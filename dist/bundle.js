import t from"https://unpkg.com/mp4-h264@1.0.7/build/mp4-encoder.js";function e(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(i){if("default"!==i&&!(i in t)){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}}))})),Object.freeze(t)}function i(){}function n(t,e){for(const i in e)t[i]=e[i];return t}function r(t){return t()}function o(){return Object.create(null)}function s(t){t.forEach(r)}function a(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function c(t,e,i,n){if(t){const r=u(t,e,i,n);return t[0](r)}}function u(t,e,i,r){return t[1]&&r?n(i.ctx.slice(),t[1](r(e))):i.ctx}function h(t,e,i,n){if(t[2]&&n){const r=t[2](n(i));if(void 0===e.dirty)return r;if("object"==typeof r){const t=[],i=Math.max(e.dirty.length,r.length);for(let n=0;n<i;n+=1)t[n]=e.dirty[n]|r[n];return t}return e.dirty|r}return e.dirty}function p(t,e,i,n,r,o){if(r){const s=u(e,i,n,o);t.p(s,r)}}function d(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let t=0;t<i;t++)e[t]=-1;return e}return-1}function f(t){const e={};for(const i in t)"$"!==i[0]&&(e[i]=t[i]);return e}function m(t,e){const i={};e=new Set(e);for(const n in t)e.has(n)||"$"===n[0]||(i[n]=t[n]);return i}function g(t){const e={};for(const i in t)e[i]=!0;return e}function y(t){return null==t?"":t}function _(t,e){t.appendChild(e)}function v(t,e,i){t.insertBefore(e,i||null)}function x(t){t.parentNode.removeChild(t)}function b(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function w(t){return document.createElement(t)}function T(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function S(t){return document.createTextNode(t)}function C(){return S(" ")}function E(){return S("")}function I(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function M(t){return function(e){return e.preventDefault(),t.call(this,e)}}function A(t,e,i){null==i?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function k(t,e){const i=Object.getOwnPropertyDescriptors(t.__proto__);for(const n in e)null==e[n]?t.removeAttribute(n):"style"===n?t.style.cssText=e[n]:"__value"===n?t.value=t[n]=e[n]:i[n]&&i[n].set?t[n]=e[n]:A(t,n,e[n])}function P(t,e){for(const i in e)A(t,i,e[i])}function L(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function z(t,e){t.value=null==e?"":e}function D(t,e,i,n){null===i?t.style.removeProperty(e):t.style.setProperty(e,i,n?"important":"")}function R(t,e,i){t.classList[i?"add":"remove"](e)}let O;function F(t){O=t}function N(){if(!O)throw new Error("Function called outside component initialization");return O}function B(t){N().$$.on_mount.push(t)}function j(){const t=N();return(e,i,{cancelable:n=!1}={})=>{const r=t.$$.callbacks[e];if(r){const o=function(t,e,{bubbles:i=!1,cancelable:n=!1}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,i,n,e),r}(e,i,{cancelable:n});return r.slice().forEach((e=>{e.call(t,o)})),!o.defaultPrevented}return!0}}function $(t){return N().$$.context.get(t)}function U(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach((t=>t.call(this,e)))}const V=[],G=[],q=[],Z=[],W=Promise.resolve();let H=!1;function X(){H||(H=!0,W.then(et))}function Y(){return X(),W}function K(t){q.push(t)}function J(t){Z.push(t)}const Q=new Set;let tt=0;function et(){const t=O;do{for(;tt<V.length;){const t=V[tt];tt++,F(t),it(t.$$)}for(F(null),V.length=0,tt=0;G.length;)G.pop()();for(let t=0;t<q.length;t+=1){const e=q[t];Q.has(e)||(Q.add(e),e())}q.length=0}while(V.length);for(;Z.length;)Z.pop()();H=!1,Q.clear(),F(t)}function it(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(K)}}const nt=new Set;let rt;function ot(){rt={r:0,c:[],p:rt}}function st(){rt.r||s(rt.c),rt=rt.p}function at(t,e){t&&t.i&&(nt.delete(t),t.i(e))}function lt(t,e,i,n){if(t&&t.o){if(nt.has(t))return;nt.add(t),rt.c.push((()=>{nt.delete(t),n&&(i&&t.d(1),n())})),t.o(e)}}const ct="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ut(t,e){lt(t,1,1,(()=>{e.delete(t.key)}))}function ht(t,e,i,n,r,o,s,a,l,c,u,h){let p=t.length,d=o.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],y=new Map,_=new Map;for(f=d;f--;){const t=h(r,o,f),a=i(t);let l=s.get(a);l?n&&l.p(t,e):(l=c(a,t),l.c()),y.set(a,g[f]=l),a in m&&_.set(a,Math.abs(f-m[a]))}const v=new Set,x=new Set;function b(t){at(t,1),t.m(a,u),s.set(t.key,t),u=t.first,d--}for(;p&&d;){const e=g[d-1],i=t[p-1],n=e.key,r=i.key;e===i?(u=e.first,p--,d--):y.has(r)?!s.has(n)||v.has(n)?b(e):x.has(r)?p--:_.get(n)>_.get(r)?(x.add(n),b(e)):(v.add(r),p--):(l(i,s),p--)}for(;p--;){const e=t[p];y.has(e.key)||l(e,s)}for(;d;)b(g[d-1]);return g}function pt(t,e){const i={},n={},r={$$scope:1};let o=t.length;for(;o--;){const s=t[o],a=e[o];if(a){for(const t in s)t in a||(n[t]=1);for(const t in a)r[t]||(i[t]=a[t],r[t]=1);t[o]=a}else for(const t in s)r[t]=1}for(const t in n)t in i||(i[t]=void 0);return i}function dt(t){return"object"==typeof t&&null!==t?t:{}}function ft(t,e,i){const n=t.$$.props[e];void 0!==n&&(t.$$.bound[n]=i,i(t.$$.ctx[n]))}function mt(t){t&&t.c()}function gt(t,e,i,n){const{fragment:o,on_mount:l,on_destroy:c,after_update:u}=t.$$;o&&o.m(e,i),n||K((()=>{const e=l.map(r).filter(a);c?c.push(...e):s(e),t.$$.on_mount=[]})),u.forEach(K)}function yt(t,e){const i=t.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function _t(t,e,n,r,a,l,c,u=[-1]){const h=O;F(t);const p=t.$$={fragment:null,ctx:null,props:l,update:i,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:o(),dirty:u,skip_bound:!1,root:e.target||h.$$.root};c&&c(p.root);let d=!1;if(p.ctx=n?n(t,e.props||{},((e,i,...n)=>{const r=n.length?n[0]:i;return p.ctx&&a(p.ctx[e],p.ctx[e]=r)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](r),d&&function(t,e){-1===t.$$.dirty[0]&&(V.push(t),X(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(t,e)),i})):[],p.update(),d=!0,s(p.before_update),p.fragment=!!r&&r(p.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);p.fragment&&p.fragment.l(t),t.forEach(x)}else p.fragment&&p.fragment.c();e.intro&&at(t.$$.fragment),gt(t,e.target,e.anchor,e.customElement),et()}F(h)}class vt{$destroy(){yt(this,1),this.$destroy=i}$on(t,e){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}var xt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function bt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function wt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Tt,St,Ct={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Tt=Ct,St=Ct.exports,function(){var t,e="Expected a function",i="__lodash_hash_undefined__",n="__lodash_placeholder__",r=16,o=32,s=64,a=128,l=256,c=1/0,u=9007199254740991,h=NaN,p=4294967295,d=[["ary",a],["bind",1],["bindKey",2],["curry",8],["curryRight",r],["flip",512],["partial",o],["partialRight",s],["rearg",l]],f="[object Arguments]",m="[object Array]",g="[object Boolean]",y="[object Date]",_="[object Error]",v="[object Function]",x="[object GeneratorFunction]",b="[object Map]",w="[object Number]",T="[object Object]",S="[object Promise]",C="[object RegExp]",E="[object Set]",I="[object String]",M="[object Symbol]",A="[object WeakMap]",k="[object ArrayBuffer]",P="[object DataView]",L="[object Float32Array]",z="[object Float64Array]",D="[object Int8Array]",R="[object Int16Array]",O="[object Int32Array]",F="[object Uint8Array]",N="[object Uint8ClampedArray]",B="[object Uint16Array]",j="[object Uint32Array]",$=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,Z=RegExp(G.source),W=RegExp(q.source),H=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,Y=/<%=([\s\S]+?)%>/g,K=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/[\\^$.*+?()[\]{}|]/g,et=RegExp(tt.source),it=/^\s+/,nt=/\s/,rt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ot=/\{\n\/\* \[wrapped with (.+)\] \*/,st=/,? & /,at=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lt=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,ut=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ht=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,ft=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,gt=/^(?:0|[1-9]\d*)$/,yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_t=/($^)/,vt=/['\n\r\u2028\u2029\\]/g,bt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",wt="\\u2700-\\u27bf",Ct="a-z\\xdf-\\xf6\\xf8-\\xff",Et="A-Z\\xc0-\\xd6\\xd8-\\xde",It="\\ufe0e\\ufe0f",Mt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",At="['’]",kt="[\\ud800-\\udfff]",Pt="["+Mt+"]",Lt="["+bt+"]",zt="\\d+",Dt="[\\u2700-\\u27bf]",Rt="["+Ct+"]",Ot="[^\\ud800-\\udfff"+Mt+zt+wt+Ct+Et+"]",Ft="\\ud83c[\\udffb-\\udfff]",Nt="[^\\ud800-\\udfff]",Bt="(?:\\ud83c[\\udde6-\\uddff]){2}",jt="[\\ud800-\\udbff][\\udc00-\\udfff]",$t="["+Et+"]",Ut="(?:"+Rt+"|"+Ot+")",Vt="(?:"+$t+"|"+Ot+")",Gt="(?:['’](?:d|ll|m|re|s|t|ve))?",qt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Zt="(?:"+Lt+"|"+Ft+")?",Wt="[\\ufe0e\\ufe0f]?",Ht=Wt+Zt+"(?:\\u200d(?:"+[Nt,Bt,jt].join("|")+")"+Wt+Zt+")*",Xt="(?:"+[Dt,Bt,jt].join("|")+")"+Ht,Yt="(?:"+[Nt+Lt+"?",Lt,Bt,jt,kt].join("|")+")",Kt=RegExp(At,"g"),Jt=RegExp(Lt,"g"),Qt=RegExp(Ft+"(?="+Ft+")|"+Yt+Ht,"g"),te=RegExp([$t+"?"+Rt+"+"+Gt+"(?="+[Pt,$t,"$"].join("|")+")",Vt+"+"+qt+"(?="+[Pt,$t+Ut,"$"].join("|")+")",$t+"?"+Ut+"+"+Gt,$t+"+"+qt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",zt,Xt].join("|"),"g"),ee=RegExp("[\\u200d\\ud800-\\udfff"+bt+It+"]"),ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ne=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],re=-1,oe={};oe[L]=oe[z]=oe[D]=oe[R]=oe[O]=oe[F]=oe[N]=oe[B]=oe[j]=!0,oe[f]=oe[m]=oe[k]=oe[g]=oe[P]=oe[y]=oe[_]=oe[v]=oe[b]=oe[w]=oe[T]=oe[C]=oe[E]=oe[I]=oe[A]=!1;var se={};se[f]=se[m]=se[k]=se[P]=se[g]=se[y]=se[L]=se[z]=se[D]=se[R]=se[O]=se[b]=se[w]=se[T]=se[C]=se[E]=se[I]=se[M]=se[F]=se[N]=se[B]=se[j]=!0,se[_]=se[v]=se[A]=!1;var ae={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},le=parseFloat,ce=parseInt,ue="object"==typeof xt&&xt&&xt.Object===Object&&xt,he="object"==typeof self&&self&&self.Object===Object&&self,pe=ue||he||Function("return this")(),de=St&&!St.nodeType&&St,fe=de&&Tt&&!Tt.nodeType&&Tt,me=fe&&fe.exports===de,ge=me&&ue.process,ye=function(){try{var t=fe&&fe.require&&fe.require("util").types;return t||ge&&ge.binding&&ge.binding("util")}catch(t){}}(),_e=ye&&ye.isArrayBuffer,ve=ye&&ye.isDate,xe=ye&&ye.isMap,be=ye&&ye.isRegExp,we=ye&&ye.isSet,Te=ye&&ye.isTypedArray;function Se(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Ce(t,e,i,n){for(var r=-1,o=null==t?0:t.length;++r<o;){var s=t[r];e(n,s,i(s),t)}return n}function Ee(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}function Ie(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function Me(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!e(t[i],i,t))return!1;return!0}function Ae(t,e){for(var i=-1,n=null==t?0:t.length,r=0,o=[];++i<n;){var s=t[i];e(s,i,t)&&(o[r++]=s)}return o}function ke(t,e){return!(null==t||!t.length)&&je(t,e,0)>-1}function Pe(t,e,i){for(var n=-1,r=null==t?0:t.length;++n<r;)if(i(e,t[n]))return!0;return!1}function Le(t,e){for(var i=-1,n=null==t?0:t.length,r=Array(n);++i<n;)r[i]=e(t[i],i,t);return r}function ze(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}function De(t,e,i,n){var r=-1,o=null==t?0:t.length;for(n&&o&&(i=t[++r]);++r<o;)i=e(i,t[r],r,t);return i}function Re(t,e,i,n){var r=null==t?0:t.length;for(n&&r&&(i=t[--r]);r--;)i=e(i,t[r],r,t);return i}function Oe(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}var Fe=Ge("length");function Ne(t,e,i){var n;return i(t,(function(t,i,r){if(e(t,i,r))return n=i,!1})),n}function Be(t,e,i,n){for(var r=t.length,o=i+(n?1:-1);n?o--:++o<r;)if(e(t[o],o,t))return o;return-1}function je(t,e,i){return e==e?function(t,e,i){for(var n=i-1,r=t.length;++n<r;)if(t[n]===e)return n;return-1}(t,e,i):Be(t,Ue,i)}function $e(t,e,i,n){for(var r=i-1,o=t.length;++r<o;)if(n(t[r],e))return r;return-1}function Ue(t){return t!=t}function Ve(t,e){var i=null==t?0:t.length;return i?We(t,e)/i:h}function Ge(e){return function(i){return null==i?t:i[e]}}function qe(e){return function(i){return null==e?t:e[i]}}function Ze(t,e,i,n,r){return r(t,(function(t,r,o){i=n?(n=!1,t):e(i,t,r,o)})),i}function We(e,i){for(var n,r=-1,o=e.length;++r<o;){var s=i(e[r]);s!==t&&(n=n===t?s:n+s)}return n}function He(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}function Xe(t){return t?t.slice(0,di(t)+1).replace(it,""):t}function Ye(t){return function(e){return t(e)}}function Ke(t,e){return Le(e,(function(e){return t[e]}))}function Je(t,e){return t.has(e)}function Qe(t,e){for(var i=-1,n=t.length;++i<n&&je(e,t[i],0)>-1;);return i}function ti(t,e){for(var i=t.length;i--&&je(e,t[i],0)>-1;);return i}function ei(t,e){for(var i=t.length,n=0;i--;)t[i]===e&&++n;return n}var ii=qe({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),ni=qe({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ri(t){return"\\"+ae[t]}function oi(t){return ee.test(t)}function si(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function ai(t,e){return function(i){return t(e(i))}}function li(t,e){for(var i=-1,r=t.length,o=0,s=[];++i<r;){var a=t[i];a!==e&&a!==n||(t[i]=n,s[o++]=i)}return s}function ci(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}function ui(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}function hi(t){return oi(t)?function(t){for(var e=Qt.lastIndex=0;Qt.test(t);)++e;return e}(t):Fe(t)}function pi(t){return oi(t)?function(t){return t.match(Qt)||[]}(t):function(t){return t.split("")}(t)}function di(t){for(var e=t.length;e--&&nt.test(t.charAt(e)););return e}var fi=qe({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),mi=function nt(xt){var bt,wt=(xt=null==xt?pe:mi.defaults(pe.Object(),xt,mi.pick(pe,ne))).Array,Tt=xt.Date,St=xt.Error,Ct=xt.Function,Et=xt.Math,It=xt.Object,Mt=xt.RegExp,At=xt.String,kt=xt.TypeError,Pt=wt.prototype,Lt=Ct.prototype,zt=It.prototype,Dt=xt["__core-js_shared__"],Rt=Lt.toString,Ot=zt.hasOwnProperty,Ft=0,Nt=(bt=/[^.]+$/.exec(Dt&&Dt.keys&&Dt.keys.IE_PROTO||""))?"Symbol(src)_1."+bt:"",Bt=zt.toString,jt=Rt.call(It),$t=pe._,Ut=Mt("^"+Rt.call(Ot).replace(tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vt=me?xt.Buffer:t,Gt=xt.Symbol,qt=xt.Uint8Array,Zt=Vt?Vt.allocUnsafe:t,Wt=ai(It.getPrototypeOf,It),Ht=It.create,Xt=zt.propertyIsEnumerable,Yt=Pt.splice,Qt=Gt?Gt.isConcatSpreadable:t,ee=Gt?Gt.iterator:t,ae=Gt?Gt.toStringTag:t,ue=function(){try{var t=fo(It,"defineProperty");return t({},"",{}),t}catch(t){}}(),he=xt.clearTimeout!==pe.clearTimeout&&xt.clearTimeout,de=Tt&&Tt.now!==pe.Date.now&&Tt.now,fe=xt.setTimeout!==pe.setTimeout&&xt.setTimeout,ge=Et.ceil,ye=Et.floor,Fe=It.getOwnPropertySymbols,qe=Vt?Vt.isBuffer:t,gi=xt.isFinite,yi=Pt.join,_i=ai(It.keys,It),vi=Et.max,xi=Et.min,bi=Tt.now,wi=xt.parseInt,Ti=Et.random,Si=Pt.reverse,Ci=fo(xt,"DataView"),Ei=fo(xt,"Map"),Ii=fo(xt,"Promise"),Mi=fo(xt,"Set"),Ai=fo(xt,"WeakMap"),ki=fo(It,"create"),Pi=Ai&&new Ai,Li={},zi=$o(Ci),Di=$o(Ei),Ri=$o(Ii),Oi=$o(Mi),Fi=$o(Ai),Ni=Gt?Gt.prototype:t,Bi=Ni?Ni.valueOf:t,ji=Ni?Ni.toString:t;function $i(t){if(ra(t)&&!Ws(t)&&!(t instanceof qi)){if(t instanceof Gi)return t;if(Ot.call(t,"__wrapped__"))return Uo(t)}return new Gi(t)}var Ui=function(){function e(){}return function(i){if(!na(i))return{};if(Ht)return Ht(i);e.prototype=i;var n=new e;return e.prototype=t,n}}();function Vi(){}function Gi(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=t}function qi(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Zi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Wi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Hi(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function Xi(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new Hi;++e<i;)this.add(t[e])}function Yi(t){var e=this.__data__=new Wi(t);this.size=e.size}function Ki(t,e){var i=Ws(t),n=!i&&Zs(t),r=!i&&!n&&Ks(t),o=!i&&!n&&!r&&pa(t),s=i||n||r||o,a=s?He(t.length,At):[],l=a.length;for(var c in t)!e&&!Ot.call(t,c)||s&&("length"==c||r&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||bo(c,l))||a.push(c);return a}function Ji(e){var i=e.length;return i?e[Yn(0,i-1)]:t}function Qi(t,e){return No(Pr(t),cn(e,0,t.length))}function tn(t){return No(Pr(t))}function en(e,i,n){(n!==t&&!Vs(e[i],n)||n===t&&!(i in e))&&an(e,i,n)}function nn(e,i,n){var r=e[i];Ot.call(e,i)&&Vs(r,n)&&(n!==t||i in e)||an(e,i,n)}function rn(t,e){for(var i=t.length;i--;)if(Vs(t[i][0],e))return i;return-1}function on(t,e,i,n){return fn(t,(function(t,r,o){e(n,t,i(t),o)})),n}function sn(t,e){return t&&Lr(e,Da(e),t)}function an(t,e,i){"__proto__"==e&&ue?ue(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function ln(e,i){for(var n=-1,r=i.length,o=wt(r),s=null==e;++n<r;)o[n]=s?t:Aa(e,i[n]);return o}function cn(e,i,n){return e==e&&(n!==t&&(e=e<=n?e:n),i!==t&&(e=e>=i?e:i)),e}function un(e,i,n,r,o,s){var a,l=1&i,c=2&i,u=4&i;if(n&&(a=o?n(e,r,o,s):n(e)),a!==t)return a;if(!na(e))return e;var h=Ws(e);if(h){if(a=function(t){var e=t.length,i=new t.constructor(e);return e&&"string"==typeof t[0]&&Ot.call(t,"index")&&(i.index=t.index,i.input=t.input),i}(e),!l)return Pr(e,a)}else{var p=yo(e),d=p==v||p==x;if(Ks(e))return Cr(e,l);if(p==T||p==f||d&&!o){if(a=c||d?{}:vo(e),!l)return c?function(t,e){return Lr(t,go(t),e)}(e,function(t,e){return t&&Lr(e,Ra(e),t)}(a,e)):function(t,e){return Lr(t,mo(t),e)}(e,sn(a,e))}else{if(!se[p])return o?e:{};a=function(t,e,i){var n,r=t.constructor;switch(e){case k:return Er(t);case g:case y:return new r(+t);case P:return function(t,e){var i=e?Er(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case L:case z:case D:case R:case O:case F:case N:case B:case j:return Ir(t,i);case b:return new r;case w:case I:return new r(t);case C:return function(t){var e=new t.constructor(t.source,ht.exec(t));return e.lastIndex=t.lastIndex,e}(t);case E:return new r;case M:return n=t,Bi?It(Bi.call(n)):{}}}(e,p,l)}}s||(s=new Yi);var m=s.get(e);if(m)return m;s.set(e,a),ca(e)?e.forEach((function(t){a.add(un(t,i,n,t,e,s))})):oa(e)&&e.forEach((function(t,r){a.set(r,un(t,i,n,r,e,s))}));var _=h?t:(u?c?so:oo:c?Ra:Da)(e);return Ee(_||e,(function(t,r){_&&(t=e[r=t]),nn(a,r,un(t,i,n,r,e,s))})),a}function hn(e,i,n){var r=n.length;if(null==e)return!r;for(e=It(e);r--;){var o=n[r],s=i[o],a=e[o];if(a===t&&!(o in e)||!s(a))return!1}return!0}function pn(i,n,r){if("function"!=typeof i)throw new kt(e);return Do((function(){i.apply(t,r)}),n)}function dn(t,e,i,n){var r=-1,o=ke,s=!0,a=t.length,l=[],c=e.length;if(!a)return l;i&&(e=Le(e,Ye(i))),n?(o=Pe,s=!1):e.length>=200&&(o=Je,s=!1,e=new Xi(e));t:for(;++r<a;){var u=t[r],h=null==i?u:i(u);if(u=n||0!==u?u:0,s&&h==h){for(var p=c;p--;)if(e[p]===h)continue t;l.push(u)}else o(e,h,n)||l.push(u)}return l}$i.templateSettings={escape:H,evaluate:X,interpolate:Y,variable:"",imports:{_:$i}},$i.prototype=Vi.prototype,$i.prototype.constructor=$i,Gi.prototype=Ui(Vi.prototype),Gi.prototype.constructor=Gi,qi.prototype=Ui(Vi.prototype),qi.prototype.constructor=qi,Zi.prototype.clear=function(){this.__data__=ki?ki(null):{},this.size=0},Zi.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Zi.prototype.get=function(e){var n=this.__data__;if(ki){var r=n[e];return r===i?t:r}return Ot.call(n,e)?n[e]:t},Zi.prototype.has=function(e){var i=this.__data__;return ki?i[e]!==t:Ot.call(i,e)},Zi.prototype.set=function(e,n){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=ki&&n===t?i:n,this},Wi.prototype.clear=function(){this.__data__=[],this.size=0},Wi.prototype.delete=function(t){var e=this.__data__,i=rn(e,t);return!(i<0||(i==e.length-1?e.pop():Yt.call(e,i,1),--this.size,0))},Wi.prototype.get=function(e){var i=this.__data__,n=rn(i,e);return n<0?t:i[n][1]},Wi.prototype.has=function(t){return rn(this.__data__,t)>-1},Wi.prototype.set=function(t,e){var i=this.__data__,n=rn(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},Hi.prototype.clear=function(){this.size=0,this.__data__={hash:new Zi,map:new(Ei||Wi),string:new Zi}},Hi.prototype.delete=function(t){var e=ho(this,t).delete(t);return this.size-=e?1:0,e},Hi.prototype.get=function(t){return ho(this,t).get(t)},Hi.prototype.has=function(t){return ho(this,t).has(t)},Hi.prototype.set=function(t,e){var i=ho(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},Xi.prototype.add=Xi.prototype.push=function(t){return this.__data__.set(t,i),this},Xi.prototype.has=function(t){return this.__data__.has(t)},Yi.prototype.clear=function(){this.__data__=new Wi,this.size=0},Yi.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Yi.prototype.get=function(t){return this.__data__.get(t)},Yi.prototype.has=function(t){return this.__data__.has(t)},Yi.prototype.set=function(t,e){var i=this.__data__;if(i instanceof Wi){var n=i.__data__;if(!Ei||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new Hi(n)}return i.set(t,e),this.size=i.size,this};var fn=Rr(wn),mn=Rr(Tn,!0);function gn(t,e){var i=!0;return fn(t,(function(t,n,r){return i=!!e(t,n,r)})),i}function yn(e,i,n){for(var r=-1,o=e.length;++r<o;){var s=e[r],a=i(s);if(null!=a&&(l===t?a==a&&!ha(a):n(a,l)))var l=a,c=s}return c}function _n(t,e){var i=[];return fn(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i}function vn(t,e,i,n,r){var o=-1,s=t.length;for(i||(i=xo),r||(r=[]);++o<s;){var a=t[o];e>0&&i(a)?e>1?vn(a,e-1,i,n,r):ze(r,a):n||(r[r.length]=a)}return r}var xn=Or(),bn=Or(!0);function wn(t,e){return t&&xn(t,e,Da)}function Tn(t,e){return t&&bn(t,e,Da)}function Sn(t,e){return Ae(e,(function(e){return ta(t[e])}))}function Cn(e,i){for(var n=0,r=(i=br(i,e)).length;null!=e&&n<r;)e=e[jo(i[n++])];return n&&n==r?e:t}function En(t,e,i){var n=e(t);return Ws(t)?n:ze(n,i(t))}function In(e){return null==e?e===t?"[object Undefined]":"[object Null]":ae&&ae in It(e)?function(e){var i=Ot.call(e,ae),n=e[ae];try{e[ae]=t;var r=!0}catch(t){}var o=Bt.call(e);return r&&(i?e[ae]=n:delete e[ae]),o}(e):function(t){return Bt.call(t)}(e)}function Mn(t,e){return t>e}function An(t,e){return null!=t&&Ot.call(t,e)}function kn(t,e){return null!=t&&e in It(t)}function Pn(e,i,n){for(var r=n?Pe:ke,o=e[0].length,s=e.length,a=s,l=wt(s),c=1/0,u=[];a--;){var h=e[a];a&&i&&(h=Le(h,Ye(i))),c=xi(h.length,c),l[a]=!n&&(i||o>=120&&h.length>=120)?new Xi(a&&h):t}h=e[0];var p=-1,d=l[0];t:for(;++p<o&&u.length<c;){var f=h[p],m=i?i(f):f;if(f=n||0!==f?f:0,!(d?Je(d,m):r(u,m,n))){for(a=s;--a;){var g=l[a];if(!(g?Je(g,m):r(e[a],m,n)))continue t}d&&d.push(m),u.push(f)}}return u}function Ln(e,i,n){var r=null==(e=ko(e,i=br(i,e)))?e:e[jo(Qo(i))];return null==r?t:Se(r,e,n)}function zn(t){return ra(t)&&In(t)==f}function Dn(e,i,n,r,o){return e===i||(null==e||null==i||!ra(e)&&!ra(i)?e!=e&&i!=i:function(e,i,n,r,o,s){var a=Ws(e),l=Ws(i),c=a?m:yo(e),u=l?m:yo(i),h=(c=c==f?T:c)==T,p=(u=u==f?T:u)==T,d=c==u;if(d&&Ks(e)){if(!Ks(i))return!1;a=!0,h=!1}if(d&&!h)return s||(s=new Yi),a||pa(e)?no(e,i,n,r,o,s):function(t,e,i,n,r,o,s){switch(i){case P:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case k:return!(t.byteLength!=e.byteLength||!o(new qt(t),new qt(e)));case g:case y:case w:return Vs(+t,+e);case _:return t.name==e.name&&t.message==e.message;case C:case I:return t==e+"";case b:var a=si;case E:var l=1&n;if(a||(a=ci),t.size!=e.size&&!l)return!1;var c=s.get(t);if(c)return c==e;n|=2,s.set(t,e);var u=no(a(t),a(e),n,r,o,s);return s.delete(t),u;case M:if(Bi)return Bi.call(t)==Bi.call(e)}return!1}(e,i,c,n,r,o,s);if(!(1&n)){var v=h&&Ot.call(e,"__wrapped__"),x=p&&Ot.call(i,"__wrapped__");if(v||x){var S=v?e.value():e,A=x?i.value():i;return s||(s=new Yi),o(S,A,n,r,s)}}return!!d&&(s||(s=new Yi),function(e,i,n,r,o,s){var a=1&n,l=oo(e),c=l.length,u=oo(i).length;if(c!=u&&!a)return!1;for(var h=c;h--;){var p=l[h];if(!(a?p in i:Ot.call(i,p)))return!1}var d=s.get(e),f=s.get(i);if(d&&f)return d==i&&f==e;var m=!0;s.set(e,i),s.set(i,e);for(var g=a;++h<c;){var y=e[p=l[h]],_=i[p];if(r)var v=a?r(_,y,p,i,e,s):r(y,_,p,e,i,s);if(!(v===t?y===_||o(y,_,n,r,s):v)){m=!1;break}g||(g="constructor"==p)}if(m&&!g){var x=e.constructor,b=i.constructor;x==b||!("constructor"in e)||!("constructor"in i)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(m=!1)}return s.delete(e),s.delete(i),m}(e,i,n,r,o,s))}(e,i,n,r,Dn,o))}function Rn(e,i,n,r){var o=n.length,s=o,a=!r;if(null==e)return!s;for(e=It(e);o--;){var l=n[o];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<s;){var c=(l=n[o])[0],u=e[c],h=l[1];if(a&&l[2]){if(u===t&&!(c in e))return!1}else{var p=new Yi;if(r)var d=r(u,h,c,e,i,p);if(!(d===t?Dn(h,u,3,r,p):d))return!1}}return!0}function On(t){return!(!na(t)||function(t){return!!Nt&&Nt in t}(t))&&(ta(t)?Ut:ft).test($o(t))}function Fn(t){return"function"==typeof t?t:null==t?sl:"object"==typeof t?Ws(t)?Vn(t[0],t[1]):Un(t):ml(t)}function Nn(t){if(!Eo(t))return _i(t);var e=[];for(var i in It(t))Ot.call(t,i)&&"constructor"!=i&&e.push(i);return e}function Bn(t){if(!na(t))return function(t){var e=[];if(null!=t)for(var i in It(t))e.push(i);return e}(t);var e=Eo(t),i=[];for(var n in t)("constructor"!=n||!e&&Ot.call(t,n))&&i.push(n);return i}function jn(t,e){return t<e}function $n(t,e){var i=-1,n=Xs(t)?wt(t.length):[];return fn(t,(function(t,r,o){n[++i]=e(t,r,o)})),n}function Un(t){var e=po(t);return 1==e.length&&e[0][2]?Mo(e[0][0],e[0][1]):function(i){return i===t||Rn(i,t,e)}}function Vn(e,i){return To(e)&&Io(i)?Mo(jo(e),i):function(n){var r=Aa(n,e);return r===t&&r===i?ka(n,e):Dn(i,r,3)}}function Gn(e,i,n,r,o){e!==i&&xn(i,(function(s,a){if(o||(o=new Yi),na(s))!function(e,i,n,r,o,s,a){var l=Lo(e,n),c=Lo(i,n),u=a.get(c);if(u)en(e,n,u);else{var h=s?s(l,c,n+"",e,i,a):t,p=h===t;if(p){var d=Ws(c),f=!d&&Ks(c),m=!d&&!f&&pa(c);h=c,d||f||m?Ws(l)?h=l:Ys(l)?h=Pr(l):f?(p=!1,h=Cr(c,!0)):m?(p=!1,h=Ir(c,!0)):h=[]:aa(c)||Zs(c)?(h=l,Zs(l)?h=xa(l):na(l)&&!ta(l)||(h=vo(c))):p=!1}p&&(a.set(c,h),o(h,c,r,s,a),a.delete(c)),en(e,n,h)}}(e,i,a,n,Gn,r,o);else{var l=r?r(Lo(e,a),s,a+"",e,i,o):t;l===t&&(l=s),en(e,a,l)}}),Ra)}function qn(e,i){var n=e.length;if(n)return bo(i+=i<0?n:0,n)?e[i]:t}function Zn(t,e,i){e=e.length?Le(e,(function(t){return Ws(t)?function(e){return Cn(e,1===t.length?t[0]:t)}:t})):[sl];var n=-1;e=Le(e,Ye(uo()));var r=$n(t,(function(t,i,r){var o=Le(e,(function(e){return e(t)}));return{criteria:o,index:++n,value:t}}));return function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(r,(function(t,e){return function(t,e,i){for(var n=-1,r=t.criteria,o=e.criteria,s=r.length,a=i.length;++n<s;){var l=Mr(r[n],o[n]);if(l)return n>=a?l:l*("desc"==i[n]?-1:1)}return t.index-e.index}(t,e,i)}))}function Wn(t,e,i){for(var n=-1,r=e.length,o={};++n<r;){var s=e[n],a=Cn(t,s);i(a,s)&&er(o,br(s,t),a)}return o}function Hn(t,e,i,n){var r=n?$e:je,o=-1,s=e.length,a=t;for(t===e&&(e=Pr(e)),i&&(a=Le(t,Ye(i)));++o<s;)for(var l=0,c=e[o],u=i?i(c):c;(l=r(a,u,l,n))>-1;)a!==t&&Yt.call(a,l,1),Yt.call(t,l,1);return t}function Xn(t,e){for(var i=t?e.length:0,n=i-1;i--;){var r=e[i];if(i==n||r!==o){var o=r;bo(r)?Yt.call(t,r,1):dr(t,r)}}return t}function Yn(t,e){return t+ye(Ti()*(e-t+1))}function Kn(t,e){var i="";if(!t||e<1||e>u)return i;do{e%2&&(i+=t),(e=ye(e/2))&&(t+=t)}while(e);return i}function Jn(t,e){return Ro(Ao(t,e,sl),t+"")}function Qn(t){return Ji(Va(t))}function tr(t,e){var i=Va(t);return No(i,cn(e,0,i.length))}function er(e,i,n,r){if(!na(e))return e;for(var o=-1,s=(i=br(i,e)).length,a=s-1,l=e;null!=l&&++o<s;){var c=jo(i[o]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(o!=a){var h=l[c];(u=r?r(h,c,l):t)===t&&(u=na(h)?h:bo(i[o+1])?[]:{})}nn(l,c,u),l=l[c]}return e}var ir=Pi?function(t,e){return Pi.set(t,e),t}:sl,nr=ue?function(t,e){return ue(t,"toString",{configurable:!0,enumerable:!1,value:nl(e),writable:!0})}:sl;function rr(t){return No(Va(t))}function or(t,e,i){var n=-1,r=t.length;e<0&&(e=-e>r?0:r+e),(i=i>r?r:i)<0&&(i+=r),r=e>i?0:i-e>>>0,e>>>=0;for(var o=wt(r);++n<r;)o[n]=t[n+e];return o}function sr(t,e){var i;return fn(t,(function(t,n,r){return!(i=e(t,n,r))})),!!i}function ar(t,e,i){var n=0,r=null==t?n:t.length;if("number"==typeof e&&e==e&&r<=2147483647){for(;n<r;){var o=n+r>>>1,s=t[o];null!==s&&!ha(s)&&(i?s<=e:s<e)?n=o+1:r=o}return r}return lr(t,e,sl,i)}function lr(e,i,n,r){var o=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(i=n(i))!=i,l=null===i,c=ha(i),u=i===t;o<s;){var h=ye((o+s)/2),p=n(e[h]),d=p!==t,f=null===p,m=p==p,g=ha(p);if(a)var y=r||m;else y=u?m&&(r||d):l?m&&d&&(r||!f):c?m&&d&&!f&&(r||!g):!f&&!g&&(r?p<=i:p<i);y?o=h+1:s=h}return xi(s,4294967294)}function cr(t,e){for(var i=-1,n=t.length,r=0,o=[];++i<n;){var s=t[i],a=e?e(s):s;if(!i||!Vs(a,l)){var l=a;o[r++]=0===s?0:s}}return o}function ur(t){return"number"==typeof t?t:ha(t)?h:+t}function hr(t){if("string"==typeof t)return t;if(Ws(t))return Le(t,hr)+"";if(ha(t))return ji?ji.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function pr(t,e,i){var n=-1,r=ke,o=t.length,s=!0,a=[],l=a;if(i)s=!1,r=Pe;else if(o>=200){var c=e?null:Kr(t);if(c)return ci(c);s=!1,r=Je,l=new Xi}else l=e?[]:a;t:for(;++n<o;){var u=t[n],h=e?e(u):u;if(u=i||0!==u?u:0,s&&h==h){for(var p=l.length;p--;)if(l[p]===h)continue t;e&&l.push(h),a.push(u)}else r(l,h,i)||(l!==a&&l.push(h),a.push(u))}return a}function dr(t,e){return null==(t=ko(t,e=br(e,t)))||delete t[jo(Qo(e))]}function fr(t,e,i,n){return er(t,e,i(Cn(t,e)),n)}function mr(t,e,i,n){for(var r=t.length,o=n?r:-1;(n?o--:++o<r)&&e(t[o],o,t););return i?or(t,n?0:o,n?o+1:r):or(t,n?o+1:0,n?r:o)}function gr(t,e){var i=t;return i instanceof qi&&(i=i.value()),De(e,(function(t,e){return e.func.apply(e.thisArg,ze([t],e.args))}),i)}function yr(t,e,i){var n=t.length;if(n<2)return n?pr(t[0]):[];for(var r=-1,o=wt(n);++r<n;)for(var s=t[r],a=-1;++a<n;)a!=r&&(o[r]=dn(o[r]||s,t[a],e,i));return pr(vn(o,1),e,i)}function _r(e,i,n){for(var r=-1,o=e.length,s=i.length,a={};++r<o;){var l=r<s?i[r]:t;n(a,e[r],l)}return a}function vr(t){return Ys(t)?t:[]}function xr(t){return"function"==typeof t?t:sl}function br(t,e){return Ws(t)?t:To(t,e)?[t]:Bo(ba(t))}var wr=Jn;function Tr(e,i,n){var r=e.length;return n=n===t?r:n,!i&&n>=r?e:or(e,i,n)}var Sr=he||function(t){return pe.clearTimeout(t)};function Cr(t,e){if(e)return t.slice();var i=t.length,n=Zt?Zt(i):new t.constructor(i);return t.copy(n),n}function Er(t){var e=new t.constructor(t.byteLength);return new qt(e).set(new qt(t)),e}function Ir(t,e){var i=e?Er(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function Mr(e,i){if(e!==i){var n=e!==t,r=null===e,o=e==e,s=ha(e),a=i!==t,l=null===i,c=i==i,u=ha(i);if(!l&&!u&&!s&&e>i||s&&a&&c&&!l&&!u||r&&a&&c||!n&&c||!o)return 1;if(!r&&!s&&!u&&e<i||u&&n&&o&&!r&&!s||l&&n&&o||!a&&o||!c)return-1}return 0}function Ar(t,e,i,n){for(var r=-1,o=t.length,s=i.length,a=-1,l=e.length,c=vi(o-s,0),u=wt(l+c),h=!n;++a<l;)u[a]=e[a];for(;++r<s;)(h||r<o)&&(u[i[r]]=t[r]);for(;c--;)u[a++]=t[r++];return u}function kr(t,e,i,n){for(var r=-1,o=t.length,s=-1,a=i.length,l=-1,c=e.length,u=vi(o-a,0),h=wt(u+c),p=!n;++r<u;)h[r]=t[r];for(var d=r;++l<c;)h[d+l]=e[l];for(;++s<a;)(p||r<o)&&(h[d+i[s]]=t[r++]);return h}function Pr(t,e){var i=-1,n=t.length;for(e||(e=wt(n));++i<n;)e[i]=t[i];return e}function Lr(e,i,n,r){var o=!n;n||(n={});for(var s=-1,a=i.length;++s<a;){var l=i[s],c=r?r(n[l],e[l],l,n,e):t;c===t&&(c=e[l]),o?an(n,l,c):nn(n,l,c)}return n}function zr(t,e){return function(i,n){var r=Ws(i)?Ce:on,o=e?e():{};return r(i,t,uo(n,2),o)}}function Dr(e){return Jn((function(i,n){var r=-1,o=n.length,s=o>1?n[o-1]:t,a=o>2?n[2]:t;for(s=e.length>3&&"function"==typeof s?(o--,s):t,a&&wo(n[0],n[1],a)&&(s=o<3?t:s,o=1),i=It(i);++r<o;){var l=n[r];l&&e(i,l,r,s)}return i}))}function Rr(t,e){return function(i,n){if(null==i)return i;if(!Xs(i))return t(i,n);for(var r=i.length,o=e?r:-1,s=It(i);(e?o--:++o<r)&&!1!==n(s[o],o,s););return i}}function Or(t){return function(e,i,n){for(var r=-1,o=It(e),s=n(e),a=s.length;a--;){var l=s[t?a:++r];if(!1===i(o[l],l,o))break}return e}}function Fr(e){return function(i){var n=oi(i=ba(i))?pi(i):t,r=n?n[0]:i.charAt(0),o=n?Tr(n,1).join(""):i.slice(1);return r[e]()+o}}function Nr(t){return function(e){return De(tl(Za(e).replace(Kt,"")),t,"")}}function Br(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Ui(t.prototype),n=t.apply(i,e);return na(n)?n:i}}function jr(e){return function(i,n,r){var o=It(i);if(!Xs(i)){var s=uo(n,3);i=Da(i),n=function(t){return s(o[t],t,o)}}var a=e(i,n,r);return a>-1?o[s?i[a]:a]:t}}function $r(i){return ro((function(n){var r=n.length,o=r,s=Gi.prototype.thru;for(i&&n.reverse();o--;){var a=n[o];if("function"!=typeof a)throw new kt(e);if(s&&!l&&"wrapper"==lo(a))var l=new Gi([],!0)}for(o=l?o:r;++o<r;){var c=lo(a=n[o]),u="wrapper"==c?ao(a):t;l=u&&So(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[lo(u[0])].apply(l,u[3]):1==a.length&&So(a)?l[c]():l.thru(a)}return function(){var t=arguments,e=t[0];if(l&&1==t.length&&Ws(e))return l.plant(e).value();for(var i=0,o=r?n[i].apply(this,t):e;++i<r;)o=n[i].call(this,o);return o}}))}function Ur(e,i,n,r,o,s,l,c,u,h){var p=i&a,d=1&i,f=2&i,m=24&i,g=512&i,y=f?t:Br(e);return function t(){for(var a=arguments.length,_=wt(a),v=a;v--;)_[v]=arguments[v];if(m)var x=co(t),b=ei(_,x);if(r&&(_=Ar(_,r,o,m)),s&&(_=kr(_,s,l,m)),a-=b,m&&a<h){var w=li(_,x);return Xr(e,i,Ur,t.placeholder,n,_,w,c,u,h-a)}var T=d?n:this,S=f?T[e]:e;return a=_.length,c?_=Po(_,c):g&&a>1&&_.reverse(),p&&u<a&&(_.length=u),this&&this!==pe&&this instanceof t&&(S=y||Br(S)),S.apply(T,_)}}function Vr(t,e){return function(i,n){return function(t,e,i,n){return wn(t,(function(t,r,o){e(n,i(t),r,o)})),n}(i,t,e(n),{})}}function Gr(e,i){return function(n,r){var o;if(n===t&&r===t)return i;if(n!==t&&(o=n),r!==t){if(o===t)return r;"string"==typeof n||"string"==typeof r?(n=hr(n),r=hr(r)):(n=ur(n),r=ur(r)),o=e(n,r)}return o}}function qr(t){return ro((function(e){return e=Le(e,Ye(uo())),Jn((function(i){var n=this;return t(e,(function(t){return Se(t,n,i)}))}))}))}function Zr(e,i){var n=(i=i===t?" ":hr(i)).length;if(n<2)return n?Kn(i,e):i;var r=Kn(i,ge(e/hi(i)));return oi(i)?Tr(pi(r),0,e).join(""):r.slice(0,e)}function Wr(e){return function(i,n,r){return r&&"number"!=typeof r&&wo(i,n,r)&&(n=r=t),i=ga(i),n===t?(n=i,i=0):n=ga(n),function(t,e,i,n){for(var r=-1,o=vi(ge((e-t)/(i||1)),0),s=wt(o);o--;)s[n?o:++r]=t,t+=i;return s}(i,n,r=r===t?i<n?1:-1:ga(r),e)}}function Hr(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=va(e),i=va(i)),t(e,i)}}function Xr(e,i,n,r,a,l,c,u,h,p){var d=8&i;i|=d?o:s,4&(i&=~(d?s:o))||(i&=-4);var f=[e,i,a,d?l:t,d?c:t,d?t:l,d?t:c,u,h,p],m=n.apply(t,f);return So(e)&&zo(m,f),m.placeholder=r,Oo(m,e,i)}function Yr(t){var e=Et[t];return function(t,i){if(t=va(t),(i=null==i?0:xi(ya(i),292))&&gi(t)){var n=(ba(t)+"e").split("e");return+((n=(ba(e(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return e(t)}}var Kr=Mi&&1/ci(new Mi([,-0]))[1]==c?function(t){return new Mi(t)}:hl;function Jr(t){return function(e){var i=yo(e);return i==b?si(e):i==E?ui(e):function(t,e){return Le(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Qr(i,c,u,h,p,d,f,m){var g=2&c;if(!g&&"function"!=typeof i)throw new kt(e);var y=h?h.length:0;if(y||(c&=-97,h=p=t),f=f===t?f:vi(ya(f),0),m=m===t?m:ya(m),y-=p?p.length:0,c&s){var _=h,v=p;h=p=t}var x=g?t:ao(i),b=[i,c,u,h,p,_,v,d,f,m];if(x&&function(t,e){var i=t[1],r=e[1],o=i|r,s=o<131,c=r==a&&8==i||r==a&&i==l&&t[7].length<=e[8]||384==r&&e[7].length<=e[8]&&8==i;if(!s&&!c)return t;1&r&&(t[2]=e[2],o|=1&i?0:4);var u=e[3];if(u){var h=t[3];t[3]=h?Ar(h,u,e[4]):u,t[4]=h?li(t[3],n):e[4]}(u=e[5])&&(h=t[5],t[5]=h?kr(h,u,e[6]):u,t[6]=h?li(t[5],n):e[6]),(u=e[7])&&(t[7]=u),r&a&&(t[8]=null==t[8]?e[8]:xi(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=o}(b,x),i=b[0],c=b[1],u=b[2],h=b[3],p=b[4],!(m=b[9]=b[9]===t?g?0:i.length:vi(b[9]-y,0))&&24&c&&(c&=-25),c&&1!=c)w=8==c||c==r?function(e,i,n){var r=Br(e);return function o(){for(var s=arguments.length,a=wt(s),l=s,c=co(o);l--;)a[l]=arguments[l];var u=s<3&&a[0]!==c&&a[s-1]!==c?[]:li(a,c);return(s-=u.length)<n?Xr(e,i,Ur,o.placeholder,t,a,u,t,t,n-s):Se(this&&this!==pe&&this instanceof o?r:e,this,a)}}(i,c,m):c!=o&&33!=c||p.length?Ur.apply(t,b):function(t,e,i,n){var r=1&e,o=Br(t);return function e(){for(var s=-1,a=arguments.length,l=-1,c=n.length,u=wt(c+a),h=this&&this!==pe&&this instanceof e?o:t;++l<c;)u[l]=n[l];for(;a--;)u[l++]=arguments[++s];return Se(h,r?i:this,u)}}(i,c,u,h);else var w=function(t,e,i){var n=1&e,r=Br(t);return function e(){return(this&&this!==pe&&this instanceof e?r:t).apply(n?i:this,arguments)}}(i,c,u);return Oo((x?ir:zo)(w,b),i,c)}function to(e,i,n,r){return e===t||Vs(e,zt[n])&&!Ot.call(r,n)?i:e}function eo(e,i,n,r,o,s){return na(e)&&na(i)&&(s.set(i,e),Gn(e,i,t,eo,s),s.delete(i)),e}function io(e){return aa(e)?t:e}function no(e,i,n,r,o,s){var a=1&n,l=e.length,c=i.length;if(l!=c&&!(a&&c>l))return!1;var u=s.get(e),h=s.get(i);if(u&&h)return u==i&&h==e;var p=-1,d=!0,f=2&n?new Xi:t;for(s.set(e,i),s.set(i,e);++p<l;){var m=e[p],g=i[p];if(r)var y=a?r(g,m,p,i,e,s):r(m,g,p,e,i,s);if(y!==t){if(y)continue;d=!1;break}if(f){if(!Oe(i,(function(t,e){if(!Je(f,e)&&(m===t||o(m,t,n,r,s)))return f.push(e)}))){d=!1;break}}else if(m!==g&&!o(m,g,n,r,s)){d=!1;break}}return s.delete(e),s.delete(i),d}function ro(e){return Ro(Ao(e,t,Ho),e+"")}function oo(t){return En(t,Da,mo)}function so(t){return En(t,Ra,go)}var ao=Pi?function(t){return Pi.get(t)}:hl;function lo(t){for(var e=t.name+"",i=Li[e],n=Ot.call(Li,e)?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==t)return r.name}return e}function co(t){return(Ot.call($i,"placeholder")?$i:t).placeholder}function uo(){var t=$i.iteratee||al;return t=t===al?Fn:t,arguments.length?t(arguments[0],arguments[1]):t}function ho(t,e){var i,n,r=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof e?"string":"hash"]:r.map}function po(t){for(var e=Da(t),i=e.length;i--;){var n=e[i],r=t[n];e[i]=[n,r,Io(r)]}return e}function fo(e,i){var n=function(e,i){return null==e?t:e[i]}(e,i);return On(n)?n:t}var mo=Fe?function(t){return null==t?[]:(t=It(t),Ae(Fe(t),(function(e){return Xt.call(t,e)})))}:_l,go=Fe?function(t){for(var e=[];t;)ze(e,mo(t)),t=Wt(t);return e}:_l,yo=In;function _o(t,e,i){for(var n=-1,r=(e=br(e,t)).length,o=!1;++n<r;){var s=jo(e[n]);if(!(o=null!=t&&i(t,s)))break;t=t[s]}return o||++n!=r?o:!!(r=null==t?0:t.length)&&ia(r)&&bo(s,r)&&(Ws(t)||Zs(t))}function vo(t){return"function"!=typeof t.constructor||Eo(t)?{}:Ui(Wt(t))}function xo(t){return Ws(t)||Zs(t)||!!(Qt&&t&&t[Qt])}function bo(t,e){var i=typeof t;return!!(e=null==e?u:e)&&("number"==i||"symbol"!=i&&gt.test(t))&&t>-1&&t%1==0&&t<e}function wo(t,e,i){if(!na(i))return!1;var n=typeof e;return!!("number"==n?Xs(i)&&bo(e,i.length):"string"==n&&e in i)&&Vs(i[e],t)}function To(t,e){if(Ws(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!ha(t))||J.test(t)||!K.test(t)||null!=e&&t in It(e)}function So(t){var e=lo(t),i=$i[e];if("function"!=typeof i||!(e in qi.prototype))return!1;if(t===i)return!0;var n=ao(i);return!!n&&t===n[0]}(Ci&&yo(new Ci(new ArrayBuffer(1)))!=P||Ei&&yo(new Ei)!=b||Ii&&yo(Ii.resolve())!=S||Mi&&yo(new Mi)!=E||Ai&&yo(new Ai)!=A)&&(yo=function(e){var i=In(e),n=i==T?e.constructor:t,r=n?$o(n):"";if(r)switch(r){case zi:return P;case Di:return b;case Ri:return S;case Oi:return E;case Fi:return A}return i});var Co=Dt?ta:vl;function Eo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||zt)}function Io(t){return t==t&&!na(t)}function Mo(e,i){return function(n){return null!=n&&n[e]===i&&(i!==t||e in It(n))}}function Ao(e,i,n){return i=vi(i===t?e.length-1:i,0),function(){for(var t=arguments,r=-1,o=vi(t.length-i,0),s=wt(o);++r<o;)s[r]=t[i+r];r=-1;for(var a=wt(i+1);++r<i;)a[r]=t[r];return a[i]=n(s),Se(e,this,a)}}function ko(t,e){return e.length<2?t:Cn(t,or(e,0,-1))}function Po(e,i){for(var n=e.length,r=xi(i.length,n),o=Pr(e);r--;){var s=i[r];e[r]=bo(s,n)?o[s]:t}return e}function Lo(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var zo=Fo(ir),Do=fe||function(t,e){return pe.setTimeout(t,e)},Ro=Fo(nr);function Oo(t,e,i){var n=e+"";return Ro(t,function(t,e){var i=e.length;if(!i)return t;var n=i-1;return e[n]=(i>1?"& ":"")+e[n],e=e.join(i>2?", ":" "),t.replace(rt,"{\n/* [wrapped with "+e+"] */\n")}(n,function(t,e){return Ee(d,(function(i){var n="_."+i[0];e&i[1]&&!ke(t,n)&&t.push(n)})),t.sort()}(function(t){var e=t.match(ot);return e?e[1].split(st):[]}(n),i)))}function Fo(e){var i=0,n=0;return function(){var r=bi(),o=16-(r-n);if(n=r,o>0){if(++i>=800)return arguments[0]}else i=0;return e.apply(t,arguments)}}function No(e,i){var n=-1,r=e.length,o=r-1;for(i=i===t?r:i;++n<i;){var s=Yn(n,o),a=e[s];e[s]=e[n],e[n]=a}return e.length=i,e}var Bo=function(t){var e=Fs(t,(function(t){return 500===i.size&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,(function(t,i,n,r){e.push(n?r.replace(ct,"$1"):i||t)})),e}));function jo(t){if("string"==typeof t||ha(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function $o(t){if(null!=t){try{return Rt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Uo(t){if(t instanceof qi)return t.clone();var e=new Gi(t.__wrapped__,t.__chain__);return e.__actions__=Pr(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Vo=Jn((function(t,e){return Ys(t)?dn(t,vn(e,1,Ys,!0)):[]})),Go=Jn((function(e,i){var n=Qo(i);return Ys(n)&&(n=t),Ys(e)?dn(e,vn(i,1,Ys,!0),uo(n,2)):[]})),qo=Jn((function(e,i){var n=Qo(i);return Ys(n)&&(n=t),Ys(e)?dn(e,vn(i,1,Ys,!0),t,n):[]}));function Zo(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:ya(i);return r<0&&(r=vi(n+r,0)),Be(t,uo(e,3),r)}function Wo(e,i,n){var r=null==e?0:e.length;if(!r)return-1;var o=r-1;return n!==t&&(o=ya(n),o=n<0?vi(r+o,0):xi(o,r-1)),Be(e,uo(i,3),o,!0)}function Ho(t){return null!=t&&t.length?vn(t,1):[]}function Xo(e){return e&&e.length?e[0]:t}var Yo=Jn((function(t){var e=Le(t,vr);return e.length&&e[0]===t[0]?Pn(e):[]})),Ko=Jn((function(e){var i=Qo(e),n=Le(e,vr);return i===Qo(n)?i=t:n.pop(),n.length&&n[0]===e[0]?Pn(n,uo(i,2)):[]})),Jo=Jn((function(e){var i=Qo(e),n=Le(e,vr);return(i="function"==typeof i?i:t)&&n.pop(),n.length&&n[0]===e[0]?Pn(n,t,i):[]}));function Qo(e){var i=null==e?0:e.length;return i?e[i-1]:t}var ts=Jn(es);function es(t,e){return t&&t.length&&e&&e.length?Hn(t,e):t}var is=ro((function(t,e){var i=null==t?0:t.length,n=ln(t,e);return Xn(t,Le(e,(function(t){return bo(t,i)?+t:t})).sort(Mr)),n}));function ns(t){return null==t?t:Si.call(t)}var rs=Jn((function(t){return pr(vn(t,1,Ys,!0))})),os=Jn((function(e){var i=Qo(e);return Ys(i)&&(i=t),pr(vn(e,1,Ys,!0),uo(i,2))})),ss=Jn((function(e){var i=Qo(e);return i="function"==typeof i?i:t,pr(vn(e,1,Ys,!0),t,i)}));function as(t){if(!t||!t.length)return[];var e=0;return t=Ae(t,(function(t){if(Ys(t))return e=vi(t.length,e),!0})),He(e,(function(e){return Le(t,Ge(e))}))}function ls(e,i){if(!e||!e.length)return[];var n=as(e);return null==i?n:Le(n,(function(e){return Se(i,t,e)}))}var cs=Jn((function(t,e){return Ys(t)?dn(t,e):[]})),us=Jn((function(t){return yr(Ae(t,Ys))})),hs=Jn((function(e){var i=Qo(e);return Ys(i)&&(i=t),yr(Ae(e,Ys),uo(i,2))})),ps=Jn((function(e){var i=Qo(e);return i="function"==typeof i?i:t,yr(Ae(e,Ys),t,i)})),ds=Jn(as),fs=Jn((function(e){var i=e.length,n=i>1?e[i-1]:t;return n="function"==typeof n?(e.pop(),n):t,ls(e,n)}));function ms(t){var e=$i(t);return e.__chain__=!0,e}function gs(t,e){return e(t)}var ys=ro((function(e){var i=e.length,n=i?e[0]:0,r=this.__wrapped__,o=function(t){return ln(t,e)};return!(i>1||this.__actions__.length)&&r instanceof qi&&bo(n)?((r=r.slice(n,+n+(i?1:0))).__actions__.push({func:gs,args:[o],thisArg:t}),new Gi(r,this.__chain__).thru((function(e){return i&&!e.length&&e.push(t),e}))):this.thru(o)})),_s=zr((function(t,e,i){Ot.call(t,i)?++t[i]:an(t,i,1)})),vs=jr(Zo),xs=jr(Wo);function bs(t,e){return(Ws(t)?Ee:fn)(t,uo(e,3))}function ws(t,e){return(Ws(t)?Ie:mn)(t,uo(e,3))}var Ts=zr((function(t,e,i){Ot.call(t,i)?t[i].push(e):an(t,i,[e])})),Ss=Jn((function(t,e,i){var n=-1,r="function"==typeof e,o=Xs(t)?wt(t.length):[];return fn(t,(function(t){o[++n]=r?Se(e,t,i):Ln(t,e,i)})),o})),Cs=zr((function(t,e,i){an(t,i,e)}));function Es(t,e){return(Ws(t)?Le:$n)(t,uo(e,3))}var Is=zr((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]})),Ms=Jn((function(t,e){if(null==t)return[];var i=e.length;return i>1&&wo(t,e[0],e[1])?e=[]:i>2&&wo(e[0],e[1],e[2])&&(e=[e[0]]),Zn(t,vn(e,1),[])})),As=de||function(){return pe.Date.now()};function ks(e,i,n){return i=n?t:i,i=e&&null==i?e.length:i,Qr(e,a,t,t,t,t,i)}function Ps(i,n){var r;if("function"!=typeof n)throw new kt(e);return i=ya(i),function(){return--i>0&&(r=n.apply(this,arguments)),i<=1&&(n=t),r}}var Ls=Jn((function(t,e,i){var n=1;if(i.length){var r=li(i,co(Ls));n|=o}return Qr(t,n,e,i,r)})),zs=Jn((function(t,e,i){var n=3;if(i.length){var r=li(i,co(zs));n|=o}return Qr(e,n,t,i,r)}));function Ds(i,n,r){var o,s,a,l,c,u,h=0,p=!1,d=!1,f=!0;if("function"!=typeof i)throw new kt(e);function m(e){var n=o,r=s;return o=s=t,h=e,l=i.apply(r,n)}function g(t){return h=t,c=Do(_,n),p?m(t):l}function y(e){var i=e-u;return u===t||i>=n||i<0||d&&e-h>=a}function _(){var t=As();if(y(t))return v(t);c=Do(_,function(t){var e=n-(t-u);return d?xi(e,a-(t-h)):e}(t))}function v(e){return c=t,f&&o?m(e):(o=s=t,l)}function x(){var e=As(),i=y(e);if(o=arguments,s=this,u=e,i){if(c===t)return g(u);if(d)return Sr(c),c=Do(_,n),m(u)}return c===t&&(c=Do(_,n)),l}return n=va(n)||0,na(r)&&(p=!!r.leading,a=(d="maxWait"in r)?vi(va(r.maxWait)||0,n):a,f="trailing"in r?!!r.trailing:f),x.cancel=function(){c!==t&&Sr(c),h=0,o=u=s=c=t},x.flush=function(){return c===t?l:v(As())},x}var Rs=Jn((function(t,e){return pn(t,1,e)})),Os=Jn((function(t,e,i){return pn(t,va(e)||0,i)}));function Fs(t,i){if("function"!=typeof t||null!=i&&"function"!=typeof i)throw new kt(e);var n=function(){var e=arguments,r=i?i.apply(this,e):e[0],o=n.cache;if(o.has(r))return o.get(r);var s=t.apply(this,e);return n.cache=o.set(r,s)||o,s};return n.cache=new(Fs.Cache||Hi),n}function Ns(t){if("function"!=typeof t)throw new kt(e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Fs.Cache=Hi;var Bs=wr((function(t,e){var i=(e=1==e.length&&Ws(e[0])?Le(e[0],Ye(uo())):Le(vn(e,1),Ye(uo()))).length;return Jn((function(n){for(var r=-1,o=xi(n.length,i);++r<o;)n[r]=e[r].call(this,n[r]);return Se(t,this,n)}))})),js=Jn((function(e,i){var n=li(i,co(js));return Qr(e,o,t,i,n)})),$s=Jn((function(e,i){var n=li(i,co($s));return Qr(e,s,t,i,n)})),Us=ro((function(e,i){return Qr(e,l,t,t,t,i)}));function Vs(t,e){return t===e||t!=t&&e!=e}var Gs=Hr(Mn),qs=Hr((function(t,e){return t>=e})),Zs=zn(function(){return arguments}())?zn:function(t){return ra(t)&&Ot.call(t,"callee")&&!Xt.call(t,"callee")},Ws=wt.isArray,Hs=_e?Ye(_e):function(t){return ra(t)&&In(t)==k};function Xs(t){return null!=t&&ia(t.length)&&!ta(t)}function Ys(t){return ra(t)&&Xs(t)}var Ks=qe||vl,Js=ve?Ye(ve):function(t){return ra(t)&&In(t)==y};function Qs(t){if(!ra(t))return!1;var e=In(t);return e==_||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!aa(t)}function ta(t){if(!na(t))return!1;var e=In(t);return e==v||e==x||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ea(t){return"number"==typeof t&&t==ya(t)}function ia(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}function na(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ra(t){return null!=t&&"object"==typeof t}var oa=xe?Ye(xe):function(t){return ra(t)&&yo(t)==b};function sa(t){return"number"==typeof t||ra(t)&&In(t)==w}function aa(t){if(!ra(t)||In(t)!=T)return!1;var e=Wt(t);if(null===e)return!0;var i=Ot.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&Rt.call(i)==jt}var la=be?Ye(be):function(t){return ra(t)&&In(t)==C},ca=we?Ye(we):function(t){return ra(t)&&yo(t)==E};function ua(t){return"string"==typeof t||!Ws(t)&&ra(t)&&In(t)==I}function ha(t){return"symbol"==typeof t||ra(t)&&In(t)==M}var pa=Te?Ye(Te):function(t){return ra(t)&&ia(t.length)&&!!oe[In(t)]},da=Hr(jn),fa=Hr((function(t,e){return t<=e}));function ma(t){if(!t)return[];if(Xs(t))return ua(t)?pi(t):Pr(t);if(ee&&t[ee])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[ee]());var e=yo(t);return(e==b?si:e==E?ci:Va)(t)}function ga(t){return t?(t=va(t))===c||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ya(t){var e=ga(t),i=e%1;return e==e?i?e-i:e:0}function _a(t){return t?cn(ya(t),0,p):0}function va(t){if("number"==typeof t)return t;if(ha(t))return h;if(na(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=na(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Xe(t);var i=dt.test(t);return i||mt.test(t)?ce(t.slice(2),i?2:8):pt.test(t)?h:+t}function xa(t){return Lr(t,Ra(t))}function ba(t){return null==t?"":hr(t)}var wa=Dr((function(t,e){if(Eo(e)||Xs(e))Lr(e,Da(e),t);else for(var i in e)Ot.call(e,i)&&nn(t,i,e[i])})),Ta=Dr((function(t,e){Lr(e,Ra(e),t)})),Sa=Dr((function(t,e,i,n){Lr(e,Ra(e),t,n)})),Ca=Dr((function(t,e,i,n){Lr(e,Da(e),t,n)})),Ea=ro(ln),Ia=Jn((function(e,i){e=It(e);var n=-1,r=i.length,o=r>2?i[2]:t;for(o&&wo(i[0],i[1],o)&&(r=1);++n<r;)for(var s=i[n],a=Ra(s),l=-1,c=a.length;++l<c;){var u=a[l],h=e[u];(h===t||Vs(h,zt[u])&&!Ot.call(e,u))&&(e[u]=s[u])}return e})),Ma=Jn((function(e){return e.push(t,eo),Se(Fa,t,e)}));function Aa(e,i,n){var r=null==e?t:Cn(e,i);return r===t?n:r}function ka(t,e){return null!=t&&_o(t,e,kn)}var Pa=Vr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=i}),nl(sl)),La=Vr((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),Ot.call(t,e)?t[e].push(i):t[e]=[i]}),uo),za=Jn(Ln);function Da(t){return Xs(t)?Ki(t):Nn(t)}function Ra(t){return Xs(t)?Ki(t,!0):Bn(t)}var Oa=Dr((function(t,e,i){Gn(t,e,i)})),Fa=Dr((function(t,e,i,n){Gn(t,e,i,n)})),Na=ro((function(t,e){var i={};if(null==t)return i;var n=!1;e=Le(e,(function(e){return e=br(e,t),n||(n=e.length>1),e})),Lr(t,so(t),i),n&&(i=un(i,7,io));for(var r=e.length;r--;)dr(i,e[r]);return i})),Ba=ro((function(t,e){return null==t?{}:function(t,e){return Wn(t,e,(function(e,i){return ka(t,i)}))}(t,e)}));function ja(t,e){if(null==t)return{};var i=Le(so(t),(function(t){return[t]}));return e=uo(e),Wn(t,i,(function(t,i){return e(t,i[0])}))}var $a=Jr(Da),Ua=Jr(Ra);function Va(t){return null==t?[]:Ke(t,Da(t))}var Ga=Nr((function(t,e,i){return e=e.toLowerCase(),t+(i?qa(e):e)}));function qa(t){return Qa(ba(t).toLowerCase())}function Za(t){return(t=ba(t))&&t.replace(yt,ii).replace(Jt,"")}var Wa=Nr((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),Ha=Nr((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),Xa=Fr("toLowerCase"),Ya=Nr((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()})),Ka=Nr((function(t,e,i){return t+(i?" ":"")+Qa(e)})),Ja=Nr((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()})),Qa=Fr("toUpperCase");function tl(e,i,n){return e=ba(e),(i=n?t:i)===t?function(t){return ie.test(t)}(e)?function(t){return t.match(te)||[]}(e):function(t){return t.match(at)||[]}(e):e.match(i)||[]}var el=Jn((function(e,i){try{return Se(e,t,i)}catch(t){return Qs(t)?t:new St(t)}})),il=ro((function(t,e){return Ee(e,(function(e){e=jo(e),an(t,e,Ls(t[e],t))})),t}));function nl(t){return function(){return t}}var rl=$r(),ol=$r(!0);function sl(t){return t}function al(t){return Fn("function"==typeof t?t:un(t,1))}var ll=Jn((function(t,e){return function(i){return Ln(i,t,e)}})),cl=Jn((function(t,e){return function(i){return Ln(t,i,e)}}));function ul(t,e,i){var n=Da(e),r=Sn(e,n);null!=i||na(e)&&(r.length||!n.length)||(i=e,e=t,t=this,r=Sn(e,Da(e)));var o=!(na(i)&&"chain"in i&&!i.chain),s=ta(t);return Ee(r,(function(i){var n=e[i];t[i]=n,s&&(t.prototype[i]=function(){var e=this.__chain__;if(o||e){var i=t(this.__wrapped__),r=i.__actions__=Pr(this.__actions__);return r.push({func:n,args:arguments,thisArg:t}),i.__chain__=e,i}return n.apply(t,ze([this.value()],arguments))})})),t}function hl(){}var pl=qr(Le),dl=qr(Me),fl=qr(Oe);function ml(t){return To(t)?Ge(jo(t)):function(t){return function(e){return Cn(e,t)}}(t)}var gl=Wr(),yl=Wr(!0);function _l(){return[]}function vl(){return!1}var xl=Gr((function(t,e){return t+e}),0),bl=Yr("ceil"),wl=Gr((function(t,e){return t/e}),1),Tl=Yr("floor"),Sl=Gr((function(t,e){return t*e}),1),Cl=Yr("round"),El=Gr((function(t,e){return t-e}),0);return $i.after=function(t,i){if("function"!=typeof i)throw new kt(e);return t=ya(t),function(){if(--t<1)return i.apply(this,arguments)}},$i.ary=ks,$i.assign=wa,$i.assignIn=Ta,$i.assignInWith=Sa,$i.assignWith=Ca,$i.at=Ea,$i.before=Ps,$i.bind=Ls,$i.bindAll=il,$i.bindKey=zs,$i.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Ws(t)?t:[t]},$i.chain=ms,$i.chunk=function(e,i,n){i=(n?wo(e,i,n):i===t)?1:vi(ya(i),0);var r=null==e?0:e.length;if(!r||i<1)return[];for(var o=0,s=0,a=wt(ge(r/i));o<r;)a[s++]=or(e,o,o+=i);return a},$i.compact=function(t){for(var e=-1,i=null==t?0:t.length,n=0,r=[];++e<i;){var o=t[e];o&&(r[n++]=o)}return r},$i.concat=function(){var t=arguments.length;if(!t)return[];for(var e=wt(t-1),i=arguments[0],n=t;n--;)e[n-1]=arguments[n];return ze(Ws(i)?Pr(i):[i],vn(e,1))},$i.cond=function(t){var i=null==t?0:t.length,n=uo();return t=i?Le(t,(function(t){if("function"!=typeof t[1])throw new kt(e);return[n(t[0]),t[1]]})):[],Jn((function(e){for(var n=-1;++n<i;){var r=t[n];if(Se(r[0],this,e))return Se(r[1],this,e)}}))},$i.conforms=function(t){return function(t){var e=Da(t);return function(i){return hn(i,t,e)}}(un(t,1))},$i.constant=nl,$i.countBy=_s,$i.create=function(t,e){var i=Ui(t);return null==e?i:sn(i,e)},$i.curry=function e(i,n,r){var o=Qr(i,8,t,t,t,t,t,n=r?t:n);return o.placeholder=e.placeholder,o},$i.curryRight=function e(i,n,o){var s=Qr(i,r,t,t,t,t,t,n=o?t:n);return s.placeholder=e.placeholder,s},$i.debounce=Ds,$i.defaults=Ia,$i.defaultsDeep=Ma,$i.defer=Rs,$i.delay=Os,$i.difference=Vo,$i.differenceBy=Go,$i.differenceWith=qo,$i.drop=function(e,i,n){var r=null==e?0:e.length;return r?or(e,(i=n||i===t?1:ya(i))<0?0:i,r):[]},$i.dropRight=function(e,i,n){var r=null==e?0:e.length;return r?or(e,0,(i=r-(i=n||i===t?1:ya(i)))<0?0:i):[]},$i.dropRightWhile=function(t,e){return t&&t.length?mr(t,uo(e,3),!0,!0):[]},$i.dropWhile=function(t,e){return t&&t.length?mr(t,uo(e,3),!0):[]},$i.fill=function(e,i,n,r){var o=null==e?0:e.length;return o?(n&&"number"!=typeof n&&wo(e,i,n)&&(n=0,r=o),function(e,i,n,r){var o=e.length;for((n=ya(n))<0&&(n=-n>o?0:o+n),(r=r===t||r>o?o:ya(r))<0&&(r+=o),r=n>r?0:_a(r);n<r;)e[n++]=i;return e}(e,i,n,r)):[]},$i.filter=function(t,e){return(Ws(t)?Ae:_n)(t,uo(e,3))},$i.flatMap=function(t,e){return vn(Es(t,e),1)},$i.flatMapDeep=function(t,e){return vn(Es(t,e),c)},$i.flatMapDepth=function(e,i,n){return n=n===t?1:ya(n),vn(Es(e,i),n)},$i.flatten=Ho,$i.flattenDeep=function(t){return null!=t&&t.length?vn(t,c):[]},$i.flattenDepth=function(e,i){return null!=e&&e.length?vn(e,i=i===t?1:ya(i)):[]},$i.flip=function(t){return Qr(t,512)},$i.flow=rl,$i.flowRight=ol,$i.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,n={};++e<i;){var r=t[e];n[r[0]]=r[1]}return n},$i.functions=function(t){return null==t?[]:Sn(t,Da(t))},$i.functionsIn=function(t){return null==t?[]:Sn(t,Ra(t))},$i.groupBy=Ts,$i.initial=function(t){return null!=t&&t.length?or(t,0,-1):[]},$i.intersection=Yo,$i.intersectionBy=Ko,$i.intersectionWith=Jo,$i.invert=Pa,$i.invertBy=La,$i.invokeMap=Ss,$i.iteratee=al,$i.keyBy=Cs,$i.keys=Da,$i.keysIn=Ra,$i.map=Es,$i.mapKeys=function(t,e){var i={};return e=uo(e,3),wn(t,(function(t,n,r){an(i,e(t,n,r),t)})),i},$i.mapValues=function(t,e){var i={};return e=uo(e,3),wn(t,(function(t,n,r){an(i,n,e(t,n,r))})),i},$i.matches=function(t){return Un(un(t,1))},$i.matchesProperty=function(t,e){return Vn(t,un(e,1))},$i.memoize=Fs,$i.merge=Oa,$i.mergeWith=Fa,$i.method=ll,$i.methodOf=cl,$i.mixin=ul,$i.negate=Ns,$i.nthArg=function(t){return t=ya(t),Jn((function(e){return qn(e,t)}))},$i.omit=Na,$i.omitBy=function(t,e){return ja(t,Ns(uo(e)))},$i.once=function(t){return Ps(2,t)},$i.orderBy=function(e,i,n,r){return null==e?[]:(Ws(i)||(i=null==i?[]:[i]),Ws(n=r?t:n)||(n=null==n?[]:[n]),Zn(e,i,n))},$i.over=pl,$i.overArgs=Bs,$i.overEvery=dl,$i.overSome=fl,$i.partial=js,$i.partialRight=$s,$i.partition=Is,$i.pick=Ba,$i.pickBy=ja,$i.property=ml,$i.propertyOf=function(e){return function(i){return null==e?t:Cn(e,i)}},$i.pull=ts,$i.pullAll=es,$i.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?Hn(t,e,uo(i,2)):t},$i.pullAllWith=function(e,i,n){return e&&e.length&&i&&i.length?Hn(e,i,t,n):e},$i.pullAt=is,$i.range=gl,$i.rangeRight=yl,$i.rearg=Us,$i.reject=function(t,e){return(Ws(t)?Ae:_n)(t,Ns(uo(e,3)))},$i.remove=function(t,e){var i=[];if(!t||!t.length)return i;var n=-1,r=[],o=t.length;for(e=uo(e,3);++n<o;){var s=t[n];e(s,n,t)&&(i.push(s),r.push(n))}return Xn(t,r),i},$i.rest=function(i,n){if("function"!=typeof i)throw new kt(e);return Jn(i,n=n===t?n:ya(n))},$i.reverse=ns,$i.sampleSize=function(e,i,n){return i=(n?wo(e,i,n):i===t)?1:ya(i),(Ws(e)?Qi:tr)(e,i)},$i.set=function(t,e,i){return null==t?t:er(t,e,i)},$i.setWith=function(e,i,n,r){return r="function"==typeof r?r:t,null==e?e:er(e,i,n,r)},$i.shuffle=function(t){return(Ws(t)?tn:rr)(t)},$i.slice=function(e,i,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&wo(e,i,n)?(i=0,n=r):(i=null==i?0:ya(i),n=n===t?r:ya(n)),or(e,i,n)):[]},$i.sortBy=Ms,$i.sortedUniq=function(t){return t&&t.length?cr(t):[]},$i.sortedUniqBy=function(t,e){return t&&t.length?cr(t,uo(e,2)):[]},$i.split=function(e,i,n){return n&&"number"!=typeof n&&wo(e,i,n)&&(i=n=t),(n=n===t?p:n>>>0)?(e=ba(e))&&("string"==typeof i||null!=i&&!la(i))&&!(i=hr(i))&&oi(e)?Tr(pi(e),0,n):e.split(i,n):[]},$i.spread=function(t,i){if("function"!=typeof t)throw new kt(e);return i=null==i?0:vi(ya(i),0),Jn((function(e){var n=e[i],r=Tr(e,0,i);return n&&ze(r,n),Se(t,this,r)}))},$i.tail=function(t){var e=null==t?0:t.length;return e?or(t,1,e):[]},$i.take=function(e,i,n){return e&&e.length?or(e,0,(i=n||i===t?1:ya(i))<0?0:i):[]},$i.takeRight=function(e,i,n){var r=null==e?0:e.length;return r?or(e,(i=r-(i=n||i===t?1:ya(i)))<0?0:i,r):[]},$i.takeRightWhile=function(t,e){return t&&t.length?mr(t,uo(e,3),!1,!0):[]},$i.takeWhile=function(t,e){return t&&t.length?mr(t,uo(e,3)):[]},$i.tap=function(t,e){return e(t),t},$i.throttle=function(t,i,n){var r=!0,o=!0;if("function"!=typeof t)throw new kt(e);return na(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Ds(t,i,{leading:r,maxWait:i,trailing:o})},$i.thru=gs,$i.toArray=ma,$i.toPairs=$a,$i.toPairsIn=Ua,$i.toPath=function(t){return Ws(t)?Le(t,jo):ha(t)?[t]:Pr(Bo(ba(t)))},$i.toPlainObject=xa,$i.transform=function(t,e,i){var n=Ws(t),r=n||Ks(t)||pa(t);if(e=uo(e,4),null==i){var o=t&&t.constructor;i=r?n?new o:[]:na(t)&&ta(o)?Ui(Wt(t)):{}}return(r?Ee:wn)(t,(function(t,n,r){return e(i,t,n,r)})),i},$i.unary=function(t){return ks(t,1)},$i.union=rs,$i.unionBy=os,$i.unionWith=ss,$i.uniq=function(t){return t&&t.length?pr(t):[]},$i.uniqBy=function(t,e){return t&&t.length?pr(t,uo(e,2)):[]},$i.uniqWith=function(e,i){return i="function"==typeof i?i:t,e&&e.length?pr(e,t,i):[]},$i.unset=function(t,e){return null==t||dr(t,e)},$i.unzip=as,$i.unzipWith=ls,$i.update=function(t,e,i){return null==t?t:fr(t,e,xr(i))},$i.updateWith=function(e,i,n,r){return r="function"==typeof r?r:t,null==e?e:fr(e,i,xr(n),r)},$i.values=Va,$i.valuesIn=function(t){return null==t?[]:Ke(t,Ra(t))},$i.without=cs,$i.words=tl,$i.wrap=function(t,e){return js(xr(e),t)},$i.xor=us,$i.xorBy=hs,$i.xorWith=ps,$i.zip=ds,$i.zipObject=function(t,e){return _r(t||[],e||[],nn)},$i.zipObjectDeep=function(t,e){return _r(t||[],e||[],er)},$i.zipWith=fs,$i.entries=$a,$i.entriesIn=Ua,$i.extend=Ta,$i.extendWith=Sa,ul($i,$i),$i.add=xl,$i.attempt=el,$i.camelCase=Ga,$i.capitalize=qa,$i.ceil=bl,$i.clamp=function(e,i,n){return n===t&&(n=i,i=t),n!==t&&(n=(n=va(n))==n?n:0),i!==t&&(i=(i=va(i))==i?i:0),cn(va(e),i,n)},$i.clone=function(t){return un(t,4)},$i.cloneDeep=function(t){return un(t,5)},$i.cloneDeepWith=function(e,i){return un(e,5,i="function"==typeof i?i:t)},$i.cloneWith=function(e,i){return un(e,4,i="function"==typeof i?i:t)},$i.conformsTo=function(t,e){return null==e||hn(t,e,Da(e))},$i.deburr=Za,$i.defaultTo=function(t,e){return null==t||t!=t?e:t},$i.divide=wl,$i.endsWith=function(e,i,n){e=ba(e),i=hr(i);var r=e.length,o=n=n===t?r:cn(ya(n),0,r);return(n-=i.length)>=0&&e.slice(n,o)==i},$i.eq=Vs,$i.escape=function(t){return(t=ba(t))&&W.test(t)?t.replace(q,ni):t},$i.escapeRegExp=function(t){return(t=ba(t))&&et.test(t)?t.replace(tt,"\\$&"):t},$i.every=function(e,i,n){var r=Ws(e)?Me:gn;return n&&wo(e,i,n)&&(i=t),r(e,uo(i,3))},$i.find=vs,$i.findIndex=Zo,$i.findKey=function(t,e){return Ne(t,uo(e,3),wn)},$i.findLast=xs,$i.findLastIndex=Wo,$i.findLastKey=function(t,e){return Ne(t,uo(e,3),Tn)},$i.floor=Tl,$i.forEach=bs,$i.forEachRight=ws,$i.forIn=function(t,e){return null==t?t:xn(t,uo(e,3),Ra)},$i.forInRight=function(t,e){return null==t?t:bn(t,uo(e,3),Ra)},$i.forOwn=function(t,e){return t&&wn(t,uo(e,3))},$i.forOwnRight=function(t,e){return t&&Tn(t,uo(e,3))},$i.get=Aa,$i.gt=Gs,$i.gte=qs,$i.has=function(t,e){return null!=t&&_o(t,e,An)},$i.hasIn=ka,$i.head=Xo,$i.identity=sl,$i.includes=function(t,e,i,n){t=Xs(t)?t:Va(t),i=i&&!n?ya(i):0;var r=t.length;return i<0&&(i=vi(r+i,0)),ua(t)?i<=r&&t.indexOf(e,i)>-1:!!r&&je(t,e,i)>-1},$i.indexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var r=null==i?0:ya(i);return r<0&&(r=vi(n+r,0)),je(t,e,r)},$i.inRange=function(e,i,n){return i=ga(i),n===t?(n=i,i=0):n=ga(n),function(t,e,i){return t>=xi(e,i)&&t<vi(e,i)}(e=va(e),i,n)},$i.invoke=za,$i.isArguments=Zs,$i.isArray=Ws,$i.isArrayBuffer=Hs,$i.isArrayLike=Xs,$i.isArrayLikeObject=Ys,$i.isBoolean=function(t){return!0===t||!1===t||ra(t)&&In(t)==g},$i.isBuffer=Ks,$i.isDate=Js,$i.isElement=function(t){return ra(t)&&1===t.nodeType&&!aa(t)},$i.isEmpty=function(t){if(null==t)return!0;if(Xs(t)&&(Ws(t)||"string"==typeof t||"function"==typeof t.splice||Ks(t)||pa(t)||Zs(t)))return!t.length;var e=yo(t);if(e==b||e==E)return!t.size;if(Eo(t))return!Nn(t).length;for(var i in t)if(Ot.call(t,i))return!1;return!0},$i.isEqual=function(t,e){return Dn(t,e)},$i.isEqualWith=function(e,i,n){var r=(n="function"==typeof n?n:t)?n(e,i):t;return r===t?Dn(e,i,t,n):!!r},$i.isError=Qs,$i.isFinite=function(t){return"number"==typeof t&&gi(t)},$i.isFunction=ta,$i.isInteger=ea,$i.isLength=ia,$i.isMap=oa,$i.isMatch=function(t,e){return t===e||Rn(t,e,po(e))},$i.isMatchWith=function(e,i,n){return n="function"==typeof n?n:t,Rn(e,i,po(i),n)},$i.isNaN=function(t){return sa(t)&&t!=+t},$i.isNative=function(t){if(Co(t))throw new St("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return On(t)},$i.isNil=function(t){return null==t},$i.isNull=function(t){return null===t},$i.isNumber=sa,$i.isObject=na,$i.isObjectLike=ra,$i.isPlainObject=aa,$i.isRegExp=la,$i.isSafeInteger=function(t){return ea(t)&&t>=-9007199254740991&&t<=u},$i.isSet=ca,$i.isString=ua,$i.isSymbol=ha,$i.isTypedArray=pa,$i.isUndefined=function(e){return e===t},$i.isWeakMap=function(t){return ra(t)&&yo(t)==A},$i.isWeakSet=function(t){return ra(t)&&"[object WeakSet]"==In(t)},$i.join=function(t,e){return null==t?"":yi.call(t,e)},$i.kebabCase=Wa,$i.last=Qo,$i.lastIndexOf=function(e,i,n){var r=null==e?0:e.length;if(!r)return-1;var o=r;return n!==t&&(o=(o=ya(n))<0?vi(r+o,0):xi(o,r-1)),i==i?function(t,e,i){for(var n=i+1;n--;)if(t[n]===e)return n;return n}(e,i,o):Be(e,Ue,o,!0)},$i.lowerCase=Ha,$i.lowerFirst=Xa,$i.lt=da,$i.lte=fa,$i.max=function(e){return e&&e.length?yn(e,sl,Mn):t},$i.maxBy=function(e,i){return e&&e.length?yn(e,uo(i,2),Mn):t},$i.mean=function(t){return Ve(t,sl)},$i.meanBy=function(t,e){return Ve(t,uo(e,2))},$i.min=function(e){return e&&e.length?yn(e,sl,jn):t},$i.minBy=function(e,i){return e&&e.length?yn(e,uo(i,2),jn):t},$i.stubArray=_l,$i.stubFalse=vl,$i.stubObject=function(){return{}},$i.stubString=function(){return""},$i.stubTrue=function(){return!0},$i.multiply=Sl,$i.nth=function(e,i){return e&&e.length?qn(e,ya(i)):t},$i.noConflict=function(){return pe._===this&&(pe._=$t),this},$i.noop=hl,$i.now=As,$i.pad=function(t,e,i){t=ba(t);var n=(e=ya(e))?hi(t):0;if(!e||n>=e)return t;var r=(e-n)/2;return Zr(ye(r),i)+t+Zr(ge(r),i)},$i.padEnd=function(t,e,i){t=ba(t);var n=(e=ya(e))?hi(t):0;return e&&n<e?t+Zr(e-n,i):t},$i.padStart=function(t,e,i){t=ba(t);var n=(e=ya(e))?hi(t):0;return e&&n<e?Zr(e-n,i)+t:t},$i.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),wi(ba(t).replace(it,""),e||0)},$i.random=function(e,i,n){if(n&&"boolean"!=typeof n&&wo(e,i,n)&&(i=n=t),n===t&&("boolean"==typeof i?(n=i,i=t):"boolean"==typeof e&&(n=e,e=t)),e===t&&i===t?(e=0,i=1):(e=ga(e),i===t?(i=e,e=0):i=ga(i)),e>i){var r=e;e=i,i=r}if(n||e%1||i%1){var o=Ti();return xi(e+o*(i-e+le("1e-"+((o+"").length-1))),i)}return Yn(e,i)},$i.reduce=function(t,e,i){var n=Ws(t)?De:Ze,r=arguments.length<3;return n(t,uo(e,4),i,r,fn)},$i.reduceRight=function(t,e,i){var n=Ws(t)?Re:Ze,r=arguments.length<3;return n(t,uo(e,4),i,r,mn)},$i.repeat=function(e,i,n){return i=(n?wo(e,i,n):i===t)?1:ya(i),Kn(ba(e),i)},$i.replace=function(){var t=arguments,e=ba(t[0]);return t.length<3?e:e.replace(t[1],t[2])},$i.result=function(e,i,n){var r=-1,o=(i=br(i,e)).length;for(o||(o=1,e=t);++r<o;){var s=null==e?t:e[jo(i[r])];s===t&&(r=o,s=n),e=ta(s)?s.call(e):s}return e},$i.round=Cl,$i.runInContext=nt,$i.sample=function(t){return(Ws(t)?Ji:Qn)(t)},$i.size=function(t){if(null==t)return 0;if(Xs(t))return ua(t)?hi(t):t.length;var e=yo(t);return e==b||e==E?t.size:Nn(t).length},$i.snakeCase=Ya,$i.some=function(e,i,n){var r=Ws(e)?Oe:sr;return n&&wo(e,i,n)&&(i=t),r(e,uo(i,3))},$i.sortedIndex=function(t,e){return ar(t,e)},$i.sortedIndexBy=function(t,e,i){return lr(t,e,uo(i,2))},$i.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var n=ar(t,e);if(n<i&&Vs(t[n],e))return n}return-1},$i.sortedLastIndex=function(t,e){return ar(t,e,!0)},$i.sortedLastIndexBy=function(t,e,i){return lr(t,e,uo(i,2),!0)},$i.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var i=ar(t,e,!0)-1;if(Vs(t[i],e))return i}return-1},$i.startCase=Ka,$i.startsWith=function(t,e,i){return t=ba(t),i=null==i?0:cn(ya(i),0,t.length),e=hr(e),t.slice(i,i+e.length)==e},$i.subtract=El,$i.sum=function(t){return t&&t.length?We(t,sl):0},$i.sumBy=function(t,e){return t&&t.length?We(t,uo(e,2)):0},$i.template=function(e,i,n){var r=$i.templateSettings;n&&wo(e,i,n)&&(i=t),e=ba(e),i=Sa({},i,r,to);var o,s,a=Sa({},i.imports,r.imports,to),l=Da(a),c=Ke(a,l),u=0,h=i.interpolate||_t,p="__p += '",d=Mt((i.escape||_t).source+"|"+h.source+"|"+(h===Y?ut:_t).source+"|"+(i.evaluate||_t).source+"|$","g"),f="//# sourceURL="+(Ot.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++re+"]")+"\n";e.replace(d,(function(t,i,n,r,a,l){return n||(n=r),p+=e.slice(u,l).replace(vt,ri),i&&(o=!0,p+="' +\n__e("+i+") +\n'"),a&&(s=!0,p+="';\n"+a+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+t.length,t})),p+="';\n";var m=Ot.call(i,"variable")&&i.variable;if(m){if(lt.test(m))throw new St("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(s?p.replace($,""):p).replace(U,"$1").replace(V,"$1;"),p="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=el((function(){return Ct(l,f+"return "+p).apply(t,c)}));if(g.source=p,Qs(g))throw g;return g},$i.times=function(t,e){if((t=ya(t))<1||t>u)return[];var i=p,n=xi(t,p);e=uo(e),t-=p;for(var r=He(n,e);++i<t;)e(i);return r},$i.toFinite=ga,$i.toInteger=ya,$i.toLength=_a,$i.toLower=function(t){return ba(t).toLowerCase()},$i.toNumber=va,$i.toSafeInteger=function(t){return t?cn(ya(t),-9007199254740991,u):0===t?t:0},$i.toString=ba,$i.toUpper=function(t){return ba(t).toUpperCase()},$i.trim=function(e,i,n){if((e=ba(e))&&(n||i===t))return Xe(e);if(!e||!(i=hr(i)))return e;var r=pi(e),o=pi(i);return Tr(r,Qe(r,o),ti(r,o)+1).join("")},$i.trimEnd=function(e,i,n){if((e=ba(e))&&(n||i===t))return e.slice(0,di(e)+1);if(!e||!(i=hr(i)))return e;var r=pi(e);return Tr(r,0,ti(r,pi(i))+1).join("")},$i.trimStart=function(e,i,n){if((e=ba(e))&&(n||i===t))return e.replace(it,"");if(!e||!(i=hr(i)))return e;var r=pi(e);return Tr(r,Qe(r,pi(i))).join("")},$i.truncate=function(e,i){var n=30,r="...";if(na(i)){var o="separator"in i?i.separator:o;n="length"in i?ya(i.length):n,r="omission"in i?hr(i.omission):r}var s=(e=ba(e)).length;if(oi(e)){var a=pi(e);s=a.length}if(n>=s)return e;var l=n-hi(r);if(l<1)return r;var c=a?Tr(a,0,l).join(""):e.slice(0,l);if(o===t)return c+r;if(a&&(l+=c.length-l),la(o)){if(e.slice(l).search(o)){var u,h=c;for(o.global||(o=Mt(o.source,ba(ht.exec(o))+"g")),o.lastIndex=0;u=o.exec(h);)var p=u.index;c=c.slice(0,p===t?l:p)}}else if(e.indexOf(hr(o),l)!=l){var d=c.lastIndexOf(o);d>-1&&(c=c.slice(0,d))}return c+r},$i.unescape=function(t){return(t=ba(t))&&Z.test(t)?t.replace(G,fi):t},$i.uniqueId=function(t){var e=++Ft;return ba(t)+e},$i.upperCase=Ja,$i.upperFirst=Qa,$i.each=bs,$i.eachRight=ws,$i.first=Xo,ul($i,function(){var t={};return wn($i,(function(e,i){Ot.call($i.prototype,i)||(t[i]=e)})),t}(),{chain:!1}),$i.VERSION="4.17.21",Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){$i[t].placeholder=$i})),Ee(["drop","take"],(function(e,i){qi.prototype[e]=function(n){n=n===t?1:vi(ya(n),0);var r=this.__filtered__&&!i?new qi(this):this.clone();return r.__filtered__?r.__takeCount__=xi(n,r.__takeCount__):r.__views__.push({size:xi(n,p),type:e+(r.__dir__<0?"Right":"")}),r},qi.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Ee(["filter","map","takeWhile"],(function(t,e){var i=e+1,n=1==i||3==i;qi.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:uo(t,3),type:i}),e.__filtered__=e.__filtered__||n,e}})),Ee(["head","last"],(function(t,e){var i="take"+(e?"Right":"");qi.prototype[t]=function(){return this[i](1).value()[0]}})),Ee(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");qi.prototype[t]=function(){return this.__filtered__?new qi(this):this[i](1)}})),qi.prototype.compact=function(){return this.filter(sl)},qi.prototype.find=function(t){return this.filter(t).head()},qi.prototype.findLast=function(t){return this.reverse().find(t)},qi.prototype.invokeMap=Jn((function(t,e){return"function"==typeof t?new qi(this):this.map((function(i){return Ln(i,t,e)}))})),qi.prototype.reject=function(t){return this.filter(Ns(uo(t)))},qi.prototype.slice=function(e,i){e=ya(e);var n=this;return n.__filtered__&&(e>0||i<0)?new qi(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==t&&(n=(i=ya(i))<0?n.dropRight(-i):n.take(i-e)),n)},qi.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},qi.prototype.toArray=function(){return this.take(p)},wn(qi.prototype,(function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),r=/^(?:head|last)$/.test(i),o=$i[r?"take"+("last"==i?"Right":""):i],s=r||/^find/.test(i);o&&($i.prototype[i]=function(){var i=this.__wrapped__,a=r?[1]:arguments,l=i instanceof qi,c=a[0],u=l||Ws(i),h=function(t){var e=o.apply($i,ze([t],a));return r&&p?e[0]:e};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var p=this.__chain__,d=!!this.__actions__.length,f=s&&!p,m=l&&!d;if(!s&&u){i=m?i:new qi(this);var g=e.apply(i,a);return g.__actions__.push({func:gs,args:[h],thisArg:t}),new Gi(g,p)}return f&&m?e.apply(this,a):(g=this.thru(h),f?r?g.value()[0]:g.value():g)})})),Ee(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Pt[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);$i.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var r=this.value();return e.apply(Ws(r)?r:[],t)}return this[i]((function(i){return e.apply(Ws(i)?i:[],t)}))}})),wn(qi.prototype,(function(t,e){var i=$i[e];if(i){var n=i.name+"";Ot.call(Li,n)||(Li[n]=[]),Li[n].push({name:e,func:i})}})),Li[Ur(t,2).name]=[{name:"wrapper",func:t}],qi.prototype.clone=function(){var t=new qi(this.__wrapped__);return t.__actions__=Pr(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Pr(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Pr(this.__views__),t},qi.prototype.reverse=function(){if(this.__filtered__){var t=new qi(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},qi.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=Ws(t),n=e<0,r=i?t.length:0,o=function(t,e,i){for(var n=-1,r=i.length;++n<r;){var o=i[n],s=o.size;switch(o.type){case"drop":t+=s;break;case"dropRight":e-=s;break;case"take":e=xi(e,t+s);break;case"takeRight":t=vi(t,e-s)}}return{start:t,end:e}}(0,r,this.__views__),s=o.start,a=o.end,l=a-s,c=n?a:s-1,u=this.__iteratees__,h=u.length,p=0,d=xi(l,this.__takeCount__);if(!i||!n&&r==l&&d==l)return gr(t,this.__actions__);var f=[];t:for(;l--&&p<d;){for(var m=-1,g=t[c+=e];++m<h;){var y=u[m],_=y.iteratee,v=y.type,x=_(g);if(2==v)g=x;else if(!x){if(1==v)continue t;break t}}f[p++]=g}return f},$i.prototype.at=ys,$i.prototype.chain=function(){return ms(this)},$i.prototype.commit=function(){return new Gi(this.value(),this.__chain__)},$i.prototype.next=function(){this.__values__===t&&(this.__values__=ma(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?t:this.__values__[this.__index__++]}},$i.prototype.plant=function(e){for(var i,n=this;n instanceof Vi;){var r=Uo(n);r.__index__=0,r.__values__=t,i?o.__wrapped__=r:i=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,i},$i.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof qi){var i=e;return this.__actions__.length&&(i=new qi(this)),(i=i.reverse()).__actions__.push({func:gs,args:[ns],thisArg:t}),new Gi(i,this.__chain__)}return this.thru(ns)},$i.prototype.toJSON=$i.prototype.valueOf=$i.prototype.value=function(){return gr(this.__wrapped__,this.__actions__)},$i.prototype.first=$i.prototype.head,ee&&($i.prototype[ee]=function(){return this}),$i}();fe?((fe.exports=mi)._=mi,de._=mi):pe._=mi}.call(xt);var Et=Ct.exports;const It=(t,e)=>Math.round(t*10**e)/10**e,Mt=["locations","routeLines","routeLineBuffer","deviceSize","routingOptions","speedOptions","maneuverOptions","styleUrl"],At=[],kt=["bearing","center","pitch","zoom"],Pt=["bearing","lat","lng","pitch","zoom","durationMultiplier"];function Lt(t){let e=Object.fromEntries(Object.entries(t).filter((([t,e])=>!kt.includes(t))).map((([t,e])=>[t,Mt.includes(t)&&null!==e?JSON.stringify(e):e])));var i;i=e,e=Object.keys(i).reduce(((t,e)=>{const n=i[e];return null!==n&&(t[e]=n),t}),{}),window.location.hash=function(t){let e=t.map?`map=${t.map}`:"";const i=["map","stylePresets"];return Object.entries(t).forEach((([t,n],r)=>{if(i.includes(t))return;let o=encodeURIComponent(n);e=`${e}${""!==e?"&":""}${t}=${o}`})),e}({map:[It(t.zoom,2),It(t.center.lat,4),It(t.center.lng,4),It(t.pitch,1),It(t.bearing,1)].join("/"),...e})}const zt=[];function Dt(t,e=i){let n;const r=new Set;function o(e){if(l(t,e)&&(t=e,n)){const e=!zt.length;for(const e of r)e[1](),zt.push(e,t);if(e){for(let t=0;t<zt.length;t+=2)zt[t][0](zt[t+1]);zt.length=0}}}return{set:o,update:function(e){o(e(t))},subscribe:function(s,a=i){const l=[s,a];return r.add(l),1===r.size&&(n=e(o)||i),s(t),()=>{r.delete(l),0===r.size&&(n(),n=null)}}}}const Rt="puck",Ot=["destination-pin",Rt],Ft=[{id:"a",center:null,locationText:""},{id:"b",center:null,locationText:""}],Nt="route-line-internal-mock-source",Bt={type:"geojson",data:{type:"FeatureCollection",features:[]}},jt={layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"cyan","line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},$t=["turn","new name","depart","arrive","merge","on ramp","off ramp","fork","end of road","continue","roundabout","rotary","roundabout turn","notification","exit roundabout","exit rotary"],Ut={speed:.1,pitch:1,zoom:.1},Vt=function(t){let e=Object.fromEntries(Object.entries(function(t){const e=t.split("#")[1];if(!e)return{};let i=Object.fromEntries(e.split("&").map((t=>t.split("=").map(decodeURIComponent))));if(i.map){const[t,e,n,r,o]=i.map.split("/");i={...i,bearing:o,lat:e,lng:n,pitch:r,zoom:t}}return i}(t)).filter((([t,e])=>!!e)).map((([t,e])=>Mt.includes(t)?[t,JSON.parse(e)]:At.includes(t)?[t,"true"===e]:Pt.includes(t)?[t,+e||0]:[t,e])));if(e.lat&&e.lng){const{lat:t,lng:i}=e;e.center={lat:t,lng:i},delete e.lat,delete e.lng}return e.map&&delete e.map,e}(window.location.hash),Gt=Dt({}),qt=["locations"],Zt=Dt(Object.keys(Vt).reduce(((t,e)=>(qt.includes(e)&&(t[e]=Vt[e]),t)),{})),Wt=["bearing","center","pitch","zoom"],Ht=Dt(Object.keys(Vt).reduce(((t,e)=>(Wt.includes(e)&&(t[e]=Vt[e]),t)),{})),Xt=Dt(null),Yt=Dt({puck:null,"destination-pin":null}),Kt=Dt(Vt.styleUrl||""),Jt=Dt(Vt?.routeLines?Vt?.routeLines.map(((t,e)=>({id:`route-line-internal-mock-layer_${e}`,type:"line",source:Nt,...{layout:t?.layout,paint:t?.paint}}))):[{id:"route-line-internal-mock-layer_0",type:"line",source:Nt,...jt}]),Qt=Dt(Vt.deviceSize||null),te=Dt({loading:!1}),ee=["durationMultiplier","routingOptions","speedOptions","maneuverOptions"];const ie=Dt(Object.keys(Vt).reduce(((t,e)=>(ee.includes(e)&&(t[e]=Vt[e]),t)),{}));function ne(t){let e,i,r,o,s,a,l;const c=[t[3]];var u=t[2];function h(t){let e={};for(let t=0;t<c.length;t+=1)e=n(e,c[t]);return{props:e}}return u&&(s=new u(h())),{c(){e=w("div"),i=w("div"),o=C(),s&&mt(s.$$.fragment),A(i,"class","outline svelte-ni5cvj"),A(i,"style",r=`height:${t[0]+40}px; width:${t[1]+40}px`),A(e,"class","layout svelte-ni5cvj"),A(e,"style",a=`height:${t[0]}px; width:${t[1]}px`)},m(t,n){v(t,e,n),_(e,i),_(e,o),s&&gt(s,e,null),l=!0},p(t,[n]){(!l||3&n&&r!==(r=`height:${t[0]+40}px; width:${t[1]+40}px`))&&A(i,"style",r);const o=8&n?pt(c,[dt(t[3])]):{};if(u!==(u=t[2])){if(s){ot();const t=s;lt(t.$$.fragment,1,0,(()=>{yt(t,1)})),st()}u?(s=new u(h()),mt(s.$$.fragment),at(s.$$.fragment,1),gt(s,e,null)):s=null}else u&&s.$set(o);(!l||3&n&&a!==(a=`height:${t[0]}px; width:${t[1]}px`))&&A(e,"style",a)},i(t){l||(s&&at(s.$$.fragment,t),l=!0)},o(t){s&&lt(s.$$.fragment,t),l=!1},d(t){t&&x(e),s&&yt(s)}}}function re(t,e,i){let{height:n}=e,{width:r}=e,{children:o}=e,{childProps:s}=e;return t.$$set=t=>{"height"in t&&i(0,n=t.height),"width"in t&&i(1,r=t.width),"children"in t&&i(2,o=t.children),"childProps"in t&&i(3,s=t.childProps)},[n,r,o,s]}class oe extends vt{constructor(t){super(),_t(this,t,re,ne,l,{height:0,width:1,children:2,childProps:3})}}function se({personalAccessToken:t,fetchFunc:e}){this._personalAccessToken=t,this._fetchFunc=e}se.prototype.get=async function(t,e){const i=e?"?"+new URLSearchParams(e).toString():"",n=await this._fetchFunc(`https://api.figma.com/v1/${t}${i}`,{headers:{"X-Figma-Token":this._personalAccessToken}});if(n.status>=400){let t="";try{t+=(await n.json()).err}finally{throw new Error(`HTTP error ${n.status} accessing Figma. ${t}`)}}return n.json()};const ae=function({file:t,nodeIds:e}){function i(t,e){return t===e.id?e:e.children?e.children.map((e=>i(t,e))).find(Boolean):null}return e.map((e=>i(e,t.document)))},le=function({file:t,names:e}){function i(t,e){return t===e.name&&"FRAME"===e.type?e.id:e.children?e.children.map((e=>i(t,e))).find(Boolean):null}return e.map((e=>i(e,t.document)))};async function ce({api:t,fileKey:e,assetList:i,scales:n=[1],format:r="png"}){const o={},s=await Promise.all(n.map((n=>async function(n){return t.get(`images/${e}`,{ids:Object.values(i),format:r,scale:n})}(n))));return n.forEach(((t,e)=>{for(const n of Object.keys(i)){const r=i[n];o[n]=o[n]||{id:r},o[n][`@${t}x`]=s[e].images[r]}})),o}async function ue({frameIds:t=[],frameNames:e=[],fileKey:i,personalAccessToken:n,scales:r=[1],format:o="png",fetchFunc:s=((...t)=>window.fetch(...t))}){const a=new se({personalAccessToken:n,fetchFunc:s}),l=await a.get(`files/${i}`);e.length&&(t=[...t,...le({file:l,names:e})]);const c=ae({file:l,nodeIds:t}).filter(Boolean);if(!c.length)throw new Error(`No matching frames for ${t}, ${e}`);const u=function(t){const e={};for(const i of t.filter(Boolean))for(const t of i.children)e[t.name]=t.id;return e}(c);return await ce({api:a,fileKey:i,assetList:u,scales:r,format:o})}function he(t,e){for(const i of Object.keys(e)){const n=Math.max(...Object.keys(e[i]).filter((t=>"@"===t[0])).map((t=>+t.replace(/[^0-9.]/g,""))));t.loadImage(e[i][`@${n}x`],((e,r)=>{t.addImage(i,r,{pixelRatio:n})}))}}var pe={getFigmaIconsByFrames:ue,getFigmassets:ue,addAssetsToMap:he,loadFigmassets:async function({map:t,...e}){t&&!e.scales&&(e.scales=[2]);const i=await ue(e);return t&&he(t,i),i},loadStoredFigmassets:async function({map:t,path:e}){e&&(e=e.replace(/([^/])$/,"$1/"));const i=await fetch(`${e}assets.json`).then((t=>t.json()));for(const n of i)t.loadImage(`${e}${n.fileName}`,((e,i)=>{t.addImage(n.id,i,{pixelRatio:n.scale})}))}};let de;Gt.subscribe((t=>({figmaLink:de}=t)));const fe=async(t,e)=>{if(!de)return new Promise([]);let i={...de,frameNames:[...new Set(Ot.map((t=>de[t])).filter(Boolean))],scales:[de.scale]};delete i.destinationPin,delete i.puck,delete i.scale;const n=pe.loadFigmassets(i),r=await n;if(!Ot.some((t=>Object.keys(r).includes(t))))throw new Error(`Icons in frames need to be named ${Ot.join(", ")}. Found ${Object.keys(r).join(", ")}. Please check icon names in your Figma file.`);const o=Promise.all(Ot.filter((t=>!!r[t]||(console.warn(`${t} was not found in your Figma file.`),!1))).map((i=>new Promise(((n,o)=>{const s=r[i];if(!s)return;const a=s[Object.keys(s).find((t=>t.includes("@")))];"maplibre-gl"===e?t.loadImage(a).then((({data:e})=>{t.addImage(i,e),n({name:i,url:a,width:e.width,height:e.height})})).catch((t=>o(t))):t.loadImage(a,((e,r)=>{e&&o(e),t.addImage(i,r),n({name:i,url:a,width:r.width,height:r.height})}))})))));return o};var me={exports:{}},ge=me.exports=function(){var t,e,i;function n(n,r){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),i=r(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=r;else t=r}return n(["exports"],(function(t){var e="undefined"!=typeof self?self:{},i=n;function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var i,n,r,o,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var r=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};const s=Math.PI/180,a=180/Math.PI;function l(t){return t*s}function c(t){return t*a}const u=[[0,0],[1,0],[1,1],[0,1]];function h(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function p(t,e,n,r){const o=new i(t,e,n,r);return function(t){return o.solve(t)}}const d=p(.25,.1,.25,1);function f(t,e,i){return Math.min(i,Math.max(e,t))}function m(t,e,i){return(i=f((i-t)/(e-t),0,1))*i*(3-2*i)}function g(t,e,i){const n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function y(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const r=new Array(t.length);let o=null;t.forEach(((t,s)=>{e(t,((t,e)=>{t&&(o=t),r[s]=e,0==--n&&i(o,r)}))}))}function _(t){const e=[];for(const i in t)e.push(t[i]);return e}function v(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let x=1;function b(){return x++}function w(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function T(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function S(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function C(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function E(t,e){return-1!==t.indexOf(e,t.length-e.length)}function I(t,e,i){const n={};for(const r in t)n[r]=e.call(i||this,t[r],r,t);return n}function M(t,e,i){const n={};for(const r in t)e.call(i||this,t[r],r,t)&&(n[r]=t[r]);return n}function A(t){return Array.isArray(t)?t.map(A):"object"==typeof t&&t?I(t,A):t}const k={};function P(t){k[t]||("undefined"!=typeof console&&console.warn(t),k[t]=!0)}function L(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function z(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}function D(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,r)=>{const o=n||r;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let O=null;function F(t){if(null==O){const e=t.navigator?t.navigator.userAgent:null;O=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return O}function N(t){try{const i=e[t];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function B(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const j=e.performance;function $(t){const e=t?t.url.toString():void 0;return j.getEntriesByName(e)}var U="2.9.1";let V,G,q,Z;const W={now:()=>void 0!==q?q:e.performance.now(),setNow(t){q=t},restoreNow(){q=void 0},frame(t){const i=e.requestAnimationFrame(t);return{cancel:()=>e.cancelAnimationFrame(i)}},getImageData(t,i=0){const{width:n,height:r}=t;Z||(Z=e.document.createElement("canvas"));const o=Z.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return(n>Z.width||r>Z.height)&&(Z.width=n,Z.height=r),o.clearRect(-i,-i,n+2*i,r+2*i),o.drawImage(t,0,0,n,r),o.getImageData(-i,-i,n+2*i,r+2*i)},resolveURL:t=>(V||(V=e.document.createElement("a")),V.href=t,V.href),get devicePixelRatio(){return e.devicePixelRatio},get prefersReducedMotion(){return!!e.matchMedia&&(null==G&&(G=e.matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}};let H;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==H){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{H=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){H=t}}return H},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Y={supported:!1,testSupport:function(t){!Q&&J&&(tt?et(t):K=t)}};let K,J,Q=!1,tt=!1;function et(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J),t.isContextLost())return;Y.supported=!0}catch(t){}t.deleteTexture(e),Q=!0}e.document&&(J=e.document.createElement("img"),J.onload=function(){K&&et(K),K=null,tt=!0},J.onerror=function(){Q=!0,K=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const it="01",nt="NO_ACCESS_TOKEN";function rt(t){return 0===t.indexOf("mapbox:")}function ot(t){return X.API_URL_REGEX.test(t)}const st=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function at(t){const e=t.match(st);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function lt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ct(t){if(!t)return null;const i=t.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(e.atob(i[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class ut{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=ct(X.ACCESS_TOKEN);let n="";return n=i&&i.u?e.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):X.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const t=N("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{const t=e.localStorage.getItem(i);t&&(this.eventData=JSON.parse(t));const r=e.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){P("Unable to read from LocalStorage")}}saveEventData(){const t=N("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{e.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&e.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(t){P("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,n){if(!X.EVENTS_URL)return;const r=at(X.EVENTS_URL);r.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:it,userId:this.anonId},s=e?v(o,e):o,a={url:lt(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=Lt(a,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(n)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const ht=new class extends ut{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>rt(t)||ot(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ct(X.ACCESS_TOKEN),i=e?e.u:X.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;S(this.anonId)||(this.anonId=w(),n=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(r),i=(r-this.eventData.lastSuccess)/864e5;n=n||i>=1||i<-1||t.getDate()!==e.getDate()}else n=!0;n?this.postEvent(r,{"enabled.telemetry":!1},(t=>{t||(this.eventData.lastSuccess=r,this.eventData.tokenU=i)}),t):this.processRequests()}},pt=ht.postTurnstileEvent.bind(ht),dt=new class extends ut{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,X.EVENTS_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),S(this.anonId)||(this.anonId=w()),this.postEvent(i,{skuToken:this.skuToken},(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t))}},ft=dt.postMapLoadEvent.bind(dt),mt=new class extends ut{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!X.API_URL||!X.SESSION_PATH)return;const r=at(X.API_URL+X.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const o={url:lt(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=zt(o,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,X.SESSION_PATH&&X.API_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(nt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}},gt=mt.getSessionAPI.bind(mt),yt=new Set;let _t,vt=500,xt=50,bt={};function wt(t){const e=St(t);let i,n;e&&e.forEach((t=>{const e=t.split("=");"language"===e[0]?i=e[1]:"worldview"===e[0]&&(n=e[1])}));let r="mapbox-tiles";return i&&(r+=`-${i}`),n&&(r+=`-${n}`),r}function Tt(t){e.caches&&!bt[t]&&(bt[t]=e.caches.open(t))}function St(t){const e=t.indexOf("?");return e>0?t.slice(e+1).split("&"):[]}function Ct(t){const e=t.indexOf("?");if(e<0)return t;const i=St(t).filter((t=>{const e=t.split("=");return"language"===e[0]||"worldview"===e[0]}));return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Et=1/0;const It={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(It);class Mt extends Error{constructor(t,e,i){401===e&&ot(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const At=D()?()=>self.worker&&self.worker.referrer:()=>("blob:"===e.location.protocol?e.parent:e).location.href,kt=function(t,i){if(!(/^file:/.test(n=t.url)||/^file:/.test(At())&&!/^\w+:/.test(n))){if(e.fetch&&e.Request&&e.AbortController&&e.Request.prototype.hasOwnProperty("signal"))return function(t,i){const n=new e.AbortController,r=new e.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:At(),signal:n.signal});let o=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&ot(l);var l;"json"===t.type&&r.headers.set("Accept","application/json");const c=(n,o,l)=>{if(s)return;if(n&&"SecurityError"!==n.message&&P(n),o&&l)return u(o);const c=Date.now();e.fetch(r).then((e=>{if(e.ok){const t=a?e.clone():null;return u(e,t,c)}return i(new Mt(e.statusText,e.status,t.url))})).catch((t=>{20!==t.code&&i(new Error(t.message))}))},u=(n,a,l)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((t=>{s||(a&&l&&function(t,i,n){const r=wt(t.url);if(Tt(r),!bt[r])return;const o={status:i.status,statusText:i.statusText,headers:new e.Headers};i.headers.forEach(((t,e)=>o.headers.set(e,t)));const s=R(i.headers.get("Cache-Control")||"");if(s["no-store"])return;s["max-age"]&&o.headers.set("Expires",new Date(n+1e3*s["max-age"]).toUTCString());const a=o.headers.get("Expires");a&&(new Date(a).getTime()-n<42e4||function(t,e){if(void 0===_t)try{new Response(new ReadableStream),_t=!0}catch(t){_t=!1}_t?e(t.body):t.blob().then(e)}(i,(i=>{const n=new e.Response(i,o);Tt(r),bt[r]&&bt[r].then((e=>e.put(Ct(t.url),n))).catch((t=>P(t.message)))})))}(r,a,l),o=!0,i(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((t=>{s||i(new Error(t.message))}))};return a?function(t,e){const i=wt(t.url);if(Tt(i),!bt[i])return e(null);const n=Ct(t.url);bt[i].then((t=>{t.match(n).then((i=>{const r=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=R(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(i);t.delete(n),r&&t.put(n,i.clone()),e(null,i,r)})).catch(e)})).catch(e)}(r,c):c(null,null),{cancel:()=>{s=!0,o||n.abort()}}}(t,i);if(D()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,i,void 0,!0)}var n;return function(t,i){const n=new e.XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const e in t.headers)n.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{i(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let e=n.response;if("json"===t.type)try{e=JSON.parse(n.response)}catch(t){return i(t)}i(null,e,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else i(new Mt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:()=>n.abort()}}(t,i)},Pt=function(t,e){return kt(v(t,{type:"arrayBuffer"}),e)},Lt=function(t,e){return kt(v(t,{method:"POST"}),e)},zt=function(t,e){return kt(v(t,{method:"GET"}),e)};function Dt(t){const i=e.document.createElement("a");return i.href=t,i.protocol===e.document.location.protocol&&i.host===e.document.location.host}const Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ot,Ft;Ot=[],Ft=0;const Nt=function(t,i){if(Y.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ft>=X.MAX_PARALLEL_IMAGE_REQUESTS){const e={requestParameters:t,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Ot.push(e),e}Ft++;let n=!1;const r=()=>{if(!n)for(n=!0,Ft--;Ot.length&&Ft<X.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Ot.shift(),{requestParameters:e,callback:i,cancelled:n}=t;n||(t.cancel=Nt(e,i).cancel)}},o=Pt(t,((t,n,o,s)=>{r(),t?i(t):n&&(e.createImageBitmap?function(t,i){const n=new e.Blob([new Uint8Array(t)],{type:"image/png"});e.createImageBitmap(n).then((t=>{i(null,t)})).catch((t=>{i(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((t,e)=>i(t,e,o,s))):function(t,i){const n=new e.Image,r=e.URL;n.onload=()=>{i(null,n),r.revokeObjectURL(n.src),n.onload=null,e.requestAnimationFrame((()=>{n.src=Rt}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new e.Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(o):Rt}(n,((t,e)=>i(t,e,o,s))))}));return{cancel:()=>{o.cancel(),r()}}};function Bt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function jt(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class $t{constructor(t,e={}){v(this,e),this.type=t}}class Ut extends $t{constructor(t,e={}){super("error",v({error:t},e))}}class Vt{on(t,e){return this._listeners=this._listeners||{},Bt(t,e,this._listeners),this}off(t,e){return jt(t,e,this._listeners),jt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Bt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new $t(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of n)jt(i,e,this._oneTimeListeners),e.call(this,t);const r=this._eventedParent;r&&(v(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof Ut&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Gt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qt(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}function Zt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Wt(t){if(Array.isArray(t))return t.map(Wt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Wt(t[i]);return e}return Zt(t)}class Ht extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var Xt=Ht;class Yt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Yt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var Kt=Yt;const Jt={kind:"null"},Qt={kind:"number"},te={kind:"string"},ee={kind:"boolean"},ie={kind:"color"},ne={kind:"object"},re={kind:"value"},oe={kind:"collator"},se={kind:"formatted"},ae={kind:"resolvedImage"};function le(t,e){return{kind:"array",itemType:t,N:e}}function ce(t){if("array"===t.kind){const e=ce(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ue=[Jt,Qt,te,ee,ie,se,ne,le(re),ae];function he(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!he(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ue)if(!he(t,e))return null}return`Expected ${ce(t)} but found ${ce(e)} instead.`}function pe(t,e){return e.some((e=>e.kind===t.kind))}function de(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function fe(t){var e={exports:{}};return t(e,e.exports),e.exports}var me=fe((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function s(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),p=1;switch(u){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[n(255*s(y,g,d+1/3)),n(255*s(y,g,d)),n(255*s(y,g,d-1/3)),p];default:return null}}return null}}catch(t){}}));class ge{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof ge)return t;if("string"!=typeof t)return;const e=me.parseCSSColor(t);return e?new ge(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}toArray01(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[t/n,e/n,i/n,n]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:n}=this;return[t,e,i,n]}}ge.black=new ge(0,0,0,1),ge.white=new ge(1,1,1,1),ge.transparent=new ge(0,0,0,0),ge.red=new ge(1,0,0,1),ge.blue=new ge(0,0,1,1);var ye=ge;class _e{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ve{constructor(t,e,i,n,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class xe{constructor(t){this.sections=t}static fromString(t){return new xe([new ve(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof xe?t:xe.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class be{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new be({name:t,available:!1}):null}serialize(){return["image",this.name]}}function we(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Te(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ye)return!0;if(t instanceof _e)return!0;if(t instanceof xe)return!0;if(t instanceof be)return!0;if(Array.isArray(t)){for(const e of t)if(!Te(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Te(t[e]))return!1;return!0}return!1}function Se(t){if(null===t)return Jt;if("string"==typeof t)return te;if("boolean"==typeof t)return ee;if("number"==typeof t)return Qt;if(t instanceof ye)return ie;if(t instanceof _e)return oe;if(t instanceof xe)return se;if(t instanceof be)return ae;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=Se(e);if(i){if(i===t)continue;i=re;break}i=t}return le(i||re,e)}return ne}function Ce(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ye||t instanceof xe||t instanceof be?t.toString():JSON.stringify(t)}class Ee{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Te(t[1]))return e.error("invalid value");const i=t[1];let n=Se(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Ee(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ye?["rgba"].concat(this.value.toArray()):this.value instanceof xe?this.value.serialize():this.value}}var Ie=Ee,Me=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Ae={string:te,number:Qt,boolean:ee,object:ne};class ke{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in Ae)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=Ae[i],n++}else r=re;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=le(r,o)}else i=Ae[r];const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,re);if(!i)return null;o.push(i)}return new ke(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!he(this.type,Se(i)))return i;if(e===this.args.length-1)throw new Me(`Expected value to be of type ${ce(this.type)}, but found ${ce(Se(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}var Pe=ke;class Le{constructor(t){this.type=se,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,Qt),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,le(te)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,ie),!s))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,re);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new Le(n)}evaluate(t){return new xe(this.sections.map((e=>{const i=e.content.evaluate(t);return Se(i)===ae?new ve("",i,null,null,null):new ve(Ce(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class ze{constructor(t){this.type=ae,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,te);return i?new ze(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=be.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const De={"to-boolean":ee,"to-color":ie,"to-number":Qt,"to-string":te};class Re{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=De[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,re);if(!n)return null;r.push(n)}return new Re(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof ye)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:we(e[0],e[1],e[2],e[3]),!i))return new ye(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Me(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new Me(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?xe.fromString(Ce(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?be.fromString(Ce(this.args[0].evaluate(t))):Ce(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Le([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ze(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Oe=Re;const Fe=["Unknown","Point","LineString","Polygon"];var Ne=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Fe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ye.parse(t)),e}};class Be{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=Be.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[n,o]of s){a=new pi(e.registry,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Be(i,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(ce).join(", ")})`:`(${ce(e.type)}...)`;var e})).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(ce(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){Be.definitions=e;for(const i in e)t[i]=Be}}var je=Be;class $e{constructor(t,e,i){this.type=oe,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,ee);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,ee);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,te),!o)?null:new $e(n,r,o)}evaluate(t){return new _e(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Ue=8192;function Ve(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ge(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function qe(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*Ue),Math.round(n*r*Ue)]}function Ze(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function We(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Ze(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(n=t)[1]!=(o=a[e+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function He(t,e){for(let i=0;i<e.length;i++)if(We(t,e[i]))return!0;return!1}function Xe(t,e,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(t[0]-i[0])*o-r*(t[1]-i[1]),a=(e[0]-i[0])*o-r*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ye(t,e,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(r=e)[0]-(n=t)[0],r[1]-n[1]])[1]-a[1]*l[0]&&Xe(n,r,o,s)&&Xe(o,s,n,r))return!0;var n,r,o,s,a,l;return!1}function Ke(t,e){for(let i=0;i<t.length;++i)if(!We(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ye(t[i],t[i+1],e))return!1;return!0}function Je(t,e){for(let i=0;i<e.length;i++)if(Ke(t,e[i]))return!0;return!1}function Qe(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=qe(t[r][n],i);Ve(e,s),o.push(s)}n.push(o)}return n}function ti(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=Qe(t[r],e,i);n.push(o)}return n}function ei(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}Ve(e,t)}function ii(t,e,i,n){const r=Math.pow(2,n.z)*Ue,o=[n.x*Ue,n.y*Ue],s=[];if(!t)return s;for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];ei(n,e,i,r),s.push(n)}return s}function ni(t,e,i,n){const r=Math.pow(2,n.z)*Ue,o=[n.x*Ue,n.y*Ue],s=[];if(!t)return s;for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];Ve(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)ei(n,e,i,r)}var a;return s}class ri{constructor(t,e){this.type=ee,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Te(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ri(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new ri(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new ri(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=Qe(e.coordinates,n,r),s=ii(t.geometry(),i,n,r);if(!Ge(i,n))return!1;for(const t of s)if(!We(t,o))return!1}if("MultiPolygon"===e.type){const o=ti(e.coordinates,n,r),s=ii(t.geometry(),i,n,r);if(!Ge(i,n))return!1;for(const t of s)if(!He(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=Qe(e.coordinates,n,r),s=ni(t.geometry(),i,n,r);if(!Ge(i,n))return!1;for(const t of s)if(!Ke(t,o))return!1}if("MultiPolygon"===e.type){const o=ti(e.coordinates,n,r),s=ni(t.geometry(),i,n,r);if(!Ge(i,n))return!1;for(const t of s)if(!Je(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var oi=ri;function si(t){if(t instanceof je){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof oi)return!1;let e=!0;return t.eachChild((t=>{e&&!si(t)&&(e=!1)})),e}function ai(t){if(t instanceof je&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!ai(t)&&(e=!1)})),e}function li(t,e){if(t instanceof je&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!li(t,e)&&(i=!1)})),i}class ci{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new ci(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ui=ci;class hi{constructor(t,e=[],i,n=new Kt,r=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new Pe(e,[t]):"coerce"===i?new Oe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof Ie)&&"resolvedImage"!==n.type.kind&&di(n)){const e=new Ne;try{n=new Ie(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new hi(this.registry,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Xt(i,t))}checkSubtype(t,e){const i=he(t,e);return i&&this.error(i),i}}var pi=hi;function di(t){if(t instanceof ui)return di(t.boundExpression);if(t instanceof je&&"error"===t.name)return!1;if(t instanceof $e)return!1;if(t instanceof oi)return!1;const e=t instanceof Oe||t instanceof Pe;let i=!0;return t.eachChild((t=>{i=e?i&&di(t):i&&t instanceof Ie})),!!i&&si(t)&&li(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function fi(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new Me("Input is not a number.");s=a-1}return 0}class mi{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Qt);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new mi(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[fi(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var gi=mi;function yi(t,e,i){return t*(1-i)+e*i}var _i=Object.freeze({__proto__:null,number:yi,color:function(t,e,i){return new ye(yi(t.r,e.r,i),yi(t.g,e.g,i),yi(t.b,e.b,i),yi(t.a,e.a,i))},array:function(t,e,i){return t.map(((t,n)=>yi(t,e[n],i)))}});const vi=.95047,xi=1.08883,bi=4/29,wi=6/29,Ti=3*wi*wi,Si=Math.PI/180,Ci=180/Math.PI;function Ei(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ti+bi}function Ii(t){return t>wi?t*t*t:Ti*(t-bi)}function Mi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ai(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ki(t){const e=Ai(t.r),i=Ai(t.g),n=Ai(t.b),r=Ei((.4124564*e+.3575761*i+.1804375*n)/vi),o=Ei((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Ei((.0193339*e+.119192*i+.9503041*n)/xi)),alpha:t.a}}function Pi(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Ii(e),i=vi*Ii(i),n=xi*Ii(n),new ye(Mi(3.2404542*i-1.5371385*e-.4985314*n),Mi(-.969266*i+1.8760108*e+.041556*n),Mi(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function Li(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const zi={forward:ki,reverse:Pi,interpolate:function(t,e,i){return{l:yi(t.l,e.l,i),a:yi(t.a,e.a,i),b:yi(t.b,e.b,i),alpha:yi(t.alpha,e.alpha,i)}}},Di={forward:function(t){const{l:e,a:i,b:n}=ki(t),r=Math.atan2(n,i)*Ci;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Si,i=t.c;return Pi({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Li(t.h,e.h,i),c:yi(t.c,e.c,i),l:yi(t.l,e.l,i),alpha:yi(t.alpha,e.alpha,i)}}};var Ri=Object.freeze({__proto__:null,lab:zi,hcl:Di});class Oi{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,n,r){let o=0;if("exponential"===t.name)o=Fi(e,t.base,n,r);else if("linear"===t.name)o=Fi(e,1,n,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;o=new i(s[0],s[1],s[2],s[3]).solve(Fi(e,1,n,r))}return o}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Qt),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=ie:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Oi(a,i,n,r,s):e.error(`Type ${ce(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=fi(e,n),s=Oi.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);return"interpolate"===this.operator?_i[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Di.reverse(Di.interpolate(Di.forward(a),Di.forward(l),s)):zi.reverse(zi.interpolate(zi.forward(a),zi.forward(l),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function Fi(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}var Ni=Oi;class Bi{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const o=n&&r.some((t=>he(n,t.type)));return new Bi(o?re:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(t),i&&i instanceof be&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var ji=Bi;class $i{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new $i(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}var Ui=$i;class Vi{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Qt),n=e.parse(t[2],2,le(e.expectedType||re));return i&&n?new Vi(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Me(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new Me(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new Me(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gi=Vi;class qi{constructor(t,e){this.type=ee,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,re),n=e.parse(t[2],2,re);return i&&n?pe(i.type,[ee,te,Qt,Jt,re])?new qi(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!de(e,["boolean","string","number","null"]))throw new Me(`Expected first argument to be of type boolean, string, number or null, but found ${ce(Se(e))} instead.`);if(!de(i,["string","array"]))throw new Me(`Expected second argument to be of type array or string, but found ${ce(Se(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Zi=qi;class Wi{constructor(t,e,i){this.type=Qt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,re),n=e.parse(t[2],2,re);if(!i||!n)return null;if(!pe(i.type,[ee,te,Qt,Jt,re]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Qt);return r?new Wi(i,n,r):null}return new Wi(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!de(e,["boolean","string","number","null"]))throw new Me(`Expected first argument to be of type boolean, string, number or null, but found ${ce(Se(e))} instead.`);if(!de(i,["string","array"]))throw new Me(`Expected second argument to be of type array or string, but found ${ce(Se(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Hi=Wi;class Xi{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Se(t)))return null}else i=Se(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=e.parse(t[1],1,re);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new Xi(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(Se(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)t.push(1===n.length?r(n[0]):n.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var Yi=Xi;class Ki{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,ee);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new Ki(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var Ji=Ki;class Qi{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,re),n=e.parse(t[2],2,Qt);if(!i||!n)return null;if(!pe(i.type,[le(re),te,re]))return e.error(`Expected first argument to be of type array or string, but found ${ce(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Qt);return r?new Qi(i.type,i,n,r):null}return new Qi(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!de(e,["string","array"]))throw new Me(`Expected first argument to be of type array or string, but found ${ce(Se(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var tn=Qi;function en(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function nn(t,e,i,n){return 0===n.compare(e,i)}function rn(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=ee,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,re);if(!o)return null;if(!en(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${ce(o.type)}'.`);let s=e.parse(t[2],2,re);if(!s)return null;if(!en(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${ce(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${ce(o.type)}' and '${ce(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Pe(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Pe(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,oe),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=Se(o),i=Se(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new Me(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=Se(o),i=Se(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const on=rn("==",(function(t,e,i){return e===i}),nn),sn=rn("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!nn(0,e,i,n)})),an=rn("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),ln=rn(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),cn=rn("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),un=rn(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class hn{constructor(t,e,i,n,r){this.type=te,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Qt);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,te),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,te),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,Qt),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Qt),!a)?null:new hn(i,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class pn{constructor(t){this.type=Qt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${ce(i.type)} instead.`):new pn(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Me(`Expected value to be of type string or array, but found ${ce(Se(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const dn={"==":on,"!=":sn,">":ln,"<":an,">=":un,"<=":cn,array:Pe,at:Gi,boolean:Pe,case:Ji,coalesce:ji,collator:$e,format:Le,image:ze,in:Zi,"index-of":Hi,interpolate:Ni,"interpolate-hcl":Ni,"interpolate-lab":Ni,length:pn,let:Ui,literal:Ie,match:Yi,number:Pe,"number-format":hn,object:Pe,slice:tn,step:gi,string:Pe,"to-boolean":Oe,"to-color":Oe,"to-number":Oe,"to-string":Oe,var:ui,within:oi};function fn(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=we(e,i,n,o);if(s)throw new Me(s);return new ye(e/255*o,i/255*o,n/255*o,o)}function mn(t,e){return t in e}function gn(t,e){const i=e[t];return void 0===i?null:i}function yn(t){return{type:t}}je.register(dn,{error:[{kind:"error"},[te],(t,[e])=>{throw new Me(e.evaluate(t))}],typeof:[te,[re],(t,[e])=>ce(Se(e.evaluate(t)))],"to-rgba":[le(Qt,4),[ie],(t,[e])=>e.evaluate(t).toArray()],rgb:[ie,[Qt,Qt,Qt],fn],rgba:[ie,[Qt,Qt,Qt,Qt],fn],has:{type:ee,overloads:[[[te],(t,[e])=>mn(e.evaluate(t),t.properties())],[[te,ne],(t,[e,i])=>mn(e.evaluate(t),i.evaluate(t))]]},get:{type:re,overloads:[[[te],(t,[e])=>gn(e.evaluate(t),t.properties())],[[te,ne],(t,[e,i])=>gn(e.evaluate(t),i.evaluate(t))]]},"feature-state":[re,[te],(t,[e])=>gn(e.evaluate(t),t.featureState||{})],properties:[ne,[],t=>t.properties()],"geometry-type":[te,[],t=>t.geometryType()],id:[re,[],t=>t.id()],zoom:[Qt,[],t=>t.globals.zoom],pitch:[Qt,[],t=>t.globals.pitch||0],"distance-from-center":[Qt,[],t=>t.distanceFromCenter()],"heatmap-density":[Qt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Qt,[],t=>t.globals.skyRadialProgress||0],accumulated:[re,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Qt,yn(Qt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Qt,yn(Qt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Qt,overloads:[[[Qt,Qt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Qt],(t,[e])=>-e.evaluate(t)]]},"/":[Qt,[Qt,Qt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Qt,[Qt,Qt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Qt,[Qt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qt,[Qt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qt,[Qt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qt,[Qt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qt,[Qt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qt,[Qt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qt,[Qt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qt,[Qt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qt,yn(Qt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Qt,yn(Qt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Qt,[Qt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qt,[Qt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qt,[Qt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qt,[Qt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ee,[te,re],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ee,[re],(t,[e])=>t.id()===e.value],"filter-type-==":[ee,[te],(t,[e])=>t.geometryType()===e.value],"filter-<":[ee,[te,re],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[ee,[re],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[ee,[te,re],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[ee,[re],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[ee,[te,re],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[ee,[re],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[ee,[te,re],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[ee,[re],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[ee,[re],(t,[e])=>e.value in t.properties()],"filter-has-id":[ee,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ee,[le(te)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ee,[le(re)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ee,[te,le(re)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ee,[te,le(re)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ee,overloads:[[[ee,ee],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[yn(ee),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ee,overloads:[[[ee,ee],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[yn(ee),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ee,[ee],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ee,[te],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[te,[te],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[te,[te],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[te,yn(re),(t,e)=>e.map((e=>Ce(e.evaluate(t)))).join("")],"resolved-locale":[te,[oe],(t,[e])=>e.evaluate(t).resolvedLocale()]});var _n=dn;function vn(t){return{result:"success",value:t}}function xn(t){return{result:"error",value:t}}function bn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function wn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Tn(t){return!!t.expression&&t.expression.interpolated}function Sn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Cn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function En(t){return t}function In(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],r=n||!(n||void 0!==t.property),o=t.type||(Tn(e)?"exponential":"interval");if(i&&((t=qt({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],ye.parse(t[1])]))),t.default=ye.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ri[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,l;if("exponential"===o)s=Pn;else if("interval"===o)s=kn;else if("categorical"===o){s=An,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Ln}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of n)r.push([i[t].zoom,In(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Ni.interpolationFactor.bind(void 0,o),zoomStops:r.map((t=>t[0])),evaluate:({zoom:i},n)=>Pn({stops:r,base:t.base},e,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Ni.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>s(t,e,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[t.property]:void 0;return void 0===r?Mn(t.default,e.default):s(t,e,r,a,l)}}}function Mn(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function An(t,e,i,n,r){return Mn(typeof i===r?n[i]:void 0,t.default,e.default)}function kn(t,e,i){if("number"!==Sn(i))return Mn(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=fi(t.stops.map((t=>t[0])),i);return t.stops[r][1]}function Pn(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==Sn(i))return Mn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=fi(t.stops.map((t=>t[0])),i),s=function(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1];let c=_i[e.type]||En;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Ri[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,s)}}:c(a,l,s)}function Ln(t,e,i){return"color"===e.type?i=ye.parse(i):"formatted"===e.type?i=xe.fromString(i.toString()):"resolvedImage"===e.type?i=be.fromString(i.toString()):Sn(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Mn(i,t.default,e.default)}class zn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new Ne,this._defaultValue=e?function(t){return"color"===t.type&&(Cn(t.default)||Array.isArray(t.default))?new ye(0,0,0,0):"color"===t.type?ye.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Me(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Dn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in _n}function Rn(t,e){const i=new pi(_n,[],e?function(t){const e={color:ie,string:te,number:Qt,enum:te,boolean:ee,formatted:se,resolvedImage:ae};return"array"===t.type?le(e[t.value]||re,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?vn(new zn(n,e)):xn(i.errors)}class On{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!ai(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}}class Fn{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!ai(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?Ni.interpolationFactor(this.interpolationType,t,e,i):0}}function Nn(t,e){if("error"===(t=Rn(t,e)).result)return t;const i=t.value.expression,n=si(i);if(!n&&!bn(e))return xn([new Xt("","data expressions not supported")]);const r=li(i,["zoom","pitch","distance-from-center"]);if(!r&&!wn(e))return xn([new Xt("","zoom expressions not supported")]);const o=jn(i);return o||r?o instanceof Xt?xn([o]):o instanceof Ni&&!Tn(e)?xn([new Xt("",'"interpolate" expressions cannot be used with this property')]):vn(o?new Fn(n?"camera":"composite",t.value,o.labels,o instanceof Ni?o.interpolation:void 0):new On(n?"constant":"source",t.value)):xn([new Xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bn{constructor(t,e){this._parameters=t,this._specification=e,qt(this,In(this._parameters,this._specification))}static deserialize(t){return new Bn(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function jn(t){let e=null;if(t instanceof Ui)e=jn(t.result);else if(t instanceof ji){for(const i of t.args)if(e=jn(i),e)break}else(t instanceof gi||t instanceof Ni)&&t.input instanceof je&&"zoom"===t.input.name&&(e=t);return e instanceof Xt||t.eachChild((t=>{const i=jn(t);i instanceof Xt?e=i:!e&&i?e=new Xt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Xt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}class $n{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function Un(t){const e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=Sn(i);if("object"!==l)return[new $n(e,i,`object expected, ${l} found`)];for(const t in i){const l=t.split(".")[0],c=n[l]||n["*"];let u;r[l]?u=r[l]:n[l]?u=br:r["*"]?u=r["*"]:n["*"]&&(u=br),u?a=a.concat(u({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:t},i)):a.push(new $n(e,i[t],`unknown property "${t}"`))}for(const t in n)r[t]||n[t].required&&void 0===n[t].default&&void 0===i[t]&&a.push(new $n(e,i,`missing required property "${t}"`));return a}function Vn(t){const e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,o=t.key,s=t.arrayElementValidator||br;if("array"!==Sn(e))return[new $n(o,e,`array expected, ${Sn(e)} found`)];if(i.length&&e.length!==i.length)return[new $n(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new $n(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(a.function=i.function),"object"===Sn(i.value)&&(a=i.value);let l=[];for(let t=0;t<e.length;t++)l=l.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:n,styleSpec:r,key:`${o}[${t}]`}));return l}function Gn(t){const e=t.key,i=t.value,n=t.valueSpec;let r=Sn(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new $n(e,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===Sn(n.minimum)&&(r=n.minimum[t.arrayIndex]),i<r)return[new $n(e,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===Sn(n.maximum)&&(r=n.maximum[t.arrayIndex]),i>r)return[new $n(e,i,`${i} is greater than the maximum value ${r}`)]}return[]}function qn(t){const e=t.valueSpec,i=Zt(t.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Sn(t.value.stops)&&"array"===Sn(t.value.stops[0])&&"object"===Sn(t.value.stops[0][0]),u=Un({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new $n(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;return e=e.concat(Vn({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Sn(n)&&0===n.length&&e.push(new $n(t.key,n,"array must have at least one stop")),e},default:function(t){return br({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new $n(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new $n(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Tn(t.valueSpec)&&u.push(new $n(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!bn(t.valueSpec)?u.push(new $n(t.key,t.value,"property functions not supported")):a&&!wn(t.valueSpec)&&u.push(new $n(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new $n(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const n=t.value,a=t.key;if("array"!==Sn(n))return[new $n(a,n,`array expected, ${Sn(n)} found`)];if(2!==n.length)return[new $n(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Sn(n[0]))return[new $n(a,n,`object expected, ${Sn(n[0])} found`)];if(void 0===n[0].zoom)return[new $n(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new $n(a,n,"object stop key must have value")];const e=Zt(n[0].zoom);if("number"!=typeof e)return[new $n(a,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>e)return[new $n(a,n[0].zoom,"stop zoom values must appear in ascending order")];e!==o&&(o=e,r=void 0,s={}),i=i.concat(Un({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Gn,value:p}}))}else i=i.concat(p({key:`${a}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return Dn(Wt(n[1]))?i.concat([new $n(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(br({key:`${a}[1]`,value:n[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const a=Sn(t.value),l=Zt(t.value),c=null!==t.value?t.value:o;if(n){if(a!==n)return[new $n(t.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new $n(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return bn(e)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $n(t.key,c,n)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new $n(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new $n(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new $n(t.key,c,`integer expected, found ${String(l)}`)]}}function Zn(t){const e=("property"===t.expressionContext?Nn:Rn)(Wt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new $n(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new $n(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ai(i))return[new $n(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Wn(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!li(i,["zoom","feature-state"]))return[new $n(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!si(i))return[new $n(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wn(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const t of e.valueSpec.expression.parameters)i.delete(t);if(0===i.size)return[];const n=[];return t instanceof je&&i.has(t.name)?[new $n(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild((t=>{n.push(...Wn(t,e))})),n)}function Hn(t){const e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(Zt(i))&&r.push(new $n(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(Zt(i))&&r.push(new $n(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Xn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Xn(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Yn(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xn(t)||(t=nr(t));const i=t;let n=!0;try{n=function(t){if(!Qn(t))return t;let e=Wt(t);return Jn(e),e=Kn(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=Gt[`filter_${e}`],o=Rn(n,r);let s=null;if("error"===o.result)throw new Error(o.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(t,e,i)=>o.value.evaluate(t,e,{},i);let a=null,l=null;if(n!==i){const t=Rn(i,r);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,i,n,r,o)=>t.value.evaluate(e,i,{},n,void 0,void 0,r,o),l=!si(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:ir(n),needFeature:!!l}}function Kn(t){if(!Array.isArray(t))return t;const e=function(t){if(tr.has(t[0]))for(let e=1;e<t.length;e++)if(Qn(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>Kn(t)))}function Jn(t){let e=!1;const i=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||Qn(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||Qn(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||Qn(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let e=1;e<t.length;e++)Jn(t[e])}function Qn(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(Qn(t[e]))return!0;return!1}const tr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function er(t,e){return t<e?-1:t>e?1:0}function ir(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(ir(t[e]))return!0;return!1}function nr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?rr(t[1],t[2],"=="):"!="===e?ar(rr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?rr(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(nr))):"all"===e?["all"].concat(t.slice(1).map(nr)):"none"===e?["all"].concat(t.slice(1).map(nr).map(ar)):"in"===e?or(t[1],t.slice(2)):"!in"===e?ar(or(t[1],t.slice(2))):"has"===e?sr(t[1]):"!has"===e?ar(sr(t[1])):"within"!==e||t;var i}function rr(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function or(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(er)]]:["filter-in-small",t,["literal",e]]}}function sr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ar(t){return["!",t]}function lr(t){return Xn(Wt(t.value))?Zn(qt({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):cr(t)}function cr(t){const e=t.value,i=t.key;if("array"!==Sn(e))return[new $n(i,e,`array expected, ${Sn(e)} found`)];const n=t.styleSpec;let r,o=[];if(e.length<1)return[new $n(i,e,"filter array must have at least 1 element")];switch(o=o.concat(Hn({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Zt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Zt(e[1])&&o.push(new $n(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new $n(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=Sn(e[1]),"string"!==r&&o.push(new $n(`${i}[1]`,e[1],`string expected, ${r} found`)));for(let s=2;s<e.length;s++)r=Sn(e[s]),"$type"===Zt(e[1])?o=o.concat(Hn({key:`${i}[${s}]`,value:e[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new $n(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)o=o.concat(cr({key:`${i}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=Sn(e[1]),2!==e.length?o.push(new $n(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new $n(`${i}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=Sn(e[1]),2!==e.length?o.push(new $n(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new $n(`${i}[1]`,e[1],`object expected, ${r} found`))}return o}function ur(t,e){const i=t.key,n=t.style,r=t.styleSpec,o=t.value,s=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return br({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=t.valueSpec||a[s];if(!c)return[new $n(i,o,`unknown property "${s}"`)];let u;if("string"===Sn(o)&&bn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new $n(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new $n(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Cn(Wt(o))&&"identity"===Zt(o.type)&&h.push(new $n(i,o,'"text-font" does not support identity functions'))),h.concat(br({key:t.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:s}))}function hr(t){return ur(t,"paint")}function pr(t){return ur(t,"layout")}function dr(t){let e=[];const i=t.value,n=t.key,r=t.style,o=t.styleSpec;i.type||i.ref||e.push(new $n(n,i,'either "type" or "ref" is required'));let s=Zt(i.type);const a=Zt(i.ref);if(i.id){const o=Zt(i.id);for(let s=0;s<t.arrayIndex;s++){const t=r.layers[s];Zt(t.id)===o&&e.push(new $n(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new $n(n,i[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{Zt(e.id)===a&&(t=e)})),t?t.ref?e.push(new $n(n,i.ref,"ref cannot reference another ref layer")):s=Zt(t.type):"string"==typeof a&&e.push(new $n(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const t=r.sources&&r.sources[i.source],o=t&&Zt(t.type);t?"vector"===o&&"raster"===s?e.push(new $n(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new $n(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new $n(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics||e.push(new $n(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new $n(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new $n(n,i.source,`source "${i.source}" not found`))}else e.push(new $n(n,i,'missing required property "source"'));return e=e.concat(Un({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>br({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>lr(qt({layerType:s},t)),layout:t=>Un({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>pr(qt({layerType:s},t))}}),paint:t=>Un({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>hr(qt({layerType:s},t))}})}})),e}function fr(t){const e=t.value,i=t.key,n=Sn(e);return"string"!==n?[new $n(i,e,`string expected, ${n} found`)]:[]}const mr={promoteId:function({key:t,value:e}){if("string"===Sn(e))return fr({key:t,value:e});{const i=[];for(const n in e)i.push(...fr({key:`${t}.${n}`,value:e[n]}));return i}}};function gr(t){const e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new $n(i,e,'"type" is required')];const o=Zt(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Un({key:i,value:e,valueSpec:n[`source_${o.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:mr}),s;case"geojson":if(s=Un({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:mr}),e.cluster)for(const t in e.clusterProperties){const[n,r]=e.clusterProperties[t],o="string"==typeof n?[n,["accumulated"],["get",t]]:n;s.push(...Zn({key:`${i}.${t}.map`,value:r,expressionContext:"cluster-map"})),s.push(...Zn({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Un({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Un({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new $n(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hn({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function yr(t){const e=t.value,i=t.styleSpec,n=i.light,r=t.style;let o=[];const s=Sn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new $n("light",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?br({key:t,value:e[t],valueSpec:i.transition,style:r,styleSpec:i}):n[t]?br({key:t,value:e[t],valueSpec:n[t],style:r,styleSpec:i}):[new $n(t,e[t],`unknown property "${t}"`)])}return o}function _r(t){const e=t.value,i=t.key,n=t.style,r=t.styleSpec,o=r.terrain;let s=[];const a=Sn(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new $n("terrain",e,`object expected, ${a} found`)]),s;for(const t in e){const i=t.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?br({key:t,value:e[t],valueSpec:r.transition,style:n,styleSpec:r}):o[t]?br({key:t,value:e[t],valueSpec:o[t],style:n,styleSpec:r}):[new $n(t,e[t],`unknown property "${t}"`)])}if(e.source){const t=n.sources&&n.sources[e.source],r=t&&Zt(t.type);t?"raster-dem"!==r&&s.push(new $n(i,e.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):s.push(new $n(i,e.source,`source "${e.source}" not found`))}else s.push(new $n(i,e,'terrain is missing required property "source"'));return s}function vr(t){const e=t.value,i=t.style,n=t.styleSpec,r=n.fog;let o=[];const s=Sn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new $n("fog",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?br({key:t,value:e[t],valueSpec:n.transition,style:i,styleSpec:n}):r[t]?br({key:t,value:e[t],valueSpec:r[t],style:i,styleSpec:n}):[new $n(t,e[t],`unknown property "${t}"`)])}return o}const xr={"*":()=>[],array:Vn,boolean:function(t){const e=t.value,i=t.key,n=Sn(e);return"boolean"!==n?[new $n(i,e,`boolean expected, ${n} found`)]:[]},number:Gn,color:function(t){const e=t.key,i=t.value,n=Sn(i);return"string"!==n?[new $n(e,i,`color expected, ${n} found`)]:null===me.parseCSSColor(i)?[new $n(e,i,`color expected, "${i}" found`)]:[]},enum:Hn,filter:lr,function:qn,layer:dr,object:Un,source:gr,light:yr,terrain:_r,fog:vr,string:fr,formatted:function(t){return 0===fr(t).length?[]:Zn(t)},resolvedImage:function(t){return 0===fr(t).length?[]:Zn(t)},projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,r=t.style;let o=[];const s=Sn(e);if("object"===s)for(const t in e)o=o.concat(br({key:t,value:e[t],valueSpec:n[t],style:r,styleSpec:i}));else"string"!==s&&(o=o.concat([new $n("projection",e,`object or string expected, ${s} found`)]));return o}};function br(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return i.expression&&Cn(Zt(e))?qn(t):i.expression&&Dn(Wt(e))?Zn(t):i.type&&xr[i.type]?xr[i.type](t):Un(qt({},t,{valueSpec:i.type?n[i.type]:i}))}function wr(t){const e=t.value,i=t.key,n=fr(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new $n(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new $n(i,e,'"glyphs" url must include a "{range}" token'))),n}function Tr(t,e=Gt){return Er(br({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:wr,"*":()=>[]}}))}const Sr=t=>Er(hr(t)),Cr=t=>Er(pr(t));function Er(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function Ir(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new Ut(new Error(n.message))),i=!0;return i}var Mr=Ar;function Ar(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[3+o],a=r[3+o+1];n.push(s===a?null:r.subarray(s,a))}var l=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}Ar.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ar.prototype._insertCell=function(t,e,i,n,r,o){this.cells[r].push(o)},Ar.prototype.query=function(t,e,i,n,r){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{},r),a},Ar.prototype._queryCell=function(t,e,i,n,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===s[p]){var d=4*p;(a?a(u[d+0],u[d+1],u[d+2],u[d+3]):t<=u[d+2]&&e<=u[d+3]&&i>=u[d+0]&&n>=u[d+1])?(s[p]=!0,o.push(c[p])):s[p]=!1}}},Ar.prototype._forEachCell=function(t,e,i,n,r,o,s,a){for(var l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),p=l;p<=u;p++)for(var d=c;d<=h;d++){var f=this.d*d+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&r.call(this,t,e,i,n,f,o,s,a))return}},Ar.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ar.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(e+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];r[3+s]=o,r.set(a,o),o+=a.length}return r[3+t.length]=o,r.set(this.keys,o),r[3+t.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const kr={};function Pr(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),kr[e]={klass:t,omit:i.omit||[]}}Pr(Object,"Object"),Mr.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Mr.deserialize=function(t){return new Mr(t.buffer)},Object.defineProperty(Mr,"name",{value:"Grid"}),Pr(Mr,"Grid"),Pr(ye,"Color"),Pr(Error,"Error"),Pr(Mt,"AJAXError"),Pr(be,"ResolvedImage"),Pr(Bn,"StylePropertyFunction"),Pr(zn,"StyleExpression",{omit:["_evaluator"]}),Pr(Fn,"ZoomDependentExpression"),Pr(On,"ZoomConstantExpression"),Pr(je,"CompoundExpression",{omit:["_evaluate"]});for(const t in _n)kr[_n[t]._classRegistryKey]||Pr(_n[t],`Expression${t}`);function Lr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function zr(t){return e.ImageBitmap&&t instanceof e.ImageBitmap}function Dr(t,i){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Lr(t)||zr(t))return i&&i.push(t),t;if(ArrayBuffer.isView(t)){const e=t;return i&&i.push(e.buffer),e}if(t instanceof e.ImageData)return i&&i.push(t.data.buffer),t;if(Array.isArray(t)){const e=[];for(const n of t)e.push(Dr(n,i));return e}if("object"==typeof t){const e=t.constructor,n=e._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=e.serialize?e.serialize(t,i):{};if(!e.serialize){for(const e in t)t.hasOwnProperty(e)&&(kr[n].omit.indexOf(e)>=0||(r[e]=Dr(t[e],i)));t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof t)}function Rr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Lr(t)||zr(t)||ArrayBuffer.isView(t)||t instanceof e.ImageData)return t;if(Array.isArray(t))return t.map(Rr);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=kr[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(n[e]=Rr(t[e]));return n}throw new Error("can't deserialize object of type "+typeof t)}class Or{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const Fr=t=>t>=1536&&t<=1791,Nr=t=>t>=1872&&t<=1919,Br=t=>t>=2208&&t<=2303,jr=t=>t>=11904&&t<=12031,$r=t=>t>=12032&&t<=12255,Ur=t=>t>=12272&&t<=12287,Vr=t=>t>=12288&&t<=12351,Gr=t=>t>=12352&&t<=12447,qr=t=>t>=12448&&t<=12543,Zr=t=>t>=12544&&t<=12591,Wr=t=>t>=12704&&t<=12735,Hr=t=>t>=12736&&t<=12783,Xr=t=>t>=12784&&t<=12799,Yr=t=>t>=12800&&t<=13055,Kr=t=>t>=13056&&t<=13311,Jr=t=>t>=13312&&t<=19903,Qr=t=>t>=19968&&t<=40959,to=t=>t>=40960&&t<=42127,eo=t=>t>=42128&&t<=42191,io=t=>t>=44032&&t<=55215,no=t=>t>=63744&&t<=64255,ro=t=>t>=64336&&t<=65023,oo=t=>t>=65040&&t<=65055,so=t=>t>=65072&&t<=65103,ao=t=>t>=65104&&t<=65135,lo=t=>t>=65136&&t<=65279,co=t=>t>=65280&&t<=65519;function uo(t){for(const e of t)if(fo(e.charCodeAt(0)))return!0;return!1}function ho(t){for(const e of t)if(!po(e.charCodeAt(0)))return!1;return!0}function po(t){return!(Fr(t)||Nr(t)||Br(t)||ro(t)||lo(t))}function fo(t){return!(746!==t&&747!==t&&(t<4352||!(Wr(t)||Zr(t)||so(t)&&!(t>=65097&&t<=65103)||no(t)||Kr(t)||jr(t)||Hr(t)||!(!Vr(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Jr(t)||Qr(t)||Yr(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||io(t)||Gr(t)||Ur(t)||(t=>t>=12688&&t<=12703)(t)||$r(t)||Xr(t)||qr(t)&&12540!==t||!(!co(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ao(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||oo(t)||(t=>t>=19904&&t<=19967)(t)||to(t)||eo(t))))}function mo(t){return!(fo(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Vr(t)||qr(t)||(t=>t>=57344&&t<=63743)(t)||so(t)||ao(t)||co(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function go(t){return t>=1424&&t<=2303||ro(t)||lo(t)}function yo(t,e){return!(!e&&go(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(t=>t>=6016&&t<=6143)(t))}function _o(t){for(const e of t)if(go(e.charCodeAt(0)))return!0;return!1}const vo="deferred",xo="loading",bo="loaded";let wo=null,To="unavailable",So=null;const Co=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(To="error"),wo&&wo(t)};function Eo(){Io.fire(new $t("pluginStateChange",{pluginStatus:To,pluginURL:So}))}const Io=new Vt,Mo=function(){return To},Ao=function(){if(To!==vo||!So)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=xo,Eo(),So&&Pt({url:So},(t=>{t?Co(t):(To=bo,Eo())}))},ko={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===bo||null!=ko.applyArabicShaping,isLoading:()=>To===xo,setState(t){To=t.pluginStatus,So=t.pluginURL},isParsed:()=>null!=ko.applyArabicShaping&&null!=ko.processBidirectionalText&&null!=ko.processStyledBidirectionalText,getPluginURL:()=>So};class Po{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition,this.pitch=e.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Or,this.transition={},this.pitch=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!yo(i.charCodeAt(0),e))return!1;return!0}(t,ko.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class Lo{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Cn(t))return new Bn(t,e);if(Dn(t)){const i=Nn(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=ye.parse(t)),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class zo{constructor(t){this.property=t,this.value=new Lo(t,void 0)}transitioned(t,e){return new Ro(this.property,this.value,e,v({},t.transition,this.transition),t.now)}untransitioned(){return new Ro(this.property,this.value,null,{},0)}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return A(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zo(this._values[t].property)),this._values[t].value=new Lo(this._values[t].property,null===e?void 0:A(e))}getTransition(t){return A(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zo(this._values[t].property)),this._values[t].transition=A(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new Oo(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new Oo(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class Ro{constructor(t,e,i,n,r){const o=n.delay||0,s=n.duration||0;r=r||0,this.property=t,this.value=e,this.begin=r+o,this.end=this.begin+s,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),r,h(s))}}return r}}class Oo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new Bo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Fo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return A(this._values[t].value)}setValue(t,e){this._values[t]=new Lo(this._values[t].property,null===e?void 0:A(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new Bo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}}class No{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class Bo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const n=_i[this.specification.type];return n?n(t,e,i):t}}class $o{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new No(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new No(this,{kind:"constant",value:void 0},t.parameters);const n=_i[this.specification.type];return n?new No(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,n,r,o){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,o)}}class Uo extends $o{possiblyEvaluate(t,e,i,n){if(void 0===t.value)return new No(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,e);return new No(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new No(this,{kind:"constant",value:i},e)}return new No(this,t.expression,e)}evaluate(t,e,i,n,r,o){if("source"===t.kind){const s=t.evaluate(e,i,n,r,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,n),t.evaluate({zoom:Math.floor(e.zoom)},i,n),t.evaluate({zoom:Math.floor(e.zoom)+1},i,n),e):t.value}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e,other:i}:{from:i,to:e,other:t}}interpolate(t){return t}}class Vo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Po(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Po(Math.floor(e.zoom),e)),t.expression.evaluate(new Po(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class Go{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class qo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Po(0,{});for(const i in t){const n=t[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new Lo(n,void 0),o=this.defaultTransitionablePropertyValues[i]=new zo(n);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(e)}}}function Zo(t,e){return 256*(t=f(Math.floor(t),0,255))+f(Math.floor(e),0,255)}Pr($o,"DataDrivenProperty"),Pr(jo,"DataConstantProperty"),Pr(Uo,"CrossFadedDataDrivenProperty"),Pr(Vo,"CrossFadedProperty"),Pr(Go,"ColorRampProperty");const Wo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ho{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yo(t,e=1){let i=0,n=0;return{members:t.map((t=>{const r=Wo[t.type].BYTES_PER_ELEMENT,o=i=Ko(i,Math.max(e,r)),s=t.components||1;return n=Math.max(n,r),i+=r*s,{name:t.name,type:t.type,components:s,offset:o}})),size:Ko(i,Math.max(n,e)),alignment:e}}function Ko(t,e){return Math.ceil(t/e)*e}class Jo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}Jo.prototype.bytesPerElement=4,Pr(Jo,"StructArrayLayout2i4");class Qo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t}}Qo.prototype.bytesPerElement=6,Pr(Qo,"StructArrayLayout3i6");class ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,t}}ts.prototype.bytesPerElement=8,Pr(ts,"StructArrayLayout4i8");class es extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=6*t,c=12*t,u=3*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,t}}es.prototype.bytesPerElement=12,Pr(es,"StructArrayLayout2i4ub1f12");class is extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,t}}is.prototype.bytesPerElement=16,Pr(is,"StructArrayLayout4f16");class ns extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,o,s,a,l,c)}emplace(t,e,i,n,r,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}ns.prototype.bytesPerElement=20,Pr(ns,"StructArrayLayout10ui20");class rs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,t,e,i,n,r,o,s,a)}emplace(t,e,i,n,r,o,s,a,l){const c=8*t;return this.uint16[c+0]=e,this.uint16[c+1]=i,this.uint16[c+2]=n,this.uint16[c+3]=r,this.uint16[c+4]=o,this.uint16[c+5]=s,this.uint16[c+6]=a,this.uint16[c+7]=l,t}}rs.prototype.bytesPerElement=16,Pr(rs,"StructArrayLayout8ui16");class os extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}os.prototype.bytesPerElement=12,Pr(os,"StructArrayLayout6i12");class ss extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,n,r,o,s,a,l,c,u,h)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=r,this.uint16[d+4]=o,this.uint16[d+5]=s,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t}}ss.prototype.bytesPerElement=24,Pr(ss,"StructArrayLayout4i4ui4i24");class as extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,t}}as.prototype.bytesPerElement=20,Pr(as,"StructArrayLayout3i3f20");class ls extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}ls.prototype.bytesPerElement=4,Pr(ls,"StructArrayLayout1ul4");class cs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,p){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,r,o,s,a,l,c,u,h,p)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p,d){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=p,this.uint16[f+19]=d,t}}cs.prototype.bytesPerElement=40,Pr(cs,"StructArrayLayout5i4f1i1ul2ui40");class us extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,t}}us.prototype.bytesPerElement=16,Pr(us,"StructArrayLayout3i2i2i16");class hs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,t}}hs.prototype.bytesPerElement=16,Pr(hs,"StructArrayLayout2f1f2i16");class ps extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=i,this.float32[s+1]=n,this.float32[s+2]=r,t}}ps.prototype.bytesPerElement=12,Pr(ps,"StructArrayLayout2ub2f12");class ds extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}ds.prototype.bytesPerElement=12,Pr(ds,"StructArrayLayout3f12");class fs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t}}fs.prototype.bytesPerElement=6,Pr(fs,"StructArrayLayout3ui6");class ms extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b){const w=30*t,T=15*t,S=60*t;return this.int16[w+0]=e,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[T+2]=r,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=p,this.uint16[w+18]=d,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=y,this.uint8[S+50]=_,this.uint32[T+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,t}}ms.prototype.bytesPerElement=60,Pr(ms,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class gs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I,M,A){const k=this.length;return this.resize(k+1),this.emplace(k,t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I,M,A)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I,M,A,k){const P=38*t,L=19*t;return this.int16[P+0]=e,this.int16[P+1]=i,this.int16[P+2]=n,this.float32[L+2]=r,this.float32[L+3]=o,this.int16[P+8]=s,this.int16[P+9]=a,this.int16[P+10]=l,this.int16[P+11]=c,this.int16[P+12]=u,this.int16[P+13]=h,this.uint16[P+14]=p,this.uint16[P+15]=d,this.uint16[P+16]=f,this.uint16[P+17]=m,this.uint16[P+18]=g,this.uint16[P+19]=y,this.uint16[P+20]=_,this.uint16[P+21]=v,this.uint16[P+22]=x,this.uint16[P+23]=b,this.uint16[P+24]=w,this.uint16[P+25]=T,this.uint16[P+26]=S,this.uint16[P+27]=C,this.uint16[P+28]=E,this.uint32[L+15]=I,this.float32[L+16]=M,this.float32[L+17]=A,this.float32[L+18]=k,t}}gs.prototype.bytesPerElement=76,Pr(gs,"StructArrayLayout3i2f6i15ui1ul3f76");class ys extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}ys.prototype.bytesPerElement=4,Pr(ys,"StructArrayLayout1f4");class _s extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,r,o,s)}emplace(t,e,i,n,r,o,s,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,t}}_s.prototype.bytesPerElement=28,Pr(_s,"StructArrayLayout7f28");class vs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,t}}vs.prototype.bytesPerElement=20,Pr(vs,"StructArrayLayout5f20");class xs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=i,this.uint16[o+3]=n,this.uint16[o+4]=r,t}}xs.prototype.bytesPerElement=12,Pr(xs,"StructArrayLayout1ul3ui12");class bs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}bs.prototype.bytesPerElement=4,Pr(bs,"StructArrayLayout2ui4");class ws extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}ws.prototype.bytesPerElement=2,Pr(ws,"StructArrayLayout1ui2");class Ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}Ts.prototype.bytesPerElement=8,Pr(Ts,"StructArrayLayout2f8");class Ss extends Ho{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ss.prototype.size=12;class Cs extends os{get(t){return new Ss(this,t)}}Pr(Cs,"FillExtrusionExtArray");class Es extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Es.prototype.size=40;class Is extends cs{get(t){return new Es(this,t)}}Pr(Is,"CollisionBoxArray");class Ms extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ms.prototype.size=60;class As extends ms{get(t){return new Ms(this,t)}}Pr(As,"PlacedSymbolArray");class ks extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ks.prototype.size=76;class Ps extends gs{get(t){return new ks(this,t)}}Pr(Ps,"SymbolInstanceArray");class Ls extends ys{getoffsetX(t){return this.float32[1*t+0]}}Pr(Ls,"GlyphOffsetArray");class zs extends Qo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Pr(zs,"SymbolLineVertexArray");class Ds extends Ho{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ds.prototype.size=12;class Rs extends xs{get(t){return new Ds(this,t)}}Pr(Rs,"FeatureIndexArray");class Os extends Ho{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Os.prototype.size=4;class Fs extends bs{get(t){return new Os(this,t)}}Pr(Fs,"FillExtrusionCentroidArray");class Ns extends Ho{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ns.prototype.size=12;class Bs extends os{get(t){return new Ns(this,t)}}Pr(Bs,"CircleGlobeExtArray");const js=Yo([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),$s=Yo([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Us=fe((function(t){t.exports=function(t,e){var i,n,r,o,s,a,l,c;for(n=t.length-(i=3&t.length),r=e,s=3432918353,a=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),Vs=fe((function(t){t.exports=function(t,e){for(var i,n=t.length,r=e^n,o=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),Gs=Us,qs=Vs;Gs.murmur3=Us,Gs.murmur2=qs;class Zs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(Ws(t)),this.positions.push(e,i,n)}getPositions(t){const e=Ws(t);let i=0,n=this.ids.length-1;for(;i<n;){const t=i+n>>1;this.ids[t]>=e?n=t:i=t+1}const r=[];for(;this.ids[i]===e;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return Hs(i,n,0,i.length-1),e&&e.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(t){const e=new Zs;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function Ws(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Gs(String(t))}function Hs(t,e,i,n){for(;i<n;){const r=t[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(t[o]<r);do{s--}while(t[s]>r);if(o>=s)break;Xs(t,o,s),Xs(e,3*o,3*s),Xs(e,3*o+1,3*s+1),Xs(e,3*o+2,3*s+2)}s-i<n-s?(Hs(t,e,i,s),i=s+1):(Hs(t,e,s+1,n),n=s)}}function Xs(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}Pr(Zs,"FeaturePositionMap");class Ys{constructor(t,e){this.gl=t.gl,this.location=e}}class Ks extends Ys{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Js extends Ys{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Qs extends Ys{constructor(t,e){super(t,e),this.current=ye.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ta=new Float32Array(16),ea=new Float32Array(9),ia=new Float32Array(4);function na(t){return[Zo(255*t.r,255*t.g),Zo(255*t.b,255*t.a)]}class ra{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new Qs(t,e):new Ks(t,e)}}class oa{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,i,n){const r="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new Js(t,e):new Ks(t,e)}}class sa{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,r,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new Po(0),e,{},r,n,o);this.paintVertexArray.resize(t),this._setPaintValue(s,t,a)}updatePaintArray(t,e,i,n,r){const o=this.expression.evaluate({zoom:0},i,n,void 0,r);this._setPaintValue(t,e,o)}_setPaintValue(t,e,i){if("color"===this.type){const n=na(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(t,e,i,n,r,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,n,r,o){const s=this.expression.evaluate(new Po(this.zoom),e,{},r,n,o),a=this.expression.evaluate(new Po(this.zoom+1),e,{},r,n,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(l,t,s,a)}updatePaintArray(t,e,i,n,r){const o=this.expression.evaluate({zoom:this.zoom},i,n,void 0,r),s=this.expression.evaluate({zoom:this.zoom+1},i,n,void 0,r);this._setPaintValue(t,e,o,s)}_setPaintValue(t,e,i,n){if("color"===this.type){const r=na(i),o=na(n);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=f(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(n)}getBinding(t,e,i){return new Ks(t,e)}}class la{constructor(t,e,i,n,r,o,s){this.expression=t,this.type=i,this.useIntegerZoom=n,this.zoom=r,this.layerId=s,this.paintVertexAttributes=("array"===i?$s:js).members;for(let t=0;t<e.length;++t);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(t,e,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,r,o){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(t,e,i,n){if(!n||!i)return;const{min:r,mid:o,max:s}=i,a=n[r],l=n[o],c=n[s];if(a&&l&&c)for(let i=t;i<e;i++)this._setPaintValue(this.zoomInPaintVertexArray,i,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,i,l,c)}_setPaintValue(t,e,i,n){t.emplace(e,i.tl[0],i.tl[1],i.br[0],i.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],i.pixelRatio,n.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ca{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in t.paint._values){if(!i(r))continue;const o=t.paint.get(r);if(!(o instanceof No&&bn(o.property.specification)))continue;const s=pa(r,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,p="line-dasharray"===String(r)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||p)if("source"===a.kind||p||h){const i=ma(r,l,"source");this.binders[r]=h?new la(a,s,l,c,e,i,t.id):new sa(a,s,l,i),n.push(`/a_${r}`)}else{const t=ma(r,l,"composite");this.binders[r]=new aa(a,s,l,c,e,t),n.push(`/z_${r}`)}else this.binders[r]=h?new oa(a.value,s):new ra(a.value,s,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof sa||e instanceof aa?e.maxValue:0}populatePaintArrays(t,e,i,n,r,o){for(const s in this.binders){const a=this.binders[s];(a instanceof sa||a instanceof aa||a instanceof la)&&a.populatePaintArray(t,e,i,n,r,o)}}setConstantPatternPositions(t,e){for(const i in this.binders){const n=this.binders[i];n instanceof oa&&n.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,n,r,o){let s=!1;for(const a in t){const l=e.getPositions(a);for(const e of l){const l=i.feature(e.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof sa||c instanceof aa||c instanceof la)&&!0===c.expression.isStateDependent){const u=n.paint.get(i);c.expression=u.value,c.updatePaintArray(e.start,e.end,l,t[a],r,o),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ra||i instanceof oa)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof sa||i instanceof aa||i instanceof la)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof ra||i instanceof oa||i instanceof aa)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof ra||r instanceof oa||r instanceof aa)for(const o of r.uniformNames)if(e[o]){const s=r.getBinding(t,e[o],o);i.push({name:o,property:n,binding:s})}}return i}setUniforms(t,e,i,n){for(const{name:t,property:r,binding:o}of e)this.binders[r].setUniform(o,n,i.get(r),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof la){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof sa||i instanceof aa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof sa||i instanceof aa||i instanceof la)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof sa||e instanceof aa||e instanceof la)&&e.destroy()}}}class ua{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new ca(n,e,i);this.needsUpload=!1,this._featureMap=new Zs,this._bufferOffset=0}populatePaintArrays(t,e,i,n,r,o,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,r,o,s);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n,r){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,n,r)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const ha={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function pa(t,e){return ha[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const da={"line-pattern":{source:ns,composite:ns},"fill-pattern":{source:ns,composite:ns},"fill-extrusion-pattern":{source:ns,composite:ns},"line-dasharray":{source:rs,composite:rs}},fa={color:{source:Ts,composite:is},number:{source:ys,composite:Ts}};function ma(t,e,i){const n=da[t];return n&&n[i]||fa[e][i]}Pr(ra,"ConstantBinder"),Pr(oa,"CrossFadedConstantBinder"),Pr(sa,"SourceExpressionBinder"),Pr(la,"CrossFadedCompositeBinder"),Pr(aa,"CompositeExpressionBinder"),Pr(ca,"ProgramConfiguration",{omit:["_buffers"]}),Pr(ua,"ProgramConfigurationSet");const ga="-transition";class ya extends Vt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Fo(e.layout)),e.paint)){this._transitionablePaint=new Do(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bo(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(Cr,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return E(t,ga)?this._transitionablePaint.getTransition(t.slice(0,-ga.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Sr,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(E(t,ga))return this._transitionablePaint.setTransition(t.slice(0,-ga.length),e||void 0),!1;{const i=this._transitionablePaint._values[t],n="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||r||n||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),M(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,n,r={}){return(!r||!1!==r.validate)&&Ir(this,t.call(Tr,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:Gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof No&&bn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Yn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _a=Yo([{name:"a_pos",components:2,type:"Int16"}],4),va=Yo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xa{constructor(t=[]){this.segments=t}prepareSegment(t,e,i,n){let r=this.segments[this.segments.length-1];return t>xa.MAX_VERTEX_ARRAY_LENGTH&&P(`Max vertices per segment is ${xa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!r||r.vertexLength+t>xa.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new xa([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}xa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pr(xa,"SegmentVector");var ba=8192;class wa{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Sa?new Sa(t.lng,t.lat):Sa.convert(t),this}setSouthWest(t){return this._sw=t instanceof Sa?new Sa(t.lng,t.lat):Sa.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,r;if(t instanceof Sa)n=t,r=t;else{if(!(t instanceof wa))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(wa.convert(t)):this.extend(Sa.convert(t)):this;if(n=t._sw,r=t._ne,!n||!r)return this}return e||i?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new Sa(n.lng,n.lat),this._ne=new Sa(r.lng,r.lat)),this}getCenter(){return new Sa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sa(this.getWest(),this.getNorth())}getSouthEast(){return new Sa(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=Sa.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(t){return!t||t instanceof wa?t:new wa(t)}}const Ta=6371008.8;class Sa{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sa(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return Ta*Math.acos(Math.min(r,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new wa(new Sa(this.lng-i,this.lat-e),new Sa(this.lng+i,this.lat+e))}static convert(t){if(t instanceof Sa)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Sa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Sa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ca=2*Math.PI*Ta;function Ea(t){return Ca*Math.cos(t*Math.PI/180)}function Ia(t){return(180+t)/360}function Ma(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Aa(t,e){return t/Ea(e)}function ka(t){return 360*t-180}function Pa(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function La(t,e){return t*Ea(Pa(e))}const za=85.051129;class Da{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=Sa.convert(t);return new Da(Ia(i.lng),Ma(i.lat),Aa(e,i.lat))}toLngLat(){return new Sa(ka(this.x),Pa(this.y))}toAltitude(){return La(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ca*(t=Pa(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ra(t,e,i,n,o,s,a,l,c){const u=(e+n)/2,h=(i+o)/2,p=new r(u,h);l(p),function(t,e,i,n,r,o){const s=i-r,a=n-o;return Math.abs((n-e)*s-(i-t)*a)/Math.hypot(s,a)}(p.x,p.y,s.x,s.y,a.x,a.y)>=c?(Ra(t,e,i,u,h,s,p,l,c),Ra(t,u,h,n,o,p,a,l,c)):t.push(a)}function Oa(t,e,i){let n=t[0],r=n.x,o=n.y;e(n);const s=[n];for(let a=1;a<t.length;a++){const l=t[a],{x:c,y:u}=l;e(l),Ra(s,r,o,c,u,n,l,e,i),r=c,o=u,n=l}return s}function Fa(t,e,i,n,r){if(r(e,i)){const o=e.add(i).mult(.5);n(o),Fa(t,e,o,n,r),Fa(t,o,i,n,r)}else t.push(i)}function Na(t,e,i){let n=t[0];e(n);const r=[n];for(let o=1;o<t.length;o++){const s=t[o];e(s),Fa(r,n,s,e,i),n=s}return r}const Ba=Math.pow(2,14)-1,ja=-Ba-1;function $a(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=f(i,ja,Ba),t.y=f(n,ja,Ba),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&P("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ua(t,e,i){const n=t.loadGeometry(),r=t.extent,o=ba/r;if(e&&i&&i.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:l,projection:c}=i,u=t=>{const i=ka((e.x+t.x/r)/o),n=Pa((e.y+t.y/r)/o),u=c.project(i,n);t.x=(u.x*s-a)*r,t.y=(u.y*s-l)*r};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Oa(n[e],u,1);else{const t=[];for(const i of n[e])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),t.push(i));n[e]=t}}for(const t of n)for(const e of t)$a(e,o);return n}function Va(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ua(t):[]}}function Ga(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}function qa(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class Za{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Jo,this.indexArray=new fs,this.segments=new xa,this.programConfigurations=new ua(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,n){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:e,id:r,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Va(e,t);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:r,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ua(e,i,n),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Bs,a=n.projection);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n,l=t[o].feature;this.addFeature(n,r,o,e.availableImages,i,a),e.featureIndex.insert(l,r,o,s,this.index)}}update(t,e,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_a.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,va.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,n,r,o){for(const i of e)for(const e of i){const i=e.x,n=e.y;if(i<0||i>=ba||n<0||n>=ba)continue;if(o){const t=o.projectTilePoint(i,n,r),e=o.upVector(r,i,n),s=this.globeExtVertexArray;qa(s,t,e),qa(s,t,e),qa(s,t,e),qa(s,t,e)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;Ga(this.layoutVertexArray,i,n,-1,-1),Ga(this.layoutVertexArray,i,n,1,-1),Ga(this.layoutVertexArray,i,n,1,1),Ga(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n,r)}}function Wa(t,e){for(let i=0;i<t.length;i++)if(il(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(il(t,e[i]))return!0;return!!Ka(t,e)}function Ha(t,e,i){return!!il(t,e)||!!Qa(e,t,i)}function Xa(t,e){if(1===t.length)return el(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(il(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(el(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ka(t,e[i]))return!0;return!1}function Ya(t,e,i){if(t.length>1){if(Ka(t,e))return!0;for(let n=0;n<e.length;n++)if(Qa(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(Qa(t[n],e,i))return!0;return!1}function Ka(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)if(Ja(n,r,e[t],e[t+1]))return!0}return!1}function Ja(t,e,i,n){return L(t,i,n)!==L(e,i,n)&&L(t,e,i)!==L(t,e,n)}function Qa(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(tl(t,e[i-1],e[i])<n)return!0;return!1}function tl(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function el(t,e){let i,n,r,o=!1;for(let s=0;s<t.length;s++){i=t[s];for(let t=0,s=i.length-1;t<i.length;s=t++)n=i[t],r=i[s],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function il(t,e){let i=!1;for(let n=0,r=t.length-1;n<t.length;r=n++){const o=t[n],s=t[r];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function nl(t,e,i,n,o){for(const r of t)if(e<=r.x&&i<=r.y&&n>=r.x&&o>=r.y)return!0;const s=[new r(e,i),new r(e,o),new r(n,o),new r(n,i)];if(t.length>2)for(const e of s)if(il(t,e))return!0;for(let e=0;e<t.length-1;e++)if(rl(t[e],t[e+1],s))return!0;return!1}function rl(t,e,i){const n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;const o=L(t,e,i[0]);return o!==L(t,e,i[1])||o!==L(t,e,i[2])||o!==L(t,e,i[3])}function ol(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function sl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function al(t,e,i,n,o){if(!e[0]&&!e[1])return t;const s=r.convert(e)._mult(o);"viewport"===i&&s._rotate(-n);const a=[];for(let e=0;e<t.length;e++)a.push(t[e].sub(s));return a}function ll(t,e,i,n){const o=r.convert(t)._mult(n);return"viewport"===e&&o._rotate(-i),o}Pr(Za,"CircleBucket",{omit:["layers"]});const cl=new qo({"circle-sort-key":new $o(Gt.layout_circle["circle-sort-key"])});var ul={paint:new qo({"circle-radius":new $o(Gt.paint_circle["circle-radius"]),"circle-color":new $o(Gt.paint_circle["circle-color"]),"circle-blur":new $o(Gt.paint_circle["circle-blur"]),"circle-opacity":new $o(Gt.paint_circle["circle-opacity"]),"circle-translate":new jo(Gt.paint_circle["circle-translate"]),"circle-translate-anchor":new jo(Gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jo(Gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jo(Gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $o(Gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $o(Gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $o(Gt.paint_circle["circle-stroke-opacity"])}),layout:cl},hl=1e-6,pl="undefined"!=typeof Float32Array?Float32Array:Array;function dl(){var t=new pl(9);return pl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function fl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ml(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*a+b*h+w*m,t[1]=v*r+x*l+b*p+w*g,t[2]=v*o+x*c+b*d+w*y,t[3]=v*s+x*u+b*f+w*_,t[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,t[5]=v*r+x*l+b*p+w*g,t[6]=v*o+x*c+b*d+w*y,t[7]=v*s+x*u+b*f+w*_,t[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,t[9]=v*r+x*l+b*p+w*g,t[10]=v*o+x*c+b*d+w*y,t[11]=v*s+x*u+b*f+w*_,t[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,t[13]=v*r+x*l+b*p+w*g,t[14]=v*o+x*c+b*d+w*y,t[15]=v*s+x*u+b*f+w*_,t}function gl(t,e,i){var n,r,o,s,a,l,c,u,h,p,d,f,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+a*g+h*y+e[12],t[13]=r*m+l*g+p*y+e[13],t[14]=o*m+c*g+d*y+e[14],t[15]=s*m+u*g+f*y+e[15]),t}function yl(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _l(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*n,t[5]=s*r+u*n,t[6]=a*r+h*n,t[7]=l*r+p*n,t[8]=c*r-o*n,t[9]=u*r-s*n,t[10]=h*r-a*n,t[11]=p*r-l*n,t}function vl(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*n,t[1]=s*r-u*n,t[2]=a*r-h*n,t[3]=l*r-p*n,t[8]=o*n+c*r,t[9]=s*n+u*r,t[10]=a*n+h*r,t[11]=l*n+p*r,t}function xl(t,e,i){var n,r,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<hl?null:(s*=c=1/c,a*=c,l*=c,n=Math.sin(e),r=Math.cos(e),t[0]=s*s*(o=1-r)+r,t[1]=a*s*o+l*n,t[2]=l*s*o-a*n,t[3]=0,t[4]=s*a*o-l*n,t[5]=a*a*o+r,t[6]=l*a*o+s*n,t[7]=0,t[8]=s*l*o+a*n,t[9]=a*l*o-s*n,t[10]=l*l*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var bl=ml;function wl(){var t=new pl(3);return pl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Tl(t){var e=new pl(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Sl(t){return Math.hypot(t[0],t[1],t[2])}function Cl(t,e,i){var n=new pl(3);return n[0]=t,n[1]=e,n[2]=i,n}function El(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Il(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ml(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Al(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function kl(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Pl(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Ll(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function zl(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Dl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Rl(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t}function Ol(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,t}function Fl(t,e,i){var n=i[0],r=i[1],o=i[2],s=e[0],a=e[1],l=e[2],c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,p=r*h-o*u,d=o*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,d*=2,f*=2,t[0]=s+(c*=m)+(p*=2),t[1]=a+u+d,t[2]=l+h+f,t}var Nl,Bl=Il,jl=Ml,$l=Sl;function Ul(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Vl(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t}function Gl(){var t=new pl(4);return pl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ql(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Zl(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+s*a,t[1]=r*l+o*a,t[2]=o*l-r*a,t[3]=s*l-n*a,t}function Wl(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l-o*a,t[1]=r*l+s*a,t[2]=o*l+n*a,t[3]=s*l-r*a,t}wl(),Nl=new pl(4),pl!=Float32Array&&(Nl[0]=0,Nl[1]=0,Nl[2]=0,Nl[3]=0),wl(),Cl(1,0,0),Cl(0,1,0),Gl(),Gl(),dl();class Hl{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const n=Dl(e,this.dir);if(Math.abs(n)<1e-6)return!1;const r=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return i[0]=this.pos[0]+this.dir[0]*r,i[1]=this.pos[1]+this.dir[1]*r,i[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(t,e,i){if(function(t,e){var i=t[0],n=t[1],r=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(i-o)<=hl*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=hl*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=hl*Math.max(1,Math.abs(r),Math.abs(a))}(this.pos,t)||0===e)return i[0]=i[1]=i[2]=0,!1;const[n,r,o]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],l=this.pos[2]-t[2],c=n*n+r*r+o*o,u=2*(s*n+a*r+l*o),h=u*u-4*c*(s*s+a*a+l*l-e*e);if(h<0){const t=Math.max(-u/2,0),c=s+n*t,h=a+r*t,p=l+o*t,d=Math.hypot(c,h,p);return i[0]=c*e/d,i[1]=h*e/d,i[2]=p*e/d,!1}{const t=(-u-Math.sqrt(h))/(2*c);if(t<0){const t=Math.hypot(s,a,l);return i[0]=s*e/t,i[1]=a*e/t,i[2]=l*e/t,!1}return i[0]=s+n*t,i[1]=a+r*t,i[2]=l+o*t,!0}}}class Xl{constructor(t,e,i,n,r){this.TL=t,this.TR=e,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(t,e,i){const n=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Ol(n,n,t),l=Ol(r,r,t),c=Ol(o,o,t),u=Ol(s,s,t);return new Xl(a,l,c,u,e/i)}}class Yl{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,e,i,n){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=Vl([],i,t),s=1/o[3]/e*r;return function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}(o,o,[s,s,n?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=zl([],Rl([],Bl([],o[t[0]],o[t[1]]),Bl([],o[t[2]],o[t[1]]))),i=-Dl(e,o[t[1]]);return e.concat(i)}));return new Yl(o,s)}}class Kl{constructor(t,e){this.min=t,this.max=e,this.center=Pl([],El([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],i=Tl(this.min),n=Tl(this.max);for(let t=0;t<e.length;t++)i[t]=e[t]?this.min[t]:this.center[t],n[t]=e[t]?this.center[t]:this.max[t];return n[2]=this.max[2],new Kl(i,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){const e=this.getCorners();let i=!0;for(let n=0;n<t.planes.length;n++){const r=t.planes[n];let o=0;for(let t=0;t<e.length;t++)o+=Dl(r,e[t])+r[3]>=0;if(0===o)return 0;o!==e.length&&(i=!1)}if(i)return 2;for(let e=0;e<3;e++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<t.points.length;r++){const o=t.points[r][e]-this.min[e];i=Math.min(i,o),n=Math.max(n,o)}if(n<0||i>this.max[e]-this.min[e])return 0}return 1}}function Jl(t,e,i,n,r,o,s,a,l){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(l*=t.pixelToTileUnitsFactor);const c=t.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of e)for(const e of h){const h=e.add(a),p=r&&i.elevation?i.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,d=i.projection.projectTilePoint(h.x,h.y,c);if(p>0){const t=i.projection.upVector(c,h.x,h.y);d.x+=t[0]*u*p,d.y+=t[1]*u*p,d.z+=t[2]*u*p}const f=o?h:Ql(d.x,d.y,d.z,n),m=o?t.tilespaceRays.map((t=>ic(t,p))):t.queryGeometry.screenGeometry,g=Vl([],[d.x,d.y,d.z,1],n);if(!s&&o?l*=g[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const t=Pa((e.y/ba+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(t,1)/Aa(1,t)}if(Ha(m,f,l))return!0}return!1}function Ql(t,e,i,n){const o=Vl([],[t,e,i,1],n);return new r(o[0]/o[3],o[1]/o[3])}const tc=Cl(0,0,0),ec=Cl(0,0,1);function ic(t,e){const i=wl();return tc[2]=e,t.intersectsPlane(tc,ec,i),new r(i[0],i[1])}class nc extends Za{}function rc(t,{width:e,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function oc(t,e,i){const{width:n,height:r}=e;n===t.width&&r===t.height||(sc(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,r)},i),t.width=n,t.height=r,t.data=e.data)}function sc(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((n.y+l)*e.width+n.x)*o;for(let t=0;t<r.width*o;t++)a[u+t]=s[c+t]}return e}Pr(nc,"HeatmapBucket",{omit:["layers"]});class ac{constructor(t,e){rc(this,t,1,e)}resize(t){oc(this,new ac(t),1)}clone(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){sc(t,e,i,n,r,1)}}class lc{constructor(t,e){rc(this,t,4,e)}resize(t){oc(this,new lc(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){sc(t,e,i,n,r,4)}}Pr(ac,"AlphaImage"),Pr(lc,"RGBAImage");var cc={paint:new qo({"heatmap-radius":new $o(Gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $o(Gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jo(Gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Go(Gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jo(Gt.paint_heatmap["heatmap-opacity"])})};function uc(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new lc({width:i,height:n}),o=(i,n,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,r=0;e<n;++e,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=t.clips[e];o(r,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return r}var hc={paint:new qo({"hillshade-illumination-direction":new jo(Gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jo(Gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jo(Gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jo(Gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jo(Gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jo(Gt.paint_hillshade["hillshade-accent-color"])})};const pc=Yo([{name:"a_pos",components:2,type:"Int16"}],4),{members:dc}=pc;var fc=gc,mc=gc;function gc(t,e,i){i=i||2;var n,r,o,s,a,l,c,u=e&&e.length,h=u?e[0]*i:t.length,p=yc(t,0,h,i,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,i,n){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=yc(t,e[r]*n,r<o-1?e[r+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(Mc(s));for(a.sort(Sc),r=0;r<a.length;r++)i=_c(i=Cc(a[r],i),i.next);return i}(t,e,p,i)),t.length>80*i){n=o=t[0],r=s=t[1];for(var f=i;f<h;f+=i)(a=t[f])<n&&(n=a),(l=t[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-r))?1/c:0}return vc(p,d,i,n,r,c),d}function yc(t,e,i,n,r){var o,s;if(r===$c(t,e,i,n)>0)for(o=e;o<i;o+=n)s=Nc(o,t[o],t[o+1],s);else for(o=i-n;o>=e;o-=n)s=Nc(o,t[o],t[o+1],s);return s&&Lc(s,s.next)&&(Bc(s),s=s.next),s}function _c(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!Lc(n,n.next)&&0!==Pc(n.prev,n,n.next))n=n.next;else{if(Bc(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function vc(t,e,i,n,r,o,s){if(t){!s&&o&&function(t,e,i,n){var r=t;do{null===r.z&&(r.z=Ic(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,l,c=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(t,n,r,o);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,o?bc(t,n,r,o):xc(t))e.push(a.i/i),e.push(t.i/i),e.push(l.i/i),Bc(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?vc(t=wc(_c(t),e,i),e,i,n,r,o,2):2===s&&Tc(t,e,i,n,r,o):vc(_c(t),e,i,n,r,o,1);break}}}function xc(t){var e=t.prev,i=t,n=t.next;if(Pc(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(Ac(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Pc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function bc(t,e,i,n){var r=t.prev,o=t,s=t.next;if(Pc(r,o,s)>=0)return!1;for(var a=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,l=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,c=Ic(r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,e,i,n),u=Ic(a,l,e,i,n),h=t.prevZ,p=t.nextZ;h&&h.z>=c&&p&&p.z<=u;){if(h!==t.prev&&h!==t.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Pc(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Pc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Pc(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=u;){if(p!==t.prev&&p!==t.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Pc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function wc(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!Lc(r,o)&&zc(r,n,n.next,o)&&Oc(r,o)&&Oc(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),Bc(n),Bc(n.next),n=t=o),n=n.next}while(n!==t);return _c(n)}function Tc(t,e,i,n,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&kc(s,a)){var l=Fc(s,a);return s=_c(s,s.next),l=_c(l,l.next),vc(s,e,i,n,r,o),void vc(l,e,i,n,r,o)}a=a.next}s=s.next}while(s!==t)}function Sc(t,e){return t.x-e.x}function Cc(t,e){var i=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s){if(s=a,a===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i;var l,c=i,u=i.x,h=i.y,p=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&Ac(o<h?r:s,o,u,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Oc(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&Ec(i,n)))&&(i=n,p=l)),n=n.next}while(n!==c);return i}(t,e);if(!i)return e;var n=Fc(i,t),r=_c(i,i.next);return _c(n,n.next),e===i?r:e}function Ec(t,e){return Pc(t.prev,t,e.prev)<0&&Pc(e.next,t,t.next)<0}function Ic(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Mc(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Ac(t,e,i,n,r,o,s,a){return(r-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function kc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&zc(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Oc(t,e)&&Oc(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Pc(t.prev,t,e.prev)||Pc(t,e.prev,e))||Lc(t,e)&&Pc(t.prev,t,t.next)>0&&Pc(e.prev,e,e.next)>0)}function Pc(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Lc(t,e){return t.x===e.x&&t.y===e.y}function zc(t,e,i,n){var r=Rc(Pc(t,e,i)),o=Rc(Pc(t,e,n)),s=Rc(Pc(i,n,t)),a=Rc(Pc(i,n,e));return r!==o&&s!==a||!(0!==r||!Dc(t,i,e))||!(0!==o||!Dc(t,n,e))||!(0!==s||!Dc(i,t,n))||!(0!==a||!Dc(i,e,n))}function Dc(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Rc(t){return t>0?1:t<0?-1:0}function Oc(t,e){return Pc(t.prev,t,t.next)<0?Pc(t,e,t.next)>=0&&Pc(t,t.prev,e)>=0:Pc(t,e,t.prev)<0||Pc(t,t.next,e)<0}function Fc(t,e){var i=new jc(t.i,t.x,t.y),n=new jc(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Nc(t,e,i,n){var r=new jc(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Bc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jc(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $c(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}function Uc(t,e,i,n,r){Vc(t,e,i||0,n||t.length-1,r||qc)}function Vc(t,e,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Vc(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(n,Math.floor(e+(o-s)*l/o+c)),r)}var u=t[e],h=i,p=n;for(Gc(t,i,e),r(t[n],u)>0&&Gc(t,i,n);h<p;){for(Gc(t,h,p),h++,p--;r(t[h],u)<0;)h++;for(;r(t[p],u)>0;)p--}0===r(t[i],u)?Gc(t,i,p):Gc(t,++p,n),p<=e&&(i=p+1),e<=p&&(n=p-1)}}function Gc(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function qc(t,e){return t<e?-1:t>e?1:0}function Zc(t,e){const i=t.length;if(i<=1)return[t];const n=[];let r,o;for(let e=0;e<i;e++){const i=z(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[t[e]]):r.push(t[e]))}if(r&&n.push(r),e>1)for(let t=0;t<n.length;t++)n[t].length<=e||(Uc(n[t],e,1,n[t].length-1,Wc),n[t]=n[t].slice(0,e));return n}function Wc(t,e){return e.area-t.area}function Hc(t,e,i){const n=i.patternDependencies;let r=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const o=e.constantOr(null);o&&(r=!0,n[o.to]=!0,n[o.from]=!0)}return r}function Xc(t,e,i,n,r){const o=r.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n-1},i,{},r.availableImages),a=e.evaluate({zoom:n},i,{},r.availableImages),l=e.evaluate({zoom:n+1},i,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}gc.deviation=function(t,e,i,n){var r=e&&e.length,o=Math.abs($c(t,0,r?e[0]*i:t.length,i));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs($c(t,e[s]*i,s<a-1?e[s+1]*i:t.length,i));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,u=n[s+1]*i,h=n[s+2]*i;l+=Math.abs((t[c]-t[h])*(t[u+1]-t[c+1])-(t[c]-t[u])*(t[h+1]-t[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},gc.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);r>0&&i.holes.push(n+=t[r-1].length)}return i},fc.default=mc;class Yc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jo,this.indexArray=new fs,this.indexArray2=new bs,this.programConfigurations=new ua(t.layers,t.zoom),this.segments=new xa,this.segments2=new xa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}populate(t,e,i,n){this.hasPattern=Hc("fill",this.layers,e);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Va(s,t);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,e.availableImages):void 0,p={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ua(s,i,n),patterns:{},sortKey:h};o.push(p)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=Xc("fill",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{},e.availableImages);e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,n)}addFeatures(t,e,i,n,r){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,r,o=[]){for(const t of Zc(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(n+e.length-1,n),r.push(e[0].x),r.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(n+t-1,n+t),r.push(e[t].x),r.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const s=fc(r,o);for(let t=0;t<s.length;t+=3)this.indexArray.emplaceBack(n+s[t],n+s[t+1],n+s[t+2]);i.vertexLength+=e,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o,n)}}Pr(Yc,"FillBucket",{omit:["layers","patternFeatures"]});const Kc=new qo({"fill-sort-key":new $o(Gt.layout_fill["fill-sort-key"])});var Jc={paint:new qo({"fill-antialias":new jo(Gt.paint_fill["fill-antialias"]),"fill-opacity":new $o(Gt.paint_fill["fill-opacity"]),"fill-color":new $o(Gt.paint_fill["fill-color"]),"fill-outline-color":new $o(Gt.paint_fill["fill-outline-color"]),"fill-translate":new jo(Gt.paint_fill["fill-translate"]),"fill-translate-anchor":new jo(Gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uo(Gt.paint_fill["fill-pattern"])}),layout:Kc};const Qc=Yo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tu=Yo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eu=Yo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iu}=Qc;var nu=ru;function ru(t,e,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=r,t.readFields(ou,this,e)}function ou(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function su(t){for(var e,i,n=0,r=0,o=t.length,s=o-1;r<o;s=r++)n+=((i=t[s]).x-(e=t[r]).x)*(e.y+i.y);return n}ru.types=["Unknown","Point","LineString","Polygon"],ru.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<i;){if(o<=0){var c=t.readVarint();n=7&c,o=c>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&l.push(e),e=[]),e.push(new r(s,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&l.push(e),l},ru.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},ru.prototype.toGeoJSON=function(t,e,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*t,a=this.extent*e,l=this.loadGeometry(),c=ru.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],o=0;o<e;o++){var s=su(t[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[t[o]]):i.push(t[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var p={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var au=lu;function lu(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(cu,this,e),this.length=this._features.length}function cu(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}function uu(t,e,i){if(3===t){var n=new au(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}lu.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new nu(this._pbf,e,this.extent,this._keys,this._values)};var hu={VectorTile:function(t,e){this.layers=t.readFields(uu,{},e)},VectorTileFeature:nu,VectorTileLayer:au};function pu(t,e,i,n){const o=[],s=0===n?(t,e,i,n,o,s)=>{t.push(new r(s,i+(s-e)/(n-e)*(o-i)))}:(t,e,i,n,o,s)=>{t.push(new r(e+(s-i)/(o-i)*(n-e),s))};for(const r of t){const t=[];for(const o of r){if(o.length<=2)continue;const r=[];for(let t=0;t<o.length-1;t++){const a=o[t].x,l=o[t].y,c=o[t+1].x,u=o[t+1].y,h=0===n?a:l,p=0===n?c:u;h<e?p>e&&s(r,a,l,c,u,e):h>i?p<i&&s(r,a,l,c,u,i):r.push(o[t]),p<e&&h>=e&&s(r,a,l,c,u,e),p>i&&h<=i&&s(r,a,l,c,u,i)}let a=o[o.length-1];const l=0===n?a.x:a.y;l>=e&&l<=i&&r.push(a),r.length&&(a=r[r.length-1],r[0].x===a.x&&r[0].y===a.y||r.push(r[0]),t.push(r))}t.length&&o.push(t)}return o}const du=hu.VectorTileFeature.types,fu=Math.pow(2,13);function mu(t,e,i,n,r,o,s,a){t.emplaceBack((e<<1)+s,(i<<1)+o,(Math.floor(n*fu)<<1)+r,Math.round(a))}function gu(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class yu{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(t.x,t.y),this.max=new r(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);const i=this.min,n=this.max;t.x<i.x?i.x=t.x:t.x>n.x&&(n.x=t.x),t.y<i.y?i.y=t.y:t.y>n.y&&(n.y=t.y),((0===t.x||t.x===ba)&&t.x===e.x)!=((0===t.y||t.y===ba)&&t.y===e.y)&&this.processBorderOverlap(t,e),e.x<0!=t.x<0&&this.addBorderIntersection(0,yi(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>ba!=t.x>ba&&this.addBorderIntersection(1,yi(e.y,t.y,(ba-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,yi(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>ba!=t.y>ba&&this.addBorderIntersection(3,yi(e.x,t.x,(ba-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){const t=this.polyCount.reduce(((t,e)=>t+e.edges),0);return 0!==t?this.acc.div(t)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0)}}class _u{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ts,this.centroidVertexArray=new Fs,this.indexArray=new fs,this.programConfigurations=new ua(t.layers,t.zoom),this.segments=new xa,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.enableTerrain=t.enableTerrain}populate(t,e,i,n){this.features=[],this.hasPattern=Hc("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/ba/(1<<t.z)}(i);for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=Va(r,t);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:t?l.geometry:Ua(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Xc("fill-extrusion",this.layers,c,this.zoom,e)):this.addFeature(c,c.geometry,s,i,{},e.availableImages,n),e.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(t,e,i,n,r){for(const t of this.features){const{geometry:o}=t;this.addFeature(t,o,t.index,e,i,n,r)}this.sortBorders()}update(t,e,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,eu.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,tu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,o,s,a){const l=[new r(0,0),new r(ba,ba)],c=a.projection,u="globe"===c.name,h=this.enableTerrain&&!u?new yu:null;u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cs);const p=Zc(e,500);for(let t=p.length-1;t>=0;t--){const e=p[t];(0===e.length||(d=e[0]).every((t=>t.x<=0))||d.every((t=>t.x>=ba))||d.every((t=>t.y<=0))||d.every((t=>t.y>=ba)))&&p.splice(t,1)}var d;let f;if(u)f=bu(p,l,n);else{f=[];for(const t of p)f.push({polygon:t,bounds:l})}for(const e of f){const i=e.polygon;let r=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t=0;t<i.length;t++){const s=i[t];if(0===s.length)continue;r+=s.length;let a=0;h&&h.startRing(s[0]);for(let t=0;t<s.length;t++){const i=s[t];if(t>=1){const r=s[t-1];if(!vu(i,r,e.bounds)){h&&h.append(i,r),o.vertexLength+4>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=i.sub(r)._perp(),e=t.x/(Math.abs(t.x)+Math.abs(t.y)),s=t.y>0?1:0,l=r.dist(i);a+l>32768&&(a=0),mu(this.layoutVertexArray,i.x,i.y,e,s,0,0,a),mu(this.layoutVertexArray,i.x,i.y,e,s,0,1,a),a+=l,mu(this.layoutVertexArray,r.x,r.y,e,s,0,0,a),mu(this.layoutVertexArray,r.x,r.y,e,s,0,1,a);const p=o.vertexLength;if(this.indexArray.emplaceBack(p,p+2,p+1),this.indexArray.emplaceBack(p+1,p+2,p+3),o.vertexLength+=4,o.primitiveLength+=2,u){const t=this.layoutVertexExtArray,e=c.projectTilePoint(i.x,i.y,n),o=c.projectTilePoint(r.x,r.y,n),s=c.upVector(n,i.x,i.y),a=c.upVector(n,r.x,r.y);gu(t,e,s),gu(t,e,s),gu(t,o,a),gu(t,o,a)}}}}}if(o.vertexLength+r>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray)),"Polygon"!==du[t.type])continue;const s=[],a=[],l=o.vertexLength;for(let t=0;t<i.length;t++){const e=i[t];if(0!==e.length){e!==i[0]&&a.push(s.length/2);for(let t=0;t<e.length;t++){const i=e[t];mu(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),s.push(i.x),s.push(i.y),h&&h.currentPolyCount.top++,u&&gu(this.layoutVertexExtArray,c.projectTilePoint(i.x,i.y,n),c.upVector(n,i.x,i.y))}}}const p=fc(s,a);for(let t=0;t<p.length;t+=3)this.indexArray.emplaceBack(l+p[t],l+p[t+2],l+p[t+1]);o.primitiveLength+=p.length/3,o.vertexLength+=r}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;const t=h.borders,e=this.featuresOnBorder.push(h)-1;for(let i=0;i<4;i++)t[i][0]!==Number.MAX_VALUE&&this.borders[i].push(e)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,o,s,n)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}encodeCentroid(t,e,i=!0){let n,r;if(t)if(0!==t.y){const i=e.span()._mult(this.tileToMeter);n=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else n=Math.ceil(7*(t.x+450)),r=0;else n=0,r=+i;let o=i?this.centroidVertexArray.length:e.vertexArrayOffset;for(const t of e.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*t.edges+t.top);for(let e=0;e<2*t.edges;e++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,n,r);for(let e=0;e<t.top;e++)this.centroidVertexArray.emplace(o++,n,r)}}}function vu(t,e,i){return t.x===e.x&&(t.x<i[0].x||t.x>i[1].x)||t.y===e.y&&(t.y<i[0].y||t.y>i[1].y)}function xu(){const t=Math.PI/32,e=Math.tan(t),i=Ta;return i*Math.sqrt(1+2*e*e)-i}function bu(t,e,i){const n=1<<i.z,o=ka(i.x/n),s=ka((i.x+1)/n),a=Pa(i.y/n),l=Pa((i.y+1)/n);return function(t,e,i,n,o,s){const a=[];if(!t.length||!i||!n)return a;const l=(t,e)=>{for(const i of t)a.push({polygon:i,bounds:e})},c=Math.ceil(Math.log2(i)),u=Math.ceil(Math.log2(n)),h=c-u,p=[];for(let t=0;t<Math.abs(h);t++)p.push(h>0?0:1);for(let t=0;t<Math.min(c,u);t++)p.push(0),p.push(1);let d=t;if(d=pu(d,e[0].y-o,e[1].y+o,1),d=pu(d,e[0].x-o,e[1].x+o,0),!d.length)return a;const f=[];for(p.length?f.push({polygons:d,bounds:e,depth:0}):l(d,e);f.length;){const t=f.pop(),e=t.depth,i=p[e],n=t.bounds[0],a=t.bounds[1],c=0===i?n.x:n.y,u=0===i?a.x:a.y,h=s?s(i,c,u):.5*(c+u),d=pu(t.polygons,c-o,h+o,i),m=pu(t.polygons,h-o,u+o,i);if(d.length){const t=[n,new r(0===i?h:a.x,1===i?h:a.y)];p.length>e+1?f.push({polygons:d,bounds:t,depth:e+1}):l(d,t)}if(m.length){const t=[new r(0===i?h:n.x,1===i?h:n.y),a];p.length>e+1?f.push({polygons:m,bounds:t,depth:e+1}):l(m,t)}}return a}(t,e,Math.ceil((s-o)/11.25),Math.ceil((a-l)/11.25),1,((t,e,r)=>{if(0===t)return.5*(e+r);{const t=Pa((i.y+e/ba)/n);return(Ma(.5*(Pa((i.y+r/ba)/n)+t))*n-i.y)*ba}}))}Pr(_u,"FillExtrusionBucket",{omit:["layers","features"]}),Pr(yu,"PartMetadata");var wu={paint:new qo({"fill-extrusion-opacity":new jo(Gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $o(Gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jo(Gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jo(Gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uo(Gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $o(Gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $o(Gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jo(Gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tu(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Su{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Iu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=function(t,e,i){var n=Tu(256*t,256*(e=Math.pow(2,i)-e-1),i),r=Tu(256*(t+1),256*(e+1),i);return n[0]+","+n[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),n=function(t,e,i){let n,r="";for(let o=t;o>0;o--)n=1<<o-1,r+=(e&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Iu(t,e.z,e.z,e.x,e.y)}}class Eu{constructor(t,e,i,n,r){this.overscaledZ=t,this.wrap=e,this.canonical=new Su(i,+n,+r),this.key=0===e&&t===i?this.canonical.key:Iu(e,t,i,n,r)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Eu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Eu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Iu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return Iu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Eu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Eu(e,this.wrap,e,i,n),new Eu(e,this.wrap,e,i+1,n),new Eu(e,this.wrap,e,i,n+1),new Eu(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Eu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Eu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Iu(t,e,i,n,r){const o=1<<Math.min(i,22);let s=o*(r%o)+n%o;return t&&i<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*s+i)+(e-i)}function Mu(t,e){return t.x*e.x+t.y*e.y}function Au(t,e){if(1===t.length){let i=0;const n=e[i++];let r;for(;!r||n.equals(r);)if(r=e[i++],!r)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=Mu(a,a),h=Mu(a,l),p=Mu(l,l),d=Mu(c,a),f=Mu(c,l),m=u*p-h*h,g=(p*d-h*f)/m,y=(u*f-h*d)/m,_=n.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function ku(t){const e=new r(t[0],t[1]);return e.z=t[2],e}function Pu(t,e,i,n,r,o,s,a){const l=s*r.getElevationAt(t,e,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(t,e,i){const n=Math.floor(e[0]/8),r=Math.floor(e[1]/8),o=10*(e[0]-8*n),s=10*(e[1]-8*r),a=t.getElevationAt(n,r,!0,!0),l=t.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=t.tileCoordToPixel(n,r),p=2*c+1,d=2*u+1,f=function(t,e,i,n,r){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+r,i,!0),t.getElevationAtPixel(e,i+r,!0),t.getElevationAtPixel(e+n,i+r,!0)]}(t,h.x-c,h.y-u,p,d),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(m+g)/p),v=Math.min(.25,.5*l*y/d);return a+Math.max(_*o,v*s)}(r,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}Pr(Su,"CanonicalTileID"),Pr(Eu,"OverscaledTileID",{omit:["projMatrix"]});const Lu=Yo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:zu}=Lu,Du=Yo([{name:"a_packed",components:4,type:"Float32"}]),{members:Ru}=Du,Ou=hu.VectorTileFeature.types,Fu=Math.cos(Math.PI/180*37.5);class Nu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new es,this.layoutVertexArray2=new is,this.indexArray=new fs,this.programConfigurations=new ua(t.layers,t.zoom),this.segments=new xa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i,n){this.hasPattern=Hc("line",this.layers,e);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Va(e,t);if(!this.layers[0]._featureFilter.filter(new Po(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ua(e,i,n),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:s,featureIndex:a}=e,l=this.addConstantDashes(s);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,s),this.hasPattern){const t=Xc("line",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,s.positions,e.availableImages);a.insert(t[o].feature,r,o,c,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)e=!0;else{const e=r.value,i=n.value;if(!i)continue;t.addDash(i.from,e),t.addDash(i.to,e),i.other&&t.addDash(i.other,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a,l,c,u,h;if("constant"===r.kind){const t=r.value;if(!t)continue;s=t.other||t.to,a=t.to,l=t.from}else s=r.evaluate({zoom:i-1},t),a=r.evaluate({zoom:i},t),l=r.evaluate({zoom:i+1},t);"constant"===o.kind?c=u=h=o.value:(c=o.evaluate({zoom:i-1},t),u=o.evaluate({zoom:i},t),h=o.evaluate({zoom:i+1},t)),e.addDash(s,c),e.addDash(a,u),e.addDash(l,h);const p=e.getKey(s,c),d=e.getKey(a,u),f=e.getKey(l,h);t.patterns[n.id]={min:p,mid:d,max:f}}}update(t,e,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i,n)}addFeatures(t,e,i,n,r){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ru)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,r,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(t,{}),l=s.get("line-cap").evaluate(t,{}),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,a,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,o,n)}addLine(t,e,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ou[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let l=0;for(;l<a-1&&t[l].equals(t[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,p,d,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[l].sub(h)._unit()._perp());for(let e=l;e<a;e++){if(d=e===a-1?s?t[l+1]:void 0:t[e+1],d&&t[e].equals(d))continue;m&&(f=m),h&&(p=h),h=t[e],m=d?d.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,_=g.x*m.x+g.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Fu&&p&&d,w=f.x*m.y-f.y*m.x>0;if(b&&e>l){const t=h.dist(p);if(t>2*c){const e=h.sub(h.sub(p)._mult(c/t)._round());this.updateDistance(p,e),this.addCurrentVertex(e,f,0,0,u),p=e}}const T=p&&d;let S=T?i:s?"butt":n;if(T&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),p&&this.updateDistance(p,h),"miter"===S)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(v>100)g=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(v*v-1),e=w?t:0,i=w?0:t;if(p&&this.addCurrentVertex(h,f,e,i,u),"fakeround"===S){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*t*t+(.848013+y*(.215638*y-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}d&&this.addCurrentVertex(h,m,-e,-i,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const t=p?1:-1;p||this.addCurrentVertex(h,g,t,t,u),this.addCurrentVertex(h,g,0,0,u),p&&this.addCurrentVertex(h,g,t,t,u)}else"round"===S&&(p&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),d&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&e<a-1){const t=h.dist(d);if(t>2*c){const e=h.add(d.sub(h)._mult(c/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,i,n,r,o=!1){const s=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,r),this.addHalfVertex(t,s,a,o,!0,-n,r)}addHalfVertex({x:t,y:e},i,n,r,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}Pr(Nu,"LineBucket",{omit:["layers","patternFeatures"]});const Bu=new qo({"line-cap":new $o(Gt.layout_line["line-cap"]),"line-join":new $o(Gt.layout_line["line-join"]),"line-miter-limit":new jo(Gt.layout_line["line-miter-limit"]),"line-round-limit":new jo(Gt.layout_line["line-round-limit"]),"line-sort-key":new $o(Gt.layout_line["line-sort-key"])});var ju={paint:new qo({"line-opacity":new $o(Gt.paint_line["line-opacity"]),"line-color":new $o(Gt.paint_line["line-color"]),"line-translate":new jo(Gt.paint_line["line-translate"]),"line-translate-anchor":new jo(Gt.paint_line["line-translate-anchor"]),"line-width":new $o(Gt.paint_line["line-width"]),"line-gap-width":new $o(Gt.paint_line["line-gap-width"]),"line-offset":new $o(Gt.paint_line["line-offset"]),"line-blur":new $o(Gt.paint_line["line-blur"]),"line-dasharray":new Uo(Gt.paint_line["line-dasharray"]),"line-pattern":new Uo(Gt.paint_line["line-pattern"]),"line-gradient":new Go(Gt.paint_line["line-gradient"]),"line-trim-offset":new jo(Gt.paint_line["line-trim-offset"])}),layout:Bu};const $u=new class extends $o{possiblyEvaluate(t,e){return e=new Po(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=v({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(ju.paint.properties["line-width"].specification);function Uu(t,e){return e>0?e+2*t:t}$u.useIntegerZoom=!0;const Vu=Yo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gu=Yo([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qu=Yo([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zu=Yo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wu=Yo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hu=Yo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xu=Yo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yo([{name:"triangle",components:3,type:"Uint16"}]),Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Yo([{type:"Float32",name:"offsetX"}]),Yo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Yu=24;const Ku=128;function Ju(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Po(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let o=r;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[r],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Po(s)),maxSize:i.evaluate(new Po(a)),interpolationType:n}}}function Qu(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===t.kind?n/Ku:"composite"===t.kind?yi(n/Ku,r/Ku,i):e}function th(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=t,a=r?f(Ni.interpolationFactor(r,e,o,s),0,1):0;"camera"===t.kind?n=yi(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var eh=Object.freeze({__proto__:null,getSizeData:Ju,evaluateSizeForFeature:Qu,evaluateSizeForZoom:th,SIZE_PACK_FACTOR:Ku});function ih(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),ko.applyArabicShaping&&(t=ko.applyArabicShaping(t)),t}(t.text,e,i)})),t}const nh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function rh(t){return"︶"===t||"﹈"===t||"︸"===t||"﹄"===t||"﹂"===t||"︾"===t||"︼"===t||"︺"===t||"︘"===t||"﹀"===t||"︐"===t||"︓"===t||"︔"===t||"｀"===t||"￣"===t||"︑"===t||"︒"===t}function oh(t){return"︵"===t||"﹇"===t||"︷"===t||"﹃"===t||"﹁"===t||"︽"===t||"︻"===t||"︹"===t||"︗"===t||"︿"===t}var sh=function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=c}return(d?-1:1)*s*Math.pow(2,o-n)},ah=function(t,e,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[i+d]=255&a,d+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m},lh=ch;function ch(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ch.Varint=0,ch.Fixed64=1,ch.Bytes=2,ch.Fixed32=5;var uh=4294967296,hh=1/uh,ph="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function dh(t){return t.type===ch.Bytes?t.readVarint()+t.pos:t.pos+1}function fh(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function mh(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function gh(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function yh(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function _h(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function vh(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function xh(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function bh(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function wh(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Th(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Sh(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Ch(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Eh(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ih(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Mh(t,e,i){e.glyphs=[],1===t&&i.readMessage(Ah,e)}function Ah(t,e,i){if(3===t){const{id:t,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(kh,{});e.glyphs.push({id:t,bitmap:new ac({width:r+6,height:o+6},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function kh(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function Ph(t){let e=0,i=0;for(const n of t)e+=n.w*n.h,i=Math.max(i,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,o=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const i=n[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),r=Math.max(r,e.x+e.w),e.w===i.w&&e.h===i.h){const e=n.pop();t<n.length&&(n[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(n.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}ch.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ch(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ih(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ch(this.buf,this.pos)+Ch(this.buf,this.pos+4)*uh;return this.pos+=8,t},readSFixed64:function(){var t=Ch(this.buf,this.pos)+Ih(this.buf,this.pos+4)*uh;return this.pos+=8,t},readFloat:function(){var t=sh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=sh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return fh(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return fh(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return fh(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return fh(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return fh(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return fh(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&ph?function(t,e,i){return ph.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var o,s,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==ch.Bytes)return t.push(this.readVarint(e));var i=dh(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==ch.Bytes)return t.push(this.readSVarint());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ch.Bytes)return t.push(this.readBoolean());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ch.Bytes)return t.push(this.readFloat());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ch.Bytes)return t.push(this.readDouble());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ch.Bytes)return t.push(this.readFixed32());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ch.Bytes)return t.push(this.readSFixed32());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ch.Bytes)return t.push(this.readFixed64());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ch.Bytes)return t.push(this.readSFixed64());var e=dh(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===ch.Varint)for(;this.buf[this.pos++]>127;);else if(e===ch.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ch.Fixed32)this.pos+=4;else{if(e!==ch.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Eh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Eh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Eh(this.buf,-1&t,this.pos),Eh(this.buf,Math.floor(t*hh),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Eh(this.buf,-1&t,this.pos),Eh(this.buf,Math.floor(t*hh),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&mh(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),ah(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ah(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&mh(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,ch.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,gh,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,yh,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,xh,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,_h,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,vh,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,bh,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,wh,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Th,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Sh,e)},writeBytesField:function(t,e){this.writeTag(t,ch.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,ch.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,ch.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,ch.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,ch.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,ch.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,ch.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,ch.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,ch.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,ch.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Lh{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class zh{constructor(t,e){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,n,r);const{w:o,h:s}=Ph(r),a=new lc({width:o||1,height:s||1});for(const e in t){const n=t[e],r=i[e].paddedRect;lc.copy(n.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},n.data)}for(const t in e){const i=e[t],r=n[t].paddedRect,o=r.x+1,s=r.y+1,l=i.data.width,c=i.data.height;lc.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),lc.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),lc.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),lc.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),lc.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(t,e,i){for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),e[n]=new Lh(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e))),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,r]=t.tl;i.update(e.data,void 0,{x:n,y:r})}}Pr(Lh,"ImagePosition"),Pr(zh,"ImageAtlas");const Dh={horizontal:1,vertical:2,horizontalOnly:3};class Rh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new Rh;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new Rh;return e.imageName=t,e}}class Oh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new Oh;for(let n=0;n<t.sections.length;n++){const r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n+1)||null,o=t.charCodeAt(n-1)||null;i+=!e&&(r&&mo(r)&&!nh[t[n+1]]||o&&mo(o)&&!nh[t[n-1]])||!nh[t[n]]?t[n]:nh[t[n]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&Nh[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&Nh[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new Oh;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Rh.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void P("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Rh.forImage(e)),this.sectionIndex.push(this.sections.length-1)):P("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fh(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m){const g=Oh.fromFeature(t,r);let y;h===Dh.vertical&&g.verticalizePunctuation(p);const{processBidirectionalText:_,processStyledBidirectionalText:v}=ko;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),qh(g,c,o,e,n,d,f));for(const e of t){const t=new Oh;t.text=e,t.sections=g.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,qh(g,c,o,e,n,d,f));for(const e of t){const t=new Oh;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const i=[],n=t.text;let r=0;for(const n of e)i.push(t.substring(r,n)),r=n;return r<n.length&&i.push(t.substring(r,n.length)),i}(g,qh(g,c,o,e,n,d,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,n,r,o,s,a,l,c,u,h){let p=0,d=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const t of r){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let y=0;for(const s of r){s.trim();const r=s.getMaxScale(),a=(r-1)*Yu,v={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=v;const x=v.positionedGlyphs;let b=0;if(!s.length()){d+=o,++y;continue}let w=0,T=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o);let y=a.scale,v=null,S=null,C=null,E=Yu,I=0;const M=!(l===Dh.horizontal||!u&&!fo(m)||u&&(Nh[m]||(_=m,Fr(_)||Nr(_)||Br(_)||ro(_)||lo(_))));if(a.imageName){const e=n[a.imageName];if(!e)continue;C=a.imageName,t.iconsInText=t.iconsInText||!0,S=e.paddedRect;const i=e.displaySize;y=y*Yu/h,v={width:i[0],height:i[1],left:1,top:-3,advance:M?i[1]:i[0],localGlyph:!1},I=g?-v.height*y:r*Yu-17-i[1]*y,E=v.advance;const o=(M?i[0]:i[1])*y-Yu*r;o>0&&o>b&&(b=o)}else{const t=i[a.fontStack];if(!t)continue;t[m]&&(S=t[m]);const n=e[a.fontStack];if(!n)continue;const o=n.glyphs[m];if(!o)continue;if(v=o.metrics,E=8203!==m?Yu:0,g){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,i=(t+e)*y;w<i&&(w=i,T=(t-e)/2*y),I=-t*y}else I=(r-y)*Yu-17}M?(t.verticalizable=!0,x.push({glyph:m,imageName:C,x:p,y:d+I,vertical:M,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),p+=E*y+c):(x.push({glyph:m,imageName:C,x:p,y:d+I,vertical:M,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),p+=v.advance*y+c)}0!==x.length&&(f=Math.max(p-c,f),g?Wh(x,m,b,T,o*r/2):Wh(x,m,b,0,o/2)),p=0;const S=o*r+b;v.lineOffset=Math.max(b,a),d+=S,++y}var _;const v=d,{horizontalAlign:x,verticalAlign:b}=Zh(s);(function(t,e,i,n,r,o){const s=(e-i)*r,a=-o*n;for(const e of t)for(const t of e.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,x,b,f,v),t.top+=-b*v,t.bottom=t.top+v,t.left+=-x*f,t.right=t.left+f,t.hasBaseline=g}(b,e,i,n,y,s,a,l,h,c,p,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const Nh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Bh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jh(t,e,i,n,r,o){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*Yu/o+r:0}{const n=i[e.fontStack],o=n&&n.glyphs[t];return o?o.metrics.advance*e.scale+r:0}}function $h(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function Uh(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Vh(t,e,i,n,r,o){let s=null,a=$h(e,i,r,o);for(const t of n){const n=$h(e-t.x,i,r,o)+t.badness;n<=a&&(s=t,a=n)}return{index:t,x:e,priorBreak:s,badness:a}}function Gh(t){return t?Gh(t.priorBreak).concat(t.index):[]}function qh(t,e,i,n,r,o,s){if("point"!==o)return[];if(!t)return[];const a=[],l=function(t,e,i,n,r,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=jh(t.getCharCode(i),a,n,r,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,n,r,s),c=t.text.indexOf("​")>=0;let u=0;for(let i=0;i<t.length();i++){const o=t.getSection(i),p=t.getCharCode(i);if(Nh[p]||(u+=jh(p,o,n,r,e,s)),i<t.length()-1){const e=!((h=p)<11904||!(Wr(h)||Zr(h)||so(h)||no(h)||Kr(h)||jr(h)||Hr(h)||Vr(h)||Jr(h)||Qr(h)||Yr(h)||co(h)||Gr(h)||Ur(h)||$r(h)||Xr(h)||qr(h)||oo(h)||eo(h)||to(h)));(Bh[p]||e||o.imageName)&&a.push(Vh(i+1,u,l,a,Uh(p,t.getCharCode(i+1),e&&c),!1))}}var h;return Gh(Vh(t.length(),u,l,a,0,!0))}function Zh(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Wh(t,e,i,n,r){if(!(e||i||n||r))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let e=0;e<=o;e++)t[e].x-=a,t[e].y+=i+n+r}function Hh(t,e,i){const{horizontalAlign:n,verticalAlign:r}=Zh(i),o=e[0]-t.displaySize[0]*n,s=e[1]-t.displaySize[1]*r;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Xh(t,e,i,n,r,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,p,d;"width"===i||"both"===i?(d=r[0]+l-n[3],h=r[0]+c+n[1]):(d=r[0]+(l+c-s.displaySize[0])/2,h=d+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],p=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,p=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:p,left:d,collisionPadding:a}}class Yh extends r{constructor(t,e,i,n,r){super(t,e),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new Yh(this.x,this.y,this.z,this.angle,this.segment)}}function Kh(t,e,i,n,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=e.dist(i)}return!0}function Jh(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Qh(t,e,i){return t?.6*e*i:0}function tp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function ep(t,e,i,n,r,o){const s=Qh(i,r,o),a=tp(i,n)*o;let l=0;const c=Jh(t)/2;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=yi(n.x,r.x,u),p=yi(n.y,r.y,u),d=new Yh(h,p,0,r.angleTo(n),i);return!s||Kh(t,d,a,s,e)?d:void 0}l+=o}}function ip(t,e,i,n,r,o,s,a,l){const c=Qh(n,o,s),u=tp(n,r),h=u*s,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),np(t,p?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,p,!1,l)}function np(t,e,i,n,r,o,s,a,l){const c=o/2,u=Jh(t);let h=0,p=e-i,d=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;p+i<h+f;){p+=i;const g=(p-h)/f,y=yi(s.x,a.x,g),_=yi(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&p-c>=0&&p+c<=u){const i=new Yh(y,_,0,m,e);i._round(),n&&!Kh(t,i,o,n,r)||d.push(i)}}h+=f}return a||d.length||s||(d=np(t,h/2,i,n,r,o,s,!0,l)),d}function rp(t,e,i,n,o){const s=[];for(let a=0;a<t.length;a++){const l=t[a];let c;for(let t=0;t<l.length-1;t++){let a=l[t],u=l[t+1];a.x<e&&u.x<e||(a.x<e?a=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new r(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=n&&u.x>=n||(a.x>=n?a=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=n&&(u=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}Pr(Yh,"Anchor");const op=1e20;function sp(t,e,i,n,r,o,s,a,l){for(let c=e;c<e+n;c++)ap(t,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)ap(t,c*o+e,1,n,s,a,l)}function ap(t,e,i,n,r,o,s){o[0]=0,s[0]=-op,s[1]=op,r[0]=t[e];for(let a=1,l=0,c=0;a<n;a++){r[a]=t[e+a*i];const n=a*a;do{const t=o[l];c=(r[a]-r[t]+n-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=op}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;t[e+a*i]=r[n]+c*c}}const lp={none:0,ideographs:1,all:2};class cp{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const i=[];for(const e in t)for(const n of t[e])i.push({stack:e,id:n});y(i,(({stack:t,id:e},i)=>{let n=this.entries[t];n||(n=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[e];if(void 0!==r)return void i(null,{stack:t,id:e,glyph:r});if(r=this._tinySDF(n,t,e),r)return n.glyphs[e]=r,void i(null,{stack:t,id:e,glyph:r});const o=Math.floor(e/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:t,id:e,glyph:r});let s=n.requests[o];s||(s=n.requests[o]=[],cp.loadGlyphRange(t,o,this.url,this.requestManager,((t,e)=>{if(e){n.ascender=e.ascender,n.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(n.glyphs[+t]=e.glyphs[+t]);n.ranges[o]=!0}for(const i of s)i(t,e);delete n.requests[o]}))),s.push(((n,r)=>{n?i(n):r&&i(null,{stack:t,id:e,glyph:r.glyphs[e]||null})}))}),((t,i)=>{if(t)e(t);else if(i){const t={};for(const{stack:e,id:n,glyph:r}of i)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==lp.none&&(this.localGlyphMode===lp.all?!!this.localFontFamily:!!this.localFontFamily&&(Qr(t)||io(t)||Gr(t)||qr(t)||Vr(t)))}_tinySDF(t,e,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=t.tinySDF;if(!r){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),r=t.tinySDF=new cp.TinySDF({fontFamily:n,fontWeight:i,fontSize:48,buffer:6,radius:16}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const o=String.fromCharCode(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:p,glyphAdvance:d}=r.draw(o);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new ac({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:p/2-27,advance:d/2,localGlyph:!0}}}}function up(t,e,i,n){const o=[],s=t.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,p=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],f=(t,e)=>t+e[1]-e[0],m=p.reduce(f,0),g=d.reduce(f,0),y=l-m,_=c-g;let v=0,x=m,b=0,w=g,T=0,S=y,C=0,E=_;if(s.content&&n){const t=s.content;v=hp(p,0,t[0]),b=hp(d,0,t[1]),x=hp(p,t[0],t[2]),w=hp(d,t[1],t[3]),T=t[0]-v,C=t[1]-b,S=t[2]-t[0]-x,E=t[3]-t[1]-w}const I=(n,o,l,c)=>{const p=dp(n.stretch-v,x,u,t.left),d=fp(n.fixed-T,S,n.stretch,m),f=dp(o.stretch-b,w,h,t.top),y=fp(o.fixed-C,E,o.stretch,g),_=dp(l.stretch-v,x,u,t.left),I=fp(l.fixed-T,S,l.stretch,m),M=dp(c.stretch-b,w,h,t.top),A=fp(c.fixed-C,E,c.stretch,g),k=new r(p,f),P=new r(_,f),L=new r(_,M),z=new r(p,M),D=new r(d/a,y/a),R=new r(I/a,A/a),O=e*Math.PI/180;if(O){const t=Math.sin(O),e=Math.cos(O),i=[e,-t,t,e];k._matMult(i),P._matMult(i),z._matMult(i),L._matMult(i)}const F=n.stretch+n.fixed,N=o.stretch+o.fixed;return{tl:k,tr:P,bl:z,br:L,tex:{x:s.paddedRect.x+1+F,y:s.paddedRect.y+1+N,w:l.stretch+l.fixed-F,h:c.stretch+c.fixed-N},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:S/a/u,minFontScaleY:E/a/h,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){const t=pp(p,y,m),e=pp(d,_,g);for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)o.push(I(n,e[t],r,e[t+1]))}}else o.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function hp(t,e,i){let n=0;for(const r of t)n+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return n}function pp(t,e,i){const n=[{fixed:-1,stretch:0}];for(const[e,i]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return n.push({fixed:e+1,stretch:i}),n}function dp(t,e,i,n){return t/e*i+n}function fp(t,e,i,n){return t-e*i/n}function mp(t,e,i,n){const r=e+t.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(e+t.positionedLines[n-1].lineOffset))/2}cp.loadGlyphRange=function(t,e,i,n,r){const o=256*e,s=o+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),It.Glyphs);Pt(a,((t,e)=>{if(t)r(t);else if(e){const t={},i=function(t){return new lh(t).readFields(Mh,{})}(e);for(const e of i.glyphs)t[e.id]=e;r(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},cp.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.min(this.size-this.buffer,Math.ceil(o-r)),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),p=new Uint8ClampedArray(h),d={data:p,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return d;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(op,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const n=(t+m)*c+e+m;if(1===i)y[n]=0,g[n]=op;else{const t=.5-i;y[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}sp(y,0,0,c,u,c,this.f,this.v,this.z),sp(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(y[t])-Math.sqrt(g[t]);p[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return d}};class gp{constructor(t,e){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1),o=e[n];const s=n+1;if(s<this.length&&i(e[s],o)<0&&(n=s,o=e[s]),i(o,r)>=0)break;e[t]=o,t=n}e[t]=r}}function yp(t,e,i=!1){let n=1/0,o=1/0,s=-1/0,a=-1/0;const l=t[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<o)&&(o=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>a)&&(a=e.y)}const c=Math.min(s-n,a-o);let u=c/2;const h=new gp([],_p);if(0===c)return new r(n,o);for(let e=n;e<s;e+=c)for(let i=o;i<a;i+=c)h.push(new vp(e+u,i+u,u,t));let p=function(t){let e=0,i=0,n=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,e+=3*l}return new vp(i/e,n/e,0,t)}(t),d=h.length;for(;h.length;){const n=h.pop();(n.d>p.d||!p.d)&&(p=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-p.d<=e||(u=n.h/2,h.push(new vp(n.p.x-u,n.p.y-u,u,t)),h.push(new vp(n.p.x+u,n.p.y-u,u,t)),h.push(new vp(n.p.x-u,n.p.y+u,u,t)),h.push(new vp(n.p.x+u,n.p.y+u,u,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${p.d}`)),p.p}function _p(t,e){return e.max-t.max}function vp(t,e,i,n){this.p=new r(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,tl(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const xp=Number.POSITIVE_INFINITY,bp=Math.sqrt(2);function wp(t,e){return e[1]!==xp?function(t,e,i){let n=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,r]}(t,e[0],e[1]):function(t,e){let i=0,n=0;e<0&&(e=0);const r=e/bp;switch(t){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,n]}(t,e[0])}function Tp(t,e,i,n,r,o,s,a,l,c){t.createArrays(),t.tilePixelRatio=ba/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const u=t.layers[0].layout,h=t.layers[0]._unevaluatedLayout._values,p={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Po(e),a),h["text-size"].possiblyEvaluate(new Po(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Po(e),a),h["icon-size"].possiblyEvaluate(new Po(i),a)]}p.layoutTextSize=h["text-size"].possiblyEvaluate(new Po(l+1),a),p.layoutIconSize=h["icon-size"].possiblyEvaluate(new Po(l+1),a),p.textMaxSize=h["text-size"].possiblyEvaluate(new Po(18),a);const d="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of t.features){const l=u.get("text-font").evaluate(o,{},a).join(","),h=f.evaluate(o,{},a),m=p.layoutTextSize.evaluate(o,{},a),g=(p.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),y=o.text;let _,v=[0,0];if(y){const n=y.toString(),s=u.get("text-letter-spacing").evaluate(o,{},a)*Yu,c=u.get("text-line-height").evaluate(o,{},a)*Yu,p=ho(n)?s:0,f=u.get("text-anchor").evaluate(o,{},a),_=u.get("text-variable-anchor");if(!_){const t=u.get("text-radial-offset").evaluate(o,{},a);v=t?wp(f,[t*Yu,xp]):u.get("text-offset").evaluate(o,{},a).map((t=>t*Yu))}let x=d?"center":u.get("text-justify").evaluate(o,{},a);const b=u.get("symbol-placement"),w="point"===b,T="point"===b?u.get("text-max-width").evaluate(o,{},a)*Yu:0,S=o=>{t.allowVerticalPlacement&&uo(n)&&(g.vertical=Fh(y,e,i,r,l,T,c,f,o,p,v,Dh.vertical,!0,b,m,h))};if(!d&&_){const t="auto"===x?_.map((t=>Sp(t))):[x];let n=!1;for(let o=0;o<t.length;o++){const s=t[o];if(!g.horizontal[s])if(n)g.horizontal[s]=g.horizontal[0];else{const t=Fh(y,e,i,r,l,T,c,"center",s,p,v,Dh.horizontal,!1,b,m,h);t&&(g.horizontal[s]=t,n=1===t.positionedLines.length)}}S("left")}else{if("auto"===x&&(x=Sp(f)),w||u.get("text-writing-mode").indexOf("horizontal")>=0||!uo(n)){const t=Fh(y,e,i,r,l,T,c,f,x,p,v,Dh.horizontal,!1,b,m,h);t&&(g.horizontal[x]=t)}S("point"===b?"left":x)}}let x=!1;if(o.icon&&o.icon.name){const e=n[o.icon.name];e&&(_=Hh(r[o.icon.name],u.get("icon-offset").evaluate(o,{},a),u.get("icon-anchor").evaluate(o,{},a)),x=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&P("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const b=Mp(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!b&&b.iconsInText),(b||_)&&Cp(t,o,g,_,n,p,m,0,v,x,s,a,c)}o&&t.generateCollisionDebugBuffers(l,t.collisionBoxArray)}function Sp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cp(t,e,i,n,r,o,s,a,c,u,h,p,d){let f=o.textMaxSize.evaluate(e,{},p);void 0===f&&(f=s);const m=t.layers[0].layout,g=m.get("icon-offset").evaluate(e,{},p),y=Mp(i.horizontal)||i.vertical,_="globe"===d.name,v=s/24,x=t.tilePixelRatio*f/24,b=(A=t.overscaling,t.zoom>18&&A>2&&(A>>=1),Math.max(ba/(512*A),1)*m.get("symbol-spacing")),w=m.get("text-padding")*t.tilePixelRatio,T=m.get("icon-padding")*t.tilePixelRatio,S=l(m.get("text-max-angle")),C="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),E="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),I=m.get("symbol-placement"),M=b/2;var A;const k=m.get("icon-text-fit");let L;n&&"none"!==k&&(t.allowVerticalPlacement&&i.vertical&&(L=Xh(n,i.vertical,k,m.get("icon-text-fit-padding"),g,v)),y&&(n=Xh(n,y,k,m.get("icon-text-fit-padding"),g,v)));const z=(s,a,l)=>{if(a.x<0||a.x>=ba||a.y<0||a.y>=ba)return;let f=null;if(_){const{x:t,y:e,z:i}=d.projectTilePoint(a.x,a.y,l);f={anchor:new Yh(t,e,i,0,void 0),up:d.upVector(l,a.x,a.y)}}!function(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S){const C=t.addToLineVertexArray(e,n);let E,I,M,A,k,L,z,D=0,R=0,O=0,F=0,N=-1,B=-1;const j={};let $=Gs("");const U=i?i.anchor:e;let V=0,G=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,G]=l.layout.get("text-offset").evaluate(x,{},S).map((t=>t*Yu)):(V=l.layout.get("text-radial-offset").evaluate(x,{},S)*Yu,G=xp),t.allowVerticalPlacement&&r.vertical){const t=r.vertical;if(f)L=kp(t),a&&(z=kp(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},S)+90;M=Ap(c,U,e,u,h,p,t,d,i,m),a&&(A=Ap(c,U,e,u,h,p,a,y,i))}}if(o){const n=l.layout.get("icon-rotate").evaluate(x,{},S),r="none"!==l.layout.get("icon-text-fit"),s=up(o,n,w,r),d=a?up(a,n,w,r):void 0;I=Ap(c,U,e,u,h,p,o,y,n),D=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[Ku*l.layout.get("icon-size").evaluate(x,{},S)],m[0]>Ep&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Ku*b.compositeIconSizes[0].evaluate(x,{},S),Ku*b.compositeIconSizes[1].evaluate(x,{},S)],(m[0]>Ep||m[1]>Ep)&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,v,_,x,!1,i,e,C.lineStartIndex,C.lineLength,-1,T,S),N=t.icon.placedSymbolArray.length-1,d&&(R=4*d.length,t.addSymbols(t.icon,d,m,v,_,x,Dh.vertical,i,e,C.lineStartIndex,C.lineLength,-1,T,S),B=t.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const o=r.horizontal[n];E||($=Gs(o.text),f?k=kp(o):E=Ap(c,U,e,u,h,p,o,d,l.layout.get("text-rotate").evaluate(x,{},S),m));const a=1===o.positionedLines.length;if(O+=Ip(t,i,e,o,s,l,f,x,m,C,r.vertical?Dh.horizontal:Dh.horizontalOnly,a?Object.keys(r.horizontal):[n],j,N,b,T,S),a)break}r.vertical&&(F+=Ip(t,i,e,r.vertical,s,l,f,x,m,C,Dh.vertical,["vertical"],j,B,b,T,S));let q=-1;const Z=(t,e)=>t?Math.max(t,e):e;q=Z(k,q),q=Z(L,q),q=Z(z,q);const W=q>-1?1:0;t.glyphOffsetArray.length>=Fd.MAX_GLYPHS&&P("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(U.x,U.y,U.z,e.x,e.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,N,B,$,void 0!==E?E:t.collisionBoxArray.length,void 0!==E?E+1:t.collisionBoxArray.length,void 0!==M?M:t.collisionBoxArray.length,void 0!==M?M+1:t.collisionBoxArray.length,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,A||t.collisionBoxArray.length,A?A+1:t.collisionBoxArray.length,u,O,F,D,R,W,0,V,G,q)}(t,a,f,s,i,n,r,L,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,w,C,c,0,T,E,g,e,o,u,h,p)};if("line"===I)for(const r of rp(e.geometry,0,0,ba,ba)){const e=ip(r,b,S,i.vertical||y,n,24,x,t.overscaling,ba);for(const i of e){const e=y;e&&Pp(t,e.text,M,i)||z(r,i,p)}}else if("line-center"===I){for(const t of e.geometry)if(t.length>1){const e=ep(t,S,i.vertical||y,n,24,x);e&&z(t,e,p)}}else if("Polygon"===e.type)for(const t of Zc(e.geometry,0)){const e=yp(t,16);z(t[0],new Yh(e.x,e.y,0,0,void 0),p)}else if("LineString"===e.type)for(const t of e.geometry)z(t,new Yh(t[0].x,t[0].y,0,0,void 0),p);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)z([e],new Yh(e.x,e.y,0,0,void 0),p)}const Ep=32640;function Ip(t,e,i,n,o,s,a,l,c,u,h,p,d,f,m,g,y){const _=function(t,e,i,n,o,s,a,l){const c=[];if(0===e.positionedLines.length)return c;const u=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(t){const e=t[0],i=t[1],n=e*i;return n>0?[e,-i]:n<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let p=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)p-=t.lineOffset;const d=e.positionedLines.length,f=p/d;let m=e.top-i[1];for(let t=0;t<d;++t){const n=e.positionedLines[t];m=mp(e,f,m,t);for(const t of n.positionedGlyphs){if(!t.rect)continue;const n=t.rect||{};let s=4,p=!0,d=1,f=0;if(t.imageName){const e=a[t.imageName];if(!e)continue;if(e.sdf){P("SDF images are not supported in formatted text and will be ignored.");continue}p=!1,d=e.pixelRatio,s=1/d}const g=(o||l)&&t.vertical,y=t.metrics.advance*t.scale/2,_=t.metrics,v=t.rect;if(null===v)continue;l&&e.verticalizable&&(f=t.imageName?y-t.metrics.width*t.scale/2:0);const x=o?[t.x+y,t.y]:[0,0];let b=[0,0],w=[0,0],T=!1;o||(g?(w=[t.x+y+h[0],t.y+h[1]-f],T=!0):b=[t.x+y+i[0],t.y+i[1]-f]);const S=v.w*t.scale/(d*(t.localGlyph?2:1)),C=v.h*t.scale/(d*(t.localGlyph?2:1));let E,I,M,A;if(g){const e=t.y-m,i=new r(-y,y-e),n=-Math.PI/2,o=new r(...w);E=new r(-y+b[0],b[1]),E._rotateAround(n,i)._add(o),E.x+=-e+y,E.y-=(_.left-s)*t.scale;const a=t.imageName?_.advance*t.scale:Yu*t.scale,l=String.fromCharCode(t.glyph);rh(l)?E.x+=(1-s)*t.scale:oh(l)?E.x+=a-_.height*t.scale+(-s-1)*t.scale:E.x+=t.imageName||_.width+2*s===v.w&&_.height+2*s===v.h?(a-C)/2:(a-(_.height+2*s)*t.scale)/2,I=new r(E.x,E.y-S),M=new r(E.x+C,E.y),A=new r(E.x+C,E.y-S)}else{const e=(_.left-s)*t.scale-y+b[0],i=(-_.top-s)*t.scale+b[1],n=e+S,o=i+C;E=new r(e,i),I=new r(n,i),M=new r(e,o),A=new r(n,o)}if(u){let t;t=o?new r(0,0):T?new r(h[0],h[1]):new r(i[0],i[1]),E._rotateAround(u,t),I._rotateAround(u,t),M._rotateAround(u,t),A._rotateAround(u,t)}const k=new r(0,0),L=new r(0,0);c.push({tl:E,tr:I,bl:M,br:A,tex:n,writingMode:e.writingMode,glyphOffset:x,sectionIndex:t.sectionIndex,isSDF:p,pixelOffsetTL:k,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,c,s,a,l,o,t.allowVerticalPlacement),v=t.textSizeData;let x=null;"source"===v.kind?(x=[Ku*s.layout.get("text-size").evaluate(l,{},y)],x[0]>Ep&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Ku*m.compositeTextSizes[0].evaluate(l,{},y),Ku*m.compositeTextSizes[1].evaluate(l,{},y)],(x[0]>Ep||x[1]>Ep)&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,_,x,c,a,l,h,e,i,u.lineStartIndex,u.lineLength,f,g,y);for(const e of p)d[e]=t.text.placedSymbolArray.length-1;return 4*_.length}function Mp(t){for(const e in t)return t[e];return null}function Ap(t,e,i,n,o,s,a,c,u,h){let p=a.top,d=a.bottom,f=a.left,m=a.right;const g=a.collisionPadding;if(g&&(f-=g[0],p-=g[1],m+=g[2],d+=g[3]),u){const t=new r(f,p),e=new r(m,p),i=new r(f,d),n=new r(m,d),o=l(u);let s=new r(0,0);h&&(s=new r(h[0],h[1])),t._rotateAround(o,s),e._rotateAround(o,s),i._rotateAround(o,s),n._rotateAround(o,s),f=Math.min(t.x,e.x,i.x,n.x),m=Math.max(t.x,e.x,i.x,n.x),p=Math.min(t.y,e.y,i.y,n.y),d=Math.max(t.y,e.y,i.y,n.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,f,p,m,d,c,n,o,s),t.length-1}function kp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Pp(t,e,i,n){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else r[e]=[];return r[e].push(n),!1}const Lp=Yo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:zp}=Lp,Dp=Yo([{name:"a_pos_3",components:3,type:"Int16"}]);var Rp=Yo([{name:"a_pos",type:"Int16",components:2}]);const Op=ba/Math.PI/2,Fp=2*Aa(1,0)*Op*Math.PI,Np=[64,32,16],Bp=-Op,jp=Op,$p=[new Kl([Bp,Bp,Bp],[jp,jp,jp]),new Kl([Bp,Bp,Bp],[0,0,jp]),new Kl([0,Bp,Bp],[jp,0,jp]),new Kl([Bp,0,Bp],[0,jp,jp]),new Kl([0,0,Bp],[jp,jp,jp])];function Up(t,e,i,n){const r=Pl([],t._camera.position,t.worldSize),o=[e,i,1,1];Vl(o,o,t.pixelMatrixInverse),Ul(o,o,1/o[3]);const s=zl([],Bl([],o,r)),a=t.globeMatrix,l=[a[12],a[13],a[14]],u=Bl([],l,r),h=Sl(u),p=zl([],u),d=t.worldSize/(2*Math.PI),m=Dl(p,s),g=Math.asin(d/h);if(g<Math.acos(m)){if(!n)return null;const t=[],e=[];Pl(t,s,h/m),zl(e,Bl(e,t,u)),zl(s,El(s,u,Pl(s,e,Math.tan(g)*h)))}const y=[];new Hl(r,s).closestPointOnSphere(l,d,y);const _=zl([],B(a,0)),v=zl([],B(a,1)),x=zl([],B(a,2)),b=Dl(_,y),w=Dl(v,y),T=Dl(x,y),S=c(Math.asin(-w/d));let C=c(Math.atan2(b,T));C=t.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(t.center.lng,C);const E=Ia(C),I=f(Ma(S),0,1);return new Da(E,I)}class Vp{constructor(t,e,i){this.a=Bl([],t,i),this.b=Bl([],e,i),this.center=i;const n=zl([],this.a),r=zl([],this.b);this.angle=Math.acos(Dl(n,r))}}function Gp(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,n){const r=Math.sin(i);return t*(Math.sin((1-n)*i)/r)+e*(Math.sin(n*i)/r)}(t.a[e],t.b[e],t.angle,f(i,0,1))+t.center[e]}function qp(t){if(t.z<=1)return $p[t.z+2*t.y+t.x];const[e,i]=Wp(t),n=[Xp(e[0],e[1]),Xp(e[0],i[1]),Xp(i[0],e[1]),Xp(i[0],i[1])],r=[jp,jp,jp],o=[Bp,Bp,Bp];for(const t of n)r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.min(r[2],t[2]),o[0]=Math.max(o[0],t[0]),o[1]=Math.max(o[1],t[1]),o[2]=Math.max(o[2],t[2]);return new Kl(r,o)}function Zp(t,e,i){const n=e/t.worldSize,r=Number.MAX_VALUE,o=[-r,-r,-r],s=[r,r,r],a=fl(new Float64Array(16));if(yl(a,a,[n,n,n]),ml(a,a,t.globeMatrix),i.z<=1){const t=qp(i).getCorners();for(let e=0;e<t.length;e++)Ol(t[e],t[e],a),Al(s,s,t[e]),kl(o,o,t[e]);return new Kl(s,o)}const[c,u]=Wp(i),h=new wa;h.setSouthWest([c[1],u[0]]),h.setNorthEast([u[1],c[0]]);const p=[Xp(h.getSouth(),h.getWest()),Xp(h.getSouth(),h.getEast()),Xp(h.getNorth(),h.getEast()),Xp(h.getNorth(),h.getWest())];for(let t=0;t<p.length;t++)Ol(p[t],p[t],a),Al(s,s,p[t]),kl(o,o,p[t]);if(h.contains(t.center)){o[2]=0;const e=t.point,i=[e.x*n,e.y*n,0];return Al(s,s,i),kl(o,o,i),new Kl(s,o)}const d=[a[12],a[13],a[14]],m=t.center.lng,g=f(t.center.lat,-85.051129,za),y=[Ia(m),Ma(g)],_=h.getCenter().lng,v=f(h.getCenter().lat,-85.051129,za),x=[Ia(_),Ma(v)];let b=new Array(3),w=0,T=y[0]-x[0];const S=y[1]-x[1];if(T>.5?T-=1:T<-.5&&(T+=1),Math.abs(T)>Math.abs(S))w=T>=0?1:3,b=d;else{w=S>=0?0:2;const t=[a[4],a[5],a[6]];let e;e=S>=0?-Math.sin(l(h.getSouth()))*Op:-Math.sin(l(h.getNorth()))*Op,b=Ll(b,d,t,e)}const C=p[w],E=p[(w+1)%4],I=new Vp(C,E,b),M=[Gp(I,0)||C[0],Gp(I,1)||C[1],Gp(I,2)||C[2]];return s[2]=Math.min(C[2],E[2]),Al(s,s,M),kl(o,o,M),new Kl(s,o)}function Wp(t){const e=1<<t.z,i=t.x/e,n=(t.x+1)/e,r=(t.y+1)/e;return[[Pa(t.y/e),ka(i)],[Pa(r),ka(n)]]}function Hp(t,e,i,n=Op){return i=l(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function Xp(t,e,i){return Hp(Math.cos(l(t)),Math.sin(l(t)),e,i)}function Yp(t,e,i){const n=Math.pow(2,i.z),r=(t/ba+i.x)/n;return Xp(Pa((e/ba+i.y)/n),ka(r))}function Kp(t){return 16383/Math.max(...Bl([],t.max,t.min))}function Jp(t){const e=fl(new Float64Array(16)),i=Kp(t);var n,r;return yl(e,e,[i,i,i]),gl(e,e,((n=[])[0]=-(r=t.min)[0],n[1]=-r[1],n[2]=-r[2],n)),e}function Qp(t){const e=fl(new Float64Array(16)),i=1/Kp(t);return gl(e,e,t.min),yl(e,e,[i,i,i]),e}function td(t,e,i,n,r){const o=function(t){const e=ba/(2*Math.PI);return t/(2*Math.PI)/e}(i),s=[t,e,-i/(2*Math.PI)],a=fl(new Float64Array(16));return gl(a,a,s),yl(a,a,[o,o,o]),_l(a,a,l(-r)),vl(a,a,l(-n)),a}function ed(t){return m(5,6,t)}function id(t,e){const i=Xp(e.lat,e.lng);return o=(n=Il([],function(t){const e=Xp(t._center.lat,t._center.lng);let i=Rl([],Cl(0,1,0),e);const n=xl([],-t.angle,e);i=Ol(i,i,n),xl(n,-t._pitch,i);const r=zl([],e);return Pl(r,r,t.cameraToCenterDistance/t.pixelsPerMeter*Fp),Ol(r,r,n),El([],e,r)}(t),i))[0],s=n[1],a=n[2],l=(r=i)[0],c=r[1],u=r[2],p=(h=Math.sqrt(o*o+s*s+a*a)*Math.sqrt(l*l+c*c+u*u))&&Dl(n,r)/h,Math.acos(Math.min(Math.max(p,-1),1));var n,r,o,s,a,l,c,u,h,p}const nd=l(85),rd=Math.cos(nd),od=Math.sin(nd);function sd(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,r=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),o=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),s=Math.sin(t._pitch)*o+r;return Math.min(1.01*s,r*(1/t._horizonShift))}function ad(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,r=(t.x+1)*i,o=t.y*i,s=(t.y+1)*i,a=ka(n),l=ka(r),c=Pa(o),u=Pa(s),h=e.project(a,c),p=e.project(l,c),d=e.project(l,u),f=e.project(a,u);let m=Math.min(h.x,p.x,d.x,f.x),g=Math.min(h.y,p.y,d.y,f.y),y=Math.max(h.x,p.x,d.x,f.x),_=Math.max(h.y,p.y,d.y,f.y);const v=i/16;function x(t,i,n,r,o,s){const a=(n+o)/2,l=(r+s)/2,c=e.project(ka(a),Pa(l)),u=Math.max(0,m-c.x,g-c.y,c.x-y,c.y-_);m=Math.min(m,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),_=Math.max(_,c.y),u>v&&(x(t,c,n,r,a,l),x(c,i,a,l,o,s))}x(h,p,n,o,r,o),x(p,d,r,o,r,s),x(d,f,r,s,n,s),x(f,h,n,s,n,o),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:e}}const ld=fl(new Float32Array(16));class cd{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new Sa(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return Aa(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return sd(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,n){const o=t.horizonLineFromTop(!1),s=new r(e,Math.max(o,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(s,n))}pointCoordinate3D(t,e,i){const n=new r(e,i);if(t.elevation)return t.elevation.pointCoordinate(n);{const e=this.pointCoordinate(t,n.x,n.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return ld}createTileMatrix(t,e,i){let n,r,o;const s=i.canonical,a=fl(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=ad(s,this);n=1,r=l.x+i.wrap*l.scale,o=l.y,yl(a,a,[n/l.scale,n/l.scale,t.pixelsPerMeter/e])}else n=e/t.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*i.wrap)*n,o=s.y*n;return gl(a,a,[r,o,0]),yl(a,a,[n/ba,n/ba,1]),a}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class ud extends cd{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],n=Math.sin(l(e));this.n=(n+Math.sin(l(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:n,r0:r}=this,o=l(t-this.center[0]),s=l(e),a=Math.sqrt(n-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-r,z:0}}unproject(t,e){const{n:i,c:n,r0:r}=this,o=r+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=l(this.center[0])*i;s=g(s,-Math.PI-a,Math.PI-a);const u=c(s/i)+this.center[0],h=Math.asin(f((n-(t*t+o*o)*i*i)/(2*i),-1,1)),p=f(c(h),-85.051129,za);return new Sa(u,p)}}const hd=1.340264,pd=-.081106,dd=893e-6,fd=.003796,md=Math.sqrt(3)/2;class gd extends cd{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(md*Math.sin(e)),n=i*i,r=n*n*n;return{x:.5*(t*Math.cos(i)/(md*(hd+3*pd*n+r*(7*dd+9*fd*n)))/Math.PI+.5),y:1-.5*(i*(hd+pd*n+r*(dd+fd*n))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=i*i,r=n*n*n;for(let t,o,s,a=0;a<12&&(o=i*(hd+pd*n+r*(dd+fd*n))-e,s=hd+3*pd*n+r*(7*dd+9*fd*n),t=o/s,i=f(i-t,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(t)<1e-12));++a);const o=md*t*(hd+3*pd*n+r*(7*dd+9*fd*n))/Math.cos(i),s=Math.asin(Math.sin(i)/md),a=f(180*o/Math.PI,-180,180),l=f(180*s/Math.PI,-85.051129,za);return new Sa(a,l)}}class yd extends cd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),n=f(360*(.5-e),-85.051129,za);return new Sa(i,n)}}const _d=Math.PI/2;function vd(t){return Math.tan((_d+t)/2)}class xd extends cd{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30],n=l(e),r=l(i),o=Math.cos(n);this.n=n===r?Math.sin(n):Math.log(o/Math.cos(r))/Math.log(vd(r)/vd(n)),this.f=o*Math.pow(vd(n),this.n)/this.n}project(t,e){e=l(e),t=l(t-this.center[0]);const i=1e-6,{n:n,f:r}=this;r>0?e<-_d+i&&(e=-_d+i):e>_d-i&&(e=_d-i);const o=r/Math.pow(vd(e),n),s=o*Math.sin(n*t),a=r-o*Math.cos(n*t);return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+.5),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:n}=this,r=n-e,o=Math.sign(r),s=Math.sign(i)*Math.sqrt(t*t+r*r);let a=Math.atan2(t,Math.abs(r))*o;r*i<0&&(a-=Math.PI*Math.sign(t)*o);const l=f(c(a/i)+this.center[0],-180,180),u=f(c(2*Math.atan(Math.pow(n/s,1/i))-_d),-85.051129,za);return new Sa(l,u)}}class bd extends cd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:Ia(t),y:Ma(e),z:0}}unproject(t,e){const i=ka(t),n=Pa(e);return new Sa(i,n)}}const wd=l(za);class Td extends cd{project(t,e){const i=(e=l(e))*e,n=i*i;return{x:.5*((t=l(t))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=25,r=0,o=i*i;do{o=i*i;const t=o*o;r=(i*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),i=f(i-r,-wd,wd)}while(Math.abs(r)>1e-6&&--n>0);o=i*i;const s=f(c(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=c(i);return new Sa(s,a)}}const Sd=l(za);class Cd extends cd{project(t,e){e=l(e),t=l(t);const i=Math.cos(e),n=2/Math.PI,r=Math.acos(i*Math.cos(t/2)),o=Math.sin(r)/r,s=.5*(t*n+2*i*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(n),o=Math.sin(n),l=2*o*r,c=o*o,u=r*r,h=Math.cos(i/2),p=Math.sin(i/2),d=2*h*p,m=p*p,g=1-u*h*h,y=g?1/g:0,_=g?Math.acos(r*h)*Math.sqrt(1/g):0,v=.5*(2*_*r*p+2*i/Math.PI)-t,x=.5*(_*o+n)-e,b=.5*y*(u*m+_*r*h*c)+1/Math.PI,w=y*(d*l/4-_*o*p),T=.125*y*(l*p-_*o*u*d),S=.5*y*(c*h+_*m*r)+.5,C=w*T-S*b;s=(x*w-v*S)/C,a=(v*T-x*b)/C,i=f(i-s,-Math.PI,Math.PI),n=f(n-a,-Sd,Sd)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new Sa(c(i),c(n))}}class Ed extends cd{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(l(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:n}=this;return{x:l(t)*n*i+.5,y:-Math.sin(l(e))/n*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:n}=this,r=-(e-.5)/i,o=f(c((t-.5)/i)/n,-180,180),s=Math.asin(f(r*n,-1,1)),a=f(c(s),-85.051129,za);return new Sa(o,a)}}class Id extends bd{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(t,e,i){const n=Math.pow(2,i.z),r=(t/ba+i.x)/n,o=Xp(Pa((e/ba+i.y)/n),ka(r));return Ol(o,o,Jp(qp(i))),{x:o[0],y:o[1],z:o[2]}}locationPoint(t,e){const i=Xp(e.lat,e.lng),n=zl([],i),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude;Ll(i,i,n,Aa(1,0)*ba*o);const s=fl(new Float64Array(16));return ml(s,t.pixelMatrix,t.globeMatrix),Ol(i,i,s),new r(i[0],i[1])}pixelsPerMeter(t,e){return Aa(1,0)*e}pixelSpaceConversion(t,e,i){const n=yi(Aa(1,45)*e,Aa(1,t)*e,i);return this.pixelsPerMeter(t,e)/n}createTileMatrix(t,e,i){const n=Qp(qp(i.canonical));return ml(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,e){const{center:i}=t,n=fl(new Float64Array(16));return ml(n,n,Jp(qp(e))),vl(n,n,l(i.lng)),_l(n,n,l(i.lat)),yl(n,n,[t._projectionScaler,t._projectionScaler,1]),Float32Array.from(n)}pointCoordinate(t,e,i,n){return Up(t,e,i,!0)||new Da(0,0)}pointCoordinate3D(t,e,i){const n=this.pointCoordinate(t,e,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(t,e){return!Up(t,e.x,e.y,!1)}farthestPixelDistance(t){const e=function(t,e){const i=t.cameraToCenterDistance,n=t._centerAltitude*e,r=t._camera,o=t._camera.forward(),s=El([],Pl([],o,-i),[0,0,n]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],c=t.width/t.height,u=Math.tan(t.fovAboveCenter),h=Pl([],r.up(),u),p=Pl([],r.right(),u*c),d=zl([],El([],El([],o,h),p)),f=[];let m;if(new Hl(s,d).closestPointOnSphere(l,a,f)){const e=El([],f,l),i=Bl([],e,s);m=Math.cos(t.fovAboveCenter)*Sl(i)}else{const t=Bl([],s,l),e=Bl([],l,s);zl(e,e);const i=Sl(t)-a;m=Math.sqrt(i*(i+2*a));const n=Math.acos(m/(a+i))-Math.acos(Dl(o,e));m*=Math.cos(n)}return 1.01*m}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),i=ed(t.zoom);if(i>0){const n=sd(t,Aa(1,t.center.lat)*t.worldSize),r=t.worldSize/(2*Math.PI),o=Math.max(t.width,t.height)/t.worldSize*Math.PI;return yi(e,n+r*(1-Math.cos(o)),Math.pow(i,10))}return e}upVector(t,e,i){const n=1<<t.z,r=(e/ba+t.x)/n;return Xp(Pa((i/ba+t.y)/n),ka(r),1)}upVectorScale(t){return{metersToTile:Fp*Kp(qp(t))}}}function Md(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new bd(t);case"equirectangular":return new yd(t);case"naturalEarth":return new Td(t);case"equalEarth":return new gd(t);case"winkelTripel":return new Cd(t);case"albers":return i?new Ed(t):new ud(t);case"lambertConformalConic":return i?new Ed(t):new xd(t);case"globe":return new Id(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Ad=hu.VectorTileFeature.types,kd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pd(t,e,i,n,r,o,s,a,l,c,u,h,p){const d=a?Math.min(Ep,Math.round(a[0])):0,f=a?Math.min(Ep,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),o,s,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function Ld(t,e,i,n,r,o,s){t.emplaceBack(e,i,n,r,o,s)}function zd(t,e,i,n,r){t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r),t.emplaceBack(e,i,n,r)}function Dd(t){for(const e of t.sections)if(_o(e.text))return!0;return!1}class Rd{constructor(t){this.layoutVertexArray=new ss,this.indexArray=new fs,this.programConfigurations=t,this.segments=new xa,this.dynamicLayoutVertexArray=new is,this.opacityVertexArray=new ls,this.placedSymbolArray=new As,this.globeExtVertexArray=new as}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vu.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,qu.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,kd,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Gu.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Pr(Rd,"SymbolBuffers");class Od{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new xa,this.collisionVertexArray=new ps,this.collisionVertexArrayExt=new ds}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Zu.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Wu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pr(Od,"CollisionBuffers");class Fd{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fl([]),this.placementViewportMatrix=fl([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ju(this.zoom,e["text-size"]),this.iconSizeData=Ju(this.zoom,e["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((t=>Dh[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Rd(new ua(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Rd(new ua(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Ls,this.lineVertexArray=new zs,this.symbolInstances=new Ps}calculateGlyphDependencies(t,e,i,n,r){for(let i=0;i<t.length;i++)if(e[t.charCodeAt(i)]=!0,n&&r){const n=nh[t.charAt(i)];n&&(e[n.charCodeAt(0)]=!0)}}populate(t,e,i,n){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof xe&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,p=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const d=e.iconDependencies,f=e.glyphDependencies,m=e.availableImages,g=new Po(this.zoom);for(const{feature:e,id:l,index:c,sourceLayerIndex:y}of t){const t=r._featureFilter.needGeometry,_=Va(e,t);if(!r._featureFilter.filter(g,_,i))continue;if(t||(_.geometry=Ua(e,i,n)),s&&1!==e.type&&i.z<=5){const t=_.geometry,e=1<<i.z,n=i.x,r=i.y,o=.98078528056;for(let i=0;i<t.length;i++)t[i]=Na(t[i],(t=>t),((t,i)=>Dl(Xp(Pa((t.y/ba+r)/e),ka((t.x/ba+n)/e),1),Xp(Pa((i.y/ba+r)/e),ka((i.x/ba+n)/e),1))<o))}let v,x;if(u){const t=r.getValueAndResolveTokens("text-field",_,i,m),e=xe.factory(t);Dd(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mo()||this.hasRTLText&&ko.isParsed())&&(v=ih(e,r,_))}if(h){const t=r.getValueAndResolveTokens("icon-image",_,i,m);x=t instanceof be?t:be.fromString(t)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?p.evaluate(_,{},i):void 0;if(this.features.push({id:l,text:v,icon:x,index:c,sourceLayerIndex:y,geometry:_.geometry,properties:e.properties,type:Ad[e.type],sortKey:b}),x&&(d[x.name]=!0),v){const t=a.evaluate(_,{},i).join(","),e="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dh.vertical)>=0;for(const i of v.sections)if(i.image)d[i.image.name]=!0;else{const n=uo(v.toString()),r=i.fontStack||t,o=f[r]=f[r]||{};this.calculateGlyphDependencies(i.text,o,e,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let r=0;function o(e){n.push(t[e]),r++}function s(t,e,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(t,i,r){const o=e[i];return delete e[i],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(!p){o(c);continue}const d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){const t=a(d,f,h),r=s(d,f,n[t].geometry);delete e[d],delete i[f],i[l(p,n[r].geometry,!0)]=r,n[t].geometry=null}else d in i?s(d,f,h):f in e?a(d,f,h):(o(c),e[d]=r-1,i[f]=r-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Md(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length,n=t.segment;if(void 0!==n){let i=t.dist(e[n+1]),r=t.dist(e[n]);const o={};for(let t=n+1;t<e.length;t++)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:i},t<e.length-1&&(i+=e[t+1].dist(e[t]));for(let t=n||0;t>=0;t--)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:r},t>0&&(r+=e[t-1].dist(e[t]));for(let t=0;t<e.length;t++){const e=o[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,n,r,o,s,a,l,c,u,h,p,d){const f=t.indexArray,m=t.layoutVertexArray,g=t.globeExtVertexArray,y=t.segments.prepareSegment(4*e.length,m,f,this.canOverlap?o.sortKey:void 0),_=this.glyphOffsetArray.length,v=y.vertexLength,x=this.allowVerticalPlacement&&s===Dh.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let n=0;n<e.length;n++){const{tl:r,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:_,pixelOffsetBR:v,minFontScaleX:w,minFontScaleY:T,glyphOffset:S,isSDF:C,sectionIndex:E}=e[n],I=y.vertexLength,M=S[1];if(Pd(m,l.x,l.y,r.x,M+r.y,h.x,h.y,i,C,_.x,_.y,w,T),Pd(m,l.x,l.y,s.x,M+s.y,h.x+h.w,h.y,i,C,v.x,_.y,w,T),Pd(m,l.x,l.y,c.x,M+c.y,h.x,h.y+h.h,i,C,_.x,v.y,w,T),Pd(m,l.x,l.y,u.x,M+u.y,h.x+h.w,h.y+h.h,i,C,v.x,v.y,w,T),a){const e=a.anchor,i=a.up;Ld(g,e.x,e.y,e.z,i[0],i[1],i[2]),Ld(g,e.x,e.y,e.z,i[0],i[1],i[2]),Ld(g,e.x,e.y,e.z,i[0],i[1],i[2]),Ld(g,e.x,e.y,e.z,i[0],i[1],i[2]),zd(t.dynamicLayoutVertexArray,e.x,e.y,e.z,x)}else zd(t.dynamicLayoutVertexArray,l.x,l.y,l.z,x);f.emplaceBack(I,I+1,I+2),f.emplaceBack(I+1,I+2,I+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(S[0]),n!==e.length-1&&E===e[n+1].sectionIndex||t.programConfigurations.populatePaintArrays(m.length,o,o.index,{},p,d,b&&b[E])}const w=a?a.anchor:l;t.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,_,this.glyphOffsetArray.length-_,v,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,i,n,r,o,s){t.emplaceBack(e,i,n,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,i,n,o,s,a){const l=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),c=l.vertexLength,u=a.tileAnchorX,h=a.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),i.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),i.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(t.x1,t.y2)),l.vertexLength+=4;const p=i.indexArray;p.emplaceBack(c,c+1),p.emplaceBack(c+1,c+2),p.emplaceBack(c+2,c+3),p.emplaceBack(c+3,c),l.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(t,e,s);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Od(us,Hu.members,bs),this.iconCollisionBox=new Od(us,Hu.members,bs);const i=th(this.iconSizeData,t),n=th(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,i,n){const r=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),o=Qu(this.textSizeData,t,r)/Yu;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,i){const n=this.icon.placedSymbolArray.get(i),r=Qu(this.iconSizeData,t,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(t,e,i){t.emplaceBack(e,-i,-i),t.emplaceBack(e,i,-i),t.emplaceBack(e,i,i),t.emplaceBack(e,-i,i)}_updateTextDebugCollisionBoxes(t,e,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding)}}_updateIconDebugCollisionBoxes(t,e,i,n,r){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=th(this.iconSizeData,t),n=th(this.textSizeData,t);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,n,r,o,s,a,l){const c={};for(let n=e;n<i;n++){const e=t.get(n);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},c.textFeatureIndex=e.featureIndex;break}for(let e=n;e<r;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],r=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);n.push(0|Math.round(e*s.tileAnchorX+i*s.tileAnchorY)),r.push(s.featureIndex)}return o.sort(((t,e)=>n[t]-n[e]||r[e]-r[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Pr(Fd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Fd.MAX_GLYPHS=65535,Fd.addDynamicAttributes=zd;const Nd=new qo({"symbol-placement":new jo(Gt.layout_symbol["symbol-placement"]),"symbol-spacing":new jo(Gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jo(Gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $o(Gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jo(Gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jo(Gt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jo(Gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new jo(Gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jo(Gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new $o(Gt.layout_symbol["icon-size"]),"icon-text-fit":new jo(Gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jo(Gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new $o(Gt.layout_symbol["icon-image"]),"icon-rotate":new $o(Gt.layout_symbol["icon-rotate"]),"icon-padding":new jo(Gt.layout_symbol["icon-padding"]),"icon-keep-upright":new jo(Gt.layout_symbol["icon-keep-upright"]),"icon-offset":new $o(Gt.layout_symbol["icon-offset"]),"icon-anchor":new $o(Gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jo(Gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jo(Gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jo(Gt.layout_symbol["text-rotation-alignment"]),"text-field":new $o(Gt.layout_symbol["text-field"]),"text-font":new $o(Gt.layout_symbol["text-font"]),"text-size":new $o(Gt.layout_symbol["text-size"]),"text-max-width":new $o(Gt.layout_symbol["text-max-width"]),"text-line-height":new $o(Gt.layout_symbol["text-line-height"]),"text-letter-spacing":new $o(Gt.layout_symbol["text-letter-spacing"]),"text-justify":new $o(Gt.layout_symbol["text-justify"]),"text-radial-offset":new $o(Gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jo(Gt.layout_symbol["text-variable-anchor"]),"text-anchor":new $o(Gt.layout_symbol["text-anchor"]),"text-max-angle":new jo(Gt.layout_symbol["text-max-angle"]),"text-writing-mode":new jo(Gt.layout_symbol["text-writing-mode"]),"text-rotate":new $o(Gt.layout_symbol["text-rotate"]),"text-padding":new jo(Gt.layout_symbol["text-padding"]),"text-keep-upright":new jo(Gt.layout_symbol["text-keep-upright"]),"text-transform":new $o(Gt.layout_symbol["text-transform"]),"text-offset":new $o(Gt.layout_symbol["text-offset"]),"text-allow-overlap":new jo(Gt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jo(Gt.layout_symbol["text-ignore-placement"]),"text-optional":new jo(Gt.layout_symbol["text-optional"])});var Bd={paint:new qo({"icon-opacity":new $o(Gt.paint_symbol["icon-opacity"]),"icon-color":new $o(Gt.paint_symbol["icon-color"]),"icon-halo-color":new $o(Gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new $o(Gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $o(Gt.paint_symbol["icon-halo-blur"]),"icon-translate":new jo(Gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new jo(Gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new $o(Gt.paint_symbol["text-opacity"]),"text-color":new $o(Gt.paint_symbol["text-color"],{runtimeType:ie,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new $o(Gt.paint_symbol["text-halo-color"]),"text-halo-width":new $o(Gt.paint_symbol["text-halo-width"]),"text-halo-blur":new $o(Gt.paint_symbol["text-halo-blur"]),"text-translate":new jo(Gt.paint_symbol["text-translate"]),"text-translate-anchor":new jo(Gt.paint_symbol["text-translate-anchor"])}),layout:Nd};class jd{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Jt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pr(jd,"FormatSectionOverride",{omit:["defaultValue"]});class $d extends ya{constructor(t){super(t,Bd)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,n){const r=this.layout.get(t).evaluate(e,{},i,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||Dn(o.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,r)}createBucket(t){return new Fd(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Bd.paint.overridableProperties){if(!$d.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new jd(e),n=new zn(i,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new On("source",n):new Fn("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new No(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&$d.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=Bd.paint.properties[e];let r=!1;const o=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof xe)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{r||(e instanceof Ie&&Se(e.value)===se?o(e.value.sections):e instanceof Le?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return r}getProgramConfiguration(t){return new ca(this,t)}}var Ud={paint:new qo({"background-color":new jo(Gt.paint_background["background-color"]),"background-pattern":new Vo(Gt.paint_background["background-pattern"]),"background-opacity":new jo(Gt.paint_background["background-opacity"])})},Vd={paint:new qo({"raster-opacity":new jo(Gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new jo(Gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jo(Gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jo(Gt.paint_raster["raster-brightness-max"]),"raster-saturation":new jo(Gt.paint_raster["raster-saturation"]),"raster-contrast":new jo(Gt.paint_raster["raster-contrast"]),"raster-resampling":new jo(Gt.paint_raster["raster-resampling"]),"raster-fade-duration":new jo(Gt.paint_raster["raster-fade-duration"])})};class Gd extends ya{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var qd={paint:new qo({"sky-type":new jo(Gt.paint_sky["sky-type"]),"sky-atmosphere-sun":new jo(Gt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jo(Gt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jo(Gt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jo(Gt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Go(Gt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jo(Gt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jo(Gt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jo(Gt.paint_sky["sky-opacity"])})};function Zd(t,e,i){const n=[0,0,1],r=ql([]);return Wl(r,r,i?-l(t)+Math.PI:l(t)),Zl(r,r,-l(e)),Fl(n,n,r),zl(n,n)}const Wd={circle:class extends ya{constructor(t){super(t,ul)}createBucket(t){return new Za(t)}queryRadius(t){const e=t;return ol("circle-radius",this,e)+ol("circle-stroke-width",this,e)+sl(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,r,o,s,a){const l=ll(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Jl(t,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ca(this,t)}},heatmap:class extends ya{createBucket(t){return new nc(t)}constructor(t){super(t,cc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ol("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,o,s,a,l){const c=this.paint.get("heatmap-radius").evaluate(e,i);return Jl(t,n,s,a,l,!0,!0,new r(0,0),c)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ca(this,t)}},hillshade:class extends ya{constructor(t){super(t,hc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ya{constructor(t){super(t,Jc)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new ca(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Yc(t)}queryRadius(){return sl(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,r,o){return!t.queryGeometry.isAboveHorizon&&Xa(al(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends ya{constructor(t){super(t,wu)}createBucket(t){return new _u(t)}queryRadius(){return sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ca(this,t)}queryIntersectsFeature(t,e,i,n,o,s,a,l,c){const u=ll(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(e,i),p=this.paint.get("fill-extrusion-base").evaluate(e,i),d=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=t.tile.getBucket(this);if(f&&g instanceof _u){const t=g.centroidVertexArray,e=c+1;if(e<t.length){const i=t.get(e);d[0]=i.a_centroid_pos0,d[1]=i.a_centroid_pos1}}if(0===d[0]&&1===d[1])return!1;"globe"===s.projection.name&&(n=bu([n],[new r(0,0),new r(ba,ba)],t.tileID.canonical).map((t=>t.polygon)).flat());const y=function(t,e,i,n,o,s,a,l,c,u,h){return"globe"===t.projection.name?function(t,e,i,n,r,o,s,a,l,c,u){const h=[],p=[],d=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(t,e,i,n)=>{t[0]=e,t[1]=i,t[2]=n,t[3]=1},y=xu();i>0&&(i+=y),n+=y;for(const y of e){const e=[],_=[];for(const h of y){const p=h.x+r.x,y=h.y+r.y,v=t.projection.projectTilePoint(p,y,u),x=t.projection.upVector(u,h.x,h.y);let b=i,w=n;if(s){const t=Pu(p,y,i,n,s,a,l,c);b+=t.base,w+=t.top}0!==i?g(f,v.x+x[0]*d*b,v.y+x[1]*d*b,v.z+x[2]*d*b):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*d*w,v.y+x[1]*d*w,v.z+x[2]*d*w),Ol(f,f,o),Ol(m,m,o),e.push(ku(f)),_.push(ku(m))}h.push(e),p.push(_)}return[h,p]}(t,e,i,n,o,s,a,l,c,u,h):a?function(t,e,i,n,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const p of t){const t=[],d=[];for(const c of p){const u=c.x+n.x,p=c.y+n.y,f=Pu(u,p,e,i,o,s,a,l);h[0]=u,h[1]=p,h[2]=f.base,h[3]=1,Vl(h,h,r),h[3]=Math.max(h[3],1e-5);const m=ku([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=p,h[2]=f.top,h[3]=1,Vl(h,h,r),h[3]=Math.max(h[3],1e-5);const g=ku([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);t.push(m),d.push(g)}c.push(t),u.push(d)}return[c,u]}(e,i,n,o,s,a,l,c,u):function(t,e,i,n,o){const s=[],a=[],l=o[8]*e,c=o[9]*e,u=o[10]*e,h=o[11]*e,p=o[8]*i,d=o[9]*i,f=o[10]*i,m=o[11]*i;for(const e of t){const t=[],i=[];for(const s of e){const e=s.x+n.x,a=s.y+n.y,g=o[0]*e+o[4]*a+o[12],y=o[1]*e+o[5]*a+o[13],_=o[2]*e+o[6]*a+o[14],v=o[3]*e+o[7]*a+o[15],x=g+l,b=y+c,w=_+u,T=Math.max(v+h,1e-5),S=g+p,C=y+d,E=_+f,I=Math.max(v+m,1e-5),M=new r(x/T,b/T);M.z=w/T,t.push(M);const A=new r(S/I,C/I);A.z=E/I,i.push(A)}s.push(t),a.push(i)}return[s,a]}(e,i,n,o,s)}(s,n,p,h,u,a,f?l:null,d,m,s.center.lat,t.tileID.canonical),_=t.queryGeometry;return function(t,e,i){let n=1/0;Xa(i,e)&&(n=Au(i,e[0]));for(let r=0;r<e.length;r++){const o=e[r],s=t[r];for(let t=0;t<o.length-1;t++){const e=o[t],r=[e,o[t+1],s[t+1],s[t],e];Wa(i,r)&&(n=Math.min(n,Au(i,r)))}}return n!==1/0&&n}(y[0],y[1],_.isPointQuery()?_.screenBounds:_.screenGeometry)}},line:class extends ya{constructor(t){super(t,ju),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof gi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=$u.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Nu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new ca(this,t)}queryRadius(t){const e=t,i=Uu(ol("line-width",this,e),ol("line-gap-width",this,e)),n=ol("line-offset",this,e);return i/2+Math.abs(n)+sl(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,o,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=al(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),l=t.pixelToTileUnitsFactor/2*Uu(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),c=this.paint.get("line-offset").evaluate(e,i);return c&&(n=function(t,e){const i=[],n=new r(0,0);for(let r=0;r<t.length;r++){const o=t[r],s=[];for(let t=0;t<o.length;t++){const i=o[t-1],r=o[t],a=o[t+1],l=0===t?n:r.sub(i)._unit()._perp(),c=t===o.length-1?n:a.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),s.push(u._mult(e)._add(r))}i.push(s)}return i}(n,c*t.pixelToTileUnitsFactor)),function(t,e,i){for(let n=0;n<e.length;n++){const r=e[n];if(t.length>=3)for(let e=0;e<r.length;e++)if(il(t,r[e]))return!0;if(Ya(t,r,i))return!0}return!1}(a,n,l)}isTileClipped(){return!0}},symbol:$d,background:class extends ya{constructor(t){super(t,Ud)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ya{constructor(t){super(t,Vd)}getProgramIds(){return["raster"]}},sky:class extends ya{constructor(t){super(t,qd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=t.style.light,o=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&P("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Zd(o.azimuthal,90-o.polar,e):Zd(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return Zd(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Hd{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,i,n){const{width:r,height:o}=t,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:p}=e;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||!1!==i.premultiply)),n||this.size&&this.size[0]===r&&this.size[1]===o){const{x:e,y:i}=n||{x:0,y:0};t instanceof l||t instanceof c||t instanceof u||t instanceof h||p&&t instanceof p?a.texSubImage2D(a.TEXTURE_2D,0,e,i,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,i,r,o,a.RGBA,a.UNSIGNED_BYTE,t.data)}else this.size=[r,o],t instanceof l||t instanceof c||t instanceof u||t instanceof h||p&&t instanceof p?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,r,o,0,this.format,a.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?t===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Xd{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new ac({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=T(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const n=[];let r=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(t,e,i){const n=e/2;for(let e=-i;e<=i;e++){const r=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const p=e/i*(n+1);if(s.isDash){const t=n-Math.abs(p);h=Math.sqrt(u*u+t*t)}else h=n-Math.sqrt(u*u+p*p);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let o=0,s=t[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=t[++o]);const n=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(n,a);this.image.data[r+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const n="round"===e,r=n?7:0,o=2*r+1;if(this.nextRow+o>this.height)return P("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let e=0;e<t.length;e++)t[e]<0&&(P("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),s+=t[e];if(0!==s){const i=this.width/s,o=this.getDashRanges(t,this.width,i);n?this.addRoundDash(o,i,r):this.addRegularDash(o,"square"===e?.5*i:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[i]=l,l}}Pr(Xd,"LineAtlas");class Yd{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Kd{constructor(){this.tasks={},this.taskQueue=[],C(["process"],this),this.invoker=new Yd(this.process),this.nextId=0}add(t,e){const i=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===n){D();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:t,metadata:e,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){D();try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<e&&(e=n.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class Jd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Qd=["tile","layer","source","sourceLayer","state"];class tf{constructor(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=n,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of Qd)void 0!==this[e]&&(t[e]=this[e]);return t}}const ef=32,nf=33,rf=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,n=0,r=0,o=0,s=0,a=0;for(1&e?r=o=s=ef:i=n=a=ef;(e>>=1)>1;){const t=i+r>>1,l=n+o>>1;1&e?(r=i,o=n,i=s,n=a):(i=r,n=o,r=s,o=a),s=t,a=l}const l=4*t;rf[l+0]=i,rf[l+1]=n,rf[l+2]=r,rf[l+3]=o}const of=new Uint16Array(2178),sf=new Uint8Array(1089),af=new Uint16Array(1089);function lf(t){return 0===t?-.03125:32===t?.03125:0}var cf=Yo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const uf={type:2,extent:ba,loadGeometry:()=>[[new r(0,0),new r(8193,0),new r(8193,8193),new r(0,8193),new r(0,0)]]};class hf{constructor(t,e,i,n,r){this.tileID=t,this.uid=b(),this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<W.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ad(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=n}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Fd){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Fd&&e.hasRTLText){this.hasRTLText=!0,ko.isLoading()||ko.isLoaded()||"deferred"!==Mo()||Ao();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(i))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new Is}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hd(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hd(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hd(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,n,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(t,e){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),r=e?e.sourceLayer:"",o=n._geojsonTileLayer||n[r];if(!o)return;const s=Yn(e&&e.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let e=0;e<o.length;e++){const n=o.feature(e);if(s.needGeometry){const t=Va(n,!0);if(!s.filter(new Po(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new Po(this.tileID.overscaledZ),n))continue;const h=i.getId(n,r),p=new tf(n,a,l,c,h);p.tile=u,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=R(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let i=!1;if(this.expirationTime>t)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{const n=this.expirationTime-e;n?this.expirationTime=t+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!e)return;const i=this.latestFeatureIndex.loadVTLayers(),n=e.style.listImages();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const o=this.buckets[r],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=i[s],l=t[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Nu||o instanceof Yc){const t=e.style._getSourceCache(o.layers[0].source);e._terrain&&e._terrain.enabled&&t&&o.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const c=e&&e.style&&e.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=W.now()+t}setTexture(t,e){const i=e.context,n=i.gl;this.texture=e.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Hd(i,t,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),i.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0],n=new Jo,r=new ws;for(let t=0;t<i.length;t++){const{x:e,y:o}=i[t];n.emplaceBack(e,o),r.emplaceBack(t)}r.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(r),this._tileDebugBuffer=t.createVertexBuffer(n,Rp.members),this._tileDebugSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0];let n,r;if(this.isRaster){const t=function(t,e){const i=ad(t,e),n=Math.pow(2,t.z);for(let r=0;r<nf;r++)for(let o=0;o<nf;o++){const s=ka((t.x+(o+lf(o))/ef)/n),a=Pa((t.y+(r+lf(r))/ef)/n),l=e.project(s,a),c=r*nf+o;of[2*c+0]=Math.round((l.x*i.scale-i.x)*ba),of[2*c+1]=Math.round((l.y*i.scale-i.y)*ba)}sf.fill(0),af.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=rf[e+0],n=rf[e+1],r=rf[e+2],o=rf[e+3],s=i+r>>1,a=n+o>>1,l=s+a-n,c=a+i-s,u=n*nf+i,h=o*nf+r,p=a*nf+s,d=Math.hypot((of[2*u+0]+of[2*h+0])/2-of[2*p+0],(of[2*u+1]+of[2*h+1])/2-of[2*p+1])>=16;if(sf[p]=sf[p]||(d?1:0),t<1022){const t=(n+c>>1)*nf+(i+l>>1),e=(o+c>>1)*nf+(r+l>>1);sf[p]=sf[p]||sf[t]||sf[e]}}const r=new ts,o=new fs;let s=0;function a(t,e){const i=e*nf+t;return 0===af[i]&&(r.emplaceBack(of[2*i+0],of[2*i+1],t*ba/ef,e*ba/ef),af[i]=++s),af[i]-1}function l(t,e,i,n,r,s){const c=t+i>>1,u=e+n>>1;if(Math.abs(t-r)+Math.abs(e-s)>1&&sf[u*nf+c])l(r,s,t,e,c,u),l(i,n,r,s,c,u);else{const l=a(t,e),c=a(i,n),u=a(r,s);o.emplaceBack(l,c,u)}}return l(0,0,ef,ef,ef,0),l(ef,ef,0,0,0,ef),{vertices:r,indices:o}}(this.tileID.canonical,e);n=t.vertices,r=t.indices}else{n=new ts,r=new fs;for(const{x:t,y:e}of i)n.emplaceBack(t,e,0,0);const t=fc(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)r.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,cf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(r),this._tileBoundsSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugBuffers(t,e){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!e||"globe"!==e.name)return;const i=this.tileID.canonical,n=Jp(qp(i));this._makeGlobeTileDebugBorderBuffer(t,i,n),this._makeGlobeTileDebugTextBuffer(t,i,n)}_makeGlobeTileDebugBorderBuffer(t,e,i){const n=new Jo,r=new ws,o=new Qo,s=(t,s,a,l,c)=>{const u=(a-t)/(c-1),h=(l-s)/(c-1),p=n.length;for(let a=0;a<c;a++){const l=t+a*u,c=s+a*h;n.emplaceBack(l,c);const d=Yp(l,c,e),f=Ol(d,d,i);o.emplaceBack(f[0],f[1],f[2]),r.emplaceBack(p+a)}},a=ba;s(0,0,a,0,16),s(a,0,a,a,16),s(a,a,0,a,16),s(0,a,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(r),this._tileDebugBuffer=t.createVertexBuffer(n,Rp.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(o,Dp.members),this._tileDebugSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugTextBuffer(t,e,i){const n=new Jo,r=new fs,o=new Qo,s=25;r.reserve(32),n.reserve(s),o.reserve(s);const a=(t,e)=>s*t+e;for(let t=0;t<s;t++){const r=2048*t;for(let t=0;t<s;t++){const s=2048*t;n.emplaceBack(s,r);const a=Yp(s,r,e),l=Ol(a,a,i);o.emplaceBack(l[0],l[1],l[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=a(t,e),n=a(t,e+1),o=a(t+1,e),s=a(t+1,e+1);r.emplaceBack(i,n,o),r.emplaceBack(o,n,s)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(r),this._tileDebugTextBuffer=t.createVertexBuffer(n,Rp.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(o,Dp.members),this._tileDebugTextSegments=xa.simpleSegment(0,0,s,32)}}class pf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){const n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},v(this.stateChanges[t][n],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])i[e]||(this.deletedStates[t][n][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,e){const i=String(e),n=v({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete n[t]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),v(this.state[t][i],this.stateChanges[t][i]),e[i]=this.state[t][i];i[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const i in this.state[t])e[i]={},this.state[t][i]={};else for(const i in this.deletedStates[t]){if(null===this.deletedStates[t][i])this.state[t][i]={};else for(const e of Object.keys(this.deletedStates[t][i]))delete this.state[t][i][e];e[i]=this.state[t][i]}i[t]=i[t]||{},v(i[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in t)t[n].setFeatureState(i,e)}}class df{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function ff(t,e,i,n){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(i[s]<t[s]||i[s]>e[s])return null}else{const a=1/n[s];let l=(t[s]-i[s])*a,c=(e[s]-i[s])*a;if(l>c){const t=l;l=c,c=t}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function mf(t,e,i,n,r,o,s,a,l,c,u){const h=n-t,p=r-e,d=o-i,f=s-t,m=a-e,g=l-i,y=u[1]*g-u[2]*m,_=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*y+p*_+d*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-t,T=c[1]-e,S=c[2]-i,C=(w*y+T*_+S*v)*b;if(C<0||C>1)return null;const E=T*d-S*p,I=S*h-w*d,M=w*p-T*h,A=(u[0]*E+u[1]*I+u[2]*M)*b;return A<0||C+A>1?null:(f*E+m*I+g*M)*b}function gf(t,e,i){return(t-e)/(i-e)}function yf(t,e,i,n,r,o,s,a,l){const c=1<<i,u=o-n,h=s-r,p=(t+1)/c*u+n,d=(e+0)/c*h+r,f=(e+1)/c*h+r;a[0]=(t+0)/c*u+n,a[1]=d,l[0]=p,l[1]=f}class _f{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let n=Math.ceil(Math.pow(2,e));const r=1/n,o=(t,e,i,n,r)=>{const o=n?1:0,s=(t+1)*i-o,a=e*i,l=(e+1)*i-o;r[0]=t*i,r[1]=a,r[2]=s,r[3]=l};let s=new df(n);const a=[];for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),r,!1,a);const i=xf(a[0],a[1],t),l=xf(a[2],a[1],t),c=xf(a[2],a[3],t),u=xf(a[0],a[3],t);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),n/=2;n>=1;n/=2){const t=i[i.length-1];s=new df(n);for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),2,!0,a);const i=t.getElevation(a[0],a[1]),r=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),p=t.isLeaf(a[2],a[3]),d=t.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&p&&d;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=e.length-1,n=e[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,n,r,o,s=1){return ff([t,e,-100],[i,n,this.maximums[0]*s],r,o)}raycast(t,e,i,n,r,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,i,n,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],p=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:a,t:d,nodex:f,nodey:m,depth:g}=p.pop();if(this.leaves[a]){yf(f,m,g,t,e,i,n,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,p=(m+0)/a,y=(m+1)/a,_=xf(l,p,this.dem)*s,v=xf(c,p,this.dem)*s,x=xf(c,y,this.dem)*s,b=xf(l,y,this.dem)*s,w=mf(u[0],u[1],_,h[0],u[1],v,h[0],h[1],x,r,o),T=mf(h[0],h[1],x,u[0],h[1],b,u[0],u[1],_,r,o),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const t=Ll([],r,o,d);if(vf(_,v,b,x,gf(t[0],u[0],h[0]),gf(t[1],u[1],h[1]))>=t[2])return d}continue}let y=0;for(let p=0;p<this._siblingOffset.length;p++){yf((f<<1)+this._siblingOffset[p][0],(m<<1)+this._siblingOffset[p][1],g+1,t,e,i,n,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+p]*s;const d=ff(u,h,r,o);if(null!=d){const t=d;l[p]=t;let e=!1;for(let i=0;i<y&&!e;i++)t>=l[c[i]]&&(c.splice(i,0,p),e=!0);e||(c[y]=p),y++}}for(let t=0;t<y;t++){const e=c[t];p.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,n,r){if(1===t[n].isLeaf(e,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=n-1,s=t[o];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const n=2*e+this._siblingOffset[t][0],r=2*i+this._siblingOffset[t][1],o=s.getElevation(n,r),c=s.isLeaf(n,r),u=this._addNode(o.min,o.max,c);c&&(a|=1<<t),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(t,2*e+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],o,l+n)}}function vf(t,e,i,n,r,o){return yi(yi(t,i,o),yi(e,n,o),r)}function xf(t,e,i){const n=i.dim,r=f(t*n-.5,0,n-1),o=f(e*n-.5,0,n-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,n-1),c=Math.min(a+1,n-1);return vf(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),r-s,o-a)}const bf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,n=!1,r=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return P(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2,s=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.encoding=i||"mapbox",this.borderReady=n,!n){for(let t=0;t<o;t++)s[this._idx(-1,t)]=s[this._idx(0,t)],s[this._idx(o,t)]=s[this._idx(o-1,t)],s[this._idx(t,-1)]=s[this._idx(t,0)],s[this._idx(t,o)]=s[this._idx(t,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new _f(this)}get(t,e,i=!1){i&&(t=f(t,-1,this.dim),e=f(e,-1,this.dim));const n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(t){return bf[t]}get unpackVector(){return bf[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,i){return(256*t*256+256*e+i)/10-1e4}_unpackTerrarium(t,e,i){return 256*t+e+i/256-32768}static pack(t,e){const i=[0,0,0,0],n=wf.getUnpackVector(e);let r=Math.floor((t+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new lc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,r=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=n;i<r;i++){const n=4*this._idx(i,e),r=4*this._idx(i+a,e+l);this.pixels[n+0]=t.pixels[r+0],this.pixels[n+1]=t.pixels[r+1],this.pixels[n+2]=t.pixels[r+2],this.pixels[n+3]=t.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Pr(wf,"DEMData"),Pr(_f,"DemMinMaxQuadTree",{omit:["dem"]});class Tf{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(t,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const t of e)this.remove(t.value.tileID,t)}}class Sf{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Sf.ReadOnly=!1,Sf.ReadWrite=!0,Sf.disabled=new Sf(519,Sf.ReadOnly,[0,1]);const Cf=7680;class Ef{constructor(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Ef.disabled=new Ef({func:519,mask:0},0,0,Cf,Cf,Cf);class If{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}If.Replace=[1,0],If.disabled=new If(If.Replace,ye.transparent,[!1,!1,!1,!1]),If.unblended=new If(If.Replace,ye.transparent,[!0,!0,!0,!0]),If.alphaBlended=new If([1,771],ye.transparent,[!0,!0,!0,!0]);const Mf=1029,Af=2305;class kf{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}kf.disabled=new kf(!1,Mf,Af),kf.backCCW=new kf(!0,Mf,Af),kf.backCW=new kf(!0,Mf,2304),kf.frontCW=new kf(!0,1028,2304),kf.frontCCW=new kf(!0,1028,Af);class Pf extends Vt{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new Tf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new pf,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,(()=>{}))}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,(()=>{}))}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const e in this._tiles){const i=this._tiles[e];this._source.prepareTile(i)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,i.tileID),i.upload(t),i.prepare(this.map.style.imageManager)}else for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return _(this._tiles).map((t=>t.tileID)).sort(Lf).map((t=>t.key))}getRenderableIds(t){const e=[];for(const i in this._tiles)this._isIdRenderable(+i,t)&&e.push(this._tiles[i]);return t?e.sort(((t,e)=>{const i=t.tileID,n=e.tileID,o=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):e.map((t=>t.tileID)).sort(Lf).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new Ut(n,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=W.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new $t("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,r=Math.floor(i*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,e,i){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new Eu(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(n=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((t=>this._source.hasTile(t))))):n=[];const r=this._updateRetainedTiles(n);if(zf(this._source.type)&&0!==n.length){const t={},e={},i=Object.keys(r);for(const n of i){const i=r[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=W.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-Pf.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[n]=i}const o=n[n.length-1].overscaledZ;for(const t in this._tiles){const i=this._tiles[t];if(r[t]||!i.hasData())continue;let n=i.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&e[n.key]){r[t]=i.tileID;break}}}for(const e in t)r[e]||(this._coveredTiles[e]=!0,r[e]=t[e])}for(const t in r)this._tiles[t].clearFadeHold();const o=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i}(this._tiles,r);for(const t of o){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},n=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),r=t[0].overscaledZ,o=Math.max(r-Pf.maxOverzooming,this._source.minzoom),s=Math.max(r+Pf.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,s,e);for(const n of t){let t=this._tiles[n.key];if(t.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const t=n.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=n.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let r=t.wasRequested();for(let s=n.overscaledZ-1;s>=o;--s){const o=n.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,t=this.getTile(o),!t&&r&&(t=this._addTile(o)),t&&(e[o.key]=o,r=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(t){let e=this._tiles[t.key];if(e)return this._source.prepareTile&&this._source.prepareTile(e),e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const i=Boolean(e);if(!i){const i=this.map?this.map.painter:null;e=new hf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._source.prepareTile&&this._source.prepareTile(e)||this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new $t("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,i){const n=[],r=this.transform;if(!r)return n;const o="globe"===r.projection.name,s=Ia(r.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const t=l.tileID.canonical;if(0===t.z){const e=[Math.abs(f(s,...Df(t,-1))-s),Math.abs(f(s,...Df(t,1))-s)];c=[0,2*e.indexOf(Math.min(...e))-1]}else{const e=[Math.abs(f(s,...Df(t,-1))-s),Math.abs(f(s,...Df(t,0))-s),Math.abs(f(s,...Df(t,1))-s)];c=[e.indexOf(Math.min(...e))-1]}}else c=[0];for(const i of c){const o=t.containsTile(l,r,e,i);o&&n.push(o)}}return n}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));for(const t of e)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(zf(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=W.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(t,e){const i=new Map,n=Array.isArray(t)?t:[t],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const t of n){const e=t.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)i.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}y(Array.from(i.values()),((t,e)=>{const i=new hf(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),e)}}function Lf(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function zf(t){return"raster"===t||"image"===t||"video"===t}function Df(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Pf.maxOverzooming=10,Pf.maxUnderzooming=3;class Rf{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const n=i||t.findDEMTileFor(e);if(!n||!n.dem)return;const r=n.dem,o=n.tileID,s=1<<e.canonical.z-o.canonical.z;return new Rf(n,n.tileSize/ba/s,[(e.canonical.x/s-o.canonical.x)*r.dim,(e.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(i);return new r(n,o)}getElevationAt(t,e,i,n){const r=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return n=!!n,i?yi(yi(l.get(s,a,n),l.get(s,a+1,n),o-a),yi(l.get(s+1,a,n),l.get(s+1,a+1,n),o-a),r-s):l.get(s,a,n)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Aa(1,t)*this._dem.stride}}class Of{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Mr(ba,16,0),this.featureIndexArray=new Rs,this.promoteId=e}insert(t,e,i,n,r,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,o);const a=this.grid;for(let t=0;t<e.length;t++){const i=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y)}n[0]<ba&&n[1]<ba&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hu.VectorTile(new lh(this.rawTileData)).layers,this.sourceLayerCoder=new Jd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,n){this.loadVTLayers();const r=t.params||{},o=Yn(r.filter),s=t.tileResult,a=t.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,i,n)=>nl(s.bufferedTilespaceGeometry,t,e,i,n)));c.sort(Nf);let u=null;a.elevation&&c.length>0&&(u=Rf.create(a.elevation,this.tileID));const h={};let p;for(let a=0;a<c.length;a++){const l=c[a];if(l===p)continue;p=l;const d=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,d,o,r.layers,r.availableImages,e,i,n,((e,i,n,r=0)=>(f||(f=Ua(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(s,e,n,f,this.z,t.transform,t.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(t,e,i,n,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:p}=e,d=this.bucketLayerIDs[u];if(n&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(n,d))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const t=Va(m,!0);if(!i.filter(new Po(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Po(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let e=0;e<d.length;e++){const i=d[e];if(n&&n.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=v({},s[i]);f.paint=Ff(f.paint,u.paint,m,h,r),f.layout=Ff(f.layout,u.layout,m,h,r);const y=!l||l(m,u,h,p);if(!y)continue;const _=new tf(m,this.z,this.x,this.y,g);_.layer=f;let x=t[i];void 0===x&&(x=t[i]=[]),x.push({featureIndex:c,feature:_,intersectionZ:y})}}lookupSymbolFeatures(t,e,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=Yn(r);for(const r of t)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,o,s,a,e);return l}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[e])return r[e];const o=this.vtLayers[n].feature(e);return r[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;return this.promoteId&&(i=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof i&&(i=Number(i))),i}}function Ff(t,e,i,n,r){return I(t,((t,o)=>{const s=e instanceof Bo?e.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function Nf(t,e){return e-t}Pr(Of,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Bf{constructor(t){const e={},i=[];for(const n in t){const r=t[n],o=e[n]={};for(const t in r.glyphs){const e=r.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n=e.metrics.localGlyph?2:1,s={x:0,y:0,w:e.bitmap.width+2*n,h:e.bitmap.height+2*n};i.push(s),o[t]=s}}const{w:n,h:r}=Ph(i),o=new ac({width:n||1,height:r||1});for(const i in t){const n=t[i];for(const t in n.glyphs){const r=n.glyphs[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=e[i][t],a=r.metrics.localGlyph?2:1;ac.copy(r.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},r.bitmap)}}this.image=o,this.positions=e}}Pr(Bf,"GlyphAtlas");class jf{constructor(t){this.tileID=new Eu(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=ad(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,e,i,n,r){this.status="parsing",this.data=t,this.collisionBoxArray=new Is;const o=new Jd(Object.keys(t.layers).sort()),s=new Of(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Xd(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=e.familiesBySource[this.source];for(const e in u){const n=t.layers[e];if(!n)continue;let r=!1,l=!1;for(const t of u[e])"symbol"===t[0].type?r=!0:l=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&P(`Vector tile source "${this.source}" layer "${e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(e),p=[];for(let t=0;t<n.length;t++){const i=n.feature(t),r=s.getId(i,e);p.push({feature:i,id:r,index:t,sourceLayerIndex:h})}for(const t of u[e]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&($f(t,this.zoom,i),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(p,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(t.map((t=>t.id))))}}let h,p,d,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=I(c.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},((t,e)=>{h||(h=t,p=e,x.call(this))}),void 0,!1,m):p={};const y=Object.keys(c.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((t,e)=>{h||(h=t,d=e,x.call(this))}),void 0,!1,m):d={};const v=Object.keys(c.patternDependencies);function x(){if(h)return r(h);if(p&&d&&f){const t=new Bf(p),e=new zh(d,f);for(const n in a){const r=a[n];r instanceof Fd?($f(r.layers,this.zoom,i),Tp(r,p,t.positions,d,e.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):r.hasPattern&&(r instanceof Nu||r instanceof Yc||r instanceof _u)&&($f(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,e.patternPositions,i,this.tileTransform))}this.status="done",r(null,{buckets:_(a).filter((t=>!t.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:l,imageAtlas:e,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?t.positions:null})}}v.length?n.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((t,e)=>{h||(h=t,f=e,x.call(this))}),void 0,!1,m):f={},x.call(this)}}function $f(t,e,i){const n=new Po(e);for(const e of t)e.recalculate(n,i)}class Uf{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const r=this.entries[t]=this.entries[t]||{callbacks:[]};if(r.result){const[t,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(t,i)}),e):n(t,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const t of r.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,n)}),e):t(i,n);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((t=>t!==n)),r.callbacks.length||(r.cancel(),delete this.entries[t]))}}}function Vf(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const n=Pt(t.request,((t,n,r,o)=>{t?e(t):n&&e(null,{vectorTile:i?void 0:new hu.VectorTile(new lh(n)),rawData:n,cacheControl:r,expires:o})}));return()=>{n.cancel(),e()}}),e)}t.ARRAY_TYPE=pl,t.AUTH_ERR_MSG=nt,t.Aabb=Kl,t.Actor=class{constructor(t,i,n){this.target=t,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},C(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=D()?t:e,this.scheduler=new Kd}send(t,e,i,n,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=F(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:Dr(e,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||D()){const t=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Rr(e.error)):i(null,Rr(e.data)))}else{const i=F(this.globalScope)?void 0:[],n=e.hasCallback?(e,n)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Dr(e):null,data:Dr(n,i)},i)}:t=>{},r=Rr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,r,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],r.source)[t[1]](r,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=Su,t.Color=ye,t.ColorMode=If,t.CullFaceMode=kf,t.DEMData=wf,t.DataConstantProperty=jo,t.DedupedRequest=Uf,t.DepthMode=Sf,t.EXTENT=ba,t.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,r=Math.floor(t.x),o=Math.floor((t.x-r)*n),s=Math.floor(t.y*n),a=this.findDEMTileFor(new Eu(i,r,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const r=n.getSource().maxzoom,o=1<<r,s=Math.floor(t.x),a=t.x-s,l=new Eu(r,s,r,Math.floor(a*o),Math.floor(t.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return e;const u=c.dem,h=1<<c.tileID.canonical.z,p=(a*h-c.tileID.canonical.x)*u.dim,d=(t.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(p),m=Math.floor(d);return(i?this.exaggeration():1)*yi(yi(u.get(f,m),u.get(f,m+1),d-m),yi(u.get(f+1,m),u.get(f+1,m+1),d-m),p-f)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Da(t.wrap+(t.canonical.x+e/ba)/n,(t.canonical.y+i/ba)/n))}getAtTileOffsetFunc(t,e,i,n){return r=>{const o=this.getAtTileOffset(t,r.x,r.y),s=n.upVector(t.canonical,r.x,r.y);return Pl(s,s,o*n.upVectorScale(t.canonical,e,i).metersToTile),s}}getForTilePoints(t,e,i,n){const r=Rf.create(this,t,n);return!!r&&(e.forEach((t=>{t[2]=this.exaggeration()*r.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,r=1<<t.canonical.z-n.canonical.z;let o=t.canonical.x/r-n.canonical.x,s=t.canonical.y/r-n.canonical.y,a=0;for(let e=0;e<t.canonical.z-n.canonical.z&&!i.leaves[a];e++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=Ut,t.EvaluationParameters=Po,t.Event=$t,t.Evented=Vt,t.FillExtrusionBucket=_u,t.Frustum=Yl,t.FrustumCorners=Xl,t.GLOBE_METERS_TO_ECEF=Fp,t.GLOBE_RADIUS=Op,t.GLOBE_SCALE_MATCH_LATITUDE=45,t.GLOBE_ZOOM_THRESHOLD_MAX=6,t.GLOBE_ZOOM_THRESHOLD_MIN=5,t.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new Jo,i=new fs,n=65;for(let t=0;t<n;t++)for(let i=0;i<n;i++)e.emplaceBack(i,t);this._gridSegments=[];for(let t=0,e=0;t<Np.length;t++){const r=Np[t];for(let t=0;t<r;t++)for(let e=0;e<64;e++){const r=t*n+e;i.emplaceBack(r+1,r,r+n),i.emplaceBack(r+n,r+n+1,r+1)}const o=64*r*2;this._gridSegments.push(xa.simpleSegment(0,e,(r+1)*n,o)),e+=o}this._gridBuffer=t.createVertexBuffer(e,Rp.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new fs;for(let t=0;t<=64;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new _s,n=new _s;this._poleSegments=[];for(let t=0,e=0;t<5;t++){const r=1<<t,o=512*r/Math.PI/2,s=360/r;i.emplaceBack(0,-o,0,0,0,.5,0),n.emplaceBack(0,-o,0,0,0,.5,1);for(let t=0;t<=64;t++){const e=t/64,r=yi(0,s,e),[a,l,c]=Hp(rd,od,r,o);i.emplaceBack(a,l,c,0,0,e,0),n.emplaceBack(a,l,c,0,0,e,1)}this._poleSegments.push(xa.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,zp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,zp,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const e=new bs,i=64,n=i+1;this._wireframeSegments=[];for(let t=0,r=0;t<Np.length;t++){const o=Np[t];for(let t=0;t<o;t++)for(let r=0;r<i;r++){const i=t*n+r;e.emplaceBack(i,i+1),e.emplaceBack(i,i+n),e.emplaceBack(i,i+n+1)}const s=o*i*3;this._wireframeSegments.push(xa.simpleSegment(0,r,(o+1)*n,s)),r+=s}this._wireframeIndexBuffer=t.createIndexBuffer(e)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},t.GlyphManager=cp,t.ImagePosition=Lh,t.LineAtlas=Xd,t.LngLat=Sa,t.LngLatBounds=wa,t.LocalGlyphMode=lp,t.MAX_MERCATOR_LATITUDE=za,t.MercatorCoordinate=Da,t.ONE_EM=Yu,t.OverscaledTileID=Eu,t.Properties=qo,t.RGBAImage=lc,t.Ray=Hl,t.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",it,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!rt(t))return t;const i=at(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!rt(t))return t;const i=at(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!rt(t))return t;const r=at(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const r=at(t);return rt(t)?(r.path=`/styles/v1${r.path}/sprite${e}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${e}${i}`,lt(r))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!rt(t))return t;const n=at(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==n.authority&&512===i?"@2x":""}${Y.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${X.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${X.TILE_URL_VERSION}${n.path}`);const r=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(n.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,r)}canonicalizeTileURL(t,e){const i=at(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let r=i.params;return e&&(r=r.filter((t=>!t.match(/^access_token=/)))),r.length&&(n+=`?${r.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&rt(e),n=[];for(const e of t.tiles||[])ot(e)?n.push(this.canonicalizeTileURL(e,i)):n.push(e);return n}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=at(X.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==n.path&&(t.path=`${n.path}${t.path}`),!X.REQUIRE_ACCESS_TOKEN)return lt(t);if(e=e||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),lt(t)}},t.ResourceType=It,t.SegmentVector=xa,t.SourceCache=Pf,t.StencilMode=Ef,t.StructArrayLayout1ui2=ws,t.StructArrayLayout2f1f2i16=hs,t.StructArrayLayout2i4=Jo,t.StructArrayLayout2ui4=bs,t.StructArrayLayout3f12=ds,t.StructArrayLayout3ui6=fs,t.StructArrayLayout4i8=ts,t.StructArrayLayout5f20=vs,t.Texture=Hd,t.Tile=hf,t.Transitionable=Do,t.Uniform1f=Ks,t.Uniform1i=class extends Ys{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends Ys{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends Ys{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=Js,t.UniformColor=Qs,t.UniformMatrix2f=class extends Ys{constructor(t,e){super(t,e),this.current=ia}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},t.UniformMatrix3f=class extends Ys{constructor(t,e){super(t,e),this.current=ea}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends Ys{constructor(t,e){super(t,e),this.current=ta}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=Cu,t.ValidationError=$n,t.VectorTileWorkerSource=class extends Vt{constructor(t,e,i,n,r){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=r||Vf,this.loading={},this.loaded={},this.deduped=new Uf(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,n=t&&t.request,r=n&&n.collectResourceTiming,o=this.loading[i]=new jf(t);o.abort=this.loadVectorData(t,((s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),e(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new hu.VectorTile(new lh(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((t,i)=>{if(t||!i)return e(t);const o={};if(r){const t=$(n);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,v({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(t,e){const i=this.loaded,n=t.uid,r=this;if(i&&i[n]){const o=i[n];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain,o.projection=t.projection,o.tileTransform=ad(t.tileID.canonical,t.projection);const s=(t,i)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,n)),e(t,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}},t.WritingMode=Dh,t.ZoomHistory=Or,t.add=El,t.addDynamicAttributes=zd,t.adjoint=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=s*u-a*c,t[1]=r*c-n*u,t[2]=n*a-r*s,t[3]=a*l-o*u,t[4]=i*u-r*l,t[5]=r*o-i*a,t[6]=o*c-s*l,t[7]=n*l-i*c,t[8]=i*s-n*o,t},t.asyncAll=y,t.bezier=p,t.bindAll=C,t.boundsAttributes=cf,t.bufferConvexPolygon=function(t,e){const i=[];for(let n=0;n<t.length;n++){const r=g(n-1,-1,t.length-1),o=g(n+1,-1,t.length-1),s=t[n],a=t[o],l=t[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(s.add(h))}return i},t.cacheEntryPossiblyAdded=function(t){Et++,Et>xt&&(t.getActor().send("enforceCacheSizeLimit",vt),Et=0)},t.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:n}=t.point,r=td(i,n,t.worldSize/t._projectionScaler,0,0);return ml(r,r,Qp(qp(e)))},t.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:n,lat:r}=t._center;return td(e,i,t.worldSize,n,r)},t.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,i=t.point,n=Aa(1,t.center.lat)*e,r=t.pixelsPerMeter,o=e/(n/t.pixelsPerMeter),s=fl(new Float64Array(16));return gl(s,s,[i.x,i.y,0]),yl(s,s,[o,o,r]),Float32Array.from(s)},t.circumferenceAtLatitude=Ea,t.clamp=f,t.clearTileCache=function(t){const i=[];for(const t in bt)i.push(e.caches.delete(t)),delete bt[t];t&&Promise.all(i).catch(t).then((()=>t()))},t.clipLine=rp,t.clone=function(t){var e=new pl(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=A,t.collisionCircleLayout=Xu,t.config=X,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.create=function(){var t=new pl(16);return pl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=dl,t.createExpression=Rn,t.createLayout=Yo,t.createStyleLayer=function(t){return"custom"===t.type?new Gd(t):new Wd[t.type](t)},t.cross=Rl,t.degToRad=l,t.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},t.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},t.dot=Dl,t.ease=d,t.easeCubicInOut=h,t.emitValidationErrors=Ir,t.endsWith=E,t.enforceCacheSizeLimit=function(t){for(const e in bt)Tt(e),bt[e].then((e=>{e.keys().then((i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])}))}))},t.evaluateSizeForFeature=Qu,t.evaluateSizeForZoom=th,t.evaluateVariableOffset=wp,t.evented=Io,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=W,t.exported$1=Y,t.extend=v,t.extend$1=qt,t.fillExtrusionHeightLift=xu,t.filterObject=M,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i+i,a=n+n,l=r+r,c=i*s,u=n*s,h=n*a,p=r*s,d=r*a,f=r*l,m=o*s,g=o*a,y=o*l;return t[0]=1-h-f,t[1]=u+y,t[2]=p-g,t[3]=0,t[4]=u-y,t[5]=1-c-f,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return u[e]},t.getAABBPointSquareDist=function(t,e,i){let n=0;for(let r=0;r<2;++r){const o=i?i[r]:0;t[r]>o&&(n+=(t[r]-o)*(t[r]-o)),e[r]<o&&(n+=(o-e[r])*(o-e[r]))}return n},t.getAnchorAlignment=Zh,t.getAnchorJustification=Sp,t.getBounds=function(t){let e=1/0,i=1/0,n=-1/0,o=-1/0;for(const r of t)e=Math.min(e,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),o=Math.max(o,r.y);return{min:new r(e,i),max:new r(n,o)}},t.getColumn=B,t.getGridMatrix=function(t,e,i){const[n,r]=e,o=.015625;return[0,(r[1]-n[1])*o,1<<t.z,(r[0]-n[0])/Np[i],0,t.y,n[0],n[1],o]},t.getImage=Nt,t.getJSON=function(t,e){return kt(v(t,{type:"json"}),e)},t.getLatitudinalLod=function(t){const e=80.051129;t=f(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(l(t))),3);return Math.round(i*(Np.length-1))},t.getMapSessionAPI=gt,t.getPerformanceMeasurement=$,t.getProjection=Md,t.getRTLTextPluginStatus=Mo,t.getReferrer=At,t.getTilePoint=function(t,{x:e,y:i},n=0){return new r(((e-n)*t.scale-t.x)*ba,(i*t.scale-t.y)*ba)},t.getTileVec3=function(t,e,i=0){return Cl(((e.x-i)*t.scale-t.x)*ba,(e.y*t.scale-t.y)*ba,La(e.z,e.y))},t.getVideo=function(t,i){const n=e.document.createElement("video");n.muted=!0,n.onloadstart=function(){i(null,n)};for(let i=0;i<t.length;i++){const r=e.document.createElement("source");Dt(t[i])||(n.crossOrigin="Anonymous"),r.src=t[i],n.appendChild(r)}return{cancel:()=>{}}},t.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=fl(new Float64Array(16));return ml(i,t.pixelMatrix,t.globeMatrix),Ol(e,e,i),new r(e[0],e[1])},t.globeECEFOrigin=function(t,e){const i=[0,0,0];return Ol(i,i,Jp(qp(e.canonical))),Ol(i,i,t),i},t.globeNormalizeECEF=Jp,t.globePixelsToTileUnits=function(t,e){return ba/(512*Math.pow(2,t))*Kp(qp(e))},t.globePoleMatrixForTile=function(t,e,i){const n=fl(new Float64Array(16)),r=1<<t,o=360*(e/r-.5),s=i.point,a=i.worldSize/(i.tileSize*r);return gl(n,n,[s.x,s.y,-i.worldSize/Math.PI/2]),yl(n,n,[a,a,a]),_l(n,n,l(-i._center.lat)),vl(n,n,l(-i._center.lng+o)),Float32Array.from(n)},t.globeTileBounds=qp,t.globeTileLatLngCorners=Wp,t.globeTiltAtLngLat=id,t.globeToMercatorTransition=ed,t.globeUseCustomAntiAliasing=function(t,e,i){const n=ed(i.zoom),r=t.style.map._antialias,o=!!e.extStandardDerivatives,s=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===n&&!r&&!s&&o},t.identity=fl,t.identity$1=ql,t.invert=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,T=r*c-o*l,S=u*m-h*f,C=u*g-p*f,E=u*y-d*f,I=h*g-p*m,M=h*y-d*m,A=p*y-d*g,k=_*A-v*M+x*I+b*E-w*C+T*S;return k?(t[0]=(a*A-l*M+c*I)*(k=1/k),t[1]=(r*M-n*A-o*I)*k,t[2]=(m*T-g*w+y*b)*k,t[3]=(p*w-h*T-d*b)*k,t[4]=(l*E-s*A-c*C)*k,t[5]=(i*A-r*E+o*C)*k,t[6]=(g*x-f*T-y*v)*k,t[7]=(u*T-p*x+d*v)*k,t[8]=(s*M-a*E+c*S)*k,t[9]=(n*E-i*M-o*S)*k,t[10]=(f*w-m*x+y*_)*k,t[11]=(h*x-u*w-d*_)*k,t[12]=(a*C-s*I-l*S)*k,t[13]=(i*I-n*C+r*S)*k,t[14]=(m*v-f*b-g*_)*k,t[15]=(u*b-h*v+p*_)*k,t):null},t.isLngLatBehindGlobe=function(t,e){return id(t,e)>Math.PI/2*1.01},t.isMapAuthenticated=function(t){return yt.has(t)},t.isMapboxURL=rt,t.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!F(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=Pa,t.len=$l,t.length=Sl,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Vf,t.makeRequest=kt,t.mapValue=function(t,e,i,n,r){return f((t-e)/(i-e)*(r-n)+n,n,r)},t.mercatorXfromLng=Ia,t.mercatorYfromLat=Ma,t.mercatorZfromAltitude=Aa,t.mul=bl,t.mul$1=jl,t.multiply=ml,t.multiply$1=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=i[0],d=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],x=i[8];return t[0]=p*n+d*s+f*c,t[1]=p*r+d*a+f*u,t[2]=p*o+d*l+f*h,t[3]=m*n+g*s+y*c,t[4]=m*r+g*a+y*u,t[5]=m*o+g*l+y*h,t[6]=_*n+v*s+x*c,t[7]=_*r+v*a+x*u,t[8]=_*o+v*l+x*h,t},t.multiply$2=Ml,t.nextPowerOfTwo=T,t.normalize=zl,t.normalize$1=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=o*s,t},t.number=yi,t.ortho=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*c,t[15]=1,t},t.pbf=lh,t.perspective=function(t,e,i,n,r){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(o=1/(n-r)),t[14]=2*r*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){const i={};for(let n=0;n<e.length;n++){const r=e[n];r in t&&(i[r]=t[r])}return i},t.plugin=ko,t.pointGeometry=r,t.polygonContainsPoint=il,t.polygonIntersectsBox=nl,t.polygonIntersectsPolygon=Wa,t.polygonizeBounds=function(t,e,i=0,n=!0){const o=new r(i,i),s=t.sub(o),a=e.add(o),l=[s,new r(a.x,s.y),a,new r(s.x,a.y)];return n&&l.push(s.clone()),l},t.posAttributes=Rp,t.postMapLoadEvent=ft,t.postTurnstileEvent=pt,t.potpack=Ph,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=c,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:To,pluginURL:So}),Io.on("pluginStateChange",t),t},t.removeAuthState=function(t){yt.delete(t)},t.renderColorRamp=uc,t.resample=Oa,t.rotateX=_l,t.rotateX$1=Zl,t.rotateY=vl,t.rotateY$1=Wl,t.rotateZ=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*n,t[1]=s*r+u*n,t[2]=a*r+h*n,t[3]=l*r+p*n,t[4]=c*r-o*n,t[5]=u*r-s*n,t[6]=h*r-a*n,t[7]=p*r-l*n,t},t.rotateZ$1=function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=n*l+r*a,t[1]=r*l-n*a,t[2]=o*l+s*a,t[3]=s*l-o*a,t},t.scale=yl,t.scale$1=Ul,t.scale$2=Pl,t.scaleAndAdd=Ll,t.setCacheLimits=function(t,e){vt=t,xt=e},t.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.setRTLTextPlugin=function(t,e,i=!1){if(To===vo||To===xo||To===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");So=W.resolveURL(t),To=vo,wo=e,Eo(),i||Ao()},t.smoothstep=m,t.spec=Gt,t.storeAuthState=function(t,e){e?yt.add(t):yt.delete(t)},t.sub=Bl,t.subtract=Il,t.symbolSize=eh,t.tileAABB=function(t,e,i,n,r,o,s,a,l){if("globe"===l.name)return Zp(t,e,new Su(i,n,r));const c=ad({z:i,x:n,y:r},l);return new Kl([(o+c.x/c.scale)*e,e*(c.y/c.scale),s],[(o+c.x2/c.scale)*e,e*(c.y2/c.scale),a])},t.tileTransform=ad,t.transformMat3=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},t.transformMat4=Ol,t.transformMat4$1=Vl,t.transformQuat=Fl,t.translate=gl,t.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},t.triggerPluginCompletionEvent=Co,t.uniqueId=b,t.updateGlobeVertexNormal=function(t,e,i,n,r){const o=5*e+2;t.float32[o+0]=i,t.float32[o+1]=n,t.float32[o+2]=r},t.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=t=>Er(lr(t)),t.validateFog=t=>Er(vr(t)),t.validateLayer=t=>Er(dr(t)),t.validateLight=t=>Er(yr(t)),t.validateSource=t=>Er(gr(t)),t.validateStyle=Tr,t.validateTerrain=t=>Er(_r(t)),t.values=_,t.vectorTile=hu,t.version=U,t.warnOnce=P,t.window=e,t.wrap=g})),n(["./shared"],(function(t){function e(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let i="[";for(const n of t)i+=`${e(n)},`;return`${i}]`}let i="{";for(const n of Object.keys(t).sort())i+=`${n}:${e(t[n])},`;return`${i}}`}function i(i){let n="";for(const r of t.refProperties)n+=`/${e(i[r])}`;return n}class n{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,n){for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of n)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=function(t,e){const n={};for(let r=0;r<t.length;r++){const o=e&&e[t[r].id]||i(t[r]);e&&(e[t[r].id]=o);let s=n[o];s||(s=n[o]=[]),s.push(t[r])}const r=[];for(const t in n)r.push(n[t]);return r}(t.values(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(e)}}}class r{loadTile(e,i){const{uid:n,encoding:r,rawImageData:o,padding:s,buildQuadTree:a}=e,l=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap?this.getImageData(o,s):o;i(null,new t.DEMData(n,l,r,s<1,a))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}var o=function t(e,i){var n,r=e&&e.type;if("FeatureCollection"===r)for(n=0;n<e.features.length;n++)t(e.features[n],i);else if("GeometryCollection"===r)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],i);else if("Feature"===r)t(e.geometry,i);else if("Polygon"===r)s(e.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<e.coordinates.length;n++)s(e.coordinates[n],i);return e};function s(t,e){if(0!==t.length){a(t[0],e);for(var i=1;i<t.length;i++)a(t[i],!e)}}function a(t,e){for(var i=0,n=0,r=0,o=t.length,s=o-1;r<o;s=r++){var a=(t[r][0]-t[s][0])*(t[s][1]+t[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!e&&t.reverse()}const l=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.pointGeometry(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.pointGeometry(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return l.call(this,t,e,i)}}class u{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new c(this._features[t])}}var h=t.vectorTile.VectorTileFeature,p=d;function d(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}d.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var n=e[i],r=[],o=0;o<n.length;o++)r.push(new t.pointGeometry(n[o][0],n[o][1]));this.geometry.push(r)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=y,g=p;function y(e){var i=new t.pbf;return function(t,e){for(var i in t.layers)e.writeMessage(3,_,t.layers[i])}(e,i),i.finish()}function _(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,v,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)e.writeMessage(4,S,o[i])}function v(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,x,t),e.writeVarintField(3,i.type),e.writeMessage(4,T,i)}function x(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,p=s[h];void 0===p&&(r.push(l),s[h]=p=r.length-1),e.writeVarint(p)}}}function b(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function T(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),e.writeVarint(b(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&e.writeVarint(b(2,u-1));var p=l[h].x-r,d=l[h].y-o;e.writeVarint(w(p)),e.writeVarint(w(d)),r+=p,o+=d}3===n&&e.writeVarint(b(7,1))}}function S(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function C(t,e,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;E(t,e,s,n,r,o%2),C(t,e,i,n,s-1,o+1),C(t,e,i,s+1,r,o+1)}function E(t,e,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);E(t,e,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=n,l=r;for(I(t,e,n,i),e[2*r+o]>s&&I(t,e,n,r);a<l;){for(I(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*n+o]===s?I(t,e,n,l):(l++,I(t,e,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function I(t,e,i,n){M(t,i,n),M(e,2*i,2*n),M(e,2*i+1,2*n+1)}function M(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function A(t,e,i,n){const r=t-i,o=e-n;return r*r+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new p(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return y({layers:i})},m.GeoJSONWrapper=g;class k{constructor(t,e,i,n=64,r){this.nodeSize=n,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),a=this.coords=new r(2*t.length);for(let n=0;n<t.length;n++)s[n]=n,a[2*n]=e(t[n]),a[2*n+1]=i(t[n]);C(s,a,n,0,s.length-1,0)}range(t,e,i,n){return function(t,e,i,n,r,o,s){const a=[0,t.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),p=a.pop(),d=a.pop();if(p-d<=s){for(let s=d;s<=p;s++)c=e[2*s],u=e[2*s+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(t[s]);continue}const f=Math.floor((d+p)/2);c=e[2*f],u=e[2*f+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(t[f]);const m=(h+1)%2;(0===h?i<=c:n<=u)&&(a.push(d),a.push(f-1),a.push(m)),(0===h?r>=c:o>=u)&&(a.push(f+1),a.push(p),a.push(m))}return l}(this.ids,this.coords,t,e,i,n,this.nodeSize)}within(t,e,i){return function(t,e,i,n,r,o){const s=[0,t.length-1,0],a=[],l=r*r;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let r=h;r<=u;r++)A(e[2*r],e[2*r+1],i,n)<=l&&a.push(t[r]);continue}const p=Math.floor((h+u)/2),d=e[2*p],f=e[2*p+1];A(d,f,i,n)<=l&&a.push(t[p]);const m=(c+1)%2;(0===c?i-r<=d:n-r<=f)&&(s.push(h),s.push(p-1),s.push(m)),(0===c?i+r>=d:n+r>=f)&&(s.push(p+1),s.push(u),s.push(m))}return a}(this.ids,this.coords,t,e,i,this.nodeSize)}}const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},L=Math.fround||(z=new Float32Array(1),t=>(z[0]=+t,z[0]));var z;class D{constructor(t){this.options=U(Object.create(P),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:i,maxZoom:n,nodeSize:r}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let s=[];for(let e=0;e<t.length;e++)t[e].geometry&&s.push(O(t[e],e));this.trees[n+1]=new k(s,V,G,r,Float32Array),e&&console.timeEnd(o);for(let t=n;t>=i;t--){const i=+Date.now();s=this._cluster(s,t),this.trees[t]=new k(s,V,G,r,Float32Array),e&&console.log("z%d: %d clusters in %dms",t,s.length,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){const t=this.getClusters([i,n,180,o],e),s=this.getClusters([-180,n,r,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(B(i),j(o),B(r),j(n)),l=[];for(const t of a){const e=s.points[t];l.push(e.numPoints?F(e):this.points[e.index])}return l}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.points[e];if(!o)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o.x,o.y,s),l=[];for(const e of a){const i=r.points[e];i.parentId===t&&l.push(i.numPoints?F(i):this.points[i.index])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,l,(e+1+a)/r,c),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.points,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,r){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(t,o.cluster_id,i,n,r):r<n?r++:t.push(e),t.length===i)break}return r}_addTileFeatures(t,e,i,n,r,o){for(const s of t){const t=e[s],a=t.numPoints;let l,c,u;if(a)l=N(t),c=t.x,u=t.y;else{const e=this.points[t.index];l=e.properties,c=B(e.geometry.coordinates[0]),u=j(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let p;a?p=t.id:this.options.generateId?p=t.index:this.points[t.index].id&&(p=this.points[t.index].id),void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const i=[],{radius:n,extent:r,reduce:o,minPoints:s}=this.options,a=n/(r*Math.pow(2,e));for(let n=0;n<t.length;n++){const r=t[n];if(r.zoom<=e)continue;r.zoom=e;const l=this.trees[e+1],c=l.within(r.x,r.y,a),u=r.numPoints||1;let h=u;for(const t of c){const i=l.points[t];i.zoom>e&&(h+=i.numPoints||1)}if(h>u&&h>=s){let t=r.x*u,s=r.y*u,a=o&&u>1?this._map(r,!0):null;const p=(n<<5)+(e+1)+this.points.length;for(const i of c){const n=l.points[i];if(n.zoom<=e)continue;n.zoom=e;const c=n.numPoints||1;t+=n.x*c,s+=n.y*c,n.parentId=p,o&&(a||(a=this._map(r,!0)),o(a,this._map(n)))}r.parentId=p,i.push(R(t/h,s/h,p,h,a))}else if(i.push(r),h>1)for(const t of c){const n=l.points[t];n.zoom<=e||(n.zoom=e,i.push(n))}}return i}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?U({},t.properties):t.properties;const i=this.points[t.index].properties,n=this.options.map(i);return e&&n===i?U({},n):n}}function R(t,e,i,n,r){return{x:L(t),y:L(e),zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function O(t,e){const[i,n]=t.geometry.coordinates;return{x:L(B(i)),y:L(j(n)),zoom:1/0,index:e,parentId:-1}}function F(t){return{type:"Feature",id:t.id,properties:N(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),$(t.y)]}};var e}function N(t){const e=t.numPoints,i=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return U(U({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:i})}function B(t){return t/360+.5}function j(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function $(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function U(t,e){for(const i in e)t[i]=e[i];return t}function V(t){return t.x}function G(t){return t.y}function q(t,e,i,n){for(var r,o=n,s=i-e>>1,a=i-e,l=t[e],c=t[e+1],u=t[i],h=t[i+1],p=e+3;p<i;p+=3){var d=Z(t[p],t[p+1],l,c,u,h);if(d>o)r=p,o=d;else if(d===o){var f=Math.abs(p-s);f<a&&(r=p,a=f)}}o>n&&(r-e>3&&q(t,e,r,n),t[r+2]=o,i-r>3&&q(t,r,i,n))}function Z(t,e,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return(s=t-i)*s+(a=e-n)*a}function W(t,e,i,n){var r={id:void 0===t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,i=t.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)H(t,e);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<e.length;n++)H(t,e[n]);else if("MultiPolygon"===i)for(n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)H(t,e[n][r])}(r),r}function H(t,e){for(var i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function X(t,e,i,n){if(e.geometry){var r=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)Y(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)Y(r[c],a);else if("LineString"===o)K(r,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<r.length;c++)K(r[c],a=[],s,!1),t.push(W(l,"LineString",a,e.properties));return}J(r,a,s,!1)}else if("Polygon"===o)J(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)X(t,{id:l,geometry:e.geometry.geometries[c],properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];J(r[c],u,s,!0),a.push(u)}}t.push(W(l,o,a,e.properties))}}function Y(t,e){e.push(Q(t[0])),e.push(tt(t[1])),e.push(0)}function K(t,e,i,n){for(var r,o,s=0,a=0;a<t.length;a++){var l=Q(t[a][0]),c=tt(t[a][1]);e.push(l),e.push(c),e.push(0),a>0&&(s+=n?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=e.length-3;e[2]=1,q(e,0,u,i),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function J(t,e,i,n){for(var r=0;r<t.length;r++){var o=[];K(t[r],o,i,n),e.push(o)}}function Q(t){return t/360+.5}function tt(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function et(t,e,i,n,r,o,s,a){if(n/=e,o>=(i/=e)&&s<n)return t;if(s<i||o>=n)return null;for(var l=[],c=0;c<t.length;c++){var u=t[c],h=u.geometry,p=u.type,d=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(d>=i&&f<n)l.push(u);else if(!(f<i||d>=n)){var m=[];if("Point"===p||"MultiPoint"===p)it(h,m,i,n,r);else if("LineString"===p)nt(h,m,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===p)ot(h,m,i,n,r,!1);else if("Polygon"===p)ot(h,m,i,n,r,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var y=[];ot(h[g],y,i,n,r,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===p){for(g=0;g<m.length;g++)l.push(W(u.id,p,m[g],u.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),l.push(W(u.id,p,m,u.tags))}}}return l.length?l:null}function it(t,e,i,n,r){for(var o=0;o<t.length;o+=3){var s=t[o+r];s>=i&&s<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function nt(t,e,i,n,r,o,s){for(var a,l,c=rt(t),u=0===r?at:lt,h=t.start,p=0;p<t.length-3;p+=3){var d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],_=0===r?d:f,v=0===r?g:y,x=!1;s&&(a=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-y,2))),_<i?v>i&&(l=u(c,d,f,g,y,i),s&&(c.start=h+a*l)):_>n?v<n&&(l=u(c,d,f,g,y,n),s&&(c.start=h+a*l)):st(c,d,f,m),v<i&&_>=i&&(l=u(c,d,f,g,y,i),x=!0),v>n&&_<=n&&(l=u(c,d,f,g,y,n),x=!0),!o&&x&&(s&&(c.end=h+a*l),e.push(c),c=rt(t)),s&&(h+=a)}var b=t.length-3;d=t[b],f=t[b+1],m=t[b+2],(_=0===r?d:f)>=i&&_<=n&&st(c,d,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&st(c,c[0],c[1],c[2]),c.length&&e.push(c)}function rt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ot(t,e,i,n,r,o){for(var s=0;s<t.length;s++)nt(t[s],e,i,n,r,o,!1)}function st(t,e,i,n){t.push(e),t.push(i),t.push(n)}function at(t,e,i,n,r,o){var s=(o-e)/(n-e);return t.push(o),t.push(i+(r-i)*s),t.push(1),s}function lt(t,e,i,n,r,o){var s=(o-i)/(r-i);return t.push(e+(n-e)*s),t.push(o),t.push(1),s}function ct(t,e){for(var i=[],n=0;n<t.length;n++){var r,o=t[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=ut(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(ut(o.geometry[a],e))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(ut(o.geometry[a][c],e));r.push(l)}i.push(W(o.id,s,r,o.tags))}return i}function ut(t,e){var i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(var n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function ht(t,e){if(t.transformed)return t;var i,n,r,o=1<<t.z,s=t.x,a=t.y;for(i=0;i<t.features.length;i++){var l=t.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(pt(c[n],c[n+1],e,o,s,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(pt(c[n][r],c[n][r+1],e,o,s,a));l.geometry.push(h)}}return t.transformed=!0,t}function pt(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}function dt(t,e,i,n,r){for(var o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,ft(s,t[a],o,r);var l=t[a].minX,c=t[a].minY,u=t[a].maxX,h=t[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ft(t,e,i,n){var r=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)mt(s,r,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)mt(s,r[a],t,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)mt(s,c[a],t,i,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(p.id=e.id),t.features.push(p)}}function mt(t,e,i,n,r,o){var s=n*n;if(n>0&&e.size<(r?s:n))i.numPoints+=e.length/3;else{for(var a=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>s)&&(i.numSimplified++,a.push(e[l]),a.push(e[l+1])),i.numPoints++;r&&function(t,e){for(var i=0,n=0,r=t.length,o=r-2;n<r;o=n,n+=2)i+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(i>0===e)for(n=0,r=t.length;n<r/2;n+=2){var s=t[n],a=t[n+1];t[n]=t[r-2-n],t[n+1]=t[r-1-n],t[r-2-n]=s,t[r-1-n]=a}}(a,o),t.push(a)}}function gt(t,e){var i=(e=this.options=function(t,e){for(var i in e)t[i]=e[i];return t}(Object.create(this.options),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)X(i,t.features[n],e,n);else X(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var i=e.buffer/e.extent,n=t,r=et(t,1,-1-i,i,0,-1,2,e),o=et(t,1,1-i,2+i,0,-1,2,e);return(r||o)&&(n=et(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=ct(r,1).concat(n)),o&&(n=n.concat(ct(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yt(t,e,i){return 32*((1<<t)*i+e)+t}function _t(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const r=new u(n.features);let o=m(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:r,rawData:o.buffer})}gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(t,e,i,n,r,o,s){for(var a=[t,e,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=yt(e,i,n),p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=dt(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(p.source=t,r){if(e===l.maxZoom||e===r)continue;var f=1<<r-e;if(i!==Math.floor(o/f)||n!==Math.floor(s/f))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,T=.5+b,S=1+b;m=g=y=_=null,v=et(t,u,i-b,i+T,0,p.minX,p.maxX,l),x=et(t,u,i+w,i+S,0,p.minX,p.maxX,l),t=null,v&&(m=et(v,u,n-b,n+T,1,p.minY,p.maxY,l),g=et(v,u,n+w,n+S,1,p.minY,p.maxY,l),v=null),x&&(y=et(x,u,n-b,n+T,1,p.minY,p.maxY,l),_=et(x,u,n+w,n+S,1,p.minY,p.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*i,2*n),a.push(g||[],e+1,2*i,2*n+1),a.push(y||[],e+1,2*i+1,2*n),a.push(_||[],e+1,2*i+1,2*n+1)}}},gt.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug;if(t<0||t>24)return null;var s=1<<t,a=yt(t,e=(e%s+s)%s,i);if(this.tiles[a])return ht(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var l,c=t,u=e,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[yt(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?ht(this.tiles[a],r):null):null};class vt extends t.VectorTileWorkerSource{constructor(t,e,i,n,r){super(t,e,i,n,_t),r&&(this.loadGeoJSON=r)}loadData(e,i){const n=e&&e.request,r=n&&n.collectResourceTiming;this.loadGeoJSON(e,((s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(e.filter){const i=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const n=a.features.filter((t=>i.value.evaluate({zoom:0},t)));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=e.cluster?new D(void 0).load(a.features):function(t,e){return new gt(t,e)}(a,e.geojsonVtOptions)}catch(s){return i(s)}this.loaded={};const l={};if(r){const i=t.getPerformanceMeasurement(n);i&&(l.resourceTiming={},l.resourceTiming[e.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.getJSON(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class xt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:vt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,i){this.isSpriteLoaded[e]=i;for(const n in this.workerSources[e]){const r=this.workerSources[e][n];for(const e in r)r[e]instanceof t.VectorTileWorkerSource&&(r[e].isSpriteLoaded=i,r[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,i){this.availableImages[t]=e;for(const i in this.workerSources[t]){const n=this.workerSources[t][i];for(const t in n)n[t].availableImages=e}i()}enableTerrain(t,e,i){this.terrain=e,i()}setProjection(e,i){this.projections[e]=t.getProjection(i)}setLayers(t,e,i){this.getLayerIndex(t).replace(e),i()}updateLayers(t,e,i){this.getLayerIndex(t).update(e.layers,e.removedIds),i()}loadTile(e,i,n){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source).loadTile(r,n)}loadDEMTile(e,i,n){const r=this.enableTerrain?t.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(e,i.source).loadTile(r,n)}reloadTile(e,i,n){const r=this.enableTerrain?t.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,i.type,i.source).reloadTile(r,n)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source).removeTile(e,i)}removeSource(t,e,i){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,n){try{t.plugin.setState(i);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const i=t.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){n(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e}getWorkerSource(t,e,i){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][i]||(this.workerSources[t][e][i]=new this.workerSourceTypes[e]({send:(e,i,n,r,o,s)=>{this.actor.send(e,i,n,t,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded[t])),this.workerSources[t][e][i]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new r),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,i){t.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),n(["./shared"],(function(t){function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],i[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const n in t)if(!e(t[n],i[n]))return!1;return!0}return t===i}var i=n;function n(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===r[e=t&&t.failIfMajorPerformanceCaveat]&&(r[e]=function(t){var e,i=function(t){var e=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}(t);if(!i)return!1;try{e=i.createShader(i.VERTEX_SHADER)}catch(t){return!1}return!(!e||i.isContextLost())&&(i.shaderSource(e,"void main() {}"),i.compileShader(e),!0===i.getShaderParameter(e,i.COMPILE_STATUS))}(e)),r[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var r={};function o(e,i,n){const r=t.window.document.createElement(e);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r}function s(e,i,n){const r=t.window.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(i))r.setAttributeNS(null,t,i[t]);return n&&n.appendChild(r),r}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=t.window.document&&t.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function p(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",p,!0)}function d(){t.window.addEventListener("click",p,!0),t.window.setTimeout((()=>{t.window.removeEventListener("click",p,!0)}),0)}function f(t,e){const i=t.getBoundingClientRect();return y(t,i,e)}function m(t,e){const i=t.getBoundingClientRect(),n=[];for(let r=0;r<e.length;r++)n.push(y(t,i,e[r]));return n}function g(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function y(e,i,n){const r=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.pointGeometry((n.clientX-i.left)*r,(n.clientY-i.top)*r)}function _(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=i*o-r*n;return s?(t[0]=o*(s=1/s),t[1]=-n*s,t[2]=-r*s,t[3]=i*s,t):null}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class x extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let i=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(i=!1);this.isLoaded()||i?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,i){const n={};for(const i of e){this.images[i]||this.fire(new t.Event("styleimagemissing",{id:i}));const e=this.images[i];e?n[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const i=this.patterns[e],n=this.getImage(e);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const i=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:n}=t.potpack(e),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],n=i.x+1,o=i.y+1,s=this.images[e].data,a=s.width,l=s.height;t.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o},{width:a,height:l}),t.RGBAImage.copy(s,r,{x:0,y:l-1},{x:n,y:o-1},{width:a,height:1}),t.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o+l},{width:a,height:1}),t.RGBAImage.copy(s,r,{x:a-1,y:0},{x:n-1,y:o},{width:1,height:l}),t.RGBAImage.copy(s,r,{x:0,y:0},{x:n+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];v(t)&&this.updateImage(e,t)}}}const b=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,i){return function([e,i,n]){const r=t.degToRad(i+90),o=t.degToRad(n);return{x:e*Math.cos(r)*Math.sin(o),y:e*Math.sin(r)*Math.sin(o),z:e*Math.cos(o),azimuthal:i,polar:n}}(e.expression.evaluate(i))}interpolate(e,i,n){return{x:t.number(e.x,i.x,n),y:t.number(e.y,i.y,n),z:t.number(e.z,i.z,n),azimuthal:t.number(e.azimuthal,i.azimuthal,n),polar:t.number(e.polar,i.polar,n)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),w="-transition";class T extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(b),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.validateLight,e,i))for(const i in e){const n=e[i];t.endsWith(i,w)?this._transitionable.setTransition(i.slice(0,-w.length),n):this._transitionable.setValue(i,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const S=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),C="-transition";class E extends t.Evented{constructor(e,i){super(),this._transitionable=new t.Transitionable(S),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e){for(const i in e){const n=e[i];t.endsWith(i,C)?this._transitionable.setTransition(i.slice(0,-C.length),n):this._transitionable.setValue(i,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function I(e,i,n,r){const o=t.smoothstep(45,65,n),[s,a]=M(e,r),l=t.length(i);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*e.alpha}function M(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}const A=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"high-color":new t.DataConstantProperty(t.spec.fog["high-color"]),"space-color":new t.DataConstantProperty(t.spec.fog["space-color"]),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"]),"star-intensity":new t.DataConstantProperty(t.spec.fog["star-intensity"])}),k="-transition";class P extends t.Evented{constructor(e,i){super(),this._transitionable=new t.Transitionable(A),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const e=this._transform,i="globe"===e.projection.name,n=t.globeToMercatorTransition(e.zoom),r=this.properties.get("range"),o=[.5,3];return{range:i?[t.number(o[0],r[0],n),t.number(o[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i={}){if(!this._validate(t.validateFog,e,i)){for(const i of Object.keys(t.spec.fog))e&&void 0===e[i]&&(e[i]=t.spec.fog[i].default);for(const i in e){const n=e[i];t.endsWith(i,k)?this._transitionable.setTransition(i.slice(0,-k.length),n):this._transitionable.setValue(i,n)}}}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.smoothstep(45,65,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,n){const r=t.MercatorCoordinate.fromLngLat(i),o=n.elevation?n.elevation.getAtPointOrZero(r):0,s=[r.x,r.y,o];return t.transformMat4(s,s,n.mercatorFogMatrix),I(e,s,n.pitch,n._fov)}(this.state,e,i):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?M(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class L{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const n=this.workerPool.acquire(this.id);for(let t=0;t<n.length;t++){const e=new L.Actor(n[t],i,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,n){t.asyncAll(this.actors,((t,n)=>{t.send(e,i,n)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}function z(e,i,n){return i*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}L.Actor=t.Actor;class D{constructor(t,e,i,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let n,r;if(e instanceof t.pointGeometry||"number"==typeof e[0]){const o=t.pointGeometry.convert(e);n=[t.pointGeometry.convert(e)],r=i.isPointAboveHorizon(o)}else{const o=t.pointGeometry.convert(e[0]),s=t.pointGeometry.convert(e[1]);n=[o,s],r=t.polygonizeBounds(o,s).every((t=>i.isPointAboveHorizon(t)))}return new D(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],r=t.polygonizeBounds(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),t.bufferConvexPolygon(r,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],r=t.polygonizeBounds(i,n,e),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>n.y))+((o.x>i.x)+(o.x>n.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(e,i,n,r=0){const o=e.queryPadding/i._projectionScaler+1,s=n?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=e.tileID.wrap+(s.unwrapped?r:0);const l=s.polygon.map((i=>t.getTilePoint(e.tileTransform,i,a)));if(!t.polygonIntersectsBox(l,0,0,t.EXTENT,t.EXTENT))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>t.getTileVec3(e.tileTransform,i,a))),u=c.map((e=>new t.pointGeometry(e[0],e[1]))),h=i.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),p=t.getTileVec3(e.tileTransform,h,a),d=c.map((e=>{const i=t.sub(e,e,p);return t.normalize(i,i),new t.Ray(p,i)})),f=z(e,1,i.zoom)*i._projectionScaler;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:d,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=t.getBounds(l),m.min.x=t.clamp(m.min.x,0,t.EXTENT),m.min.y=t.clamp(m.min.y,0,t.EXTENT),m.max.x=t.clamp(m.max.x,0,t.EXTENT),m.max.y=t.clamp(m.max.y,0,t.EXTENT),m),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(t,e){const i=F(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(t,e){const i=F(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(e,i){const n=function(e,i){const n=t.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-t.GLOBE_RADIUS,0,1],o=[0,t.GLOBE_RADIUS,0,1],s=[0,0,0,1];t.transformMat4$1(r,r,n),t.transformMat4$1(o,o,n),t.transformMat4$1(s,s,n);const a=new t.pointGeometry(r[0]/r[3],r[1]/r[3]),l=new t.pointGeometry(o[0]/o[3],o[1]/o[3]),c=t.polygonContainsPoint(e,a)&&r[3]<s[3],u=t.polygonContainsPoint(e,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(t,e,i){for(let n=1;n<t.length;n++){const r=O(e.pointCoordinate3D(t[n-1]).x),o=O(e.pointCoordinate3D(t[n]).x);if(i<0){if(r<o)return{idx:n,t:-r/(o-1-r)}}else if(o<r)return{idx:n,t:(1-r)/(o+1-r)}}return null}(e,i,c?-1:1);if(!h)return null;const{idx:p,t:d}=h;let f=p>1?R(e.slice(0,p),i):[],m=p<e.length?R(e.slice(p),i):[];f=f.map((e=>new t.pointGeometry(O(e.x),e.y))),m=m.map((e=>new t.pointGeometry(O(e.x),e.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const y=t.number(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,d);let _;return _=c?[new t.pointGeometry(0,y),new t.pointGeometry(0,0),new t.pointGeometry(1,0),new t.pointGeometry(1,y)]:[new t.pointGeometry(1,y),new t.pointGeometry(1,1),new t.pointGeometry(0,1),new t.pointGeometry(0,y)],g.push(..._),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((e=>new t.MercatorCoordinate(e.x,e.y))),unwrapped:!1}}(e,i);if(n)return n;const r=function(e,i){let n=!1,r=-1/0,o=0;for(let t=0;t<e.length-1;t++)e[t].x>r&&(r=e[t].x,o=t);for(let t=0;t<e.length-1;t++){const i=(o+t)%(e.length-1),r=e[i],s=e[i+1];Math.abs(r.x-s.x)>.5&&(r.x<s.x?(r.x+=1,0===i&&(e[e.length-1].x+=1)):(s.x+=1,i+1===e.length-1&&(e[0].x+=1)),n=!0)}const s=t.mercatorXfromLng(i.center.lng);return n&&s<Math.abs(s-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:n}}(R(e,i).map((e=>new t.pointGeometry(O(e.x),e.y))),i);return{polygon:r.polygon.map((e=>new t.MercatorCoordinate(e.x,e.y))),unwrapped:r.unwrapped}}}function R(e,i){return t.resample(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function O(t){return t<0?1+t%1:t%1}function F(t){return 100*t|0}function N(e,i,n,r,o){const s=function(n,r){if(n)return o(n);if(r){const n=t.pick(t.extend(r,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((t=>t.id))),r.language_options&&(n.languageOptions=r.language_options),r.language&&r.language[r.id]&&(n.language=r.language[r.id]),r.worldview_options&&(n.worldviewOptions=r.worldview_options),r.worldview?n.worldview=r.worldview[r.id]:r.worldview_default&&(n.worldview=r.worldview_default),n.tiles=i.canonicalizeTileset(n,e.url),o(null,n)}};return e.url?t.getJSON(i.transformRequest(i.normalizeSourceURL(e.url,null,n,r),t.ResourceType.Source),s):t.exported.frame((()=>s(null,e)))}class B{constructor(e,i,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*i),s=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*i);return e.x>=n&&e.x<o&&e.y>=r&&e.y<s}}class j{constructor(t,e,i){this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class U{constructor(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[$[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class V{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class G extends V{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class q extends V{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Z extends V{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class W extends V{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class H extends V{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class X extends V{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Y extends V{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class K extends V{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class J extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Q extends V{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class tt extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class et extends V{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class it extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class nt extends V{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class rt extends V{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ot extends V{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class st extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class at extends V{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class lt extends V{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class ct extends V{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ut extends V{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ht extends V{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pt extends V{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dt extends V{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ft extends V{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class mt extends V{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gt extends V{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class yt extends V{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class _t extends V{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class vt extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class xt extends V{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class bt extends V{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class wt extends bt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tt extends bt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class St extends Tt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ct{constructor(t,e,i,n){this.context=t,this.width=e,this.height=i;const r=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,r),n&&(this.depthAttachment=new Tt(t,r))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Et{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new q(this),this.clearStencil=new Z(this),this.colorMask=new W(this),this.depthMask=new H(this),this.stencilMask=new X(this),this.stencilFunc=new Y(this),this.stencilOp=new K(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new it(this),this.blendFunc=new nt(this),this.blendColor=new rt(this),this.blendEquation=new ot(this),this.cullFace=new st(this),this.cullFaceSide=new at(this),this.frontFace=new lt(this),this.program=new ct(this),this.activeTexture=new ut(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new vt(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new j(this,t,e)}createVertexBuffer(t,e,i){return new U(this,t,e,i)}createRenderbuffer(t,e,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i){return new Ct(this,t,e,i)}clear({color:t,depth:e,stencil:i}){const n=this.gl;let r=0;t&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(i){e(i.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class It extends t.Evented{constructor(e,i,n,r){super(),this.id=e,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=N(this._options,this.map._requestManager,null,null,((e,i)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(t.extend(this,i),i.bounds&&(this.tileBounds=new B(i.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(i.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const n=t.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),((n,r,o,s)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):n?(e.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s}),e.setTexture(r,this.map.painter),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(t,e,i){t.setTexture(e,i)}static unloadTileData(t,e){t.texture&&e.saveTileTexture(t.texture)}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let Mt;function At(e,i,n,r,o,s,a,l){const c=[e,n,o,i,r,s,1,1,1],u=[a,l,1],h=t.adjoint([],c),[p,d,f]=t.transformMat3(u,u,t.transpose(h,h));return t.multiply$1(c,[p,0,0,0,d,0,0,0,f],c)}class kt extends t.Evented{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}load(e,i){this._loaded=i||!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),((i,n)=>{if(this._loaded=!0,i)this.fire(new t.ErrorEvent(i));else if(n){const{HTMLImageElement:i}=t.window;this.image=n instanceof i?t.exported.getImageData(n):n,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;const i=e.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(e){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),n=Math.min(n,t.y),r=Math.max(r,t.x),o=Math.max(o,t.y);const s=Math.max(r-i,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const i=t.tileTransform(this.tileID,this.map.transform.projection),[n,r,o,s]=this.coordinates.map((e=>{const n=i.projection.project(e[0],e[1]);return t.getTilePoint(i,n)._round()}));this.perspectiveTransform=function(e,i,n,r,o,s,a,l,c,u){const h=At(0,0,e,0,0,i,e,i),p=At(n,r,o,s,a,l,c,u);return t.multiply$1(p,t.adjoint(h,h),p),[p[6]/p[8]*e/t.EXTENT,p[7]/p[8]*i/t.EXTENT]}(this.width,this.height,n.x,n.y,r.x,r.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new t.StructArrayLayout4i8;a.emplaceBack(n.x,n.y,0,0),a.emplaceBack(r.x,r.y,t.EXTENT,0),a.emplaceBack(s.x,s.y,0,t.EXTENT),a.emplaceBack(o.x,o.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(a,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture?this.texture.update(this.image):(this.texture=new t.Texture(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Pt={vector:class extends t.Evented{constructor(e,i,n,r){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(i,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(e){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,n=this.worldview||this.map._worldview;this._tileJSONRequest=N(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.ErrorEvent(r))):o&&(t.extend(this,o),o.bounds&&(this.tileBounds=new B(o.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load((()=>{const t=this.map.style._getSourceCaches(this.id);for(const e of t)e.clearTiles()}))}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}_setLanguage(t){return t===this.language||this.setSourceProperty((()=>{this.language=t})),this}_setWorldview(t){return t===this.worldview?this:this.worldviewOptions&&t&&!this.worldviewOptions[t]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${t}".`),this):(this.setSourceProperty((()=>{this.worldview=t})),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",r,o.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const i=t.loadVectorTile.call({deduped:this._deduped},r,((t,i)=>{t||!i?o.call(this,t):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function o(n,r){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:It,"raster-dem":class extends It{constructor(e,i,n,r){super(e,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const i=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&(null==Mt&&(Mt=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),Mt),n=1-(o.width-t.prevPowerOfTwo(o.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const l=i?o:t.exported.getImageData(o,n),c={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+n)%n,a=i.x+1===n?e.wrap+1:e.wrap,l={};return l[new t.OverscaledTileID(e.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new t.OverscaledTileID(e.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.OverscaledTileID(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,i,n,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(i),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,((e,i)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(e.resourceTiming=i.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,i){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(n,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((t,r)=>(delete e.request,e.unloadVectorData(),e.aborted?i(null):t?i(t):(e.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends kt{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.ResourceType.Source).url);t.getVideo(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:kt,canvas:class extends kt{constructor(e,i,n,r){super(e,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.Evented{constructor(e,i,n,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new B(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:n}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const{x:n,y:r,z:o}=e.tileID.canonical,s=new t.window.AbortController,a=this._implementation.loadTile({x:n,y:r,z:o},{signal:s.signal});if(!a)return this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",i(null);a.cancel=()=>s.abort(),e.request=a.then(function(n){return delete e.request,e.aborted?(e.state="unloaded",i(null)):n?function(e){return e instanceof t.window.ImageData||e instanceof t.window.ImageBitmap||e instanceof t.window.HTMLCanvasElement}(n)?(this.loadTileData(e,n),e.state="loaded",void i(null)):(e.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",i(null))}.bind(this)).catch((t=>{20!==t.code&&(e.state="errored",i(t))}))}loadTileData(t,e){It.loadTileData(t,e,this._map.painter)}unloadTileData(t){It.unloadTileData(t,this._map.painter)}prepareTile(t){if(!this._implementation.prepareTile)return null;const{x:e,y:i,z:n}=t.tileID.canonical,r=this._implementation.prepareTile({x:e,y:i,z:n});return r?(this.loadTileData(t,r),t.state="loaded",r):null}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:e,y:i,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:n})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Lt=function(e,i,n,r){const o=new Pt[i.type](e,i,n,r);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function zt(e,i){const n=t.identity([]);return t.scale(n,n,[.5*e.width,.5*-e.height,1]),t.translate(n,n,[1,-1,0]),t.multiply(n,n,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function Dt(t,e,i,n,r,o,s,a=!1){const l=t.tilesIn(n,s,a);l.sort(Ot);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,i,t._state,n,r,o,zt(t.transform,n.tile.tileID),a)});const u=function(t){const e={},i={};for(const n of t){const t=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in t){const n=t[i],r=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of n)r[t.featureIndex]||(r[t.featureIndex]=!0,s.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(n["source-layer"],i.id):{})}));return u}function Rt(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],r={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,e))}return n}function Ot(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Ft(){return null!=uo.workerClass?new uo.workerClass:new t.window.Worker(uo.workerUrl)}const Nt="mapboxgl_preloaded_worker_pool";class Bt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Ft);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Nt]}numActive(){return Object.keys(this.active).length}}let jt;function $t(){return jt||(jt=new Bt),jt}function Ut(e,i){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.refProperties.forEach((t=>{t in i&&(n[t]=i[t])})),n}function Vt(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Ut(t[i],e[t[i].ref]));return t}Bt.workerCount=2;const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qt(t,e,i){i.push({command:Gt.addSource,args:[t,e[t]]})}function Zt(t,e,i){e.push({command:Gt.removeSource,args:[t]}),i[t]=!0}function Wt(t,e,i,n){Zt(t,i,n),qt(t,e,i)}function Ht(t,i,n){let r;for(r in t[n])if(t[n].hasOwnProperty(r)&&"data"!==r&&!e(t[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!e(t[n][r],i[n][r]))return!1;return!0}function Xt(t,i,n,r,o,s){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e(t[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e(t[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}))}function Yt(t){return t.id}function Kt(t,e){return t[e.id]=e,t}class Jt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let i=1,n=this._distances[i];const r=e*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Qt{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(t,e,i,n,r,o){this.circleCells[r].push(o)}_query(t,e,i,n,r,o){if(i<0||t>this.width||n<0||e>this.height)return!r&&[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return o?s.filter(o):s}return this._forEachCell(t,e,i,n,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(t,e,i,n,r){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(t,e,i,n,r){return this._query(t,e,i,n,!1,r)}hitTest(t,e,i,n,r){return this._query(t,e,i,n,!0,r)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(t<=r[c+2]&&e<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],t,e,i,n)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const t=r[u],e=r[u+1],i=r[u+2];o.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const t=this.circles;for(const e of h)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+p,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,o){const s=n-t,a=r-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,p=u-c;return h*h+p*p<=i*i}}const te=Math.tan(85*Math.PI/180);function ee(e,i,n,r,o,s,a){const l=t.create();if(n)if("globe"===s.name){const e=t.calculateGlobeLabelMatrix(o,i);t.multiply(l,l,e)}else{const e=_([],a);l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],r||t.rotateZ(l,l,o.angle)}else t.multiply(l,o.labelPlaneMatrix,e);return l}function ie(t,e,i,n,r,o,s){const a=ee(t,e,i,n,r,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function ne(e,i,n,r,o,s,a){if(n){if("globe"===s.name){const l=ee(e,i,n,r,o,s,a);return t.invert(l,l),t.multiply(l,e,l),l}{const i=t.clone(e),n=t.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],t.multiply(i,i,n),r||t.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function re(e,i,n=0){const r=[e.x,e.y,n,1];n?t.transformMat4$1(r,r,i):ye(r,r,i);const o=r[3];return{point:[r[0]/o,r[1]/o,r[2]/o],signedDistanceFromCamera:o}}function oe(e,i){const n=[e[0],e[1],e[2],1];t.transformMat4$1(n,n,i);const r=n[3];return{point:[n[0]/r,n[1]/r,n[2]/r],signedDistanceFromCamera:r}}function se(t,e){return Math.min(.5+t/e*.5,1.5)}function ae(t,e){const i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function le(e,i,n,r,o,s,a,l,c,u){const h=n.transform,p=r?e.textSizeData:e.iconSizeData,d=t.evaluateSizeForZoom(p,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;g.clear();let y=null;f&&(y=r?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const _=e.lineVertexArray,v=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b=!1;for(let r=0;r<v.length;r++){const f=v.get(r);if(f.writingMode!==t.WritingMode.vertical||b||0!==r&&v.get(r-1).writingMode===t.WritingMode.horizontal||(b=!0),(f.hidden||f.writingMode===t.WritingMode.vertical)&&!b){ge(f.numGlyphs,g);continue}b=!1;const w=new t.pointGeometry(f.tileAnchorX,f.tileAnchorY),T=c?c(w):[0,0,0],S=h.projection.projectTilePoint(w.x,w.y,u.canonical),C=[S.x+T[0],S.y+T[1],S.z+T[2]],E=[...C,1];if(t.transformMat4$1(E,E,i),!ae(E,m)){ge(f.numGlyphs,g);continue}const I=se(n.transform.cameraToCenterDistance,E[3]),M=t.evaluateSizeForFeature(p,d,f),A=a?M/I:M*I,k=re(new t.pointGeometry(C[0],C[1]),o,C[2]);if(k.signedDistanceFromCamera<=0){ge(f.numGlyphs,g);continue}let P={};const L=a?null:c,z=he(f,A,!1,l,i,o,s,e.glyphOffsetArray,_,g,y,k.point,w,P,x,L,h.projection,u,a);b=z.useVertical,L&&z.needsFlipping&&(P={}),(z.notEnoughRoom||b||z.needsFlipping&&he(f,A,!0,l,i,o,s,e.glyphOffsetArray,_,g,y,k.point,w,P,x,L,h.projection,u,a).notEnoughRoom)&&ge(f.numGlyphs,g)}r?(e.text.dynamicLayoutVertexBuffer.updateData(g),y&&e.text.globeExtVertexBuffer.updateData(y)):(e.icon.dynamicLayoutVertexBuffer.updateData(g),y&&e.icon.globeExtVertexBuffer.updateData(y))}function ce(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m){const g=a.glyphStartIndex+a.numGlyphs,y=a.lineStartIndex,_=a.lineStartIndex+a.lineLength,v=e.getoffsetX(a.glyphStartIndex),x=e.getoffsetX(g-1),b=fe(t*v,i,n,r,o,s,a.segment,y,_,l,c,u,h,p,!0,d,f,m);if(!b)return null;const w=fe(t*x,i,n,r,o,s,a.segment,y,_,l,c,u,h,p,!0,d,f,m);return w?{first:b,last:w}:null}function ue(e,i,n,r){return e.writingMode===t.WritingMode.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:e.writingMode===t.WritingMode.vertical?i.y<n.y?{needsFlipping:!0}:null:0!==e.flipState&&function(t,e,i){const n=(e.x-t.x)*i;return 0===n||Math.abs((e.y-t.y)/n)>te}(i,n,r)?1===e.flipState?{needsFlipping:!0}:null:i.x>n.x?{needsFlipping:!0}:null}function he(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v){const x=i/24,b=e.lineOffsetX*x,w=e.lineOffsetY*x;let T;if(e.numGlyphs>1){const i=e.glyphStartIndex+e.numGlyphs,o=e.lineStartIndex,u=e.lineStartIndex+e.lineLength,h=ce(x,l,b,w,n,p,d,e,c,s,f,g,!1,y,_,v);if(!h)return{notEnoughRoom:!0};const S=oe(h.first.point,a).point,C=oe(h.last.point,a).point,E=new t.pointGeometry(S[0],S[1]),I=new t.pointGeometry(C[0],C[1]);if(r&&!n){const t=ue(e,E,I,m);if(e.flipState=t&&t.needsFlipping?1:2,t)return t}T=[h.first];for(let t=e.glyphStartIndex+1;t<i-1;t++)T.push(fe(x*l.getoffsetX(t),b,w,n,p,d,e.segment,o,u,c,s,f,g,!1,!1,y,_,v));T.push(h.last)}else{if(r&&!n){const i=re(d,o).point,n=e.lineStartIndex+e.segment+1,r=new t.pointGeometry(c.getx(n),c.gety(n)),s=re(r,o),a=s.signedDistanceFromCamera>0?s.point:de(d,r,i,1,o,void 0,y,_.canonical),l=ue(e,new t.pointGeometry(i[0],i[1]),new t.pointGeometry(a[0],a[1]),m);if(e.flipState=l&&l.needsFlipping?1:2,l)return l}const i=fe(x*l.getoffsetX(e.glyphStartIndex),b,w,n,p,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,s,f,g,!1,!1,y,_,v);if(!i)return{notEnoughRoom:!0};T=[i]}if(h)for(const e of T)t.updateGlobeVertexNormal(h,u.length+0,e.up[0],e.up[1],e.up[2]),t.updateGlobeVertexNormal(h,u.length+1,e.up[0],e.up[1],e.up[2]),t.updateGlobeVertexNormal(h,u.length+2,e.up[0],e.up[1],e.up[2]),t.updateGlobeVertexNormal(h,u.length+3,e.up[0],e.up[1],e.up[2]),t.addDynamicAttributes(u,e.point[0],e.point[1],e.point[2],e.angle);else for(const e of T)t.addDynamicAttributes(u,e.point[0],e.point[1],e.point[2],e.angle);return{}}function pe(e,i,n,r,o){const s=r.projectTilePoint(e.x,e.y,i);if(!o)return re(s,n,s.z);const a=o(e);return re(new t.pointGeometry(s.x+a[0],s.y+a[1]),n,s.z+a[2])}function de(e,i,n,r,o,s,a,l){const c=pe(e.add(e.sub(i)._unit()),l,o,a,s).point,u=t.sub([],n,c);return t.scaleAndAdd([],n,u,r/t.length(u))}function fe(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_){const v=r?e-i:e+i;let x=v>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=x>0?l+a:l+a+1,T=o,S=o,C=0,E=0;const I=Math.abs(v),M=[],A=[];let k=s;const P=()=>{const e=w-x;return 0===C?s:new t.pointGeometry(u.getx(e),u.gety(e))},L=()=>de(P(),k,S,I-C+1,h,d,g,y.canonical);for(;C+E<=I;){if(w+=x,w<l||w>=c)return null;if(S=T,M.push(T),f&&A.push(k||P()),T=p[w],void 0===T){k=new t.pointGeometry(u.getx(w),u.gety(w));const e=pe(k,y.canonical,h,g,d);T=e.signedDistanceFromCamera>0?p[w]=e.point:L()}else k=null;C+=E,E=t.distance(S,T)}k=k||new t.pointGeometry(u.getx(w),u.gety(w));const z=P();m&&d&&(p[w]=T=void 0===p[w]?T:L(),E=t.distance(S,T));const D=(I-C)/E,R=k.sub(z).mult(D)._add(z),O=t.sub([],T,S),F=t.scaleAndAdd([],S,O,D);let N=[0,0,1],B=O[0],j=O[1];if(_&&(N=g.upVector(y.canonical,R.x,R.y),0!==N[0]||0!==N[1]||1!==N[2])){const e=[1,0,0],i=[0,1,0];e[0]=N[2],e[1]=0,e[2]=-N[0],t.cross(i,N,e),t.normalize(e,e),t.normalize(i,i),B=t.dot(O,e),j=t.dot(O,i)}if(n){const e=t.cross([],N,O);t.normalize(e,e),t.scaleAndAdd(F,F,e,n*x)}const $=b+Math.atan2(j,B);return M.push(F),f&&A.push(R),{point:F,angle:$,path:M,tilePath:A,up:N}}const me=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(me,4*t)}}function ye(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}const _e=100;class ve{constructor(t,e,i=new Qt(t.width+200,t.height+200,25),n=new Qt(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+_e,this.screenBottomBoundary=t.height+_e,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,n,r,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,p=i.tileID;if(h&&p){const e=t.getProjection().upVector(p.canonical,i.tileAnchorX,i.tileAnchorY),n=t.getProjection().upVectorScale(p.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e[0]*h*n,c+=e[1]*h*n,u+=e[2]*h*n}const d=this.projectAndGetPerspectiveRatio(s,[l,c,u],i.tileID,"globe"===t.projection.name||!!h||this.transform.pitch>0,t.getProjection()),f=o*d.perspectiveRatio,m=(i.x1*e+n.x-i.padding)*f+d.point.x,g=(i.y1*e+n.y-i.padding)*f+d.point.y,y=(i.x2*e+n.x+i.padding)*f+d.point.x,_=(i.y2*e+n.y+i.padding)*f+d.point.y,v=d.perspectiveRatio<=.55||d.occluded;return!this.isInsideGrid(m,g,y,_)||!r&&this.grid.hitTest(m,g,y,_,a)||v?{box:[],offscreen:!1,occluded:d.occluded}:{box:[m,g,y,_],offscreen:this.isOffscreen(m,g,y,_),occluded:!1}}placeCollisionCircles(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m){const g=[],y=this.transform.elevation,_=y?y.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,e.getProjection()):t=>[0,0,0],v=new t.pointGeometry(n.tileAnchorX,n.tileAnchorY),x=e.getProjection().projectTilePoint(n.tileAnchorX,n.tileAnchorY,m.canonical),b=_(v),w=[x.x+b[0],x.y+b[1],x.z+b[2]],T="globe"===e.projection.name,S=this.projectAndGetPerspectiveRatio(a,[w[0],w[1],w[2]],m,T||!!y||this.transform.pitch>0,e.getProjection()),{perspectiveRatio:C}=S,E=(h?s/C:s*C)/t.ONE_EM,I=re(new t.pointGeometry(w[0],w[1]),l,w[2]).point,M=S.signedDistanceFromCamera>0?ce(E,o,n.lineOffsetX*E,n.lineOffsetY*E,!1,I,v,n,r,l,{},y&&!h?_:null,h&&!!y,e.getProjection(),m,h):null;let A=!1,k=!1,P=!0;if(M&&!S.occluded){const e=.5*d*C+f,n=new t.pointGeometry(-100,-100),r=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Jt,s=M.first,a=M.last;let l=[];for(let t=s.path.length-1;t>=1;t--)l.push(s.path[t]);for(let t=1;t<a.path.length;t++)l.push(a.path[t]);const h=2.5*e;if(c){const t=l.map(y&&!T?(t,e)=>{const i=_(e<s.path.length-1?s.tilePath[s.path.length-1-e]:a.tilePath[e-s.path.length+2]);return t[2]=i[2],oe(t,c)}:t=>oe(t,c));l=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let m=[];if(l.length>0){const e=l.map((e=>new t.pointGeometry(e[0],e[1])));let i=1/0,o=-1/0,s=1/0,a=-1/0;for(let t=0;t<e.length;t++)i=Math.min(i,e[t].x),s=Math.min(s,e[t].y),o=Math.max(o,e[t].x),a=Math.max(a,e[t].y);m=i>=n.x&&o<=r.x&&s>=n.y&&a<=r.y?[e]:o<n.x||i>r.x||a<n.y||s>r.y?[]:t.clipLine([e],n.x,n.y,r.x,r.y)}for(const t of m){o.reset(t,.25*e);let n=0;n=o.length<=.5*e?1:Math.ceil(o.paddedLength/h)+1;for(let t=0;t<n;t++){const r=t/Math.max(n-1,1),s=o.lerp(r),a=s.x+_e,l=s.y+_e;g.push(a,l,e,0);const c=a-e,h=l-e,d=a+e,f=l+e;if(P=P&&this.isOffscreen(c,h,d,f),k=k||this.isInsideGrid(c,h,d,f),!i&&this.grid.hitTestCircle(a,l,e,p)&&(A=!0,!u))return{circles:[],offscreen:!1,collisionDetected:A,occluded:!1}}}}return{circles:!u&&A||!k?[]:g,offscreen:P,collisionDetected:A,occluded:S.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.pointGeometry(a.x+_e,a.y+_e);n=Math.min(n,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const e of a){const n=e.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new t.pointGeometry(e.x1,e.y1),new t.pointGeometry(e.x2,e.y1),new t.pointGeometry(e.x2,e.y2),new t.pointGeometry(e.x1,e.y2)];t.polygonIntersectsPolygon(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(t,e,i,n,r){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,r){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let e=0;e<t.length;e+=4)o.insertCircle(s,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,n,r,o){const s=[i[0],i[1],i[2],1];let a=!1;if(i[2]||this.transform.pitch>0){t.transformMat4$1(s,s,e);const r="globe"===o.name;this.fogState&&n&&!r&&(a=function(e,i,n,r,o,s){const a=s.calculateFogTileMatrix(o),l=[i,n,r];return t.transformMat4(l,l,a),I(e,l,s.pitch,s._fov)}(this.fogState,i[0],i[1],i[2],n.toUnwrapped(),this.transform)>.9)}else ye(s,s,e);return{point:new t.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+_e,(-s[1]/s[3]+1)/2*this.transform.height+_e),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/s[3]*.5,1.5),signedDistanceFromCamera:s[3],occluded:r&&s[2]>s[3]||a}}isOffscreen(t,e,i,n){return i<_e||t>=this.screenRightBoundary||n<_e||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}function xe(e,i,n){const r=i.createTileMatrix(e,e.worldSize,n.toUnwrapped());return t.multiply(new Float32Array(16),e.projMatrix,r)}function be(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const n=i.clone();return n.setProjection(e.projection),xe(n,e.getProjection(),t)}function we(t,e,i){return e.name===i.projection.name?t.projMatrix:xe(i,e,t)}class Te{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Se{constructor(t,e,i,n,r,o=!1){this.text=new Te(t?t.text:null,e,i,r),this.icon=new Te(t?t.icon:null,e,n,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ce{constructor(t,e,i,n=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=n}}class Ee{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class Ie{constructor(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Me{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Ae(e,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=t.getAnchorAlignment(e),l=-(s-.5)*i,c=-(a-.5)*n,u=t.evaluateVariableOffset(e,r);return new t.pointGeometry(l+u[0]*o,c+u[1]*o)}function ke(e,i,n,r,o){const s=new t.pointGeometry(e,i);return n&&s._rotate(r?o:-o),s}class Pe{constructor(t,e,i,n,r){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new ve(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new Me(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/t.EXTENT,h=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const p=(d=n.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(d.toUnwrapped()):xe(m,f,d));var d,f,m;const g="map"===a.get("text-pitch-alignment"),y="map"===a.get("text-rotation-alignment");i.compileFilter();const _=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(n),b=ie(p,n.tileID.canonical,g,y,this.transform,o.getProjection(),x);let w=null;if(g){const e=ne(p,n.tileID.canonical,g,y,this.transform,o.getProjection(),x);w=t.multiply([],this.transform.labelPlaneMatrix,e)}let T=null;_&&n.latestFeatureIndex&&(T={unwrappedTileID:h,dynamicFilter:_,dynamicFilterNeedsFeature:v,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Ie(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const S={bucket:o,layout:a,posMatrix:p,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:T,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=t;e.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:S})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:S})}attemptAnchorPlacement(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y){const _=[h.textOffset0,h.textOffset1],v=Ae(t,i,n,_,r),x=this.collisionIndex.placeCollisionBox(d,r,e,ke(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(d,d.getSymbolInstanceIconSize(y,this.transform.zoom,p),m,ke(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)&&x.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:i,height:n,anchor:t,textScale:r,prevAnchor:e},this.markUsedJustification(d,t,h,f),d.allowVerticalPlacement&&(this.markUsedOrientation(d,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(e,i,n,r){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:p,collisionBoxArray:d,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=e.parameters,y=s.get("text-optional"),_=s.get("icon-optional"),v=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),T="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order");this.transform.setProjection(o.projection);let C=v&&(x||!o.hasIconData()||_),E=x&&(v||!o.hasTextData()||y);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d),n&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,d);const I=(e,r,d)=>{if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.pointGeometry(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[e.crossTileID]=new Ce(!1,!1,!1,!0),void(i[e.crossTileID]=!0)}if(i[e.crossTileID])return;if(p)return void(this.placements[e.crossTileID]=new Ce(!1,!1,!1));let S=!1,I=!1,M=!0,A=!1,k=!1,P=null,L={box:null,offscreen:null,occluded:null},z={box:null,offscreen:null,occluded:null},D=null,R=null,O=null,F=0,N=0,B=0;d.textFeatureIndex?F=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(F=e.featureIndex),d.verticalTextFeatureIndex&&(N=d.verticalTextFeatureIndex);const j=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,t.tileAnchorX,t.tileAnchorY):0)},$=d.textBox;if($){j($);const i=i=>{let n=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,n=t,this.markUsedOrientation(o,n,e))}return n},n=(i,n)=>{if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of o.writingModes)if(e===t.WritingMode.vertical?(L=n(),z=L):L=i(),L&&L.box&&L.box.length)break}else L=i()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];l.indexOf(t.anchor)>0&&(l=l.filter((e=>e!==t.anchor)),l.unshift(t.anchor))}const c=(t,i,n)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,r),c=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,p=T&&!x?i:null;p&&j(p);let d={box:[],offscreen:!1,occluded:!1};const y=v?2*l.length:l.length;for(let i=0;i<y;++i){const y=this.attemptAnchorPlacement(l[i%l.length],t,c,u,s,b,w,h,a,g,i>=l.length,e,r,o,n,p,f,m);if(y&&(d=y.placedGlyphBoxes,d&&d.box&&d.box.length)){S=!0,P=y.shift;break}}return d};n((()=>c($,d.iconBox,t.WritingMode.horizontal)),(()=>{const i=d.verticalTextBox;return i&&j(i),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&e.numVerticalGlyphVertices>0&&i?c(i,d.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),L&&(S=L.box,M=L.offscreen,A=L.occluded);const u=i(L&&L.box);if(!S&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const s=(i,n)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,s,i,new t.pointGeometry(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,e),this.placedOrientations[e.crossTileID]=n),l};n((()=>s($,t.WritingMode.horizontal)),(()=>{const i=d.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?(j(i),s(i,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(L&&L.box&&L.box.length)}}if(D=L,S=D&&D.box&&D.box.length>0,M=D&&D.offscreen,A=D&&D.occluded,e.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),r=t.evaluateSizeForFeature(o.textSizeData,f,i),u=s.get("text-padding");R=this.collisionIndex.placeCollisionCircles(o,v,i,o.lineVertexArray,o.glyphOffsetArray,r,a,l,c,n,w,g.predicate,e.collisionCircleDiameter*r/t.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),S=v||R.circles.length>0&&!R.collisionDetected,M=M&&R.offscreen,A=R.occluded}if(d.iconFeatureIndex&&(B=d.iconFeatureIndex),d.iconBox){const e=e=>{j(e);const i=T&&P?ke(P.x,P.y,b,w,this.transform.angle):new t.pointGeometry(0,0),n=o.getSymbolInstanceIconSize(m,this.transform.zoom,r);return this.collisionIndex.placeCollisionBox(o,n,e,i,x,h,a,g.predicate)};z&&z.box&&z.box.length&&d.verticalIconBox?(O=e(d.verticalIconBox),I=O.box.length>0):(O=e(d.iconBox),I=O.box.length>0),M=M&&O.offscreen,k=O.occluded}const U=y||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,V=_||0===e.numIconVertices;if(U||V?V?U||(I=I&&S):S=I&&S:I=S=I&&S,S&&D&&D.box&&this.collisionIndex.insertCollisionBox(D.box,s.get("text-ignore-placement"),o.bucketInstanceId,z&&z.box&&N?N:F,g.ID),I&&O&&this.collisionIndex.insertCollisionBox(O.box,s.get("icon-ignore-placement"),o.bucketInstanceId,B,g.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,F,g.ID),n)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Ee);for(let t=0;t<R.circles.length;t+=4)e.circles.push(R.circles[t+0]),e.circles.push(R.circles[t+1]),e.circles.push(R.circles[t+2]),e.circles.push(R.collisionDetected?1:0)}const G="globe"!==o.projection.name;C=C&&(G||!A),E=E&&(G||!k),this.placements[e.crossTileID]=new Ce(S||C,I||E,M||o.justReloaded),i[e.crossTileID]=!0};if(S){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];I(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)I(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,i,n,r){let o;o=r===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(i)];const s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:n.crossTileID)}markUsedOrientation(e,i,n){const r=i===t.WritingMode.horizontal||i===t.WritingMode.horizontalOnly?i:0,o=i===t.WritingMode.vertical?i:0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=r[t];o?(this.opacities[t]=new Se(o,n,e.text,e.icon,null,e.clipped),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Se(null,n,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in r){const e=r[t];if(!this.opacities[t]){const r=new Se(e,n,!1,!1);r.isHidden()||(this.opacities[t]=r,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,i,n.collisionBoxArray)}}updateBucketOpacities(e,i,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const r=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new Se(null,0,!1,!1,!0),a=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),p="none"!==r.get("icon-text-fit"),d=new Se(null,0,a&&(l||!e.hasIconData()||r.get("icon-optional")),l&&(a||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const f=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)};let m=0;for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:g}=r;let y=this.opacities[g];i[g]?y=s:y||(y=d,this.opacities[g]=y),i[g]=!0;const _=a>0||l>0,v=r.numIconVertices>0,x=this.placedOrientations[r.crossTileID],b=x===t.WritingMode.vertical,w=x===t.WritingMode.horizontal||x===t.WritingMode.horizontalOnly;if(!_&&!v||y.isHidden()||m++,_){const t=je(y.text);f(e.text,a,b?$e:t),f(e.text,l,w?$e:t);const i=y.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||b?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=i||w?1:0);const n=this.variableOffsets[r.crossTileID];n&&this.markUsedJustification(e,n.anchor,r,x);const o=this.placedOrientations[r.crossTileID];o&&(this.markUsedJustification(e,"left",r,o),this.markUsedOrientation(e,o,r))}if(v){const t=je(y.icon);r.placedIconSymbolIndex>=0&&(f(e.icon,r.numIconVertices,b?$e:t),e.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=y.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,r.numVerticalIconVertices,w?$e:t),e.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[n];if(i){let n=new t.pointGeometry(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(c){const t=this.variableOffsets[g];t?(n=Ae(t.anchor,t.width,t.height,t.textOffset,t.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):r=!1}o&&(r=!y.clipped),i.textBox&&Le(e.textCollisionBox.collisionVertexArray,y.text.placed,!r||b,n.x,n.y),i.verticalTextBox&&Le(e.textCollisionBox.collisionVertexArray,y.text.placed,!r||w,n.x,n.y)}const s=r&&Boolean(!w&&i.verticalIconBox);i.iconBox&&Le(e.iconCollisionBox.collisionVertexArray,y.icon.placed,s,p?n.x:0,p?n.y:0),i.verticalIconBox&&Le(e.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,p?n.x:0,p?n.y:0)}}}if(e.fullyClipped=0===m,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function Le(t,e,i,n,r){t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0),t.emplaceBack(e?1:0,i?1:0,n||0,r||0)}const ze=Math.pow(2,25),De=Math.pow(2,24),Re=Math.pow(2,17),Oe=Math.pow(2,16),Fe=Math.pow(2,9),Ne=Math.pow(2,8),Be=Math.pow(2,1);function je(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*ze+e*De+i*Re+e*Oe+i*Fe+e*Ne+i*Be+e}const $e=0;class Ue{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class Ve{constructor(t,e,i,n,r,o,s,a){this.placement=new Pe(t,r,o,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,n){const r=t.exported.now(),o=()=>{const e=t.exported.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=i[e[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=r)&&(!t.maxzoom||t.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new Ue(t)),this._inProgressLayer.continuePlacement(n[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ge=512/t.EXTENT/2;class qe{constructor(t,e,i){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<e.length;i++){const n=e.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,i){const n=Ge/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*t.EXTENT+e.tileAnchorX)*n),y:Math.floor((i.canonical.y*t.EXTENT+e.tileAnchorY)*n)}}findMatches(t,e,i){const n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const o=t.get(r);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);for(const t of s)if(Math.abs(t.coord.x-a.x)<=n&&Math.abs(t.coord.y-a.y)<=n&&!i[t.crossTileID]){i[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class Ze{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class We{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],n={};for(const t in i){const r=i[t];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}this.indexes[t]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,n)}else{const o=r[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,n)}}for(let t=0;t<e.symbolInstances.length;t++){const r=e.symbolInstances.get(t);r.crossTileID||(r.crossTileID=i.generate(),n[r.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new qe(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i in e.indexedSymbolInstances)for(const n of e.indexedSymbolInstances[i])delete this.usedCrossTileIDs[t][n.crossTileID]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e}}class He{constructor(){this.layerIndexes={},this.crossTileIDs=new Ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,n){let r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new We);let o=!1;const s={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const Xe=(e,i)=>t.emitValidationErrors(e,i&&i.filter((t=>"source.canvas"!==t.identifier))),Ye=t.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ke=t.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),Je={version:8,layers:[],sources:{}},Qe={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ti extends t.Evented{constructor(e,i={}){super(),this.map=e,this.dispatcher=new L($t(),this),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,i.localFontFamily?t.LocalGlyphMode.all:i.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new He,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const n=this;this._rtlTextPluginCallback=ti.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.triggerPluginCompletionEvent(e),i&&i.every((t=>t)))for(const t in n._sourceCaches){const e=n._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}))}loadURL(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,i.accessToken);const r=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(r,((e,i)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):i&&this._load(i,n)}))}loadJSON(e,i={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Je,!1)}_updateLayerCount(t,e){const i=e?1:-1;t.is3D()&&(this._num3DLayers+=i),"circle"===t.type&&(this._numCircleLayers+=i),"symbol"===t.type&&(this._numSymbolLayers+=i)}_load(e,i){if(i&&Xe(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=t.clone$1(e),this._updateMapProjection();for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const n=Vt(this.stylesheet.layers);this._order=n.map((t=>t.id)),this._layers={},this._serializedLayers={};for(let e of n)e=t.createStyleLayer(e),e.setEventedParent(this,{layer:{id:e.id}}),this._layers[e.id]=e,this._serializedLayers[e.id]=e.serialize(),this._updateLayerCount(e,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new T(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(e){this._spriteRequest=function(e,i,n){let r,o,s;const a=t.exported.devicePixelRatio>1?"@2x":"";let l=t.getJSON(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),((t,e)=>{l=null,s||(s=t,r=e,u())})),c=t.getImage(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),((t,e)=>{c=null,s||(s=t,o=e,u())}));function u(){if(s)n(s);else if(r&&o){const e=t.exported.getImageData(o),i={};for(const n in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:p,content:d}=r[n],f=new t.RGBAImage({width:o,height:s});t.RGBAImage.copy(e,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:p,content:d}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(i)for(const t in i)this.imageManager.addImage(t,i[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))}))}_validateLayer(e){const i=this.getSource(e.source);if(!i)return;const n=e.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Qe[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const i=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const t in this._updatedSources){const e=this._updatedSources[t];"reload"===e?this._reloadSource(t):"clear"===e&&this._clearSource(t)}this._updateTilesForChangedImages();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const n={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];n[t]=e.used,e.used=!1}for(const t of this._order){const i=this._layers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this._getLayerSourceCache(i);t&&(t.used=!0)}const n=this.map.painter;if(n){const t=i.getProgramIds();if(!t)continue;const r=i.getProgramConfiguration(e.zoom);for(const e of t)n.useProgram(e,r)}}for(const e in n){const i=this._sourceCaches[e];n[e]!==i.used&&i.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Xe(this,t.validateStyle(i)))return!1;(i=t.clone$1(i)).layers=Vt(i.layers);const n=function(t,i){if(!t)return[{command:Gt.setStyle,args:[i]}];let n=[];try{if(!e(t.version,i.version))return[{command:Gt.setStyle,args:[i]}];e(t.center,i.center)||n.push({command:Gt.setCenter,args:[i.center]}),e(t.zoom,i.zoom)||n.push({command:Gt.setZoom,args:[i.zoom]}),e(t.bearing,i.bearing)||n.push({command:Gt.setBearing,args:[i.bearing]}),e(t.pitch,i.pitch)||n.push({command:Gt.setPitch,args:[i.pitch]}),e(t.sprite,i.sprite)||n.push({command:Gt.setSprite,args:[i.sprite]}),e(t.glyphs,i.glyphs)||n.push({command:Gt.setGlyphs,args:[i.glyphs]}),e(t.transition,i.transition)||n.push({command:Gt.setTransition,args:[i.transition]}),e(t.light,i.light)||n.push({command:Gt.setLight,args:[i.light]}),e(t.fog,i.fog)||n.push({command:Gt.setFog,args:[i.fog]}),e(t.projection,i.projection)||n.push({command:Gt.setProjection,args:[i.projection]});const r={},o=[];!function(t,i,n,r){let o;for(o in i=i||{},t=t||{})t.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Zt(o,n,r));for(o in i)i.hasOwnProperty(o)&&(t.hasOwnProperty(o)?e(t[o],i[o])||("geojson"===t[o].type&&"geojson"===i[o].type&&Ht(t,i,o)?n.push({command:Gt.setGeoJSONSourceData,args:[o,i[o].data]}):Wt(o,i,n,r)):qt(o,i,n))}(t.sources,i.sources,o,r);const s=[];t.layers&&t.layers.forEach((t=>{t.source&&r[t.source]?n.push({command:Gt.removeLayer,args:[t.id]}):s.push(t)}));let a=t.terrain;a&&r[a.source]&&(n.push({command:Gt.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),e(a,i.terrain)||n.push({command:Gt.setTerrain,args:[i.terrain]}),function(t,i,n){i=i||[];const r=(t=t||[]).map(Yt),o=i.map(Yt),s=t.reduce(Kt,{}),a=i.reduce(Kt,{}),l=r.slice(),c=Object.create(null);let u,h,p,d,f,m,g;for(u=0,h=0;u<r.length;u++)p=r[u],a.hasOwnProperty(p)?h++:(n.push({command:Gt.removeLayer,args:[p]}),l.splice(l.indexOf(p,h),1));for(u=0,h=0;u<o.length;u++)p=o[o.length-1-u],l[l.length-1-u]!==p&&(s.hasOwnProperty(p)?(n.push({command:Gt.removeLayer,args:[p]}),l.splice(l.lastIndexOf(p,l.length-h),1)):h++,m=l[l.length-u],n.push({command:Gt.addLayer,args:[a[p],m]}),l.splice(l.length-u,0,p),c[p]=!0);for(u=0;u<o.length;u++)if(p=o[u],d=s[p],f=a[p],!c[p]&&!e(d,f))if(e(d.source,f.source)&&e(d["source-layer"],f["source-layer"])&&e(d.type,f.type)){for(g in Xt(d.layout,f.layout,n,p,null,Gt.setLayoutProperty),Xt(d.paint,f.paint,n,p,null,Gt.setPaintProperty),e(d.filter,f.filter)||n.push({command:Gt.setFilter,args:[p,f.filter]}),e(d.minzoom,f.minzoom)&&e(d.maxzoom,f.maxzoom)||n.push({command:Gt.setLayerZoomRange,args:[p,f.minzoom,f.maxzoom]}),d)d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xt(d[g],f[g],n,p,g.slice(6),Gt.setPaintProperty):e(d[g],f[g])||n.push({command:Gt.setLayerProperty,args:[p,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!d.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xt(d[g],f[g],n,p,g.slice(6),Gt.setPaintProperty):e(d[g],f[g])||n.push({command:Gt.setLayerProperty,args:[p,g,f[g]]}))}else n.push({command:Gt.removeLayer,args:[p]}),m=l[l.lastIndexOf(p)+1],n.push({command:Gt.addLayer,args:[f,m]})}(s,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Gt.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((t=>!(t.command in Ke)));if(0===n.length)return!1;const r=n.filter((t=>!(t.command in Ye)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((t=>t.command)).join(", ")}.`);return n.forEach((t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,i),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e),this._afterImageUpdated(e),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(e,i,n={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.validateSource,`sources.${e}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Lt(e,i,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(e),source:r.serialize(),sourceId:e})));const o=i=>{const n=(i?"symbol:":"other:")+e,o=this._sourceCaches[n]=new t.SourceCache(n,r,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const i=this.getSource(e);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(e);for(const e of n)delete this._sourceCaches[e.id],delete this._updatedSources[e.id],e.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles();return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,i,n={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===e.type){if(Xe(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(r,e.source),e=t.clone$1(e),e=t.extend(e,{source:r})),this._validate(t.validateLayer,`layers.${r}`,e,{arrayIndex:-1},n))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&a&&"custom"!==o.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const n=this._order.indexOf(e);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,i,n){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,n,r={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!e(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateFilter,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=t.clone$1(n),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){const i=this.getLayer(e);return i&&t.clone$1(i.filter)}setLayoutProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?e(s.getLayoutProperty(n),r)||(s.setLayoutProperty(n,r,o),this._updateLayer(s)):this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,i){const n=this.getLayer(e);if(n)return n.getLayoutProperty(i);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?e(s.getPaintProperty(n),r)||(s.setPaintProperty(n,r,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){const i=this.getLayer(t);return i&&i.getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const n=e.source,r=e.sourceLayer,o=this.getSource(n);if(!o)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&r)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(n);for(const t of a)t.setFeatureState(r,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const n=e.source,r=this.getSource(n);if(!r)return void this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(n);for(const t of a)t.removeFeatureState(s,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,n=e.sourceLayer,r=this.getSource(i);if(r){if("vector"!==r.type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(e(o)){i[o]=r;for(const e of t){const t=e[o];if(t)for(const e of t)n.push(e)}}}n.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(i[e.layer.id]<o)break;r.push(e),n.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,i,n){i&&i.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=i&&i.layers?i.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),a=D.createFromScreenPoints(e,n);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;i.layers&&!r[e]||o.push(Dt(this._sourceCaches[t],this._layers,this._serializedLayers,a,i,n,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort(Ot);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],r=n[t];r.sort(((t,e)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of r)e.push(t)}}for(const e in a)a[e].forEach((n=>{const r=n.feature,o=i(t[e]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const n=this._getSourceCaches(e);let r=[];for(const t of n)r=r.concat(Rt(t,i));return r}addSourceType(t,e,i){return ti.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(ti.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in t)if(!e(t[i],n[i])){r=!0;break}if(!r)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===n){if("object"==typeof i.source){const e="terrain-dem-src";this.addSource(e,i.source),i=t.clone$1(i),i=t.extend(i,{source:e})}if(this._validate(t.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode)this._createTerrain(i,n);else{const n=this.terrain,r=n.get();for(const e of Object.keys(t.spec.terrain))!i.hasOwnProperty(e)&&t.spec.terrain[e].default&&(i[e]=t.spec.terrain[e].default);for(const t in i)if(!e(i[t],r[t])){n.set(i),this.stylesheet.terrain=i;const t=this._setTransitionParameters({duration:0});n.updateTransitions(t);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new P(t,this.map.transform);this.stylesheet.fog=t;const i=this._setTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,n=i.get();0===Object.keys(t).length&&i.set(t);for(const r in t)if(!e(t[r],n[r])){i.set(t),this.stylesheet.fog=t;const e=this._setTransitionParameters({duration:0});i.updateTransitions(e);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(e){return{now:t.exported.now(),transition:t.extend(e,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter((t=>this.isLayerDraped(this._layers[t]))),e=this._order.filter((t=>!this.isLayerDraped(this._layers[t])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new E(t,e);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const n=this._setTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,n,r,o={}){return(!o||!1!==o.validate)&&Xe(this,e.call(t.validateStyle,t.extend({key:i,style:this.serialize(),value:n,styleSpec:t.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const t of e)t.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const t of e)t.resume(),t.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,n,r,o=!1){let s=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this._getLayerSourceCache(i);if(!t)continue;l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng,e.projection);s=s||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new Ve(e,this._order,o,i,n,r,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,i){this.imageManager.getImages(e.icons,i),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,i)}getResource(e,i,n){return t.makeRequest(i,n)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this._getSourceCaches(e);return 0===i.length?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ti.getSourceType=function(t){return Pt[t]},ti.setSourceType=function(t,e){Pt[t]=e},ti.registerForPluginStateChange=t.registerForPluginStateChange;var ei="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ii="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ni={},ri={};ni=ci("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ri=ci("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const oi=ci("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),si=ei,ai="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var li={background:ci("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ci("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ci("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ci("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ci("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ci("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ci("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ci("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ci("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ci("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ci("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ci("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ci("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ci("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxGradient:ci("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxCapture:ci("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ci("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ci(t,e,i){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=t.match(r),a=e.match(r),l=ei.match(r);let c=a?a.concat(s):s;i||(ni.staticUniforms&&(c=ni.staticUniforms.concat(c)),ri.staticUniforms&&(c=ri.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:t=t.replace(n,((t,e,i,n,r)=>(u[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`))),vertexSource:e=e.replace(n,((t,e,i,n,r)=>{const o="float"===n?"vec2":"vec4",s=r.match(/color/)?"color":o;return u[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:o,staticUniforms:c}}class ui{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,n,r,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==n.length;for(let t=0;!c&&t<n.length;t++)this.boundPaintVertexBuffers[t]!==n[t]&&(c=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===i&&!c&&this.boundIndexBuffer===r&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a&&this.boundDynamicVertexBuffer3===l?(t.bindVertexArrayOES.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind()):this.freshBind(e,i,n,r,o,s,a,l)}freshBind(t,e,i,n,r,o,s,a){let l;const c=t.numAttributes,u=this.context,h=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),l=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a;else{l=u.currentNumAttributes||0;for(let t=c;t<l;t++)h.disableVertexAttribArray(t)}e.enableAttributes(h,t);for(const e of i)e.enableAttributes(h,t);o&&o.enableAttributes(h,t),s&&s.enableAttributes(h,t),a&&a.enableAttributes(h,t),e.bind(),e.setVertexAttribPointers(h,t,r);for(const e of i)e.bind(),e.setVertexAttribPointers(h,t,r);o&&(o.bind(),o.setVertexAttribPointers(h,t,r)),n&&n.bind(),s&&(s.bind(),s.setVertexAttribPointers(h,t,r)),a&&(a.bind(),a.setVertexAttribPointers(h,t,r)),u.currentNumAttributes=c}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function hi(e,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new t.MercatorCoordinate(0,r/n).toLngLat().lat,new t.MercatorCoordinate(0,(r+1)/n).toLngLat().lat]}function pi(e,i,n,r,o,s,a){const l=e.context,c=l.gl,u=n.fbo;if(!u)return;e.prepareDrawTile();const h=e.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const p=((t,e,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const l=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),l),u_image:0,u_latrange:hi(0,e.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(e,n,r,e.terrain?i.projMatrix:null);e.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:d,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(n);h.draw(l,c.TRIANGLES,o,s,a,t.CullFaceMode.disabled,p,r.id,d,f,m)}function di(e,i,n){if(!i.needsDEMTextureUpload)return;const r=e.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(n.stride);const s=n.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new t.Texture(r,s,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function fi(e,i,n,r,o,s){const a=e.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),di(e,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const e=new t.Texture(a,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:p,tileBoundsIndexBuffer:d,tileBoundsSegments:f}=e.getMercatorTileBoundsBuffers();e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,t.CullFaceMode.disabled,((e,i)=>{const n=i.stride,r=t.create();return t.ortho(r,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(r,r,[0,-t.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),n.id,p,d,f),i.needsHillshadePrepare=!1}const mi=(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image0:new t.Uniform1i(e,i.u_image0),u_skirt_height:new t.Uniform1f(e,i.u_skirt_height)}),gi=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),yi=(t,e,i,n,r,o,s,a,l,c,u,h,p,d)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:p,u_grid_matrix:d?Float32Array.from(d):new Float32Array(9)});function _i(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const vi=new class{constructor(){this.operations={}}newMorphing(t,e,i,n,r){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:n,phase:0,duration:r,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},xi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bi(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const wi=t=>({u_matrix:t});function Ti(e,i,n,r,o){if(o>0){const s=t.exported.now(),a=(s-e.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),p=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-l,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}class Si extends t.SourceCache{constructor(t){const e={type:"raster-dem",maxzoom:t.transform.maxZoom},i=new L($t(),null),n=Lt("mock-dem",e,i,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class Ci extends t.SourceCache{constructor(t){const e=Lt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new L($t(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,n){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new t.Tile(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i}),{});for(const t in this._tiles)t in r||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ei extends t.OverscaledTileID{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class Ii extends t.Elevation{constructor(e,i){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,o]=function(e){const i=new t.StructArrayLayout4i8,n=new t.StructArrayLayout3ui6,r=131;i.reserve(17161),n.reserve(33800);const o=t.EXTENT/128,s=t.EXTENT+o/2,a=s+o;for(let e=-o;e<a;e+=o)for(let n=-o;n<a;n+=o){const r=n<0||n>s||e<0||e>s?24575:0,o=t.clamp(Math.round(n),0,t.EXTENT),a=t.clamp(Math.round(e),0,t.EXTENT);i.emplaceBack(o+r,a,o,a)}const l=(t,e)=>{const i=e*r+t;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)})),[i,n,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(n,t.boundsAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=t.SegmentVector.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ci(i.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Si(i.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(e,i,n){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const r=e.terrain.properties;this.sourceCache=0===e.terrain.drapeRenderMode?this._mockSourceCache:e._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new t.pointGeometry(n.x,n.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const n=new t.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=r.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(o)}))}(r,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const t in s){const i=s[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],o),i.usedForTerrain)continue;const n=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((t=>new Ei(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),di(this.painter,n,r))}}_prepareDemTileUniforms(t,e,i,n){if(!e||null==e.demTexture)return!1;const r=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-r.z),s=n||"";return i[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,i=e.gl;if(!this._emptyDepthBufferTexture){const n=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(e,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const n=i.dem.tree.minimums[0];return n>0&&t++,e+n}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),r=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(n,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,r,i.RGBA,{premultiply:!1}),o}setupElevationDraw(e,i,n){const r=this.painter.context,o=r.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();const l=this.painter.transform,c=l.projection,u=e.tileID.canonical;s.u_tile_tl_up=c.upVector(u,0,0),s.u_tile_tr_up=c.upVector(u,t.EXTENT,0),s.u_tile_br_up=c.upVector(u,t.EXTENT,t.EXTENT),s.u_tile_bl_up=c.upVector(u,0,t.EXTENT),s.u_tile_up_scale=n&&n.useDenormalizedUpVectorScale?t.GLOBE_METERS_TO_ECEF:c.upVectorScale(u,l.center.lat,l.worldSize).metersToTile;let h=null,p=null,d=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;d=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(p=t),this._prepareDemTileUniforms(e,i,s)&&(h=i))}if(p&&h?(r.activeTexture.set(o.TEXTURE2),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),p.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=d):(h=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,h,s)?h.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),r.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&h){const e=(1<<h.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,s)}renderToBackBuffer(e){const i=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,n,r,o){if("globe"===e.transform.projection.name)!function(e,i,n,r,o){const s=e.context,a=s.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=e.transform,p=t.globeUseCustomAntiAliasing(e,s,h),d=(t,i)=>{if(c===t)return;const n=[xi[t],"PROJECTION_GLOBE_VIEW"];p&&n.push("CUSTOM_ANTIALIASING"),i&&n.push(xi[u]),l=e.useProgram("globeRaster",null,n),c=t},f=e.colorModeForRenderPass(),m=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);vi.update(o);const g=t.calculateGlobeMercatorMatrix(h),y=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],_=e.globeSharedBuffers,v=[h.width*t.exported.devicePixelRatio,h.height*t.exported.devicePixelRatio];if((u?[!1,!0]:[!1]).forEach((u=>{c=-1;const p=u?a.LINES:a.TRIANGLES;for(const c of r){const r=n.getTile(c),x=t.StencilMode.disabled,b=i.prevTerrainTileForTile[c.key],w=i.terrainTileForTile[c.key];_i(b,w)&&vi.newMorphing(c.key,b,w,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=vi.getMorphValuesForProxy(c.key),S=T?1:0,C={useDenormalizedUpVectorScale:!0};T&&t.extend$1(C,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.easeCubicInOut(T.phase)}});const E=Float32Array.from(h.globeMatrix),I=t.globeTileLatLngCorners(c.canonical),M=t.getLatitudinalLod((I[0][0]+I[1][0])/2),A=t.getGridMatrix(c.canonical,I,M),k=t.globeNormalizeECEF(t.globeTileBounds(c.canonical)),P=yi(h.projMatrix,E,g,k,t.globeToMercatorTransition(h.zoom),y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,A);if(d(S,u),i.setupElevationDraw(r,l,C),e.prepareDrawProgram(s,l,c.toUnwrapped()),_){const[i,n,r]=u?_.getWirefameBuffers(e.context,M):_.getGridBuffers(M);l.draw(s,p,m,x,f,t.CullFaceMode.backCCW,P,"globe_raster",i,n,r)}}})),_){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];p&&o.push("CUSTOM_ANTIALIASING"),l=e.useProgram("globeRaster",null,o);for(const o of r){const{x:r,y:c,z:u}=o.canonical,p=0===c,d=c===(1<<u)-1,[g,x,b,w]=_.getPoleBuffers(u);if(w&&(p||d)){const c=n.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=t.globePoleMatrixForTile(u,r,h);const T=t.globeNormalizeECEF(t.globeTileBounds(o.canonical)),S=(e,i)=>e.draw(s,a.TRIANGLES,m,t.StencilMode.disabled,f,t.CullFaceMode.disabled,yi(h.projMatrix,_,_,T,0,y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v),"globe_pole_raster",i,b,w);i.setupElevationDraw(c,l,{}),e.prepareDrawProgram(s,l,o.toUnwrapped()),p&&S(l,g),d&&(_=t.scale(t.create(),_,[1,-1,1]),S(l,x))}}}}(e,i,n,r,o);else{const s=e.context,a=s.gl;let l,c;const u=e.options.showTerrainWireframe?2:0,h=(t,i)=>{if(c===t)return;const n=[xi[t]];i&&n.push(xi[u]),l=e.useProgram("terrainRaster",null,n),c=t},p=e.colorModeForRenderPass(),d=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);vi.update(o);const f=e.transform,m=6*Math.pow(1.5,22-f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[y,_]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),v=t.StencilMode.disabled,x=i.prevTerrainTileForTile[c.key],b=i.terrainTileForTile[c.key];_i(x,b)&&vi.newMorphing(c.key,x,b,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=vi.getMorphValuesForProxy(c.key),T=w?1:0;let S;w&&(S={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:t.easeCubicInOut(w.phase)}});const C=gi(c.projMatrix,bi(c.canonical,f.renderWorldCopies)?m/10:m);h(T,u),i.setupElevationDraw(r,l,S),e.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,g,d,v,p,t.CullFaceMode.backCCW,C,"terrain_raster",i.gridBuffer,y,_)}}))}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=[],l=i.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][e]:void 0,p=void 0!==h?r.renderCache[h]:this.pool[c++],d=void 0!==h;if(o.texture=p.tex,d&&!p.dirty){a.push(o.tileID);continue}let f;n.bindFramebuffer.set(p.fb.framebuffer),this.renderedToTile=!1,p.dirty&&(n.clear({color:t.Color.transparent,stencil:0}),p.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=i.style._layers[l[t]];if(e.isHidden(i.transform.zoom))continue;const r=i.style._getLayerSourceCache(e),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;n.viewport.set([0,0,p.fb.width,p.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(p,o,e,r),f=r?r.id:null),i.renderLayer(i,r,e,s)}this.renderedToTile?(p.dirty=!0,a.push(o.tileID)):d||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let i,n=0,r=0,o=!1;for(let s=0;s<e;++s){const e=t._layers[t.order[s]];this._style.isLayerDraped(e)?(o&&++n,++r):o||(o=!0,i=e.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-n/r),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((t=>t.dem)).map((n=>{const r=n.tileID,o=Math.pow(2,r.overscaledZ),{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,t,e,i),tile:n}}));n.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,t,e,i);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,i=e.gl,n=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const r=new t.Texture(e,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=e.createFramebuffer(n[0],n[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new St(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._layers[t],i=e.isHidden(this.painter.transform.zoom),n=e.getCrossfadeParameters(),r=!!n&&1!==n.t,o=e.hasTransition();return"custom"!==e.type&&!i&&(r||o)}))}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof It){t=!0;break}if(t)for(let t=0;t<this._style.order.length;++t){const e=this._style._layers[this._style.order[t]],i=e.isHidden(this.painter.transform.zoom),n=this._style._getLayerSourceCache(e);if("raster"!==e.type||i||!n)continue;const r=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e){const e=Ti(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,r);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(n.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const i=[];let n,r=0,o=this._style._layers[t[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<e;)o=this._style._layers[t[r]];for(;r<e;++r){const e=this._style._layers[t[r]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const n=Object.values(t[i]);e.renderCachePool.push(...n)}}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(e.getTileByID(o.key),void 0!==e.proxyCachedFBO[o.key]){const i=t[o.key],r=this.proxyToSource[o.key];let s=0;for(const t in r){const e=r[t],o=i[t];if(!o||o.length!==e.length||e.some(((e,i)=>e!==o[i]||n[t]&&n[t].hasOwnProperty(e.key)))){s=-1;break}++s}for(const t in e.proxyCachedFBO[o.key])e.renderCache[e.proxyCachedFBO[o.key][t]].dirty=s<0||s!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of r)for(const n of i){if(e.proxyCachedFBO[n.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[n.key]={},e.proxyCachedFBO[n.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,i){const n=this.painter,r=this.painter.context,o=r.gl;n._tileClippingMaskIDs={},r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const s=n.useProgram("clippingMask");for(const a of e){const e=n._tileClippingMaskIDs[a.key]=--i;s.draw(r,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,wi(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const n=[e.x,e.y,1,1];t.transformMat4$1(n,n,i.pixelMatrixInverse),t.scale$1(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,o=t.mercatorZfromAltitude(1,i.center.lat),s=[r[0],r[1],r[2]/o,0],a=t.subtract([],n.slice(0,3),s);t.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(t.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,i=e.context,n=this.proxySourceCache,r=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=i.gl,n=i.createFramebuffer(r,o,!0);i.activeTexture.set(e.TEXTURE0);const s=new t.Texture(i,{width:r,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),n.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,o);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,o]),function(e,i,n,r){if("globe"===e.transform.projection.name)return;const o=e.context,s=o.gl;o.clear({depth:1});const a=e.useProgram("terrainDepth"),l=new t.DepthMode(s.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const e of r){const r=n.getTile(e),c=gi(e.projMatrix,0);i.setupElevationDraw(r,a),a.draw(o,s.TRIANGLES,l,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(e,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,i){if(t.getSource()instanceof kt)return this._setupProxiedCoordsForImageSource(t,e,i);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],r=this.proxyCoords;for(let e=0;e<r.length;e++){const o=r[e],s=this._findTileCoveringTileID(o,t);if(s){const e=this._createProxiedId(o,s,i[o.key]&&i[o.key][t.id]);n.push(e),this.proxyToSource[o.key][t.id]=[e]}}let o=!1;for(let r=0;r<e.length;r++){const s=t.getTile(e[r]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],r=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][t.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[a.tileID.key][t.id]=[r],n.push(r),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,i,n){if(!e.getSource().loaded())return;const r=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=new t.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t)),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(e,i)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),r=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+o<s+l.min.x||n>s+l.max.x||r+o<a+l.min.y||r>a+l.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<i.length;t++){const o=e.getTile(i[t]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][e.id]),l=this.proxyToSource[s.key][e.id];l?l.push(a):this.proxyToSource[s.key][e.id]=[a],r.push(a)}}}_createProxiedId(e,i,n){let r=this.orthoMatrix;if(n){const t=n.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const n=e.canonical.z-i.tileID.canonical.z;let o,s,a;r=t.create();const l=i.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(o=t.EXTENT>>n,s=o*((i.tileID.canonical.x<<n)-e.canonical.x+l),a=o*((i.tileID.canonical.y<<n)-e.canonical.y)):(o=t.EXTENT<<-n,s=t.EXTENT*(i.tileID.canonical.x-(e.canonical.x+l<<-n)),a=t.EXTENT*(i.tileID.canonical.y-(e.canonical.y<<-n))),t.ortho(r,0,o,0,o,0,1),t.translate(r,r,[s,a,0])}return new Ei(i.tileID,e.key,r)}_findTileCoveringTileID(e,i){let n=i.getTile(e);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],o=r[e.key];if(n=o?i.getTileByID(o):null,n&&n.hasData()||null===o)return n;let s=n?n.tileID:e,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const r=i.getSource().maxzoom;if(e.canonical.z>=r){const n=e.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),s=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=r,s=new t.OverscaledTileID(a,e.wrap,r,e.canonical.x>>n,e.canonical.y>>n))}s.key!==e.key&&(c.push(s.key),n=i.getTile(s))}const u=t=>{c.forEach((e=>{r[e]=t})),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const t=s.calculateScaledKey(a);if(n=i.getTileByID(t),n&&n.hasData())break;const e=r[t];if(null===e)break;void 0===e?c.push(t):n=i.getTileByID(e)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let i=0;const n=new t.StructArrayLayout2ui4,r=131;for(let t=1;t<129;t++){for(let e=1;e<129;e++)i=t*r+e,n.emplaceBack(i,i+1),n.emplaceBack(i,i+r),n.emplaceBack(i+1,i+r),128===t&&n.emplaceBack(i+r,i+r+1);n.emplaceBack(i+1,i+1+r)}return n}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Mi(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const n=t[i].split(" ");e.push(n.pop())}return e}class Ai{static cacheKey(t,e,i){let n=`${t}${i?i.cacheKey:""}`;for(const t of e)n+=`/${t}`;return n}constructor(e,i,n,r,o,s){const a=e.gl;this.program=a.createProgram();const l=Mi(n.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=n.staticUniforms?Mi(n.staticUniforms):[],p=r?r.getBinderUniforms():[],d=h.concat(p),f=[];for(const t of d)f.indexOf(t)<0&&f.push(t);let m=r?r.defines():[];m=m.concat(s.map((t=>`#define ${t}`)));const g=m.concat(e.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(ai):ai,ai,si,oi.fragmentSource,ri.fragmentSource,n.fragmentSource).join("\n"),y=m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",si,oi.vertexSource,ri.vertexSource,ni.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,y),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(_);for(let t=0;t<f.length;t++){const e=f[t];if(e&&!x[e]){const t=a.getUniformLocation(this.program,e);t&&(x[e]=t)}}this.fixedUniforms=o(e,x),this.binderUniforms=r?r.getUniforms(e,x):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((e,i)=>({u_dem:new t.Uniform1i(e,i.u_dem),u_dem_prev:new t.Uniform1i(e,i.u_dem_prev),u_dem_unpack:new t.Uniform4f(e,i.u_dem_unpack),u_dem_tl:new t.Uniform2f(e,i.u_dem_tl),u_dem_scale:new t.Uniform1f(e,i.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(e,i.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(e,i.u_dem_scale_prev),u_dem_size:new t.Uniform1f(e,i.u_dem_size),u_dem_lerp:new t.Uniform1f(e,i.u_dem_lerp),u_exaggeration:new t.Uniform1f(e,i.u_exaggeration),u_depth:new t.Uniform1i(e,i.u_depth),u_depth_size_inv:new t.Uniform2f(e,i.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(e,i.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(e,i.u_label_plane_matrix_inv),u_tile_tl_up:new t.Uniform3f(e,i.u_tile_tl_up),u_tile_tr_up:new t.Uniform3f(e,i.u_tile_tr_up),u_tile_br_up:new t.Uniform3f(e,i.u_tile_br_up),u_tile_bl_up:new t.Uniform3f(e,i.u_tile_bl_up),u_tile_up_scale:new t.Uniform1f(e,i.u_tile_up_scale)}))(e,x)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((e,i)=>({u_fog_matrix:new t.UniformMatrix4f(e,i.u_fog_matrix),u_fog_range:new t.Uniform2f(e,i.u_fog_range),u_fog_color:new t.Uniform4f(e,i.u_fog_color),u_fog_horizon_blend:new t.Uniform1f(e,i.u_fog_horizon_blend),u_fog_temporal_offset:new t.Uniform1f(e,i.u_fog_temporal_offset),u_frustum_tl:new t.Uniform3f(e,i.u_frustum_tl),u_frustum_tr:new t.Uniform3f(e,i.u_frustum_tr),u_frustum_br:new t.Uniform3f(e,i.u_frustum_br),u_frustum_bl:new t.Uniform3f(e,i.u_frustum_bl),u_globe_pos:new t.Uniform3f(e,i.u_globe_pos),u_globe_radius:new t.Uniform1f(e,i.u_globe_radius),u_globe_transition:new t.Uniform1f(e,i.u_globe_transition),u_is_globe:new t.Uniform1i(e,i.u_is_globe),u_viewport:new t.Uniform2f(e,i.u_viewport)}))(e,x))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].location&&i[t].set(e[t])}}draw(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g){const y=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(n),t.setColorMode(r),t.setCullFace(o);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(s[t]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:p});const _={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[e];for(const i of u.get()){const n=i.vaos||(i.vaos={});(n[a]||(n[a]=new ui)).bind(t,this,l,d?d.getPaintVertexBuffers():[],c,i.vertexOffset,f,m,g),y.drawElements(e,i.primitiveLength*_,y.UNSIGNED_SHORT,i.primitiveOffset*_*2)}}}function ki(t,e,i){const n=1/z(i,1,e.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,e.transform.tileZoom)/r,s=o*(i.tileID.canonical.x+i.tileID.wrap*r),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const Pi=t.create(),Li=(e,i,n,r,o,s,a,l,c)=>{const u=i.style.light,h=u.properties.get("position"),p=[h.x,h.y,h.z],d=t.create$1();"viewport"===u.properties.get("anchor")&&(t.fromRotation(d,-i.transform.angle),t.transformMat3(p,p,d));const f=u.properties.get("color"),m=i.transform,g={u_matrix:e,u_lightpos:p,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[f.r,f.g,f.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===m.projection.name&&(g.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],g.u_zoom_transition=a,g.u_inv_rot_matrix=c,g.u_merc_center=l,g.u_up_dir=m.projection.upVector(new t.CanonicalTileID(0,0,0),l[0]*t.EXTENT,l[1]*t.EXTENT),g.u_height_lift=s),g},zi=(e,i,n,r,o,s,a,l,c,u,h)=>{const p=Li(e,i,n,r,o,l,c,u,h),d={u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8};return t.extend(p,ki(s,i,a),d)},Di=t=>({u_matrix:t}),Ri=(e,i,n,r)=>t.extend(Di(e),ki(n,i,r)),Oi=(t,e)=>({u_matrix:t,u_world:e}),Fi=(e,i,n,r,o)=>t.extend(Ri(e,i,n,r),{u_world:o}),Ni=t.create(),Bi=(e,i,n,r,o,s)=>{const a=e.transform,l="globe"===a.projection.name;let c;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const e=t.globePixelsToTileUnits(a.zoom,i.canonical)*a._projectionScaler;c=Float32Array.from([e,0,0,e])}else c=a.calculatePixelsToTileUnitsMatrix(n);else c=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:e.translatePosMatrix(i.projMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Ni,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=t.globeToMercatorTransition(a.zoom);const e=o[0]*t.EXTENT,n=o[1]*t.EXTENT;u.u_up_dir=a.projection.upVector(new t.CanonicalTileID(0,0,0),e,n)}return u},ji=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},$i=(e,i,n,r)=>{const o=t.EXTENT/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Ui=(t,e,i=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:i}),Vi=t.create(),Gi=(e,i,n,r,o,s,a)=>{const l=e.transform,c="globe"===l.projection.name,u=c?t.globePixelsToTileUnits(l.zoom,i.canonical)*l._projectionScaler:z(n,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Vi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=t.globeToMercatorTransition(l.zoom);const e=o[0]*t.EXTENT,n=o[1]*t.EXTENT;h.u_up_dir=l.projection.upVector(new t.CanonicalTileID(0,0,0),e,n)}return h},qi=(t,e,i,n,r,o,s,a)=>{const l=t.transform,c=l.calculatePixelsToTileUnitsMatrix(e),u={u_matrix:Hi(t,e,i,r),u_pixels_to_tile_units:c,u_device_pixel_ratio:s,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:a};if(Xi(i)){const i=Wi(e,t.transform);u.u_texsize=e.lineAtlasTexture.size,u.u_scale=[i,n.fromScale,n.toScale],u.u_mix=n.t}return u},Zi=(t,e,i,n,r,o)=>{const s=t.transform,a=Wi(e,s);return{u_matrix:Hi(t,e,i,r),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:o,u_image:0,u_scale:[a,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Wi(t,e){return 1/z(t,1,e.tileZoom)}function Hi(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Xi(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Yi=(t,e,i,n,r,o)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:i,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(a=r.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=r.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Ki(r.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Ki(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Ji=t.create(),Qi=(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g)=>{const y=o.transform,_={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:y.cameraToCenterDistance,u_rotate_symbol:+n,u_aspect_ratio:y.width/y.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ji,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ji,u_up_vector:[0,-1,0]};return"globe"===g.name&&(_.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],_.u_zoom_transition=p,_.u_inv_rot_matrix=f,_.u_merc_center=d,_.u_camera_forward=y._camera.forward(),_.u_ecef_origin=t.globeECEFOrigin(y.globeMatrix,h.toUnwrapped()),_.u_tile_matrix=Float32Array.from(y.globeMatrix),_.u_up_vector=m),_},tn=(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y)=>t.extend(Qi(e,i,n,r,o,s,a,l,c,u,p,d,f,m,g,y),{u_gamma_scale:r?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h}),en=(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g)=>t.extend(tn(e,i,n,r,o,s,a,l,!0,c,!0,h,p,d,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),nn=(t,e,i)=>({u_matrix:t,u_opacity:e,u_color:i}),rn=(e,i,n,r,o,s)=>t.extend(function(t,e,i,n){const r=i.imageManager.getPattern(t.from.toString()),o=i.imageManager.getPattern(t.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/z(n,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,n,o),{u_matrix:e,u_opacity:i}),on={fillExtrusion:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_opacity:new t.Uniform1f(e,i.u_opacity),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_up_dir:new t.Uniform3f(e,i.u_up_dir),u_height_lift:new t.Uniform1f(e,i.u_height_lift)}),fillExtrusionPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_lightpos:new t.Uniform3f(e,i.u_lightpos),u_lightintensity:new t.Uniform1f(e,i.u_lightintensity),u_lightcolor:new t.Uniform3f(e,i.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,i.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,i.u_height_factor),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_up_dir:new t.Uniform3f(e,i.u_up_dir),u_height_lift:new t.Uniform1f(e,i.u_height_lift),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_opacity:new t.Uniform1f(e,i.u_opacity)}),fill:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),fillPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}),fillOutline:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world)}),fillOutlinePattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_world:new t.Uniform2f(e,i.u_world),u_image:new t.Uniform1i(e,i.u_image),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade)}),circle:(e,i)=>({u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_extrude_scale:new t.UniformMatrix2f(e,i.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_up_dir:new t.Uniform3f(e,i.u_up_dir)}),collisionBox:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,i.u_extrude_scale)}),collisionCircle:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,i.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.UniformColor(e,i.u_color),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_overlay:new t.Uniform1i(e,i.u_overlay),u_overlay_scale:new t.Uniform1f(e,i.u_overlay_scale)}),clippingMask:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix)}),heatmap:(e,i)=>({u_extrude_scale:new t.Uniform1f(e,i.u_extrude_scale),u_intensity:new t.Uniform1f(e,i.u_intensity),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_up_dir:new t.Uniform3f(e,i.u_up_dir)}),heatmapTexture:(e,i)=>({u_image:new t.Uniform1i(e,i.u_image),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_opacity:new t.Uniform1f(e,i.u_opacity)}),hillshade:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_latrange:new t.Uniform2f(e,i.u_latrange),u_light:new t.Uniform2f(e,i.u_light),u_shadow:new t.UniformColor(e,i.u_shadow),u_highlight:new t.UniformColor(e,i.u_highlight),u_accent:new t.UniformColor(e,i.u_accent)}),hillshadePrepare:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_image:new t.Uniform1i(e,i.u_image),u_dimension:new t.Uniform2f(e,i.u_dimension),u_zoom:new t.Uniform1f(e,i.u_zoom),u_unpack:new t.Uniform4f(e,i.u_unpack)}),line:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_pixels_to_tile_units:new t.UniformMatrix2f(e,i.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_dash_image:new t.Uniform1i(e,i.u_dash_image),u_gradient_image:new t.Uniform1i(e,i.u_gradient_image),u_image_height:new t.Uniform1f(e,i.u_image_height),u_texsize:new t.Uniform2f(e,i.u_texsize),u_scale:new t.Uniform3f(e,i.u_scale),u_mix:new t.Uniform1f(e,i.u_mix),u_alpha_discard_threshold:new t.Uniform1f(e,i.u_alpha_discard_threshold),u_trim_offset:new t.Uniform2f(e,i.u_trim_offset)}),linePattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_texsize:new t.Uniform2f(e,i.u_texsize),u_pixels_to_tile_units:new t.UniformMatrix2f(e,i.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_image:new t.Uniform1i(e,i.u_image),u_units_to_pixels:new t.Uniform2f(e,i.u_units_to_pixels),u_scale:new t.Uniform3f(e,i.u_scale),u_fade:new t.Uniform1f(e,i.u_fade),u_alpha_discard_threshold:new t.Uniform1f(e,i.u_alpha_discard_threshold)}),raster:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_tl_parent:new t.Uniform2f(e,i.u_tl_parent),u_scale_parent:new t.Uniform1f(e,i.u_scale_parent),u_fade_t:new t.Uniform1f(e,i.u_fade_t),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image0:new t.Uniform1i(e,i.u_image0),u_image1:new t.Uniform1i(e,i.u_image1),u_brightness_low:new t.Uniform1f(e,i.u_brightness_low),u_brightness_high:new t.Uniform1f(e,i.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,i.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,i.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,i.u_spin_weights),u_perspective_transform:new t.Uniform2f(e,i.u_perspective_transform)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_camera_forward:new t.Uniform3f(e,i.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,i.u_tile_matrix),u_up_vector:new t.Uniform3f(e,i.u_up_vector),u_ecef_origin:new t.Uniform3f(e,i.u_ecef_origin),u_texture:new t.Uniform1i(e,i.u_texture)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texture:new t.Uniform1i(e,i.u_texture),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_tile_id:new t.Uniform3f(e,i.u_tile_id),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,i.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_camera_forward:new t.Uniform3f(e,i.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,i.u_tile_matrix),u_up_vector:new t.Uniform3f(e,i.u_up_vector),u_ecef_origin:new t.Uniform3f(e,i.u_ecef_origin),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.Uniform1i(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,i.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,i.u_size_t),u_size:new t.Uniform1f(e,i.u_size),u_camera_to_center_distance:new t.Uniform1f(e,i.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,i.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,i.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,i.u_fade_change),u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,i.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,i.u_coord_matrix),u_is_text:new t.Uniform1i(e,i.u_is_text),u_pitch_with_map:new t.Uniform1i(e,i.u_pitch_with_map),u_texsize:new t.Uniform2f(e,i.u_texsize),u_texsize_icon:new t.Uniform2f(e,i.u_texsize_icon),u_texture:new t.Uniform1i(e,i.u_texture),u_texture_icon:new t.Uniform1i(e,i.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,i.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,i.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,i.u_is_halo)}),background:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_color:new t.UniformColor(e,i.u_color)}),backgroundPattern:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_opacity:new t.Uniform1f(e,i.u_opacity),u_image:new t.Uniform1i(e,i.u_image),u_pattern_tl_a:new t.Uniform2f(e,i.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,i.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,i.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,i.u_pattern_br_b),u_texsize:new t.Uniform2f(e,i.u_texsize),u_mix:new t.Uniform1f(e,i.u_mix),u_pattern_size_a:new t.Uniform2f(e,i.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,i.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,i.u_scale_a),u_scale_b:new t.Uniform1f(e,i.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,i.u_tile_units_to_pixels)}),terrainRaster:mi,terrainDepth:mi,skybox:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_sun_direction:new t.Uniform3f(e,i.u_sun_direction),u_cubemap:new t.Uniform1i(e,i.u_cubemap),u_opacity:new t.Uniform1f(e,i.u_opacity),u_temporal_offset:new t.Uniform1f(e,i.u_temporal_offset)}),skyboxGradient:(e,i)=>({u_matrix:new t.UniformMatrix4f(e,i.u_matrix),u_color_ramp:new t.Uniform1i(e,i.u_color_ramp),u_center_direction:new t.Uniform3f(e,i.u_center_direction),u_radius:new t.Uniform1f(e,i.u_radius),u_opacity:new t.Uniform1f(e,i.u_opacity),u_temporal_offset:new t.Uniform1f(e,i.u_temporal_offset)}),skyboxCapture:(e,i)=>({u_matrix_3f:new t.UniformMatrix3f(e,i.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,i.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,i.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,i.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,i.u_color_tint_m),u_luminance:new t.Uniform1f(e,i.u_luminance)}),globeRaster:(e,i)=>({u_proj_matrix:new t.UniformMatrix4f(e,i.u_proj_matrix),u_globe_matrix:new t.UniformMatrix4f(e,i.u_globe_matrix),u_normalize_matrix:new t.UniformMatrix4f(e,i.u_normalize_matrix),u_merc_matrix:new t.UniformMatrix4f(e,i.u_merc_matrix),u_zoom_transition:new t.Uniform1f(e,i.u_zoom_transition),u_merc_center:new t.Uniform2f(e,i.u_merc_center),u_image0:new t.Uniform1i(e,i.u_image0),u_grid_matrix:new t.UniformMatrix3f(e,i.u_grid_matrix),u_frustum_tl:new t.Uniform3f(e,i.u_frustum_tl),u_frustum_tr:new t.Uniform3f(e,i.u_frustum_tr),u_frustum_br:new t.Uniform3f(e,i.u_frustum_br),u_frustum_bl:new t.Uniform3f(e,i.u_frustum_bl),u_globe_pos:new t.Uniform3f(e,i.u_globe_pos),u_globe_radius:new t.Uniform1f(e,i.u_globe_radius),u_viewport:new t.Uniform2f(e,i.u_viewport)}),globeAtmosphere:(e,i)=>({u_frustum_tl:new t.Uniform3f(e,i.u_frustum_tl),u_frustum_tr:new t.Uniform3f(e,i.u_frustum_tr),u_frustum_br:new t.Uniform3f(e,i.u_frustum_br),u_frustum_bl:new t.Uniform3f(e,i.u_frustum_bl),u_horizon:new t.Uniform1f(e,i.u_horizon),u_transition:new t.Uniform1f(e,i.u_transition),u_fadeout_range:new t.Uniform1f(e,i.u_fadeout_range),u_color:new t.Uniform4f(e,i.u_color),u_high_color:new t.Uniform4f(e,i.u_high_color),u_space_color:new t.Uniform4f(e,i.u_space_color),u_star_intensity:new t.Uniform1f(e,i.u_star_intensity),u_star_density:new t.Uniform1f(e,i.u_star_density),u_star_size:new t.Uniform1f(e,i.u_star_size),u_temporal_offset:new t.Uniform1f(e,i.u_temporal_offset),u_horizon_angle:new t.Uniform1f(e,i.u_horizon_angle),u_rotation_matrix:new t.UniformMatrix4f(e,i.u_rotation_matrix)})};let sn;function an(e,i,n,r,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=e.useProgram("collisionBox"),p=[];let d=0,f=0;for(let m=0;m<r.length;m++){const g=r[m],y=i.getTile(g),_=y.getBucket(n);if(!_)continue;const v=be(g,_,u);let x=v;0===o[0]&&0===o[1]||(x=e.translatePosMatrix(v,y,o,s));const b=a?_.textCollisionBox:_.iconCollisionBox,w=_.collisionCircleArray;if(w.length>0){const e=t.create(),i=x;t.mul(e,_.placementInvProjMatrix,u.glCoordMatrix),t.mul(e,e,_.placementViewportMatrix),p.push({circleArray:w,circleOffset:f,transform:i,invTransform:e,projection:_.getProjection()}),d+=w.length/4,f=d}b&&(e.terrain&&e.terrain.setupElevationDraw(y,h),h.draw(l,c.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,$i(x,u,y,_.getProjection()),n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,u.zoom,null,b.collisionVertexBuffer,b.collisionVertexBufferExt))}if(!a||!p.length)return;const m=e.useProgram("collisionCircle"),g=new t.StructArrayLayout2f1f2i16;g.resize(4*d),g._trim();let y=0;for(const t of p)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],r=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];g.emplace(y++,n,r,o,s,0),g.emplace(y++,n,r,o,s,1),g.emplace(y++,n,r,o,s,2),g.emplace(y++,n,r,o,s,3)}(!sn||sn.length<2*d)&&(sn=function(e){const i=2*e,n=new t.StructArrayLayout3ui6;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(d));const _=l.createIndexBuffer(sn,!0),v=l.createVertexBuffer(g,t.collisionCircleLayout.members,!0);for(const i of p){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};m.draw(l,c.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,r,n.id,v,_,t.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var x;v.destroy(),_.destroy()}const ln=t.create();function cn(e,i,n,r,o,s){const{horizontalAlign:a,verticalAlign:l}=t.getAnchorAlignment(e),c=-(a-.5)*i,u=-(l-.5)*n,h=t.evaluateVariableOffset(e,r);return new t.pointGeometry((c/o+h[0])*s,(u/o+h[1])*s)}function un(e,i,n,r,o,s,a,l,c,u,h){const p=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,f=e.icon.dynamicLayoutVertexArray,m={},g=we(l,e.getProjection(),s),y=s.elevation,_=e.getProjection().upVectorScale(l.canonical,s.center.lat,s.worldSize);d.clear();for(let f=0;f<p.length;f++){const v=p.get(f),x=e.allowVerticalPlacement&&!v.placedOrientation,b=v.hidden||!v.crossTileID||x?null:r[v.crossTileID];if(b){const r=new t.pointGeometry(v.tileAnchorX,v.tileAnchorY),p=e.getProjection().upVector(l.canonical,r.x,r.y),f=y?y.getAtTileOffset(l,r.x,r.y):0,x=oe([v.projectedAnchorX+f*p[0]*_.metersToTile,v.projectedAnchorY+f*p[1]*_.metersToTile,v.projectedAnchorZ+f*p[2]*_.metersToTile],n?g:a),w=se(s.getCameraToCenterDistance(e.getProjection()),x.signedDistanceFromCamera);let T=o.evaluateSizeForFeature(e.textSizeData,u,v)*w/t.ONE_EM;n&&(T*=e.tilePixelRatio/c);const{width:S,height:C,anchor:E,textOffset:I,textScale:M}=b,A=cn(E,S,C,I,M,T);let k;if(n){const t=r.add(A),{x:i,y:n,z:o}=e.getProjection().projectTilePoint(t.x,t.y,l.canonical);k=oe([i+f*p[0]*_.metersToTile,n+f*p[1]*_.metersToTile,o+f*p[2]*_.metersToTile],a).point}else{const t=i?A.rotate(-s.angle):A;k=[x.point[0]+t.x,x.point[1]+t.y,0]}const P=e.allowVerticalPlacement&&v.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<v.numGlyphs;e++)t.addDynamicAttributes(d,k[0],k[1],k[2],P);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={shiftedAnchor:k,angle:P})}else ge(v.numGlyphs,d)}if(h){f.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const n=i.get(e);if(n.hidden)ge(n.numGlyphs,f);else{const i=m[e];if(i)for(let e=0;e<n.numGlyphs;e++)t.addDynamicAttributes(f,i.shiftedAnchor[0],i.shiftedAnchor[1],i.shiftedAnchor[2],i.angle);else ge(n.numGlyphs,f)}}e.icon.dynamicLayoutVertexBuffer.updateData(f)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function hn(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function pn(e,i,n,r,o,s,a,l,c,u,h,p){const d=e.context,f=d.gl,m=e.transform,g="map"===l,y="map"===c,_=g&&"point"!==n.layout.get("symbol-placement"),v=g&&!y&&!_,x=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),T=[t.mercatorXfromLng(m.center.lng),t.mercatorYfromLat(m.center.lat)],S=n.layout.get("text-variable-anchor"),C="globe"===m.projection.name,E=[],I=[0,-1,0];let M=I;!C&&!m.mercatorFromTransition||g||(M=function(e){const i=e._camera.getWorldToCamera(e.worldSize,1),n=t.multiply([],i,e.globeMatrix);t.invert(n,n);const r=[0,0,0],o=[0,1,0,0];return t.transformMat4$1(o,o,n),r[0]=o[0],r[1]=o[1],r[2]=o[2],t.normalize(r,r),r}(m));for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;if("mercator"===c.projection.name&&C)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const p=h.programConfigurations.get(n.id),d=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,A=y||0!==m.pitch,k=t.evaluateSizeForZoom(w,m.zoom);let P,L,z,D,R=[0,0],O=null;if(o){if(L=r.glyphAtlasTexture,z=f.LINEAR,P=r.glyphAtlasTexture.size,c.iconsInText){R=r.imageAtlasTexture.size,O=r.imageAtlasTexture;const t="composite"===w.kind||"camera"===w.kind;D=A||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=r.imageAtlasTexture,z=d||e.options.rotating||e.options.zooming||t||A?f.LINEAR:f.NEAREST,P=r.imageAtlasTexture.size}const F="globe"===c.projection.name,N=F?M:I,B=F?t.globeToMercatorTransition(m.zoom):0,j=we(l,c.getProjection(),m),$=m.calculatePixelsToTileUnitsMatrix(r),U=ee(j,r.tileID.canonical,y,g,m,c.getProjection(),$),V=e.terrain&&y&&_?t.invert(t.create(),U):ln,G=ne(j,r.tileID.canonical,y,g,m,c.getProjection(),$),q=S&&c.hasTextData(),Z="none"!==n.layout.get("icon-text-fit")&&q&&c.hasIconData();if(_){const t=m.elevation,i=t?t.getAtTileOffsetFunc(l,m.center.lat,m.worldSize,c.getProjection()):t=>[0,0,0],n=ie(j,r.tileID.canonical,y,g,m,c.getProjection(),$);le(c,j,e,o,n,G,y,u,i,l)}const W=_||o&&S||Z,H=e.translatePosMatrix(j,r,s,a),X=W?ln:U,Y=e.translatePosMatrix(G,r,s,a,!0),K=c.getProjection().createInversionMatrix(m,l.canonical),J=[];e.terrain&&y&&J.push("PITCH_WITH_MAP_TERRAIN"),F&&J.push("PROJECTION_GLOBE_VIEW"),W&&J.push("PROJECTED_POS_ON_VIEWPORT");const Q=d&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let tt;tt=d?c.iconsInText?en(w.kind,k,v,y,e,H,X,Y,P,R,l,B,T,K,N,c.getProjection()):tn(w.kind,k,v,y,e,H,X,Y,o,P,!0,l,B,T,K,N,c.getProjection()):Qi(w.kind,k,v,y,e,H,X,Y,o,P,l,B,T,K,N,c.getProjection());const et={program:e.useProgram(hn(d,o,c),p,J),buffers:h,uniformValues:tt,atlasTexture:L,atlasTextureIcon:O,atlasInterpolation:z,atlasInterpolationIcon:D,isSDF:d,hasHalo:Q,tile:r,labelPlaneMatrixInv:V};if(x&&c.canOverlap){b=!0;const e=h.segments.get();for(const i of e)E.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:et})}else E.push({segments:h.segments,sortKey:0,state:et})}b&&E.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of E){const i=t.state;if(e.terrain&&e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!C,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),d.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(d.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,dn(i.buffers,t.segments,n,e,i.program,w,h,p,r)),r.u_is_halo=0}dn(i.buffers,t.segments,n,e,i.program,w,h,p,i.uniformValues)}}function dn(e,i,n,r,o,s,a,l,c){const u=r.context;o.draw(u,u.gl.TRIANGLES,s,a,l,t.CullFaceMode.disabled,c,n.id,e.layoutVertexBuffer,e.indexBuffer,i,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.globeExtVertexBuffer)}function fn(e,i,n,r,o,s,a){const l=e.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=n.getCrossfadeParameters();let p,d,f,m,g;a?(d=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",p=l.LINES):(d=u?"fillPattern":"fill",p=l.TRIANGLES);for(const y of r){const r=i.getTile(y);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(n);if(!_)continue;e.prepareDrawTile();const v=_.programConfigurations.get(n.id),x=e.useProgram(d,v);u&&(e.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[b.to.toString()],i=t.patternPositions[b.from.toString()];e&&i&&v.setConstantPatternPositions(e,i)}const w=e.translatePosMatrix(y.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){m=_.indexBuffer2,g=_.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===d&&u?Fi(w,e,h,r,t):Oi(w,t)}else m=_.indexBuffer,g=_.segments,f=u?Ri(w,e,h,r):Di(w);e.prepareDrawProgram(e.context,x,y.toUnwrapped()),x.draw(e.context,p,o,e.stencilModeForClipping(y),s,t.CullFaceMode.disabled,f,n.id,_.layoutVertexBuffer,m,g,n.paint,e.transform.zoom,v)}}function mn(e,i,n,r,o,s,a){const l=e.context,c=l.gl,u=e.transform,h=n.paint.get("fill-extrusion-pattern"),p=h.constantOr(1),d=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity"),m="globe"===u.projection.name?t.fillExtrusionHeightLift():0,g="globe"===u.projection.name,y=g?t.globeToMercatorTransition(u.zoom):0,_=[t.mercatorXfromLng(u.center.lng),t.mercatorYfromLat(u.center.lat)],v=[];g&&v.push("PROJECTION_GLOBE_VIEW");for(const x of r){const r=i.getTile(x),b=r.getBucket(n);if(!b||b.projection.name!==u.projection.name)continue;const w=b.programConfigurations.get(n.id),T=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",w,v);if(e.terrain){const t=e.terrain;if(e.style.terrainSetForDrapingOnly())t.setupElevationDraw(r,T,{useMeterToDem:!0});else{if(!b.enableTerrain)continue;if(t.setupElevationDraw(r,T,{useMeterToDem:!0}),gn(l,i,x,b,n,t),!b.centroidVertexBuffer){const t=T.attributes.a_centroid_pos;void 0!==t&&c.vertexAttrib2f(t,0,0)}}}p&&(e.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.updatePaintBuffers(d));const S=h.constantOr(null);if(S&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[S.to.toString()],i=t.patternPositions[S.from.toString()];e&&i&&w.setConstantPatternPositions(e,i)}const C=e.translatePosMatrix(x.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),E=u.projection.createInversionMatrix(u,x.canonical),I=n.paint.get("fill-extrusion-vertical-gradient"),M=p?zi(C,e,I,f,x,d,r,m,y,_,E):Li(C,e,I,f,x,m,y,_,E);e.prepareDrawProgram(l,T,x.toUnwrapped()),T.draw(l,l.gl.TRIANGLES,o,s,a,t.CullFaceMode.backCCW,M,n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,n.paint,e.transform.zoom,w,e.terrain?b.centroidVertexBuffer:null,g?b.layoutVertexExtBuffer:null)}}function gn(e,i,n,r,o,s){const a=[e=>{let i=e.canonical.x-1,n=e.wrap;return i<0&&(i=(1<<e.canonical.z)-1,n--),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,i,e.canonical.y)},e=>{let i=e.canonical.x+1,n=e.wrap;return i===1<<e.canonical.z&&(i=0,n++),new t.OverscaledTileID(e.overscaledZ,n,e.canonical.z,i,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],l=t=>{const e=i.getSource().minzoom,n=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},r=[0,-1,1];for(const i of r){if(t.overscaledZ+i<e)continue;const r=n(t.calculateScaledKey(t.overscaledZ+i));if(r)return r}},c=[0,0,0],u=(e,i)=>(c[0]=Math.min(e.min.y,i.min.y),c[1]=Math.max(e.max.y,i.max.y),c[2]=t.EXTENT-i.min.x>e.max.x?i.min.x-t.EXTENT:e.max.x,c),h=(e,i)=>(c[0]=Math.min(e.min.x,i.min.x),c[1]=Math.max(e.max.x,i.max.x),c[2]=t.EXTENT-i.min.y>e.max.y?i.min.y-t.EXTENT:e.max.y,c),p=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],d=new t.pointGeometry(0,0);let f,m,g;const y=(e,i,r,o,a)=>{const l=[[o?r:e,o?e:r,0],[o?r:i,o?i:r,0]],c=a<0?t.EXTENT+a:a,u=[o?c:(e+i)/2,o?(e+i)/2:c,0];return 0===r&&a<0||0!==r&&a>0?s.getForTilePoints(g,[u],!0,m):l.push(u),s.getForTilePoints(n,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let e=0;e<4;e++){const i=(e<2?1:5)-e,o=r.borders[e];if(0===o.length)continue;const c=g=a[e](n),u=l(c);if(!(u&&u instanceof t.FillExtrusionBucket&&u.enableTerrain))continue;if(r.borderDoneWithNeighborZ[e]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===r.canonical.z)continue;if(m=s.findDEMTileFor(c),!m||!m.dem)continue;if(!f){const t=s.findDEMTileFor(n);if(!t||!t.dem)return;f=t}const h=u.borders[i];let _=0;const v=u.borderDoneWithNeighborZ[i]!==r.canonical.z;if(r.canonical.z===u.canonical.z){for(let n=0;n<o.length;n++){const s=r.featuresOnBorder[o[n]],a=s.borders[e];let l;for(;_<h.length&&(l=u.featuresOnBorder[h[_]],!(l.borders[i][1]>a[0]+3));)v&&u.encodeCentroid(void 0,l,!1),_++;if(l&&_<h.length){const n=_;let o=0;for(;!(l.borders[i][0]>a[1]-3)&&(o++,++_!==h.length);)l=u.featuresOnBorder[h[_]];if(l=u.featuresOnBorder[h[n]],s.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(_=n),r.encodeCentroid(void 0,s,!1),v&&u.encodeCentroid(void 0,l,!1);continue}const c=p[e](s,l),f=e%2?t.EXTENT-1:0;d.x=y(c[0],Math.min(t.EXTENT-1,c[1]),f,e<2,c[2]),d.y=0,r.encodeCentroid(d,s,!1),v&&u.encodeCentroid(d,l,!1)}else r.encodeCentroid(void 0,s,!1)}r.borderDoneWithNeighborZ[e]=u.canonical.z,r.needsCentroidUpdate=!0,v&&(u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0)}else{for(const t of o)r.encodeCentroid(void 0,r.featuresOnBorder[t],!1);if(v){for(const t of h)u.encodeCentroid(void 0,u.featuresOnBorder[t],!1);u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0}r.borderDoneWithNeighborZ[e]=u.canonical.z,r.needsCentroidUpdate=!0}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(e)}const yn=new t.Color(1,0,0,1),_n=new t.Color(0,1,0,1),vn=new t.Color(0,0,1,1),xn=new t.Color(1,0,1,1),bn=new t.Color(0,1,1,1);function wn(t,e,i,n){Sn(t,0,e+i/2,t.transform.width,i,n)}function Tn(t,e,i,n){Sn(t,e-i/2,0,i,t.transform.height,n)}function Sn(e,i,n,r,o,s){const a=e.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*t.exported.devicePixelRatio,n*t.exported.devicePixelRatio,r*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function Cn(e,i,n){const r=e.context,o=r.gl,s="globe"===e.transform.projection.name,a=n.projMatrix,l=e.useProgram("debug",null,s?["PROJECTION_GLOBE_VIEW"]:null),c=i.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(c,l);const u=t.DepthMode.disabled,h=t.StencilMode.disabled,p=e.colorModeForRenderPass(),d="$debug";r.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?c._makeGlobeTileDebugBuffers(e.context,e.transform.projection):c._makeDebugTileBoundsBuffers(e.context,e.transform.projection);const f=c._tileDebugBuffer||e.debugBuffer,m=c._tileDebugIndexBuffer||e.debugIndexBuffer,g=c._tileDebugSegments||e.debugSegments;l.draw(r,o.LINE_STRIP,u,h,p,t.CullFaceMode.disabled,Ui(a,t.Color.red),d,f,m,g,null,null,null,c._globeTileDebugBorderBuffer);const y=c.latestRawTileData,_=Math.floor((y&&y.byteLength||0)/1024),v=i.getTile(n).tileSize,x=512/Math.min(v,512)*(n.overscaledZ/e.transform.zoom)*.5;let b=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(b+=` => ${n.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,`${b} ${_}kb`);const w=c._tileDebugTextBuffer||e.debugBuffer,T=c._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,S=c._tileDebugTextSegments||e.debugSegments;l.draw(r,o.TRIANGLES,u,h,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,Ui(a,t.Color.transparent,x),d,w,T,S,null,null,null,c._globeTileDebugTextBuffer)}const En=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:In}=En;function Mn(t,e,i,n){t.emplaceBack(e,i,n)}class An{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,Mn(this.vertexArray,-1,-1,1),Mn(this.vertexArray,1,-1,1),Mn(this.vertexArray,-1,1,1),Mn(this.vertexArray,1,1,1),Mn(this.vertexArray,-1,-1,-1),Mn(this.vertexArray,1,-1,-1),Mn(this.vertexArray,-1,1,-1),Mn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,In),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function kn(e,i,n,r,o,s){const a=e.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,i,n,r)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),r),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),n.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Pn=t.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ln{constructor(e){const i=new t.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new t.StructArrayLayout3ui6;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,Pn.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=t.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const zn={symbol:function(e,i,n,r,o){if("translucent"!==e.renderPass)return;const s=t.StencilMode.disabled,a=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,i,n,r,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of e){const e=r.getTile(i),o=e.getBucket(n);if(!o||!o.text||!o.text.segments.get().length)continue;const s=t.evaluateSizeForZoom(o.textSizeData,l.zoom),h=we(i,o.getProjection(),l),p=l.calculatePixelsToTileUnitsMatrix(e),d=ee(h,e.tileID.canonical,u,c,l,o.getProjection(),p),f="none"!==n.layout.get("icon-text-fit")&&o.hasIconData();if(s){const n=Math.pow(2,l.zoom-e.tileID.overscaledZ);un(o,c,u,a,t.symbolSize,l,d,i,n,s,f)}}}(r,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&pn(e,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),s,a),0!==n.paint.get("text-opacity").constantOr(1)&&pn(e,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(an(e,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),an(e,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,n,r){if("translucent"!==e.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.transform,p=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),d=t.StencilMode.disabled,f=e.colorModeForRenderPass(),m="globe"===h.projection.name,g=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],y=[];for(let o=0;o<r.length;o++){const s=r[o],a=i.getTile(s),c=a.getBucket(n);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(n.id),p=ji(n);m&&p.push("PROJECTION_GLOBE_VIEW");const d=e.useProgram("circle",u,p),f=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,v=c.indexBuffer,x=h.projection.createInversionMatrix(h,s.canonical),b={programConfiguration:u,program:d,layoutVertexBuffer:f,globeExtVertexBuffer:_,indexBuffer:v,uniformValues:Bi(e,s,a,x,g,n),tile:a};if(l){const e=c.segments.get();for(const i of e)y.push({segments:new t.SegmentVector([i]),sortKey:i.sortKey,state:b})}else y.push({segments:c.segments,sortKey:0,state:b})}l&&y.sort(((t,e)=>t.sortKey-e.sortKey));const _={useDepthForOcclusion:!m};for(const i of y){const{programConfiguration:r,program:o,layoutVertexBuffer:s,globeExtVertexBuffer:a,indexBuffer:l,uniformValues:g,tile:y}=i.state,v=i.segments;e.terrain&&e.terrain.setupElevationDraw(y,o,_),e.prepareDrawProgram(c,o,y.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,p,d,f,t.CullFaceMode.disabled,g,n.id,s,l,v,n.paint,h.zoom,r,m?a:null)}},heatmap:function(e,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=t.StencilMode.disabled,l=new t.ColorMode([s.ONE,s.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,i,n){const r=t.gl,o=e.width*n,s=e.height*n;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=t.createFramebuffer(o,s,!1),function(t,e,i,n,r,o){const s=t.gl;s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r,o,0,s.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,0,e,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(o,e,n,"globe"===e.transform.projection.name?.5:.25),o.clear({color:t.Color.transparent});const c=e.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,p=u?t.CullFaceMode.frontCCW:t.CullFaceMode.disabled,d=[t.mercatorXfromLng(c.center.lng),t.mercatorYfromLat(c.center.lat)];for(let f=0;f<r.length;f++){const m=r[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),y=g.getBucket(n);if(!y||y.projection.name!==c.projection.name)continue;const _=y.programConfigurations.get(n.id),v=e.useProgram("heatmap",_,h),{zoom:x}=e.transform;e.terrain&&e.terrain.setupElevationDraw(g,v),e.prepareDrawProgram(o,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(o,s.TRIANGLES,t.DepthMode.disabled,a,l,p,Gi(e,m,g,b,d,x,n.paint.get("heatmap-intensity")),n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,e.transform.zoom,_,u?y.globeExtVertexBuffer:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const n=e.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new t.Texture(n,i.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,r.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((t,e,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,n))},line:function(e,i,n,r){if("translucent"!==e.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),l=e.colorModeForRenderPass(),c=e.terrain&&e.terrain.renderingToTexture?1:t.exported.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),p=n.layout.get("line-cap"),d=n.paint.get("line-pattern"),f=d.constantOr(1),m=n.paint.get("line-gradient"),g=n.getCrossfadeParameters(),y=f?"linePattern":"line",_=e.context,v=_.gl,x=(t=>{const e=[];Xi(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET");const n=t.paint.get("line-pattern").constantOr(1),r=1!==t.paint.get("line-opacity").constantOr(1);return!n&&r&&e.push("RENDER_LINE_ALPHA_DISCARD"),e})(n);let b=x.includes("RENDER_LINE_ALPHA_DISCARD");e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(b=!1);for(const o of r){const r=i.getTile(o);if(f&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;e.prepareDrawTile();const w=s.programConfigurations.get(n.id),T=e.useProgram(y,w,x),S=d.constantOr(null);if(S&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[S.to.toString()],i=t.patternPositions[S.from.toString()];e&&i&&w.setConstantPatternPositions(e,i)}const C=u.constantOr(null),E=p.constantOr(null);if(!f&&C&&E&&r.lineAtlas){const t=r.lineAtlas,e=t.getDash(C.to,E),i=t.getDash(C.from,E);e&&i&&w.setConstantPatternPositions(e,i)}let[I,M]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const t=1;I!==M&&(0===I&&(I-=t),1===M&&(M+=t))}const A=e.terrain?o.projMatrix:null,k=f?Zi(e,r,n,g,A,c):qi(e,r,n,g,A,s.lineClipsArray.length,c,[I,M]);if(m){const r=s.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.clamp(t.nextPowerOfTwo(s.maxLineLength/t.EXTENT*1024*r),256,_.maxTextureSize)}r.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new t.Texture(_,r.gradient,v.RGBA),r.version=n.gradientVersion,a=r.texture}_.activeTexture.set(v.TEXTURE1),a.bind(n.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}h&&(_.activeTexture.set(v.TEXTURE0),r.lineAtlasTexture.bind(v.LINEAR,v.REPEAT),w.updatePaintBuffers(g)),f&&(_.activeTexture.set(v.TEXTURE0),r.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),w.updatePaintBuffers(g)),e.prepareDrawProgram(_,T,o.toUnwrapped());const P=i=>{T.draw(_,v.TRIANGLES,a,i,l,t.CullFaceMode.disabled,k,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,e.transform.zoom,w,s.layoutVertexBuffer2)};if(b){const i=e.stencilModeForClipping(o).ref;0===i&&e.terrain&&_.clear({stencil:0});const n={func:v.EQUAL,mask:255};k.u_alpha_discard_threshold=.8,P(new t.StencilMode(n,i,255,v.KEEP,v.KEEP,v.INVERT)),k.u_alpha_discard_threshold=0,P(new t.StencilMode(n,i,255,v.KEEP,v.KEEP,v.KEEP))}else P(e.stencilModeForClipping(o))}b&&(e.resetStencilClippingMasks(),e.terrain&&_.clear({stencil:0}))},fill:function(e,i,n,r){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);fn(e,i,n,r,o,a,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const o=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);fn(e,i,n,r,o,a,!0)}},"fill-extrusion":function(e,i,n,r){const o=n.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const s=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))mn(e,i,n,r,s,t.StencilMode.disabled,t.ColorMode.disabled),mn(e,i,n,r,s,e.stencilModeFor3D(),e.colorModeForRenderPass()),e.resetStencilClippingMasks();else{const o=e.colorModeForRenderPass();mn(e,i,n,r,s,t.StencilMode.disabled,o)}}},hillshade:function(e,i,n,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture,[c,u]="translucent"!==e.renderPass||l?[{},r]:e.stencilConfigForOverlap(r);for(const r of u){const o=i.getTile(r);if(o.needsHillshadePrepare&&"offscreen"===e.renderPass)fi(e,o,n,s,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=l&&e.terrain?e.terrain.stencilModeForRTTOverlap(r):c[r.overscaledZ];pi(e,r,o,n,s,t,a)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,i,n,r,o,s){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const a=e.context,l=a.gl,c=i.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),p=e.terrain&&e.terrain.renderingToTexture,[d,f]=c instanceof kt||p?[{},r]:e.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!e.options.moving;for(const r of f){const o=p?t.DepthMode.disabled:e.depthModeForSublayer(r.overscaledZ-m,1===n.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,l.LESS),f=r.toUnwrapped(),y=i.getTile(r);if(p&&(!y||!y.hasData()))continue;const _=p?r.projMatrix:e.transform.calculateProjMatrix(f,g),v=e.terrain&&p?e.terrain.stencilModeForRTTOverlap(r):d[r.overscaledZ],x=s?0:n.paint.get("raster-fade-duration");y.registerFadeDuration(x);const b=i.findLoadedParent(r,0),w=Ti(y,b,i,e.transform,x);let T,S;e.terrain&&e.terrain.prepareDrawTile();const C="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),y.texture.bind(C,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(C,l.CLAMP_TO_EDGE),T=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*T%1,y.tileID.canonical.y*T%1]):y.texture.bind(C,l.CLAMP_TO_EDGE);const E=Yi(_,S||[0,0],T||1,w,n,c instanceof kt?c.perspectiveTransform:[0,0]);if(e.prepareDrawProgram(a,u,f),c instanceof kt)c.boundsBuffer&&c.boundsSegments&&u.draw(a,l.TRIANGLES,o,t.StencilMode.disabled,h,t.CullFaceMode.disabled,E,n.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:r,tileBoundsSegments:s}=e.getTileBoundsBuffers(y);u.draw(a,l.TRIANGLES,o,v,h,t.CullFaceMode.disabled,E,n.id,i,r,s)}}e.resetStencilClippingMasks()},background:function(e,i,n,r){const o=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const a=e.context,l=a.gl,c=e.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(e.isPatternMissing(h))return;const p=!h&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==p)return;const d=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===p?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background");let y,_=r;_||(y=e.getBackgroundTiles(),_=Object.values(y).map((t=>t.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context));const v=n.getCrossfadeParameters();for(const p of _){const _=p.toUnwrapped(),x=r?p.projMatrix:e.transform.calculateProjMatrix(_);e.prepareDrawTile();const b=i?i.getTile(p):y?y[p.key]:new t.Tile(p,u,c.zoom,e),w=h?rn(x,s,e,h,{tileID:p,tileSize:u},v):nn(x,s,o);e.prepareDrawProgram(a,g,_);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:S,tileBoundsSegments:C}=e.getTileBoundsBuffers(b);g.draw(a,l.TRIANGLES,f,d,m,t.CullFaceMode.disabled,w,n.id,T,S,C)}},sky:function(e,i,n){const r=e.transform,o="mercator"===r.projection.name||"globe"===r.projection.name?1:t.smoothstep(7,8,r.zoom),s=n.paint.get("sky-opacity")*o;if(0===s)return;const a=e.context,l=n.paint.get("sky-type"),c=new t.DepthMode(a.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),u=e.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,i,n,r){const o=e.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new An(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(e,!0),c=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),kn(o,i,c,u,l,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),kn(o,i,c,u,l,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),kn(o,i,c,u,l,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),kn(o,i,c,u,l,3),t.identity(u),kn(o,i,c,u,l,4),t.identity(u),t.rotateY(u,u,Math.PI),kn(o,i,c,u,l,5),o.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,i,n,r,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((t,e,i,n,r)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(e,!1),0,r,o);e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,c,s,u):"gradient"===l&&"sky"===e.renderPass&&function(e,i,n,r,o){const s=e.context,a=s.gl,l=e.transform,c=e.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new An(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.Texture(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,i,n,r,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.degToRad(n),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),r,o);e.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,c,s,u)},debug:function(t,e,i){for(let n=0;n<i.length;n++)Cn(t,e,i[n])},custom:function(e,i,n){const r=e.context,o=n.implementation;if(e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes("custom"))t.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===e.renderPass){const t=o.prerender;t&&(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),t.call(o,r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(t.StencilMode.disabled);const i="3d"===o.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);r.setDepthMode(i),o.render(r.gl,e.transform.customLayerMatrix()),r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}};class Dn{constructor(e,i){this.context=new Et(e),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new He,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ii(this,t));const n=this._terrain;this.transform.elevation=i?n:null,n.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=e.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,i){if(this.width=e*t.exported.devicePixelRatio,this.height=i*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const r=new t.StructArrayLayout2i4;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(t.EXTENT,0,t.EXTENT,0),o.emplaceBack(0,t.EXTENT,0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.StructArrayLayout1ui2;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.create();const l=this.context.gl;this.stencilClearMode=new t.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(t.window.performance.now()),this.atmosphereBuffer=new Ln(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(e,i.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,wi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,n){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of n)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=i.id;const r=this.context,o=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(t.ColorMode.disabled),r.setDepthMode(t.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of n){const n=i.getTile(e),a=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(n);s.draw(r,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},a,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,wi(e.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new t.StencilMode({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new t.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,n=e.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),r=n[n.length-1].overscaledZ,o=n[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let n=0;n<o;n++)e[n+r]=new t.StencilMode({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[e,n]}return[{[r]:t.StencilMode.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,i,n){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const n=this.style.order,r=this.style._sourceCaches;for(const t in r){const e=r[t];e.used&&e.prepare(this.context)}const o={},s={},a={};for(const t in r){const e=r[t];o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<n.length;t++)if(this.style._layers[n[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),t.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const t of n){const i=this.style._layers[t],n=e._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const r=n?s[n.id]:void 0;("custom"===i.type||i.isSky()||r&&r.length)&&this.renderLayer(this,n,i,r)}if(this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky())continue;const r=i?s[i.id]:void 0;this._renderTileClippingMasks(t,i,r),this.renderLayer(this,i,t,r)}if(this.style.fog&&this.transform.projection.supportsFog&&function(e,i){const n=e.context,r=n.gl,o=e.transform,s=new t.DepthMode(r.LEQUAL,t.DepthMode.ReadOnly,[0,1]),a=e.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=t.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),p=t.identity$1([]);t.rotateY$1(p,p,-t.degToRad(o._center.lng)),t.rotateX$1(p,p,t.degToRad(o._center.lat)),t.rotateZ$1(p,p,o.angle),t.rotateX$1(p,p,-o._pitch);const d=t.fromQuat(new Float32Array(16),p),f=t.mapValue(i.properties.get("star-intensity"),0,1,0,.25),m=5e-4,g=t.mapValue(i.properties.get("horizon-blend"),0,1,m,.25),y=t.globeUseCustomAntiAliasing(e,n,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=e.frameCounter/1e3%1,v=t.length(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(y,2)),b=Math.acos(x/v),w=((e,i,n,r,o,s,a,l,c,u,h,p,d,f)=>({u_frustum_tl:e,u_frustum_tr:i,u_frustum_br:n,u_frustum_bl:r,u_horizon:o,u_transition:s,u_fadeout_range:a,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*t.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:p,u_horizon_angle:d,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,g,c,u,h,f,_,b,d);e.prepareDrawProgram(n,a);const T=e.atmosphereBuffer;T&&a.draw(n,r.TRIANGLES,s,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,w,"skybox",T.vertexBuffer,T.indexBuffer,T.segments)}(this,this.style.fog),this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?s[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const t=this.style._layers[n[this.currentLayer]],i=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=i?("symbol"===t.type?a:s)[i.id]:void 0;this._renderTileClippingMasks(t,i,i?o[i.id]:void 0),this.renderLayer(this,i,t,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;t.values(this.style._layers).forEach((t=>{const n=e._getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&zn.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;wn(t,t.transform.height-(e.top||0),3,yn),wn(t,e.bottom||0,3,_n),Tn(t,e.left||0,3,vn),Tn(t,t.transform.width-(e.right||0),3,xn);const i=t.transform.centerPoint;!function(t,e,i,n){Sn(t,e-1,i-10,2,20,n),Sn(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,bn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(i.type)||zn[i.type](t,e,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),i.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(e),t.beginQueryEXT(t.TIME_ELAPSED_EXT,e)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const n=t[i],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),e[i]=o}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery;let i=0;for(const n of t)i+=e.getQueryObjectEXT(n,e.QUERY_RESULT_EXT)/1e6,e.deleteQueryEXT(n);return i}translatePosMatrix(e,i,n,r,o){if(!n[0]&&!n[1])return e;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[o?n[0]:z(i,n[0],this.transform.zoom),o?n[1]:z(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,a),l}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&i.push("FOG"),t&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(t,e,i){this.cache=this.cache||{};const n=i||[],r=this.currentGlobalDefines().concat(n),o=Ai.cacheKey(t,r,e);return this.cache[o]||(this.cache[o]=new Ai(this.context,t,li[t],e,on[t],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(e,i,n){if(this.terrain&&this.terrain.renderingToTexture)return;const r=this.style.fog;if(r){const o=r.getOpacity(this.transform.pitch),s=((e,i,n,r,o,s,a,l,c,u,h)=>{const p=e.transform,d=i.properties.get("color").toArray01();d[3]=r;const f=e.frameCounter/1e3%1;return{u_fog_matrix:n?p.calculateFogTileMatrix(n):e.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:d,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:t.globeToMercatorTransition(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,r,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.exported.devicePixelRatio,this.transform.height*t.exported.devicePixelRatio]);i.setFogUniformValues(e,s)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)i[r.key]=e[r.key]||new t.Tile(r,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Rn{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.number(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.number(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.number(e.right,i.right,n)),this}getCenter(e,i){const n=t.clamp((this.left+e-this.right)/2,0,e),r=t.clamp((this.top+i-this.bottom)/2,0,i);return new t.pointGeometry(n,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Rn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function On(e,i){const n=t.getColumn(e,3);t.fromQuat(e,i),t.setColumn(e,3,n)}function Fn(e,i){const n=t.identity$1([]);return t.rotateZ$1(n,n,-i),t.rotateX$1(n,n,-e),n}function Nn(e,i){const n=[e[0],e[1],0],r=[i[0],i[1],0];if(t.length(n)>=1e-15){const e=t.normalize([],n);t.scale$2(r,e,t.dot(r,e)),i[0]=r[0],i[1]=r[1]}const o=t.cross([],i,e);if(t.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Fn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class Bn{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t.MercatorCoordinate?e:new t.MercatorCoordinate(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const n=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,r=this.position,o=t.MercatorCoordinate.fromLngLat(e,n),s=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Nn(s,i)}setPitchBearing(e,i){this.orientation=Fn(t.degToRad(e),t.degToRad(-i))}}class jn{constructor(e,i){this._transform=t.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const e=t.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.setColumn(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.identity$1([]),e&&On(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Fn(t,e),On(this._transform,this._orientation)}forward(){const e=t.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const n=new Float64Array(16);return t.invert(n,this.getWorldToCamera(e,i)),n}getWorldToCameraPosition(e,i,n){const r=this.position;t.scale$2(r,r,-e);const o=new Float64Array(16);return t.fromScaling(o,[n,n,n]),t.translate(o,o,r),o[10]*=i,o}getWorldToCamera(e,i){const n=new Float64Array(16),r=new Float64Array(4),o=this.position;return t.conjugate(r,this._orientation),t.scale$2(o,o,-e),t.fromQuat(n,r),t.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(e,i,n,r){const o=new Float64Array(16);return t.perspective(o,e,i,n,r),o}getDistanceToElevation(e){const i=0===e?0:t.mercatorZfromAltitude(e,this.position[1]),n=this.forward();return(i-this.position[2])/n[2]}clone(){return new jn([...this.position],[...this.orientation])}}function $n(e,i){const n=Vn(e.projection,e.zoom,e.width,e.height),r=function(e,i,n,r,o){const s=new t.LngLat(n.lng-180*Gn,n.lat),a=new t.LngLat(n.lng+180*Gn,n.lat),l=e.project(s.lng,s.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=t.MercatorCoordinate.fromLngLat(n);h.y=t.clamp(h.y,-.999975,.999975);const p=h.toLngLat(),d=e.project(p.lng,p.lat),f=t.MercatorCoordinate.fromLngLat(p);f.x+=Gn;const m=f.toLngLat(),g=e.project(m.lng,m.lat),y=Zn(g.x-d.x,g.y-d.y,u),_=t.MercatorCoordinate.fromLngLat(p);_.y+=Gn;const v=_.toLngLat(),x=e.project(v.lng,v.lat),b=Zn(x.x-d.x,x.y-d.y,u),w=Math.abs(y.x)/Math.abs(b.y),T=t.identity([]);t.rotateZ(T,T,-u*(1-(o?0:r)));const S=t.identity([]);return t.scale(S,S,[1,1-(1-w)*r,1]),S[4]=-b.x/b.y*r,t.rotateZ(S,S,u),t.multiply(S,T,S),S}(e.projection,0,e.center,n,i),o=Un(e);return t.scale(r,r,[o,o,1]),r}function Un(e){const i=e.projection,n=Vn(e.projection,e.zoom,e.width,e.height),r=qn(i,e.center),o=qn(i,t.LngLat.convert(i.center));return Math.pow(2,r*n+(1-n)*o)}function Vn(e,i,n,r,o=1/0){const s=e.range;if(!s)return 0;const a=Math.min(o,Math.max(n,r)),l=Math.log(a/1024)/Math.LN2;return t.smoothstep(s[0]+l,s[1]+l,i)}const Gn=1/4e4;function qn(e,i){const n=t.clamp(i.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),r=new t.LngLat(i.lng-180*Gn,n),o=new t.LngLat(i.lng+180*Gn,n),s=e.project(r.lng,n),a=e.project(o.lng,n),l=t.MercatorCoordinate.fromLngLat(r),c=t.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,p=c.x-l.x,d=c.y-l.y,f=Math.sqrt((p*p+d*d)/(u*u+h*h));return Math.log(f)/Math.LN2}function Zn(t,e,i){const n=Math.cos(i),r=Math.sin(i);return{x:t*n-e*r,y:t*r+e*n}}class Wn{constructor(e,i,n,r,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Rn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Wn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const e=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||e)&&this._updateCameraOnTerrain(),(t||e)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=t.getProjection(this.projectionOptions);const r=!e(n,this.getProjection());return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;var n;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(i),l=Math.cos(i);t[0]=n*l+o*a,t[1]=r*l+s*a,t[2]=n*-a+o*l,t[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<i.length;s++){const a=new t.pointGeometry(i[s][0]*this.width,n+i[s][1]*(this.height-n)),l=e.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,n=this._mercatorZfromZoom(t),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const r=t.length(t.sub([],this._camera.position,n));return t.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new Bn;return i.position=new t.MercatorCoordinate(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const i=t.transformQuat([],[0,0,-1],e),n=t.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const r=Nn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=t.clamp(e[2],r/n,r/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.UnwrappedTileID(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new t.pointGeometry(0,0)),r=this.pointCoordinate(new t.pointGeometry(this.width,0)),o=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new t.UnwrappedTileID(n,e))}return i}coveringTiles(e){let i=this.coveringZoomLevel(e);const n=i,r=this.elevation&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<i,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,p=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),d=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*t.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),g=[l*d.x,l*d.y,m*(h?1:f)],y=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,v=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=e.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?Un(this):1,w=e=>{const i=1/4e4,n=new t.MercatorCoordinate(e.x+i,e.y,e.z),r=new t.MercatorCoordinate(e.x,e.y+i,e.z),o=e.toLngLat(),s=n.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),p=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*p)*b/i},T=e=>{const i=v,n=x;return{aabb:t.tileAABB(this,l,0,0,0,e,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:e,fullyVisible:!1}},S=[];let C=[];const E=i,I=e.reparseOverscaled?n:i,M=t=>t*t,A=M((m-this._centerAltitude)*f),k=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=P(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},P=e=>{if(e.zoom<_)return!0;if(e.zoom===E)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(g),o=e.aabb.distanceY(g);let s=A,l=1;if(u){s=M(e.aabb.distanceZ(g));const i=Math.pow(2,e.zoom),n=t.latFromMercatorY((e.y+1)/i),r=t.latFromMercatorY(e.y/i),o=Math.min(Math.max(a,n),r),c=t.circumferenceAtLatitude(o)/t.circumferenceAtLatitude(a);if(l=o===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=t.GLOBE_ZOOM_THRESHOLD_MIN&&e.zoom===E-1&&c>=.9)return!0}else if(r&&(s=M(e.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,e.zoom),n=w(new t.MercatorCoordinate((e.x+.5)/i,(e.y+.5)/i));l=n>.85?1:n}const c=i*i+o*o+s;return c<M((1<<E-e.zoom)*y*l*((t,e)=>{if(e*M(.707)<t)return 1;const i=Math.sqrt(e/t);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,A),c))};if(this.renderWorldCopies)for(let t=1;t<=3;t++)S.push(T(-t)),S.push(T(t));for(S.push(T(0));S.length>0;){const n=S.pop(),s=n.x,a=n.y;let h=n.fullyVisible;if(!h){const t=n.aabb.intersects(p);if(0===t)continue;h=2===t}if(n.zoom!==E&&P(n))for(let e=0;e<4;e++){const i=(s<<1)+e%2,c=(a<<1)+(e>>1),p={aabb:o?n.aabb.quadrant(e):t.tileAABB(this,l,n.zoom+1,i,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:c,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(p.tileID=new t.OverscaledTileID(n.zoom+1===E?I:n.zoom+1,n.wrap,n.zoom+1,i,c),k(p)),S.push(p)}else{const r=n.zoom===E?I:n.zoom;if(e.minzoom&&e.minzoom>r)continue;const o=c[0]-(.5+s+(n.wrap<<n.zoom))*(1<<i-n.zoom),l=c[1]-.5-a,u=n.tileID?n.tileID:new t.OverscaledTileID(r,n.wrap,n.zoom,s,a);C.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();C=C.filter((r=>{const o=[0,0,0,1],s=[t.EXTENT,t.EXTENT,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());t.transformMat4$1(o,o,a),t.transformMat4$1(s,s,a);const l=t.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=u.getMinMaxForTile(r.tileID)),o||(o={min:x,max:v});const s=t.furthestTileCorner(this.rotation),a=[s[0]*t.EXTENT,s[1]*t.EXTENT,o.max];t.transformMat4(a,a,i),c=(1-a[1])*this.height*.5<n}return l<i||c}))}return C.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.clamp(e.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),n=this.projection.project(e.lng,i);return new t.pointGeometry(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(e,i){let n,r;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;n=(i.x-o.x)/t,r=(i.y-o.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(o);n=t.x-e.x,r=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.MercatorCoordinate(s.x-n,s.y-r))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const n=i?t.mercatorZfromAltitude(i,e.lat):void 0,r=this.projection.project(e.lng,e.lat);return new t.MercatorCoordinate(r.x,r.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const n=null!=i?i:this._centerAltitude,r=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4$1(r,r,this.pixelMatrixInverse),t.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];t.scale$1(r,r,1/r[3]),t.scale$1(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.transformMat4$1(i,i,this.pixelMatrixInverse),t.transformMat4$1(n,n,this.pixelMatrixInverse),t.scale$1(i,i,1/i[3]),t.scale$1(n,n,1/n[3]),i[2]=t.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,t.scale$1(i,i,1/this.worldSize),t.scale$1(n,n,1/this.worldSize),new t.Ray([i[0],i[1],i[2]],t.normalize([],t.sub([],n,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:n,t:r}=e,o=t.mercatorZfromAltitude(i[2],this._center.lat),s=t.mercatorZfromAltitude(n[2],this._center.lat);return new t.MercatorCoordinate(t.number(i[0],n[0],r)/this.worldSize,t.number(i[1],n[1],r)/this.worldSize,t.number(o,s,r))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t.MercatorCoordinate(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(e.y>r)return this.pointCoordinate(e);const o=.02*r,s=e.clone();for(let e=0;e<10&&r-n>o;e++){s.y=t.number(n,r,.66);const e=this.projection.pointCoordinate3D(this,s.x,s.y);e?(r=s.y,i=e):n=s.y}return i?new t.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(e,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.transformMat4$1(r,r,this.pixelMatrix),r[3]>0?new t.pointGeometry(r[0]/r[3],r[1]/r[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(e,i){const n=new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),r=new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(n,e),l=this.pointCoordinate(r,e);const c=this.pointCoordinate(o,i),u=this.pointCoordinate(s,i),h=(t,e)=>(e.y-t.y)/(e.x-t.x);return a.y>1&&l.y>=0?a=new t.MercatorCoordinate((1-u.y)/h(u,a)+u.x,1):a.y<0&&l.y<=1&&(a=new t.MercatorCoordinate(-u.y/h(u,a)+u.x,0)),l.y>1&&a.y>=0?l=new t.MercatorCoordinate((1-c.y)/h(c,l)+c.x,1):l.y<0&&a.y<=1&&(l=new t.MercatorCoordinate(-c.y/h(c,l)+c.x,0)),(new t.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(c))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBounds(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=e.canonical,o=1/this.height,s=this.cameraWorldSize/this.zoomScale(r.z),a=(r.x+Math.pow(2,r.z)*e.wrap)*s,l=r.y*s,c=this.point,u=this.angle,h=Math.sin(-u),p=-Math.cos(-u);return n[i]={bearing:[h,p],center:[(c.x-a)*o,(c.y-l)*o],scale:s/t.EXTENT*o},n[i]}calculateFogTileMatrix(e){const i=e.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSize,e);return t.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(e,i=!1){const n=e.key,r=i?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const o=this.calculatePosMatrix(e,this.worldSize);return t.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),r[n]=new Float32Array(o),r[n]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=function(e,i){const{scale:n}=e.tileTransform,r=n*t.EXTENT/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return o=new Float32Array(4),l=(s=i.inverseAdjustmentMatrix)[1],c=s[2],u=s[3],p=(a=[r,r])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=c*p,o[3]=u*p,o;var o,s,a,l,c,u,h,p}(e,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),o=t.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,r[2]/=o,t.normalize(r,r);const s=e.raycast(n,r,e.exaggeration());if(s){const e=t.scaleAndAdd([],n,r,s),i=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),a=(i.z+t.length([i.x-n[0],i.y-n[1],i.z-n[2]*o]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const i=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=e.getAtPointOrZero(new t.MercatorCoordinate(...n)),o=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),s=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*r;if(s<o){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[e.x-n[0],e.y-n[1],e.z-n[2]],r=t.length(i);i[2]-=(o-s)/this._projectionScaler;const a=t.length(i);if(0===a)return;t.scale$2(i,i,r/a*this._projectionScaler),this._camera.position=[e.x-i[0],e.y-i[1],e.z*this._projectionScaler-i[2]],this._camera.orientation=Nn(i,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const e=this.center;return e.lat=t.clamp(e.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(e.lng=t.clamp(e.lng,this.minLng,this.maxLng)),this.center=e,void(this._constraining=!1)}const e=this._unmodified,{x:i,y:n}=this.point;let r=0,o=i,s=n;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(n-l<c&&(s=c+l),n+l>u&&(s=u-l),u-c<this.height&&(r=Math.max(r,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,n=this.worldSize/2-(t+e)/2;o=(i+n+this.worldSize)%this.worldSize-n,o-a<t&&(o=t+a),o+a>e&&(o=e-a),e-t<this.width&&(r=Math.max(r,this.width/(e-t)),o=(e+t)/2)}o===i&&s===n||(this.center=this.unproject(new t.pointGeometry(o,s))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCameraAltitude(),this._unmodified=e,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i=this.pixelsPerMeter;if("globe"===this.projection.name){const e=t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,i=t.mercatorZfromAltitude(1,t.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=e/i}const n=Vn(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?i:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-e.x/this.width,o[9]=2*e.y/this.height;let s=t.mul([],o,r);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.identity([]);t.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.multiply(i,i,$n(this)),t.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.multiply(s,s,i),this.inverseAdjustmentMatrix=function(t){const e=$n(t,!0);return _([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],s,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=s,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const a=t.invert([],o);this.frustumCorners=t.FrustumCorners.fromInvProjectionMatrix(a,this.horizonLineFromTop(),this.height);const l=new Float32Array(16);t.identity(l),t.scale(l,l,[1,-1,1]),t.rotateX(l,l,this._pitch),t.rotateZ(l,l,this.angle);const c=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),u=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;c[8]=2*-e.x/this.width,c[9]=2*(e.y+u)/this.height,this.skyboxMatrix=t.multiply(l,c,l);const h=this.point,p=h.x,d=h.y,f=this.width%2/2,m=this.height%2/2,g=Math.cos(this.angle),y=Math.sin(this.angle),v=p-Math.round(p)+g*f+y*m,x=d-Math.round(d)+g*m+y*f,b=new Float64Array(s);if(t.translate(b,b,[v>.5?v-1:v,x>.5?x-1:x,0]),this.alignedProjMatrix=b,s=t.create(),t.scale(s,s,[this.width/2,-this.height/2,1]),t.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=t.create(),t.scale(s,s,[1,-1,1]),t.translate(s,s,[-1,-1,0]),t.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=t.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=s,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.calculateGlobeMatrix(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.transformMat4(e,e,r),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=s;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSize,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._projectionScaler,o=[e,e,i];t.scale$2(o,o,r),t.scale$2(n,n,-1),t.multiply$2(n,n,o);const s=t.create();t.translate(s,s,n),t.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,r)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,t/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=e[2];let r=1;n>0&&(r=Math.min((i-this._camera.position[2])/n,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,i,a),this._pitch=t.clamp(n,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(r,-Math.PI,Math.PI),this._setZoom(t.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const n=Math.min(e.x,i.x),r=Math.max(e.x,i.x),o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.pointGeometry(n,o),new t.pointGeometry(r,s),new t.pointGeometry(n,s),new t.pointGeometry(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,i){const n=t.length(t.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const e=function(e,i){const n=[e[0],e[1],e[2],1];t.transformMat4$1(n,n,i);const r=Math.max(n[3],1e-6);return[n[0]/r,n[1]/r,n[2]/r,r]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.pointGeometry(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}}getCameraToCenterDistance(t){const e=Vn(t,this.zoom,this.width,this.height,1024),i=t.pixelSpaceConversion(this.center.lat,this.worldSize,e);return.5/Math.tan(.5*this._fov)*this.height*i}}function Hn(t,e){let i=!1,n=null;const r=()=>{n=null,i&&(t(),n=setTimeout(r,e),i=!1)};return()=>(i=!0,n||r(),n)}class Xn{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Hn(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(e){const i=this._map;if(!i)return"";const n=i.getCenter(),r=Math.round(100*i.getZoom())/100,o=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,o),a=Math.round(n.lng*s)/s,l=Math.round(n.lat*s)/s,c=i.getBearing(),u=i.getPitch();let h="";if(h+=e?`/${a}/${l}/${r}`:`${r}/${l}/${a}`,(c||u)&&(h+="/"+Math.round(10*c)/10),u&&(h+=`/${Math.round(u)}`),this._hashName){const e=this._hashName;let i=!1;const n=t.window.location.hash.slice(1).split("&").map((t=>{const n=t.split("=")[0];return n===e?(i=!0,`${n}=${h}`):t})).filter((t=>t));return i||n.push(`${e}=${h}`),`#${n.join("&")}`}return`#${h}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((t=>t.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const Yn={linearity:.3,easing:t.bezier(0,0,.3,1)},Kn=t.extend({deceleration:2500,maxSpeed:1400},Yn),Jn=t.extend({deceleration:20,maxSpeed:1400},Yn),Qn=t.extend({deceleration:1e3,maxSpeed:360},Yn),tr=t.extend({deceleration:1e3,maxSpeed:90},Yn);class er{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.exported.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=nr(i.pan.mag(),n,t.extend({},Kn,e||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,ir(r,o)}if(i.zoom){const t=nr(i.zoom,n,Jn);r.zoom=this._map.transform.zoom+t.amount,ir(r,t)}if(i.bearing){const e=nr(i.bearing,n,Qn);r.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),ir(r,e)}if(i.pitch){const t=nr(i.pitch,n,tr);r.pitch=this._map.transform.pitch+t.amount,ir(r,t)}if(r.zoom||r.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function ir(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function nr(e,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=t.clamp(e*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class rr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n,r={}){const o=f(i.getCanvasContainer(),n),s=i.unproject(o);super(e,t.extend({point:o,lngLat:s,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class or extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){const r="touchend"===e?n.changedTouches:n.touches,o=m(i.getCanvasContainer(),r),s=o.map((t=>i.unproject(t))),a=o.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new t.pointGeometry(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class sr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class ar{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new sr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new rr(t.type,this._map,t))}mouseup(t){this._map.fire(new rr(t.type,this._map,t))}preclick(e){const i=t.extend({},e);i.type="preclick",this._map.fire(new rr(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new rr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new rr(t.type,this._map,t))}mouseover(t){this._map.fire(new rr(t.type,this._map,t))}mouseout(t){this._map.fire(new rr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new or(t.type,this._map,t))}touchmove(t){this._map.fire(new or(t.type,this._map,t))}touchend(t){this._map.fire(new or(t.type,this._map,t))}touchcancel(t){this._map.fire(new or(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new rr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new rr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cr{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(n.x,i.x),s=Math.max(n.x,i.x),a=Math.min(n.y,i.y),l=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${r}px,${a}px)`,this._box.style.width=s-r+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(e,i){if(!this._active)return;if(0!==e.button)return;const n=this._startPos,r=i;if(this.reset(),d(),n.x!==r.x||n.y!==r.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.Event(e,{originalEvent:i}))}}function ur(t,e){const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class hr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const i=new t.pointGeometry(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=ur(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=ur(i,e);for(const t in this.touches){const e=this.touches[t],i=n[t];(!i||i.dist(e)>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class pr{constructor(t){this.singleTap=new hr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class dr{constructor(){this._zoomIn=new pr({numTouches:1,numTaps:2}),this._zoomOut=new pr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),r=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fr={0:1,2:2};class mr{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=g(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=fr[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&g(t)===this._eventButton&&(this._moved&&d(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gr extends mr{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class yr extends mr{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class _r extends mr{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class vr{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,e,i)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,n){n.length>0&&(this._active=!0);const r=ur(n,i),o=new t.pointGeometry(0,0),s=new t.pointGeometry(0,0);let a=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,r[t]=e)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")}),500)}}class xr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const n=this._firstTwoTouches;if(!n)return;t.preventDefault();const[r,o]=n,s=br(i,e,r),a=br(i,e,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=br(i,e,n),s=br(i,e,r);o&&s||(this._active&&d(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function br(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function wr(t,e){return Math.log(t/e)/Math.LN2}class Tr extends xr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(wr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wr(this._distance,i),pinchAround:e}}}function Sr(t,e){return 180*t.angleWith(e)/Math.PI}class Cr extends xr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sr(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=Sr(t,this._startVector);return Math.abs(i)<e}}function Er(t){return Math.abs(t.y)>Math.abs(t.x)}class Ir extends xr{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Er(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){const n=this._lastPoints;if(!n)return;const r=t[0].sub(n[0]),o=t[1].sub(n[1]);return this._map._cooperativeGestures&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(r,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,r=e.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return Er(t)&&Er(e)&&o}}const Mr={panStep:100,bearingStep:15,pitchStep:10};class Ar{constructor(){const t=Mr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:kr,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kr(t){return t*(2-t)}const Pr=4.000244140625;class Lr{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.exported.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Pr==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=f(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform,i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Pr?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const r=i(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),i=o(e);s=t.number(r,n,i),e<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.ease;if(this._prevEase){const e=this._prevEase,n=(t.exported.now()-e.start)/e.duration,r=e.easing(n+.01)-e.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=t.bezier(o,s,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!t.window.document.fullscreenElement||!!t.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")}),200)}}class zr{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rr{constructor(){this._tap=new pr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Or{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fr{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nr{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Br=t=>t.zoom||t.drag||t.pitch||t.rotate;class jr extends t.Event{}class $r{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const n=t.sub([],i,e);this.radius=t.length(n[2]<0?t.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);const i=t.scale$2([],e,this.radius);if(i[2]>0){const e=t.scale$2([],[0,0,1],t.dot(i,[0,0,1])),n=t.scale$2([],t.normalize([],[i[0],i[1],0]),this.radius),r=t.add([],i,t.scale$2([],t.sub([],t.add([],n,e),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Ur(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Vr{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new er(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $r,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[e,i,n]of this._listeners)e.addEventListener(i,e===t.window.document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[e,i,n]of this._listeners)e.removeEventListener(i,e===t.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new ar(e,t));const n=e.boxZoom=new cr(e,t);this._add("boxZoom",n);const r=new dr,o=new Dr;e.doubleClickZoom=new zr(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new Rr;this._add("tapDragZoom",s);const a=e.touchPitch=new Ir(e);this._add("touchPitch",a);const l=new yr(t),c=new _r(t);e.dragRotate=new Fr(t,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new gr(t),h=new vr(e,t);e.dragPan=new Or(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const p=new Cr,d=new Tr;e.touchZoomRotate=new Nr(i,d,p,s),this._add("touchRotate",p,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lr(e));const f=e.scrollZoom=new Lr(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new Ar;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Br(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,r={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[e||t.type]&&(h=c[e||t.type](t,l,a),this.mergeHandlerResult(r,o,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=n);this._previousActiveHandlers=s,(Object.keys(c).length||Ur(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Ur(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,i,n,r,o){if(!n)return;t.extend(e,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.aroundCoord&&(e.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.extend(i,o),t.extend(n,s);this._updateMapTransform(e,i,n),this._changes=[]}_updateMapTransform(e,i,n){const r=this._map,o=r.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Ur(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(!Ur(e))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:p,pinchAround:d}=e;void 0!==d&&(h=d),(t=>i.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a){const e=o.pointCoordinate(h);if("globe"===o.projection.name){const i=t.latFromMercatorY(e.y),n=o.center.lat,r=Math.min(t.mercatorZfromAltitude(1,i)/t.mercatorZfromAltitude(1,n),2);a=a.rotate(-o.angle),f[0]=-a.x/o.worldSize*r,f[1]=-a.y/o.worldSize*r}else{const t=o.pointCoordinate(h.sub(a));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const m=o.zoom,g=[0,0,0];if(l){const e=s(p||o.pointCoordinate3D(h)),i={dir:t.normalize([],t.sub([],e,o._camera.position))};if(i.dir[2]<0){const n=o.zoomDeltaToMovement(e,l);t.scale$2(g,i.dir,n)}}const y=t.add(f,f,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,n,!0)}_fireEvents(e,i,n){const r=Br(this._eventsInProgress),o=Br(e),s={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let l;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],l=i[e]||n,a[`${t}end`]=l)}for(const t in a)this._fireEvent(t,a[t]);const c=Br(this._eventsInProgress);if(n&&(r||o)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:l})):(this._map.fire(new t.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.Event(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new jr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Gr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qr extends t.Evented{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,n){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},i),n)}panTo(e,i,n){return this.easeTo(t.extend({center:e},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,n){return this.easeTo(t.extend({zoom:e},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,n){return this.easeTo(t.extend({bearing:e},i),n)}resetNorth(e,i){return this.rotateTo(0,t.extend({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){"globe"===this.transform.projection.name&&t.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),e=t.LngLatBounds.convert(e);const n=i&&i.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,i)}_extendCameraOptions(e){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(i,e.padding),e}_cameraForBoxAndBearing(e,i,n,r){const o=this._extendCameraOptions(r),s=this.transform,a=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(i)),u=new t.pointGeometry(l.x,c.y),h=new t.pointGeometry(c.x,l.y),p=-t.degToRad(n),d=l.rotate(p),f=c.rotate(p),m=u.rotate(p),g=h.rotate(p),y=new t.pointGeometry(Math.max(d.x,f.x,m.x,g.x),Math.max(d.y,f.y,m.y,g.y)),_=new t.pointGeometry(Math.min(d.x,f.x,m.x,g.x),Math.min(d.y,f.y,m.y,g.y)),v=y.sub(_),x=(s.width-((a.left||0)+(a.right||0)+o.padding.left+o.padding.right))/v.x,b=(s.height-((a.top||0)+(a.bottom||0)+o.padding.top+o.padding.bottom))/v.y;if(b<0||x<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const w=Math.min(s.scaleZoom(s.scale*Math.min(x,b)),o.maxZoom),T="number"==typeof o.offset.x&&"number"==typeof o.offset.y?new t.pointGeometry(o.offset.x,o.offset.y):t.pointGeometry.convert(o.offset),S=new t.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(n*Math.PI/180),C=T.add(S).mult(s.scale/s.zoomScale(w));return{center:s.unproject(l.add(c).div(2).sub(C)),zoom:w,bearing:n}}_cameraForBox(e,i,n,r,o){const s=this._extendCameraOptions(o);n=n||0,r=r||0,e=t.LngLat.convert(e),i=t.LngLat.convert(i);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),c=new t.LngLat(.5*(e.lng+i.lng),.5*(e.lat+i.lat)),u=.5*(n+r);if(a._camera.position[2]<t.mercatorZfromAltitude(u,c.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=t.MercatorCoordinate.fromLngLat(e),p=t.MercatorCoordinate.fromLngLat(i),d=a.pointRayIntersection(a.centerPoint,u),f=[(m=a.rayIntersectionCoordinate(d)).x,m.y,m.z];var m;const g=a.screenPointToMercatorRay(a.centerPoint),y="globe"!==a.projection.name;let _,v=0;do{const i=Math.floor(a.zoom),o=1<<i,s=Math.min(o*h.x,o*p.x),l=Math.min(o*h.y,o*p.y),c=Math.max(o*h.x,o*p.x),u=Math.max(o*h.y,o*p.y),d=new t.Aabb([s,l,n],[c,u,r]),m=t.Frustum.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,i,y);if(2!==d.intersects(m)){_&&(a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,-_),a._updateStateFromCamera());break}const v=t.sub([],a._camera.position,f);_=.5*t.length(v),a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,_);try{a._updateStateFromCamera()}catch(e){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(e,i,n){return"globe"===this.transform.projection.name&&t.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(e,i),i,n)}_raycastElevationBox(e,i){const n=this.transform.elevation;if(!n)return;const r=new t.pointGeometry(e.x,i.y),o=new t.pointGeometry(i.x,e.y),s=n.pointCoordinate(e);if(!s)return;const a=n.pointCoordinate(i);if(!a)return;const l=n.pointCoordinate(r);if(!l)return;const c=n.pointCoordinate(o);if(!c)return;const u=new t.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),p=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),d=new t.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(p.lng,d.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(p.lat,d.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(p.lng,d.lng))),y=Math.max(u.lat,Math.max(h.lat,Math.max(p.lat,d.lat))),_=Math.min(s[3],Math.min(a[3],Math.min(l[3],c[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new t.LngLat(f,m),maxLngLat:new t.LngLat(g,y),minAltitude:_,maxAltitude:v}}fitScreenCoordinates(e,i,n,r,o){let s,a,l,c;"globe"===this.transform.projection.name&&t.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const u=t.pointGeometry.convert(e),h=t.pointGeometry.convert(i),p=this._raycastElevationBox(u,h);if(p)s=p.minLngLat,a=p.maxLngLat,l=p.minAltitude,c=p.maxAltitude;else{if(this.transform.anyCornerOffEdge(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(i)),n,r):this._cameraForBox(s,a,l,c,r),r,o)}_fitInternal(e,i,n){return e?(delete(i=t.extend(e,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(e,i){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,s=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(s=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),r&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),o&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),s&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(Gr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return t.warnOnce(Gr),this;this.stop();const r=n.zoom,o=n.pitch,s=n.bearing;n.setFreeCameraOptions(e);const a=r!==n.zoom,l=o!==n.pitch,c=s!==n.bearing;return this.fire(new t.Event("movestart",i)).fire(new t.Event("move",i)),a&&this.fire(new t.Event("zoomstart",i)).fire(new t.Event("zoom",i)).fire(new t.Event("zoomend",i)),c&&this.fire(new t.Event("rotatestart",i)).fire(new t.Event("rotate",i)).fire(new t.Event("rotateend",i)),l&&this.fire(new t.Event("pitchstart",i)).fire(new t.Event("pitch",i)).fire(new t.Event("pitchend",i)),this.fire(new t.Event("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?+e.zoom:r,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:n.padding,p=t.pointGeometry.convert(e.offset);let d,f,m;if("globe"===n.projection.name){const i=t.MercatorCoordinate.fromLngLat(n.center),r=p.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const o=i.toLngLat(),s=t.LngLat.convert(e.center||o);this._normalizeCenter(s),d=n.centerPoint.add(r),f=new t.pointGeometry(i.x,i.y).mult(n.worldSize),m=new t.pointGeometry(t.mercatorXfromLng(s.lng),t.mercatorYfromLat(s.lat)).mult(n.worldSize).sub(f)}else{d=n.centerPoint.add(p);const i=n.pointLocation(d),r=t.LngLat.convert(e.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let y,_;e.around&&(y=t.LngLat.convert(e.around),_=n.locationPoint(y));const v=this._zooming||l!==r,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!n.isPaddingEqual(h),T=n=>T=>{if(v&&(n.zoom=t.number(r,l,T)),x&&(n.bearing=t.number(o,c,T)),b&&(n.pitch=t.number(s,u,T)),w&&(n.interpolatePadding(a,h,T),d=n.centerPoint.add(p)),y)n.setLocationAtPoint(y,_);else{const t=n.zoomScale(n.zoom-r),e=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(e,1-T),o=n.unproject(f.add(m.mult(T*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,d)}return e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(T,e.duration,n);return this._preloadTiles(t),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,S),this._ease(T(n),(t=>{n.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),r&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,i){if(!e.essential&&t.exported.prefersReducedMotion){const n=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,n.minZoom,n.maxZoom):r,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:n.padding,p=n.zoomScale(l-r),d=t.pointGeometry.convert(e.offset);let f=n.centerPoint.add(d);const m=n.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const y=n.project(m),_=n.project(g).sub(y);let v=e.curve;const x=Math.max(n.width,n.height),b=x/p,w=_.mag();if("minZoom"in e){const i=t.clamp(Math.min(e.minZoom,r,l),n.minZoom,n.maxZoom),o=x/n.zoomScale(i-r);v=Math.sqrt(o/w*2)}const T=v*v;function S(t){const e=(b*b-x*x+(t?-1:1)*T*T*w*w)/(2*(t?b:x)*T*w);return Math.log(Math.sqrt(e*e+1)-e)}function C(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const I=S(0);let M=function(t){return E(I)/E(I+v*t)},A=function(t){return x*((E(I)*(C(e=I+v*t)/E(e))-C(I))/T)/w;var e},k=(S(1)-I)/v;if(Math.abs(w)<1e-6||!isFinite(k)){if(Math.abs(x-b)<1e-6)return this.easeTo(e,i);const t=b<x?-1:1;k=Math.abs(Math.log(b/x))/v,A=function(){return 0},M=function(e){return Math.exp(t*v*e)}}e.duration="duration"in e?+e.duration:1e3*k/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const P=o!==c,L=u!==s,z=!n.isPaddingEqual(h),D=n=>p=>{const m=p*k,v=1/M(m);n.zoom=1===p?l:r+n.scaleZoom(v),P&&(n.bearing=t.number(o,c,p)),L&&(n.pitch=t.number(s,u,p)),z&&(n.interpolatePadding(a,h,p),f=n.centerPoint.add(d));const x=1===p?g:n.unproject(y.add(_.mult(A(m))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?x.wrap():x,f),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(D,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=P,this._pitching=L,this._padding=z,this._prepareEase(i,!1),this._ease(D(n),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.exported.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.wrap(e,-180,180);const n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.maxBounds)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_emulate(t,e,i){const n=Math.ceil(15*e/1e3),r=[],o=t(i.clone());for(let t=0;t<=n;t++){const e=o(t/n);r.push(e.clone())}return r}}class Zr{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.setAttribute("aria-label",i),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const n=i.reduce(((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<i.length-1?"&":""}`),t)),"?");e.href=`${t.config.FEEDBACK_URL}/${n}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const i in e){const n=e[i];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wr{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Hr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xr(e,i,n){if(e=new t.LngLat(e.lng,e.lat),i){const r=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<s)?e=r:n.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-n.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const Yr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Kr extends t.Evented{constructor(e,i){if(super(),(e instanceof t.window.HTMLElement||i)&&(e=t.extend({element:e},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,n=27,r=s("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},r));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const n=this._element.classList;for(const t in Yr)n.remove(`mapboxgl-marker-anchor-${t}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map;if(!t)return!1;const e=t.unproject(this._pos),i=t.getFreeCameraOptions();if(!i.position)return!1;const n=i.position.toLngLat();return n.distanceTo(e)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(i);let r;e._usingGlobe()&&t.isLngLatBehindGlobe(e.transform,this._lngLat)?r=0:(r=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(r*=.2)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._calculateXYTransform()+this._calculateZTransform(),i=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px) ${Yr[this._anchor]}\n            ${e}\n            translate(${i.x}px,${i.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map;if("map"!==this.getPitchAlignment()||!i||!e)return"";if(!i._usingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const n=t.radToDeg(t.globeTiltAtLngLat(i.transform,this._lngLat)),r=e.sub(t.globeCenterToScreenPoint(i.transform)),o=n/(Math.abs(r.x)+Math.abs(r.y)),s=r.x*o,a=-r.y*o;return a||s?`rotateX(${a}deg) rotateY(${s}deg)`:""}_calculateZTransform(){const t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const e=this._map;if(this._pos&&e&&e._usingGlobe()){const i=e.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),n=e.project(new t.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(i);return this._rotation+t.radToDeg(Math.atan2(n.y,n.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(e){t.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Xr(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===e?this._updateFrameId=t.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._usingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){const i=this._map;if(i){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map;e&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Jr{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const Qr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},to={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function eo(t){t.parentNode&&t.parentNode.removeChild(t)}const io={showCompass:!0,showZoom:!0,visualizePitch:!1};class no{constructor(e,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new yr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new _r({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const i=this.map,n=this.mouseRotate.mousemoveWindow(t,e),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,f(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=m(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ro={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},oo={maxWidth:100,unit:"metric"};function so(t,e,i,n,r,o){const s=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i),a=s/i;o._requestDomTask((()=>{t.style.width=e*a+"px",t.innerHTML="nautical-mile"!==r?new Intl.NumberFormat(n,{style:"unit",unitDisplay:"narrow",unit:r}).format(s):`${s}&nbsp;nm`}))}const ao={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(e=new t.pointGeometry(0,0),i="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.pointGeometry(0,e);case"top-left":return new t.pointGeometry(n,n);case"top-right":return new t.pointGeometry(-n,n);case"bottom":return new t.pointGeometry(0,-e);case"bottom-left":return new t.pointGeometry(n,-n);case"bottom-right":return new t.pointGeometry(-n,-n);case"left":return new t.pointGeometry(e,0);case"right":return new t.pointGeometry(-e,0)}return new t.pointGeometry(0,0)}return e instanceof t.pointGeometry||Array.isArray(e)?t.pointGeometry.convert(e):t.pointGeometry.convert(e[i]||[0,0])}const uo={version:t.version,supported:i,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends qr{constructor(e){if(null!=(e=t.extend({},to,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(e.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._language="auto"===e.language?t.window.navigator.language:e.language,this._worldview=e.worldview,this._renderTaskQueue=new Hr,this._domRenderTaskQueue=new Hr,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Qr,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jr(0),this._explicitProjection=null,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Vr(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new Xn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new Zr({customAttribution:e.customAttribution})),this._logoControl=new Wr,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),i&&this.fire(new t.Event("moveend",e)),this}getBounds(){return"globe"===this.transform.projection.name&&t.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}getLanguage(){return this._language}setLanguage(e){if(this._language="auto"===e?t.window.navigator.language:e,this.style)for(const t in this.style._sourceCaches){const e=this.style._sourceCaches[t]._source;e._setLanguage&&e._setLanguage(this._language)}for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){if(this._worldview=t,this.style)for(const e in this.style._sourceCaches){const i=this.style._sourceCaches[e]._source;i._setWorldview&&i._setWorldview(t)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._updateProjection(t)}_updateProjection(e){const i=this.getProjection();null===e&&(this._explicitProjection=null);const n=e||this.getProjection();let r;if(n&&"globe"===n.name&&this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?(r=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(r=this.transform.setProjection(n),this.transform.mercatorFromTransition=!1),e&&(this._explicitProjection="globe"===e.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),r){if("globe"===i.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const t in this.style._sourceCaches)this.style._sourceCaches[t].clearTiles()}this._update(!0)}return this}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t))),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?n||(n=!0,i.call(this,new rr(t,this,r.originalEvent,{features:s}))):n=!1},o=()=>{n=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new rr(t,this,r.originalEvent)))},o=e=>{n&&(n=!1,i.call(this,new rr(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=t=>{const n=e.filter((t=>this.getLayer(t))),r=n.length?this.queryRenderedFeatures(t.point,{layers:n}):[];r.length&&(t.features=r,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:n}}}}on(t,e,i){if(void 0===i)return super.on(t,e);Array.isArray(e)||(e=[e]);const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const t in n.delegates)this.on(t,n.delegates[t]);return this}once(t,e,i){if(void 0===i)return super.once(t,e);Array.isArray(e)||(e=[e]);const n=this._createDelegatedListener(t,e,i);for(const t in n.delegates)this.once(t,n.delegates[t]);return this}off(t,e,i){if(void 0===i)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);const n=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[t]:void 0;return r&&(t=>{for(let r=0;r<t.length;r++){const o=t[r];if(o.listener===i&&n(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(r,1),this}}})(r),this}queryRenderedFeatures(e,i){return this.style?(void 0!==i||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(i=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}queryTerrainElevation(e,i){const n=this.transform.elevation;return n?(i=t.extend({},{exaggerated:!0},i),n.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,i.exaggerated)):null}setStyle(e,i){return!1!==(i=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new ti(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const n=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(r,((e,n)=>{e?this.fire(new t.ErrorEvent(e)):n&&this._updateDiff(n,i)}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){return!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,i,{pixelRatio:n=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap){const{width:l,height:c,data:u}=t.exported.getImageData(i);this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},u),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(e,{data:new t.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,i){const n=this.style.getImage(e);if(!n)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap?t.exported.getImageData(i):i,{width:o,height:s}=r;void 0!==o&&void 0!==s?o===n.data.width&&s===n.data.height?(n.data.replace(r.data,!(i instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&i instanceof t.window.ImageBitmap)),this.style.updateImage(e,n)):this.fire(new t.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),((e,n)=>{i(e,n instanceof t.window.HTMLImageElement?t.exported.getImageData(n):n)}))}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,n={}){return this.style.setPaintProperty(t,e,i,n),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,n={}){return this.style.setLayoutProperty(t,e,i,n),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let n,r,o,s=this._container;for(;s&&(!r||!o);){const e=t.window.getComputedStyle(s).transform;e&&"none"!==e&&(n=e.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(r=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(o=n[3])),s=s.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",t),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{n[t]=o("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const n=t.exported.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_setupPainter(){const e=t.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e);n?(t.storeAuthState(n,!0),this.painter=new Dn(n,this.transform),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.exported$1.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;const n=this.painter.context.extTimerQuery,r=t.exported.now();if(this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=t.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let o=!1;const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,n=t.exported.now();this.style.zoomHistory.update(e,n);const r=new t.EvaluationParameters(e,{now:n,fadeDuration:s,pitch:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=r.crossFadingFactor();1===a&&a===this._crossFadingFactor||(o=!0,this._crossFadingFactor=a),this.style.update(r)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style._updateSources(this.transform),this._forceMarkerUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const e=t.exported.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:o})),t.window.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const t of this._markers)t._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let n=this.transform.sampleAverageElevation(),r=!1;this.transform.elevation&&(r=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof Wr&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(t,e,i){let n=i[1]-i[0];const r=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);n+=(i[o+2]-i[o+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),eo(this._canvasContainer),eo(this._controlContainer),eo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,i){t.setCacheLimits(e,i)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},io,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),n=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new no(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=o("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({geolocation:t.window.navigator.geolocation},ro,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Hn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((t=>{this._supportsGeolocation="denied"!==t.state,e(this._supportsGeolocation)})):(this._supportsGeolocation=!!this.geolocation,e(this._supportsGeolocation))}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=this._map.getBearing(),o=t.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),o,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.mercatorZfromAltitude(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))}))}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.window.DeviceMotionEvent&&"function"==typeof t.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Zr,ScaleControl:class{constructor(e){this.options=t.extend({},oo,e),t.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(t,e,i,n){const r=n&&n.maxWidth||100,o=t._containerHeight/2,s=t._containerWidth/2-r/2,a=t.unproject([s,o]),l=t.unproject([s+r,o]),c=a.distanceTo(l);if(n&&"imperial"===n.unit){const n=3.2808*c;n>5280?so(e,r,n/5280,i,"mile",t):so(e,r,n,i,"foot",t)}else n&&"nautical"===n.unit?so(e,r,c/1852,i,"nautical-mile",t):c>=1e3?so(e,r,c/1e3,i,"kilometer",t):so(e,r,c,i,"meter",t)}(this._map,this._container,this._language,this.options)}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(ao),e),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const i=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,n=this._pos;if(!e||!i||!n)return"bottom";const r=i.offsetWidth,o=i.offsetHeight,s=n.x<r/2,a=n.x>e.transform.width-r/2;if(n.y+t<o)return s?"top-left":a?"top-right":"top";if(n.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xr(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const t=this._pos=this._trackPointer&&e?e:i.project(this._lngLat),n=co(this.options.offset),r=this._anchor=this._getAnchor(n.y),o=co(this.options.offset,r),s=t.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${Yr[r]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._usingGlobe()){const e=t.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(lo);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:Kr,Style:ti,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:Bn,Evented:t.Evented,config:t.config,prewarm:function(){$t().acquire(Nt)},clearPrewarmedResources:function(){const t=jt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Nt),jt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Bt.workerCount},set workerCount(t){Bt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return uo})),i}(),ye=e({__proto__:null,default:ge},[me.exports]),_e={exports:{}},ve=bt(_e.exports=function(){var t={},e={};function i(i,n,r){if(e[i]=r,"index"===i){var o="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",s={};return e.shared(s),e.index(t,s),"undefined"!=typeof window&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),t}}return i("shared",["exports"],(function(t){function e(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}l((n=n.apply(t,e||[])).next())}))}function i(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var n,r;function o(){if(r)return n;function t(t,e){this.x=t,this.y=e}return r=1,n=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),r=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e},n}"function"==typeof SuppressedError&&SuppressedError;var s,a,l=i(o()),c=function(){if(a)return s;function t(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}return a=1,s=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var r=this.sampleCurveX(i)-t;if(Math.abs(r)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=t,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-t)<e));n++)t>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},s}(),u=i(c);let h,p;function d(){return null==h&&(h="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),h}function f(){if(null==p&&(p=!1,d())){const t=5,e=new OffscreenCanvas(t,t).getContext("2d",{willReadFrequently:!0});if(e){for(let i=0;i<t*t;i++){const n=4*i;e.fillStyle=`rgb(${n},${n+1},${n+2})`,e.fillRect(i%t,Math.floor(i/t),1,1)}const i=e.getImageData(0,0,t,t).data;for(let e=0;e<t*t*4;e++)if(e%4!=3&&i[e]!==e){p=!0;break}}}return p||!1}var m=1e-6,g="undefined"!=typeof Float32Array?Float32Array:Array;function y(){var t=new g(9);return g!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function _(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function v(){var t=new g(3);return g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function x(t){return Math.hypot(t[0],t[1],t[2])}function b(t,e,i){var n=new g(3);return n[0]=t,n[1]=e,n[2]=i,n}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var w,T=x;function S(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,t[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,t[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,t[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,t}function C(){var t=new g(4);return g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function E(){var t=new g(2);return g!=Float32Array&&(t[0]=0,t[1]=0),t}function I(t,e){var i=new g(2);return i[0]=t,i[1]=e,i}v(),w=new g(4),g!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),v(),b(1,0,0),b(0,1,0),C(),C(),y(),E();const M=8192;function A(t,e,i){return e*(M/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function k(t,e){return(t%e+e)%e}function P(t,e,i){return t*(1-i)+e*i}function L(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function z(t,e,i,n){const r=new u(t,e,i,n);return t=>r.solve(t)}const D=z(.25,.1,.25,1);function R(t,e,i){return Math.min(i,Math.max(e,t))}function O(t,e,i){const n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r}function F(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let N=1;function B(t,e,i){const n={};for(const i in t)n[i]=e.call(this,t[i],i,t);return n}function j(t,e,i){const n={};for(const i in t)e.call(this,t[i],i,t)&&(n[i]=t[i]);return n}function $(t){return Array.isArray(t)?t.map($):"object"==typeof t&&t?B(t,$):t}const U={};function V(t){U[t]||("undefined"!=typeof console&&console.warn(t),U[t]=!0)}function G(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function q(t){return"undefined"!=typeof WorkerGlobalScope&&void 0!==t&&t instanceof WorkerGlobalScope}let Z=null;function W(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}const H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function X(t,i,n,r,o){return e(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const e=new VideoFrame(t,{timestamp:0});try{const s=null==e?void 0:e.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(r*o*4);if(yield e.copyTo(l,function(t,e,i,n,r){const o=4*Math.max(1,0),s=(Math.max(0,i)-i)*n*4+o,a=4*n,l=Math.max(0,e),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(t.width,e+n)-l,height:Math.min(t.height,i+r)-c},layout:[{offset:s,stride:a}]}}(t,i,n,r,o)),a)for(let t=0;t<l.length;t+=4){const e=l[t];l[t]=l[t+2],l[t+2]=e}return l}finally{e.close()}}))}let Y,K;function J(t,e,i,n){return t.addEventListener(e,i,n),{unsubscribe:()=>{t.removeEventListener(e,i,n)}}}function Q(t){return t*Math.PI/180}function tt(t){return t/Math.PI*180}const et={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},it={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},nt="AbortError";function rt(){return new Error(nt)}const ot={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function st(t){return ot.REGISTERED_PROTOCOLS[t.substring(0,t.indexOf("://"))]}const at="global-dispatcher";class lt extends Error{constructor(t,e,i,n){super(`AJAXError: ${e} (${t}): ${i}`),this.status=t,this.statusText=e,this.url=i,this.body=n}}const ct=()=>q(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,ut=function(t,i){if(/:\/\//.test(t.url)&&!/^https?:|^file:/.test(t.url)){const e=st(t.url);if(e)return e(t,i);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,targetMapId:at},i)}if(!(/^file:/.test(n=t.url)||/^file:/.test(ct())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(t,i){return e(this,void 0,void 0,(function*(){const e=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,cache:t.cache,referrer:ct(),signal:i.signal});let n,r;"json"!==t.type||e.headers.has("Accept")||e.headers.set("Accept","application/json");try{n=yield fetch(e)}catch(e){throw new lt(0,e.message,t.url,new Blob)}if(!n.ok){const e=yield n.blob();throw new lt(n.status,n.statusText,t.url,e)}r="arrayBuffer"===t.type||"image"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text();const o=yield r;if(i.signal.aborted)throw rt();return{data:o,cacheControl:n.headers.get("Cache-Control"),expires:n.headers.get("Expires")}}))}(t,i);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:t,mustQueue:!0,targetMapId:at},i)}var n;return function(t,e){return new Promise(((i,n)=>{var r;const o=new XMLHttpRequest;o.open(t.method||"GET",t.url,!0),"arrayBuffer"!==t.type&&"image"!==t.type||(o.responseType="arraybuffer");for(const e in t.headers)o.setRequestHeader(e,t.headers[e]);"json"===t.type&&(o.responseType="text",(null===(r=t.headers)||void 0===r?void 0:r.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===t.credentials,o.onerror=()=>{n(new Error(o.statusText))},o.onload=()=>{if(!e.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let e=o.response;if("json"===t.type)try{e=JSON.parse(o.response)}catch(t){return void n(t)}i({data:e,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const e=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});n(new lt(o.status,o.statusText,t.url,e))}},e.signal.addEventListener("abort",(()=>{o.abort(),n(rt())})),o.send(t.body)}))}(t,i)};function ht(t){if(!t||t.indexOf("://")<=0||0===t.indexOf("data:image/")||0===t.indexOf("blob:"))return!0;const e=new URL(t),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function pt(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function dt(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class ft{constructor(t,e={}){F(this,e),this.type=t}}class mt extends ft{constructor(t,e={}){super("error",F({error:t},e))}}class gt{on(t,e){return this._listeners=this._listeners||{},pt(t,e,this._listeners),{unsubscribe:()=>{this.off(t,e)}}}off(t,e){return dt(t,e,this._listeners),dt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},pt(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){"string"==typeof t&&(t=new ft(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const e=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of e)i.call(this,t);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const e of n)dt(i,e,this._oneTimeListeners),e.call(this,t);const r=this._eventedParent;r&&(F(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(t))}else t instanceof mt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var yt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _t=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function vt(t,e){const i={};for(const e in t)"ref"!==e&&(i[e]=t[e]);return _t.forEach((t=>{t in e&&(i[t]=e[t])})),i}function xt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!xt(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!xt(t[i],e[i]))return!1;return!0}return t===e}function bt(t,e){t.push(e)}function wt(t,e,i){bt(i,{command:"addSource",args:[t,e[t]]})}function Tt(t,e,i){bt(e,{command:"removeSource",args:[t]}),i[t]=!0}function St(t,e,i,n){Tt(t,i,n),wt(t,e,i)}function Ct(t,e,i){let n;for(n in t[i])if(Object.prototype.hasOwnProperty.call(t[i],n)&&"data"!==n&&!xt(t[i][n],e[i][n]))return!1;for(n in e[i])if(Object.prototype.hasOwnProperty.call(e[i],n)&&"data"!==n&&!xt(t[i][n],e[i][n]))return!1;return!0}function Et(t,e,i,n,r,o){t=t||{},e=e||{};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(xt(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}));for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&!Object.prototype.hasOwnProperty.call(t,s)&&(xt(t[s],e[s])||i.push({command:o,args:[n,s,e[s],r]}))}function It(t){return t.id}function Mt(t,e){return t[e.id]=e,t}class At{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function kt(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class Pt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Lt{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Lt(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const zt={kind:"null"},Dt={kind:"number"},Rt={kind:"string"},Ot={kind:"boolean"},Ft={kind:"color"},Nt={kind:"projectionDefinition"},Bt={kind:"object"},jt={kind:"value"},$t={kind:"collator"},Ut={kind:"formatted"},Vt={kind:"padding"},Gt={kind:"colorArray"},qt={kind:"numberArray"},Zt={kind:"resolvedImage"},Wt={kind:"variableAnchorOffsetCollection"};function Ht(t,e){return{kind:"array",itemType:t,N:e}}function Xt(t){if("array"===t.kind){const e=Xt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Yt=[zt,Dt,Rt,Ot,Ft,Nt,Ut,Bt,Ht(jt),Vt,qt,Gt,Zt,Wt];function Kt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Kt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Yt)if(!Kt(t,e))return null}return`Expected ${Xt(t)} but found ${Xt(e)} instead.`}function Jt(t,e){return e.some((e=>e.kind===t.kind))}function Qt(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function te(t,e){return"array"===t.kind&&"array"===e.kind?t.itemType.kind===e.itemType.kind&&"number"==typeof t.N:t.kind===e.kind}const ee=.96422,ie=.82521,ne=4/29,re=6/29,oe=3*re*re,se=re*re*re,ae=Math.PI/180,le=180/Math.PI;function ce(t){return(t%=360)<0&&(t+=360),t}function ue([t,e,i,n]){let r,o;const s=pe((.2225045*(t=he(t))+.7168786*(e=he(e))+.0606169*(i=he(i)))/1);t===e&&e===i?r=o=s:(r=pe((.4360747*t+.3850649*e+.1430804*i)/ee),o=pe((.0139322*t+.0971045*e+.7141733*i)/ie));const a=116*s-16;return[a<0?0:a,500*(r-s),200*(s-o),n]}function he(t){return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function pe(t){return t>se?Math.pow(t,1/3):t/oe+ne}function de([t,e,i,n]){let r=(t+16)/116,o=isNaN(e)?r:r+e/500,s=isNaN(i)?r:r-i/200;return r=1*me(r),o=ee*me(o),s=ie*me(s),[fe(3.1338561*o-1.6168667*r-.4906146*s),fe(-.9787684*o+1.9161415*r+.033454*s),fe(.0719453*o-.2289914*r+1.4052427*s),n]}function fe(t){return(t=t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055)<0?0:t>1?1:t}function me(t){return t>re?t*t*t:oe*(t-ne)}const ge=Object.hasOwn||function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};function ye(t,e){return ge(t,e)?t[e]:void 0}function _e(t){return parseInt(t.padEnd(2,t),16)/255}function ve(t,e){return xe(e?t/100:t,0,1)}function xe(t,e,i){return Math.min(Math.max(e,t),i)}function be(t){return!t.some(Number.isNaN)}const we={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Te(t,e,i){return t+i*(e-t)}function Se(t,e,i){return t.map(((t,n)=>Te(t,e[n],i)))}class Ce{constructor(t,e,i,n=1,r=!0){this.r=t,this.g=e,this.b=i,this.a=n,r||(this.r*=n,this.g*=n,this.b*=n,n||this.overwriteGetter("rgb",[t,e,i,n]))}static parse(t){if(t instanceof Ce)return t;if("string"!=typeof t)return;const e=function(t){if("transparent"===(t=t.toLowerCase().trim()))return[0,0,0,0];const e=ye(we,t);if(e){const[t,i,n]=e;return[t/255,i/255,n/255,1]}if(t.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(t)){const e=t.length<6?1:2;let i=1;return[_e(t.slice(i,i+=e)),_e(t.slice(i,i+=e)),_e(t.slice(i,i+=e)),_e(t.slice(i,i+e)||"ff")]}if(t.startsWith("rgb")){const e=t.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(e){const[t,i,n,r,o,s,a,l,c,u,h,p]=e,d=[r||" ",a||" ",u].join("");if("  "===d||"  /"===d||",,"===d||",,,"===d){const t=[n,s,c].join(""),e="%%%"===t?100:""===t?255:0;if(e){const t=[xe(+i/e,0,1),xe(+o/e,0,1),xe(+l/e,0,1),h?ve(+h,p):1];if(be(t))return t}}return}}const i=t.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[t,e,n,r,o,s,a,l,c]=i,u=[n||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const t=[+e,xe(+r,0,100),xe(+s,0,100),l?ve(+l,c):1];if(be(t))return function([t,e,i,n]){function r(n){const r=(n+t/30)%12,o=e*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(r-3,9-r,1))}return t=ce(t),e/=100,i/=100,[r(0),r(8),r(4),n]}(t)}}}(t);return e?new Ce(...e,!1):void 0}get rgb(){const{r:t,g:e,b:i,a:n}=this,r=n||1/0;return this.overwriteGetter("rgb",[t/r,e/r,i/r,n])}get hcl(){return this.overwriteGetter("hcl",function(t){const[e,i,n,r]=ue(t),o=Math.sqrt(i*i+n*n);return[Math.round(1e4*o)?ce(Math.atan2(n,i)*le):NaN,o,e,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ue(this.rgb))}overwriteGetter(t,e){return Object.defineProperty(this,t,{value:e}),e}toString(){const[t,e,i,n]=this.rgb;return`rgba(${[t,e,i].map((t=>Math.round(255*t))).join(",")},${n})`}static interpolate(t,e,i,n="rgb"){switch(n){case"rgb":{const[n,r,o,s]=Se(t.rgb,e.rgb,i);return new Ce(n,r,o,s,!1)}case"hcl":{const[n,r,o,s]=t.hcl,[a,l,c,u]=e.hcl;let h,p;if(isNaN(n)||isNaN(a))isNaN(n)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(p=l)):(h=n,1!==c&&0!==c||(p=r));else{let t=a-n;a>n&&t>180?t-=360:a<n&&n-a>180&&(t+=360),h=n+i*t}const[d,f,m,g]=function([t,e,i,n]){return t=isNaN(t)?0:t*ae,de([i,Math.cos(t)*e,Math.sin(t)*e,n])}([h,null!=p?p:Te(r,l,i),Te(o,c,i),Te(s,u,i)]);return new Ce(d,f,m,g,!1)}case"lab":{const[n,r,o,s]=de(Se(t.lab,e.lab,i));return new Ce(n,r,o,s,!1)}}}}Ce.black=new Ce(0,0,0,1),Ce.white=new Ce(1,1,1,1),Ce.transparent=new Ce(0,0,0,0),Ce.red=new Ce(1,0,0,1);class Ee{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ie=["bottom","center","top"];class Me{constructor(t,e,i,n,r,o){this.text=t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r,this.verticalAlign=o}}class Ae{constructor(t){this.sections=t}static fromString(t){return new Ae([new Me(t,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Ae?t:Ae.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}}class ke{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ke)return t;if("number"==typeof t)return new ke([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const e of t)if("number"!=typeof e)return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ke(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,i){return new ke(Se(t.values,e.values,i))}}class Pe{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Pe)return t;if("number"==typeof t)return new Pe([t]);if(Array.isArray(t)){for(const e of t)if("number"!=typeof e)return;return new Pe(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,i){return new Pe(Se(t.values,e.values,i))}}class Le{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Le)return t;if("string"==typeof t){const e=Ce.parse(t);if(!e)return;return new Le([e])}if(!Array.isArray(t))return;const e=[];for(const i of t){if("string"!=typeof i)return;const t=Ce.parse(i);if(!t)return;e.push(t)}return new Le(e)}toString(){return JSON.stringify(this.values)}static interpolate(t,e,i,n="rgb"){const r=[];if(t.values.length!=e.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${e.values.length}), cannot interpolate.`);for(let o=0;o<t.values.length;o++)r.push(Ce.interpolate(t.values[o],e.values[o],i,n));return new Le(r)}}class ze extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const De=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Re{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Re)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];if("string"!=typeof i||!De.has(i))return;if(!Array.isArray(n)||2!==n.length||"number"!=typeof n[0]||"number"!=typeof n[1])return}return new Re(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,e,i){const n=t.values,r=e.values;if(n.length!==r.length)throw new ze(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${e.toString()}`);const o=[];for(let t=0;t<n.length;t+=2){if(n[t]!==r[t])throw new ze(`Cannot interpolate values containing mismatched anchors. from[${t}]: ${n[t]}, to[${t}]: ${r[t]}`);o.push(n[t]);const[e,s]=n[t+1],[a,l]=r[t+1];o.push([Te(e,a,i),Te(s,l,i)])}return new Re(o)}}class Oe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Oe({name:t,available:!1}):null}}class Fe{constructor(t,e,i){this.from=t,this.to=e,this.transition=i}static interpolate(t,e,i){return new Fe(t,e,i)}static parse(t){return t instanceof Fe?t:Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]?new Fe(t[0],t[1],t[2]):"object"==typeof t&&"string"==typeof t.from&&"string"==typeof t.to&&"number"==typeof t.transition?new Fe(t.from,t.to,t.transition):"string"==typeof t?new Fe(t,t,1):void 0}}function Ne(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Be(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Fe||t instanceof Ce||t instanceof Ee||t instanceof Ae||t instanceof ke||t instanceof Pe||t instanceof Le||t instanceof Re||t instanceof Oe)return!0;if(Array.isArray(t)){for(const e of t)if(!Be(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Be(t[e]))return!1;return!0}return!1}function je(t){if(null===t)return zt;if("string"==typeof t)return Rt;if("boolean"==typeof t)return Ot;if("number"==typeof t)return Dt;if(t instanceof Ce)return Ft;if(t instanceof Fe)return Nt;if(t instanceof Ee)return $t;if(t instanceof Ae)return Ut;if(t instanceof ke)return Vt;if(t instanceof Pe)return qt;if(t instanceof Le)return Gt;if(t instanceof Re)return Wt;if(t instanceof Oe)return Zt;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=je(e);if(i){if(i===t)continue;i=jt;break}i=t}return Ht(i||jt,e)}return Bt}function $e(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Ce||t instanceof Fe||t instanceof Ae||t instanceof ke||t instanceof Pe||t instanceof Le||t instanceof Re||t instanceof Oe?t.toString():JSON.stringify(t)}class Ue{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Be(t[1]))return e.error("invalid value");const i=t[1];let n=je(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Ue(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ve={string:Rt,number:Dt,boolean:Ot,object:Bt};class Ge{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in Ve)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=Ve[i],n++}else r=jt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=Ht(r,o)}else{if(!Ve[r])throw new Error(`Types doesn't contain name = ${r}`);i=Ve[r]}const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,jt);if(!i)return null;o.push(i)}return new Ge(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Kt(this.type,je(i)))return i;if(e===this.args.length-1)throw new ze(`Expected value to be of type ${Xt(this.type)}, but found ${Xt(je(i))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const qe={"to-boolean":Ot,"to-color":Ft,"to-number":Dt,"to-string":Rt};class Ze{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(!qe[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=qe[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,jt);if(!n)return null;r.push(n)}return new Ze(n,r)}evaluate(t){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(t));case"color":{let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Ce)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rgba value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Ne(e[0],e[1],e[2],e[3]),!i))return new Ce(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ze(i||`Could not parse color from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"padding":{let e;for(const i of this.args){e=i.evaluate(t);const n=ke.parse(e);if(n)return n}throw new ze(`Could not parse padding from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"numberArray":{let e;for(const i of this.args){e=i.evaluate(t);const n=Pe.parse(e);if(n)return n}throw new ze(`Could not parse numberArray from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"colorArray":{let e;for(const i of this.args){e=i.evaluate(t);const n=Le.parse(e);if(n)return n}throw new ze(`Could not parse colorArray from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(const i of this.args){e=i.evaluate(t);const n=Re.parse(e);if(n)return n}throw new ze(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof e?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new ze(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return Ae.fromString($e(this.args[0].evaluate(t)));case"resolvedImage":return Oe.fromString($e(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return $e(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const We=["Unknown","Point","LineString","Polygon"];class He{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?We[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let e=this._parseColorCache.get(t);return e||(e=Ce.parse(t),this._parseColorCache.set(t,e)),e}}class Xe{constructor(t,e,i=[],n,r=new Lt,o=[]){this.registry=t,this.path=i,this.key=i.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=o,this.expectedType=n,this._isConstant=e}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new Ge(e,[t]):"coerce"===i?new Ze(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind){if("projectionDefinition"===t.kind&&["string","array"].includes(r.kind)||["color","formatted","resolvedImage"].includes(t.kind)&&["value","string"].includes(r.kind)||["padding","numberArray"].includes(t.kind)&&["value","number","array"].includes(r.kind)||"colorArray"===t.kind&&["value","string","array"].includes(r.kind)||"variableAnchorOffsetCollection"===t.kind&&["value","array"].includes(r.kind))n=i(n,t,e.typeAnnotation||"coerce");else if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof Ue)&&"resolvedImage"!==n.type.kind&&this._isConstant(n)){const e=new He;try{n=new Ue(n.type,n.evaluate(e))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new Xe(this.registry,this._isConstant,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Pt(i,t))}checkSubtype(t,e){const i=Kt(t,e);return i&&this.error(i),i}}class Ye{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new Ye(i,n):null}outputDefined(){return this.result.outputDefined()}}class Ke{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Ke(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Je{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Dt),n=e.parse(t[2],2,Ht(e.expectedType||jt));return i&&n?new Je(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ze(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ze(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ze(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Qe{constructor(t,e){this.type=Ot,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,jt),n=e.parse(t[2],2,jt);return i&&n?Jt(i.type,[Ot,Rt,Dt,zt,jt])?new Qe(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xt(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!i)return!1;if(!Qt(e,["boolean","string","number","null"]))throw new ze(`Expected first argument to be of type boolean, string, number or null, but found ${Xt(je(e))} instead.`);if(!Qt(i,["string","array"]))throw new ze(`Expected second argument to be of type array or string, but found ${Xt(je(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ti{constructor(t,e,i){this.type=Dt,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,jt),n=e.parse(t[2],2,jt);if(!i||!n)return null;if(!Jt(i.type,[Ot,Rt,Dt,zt,jt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xt(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Dt);return r?new ti(i,n,r):null}return new ti(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Qt(e,["boolean","string","number","null"]))throw new ze(`Expected first argument to be of type boolean, string, number or null, but found ${Xt(je(e))} instead.`);let n;if(this.fromIndex&&(n=this.fromIndex.evaluate(t)),Qt(i,["string"])){const t=i.indexOf(e,n);return-1===t?-1:[...i.slice(0,t)].length}if(Qt(i,["array"]))return i.indexOf(e,n);throw new ze(`Expected second argument to be of type array or string, but found ${Xt(je(i))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ei{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,je(t)))return null}else i=je(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=e.parse(t[1],1,jt);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new ei(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(je(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ii{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,Ot);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);if(!r)return null;if(!i)throw new Error("Can't infer output type");return new ii(i,n,r)}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ni{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,jt),n=e.parse(t[2],2,Dt);if(!i||!n)return null;if(!Jt(i.type,[Ht(jt),Rt,jt]))return e.error(`Expected first argument to be of type array or string, but found ${Xt(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Dt);return r?new ni(i.type,i,n,r):null}return new ni(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);let n;if(this.endIndex&&(n=this.endIndex.evaluate(t)),Qt(e,["string"]))return[...e].slice(i,n).join("");if(Qt(e,["array"]))return e.slice(i,n);throw new ze(`Expected first argument to be of type array or string, but found ${Xt(je(e))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ri(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new ze("Input is not a number.");s=a-1}return 0}class oi{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Dt);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new oi(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;return n>=e[r-1]?i[r-1].evaluate(t):i[ri(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function si(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ai,li,ci=function(){if(li)return ai;function t(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}return li=1,ai=t,t.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var r=this.sampleCurveX(i)-t;if(Math.abs(r)<e)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=r/o}var s=0,a=1;for(i=t,n=0;n<20&&(r=this.sampleCurveX(i),!(Math.abs(r-t)<e));n++)t>r?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},ai}(),ui=si(ci);class hi{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=pi(e,t.base,i,n);else if("linear"===t.name)r=pi(e,1,i,n);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new ui(o[0],o[1],o[2],o[3]).solve(pi(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Dt),!r)return null;const s=[];let a=null;"interpolate-hcl"!==i&&"interpolate-lab"!==i||e.expectedType==Gt?e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType):a=Ft;for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return te(a,Dt)||te(a,Nt)||te(a,Ft)||te(a,Vt)||te(a,qt)||te(a,Gt)||te(a,Wt)||te(a,Ht(Dt))?new hi(a,i,n,r,s):e.error(`Type ${Xt(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=ri(e,n),s=hi.interpolationFactor(this.interpolation,n,e[o],e[o+1]),a=i[o].evaluate(t),l=i[o+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Te(a,l,s);case"color":return Ce.interpolate(a,l,s);case"padding":return ke.interpolate(a,l,s);case"colorArray":return Le.interpolate(a,l,s);case"numberArray":return Pe.interpolate(a,l,s);case"variableAnchorOffsetCollection":return Re.interpolate(a,l,s);case"array":return Se(a,l,s);case"projectionDefinition":return Fe.interpolate(a,l,s)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ce.interpolate(a,l,s,"hcl");case"colorArray":return Le.interpolate(a,l,s,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ce.interpolate(a,l,s,"lab");case"colorArray":return Le.interpolate(a,l,s,"lab")}}}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function pi(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}const di={color:Ce.interpolate,number:Te,padding:ke.interpolate,numberArray:Pe.interpolate,colorArray:Le.interpolate,variableAnchorOffsetCollection:Re.interpolate,array:Se};class fi{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}if(!i)throw new Error("No output type");const o=n&&r.some((t=>Kt(n,t.type)));return new fi(o?jt:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args)if(n++,i=r.evaluate(t),i&&i instanceof Oe&&!i.available&&(e||(e=i.name),i=null,n===this.args.length&&(i=e)),null!==i)break;return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function mi(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gi(t,e,i,n){return 0===n.compare(e,i)}function yi(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=Ot,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,jt);if(!o)return null;if(!mi(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Xt(o.type)}'.`);let s=e.parse(t[2],2,jt);if(!s)return null;if(!mi(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Xt(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Xt(o.type)}' and '${Xt(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Ge(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Ge(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,$t),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=je(o),i=je(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ze(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=je(o),i=je(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}}}const _i=yi("==",(function(t,e,i){return e===i}),gi),vi=yi("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!gi(0,e,i,n)})),xi=yi("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),bi=yi(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),wi=yi("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),Ti=yi(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class Si{constructor(t,e,i){this.type=$t,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Ot);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Ot);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,Rt),!o)?null:new Si(n,r,o)}evaluate(t){return new Ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Ci{constructor(t,e,i,n,r){this.type=Rt,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Dt);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,Rt),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,Rt),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,Dt),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Dt),!a)?null:new Ci(i,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ei{constructor(t){this.type=Ut,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,Dt),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,Ht(Rt)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,Ft),!s))return null;let a=null;if(o["vertical-align"]){if("string"==typeof o["vertical-align"]&&!Ie.includes(o["vertical-align"]))return e.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${o["vertical-align"]}' instead.`);if(a=e.parse(o["vertical-align"],1,Rt),!a)return null}const l=n[n.length-1];l.scale=t,l.font=i,l.textColor=s,l.verticalAlign=a}else{const o=e.parse(t[i],1,jt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ei(n)}evaluate(t){return new Ae(this.sections.map((e=>{const i=e.content.evaluate(t);return je(i)===Zt?new Me("",i,null,null,null,e.verticalAlign?e.verticalAlign.evaluate(t):null):new Me($e(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null,e.verticalAlign?e.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor),e.verticalAlign&&t(e.verticalAlign)}outputDefined(){return!1}}class Ii{constructor(t){this.type=Zt,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Rt);return i?new Ii(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=Oe.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}}class Mi{constructor(t){this.type=Dt,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Xt(i.type)} instead.`):new Mi(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return[...e].length;if(Array.isArray(e))return e.length;throw new ze(`Expected value to be of type string or array, but found ${Xt(je(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ai=8192;function ki(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(i*r*Ai),Math.round(n*r*Ai)]}function Pi(t,e){const i=Math.pow(2,e.z);return[(r=(t[0]/Ai+e.x)/i,360*r-180),(n=(t[1]/Ai+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,r}function Li(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function zi(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Di(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function Ri(t,e,i,n){return 0!=(r=[n[0]-i[0],n[1]-i[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*o[0]&&!(!$i(t,e,i,n)||!$i(i,n,t,e));var r,o}function Oi(t,e,i){for(const n of i)for(let i=0;i<n.length-1;++i)if(Ri(t,e,n[i],n[i+1]))return!0;return!1}function Fi(t,e,i=!1){let n=!1;for(const a of e)for(let e=0;e<a.length-1;e++){if(Di(t,a[e],a[e+1]))return i;(o=a[e])[1]>(r=t)[1]!=(s=a[e+1])[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(n=!n)}var r,o,s;return n}function Ni(t,e){for(const i of e)if(Fi(t,i))return!0;return!1}function Bi(t,e){for(const i of t)if(!Fi(i,e))return!1;for(let i=0;i<t.length-1;++i)if(Oi(t[i],t[i+1],e))return!1;return!0}function ji(t,e){for(const i of e)if(Bi(t,i))return!0;return!1}function $i(t,e,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(t[0]-i[0])*o-r*(t[1]-i[1]),a=(e[0]-i[0])*o-r*(e[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ui(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=ki(t[r][n],i);Li(e,s),o.push(s)}n.push(o)}return n}function Vi(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=Ui(t[r],e,i);n.push(o)}return n}function Gi(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}Li(e,t)}function qi(t,e,i,n){const r=Math.pow(2,n.z)*Ai,o=[n.x*Ai,n.y*Ai],s=[];for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];Gi(n,e,i,r),s.push(n)}return s}function Zi(t,e,i,n){const r=Math.pow(2,n.z)*Ai,o=[n.x*Ai,n.y*Ai],s=[];for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];Li(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const n of t)Gi(n,e,i,r)}var a;return s}class Wi{constructor(t,e){this.type=Ot,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Be(t[1])){const e=t[1];if("FeatureCollection"===e.type){const t=[];for(const i of e.features){const{type:e,coordinates:n}=i.geometry;"Polygon"===e&&t.push(n),"MultiPolygon"===e&&t.push(...n)}if(t.length)return new Wi(e,{type:"MultiPolygon",coordinates:t})}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Wi(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Wi(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=Ui(e.coordinates,n,r),s=qi(t.geometry(),i,n,r);if(!zi(i,n))return!1;for(const t of s)if(!Fi(t,o))return!1}if("MultiPolygon"===e.type){const o=Vi(e.coordinates,n,r),s=qi(t.geometry(),i,n,r);if(!zi(i,n))return!1;for(const t of s)if(!Ni(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if("Polygon"===e.type){const o=Ui(e.coordinates,n,r),s=Zi(t.geometry(),i,n,r);if(!zi(i,n))return!1;for(const t of s)if(!Bi(t,o))return!1}if("MultiPolygon"===e.type){const o=Vi(e.coordinates,n,r),s=Zi(t.geometry(),i,n,r);if(!zi(i,n))return!1;for(const t of s)if(!ji(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hi=class{constructor(t,e){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1);const o=n+1;if(o<this.length&&i(e[o],e[n])<0&&(n=o),i(e[n],r)>=0)break;e[t]=e[n],t=n}e[t]=r}};function Xi(t,e,i=0,n=t.length-1,r=Ki){for(;n>i;){if(n-i>600){const o=n-i+1,s=e-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Xi(t,e,Math.max(i,Math.floor(e-s*l/o+c)),Math.min(n,Math.floor(e+(o-s)*l/o+c)),r)}const o=t[e];let s=i,a=n;for(Yi(t,i,e),r(t[n],o)>0&&Yi(t,i,n);s<a;){for(Yi(t,s,a),s++,a--;r(t[s],o)<0;)s++;for(;r(t[a],o)>0;)a--}0===r(t[i],o)?Yi(t,i,a):(a++,Yi(t,a,n)),a<=e&&(i=a+1),e<=a&&(n=a-1)}}function Yi(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Ki(t,e){return t<e?-1:t>e?1:0}function Ji(t,e){if(t.length<=1)return[t];const i=[];let n,r;for(const e of t){const t=tn(e);0!==t&&(e.area=Math.abs(t),void 0===r&&(r=t<0),r===t<0?(n&&i.push(n),n=[e]):n.push(e))}if(n&&i.push(n),e>1)for(let t=0;t<i.length;t++)i[t].length<=e||(Xi(i[t],e,1,i[t].length-1,Qi),i[t]=i[t].slice(0,e));return i}function Qi(t,e){return e.area-t.area}function tn(t){let e=0;for(let i,n,r=0,o=t.length,s=o-1;r<o;s=r++)i=t[r],n=t[s],e+=(n.x-i.x)*(i.y+n.y);return e}const en=1/298.257223563,nn=en*(2-en),rn=Math.PI/180;class on{constructor(t){const e=6378.137*rn*1e3,i=Math.cos(t*rn),n=1/(1-nn*(1-i*i)),r=Math.sqrt(n);this.kx=e*r*i,this.ky=e*r*n*(1-nn)}distance(t,e){const i=this.wrap(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)}pointOnLine(t,e){let i,n,r,o,s=1/0;for(let a=0;a<t.length-1;a++){let l=t[a][0],c=t[a][1],u=this.wrap(t[a+1][0]-l)*this.kx,h=(t[a+1][1]-c)*this.ky,p=0;0===u&&0===h||(p=(this.wrap(e[0]-l)*this.kx*u+(e[1]-c)*this.ky*h)/(u*u+h*h),p>1?(l=t[a+1][0],c=t[a+1][1]):p>0&&(l+=u/this.kx*p,c+=h/this.ky*p)),u=this.wrap(e[0]-l)*this.kx,h=(e[1]-c)*this.ky;const d=u*u+h*h;d<s&&(s=d,i=l,n=c,r=a,o=p)}return{point:[i,n],index:r,t:Math.max(0,Math.min(1,o))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function sn(t,e){return e[0]-t[0]}function an(t){return t[1]-t[0]+1}function ln(t,e){return t[1]>=t[0]&&t[1]<e}function cn(t,e){if(t[0]>t[1])return[null,null];const i=an(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}if(1===i)return[t,null];const n=Math.floor(i/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}function un(t,e){if(!ln(e,t.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)Li(i,t[n]);return i}function hn(t){const e=[1/0,1/0,-1/0,-1/0];for(const i of t)for(const t of i)Li(e,t);return e}function pn(t){return t[0]!==-1/0&&t[1]!==-1/0&&t[2]!==1/0&&t[3]!==1/0}function dn(t,e,i){if(!pn(t)||!pn(e))return NaN;let n=0,r=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),i.distance([0,0],[n,r])}function fn(t,e,i){const n=i.pointOnLine(e,t);return i.distance(t,n.point)}function mn(t,e,i,n,r){const o=Math.min(fn(t,[i,n],r),fn(e,[i,n],r)),s=Math.min(fn(i,[t,e],r),fn(n,[t,e],r));return Math.min(o,s)}function gn(t,e,i,n,r){if(!ln(e,t.length)||!ln(n,i.length))return 1/0;let o=1/0;for(let s=e[0];s<e[1];++s){const e=t[s],a=t[s+1];for(let t=n[0];t<n[1];++t){const n=i[t],s=i[t+1];if(Ri(e,a,n,s))return 0;o=Math.min(o,mn(e,a,n,s,r))}}return o}function yn(t,e,i,n,r){if(!ln(e,t.length)||!ln(n,i.length))return NaN;let o=1/0;for(let s=e[0];s<=e[1];++s)for(let e=n[0];e<=n[1];++e)if(o=Math.min(o,r.distance(t[s],i[e])),0===o)return o;return o}function _n(t,e,i){if(Fi(t,e,!0))return 0;let n=1/0;for(const r of e){const e=r[0],o=r[r.length-1];if(e!==o&&(n=Math.min(n,fn(t,[o,e],i)),0===n))return n;const s=i.pointOnLine(r,t);if(n=Math.min(n,i.distance(t,s.point)),0===n)return n}return n}function vn(t,e,i,n){if(!ln(e,t.length))return NaN;for(let n=e[0];n<=e[1];++n)if(Fi(t[n],i,!0))return 0;let r=1/0;for(let o=e[0];o<e[1];++o){const e=t[o],s=t[o+1];for(const t of i)for(let i=0,o=t.length,a=o-1;i<o;a=i++){const o=t[a],l=t[i];if(Ri(e,s,o,l))return 0;r=Math.min(r,mn(e,s,o,l,n))}}return r}function xn(t,e){for(const i of t)for(const t of i)if(Fi(t,e,!0))return!0;return!1}function bn(t,e,i,n=1/0){const r=hn(t),o=hn(e);if(n!==1/0&&dn(r,o,i)>=n)return n;if(zi(r,o)){if(xn(t,e))return 0}else if(xn(e,t))return 0;let s=1/0;for(const n of t)for(let t=0,r=n.length,o=r-1;t<r;o=t++){const r=n[o],a=n[t];for(const t of e)for(let e=0,n=t.length,o=n-1;e<n;o=e++){const n=t[o],l=t[e];if(Ri(r,a,n,l))return 0;s=Math.min(s,mn(r,a,n,l,i))}}return s}function wn(t,e,i,n,r,o){if(!o)return;const s=dn(un(n,o),r,i);s<e&&t.push([s,o,[0,0]])}function Tn(t,e,i,n,r,o,s){if(!o||!s)return;const a=dn(un(n,o),un(r,s),i);a<e&&t.push([a,o,s])}function Sn(t,e,i,n,r=1/0){let o=Math.min(n.distance(t[0],i[0][0]),r);if(0===o)return o;const s=new Hi([[0,[0,t.length-1],[0,0]]],sn),a=hn(i);for(;s.length>0;){const r=s.pop();if(r[0]>=o)continue;const l=r[1],c=e?50:100;if(an(l)<=c){if(!ln(l,t.length))return NaN;if(e){const e=vn(t,l,i,n);if(isNaN(e)||0===e)return e;o=Math.min(o,e)}else for(let e=l[0];e<=l[1];++e){const r=_n(t[e],i,n);if(o=Math.min(o,r),0===o)return 0}}else{const i=cn(l,e);wn(s,o,n,t,a,i[0]),wn(s,o,n,t,a,i[1])}}return o}function Cn(t,e,i,n,r,o=1/0){let s=Math.min(o,r.distance(t[0],i[0]));if(0===s)return s;const a=new Hi([[0,[0,t.length-1],[0,i.length-1]]],sn);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=e?50:100,h=n?50:100;if(an(l)<=u&&an(c)<=h){if(!ln(l,t.length)&&ln(c,i.length))return NaN;let o;if(e&&n)o=gn(t,l,i,c,r),s=Math.min(s,o);else if(e&&!n){const e=t.slice(l[0],l[1]+1);for(let t=c[0];t<=c[1];++t)if(o=fn(i[t],e,r),s=Math.min(s,o),0===s)return s}else if(!e&&n){const e=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=fn(t[i],e,r),s=Math.min(s,o),0===s)return s}else o=yn(t,l,i,c,r),s=Math.min(s,o)}else{const o=cn(l,e),u=cn(c,n);Tn(a,s,r,t,i,o[0],u[0]),Tn(a,s,r,t,i,o[0],u[1]),Tn(a,s,r,t,i,o[1],u[0]),Tn(a,s,r,t,i,o[1],u[1])}}return s}function En(t){return"MultiPolygon"===t.type?t.coordinates.map((t=>({type:"Polygon",coordinates:t}))):"MultiLineString"===t.type?t.coordinates.map((t=>({type:"LineString",coordinates:t}))):"MultiPoint"===t.type?t.coordinates.map((t=>({type:"Point",coordinates:t}))):[t]}class In{constructor(t,e){this.type=Dt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Be(t[1])){const e=t[1];if("FeatureCollection"===e.type)return new In(e,e.features.map((t=>En(t.geometry))).flat());if("Feature"===e.type)return new In(e,En(e.geometry));if("type"in e&&"coordinates"in e)return new In(e,En(e))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=t.geometry(),n=i.flat().map((e=>Pi([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const r=new on(n[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Cn(n,!1,[t.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Cn(n,!1,t.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,Sn(n,!1,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=t.geometry(),n=i.flat().map((e=>Pi([e.x,e.y],t.canonical)));if(0===i.length)return NaN;const r=new on(n[0][1]);let o=1/0;for(const t of e){switch(t.type){case"Point":o=Math.min(o,Cn(n,!0,[t.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Cn(n,!0,t.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,Sn(n,!0,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries);if("Polygon"===t.geometryType())return function(t,e){const i=t.geometry();if(0===i.length||0===i[0].length)return NaN;const n=Ji(i,0).map((e=>e.map((e=>e.map((e=>Pi([e.x,e.y],t.canonical))))))),r=new on(n[0][0][0][1]);let o=1/0;for(const t of e)for(const e of n){switch(t.type){case"Point":o=Math.min(o,Sn([t.coordinates],!1,e,r,o));break;case"LineString":o=Math.min(o,Sn(t.coordinates,!0,e,r,o));break;case"Polygon":o=Math.min(o,bn(e,t.coordinates,r,o))}if(0===o)return o}return o}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Mn{constructor(t){this.type=jt,this.key=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=t[1];return null==i?e.error("Global state property must be defined."):"string"!=typeof i?e.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Mn(i)}evaluate(t){var e;const i=null===(e=t.globals)||void 0===e?void 0:e.globalState;return i&&0!==Object.keys(i).length?ye(i,this.key):null}eachChild(){}outputDefined(){return!1}}const An={"==":_i,"!=":vi,">":bi,"<":xi,">=":Ti,"<=":wi,array:Ge,at:Je,boolean:Ge,case:ii,coalesce:fi,collator:Si,format:Ei,image:Ii,in:Qe,"index-of":ti,interpolate:hi,"interpolate-hcl":hi,"interpolate-lab":hi,length:Mi,let:Ye,literal:Ue,match:ei,number:Ge,"number-format":Ci,object:Ge,slice:ni,step:oi,string:Ge,"to-boolean":Ze,"to-color":Ze,"to-number":Ze,"to-string":Ze,var:Ke,within:Wi,distance:In,"global-state":Mn};class kn{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,e){const i=t[0],n=kn.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[n,o]of s){a=new Xe(e.registry,Rn,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new kn(i,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Xt).join(", ")})`:`(${Xt(e.type)}...)`;var e})).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(Xt(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){kn.definitions=e;for(const i in e)t[i]=kn}}function Pn(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=Ne(e,i,n,o);if(s)throw new ze(s);return new Ce(e/255,i/255,n/255,o,!1)}function Ln(t,e){return t in e}function zn(t,e){const i=e[t];return void 0===i?null:i}function Dn(t){return{type:t}}function Rn(t){if(t instanceof Ke)return Rn(t.boundExpression);if(t instanceof kn&&"error"===t.name)return!1;if(t instanceof Si)return!1;if(t instanceof Wi)return!1;if(t instanceof In)return!1;if(t instanceof Mn)return!1;const e=t instanceof Ze||t instanceof Ge;let i=!0;return t.eachChild((t=>{i=e?i&&Rn(t):i&&t instanceof Ue})),!!i&&On(t)&&Nn(t,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function On(t){if(t instanceof kn){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Wi)return!1;if(t instanceof In)return!1;let e=!0;return t.eachChild((t=>{e&&!On(t)&&(e=!1)})),e}function Fn(t){if(t instanceof kn&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Fn(t)&&(e=!1)})),e}function Nn(t,e){if(t instanceof kn&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Nn(t,e)&&(i=!1)})),i}function Bn(t){return{result:"success",value:t}}function jn(t){return{result:"error",value:t}}function $n(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Un(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Vn(t){return!!t.expression&&t.expression.interpolated}function Gn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function qn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)&&je(t)===Bt}function Zn(t){return t}function Wn(t,e){const i=t.stops&&"object"==typeof t.stops[0][0],n=i||!(i||void 0!==t.property),r=t.type||(Vn(e)?"exponential":"interval"),o=function(t){switch(t.type){case"color":return Ce.parse;case"padding":return ke.parse;case"numberArray":return Pe.parse;case"colorArray":return Le.parse;default:return null}}(e);if(o&&((t=kt({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],o(t[1])]))),t.default=o(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==(s=t.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${t.colorSpace}"`);var s;const a=function(t){switch(t){case"exponential":return Kn;case"interval":return Yn;case"categorical":return Xn;case"identity":return Jn;default:throw new Error(`Unknown function type "${t}"`)}}(r);let l,c;if("categorical"===r){l=Object.create(null);for(const e of t.stops)l[e[0]]=e[1];c=typeof t.stops[0][0]}if(i){const i={},n=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of n)r.push([i[t].zoom,Wn(i[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:hi.interpolationFactor.bind(void 0,o),zoomStops:r.map((t=>t[0])),evaluate:({zoom:i},n)=>Kn({stops:r,base:t.base},e,i).evaluate(i,n)}}if(n){const i="exponential"===r?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:hi.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>a(t,e,i,l,c)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[t.property]:void 0;return void 0===r?Hn(t.default,e.default):a(t,e,r,l,c)}}}function Hn(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Xn(t,e,i,n,r){return Hn(typeof i===r?n[i]:void 0,t.default,e.default)}function Yn(t,e,i){if("number"!==Gn(i))return Hn(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const r=ri(t.stops.map((t=>t[0])),i);return t.stops[r][1]}function Kn(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==Gn(i))return Hn(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=ri(t.stops.map((t=>t[0])),i),s=function(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(i,n,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],l=t.stops[o+1][1],c=di[e.type]||Zn;return"function"==typeof a.evaluate?{evaluate(...e){const i=a.evaluate.apply(void 0,e),n=l.evaluate.apply(void 0,e);if(void 0!==i&&void 0!==n)return c(i,n,s,t.colorSpace)}}:c(a,l,s,t.colorSpace)}function Jn(t,e,i){switch(e.type){case"color":i=Ce.parse(i);break;case"formatted":i=Ae.fromString(i.toString());break;case"resolvedImage":i=Oe.fromString(i.toString());break;case"padding":i=ke.parse(i);break;case"colorArray":i=Le.parse(i);break;case"numberArray":i=Pe.parse(i);break;default:Gn(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0)}return Hn(i,t.default,e.default)}kn.register(An,{error:[{kind:"error"},[Rt],(t,[e])=>{throw new ze(e.evaluate(t))}],typeof:[Rt,[jt],(t,[e])=>Xt(je(e.evaluate(t)))],"to-rgba":[Ht(Dt,4),[Ft],(t,[e])=>{const[i,n,r,o]=e.evaluate(t).rgb;return[255*i,255*n,255*r,o]}],rgb:[Ft,[Dt,Dt,Dt],Pn],rgba:[Ft,[Dt,Dt,Dt,Dt],Pn],has:{type:Ot,overloads:[[[Rt],(t,[e])=>Ln(e.evaluate(t),t.properties())],[[Rt,Bt],(t,[e,i])=>Ln(e.evaluate(t),i.evaluate(t))]]},get:{type:jt,overloads:[[[Rt],(t,[e])=>zn(e.evaluate(t),t.properties())],[[Rt,Bt],(t,[e,i])=>zn(e.evaluate(t),i.evaluate(t))]]},"feature-state":[jt,[Rt],(t,[e])=>zn(e.evaluate(t),t.featureState||{})],properties:[Bt,[],t=>t.properties()],"geometry-type":[Rt,[],t=>t.geometryType()],id:[jt,[],t=>t.id()],zoom:[Dt,[],t=>t.globals.zoom],"heatmap-density":[Dt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Dt,[],t=>t.globals.lineProgress||0],accumulated:[jt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Dt,Dn(Dt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Dt,Dn(Dt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Dt,overloads:[[[Dt,Dt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Dt],(t,[e])=>-e.evaluate(t)]]},"/":[Dt,[Dt,Dt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Dt,[Dt,Dt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Dt,[],()=>Math.LN2],pi:[Dt,[],()=>Math.PI],e:[Dt,[],()=>Math.E],"^":[Dt,[Dt,Dt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Dt,[Dt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Dt,[Dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Dt,[Dt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Dt,[Dt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Dt,[Dt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Dt,[Dt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Dt,[Dt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Dt,[Dt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Dt,[Dt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Dt,[Dt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Dt,Dn(Dt),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Dt,Dn(Dt),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Dt,[Dt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Dt,[Dt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Dt,[Dt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Dt,[Dt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ot,[Rt,jt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Ot,[jt],(t,[e])=>t.id()===e.value],"filter-type-==":[Ot,[Rt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ot,[Rt,jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[Ot,[jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[Ot,[Rt,jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[Ot,[jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[Ot,[Rt,jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[Ot,[jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[Ot,[Rt,jt],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[Ot,[jt],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[Ot,[jt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ot,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ot,[Ht(Rt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ot,[Ht(jt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ot,[Rt,Ht(jt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ot,[Rt,Ht(jt)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Dn(Ot),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Dn(Ot),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Ot,[Ot],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ot,[Rt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Rt,[Rt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Rt,[Rt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Rt,Dn(jt),(t,e)=>e.map((e=>$e(e.evaluate(t)))).join("")],"resolved-locale":[Rt,[$t],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Qn{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new He,this._defaultValue=e?function(t){if("color"===t.type&&qn(t.default))return new Ce(0,0,0,0);switch(t.type){case"color":return Ce.parse(t.default)||null;case"padding":return ke.parse(t.default)||null;case"numberArray":return Pe.parse(t.default)||null;case"colorArray":return Le.parse(t.default)||null;case"variableAnchorOffsetCollection":return Re.parse(t.default)||null;case"projectionDefinition":return Fe.parse(t.default)||null;default:return void 0===t.default?null:t.default}}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ze(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function tr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in An}function er(t,e){const i=new Xe(An,Rn,[],e?function(t){const e={color:Ft,string:Rt,number:Dt,enum:Rt,boolean:Ot,formatted:Ut,padding:Vt,numberArray:qt,colorArray:Gt,projectionDefinition:Nt,resolvedImage:Zt,variableAnchorOffsetCollection:Wt};return"array"===t.type?Ht(e[t.value]||jt,t.length):e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Bn(new Qn(n,e)):jn(i.errors)}class ir{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Fn(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}}class nr{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Fn(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?hi.interpolationFactor(this.interpolationType,t,e,i):0}}function rr(t,e){const i=er(t,e);if("error"===i.result)return i;const n=i.value.expression,r=On(n);if(!r&&!$n(e))return jn([new Pt("","data expressions not supported")]);const o=Nn(n,["zoom"]);if(!o&&!Un(e))return jn([new Pt("","zoom expressions not supported")]);const s=sr(n);return s||o?s instanceof Pt?jn([s]):s instanceof hi&&!Vn(e)?jn([new Pt("",'"interpolate" expressions cannot be used with this property')]):Bn(s?new nr(r?"camera":"composite",i.value,s.labels,s instanceof hi?s.interpolation:void 0):new ir(r?"constant":"source",i.value)):jn([new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class or{constructor(t,e){this._parameters=t,this._specification=e,kt(this,Wn(this._parameters,this._specification))}static deserialize(t){return new or(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function sr(t){let e=null;if(t instanceof Ye)e=sr(t.result);else if(t instanceof fi){for(const i of t.args)if(e=sr(i),e)break}else(t instanceof oi||t instanceof hi)&&t.input instanceof kn&&"zoom"===t.input.name&&(e=t);return e instanceof Pt||t.eachChild((t=>{const i=sr(t);i instanceof Pt?e=i:!e&&i?e=new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Pt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function ar(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ar(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const lr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function cr(t){if(null==t)return{filter:()=>!0,needGeometry:!1};ar(t)||(t=pr(t));const e=er(t,lr);if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,i,n)=>e.value.evaluate(t,i,{},n),needGeometry:hr(t)}}function ur(t,e){return t<e?-1:t>e?1:0}function hr(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(hr(t[e]))return!0;return!1}function pr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?dr(t[1],t[2],"=="):"!="===e?gr(dr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?dr(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(pr))):"all"===e?["all"].concat(t.slice(1).map(pr)):"none"===e?["all"].concat(t.slice(1).map(pr).map(gr)):"in"===e?fr(t[1],t.slice(2)):"!in"===e?gr(fr(t[1],t.slice(2))):"has"===e?mr(t[1]):"!has"!==e||gr(mr(t[1]));var i}function dr(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function fr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(ur)]]:["filter-in-small",t,["literal",e]]}}function mr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function gr(t){return["!",t]}function yr(t){const e=typeof t;if("number"===e||"boolean"===e||"string"===e||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const i of t)e+=`${yr(i)},`;return`${e}]`}const i=Object.keys(t).sort();let n="{";for(let e=0;e<i.length;e++)n+=`${JSON.stringify(i[e])}:${yr(t[i[e]])},`;return`${n}}`}function _r(t){let e="";for(const i of _t)e+=`/${yr(t[i])}`;return e}function vr(t){const e=t.value;return e?[new At(t.key,e,"constants have been deprecated as of v8")]:[]}function xr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function br(t){if(Array.isArray(t))return t.map(br);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=br(t[i]);return e}return xr(t)}function wr(t){const e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,s=t.styleSpec,a=t.validateSpec;let l=[];const c=Gn(i);if("object"!==c)return[new At(e,i,`object expected, ${c} found`)];for(const t in i){const c=t.split(".")[0],u=ye(n,c)||n["*"];let h;if(ye(r,c))h=r[c];else if(ye(n,c))h=a;else if(r["*"])h=r["*"];else{if(!n["*"]){l.push(new At(e,i[t],`unknown property "${t}"`));continue}h=a}l=l.concat(h({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:t,validateSpec:a},i))}for(const t in n)r[t]||n[t].required&&void 0===n[t].default&&void 0===i[t]&&l.push(new At(e,i,`missing required property "${t}"`));return l}function Tr(t){const e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,o=t.key,s=t.arrayElementValidator||t.validateSpec;if("array"!==Gn(e))return[new At(o,e,`array expected, ${Gn(e)} found`)];if(i.length&&e.length!==i.length)return[new At(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new At(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values};r.$version<7&&(a.function=i.function),"object"===Gn(i.value)&&(a=i.value);let l=[];for(let i=0;i<e.length;i++)l=l.concat(s({array:e,arrayIndex:i,value:e[i],valueSpec:a,validateSpec:t.validateSpec,style:n,styleSpec:r,key:`${o}[${i}]`}));return l}function Sr(t){const e=t.key,i=t.value,n=t.valueSpec;let r=Gn(i);return"number"===r&&i!=i&&(r="NaN"),"number"!==r?[new At(e,i,`number expected, ${r} found`)]:"minimum"in n&&i<n.minimum?[new At(e,i,`${i} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&i>n.maximum?[new At(e,i,`${i} is greater than the maximum value ${n.maximum}`)]:[]}function Cr(t){const e=t.valueSpec,i=xr(t.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===Gn(t.value.stops)&&"array"===Gn(t.value.stops[0])&&"object"===Gn(t.value.stops[0][0]),u=wr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new At(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;return e=e.concat(Tr({key:t.key,value:n,valueSpec:t.valueSpec,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Gn(n)&&0===n.length&&e.push(new At(t.key,n,"array must have at least one stop")),e},default:function(t){return t.validateSpec({key:t.key,value:t.value,valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new At(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new At(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Vn(t.valueSpec)&&u.push(new At(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!$n(t.valueSpec)?u.push(new At(t.key,t.value,"property functions not supported")):a&&!Un(t.valueSpec)&&u.push(new At(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new At(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const n=t.value,a=t.key;if("array"!==Gn(n))return[new At(a,n,`array expected, ${Gn(n)} found`)];if(2!==n.length)return[new At(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Gn(n[0]))return[new At(a,n,`object expected, ${Gn(n[0])} found`)];if(void 0===n[0].zoom)return[new At(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new At(a,n,"object stop key must have value")];if(o&&o>xr(n[0].zoom))return[new At(a,n[0].zoom,"stop zoom values must appear in ascending order")];xr(n[0].zoom)!==o&&(o=xr(n[0].zoom),r=void 0,s={}),i=i.concat(wr({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Sr,value:p}}))}else i=i.concat(p({key:`${a}[0]`,value:n[0],validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec},n));return tr(br(n[1]))?i.concat([new At(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(t.validateSpec({key:`${a}[1]`,value:n[1],valueSpec:e,validateSpec:t.validateSpec,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const a=Gn(t.value),l=xr(t.value),c=null!==t.value?t.value:o;if(n){if(a!==n)return[new At(t.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new At(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return $n(e)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new At(t.key,c,n)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==r&&l<r?[new At(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new At(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new At(t.key,c,`integer expected, found ${l}`)]}}function Er(t){const e=("property"===t.expressionContext?rr:er)(br(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new At(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new At(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Fn(i))return[new At(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Fn(i))return[new At(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Nn(i,["zoom","feature-state"]))return[new At(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!On(i))return[new At(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ir(t){const e=t.key,i=t.value,n=Gn(i);return"string"!==n?[new At(e,i,`color expected, ${n} found`)]:Ce.parse(String(i))?[]:[new At(e,i,`color expected, "${i}" found`)]}function Mr(t){const e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(xr(i))&&r.push(new At(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(xr(i))&&r.push(new At(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Ar(t){return ar(br(t.value))?Er(kt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):kr(t)}function kr(t){const e=t.value,i=t.key;if("array"!==Gn(e))return[new At(i,e,`array expected, ${Gn(e)} found`)];const n=t.styleSpec;let r,o=[];if(e.length<1)return[new At(i,e,"filter array must have at least 1 element")];switch(o=o.concat(Mr({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),xr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===xr(e[1])&&o.push(new At(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new At(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=Gn(e[1]),"string"!==r&&o.push(new At(`${i}[1]`,e[1],`string expected, ${r} found`)));for(let s=2;s<e.length;s++)r=Gn(e[s]),"$type"===xr(e[1])?o=o.concat(Mr({key:`${i}[${s}]`,value:e[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new At(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)o=o.concat(kr({key:`${i}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=Gn(e[1]),2!==e.length?o.push(new At(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new At(`${i}[1]`,e[1],`string expected, ${r} found`))}return o}function Pr(t,e){const i=t.key,n=t.validateSpec,r=t.style,o=t.styleSpec,s=t.value,a=t.objectKey,l=o[`${e}_${t.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===e&&c&&l[c[1]]&&l[c[1]].transition)return n({key:i,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=t.valueSpec||l[a];if(!u)return[new At(i,s,`unknown property "${a}"`)];let h;if("string"===Gn(s)&&$n(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new At(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const p=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&p.push(new At(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&qn(br(s))&&"identity"===xr(s.type)&&p.push(new At(i,s,'"text-font" does not support identity functions'))),p.concat(n({key:t.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:a}))}function Lr(t){return Pr(t,"paint")}function zr(t){return Pr(t,"layout")}function Dr(t){let e=[];const i=t.value,n=t.key,r=t.style,o=t.styleSpec;if("object"!==Gn(i))return[new At(n,i,`object expected, ${Gn(i)} found`)];i.type||i.ref||e.push(new At(n,i,'either "type" or "ref" is required'));let s=xr(i.type);const a=xr(i.ref);if(i.id){const o=xr(i.id);for(let s=0;s<t.arrayIndex;s++){const t=r.layers[s];xr(t.id)===o&&e.push(new At(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new At(n,i[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{xr(e.id)===a&&(t=e)})),t?t.ref?e.push(new At(n,i.ref,"ref cannot reference another ref layer")):s=xr(t.type):e.push(new At(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const t=r.sources&&r.sources[i.source],o=t&&xr(t.type);t?"vector"===o&&"raster"===s?e.push(new At(n,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?e.push(new At(n,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?e.push(new At(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new At(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new At(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new At(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new At(n,i.source,`source "${i.source}" not found`))}else e.push(new At(n,i,'missing required property "source"'));return e=e.concat(wr({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":()=>[],type:()=>t.validateSpec({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,object:i,objectKey:"type"}),filter:Ar,layout:t=>wr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>zr(kt({layerType:s},t))}}),paint:t=>wr({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,validateSpec:t.validateSpec,objectElementValidators:{"*":t=>Lr(kt({layerType:s},t))}})}})),e}function Rr(t){const e=t.value,i=t.key,n=Gn(e);return"string"!==n?[new At(i,e,`string expected, ${n} found`)]:[]}const Or={promoteId:function({key:t,value:e}){if("string"===Gn(e))return Rr({key:t,value:e});{const i=[];for(const n in e)i.push(...Rr({key:`${t}.${n}`,value:e[n]}));return i}}};function Fr(t){const e=t.value,i=t.key,n=t.styleSpec,r=t.style,o=t.validateSpec;if(!e.type)return[new At(i,e,'"type" is required')];const s=xr(e.type);let a;switch(s){case"vector":case"raster":return a=wr({key:i,value:e,valueSpec:n[`source_${s.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:Or,validateSpec:o}),a;case"raster-dem":return a=function(t){var e;const i=null!==(e=t.sourceName)&&void 0!==e?e:"",n=t.value,r=t.styleSpec,o=r.source_raster_dem,s=t.style;let a=[];const l=Gn(n);if(void 0===n)return a;if("object"!==l)return a.push(new At("source_raster_dem",n,`object expected, ${l} found`)),a;const c="custom"===xr(n.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=t.value.encoding?`"${t.value.encoding}"`:"Default";for(const e in n)!c&&u.includes(e)?a.push(new At(e,n[e],`In "${i}": "${e}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[e]?a=a.concat(t.validateSpec({key:e,value:n[e],valueSpec:o[e],validateSpec:t.validateSpec,style:s,styleSpec:r})):a.push(new At(e,n[e],`unknown property "${e}"`));return a}({sourceName:i,value:e,style:t.style,styleSpec:n,validateSpec:o}),a;case"geojson":if(a=wr({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,validateSpec:o,objectElementValidators:Or}),e.cluster)for(const t in e.clusterProperties){const[n,r]=e.clusterProperties[t],o="string"==typeof n?[n,["accumulated"],["get",t]]:n;a.push(...Er({key:`${i}.${t}.map`,value:r,expressionContext:"cluster-map"})),a.push(...Er({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return wr({key:i,value:e,valueSpec:n.source_video,style:r,validateSpec:o,styleSpec:n});case"image":return wr({key:i,value:e,valueSpec:n.source_image,style:r,validateSpec:o,styleSpec:n});case"canvas":return[new At(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mr({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Nr(t){const e=t.value,i=t.styleSpec,n=i.light,r=t.style;let o=[];const s=Gn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new At("light",e,`object expected, ${s} found`)]),o;for(const s in e){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?t.validateSpec({key:s,value:e[s],valueSpec:i.transition,validateSpec:t.validateSpec,style:r,styleSpec:i}):n[s]?t.validateSpec({key:s,value:e[s],valueSpec:n[s],validateSpec:t.validateSpec,style:r,styleSpec:i}):[new At(s,e[s],`unknown property "${s}"`)])}return o}function Br(t){const e=t.value,i=t.styleSpec,n=i.sky,r=t.style,o=Gn(e);if(void 0===e)return[];if("object"!==o)return[new At("sky",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(n[o]?t.validateSpec({key:o,value:e[o],valueSpec:n[o],style:r,styleSpec:i}):[new At(o,e[o],`unknown property "${o}"`)]);return s}function jr(t){const e=t.value,i=t.styleSpec,n=i.terrain,r=t.style;let o=[];const s=Gn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new At("terrain",e,`object expected, ${s} found`)]),o;for(const s in e)o=o.concat(n[s]?t.validateSpec({key:s,value:e[s],valueSpec:n[s],validateSpec:t.validateSpec,style:r,styleSpec:i}):[new At(s,e[s],`unknown property "${s}"`)]);return o}function $r(t){let e=[];const i=t.value,n=t.key;if(Array.isArray(i)){const r=[],o=[];for(const s in i)i[s].id&&r.includes(i[s].id)&&e.push(new At(n,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),r.push(i[s].id),i[s].url&&o.includes(i[s].url)&&e.push(new At(n,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),e=e.concat(wr({key:`${n}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:t.validateSpec}));return e}return Rr({key:n,value:i})}function Ur(t){return e=t.value,Boolean(e)&&e.constructor===Object?[]:[new At(t.key,t.value,`object expected, ${Gn(t.value)} found`)];var e}const Vr={"*":()=>[],array:Tr,boolean:function(t){const e=t.value,i=t.key,n=Gn(e);return"boolean"!==n?[new At(i,e,`boolean expected, ${n} found`)]:[]},number:Sr,color:Ir,constants:vr,enum:Mr,filter:Ar,function:Cr,layer:Dr,object:wr,source:Fr,light:Nr,sky:Br,terrain:jr,projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,r=t.style,o=Gn(e);if(void 0===e)return[];if("object"!==o)return[new At("projection",e,`object expected, ${o} found`)];let s=[];for(const o in e)s=s.concat(n[o]?t.validateSpec({key:o,value:e[o],valueSpec:n[o],style:r,styleSpec:i}):[new At(o,e[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(t){const e=t.key;let i=t.value;i=i instanceof String?i.valueOf():i;const n=Gn(i);return"array"!==n||function(t){return Array.isArray(t)&&3===t.length&&"string"==typeof t[0]&&"string"==typeof t[1]&&"number"==typeof t[2]}(i)||function(t){return!!["interpolate","step","literal"].includes(t[0])}(i)?["array","string"].includes(n)?[]:[new At(e,i,`projection expected, invalid type "${n}" found`)]:[new At(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Rr,formatted:function(t){return 0===Rr(t).length?[]:Er(t)},resolvedImage:function(t){return 0===Rr(t).length?[]:Er(t)},padding:function(t){const e=t.key,i=t.value;if("array"===Gn(i)){if(i.length<1||i.length>4)return[new At(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const n={type:"number"};let r=[];for(let o=0;o<i.length;o++)r=r.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:n}));return r}return Sr({key:e,value:i,valueSpec:{}})},numberArray:function(t){const e=t.key,i=t.value;if("array"===Gn(i)){const n={type:"number"};if(i.length<1)return[new At(e,i,"array length at least 1 expected, length 0 found")];let r=[];for(let o=0;o<i.length;o++)r=r.concat(t.validateSpec({key:`${e}[${o}]`,value:i[o],validateSpec:t.validateSpec,valueSpec:n}));return r}return Sr({key:e,value:i,valueSpec:{}})},colorArray:function(t){const e=t.key,i=t.value;if("array"===Gn(i)){if(i.length<1)return[new At(e,i,"array length at least 1 expected, length 0 found")];let t=[];for(let n=0;n<i.length;n++)t=t.concat(Ir({key:`${e}[${n}]`,value:i[n]}));return t}return Ir({key:e,value:i})},variableAnchorOffsetCollection:function(t){const e=t.key,i=t.value,n=Gn(i),r=t.styleSpec;if("array"!==n||i.length<1||i.length%2!=0)return[new At(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let n=0;n<i.length;n+=2)o=o.concat(Mr({key:`${e}[${n}]`,value:i[n],valueSpec:r.layout_symbol["text-anchor"]})),o=o.concat(Tr({key:`${e}[${n+1}]`,value:i[n+1],valueSpec:{length:2,value:"number"},validateSpec:t.validateSpec,style:t.style,styleSpec:r}));return o},sprite:$r,state:Ur};function Gr(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;return t.validateSpec=Gr,i.expression&&qn(xr(e))?Cr(t):i.expression&&tr(br(e))?Er(t):i.type&&Vr[i.type]?Vr[i.type](t):wr(kt({},t,{valueSpec:i.type?n[i.type]:i}))}function qr(t){const e=t.value,i=t.key,n=Rr(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new At(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new At(i,e,'"glyphs" url must include a "{range}" token'))),n}function Zr(t,e=yt){let i=[];return i=i.concat(Gr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,validateSpec:Gr,objectElementValidators:{glyphs:qr,"*":()=>[]}})),t.constants&&(i=i.concat(vr({key:"constants",value:t.constants}))),Hr(i)}function Wr(t){return function(e){return t({...e,validateSpec:Gr})}}function Hr(t){return[].concat(t).sort(((t,e)=>t.line-e.line))}function Xr(t){return function(...e){return Hr(t.apply(this,e))}}Zr.source=Xr(Wr(Fr)),Zr.sprite=Xr(Wr($r)),Zr.glyphs=Xr(Wr(qr)),Zr.light=Xr(Wr(Nr)),Zr.sky=Xr(Wr(Br)),Zr.terrain=Xr(Wr(jr)),Zr.state=Xr(Wr(Ur)),Zr.layer=Xr(Wr(Dr)),Zr.filter=Xr(Wr(Ar)),Zr.paintProperty=Xr(Wr(Lr)),Zr.layoutProperty=Xr(Wr(zr));const Yr=Zr,Kr=Yr.light,Jr=Yr.sky,Qr=Yr.paintProperty,to=Yr.layoutProperty;function eo(t,e){let i=!1;if(e&&e.length)for(const n of e)t.fire(new mt(new Error(n.message))),i=!0;return i}class io{constructor(t,e,i){const n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(i=r[2]);for(let t=0;t<this.d*this.d;t++){const e=r[3+t],i=r[3+t+1];n.push(e===i?null:r.subarray(e,i))}const o=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],o),this.bboxes=r.subarray(o),this.insert=this._insertReadonly}else{this.d=e+2*i;for(let t=0;t<this.d*this.d;t++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;const r=i/e*t;this.min=-r,this.max=t+r}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,e,i,n,r,o){this.cells[r].push(o)}query(t,e,i,n,r){const o=this.min,s=this.max;if(t<=o&&e<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(t,e,i,n,this._queryCell,o,{},r),o}}_queryCell(t,e,i,n,r,o,s,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):t<=c[l+2]&&e<=c[l+3]&&i>=c[l+0]&&n>=c[l+1])?(s[h]=!0,o.push(r[h])):s[h]=!1}}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++){const c=this.d*l+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(l),this._convertFromCellCoord(p+1),this._convertFromCellCoord(l+1)))&&r.call(this,t,e,i,n,c,o,s,a))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,e=3+this.cells.length+1+1;let i=0;for(let t=0;t<this.cells.length;t++)i+=this.cells[t].length;const n=new Int32Array(e+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;let r=e;for(let e=0;e<t.length;e++){const i=t[e];n[3+e]=r,n.set(i,r),r+=i.length}return n[3+t.length]=r,n.set(this.keys,r),r+=this.keys.length,n[3+t.length+1]=r,n.set(this.bboxes,r),r+=this.bboxes.length,n.buffer}static serialize(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}}static deserialize(t){return new io(t.buffer)}}const no={};function ro(t,e,i={}){if(no[t])throw new Error(`${t} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),no[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}ro("Object",Object),ro("TransferableGridIndex",io),ro("Color",Ce),ro("Error",Error),ro("AJAXError",lt),ro("ResolvedImage",Oe),ro("StylePropertyFunction",or),ro("StyleExpression",Qn,{omit:["_evaluator"]}),ro("ZoomDependentExpression",nr),ro("ZoomConstantExpression",ir),ro("CompoundExpression",kn,{omit:["_evaluate"]});for(const t in An)An[t]._classRegistryKey||ro(`Expression_${t}`,An[t]);function oo(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function so(t){return t.$name||t.constructor._classRegistryKey}function ao(t){return!function(t){if(null===t||"object"!=typeof t)return!1;const e=so(t);return!(!e||"Object"===e)}(t)&&(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof Blob||t instanceof Error||oo(t)||W(t)||ArrayBuffer.isView(t)||t instanceof ImageData)}function lo(t,e){if(ao(t))return(oo(t)||W(t))&&e&&e.push(t),ArrayBuffer.isView(t)&&e&&e.push(t.buffer),t instanceof ImageData&&e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(lo(n,e));return i}if("object"!=typeof t)throw new Error("can't serialize object of type "+typeof t);const i=so(t);if(!i)throw new Error(`can't serialize object of unregistered class ${t.constructor.name}`);if(!no[i])throw new Error(`${i} is not registered.`);const{klass:n}=no[i],r=n.serialize?n.serialize(t,e):{};if(n.serialize){if(e&&r===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const n in t){if(!t.hasOwnProperty(n))continue;if(no[i].omit.indexOf(n)>=0)continue;const o=t[n];r[n]=no[i].shallow.indexOf(n)>=0?o:lo(o,e)}t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}function co(t){if(ao(t))return t;if(Array.isArray(t))return t.map(co);if("object"!=typeof t)throw new Error("can't deserialize object of type "+typeof t);const e=so(t)||"Object";if(!no[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=no[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const i of Object.keys(t)){if("$name"===i)continue;const r=t[i];n[i]=no[e].shallow.indexOf(i)>=0?r:co(r)}return n}class uo{constructor(){this.first=!0}update(t,e){const i=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=i,!0))}}const ho={"Latin-1 Supplement":t=>t>=128&&t<=255,"Hangul Jamo":t=>t>=4352&&t<=4607,Khmer:t=>t>=6016&&t<=6143,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Kanbun:t=>t>=12688&&t<=12703,"CJK Strokes":t=>t>=12736&&t<=12783,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Hangul Syllables":t=>t>=44032&&t<=55215,"Private Use Area":t=>t>=57344&&t<=63743,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function po(t){for(const e of t)if(vo(e.charCodeAt(0)))return!0;return!1}function fo(t){for(const e of t)if(!yo(e.charCodeAt(0)))return!1;return!0}function mo(t){const e=t.map((t=>{try{return new RegExp(`\\p{sc=${t}}`,"u").source}catch(t){return null}})).filter((t=>t));return new RegExp(e.join("|"),"u")}const go=mo(["Arab","Dupl","Mong","Ougr","Syrc"]);function yo(t){return!go.test(String.fromCodePoint(t))}const _o=mo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vo(t){return!(746!==t&&747!==t&&(t<4352||!(ho["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||ho["CJK Compatibility"](t)||ho["CJK Strokes"](t)||!(!ho["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||ho["Enclosed CJK Letters and Months"](t)||ho["Ideographic Description Characters"](t)||ho.Kanbun(t)||ho.Katakana(t)&&12540!==t||!(!ho["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!ho["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||ho["Vertical Forms"](t)||ho["Yijing Hexagram Symbols"](t)||/\p{sc=Cans}/u.test(String.fromCodePoint(t))||/\p{sc=Hang}/u.test(String.fromCodePoint(t))||_o.test(String.fromCodePoint(t)))))}function xo(t){return!(vo(t)||function(t){return!!(ho["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ho["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ho["Letterlike Symbols"](t)||ho["Number Forms"](t)||ho["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ho["Control Pictures"](t)&&9251!==t||ho["Optical Character Recognition"](t)||ho["Enclosed Alphanumerics"](t)||ho["Geometric Shapes"](t)||ho["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ho["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ho["CJK Symbols and Punctuation"](t)||ho.Katakana(t)||ho["Private Use Area"](t)||ho["CJK Compatibility Forms"](t)||ho["Small Form Variants"](t)||ho["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}const bo=mo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function wo(t){return bo.test(String.fromCodePoint(t))}function To(t,e){return!(!e&&wo(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||ho.Khmer(t))}function So(t){for(const e of t)if(wo(e.charCodeAt(0)))return!0;return!1}const Co=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(t){this.pluginStatus=t.pluginStatus,this.pluginURL=t.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(t){if(Co.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=t.applyArabicShaping,this.processBidirectionalText=t.processBidirectionalText,this.processStyledBidirectionalText=t.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(t,i){return e(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if("loading"!==t.pluginStatus)return this.setState(t),t;const e=t.pluginURL,n=new Promise((t=>{this.loadScriptResolve=t}));i(e);const r=new Promise((t=>setTimeout((()=>t()),this.TIMEOUT)));if(yield Promise.race([n,r]),this.isParsed()){const t={pluginStatus:"loaded",pluginURL:e};return this.setState(t),t}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${e}`)}))}};class Eo{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uo,this.transition={})}isSupportedScript(t){return function(t,e){for(const i of t)if(!To(i.charCodeAt(0),e))return!1;return!0}(t,"loaded"===Co.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),i=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*e}}}class Io{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(qn(t))return new or(t,e);if(tr(t)){const i=rr(t,e);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let i=t;return"color"===e.type&&"string"==typeof t?i=Ce.parse(t):"padding"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"numberArray"!==e.type||"number"!=typeof t&&!Array.isArray(t)?"colorArray"!==e.type||"string"!=typeof t&&!Array.isArray(t)?"variableAnchorOffsetCollection"===e.type&&Array.isArray(t)?i=Re.parse(t):"projectionDefinition"===e.type&&"string"==typeof t&&(i=Fe.parse(t)):i=Le.parse(t):i=Pe.parse(t):i=ke.parse(t),{kind:"constant",evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Mo{constructor(t){this.property=t,this.value=new Io(t,void 0)}transitioned(t,e){return new ko(this.property,this.value,e,F({},t.transition,this.transition),t.now)}untransitioned(){return new ko(this.property,this.value,null,{},0)}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return $(this._values[t].value.value)}setValue(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Mo(this._values[t].property)),this._values[t].value=new Io(this._values[t].property,null===e?void 0:$(e))}getTransition(t){return $(this._values[t].transition)}setTransition(t,e){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Mo(this._values[t].property)),this._values[t].transition=$(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new Po(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new Po(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class ko{constructor(t,e,i,n,r){this.property=t,this.value=e,this.begin=r+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,r=this.value.possiblyEvaluate(t,e,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(t,e,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,i),r,L(s))}}return r}}class Po{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new Do(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return void 0!==this._values[t].value}getValue(t){return $(this._values[t].value)}setValue(t,e){this._values[t]=new Io(this._values[t].property,null===e?void 0:$(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new Do(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(t,e,i);return n}}class zo{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ro{constructor(t){this.specification=t}possiblyEvaluate(t,e){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(e)}interpolate(t,e,i){const n=di[this.specification.type];return n?n(t,e,i):t}}class Oo{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new zo(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new zo(this,{kind:"constant",value:void 0},t.parameters);const n=di[this.specification.type];if(n){const r=n(t.value.value,e.value.value,i);return new zo(this,{kind:"constant",value:r},t.parameters)}return t}evaluate(t,e,i,n,r,o){return"constant"===t.kind?t.value:t.evaluate(e,i,n,r,o)}}class Fo extends Oo{possiblyEvaluate(t,e,i,n){if(void 0===t.value)return new zo(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n),o="resolvedImage"===t.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,e);return new zo(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const i=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new zo(this,{kind:"constant",value:i},e)}return new zo(this,t.expression,e)}evaluate(t,e,i,n,r,o){if("source"===t.kind){const s=t.evaluate(e,i,n,r,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},i,n),t.evaluate({zoom:Math.floor(e.zoom)},i,n),t.evaluate({zoom:Math.floor(e.zoom)+1},i,n),e):t.value}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class No{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){if(void 0!==t.value){if("constant"===t.expression.kind){const r=t.expression.evaluate(e,null,{},i,n);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Eo(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Eo(Math.floor(e.zoom),e)),t.expression.evaluate(new Eo(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:i,to:e}}interpolate(t){return t}}class Bo{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class jo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const i=t[e];i.specification.overridable&&this.overridableProperties.push(e);const n=this.defaultPropertyValues[e]=new Io(i,void 0),r=this.defaultTransitionablePropertyValues[e]=new Mo(i);this.defaultTransitioningPropertyValues[e]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}}}ro("DataDrivenProperty",Oo),ro("DataConstantProperty",Ro),ro("CrossFadedDataDrivenProperty",Fo),ro("CrossFadedProperty",No),ro("ColorRampProperty",Bo);const $o="-transition";class Uo extends gt{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new Lo(e.layout)),e.paint)){this._transitionablePaint=new Ao(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,i={}){null!=e&&this._validate(to,`layers.${this.id}.layout.${t}`,t,e,i)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return t.endsWith($o)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,i={}){if(null!=e&&this._validate(Qr,`layers.${this.id}.paint.${t}`,t,e,i))return!1;if(t.endsWith($o))return this._transitionablePaint.setTransition(t.slice(0,-11),e||void 0),!1;{const i=this._transitionablePaint._values[t],n="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||r||n||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),j(t,((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}_validate(t,e,i,n,r={}){return(!r||!1!==r.validate)&&eo(this,t.call(Yr,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:yt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof zo&&$n(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}}const Vo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Go{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zo(t,e=1){let i=0,n=0;return{members:t.map((t=>{const r=Vo[t.type].BYTES_PER_ELEMENT,o=i=Wo(i,Math.max(e,r)),s=t.components||1;return n=Math.max(n,r),i+=r*s,{name:t.name,type:t.type,components:s,offset:o}})),size:Wo(i,Math.max(n,e)),alignment:e}}function Wo(t,e){return Math.ceil(t/e)*e}class Ho extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}Ho.prototype.bytesPerElement=4,ro("StructArrayLayout2i4",Ho);class Xo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,t}}Xo.prototype.bytesPerElement=6,ro("StructArrayLayout3i6",Xo);class Yo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,t}}Yo.prototype.bytesPerElement=8,ro("StructArrayLayout4i8",Yo);class Ko extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}Ko.prototype.bytesPerElement=12,ro("StructArrayLayout2i4i12",Ko);class Jo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=4*t,l=8*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.uint8[l+4]=n,this.uint8[l+5]=r,this.uint8[l+6]=o,this.uint8[l+7]=s,t}}Jo.prototype.bytesPerElement=8,ro("StructArrayLayout2i4ub8",Jo);class Qo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}Qo.prototype.bytesPerElement=8,ro("StructArrayLayout2f8",Qo);class ts extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,i,n,r,o,s,a,l,c)}emplace(t,e,i,n,r,o,s,a,l,c,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,t}}ts.prototype.bytesPerElement=20,ro("StructArrayLayout10ui20",ts);class es extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,i,n,r,o,s,a,l,c,u,h)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=r,this.uint16[d+4]=o,this.uint16[d+5]=s,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=h,this.int16[d+11]=p,t}}es.prototype.bytesPerElement=24,ro("StructArrayLayout4i4ui4i24",es);class is extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}is.prototype.bytesPerElement=12,ro("StructArrayLayout3f12",is);class ns extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}ns.prototype.bytesPerElement=4,ro("StructArrayLayout1ul4",ns);class rs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,i,n,r,o,s,a,l)}emplace(t,e,i,n,r,o,s,a,l,c){const u=10*t,h=5*t;return this.int16[u+0]=e,this.int16[u+1]=i,this.int16[u+2]=n,this.int16[u+3]=r,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,t}}rs.prototype.bytesPerElement=20,ro("StructArrayLayout6i1ul2ui20",rs);class os extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,t}}os.prototype.bytesPerElement=12,ro("StructArrayLayout2i2i2i12",os);class ss extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,r)}emplace(t,e,i,n,r,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,t}}ss.prototype.bytesPerElement=16,ro("StructArrayLayout2f1f2i16",ss);class as extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n,r,o)}emplace(t,e,i,n,r,o,s){const a=16*t,l=4*t,c=8*t;return this.uint8[a+0]=e,this.uint8[a+1]=i,this.float32[l+1]=n,this.float32[l+2]=r,this.int16[c+6]=o,this.int16[c+7]=s,t}}as.prototype.bytesPerElement=16,ro("StructArrayLayout2ub2f2i16",as);class ls extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,t}}ls.prototype.bytesPerElement=6,ro("StructArrayLayout3ui6",ls);class cs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y){const _=24*t,v=12*t,x=48*t;return this.int16[_+0]=e,this.int16[_+1]=i,this.uint16[_+2]=n,this.uint16[_+3]=r,this.uint32[v+2]=o,this.uint32[v+3]=s,this.uint32[v+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=p,this.uint8[x+36]=d,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,t}}cs.prototype.bytesPerElement=48,ro("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cs);class us extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I){const M=this.length;return this.resize(M+1),this.emplace(M,t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I)}emplace(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C,E,I,M){const A=32*t,k=16*t;return this.int16[A+0]=e,this.int16[A+1]=i,this.int16[A+2]=n,this.int16[A+3]=r,this.int16[A+4]=o,this.int16[A+5]=s,this.int16[A+6]=a,this.int16[A+7]=l,this.uint16[A+8]=c,this.uint16[A+9]=u,this.uint16[A+10]=h,this.uint16[A+11]=p,this.uint16[A+12]=d,this.uint16[A+13]=f,this.uint16[A+14]=m,this.uint16[A+15]=g,this.uint16[A+16]=y,this.uint16[A+17]=_,this.uint16[A+18]=v,this.uint16[A+19]=x,this.uint16[A+20]=b,this.uint16[A+21]=w,this.uint16[A+22]=T,this.uint32[k+12]=S,this.float32[k+13]=C,this.float32[k+14]=E,this.uint16[A+30]=I,this.uint16[A+31]=M,t}}us.prototype.bytesPerElement=64,ro("StructArrayLayout8i15ui1ul2f2ui64",us);class hs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}hs.prototype.bytesPerElement=4,ro("StructArrayLayout1f4",hs);class ps extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=3*t;return this.uint16[6*t+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,t}}ps.prototype.bytesPerElement=12,ro("StructArrayLayout1ui2f12",ps);class ds extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const r=4*t;return this.uint32[2*t+0]=e,this.uint16[r+2]=i,this.uint16[r+3]=n,t}}ds.prototype.bytesPerElement=8,ro("StructArrayLayout1ul2ui8",ds);class fs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}fs.prototype.bytesPerElement=4,ro("StructArrayLayout2ui4",fs);class ms extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}ms.prototype.bytesPerElement=2,ro("StructArrayLayout1ui2",ms);class gs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n)}emplace(t,e,i,n,r){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,t}}gs.prototype.bytesPerElement=16,ro("StructArrayLayout4f16",gs);class ys extends Go{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new l(this.anchorPointX,this.anchorPointY)}}ys.prototype.size=20;class _s extends rs{get(t){return new ys(this,t)}}ro("CollisionBoxArray",_s);class vs extends Go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}vs.prototype.size=48;class xs extends cs{get(t){return new vs(this,t)}}ro("PlacedSymbolArray",xs);class bs extends Go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}bs.prototype.size=64;class ws extends us{get(t){return new bs(this,t)}}ro("SymbolInstanceArray",ws);class Ts extends hs{getoffsetX(t){return this.float32[1*t+0]}}ro("GlyphOffsetArray",Ts);class Ss extends Xo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}ro("SymbolLineVertexArray",Ss);class Cs extends Go{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Cs.prototype.size=12;class Es extends ps{get(t){return new Cs(this,t)}}ro("TextAnchorOffsetArray",Es);class Is extends Go{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Is.prototype.size=8;class Ms extends ds{get(t){return new Is(this,t)}}ro("FeatureIndexArray",Ms);class As extends Ho{}class ks extends Ho{}class Ps extends Ho{}class Ls extends Ko{}class zs extends Jo{}class Ds extends Qo{}class Rs extends ts{}class Os extends es{}class Fs extends is{}class Ns extends ns{}class Bs extends os{}class js extends as{}class $s extends ls{}class Us extends fs{}const Vs=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gs}=Vs;class qs{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,e,i,n){const r=this.segments[this.segments.length-1];return t>qs.MAX_VERTEX_ARRAY_LENGTH&&V(`Max vertices per segment is ${qs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${qs.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!r||r.vertexLength+t>qs.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n?this.createNewSegment(e,i,n):r}createNewSegment(t,e,i){const n={vertexOffset:t.length,primitiveOffset:e.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==i&&(n.sortKey=i),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(n),n}getOrCreateLatestSegment(t,e,i){return this.prepareSegment(0,t,e,i)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new qs([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function Zs(t,e){return 256*(t=R(Math.floor(t),0,255))+R(Math.floor(e),0,255)}qs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ro("SegmentVector",qs);const Ws=Zo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Hs,Xs,Ys,Ks={exports:{}},Js={exports:{}},Qs={exports:{}},ta=function(){if(Ys)return Ks.exports;Ys=1;var t=(Hs||(Hs=1,Js.exports=function(t,e){var i,n,r,o,s,a,l,c;for(n=t.length-(i=3&t.length),r=e,s=3432918353,a=461845907,c=0;c<n;)l=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&t.charCodeAt(c+2))<<16;case 2:l^=(255&t.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=t.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}),Js.exports),e=(Xs||(Xs=1,Qs.exports=function(t,e){for(var i,n=t.length,r=e^n,o=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&t.charCodeAt(o+2))<<16;case 2:r^=(255&t.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&t.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}),Qs.exports);return Ks.exports=t,Ks.exports.murmur3=t,Ks.exports.murmur2=e,Ks.exports}(),ea=i(ta);class ia{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(na(t)),this.positions.push(e,i,n)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const e=na(t);let i=0,n=this.ids.length-1;for(;i<n;){const t=i+n>>1;this.ids[t]>=e?n=t:i=t+1}const r=[];for(;this.ids[i]===e;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return ra(i,n,0,i.length-1),e&&e.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(t){const e=new ia;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function na(t){const e=+t;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:ea(String(t))}function ra(t,e,i,n){for(;i<n;){const r=t[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(t[o]<r);do{s--}while(t[s]>r);if(o>=s)break;oa(t,o,s),oa(e,3*o,3*s),oa(e,3*o+1,3*s+1),oa(e,3*o+2,3*s+2)}s-i<n-s?(ra(t,e,i,s),i=s+1):(ra(t,e,s+1,n),n=s)}}function oa(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}ro("FeaturePositionMap",ia);class sa{constructor(t,e){this.gl=t.gl,this.location=e}}class aa extends sa{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class la extends sa{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ca extends sa{constructor(t,e){super(t,e),this.current=Ce.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ua=new Float32Array(16);function ha(t){return[Zs(255*t.r,255*t.g),Zs(255*t.b,255*t.a)]}class pa{constructor(t,e,i){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i}setUniform(t,e,i){t.set(i.constantOr(this.value))}getBinding(t,e,i){return"color"===this.type?new ca(t,e):new aa(t,e)}}class da{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr}setUniform(t,e,i,n){const r="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&t.set(r)}getBinding(t,e,i){return"u_pattern"===i.substr(0,9)?new la(t,e):new aa(t,e)}}class fa{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new Eo(0),e,{},n,[],r);this.paintVertexArray.resize(t),this._setPaintValue(o,t,s)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:0},i,n);this._setPaintValue(t,e,r)}_setPaintValue(t,e,i){if("color"===this.type){const n=ha(i);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ma{constructor(t,e,i,n,r,o){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(t,e,i,n,r){const o=this.expression.evaluate(new Eo(this.zoom),e,{},n,[],r),s=this.expression.evaluate(new Eo(this.zoom+1),e,{},n,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(a,t,o,s)}updatePaintArray(t,e,i,n){const r=this.expression.evaluate({zoom:this.zoom},i,n),o=this.expression.evaluate({zoom:this.zoom+1},i,n);this._setPaintValue(t,e,r,o)}_setPaintValue(t,e,i,n){if("color"===this.type){const r=ha(i),o=ha(n);for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const i=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=R(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);t.set(n)}getBinding(t,e,i){return new aa(t,e)}}class ga{constructor(t,e,i,n,r,o){this.expression=t,this.type=e,this.useIntegerZoom=i,this.zoom=n,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(t,e,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,r){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(t,e,i,n){if(!n||!i)return;const{min:r,mid:o,max:s}=i,a=n[r],l=n[o],c=n[s];if(a&&l&&c)for(let i=t;i<e;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ws.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ws.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ya{constructor(t,e,i){this.binders={},this._buffers=[];const n=[];for(const r in t.paint._values){if(!i(r))continue;const o=t.paint.get(r);if(!(o instanceof zo&&$n(o.property.specification)))continue;const s=va(r,t.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new da(a.value,s):new pa(a.value,s,l),n.push(`/u_${r}`);else if("source"===a.kind||h){const i=xa(r,l,"source");this.binders[r]=h?new ga(a,l,c,e,i,t.id):new fa(a,s,l,i),n.push(`/a_${r}`)}else{const t=xa(r,l,"composite");this.binders[r]=new ma(a,s,l,c,e,t),n.push(`/z_${r}`)}}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof fa||e instanceof ma?e.maxValue:0}populatePaintArrays(t,e,i,n,r){for(const o in this.binders){const s=this.binders[o];(s instanceof fa||s instanceof ma||s instanceof ga)&&s.populatePaintArray(t,e,i,n,r)}}setConstantPatternPositions(t,e){for(const i in this.binders){const n=this.binders[i];n instanceof da&&n.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,i,n,r){let o=!1;for(const s in t){const a=e.getPositions(s);for(const e of a){const a=i.feature(e.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof fa||l instanceof ma||l instanceof ga)&&!0===l.expression.isStateDependent){const c=n.paint.get(i);l.expression=c.value,l.updatePaintArray(e.start,e.end,a,t[s],r),o=!0}}}}return o}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof pa||i instanceof da)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof fa||i instanceof ma)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name);else if(i instanceof ga)for(let e=0;e<Ws.members.length;e++)t.push(Ws.members[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof pa||i instanceof da||i instanceof ma)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof pa||r instanceof da||r instanceof ma)for(const o of r.uniformNames)if(e[o]){const s=r.getBinding(t,e[o],o);i.push({name:o,property:n,binding:s})}}return i}setUniforms(t,e,i,n){for(const{name:t,property:r,binding:o}of e)this.binders[r].setUniform(o,n,i.get(r),t)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const i=this.binders[e];if(t&&i instanceof ga){const e=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(i instanceof fa||i instanceof ma)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof fa||i instanceof ma||i instanceof ga)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof fa||e instanceof ma||e instanceof ga)&&e.destroy()}}}class _a{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new ya(n,e,i);this.needsUpload=!1,this._featureMap=new ia,this._bufferOffset=0}populatePaintArrays(t,e,i,n,r,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,r,o);void 0!==e.id&&this._featureMap.add(e.id,i,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n){for(const r of i)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(t,this._featureMap,e,r,n)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function va(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}function xa(t,e,i){const n={color:{source:Qo,composite:gs},number:{source:hs,composite:Qo}},r=function(t){return{"line-pattern":{source:Rs,composite:Rs},"fill-pattern":{source:Rs,composite:Rs},"fill-extrusion-pattern":{source:Rs,composite:Rs}}[t]}(t);return r&&r[i]||n[e][i]}ro("ConstantBinder",pa),ro("CrossFadedConstantBinder",da),ro("SourceExpressionBinder",fa),ro("CrossFadedCompositeBinder",ga),ro("CompositeExpressionBinder",ma),ro("ProgramConfiguration",ya,{omit:["_buffers"]}),ro("ProgramConfigurationSet",_a);const ba=Math.pow(2,14)-1,wa=-ba-1;function Ta(t){const e=M/t.extent,i=t.loadGeometry();for(let t=0;t<i.length;t++){const n=i[t];for(let t=0;t<n.length;t++){const i=n[t],r=Math.round(i.x*e),o=Math.round(i.y*e);i.x=R(r,wa,ba),i.y=R(o,wa,ba),(r<i.x||r>i.x+1||o<i.y||o>i.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Sa(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ta(t):[]}}const Ca=-32768;function Ea(t,e,i,n,r){t.emplaceBack(Ca+8*e+n,Ca+8*i+r)}class Ia{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ks,this.indexArray=new $s,this.segments=new qs,this.programConfigurations=new _a(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){const n=this.layers[0],r=[];let o=null,s=!1,a="heatmap"===n.type;if("circle"===n.type){const t=n;o=t.layout.get("circle-sort-key"),s=!o.isConstant(),a=a||"map"===t.paint.get("circle-pitch-alignment")}const l=a?e.subdivisionGranularity.circle:1;for(const{feature:e,id:n,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Sa(e,t);if(!this.layers[0]._featureFilter.filter(new Eo(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:n,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ta(e),patterns:{},sortKey:u};r.push(h)}s&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of r){const{geometry:r,index:o,sourceLayerIndex:s}=n,a=t[o].feature;this.addFeature(n,r,o,i,l),e.featureIndex.insert(a,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,r=1){let o;switch(r){case 1:o=[0,7];break;case 3:o=[0,2,5,7];break;case 5:o=[0,1,3,4,6,7];break;case 7:o=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${r}; valid values are 1, 3, 5, 7.`)}const s=o.length;for(const i of e)for(const e of i){const i=e.x,n=e.y;if(i<0||i>=M||n<0||n>=M)continue;const r=this.segments.prepareSegment(s*s,this.layoutVertexArray,this.indexArray,t.sortKey),a=r.vertexLength;for(let t=0;t<s;t++)for(let e=0;e<s;e++)Ea(this.layoutVertexArray,i,n,o[e],o[t]);for(let t=0;t<s-1;t++)for(let e=0;e<s-1;e++){const i=a+t*s+e,n=a+(t+1)*s+e;this.indexArray.emplaceBack(i,n+1,i+1),this.indexArray.emplaceBack(i,n,n+1)}r.vertexLength+=s*s,r.primitiveLength+=(s-1)*(s-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n)}}function Ma(t,e){for(let i=0;i<t.length;i++)if(Fa(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Fa(t,e[i]))return!0;return!!La(t,e)}function Aa(t,e,i){return!!Fa(t,e)||!!Da(e,t,i)}function ka(t,e){if(1===t.length)return Oa(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(Fa(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(Oa(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(La(t,e[i]))return!0;return!1}function Pa(t,e,i){if(t.length>1){if(La(t,e))return!0;for(let n=0;n<e.length;n++)if(Da(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(Da(t[n],e,i))return!0;return!1}function La(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)if(za(n,r,e[t],e[t+1]))return!0}return!1}function za(t,e,i,n){return G(t,i,n)!==G(e,i,n)&&G(t,e,i)!==G(t,e,n)}function Da(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Ra(t,e[i-1],e[i])<n)return!0;return!1}function Ra(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(r<0?e:r>1?i:i.sub(e)._mult(r)._add(e))}function Oa(t,e){for(let i=0;i<t.length;i++)if(Fa(t[i],e))return!0;return!1}function Fa(t,e){let i=!1;for(let n=0,r=t.length-1;n<t.length;r=n++){const o=t[n],s=t[r];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Na(t,e,i){const n=i[0],r=i[2];if(t.x<n.x&&e.x<n.x||t.x>r.x&&e.x>r.x||t.y<n.y&&e.y<n.y||t.y>r.y&&e.y>r.y)return!1;const o=G(t,e,i[0]);return o!==G(t,e,i[1])||o!==G(t,e,i[2])||o!==G(t,e,i[3])}function Ba(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function ja(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function $a(t,e,i,n,r){if(!e[0]&&!e[1])return t;const o=l.convert(e)._mult(r);"viewport"===i&&o._rotate(-n);const s=[];for(let e=0;e<t.length;e++)s.push(t[e].sub(o));return s}let Ua,Va;ro("CircleBucket",Ia,{omit:["layers"]});var Ga={get paint(){return Va=Va||new jo({"circle-radius":new Oo(yt.paint_circle["circle-radius"]),"circle-color":new Oo(yt.paint_circle["circle-color"]),"circle-blur":new Oo(yt.paint_circle["circle-blur"]),"circle-opacity":new Oo(yt.paint_circle["circle-opacity"]),"circle-translate":new Ro(yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ro(yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ro(yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ro(yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Oo(yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Oo(yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Oo(yt.paint_circle["circle-stroke-opacity"])})},get layout(){return Ua=Ua||new jo({"circle-sort-key":new Oo(yt.layout_circle["circle-sort-key"])})}};class qa extends Uo{constructor(t){super(t,Ga)}createBucket(t){return new Ia(t)}queryRadius(t){const e=t;return Ba("circle-radius",this,e)+Ba("circle-stroke-width",this,e)+ja(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:e,featureState:i,geometry:n,transform:r,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:a}){const l=$a(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-r.bearingInRadians,o),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(t,e,i,n){return t.map((t=>Za(t,e,i,n)))}(l,r,s,a),p=u?c*o:c;for(const t of n)for(const e of t){const t=u?e:Za(e,r,s,a);let i=p;const n=r.projectTileCoordinates(e.x,e.y,s,a).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=n/r.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=r.cameraToCenterDistance/n),Aa(h,t,i))return!0}return!1}}function Za(t,e,i,n){const r=e.projectTileCoordinates(t.x,t.y,i,n).point;return new l((.5*r.x+.5)*e.width,(.5*-r.y+.5)*e.height)}class Wa extends Ia{}let Ha;ro("HeatmapBucket",Wa,{omit:["layers"]});var Xa={get paint(){return Ha=Ha||new jo({"heatmap-radius":new Oo(yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Oo(yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ro(yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bo(yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ro(yt.paint_heatmap["heatmap-opacity"])})}};function Ya(t,{width:e,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*i*n)throw new RangeError(`mismatched image size. expected: ${r.length} but got: ${e*i*n}`)}else r=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=r,t}function Ka(t,{width:e,height:i},n){if(e===t.width&&i===t.height)return;const r=Ya({},{width:e,height:i},n);Ja(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},n),t.width=e,t.height=i,t.data=r.data}function Ja(t,e,i,n,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((i.y+l)*t.width+i.x)*o,u=((n.y+l)*e.width+n.x)*o;for(let t=0;t<r.width*o;t++)a[u+t]=s[c+t]}return e}class Qa{constructor(t,e){Ya(this,t,1,e)}resize(t){Ka(this,t,1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ja(t,e,i,n,r,1)}}class tl{constructor(t,e){Ya(this,t,4,e)}resize(t){Ka(this,t,4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,r){Ja(t,e,i,n,r,4)}}function el(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,r=t.image||new tl({width:i,height:n});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,n,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a)};if(t.clips)for(let e=0,r=0;e<n;++e,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=t.clips[e];o(r,s,l*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)o(0,e,t/(i-1));return r}ro("AlphaImage",Qa),ro("RGBAImage",tl);const il="big-fb";class nl extends Uo{createBucket(t){return new Wa(t)}constructor(t){super(t,Xa),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=el({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(il)&&this.heatmapFbos.delete(il)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let rl;var ol={get paint(){return rl=rl||new jo({"hillshade-illumination-direction":new Ro(yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ro(yt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ro(yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ro(yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ro(yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ro(yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ro(yt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ro(yt.paint_hillshade["hillshade-method"])})}};class sl extends Uo{constructor(t){super(t,ol),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,e=this.paint.get("hillshade-illumination-altitude").values,i=this.paint.get("hillshade-highlight-color").values,n=this.paint.get("hillshade-shadow-color").values;const r=Math.max(t.length,e.length,i.length,n.length);t=t.concat(Array(r-t.length).fill(t.at(-1))),e=e.concat(Array(r-e.length).fill(e.at(-1))),i=i.concat(Array(r-i.length).fill(i.at(-1))),n=n.concat(Array(r-n.length).fill(n.at(-1)));const o=e.map(Q);return{directionRadians:t.map(Q),altitudeRadians:o,shadowColor:n,highlightColor:i}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const al=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:ll}=al;function cl(t,e,i){const n=i.patternDependencies;let r=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(r=!0);const o=e.constantOr(null);o&&(r=!0,n[o.to]=!0,n[o.from]=!0)}return r}function ul(t,e,i,n,r){const o=r.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n-1},i,{},r.availableImages),a=e.evaluate({zoom:n},i,{},r.availableImages),l=e.evaluate({zoom:n+1},i,{},r.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[t]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:t,mid:a,max:l}}}return i}function hl(t,e,i,n,r){let o;if(r===function(t,e,i,n){let r=0;for(let o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}(t,e,i,n)>0)for(let r=e;r<i;r+=n)o=zl(r/n|0,t[r],t[r+1],o);else for(let r=i-n;r>=e;r-=n)o=zl(r/n|0,t[r],t[r+1],o);return o&&Il(o,o.next)&&(Dl(o),o=o.next),o}function pl(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!Il(n,n.next)&&0!==El(n.prev,n,n.next))n=n.next;else{if(Dl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function dl(t,e,i,n,r,o,s){if(!t)return;!s&&o&&function(t,e,i,n){let r=t;do{0===r.z&&(r.z=bl(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i=1;do{let n,r=t;t=null;let o=null;for(e=0;r;){e++;let s=r,a=0;for(let t=0;t<i&&(a++,s=s.nextZ,s);t++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||r.z<=s.z)?(n=r,r=r.nextZ,a--):(n=s,s=s.nextZ,l--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=s}o.nextZ=null,i*=2}while(e>1)}(r)}(t,n,r,o);let a=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(o?ml(t,n,r,o):fl(t))e.push(l.i,t.i,c.i),Dl(t),t=c.next,a=c.next;else if((t=c)===a){s?1===s?dl(t=gl(pl(t),e),e,i,n,r,o,2):2===s&&yl(t,e,i,n,r,o):dl(pl(t),e,i,n,r,o,1);break}}}function fl(t){const e=t.prev,i=t,n=t.next;if(El(e,i,n)>=0)return!1;const r=e.x,o=i.x,s=n.x,a=e.y,l=i.y,c=n.y,u=Math.min(r,o,s),h=Math.min(a,l,c),p=Math.max(r,o,s),d=Math.max(a,l,c);let f=n.next;for(;f!==e;){if(f.x>=u&&f.x<=p&&f.y>=h&&f.y<=d&&Sl(r,a,o,l,s,c,f.x,f.y)&&El(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ml(t,e,i,n){const r=t.prev,o=t,s=t.next;if(El(r,o,s)>=0)return!1;const a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,p=s.y,d=Math.min(a,l,c),f=Math.min(u,h,p),m=Math.max(a,l,c),g=Math.max(u,h,p),y=bl(d,f,e,i,n),_=bl(m,g,e,i,n);let v=t.prevZ,x=t.nextZ;for(;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Sl(a,u,l,h,c,p,v.x,v.y)&&El(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=d&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Sl(a,u,l,h,c,p,x.x,x.y)&&El(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Sl(a,u,l,h,c,p,v.x,v.y)&&El(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=d&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&Sl(a,u,l,h,c,p,x.x,x.y)&&El(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function gl(t,e){let i=t;do{const n=i.prev,r=i.next.next;!Il(n,r)&&Ml(n,i,i.next,r)&&Pl(n,r)&&Pl(r,n)&&(e.push(n.i,i.i,r.i),Dl(i),Dl(i.next),i=t=r),i=i.next}while(i!==t);return pl(i)}function yl(t,e,i,n,r,o){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&Cl(s,t)){let a=Ll(s,t);return s=pl(s,s.next),a=pl(a,a.next),dl(s,e,i,n,r,o,0),void dl(a,e,i,n,r,o,0)}t=t.next}s=s.next}while(s!==t)}function _l(t,e){let i=t.x-e.x;return 0===i&&(i=t.y-e.y,0===i)&&(i=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function vl(t,e){const i=function(t,e){let i=e;const n=t.x,r=t.y;let o,s=-1/0;if(Il(t,i))return i;do{if(Il(t,i.next))return i.next;if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>s&&(s=t,o=i.x<i.next.x?i:i.next,t===n))return o}i=i.next}while(i!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;i=o;do{if(n>=i.x&&i.x>=l&&n!==i.x&&Tl(r<c?n:s,r,l,c,r<c?s:n,r,i.x,i.y)){const e=Math.abs(r-i.y)/(n-i.x);Pl(i,t)&&(e<u||e===u&&(i.x>o.x||i.x===o.x&&xl(o,i)))&&(o=i,u=e)}i=i.next}while(i!==a);return o}(t,e);if(!i)return e;const n=Ll(i,t);return pl(n,n.next),pl(i,i.next)}function xl(t,e){return El(t.prev,t,e.prev)<0&&El(e.next,t,t.next)<0}function bl(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function wl(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Tl(t,e,i,n,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(n-a)>=(i-s)*(e-a)&&(i-s)*(o-a)>=(r-s)*(n-a)}function Sl(t,e,i,n,r,o,s,a){return!(t===s&&e===a)&&Tl(t,e,i,n,r,o,s,a)}function Cl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Ml(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Pl(t,e)&&Pl(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(El(t.prev,t,e.prev)||El(t,e.prev,e))||Il(t,e)&&El(t.prev,t,t.next)>0&&El(e.prev,e,e.next)>0)}function El(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Il(t,e){return t.x===e.x&&t.y===e.y}function Ml(t,e,i,n){const r=kl(El(t,e,i)),o=kl(El(t,e,n)),s=kl(El(i,n,t)),a=kl(El(i,n,e));return r!==o&&s!==a||!(0!==r||!Al(t,i,e))||!(0!==o||!Al(t,n,e))||!(0!==s||!Al(i,t,n))||!(0!==a||!Al(i,e,n))}function Al(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function kl(t){return t>0?1:t<0?-1:0}function Pl(t,e){return El(t.prev,t,t.next)<0?El(t,e,t.next)>=0&&El(t,t.prev,e)>=0:El(t,e,t.prev)<0||El(t,t.next,e)<0}function Ll(t,e){const i=Rl(t.i,t.x,t.y),n=Rl(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function zl(t,e,i,n){const r=Rl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Dl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rl(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ol{constructor(t,e){if(e>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=e}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Fl{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Fl.noSubdivision=new Fl({fill:new Ol(0,0),line:new Ol(0,0),tile:new Ol(0,0),stencil:new Ol(0,0),circle:1}),ro("SubdivisionGranularityExpression",Ol),ro("SubdivisionGranularitySetting",Fl);const Nl=-32768,Bl=32767;class jl{constructor(t,e){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=M/t,this._canonical=e}_getKey(t,e){return(t+=32768)<<16|(e+=32768)<<0}_vertexToIndex(t,e){if(t<-32768||e<-32768||t>32767||e>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const i=0|Math.round(t),n=0|Math.round(e),r=this._getKey(i,n);if(this._vertexDictionary.has(r))return this._vertexDictionary.get(r);const o=this._vertexBuffer.length/2;return this._vertexDictionary.set(r,o),this._vertexBuffer.push(i,n),o}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(t,e){const i=[];for(let n=0;n<e.length;n+=3){const r=e[n],o=e[n+1],s=e[n+2],a=t[2*r],l=t[2*r+1];(t[2*o]-a)*(t[2*s+1]-l)-(t[2*o+1]-l)*(t[2*s]-a)>0?(i.push(r),i.push(s),i.push(o)):(i.push(r),i.push(o),i.push(s))}return i}(this._vertexBuffer,t);const e=[],i=t.length;for(let n=0;n<i;n+=3){const i=[t[n+0],t[n+1],t[n+2]],r=[this._vertexBuffer[2*t[n+0]+0],this._vertexBuffer[2*t[n+0]+1],this._vertexBuffer[2*t[n+1]+0],this._vertexBuffer[2*t[n+1]+1],this._vertexBuffer[2*t[n+2]+0],this._vertexBuffer[2*t[n+2]+1]];let o=1/0,s=1/0,a=-1/0,l=-1/0;for(let t=0;t<3;t++){const e=r[2*t],i=r[2*t+1];o=Math.min(o,e),a=Math.max(a,e),s=Math.min(s,i),l=Math.max(l,i)}if(o===a||s===l)continue;const c=Math.floor(o/this._granularityCellSize),u=Math.ceil(a/this._granularityCellSize),h=Math.floor(s/this._granularityCellSize),p=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==p)for(let t=h;t<p;t++){const n=this._scanlineGenerateVertexRingForCellRow(t,r,i);Vl(this._vertexBuffer,n,e)}else e.push(...i)}return e}_scanlineGenerateVertexRingForCellRow(t,e,i){const n=t*this._granularityCellSize,r=n+this._granularityCellSize,o=[];for(let t=0;t<3;t++){const s=e[2*t],a=e[2*t+1],l=e[2*(t+1)%6],c=e[(2*(t+1)+1)%6],u=e[2*(t+2)%6],h=e[(2*(t+2)+1)%6],p=l-s,d=c-a,f=0===p,m=0===d,g=(n-a)/d,y=(r-a)/d,_=Math.min(g,y),v=Math.max(g,y);if(!m&&(_>=1||v<=0)||m&&(a<n||a>r)){c>=n&&c<=r&&o.push(i[(t+1)%3]);continue}!m&&_>0&&o.push(this._vertexToIndex(s+p*_,a+d*_));const x=s+p*Math.max(_,0),b=s+p*Math.min(v,1);f||this._generateIntraEdgeVertices(o,s,a,l,c,x,b),!m&&v<1&&o.push(this._vertexToIndex(s+p*v,a+d*v)),(m||c>=n&&c<=r)&&o.push(i[(t+1)%3]),!m&&(c<=n||c>=r)&&this._generateInterEdgeVertices(o,s,a,l,c,u,h,b,n,r)}return o}_generateIntraEdgeVertices(t,e,i,n,r,o,s){const a=n-e,l=r-i,c=0===l,u=c?Math.min(e,n):Math.min(o,s),h=c?Math.max(e,n):Math.max(o,s),p=Math.floor(u/this._granularityCellSize)+1,d=Math.ceil(h/this._granularityCellSize)-1;if(c?e<n:o<s)for(let n=p;n<=d;n++){const r=n*this._granularityCellSize;t.push(this._vertexToIndex(r,i+l*(r-e)/a))}else for(let n=d;n>=p;n--){const r=n*this._granularityCellSize;t.push(this._vertexToIndex(r,i+l*(r-e)/a))}}_generateInterEdgeVertices(t,e,i,n,r,o,s,a,l,c){const u=r-i,h=o-n,p=s-r,d=(l-r)/p,f=(c-r)/p,m=Math.min(d,f),g=Math.max(d,f),y=n+h*m;let _=Math.floor(Math.min(y,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(y,a)/this._granularityCellSize)-1,x=a<y;const b=0===p;if(b&&(s===l||s===c))return;if(b||m>=1||g<=0){const t=i-s,n=o+(e-o)*Math.min((l-s)/t,(c-s)/t);_=Math.floor(Math.min(n,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(n,a)/this._granularityCellSize)-1,x=a<n}const w=u>0?c:l;if(x)for(let e=_;e<=v;e++)t.push(this._vertexToIndex(e*this._granularityCellSize,w));else for(let e=v;e>=_;e--)t.push(this._vertexToIndex(e*this._granularityCellSize,w))}_generateOutline(t){const e=[];for(const i of t){const t=Ul(i,this._granularity,!0),n=this._pointArrayToIndices(t),r=[];for(let t=1;t<n.length;t++)r.push(n[t-1]),r.push(n[t]);e.push(r)}return e}_handlePoles(t){let e=!1,i=!1;this._canonical&&(0===this._canonical.y&&(e=!0),this._canonical.y===(1<<this._canonical.z)-1&&(i=!0)),(e||i)&&this._fillPoles(t,e,i)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let e=0;e<t.length;e+=2){const i=t[e+1];i===Nl&&(t[e+1]=-32767),i===Bl&&(t[e+1]=32766)}}_generatePoleQuad(t,e,i,n,r,o){n>r!=(o===Nl)?(t.push(e),t.push(i),t.push(this._vertexToIndex(n,o)),t.push(i),t.push(this._vertexToIndex(r,o)),t.push(this._vertexToIndex(n,o))):(t.push(i),t.push(e),t.push(this._vertexToIndex(n,o)),t.push(this._vertexToIndex(r,o)),t.push(i),t.push(this._vertexToIndex(n,o)))}_fillPoles(t,e,i){const n=this._vertexBuffer,r=M,o=t.length;for(let s=2;s<o;s+=3){const o=t[s-2],a=t[s-1],l=t[s],c=n[2*o],u=n[2*o+1],h=n[2*a],p=n[2*a+1],d=n[2*l],f=n[2*l+1];e&&(0===u&&0===p&&this._generatePoleQuad(t,o,a,c,h,Nl),0===p&&0===f&&this._generatePoleQuad(t,a,l,h,d,Nl),0===f&&0===u&&this._generatePoleQuad(t,l,o,d,c,Nl)),i&&(u===r&&p===r&&this._generatePoleQuad(t,o,a,c,h,Bl),p===r&&f===r&&this._generatePoleQuad(t,a,l,h,d,Bl),f===r&&u===r&&this._generatePoleQuad(t,l,o,d,c,Bl))}}_initializeVertices(t){for(let e=0;e<t.length;e+=2)this._vertexToIndex(t[e],t[e+1])}subdividePolygonInternal(t,e){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:i,holeIndices:n}=function(t){const e=[],i=[];for(const n of t)if(0!==n.length){n!==t[0]&&e.push(i.length/2);for(let t=0;t<n.length;t++)i.push(n[t].x),i.push(n[t].y)}return{flattened:i,holeIndices:e}}(t);let r;this._initializeVertices(i);try{const t=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let o=hl(t,0,r,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(n&&(o=function(t,e,i,n){const r=[];for(let i=0,o=e.length;i<o;i++){const s=hl(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1);s===s.next&&(s.steiner=!0),r.push(wl(s))}r.sort(_l);for(let t=0;t<r.length;t++)i=vl(r[t],i);return i}(t,e,o,i)),t.length>80*i){a=1/0,l=1/0;let e=-1/0,n=-1/0;for(let o=i;o<r;o+=i){const i=t[o],r=t[o+1];i<a&&(a=i),r<l&&(l=r),i>e&&(e=i),r>n&&(n=r)}c=Math.max(e-a,n-l),c=0!==c?32767/c:0}return dl(o,s,i,a,l,c,0),s}(i,n),e=this._convertIndices(i,t);r=this._subdivideTrianglesScanline(e)}catch(t){console.error(t)}let o=[];return e&&(o=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(r),{verticesFlattened:this._vertexBuffer,indicesTriangles:r,indicesLineList:o}}_convertIndices(t,e){const i=[];for(let n=0;n<e.length;n++)i.push(this._vertexToIndex(t[2*e[n]],t[2*e[n]+1]));return i}_pointArrayToIndices(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];e.push(this._vertexToIndex(n.x,n.y))}return e}}function $l(t,e,i,n=!0){return new jl(i,e).subdividePolygonInternal(t,n)}function Ul(t,e,i=!1){if(!t||t.length<1)return[];if(t.length<2)return[];const n=t[0],r=t[t.length-1],o=i&&(n.x!==r.x||n.y!==r.y);if(e<2)return o?[...t,t[0]]:[...t];const s=Math.floor(M/e),a=[];a.push(new l(t[0].x,t[0].y));const c=t.length,u=o?c:c-1;for(let e=0;e<u;e++){const i=t[e],n=e<c-1?t[e+1]:t[0],r=i.x,o=i.y,u=n.x,h=n.y,p=r!==u,d=o!==h;if(!p&&!d)continue;const f=u-r,m=h-o,g=Math.abs(f),y=Math.abs(m);let _=r,v=o;for(;;){const t=f>0?(Math.floor(_/s)+1)*s:(Math.ceil(_/s)-1)*s,e=m>0?(Math.floor(v/s)+1)*s:(Math.ceil(v/s)-1)*s,i=Math.abs(_-t),n=Math.abs(v-e),r=Math.abs(_-u),o=Math.abs(v-h),c=p?i/g:Number.POSITIVE_INFINITY,x=d?n/y:Number.POSITIVE_INFINITY;if((r<=i||!p)&&(o<=n||!d))break;if(c<x&&p||!d){_=t,v+=m*c;const e=new l(_,Math.round(v));a[a.length-1].x===e.x&&a[a.length-1].y===e.y||a.push(e)}else{_+=f*x,v=e;const t=new l(Math.round(_),v);a[a.length-1].x===t.x&&a[a.length-1].y===t.y||a.push(t)}}const x=new l(u,h);a[a.length-1].x===x.x&&a[a.length-1].y===x.y||a.push(x)}return a}function Vl(t,e,i){if(0===e.length)throw new Error("Subdivision vertex ring is empty.");let n=0,r=t[2*e[0]];for(let i=1;i<e.length;i++){const o=t[2*e[i]];o<r&&(r=o,n=i)}const o=e.length;let s=n,a=(s+1)%o;for(;;){const n=s-1>=0?s-1:o-1,r=(a+1)%o,l=t[2*e[n]],c=t[2*e[r]],u=t[2*e[s]],h=t[2*e[s]+1],p=t[2*e[a]+1];let d=!1;if(l<c)d=!0;else if(l>c)d=!1;else{const i=p-h,o=-(t[2*e[a]]-u),s=h<p?1:-1;((l-u)*i+(t[2*e[n]+1]-h)*o)*s>((c-u)*i+(t[2*e[r]+1]-h)*o)*s&&(d=!0)}if(d){const t=e[n],r=e[s],l=e[a];t!==r&&t!==l&&r!==l&&i.push(l,r,t),s--,s<0&&(s=o-1)}else{const t=e[r],n=e[s],l=e[a];t!==n&&t!==l&&n!==l&&i.push(l,n,t),a++,a>=o&&(a=0)}if(n===r)break}}function Gl(t,e,i,n,r,o,s,a,l){const c=r.length/2,u=s&&a&&l;if(c<qs.MAX_VERTEX_ARRAY_LENGTH){const h=e.prepareSegment(c,i,n),p=h.vertexLength;for(let t=0;t<o.length;t+=3)n.emplaceBack(p+o[t],p+o[t+1],p+o[t+2]);let d,f;h.vertexLength+=c,h.primitiveLength+=o.length/3,u&&(f=s.prepareSegment(c,i,a),d=f.vertexLength,f.vertexLength+=c);for(let e=0;e<r.length;e+=2)t(r[e],r[e+1]);if(u)for(let t=0;t<l.length;t++){const e=l[t];for(let t=1;t<e.length;t+=2)a.emplaceBack(d+e[t-1],d+e[t]);f.primitiveLength+=e.length/2}}else!function(t,e,i,n,r,o){const s=[];for(let t=0;t<n.length/2;t++)s.push(-1);const a={count:0};let l=0,c=t.getOrCreateLatestSegment(e,i),u=c.vertexLength;for(let h=2;h<r.length;h+=3){const p=r[h-2],d=r[h-1],f=r[h];let m=s[p]<l,g=s[d]<l,y=s[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(y?1:0))>qs.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,i),l=a.count,m=!0,g=!0,y=!0,u=0);const _=ql(s,n,o,a,p,m,c),v=ql(s,n,o,a,d,g,c),x=ql(s,n,o,a,f,y,c);i.emplaceBack(u+_-l,u+v-l,u+x-l),c.primitiveLength++}}(e,i,n,r,o,t),u&&function(t,e,i,n,r,o){const s=[];for(let t=0;t<n.length/2;t++)s.push(-1);const a={count:0};let l=0,c=t.getOrCreateLatestSegment(e,i),u=c.vertexLength;for(let h=0;h<r.length;h++){const p=r[h];for(let d=1;d<r[h].length;d+=2){const r=p[d-1],h=p[d];let f=s[r]<l,m=s[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>qs.MAX_VERTEX_ARRAY_LENGTH&&(c=t.createNewSegment(e,i),l=a.count,f=!0,m=!0,u=0);const g=ql(s,n,o,a,r,f,c),y=ql(s,n,o,a,h,m,c);i.emplaceBack(u+g-l,u+y-l),c.primitiveLength++}}}(s,i,a,r,l,t),e.forceNewSegmentOnNextPrepare(),null==s||s.forceNewSegmentOnNextPrepare()}function ql(t,e,i,n,r,o,s){if(o){const o=n.count;return i(e[2*r],e[2*r+1]),t[r]=n.count,n.count++,s.vertexLength++,o}return t[r]}class Zl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ps,this.indexArray=new $s,this.indexArray2=new Us,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new qs,this.segments2=new qs,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=cl("fill",this.layers,e);const n=this.layers[0].layout.get("fill-sort-key"),r=!n.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Sa(s,t);if(!this.layers[0]._featureFilter.filter(new Eo(this.zoom),u,i))continue;const h=r?n.evaluate(u,{},i,e.availableImages):void 0,p={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:t?u.geometry:Ta(s),patterns:{},sortKey:h};o.push(p)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=ul("fill",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{},e.subdivisionGranularity);e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const n of this.patternFeatures)this.addFeature(n,n.geometry,n.index,e,i,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ll),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,r,o){for(const t of Ji(e,500)){const e=$l(t,n,o.fill.getGranularityForZoomLevel(n.z)),i=this.layoutVertexArray;Gl(((t,e)=>{i.emplaceBack(t,e)}),this.segments,this.layoutVertexArray,this.indexArray,e.verticesFlattened,e.indicesTriangles,this.segments2,this.indexArray2,e.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}}let Wl,Hl;ro("FillBucket",Zl,{omit:["layers","patternFeatures"]});var Xl={get paint(){return Hl=Hl||new jo({"fill-antialias":new Ro(yt.paint_fill["fill-antialias"]),"fill-opacity":new Oo(yt.paint_fill["fill-opacity"]),"fill-color":new Oo(yt.paint_fill["fill-color"]),"fill-outline-color":new Oo(yt.paint_fill["fill-outline-color"]),"fill-translate":new Ro(yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ro(yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fo(yt.paint_fill["fill-pattern"])})},get layout(){return Wl=Wl||new jo({"fill-sort-key":new Oo(yt.layout_fill["fill-sort-key"])})}};class Yl extends Uo{constructor(t){super(t,Xl)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Zl(t)}queryRadius(){return ja(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:e,transform:i,pixelsToTileUnits:n}){return ka($a(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-i.bearingInRadians,n),e)}isTileClipped(){return!0}}const Kl=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jl=Zo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ql}=Kl;var tc,ec,ic,nc,rc,oc,sc,ac={};function lc(){if(ec)return tc;ec=1;var t=o();function e(t,e,n,r,o){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=o,t.readFields(i,this,e)}function i(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function n(t){for(var e,i,n=0,r=0,o=t.length,s=o-1;r<o;s=r++)n+=((i=t[s]).x-(e=t[r]).x)*(e.y+i.y);return n}return tc=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var i,n=e.readVarint()+e.pos,r=1,o=0,s=0,a=0,l=[];e.pos<n;){if(o<=0){var c=e.readVarint();r=7&c,o=c>>3}if(o--,1===r||2===r)s+=e.readSVarint(),a+=e.readSVarint(),1===r&&(i&&l.push(i),i=[]),i.push(new t(s,a));else{if(7!==r)throw new Error("unknown command "+r);i&&i.push(i[0].clone())}}return i&&l.push(i),l},e.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=t.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=t.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},e.prototype.toGeoJSON=function(t,i,r){var o,s,a=this.extent*Math.pow(2,r),l=this.extent*t,c=this.extent*i,u=this.loadGeometry(),h=e.types[this.type];function p(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+c)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(o=0;o<u.length;o++)d[o]=u[o][0];p(u=d);break;case 2:for(o=0;o<u.length;o++)p(u[o]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var i,r,o=[],s=0;s<e;s++){var a=n(t[s]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(i&&o.push(i),i=[t[s]]):i.push(t[s]))}return i&&o.push(i),o}(u),o=0;o<u.length;o++)for(s=0;s<u[o].length;s++)p(u[o][s])}1===u.length?u=u[0]:h="Multi"+h;var f={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f},tc}function cc(){if(nc)return ic;nc=1;var t=lc();function e(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(i,this,e),this.length=this._features.length}function i(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}return ic=e,e.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var i=this._pbf.readVarint()+this._pbf.pos;return new t(this._pbf,i,this.extent,this._keys,this._values)},ic}function uc(){return sc||(sc=1,ac.VectorTile=function(){if(oc)return rc;oc=1;var t=cc();function e(e,i,n){if(3===e){var r=new t(n,n.readVarint()+n.pos);r.length&&(i[r.name]=r)}}return rc=function(t,i){this.layers=t.readFields(e,{},i)},rc}(),ac.VectorTileFeature=lc(),ac.VectorTileLayer=cc()),ac}var hc=i(uc());const pc=hc.VectorTileFeature.types,dc=Math.pow(2,13);function fc(t,e,i,n,r,o,s,a){t.emplaceBack(e,i,2*Math.floor(n*dc)+s,r*dc*2,o*dc*2,Math.round(a))}class mc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ls,this.centroidVertexArray=new As,this.indexArray=new $s,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new qs,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.features=[],this.hasPattern=cl("fill-extrusion",this.layers,e);for(const{feature:n,id:r,index:o,sourceLayerIndex:s}of t){const t=this.layers[0]._featureFilter.needGeometry,a=Sa(n,t);if(!this.layers[0]._featureFilter.filter(new Eo(this.zoom),a,i))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:t?a.geometry:Ta(n),properties:n.properties,type:n.type,patterns:{}};this.hasPattern?this.features.push(ul("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,o,i,{},e.subdivisionGranularity),e.featureIndex.insert(n,l.geometry,o,s,this.index,!0)}}addFeatures(t,e,i){for(const n of this.features){const{geometry:r}=n;this.addFeature(n,r,n.index,e,i,t.subdivisionGranularity)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ql),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Jl.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,e,i,n,r,o){for(const i of Ji(e,500)){const e={x:0,y:0,sampleCount:0},r=this.layoutVertexArray.length;this.processPolygon(e,n,t,i,o);const s=this.layoutVertexArray.length-r,a=Math.floor(e.x/e.sampleCount),l=Math.floor(e.y/e.sampleCount);for(let t=0;t<s;t++)this.centroidVertexArray.emplaceBack(a,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}processPolygon(t,e,i,n,r){if(n.length<1)return;if(_c(n[0]))return;for(const e of n)0!==e.length&&gc(t,e);const o={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},s=r.fill.getGranularityForZoomLevel(e.z),a="Polygon"===pc[i.type];for(const t of n){if(0===t.length)continue;if(_c(t))continue;const e=Ul(t,s,a);this._generateSideFaces(e,o)}if(!a)return;const l=$l(n,e,s,!1),c=this.layoutVertexArray;Gl(((t,e)=>{fc(c,t,e,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(t,e){let i=0;for(let n=1;n<t.length;n++){const r=t[n],o=t[n-1];if(yc(r,o))continue;e.segment.vertexLength+4>qs.MAX_VERTEX_ARRAY_LENGTH&&(e.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const s=r.sub(o)._perp()._unit(),a=o.dist(r);i+a>32768&&(i=0),fc(this.layoutVertexArray,r.x,r.y,s.x,s.y,0,0,i),fc(this.layoutVertexArray,r.x,r.y,s.x,s.y,0,1,i),i+=a,fc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,0,i),fc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,1,i);const l=e.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),e.segment.vertexLength+=4,e.segment.primitiveLength+=2}}}function gc(t,e){for(let i=0;i<e.length;i++){const n=e[i];i===e.length-1&&e[0].x===n.x&&e[0].y===n.y||(t.x+=n.x,t.y+=n.y,t.sampleCount++)}}function yc(t,e){return t.x===e.x&&(t.x<0||t.x>M)||t.y===e.y&&(t.y<0||t.y>M)}function _c(t){return t.every((t=>t.x<0))||t.every((t=>t.x>M))||t.every((t=>t.y<0))||t.every((t=>t.y>M))}let vc;ro("FillExtrusionBucket",mc,{omit:["layers","features"]});var xc={get paint(){return vc=vc||new jo({"fill-extrusion-opacity":new Ro(yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Oo(yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ro(yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ro(yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fo(yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Oo(yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Oo(yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ro(yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bc extends Uo{constructor(t){super(t,xc)}createBucket(t){return new mc(t)}queryRadius(){return ja(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:e,featureState:i,geometry:n,transform:r,pixelsToTileUnits:o,pixelPosMatrix:s}){const a=$a(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-r.bearingInRadians,o),c=this.paint.get("fill-extrusion-height").evaluate(e,i),u=this.paint.get("fill-extrusion-base").evaluate(e,i),h=function(t,e,i){const n=[];for(const i of t){const t=[i.x,i.y,0,1];S(t,t,e),n.push(new l(t[0]/t[3],t[1]/t[3]))}return n}(a,s),p=function(t,e,i,n){const r=[],o=[],s=n[8]*e,a=n[9]*e,c=n[10]*e,u=n[11]*e,h=n[8]*i,p=n[9]*i,d=n[10]*i,f=n[11]*i;for(const e of t){const t=[],i=[];for(const r of e){const e=r.x,o=r.y,m=n[0]*e+n[4]*o+n[12],g=n[1]*e+n[5]*o+n[13],y=n[2]*e+n[6]*o+n[14],_=n[3]*e+n[7]*o+n[15],v=y+c,x=_+u,b=m+h,w=g+p,T=y+d,S=_+f,C=new l((m+s)/x,(g+a)/x);C.z=v/x,t.push(C);const E=new l(b/S,w/S);E.z=T/S,i.push(E)}r.push(t),o.push(i)}return[r,o]}(n,u,c,s);return function(t,e,i){let n=1/0;ka(i,e)&&(n=Tc(i,e[0]));for(let r=0;r<e.length;r++){const o=e[r],s=t[r];for(let t=0;t<o.length-1;t++){const e=o[t],r=[e,o[t+1],s[t+1],s[t],e];Ma(i,r)&&(n=Math.min(n,Tc(i,r)))}}return n!==1/0&&n}(p[0],p[1],h)}}function wc(t,e){return t.x*e.x+t.y*e.y}function Tc(t,e){if(1===t.length){let i=0;const n=e[i++];let r;for(;!r||n.equals(r);)if(r=e[i++],!r)return 1/0;for(;i<e.length;i++){const o=e[i],s=t[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=wc(a,a),h=wc(a,l),p=wc(l,l),d=wc(c,a),f=wc(c,l),m=u*p-h*h,g=(p*d-h*f)/m,y=(u*f-h*d)/m,_=n.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}const Sc=Zo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cc}=Sc,Ec=Zo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ic}=Ec,Mc=hc.VectorTileFeature.types,Ac=Math.cos(Math.PI/180*37.5),kc=Math.pow(2,14)/.5;class Pc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new zs,this.layoutVertexArray2=new Ds,this.indexArray=new $s,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new qs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(t,e,i){this.hasPattern=cl("line",this.layers,e);const n=this.layers[0].layout.get("line-sort-key"),r=!n.isConstant(),o=[];for(const{feature:e,id:s,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Sa(e,t);if(!this.layers[0]._featureFilter.filter(new Eo(this.zoom),c,i))continue;const u=r?n.evaluate(c,{},i):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?c.geometry:Ta(e),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const t=ul("line",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,r,o,i,{},e.subdivisionGranularity);e.featureIndex.insert(t[o].feature,r,o,s,this.index)}}update(t,e,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,i)}addFeatures(t,e,i){for(const n of this.patternFeatures)this.addFeature(n,n.geometry,n.index,e,i,t.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ic)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,r,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(t,{}),l=s.get("line-cap"),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,a,l,c,u,n,o);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,r,n)}addLine(t,e,i,n,r,o,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Ul(t,s?a.line.getGranularityForZoomLevel(s.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===Mc[e.type];let c=t.length;for(;c>=2&&t[c-1].equals(t[c-2]);)c--;let u=0;for(;u<c-1&&t[u].equals(t[u+1]);)u++;if(c<(l?3:2))return;"bevel"===i&&(r=1.05);const h=this.overscaling<=16?15*M/(512*this.overscaling):0,p=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let d,f,m,g,y;this.e1=this.e2=-1,l&&(d=t[c-2],y=t[u].sub(d)._unit()._perp());for(let e=u;e<c;e++){if(m=e===c-1?l?t[u+1]:void 0:t[e+1],m&&t[e].equals(m))continue;y&&(g=y),d&&(f=d),d=t[e],y=m?m.sub(d)._unit()._perp():g,g=g||y;let s=g.add(y);0===s.x&&0===s.y||s._unit();const a=g.x*y.x+g.y*y.y,_=s.x*y.x+s.y*y.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Ac&&f&&m,w=g.x*y.y-g.y*y.x>0;if(b&&e>u){const t=d.dist(f);if(t>2*h){const e=d.sub(d.sub(f)._mult(h/t)._round());this.updateDistance(f,e),this.addCurrentVertex(e,g,0,0,p),f=e}}const T=f&&m;let S=T?i:l?"butt":n;if(T&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),f&&this.updateDistance(f,d),"miter"===S)s._mult(v),this.addCurrentVertex(d,s,0,0,p);else if("flipbevel"===S){if(v>100)s=y.mult(-1);else{const t=v*g.add(y).mag()/g.sub(y).mag();s._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(d,s,0,0,p),this.addCurrentVertex(d,s.mult(-1),0,0,p)}else if("bevel"===S||"fakeround"===S){const t=-Math.sqrt(v*v-1),e=w?t:0,i=w?0:t;if(f&&this.addCurrentVertex(d,g,e,i,p),"fakeround"===S){const t=Math.round(180*x/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*t*t+(.848013+a*(.215638*a-1.06021)))}const n=y.sub(g)._mult(i)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(d,n.x,n.y,!1,w,0,p)}}m&&this.addCurrentVertex(d,y,-e,-i,p)}else if("butt"===S)this.addCurrentVertex(d,s,0,0,p);else if("square"===S){const t=f?1:-1;this.addCurrentVertex(d,s,t,t,p)}else"round"===S&&(f&&(this.addCurrentVertex(d,g,0,0,p),this.addCurrentVertex(d,g,1,1,p,!0)),m&&(this.addCurrentVertex(d,y,-1,-1,p,!0),this.addCurrentVertex(d,y,0,0,p)));if(b&&e<c-1){const t=d.dist(m);if(t>2*h){const e=d.add(m.sub(d)._mult(h/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,y,0,0,p),d=e}}}}addCurrentVertex(t,e,i,n,r,o=!1){const s=e.y*n-e.x,a=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*i,e.y-e.x*i,o,!1,i,r),this.addHalfVertex(t,s,a,o,!0,-n,r),this.distance>kc/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,i,n,r,o))}addHalfVertex({x:t,y:e},i,n,r,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(kc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(r?1:0),(e<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,c,this.e2),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}let Lc,zc;ro("LineBucket",Pc,{omit:["layers","patternFeatures"]});var Dc={get paint(){return zc=zc||new jo({"line-opacity":new Oo(yt.paint_line["line-opacity"]),"line-color":new Oo(yt.paint_line["line-color"]),"line-translate":new Ro(yt.paint_line["line-translate"]),"line-translate-anchor":new Ro(yt.paint_line["line-translate-anchor"]),"line-width":new Oo(yt.paint_line["line-width"]),"line-gap-width":new Oo(yt.paint_line["line-gap-width"]),"line-offset":new Oo(yt.paint_line["line-offset"]),"line-blur":new Oo(yt.paint_line["line-blur"]),"line-dasharray":new No(yt.paint_line["line-dasharray"]),"line-pattern":new Fo(yt.paint_line["line-pattern"]),"line-gradient":new Bo(yt.paint_line["line-gradient"])})},get layout(){return Lc=Lc||new jo({"line-cap":new Ro(yt.layout_line["line-cap"]),"line-join":new Oo(yt.layout_line["line-join"]),"line-miter-limit":new Ro(yt.layout_line["line-miter-limit"]),"line-round-limit":new Ro(yt.layout_line["line-round-limit"]),"line-sort-key":new Oo(yt.layout_line["line-sort-key"])})}};class Rc extends Oo{possiblyEvaluate(t,e){return e=new Eo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=F({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}let Oc;class Fc extends Uo{constructor(t){super(t,Dc),this.gradientVersion=0,Oc||(Oc=new Rc(Dc.paint.properties["line-width"].specification),Oc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this.gradientExpression();this.stepInterpolant=!!function(t){return void 0!==t._styleExpression}(t)&&t._styleExpression.expression instanceof oi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Oc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Pc(t)}queryRadius(t){const e=t,i=Nc(Ba("line-width",this,e),Ba("line-gap-width",this,e)),n=Ba("line-offset",this,e);return i/2+Math.abs(n)+ja(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:e,featureState:i,geometry:n,transform:r,pixelsToTileUnits:o}){const s=$a(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-r.bearingInRadians,o),a=o/2*Nc(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),c=this.paint.get("line-offset").evaluate(e,i);return c&&(n=function(t,e){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=[];for(let t=0;t<r.length;t++){const i=r[t-1],n=r[t],s=r[t+1],a=0===t?new l(0,0):n.sub(i)._unit()._perp(),c=t===r.length-1?new l(0,0):s.sub(n)._unit()._perp(),u=a._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),o.push(u._mult(e)._add(n))}i.push(o)}return i}(n,c*o)),function(t,e,i){for(let n=0;n<e.length;n++){const r=e[n];if(t.length>=3)for(let e=0;e<r.length;e++)if(Fa(t,r[e]))return!0;if(Pa(t,r,i))return!0}return!1}(s,n,a)}isTileClipped(){return!0}}function Nc(t,e){return e>0?e+2*t:t}const Bc=Zo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jc=Zo([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $c=Zo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Zo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uc=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vc=Zo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gc(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Co.applyArabicShaping&&(t=Co.applyArabicShaping(t)),t}(t.text,e,i)})),t}Zo([{name:"triangle",components:3,type:"Uint16"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zo([{type:"Float32",name:"offsetX"}]),Zo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Zc,Wc,Hc,Xc=24,Yc={};function Kc(){return Zc||(Zc=1,Yc.read=function(t,e,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,p=i?-1:1,d=t[e+h];for(h+=p,o=d&(1<<-u)-1,d>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=p,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+t[e+h],h+=p,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),o-=c}return(d?-1:1)*s*Math.pow(2,o-n)},Yc.write=function(t,e,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,f=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),(e+=s+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*l-1)*Math.pow(2,r),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[i+d]=255&a,d+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[i+d]=255&s,d+=f,s/=256,c-=8);t[i+d-f]|=128*m}),Yc}function Jc(){if(Hc)return Wc;Hc=1,Wc=e;var t=Kc();function e(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,n=1/i,r="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function o(t){return t.type===e.Bytes?t.readVarint()+t.pos:t.pos+1}function s(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function a(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function l(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function g(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function _(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function v(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,t(r,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=v(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=y(this.buf,this.pos)+y(this.buf,this.pos+4)*i;return this.pos+=8,t},readSFixed64:function(){var t=y(this.buf,this.pos)+v(this.buf,this.pos+4)*i;return this.pos+=8,t},readFloat:function(){var e=t.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=t.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return s(t,n,e);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return s(t,n,e);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return s(t,n,e);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return s(t,n,e);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return s(t,n,e);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return s(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&r?function(t,e,i){return r.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",r=e;r<i;){var o,s,a,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=t[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=t[r+2],a=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,i){if(this.type!==e.Bytes)return t.push(this.readVarint(i));var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){if(this.type!==e.Bytes)return t.push(this.readSVarint());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==e.Bytes)return t.push(this.readBoolean());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==e.Bytes)return t.push(this.readFloat());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==e.Bytes)return t.push(this.readDouble());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed32());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed32());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readFixed64());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==e.Bytes)return t.push(this.readSFixed64());var i=o(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===e.Varint)for(;this.buf[this.pos++]>127;);else if(i===e.Bytes)this.pos=this.readVarint()+this.pos;else if(i===e.Fixed32)this.pos+=4;else{if(i!==e.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),_(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),_(this.buf,-1&t,this.pos),_(this.buf,Math.floor(t*n),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,r,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):r=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(t[i++]=239,t[i++]=191,t[i++]=189,r=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&a(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),t.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),t.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&a(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,i,n){this.writeTag(t,e.Bytes),this.writeRawMessage(i,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writeBytesField:function(t,i){this.writeTag(t,e.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,e.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,e.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,e.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,e.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,e.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,e.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}},Wc}var Qc=i(Jc());const tu=3;function eu(t,e,i){1===t&&i.readMessage(iu,e)}function iu(t,e,i){if(3===t){const{id:t,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(nu,{});e.push({id:t,bitmap:new Qa({width:r+2*tu,height:o+2*tu},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}}function nu(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const ru=tu;function ou(t){let e=0,i=0;for(const n of t)e+=n.w*n.h,i=Math.max(i,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let r=0,o=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const i=n[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,o=Math.max(o,e.y+e.h),r=Math.max(r,e.x+e.w),e.w===i.w&&e.h===i.h){const e=n.pop();t<n.length&&(n[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(n.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}const su=1;class au{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:r,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+su,this.paddedRect.y+su]}get br(){return[this.paddedRect.x+this.paddedRect.w-su,this.paddedRect.y+this.paddedRect.h-su]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*su)/this.pixelRatio,(this.paddedRect.h-2*su)/this.pixelRatio]}}class lu{constructor(t,e){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,i,r),this.addImages(e,n,r);const{w:o,h:s}=ou(r),a=new tl({width:o||1,height:s||1});for(const e in t){const n=t[e],r=i[e].paddedRect;tl.copy(n.data,a,{x:0,y:0},{x:r.x+su,y:r.y+su},n.data)}for(const t in e){const i=e[t],r=n[t].paddedRect,o=r.x+su,s=r.y+su,l=i.data.width,c=i.data.height;tl.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),tl.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),tl.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),tl.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),tl.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(t,e,i){for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*su,h:r.data.height+2*su};i.push(o),e[n]=new au(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in t.updatedImages)this.patchUpdatedImage(this.iconPositions[i],t.getImage(i),e),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,r]=t.tl;i.update(e.data,void 0,{x:n,y:r})}}var cu;ro("ImagePosition",au),ro("ImageAtlas",lu),t.al=void 0,(cu=t.al||(t.al={}))[cu.none=0]="none",cu[cu.horizontal=1]="horizontal",cu[cu.vertical=2]="vertical",cu[cu.horizontalOnly=3]="horizontalOnly";const uu=-17;class hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,e,i){const n=new hu;return n.scale=t||1,n.fontStack=e,n.verticalAlign=i||"bottom",n}static forImage(t,e){const i=new hu;return i.imageName=t,i.verticalAlign=e||"bottom",i}}class pu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new pu;for(let n=0;n<t.sections.length;n++){const r=t.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let e="";for(let i=0;i<t.length;i++){const n=t.charCodeAt(i+1)||null,r=t.charCodeAt(i-1)||null;e+=n&&xo(n)&&!qc[t[i+1]]||r&&xo(r)&&!qc[t[i-1]]||!qc[t[i]]?t[i]:qc[t[i]]}return e}(this.text)}trim(){let t=0;for(let e=0;e<this.text.length&&fu[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&fu[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new pu;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}getMaxImageSize(t){let e=0,i=0;for(let n=0;n<this.length();n++){const r=this.getSection(n);if(r.imageName){const n=t[r.imageName];if(!n)continue;const o=n.displaySize;e=Math.max(e,o[0]),i=Math.max(i,o[1])}}return{maxImageWidth:e,maxImageHeight:i}}addTextSection(t,e){this.text+=t.text,this.sections.push(hu.forText(t.scale,t.fontStack||e,t.verticalAlign));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void V("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(hu.forImage(e,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function du(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m){const g=pu.fromFeature(e,o);let y;p===t.al.vertical&&g.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:v}=Co;if(_&&1===g.sections.length){y=[];const t=_(g.toString(),wu(g,u,s,i,r,f));for(const e of t){const t=new pu;t.text=e,t.sections=g.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);y.push(t)}}else if(v){y=[];const t=v(g.text,g.sectionIndex,wu(g,u,s,i,r,f));for(const e of t){const t=new pu;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,y.push(t)}}else y=function(t,e){const i=[],n=t.text;let r=0;for(const n of e)i.push(t.substring(r,n)),r=n;return r<n.length&&i.push(t.substring(r,n.length)),i}(g,wu(g,u,s,i,r,f));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:p,iconsInText:!1,verticalizable:!1};return function(t,e,i,n,r,o,s,a,l,c,u,h){let p=0,d=0,f=0,m=0;const g="right"===a?1:"left"===a?0:.5,y=Xc/h;let _=0;for(const s of r){s.trim();const r=s.getMaxScale(),a={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=a;const h=a.positionedGlyphs;let v=0;if(!s.length()){d+=o,++_;continue}const x=Su(n,s,y);for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o),g=Eu(l,u,m);let _;if(a.imageName){if(t.iconsInText=!0,a.scale=a.scale*y,_=Mu(a,g,r,x,n),!_)continue;v=Math.max(v,_.imageOffset)}else if(_=Iu(a,m,g,x,e,i),!_)continue;const{rect:b,metrics:w,baselineOffset:T}=_;h.push({glyph:m,imageName:a.imageName,x:p,y:d+T+uu,vertical:g,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:w,rect:b}),g?(t.verticalizable=!0,p+=(a.imageName?w.advance:Xc)*a.scale+c):p+=w.advance*a.scale+c}0!==h.length&&(f=Math.max(p-c,f),Au(h,0,h.length-1,g)),p=0,a.lineOffset=Math.max(v,(r-1)*Xc);const b=o*r+v;d+=b,m=Math.max(b,m),++_}const{horizontalAlign:v,verticalAlign:x}=Tu(s);(function(t,e,i,n,r,o,s,a,l){const c=(e-i)*r;let u=0;u=o!==s?-a*n-uu:-n*l*s+.5*s;for(const e of t)for(const t of e.positionedGlyphs)t.x+=c,t.y+=u})(t.positionedLines,g,v,x,f,m,o,d,r.length),t.top+=-x*d,t.bottom=t.top+d,t.left+=-v*f,t.right=t.left+f}(b,i,n,r,y,a,l,c,p,u,d,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(x)&&b}const fu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},gu={40:!0};function yu(t,e,i,n,r,o){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*Xc/o+r:0}{const n=i[e.fontStack],o=n&&n[t];return o?o.metrics.advance*e.scale+r:0}}function _u(t,e,i,n){const r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function vu(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function xu(t,e,i,n,r,o){let s=null,a=_u(e,i,r,o);for(const t of n){const n=_u(e-t.x,i,r,o)+t.badness;n<=a&&(s=t,a=n)}return{index:t,x:e,priorBreak:s,badness:a}}function bu(t){return t?bu(t.priorBreak).concat(t.index):[]}function wu(t,e,i,n,r,o){if(!t)return[];const s=[],a=function(t,e,i,n,r,o){let s=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);s+=yu(t.getCharCode(i),a,n,r,e,o)}return s/Math.max(1,Math.ceil(s/i))}(t,e,i,n,r,o),l=t.text.indexOf("​")>=0;let c=0;for(let i=0;i<t.length();i++){const h=t.getSection(i),p=t.getCharCode(i);if(fu[p]||(c+=yu(p,h,n,r,e,o)),i<t.length()-1){const e=!((u=p)<11904)&&(!!ho["CJK Compatibility Forms"](u)||!!ho["CJK Compatibility"](u)||!!ho["CJK Strokes"](u)||!!ho["CJK Symbols and Punctuation"](u)||!!ho["Enclosed CJK Letters and Months"](u)||!!ho["Halfwidth and Fullwidth Forms"](u)||!!ho["Ideographic Description Characters"](u)||!!ho["Vertical Forms"](u)||_o.test(String.fromCodePoint(u)));(mu[p]||e||h.imageName||i!==t.length()-2&&gu[t.getCharCode(i+1)])&&s.push(xu(i+1,c,a,s,vu(p,t.getCharCode(i+1),e&&l),!1))}}var u;return bu(xu(t.length(),c,a,s,0,!0))}function Tu(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Su(t,e,i){const n=e.getMaxScale()*Xc,{maxImageWidth:r,maxImageHeight:o}=e.getMaxImageSize(t),s=Math.max(n,o*i);return{verticalLineContentWidth:Math.max(n,r*i),horizontalLineContentHeight:s}}function Cu(t){switch(t){case"top":return 0;case"center":return.5;default:return 1}}function Eu(e,i,n){return!(e===t.al.horizontal||!i&&!vo(n)||i&&(fu[n]||(r=n,/\p{sc=Arab}/u.test(String.fromCodePoint(r)))));var r}function Iu(t,e,i,n,r,o){const s=o[t.fontStack],a=function(t,e,i,n){if(t&&t.rect)return t;const r=e[i.fontStack],o=r&&r[n];return o?{rect:null,metrics:o.metrics}:null}(s&&s[e],r,t,e);if(null===a)return null;let l;if(i)l=n.verticalLineContentWidth-t.scale*Xc;else{const e=Cu(t.verticalAlign);l=(n.horizontalLineContentHeight-t.scale*Xc)*e}return{rect:a.rect,metrics:a.metrics,baselineOffset:l}}function Mu(t,e,i,n,r){const o=r[t.imageName];if(!o)return null;const s=o.paddedRect,a=o.displaySize,l={width:a[0],height:a[1],left:su,top:-3,advance:e?a[1]:a[0]};let c;if(e)c=n.verticalLineContentWidth-a[1]*t.scale;else{const e=Cu(t.verticalAlign);c=(n.horizontalLineContentHeight-a[1]*t.scale)*e}return{rect:s,metrics:l,baselineOffset:c,imageOffset:(e?a[0]:a[1])*t.scale-Xc*i}}function Au(t,e,i,n){if(0===n)return;const r=t[i],o=(t[i].x+r.metrics.advance*r.scale)*n;for(let n=e;n<=i;n++)t[n].x-=o}function ku(t,e,i){const{horizontalAlign:n,verticalAlign:r}=Tu(i),o=e[0]-t.displaySize[0]*n,s=e[1]-t.displaySize[1]*r;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function Pu(t){var e,i;let n=t.left,r=t.top,o=t.right-n,s=t.bottom-r;const a=null!==(e=t.image.textFitWidth)&&void 0!==e?e:"stretchOrShrink",l=null!==(i=t.image.textFitHeight)&&void 0!==i?i:"stretchOrShrink",c=(t.image.content[2]-t.image.content[0])/(t.image.content[3]-t.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const t=Math.ceil(s*c);n*=t/o,o=t}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const t=Math.ceil(o/c);r*=t/s,s=t}return{x1:n,y1:r,x2:n+o,y2:r+s}}function Lu(t,e,i,n,r,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const l=e.left*o,c=e.right*o;let u,h,p,d;"width"===i||"both"===i?(d=r[0]+l-n[3],h=r[0]+c+n[1]):(d=r[0]+(l+c-s.displaySize[0])/2,h=d+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],p=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,p=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:p,left:d,collisionPadding:a}}const zu=255,Du=128,Ru=zu*Du;function Ou(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Eo(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let r=0;for(;r<e.length&&e[r]<=t;)r++;r=Math.max(0,r-1);let o=r;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[r],a=e[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Eo(s)),maxSize:i.evaluate(new Eo(a)),interpolationType:n}}}function Fu(t,e,i){let n="never";const r=t.get(e);return r?n=r:t.get(i)&&(n="always"),n}const Nu=hc.VectorTileFeature.types,Bu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ju(t,e,i,n,r,o,s,a,l,c,u,h,p){const d=a?Math.min(Ru,Math.round(a[0])):0,f=a?Math.min(Ru,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*r),o,s,(d<<1)+(l?1:0),f,16*c,16*u,256*h,256*p)}function $u(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function Uu(t){for(const e of t.sections)if(So(e.text))return!0;return!1}class Vu{constructor(t){this.layoutVertexArray=new Os,this.indexArray=new $s,this.programConfigurations=t,this.segments=new qs,this.dynamicLayoutVertexArray=new Fs,this.opacityVertexArray=new Ns,this.hasVisibleVertices=!1,this.placedSymbolArray=new xs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,jc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Bu,!0),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ro("SymbolBuffers",Vu);class Gu{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new qs,this.collisionVertexArray=new js}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$c.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ro("CollisionBuffers",Gu);class qu{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ou(this.zoom,i["text-size"]),this.iconSizeData=Ou(this.zoom,i["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),o=n.get("symbol-z-order");this.canOverlap="never"!==Fu(n,"text-overlap","text-allow-overlap")||"never"!==Fu(n,"icon-overlap","icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((e=>t.al[e]))),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Vu(new _a(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Vu(new _a(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Ts,this.lineVertexArray=new Ss,this.symbolInstances=new ws,this.textAnchorOffsets=new Es}calculateGlyphDependencies(t,e,i,n,r){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(i||n)&&r){const i=qc[t.charAt(o)];i&&(e[i.charCodeAt(0)]=!0)}}populate(e,i,n){const r=this.layers[0],o=r.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Ae&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const p=i.iconDependencies,d=i.glyphDependencies,f=i.availableImages,m=new Eo(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:g}of e){const e=r._featureFilter.needGeometry,y=Sa(i,e);if(!r._featureFilter.filter(m,y,n))continue;let _,v;if(e||(y.geometry=Ta(i)),c){const t=r.getValueAndResolveTokens("text-field",y,n,f),e=Ae.factory(t),i=this.hasRTLText=this.hasRTLText||Uu(e);(!i||"unavailable"===Co.getRTLTextPluginStatus()||i&&Co.isParsed())&&(_=Gc(e,r,y))}if(u){const t=r.getValueAndResolveTokens("icon-image",y,n,f);v=t instanceof Oe?t:Oe.fromString(t)}if(!_&&!v)continue;const x=this.sortFeaturesByKey?h.evaluate(y,{},n):void 0;if(this.features.push({id:a,text:_,icon:v,index:l,sourceLayerIndex:g,geometry:y.geometry,properties:i.properties,type:Nu[i.type],sortKey:x}),v&&(p[v.name]=!0),_){const e=s.evaluate(y,{},n).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(t.al.vertical)>=0;for(const t of _.sections)if(t.image)p[t.image.name]=!0;else{const n=po(_.toString()),r=t.fontStack||e,o=d[r]=d[r]||{};this.calculateGlyphDependencies(t.text,o,i,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let r=0;function o(e){n.push(t[e]),r++}function s(t,e,r){const o=i[t];return delete i[t],i[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(t,i,r){const o=e[i];return delete e[i],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],h=u.geometry,p=u.text?u.text.toString():null;if(!p){o(c);continue}const d=l(p,h),f=l(p,h,!0);if(d in i&&f in e&&i[d]!==e[f]){const t=a(d,f,h),r=s(d,f,n[t].geometry);delete e[d],delete i[f],i[l(p,n[r].geometry,!0)]=r,n[t].geometry=null}else d in i?s(d,f,h):f in e?a(d,f,h):(o(c),e[d]=r-1,i[f]=r-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,i),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment){let i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]);const r={};for(let n=t.segment+1;n<e.length;n++)r[n]={x:e[n].x,y:e[n].y,tileUnitDistanceFromAnchor:i},n<e.length-1&&(i+=e[n+1].dist(e[n]));for(let i=t.segment||0;i>=0;i--)r[i]={x:e[i].x,y:e[i].y,tileUnitDistanceFromAnchor:n},i>0&&(n+=e[i-1].dist(e[i]));for(let t=0;t<e.length;t++){const e=r[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,i,n,r,o,s,a,l,c,u,h,p){const d=e.indexArray,f=e.layoutVertexArray,m=e.segments.prepareSegment(4*i.length,f,d,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&a===t.al.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let t=0;t<i.length;t++){const{tl:r,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:T}=i[t],S=m.vertexLength,C=b[1];ju(f,l.x,l.y,r.x,C+r.y,u.x,u.y,n,w,h.x,h.y,y,x),ju(f,l.x,l.y,o.x,C+o.y,u.x+u.w,u.y,n,w,g.x,h.y,y,x),ju(f,l.x,l.y,a.x,C+a.y,u.x,u.y+u.h,n,w,h.x,g.y,y,x),ju(f,l.x,l.y,c.x,C+c.y,u.x+u.w,u.y+u.h,n,w,g.x,g.y,y,x),$u(e.dynamicLayoutVertexArray,l,_),d.emplaceBack(S,S+2,S+1),d.emplaceBack(S+1,S+2,S+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),t!==i.length-1&&T===i[t+1].sectionIndex||e.programConfigurations.populatePaintArrays(f.length,s,s.index,{},p,v&&v[T])}e.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,h)}_addCollisionDebugVertex(t,e,i,n,r,o){return e.emplaceBack(0,0),t.emplaceBack(i.x,i.y,n,r,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(t,e,i,n,r,o,s){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=a.vertexLength,u=r.layoutVertexArray,h=r.collisionVertexArray,p=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(u,h,o,p,d,new l(t,e)),this._addCollisionDebugVertex(u,h,o,p,d,new l(i,e)),this._addCollisionDebugVertex(u,h,o,p,d,new l(i,n)),this._addCollisionDebugVertex(u,h,o,p,d,new l(t,n)),a.vertexLength+=4;const f=r.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),a.primitiveLength+=4}addDebugCollisionBoxes(t,e,i,n){for(let r=t;r<e;r++){const t=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(t.x1,t.y1,t.x2,t.y2,n?this.textCollisionBox:this.iconCollisionBox,t.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gu(Bs,Uc.members,Us),this.iconCollisionBox=new Gu(Bs,Uc.members,Us);for(let t=0;t<this.symbolInstances.length;t++){const e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}}_deserializeCollisionBoxesForSymbol(t,e,i,n,r,o,s,a,l){const c={};for(let n=e;n<i;n++){const e=t.get(n);c.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY},c.textFeatureIndex=e.featureIndex;break}for(let e=n;e<r;e++){const i=t.get(e);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let e=o;e<s;e++){const i=t.get(e);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let e=a;e<l;e++){const i=t.get(e);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+2,e+1),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],r=[],o=[];for(let t=0;t<this.symbolInstances.length;++t){o.push(t);const s=this.symbolInstances.get(t);n.push(0|Math.round(e*s.anchorX+i*s.anchorY)),r.push(s.featureIndex)}return o.sort(((t,e)=>n[t]-n[e]||r[e]-r[t])),o}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach(((t,e,i)=>{t>=0&&i.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)})),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Zu,Wu;ro("SymbolBucket",qu,{omit:["layers","collisionBoxArray","features","compareText"]}),qu.MAX_GLYPHS=65535,qu.addDynamicAttributes=$u;var Hu={get paint(){return Wu=Wu||new jo({"icon-opacity":new Oo(yt.paint_symbol["icon-opacity"]),"icon-color":new Oo(yt.paint_symbol["icon-color"]),"icon-halo-color":new Oo(yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Oo(yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Oo(yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ro(yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ro(yt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Oo(yt.paint_symbol["text-opacity"]),"text-color":new Oo(yt.paint_symbol["text-color"],{runtimeType:Ft,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Oo(yt.paint_symbol["text-halo-color"]),"text-halo-width":new Oo(yt.paint_symbol["text-halo-width"]),"text-halo-blur":new Oo(yt.paint_symbol["text-halo-blur"]),"text-translate":new Ro(yt.paint_symbol["text-translate"]),"text-translate-anchor":new Ro(yt.paint_symbol["text-translate-anchor"])})},get layout(){return Zu=Zu||new jo({"symbol-placement":new Ro(yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ro(yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ro(yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Oo(yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ro(yt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ro(yt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ro(yt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ro(yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ro(yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ro(yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Oo(yt.layout_symbol["icon-size"]),"icon-text-fit":new Ro(yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ro(yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Oo(yt.layout_symbol["icon-image"]),"icon-rotate":new Oo(yt.layout_symbol["icon-rotate"]),"icon-padding":new Oo(yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ro(yt.layout_symbol["icon-keep-upright"]),"icon-offset":new Oo(yt.layout_symbol["icon-offset"]),"icon-anchor":new Oo(yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ro(yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ro(yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ro(yt.layout_symbol["text-rotation-alignment"]),"text-field":new Oo(yt.layout_symbol["text-field"]),"text-font":new Oo(yt.layout_symbol["text-font"]),"text-size":new Oo(yt.layout_symbol["text-size"]),"text-max-width":new Oo(yt.layout_symbol["text-max-width"]),"text-line-height":new Ro(yt.layout_symbol["text-line-height"]),"text-letter-spacing":new Oo(yt.layout_symbol["text-letter-spacing"]),"text-justify":new Oo(yt.layout_symbol["text-justify"]),"text-radial-offset":new Oo(yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ro(yt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Oo(yt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Oo(yt.layout_symbol["text-anchor"]),"text-max-angle":new Ro(yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ro(yt.layout_symbol["text-writing-mode"]),"text-rotate":new Oo(yt.layout_symbol["text-rotate"]),"text-padding":new Ro(yt.layout_symbol["text-padding"]),"text-keep-upright":new Ro(yt.layout_symbol["text-keep-upright"]),"text-transform":new Oo(yt.layout_symbol["text-transform"]),"text-offset":new Oo(yt.layout_symbol["text-offset"]),"text-allow-overlap":new Ro(yt.layout_symbol["text-allow-overlap"]),"text-overlap":new Ro(yt.layout_symbol["text-overlap"]),"text-ignore-placement":new Ro(yt.layout_symbol["text-ignore-placement"]),"text-optional":new Ro(yt.layout_symbol["text-optional"])})}};class Xu{constructor(t){if(void 0===t.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:zt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ro("FormatSectionOverride",Xu,{omit:["defaultValue"]});class Yu extends Uo{constructor(t){super(t,Hu)}recalculate(t,e){if(super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const t=this.layout.get("text-writing-mode");if(t){const e=[];for(const i of t)e.indexOf(i)<0&&e.push(i);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,e,i,n){const r=this.layout.get(t).evaluate(e,{},i,n),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||tr(o.value)||!r?r:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>t&&i in t?String(t[i]):""))}(e.properties,r)}createBucket(t){return new qu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Hu.paint.overridableProperties){if(!Yu.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new Xu(e),n=new Qn(i,e.property.specification);let r=null;r="constant"===e.value.kind||"source"===e.value.kind?new ir("source",n):new nr("composite",n,e.value.zoomStops),this.paint._values[t]=new zo(e.property,r,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&Yu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=Hu.paint.properties[e];let r=!1;const o=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof Ae)o(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{r||(e instanceof Ue&&je(e.value)===Ut?o(e.value.sections):e instanceof Ei?o(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return r}}let Ku;var Ju={get paint(){return Ku=Ku||new jo({"background-color":new Ro(yt.paint_background["background-color"]),"background-pattern":new No(yt.paint_background["background-pattern"]),"background-opacity":new Ro(yt.paint_background["background-opacity"])})}};class Qu extends Uo{constructor(t){super(t,Ju)}}let th;var eh={get paint(){return th=th||new jo({"raster-opacity":new Ro(yt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ro(yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ro(yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ro(yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ro(yt.paint_raster["raster-saturation"]),"raster-contrast":new Ro(yt.paint_raster["raster-contrast"]),"raster-resampling":new Ro(yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ro(yt.paint_raster["raster-fade-duration"])})}};class ih extends Uo{constructor(t){super(t,eh)}}class nh extends Uo{constructor(t){super(t,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rh{constructor(t){this._methodToThrottle=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const oh={once:!0},sh=6371008.8;class ah{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ah(O(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return sh*Math.acos(Math.min(r,1))}static convert(t){if(t instanceof ah)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new ah(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new ah(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lh=2*Math.PI*sh;function ch(t){return lh*Math.cos(t*Math.PI/180)}function uh(t){return(180+t)/360}function hh(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ph(t,e){return t/ch(e)}function dh(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function fh(t,e){return t*ch(dh(e))}class mh{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=ah.convert(t);return new mh(uh(i.lng),hh(i.lat),ph(e,i.lat))}toLngLat(){return new ah(360*this.x-180,dh(this.y))}toAltitude(){return fh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lh*(t=dh(this.y),1/Math.cos(t*Math.PI/180));var t}}function gh(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class yh{constructor(t,e,i){if(!function(t,e,i){return!(t<0||t>25||i<0||i>=Math.pow(2,t)||e<0||e>=Math.pow(2,t))}(t,e,i))throw new Error(`x=${e}, y=${i}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=e,this.y=i,this.key=xh(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e,i){const n=(o=this.y,s=this.z,a=gh(256*(r=this.x),256*(o=Math.pow(2,s)-o-1),s),l=gh(256*(r+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,o,s,a,l;const c=function(t,e,i){let n,r="";for(let o=t;o>0;o--)n=1<<o-1,r+=(e&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,e>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,n)}isChildOf(t){const e=this.z-t.z;return e>0&&t.x===this.x>>e&&t.y===this.y>>e}getTilePoint(t){const e=Math.pow(2,this.z);return new l((t.x*e-this.x)*M,(t.y*e-this.y)*M)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _h{constructor(t,e){this.wrap=t,this.canonical=e,this.key=xh(t,e.z,e.z,e.x,e.y)}}class vh{constructor(t,e,i,n,r){if(this.terrainRttPosMatrix32f=null,t<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${i}`);this.overscaledZ=t,this.wrap=e,this.canonical=new yh(i,+n,+r),this.key=xh(e,t,i,n,r)}clone(){return new vh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const e=this.canonical.z-t;return t>this.canonical.z?new vh(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vh(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?xh(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):xh(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new vh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new vh(e,this.wrap,e,i,n),new vh(e,this.wrap,e,i+1,n),new vh(e,this.wrap,e,i,n+1),new vh(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new vh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new vh(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _h(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new mh(t.x-this.wrap,t.y))}}function xh(t,e,i,n,r){(t*=2)<0&&(t=-1*t-1);const o=1<<i;return(o*o*t+o*r+n).toString(36)+i.toString(36)+e.toString(36)}ro("CanonicalTileID",yh),ro("OverscaledTileID",vh,{omit:["terrainRttPosMatrix32f"]});class bh{constructor(t,e,i,n=1,r=1,o=1,s=0){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void V(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=e.height;const a=this.dim=e.height-2;switch(this.data=new Uint32Array(e.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=n,this.greenFactor=r,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let t=0;t<a;t++)this.data[this._idx(-1,t)]=this.data[this._idx(0,t)],this.data[this._idx(a,t)]=this.data[this._idx(a-1,t)],this.data[this._idx(t,-1)]=this.data[this._idx(t,0)],this.data[this._idx(t,a)]=this.data[this._idx(t,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let t=0;t<a;t++)for(let e=0;e<a;e++){const i=this.get(t,e);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(t,e){const i=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return this.unpack(i[n],i[n+1],i[n+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}unpack(t,e,i){return t*this.redFactor+e*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new tl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,r=e*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(e){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,l=-i*this.dim;for(let e=o;e<s;e++)for(let i=n;i<r;i++)this.data[this._idx(i,e)]=t.data[this._idx(i+a,e+l)]}}ro("DEMData",bh);class wh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Th{constructor(t,e,i,n,r){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t}}class Sh{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new io(M,16,0),this.grid3D=new io(M,16,0),this.featureIndexArray=new Ms,this.promoteId=e}insert(t,e,i,n,r,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r);const a=o?this.grid3D:this.grid;for(let t=0;t<e.length;t++){const i=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y)}n[0]<M&&n[1]<M&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hc.VectorTile(new Qc(this.rawTileData)).layers,this.sourceLayerCoder=new wh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,e,i,n){this.loadVTLayers();const r=t.params,o=M/t.tileSize/t.scale,s=cr(r.filter),a=t.queryGeometry,c=t.queryPadding*o,u=Eh(a),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),p=Eh(t.cameraQueryGeometry),d=this.grid3D.query(p.minX-c,p.minY-c,p.maxX+c,p.maxY+c,((e,i,n,r)=>function(t,e,i,n,r){for(const o of t)if(e<=o.x&&i<=o.y&&n>=o.x&&r>=o.y)return!0;const o=[new l(e,i),new l(e,r),new l(n,r),new l(n,i)];if(t.length>2)for(const e of o)if(Fa(t,e))return!0;for(let e=0;e<t.length-1;e++)if(Na(t[e],t[e+1],o))return!0;return!1}(t.cameraQueryGeometry,e-c,i-c,n+c,r+c)));for(const t of d)h.push(t);h.sort(Ih);const f={};let m;for(let l=0;l<h.length;l++){const c=h[l];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let p=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,r.layers,r.availableImages,e,i,n,((e,i,n)=>(p||(p=Ta(e)),i.queryIntersectsFeature({queryGeometry:a,feature:e,featureState:n,geometry:p,zoom:this.z,transform:t.transform,pixelsToTileUnits:o,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return f}loadMatchingFeature(t,e,i,n,r,o,s,a,l,c,u){const h=this.bucketLayerIDs[e];if(o&&!h.some((t=>o.has(t))))return;const p=this.sourceLayerCoder.decode(i),d=this.vtLayers[p].feature(n);if(r.needGeometry){const t=Sa(d,!0);if(!r.filter(new Eo(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new Eo(this.tileID.overscaledZ),d))return;const f=this.getId(d,p);for(let e=0;e<h.length;e++){const i=h[e];if(o&&!o.has(i))continue;const r=a[i];if(!r)continue;let p={};f&&c&&(p=c.getState(r.sourceLayer||"_geojsonTileLayer",f));const m=F({},l[i]);m.paint=Ch(m.paint,r.paint,d,p,s),m.layout=Ch(m.layout,r.layout,d,p,s);const g=!u||u(d,r,p);if(!g)continue;const y=new Th(d,this.z,this.x,this.y,f);y.layer=m;let _=t[i];void 0===_&&(_=t[i]=[]),_.push({featureIndex:n,feature:y,intersectionZ:g})}}lookupSymbolFeatures(t,e,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=cr(r);for(const r of t)this.loadMatchingFeature(l,i,n,r,c,o,s,a,e);return l}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){var i;let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n)),void 0===n&&(null===(i=t.properties)||void 0===i?void 0:i.cluster)&&this.promoteId&&(n=Number(t.properties.cluster_id))),n}}function Ch(t,e,i,n,r){return B(t,((t,o)=>{const s=e instanceof Do?e.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function Eh(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return{minX:e,minY:i,maxX:n,maxY:r}}function Ih(t,e){return e-t}function Mh(t,e,i,n,r){const o=[];for(let s=0;s<t.length;s++){const a=t[s];let c;for(let t=0;t<a.length-1;t++){let s=a[t],u=a[t+1];s.x<e&&u.x<e||(s.x<e?s=new l(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<e&&(u=new l(e,s.y+(e-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=n&&u.x>=n||(s.x>=n?s=new l(n,s.y+(n-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=n&&(u=new l(n,s.y+(n-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=r&&u.y>=r||(s.y>=r?s=new l(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round():u.y>=r&&(u=new l(s.x+(r-s.y)/(u.y-s.y)*(u.x-s.x),r)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}ro("FeatureIndex",Sh,{omit:["rawTileData","sourceLayerCoder"]});class Ah extends l{constructor(t,e,i,n){super(t,e),this.angle=i,void 0!==n&&(this.segment=n)}clone(){return new Ah(this.x,this.y,this.angle,this.segment)}}function kh(t,e,i,n,r){if(void 0===e.segment||0===i)return!0;let o=e,s=e.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const e=t[s],i=t[s+1];if(!i)return!1;let o=t[s-1].angleTo(e)-e.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=e.dist(i)}return!0}function Ph(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Lh(t,e,i){return t?.6*e*i:0}function zh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Dh(t,e,i,n,r,o){const s=Lh(i,r,o),a=zh(i,n)*o;let l=0;const c=Ph(t)/2;for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=di.number(n.x,r.x,u),p=di.number(n.y,r.y,u),d=new Ah(h,p,r.angleTo(n),i);return d._round(),!s||kh(t,d,a,s,e)?d:void 0}l+=o}}function Rh(t,e,i,n,r,o,s,a,l){const c=Lh(n,o,s),u=zh(n,r),h=u*s,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Oh(t,p?e/2*a%e:(u/2+2*o)*s*a%e,e,c,i,h,p,!1,l)}function Oh(t,e,i,n,r,o,s,a,l){const c=o/2,u=Ph(t);let h=0,p=e-i,d=[];for(let e=0;e<t.length-1;e++){const s=t[e],a=t[e+1],f=s.dist(a),m=a.angleTo(s);for(;p+i<h+f;){p+=i;const g=(p-h)/f,y=di.number(s.x,a.x,g),_=di.number(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&p-c>=0&&p+c<=u){const i=new Ah(y,_,m,e);i._round(),n&&!kh(t,i,o,n,r)||d.push(i)}}h+=f}return a||d.length||s||(d=Oh(t,h/2,i,n,r,o,s,!0,l)),d}ro("Anchor",Ah);const Fh=su;function Nh(t,e,i,n){const r=[],o=t.image,s=o.pixelRatio,a=o.paddedRect.w-2*Fh,c=o.paddedRect.h-2*Fh;let u={x1:t.left,y1:t.top,x2:t.right,y2:t.bottom};const h=o.stretchX||[[0,a]],p=o.stretchY||[[0,c]],d=(t,e)=>t+e[1]-e[0],f=h.reduce(d,0),m=p.reduce(d,0),g=a-f,y=c-m;let _=0,v=f,x=0,b=m,w=0,T=g,S=0,C=y;if(o.content&&n){const e=o.content,i=e[2]-e[0],n=e[3]-e[1];(o.textFitWidth||o.textFitHeight)&&(u=Pu(t)),_=Bh(h,0,e[0]),x=Bh(p,0,e[1]),v=Bh(h,e[0],e[2]),b=Bh(p,e[1],e[3]),w=e[0]-_,S=e[1]-x,T=i-v,C=n-b}const E=u.x1,I=u.y1,M=u.x2-E,A=u.y2-I,k=(t,n,r,a)=>{const c=$h(t.stretch-_,v,M,E),u=Uh(t.fixed-w,T,t.stretch,f),h=$h(n.stretch-x,b,A,I),p=Uh(n.fixed-S,C,n.stretch,m),d=$h(r.stretch-_,v,M,E),g=Uh(r.fixed-w,T,r.stretch,f),y=$h(a.stretch-x,b,A,I),k=Uh(a.fixed-S,C,a.stretch,m),P=new l(c,h),L=new l(d,h),z=new l(d,y),D=new l(c,y),R=new l(u/s,p/s),O=new l(g/s,k/s),F=e*Math.PI/180;if(F){const t=Math.sin(F),e=Math.cos(F),i=[e,-t,t,e];P._matMult(i),L._matMult(i),D._matMult(i),z._matMult(i)}const N=t.stretch+t.fixed,B=n.stretch+n.fixed;return{tl:P,tr:L,bl:D,br:z,tex:{x:o.paddedRect.x+Fh+N,y:o.paddedRect.y+Fh+B,w:r.stretch+r.fixed-N,h:a.stretch+a.fixed-B},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:O,minFontScaleX:T/s/M,minFontScaleY:C/s/A,isSDF:i}};if(n&&(o.stretchX||o.stretchY)){const t=jh(h,g,f),e=jh(p,y,m);for(let i=0;i<t.length-1;i++){const n=t[i],o=t[i+1];for(let t=0;t<e.length-1;t++)r.push(k(n,e[t],o,e[t+1]))}}else r.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:c+1}));return r}function Bh(t,e,i){let n=0;for(const r of t)n+=Math.max(e,Math.min(i,r[1]))-Math.max(e,Math.min(i,r[0]));return n}function jh(t,e,i){const n=[{fixed:-1,stretch:0}];for(const[e,i]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return n.push({fixed:e+Fh,stretch:i}),n}function $h(t,e,i,n){return t/e*i+n}function Uh(t,e,i,n){return t-e*i/n}class Vh{constructor(t,e,i,n,r,o,s,a,c,u){var h;if(this.boxStartIndex=t.length,c){let t=o.top,e=o.bottom;const i=o.collisionPadding;i&&(t-=i[1],e+=i[3]);let n=e-t;n>0&&(n=Math.max(10,n),this.circleDiameter=n)}else{const c=(null===(h=o.image)||void 0===h?void 0:h.content)&&(o.image.textFitWidth||o.image.textFitHeight)?Pu(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};c.y1=c.y1*s-a[0],c.y2=c.y2*s+a[2],c.x1=c.x1*s-a[3],c.x2=c.x2*s+a[1];const p=o.collisionPadding;if(p&&(c.x1-=p[0]*s,c.y1-=p[1]*s,c.x2+=p[2]*s,c.y2+=p[3]*s),u){const t=new l(c.x1,c.y1),e=new l(c.x2,c.y1),i=new l(c.x1,c.y2),n=new l(c.x2,c.y2),r=u*Math.PI/180;t._rotate(r),e._rotate(r),i._rotate(r),n._rotate(r),c.x1=Math.min(t.x,e.x,i.x,n.x),c.x2=Math.max(t.x,e.x,i.x,n.x),c.y1=Math.min(t.y,e.y,i.y,n.y),c.y2=Math.max(t.y,e.y,i.y,n.y)}t.emplaceBack(e.x,e.y,c.x1,c.y1,c.x2,c.y2,i,n,r)}this.boxEndIndex=t.length}}class Gh{constructor(t,e){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(i(n,o)>=0)break;e[t]=o,t=r}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,r=e[t];for(;t<n;){let n=1+(t<<1);const o=n+1;if(o<this.length&&i(e[o],e[n])<0&&(n=o),i(e[n],r)>=0)break;e[t]=e[n],t=n}e[t]=r}}function qh(t,e,i=!1){let n=1/0,r=1/0,o=-1/0,s=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<r)&&(r=e.y),(!t||e.x>o)&&(o=e.x),(!t||e.y>s)&&(s=e.y)}const c=Math.min(o-n,s-r);let u=c/2;const h=new Gh([],Zh);if(0===c)return new l(n,r);for(let e=n;e<o;e+=c)for(let i=r;i<s;i+=c)h.push(new Wh(e+u,i+u,u,t));let p=function(t){let e=0,i=0,n=0;const r=t[0];for(let t=0,o=r.length,s=o-1;t<o;s=t++){const o=r[t],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,e+=3*l}return new Wh(i/e,n/e,0,t)}(t),d=h.length;for(;h.length;){const n=h.pop();(n.d>p.d||!p.d)&&(p=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,d)),n.max-p.d<=e||(u=n.h/2,h.push(new Wh(n.p.x-u,n.p.y-u,u,t)),h.push(new Wh(n.p.x+u,n.p.y-u,u,t)),h.push(new Wh(n.p.x-u,n.p.y+u,u,t)),h.push(new Wh(n.p.x+u,n.p.y+u,u,t)),d+=4)}return i&&(console.log(`num probes: ${d}`),console.log(`best distance: ${p.d}`)),p.p}function Zh(t,e){return e.max-t.max}function Wh(t,e,i,n){this.p=new l(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,Ra(t,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var Hh;t.aB=void 0,(Hh=t.aB||(t.aB={}))[Hh.center=1]="center",Hh[Hh.left=2]="left",Hh[Hh.right=3]="right",Hh[Hh.top=4]="top",Hh[Hh.bottom=5]="bottom",Hh[Hh["top-left"]=6]="top-left",Hh[Hh["top-right"]=7]="top-right",Hh[Hh["bottom-left"]=8]="bottom-left",Hh[Hh["bottom-right"]=9]="bottom-right";const Xh=7,Yh=Number.POSITIVE_INFINITY;function Kh(t,e){return e[1]!==Yh?function(t,e,i){let n=0,r=0;switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":r=i-Xh;break;case"bottom-right":case"bottom-left":case"bottom":r=-i+Xh}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,r]}(t,e[0],e[1]):function(t,e){let i=0,n=0;e<0&&(e=0);const r=e/Math.SQRT2;switch(t){case"top-right":case"top-left":n=r-Xh;break;case"bottom-right":case"bottom-left":n=-r+Xh;break;case"bottom":n=-e+Xh;break;case"top":n=e-Xh}switch(t){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=e;break;case"right":i=-e}return[i,n]}(t,e[0])}function Jh(t,e,i){var n;const r=t.layout,o=null===(n=r.get("text-variable-anchor-offset"))||void 0===n?void 0:n.evaluate(e,{},i);if(o){const t=o.values,e=[];for(let i=0;i<t.length;i+=2){const n=e[i]=t[i],r=t[i+1].map((t=>t*Xc));n.startsWith("top")?r[1]-=Xh:n.startsWith("bottom")&&(r[1]+=Xh),e[i+1]=r}return new Re(e)}const s=r.get("text-variable-anchor");if(s){let n;n=void 0!==t._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(e,{},i)*Xc,Yh]:r.get("text-offset").evaluate(e,{},i).map((t=>t*Xc));const o=[];for(const t of s)o.push(t,Kh(t,n));return new Re(o)}return null}function Qh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tp(e,i,n,r,o,s,a,l,c,u,h,p){let d=s.textMaxSize.evaluate(i,{});void 0===d&&(d=a);const f=e.layers[0].layout,m=f.get("icon-offset").evaluate(i,{},h),g=ip(n.horizontal),y=a/24,_=e.tilePixelRatio*y,v=e.tilePixelRatio*d/24,x=e.tilePixelRatio*l,b=e.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*e.tilePixelRatio,T=function(t,e,i,n=1){const r=t.get("icon-padding").evaluate(e,{},i),o=r&&r.values;return[o[0]*n,o[1]*n,o[2]*n,o[3]*n]}(f,i,h,e.tilePixelRatio),S=f.get("text-max-angle")/180*Math.PI,C="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),E="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),I=f.get("symbol-placement"),A=b/2,k=f.get("icon-text-fit");let P;r&&"none"!==k&&(e.allowVerticalPlacement&&n.vertical&&(P=Lu(r,n.vertical,k,f.get("icon-text-fit-padding"),m,y)),g&&(r=Lu(r,g,k,f.get("icon-text-fit-padding"),m,y)));const L=h?p.line.getGranularityForZoomLevel(h.z):1,z=(l,p)=>{p.x<0||p.x>=M||p.y<0||p.y>=M||function(e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x,b,w,T,S,C){const E=e.addToLineVertexArray(i,n);let I,M,A,k,P=0,L=0,z=0,D=0,R=-1,O=-1;const F={};let N=ea("");if(e.allowVerticalPlacement&&r.vertical){const t=l.layout.get("text-rotate").evaluate(b,{},S)+90;A=new Vh(c,i,u,h,p,r.vertical,d,f,m,t),a&&(k=new Vh(c,i,u,h,p,a,y,_,m,t))}if(o){const n=l.layout.get("icon-rotate").evaluate(b,{}),r="none"!==l.layout.get("icon-text-fit"),s=Nh(o,n,T,r),d=a?Nh(a,n,T,r):void 0;M=new Vh(c,i,u,h,p,o,y,_,!1,n),P=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Du*l.layout.get("icon-size").evaluate(b,{})],m[0]>Ru&&V(`${e.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Du*w.compositeIconSizes[0].evaluate(b,{},S),Du*w.compositeIconSizes[1].evaluate(b,{},S)],(m[0]>Ru||m[1]>Ru)&&V(`${e.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,x,v,b,t.al.none,i,E.lineStartIndex,E.lineLength,-1,S),R=e.icon.placedSymbolArray.length-1,d&&(L=4*d.length,e.addSymbols(e.icon,d,m,x,v,b,t.al.vertical,i,E.lineStartIndex,E.lineLength,-1,S),O=e.icon.placedSymbolArray.length-1)}const B=Object.keys(r.horizontal);for(const n of B){const o=r.horizontal[n];if(!I){N=ea(o.text);const t=l.layout.get("text-rotate").evaluate(b,{},S);I=new Vh(c,i,u,h,p,o,d,f,m,t)}const a=1===o.positionedLines.length;if(z+=ep(e,i,o,s,l,m,b,g,E,r.vertical?t.al.horizontal:t.al.horizontalOnly,a?B:[n],F,R,w,S),a)break}r.vertical&&(D+=ep(e,i,r.vertical,s,l,m,b,g,E,t.al.vertical,["vertical"],F,O,w,S));const j=I?I.boxStartIndex:e.collisionBoxArray.length,$=I?I.boxEndIndex:e.collisionBoxArray.length,U=A?A.boxStartIndex:e.collisionBoxArray.length,G=A?A.boxEndIndex:e.collisionBoxArray.length,q=M?M.boxStartIndex:e.collisionBoxArray.length,Z=M?M.boxEndIndex:e.collisionBoxArray.length,W=k?k.boxStartIndex:e.collisionBoxArray.length,H=k?k.boxEndIndex:e.collisionBoxArray.length;let X=-1;const Y=(t,e)=>t&&t.circleDiameter?Math.max(t.circleDiameter,e):e;X=Y(I,X),X=Y(A,X),X=Y(M,X),X=Y(k,X);const K=X>-1?1:0;K&&(X*=C/Xc),e.glyphOffsetArray.length>=qu.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,b.sortKey);const J=Jh(l,b,S),[Q,tt]=function(e,i){const n=e.length,r=null==i?void 0:i.values;if((null==r?void 0:r.length)>0)for(let i=0;i<r.length;i+=2){const n=r[i+1];e.emplaceBack(t.aB[r[i]],n[0],n[1])}return[n,e.length]}(e.textAnchorOffsets,J);e.symbolInstances.emplaceBack(i.x,i.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,R,O,N,j,$,U,G,q,Z,W,H,u,z,D,P,L,K,0,d,X,Q,tt)}(e,p,l,n,r,o,P,e.layers[0],e.collisionBoxArray,i.index,i.sourceLayerIndex,e.index,_,[w,w,w,w],C,c,x,T,E,m,i,s,u,h,a)};if("line"===I)for(const t of Mh(i.geometry,0,0,M,M)){const i=Ul(t,L),o=Rh(i,b,S,n.vertical||g,r,24,v,e.overscaling,M);for(const t of o)g&&np(e,g.text,A,t)||z(i,t)}else if("line-center"===I){for(const t of i.geometry)if(t.length>1){const e=Ul(t,L),i=Dh(e,S,n.vertical||g,r,24,v);i&&z(e,i)}}else if("Polygon"===i.type)for(const t of Ji(i.geometry,0)){const e=qh(t,16);z(Ul(t[0],L,!0),new Ah(e.x,e.y,0))}else if("LineString"===i.type)for(const t of i.geometry){const e=Ul(t,L);z(e,new Ah(e[0].x,e[0].y,0))}else if("Point"===i.type)for(const t of i.geometry)for(const e of t)z([e],new Ah(e.x,e.y,0))}function ep(t,e,i,n,r,o,s,a,c,u,h,p,d,f,m){const g=function(t,e,i,n,r,o,s,a){const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const t of e.positionedLines)for(const n of t.positionedGlyphs){if(!n.rect)continue;const o=n.rect||{};let h=ru+1,p=!0,d=1,f=0;const m=(r||a)&&n.vertical,g=n.metrics.advance*n.scale/2;if(a&&e.verticalizable&&(f=t.lineOffset/2-(n.imageName?-(Xc-n.metrics.width*n.scale)/2:(n.scale-1)*Xc)),n.imageName){const t=s[n.imageName];p=t.sdf,d=t.pixelRatio,h=su/d}const y=r?[n.x+g,n.y]:[0,0];let _=r?[0,0]:[n.x+g+i[0],n.y+i[1]-f],v=[0,0];m&&(v=_,_=[0,0]);const x=n.metrics.isDoubleResolution?2:1,b=(n.metrics.left-h)*n.scale-g+_[0],w=(-n.metrics.top-h)*n.scale+_[1],T=b+o.w/x*n.scale/d,S=w+o.h/x*n.scale/d,C=new l(b,w),E=new l(T,w),I=new l(b,S),M=new l(T,S);if(m){const t=new l(-g,g-uu),e=-Math.PI/2,i=Xc/2-g,r=new l(5-uu-i,-(n.imageName?i:0)),o=new l(...v);C._rotateAround(e,t)._add(r)._add(o),E._rotateAround(e,t)._add(r)._add(o),I._rotateAround(e,t)._add(r)._add(o),M._rotateAround(e,t)._add(r)._add(o)}if(c){const t=Math.sin(c),e=Math.cos(c),i=[e,-t,t,e];C._matMult(i),E._matMult(i),I._matMult(i),M._matMult(i)}const A=new l(0,0),k=new l(0,0);u.push({tl:C,tr:E,bl:I,br:M,tex:o,writingMode:e.writingMode,glyphOffset:y,sectionIndex:n.sectionIndex,isSDF:p,pixelOffsetTL:A,pixelOffsetBR:k,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,a,r,o,s,n,t.allowVerticalPlacement),y=t.textSizeData;let _=null;"source"===y.kind?(_=[Du*r.layout.get("text-size").evaluate(s,{})],_[0]>Ru&&V(`${t.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)):"composite"===y.kind&&(_=[Du*f.compositeTextSizes[0].evaluate(s,{},m),Du*f.compositeTextSizes[1].evaluate(s,{},m)],(_[0]>Ru||_[1]>Ru)&&V(`${t.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)),t.addSymbols(t.text,g,_,a,o,s,u,e,c.lineStartIndex,c.lineLength,d,m);for(const e of h)p[e]=t.text.placedSymbolArray.length-1;return 4*g.length}function ip(t){for(const e in t)return t[e];return null}function np(t,e,i,n){const r=t.compareText;if(e in r){const t=r[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else r[e]=[];return r[e].push(n),!1}const rp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class op{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const r=rp[15&i];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(t,2,1),[s]=new Uint32Array(t,4,1);return new op(s,o,r,t)}constructor(t,e=64,i=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const r=rp.indexOf(this.ArrayType),o=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return sp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=t&&a<=i&&c>=e&&c<=n&&l.push(r[s])}continue}const p=h+u>>1,d=o[2*p],f=o[2*p+1];d>=t&&d<=i&&f>=e&&f<=n&&l.push(r[p]),(0===c?t<=d:e<=f)&&(a.push(h),a.push(p-1),a.push(1-c)),(0===c?i>=d:n>=f)&&(a.push(p+1),a.push(u),a.push(1-c))}return l}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:r,nodeSize:o}=this,s=[0,n.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)up(r[2*i],r[2*i+1],t,e)<=l&&a.push(n[i]);continue}const p=h+u>>1,d=r[2*p],f=r[2*p+1];up(d,f,t,e)<=l&&a.push(n[p]),(0===c?t-i<=d:e-i<=f)&&(s.push(h),s.push(p-1),s.push(1-c)),(0===c?t+i>=d:e+i>=f)&&(s.push(p+1),s.push(u),s.push(1-c))}return a}}function sp(t,e,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;ap(t,e,s,n,r,o),sp(t,e,i,n,s-1,1-o),sp(t,e,i,s+1,r,1-o)}function ap(t,e,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);ap(t,e,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=e[2*i+o];let a=n,l=r;for(lp(t,e,n,i),e[2*r+o]>s&&lp(t,e,n,r);a<l;){for(lp(t,e,a,l),a++,l--;e[2*a+o]<s;)a++;for(;e[2*l+o]>s;)l--}e[2*n+o]===s?lp(t,e,n,l):(l++,lp(t,e,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function lp(t,e,i,n){cp(t,i,n),cp(e,2*i,2*n),cp(e,2*i+1,2*n+1)}function cp(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function up(t,e,i,n){const r=t-i,o=e-n;return r*r+o*o}var hp;t.co=void 0,(hp=t.co||(t.co={})).create="create",hp.load="load",hp.fullLoad="fullLoad";let pp=null,dp=[];const fp=1e3/60,mp="loadTime",gp="fullLoadTime",yp={mark(t){performance.mark(t)},frame(t){const e=t;null!=pp&&dp.push(e-pp),pp=e},clearMetrics(){pp=null,dp=[],performance.clearMeasures(mp),performance.clearMeasures(gp);for(const e in t.co)performance.clearMarks(t.co[e])},getPerformanceMetrics(){performance.measure(mp,t.co.create,t.co.load),performance.measure(gp,t.co.create,t.co.fullLoad);const e=performance.getEntriesByName(mp)[0].duration,i=performance.getEntriesByName(gp)[0].duration,n=dp.length,r=1/(dp.reduce(((t,e)=>t+e),0)/n/1e3),o=dp.filter((t=>t>fp)).reduce(((t,e)=>t+(e-fp)/fp),0);return{loadTime:e,fullLoadTime:i,fps:r,percentDroppedFrames:o/(n+o)*100,totalFrames:n}}};t.$=mh,t.A=g,t.B=di,t.C=Eo,t.D=Ro,t.E=gt,t.F=Jr,t.G=function(t){if(null==Z){const e=t.navigator?t.navigator.userAgent:null;Z=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Z},t.H=class{constructor(t,e){this.target=t,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new rh((()=>this.process())),this.subscription=J(this.target,"message",(t=>this.receive(t)),!1),this.globalScope=q(self)?t:window}registerMessageHandler(t,e){this.messageHandlers[t]=e}sendAsync(t,e){return new Promise(((i,n)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10),o=e?J(e.signal,"abort",(()=>{null==o||o.unsubscribe(),delete this.resolveRejects[r];const e={id:r,type:"<cancel>",origin:location.origin,targetMapId:t.targetMapId,sourceMapId:this.mapId};this.target.postMessage(e)}),oh):null;this.resolveRejects[r]={resolve:t=>{null==o||o.unsubscribe(),i(t)},reject:t=>{null==o||o.unsubscribe(),n(t)}};const s=[],a=Object.assign(Object.assign({},t),{id:r,sourceMapId:this.mapId,origin:location.origin,data:lo(t.data,s)});this.target.postMessage(a,{transfer:s})}))}receive(t){const e=t.data,i=e.id;if(!("file://"!==e.origin&&"file://"!==location.origin&&"resource://android"!==e.origin&&"resource://android"!==location.origin&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if("<cancel>"===e.type){delete this.tasks[i];const t=this.abortControllers[i];return delete this.abortControllers[i],void(t&&t.abort())}if(q(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(0===this.taskQueue.length)return;const t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(t,e)}processTask(t,i){return e(this,void 0,void 0,(function*(){if("<response>"===i.type){const e=this.resolveRejects[t];if(delete this.resolveRejects[t],!e)return;return void(i.error?e.reject(co(i.error)):e.resolve(co(i.data)))}if(!this.messageHandlers[i.type])return void this.completeTask(t,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const e=co(i.data),n=new AbortController;this.abortControllers[t]=n;try{const r=yield this.messageHandlers[i.type](i.sourceMapId,e,n);this.completeTask(t,null,r)}catch(e){this.completeTask(t,e)}}))}completeTask(t,e,i){const n=[];delete this.abortControllers[t];const r={id:t,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?lo(e):null,data:lo(i,n)};this.target.postMessage(r,{transfer:n})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},t.I=au,t.J=at,t.K=function(){var t=new g(16);return g!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.L=function(t,e,i){var n,r,o,s,a,l,c,u,h,p,d,f,m=i[0],g=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*y+e[12],t[13]=e[1]*m+e[5]*g+e[9]*y+e[13],t[14]=e[2]*m+e[6]*g+e[10]*y+e[14],t[15]=e[3]*m+e[7]*g+e[11]*y+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+a*g+h*y+e[12],t[13]=r*m+l*g+p*y+e[13],t[14]=o*m+c*g+d*y+e[14],t[15]=s*m+u*g+f*y+e[15]),t},t.M=function(t,e,i){var n=i[0],r=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.N=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],v=i[0],x=i[1],b=i[2],w=i[3];return t[0]=v*n+x*a+b*h+w*m,t[1]=v*r+x*l+b*p+w*g,t[2]=v*o+x*c+b*d+w*y,t[3]=v*s+x*u+b*f+w*_,t[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,t[5]=v*r+x*l+b*p+w*g,t[6]=v*o+x*c+b*d+w*y,t[7]=v*s+x*u+b*f+w*_,t[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,t[9]=v*r+x*l+b*p+w*g,t[10]=v*o+x*c+b*d+w*y,t[11]=v*s+x*u+b*f+w*_,t[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,t[13]=v*r+x*l+b*p+w*g,t[14]=v*o+x*c+b*d+w*y,t[15]=v*s+x*u+b*f+w*_,t},t.O=function(t,e){const i={};for(let n=0;n<e.length;n++){const r=e[n];r in t&&(i[r]=t[r])}return i},t.P=l,t.Q=ah,t.R=tl,t.S=hh,t.T=Ao,t.U=uh,t.V=d,t.W=f,t.X=X,t.Y=vh,t.Z=M,t._=e,t.a=ot,t.a$=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+c*n,t[5]=s*r+u*n,t[6]=a*r+h*n,t[7]=l*r+p*n,t[8]=c*r-o*n,t[9]=u*r-s*n,t[10]=h*r-a*n,t[11]=p*r-l*n,t},t.a0=25,t.a1=yh,t.a2=t=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const i of t){const t=window.document.createElement("source");ht(i)||(e.crossOrigin="Anonymous"),t.src=i,e.appendChild(t)}}))},t.a3=At,t.a4=function(){return N++},t.a5=_s,t.a6=qu,t.a7=cr,t.a8=Sa,t.a9=Th,t.aA=function(t,e,i,n,r=!1){if(!i[0]&&!i[1])return[0,0];const o=r?"map"===n?-t.bearingInRadians:0:"viewport"===n?t.bearingInRadians:0;if(o){const t=Math.sin(o),e=Math.cos(o);i=[i[0]*e-i[1]*t,i[0]*t+i[1]*e]}return[r?i[0]:A(e,i[0],t.zoom),r?i[1]:A(e,i[1],t.zoom)]},t.aC=Fu,t.aD=Qh,t.aE=Tu,t.aF=op,t.aG=Zo,t.aH=Fl,t.aI=As,t.aJ=qs,t.aK=$s,t.aL=O,t.aM=tt,t.aN=fh,t.aO=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},t.aP=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},t.aQ=function(t){var e=new g(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.aR=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},t.aS=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},t.aT=function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.aU=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[0],a=i[1],l=i[2];return t[0]=r*l-o*a,t[1]=o*s-n*l,t[2]=n*a-r*s,t},t.aV=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.aW=_h,t.aX=xh,t.aY=function(t,e,i,n,r){var o,s=1/Math.tan(e/2);return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+n)*(o=1/(n-r)),t[14]=2*r*n*o):(t[10]=-1,t[14]=-2*n),t},t.aZ=function(t){var e=new g(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.a_=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+c*n,t[1]=s*r+u*n,t[2]=a*r+h*n,t[3]=l*r+p*n,t[4]=c*r-o*n,t[5]=u*r-s*n,t[6]=h*r-a*n,t[7]=p*r-l*n,t},t.aa=function(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,r)=>{const o=n||r;return e[i]=!o||o.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e},t.ab=Q,t.ac=function(t){return Math.pow(2,t)},t.ad=_,t.ae=R,t.af=85.051129,t.ag=ph,t.ah=function(t){return Math.log(t)/Math.LN2},t.ai=function(t){var e=t[0],i=t[1];return e*e+i*i},t.aj=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},t.ak=function(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=t,a=r?R(hi.interpolationFactor(r,e,o,s),0,1):0;"camera"===t.kind?n=di.number(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}},t.am=function(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===t.kind?n/Du:"composite"===t.kind?di.number(n/Du,r/Du,i):e},t.an=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],_=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,T=r*c-o*l,S=u*m-h*f,C=u*g-p*f,E=u*y-d*f,I=h*g-p*m,M=h*y-d*m,A=p*y-d*g,k=_*A-v*M+x*I+b*E-w*C+T*S;return k?(t[0]=(a*A-l*M+c*I)*(k=1/k),t[1]=(r*M-n*A-o*I)*k,t[2]=(m*T-g*w+y*b)*k,t[3]=(p*w-h*T-d*b)*k,t[4]=(l*E-s*A-c*C)*k,t[5]=(i*A-r*E+o*C)*k,t[6]=(g*x-f*T-y*v)*k,t[7]=(u*T-p*x+d*v)*k,t[8]=(s*M-a*E+c*S)*k,t[9]=(n*E-i*M-o*S)*k,t[10]=(f*w-m*x+y*_)*k,t[11]=(h*x-u*w-d*_)*k,t[12]=(a*C-s*I-l*S)*k,t[13]=(i*I-n*C+r*S)*k,t[14]=(m*v-f*b-g*_)*k,t[15]=(u*b-h*v+p*_)*k,t):null},t.ao=E,t.ap=function(t){return Math.hypot(t[0],t[1])},t.aq=function(t){return t[0]=0,t[1]=0,t},t.ar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},t.as=$u,t.at=S,t.au=function(t,e,i,n){const r=e.y-t.y,o=e.x-t.x,s=n.y-i.y,a=n.x-i.x,c=s*o-a*r;if(0===c)return null;const u=(a*(t.y-i.y)-s*(t.x-i.x))/c;return new l(t.x+u*o,t.y+u*r)},t.av=Mh,t.aw=Ma,t.ax=function(t){let e=1/0,i=1/0,n=-1/0,r=-1/0;for(const o of t)e=Math.min(e,o.x),i=Math.min(i,o.y),n=Math.max(n,o.x),r=Math.max(r,o.y);return[e,i,n,r]},t.ay=Xc,t.az=A,t.b=W,t.b$=class extends ms{},t.b0=function(){const t=new Float32Array(16);return _(t),t},t.b1=function(){const t=new Float64Array(16);return _(t),t},t.b2=function(){return new Float64Array(16)},t.b3=function(t,e,i){const n=new Float64Array(4);return function(t,e,i,n){var r=.5*Math.PI/180;e*=r,i*=r,n*=r;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(n),u=Math.cos(n);t[0]=o*l*u-s*a*c,t[1]=s*a*u+o*l*c,t[2]=s*l*c-o*a*u,t[3]=s*l*u+o*a*c}(n,t,e-90,i),n},t.b4=function(t,e,i,n){var r,o,s,a,l,c=e[0],u=e[1],h=e[2],p=e[3],d=i[0],f=i[1],g=i[2],y=i[3];return(o=c*d+u*f+h*g+p*y)<0&&(o=-o,d=-d,f=-f,g=-g,y=-y),1-o>m?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-n)*r)/s,l=Math.sin(n*r)/s):(a=1-n,l=n),t[0]=a*c+l*d,t[1]=a*u+l*f,t[2]=a*h+l*g,t[3]=a*p+l*y,t},t.b5=function(t){const e=new Float64Array(9);var i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v;h=(r=(n=t)[0])*(l=r+r),p=(o=n[1])*l,f=(s=n[2])*l,m=s*(c=o+o),y=(a=n[3])*l,_=a*c,v=a*(u=s+s),(i=e)[0]=1-(d=o*c)-(g=s*u),i[3]=p-v,i[6]=f+_,i[1]=p+v,i[4]=1-h-g,i[7]=m-y,i[2]=f-_,i[5]=m+y,i[8]=1-h-d;const x=tt(-Math.asin(R(e[2],-1,1)));let b,w;return Math.hypot(e[5],e[8])<.001?(b=0,w=-tt(Math.atan2(e[3],e[4]))):(b=tt(0===e[5]&&0===e[8]?0:Math.atan2(e[5],e[8])),w=tt(0===e[1]&&0===e[0]?0:Math.atan2(e[1],e[0]))),{roll:b,pitch:x+90,bearing:w}},t.b6=function(t,e){return t.roll==e.roll&&t.pitch==e.pitch&&t.bearing==e.bearing},t.b7=Ce,t.b8=aa,t.b9=Nl,t.bA=function(t){if("custom"===t.type)return new nh(t);switch(t.type){case"background":return new Qu(t);case"circle":return new qa(t);case"fill":return new Yl(t);case"fill-extrusion":return new bc(t);case"heatmap":return new nl(t);case"hillshade":return new sl(t);case"line":return new Fc(t);case"raster":return new ih(t);case"symbol":return new Yu(t)}},t.bB=$,t.bC=function(t,e){if(!t)return[{command:"setStyle",args:[e]}];let i=[];try{if(!xt(t.version,e.version))return[{command:"setStyle",args:[e]}];xt(t.center,e.center)||i.push({command:"setCenter",args:[e.center]}),xt(t.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),xt(t.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),xt(t.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),xt(t.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),xt(t.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),xt(t.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),xt(t.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),xt(t.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),xt(t.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),xt(t.light,e.light)||i.push({command:"setLight",args:[e.light]}),xt(t.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),xt(t.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),xt(t.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const n={},r=[];!function(t,e,i,n){let r;for(r in e=e||{},t=t||{})Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)||Tt(r,i,n));for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?xt(t[r],e[r])||("geojson"===t[r].type&&"geojson"===e[r].type&&Ct(t,e,r)?bt(i,{command:"setGeoJSONSourceData",args:[r,e[r].data]}):St(r,e,i,n)):wt(r,e,i))}(t.sources,e.sources,r,n);const o=[];t.layers&&t.layers.forEach((t=>{"source"in t&&n[t.source]?i.push({command:"removeLayer",args:[t.id]}):o.push(t)})),i=i.concat(r),function(t,e,i){e=e||[];const n=(t=t||[]).map(It),r=e.map(It),o=t.reduce(Mt,{}),s=e.reduce(Mt,{}),a=n.slice(),l=Object.create(null);let c,u,h,p,d;for(let t=0,e=0;t<n.length;t++)c=n[t],Object.prototype.hasOwnProperty.call(s,c)?e++:(bt(i,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,e),1));for(let t=0,e=0;t<r.length;t++)c=r[r.length-1-t],a[a.length-1-t]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(bt(i,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-e),1)):e++,p=a[a.length-t],bt(i,{command:"addLayer",args:[s[c],p]}),a.splice(a.length-t,0,c),l[c]=!0);for(let t=0;t<r.length;t++)if(c=r[t],u=o[c],h=s[c],!l[c]&&!xt(u,h))if(xt(u.source,h.source)&&xt(u["source-layer"],h["source-layer"])&&xt(u.type,h.type)){for(d in Et(u.layout,h.layout,i,c,null,"setLayoutProperty"),Et(u.paint,h.paint,i,c,null,"setPaintProperty"),xt(u.filter,h.filter)||bt(i,{command:"setFilter",args:[c,h.filter]}),xt(u.minzoom,h.minzoom)&&xt(u.maxzoom,h.maxzoom)||bt(i,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,d)&&"layout"!==d&&"paint"!==d&&"filter"!==d&&"metadata"!==d&&"minzoom"!==d&&"maxzoom"!==d&&(0===d.indexOf("paint.")?Et(u[d],h[d],i,c,d.slice(6),"setPaintProperty"):xt(u[d],h[d])||bt(i,{command:"setLayerProperty",args:[c,d,h[d]]}));for(d in h)Object.prototype.hasOwnProperty.call(h,d)&&!Object.prototype.hasOwnProperty.call(u,d)&&"layout"!==d&&"paint"!==d&&"filter"!==d&&"metadata"!==d&&"minzoom"!==d&&"maxzoom"!==d&&(0===d.indexOf("paint.")?Et(u[d],h[d],i,c,d.slice(6),"setPaintProperty"):xt(u[d],h[d])||bt(i,{command:"setLayerProperty",args:[c,d,h[d]]}))}else bt(i,{command:"removeLayer",args:[c]}),p=a[a.lastIndexOf(c)+1],bt(i,{command:"addLayer",args:[h,p]})}(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:"setStyle",args:[e]}]}return i},t.bD=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.bE=function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i},t.bF=B,t.bG=j,t.bH=class extends sa{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.bI=ca,t.bJ=class extends sa{constructor(t,e){super(t,e),this.current=ua}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.bK=la,t.bL=class extends sa{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.bM=class extends sa{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.bN=y,t.bO=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.bP=function(t,e,i){var n=e[0],r=e[1],o=e[2];return t[0]=n*i[0]+r*i[3]+o*i[6],t[1]=n*i[1]+r*i[4]+o*i[7],t[2]=n*i[2]+r*i[5]+o*i[8],t},t.bQ=function(t,e,i,n,r,o,s){var a=1/(e-i),l=1/(n-r),c=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(r+n)*l,t[14]=(s+o)*c,t[15]=1,t},t.bR=class extends sa{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(4*t.length);for(let i=0;i<t.length;i++)e[4*i]=t[i].r,e[4*i+1]=t[i].g,e[4*i+2]=t[i].b,e[4*i+3]=t[i].a;this.gl.uniform4fv(this.location,e)}}},t.bS=class extends sa{constructor(t,e){super(t,e),this.current=new Array}set(t){if(t!=this.current){this.current=t;const e=new Float32Array(t);this.gl.uniform1fv(this.location,e)}}},t.bT=class extends ss{},t.bU=Vc,t.bV=class extends ls{},t.bW=il,t.bX=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.bY=el,t.bZ=function(t,e,i){var n=e[0],r=e[1],o=e[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return t[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(s=s||1),t[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,t[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,t},t.b_=class extends Yo{},t.ba=Bl,t.bb=Ol,t.bc=P,t.bd=L,t.be=Fe,t.bf=function(t,e,i,n,r){return P(n,r,R((t-e)/(i-e),0,1))},t.bg=k,t.bh=function(){return new Float64Array(3)},t.bi=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},t.bj=T,t.bk=function(){return new Float64Array(4)},t.bl=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},t.bm=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0],o[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),o[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},t.bn=function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),o[1]=r[1],o[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t},t.bo=x,t.bp=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],s=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-c*n,t[1]=s*r-u*n,t[2]=a*r-h*n,t[3]=l*r-p*n,t[8]=o*n+c*r,t[9]=s*n+u*r,t[10]=a*n+h*r,t[11]=l*n+p*r,t},t.bq=function(t,e){const i=k(t,360),n=k(e,360),r=n-i,o=n>i?r-360:r+360;return Math.abs(r)<Math.abs(o)?r:o},t.br=function(t){return t[0]=0,t[1]=0,t[2]=0,t},t.bs=function(t,e,i,n){const r=Math.sqrt(t*t+e*e),o=Math.sqrt(i*i+n*n);t/=r,e/=r,i/=o,n/=o;const s=Math.acos(t*i+e*n);return-e*i+t*n>0?s:-s},t.bt=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},t.bu=sh,t.bv=function(t,e){const i=k(t,2*Math.PI),n=k(e,2*Math.PI);return Math.min(Math.abs(i-n),Math.abs(i-n+2*Math.PI),Math.abs(i-n-2*Math.PI))},t.bw=function(){const t={},e=yt.$version;for(const i in yt.$root){const n=yt.$root[i];if(n.required){let r=null;r="version"===i?e:"array"===n.type?[]:{},null!=r&&(t[i]=r)}}return t},t.bx=uo,t.by=ct,t.bz=function(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=vt(t[i],e[t[i].ref]));return t},t.c=rt,t.c0=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},t.c1=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],p=t[10],d=t[11],f=t[12],g=t[13],y=t[14],_=t[15],v=e[0],x=e[1],b=e[2],w=e[3],T=e[4],S=e[5],C=e[6],E=e[7],I=e[8],M=e[9],A=e[10],k=e[11],P=e[12],L=e[13],z=e[14],D=e[15];return Math.abs(i-v)<=m*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(n-x)<=m*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(r-b)<=m*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(o-w)<=m*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-T)<=m*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(a-S)<=m*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-C)<=m*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-E)<=m*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-I)<=m*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(h-M)<=m*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-A)<=m*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(d-k)<=m*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(f-P)<=m*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(g-L)<=m*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-z)<=m*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(_-D)<=m*Math.max(1,Math.abs(_),Math.abs(D))},t.c2=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.c3=t=>"symbol"===t.type,t.c4=t=>"circle"===t.type,t.c5=t=>"heatmap"===t.type,t.c6=t=>"line"===t.type,t.c7=t=>"fill"===t.type,t.c8=t=>"fill-extrusion"===t.type,t.c9=t=>"hillshade"===t.type,t.cA=Zl,t.cB=mc,t.cC=hc,t.cD=Qc,t.cE=class{constructor(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let t=performance.getEntriesByName(this._marks.measure);return 0===t.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),t=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),t}},t.cF=function(t,i,n,r,o){return e(this,void 0,void 0,(function*(){if(f())try{return yield X(t,i,n,r,o)}catch(t){}return function(t,e,i,n,r){const o=t.width,s=t.height;Y&&K||(Y=new OffscreenCanvas(o,s),K=Y.getContext("2d",{willReadFrequently:!0})),Y.width=o,Y.height=s,K.drawImage(t,0,0,o,s);const a=K.getImageData(e,i,n,r);return K.clearRect(0,0,o,s),a.data}(t,i,n,r,o)}))},t.cG=bh,t.cH=i,t.cI=o,t.cJ=uc,t.cK=Jc,t.cL=er,t.cM=Co,t.ca=t=>"raster"===t.type,t.cb=t=>"background"===t.type,t.cc=t=>"custom"===t.type,t.cd=z,t.ce=function(t,e,i){const n=I(e.x-i.x,e.y-i.y),r=I(t.x-i.x,t.y-i.y);var o,s;return tt(Math.atan2(n[0]*r[1]-n[1]*r[0],(o=n)[0]*(s=r)[0]+o[1]*s[1]))},t.cf=D,t.cg=function(t,e){return it[e]&&(t instanceof MouseEvent||t instanceof WheelEvent)},t.ch=function(t,e){return et[e]&&"touches"in t},t.ci=function(t){return et[t]||it[t]},t.cj=function(t,e,i){var n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t},t.ck=function(t,e){const{x:i,y:n}=mh.fromLngLat(e);return!(t<0||t>25||n<0||n>=1||i<0||i>=1)},t.cl=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.cm=class extends Xo{},t.cn=yp,t.cp=function(t){return t.message===nt},t.cq=lt,t.cr=function(t,e){ot.REGISTERED_PROTOCOLS[t]=e},t.cs=function(t){delete ot.REGISTERED_PROTOCOLS[t]},t.ct=function(t,e){const i={};for(let n=0;n<t.length;n++){const r=e&&e[t[n].id]||_r(t[n]);e&&(e[t[n].id]=r);let o=i[r];o||(o=i[r]=[]),o.push(t[n])}const n=[];for(const t in i)n.push(i[t]);return n},t.cu=ro,t.cv=wh,t.cw=Sh,t.cx=lu,t.cy=function(e){e.bucket.createArrays(),e.bucket.tilePixelRatio=M/(512*e.bucket.overscaling),e.bucket.compareText={},e.bucket.iconsNeedLinear=!1;const i=e.bucket.layers[0],n=i.layout,r=i._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new Eo(e.bucket.zoom+1),e.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Eo(e.bucket.zoom+1),e.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Eo(18))};if("composite"===e.bucket.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Eo(t),e.canonical),r["text-size"].possiblyEvaluate(new Eo(i),e.canonical)]}if("composite"===e.bucket.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Eo(t),e.canonical),r["icon-size"].possiblyEvaluate(new Eo(i),e.canonical)]}const s=n.get("text-line-height")*Xc,a="viewport"!==n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement"),l=n.get("text-keep-upright"),c=n.get("text-size");for(const r of e.bucket.features){const u=n.get("text-font").evaluate(r,{},e.canonical).join(","),h=c.evaluate(r,{},e.canonical),p=o.layoutTextSize.evaluate(r,{},e.canonical),d=o.layoutIconSize.evaluate(r,{},e.canonical),f={horizontal:{},vertical:void 0},m=r.text;let g,y=[0,0];if(m){const o=m.toString(),c=n.get("text-letter-spacing").evaluate(r,{},e.canonical)*Xc,d=fo(o)?c:0,g=n.get("text-anchor").evaluate(r,{},e.canonical),_=Jh(i,r,e.canonical);if(!_){const t=n.get("text-radial-offset").evaluate(r,{},e.canonical);y=t?Kh(g,[t*Xc,Yh]):n.get("text-offset").evaluate(r,{},e.canonical).map((t=>t*Xc))}let v=a?"center":n.get("text-justify").evaluate(r,{},e.canonical);const x="point"===n.get("symbol-placement")?n.get("text-max-width").evaluate(r,{},e.canonical)*Xc:1/0,b=()=>{e.bucket.allowVerticalPlacement&&po(o)&&(f.vertical=du(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,"left",d,y,t.al.vertical,!0,p,h))};if(!a&&_){const i=new Set;if("auto"===v)for(let t=0;t<_.values.length;t+=2)i.add(Qh(_.values[t]));else i.add(v);let n=!1;for(const r of i)if(!f.horizontal[r])if(n)f.horizontal[r]=f.horizontal[0];else{const i=du(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,"center",r,d,y,t.al.horizontal,!1,p,h);i&&(f.horizontal[r]=i,n=1===i.positionedLines.length)}b()}else{"auto"===v&&(v=Qh(g));const i=du(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,v,d,y,t.al.horizontal,!1,p,h);i&&(f.horizontal[v]=i),b(),po(o)&&a&&l&&(f.vertical=du(m,e.glyphMap,e.glyphPositions,e.imagePositions,u,x,s,g,v,d,y,t.al.vertical,!1,p,h))}}let _=!1;if(r.icon&&r.icon.name){const t=e.imageMap[r.icon.name];t&&(g=ku(e.imagePositions[r.icon.name],n.get("icon-offset").evaluate(r,{},e.canonical),n.get("icon-anchor").evaluate(r,{},e.canonical)),_=!!t.sdf,void 0===e.bucket.sdfIcons?e.bucket.sdfIcons=_:e.bucket.sdfIcons!==_&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.bucket.pixelRatio||0!==n.get("icon-rotate").constantOr(1))&&(e.bucket.iconsNeedLinear=!0))}const v=ip(f.horizontal)||f.vertical;e.bucket.iconsInText=!!v&&v.iconsInText,(v||g)&&tp(e.bucket,r,f,g,e.imageMap,o,p,d,y,_,e.canonical,e.subdivisionGranularity)}e.showCollisionBoxes&&e.bucket.generateCollisionDebugBuffers()},t.cz=Pc,t.d=ht,t.e=F,t.f=t=>e(void 0,void 0,void 0,(function*(){if(0===t.byteLength)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(t)],{type:"image/png"});try{return createImageBitmap(e)}catch(t){throw new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),t.g=st,t.h=t=>new Promise(((e,i)=>{const n=new Image;n.onload=()=>{e(n),URL.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((()=>{n.src=H}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?URL.createObjectURL(r):H})),t.i=q,t.j=(t,e)=>ut(F(t,{type:"json"}),e),t.k=mt,t.l=ft,t.m=ut,t.n=(t,e)=>ut(F(t,{type:"arrayBuffer"}),e),t.o=function(t){return new Qc(t).readFields(eu,[])},t.p=ou,t.q=Qa,t.r=jo,t.s=J,t.t=Kr,t.u=ho,t.v=yt,t.w=V,t.x=eo,t.y=Yr,t.z=function([t,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:t*Math.cos(e)*Math.sin(i),y:t*Math.sin(e)*Math.sin(i),z:t*Math.cos(i)}}})),i("worker",["./shared"],(function(t){class e{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,i){for(const i of e){this._layerConfigs[i.id]=i;const e=this._layers[i.id]=t.bA(i);e._featureFilter=t.a7(e.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const n=t.ct(Object.values(this._layerConfigs),this.keyCache);for(const t of n){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(e)}}}class i{constructor(e){const i={},n=[];for(const t in e){const r=e[t],o=i[t]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};n.push(i),o[t]={rect:i,metrics:e.metrics}}}const{w:r,h:o}=t.p(n),s=new t.q({width:r||1,height:o||1});for(const n in e){const r=e[n];for(const e in r){const o=r[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[n][e].rect;t.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}t.cu("GlyphAtlas",i);class n{constructor(e){this.tileID=new t.Y(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(e,n,o,s,a){return t._(this,void 0,void 0,(function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new t.a5;const l=new t.cv(Object.keys(e.layers).sort()),c=new t.cw(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o,subdivisionGranularity:a},p=n.familiesBySource[this.source];for(const i in p){const n=e.layers[i];if(!n)continue;1===n.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(i),a=[];for(let t=0;t<n.length;t++){const e=n.feature(t),r=c.getId(e,i);a.push({feature:e,id:r,index:t,sourceLayerIndex:s})}for(const e of p[i]){const i=e[0];i.source!==this.source&&t.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(r(e,this.zoom,o),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(e.map((t=>t.id))))}}const d=t.bF(h.glyphDependencies,(t=>Object.keys(t).map(Number)));this.inFlightDependencies.forEach((t=>null==t?void 0:t.abort())),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(d).length){const t=new AbortController;this.inFlightDependencies.push(t),f=s.sendAsync({type:"GG",data:{stacks:d,source:this.source,tileID:this.tileID,type:"glyphs"}},t)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const t=new AbortController;this.inFlightDependencies.push(t),g=s.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},t)}const y=Object.keys(h.patternDependencies);let _=Promise.resolve({});if(y.length){const t=new AbortController;this.inFlightDependencies.push(t),_=s.sendAsync({type:"GI",data:{icons:y,source:this.source,tileID:this.tileID,type:"patterns"}},t)}const[v,x,b]=yield Promise.all([f,g,_]),w=new i(v),T=new t.cx(x,b);for(const e in u){const i=u[e];i instanceof t.a6?(r(i.layers,this.zoom,o),t.cy({bucket:i,glyphMap:v,glyphPositions:w.positions,imageMap:x,imagePositions:T.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):i.hasPattern&&(i instanceof t.cz||i instanceof t.cA||i instanceof t.cB)&&(r(i.layers,this.zoom,o),i.addFeatures(h,this.tileID.canonical,T.patternPositions))}return this.status="done",{buckets:Object.values(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,imageAtlas:T,glyphMap:this.returnDependencies?v:null,iconMap:this.returnDependencies?x:null,glyphPositions:this.returnDependencies?w.positions:null}}))}}function r(e,i,n){const r=new t.C(i);for(const t of e)t.recalculate(r,n)}class o{constructor(t,e,i){this.actor=t,this.layerIndex=e,this.availableImages=i,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const n=yield t.n(e.request,i);try{return{vectorTile:new t.cC.VectorTile(new t.cD(n.data)),rawData:n.data,cacheControl:n.cacheControl,expires:n.expires}}catch(t){const i=new Uint8Array(n.data);let r=`Unable to parse the tile at ${e.request.url}, `;throw r+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${t.message}`,new Error(r)}}))}loadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid,r=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cE(e.request),o=new n(e);this.loading[i]=o;const s=new AbortController;o.abort=s;try{const n=yield this.loadVectorTile(e,s);if(delete this.loading[i],!n)return null;const a=n.rawData,l={};n.expires&&(l.expires=n.expires),n.cacheControl&&(l.cacheControl=n.cacheControl);const c={};if(r){const t=r.finish();t&&(c.resourceTiming=JSON.parse(JSON.stringify(t)))}o.vectorTile=n.vectorTile;const u=o.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);this.loaded[i]=o,this.fetching[i]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const e=yield u;return t.e({rawTileData:a.slice(0)},e,l,c)}finally{delete this.fetching[i]}}catch(t){throw delete this.loading[i],o.status="done",this.loaded[i]=o,t}}))}reloadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.uid;if(!this.loaded||!this.loaded[i])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const n=this.loaded[i];if(n.showCollisionBoxes=e.showCollisionBoxes,"parsing"===n.status){const r=yield n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity);let o;if(this.fetching[i]){const{rawTileData:e,cacheControl:n,resourceTiming:s}=this.fetching[i];delete this.fetching[i],o=t.e({rawTileData:e.slice(0)},r,n,s)}else o=r;return o}if("done"===n.status&&n.vectorTile)return n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor,e.subdivisionGranularity)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){const t=this.loading,i=e.uid;t&&t[i]&&t[i].abort&&(t[i].abort.abort(),delete t[i])}))}removeTile(e){return t._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]}))}}class s{constructor(){this.loaded={}}loadTile(e){return t._(this,void 0,void 0,(function*(){const{uid:i,encoding:n,rawImageData:r,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=e,c=r.width+2,u=r.height+2,h=t.b(r)?new t.R({width:c,height:u},yield t.cF(r,-1,-1,c,u)):r,p=new t.cG(i,h,n,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[i]=p,p}))}removeTile(t){const e=this.loaded,i=t.uid;e&&e[i]&&delete e[i]}}var a,l,c=function(){if(l)return a;function t(t,i){if(0!==t.length){e(t[0],i);for(var n=1;n<t.length;n++)e(t[n],!i)}}function e(t,e){for(var i=0,n=0,r=0,o=t.length,s=o-1;r<o;s=r++){var a=(t[r][0]-t[s][0])*(t[s][1]+t[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!e&&t.reverse()}return l=1,a=function e(i,n){var r,o=i&&i.type;if("FeatureCollection"===o)for(r=0;r<i.features.length;r++)e(i.features[r],n);else if("GeometryCollection"===o)for(r=0;r<i.geometries.length;r++)e(i.geometries[r],n);else if("Feature"===o)e(i.geometry,n);else if("Polygon"===o)t(i.coordinates,n);else if("MultiPolygon"===o)for(r=0;r<i.coordinates.length;r++)t(i.coordinates[r],n);return i}}(),u=t.cH(c);const h=t.cC.VectorTileFeature.prototype.toGeoJSON;class p{constructor(e){this._feature=e,this.extent=t.Z,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return h.call(this,t,e,i)}}class d{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.Z,this.length=e.length,this._features=e}feature(t){return new p(this._features[t])}}var f,m,g,y={exports:{}},_=function(){if(g)return y.exports;g=1;var e=t.cK(),i=function(){if(m)return f;m=1;var e=t.cI(),i=t.cJ().VectorTileFeature;function n(t,e){this.options=e||{},this.features=t,this.length=t.length}function r(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}return f=n,n.prototype.feature=function(t){return new r(this.features[t],this.options.extent)},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var n=t[i],r=[],o=0;o<n.length;o++)r.push(new e(n[o][0],n[o][1]));this.geometry.push(r)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var l=s[a];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},r.prototype.toGeoJSON=i.prototype.toGeoJSON,f}();function n(t){var i=new e;return function(t,e){for(var i in t.layers)e.writeMessage(3,r,t.layers[i])}(t,i),i.finish()}function r(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,o,n);var r=n.keys;for(i=0;i<r.length;i++)e.writeStringField(3,r[i]);var s=n.values;for(i=0;i<s.length;i++)e.writeMessage(4,u,s[i])}function o(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,s,t),e.writeVarintField(3,i.type),e.writeMessage(4,c,i)}function s(t,e){var i=t.feature,n=t.keys,r=t.values,o=t.keycache,s=t.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),e.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,p=s[h];void 0===p&&(r.push(l),s[h]=p=r.length-1),e.writeVarint(p)}}}function a(t,e){return(e<<3)+(7&t)}function l(t){return t<<1^t>>31}function c(t,e){for(var i=t.loadGeometry(),n=t.type,r=0,o=0,s=i.length,c=0;c<s;c++){var u=i[c],h=1;1===n&&(h=u.length),e.writeVarint(a(1,h));for(var p=3===n?u.length-1:u.length,d=0;d<p;d++){1===d&&1!==n&&e.writeVarint(a(2,p-1));var f=u[d].x-r,m=u[d].y-o;e.writeVarint(l(f)),e.writeVarint(l(m)),r+=f,o+=m}3===n&&e.writeVarint(a(7,1))}}function u(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}return y.exports=n,y.exports.fromVectorTileJs=n,y.exports.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var o in t)r[o]=new i(t[o].features,e),r[o].name=o,r[o].version=e.version,r[o].extent=e.extent;return n({layers:r})},y.exports.GeoJSONWrapper=i,y.exports}(),v=t.cH(_);const x={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},b=Math.fround||(w=new Float32Array(1),t=>(w[0]=+t,w[0]));var w;const T=3,S=5,C=6;class E{constructor(t){this.options=Object.assign(Object.create(x),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:n}=this.options;e&&console.time("total time");const r=`prepare ${t.length} points`;e&&console.time(r),this.points=t;const o=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[n,r]=i.geometry.coordinates,s=b(A(n)),a=b(k(r));o.push(s,a,1/0,e,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[n+1]=this._createTree(o);e&&console.timeEnd(r);for(let t=n;t>=i;t--){const i=+Date.now();s=this.trees[t]=this._createTree(this._cluster(s,t)),e&&console.log("z%d: %d clusters in %dms",t,s.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let r=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,r=180;else if(i>r){const t=this.getClusters([i,n,180,o],e),s=this.getClusters([-180,n,r,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(A(i),k(o),A(r),k(n)),l=s.data,c=[];for(const t of a){const e=this.stride*t;c.push(l[e+S]>1?I(l,e,this.clusterProps):this.points[l[e+T]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.data;if(e*this.stride>=o.length)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o[e*this.stride],o[e*this.stride+1],s),l=[];for(const e of a){const i=e*this.stride;o[i+4]===t&&l.push(o[i+S]>1?I(o,i,this.clusterProps):this.points[o[i+T]])}if(0===l.length)throw new Error(n);return l}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((e-a)/r,l,(e+1+a)/r,c),n.data,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.data,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.data,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,r){const o=this.getChildren(e);for(const e of o){const o=e.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(t,o.cluster_id,i,n,r):r<n?r++:t.push(e),t.length===i)break}return r}_createTree(e){const i=new t.aF(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,n,r,o){for(const s of t){const t=s*this.stride,a=e[t+S]>1;let l,c,u;if(a)l=M(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+T]];l=i.properties;const[n,r]=i.geometry.coordinates;c=A(n),u=k(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let p;p=a||this.options.generateId?e[t+T]:this.points[e[t+T]].id,void 0!==p&&(h.id=p),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:n,reduce:r,minPoints:o}=this.options,s=i/(n*Math.pow(2,e)),a=t.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const n=a[i],u=a[i+1],h=t.within(a[i],a[i+1],s),p=a[i+S];let d=p;for(const t of h){const i=t*c;a[i+2]>e&&(d+=a[i+S])}if(d>p&&d>=o){let t,o=n*p,s=u*p,f=-1;const m=((i/c|0)<<5)+(e+1)+this.points.length;for(const n of h){const l=n*c;if(a[l+2]<=e)continue;a[l+2]=e;const u=a[l+S];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(t||(t=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(t)),r(t,this._map(a,l)))}a[i+4]=m,l.push(o/d,s/d,1/0,m,-1,d),r&&l.push(f)}else{for(let t=0;t<c;t++)l.push(a[i+t]);if(d>1)for(const t of h){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)l.push(a[i+t])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+S]>1){const n=this.clusterProps[t[e+C]];return i?Object.assign({},n):n}const n=this.points[t[e+T]].properties,r=this.options.map(n);return i&&r===n?Object.assign({},r):r}}function I(t,e,i){return{type:"Feature",id:t[e+T],properties:M(t,e,i),geometry:{type:"Point",coordinates:[(n=t[e],360*(n-.5)),P(t[e+1])]}};var n}function M(t,e,i){const n=t[e+S],r=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,o=t[e+C],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:t[e+T],point_count:n,point_count_abbreviated:r})}function A(t){return t/360+.5}function k(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function P(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function L(t,e,i,n){let r=n;const o=e+(i-e>>1);let s,a=i-e;const l=t[e],c=t[e+1],u=t[i],h=t[i+1];for(let n=e+3;n<i;n+=3){const e=z(t[n],t[n+1],l,c,u,h);if(e>r)s=n,r=e;else if(e===r){const t=Math.abs(n-o);t<a&&(s=n,a=t)}}r>n&&(s-e>3&&L(t,e,s,n),t[s+2]=r,i-s>3&&L(t,s,i,n))}function z(t,e,i,n,r,o){let s=r-i,a=o-n;if(0!==s||0!==a){const l=((t-i)*s+(e-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return s=t-i,a=e-n,s*s+a*a}function D(t,e,i,n){const r={id:null==t?null:t,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)R(r,i);else if("Polygon"===e)R(r,i[0]);else if("MultiLineString"===e)for(const t of i)R(r,t);else if("MultiPolygon"===e)for(const t of i)R(r,t[0]);return r}function R(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function O(t,e,i,n){if(!e.geometry)return;const r=e.geometry.coordinates;if(r&&0===r.length)return;const o=e.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=e.id;if(i.promoteId?l=e.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)F(r,a);else if("MultiPoint"===o)for(const t of r)F(t,a);else if("LineString"===o)N(r,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of r)a=[],N(i,a,s,!1),t.push(D(l,"LineString",a,e.properties));return}B(r,a,s,!1)}else if("Polygon"===o)B(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const r of e.geometry.geometries)O(t,{id:l,geometry:r,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of r){const e=[];B(t,e,s,!0),a.push(e)}}t.push(D(l,o,a,e.properties))}function F(t,e){e.push(j(t[0]),$(t[1]),0)}function N(t,e,i,n){let r,o,s=0;for(let i=0;i<t.length;i++){const a=j(t[i][0]),l=$(t[i][1]);e.push(a,l,0),i>0&&(s+=n?(r*l-a*o)/2:Math.sqrt(Math.pow(a-r,2)+Math.pow(l-o,2))),r=a,o=l}const a=e.length-3;e[2]=1,L(e,0,a,i),e[a+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function B(t,e,i,n){for(let r=0;r<t.length;r++){const o=[];N(t[r],o,i,n),e.push(o)}}function j(t){return t/360+.5}function $(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function U(t,e,i,n,r,o,s,a){if(n/=e,o>=(i/=e)&&s<n)return t;if(s<i||o>=n)return null;const l=[];for(const e of t){const t=e.geometry;let o=e.type;const s=0===r?e.minX:e.minY,c=0===r?e.maxX:e.maxY;if(s>=i&&c<n){l.push(e);continue}if(c<i||s>=n)continue;let u=[];if("Point"===o||"MultiPoint"===o)V(t,u,i,n,r);else if("LineString"===o)G(t,u,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===o)Z(t,u,i,n,r,!1);else if("Polygon"===o)Z(t,u,i,n,r,!0);else if("MultiPolygon"===o)for(const e of t){const t=[];Z(e,t,i,n,r,!0),t.length&&u.push(t)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const t of u)l.push(D(e.id,o,t,e.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(D(e.id,o,u,e.tags))}}return l.length?l:null}function V(t,e,i,n,r){for(let o=0;o<t.length;o+=3){const s=t[o+r];s>=i&&s<=n&&W(e,t[o],t[o+1],t[o+2])}}function G(t,e,i,n,r,o,s){let a=q(t);const l=0===r?H:X;let c,u,h=t.start;for(let p=0;p<t.length-3;p+=3){const d=t[p],f=t[p+1],m=t[p+2],g=t[p+3],y=t[p+4],_=0===r?d:f,v=0===r?g:y;let x=!1;s&&(c=Math.sqrt(Math.pow(d-g,2)+Math.pow(f-y,2))),_<i?v>i&&(u=l(a,d,f,g,y,i),s&&(a.start=h+c*u)):_>n?v<n&&(u=l(a,d,f,g,y,n),s&&(a.start=h+c*u)):W(a,d,f,m),v<i&&_>=i&&(u=l(a,d,f,g,y,i),x=!0),v>n&&_<=n&&(u=l(a,d,f,g,y,n),x=!0),!o&&x&&(s&&(a.end=h+c*u),e.push(a),a=q(t)),s&&(h+=c)}let p=t.length-3;const d=t[p],f=t[p+1],m=0===r?d:f;m>=i&&m<=n&&W(a,d,f,t[p+2]),p=a.length-3,o&&p>=3&&(a[p]!==a[0]||a[p+1]!==a[1])&&W(a,a[0],a[1],a[2]),a.length&&e.push(a)}function q(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function Z(t,e,i,n,r,o){for(const s of t)G(s,e,i,n,r,o,!1)}function W(t,e,i,n){t.push(e,i,n)}function H(t,e,i,n,r,o){const s=(o-e)/(n-e);return W(t,o,i+(r-i)*s,1),s}function X(t,e,i,n,r,o){const s=(o-i)/(r-i);return W(t,e+(n-e)*s,o,1),s}function Y(t,e){const i=[];for(let n=0;n<t.length;n++){const r=t[n],o=r.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=K(r.geometry,e);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const t of r.geometry)s.push(K(t,e))}else if("MultiPolygon"===o){s=[];for(const t of r.geometry){const i=[];for(const n of t)i.push(K(n,e));s.push(i)}}i.push(D(r.id,o,s,r.tags))}return i}function K(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function J(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,r=t.y;for(const o of t.features){const t=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<t.length;s+=2)o.geometry.push(Q(t[s],t[s+1],e,i,n,r));else for(let s=0;s<t.length;s++){const a=[];for(let o=0;o<t[s].length;o+=2)a.push(Q(t[s][o],t[s][o+1],e,i,n,r));o.geometry.push(a)}}return t.transformed=!0,t}function Q(t,e,i,n,r,o){return[Math.round(i*(t*n-r)),Math.round(i*(e*n-o))]}function tt(t,e,i,n,r){const o=e===r.maxZoom?0:r.tolerance/((1<<e)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)et(s,e,o,r);return s}function et(t,e,i,n){const r=e.geometry,o=e.type,s=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(let e=0;e<r.length;e+=3)s.push(r[e],r[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)it(s,r,t,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let e=0;e<r.length;e++)it(s,r[e],t,i,"Polygon"===o,0===e);else if("MultiPolygon"===o)for(let e=0;e<r.length;e++){const n=r[e];for(let e=0;e<n.length;e++)it(s,n[e],t,i,!0,0===e)}if(s.length){let i=e.tags||null;if("LineString"===o&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=r.start/r.size,i.mapbox_clip_end=r.end/r.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a)}}function it(t,e,i,n,r,o){const s=n*n;if(n>0&&e.size<(r?s:n))return void(i.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===n||e[t+2]>s)&&(i.numSimplified++,a.push(e[t],e[t+1])),i.numPoints++;r&&function(t,e){let i=0;for(let e=0,n=t.length,r=n-2;e<n;r=e,e+=2)i+=(t[e]-t[r])*(t[e+1]+t[r+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const n=t[e],r=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=n,t[i-1-e]=r}}(a,o),t.push(a)}const nt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rt{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(nt),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)O(i,t.features[n],e,n);else O(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const r=U(t,1,-1-i,i,0,-1,2,e),o=U(t,1,1-i,2+i,0,-1,2,e);return(r||o)&&(n=U(t,1,-i,1+i,0,-1,2,e)||[],r&&(n=Y(r,1).concat(n)),o&&(n=n.concat(Y(o,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,n,r,o,s){const a=[t,e,i,n],l=this.options,c=l.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const u=1<<e,h=ot(e,i,n);let p=this.tiles[h];if(!p&&(c>1&&console.time("creation"),p=this.tiles[h]=tt(t,e,i,n,l),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(p.source=t,null==r){if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue}else{if(e===l.maxZoom||e===r)continue;if(null!=r){const t=r-e;if(i!==o>>t||n!==s>>t)continue}}if(p.source=null,0===t.length)continue;c>1&&console.time("clipping");const d=.5*l.buffer/l.extent,f=.5-d,m=.5+d,g=1+d;let y=null,_=null,v=null,x=null,b=U(t,u,i-d,i+m,0,p.minX,p.maxX,l),w=U(t,u,i+f,i+g,0,p.minX,p.maxX,l);t=null,b&&(y=U(b,u,n-d,n+m,1,p.minY,p.maxY,l),_=U(b,u,n+f,n+g,1,p.minY,p.maxY,l),b=null),w&&(v=U(w,u,n-d,n+m,1,p.minY,p.maxY,l),x=U(w,u,n+f,n+g,1,p.minY,p.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(y||[],e+1,2*i,2*n),a.push(_||[],e+1,2*i,2*n+1),a.push(v||[],e+1,2*i+1,2*n),a.push(x||[],e+1,2*i+1,2*n+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:r,debug:o}=n;if(t<0||t>24)return null;const s=1<<t,a=ot(t,e=e+s&s-1,i);if(this.tiles[a])return J(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let l,c=t,u=e,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[ot(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,t,e,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?J(this.tiles[a],r):null):null}}function ot(t,e,i){return 32*((1<<t)*i+e)+t}function st(t,e){return e?t.properties[e]:t.id}function at(t,e){if(null==t)return!0;if("Feature"===t.type)return null!=st(t,e);if("FeatureCollection"===t.type){const i=new Set;for(const n of t.features){const t=st(n,e);if(null==t)return!1;if(i.has(t))return!1;i.add(t)}return!0}return!1}function lt(t,e){const i=new Map;if(null==t);else if("Feature"===t.type)i.set(st(t,e),t);else for(const n of t.features)i.set(st(n,e),n);return i}class ct extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,i){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(t.z,t.x,t.y);if(!i)return null;const n=new d(i.features);let r=v(n);return 0===r.byteOffset&&r.byteLength===r.buffer.byteLength||(r=new Uint8Array(r)),{vectorTile:n,rawData:r.buffer}}))}loadData(e){return t._(this,void 0,void 0,(function*(){var i;null===(i=this._pendingRequest)||void 0===i||i.abort();const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.cE(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest),this._geoJSONIndex=e.cluster?new E(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const n={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys();for(const e of a){const[n,r]=i[e];t.cL(r),t.cL("string"==typeof n?[n,["accumulated"],["get",e]]:n)}return e.map=t=>{const e={};for(const t of a)e[t]=n[t].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const e of a)o.accumulated=t[e],t[e]=r[e].evaluate(o,s)},e}(e)).load((yield this._pendingData).features):(r=yield this._pendingData,new rt(r,e.geojsonVtOptions)),this.loaded={};const i={};if(n){const t=n.finish();t&&(i.resourceTiming={},i.resourceTiming[e.source]=JSON.parse(JSON.stringify(t)))}return i}catch(e){if(delete this._pendingRequest,t.cp(e))return{abandoned:!0};throw e}var r}))}getData(){return t._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(t){const e=this.loaded;return e&&e[t.uid]?super.reloadTile(t):this.loadTile(t)}loadAndProcessGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){let n=yield this.loadGeoJSON(e,i);if(delete this._pendingRequest,"object"!=typeof n)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(u(n,!0),e.filter){const i=t.cL(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));const r=n.features.filter((t=>i.value.evaluate({zoom:0},t)));n={type:"FeatureCollection",features:r}}return n}))}loadGeoJSON(e,i){return t._(this,void 0,void 0,(function*(){const{promoteId:n}=e;if(e.request){const r=yield t.j(e.request,i);return this._dataUpdateable=at(r.data,n)?lt(r.data,n):void 0,r.data}if("string"==typeof e.data)try{const t=JSON.parse(e.data);return this._dataUpdateable=at(t,n)?lt(t,n):void 0,t}catch(t){throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`)}if(!e.dataDiff)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${e.source}`);return function(t,e,i){var n,r,o,s;if(e.removeAll&&t.clear(),e.remove)for(const i of e.remove)t.delete(i);if(e.add)for(const n of e.add){const e=st(n,i);null!=e&&t.set(e,n)}if(e.update)for(const i of e.update){let e=t.get(i.id);if(null==e)continue;const a=!i.removeAllProperties&&((null===(n=i.removeProperties)||void 0===n?void 0:n.length)>0||(null===(r=i.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(e=Object.assign({},e),t.set(i.id,e),a&&(e.properties=Object.assign({},e.properties))),i.newGeometry&&(e.geometry=i.newGeometry),i.removeAllProperties)e.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const t of i.removeProperties)Object.prototype.hasOwnProperty.call(e.properties,t)&&delete e.properties[t];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:t,value:n}of i.addOrUpdateProperties)e.properties[t]=n}}(this._dataUpdateable,e.dataDiff,n),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(e){return t._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(t){return this._geoJSONIndex.getClusterExpansionZoom(t.clusterId)}getClusterChildren(t){return this._geoJSONIndex.getChildren(t.clusterId)}getClusterLeaves(t){return this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset)}}class ut{constructor(e){this.self=e,this.actor=new t.H(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,e)=>{if(this.externalWorkerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.externalWorkerSourceTypes[t]=e},this.self.addProtocol=t.cr,this.self.removeProtocol=t.cs,this.self.registerRTLTextPlugin=e=>{t.cM.setMethods(e)},this.actor.registerMessageHandler("LDT",((t,e)=>this._getDEMWorkerSource(t,e.source).loadTile(e))),this.actor.registerMessageHandler("RDT",((e,i)=>t._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(e,i.source).removeTile(i)})))),this.actor.registerMessageHandler("GCEZ",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterExpansionZoom(i)})))),this.actor.registerMessageHandler("GCC",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterChildren(i)})))),this.actor.registerMessageHandler("GCL",((e,i)=>t._(this,void 0,void 0,(function*(){return this._getWorkerSource(e,i.type,i.source).getClusterLeaves(i)})))),this.actor.registerMessageHandler("LD",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadData(e))),this.actor.registerMessageHandler("GD",((t,e)=>this._getWorkerSource(t,e.type,e.source).getData())),this.actor.registerMessageHandler("LT",((t,e)=>this._getWorkerSource(t,e.type,e.source).loadTile(e))),this.actor.registerMessageHandler("RT",((t,e)=>this._getWorkerSource(t,e.type,e.source).reloadTile(e))),this.actor.registerMessageHandler("AT",((t,e)=>this._getWorkerSource(t,e.type,e.source).abortTile(e))),this.actor.registerMessageHandler("RMT",((t,e)=>this._getWorkerSource(t,e.type,e.source).removeTile(e))),this.actor.registerMessageHandler("RS",((e,i)=>t._(this,void 0,void 0,(function*(){if(!this.workerSources[e]||!this.workerSources[e][i.type]||!this.workerSources[e][i.type][i.source])return;const t=this.workerSources[e][i.type][i.source];delete this.workerSources[e][i.type][i.source],void 0!==t.removeSource&&t.removeSource(i)})))),this.actor.registerMessageHandler("RM",(e=>t._(this,void 0,void 0,(function*(){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e]})))),this.actor.registerMessageHandler("SR",((e,i)=>t._(this,void 0,void 0,(function*(){this.referrer=i})))),this.actor.registerMessageHandler("SRPS",((t,e)=>this._syncRTLPluginState(t,e))),this.actor.registerMessageHandler("IS",((e,i)=>t._(this,void 0,void 0,(function*(){this.self.importScripts(i)})))),this.actor.registerMessageHandler("SI",((t,e)=>this._setImages(t,e))),this.actor.registerMessageHandler("UL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).update(i.layers,i.removedIds)})))),this.actor.registerMessageHandler("SL",((e,i)=>t._(this,void 0,void 0,(function*(){this._getLayerIndex(e).replace(i)}))))}_setImages(e,i){return t._(this,void 0,void 0,(function*(){this.availableImages[e]=i;for(const t in this.workerSources[e]){const n=this.workerSources[e][t];for(const t in n)n[t].availableImages=i}}))}_syncRTLPluginState(e,i){return t._(this,void 0,void 0,(function*(){return yield t.cM.syncState(i,this.self.importScripts)}))}_getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}_getLayerIndex(t){let i=this.layerIndexes[t];return i||(i=this.layerIndexes[t]=new e),i}_getWorkerSource(t,e,i){if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][i]){const n={sendAsync:(e,i)=>(e.targetMapId=t,this.actor.sendAsync(e,i))};switch(e){case"vector":this.workerSources[t][e][i]=new o(n,this._getLayerIndex(t),this._getAvailableImages(t));break;case"geojson":this.workerSources[t][e][i]=new ct(n,this._getLayerIndex(t),this._getAvailableImages(t));break;default:this.workerSources[t][e][i]=new this.externalWorkerSourceTypes[e](n,this._getLayerIndex(t),this._getAvailableImages(t))}}return this.workerSources[t][e][i]}_getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new s),this.demWorkerSources[t][e]}}return t.i(self)&&(self.worker=new ut(self)),ut})),i("index",["exports","./shared"],(function(t,e){var i="5.5.0";function n(){var t=new e.A(4);return e.A!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}let r,o;const s={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(t,i,n){const r=requestAnimationFrame((t=>{o(),i(t)})),{unsubscribe:o}=e.s(t.signal,"abort",(()=>{o(),cancelAnimationFrame(r),n(e.c())}),!1)},frameAsync(t){return new Promise(((e,i)=>{this.frame(t,e,i)}))},getImageData(t,e=0){return this.getImageCanvasContext(t).getImageData(-e,-e,t.width+2*e,t.height+2*e)},getImageCanvasContext(t){const e=window.document.createElement("canvas"),i=e.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0,t.width,t.height),i},resolveURL:t=>(r||(r=document.createElement("a")),r.href=t,r.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==o&&(o=matchMedia("(prefers-reduced-motion: reduce)")),o.matches)}};class a{static testProp(t){if(!a.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in a.docStyle)return t[e];return t[0]}static create(t,e,i){const n=window.document.createElement(t);return void 0!==e&&(n.className=e),i&&i.appendChild(n),n}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(t,e){t.style[a.transformProp]=e}static addEventListener(t,e,i,n={}){t.addEventListener(e,i,"passive"in n?n:n.capture)}static removeEventListener(t,e,i,n={}){t.removeEventListener(e,i,"passive"in n?n:n.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",a.suppressClickInternal,!0)}),0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,i,n){const r=i.boundingClientRect;return new e.P((n.clientX-r.left)/i.x-t.clientLeft,(n.clientY-r.top)/i.y-t.clientTop)}static mousePos(t,e){const i=a.getScale(t);return a.getPoint(t,i,e)}static touchPos(t,e){const i=[],n=a.getScale(t);for(let r=0;r<e.length;r++)i.push(a.getPoint(t,n,e[r]));return i}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const e=(new DOMParser).parseFromString(t,"text/html").body||document.createElement("body"),i=e.querySelectorAll("script");for(const t of i)t.remove();return a.clean(e),e.innerHTML}static isPossiblyDangerous(t,e){const i=e.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!i.includes("javascript:")&&!i.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const e=t.children;for(const t of e)a.removeAttributes(t),a.clean(t)}static removeAttributes(t){for(const{name:e,value:i}of t.attributes)a.isPossiblyDangerous(e,i)&&t.removeAttribute(e)}}a.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(t){!h&&u&&(p?d(t):c=t)}};let c,u,h=!1,p=!1;function d(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),t.isContextLost())return;l.supported=!0}catch(t){}t.deleteTexture(e),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&d(c),c=null,p=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(t){let i,n,r,o;t.resetRequestQueue=()=>{i=[],n=0,r=0,o={}},t.addThrottleControl=t=>{const e=r++;return o[e]=t,e},t.removeThrottleControl=t=>{delete o[t],a()},t.getImage=(t,n,r=!0)=>new Promise(((o,s)=>{l.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),e.e(t,{type:"image"}),i.push({abortController:n,requestParameters:t,supportImageRefresh:r,state:"queued",onError:t=>{s(t)},onSuccess:t=>{o(t)}}),a()}));const s=t=>e._(this,void 0,void 0,(function*(){t.state="running";const{requestParameters:i,supportImageRefresh:r,onError:o,onSuccess:s,abortController:l}=t,u=!1===r&&!e.i(self)&&!e.g(i.url)&&(!i.headers||Object.keys(i.headers).reduce(((t,e)=>t&&"accept"===e),!0));n++;const h=u?c(i,l):e.m(i,l);try{const i=yield h;delete t.abortController,t.state="completed",i.data instanceof HTMLImageElement||e.b(i.data)?s(i):i.data&&s({data:yield(p=i.data,"function"==typeof createImageBitmap?e.f(p):e.h(p)),cacheControl:i.cacheControl,expires:i.expires})}catch(e){delete t.abortController,o(e)}finally{n--,a()}var p})),a=()=>{const t=(()=>{for(const t of Object.keys(o))if(o[t]())return!0;return!1})()?e.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:e.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let e=n;e<t&&i.length>0;e++){const t=i.shift();t.abortController.signal.aborted?e--:s(t)}},c=(t,i)=>new Promise(((n,r)=>{const o=new Image,s=t.url,a=t.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!e.d(s))&&(o.crossOrigin="anonymous"),i.signal.addEventListener("abort",(()=>{o.src="",r(e.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,n({data:o})},o.onerror=()=>{o.onerror=o.onload=null,i.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(f||(f={})),f.resetRequestQueue();class m{constructor(t){this._transformRequestFn=t}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function g(t){const e=[];if("string"==typeof t)e.push({id:"default",url:t});else if(t&&t.length>0){const i=[];for(const{id:n,url:r}of t){const t=`${n}${r}`;-1===i.indexOf(t)&&(i.push(t),e.push({id:n,url:r}))}}return e}function y(t,e,i){try{const n=new URL(t);return n.pathname+=`${e}${i}`,n.toString()}catch(e){throw new Error(`Invalid sprite URL "${t}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class _{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,i,n){const{width:r,height:o}=t,s=!(this.size&&this.size[0]===r&&this.size[1]===o||n),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[r,o],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,t):l.texImage2D(l.TEXTURE_2D,0,this.format,r,o,0,this.format,l.UNSIGNED_BYTE,t.data);else{const{x:i,y:s}=n||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||e.b(t)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,t):l.texSubImage2D(l.TEXTURE_2D,0,i,s,r,o,l.RGBA,l.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D),a.pixelStoreUnpackFlipY.setDefault(),a.pixelStoreUnpack.setDefault(),a.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,e,i){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),i!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class x extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,promiseResolve:e}of this.requestors)e(this._getImagesForIds(t));this.requestors=[]}}getImage(t){const i=this.images[t];if(i&&!i.data&&i.spriteData){const t=i.spriteData;i.data=new e.R({width:t.width,height:t.height},t.context.getImageData(t.x,t.y,t.width,t.height).data),i.spriteData=null}return i}addImage(t,e){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,e)&&(this.images[t]=e)}_validate(t,i){let n=!0;const r=i.data||i.spriteData;return this._validateStretch(i.stretchX,r&&r.width)||(this.fire(new e.k(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,r&&r.height)||(this.fire(new e.k(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.k(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){if(!t)return!0;if(4!==t.length)return!1;const i=e.spriteData,n=i&&i.width||e.data.width,r=i&&i.height||e.data.height;return!(t[0]<0||n<t[0]||t[1]<0||r<t[1]||t[2]<0||n<t[2]||t[3]<0||r<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,e,i=!0){const n=this.getImage(t);if(i&&(n.data.width!==e.data.width||n.data.height!==e.data.height))throw new Error(`size mismatch between old image (${n.data.width}x${n.data.height}) and new image (${e.data.width}x${e.data.height}).`);e.version=n.version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((e,i)=>{let n=!0;if(!this.isLoaded())for(const e of t)this.images[e]||(n=!1);this.isLoaded()||n?e(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:e})}))}_getImagesForIds(t){const i={};for(const n of t){let t=this.getImage(n);t||(this.fire(new e.l("styleimagemissing",{id:n})),t=this.getImage(n)),t?i[n]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,textFitWidth:t.textFitWidth,textFitHeight:t.textFitHeight,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(t){const i=this.patterns[t],n=this.getImage(t);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new e.I(i,n);this.patterns[t]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const e=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _(t,this.atlasImage,e.RGBA),this.atlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:n}=e.p(t),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],n=i.x+1,o=i.y+1,s=this.getImage(t).data,a=s.width,l=s.height;e.R.copy(s,r,{x:0,y:0},{x:n,y:o},{width:a,height:l}),e.R.copy(s,r,{x:0,y:l-1},{x:n,y:o-1},{width:a,height:1}),e.R.copy(s,r,{x:0,y:0},{x:n,y:o+l},{width:a,height:1}),e.R.copy(s,r,{x:a-1,y:0},{x:n-1,y:o},{width:1,height:l}),e.R.copy(s,r,{x:0,y:0},{x:n+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const i of t){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const t=this.getImage(i);t||e.w(`Image with ID: "${i}" was not found`),v(t)&&this.updateImage(i,t)}}}const b=1e20;function w(t,e,i,n,r,o,s,a,l){for(let c=e;c<e+n;c++)T(t,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)T(t,c*o+e,1,n,s,a,l)}function T(t,e,i,n,r,o,s){o[0]=0,s[0]=-1e20,s[1]=b,r[0]=t[e];for(let a=1,l=0,c=0;a<n;a++){r[a]=t[e+a*i];const n=a*a;do{const t=o[l];c=(r[a]-r[t]+n-t*t)/(a-t)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=b}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;t[e+a*i]=r[n]+c*c}}class S{constructor(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return e._(this,void 0,void 0,(function*(){const e=[];for(const i in t)for(const n of t[i])e.push(this._getAndCacheGlyphsPromise(i,n));const i=yield Promise.all(e),n={};for(const{stack:t,id:e,glyph:r}of i)n[t]||(n[t]={}),n[t][e]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};return n}))}_getAndCacheGlyphsPromise(t,i){return e._(this,void 0,void 0,(function*(){let e=this.entries[t];e||(e=this.entries[t]={glyphs:{},requests:{},ranges:{}});let n=e.glyphs[i];if(void 0!==n)return{stack:t,id:i,glyph:n};if(n=this._tinySDF(e,t,i),n)return e.glyphs[i]=n,{stack:t,id:i,glyph:n};const r=Math.floor(i/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(e.ranges[r])return{stack:t,id:i,glyph:n};if(!this.url)throw new Error("glyphsUrl is not set");if(!e.requests[r]){const i=S.loadGlyphRange(t,r,this.url,this.requestManager);e.requests[r]=i}const o=yield e.requests[r];for(const t in o)this._doesCharSupportLocalGlyph(+t)||(e.glyphs[+t]=o[+t]);return e.ranges[r]=!0,{stack:t,id:i,glyph:o[i]||null}}))}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))||e.u["CJK Unified Ideographs"](t)||e.u["Hangul Syllables"](t)||e.u.Hiragana(t)||e.u.Katakana(t)||e.u["CJK Symbols and Punctuation"](t)||e.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,i,n){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(n))return;let o=t.tinySDF;if(!o){let e="400";/bold/i.test(i)?e="900":/medium/i.test(i)?e="500":/light/i.test(i)&&(e="200"),o=t.tinySDF=new S.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:e})}const s=o.draw(String.fromCharCode(n));return{id:n,bitmap:new e.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}S.loadGlyphRange=function(t,i,n,r){return e._(this,void 0,void 0,(function*(){const o=256*i,s=o+255,a=r.transformRequest(n.replace("{fontstack}",t).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield e.n(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${i}, ${o}-${s}`);const c={};for(const t of e.o(l.data))c[t.id]=t;return c}))},S.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${t}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),p=new Uint8ClampedArray(h),d={data:p,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return d;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(b,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const i=_.data[4*(t*a+e)+3]/255;if(0===i)continue;const n=(t+m)*c+e+m;if(1===i)y[n]=0,g[n]=b;else{const t=.5-i;y[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}w(y,0,0,c,u,c,this.f,this.v,this.z),w(g,m,m,a,l,c,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(y[t])-Math.sqrt(g[t]);p[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return d}};class C{constructor(){this.specification=e.v.light.position}possiblyEvaluate(t,i){return e.z(t.expression.evaluate(i))}interpolate(t,i,n){return{x:e.B.number(t.x,i.x,n),y:e.B.number(t.y,i.y,n),z:e.B.number(t.z,i.z,n)}}}let E;class I extends e.E{constructor(t){super(),E=E||new e.r({anchor:new e.D(e.v.light.anchor),position:new C,color:new e.D(e.v.light.color),intensity:new e.D(e.v.light.intensity)}),this._transitionable=new e.T(E),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.t,t,i))for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.x(this,t.call(e.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v}))}}const M=new e.r({"sky-color":new e.D(e.v.sky["sky-color"]),"horizon-color":new e.D(e.v.sky["horizon-color"]),"fog-color":new e.D(e.v.sky["fog-color"]),"fog-ground-blend":new e.D(e.v.sky["fog-ground-blend"]),"horizon-fog-blend":new e.D(e.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new e.D(e.v.sky["sky-horizon-blend"]),"atmosphere-blend":new e.D(e.v.sky["atmosphere-blend"])});class A extends e.E{constructor(t){super(),this._transitionable=new e.T(M),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.C(0))}setSky(t,i={}){if(!this._validate(e.F,t,i)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const e in t){const i=t[e];e.endsWith("-transition")?this._transitionable.setTransition(e.slice(0,-11),i):this._transitionable.setValue(e,i)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,i,n={}){return!1!==(null==n?void 0:n.validate)&&e.x(this,t.call(e.y,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class k{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,e){const i=t.join(",")+String(e);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(t,e)),this.dashEntry[i]}getDashRanges(t,e,i){const n=[];let r=t.length%2==1?-t[t.length-1]*i:0,o=t[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){s=!s;const l=t[e];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(t,e,i){const n=e/2;for(let e=-i;e<=i;e++){const r=this.width*(this.nextRow+i+e);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const p=e/i*(n+1);if(s.isDash){const t=n-Math.abs(p);h=Math.sqrt(u*u+t*t)}else h=n-Math.sqrt(u*u+p*p);this.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t){for(let e=t.length-1;e>=0;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const e=t[0],i=t[t.length-1];e.isDash===i.isDash&&(e.left=i.left-this.width,i.right=e.right+this.width);const n=this.width*this.nextRow;let r=0,o=t[r];for(let e=0;e<this.width;e++){e/o.right>1&&(o=t[++r]);const i=Math.abs(e-o.left),s=Math.abs(e-o.right),a=Math.min(i,s);this.data[n+e]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(t,i){const n=i?7:0,r=2*n+1;if(this.nextRow+r>this.height)return e.w("LineAtlas out of space"),null;let o=0;for(let e=0;e<t.length;e++)o+=t[e];if(0!==o){const e=this.width/o,r=this.getDashRanges(t,this.width,e);i?this.addRoundDash(r,e,n):this.addRegularDash(r)}const s={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:o};return this.nextRow+=r,this.dirty=!0,s}bind(t){const e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))}}const P="maplibre_preloaded_worker_pool";class L{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<L.workerCount;)this.workers.push(new Worker(e.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[P]}numActive(){return Object.keys(this.active).length}}const z=Math.floor(s.hardwareConcurrency/2);let D,R;function O(){return D||(D=new L),D}L.workerCount=e.G(globalThis)?Math.max(Math.min(z,3),1):1;class F{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=i;const n=this.workerPool.acquire(i);for(let t=0;t<n.length;t++){const r=new e.H(n[t],i);r.name=`Worker ${t}`,this.actors.push(r)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,e){const i=[];for(const n of this.actors)i.push(n.sendAsync({type:t,data:e}));return Promise.all(i)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((t=>{t.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,e){for(const i of this.actors)i.registerMessageHandler(t,e)}}function N(){return R||(R=new F(O(),e.J),R.registerMessageHandler("GR",((t,i,n)=>e.m(i,n)))),R}function B(t,i){const n=e.K();return e.L(n,n,[1,1,0]),e.M(n,n,[.5*t.width,.5*t.height,1]),t.calculatePosMatrix?e.N(n,n,t.calculatePosMatrix(i.toUnwrapped())):n}function j(t,e,i,n,r,o,s){var a;const l=function(t,e,i){if(t)for(const n of t){const t=e[n];if(t&&t.source===i&&"fill-extrusion"===t.type)return!0}else for(const t in e){const n=e[t];if(n.source===i&&"fill-extrusion"===n.type)return!0}return!1}(null!==(a=null==r?void 0:r.layers)&&void 0!==a?a:null,e,t.id),c=o.maxPitchScaleFactor(),u=t.tilesIn(n,c,l);u.sort($);const h=[];for(const n of u)h.push({wrappedTileID:n.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,i,t._state,n.queryGeometry,n.cameraQueryGeometry,n.scale,r,o,c,B(t.transform,n.tileID),s?(t,e)=>s(n.tileID,t,e):void 0)});return function(t,e){for(const i in t)for(const n of t[i])U(n,e);return t}(function(t){const e={},i={};for(const n of t){const t=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in t){const n=t[i],r=o[i]=o[i]||{},s=e[i]=e[i]||[];for(const t of n)r[t.featureIndex]||(r[t.featureIndex]=!0,s.push(t))}}return e}(h),t)}function $(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function U(t,e){const i=t.feature,n=e.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=n}function V(t,i,n){return e._(this,void 0,void 0,(function*(){let r=t;if(t.url?r=(yield e.j(i.transformRequest(t.url,"Source"),n)).data:yield s.frameAsync(n),!r)return null;const o=e.O(e.e(r,t),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(o.vectorLayerIds=r.vector_layers.map((t=>t.id))),o}))}class G{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof e.Q?new e.Q(t.lng,t.lat):e.Q.convert(t),this}setSouthWest(t){return this._sw=t instanceof e.Q?new e.Q(t.lng,t.lat):e.Q.convert(t),this}extend(t){const i=this._sw,n=this._ne;let r,o;if(t instanceof e.Q)r=t,o=t;else{if(!(t instanceof G))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(G.convert(t)):this.extend(e.Q.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(e.Q.convert(t)):this;if(r=t._sw,o=t._ne,!r||!o)return this}return i||n?(i.lng=Math.min(r.lng,i.lng),i.lat=Math.min(r.lat,i.lat),n.lng=Math.max(o.lng,n.lng),n.lat=Math.max(o.lat,n.lat)):(this._sw=new e.Q(r.lng,r.lat),this._ne=new e.Q(o.lng,o.lat)),this}getCenter(){return new e.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new e.Q(this.getWest(),this.getNorth())}getSouthEast(){return new e.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:n}=e.Q.convert(t);let r=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(t){return t instanceof G?t:t?new G(t):t}static fromLngLat(t,i=0){const n=360*i/40075017,r=n/Math.cos(Math.PI/180*t.lat);return new G(new e.Q(t.lng-r,t.lat-n),new e.Q(t.lng+r,t.lat+n))}adjustAntiMeridian(){const t=new e.Q(this._sw.lng,this._sw.lat),i=new e.Q(this._ne.lng,this._ne.lat);return new G(t,t.lng>i.lng?new e.Q(i.lng+360,i.lat):i)}}class q{constructor(t,e,i){this.bounds=G.convert(this.validateBounds(t)),this.minzoom=e||0,this.maxzoom=i||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.U(this.bounds.getWest())*i),r=Math.floor(e.S(this.bounds.getNorth())*i),o=Math.ceil(e.U(this.bounds.getEast())*i),s=Math.ceil(e.S(this.bounds.getSouth())*i);return t.x>=n&&t.x<o&&t.y>=r&&t.y<s}}class Z extends e.E{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.O(i,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(e.e(this,t),t.bounds&&(this.tileBounds=new q(t.bounds,this.minzoom,this.maxzoom)),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new e.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return e.e({},this._options)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(e,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.request.collectResourceTiming=this._collectResourceTiming;let n="RT";if(t.actor&&"expired"!==t.state){if("loading"===t.state)return new Promise(((e,i)=>{t.reloadPromise={resolve:e,reject:i}}))}else t.actor=this.dispatcher.getActor(),n="LT";t.abortController=new AbortController;try{const e=yield t.actor.sendAsync({type:n,data:i},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,e)}catch(e){if(delete t.abortController,t.aborted)return;if(e&&404!==e.status)throw e;this._afterTileLoadWorkerResponse(t,null)}}))}_afterTileLoadWorkerResponse(t,e){if(e&&e.resourceTiming&&(t.resourceTiming=e.resourceTiming),e&&this.map._refreshExpiredTiles&&t.setExpiryData(e),t.loadVectorData(e,this.map.painter),t.reloadPromise){const e=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(e.resolve).catch(e.reject)}}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class W extends e.E{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},i),e.e(this,e.O(i,["url","scheme","tileSize"]))}load(){return e._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(e.e(this,i),i.bounds&&(this.tileBounds=new q(i.bounds,this.minzoom,this.maxzoom)),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(t){this._tileJSONRequest=null,this.fire(new e.k(t))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return e.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(e,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const e=this.map.painter.context,n=e.gl,r=i.data;t.texture=this.map.painter.getTileTexture(r.width),t.texture?t.texture.update(r,{useMipmap:!0}):(t.texture=new _(e,r,n.RGBA,{useMipmap:!0}),t.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE,n.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class H extends W{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(i,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const i=yield f.getImage(n,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(i&&i.data){const n=i.data;this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&t.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const r=e.b(n)&&e.V()?n:yield this.readImageNow(n),o={type:this.type,uid:t.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||"expired"===t.state){t.actor=this.dispatcher.getActor();const e=yield t.actor.sendAsync({type:"LDT",data:o});t.dem=e,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(e){if(delete t.abortController,t.aborted)t.state="unloaded";else if(e)throw t.state="errored",e}}))}readImageNow(t){return e._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&e.W()){const i=t.width+2,n=t.height+2;try{return new e.R({width:i,height:n},yield e.X(t,-1,-1,i,n))}catch(t){}}return s.getImageData(t,1)}))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+n)%n,a=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.Y(t.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new e.Y(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.Y(t.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new e.Y(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.Y(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.Y(t.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new e.Y(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.Y(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}class X extends e.E{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,void 0!==i.clusterMaxZoom&&this.maxzoom<=i.clusterMaxZoom&&e.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=e.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==i.buffer?i.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==i.tolerance?i.tolerance:.375),extent:e.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(e.Z/this.tileSize)}load(){return e._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return e._(this,void 0,void 0,(function*(){const t=e.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getCoordinatesFromGeometry(t){return"GeometryCollection"===t.type?t.geometries.map((t=>t.coordinates)).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return e._(this,void 0,void 0,(function*(){const t=new G,e=yield this.getData();let i;switch(e.type){case"FeatureCollection":i=e.features.map((t=>this.getCoordinatesFromGeometry(t.geometry))).flat(1/0);break;case"Feature":i=this.getCoordinatesFromGeometry(e.geometry);break;default:i=this.getCoordinatesFromGeometry(e)}if(0==i.length)return t;for(let e=0;e<i.length-1;e+=2)t.extend([i[e],i[e+1]]);return t}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(void 0!==t.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),void 0!==t.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,e,i){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:e,offset:i}})}_updateWorkerData(t){return e._(this,void 0,void 0,(function*(){const i=e.e({type:this.type},this.workerOptions);t?i.dataDiff=t:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(s.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new e.l("dataloading",{dataType:"source"}));try{const t=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||t.abandoned)return void this.fire(new e.l("dataabort",{dataType:"source"}));let n=null;t.resourceTiming&&t.resourceTiming[this.id]&&(n=t.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&n&&n.length>0&&e.e(r,{resourceTiming:n}),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new e.l("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(t){if(this._pendingLoads--,this._removed)return void this.fire(new e.l("dataabort",{dataType:"source"}));this.fire(new e.k(t))}}))}loaded(){return 0===this._pendingLoads}loadTile(t){return e._(this,void 0,void 0,(function*(){const e=t.actor?"RT":"LT";t.actor=this.actor;const i={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const n=yield this.actor.sendAsync({type:e,data:i},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(n,this.map.painter,"RT"===e)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return e._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Y extends e.E{constructor(t,e,i,n){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=e}load(t){return e._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new e.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const e=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,e&&e.data&&(this.image=e.data,t&&(this.coordinates=t),this._finishLoading())}catch(t){this._request=null,this._loaded=!0,this.fire(new e.k(t))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const i=t.map(e.$.fromLngLat);var n;return this.tileID=function(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s=Math.max(r-i,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.a1(a,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map((t=>this.tileID.getTilePoint(t)._round())),this.flippedWindingOrder=((n=this.tileCoords)[1].x-n[0].x)*(n[2].y-n[0].y)-(n[1].y-n[0].y)*(n[2].x-n[0].x)<0,this.fire(new e.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.texture||(this.texture=new _(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return e._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s={};for(let t=0;t<=e.a0;t++){const e=Math.pow(2,t),a=Math.floor(i*e),l=Math.floor(n*e),c=Math.floor(r*e),u=Math.floor(o*e);s[t]={minTileX:a,minTileY:l,maxTileX:c,maxTileY:u}}return s}}class K extends Y{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,"Source").url);try{const t=yield e.a2(this.urls);if(this._loaded=!0,!t)return;this.video=t,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(t){this.fire(new e.k(t))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.k(new e.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new _(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let n=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,n=!0)}n&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class J extends Y{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new e.k(new e.a3(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.k(new e.a3(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.k(new e.a3(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.k(new e.a3(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.k(new e.a3(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){return e._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,n=i.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _(i,this.canvas,n.RGBA,{premultiply:!0});let r=!1;for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture,r=!0)}r&&this.fire(new e.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Q={},tt=t=>{switch(t){case"geojson":return X;case"image":return Y;case"raster":return W;case"raster-dem":return H;case"vector":return Z;case"video":return K;case"canvas":return J}return Q[t]},et="RTLPluginLoaded";class it extends e.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=N()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((t=>{throw this.status="error",t}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return e._(this,arguments,void 0,(function*(t,e=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=s.resolveURL(t),!this.url)throw new Error(`requested url ${t} is invalid`);if("unavailable"===this.status){if(!e)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return e._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new e.l(et))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let nt=null;function rt(){return nt||(nt=new it),nt}class ot{constructor(t,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=e.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const e=t+this.timeAdded;e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,i,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.id]=n}}return i}(t.buckets,null==i?void 0:i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.a6&&i.hasRTLText){this.hasRTLText=!0,rt().lazyLoad();break}}this.queryPadding=0;for(const t in this.buckets){const e=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(t).queryRadius(e))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new e.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,i,n,r,o,s,a,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:r,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l,getElevation:u},t,e,i):{}}querySourceFeatures(t,i){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=e.a7(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const r=s.feature(i);if(a.needGeometry){const t=e.a8(r,!0);if(!a.filter(new e.C(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!a.filter(new e.C(this.tileID.overscaledZ),r))continue;const p=n.getId(r,o),d=new e.a9(r,l,c,u,p);d.tile=h,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.aa(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;if(this.expirationTime>t)e=!1;else if(i)if(this.expirationTime<i)e=!0;else{const n=this.expirationTime-i;n?this.expirationTime=t+Math.max(n,3e4):e=!0}else e=!0;e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const n in this.buckets){if(!e.style.hasLayer(n))continue;const r=this.buckets[n],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=t[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=e&&e.style&&e.style.getLayer(n);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.now()+t}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}}class st{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:e,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(t,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const t of e)this.remove(t.value.tileID,t)}}class at{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,n){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.e(this.stateChanges[t][r],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])n[e]||(this.deletedStates[t][r][e]=null)}else for(const e in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,i){const n=String(i),r=e.e({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return{};for(const t in e)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,i){const n={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const n in this.stateChanges[t])this.state[t][n]||(this.state[t][n]={}),e.e(this.state[t][n],this.stateChanges[t][n]),i[n]=this.state[t][n];n[t]=i}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e]}n[t]=n[t]||{},e.e(n[t],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const e in t)t[e].setFeatureState(n,i)}}const lt=89.25;function ct(t,i){const n=e.ae(i.lat,-85.051129,e.af);return new e.P(e.U(i.lng)*t,e.S(n)*t)}function ut(t,i){return new e.$(i.x/t,i.y/t).toLngLat()}function ht(t){return t.cameraToCenterDistance*Math.min(.85*Math.tan(e.ab(90-t.pitch)),Math.tan(e.ab(lt-t.pitch)))}function pt(t,i){const n=t.canonical,r=i/e.ac(n.z),o=n.x+Math.pow(2,n.z)*t.wrap,s=e.ad(new Float64Array(16));return e.L(s,s,[o*r,n.y*r,0]),e.M(s,s,[r/e.Z,r/e.Z,1]),s}function dt(t,i,n,r,o){const s=e.$.fromLngLat(t,i),a=o*e.ag(1,t.lat),l=a*Math.cos(e.ab(n)),c=Math.sqrt(a*a-l*l),u=c*Math.sin(e.ab(-r)),h=c*Math.cos(e.ab(-r));return new e.$(s.x+u,s.y+h,s.z+l)}function ft(t,e,i){const n=e.intersectsFrustum(t);if(!i)return n;const r=e.intersectsPlane(i);return 0===n||0===r?0:2===n&&2===r?2:1}function mt(t,e,i){let n=0;const r=(i-e)/10;for(let o=0;o<10;o++)n+=r*Math.pow(Math.cos(e+(o+.5)/10*(i-e)),t);return n}function gt(t,i){return function(n,r,o,s,a){const l=2*((t-1)/e.ah(Math.cos(e.ab(lt-a))/Math.cos(e.ab(lt)))-1),c=Math.acos(o/s),u=2*mt(l-1,0,e.ab(a/2)),h=Math.min(e.ab(lt),c+e.ab(a/2)),p=mt(l-1,Math.min(h,c-e.ab(a/2)),h),d=Math.atan(r/o),f=Math.hypot(r,o);let m=n;return m+=e.ah(s/f/Math.max(.5,Math.cos(e.ab(a/2)))),m+=l*e.ah(Math.cos(d))/2,m-=e.ah(Math.max(1,p/u/i))/2,m}}const yt=gt(9.314,3);function _t(t,i){const n=(i.roundZoom?Math.round:Math.floor)(t.zoom+e.ah(t.tileSize/i.tileSize));return Math.max(0,n)}function vt(t,i){const n=t.getCameraFrustum(),r=t.getClippingPlane(),o=t.screenPointToMercatorCoordinate(t.getCameraPoint()),s=e.$.fromLngLat(t.center,t.elevation);o.z=s.z+Math.cos(t.pitchInRadians)*t.cameraToCenterDistance/t.worldSize;const a=t.getCoveringTilesDetailsProvider(),l=a.allowVariableZoom(t,i),c=_t(t,i),u=i.minzoom||0,h=void 0!==i.maxzoom?i.maxzoom:t.maxZoom,p=Math.min(Math.max(0,c),h),d=Math.pow(2,p),f=[d*o.x,d*o.y,0],m=[d*s.x,d*s.y,0],g=Math.hypot(s.x-o.x,s.y-o.y),y=Math.abs(s.z-o.z),_=Math.hypot(g,y),v=t=>({zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}),x=[],b=[];if(t.renderWorldCopies&&a.allowWorldCopies())for(let t=1;t<=3;t++)x.push(v(-t)),x.push(v(t));for(x.push(v(0));x.length>0;){const d=x.pop(),g=d.x,v=d.y;let w=d.fullyVisible;const T={x:g,y:v,z:d.zoom},S=a.getTileAABB(T,d.wrap,t.elevation,i);if(!w){const t=ft(n,S,r);if(0===t)continue;w=2===t}const C=a.distanceToTile2d(o.x,o.y,T,S);let E=c;l&&(E=(i.calculateTileZoom||yt)(t.zoom+e.ah(t.tileSize/i.tileSize),C,y,_,t.fov)),E=(i.roundZoom?Math.round:Math.floor)(E),E=Math.max(0,E);const I=Math.min(E,h);if(d.wrap=a.getWrap(s,T,d.wrap),d.zoom>=I){if(d.zoom<u)continue;const t=p-d.zoom,n=f[0]-.5-(g<<t),r=f[1]-.5-(v<<t),o=i.reparseOverscaled?Math.max(d.zoom,E):d.zoom;b.push({tileID:new e.Y(d.zoom===h?o:d.zoom,d.wrap,d.zoom,g,v),distanceSq:e.ai([m[0]-.5-g,m[1]-.5-v]),tileDistanceToCamera:Math.sqrt(n*n+r*r)})}else for(let t=0;t<4;t++)x.push({zoom:d.zoom+1,x:(g<<1)+t%2,y:(v<<1)+(t>>1),wrap:d.wrap,fullyVisible:w})}return b.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}class xt extends e.E{constructor(t,e,i){super(),this.id=t,this.dispatcher=i,this.on("data",(t=>this._dataHandler(t))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((t,e,i,n)=>{const r=new(tt(e.type))(t,e,i,n);if(r.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${r.id}`);return r})(t,e,i,this),this._tiles={},this._cache=new st(0,(t=>this._unloadTile(t))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new at,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,i,n){return e._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,i,n)}catch(i){t.state="errored",404!==i.status?this._source.fire(new e.k(i,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new e.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(bt).map((t=>t.key))}getRenderableIds(t){const i=[];for(const e in this._tiles)this._isIdRenderable(e,t)&&i.push(this._tiles[e]);return t?i.sort(((t,i)=>{const n=t.tileID,r=i.tileID,o=new e.P(n.canonical.x,n.canonical.y)._rotate(-this.transform.bearingInRadians),s=new e.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians);return n.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(bt).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)(t||"errored"!==this._tiles[e].state)&&this._reloadTile(e,"reloading")}}_reloadTile(t,i){return e._(this,void 0,void 0,(function*(){const e=this._tiles[t];e&&("loading"!==e.state&&(e.state=i),yield this._loadTile(e,t,i))}))}_tileLoaded(t,i,n){t.timeAdded=s.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this.getSource().type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new e.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){const e=this.getTileByID(r);i(t,e),i(e,t)}}function i(t,e){t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,r=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]||t[a.canonical.key]){n[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const i=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(i*n*(null===this._maxTileCacheZoomLevels?e.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(t,this._tiles[t])}}_updateCoveredAndRetainedTiles(t,e,i,n,r,o){const a={},l={},c=Object.keys(t),u=s.now();for(const i of c){const n=t[i],r=this._tiles[i];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const o=this.findLoadedParent(n,e),s=this.findLoadedSibling(n),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[i]=n}this._retainLoadedChildren(l,n,i,t);for(const e in a)t[e]||(this._coveredTiles[e]=!0,t[e]=a[e]);if(o){const e={},i={};for(const t of r)this._tiles[t.key].hasData()?e[t.key]=t:i[t.key]=t;for(const n in i){const r=i[n].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(e[r[0].key]=t[r[0].key]=r[0],e[r[1].key]=t[r[1].key]=r[1],e[r[2].key]=t[r[2].key]=r[2],e[r[3].key]=t[r[3].key]=r[3],delete i[n])}for(const n in i){const r=i[n],o=this.findLoadedParent(r,this._source.minzoom),s=this.findLoadedSibling(r),a=o||s||null;if(a){e[a.tileID.key]=t[a.tileID.key]=a.tileID;for(const t in e)e[t].isChildOf(a.tileID)&&delete e[t]}}for(const t in this._tiles)e[t]||(this._coveredTiles[t]=!0)}}update(t,i){if(!this._sourceLoaded||this._paused)return;let n;this.transform=t,this.terrain=i,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.Y(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y))):(n=vt(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(n=n.filter((t=>this._source.hasTile(t))))):n=[];const r=_t(t,this._source),o=Math.max(r-xt.maxOverzooming,this._source.minzoom),s=Math.max(r+xt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const t={};for(const e of n)if(e.canonical.z>this._source.minzoom){const i=e.scaledTo(e.canonical.z-1);t[i.key]=i;const n=e.scaledTo(Math.max(this._source.minzoom,Math.min(e.canonical.z,5)));t[n.key]=n}n=n.concat(Object.values(t))}const a=0===n.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new e.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(n,r);wt(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,r,n,i);for(const t in l)this._tiles[t].clearFadeHold();const c=e.aj(this._tiles,l);for(const t of c){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(t)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,e){var i;const n={},r={},o=Math.max(e-xt.maxOverzooming,this._source.minzoom),s=Math.max(e+xt.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);n[i.key]=i,t.hasData()||e<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,e,s,n);for(const s of t){let t=this._tiles[s.key];if(t.hasData())continue;if(e+1>this._source.maxzoom){const t=s.children(this._source.maxzoom)[0],e=this.getTile(t);if(e&&e.hasData()){n[t.key]=t;continue}}else{const t=s.children(this._source.maxzoom);if(n[t[0].key]&&n[t[1].key]&&n[t[2].key]&&n[t[3].key])continue}let a=t.wasRequested();for(let e=s.overscaledZ-1;e>=o;--e){const o=s.scaledTo(e);if(r[o.key])break;if(r[o.key]=!0,t=this.getTile(o),!t&&a&&(t=this._addTile(o)),t){const e=t.hasData();if((e||!(null===(i=this.map)||void 0===i?void 0:i.cancelPendingTileRequestsWhileZooming)||a)&&(n[o.key]=o),a=t.wasRequested(),e)break}}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const e=this._tiles[t].tileID,i=this._getLoadedTile(e);this._loadedSiblingTiles[e.key]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const n=i;return i||(i=new ot(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(i,t.key,i.state)),i.uses++,this._tiles[t.key]=i,n||this._source.fire(new e.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}refreshTiles(t){for(const e in this._tiles)this._isIdRenderable(e)&&t.some((t=>t.equals(this._tiles[e].tileID.canonical)))&&this._reloadTile(e,"expired")}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}_dataHandler(t){const e=t.sourceDataType;"source"===t.dataType&&"metadata"===e&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===e&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,i,n){const r=[],o=this.transform;if(!o)return r;const s=n?o.getCameraQueryGeometry(t):t,a=t.map((t=>o.screenPointToMercatorCoordinate(t,this.terrain))),l=s.map((t=>o.screenPointToMercatorCoordinate(t,this.terrain))),c=this.getIds();let u=1/0,h=1/0,p=-1/0,d=-1/0;for(const t of l)u=Math.min(u,t.x),h=Math.min(h,t.y),p=Math.max(p,t.x),d=Math.max(d,t.y);for(let t=0;t<c.length;t++){const n=this._tiles[c[t]];if(n.holdingForFade())continue;const s=o.getCoveringTilesDetailsProvider().allowWorldCopies()?n.tileID:n.tileID.unwrapTo(0),f=Math.pow(2,o.zoom-n.tileID.overscaledZ),m=i*n.queryPadding*e.Z/n.tileSize/f,g=[s.getTilePoint(new e.$(u,h)),s.getTilePoint(new e.$(p,d))];if(g[0].x-m<e.Z&&g[0].y-m<e.Z&&g[1].x+m>=0&&g[1].y+m>=0){const t=a.map((t=>s.getTilePoint(t))),e=l.map((t=>s.getTilePoint(t)));r.push({tile:n,tileID:s,queryGeometry:t,cameraQueryGeometry:e,scale:f})}}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map((t=>this._tiles[t].tileID));return this.transform&&this.transform.populateCache(e),e}hasTransition(){if(this._source.hasTransition())return!0;if(wt(this._source.type)){const t=s.now();for(const e in this._tiles)if(this._tiles[e].fadeEndTime>=t)return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}}function bt(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wt(t){return"raster"===t||"image"===t||"video"===t}xt.maxOverzooming=10,xt.maxUnderzooming=3;class Tt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ae(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function St(t,e){let i=!0;return"always"===t||"never"!==t&&"never"!==e||(i=!1),i}class Ct{constructor(t,e,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(t,e,i,n,r,o){this.circleCells[r].push(o)}_query(t,e,i,n,r,o,s){if(i<0||t>this.width||n<0||e>this.height)return[];const a=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(r)return[{key:null,x1:t,y1:e,x2:i,y2:n}];for(let t=0;t<this.boxKeys.length;t++)a.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];a.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}}else this._forEachCell(t,e,i,n,this._queryCell,a,{hitTest:r,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(t,e,i,n){return this._query(t,e,i,n,!1,null)}hitTest(t,e,i,n,r,o){return this._query(t,e,i,n,!0,r,o).length>0}hitTestCircle(t,e,i,n,r){const o=t-i,s=t+i,a=e-i,l=e+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(t,e,i,n,r,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,p=this.boxKeys[s];if(t<=r[h+2]&&e<=r[h+3]&&i>=r[h+0]&&n>=r[h+1]&&(!a||a(p))&&(!c||!St(u,p.overlapMode))&&(o.push({key:p,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const p=this.circleCells[r];if(null!==p){const r=this.circles;for(const s of p)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,p=this.circleKeys[s];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],t,e,i,n)&&(!a||a(p))&&(!c||!St(u,p.overlapMode))){const t=r[h],e=r[h+1],i=r[h+2];if(o.push({key:p,x1:t-i,y1:e-i,x2:t+i,y2:e+i}),c)return!0}}}return!1}_queryCellCircle(t,e,i,n,r,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const t=this.bboxes;for(const e of h)if(!c.box[e]){c.box[e]=!0;const i=4*e,n=this.boxKeys[e];if(this._circleAndRectCollide(l.x,l.y,l.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(n))&&!St(u,n.overlapMode))return o.push(!0),!0}}const p=this.circleCells[r];if(null!==p){const t=this.circles;for(const e of p)if(!c.circle[e]){c.circle[e]=!0;const i=3*e,n=this.circleKeys[e];if(this._circlesCollide(t[i],t[i+1],t[i+2],l.x,l.y,l.radius)&&(!a||a(n))&&!St(u,n.overlapMode))return o.push(!0),!0}}}_forEachCell(t,e,i,n,r,o,s,a){const l=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let p=l;p<=u;p++)for(let l=c;l<=h;l++)if(r.call(this,t,e,i,n,this.xCellCount*l+p,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,r,o){const s=n-t,a=r-e,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(t,e,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(t-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(e-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,p=u-c;return h*h+p*p<=i*i}}function Et(t,i,r){const o=e.K();if(!t){const{vecSouth:t,vecEast:e}=Mt(i),r=n();r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],s=r,(p=(l=(a=r)[0])*(h=a[3])-(u=a[2])*(c=a[1]))&&(s[0]=h*(p=1/p),s[1]=-c*p,s[2]=-u*p,s[3]=l*p),o[0]=r[0],o[1]=r[1],o[4]=r[2],o[5]=r[3]}var s,a,l,c,u,h,p;return e.M(o,o,[1/r,1/r,1]),o}function It(t,i,n,r){if(t){const t=e.K();if(!i){const{vecSouth:e,vecEast:i}=Mt(n);t[0]=i[0],t[1]=i[1],t[4]=e[0],t[5]=e[1]}return e.M(t,t,[r,r,1]),t}return n.pixelsToClipSpaceMatrix}function Mt(t){const i=Math.cos(t.rollInRadians),n=Math.sin(t.rollInRadians),r=Math.cos(t.pitchInRadians),o=Math.cos(t.bearingInRadians),s=Math.sin(t.bearingInRadians),a=e.ao();a[0]=-o*r*n-s*i,a[1]=-s*r*n+o*i;const l=e.ap(a);l<1e-9?e.aq(a):e.ar(a,a,1/l);const c=e.ao();c[0]=o*r*i-s*n,c[1]=s*r*i+o*n;const u=e.ap(c);return u<1e-9?e.aq(c):e.ar(c,c,1/u),{vecEast:c,vecSouth:a}}function At(t,i,n,r){let o;r?(o=[t,i,r(t,i),1],e.at(o,o,n)):(o=[t,i,0,1],Zt(o,o,n));const s=o[3];return{point:new e.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function kt(t,e){return.5+t/e*.5}function Pt(t,e){return t.x>=-e[0]&&t.x<=e[0]&&t.y>=-e[1]&&t.y<=e[1]}function Lt(t,i,n,r,o,s,a,l,c,u,h,p,d){const f=n?t.textSizeData:t.iconSizeData,m=e.ak(f,i.transform.zoom),g=[256/i.width*2+1,256/i.height*2+1],y=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;y.clear();const _=t.lineVertexArray,v=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=i.transform.width/i.transform.height;let b=!1;for(let n=0;n<v.length;n++){const w=v.get(n);if(w.hidden||w.writingMode===e.al.vertical&&!b){qt(w.numGlyphs,y);continue}b=!1;const T=new e.P(w.anchorX,w.anchorY),S={getElevation:d,pitchedLabelPlaneMatrix:r,lineVertexArray:_,pitchWithMap:s,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:T,unwrappedTileID:c,width:u,height:h,translation:p},C=jt(w.anchorX,w.anchorY,S);if(!Pt(C.point,g)){qt(w.numGlyphs,y);continue}const E=kt(i.transform.cameraToCenterDistance,C.signedDistanceFromCamera),I=e.am(f,m,w),M=s?I*i.transform.getPitchedTextCorrection(w.anchorX,w.anchorY,c)/E:I*E,A=Rt({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:M,flip:!1,keepUpright:a,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l});b=A.useVertical,(A.notEnoughRoom||b||A.needsFlipping&&Rt({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:M,flip:!0,keepUpright:a,glyphOffsetArray:t.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l}).notEnoughRoom)&&qt(w.numGlyphs,y)}n?t.text.dynamicLayoutVertexBuffer.updateData(y):t.icon.dynamicLayoutVertexBuffer.updateData(y)}function zt(t,e,i,n,r,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=e.getoffsetX(o.glyphStartIndex),p=e.getoffsetX(l-1),d=Vt(t*h,i,n,r,o.segment,c,u,a,s);if(!d)return null;const f=Vt(t*p,i,n,r,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:d,last:f}:null}function Dt(t,i,n,r){return t===e.al.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:(t===e.al.vertical?i.y<n.y:i.x>n.x)?{needsFlipping:!0}:null}function Rt(t){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:n,symbol:r,fontSize:o,flip:s,keepUpright:a,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=t,p=o/24,d=r.lineOffsetX*p,f=r.lineOffsetY*p;let m;if(r.numGlyphs>1){const t=r.glyphStartIndex+r.numGlyphs,e=r.lineStartIndex,o=r.lineStartIndex+r.lineLength,c=zt(p,l,d,f,s,r,h,i);if(!c)return{notEnoughRoom:!0};const g=Bt(c.first.point.x,c.first.point.y,i,n),y=Bt(c.last.point.x,c.last.point.y,i,n);if(a&&!s){const t=Dt(r.writingMode,g,y,u);if(t)return t}m=[c.first];for(let n=r.glyphStartIndex+1;n<t-1;n++)m.push(Vt(p*l.getoffsetX(n),d,f,s,r.segment,e,o,i,h));m.push(c.last)}else{if(a&&!s){const t=Nt(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,o=r.lineStartIndex+r.segment+1,s=new e.P(i.lineVertexArray.getx(o),i.lineVertexArray.gety(o)),a=Nt(s.x,s.y,i),l=a.signedDistanceFromCamera>0?a.point:Ot(i.tileAnchorPoint,s,t,1,i),c=Bt(t.x,t.y,i,n),h=Bt(l.x,l.y,i,n),p=Dt(r.writingMode,c,h,u);if(p)return p}const t=Vt(p*l.getoffsetX(r.glyphStartIndex),d,f,s,r.segment,r.lineStartIndex,r.lineStartIndex+r.lineLength,i,h);if(!t||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[t]}for(const t of m)e.as(c,t.point,t.angle);return{}}function Ot(t,e,i,n,r){const o=t.add(t.sub(e)._unit()),s=Nt(o.x,o.y,r).point,a=i.sub(s);return i.add(a._mult(n/a.mag()))}function Ft(t,i,n){const r=i.projectionCache;if(r.projections[t])return r.projections[t];const o=new e.P(i.lineVertexArray.getx(t),i.lineVertexArray.gety(t)),s=Nt(o.x,o.y,i);if(s.signedDistanceFromCamera>0)return r.projections[t]=s.point,r.anyProjectionOccluded=r.anyProjectionOccluded||s.isOccluded,s.point;const a=t-n.direction;return Ot(0===n.distanceFromAnchor?i.tileAnchorPoint:new e.P(i.lineVertexArray.getx(a),i.lineVertexArray.gety(a)),o,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,i)}function Nt(t,e,i){const n=t+i.translation[0],r=e+i.translation[1];let o;return i.pitchWithMap?(o=At(n,r,i.pitchedLabelPlaneMatrix,i.getElevation),o.isOccluded=!1):(o=i.transform.projectTileCoordinates(n,r,i.unwrappedTileID,i.getElevation),o.point.x=(.5*o.point.x+.5)*i.width,o.point.y=(.5*-o.point.y+.5)*i.height),o}function Bt(t,i,n,r){if(n.pitchWithMap){const o=[t,i,0,1];return e.at(o,o,r),n.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],n.unwrappedTileID,n.getElevation).point}return{x:t/n.width*2-1,y:i/n.height*2-1}}function jt(t,e,i){return i.transform.projectTileCoordinates(t,e,i.unwrappedTileID,i.getElevation)}function $t(t,e,i){return t._unit()._perp()._mult(e*i)}function Ut(t,i,n,r,o,s,a,l,c){if(l.projectionCache.offsets[t])return l.projectionCache.offsets[t];const u=n.add(i);if(t+c.direction<r||t+c.direction>=o)return l.projectionCache.offsets[t]=u,u;const h=Ft(t+c.direction,l,c),p=$t(h.sub(n),a,c.direction),d=n.add(p),f=h.add(p);return l.projectionCache.offsets[t]=e.au(s,u,d,f)||u,l.projectionCache.offsets[t]}function Vt(t,e,i,n,r,o,s,a,l){const c=n?t-e:t+e;let u=c>0?1:-1,h=0;n&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let p,d=u>0?o+r:o+r+1;a.projectionCache.cachedAnchorPoint?p=a.projectionCache.cachedAnchorPoint:(p=Nt(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=p);let f,m,g=p,y=p,_=0,v=0;const x=Math.abs(c),b=[];let w;for(;_+v<=x;){if(d+=u,d<o||d>=s)return null;_+=v,y=g,m=f;const t={absOffsetX:x,direction:u,distanceFromAnchor:_,previousVertex:y};if(g=Ft(d,a,t),0===i)b.push(y),w=g.sub(y);else{let e;const n=g.sub(y);e=0===n.mag()?$t(Ft(d+u,a,t).sub(g),i,u):$t(n,i,u),m||(m=y.add(e)),f=Ut(d,e,g,o,s,m,i,a,t),b.push(m),w=f.sub(m)}v=w.mag()}const T=w._mult((x-_)/v)._add(m||y),S=h+Math.atan2(g.y-y.y,g.x-y.x);return b.push(T),{point:T,angle:l?S:0,path:b}}const Gt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qt(t,e){for(let i=0;i<t;i++){const t=e.length;e.resize(t+4),e.float32.set(Gt,3*t)}}function Zt(t,e,i){const n=e[0],r=e[1];return t[0]=i[0]*n+i[4]*r+i[12],t[1]=i[1]*n+i[5]*r+i[13],t[3]=i[3]*n+i[7]*r+i[15],t}const Wt=100;class Ht{constructor(t,e=new Ct(t.width+200,t.height+200,25),i=new Ct(t.width+200,t.height+200,25)){this.transform=t,this.grid=e,this.ignoredGrid=i,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Wt,this.screenBottomBoundary=t.height+Wt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,e,i,n,r,o,s,a,l,c,u,h){const p=this.projectAndGetPerspectiveRatio(t.anchorPointX+a[0],t.anchorPointY+a[1],r,c,h),d=i*p.perspectiveRatio;let f;if(o||s)f=this._projectCollisionBox(t,d,n,r,o,s,a,p,c,u,h);else{const e=p.x+(u?u.x*d:0),i=p.y+(u?u.y*d:0);f={allPointsOccluded:!1,box:[e+t.x1*d,i+t.y1*d,e+t.x2*d,i+t.y2*d]}}const[m,g,y,_]=f.box,v=o?f.allPointsOccluded:p.isOccluded;let x=v;return x||(x=p.perspectiveRatio<this.perspectiveRatioCutoff),x||(x=!this.isInsideGrid(m,g,y,_)),x||"always"!==e&&this.grid.hitTest(m,g,y,_,e,l)?{box:[m,g,y,_],placeable:!1,offscreen:!1,occluded:v}:{box:[m,g,y,_],placeable:!0,offscreen:this.isOffscreen(m,g,y,_),occluded:v}}placeCollisionCircles(t,i,n,r,o,s,a,l,c,u,h,p,d,f){const m=[],g=new e.P(i.anchorX,i.anchorY),y=this.getPerspectiveRatio(g.x,g.y,s,f),_=(c?o*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,s)/y:o*y)/e.ay,v={getElevation:f,pitchedLabelPlaneMatrix:a,lineVertexArray:n,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:s,width:this.transform.width,height:this.transform.height,translation:d},x=zt(_,r,i.lineOffsetX*_,i.lineOffsetY*_,!1,i,!1,v);let b=!1,w=!1,T=!0;if(x){const i=.5*h*y+p,n=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Tt,s=x.first,a=x.last;let d=[];for(let t=s.path.length-1;t>=1;t--)d.push(s.path[t]);for(let t=1;t<a.path.length;t++)d.push(a.path[t]);const f=2.5*i;if(c){const t=this.projectPathToScreenSpace(d,v);d=t.some((t=>t.signedDistanceFromCamera<=0))?[]:t.map((t=>t.point))}let g=[];if(d.length>0){const t=d[0].clone(),i=d[0].clone();for(let e=1;e<d.length;e++)t.x=Math.min(t.x,d[e].x),t.y=Math.min(t.y,d[e].y),i.x=Math.max(i.x,d[e].x),i.y=Math.max(i.y,d[e].y);g=t.x>=n.x&&i.x<=r.x&&t.y>=n.y&&i.y<=r.y?[d]:i.x<n.x||t.x>r.x||i.y<n.y||t.y>r.y?[]:e.av([d],n.x,n.y,r.x,r.y)}for(const e of g){o.reset(e,.25*i);let n=0;n=o.length<=.5*i?1:Math.ceil(o.paddedLength/f)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),s=o.lerp(r),a=s.x+Wt,c=s.y+Wt;m.push(a,c,i,0);const h=a-i,p=c-i,d=a+i,f=c+i;if(T=T&&this.isOffscreen(h,p,d,f),w=w||this.isInsideGrid(h,p,d,f),"always"!==t&&this.grid.hitTestCircle(a,c,i,t,u)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:T,collisionDetected:b}}projectPathToScreenSpace(t,i){const n=function(t,i){const n=e.K();return e.an(n,i.pitchedLabelPlaneMatrix),t.map((t=>{const e=At(t.x,t.y,n,i.getElevation),r=i.transform.projectTileCoordinates(e.point.x,e.point.y,i.unwrappedTileID,i.getElevation);return r.point.x=(.5*r.point.x+.5)*i.width,r.point.y=(.5*-r.point.y+.5)*i.height,r}))}(t,i);return function(t){let e=0,i=0,n=0,r=0;for(let o=0;o<t.length;o++)t[o].isOccluded?(n=o+1,r=0):(r++,r>i&&(i=r,e=n));return t.slice(e,e+i)}(n)}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.P(a.x+Wt,a.y+Wt);n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const t of a){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.aw(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(t,e,i,n,r,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:o,overlapMode:e},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,r,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:o,overlapMode:e};for(let e=0;e<t.length;e+=4)s.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(t,i,n,r,o){if(o){let n;r?(n=[t,i,r(t,i),1],e.at(n,n,o)):(n=[t,i,0,1],Zt(n,n,o));const s=n[3];return{x:(n[0]/s+1)/2*this.transform.width+Wt,y:(-n[1]/s+1)/2*this.transform.height+Wt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/s*.5,isOccluded:!1,signedDistanceFromCamera:s}}{const e=this.transform.projectTileCoordinates(t,i,n,r);return{x:(e.point.x+1)/2*this.transform.width+Wt,y:(1-e.point.y)/2*this.transform.height+Wt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/e.signedDistanceFromCamera*.5,isOccluded:e.isOccluded,signedDistanceFromCamera:e.signedDistanceFromCamera}}}getPerspectiveRatio(t,e,i,n){const r=this.transform.projectTileCoordinates(t,e,i,n);return.5+this.transform.cameraToCenterDistance/r.signedDistanceFromCamera*.5}isOffscreen(t,e,i,n){return i<Wt||t>=this.screenRightBoundary||n<Wt||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const t=e.ad([]);return e.L(t,t,[-100,-100,0]),t}_projectCollisionBox(t,i,n,r,o,s,a,l,c,u,h){let p=1,d=0,f=0,m=1;const g=t.anchorPointX+a[0],y=t.anchorPointY+a[1];if(s&&!o){const t=this.projectAndGetPerspectiveRatio(g+1,y,r,c,h),e=t.x-l.x,i=Math.atan((t.y-l.y)/e)+(e<0?Math.PI:0),n=Math.sin(i),o=Math.cos(i);p=o,d=n,f=-n,m=o}else if(!s&&o){const t=Mt(this.transform);p=t.vecEast[0],d=t.vecEast[1],f=t.vecSouth[0],m=t.vecSouth[1]}let _=l.x,v=l.y,x=i;o&&(_=g,v=y,x=Math.pow(2,-(this.transform.zoom-n.overscaledZ)),x*=this.transform.getPitchedTextCorrection(g,y,r),u||(x*=e.ae(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(_+=p*u.x*x+f*u.y*x,v+=d*u.x*x+m*u.y*x);const b=t.x1*x,w=t.x2*x,T=(b+w)/2,S=t.y1*x,C=t.y2*x,E=(S+C)/2,I=[{offsetX:b,offsetY:S},{offsetX:T,offsetY:S},{offsetX:w,offsetY:S},{offsetX:w,offsetY:E},{offsetX:w,offsetY:C},{offsetX:T,offsetY:C},{offsetX:b,offsetY:C},{offsetX:b,offsetY:E}];let M=[];for(const{offsetX:t,offsetY:i}of I)M.push(new e.P(_+p*t+f*i,v+d*t+m*i));let A=!1;if(o){const t=M.map((t=>this.projectAndGetPerspectiveRatio(t.x,t.y,r,c,h)));A=t.some((t=>!t.isOccluded)),M=t.map((t=>new e.P(t.x,t.y)))}else A=!0;return{box:e.ax(M),allPointsOccluded:!A}}}class Xt{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Yt{constructor(t,e,i,n,r){this.text=new Xt(t?t.text:null,e,i,r),this.icon=new Xt(t?t.icon:null,e,n,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Kt{constructor(t,e,i){this.text=t,this.icon=e,this.skipFade=i}}class Jt{constructor(t,e,i,n,r){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Qt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function te(t,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=e.aE(t);return new e.P(-(s-.5)*i+r[0]*o,-(a-.5)*n+r[1]*o)}class ee{constructor(t,e,i,n,r){this.transform=t.clone(),this.terrain=e,this.collisionIndex=new Ht(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Qt(n),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const e=this.terrain;return e?(i,n)=>e.getElevation(t,i,n):null}getBucketParts(t,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=n.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),h=n.tileSize/e.Z,p=n.tileID.toUnwrapped(),d="map"===l.get("text-rotation-alignment"),f=e.az(n,1,this.transform.zoom),m=e.aA(this.collisionIndex.transform,n,c.get("text-translate"),c.get("text-translate-anchor")),g=e.aA(this.collisionIndex.transform,n,c.get("icon-translate"),c.get("icon-translate-anchor")),y=Et(d,this.transform,f);this.retainedQueryData[o.bucketInstanceId]=new Jt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const _={bucket:o,layout:l,translationText:m,translationIcon:g,unwrappedTileID:p,pitchedLabelPlaneMatrix:y,scale:u,textPixelRatio:h,holdingForFade:n.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:e.ak(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:_})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:_})}attemptAnchorPlacement(t,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,x){const b=e.aB[t.textAnchor],w=[t.textOffset0,t.textOffset1],T=te(b,n,r,w,o),S=this.collisionIndex.placeCollisionBox(i,p,l,c,u,a,s,g,h.predicate,v,T,x);if((!_||this.collisionIndex.placeCollisionBox(_,p,l,c,u,a,s,y,h.predicate,v,T,x).placeable)&&S.placeable){let t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID]&&this.prevPlacement.placements[d.crossTileID].text&&(t=this.prevPlacement.variableOffsets[d.crossTileID].anchor),0===d.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[d.crossTileID]={textOffset:w,width:n,height:r,anchor:b,textBoxScale:o,prevAnchor:t},this.markUsedJustification(f,b,d,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,d),this.placedOrientations[d.crossTileID]=m),{shift:T,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,n){const{bucket:r,layout:o,translationText:s,translationIcon:a,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:p,partiallyEvaluatedTextSize:d,collisionGroup:f}=t.parameters,m=o.get("text-optional"),g=o.get("icon-optional"),y=e.aC(o,"text-overlap","text-allow-overlap"),_="always"===y,v=e.aC(o,"icon-overlap","icon-allow-overlap"),x="always"===v,b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),T="none"!==o.get("icon-text-fit"),S="viewport-y"===o.get("symbol-z-order"),C=_&&(x||!r.hasIconData()||g),E=x&&(_||!r.hasTextData()||m);!r.collisionArrays&&p&&r.deserializeCollisionBoxes(p);const I=this.retainedQueryData[r.bucketInstanceId].tileID,M=this._getTerrainElevationFunc(I),A=this.transform.getFastPathSimpleProjectionMatrix(I),k=(t,p,x)=>{var S,k;if(i[t.crossTileID])return;if(h)return void(this.placements[t.crossTileID]=new Kt(!1,!1,!1));let P=!1,L=!1,z=!0,D=null,R={box:null,placeable:!1,offscreen:null,occluded:!1},O={placeable:!1},F=null,N=null,B=null,j=0,$=0,U=0;p.textFeatureIndex?j=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(j=t.featureIndex),p.verticalTextFeatureIndex&&($=p.verticalTextFeatureIndex);const V=p.textBox;if(V){const i=i=>{let n=e.al.horizontal;if(r.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,n=e,this.markUsedOrientation(r,n,t))}return n},o=(i,n)=>{if(r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&p.verticalTextBox){for(const t of r.writingModes)if(t===e.al.vertical?(R=n(),O=R):R=i(),R&&R.placeable)break}else R=i()},c=t.textAnchorOffsetStartIndex,h=t.textAnchorOffsetEndIndex;if(h===c){const n=(e,i)=>{const n=this.collisionIndex.placeCollisionBox(e,y,u,I,l,w,b,s,f.predicate,M,void 0,A);return n&&n.placeable&&(this.markUsedOrientation(r,i,t),this.placedOrientations[t.crossTileID]=i),n};o((()=>n(V,e.al.horizontal)),(()=>{const i=p.verticalTextBox;return r.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?n(i,e.al.vertical):{box:null,offscreen:null}})),i(R&&R.placeable)}else{let d=e.aB[null===(k=null===(S=this.prevPlacement)||void 0===S?void 0:S.variableOffsets[t.crossTileID])||void 0===k?void 0:k.anchor];const m=(e,i,o)=>{const p=e.x2-e.x1,m=e.y2-e.y1,g=t.textBoxScale,_=T&&"never"===v?i:null;let x=null,S="never"===y?1:2,C="never";d&&S++;for(let i=0;i<S;i++){for(let i=c;i<h;i++){const n=r.textAnchorOffsets.get(i);if(d&&n.textAnchor!==d)continue;const c=this.attemptAnchorPlacement(n,e,p,m,g,b,w,u,I,l,f,C,t,r,o,s,a,_,M);if(c&&(x=c.placedGlyphBoxes,x&&x.placeable))return P=!0,D=c.shift,x}d?d=null:C=y}return n&&!x&&(x={box:this.collisionIndex.placeCollisionBox(V,"always",u,I,l,w,b,s,f.predicate,M,void 0,A).box,offscreen:!1,placeable:!1,occluded:!1}),x};o((()=>m(V,p.iconBox,e.al.horizontal)),(()=>{const i=p.verticalTextBox;return r.allowVerticalPlacement&&(!R||!R.placeable)&&t.numVerticalGlyphVertices>0&&i?m(i,p.verticalIconBox,e.al.vertical):{box:null,occluded:!0,offscreen:null}})),R&&(P=R.placeable,z=R.offscreen);const g=i(R&&R.placeable);if(!P&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(r,e.anchor,t,g))}}}if(F=R,P=F&&F.placeable,z=F&&F.offscreen,t.useRuntimeCollisionCircles){const i=r.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),a=e.am(r.textSizeData,d,i),u=o.get("text-padding");N=this.collisionIndex.placeCollisionCircles(y,i,r.lineVertexArray,r.glyphOffsetArray,a,l,c,n,w,f.predicate,t.collisionCircleDiameter,u,s,M),N.circles.length&&N.collisionDetected&&!n&&e.w("Collisions detected, but collision boxes are not shown"),P=_||N.circles.length>0&&!N.collisionDetected,z=z&&N.offscreen}if(p.iconFeatureIndex&&(U=p.iconFeatureIndex),p.iconBox){const t=t=>this.collisionIndex.placeCollisionBox(t,v,u,I,l,w,b,a,f.predicate,M,T&&D?D:void 0,A);O&&O.placeable&&p.verticalIconBox?(B=t(p.verticalIconBox),L=B.placeable):(B=t(p.iconBox),L=B.placeable),z=z&&B.offscreen}const G=m||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,q=g||0===t.numIconVertices;G||q?q?G||(L=L&&P):P=L&&P:L=P=L&&P;const Z=L&&B.placeable;if(P&&F.placeable&&this.collisionIndex.insertCollisionBox(F.box,y,o.get("text-ignore-placement"),r.bucketInstanceId,O&&O.placeable&&$?$:j,f.ID),Z&&this.collisionIndex.insertCollisionBox(B.box,v,o.get("icon-ignore-placement"),r.bucketInstanceId,U,f.ID),N&&P&&this.collisionIndex.insertCollisionCircles(N.circles,y,o.get("text-ignore-placement"),r.bucketInstanceId,j,f.ID),n&&this.storeCollisionData(r.bucketInstanceId,x,p,F,B,N),0===t.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[t.crossTileID]=new Kt((P||C)&&!(null==F?void 0:F.occluded),(L||E)&&!(null==B?void 0:B.occluded),z||r.justReloaded),i[t.crossTileID]=!0};if(S){if(0!==t.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const e=r.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let t=e.length-1;t>=0;--t){const i=e[t];k(r.symbolInstances.get(i),r.collisionArrays[i],i)}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)k(r.symbolInstances.get(e),r.collisionArrays[e],e);r.justReloaded=!1}storeCollisionData(t,e,i,n,r,o){if(i.textBox||i.iconBox){let o,s;this.collisionBoxArrays.has(t)?o=this.collisionBoxArrays.get(t):(o=new Map,this.collisionBoxArrays.set(t,o)),o.has(e)?s=o.get(e):(s={text:null,icon:null},o.set(e,s)),i.textBox&&(s.text=n.box),i.iconBox&&(s.icon=r.box)}if(o){let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=[]);for(let t=0;t<o.circles.length;t+=4)e.push(o.circles[t+0]-Wt),e.push(o.circles[t+1]-Wt),e.push(o.circles[t+2]),e.push(o.collisionDetected?1:0)}}markUsedJustification(t,i,n,r){let o;o=r===e.al.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[e.aD(i)];const s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:n.crossTileID)}markUsedOrientation(t,i,n){const r=i===e.al.horizontal||i===e.al.horizontalOnly?i:0,o=i===e.al.vertical?i:0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,r=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],o=r[t];o?(this.opacities[t]=new Yt(o,n,e.text,e.icon),i=i||e.text!==o.text.placed||e.icon!==o.icon.placed):(this.opacities[t]=new Yt(null,n,e.text,e.icon,e.skipFade),i=i||e.text||e.icon)}for(const t in r){const e=r[t];if(!this.opacities[t]){const r=new Yt(e,n,!1,!1);r.isHidden()||(this.opacities[t]=r,i=i||e.text.placed||e.icon.placed)}}for(const t in o)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=o[t]);for(const t in s)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=s[t]);if(e&&void 0===e.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const i={};for(const n of e){const e=n.getBucket(t);e&&n.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n.tileID,i,n.collisionBoxArray)}}updateBucketOpacities(t,i,n,r){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const o=t.layers[0],s=o.layout,a=new Yt(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),p="map"===s.get("text-pitch-alignment"),d="none"!==s.get("icon-text-fit"),f=new Yt(null,0,l&&(c||!t.hasIconData()||s.get("icon-optional")),c&&(l||!t.hasTextData()||s.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const m=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i);t.hasVisibleVertices=t.hasVisibleVertices||i!==he},g=this.collisionBoxArrays.get(t.bucketInstanceId);for(let i=0;i<t.symbolInstances.length;i++){const r=t.symbolInstances.get(i),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=r;let c=this.opacities[l];n[l]?c=a:c||(c=f,this.opacities[l]=c),n[l]=!0;const y=r.numIconVertices>0,_=this.placedOrientations[r.crossTileID],v=_===e.al.vertical,x=_===e.al.horizontal||_===e.al.horizontalOnly;if(o>0||s>0){const e=ue(c.text);m(t.text,o,v?he:e),m(t.text,s,x?he:e);const i=c.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||v?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=i||x?1:0);const n=this.variableOffsets[r.crossTileID];n&&this.markUsedJustification(t,n.anchor,r,_);const a=this.placedOrientations[r.crossTileID];a&&(this.markUsedJustification(t,"left",r,a),this.markUsedOrientation(t,a,r))}if(y){const e=ue(c.icon),i=!(d&&r.verticalPlacedIconSymbolIndex&&v);r.placedIconSymbolIndex>=0&&(m(t.icon,r.numIconVertices,i?e:he),t.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=c.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(m(t.icon,r.numVerticalIconVertices,i?he:e),t.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const b=g&&g.has(i)?g.get(i):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const n=t.collisionArrays[i];if(n){let i=new e.P(0,0);if(n.textBox||n.verticalTextBox){let e=!0;if(u){const t=this.variableOffsets[l];t?(i=te(t.anchor,t.width,t.height,t.textOffset,t.textBoxScale),h&&i._rotate(p?-this.transform.bearingInRadians:this.transform.bearingInRadians)):e=!1}if(n.textBox||n.verticalTextBox){let r;n.textBox&&(r=v),n.verticalTextBox&&(r=x),ie(t.textCollisionBox.collisionVertexArray,c.text.placed,!e||r,b.text,i.x,i.y)}}if(n.iconBox||n.verticalIconBox){const e=Boolean(!x&&n.verticalIconBox);let r;n.iconBox&&(r=e),n.verticalIconBox&&(r=!e),ie(t.iconCollisionBox.collisionVertexArray,c.icon.placed,r,b.icon,d?i.x:0,d?i.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function ie(t,e,i,n,r,o){n&&0!==n.length||(n=[0,0,0,0]);const s=n[0]-Wt,a=n[1]-Wt,l=n[2]-Wt,c=n[3]-Wt;t.emplaceBack(e?1:0,i?1:0,r||0,o||0,s,a),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,l,a),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,l,c),t.emplaceBack(e?1:0,i?1:0,r||0,o||0,s,c)}const ne=Math.pow(2,25),re=Math.pow(2,24),oe=Math.pow(2,17),se=Math.pow(2,16),ae=Math.pow(2,9),le=Math.pow(2,8),ce=Math.pow(2,1);function ue(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*ne+e*re+i*oe+e*se+i*ae+e*le+i*ce+e}const he=0;class pe{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,r())return!0;return!1}}class de{constructor(t,e,i,n,r,o,s,a){this.placement=new ee(t,e,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,e,i){const n=s.now(),r=()=>!this._forceFullPlacement&&s.now()-n>2;for(;this._currentPlacementIndex>=0;){const n=e[t[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===n.type&&(!n.minzoom||n.minzoom<=o)&&(!n.maxzoom||n.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new pe(n)),this._inProgressLayer.continuePlacement(i[n.source],this.placement,this._showCollisionBoxes,n,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const fe=512/e.Z/2;class me{constructor(t,i,n){this.tileID=t,this.bucketInstanceId=n,this._symbolsByKey={};const r=new Map;for(let t=0;t<i.length;t++){const e=i.get(t),n=e.key,o=r.get(n);o?o.push(e):r.set(n,[e])}for(const[t,i]of r){const n={positions:i.map((t=>({x:Math.floor(t.anchorX*fe),y:Math.floor(t.anchorY*fe)}))),crossTileIDs:i.map((t=>t.crossTileID))};if(n.positions.length>128){const t=new e.aF(n.positions.length,16,Uint16Array);for(const{x:e,y:i}of n.positions)t.add(e,i);t.finish(),delete n.positions,n.index=t}this._symbolsByKey[t]=n}}getScaledCoordinates(t,i){const{x:n,y:r,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=fe/Math.pow(2,l-o),u=(a*e.Z+t.anchorY)*c,h=r*e.Z*fe;return{x:Math.floor((s*e.Z+t.anchorX)*c-n*e.Z*fe),y:Math.floor(u-h)}}findMatches(t,e,i){const n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let r=0;r<t.length;r++){const o=t.get(r);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);if(s.index){const t=s.index.range(a.x-n,a.y-n,a.x+n,a.y+n).sort();for(const e of t){const t=s.crossTileIDs[e];if(!i[t]){i[t]=!0,o.crossTileID=t;break}}}else if(s.positions)for(let t=0;t<s.positions.length;t++){const e=s.positions[t],r=s.crossTileIDs[t];if(Math.abs(e.x-a.x)<=n&&Math.abs(e.y-a.y)<=n&&!i[r]){i[r]=!0,o.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ge{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ye{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],n={};for(const t in i){const r=i[t];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),n[r.tileID.key]=r}this.indexes[t]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,n)}else{const o=r[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,n)}}for(let t=0;t<e.symbolInstances.length;t++){const r=e.symbolInstances.get(t);r.crossTileID||(r.crossTileID=i.generate(),n[r.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new me(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.getCrossTileIDsLists())for(const e of i)delete this.usedCrossTileIDs[t][e]}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)t[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],e=!0)}return e}}class _e{constructor(){this.layerIndexes={},this.crossTileIDs=new ge,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i){let n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new ye);let r=!1;const o={};n.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,e,this.crossTileIDs)&&(r=!0),o[e.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}var ve="void main() {fragColor=vec4(1.0);}";const xe={prelude:be("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:be("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:be("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:be("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:be("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:be("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:be(ve,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:be("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:be("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:be("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:be("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:be("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:be(ve,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:be("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:be("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:be("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:be("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:be("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:be("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:\nbasic_hillshade(deriv);break;case COMBINED:\ncombined_hillshade(deriv);break;case IGOR:\nigor_hillshade(deriv);break;case MULTIDIRECTIONAL:\nmultidirectional_hillshade(deriv);break;case STANDARD:\ndefault:\nstandard_hillshade(deriv);break;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:be("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:be("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:be("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:be("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:be("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:be("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:be("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:be("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:be("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:be("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:be("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:be("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:be("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:be("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function be(t,e){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/in ([\w]+) ([\w]+)/g),r=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(r):r,a={};return{fragmentSource:t=t.replace(i,((t,e,i,n,r)=>(a[r]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nin ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`))),vertexSource:e=e.replace(i,((t,e,i,n,r)=>{const o="float"===n?"vec2":"vec4",s=r.match(/color/)?"color":o;return a[r]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${o} a_${r};\nout ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:n,staticUniforms:s}}class we{constructor(t,e,i){this.vertexBuffer=t,this.indexBuffer=e,this.segments=i}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Te=e.aG([{name:"a_pos",type:"Int16",components:2}]);const Se="#define PROJECTION_MERCATOR",Ce="mercator";class Ee{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ce}get shaderDefine(){return Se}get shaderPreludeCode(){return xe.projectionMercator}get vertexShaderPreludeCode(){return xe.projectionMercator.vertexSource}get subdivisionGranularity(){return e.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,i,n,r,o){if(this._cachedMesh)return this._cachedMesh;const s=new e.aI;s.emplaceBack(0,0),s.emplaceBack(e.Z,0),s.emplaceBack(0,e.Z),s.emplaceBack(e.Z,e.Z);const a=t.createVertexBuffer(s,Te.members),l=e.aJ.simpleSegment(0,0,4,2),c=new e.aK;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=t.createIndexBuffer(c);return this._cachedMesh=new we(a,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ie{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.B.number(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.B.number(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.B.number(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.B.number(t.right,i.right,n)),this}getCenter(t,i){const n=e.ae((this.left+t-this.right)/2,0,t),r=e.ae((this.top+i-this.bottom)/2,0,i);return new e.P(n,r)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ie(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Me(t,e){if(!t.renderWorldCopies||t.lngRange)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}function Ae(t){return Math.max(0,Math.floor(t))}class ke{constructor(t,i,n,r,o,s){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=void 0===s||!!s,this._minZoom=i||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==o?60:o,this.setMaxBounds(),this._width=0,this._height=0,this._center=new e.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ae(this._zoom),this._scale=e.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ie,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,i,n){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Ae(this._zoom),this._scale=e.ac(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ie(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!n&&t.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const i=e.aL(t,-180,180)*Math.PI/180;var r,o,s,a,l,c,u,h,p;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=n(),r=this._rotationMatrix,s=-this._bearingInRadians,a=(o=this._rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(s),p=Math.cos(s),r[0]=a*p+c*h,r[1]=l*p+u*h,r[2]=a*-h+c*p,r[3]=l*-h+u*p)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const i=e.ae(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const e=t/180*Math.PI;this._rollInRadians!==e&&(this._unmodified=!1,this._rollInRadians=e,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return e.aM(this._fovInRadians)}setFov(t){t=e.ae(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=e.ab(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const i=this.getConstrained(this._center,t).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=e.ac(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,e){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=e,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}resize(t,e,i=!0){this._width=t,this._height=e,i&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new G([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,e.af])}getConstrained(t,e){return this._callbacks.getConstrained(t,e)}getCameraQueryGeometry(t,i){if(1===i.length)return[i[0],t];{let n=t.x,r=t.y,o=t.x,s=t.y;for(const t of i)n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y);return[new e.P(n,r),new e.P(o,r),new e.P(o,s),new e.P(n,s),new e.P(n,r)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:i}=this.getConstrained(this.center,this.zoom);this.setCenter(e),this.setZoom(i),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=e.ad(new Float64Array(16));e.M(t,t,[this._width/2,-this._height/2,1]),e.L(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=e.ad(new Float64Array(16)),e.M(t,t,[1,-1,1]),e.L(t,t,[-1,-1,0]),e.M(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,i,n,r){const o=void 0!==n?n:this.bearing,s=r=void 0!==r?r:this.pitch,a=e.$.fromLngLat(t,i),l=-Math.cos(e.ab(s)),c=Math.sin(e.ab(s)),u=c*Math.sin(e.ab(o)),h=-c*Math.cos(e.ab(o));let p=this.elevation;const d=i-p;let f;l*d>=0||Math.abs(l)<.1?(f=1e4,p=i+f*l):f=-d/l;let m,g,y=e.aN(1,a.y),_=0;do{if(_+=1,_>10)break;g=f/y,m=new e.$(a.x+u*g,a.y+h*g),y=1/m.meterInMercatorCoordinateUnits()}while(Math.abs(f-g*y)>1e-12);return{center:m.toLngLat(),elevation:p,zoom:e.ah(this.height/2/Math.tan(this.fovInRadians/2)/g/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const i=e.ag(1,this.center.lat)*this.worldSize,n=this.cameraToCenterDistance/i,r=e.$.fromLngLat(this.center,this.elevation),o=dt(this.center,this.elevation,this.pitch,this.bearing,n);this._elevation=t;const s=this.calculateCenterFromCameraLngLatAlt(o.toLngLat(),e.aN(o.z,r.y),this.bearing,this.pitch);this._elevation=s.elevation,this._center=s.center,this.setZoom(s.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=e.ag(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const i=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/i,t.canonical.y/i,1/i/e.Z,1/i/e.Z]}}class Pe{constructor(t,i){this.min=t,this.max=i,this.center=e.aO([],e.aP([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],n=e.aQ(this.min),r=e.aQ(this.max);for(let t=0;t<i.length;t++)n[t]=i[t]?this.min[t]:this.center[t],r[t]=i[t]?this.center[t]:this.max[t];return r[2]=this.max[2],new Pe(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let e=!0;for(let i=0;i<t.planes.length;i++){const n=this.intersectsPlane(t.planes[i]);if(0===n)return 0;1===n&&(e=!1)}return e?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let e=t[3],i=t[3];for(let n=0;n<3;n++)t[n]>0?(e+=t[n]*this.min[n],i+=t[n]*this.max[n]):(i+=t[n]*this.min[n],e+=t[n]*this.max[n]);return e>=0?2:i<0?0:1}}class Le{distanceToTile2d(t,e,i,n){const r=n.distanceX([t,e]),o=n.distanceY([t,e]);return Math.hypot(r,o)}getWrap(t,e,i){return i}getTileAABB(t,i,n,r){var o,s;let a=n,l=n;if(r.terrain){const c=new e.Y(t.z,i,t.z,t.x,t.y),u=r.terrain.getMinMaxElevation(c);a=null!==(o=u.minElevation)&&void 0!==o?o:n,l=null!==(s=u.maxElevation)&&void 0!==s?s:n}const c=1<<t.z;return new Pe([i+t.x/c,t.y/c,a],[i+(t.x+1)/c,(t.y+1)/c,l])}allowVariableZoom(t,i){const n=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,r=e.ae(78.5-n/2,0,60);return!!i.terrain||t.pitch>r}allowWorldCopies(){return!0}recalculateCache(){}}class ze{constructor(t,e,i){this.points=t,this.planes=e,this.aabb=i}static fromInvProjectionMatrix(t,i=1,n=0){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=1/(n=e.at([],n,t))[3]/i*r;return e.aR(n,n,[o,o,1/n[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const i=e.aS([],o[t[0]],o[t[1]]),n=e.aS([],o[t[2]],o[t[1]]),r=e.aT([],e.aU([],i,n)),s=-e.aV(r,o[t[1]]);return r.concat(s)})),a=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],l=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const t of o)for(let e=0;e<3;e++)a[e]=Math.min(a[e],t[e]),l[e]=Math.max(l[e],t[e]);return new ze(o,s,new Pe(a,l))}}class De{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,i){return this._helper.interpolatePadding(t,e,i)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e,i=!0){this._helper.resize(t,e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,e){}constructor(t,e,i,n,r){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new ke({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)},t,e,i,n,r),this._coveringTilesDetailsProvider=new Le}clone(){const t=new De;return t.apply(this),t}apply(t,e,i){this._helper.apply(t,e,i)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const i=[new e.aW(0,t)];if(this._helper._renderWorldCopies){const n=this.screenPointToMercatorCoordinate(new e.P(0,0)),r=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,0)),o=this.screenPointToMercatorCoordinate(new e.P(this._helper._width,this._helper._height)),s=this.screenPointToMercatorCoordinate(new e.P(0,this._helper._height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new e.aW(n,t))}return i}getCameraFrustum(){return ze.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const e=this.screenPointToLocation(this.centerPoint,t),i=t?t.getElevationForLngLatZoom(e,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(i)}setLocationAtPoint(t,i){const n=e.ag(this.elevation,this.center.lat),r=this.screenPointToMercatorCoordinateAtZ(i,n),o=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,n),s=e.$.fromLngLat(t),a=new e.$(s.x-(r.x-o.x),s.y-(r.y-o.y));this.setCenter(null==a?void 0:a.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,i){return i?this.coordinatePoint(e.$.fromLngLat(t),i.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(e.$.fromLngLat(t))}screenPointToLocation(t,e){var i;return null===(i=this.screenPointToMercatorCoordinate(t,e))||void 0===i?void 0:i.toLngLat()}screenPointToMercatorCoordinate(t,e){if(e){const i=e.pointCoordinate(t);if(null!=i)return i}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,i){const n=i||0,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.at(r,r,this._pixelMatrixInverse),e.at(o,o,this._pixelMatrixInverse);const s=r[3],a=o[3],l=r[1]/s,c=o[1]/a,u=r[2]/s,h=o[2]/a,p=u===h?0:(n-u)/(h-u);return new e.$(e.B.number(r[0]/s,o[0]/a,p)/this.worldSize,e.B.number(l,c,p)/this.worldSize,n)}coordinatePoint(t,i=0,n=this._pixelMatrix){const r=[t.x*this.worldSize,t.y*this.worldSize,i,1];return e.at(r,r,n),new e.P(r[0]/r[3],r[1]/r[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ht(this));return(new G).extend(this.screenPointToLocation(new e.P(0,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,t))).extend(this.screenPointToLocation(new e.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new e.P(0,this._helper._height)))}isPointOnMapSurface(t,e){return e?null!=e.pointCoordinate(t):t.y>this.height/2-ht(this)}calculatePosMatrix(t,i=!1,n){var r;const o=null!==(r=t.key)&&void 0!==r?r:e.aX(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),s=i?this._alignedPosMatrixCache:this._posMatrixCache;if(s.has(o)){const t=s.get(o);return n?t.f32:t.f64}const a=pt(t,this.worldSize);e.N(a,i?this._alignedProjMatrix:this._viewProjMatrix,a);const l={f64:a,f32:new Float32Array(a)};return s.set(o,l),n?l.f32:l.f64}calculateFogMatrix(t){const i=t.key,n=this._fogMatrixCacheF32;if(n.has(i))return n.get(i);const r=pt(t,this.worldSize);return e.N(r,this._fogMatrix,r),n.set(i,new Float32Array(r)),n.get(i)}getConstrained(t,i){i=e.ae(+i,this.minZoom,this.maxZoom);const n={center:new e.Q(t.lng,t.lat),zoom:i};let r=this._helper._lngRange;this._helper._renderWorldCopies||null!==r||(r=[-179.9999999999,180-1e-10]);const o=this.tileSize*e.ac(n.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:p,y:d}=this.size;if(this._helper._latRange){const t=this._helper._latRange;s=e.S(t[1])*o,a=e.S(t[0])*o,a-s<d&&(u=d/(a-s))}r&&(l=e.aL(e.U(r[0])*o,0,o),c=e.aL(e.U(r[1])*o,0,o),c<l&&(c+=o),c-l<p&&(h=p/(c-l)));const{x:f,y:m}=ct(o,t);let g,y;const _=Math.max(h||0,u||0);if(_){const t=new e.P(h?(c+l)/2:f,u?(a+s)/2:m);return n.center=ut(o,t).wrap(),n.zoom+=e.ah(_),n}if(this._helper._latRange){const t=d/2;m-t<s&&(y=s+t),m+t>a&&(y=a-t)}if(r){const t=(l+c)/2;let i=f;this._helper._renderWorldCopies&&(i=e.aL(f,t-o/2,t+o/2));const n=p/2;i-n<l&&(g=l+n),i+n>c&&(g=c-n)}if(void 0!==g||void 0!==y){const t=new e.P(null!=g?g:f,null!=y?y:m);n.center=ut(o,t).wrap()}return n}calculateCenterFromCameraLngLatAlt(t,e,i,n){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,i,n)}_calculateNearFarZIfNeeded(t,i,n){if(!this._helper.autoCalculateNearFarZ)return;const r=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),o=t-r*this._helper._pixelPerMeter/Math.cos(i),s=r<0?o:t,a=Math.PI/2+this.pitchInRadians,l=e.ab(this.fov)*(Math.abs(Math.cos(e.ab(this.roll)))*this.height+Math.abs(Math.sin(e.ab(this.roll)))*this.width)/this.height*(.5+n.y/this.height),c=Math.sin(l)*s/Math.sin(e.ae(Math.PI-a-l,.01,Math.PI-.01)),u=ht(this),h=Math.atan(u/this._helper.cameraToCenterDistance),p=e.ab(.75),d=h>p?2*h*(.5+n.y/(2*u)):p,f=Math.sin(d)*s/Math.sin(e.ae(Math.PI-a-d,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*m+s),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,i=ct(this.worldSize,this.center),n=i.x,r=i.y;this._helper._pixelPerMeter=e.ag(1,this.center.lat)*this.worldSize;const o=e.ab(Math.min(this.pitch,lt)),s=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(o));let a;this._calculateNearFarZIfNeeded(s,o,t),a=new Float64Array(16),e.aY(a,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),e.an(this._invProjMatrix,a),a[8]=2*-t.x/this._helper._width,a[9]=2*t.y/this._helper._height,this._projectionMatrix=e.aZ(a),e.M(a,a,[1,-1,1]),e.L(a,a,[0,0,-this._helper.cameraToCenterDistance]),e.a_(a,a,-this.rollInRadians),e.a$(a,a,this.pitchInRadians),e.a_(a,a,-this.bearingInRadians),e.L(a,a,[-n,-r,0]),this._mercatorMatrix=e.M([],a,[this.worldSize,this.worldSize,this.worldSize]),e.M(a,a,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=e.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a),e.L(a,a,[0,0,-this.elevation]),this._viewProjMatrix=a,this._invViewProjMatrix=e.an([],a);const l=[0,0,-1,1];e.at(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),e.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,s,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,e.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),e.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),e.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),e.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),e.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),e.L(this._fogMatrix,this._fogMatrix,[-n,-r,0]),e.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),e.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=e.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),p=Math.sin(-this.bearingInRadians),d=n-Math.round(n)+h*c+p*u,f=r-Math.round(r)+h*u+p*c,m=new Float64Array(a);if(e.L(m,m,[d>.5?d-1:d,f>.5?f-1:f,0]),this._alignedProjMatrix=m,a=e.an(new Float64Array(16),this._pixelMatrix),!a)throw new Error("failed to invert matrix");this._pixelMatrixInverse=a,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new e.P(0,0)),i=[t.x*this.worldSize,t.y*this.worldSize,0,1];return e.at(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=e.ag(1,this.center.lat)*this.worldSize;return dt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,i){const n=e.$.fromLngLat(t),r=[n.x*this.worldSize,n.y*this.worldSize,i,1];return e.at(r,r,this._viewProjMatrix),r[2]/r[3]}getProjectionData(t){const{overscaledTileID:i,aligned:n,applyTerrainMatrix:r}=t,o=this._helper.getMercatorTileCoordinates(i),s=i?this.calculatePosMatrix(i,n,!0):null;let a;return a=i&&i.terrainRttPosMatrix32f&&r?i.terrainRttPosMatrix32f:s||e.b0(),{mainMatrix:a,tileMercatorCoords:o,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,e,i){return 1}transformLightDirection(t){return e.aQ(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,i,n,r){const o=this.calculatePosMatrix(n);let s;r?(s=[t,i,r(t,i),1],e.at(s,s,o)):(s=[t,i,0,1],Zt(s,s,o));const a=s[3];return{point:new e.P(s[0]/a,s[1]/a),signedDistanceFromCamera:a,isOccluded:!1}}populateCache(t){for(const e of t)this.calculatePosMatrix(e)}getMatrixForModel(t,i){const n=e.$.fromLngLat(t,i),r=n.meterInMercatorCoordinateUnits(),o=e.b1();return e.L(o,o,[n.x,n.y,n.z]),e.a_(o,o,Math.PI),e.a$(o,o,Math.PI/2),e.M(o,o,[-r,r,r]),o}getProjectionDataForCustomLayer(t=!0){const i=new e.Y(0,0,0,0,0),n=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:t}),r=pt(i,this.worldSize);e.N(r,this._viewProjMatrix,r),n.tileMercatorCoords=[0,0,1,1];const o=[e.Z,e.Z,this.worldSize/this._helper.pixelsPerMeter],s=e.b2();return e.M(s,r,o),n.fallbackMatrix=s,n.mainMatrix=s,n}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Re(){e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Oe(t){if(t.useSlerp)if(t.k<1){const i=e.b3(t.startEulerAngles.roll,t.startEulerAngles.pitch,t.startEulerAngles.bearing),n=e.b3(t.endEulerAngles.roll,t.endEulerAngles.pitch,t.endEulerAngles.bearing),r=new Float64Array(4);e.b4(r,i,n,t.k);const o=e.b5(r);t.tr.setRoll(o.roll),t.tr.setPitch(o.pitch),t.tr.setBearing(o.bearing)}else t.tr.setRoll(t.endEulerAngles.roll),t.tr.setPitch(t.endEulerAngles.pitch),t.tr.setBearing(t.endEulerAngles.bearing);else t.tr.setRoll(e.B.number(t.startEulerAngles.roll,t.endEulerAngles.roll,t.k)),t.tr.setPitch(e.B.number(t.startEulerAngles.pitch,t.endEulerAngles.pitch,t.k)),t.tr.setBearing(e.B.number(t.startEulerAngles.bearing,t.endEulerAngles.bearing,t.k))}function Fe(t,i,n,r,o){const s=o.padding,a=ct(o.worldSize,n.getNorthWest()),l=ct(o.worldSize,n.getNorthEast()),c=ct(o.worldSize,n.getSouthEast()),u=ct(o.worldSize,n.getSouthWest()),h=e.ab(-r),p=a.rotate(h),d=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new e.P(Math.max(p.x,d.x,m.x,f.x),Math.max(p.y,d.y,m.y,f.y)),y=new e.P(Math.min(p.x,d.x,m.x,f.x),Math.min(p.y,d.y,m.y,f.y)),_=g.sub(y),v=(o.width-(s.left+s.right+i.left+i.right))/_.x,x=(o.height-(s.top+s.bottom+i.top+i.bottom))/_.y;if(x<0||v<0)return void Re();const b=Math.min(e.ah(o.scale*Math.min(v,x)),t.maxZoom),w=e.P.convert(t.offset),T=new e.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(e.ab(r)),S=w.add(T).mult(o.scale/e.ac(b));return{center:ut(o.worldSize,a.add(c).div(2).sub(S)),zoom:b,bearing:r}}class Ne{get useGlobeControls(){return!1}handlePanInertia(t,e){return{easingOffset:t,easingCenter:e.center}}handleMapControlsRollPitchBearingZoom(t,e){t.bearingDelta&&e.setBearing(e.bearing+t.bearingDelta),t.pitchDelta&&e.setPitch(e.pitch+t.pitchDelta),t.rollDelta&&e.setRoll(e.roll+t.rollDelta),t.zoomDelta&&e.setZoom(e.zoom+t.zoomDelta)}handleMapControlsPan(t,e,i){t.around.distSqr(e.centerPoint)<.01||e.setLocationAtPoint(i,t.around)}cameraForBoxAndBearing(t,e,i,n,r){return Fe(t,e,i,n,r)}handleJumpToCenterZoom(t,i){t.zoom!==(void 0!==i.zoom?+i.zoom:t.zoom)&&t.setZoom(+i.zoom),void 0!==i.center&&t.setCenter(e.Q.convert(i.center))}handleEaseTo(t,i){const n=t.zoom,r=t.padding,o={roll:t.roll,pitch:t.pitch,bearing:t.bearing},s={roll:void 0===i.roll?t.roll:i.roll,pitch:void 0===i.pitch?t.pitch:i.pitch,bearing:void 0===i.bearing?t.bearing:i.bearing},a=void 0!==i.zoom,l=!t.isPaddingEqual(i.padding);let c=!1;const u=a?+i.zoom:t.zoom;let h=t.centerPoint.add(i.offsetAsPoint);const p=t.screenPointToLocation(h),{center:d,zoom:f}=t.getConstrained(e.Q.convert(i.center||p),null!=u?u:n);Me(t,d);const m=ct(t.worldSize,p),g=ct(t.worldSize,d).sub(m),y=e.ac(f-n);return c=f!==n,{easeFunc:a=>{if(c&&t.setZoom(e.B.number(n,f,a)),e.b6(o,s)||Oe({startEulerAngles:o,endEulerAngles:s,tr:t,k:a,useSlerp:o.roll!=s.roll}),l&&(t.interpolatePadding(r,i.padding,a),h=t.centerPoint.add(i.offsetAsPoint)),i.around)t.setLocationAtPoint(i.around,i.aroundPoint);else{const i=e.ac(t.zoom-n),r=f>n?Math.min(2,y):Math.max(.5,y),o=Math.pow(r,1-a),s=ut(t.worldSize,m.add(g.mult(a*o)).mult(i));t.setLocationAtPoint(t.renderWorldCopies?s.wrap():s,h)}},isZooming:c,elevationCenter:d}}handleFlyTo(t,i){const n=void 0!==i.zoom,r=t.zoom,o=t.getConstrained(e.Q.convert(i.center||i.locationAtOffset),n?+i.zoom:r),s=o.center,a=o.zoom;Me(t,s);const l=ct(t.worldSize,i.locationAtOffset),c=ct(t.worldSize,s).sub(l),u=c.mag(),h=e.ac(a-r);let p;if(void 0!==i.minZoom){const n=Math.min(+i.minZoom,r,a),o=t.getConstrained(s,n).zoom;p=e.ac(o-r)}return{easeFunc:(i,n,o,u)=>{t.setZoom(1===i?a:r+e.ah(n));const h=1===i?s:ut(t.worldSize,l.add(c.mult(o)).mult(n));t.setLocationAtPoint(t.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:s,scaleOfMinZoom:p,pixelPathLength:u}}}class Be{constructor(t,e,i){this.blendFunction=t,this.blendColor=e,this.mask=i}}Be.Replace=[1,0],Be.disabled=new Be(Be.Replace,e.b7.transparent,[!1,!1,!1,!1]),Be.unblended=new Be(Be.Replace,e.b7.transparent,[!0,!0,!0,!0]),Be.alphaBlended=new Be([1,771],e.b7.transparent,[!0,!0,!0,!0]);const je=2305;class $e{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}$e.disabled=new $e(!1,1029,je),$e.backCCW=new $e(!0,1029,je),$e.frontCCW=new $e(!0,1028,je);class Ue{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}Ue.ReadOnly=!1,Ue.ReadWrite=!0,Ue.disabled=new Ue(519,Ue.ReadOnly,[0,1]);const Ve=7680;class Ge{constructor(t,e,i,n,r,o){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Ge.disabled=new Ge({func:519,mask:0},0,0,Ve,Ve,Ve);const qe=new WeakMap;function Ze(t){var e;if(qe.has(t))return qe.get(t);{const i=null===(e=t.getParameter(t.VERSION))||void 0===e?void 0:e.startsWith("WebGL 2.0");return qe.set(t,i),i}}class We{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const i=t.context,n=i.gl;this._texFormat=n.RGBA,this._texType=n.UNSIGNED_BYTE;const r=new e.aI;r.emplaceBack(-1,-1),r.emplaceBack(2,-1),r.emplaceBack(-1,2);const o=new e.aK;o.emplaceBack(0,1,2),this._fullscreenTriangle=new we(i.createVertexBuffer(r,Te.members),i.createIndexBuffer(o),e.aJ.simpleSegment(0,0,r.length,o.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(n.TEXTURE1);const s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texImage2D(n.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(s),Ze(n)&&(this._pbo=n.createBuffer(),n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.bufferData(n.PIXEL_PACK_BUFFER,4,n.STREAM_READ),n.bindBuffer(n.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,e){const i=this._updateCount;return this._readbackQueue?i>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():i>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,e),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,e=t.gl;t.activeTexture.set(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,i){const n=this._cachedRenderContext.context,r=n.gl;if(this._bindFramebuffer(),n.viewport.set([0,0,this._texWidth,this._texHeight]),n.clear({color:e.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(n,r.TRIANGLES,Ue.disabled,Ge.disabled,Be.unblended,$e.disabled,((t,e)=>({u_input:t,u_output_expected:e}))(t,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ze(r)){r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.readBuffer(r.COLOR_ATTACHMENT0),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null);const t=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:t}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ze(t)){const i=t.clientWaitSync(this._readbackQueue.sync,0,0);if(i===t.WAIT_FAILED)return e.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=We._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let e=0;return e+=t[0]/256,e+=t[1]/65536,e+=t[2]/16777216,t[3]<127&&(e=-e),e/128}}const He=e.Z/128;function Xe(t,i){const n=void 0!==t.granularity?Math.max(t.granularity,1):1,r=n+(t.generateBorders?2:0),o=n+(t.extendToNorthPole||t.generateBorders?1:0)+(t.extendToSouthPole||t.generateBorders?1:0),s=r+1,a=o+1,l=t.generateBorders?-1:0,c=t.generateBorders||t.extendToNorthPole?-1:0,u=n+(t.generateBorders?1:0),h=n+(t.generateBorders||t.extendToSouthPole?1:0),p=s*a,d=r*o*6,f=s*a>65536;if(f&&"16bit"===i)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===i,g=new Int16Array(2*p);let y=0;for(let i=c;i<=h;i++)for(let r=l;r<=u;r++){let o=r/n*e.Z;-1===r&&(o=-64),r===n+1&&(o=e.Z+He);let s=i/n*e.Z;-1===i&&(s=t.extendToNorthPole?e.b9:-64),i===n+1&&(s=t.extendToSouthPole?e.ba:e.Z+He),g[y++]=o,g[y++]=s}const _=m?new Uint32Array(d):new Uint16Array(d);let v=0;for(let t=0;t<o;t++)for(let e=0;e<r;e++){const i=e+1+t*s,n=e+(t+1)*s,r=e+1+(t+1)*s;_[v++]=e+t*s,_[v++]=n,_[v++]=i,_[v++]=i,_[v++]=n,_[v++]=r}return{vertices:g.buffer.slice(0),indices:_.buffer.slice(0),uses32bitIndices:m}}const Ye=new e.aH({fill:new e.bb(128,2),line:new e.bb(512,0),tile:new e.bb(128,32),stencil:new e.bb(128,1),circle:3});class Ke{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return xe.projectionGlobe}get vertexShaderPreludeCode(){return xe.projectionMercator.vertexSource}get subdivisionGranularity(){return Ye}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new We(t));const i=e.S(this._errorQueryLatitudeDegrees),n=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,r=this._errorMeasurement.updateErrorLoop(i,n),o=s.now();r!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=r,this._errorMeasurementLastChangeTime=o);const a=Math.min(Math.max((o-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=e.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,e.bd(a))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,e,i,n,r){const o=("stencil"===r?Ye.stencil:Ye.tile).getGranularityForZoomLevel(e.z);return this._getMesh(t,{granularity:o,generateBorders:i,extendToNorthPole:0===e.y&&n,extendToSouthPole:e.y===(1<<e.z)-1&&n})}_getMesh(t,i){const n=this._getMeshKey(i);if(n in this._tileMeshCache)return this._tileMeshCache[n];const r=function(t,i){const n=Xe(i,"16bit"),r=e.aI.deserialize({arrayBuffer:n.vertices,length:n.vertices.byteLength/2/2}),o=e.aK.deserialize({arrayBuffer:n.indices,length:n.indices.byteLength/2/3});return new we(t.createVertexBuffer(r,Te.members),t.createIndexBuffer(o),e.aJ.simpleSegment(0,0,r.length,o.length))}(t,i);return this._tileMeshCache[n]=r,r}recalculate(t){}hasTransition(){const t=s.now();let e=!1;return e=e||(t-this._errorMeasurementLastChangeTime)/1e3<.7,e=e||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,e}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Je=new e.r({type:new e.D(e.v.projection.type)});class Qe extends e.E{constructor(t){super(),this._transitionable=new e.T(Je),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new e.C(0)),this._mercatorProjection=new Ee,this._verticalPerspectiveProjection=new Ke}get transitionState(){const t=this.properties.get("type");if("string"==typeof t&&"mercator"===t)return 0;if("string"==typeof t&&"vertical-perspective"===t)return 1;if(t instanceof e.be){if("vertical-perspective"===t.from&&"mercator"===t.to)return 1-t.transition;if("mercator"===t.from&&"vertical-perspective"===t.to)return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,e,i,n,r){return this.currentProjection.getMeshFromTileID(t,e,i,n,r)}setProjection(t){this._transitionable.setValue("type",(null==t?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ti(t){const e=ni(t.worldSize,t.center.lat);return 2*Math.PI*e}function ei(t,i,n,r,o){const s=1/(1<<o),a=i/e.Z*s+r*s,l=e.bg((t/e.Z*s+n*s)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function ii(t){return function(t,e){const i=Math.cos(e),n=new Float64Array(3);return n[0]=Math.sin(t)*i,n[1]=Math.sin(e),n[2]=Math.cos(t)*i,n}(t.lng*Math.PI/180,t.lat*Math.PI/180)}function ni(t,e){return t/(2*Math.PI)/Math.cos(e*Math.PI/180)}function ri(t){const i=Math.asin(t[1])/Math.PI*180,n=Math.sqrt(t[0]*t[0]+t[2]*t[2]);if(n>1e-6){const r=t[0]/n,o=Math.acos(t[2]/n),s=(r>0?o:-o)/Math.PI*180;return new e.Q(e.aL(s,-180,180),i)}return new e.Q(0,i)}function oi(t){return Math.cos(t*Math.PI/180)}function si(t,i){const n=oi(t),r=oi(i);return e.ah(r/n)}function ai(t,i){const n=t.rotate(i.bearingInRadians),r=i.zoom+si(i.center.lat,0),o=e.bc(1/oi(i.center.lat),1/oi(Math.min(Math.abs(i.center.lat),60)),e.bf(r,7,3,0,1)),s=360/ti({worldSize:i.worldSize,center:{lat:i.center.lat}});return new e.Q(i.center.lng-n.x*s*o,e.ae(i.center.lat+n.y*s,-85.051129,e.af))}function li(t){const e=.5*t,i=Math.sin(e),n=Math.cos(e);return Math.log(i+n)-Math.log(n-i)}function ci(t,i,n,r){const o=t.lat+n*r;if(Math.abs(n)>1){const s=(Math.sign(t.lat+n)!==Math.sign(t.lat)?-Math.abs(t.lat):Math.abs(t.lat))*Math.PI/180,a=Math.abs(t.lat+n)*Math.PI/180,l=li(s+r*(a-s)),c=li(s),u=li(a);return new e.Q(t.lng+i*((l-c)/(u-c)),o)}return new e.Q(t.lng+i*r,o)}class ui{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=t}recalculateCache(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(t,e,i,n){const r=`${t.z}_${t.x}_${t.y}`,o=this._cache.get(r);if(o)return o;const s=this._cachePrevious.get(r);if(s)return this._cache.set(r,s),s;const a=this._aabbFactory(t,e,i,n);return this._cache.set(r,a),this._hadAnyChanges=!0,a}}function hi(t,e,i){const n=t-e;return n<0?-n:Math.max(0,n-i)}function pi(t,e,i,n,r){const o=t-i;let s;return s=o<0?Math.min(-o,1+o-r):o>1?Math.min(Math.max(o-r,0),1-o):0,Math.max(s,hi(e,n,r))}class di{constructor(){this._aabbCache=new ui(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(t,e,i,n){const r=1<<i.z,o=1/r,s=i.x/r,a=i.y/r;let l=2;return l=Math.min(l,pi(t,e,s,a,o)),l=Math.min(l,pi(t,e,s+.5,-a-o,o)),l=Math.min(l,pi(t,e,s+.5,2-a-o,o)),l}getWrap(t,e,i){const n=1<<e.z,r=1/n,o=e.x/n,s=hi(t.x,o,r),a=hi(t.x,o-1,r),l=hi(t.x,o+1,r),c=Math.min(s,a,l);return c===l?1:c===a?-1:0}allowVariableZoom(t,e){return _t(t,e)>4}allowWorldCopies(){return!1}getTileAABB(t,e,i,n){return this._aabbCache.getTileAABB(t,e,i,n)}_computeTileAABB(t,i,n,r){if(t.z<=0)return new Pe([-1,-1,-1],[1,1,1]);if(1===t.z)return new Pe([0===t.x?-1:0,0===t.y?0:-1,-1],[0===t.x?0:1,0===t.y?1:0,1]);{const i=[ei(0,0,t.x,t.y,t.z),ei(e.Z,0,t.x,t.y,t.z),ei(e.Z,e.Z,t.x,t.y,t.z),ei(0,e.Z,t.x,t.y,t.z)],n=[1,1,1],r=[-1,-1,-1];for(const t of i)for(let e=0;e<3;e++)n[e]=Math.min(n[e],t[e]),r[e]=Math.max(r[e],t[e]);if(0===t.y||t.y===(1<<t.z)-1){const e=[0,0===t.y?1:-1,0];for(let t=0;t<3;t++)n[t]=Math.min(n[t],e[t]),r[t]=Math.max(r[t],e[t])}return new Pe(n,r)}}}class fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,i){return this._helper.interpolatePadding(t,e,i)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e){this._helper.resize(t,e)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=e.bk(),this._projectionMatrix=e.b1(),this._globeViewProjMatrix32f=e.b0(),this._globeViewProjMatrixNoCorrection=e.b1(),this._globeViewProjMatrixNoCorrectionInverted=e.b1(),this._globeProjMatrixInverted=e.b1(),this._cameraPosition=e.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new ke({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._coveringTilesDetailsProvider=new di}clone(){const t=new fi;return t.apply(this),t}apply(t,e){this._globeLatitudeErrorCorrectionRadians=e||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=e.bh();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:e,applyGlobeMatrix:i}=t,n=this._helper.getMercatorTileCoordinates(e);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:n,clippingPlane:this._cachedClippingPlane,projectionTransition:i?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const i=this.pitchInRadians,n=this.cameraToCenterDistance/t,r=Math.sin(i)*n,o=Math.cos(i)*n+1,s=1/Math.sqrt(r*r+o*o)*1;let a=-r,l=o;const c=Math.sqrt(a*a+l*l);a/=c,l/=c;const u=[0,a,l];e.bl(u,u,[0,0,0],-this.bearingInRadians),e.bm(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),e.bn(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/e.bo(u);return e.aO(u,u,h),[...u,-s*h]}isLocationOccluded(t){return!this.isSurfacePointVisible(ii(t))}transformLightDirection(t){const i=this._helper._center.lng*Math.PI/180,n=this._helper._center.lat*Math.PI/180,r=Math.cos(n),o=[Math.sin(i)*r,Math.sin(n),Math.cos(i)*r],s=[o[2],0,-o[0]],a=[0,0,0];e.aU(a,s,o),e.aT(s,s),e.aT(a,a);const l=[0,0,0];return e.aT(l,[s[0]*t[0]+a[0]*t[1]+o[0]*t[2],s[1]*t[0]+a[1]*t[1]+o[1]*t[2],s[2]*t[0]+a[2]*t[1]+o[2]*t[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,i,n){const r=function(t,i,n){const r=1/(1<<n.z);return new e.$(t/e.Z*r+n.x*r,i/e.Z*r+n.y*r)}(t,i,n.canonical),o=(s=r.y,[e.bg(r.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI]);var s;return this.getCircleRadiusCorrection()/Math.cos(o[1])}projectTileCoordinates(t,i,n,r){const o=n.canonical,s=ei(t,i,o.x,o.y,o.z),a=1+(r?r(t,i):0)/e.bu,l=[s[0]*a,s[1]*a,s[2]*a,1];e.at(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]<0;return{point:new e.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=ni(this.worldSize,this.center.lat),i=e.b2(),n=e.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),e.aY(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const r=this.centerOffset;i[8]=2*-r.x/this._helper._width,i[9]=2*r.y/this._helper._height,this._projectionMatrix=e.aZ(i),this._globeProjMatrixInverted=e.b2(),e.an(this._globeProjMatrixInverted,i),e.L(i,i,[0,0,-this.cameraToCenterDistance]),e.a_(i,i,this.rollInRadians),e.a$(i,i,-this.pitchInRadians),e.a_(i,i,this.bearingInRadians),e.L(i,i,[0,0,-t]);const o=e.bh();o[0]=t,o[1]=t,o[2]=t,e.a$(n,i,this.center.lat*Math.PI/180),e.bp(n,n,-this.center.lng*Math.PI/180),e.M(n,n,o),this._globeViewProjMatrixNoCorrection=n,e.a$(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),e.bp(i,i,-this.center.lng*Math.PI/180),e.M(i,i,o),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=e.b2(),e.an(this._globeViewProjMatrixNoCorrectionInverted,n);const s=e.bh();this._cameraPosition=e.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/t,e.bl(this._cameraPosition,this._cameraPosition,s,-this.rollInRadians),e.bm(this._cameraPosition,this._cameraPosition,s,this.pitchInRadians),e.bl(this._cameraPosition,this._cameraPosition,s,-this.bearingInRadians),e.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),e.bm(this._cameraPosition,this._cameraPosition,s,-this.center.lat*Math.PI/180),e.bn(this._cameraPosition,this._cameraPosition,s,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const a=e.aZ(this._globeViewProjMatrixNoCorrectionInverted);e.M(a,a,[1,1,-1]),this._cachedFrustum=ze.fromInvProjectionMatrix(a)}calculateFogMatrix(t){e.w("calculateFogMatrix is not supported on globe projection.");const i=e.b2();return e.ad(i),i}getVisibleUnwrappedCoordinates(t){return[new e.aW(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&e.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const n=ii(t);e.aO(n,n,1+i/e.bu);const r=e.bk();return e.at(r,[n[0],n[1],n[2],1],this._globeViewProjMatrixNoCorrection),r[2]/r[3]}populateCache(t){}getBounds(){const t=.5*this.width,i=.5*this.height,n=[new e.P(0,0),new e.P(t,0),new e.P(this.width,0),new e.P(this.width,i),new e.P(this.width,this.height),new e.P(t,this.height),new e.P(0,this.height),new e.P(0,i)],r=[];for(const t of n)r.push(this.unprojectScreenPoint(t));let o=0,s=0,a=0,l=0;const c=this.center;for(const t of r){const i=e.bq(c.lng,t.lng),n=e.bq(c.lat,t.lat);i<s&&(s=i),i>o&&(o=i),n<l&&(l=n),n>a&&(a=n)}const u=[c.lng+s,c.lat+l,c.lng+o,c.lat+a];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new G(u)}getConstrained(t,i){const n=e.ae(t.lat,-85.051129,e.af),r=e.ae(+i,this.minZoom+si(0,n),this.maxZoom);return{center:new e.Q(t.lng,n),zoom:r}}calculateCenterFromCameraLngLatAlt(t,e,i,n){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,i,n)}setLocationAtPoint(t,i){const n=ii(this.unprojectScreenPoint(i)),r=ii(t),o=e.bh();e.br(o);const s=e.bh();e.bn(s,n,o,-this.center.lng*Math.PI/180),e.bm(s,s,o,this.center.lat*Math.PI/180);const a=r[0]*r[0]+r[2]*r[2],l=s[0]*s[0];if(a<l)return;const c=Math.sqrt(a-l),u=-c,h=e.bs(r[0],r[2],s[0],c),p=e.bs(r[0],r[2],s[0],u),d=e.bh();e.bn(d,r,o,-h);const f=e.bs(d[1],d[2],s[1],s[2]),m=e.bh();e.bn(m,r,o,-p);const g=e.bs(m[1],m[2],s[1],s[2]),y=.5*Math.PI,_=f>=-y&&f<=y,v=g>=-y&&g<=y;let x,b;if(_&&v){const t=this.center.lng*Math.PI/180,i=this.center.lat*Math.PI/180;e.bv(h,t)+e.bv(f,i)<e.bv(p,t)+e.bv(g,i)?(x=h,b=f):(x=p,b=g)}else if(_)x=h,b=f;else{if(!v)return;x=p,b=g}const w=x/Math.PI*180,T=b/Math.PI*180,S=this.center.lat;this.setCenter(new e.Q(w,e.ae(T,-90,90))),this.setZoom(this.zoom+si(S,this.center.lat))}locationToScreenPoint(t,i){const n=ii(t);if(i){const r=i.getElevationForLngLatZoom(t,this._helper._tileZoom);e.aO(n,n,1+r/e.bu)}return this._projectSurfacePointToScreen(n)}_projectSurfacePointToScreen(t){const i=e.bk();return e.at(i,[...t,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new e.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,i){if(i){const e=i.pointCoordinate(t);if(e)return e}return e.$.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,e){var i;return null===(i=this.screenPointToMercatorCoordinate(t,e))||void 0===i?void 0:i.toLngLat()}isPointOnMapSurface(t,e){const i=this._cameraPosition,n=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(i,n)}getRayDirectionFromPixel(t){const i=e.bk();i[0]=t.x/this.width*2-1,i[1]=-1*(t.y/this.height*2-1),i[2]=1,i[3]=1,e.at(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const n=e.bh();n[0]=i[0]-this._cameraPosition[0],n[1]=i[1]-this._cameraPosition[1],n[2]=i[2]-this._cameraPosition[2];const r=e.bh();return e.aT(r,n),r}isSurfacePointVisible(t){const e=this._cachedClippingPlane;return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const i=e.bk();return e.at(i,[...t,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(t,i){const n=e.aV(t,i),r=e.bh(),o=e.bh();e.aO(o,i,n),e.aS(r,t,o);const s=1-e.aV(r,r);if(s<0)return null;const a=e.aV(t,t)-1,l=-n+(n<0?1:-1)*Math.sqrt(s),c=a/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(t){const i=this._cameraPosition,n=this.getRayDirectionFromPixel(t),r=this.rayPlanetIntersection(i,n);if(r){const t=e.bh();e.aP(t,i,[n[0]*r.tMin,n[1]*r.tMin,n[2]*r.tMin]);const o=e.bh();return e.aT(o,t),ri(o)}const o=this._cachedClippingPlane,s=o[0]*n[0]+o[1]*n[1]+o[2]*n[2],a=-e.bt(o,i)/s,l=e.bh();if(a>0)e.aP(l,i,[n[0]*a,n[1]*a,n[2]*a]);else{const t=e.bh();e.aP(t,i,[2*n[0],2*n[1],2*n[2]]);const r=e.bt(this._cachedClippingPlane,t);e.aS(l,t,[this._cachedClippingPlane[0]*r,this._cachedClippingPlane[1]*r,this._cachedClippingPlane[2]*r])}const c=function(t){const i=e.bh();return i[0]=t[0]*-t[3],i[1]=t[1]*-t[3],i[2]=t[2]*-t[3],{center:i,radius:Math.sqrt(1-t[3]*t[3])}}(o);return ri(function(t,i,n){const r=e.bh();e.aS(r,n,t);const o=e.bh();return e.bi(o,t,r,i/e.bj(r)),o}(c.center,c.radius,l))}getMatrixForModel(t,i){const n=e.Q.convert(t),r=1/e.bu,o=e.b1();return e.bp(o,o,n.lng/180*Math.PI),e.a$(o,o,-n.lat/180*Math.PI),e.L(o,o,[0,0,1+i/e.bu]),e.a$(o,o,.5*Math.PI),e.M(o,o,[r,r,r]),o}getProjectionDataForCustomLayer(t=!0){const i=this.getProjectionData({overscaledTileID:new e.Y(0,0,0,0,0),applyGlobeMatrix:t});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(t){}}class mi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,e,i){return this._helper.interpolatePadding(t,e,i)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,e,i=!0){this._helper.resize(t,e,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,e){this._helper.overrideNearFarZ(t,e)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,e){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=e,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new ke({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,e)=>this.getConstrained(t,e)}),this._globeness=1,this._mercatorTransform=new De,this._verticalPerspectiveTransform=new fi}clone(){const t=new mi;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const e=this._mercatorTransform.getProjectionData(t),i=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?i.mainMatrix:e.mainMatrix,clippingPlane:i.clippingPlane,tileMercatorCoords:i.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:e.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return e.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return e.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,i,n){const r=this._mercatorTransform.getPitchedTextCorrection(t,i,n),o=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,i,n);return e.bc(r,o,this._globeness)}projectTileCoordinates(t,e,i,n){return this.currentTransform.projectTileCoordinates(t,e,i,n)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,e){return this.currentTransform.lngLatToCameraDepth(t,e)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,e){return this.currentTransform.getConstrained(t,e)}calculateCenterFromCameraLngLatAlt(t,e,i,n){return this._helper.calculateCenterFromCameraLngLatAlt(t,e,i,n)}setLocationAtPoint(t,e){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,e),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,e),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,e){return this.currentTransform.locationToScreenPoint(t,e)}screenPointToMercatorCoordinate(t,e){return this.currentTransform.screenPointToMercatorCoordinate(t,e)}screenPointToLocation(t,e){return this.currentTransform.screenPointToLocation(t,e)}isPointOnMapSurface(t,e){return this.currentTransform.isPointOnMapSurface(t,e)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,e){return this.currentTransform.getMatrixForModel(t,e)}getProjectionDataForCustomLayer(t=!0){const e=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return e;const i=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return i.fallbackMatrix=e.mainMatrix,i}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class gi{get useGlobeControls(){return!0}handlePanInertia(t,i){const n=ai(t,i);return Math.abs(n.lng-i.center.lng)>180&&(n.lng=i.center.lng+179.5*Math.sign(n.lng-i.center.lng)),{easingCenter:n,easingOffset:new e.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,i){const n=t.around,r=i.screenPointToLocation(n);t.bearingDelta&&i.setBearing(i.bearing+t.bearingDelta),t.pitchDelta&&i.setPitch(i.pitch+t.pitchDelta),t.rollDelta&&i.setRoll(i.roll+t.rollDelta);const o=i.zoom;t.zoomDelta&&i.setZoom(i.zoom+t.zoomDelta);const s=i.zoom-o;if(0===s)return;const a=e.bq(i.center.lng,r.lng),l=a/(Math.abs(a/180)+1),c=e.bq(i.center.lat,r.lat),u=i.getRayDirectionFromPixel(n),h=i.cameraPosition,p=-1*e.aV(h,u),d=e.bh();e.aP(d,h,[u[0]*p,u[1]*p,u[2]*p]);const f=e.bo(d)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=ni(i.worldSize,i.center.lat)/Math.min(i.width,i.height),y=e.bf(g,.9,.5,1,.25),_=(1-e.ac(-s))*Math.min(m,y),v=i.center.lat,x=i.zoom,b=new e.Q(i.center.lng+l*_,e.ae(i.center.lat+c*_,-85.051129,e.af));i.setLocationAtPoint(r,n);const w=i.center,T=e.bf(Math.abs(a),45,85,0,1),S=e.bf(g,.75,.35,0,1),C=Math.pow(Math.max(T,S),.25),E=e.bq(w.lng,b.lng),I=e.bq(w.lat,b.lat);i.setCenter(new e.Q(w.lng+E*C,w.lat+I*C).wrap()),i.setZoom(x+si(v,i.center.lat))}handleMapControlsPan(t,e,i){if(!t.panDelta)return;const n=e.center.lat,r=e.zoom;e.setCenter(ai(t.panDelta,e).wrap()),e.setZoom(r+si(n,e.center.lat))}cameraForBoxAndBearing(t,i,n,r,o){const s=Fe(t,i,n,r,o),a=i.left/o.width*2-1,l=(o.width-i.right)/o.width*2-1,c=i.top/o.height*-2+1,u=(o.height-i.bottom)/o.height*-2+1,h=e.bq(n.getWest(),n.getEast())<0,p=h?n.getEast():n.getWest(),d=h?n.getWest():n.getEast(),f=Math.max(n.getNorth(),n.getSouth()),m=Math.min(n.getNorth(),n.getSouth()),g=p+.5*e.bq(p,d),y=f+.5*e.bq(f,m),_=o.clone();_.setCenter(s.center),_.setBearing(s.bearing),_.setPitch(0),_.setRoll(0),_.setZoom(s.zoom);const v=_.modelViewProjectionMatrix,x=[ii(n.getNorthWest()),ii(n.getNorthEast()),ii(n.getSouthWest()),ii(n.getSouthEast()),ii(new e.Q(d,y)),ii(new e.Q(p,y)),ii(new e.Q(g,f)),ii(new e.Q(g,m))],b=ii(s.center);let w=Number.POSITIVE_INFINITY;for(const t of x)a<0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(t,b,v,"x",a))),l>0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(t,b,v,"x",l))),c>0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(t,b,v,"y",c))),u<0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(t,b,v,"y",u)));if(Number.isFinite(w)&&0!==w)return s.zoom=_.zoom+e.ah(w),s;Re()}handleJumpToCenterZoom(t,i){const n=t.center.lat,r=t.getConstrained(i.center?e.Q.convert(i.center):t.center,t.zoom).center;t.setCenter(r.wrap());const o=void 0!==i.zoom?+i.zoom:t.zoom+si(n,r.lat);t.zoom!==o&&t.setZoom(o)}handleEaseTo(t,i){const n=t.zoom,r=t.center,o=t.padding,s={roll:t.roll,pitch:t.pitch,bearing:t.bearing},a={roll:void 0===i.roll?t.roll:i.roll,pitch:void 0===i.pitch?t.pitch:i.pitch,bearing:void 0===i.bearing?t.bearing:i.bearing},l=void 0!==i.zoom,c=!t.isPaddingEqual(i.padding);let u=!1;const h=i.center?e.Q.convert(i.center):r,p=t.getConstrained(h,n).center;Me(t,p);const d=t.clone();d.setCenter(p),d.setZoom(l?+i.zoom:n+si(r.lat,h.lat)),d.setBearing(i.bearing);const f=new e.P(e.ae(t.centerPoint.x+i.offsetAsPoint.x,0,t.width),e.ae(t.centerPoint.y+i.offsetAsPoint.y,0,t.height));d.setLocationAtPoint(p,f);const m=(i.offset&&i.offsetAsPoint.mag())>0?d.center:p,g=l?+i.zoom:n+si(r.lat,m.lat),y=n+si(r.lat,0),_=g+si(m.lat,0),v=e.bq(r.lng,m.lng),x=e.bq(r.lat,m.lat),b=e.ac(_-y);return u=g!==n,{easeFunc:n=>{if(e.b6(s,a)||Oe({startEulerAngles:s,endEulerAngles:a,tr:t,k:n,useSlerp:s.roll!=a.roll}),c&&t.interpolatePadding(o,i.padding,n),i.around)e.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(i.around,i.aroundPoint);else{const e=_>y?Math.min(2,b):Math.max(.5,b),i=Math.pow(e,1-n),o=ci(r,v,x,n*i);t.setCenter(o.wrap())}if(u){const i=e.B.number(y,_,n)+si(0,t.center.lat);t.setZoom(i)}},isZooming:u,elevationCenter:m}}handleFlyTo(t,i){const n=void 0!==i.zoom,r=t.center,o=t.zoom,s=t.padding,a=!t.isPaddingEqual(i.padding),l=t.getConstrained(e.Q.convert(i.center||i.locationAtOffset),o).center,c=n?+i.zoom:t.zoom+si(t.center.lat,l.lat),u=t.clone();u.setCenter(l),u.setZoom(c),u.setBearing(i.bearing);const h=new e.P(e.ae(t.centerPoint.x+i.offsetAsPoint.x,0,t.width),e.ae(t.centerPoint.y+i.offsetAsPoint.y,0,t.height));u.setLocationAtPoint(l,h);const p=u.center;Me(t,p);const d=function(t,i,n){const r=ii(i),o=ii(n),s=e.aV(r,o),a=Math.acos(s),l=ti(t);return a/(2*Math.PI)*l}(t,r,p),f=o+si(r.lat,0),m=c+si(p.lat,0),g=e.ac(m-f);let y;if("number"==typeof i.minZoom){const n=+i.minZoom+si(p.lat,0),r=Math.min(n,f,m)+si(0,p.lat),o=t.getConstrained(p,r).zoom+si(p.lat,0);y=e.ac(o-f)}const _=e.bq(r.lng,p.lng),v=e.bq(r.lat,p.lat);return{easeFunc:(n,o,l,u)=>{const h=ci(r,_,v,l);a&&t.interpolatePadding(s,i.padding,n);const d=1===n?p:h;t.setCenter(d.wrap());const m=f+e.ah(o);t.setZoom(1===n?c:m+si(0,d.lat))},scaleOfZoom:g,targetCenter:p,scaleOfMinZoom:y,pixelPathLength:d}}static solveVectorScale(t,e,i,n,r){const o="x"===n?[i[0],i[4],i[8],i[12]]:[i[1],i[5],i[9],i[13]],s=[i[3],i[7],i[11],i[15]],a=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],l=t[0]*s[0]+t[1]*s[1]+t[2]*s[2],c=e[0]*o[0]+e[1]*o[1]+e[2]*o[2],u=e[0]*s[0]+e[1]*s[1]+e[2]*s[2];return c+r*l===a+r*u||s[3]*(a-c)+o[3]*(u-l)+a*u==c*l?null:(c+o[3]-r*u-r*s[3])/(c-a-r*u+r*l)}static getLesserNonNegativeNonNull(t,e){return null!==e&&e>=0&&e<t?e:t}}class yi{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ne,this._verticalPerspectiveCameraHelper=new gi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,e){return this.currentHelper.handlePanInertia(t,e)}handleMapControlsRollPitchBearingZoom(t,e){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,e)}handleMapControlsPan(t,e,i){this.currentHelper.handleMapControlsPan(t,e,i)}cameraForBoxAndBearing(t,e,i,n,r){return this.currentHelper.cameraForBoxAndBearing(t,e,i,n,r)}handleJumpToCenterZoom(t,e){this.currentHelper.handleJumpToCenterZoom(t,e)}handleEaseTo(t,e){return this.currentHelper.handleEaseTo(t,e)}handleFlyTo(t,e){return this.currentHelper.handleFlyTo(t,e)}}const _i=(t,i)=>e.x(t,i&&i.filter((t=>"source.canvas"!==t.identifier))),vi=e.bw();class xi extends e.E{constructor(t,i={}){super(),this._rtlPluginLoaded=()=>{for(const t in this.sourceCaches){const e=this.sourceCaches[t].getSource().type;"vector"!==e&&"geojson"!==e||this.sourceCaches[t].reload()}},this.map=t,this.dispatcher=new F(O(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((t,e)=>this.getGlyphs(t,e))),this.dispatcher.registerMessageHandler("GI",((t,e)=>this.getImages(t,e))),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new S(t._requestManager,i.localIdeographFontFamily),this.lineAtlas=new k(256,512),this.crossTileSymbolIndex=new _e,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",e.by()),rt().on(et,this._rtlPluginLoaded),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.sourceCaches[t.sourceId];if(!e)return;const i=e.getSource();if(i&&i.vectorLayerIds)for(const t in this._layers){const e=this._layers[t];e.source===i.id&&this._validateLayer(e)}}))}loadURL(t,i={},n){this.fire(new e.l("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const r=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;e.j(r,this._loadStyleRequest).then((t=>{this._loadStyleRequest=null,this._load(t.data,i,n)})).catch((t=>{this._loadStyleRequest=null,t&&!o.signal.aborted&&this.fire(new e.k(t))}))}loadJSON(t,i={},n){this.fire(new e.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,s.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=!1!==i.validate,this._load(t,i,n)})).catch((()=>{}))}loadEmpty(){this.fire(new e.l("dataloading",{dataType:"style"})),this._load(vi,{validate:!1})}_load(t,i,n){var r,o;const s=i.transformStyle?i.transformStyle(n,t):t;if(!i.validate||!_i(this,e.y(s))){this._loaded=!0,this.stylesheet=s;for(const t in s.sources)this.addSource(t,s.sources[t],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new I(this.stylesheet.light),this._setProjectionInternal((null===(r=this.stylesheet.projection)||void 0===r?void 0:r.type)||"mercator"),this.sky=new A(this.stylesheet.sky),this.map.setTerrain(null!==(o=this.stylesheet.terrain)&&void 0!==o?o:null),this.fire(new e.l("data",{dataType:"style"})),this.fire(new e.l("style.load"))}}_createLayers(){const t=e.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map((t=>t.id)),this._layers={},this._serializedLayers=null;for(const i of t){const t=e.bA(i);t.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=t}}_loadSprite(t,i=!1,n){let r;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(t,i,n,r){return e._(this,void 0,void 0,(function*(){const o=g(t),a=n>1?"@2x":"",l={},c={};for(const{id:t,url:n}of o){const o=i.transformRequest(y(n,a,".json"),"SpriteJSON");l[t]=e.j(o,r);const s=i.transformRequest(y(n,a,".png"),"SpriteImage");c[t]=f.getImage(s,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(t,i){return e._(this,void 0,void 0,(function*(){const e={};for(const n in t){e[n]={};const r=s.getImageCanvasContext((yield i[n]).data),o=(yield t[n]).data;for(const t in o){const{width:i,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:p,content:d,textFitWidth:f,textFitHeight:m}=o[t];e[n][t]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:p,content:d,textFitWidth:f,textFitHeight:m,spriteData:{width:i,height:s,x:a,y:l,context:r}}}}return e}))}(l,c)}))}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((t=>{if(this._spriteRequest=null,t)for(const e in t){this._spritesImagesIds[e]=[];const n=this._spritesImagesIds[e]?this._spritesImagesIds[e].filter((e=>!(e in t))):[];for(const t of n)this.imageManager.removeImage(t),this._changedImages[t]=!0;for(const n in t[e]){const r="default"===e?n:`${e}:${n}`;this._spritesImagesIds[e].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,t[e][n],!1):this.imageManager.addImage(r,t[e][n]),i&&(this._changedImages[r]=!0)}}})).catch((t=>{this._spriteRequest=null,r=t,this.fire(new e.k(r))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"})),n&&n(r)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}_validateLayer(t){const i=this.sourceCaches[t.source];if(!i)return;const n=t.sourceLayer;if(!n)return;const r=i.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new e.k(new Error(`Source layer "${n}" does not exist on source "${r.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,i=!1){const n=this._serializedAllLayers();if(!t||0===t.length)return Object.values(i?e.bB(n):n);const r=[];for(const o of t)if(n[o]){const t=i?e.bB(n[o]):n[o];r.push(t)}return r}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const e=Object.keys(this._layers);for(const i of e){const e=this._layers[i];"custom"!==e.type&&(t[i]=e.serialize())}return t}hasTransitions(){var t,e,i;if(null===(t=this.light)||void 0===t?void 0:t.hasTransition())return!0;if(null===(e=this.sky)||void 0===e?void 0:e.hasTransition())return!0;if(null===(i=this.projection)||void 0===i?void 0:i.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const i=this._changed;if(i){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const t in this._updatedSources){const e=this._updatedSources[t];if("reload"===e)this._reloadSource(t);else{if("clear"!==e)throw new Error(`Invalid action ${e}`);this._clearSource(t)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const n={};for(const t in this.sourceCaches){const e=this.sourceCaches[t];n[t]=e.used,e.used=!1}for(const e of this._order){const i=this._layers[e];i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const t in n){const i=this.sourceCaches[t];!!n[t]!=!!i.used&&i.fire(new e.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:t}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,i&&this.fire(new e.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,i={}){var n;this._checkLoaded();const r=this.serialize();if(t=i.transformStyle?i.transformStyle(r,t):t,(null===(n=i.validate)||void 0===n||n)&&_i(this,e.y(t)))return!1;(t=e.bB(t)).layers=e.bz(t.layers);const o=e.bC(r,t),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const t of s.operations)t();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const e=[],i=[];for(const n of t)switch(n.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":e.push((()=>this.addLayer.apply(this,n.args)));break;case"removeLayer":e.push((()=>this.removeLayer.apply(this,n.args)));break;case"setPaintProperty":e.push((()=>this.setPaintProperty.apply(this,n.args)));break;case"setLayoutProperty":e.push((()=>this.setLayoutProperty.apply(this,n.args)));break;case"setFilter":e.push((()=>this.setFilter.apply(this,n.args)));break;case"addSource":e.push((()=>this.addSource.apply(this,n.args)));break;case"removeSource":e.push((()=>this.removeSource.apply(this,n.args)));break;case"setLayerZoomRange":e.push((()=>this.setLayerZoomRange.apply(this,n.args)));break;case"setLight":e.push((()=>this.setLight.apply(this,n.args)));break;case"setGeoJSONSourceData":e.push((()=>this.setGeoJSONSourceData.apply(this,n.args)));break;case"setGlyphs":e.push((()=>this.setGlyphs.apply(this,n.args)));break;case"setSprite":e.push((()=>this.setSprite.apply(this,n.args)));break;case"setTerrain":e.push((()=>this.map.setTerrain.apply(this,n.args)));break;case"setSky":e.push((()=>this.setSky.apply(this,n.args)));break;case"setProjection":this.setProjection.apply(this,n.args);break;case"setTransition":e.push((()=>{}));break;default:i.push(n.command)}return{operations:e,unimplemented:i}}addImage(t,i){if(this.getImage(t))return this.fire(new e.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,i),this._afterImageUpdated(t)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new e.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error(`Source "${t}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.y.source,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=this.sourceCaches[t]=new xt(t,i,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:t}))),r.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.k(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],i.fire(new e.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,e){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error(`There is no source with this ID=${t}`);const i=this.sourceCaches[t].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(e),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.k(new Error(`Layer "${r}" already exists on this map.`)));let o;if("custom"===t.type){if(_i(this,e.bD(t)))return;o=e.bA(t)}else{if("source"in t&&"object"==typeof t.source&&(this.addSource(r,t.source),t=e.bB(t),t=e.e(t,{source:r})),this._validate(e.y.layer,`layers.${r}`,t,{arrayIndex:-1},n))return;o=e.bA(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new e.k(new Error(`Cannot add layer "${r}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o,this._removedLayers[r]&&o.source&&"custom"!==o.type){const t=this._removedLayers[r];delete this._removedLayers[r],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.k(new Error(`Cannot move layer "${t}" before non-existing layer "${i}".`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.k(new Error(`Cannot remove non-existing layer "${t}".`)));i.setEventedParent(null);const n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,i,n){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new e.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,i,n={}){this._checkLoaded();const r=this.getLayer(t);if(r){if(!e.bE(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(e.y.filter,`layers.${r.id}.filter`,i,null,n)||(r.filter=e.bB(i),this._updateLayer(r)))}else this.fire(new e.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return e.bB(this.getLayer(t).filter)}setLayoutProperty(t,i,n,r={}){this._checkLoaded();const o=this.getLayer(t);o?e.bE(o.getLayoutProperty(i),n)||(o.setLayoutProperty(i,n,r),this._updateLayer(o)):this.fire(new e.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,i){const n=this.getLayer(t);if(n)return n.getLayoutProperty(i);this.fire(new e.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,i,n,r={}){this._checkLoaded();const o=this.getLayer(t);o?e.bE(o.getPaintProperty(i),n)||(o.setPaintProperty(i,n,r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new e.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,e){return this.getLayer(t).getPaintProperty(e)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,o=this.sourceCaches[n];if(void 0===o)return void this.fire(new e.k(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&r?this.fire(new e.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),o.setFeatureState(r,t.id,i)):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this.sourceCaches[n];if(void 0===r)return void this.fire(new e.k(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.getSource().type,s="vector"===o?t.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof t.id&&"number"!=typeof t.id?this.fire(new e.k(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(s,t.id,i):this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this.sourceCaches[i];if(void 0!==r)return"vector"!==r.getSource().type||n?(void 0===t.id&&this.fire(new e.k(new Error("The feature id parameter must be provided."))),r.getFeatureState(n,t.id)):void this.fire(new e.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new e.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=e.bF(this.sourceCaches,(t=>t.serialize())),i=this._serializeByIds(this._order,!0),n=this.map.getTerrain()||void 0,r=this.stylesheet;return e.bG({version:r.version,name:r.name,metadata:r.metadata,light:r.light,sky:r.sky,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,projection:r.projection,sources:t,layers:i,terrain:n},(t=>void 0!==t))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(e(o)){i[o]=r;for(const e of t){const t=e[o];if(t)for(const e of t)n.push(e)}}}n.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=n.length-1;t>=0;t--){const e=n[t].feature;if(i[e.layer.id]<o)break;r.push(e),n.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(e.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new e.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers(),a=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,l=Object.assign(Object.assign({},i),{layers:a});for(const e in this.sourceCaches)i.layers&&!r[e]||o.push(j(this.sourceCaches[e],this._layers,s,t,l,n,this.map.terrain?(t,e,i)=>this.map.terrain.getElevation(t,e,i):void 0));return this.placement&&o.push(function(t,e,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const t of Object.keys(l).map(Number))c.push(s[t]);c.sort($);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],r=n[t];r.sort(((t,e)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of r)e.push(t)}}return function(t,e,i){for(const n in t)for(const r of t[n])U(r,i[e[n].source]);return t}(a,t,i)}(this._layers,s,this.sourceCaches,t,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.y.filter,"querySourceFeatures.filter",i.filter,null,i);const n=this.sourceCaches[t];return n?function(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],r={};for(let t=0;t<i.length;t++){const o=i[t],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,e))}return n}(n,i):[]}getLight(){return this.light.getLight()}setLight(t,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in t)if(!e.bE(t[i],n[i])){r=!0;break}if(!r)return;const o={now:s.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,i),this.light.updateTransitions(o)}getProjection(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return null===(t=this.stylesheet)||void 0===t?void 0:t.sky}setSky(t,i={}){this._checkLoaded();const n=this.getSky();let r=!1;if(!t&&!n)return;if(t&&!n)r=!0;else if(!t&&n)r=!0;else for(const i in t)if(!e.bE(t[i],n[i])){r=!0;break}if(!r)return;const o={now:s.now(),transition:e.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,i),this.sky.updateTransitions(o)}_setProjectionInternal(t){const i=function(t){if(Array.isArray(t)){const e=new Qe({type:t});return{projection:e,transform:new mi,cameraHelper:new yi(e)}}switch(t){case"mercator":return{projection:new Ee,transform:new De,cameraHelper:new Ne};case"globe":{const t=new Qe({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:t,transform:new mi,cameraHelper:new yi(t)}}case"vertical-perspective":return{projection:new Ke,transform:new fi,cameraHelper:new gi};default:return e.w(`Unknown projection name: ${t}. Falling back to mercator projection.`),{projection:new Ee,transform:new De,cameraHelper:new Ne}}}(t);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const t in this.sourceCaches)this.sourceCaches[t].reload()}_validate(t,i,n,r,o={}){return(!o||!1!==o.validate)&&_i(this,t.call(e.y,e.e({key:i,style:this.serialize(),value:n,styleSpec:e.v},r)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rt().off(et,this._rtlPluginLoaded);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const e=this.sourceCaches[t];e.setEventedParent(null),e.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const e in this.sourceCaches)this.sourceCaches[e].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,e,i,n,r=!1){let o=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const t=this.sourceCaches[i.source];l[i.source]=t.getRenderableIds(!0).map((e=>t.getTileByID(e))).sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng);o=o||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.now(),t.zoom))&&(this.pauseablePlacement=new de(t,this.map.terrain,this._order,r,e,i,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,l[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,i.icons),t}))}getGlyphs(t,i){return e._(this,void 0,void 0,(function*(){const t=yield this.glyphManager.getGlyphs(i.stacks),e=this.sourceCaches[i.source];return e&&e.setDependencies(i.tileID.key,i.type,[""]),t}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,i={}){this._checkLoaded(),t&&this._validate(e.y.glyphs,"glyphs",t,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,i,n={},r){this._checkLoaded();const o=[{id:t,url:i}],s=[...g(this.stylesheet.sprite),...o];this._validate(e.y.sprite,"sprite",s,null,n)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,r))}removeSprite(t){this._checkLoaded();const i=g(this.stylesheet.sprite);if(i.find((e=>e.id===t))){if(this._spritesImagesIds[t])for(const e of this._spritesImagesIds[t])this.imageManager.removeImage(e),this._changedImages[e]=!0;i.splice(i.findIndex((e=>e.id===t)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new e.l("data",{dataType:"style"}))}else this.fire(new e.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return g(this.stylesheet.sprite)}setSprite(t,i={},n){this._checkLoaded(),t&&this._validate(e.y.sprite,"sprite",t,null,i)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,n):(this._unloadSprite(),n&&n(null)))}}var bi=e.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,i,n,r,o,s,a,l){this.context=t;let c=this.boundPaintVertexBuffers.length!==n.length;for(let t=0;!c&&t<n.length;t++)this.boundPaintVertexBuffers[t]!==n[t]&&(c=!0);!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(e,i,n,r,o,s,a,l):(t.bindVertexArray.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind())}freshBind(t,e,i,n,r,o,s,a){const l=t.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,e.enableAttributes(u,t);for(const e of i)e.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),a&&a.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,r);for(const e of i)e.bind(),e.setVertexAttribPointers(u,t,r);o&&(o.bind(),o.setVertexAttribPointers(u,t,r)),n&&n.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,r)),a&&(a.bind(),a.setVertexAttribPointers(u,t,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ti=(t,i,n,r,o)=>({u_texture:0,u_ele_delta:t,u_fog_matrix:i,u_fog_color:n?n.properties.get("fog-color"):e.b7.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:n?n.calculateFogBlendOpacity(r):0,u_horizon_color:n?n.properties.get("horizon-color"):e.b7.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),Si={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ci(t){const e=[];for(let i=0;i<t.length;i++){if(null===t[i])continue;const n=t[i].split(" ");e.push(n.pop())}return e}class Ei{constructor(t,i,n,r,o,s,a,l,c=[]){const u=t.gl;this.program=u.createProgram();const h=Ci(i.staticAttributes),p=n?n.getBinderAttributes():[],d=h.concat(p),f=xe.prelude.staticUniforms?Ci(xe.prelude.staticUniforms):[],m=a.staticUniforms?Ci(a.staticUniforms):[],g=i.staticUniforms?Ci(i.staticUniforms):[],y=n?n.getBinderUniforms():[],_=f.concat(m).concat(g).concat(y),v=[];for(const t of _)v.indexOf(t)<0&&v.push(t);const x=n?n.defines():[];Ze(u)&&x.unshift("#version 300 es"),o&&x.push("#define OVERDRAW_INSPECTOR;"),s&&x.push("#define TERRAIN3D;"),l&&x.push(l),c&&x.push(...c);let b=x.concat(xe.prelude.fragmentSource,a.fragmentSource,i.fragmentSource).join("\n"),w=x.concat(xe.prelude.vertexSource,a.vertexSource,i.vertexSource).join("\n");Ze(u)||(b=function(t){return t.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(b),w=function(t){return t.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const T=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(T,b),u.compileShader(T),!u.getShaderParameter(T,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(T)}`);u.attachShader(this.program,T);const S=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,w),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(S)}`);u.attachShader(this.program,S),this.attributes={};const C={};this.numAttributes=d.length;for(let t=0;t<this.numAttributes;t++)d[t]&&(u.bindAttribLocation(this.program,t,d[t]),this.attributes[d[t]]=t);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(S),u.deleteShader(T);for(let t=0;t<v.length;t++){const e=v[t];if(e&&!C[e]){const t=u.getUniformLocation(this.program,e);t&&(C[e]=t)}}this.fixedUniforms=r(t,C),this.terrainUniforms=((t,i)=>({u_depth:new e.bH(t,i.u_depth),u_terrain:new e.bH(t,i.u_terrain),u_terrain_dim:new e.b8(t,i.u_terrain_dim),u_terrain_matrix:new e.bJ(t,i.u_terrain_matrix),u_terrain_unpack:new e.bK(t,i.u_terrain_unpack),u_terrain_exaggeration:new e.b8(t,i.u_terrain_exaggeration)}))(t,C),this.projectionUniforms=((t,i)=>({u_projection_matrix:new e.bJ(t,i.u_projection_matrix),u_projection_tile_mercator_coords:new e.bK(t,i.u_projection_tile_mercator_coords),u_projection_clipping_plane:new e.bK(t,i.u_projection_clipping_plane),u_projection_transition:new e.b8(t,i.u_projection_transition),u_projection_fallback_matrix:new e.bJ(t,i.u_projection_fallback_matrix)}))(t,C),this.binderUniforms=n?n.getUniforms(t,C):[]}draw(t,e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_){const v=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(i),t.setStencilMode(n),t.setColorMode(r),t.setCullFace(o),a){t.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,a.depthTexture),t.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,a.texture);for(const t in this.terrainUniforms)this.terrainUniforms[t].set(a[t])}if(l)for(const t in l)this.projectionUniforms[Si[t]].set(l[t]);if(s)for(const t in this.fixedUniforms)this.fixedUniforms[t].set(s[t]);m&&m.setUniforms(t,this.binderUniforms,d,{zoom:f});let x=0;switch(e){case v.LINES:x=2;break;case v.TRIANGLES:x=3;break;case v.LINE_STRIP:x=1}for(const i of p.get()){const n=i.vaos||(i.vaos={});(n[c]||(n[c]=new wi)).bind(t,this,u,m?m.getPaintVertexBuffers():[],h,i.vertexOffset,g,y,_),v.drawElements(e,i.primitiveLength*x,v.UNSIGNED_SHORT,i.primitiveOffset*x*2)}}}function Ii(t,i,n){const r=1/e.az(n,1,i.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),s=n.tileSize*Math.pow(2,i.transform.tileZoom)/o,a=s*(n.tileID.canonical.x+n.tileID.wrap*o),l=s*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const Mi=(t,i,n,r)=>{const o=t.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=e.bN();"viewport"===o.properties.get("anchor")&&e.bO(l,t.transform.bearingInRadians),e.bP(a,a,l);const c=t.transform.transformLightDirection(a),u=o.properties.get("color");return{u_lightpos:a,u_lightpos_globe:c,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+i,u_opacity:n,u_fill_translate:r}},Ai=(t,i,n,r,o,s,a)=>e.e(Mi(t,i,n,r),Ii(s,t,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),ki=(t,i,n,r)=>e.e(Ii(i,t,n),{u_fill_translate:r}),Pi=(t,e)=>({u_world:t,u_fill_translate:e}),Li=(t,i,n,r,o)=>e.e(ki(t,i,n,o),{u_world:r}),zi=(t,i,n,r,o)=>{const s=t.transform;let a,l,c=0;if("map"===n.paint.get("circle-pitch-alignment")){const t=e.az(i,1,s.zoom);a=!0,l=[t,t],c=t/(e.Z*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*o}else a=!1,l=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===n.paint.get("circle-pitch-scale")),u_pitch_with_map:+a,u_device_pixel_ratio:t.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:r}},Di=t=>({u_pixel_extrude_scale:[1/t.width,1/t.height]}),Ri=t=>({u_viewport_size:[t.width,t.height]}),Oi=(t,e=1)=>({u_color:t,u_overlay:0,u_overlay_scale:e}),Fi=(t,i,n,r)=>{const o=e.az(t,1,i)/(e.Z*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*r;return{u_extrude_scale:e.az(t,1,i),u_intensity:n,u_globe_extrude_scale:o}},Ni=(t,i,n,r)=>{const o=e.K();e.bQ(o,0,t.width,t.height,0,0,1);const s=t.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:n,u_color_ramp:r,u_opacity:i.paint.get("heatmap-opacity")}},Bi=(t,e,i)=>{const n=i.paint.get("hillshade-accent-color");let r;switch(i.paint.get("hillshade-method")){case"basic":r=4;break;case"combined":r=1;break;case"igor":r=2;break;case"multidirectional":r=3;break;default:r=0}const o=i.getIlluminationProperties();for(let e=0;e<o.directionRadians.length;e++)"viewport"===i.paint.get("hillshade-illumination-anchor")&&(o.directionRadians[e]+=t.transform.bearingInRadians);return{u_image:0,u_latrange:$i(0,e.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:o.altitudeRadians,u_azimuths:o.directionRadians,u_accent:n,u_method:r,u_highlights:o.highlightColor,u_shadows:o.shadowColor}},ji=(t,i)=>{const n=i.stride,r=e.K();return e.bQ(r,0,e.Z,-8192,0,0,1),e.L(r,r,[0,-8192,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_unpack:i.getUnpackVector()}};function $i(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.$(0,r/n).toLngLat().lat,new e.$(0,(r+1)/n).toLngLat().lat]}const Ui=(t,i,n,r)=>{const o=t.transform;return{u_translation:Wi(t,i,n),u_ratio:r/e.az(i,1,o.zoom),u_device_pixel_ratio:t.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Vi=(t,i,n,r,o)=>e.e(Ui(t,i,n,r),{u_image:0,u_image_height:o}),Gi=(t,i,n,r,o)=>{const s=t.transform,a=Zi(i,s);return{u_translation:Wi(t,i,n),u_texsize:i.imageAtlasTexture.size,u_ratio:r/e.az(i,1,s.zoom),u_device_pixel_ratio:t.pixelRatio,u_image:0,u_scale:[a,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},qi=(t,i,n,r,o,s)=>{const a=t.lineAtlas,l=Zi(i,t.transform),c="round"===n.layout.get("line-cap"),u=a.getDash(o.from,c),h=a.getDash(o.to,c),p=u.width*s.fromScale,d=h.width*s.toScale;return e.e(Ui(t,i,n,r),{u_patternscale_a:[l/p,-u.height/2],u_patternscale_b:[l/d,-h.height/2],u_sdfgamma:a.width/(256*Math.min(p,d)*t.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:s.t})};function Zi(t,i){return 1/e.az(t,1,i.tileZoom)}function Wi(t,i,n){return e.aA(t.transform,i,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Hi=(t,e,i,n,r)=>{return{u_tl_parent:t,u_scale_parent:e,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(s=n.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=n.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Xi(n.paint.get("raster-hue-rotate")),u_coords_top:[r[0].x,r[0].y,r[1].x,r[1].y],u_coords_bottom:[r[3].x,r[3].y,r[2].x,r[2].y]};var o,s};function Xi(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const Yi=(t,e,i,n,r,o,s,a,l,c,u,h,p)=>{const d=s.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:d.cameraToCenterDistance,u_pitch:d.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:d.width/d.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+n,u_is_along_line:r,u_is_variable_anchor:o,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:p}},Ki=(t,i,n,r,o,s,a,l,c,u,h,p,d,f)=>{const m=a.transform;return e.e(Yi(t,i,n,r,o,s,a,l,c,u,h,p,f),{u_gamma_scale:r?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:1})},Ji=(t,i,n,r,o,s,a,l,c,u,h,p,d)=>e.e(Ki(t,i,n,r,o,s,a,l,c,u,!0,h,0,d),{u_texsize_icon:p,u_texture_icon:1}),Qi=(t,e)=>({u_opacity:t,u_color:e}),tn=(t,i,n,r,o)=>e.e(function(t,i,n,r){const o=n.imageManager.getPattern(t.from.toString()),s=n.imageManager.getPattern(t.to.toString()),{width:a,height:l}=n.imageManager.getPixelSize(),c=Math.pow(2,r.tileID.overscaledZ),u=r.tileSize*Math.pow(2,n.transform.tileZoom)/c,h=u*(r.tileID.canonical.x+r.tileID.wrap*c),p=u*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:o.tl,u_pattern_br_a:o.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[a,l],u_mix:i.t,u_pattern_size_a:o.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:i.fromScale,u_scale_b:i.toScale,u_tile_units_to_pixels:1/e.az(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(n,o,i,r),{u_opacity:t}),en=(t,e)=>{},nn={fillExtrusion:(t,i)=>({u_lightpos:new e.bL(t,i.u_lightpos),u_lightpos_globe:new e.bL(t,i.u_lightpos_globe),u_lightintensity:new e.b8(t,i.u_lightintensity),u_lightcolor:new e.bL(t,i.u_lightcolor),u_vertical_gradient:new e.b8(t,i.u_vertical_gradient),u_opacity:new e.b8(t,i.u_opacity),u_fill_translate:new e.bM(t,i.u_fill_translate)}),fillExtrusionPattern:(t,i)=>({u_lightpos:new e.bL(t,i.u_lightpos),u_lightpos_globe:new e.bL(t,i.u_lightpos_globe),u_lightintensity:new e.b8(t,i.u_lightintensity),u_lightcolor:new e.bL(t,i.u_lightcolor),u_vertical_gradient:new e.b8(t,i.u_vertical_gradient),u_height_factor:new e.b8(t,i.u_height_factor),u_opacity:new e.b8(t,i.u_opacity),u_fill_translate:new e.bM(t,i.u_fill_translate),u_image:new e.bH(t,i.u_image),u_texsize:new e.bM(t,i.u_texsize),u_pixel_coord_upper:new e.bM(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.bM(t,i.u_pixel_coord_lower),u_scale:new e.bL(t,i.u_scale),u_fade:new e.b8(t,i.u_fade)}),fill:(t,i)=>({u_fill_translate:new e.bM(t,i.u_fill_translate)}),fillPattern:(t,i)=>({u_image:new e.bH(t,i.u_image),u_texsize:new e.bM(t,i.u_texsize),u_pixel_coord_upper:new e.bM(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.bM(t,i.u_pixel_coord_lower),u_scale:new e.bL(t,i.u_scale),u_fade:new e.b8(t,i.u_fade),u_fill_translate:new e.bM(t,i.u_fill_translate)}),fillOutline:(t,i)=>({u_world:new e.bM(t,i.u_world),u_fill_translate:new e.bM(t,i.u_fill_translate)}),fillOutlinePattern:(t,i)=>({u_world:new e.bM(t,i.u_world),u_image:new e.bH(t,i.u_image),u_texsize:new e.bM(t,i.u_texsize),u_pixel_coord_upper:new e.bM(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.bM(t,i.u_pixel_coord_lower),u_scale:new e.bL(t,i.u_scale),u_fade:new e.b8(t,i.u_fade),u_fill_translate:new e.bM(t,i.u_fill_translate)}),circle:(t,i)=>({u_camera_to_center_distance:new e.b8(t,i.u_camera_to_center_distance),u_scale_with_map:new e.bH(t,i.u_scale_with_map),u_pitch_with_map:new e.bH(t,i.u_pitch_with_map),u_extrude_scale:new e.bM(t,i.u_extrude_scale),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_globe_extrude_scale:new e.b8(t,i.u_globe_extrude_scale),u_translate:new e.bM(t,i.u_translate)}),collisionBox:(t,i)=>({u_pixel_extrude_scale:new e.bM(t,i.u_pixel_extrude_scale)}),collisionCircle:(t,i)=>({u_viewport_size:new e.bM(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.bI(t,i.u_color),u_overlay:new e.bH(t,i.u_overlay),u_overlay_scale:new e.b8(t,i.u_overlay_scale)}),depth:en,clippingMask:en,heatmap:(t,i)=>({u_extrude_scale:new e.b8(t,i.u_extrude_scale),u_intensity:new e.b8(t,i.u_intensity),u_globe_extrude_scale:new e.b8(t,i.u_globe_extrude_scale)}),heatmapTexture:(t,i)=>({u_matrix:new e.bJ(t,i.u_matrix),u_world:new e.bM(t,i.u_world),u_image:new e.bH(t,i.u_image),u_color_ramp:new e.bH(t,i.u_color_ramp),u_opacity:new e.b8(t,i.u_opacity)}),hillshade:(t,i)=>({u_image:new e.bH(t,i.u_image),u_latrange:new e.bM(t,i.u_latrange),u_exaggeration:new e.b8(t,i.u_exaggeration),u_altitudes:new e.bS(t,i.u_altitudes),u_azimuths:new e.bS(t,i.u_azimuths),u_accent:new e.bI(t,i.u_accent),u_method:new e.bH(t,i.u_method),u_shadows:new e.bR(t,i.u_shadows),u_highlights:new e.bR(t,i.u_highlights)}),hillshadePrepare:(t,i)=>({u_matrix:new e.bJ(t,i.u_matrix),u_image:new e.bH(t,i.u_image),u_dimension:new e.bM(t,i.u_dimension),u_zoom:new e.b8(t,i.u_zoom),u_unpack:new e.bK(t,i.u_unpack)}),line:(t,i)=>({u_translation:new e.bM(t,i.u_translation),u_ratio:new e.b8(t,i.u_ratio),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.bM(t,i.u_units_to_pixels)}),lineGradient:(t,i)=>({u_translation:new e.bM(t,i.u_translation),u_ratio:new e.b8(t,i.u_ratio),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.bM(t,i.u_units_to_pixels),u_image:new e.bH(t,i.u_image),u_image_height:new e.b8(t,i.u_image_height)}),linePattern:(t,i)=>({u_translation:new e.bM(t,i.u_translation),u_texsize:new e.bM(t,i.u_texsize),u_ratio:new e.b8(t,i.u_ratio),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_image:new e.bH(t,i.u_image),u_units_to_pixels:new e.bM(t,i.u_units_to_pixels),u_scale:new e.bL(t,i.u_scale),u_fade:new e.b8(t,i.u_fade)}),lineSDF:(t,i)=>({u_translation:new e.bM(t,i.u_translation),u_ratio:new e.b8(t,i.u_ratio),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.bM(t,i.u_units_to_pixels),u_patternscale_a:new e.bM(t,i.u_patternscale_a),u_patternscale_b:new e.bM(t,i.u_patternscale_b),u_sdfgamma:new e.b8(t,i.u_sdfgamma),u_image:new e.bH(t,i.u_image),u_tex_y_a:new e.b8(t,i.u_tex_y_a),u_tex_y_b:new e.b8(t,i.u_tex_y_b),u_mix:new e.b8(t,i.u_mix)}),raster:(t,i)=>({u_tl_parent:new e.bM(t,i.u_tl_parent),u_scale_parent:new e.b8(t,i.u_scale_parent),u_buffer_scale:new e.b8(t,i.u_buffer_scale),u_fade_t:new e.b8(t,i.u_fade_t),u_opacity:new e.b8(t,i.u_opacity),u_image0:new e.bH(t,i.u_image0),u_image1:new e.bH(t,i.u_image1),u_brightness_low:new e.b8(t,i.u_brightness_low),u_brightness_high:new e.b8(t,i.u_brightness_high),u_saturation_factor:new e.b8(t,i.u_saturation_factor),u_contrast_factor:new e.b8(t,i.u_contrast_factor),u_spin_weights:new e.bL(t,i.u_spin_weights),u_coords_top:new e.bK(t,i.u_coords_top),u_coords_bottom:new e.bK(t,i.u_coords_bottom)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.bH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bH(t,i.u_is_size_feature_constant),u_size_t:new e.b8(t,i.u_size_t),u_size:new e.b8(t,i.u_size),u_camera_to_center_distance:new e.b8(t,i.u_camera_to_center_distance),u_pitch:new e.b8(t,i.u_pitch),u_rotate_symbol:new e.bH(t,i.u_rotate_symbol),u_aspect_ratio:new e.b8(t,i.u_aspect_ratio),u_fade_change:new e.b8(t,i.u_fade_change),u_label_plane_matrix:new e.bJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.bJ(t,i.u_coord_matrix),u_is_text:new e.bH(t,i.u_is_text),u_pitch_with_map:new e.bH(t,i.u_pitch_with_map),u_is_along_line:new e.bH(t,i.u_is_along_line),u_is_variable_anchor:new e.bH(t,i.u_is_variable_anchor),u_texsize:new e.bM(t,i.u_texsize),u_texture:new e.bH(t,i.u_texture),u_translation:new e.bM(t,i.u_translation),u_pitched_scale:new e.b8(t,i.u_pitched_scale)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.bH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bH(t,i.u_is_size_feature_constant),u_size_t:new e.b8(t,i.u_size_t),u_size:new e.b8(t,i.u_size),u_camera_to_center_distance:new e.b8(t,i.u_camera_to_center_distance),u_pitch:new e.b8(t,i.u_pitch),u_rotate_symbol:new e.bH(t,i.u_rotate_symbol),u_aspect_ratio:new e.b8(t,i.u_aspect_ratio),u_fade_change:new e.b8(t,i.u_fade_change),u_label_plane_matrix:new e.bJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.bJ(t,i.u_coord_matrix),u_is_text:new e.bH(t,i.u_is_text),u_pitch_with_map:new e.bH(t,i.u_pitch_with_map),u_is_along_line:new e.bH(t,i.u_is_along_line),u_is_variable_anchor:new e.bH(t,i.u_is_variable_anchor),u_texsize:new e.bM(t,i.u_texsize),u_texture:new e.bH(t,i.u_texture),u_gamma_scale:new e.b8(t,i.u_gamma_scale),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_is_halo:new e.bH(t,i.u_is_halo),u_translation:new e.bM(t,i.u_translation),u_pitched_scale:new e.b8(t,i.u_pitched_scale)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.bH(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.bH(t,i.u_is_size_feature_constant),u_size_t:new e.b8(t,i.u_size_t),u_size:new e.b8(t,i.u_size),u_camera_to_center_distance:new e.b8(t,i.u_camera_to_center_distance),u_pitch:new e.b8(t,i.u_pitch),u_rotate_symbol:new e.bH(t,i.u_rotate_symbol),u_aspect_ratio:new e.b8(t,i.u_aspect_ratio),u_fade_change:new e.b8(t,i.u_fade_change),u_label_plane_matrix:new e.bJ(t,i.u_label_plane_matrix),u_coord_matrix:new e.bJ(t,i.u_coord_matrix),u_is_text:new e.bH(t,i.u_is_text),u_pitch_with_map:new e.bH(t,i.u_pitch_with_map),u_is_along_line:new e.bH(t,i.u_is_along_line),u_is_variable_anchor:new e.bH(t,i.u_is_variable_anchor),u_texsize:new e.bM(t,i.u_texsize),u_texsize_icon:new e.bM(t,i.u_texsize_icon),u_texture:new e.bH(t,i.u_texture),u_texture_icon:new e.bH(t,i.u_texture_icon),u_gamma_scale:new e.b8(t,i.u_gamma_scale),u_device_pixel_ratio:new e.b8(t,i.u_device_pixel_ratio),u_is_halo:new e.bH(t,i.u_is_halo),u_translation:new e.bM(t,i.u_translation),u_pitched_scale:new e.b8(t,i.u_pitched_scale)}),background:(t,i)=>({u_opacity:new e.b8(t,i.u_opacity),u_color:new e.bI(t,i.u_color)}),backgroundPattern:(t,i)=>({u_opacity:new e.b8(t,i.u_opacity),u_image:new e.bH(t,i.u_image),u_pattern_tl_a:new e.bM(t,i.u_pattern_tl_a),u_pattern_br_a:new e.bM(t,i.u_pattern_br_a),u_pattern_tl_b:new e.bM(t,i.u_pattern_tl_b),u_pattern_br_b:new e.bM(t,i.u_pattern_br_b),u_texsize:new e.bM(t,i.u_texsize),u_mix:new e.b8(t,i.u_mix),u_pattern_size_a:new e.bM(t,i.u_pattern_size_a),u_pattern_size_b:new e.bM(t,i.u_pattern_size_b),u_scale_a:new e.b8(t,i.u_scale_a),u_scale_b:new e.b8(t,i.u_scale_b),u_pixel_coord_upper:new e.bM(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.bM(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.b8(t,i.u_tile_units_to_pixels)}),terrain:(t,i)=>({u_texture:new e.bH(t,i.u_texture),u_ele_delta:new e.b8(t,i.u_ele_delta),u_fog_matrix:new e.bJ(t,i.u_fog_matrix),u_fog_color:new e.bI(t,i.u_fog_color),u_fog_ground_blend:new e.b8(t,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new e.b8(t,i.u_fog_ground_blend_opacity),u_horizon_color:new e.bI(t,i.u_horizon_color),u_horizon_fog_blend:new e.b8(t,i.u_horizon_fog_blend),u_is_globe_mode:new e.b8(t,i.u_is_globe_mode)}),terrainDepth:(t,i)=>({u_ele_delta:new e.b8(t,i.u_ele_delta)}),terrainCoords:(t,i)=>({u_texture:new e.bH(t,i.u_texture),u_terrain_coords_id:new e.b8(t,i.u_terrain_coords_id),u_ele_delta:new e.b8(t,i.u_ele_delta)}),projectionErrorMeasurement:(t,i)=>({u_input:new e.b8(t,i.u_input),u_output_expected:new e.b8(t,i.u_output_expected)}),atmosphere:(t,i)=>({u_sun_pos:new e.bL(t,i.u_sun_pos),u_atmosphere_blend:new e.b8(t,i.u_atmosphere_blend),u_globe_position:new e.bL(t,i.u_globe_position),u_globe_radius:new e.b8(t,i.u_globe_radius),u_inv_proj_matrix:new e.bJ(t,i.u_inv_proj_matrix)}),sky:(t,i)=>({u_sky_color:new e.bI(t,i.u_sky_color),u_horizon_color:new e.bI(t,i.u_horizon_color),u_horizon:new e.bM(t,i.u_horizon),u_horizon_normal:new e.bM(t,i.u_horizon_normal),u_sky_horizon_blend:new e.b8(t,i.u_sky_horizon_blend),u_sky_blend:new e.b8(t,i.u_sky_blend)})};class rn{constructor(t,e,i){this.context=t;const n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const on={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sn{constructor(t,e,i,n){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;const r=t.gl;this.buffer=r.createBuffer(),t.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=e.attributes[r.name];void 0!==o&&t.vertexAttribPointer(o,r.components,t[on[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class an{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ln extends an{getDefault(){return e.b7.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cn extends an{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class un extends an{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hn extends an{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class pn extends an{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dn extends an{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class fn extends an{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class mn extends an{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class gn extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class yn extends an{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class _n extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class vn extends an{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class xn extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class bn extends an{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class wn extends an{getDefault(){return e.b7.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Tn extends an{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Sn extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class Cn extends an{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class En extends an{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class In extends an{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Mn extends an{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class An extends an{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class kn extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Pn extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ln extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class zn extends an{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Dn extends an{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rn extends an{getDefault(){return null}set(t){var e;if(t===this.current&&!this.dirty)return;const i=this.gl;Ze(i)?i.bindVertexArray(t):null===(e=i.getExtension("OES_vertex_array_object"))||void 0===e||e.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class On extends an{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Fn extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Nn extends an{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Bn extends an{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class jn extends Bn{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class $n extends Bn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Un extends Bn{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Vn="Framebuffer is not complete";class Gn{constructor(t,e,i,n,r){this.context=t,this.width=e,this.height=i;const o=t.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new jn(t,s),n)this.depthAttachment=r?new Un(t,s):new $n(t,s);else if(r)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error(Vn)}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class qn{constructor(t){var e,i;if(this.gl=t,this.clearColor=new ln(this),this.clearDepth=new cn(this),this.clearStencil=new un(this),this.colorMask=new hn(this),this.depthMask=new pn(this),this.stencilMask=new dn(this),this.stencilFunc=new fn(this),this.stencilOp=new mn(this),this.stencilTest=new gn(this),this.depthRange=new yn(this),this.depthTest=new _n(this),this.depthFunc=new vn(this),this.blend=new xn(this),this.blendFunc=new bn(this),this.blendColor=new wn(this),this.blendEquation=new Tn(this),this.cullFace=new Sn(this),this.cullFaceSide=new Cn(this),this.frontFace=new En(this),this.program=new In(this),this.activeTexture=new Mn(this),this.viewport=new An(this),this.bindFramebuffer=new kn(this),this.bindRenderbuffer=new Pn(this),this.bindTexture=new Ln(this),this.bindVertexBuffer=new zn(this),this.bindElementBuffer=new Dn(this),this.bindVertexArray=new Rn(this),this.pixelStoreUnpack=new On(this),this.pixelStoreUnpackPremultiplyAlpha=new Fn(this),this.pixelStoreUnpackFlipY=new Nn(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Ze(t)){this.HALF_FLOAT=t.HALF_FLOAT;const n=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(e=t.RGBA16F)&&void 0!==e?e:null==n?void 0:n.RGBA16F_EXT,this.RGB16F=null!==(i=t.RGB16F)&&void 0!==i?i:null==n?void 0:n.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const e=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==e?void 0:e.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new rn(this,t,e)}createVertexBuffer(t,e,i){return new sn(this,t,e,i)}createRenderbuffer(t,e,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),r}createFramebuffer(t,e,i,n){return new Gn(this,t,e,i,n)}clear({color:t,depth:e,stencil:i}){const n=this.gl;let r=0;t&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.bE(t.blendFunction,Be.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Ze(this.gl)?this.gl.createVertexArray():null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var e;return Ze(this.gl)?this.gl.deleteVertexArray(t):null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Zn;function Wn(t,i,n,r,o){const s=t.context,a=t.transform,l=s.gl,c=t.useProgram("collisionBox"),u=[];let h=0,p=0;for(let e=0;e<r.length;e++){const d=r[e],f=i.getTile(d).getBucket(n);if(!f)continue;const m=o?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:p,coord:d}),h+=g.length/4,p=h),m&&c.draw(s,l.LINES,Ue.disabled,Ge.disabled,t.colorModeForRenderPass(),$e.disabled,Di(t.transform),t.style.map.terrain&&t.style.map.terrain.getTerrainData(d),a.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}if(!o||!u.length)return;const d=t.useProgram("collisionCircle"),f=new e.bT;f.resize(4*h),f._trim();let m=0;for(const t of u)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],r=t.circleArray[i+1],o=t.circleArray[i+2],s=t.circleArray[i+3];f.emplace(m++,n,r,o,s,0),f.emplace(m++,n,r,o,s,1),f.emplace(m++,n,r,o,s,2),f.emplace(m++,n,r,o,s,3)}(!Zn||Zn.length<2*h)&&(Zn=function(t){const i=2*t,n=new e.bV;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(h));const g=s.createIndexBuffer(Zn,!0),y=s.createVertexBuffer(f,e.bU.members,!0);for(const i of u){const r=Ri(t.transform);d.draw(s,l.TRIANGLES,Ue.disabled,Ge.disabled,t.colorModeForRenderPass(),$e.disabled,r,t.style.map.terrain&&t.style.map.terrain.getTerrainData(i.coord),null,n.id,y,g,e.aJ.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,t.transform.zoom,null,null,null)}y.destroy(),g.destroy()}const Hn=e.ad(new Float32Array(16));function Xn(t,i,n,r,o,s){const{horizontalAlign:a,verticalAlign:l}=e.aE(t);return new e.P((-(a-.5)*i/o+r[0])*s,(-(l-.5)*n/o+r[1])*s)}function Yn(t,i,n,r,o,s){const a=i.tileAnchorPoint.add(new e.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let t=r.mult(s);n||(t=t.rotate(-o));const e=a.add(t);return At(e.x,e.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(n){const e=Nt(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(t),n=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0);return t.add(r.rotate(n))}return t.add(r)}function Kn(t,i,n,r,o,s,a,l,c,u,h,p){const d=t.text.placedSymbolArray,f=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,g={};f.clear();for(let m=0;m<d.length;m++){const y=d.get(m),_=y.hidden||!y.crossTileID||t.allowVerticalPlacement&&!y.placedOrientation?null:r[y.crossTileID];if(_){const r=new e.P(y.anchorX,y.anchorY),d={getElevation:p,width:o.width,height:o.height,pitchedLabelPlaneMatrix:s,pitchWithMap:n,transform:o,tileAnchorPoint:r,translation:u,unwrappedTileID:h},m=n?jt(r.x,r.y,d):Nt(r.x,r.y,d),v=kt(o.cameraToCenterDistance,m.signedDistanceFromCamera);let x=e.am(t.textSizeData,l,y)*v/e.ay;n&&(x*=t.tilePixelRatio/a);const{width:b,height:w,anchor:T,textOffset:S,textBoxScale:C}=_,E=Xn(T,b,w,S,C,x),I=o.getPitchedTextCorrection(r.x+u[0],r.y+u[1],h),M=Yn(m.point,d,i,E,-o.bearingInRadians,I),A=t.allowVerticalPlacement&&y.placedOrientation===e.al.vertical?Math.PI/2:0;for(let t=0;t<y.numGlyphs;t++)e.as(f,M,A);c&&y.associatedIconIndex>=0&&(g[y.associatedIconIndex]={shiftedAnchor:M,angle:A})}else qt(y.numGlyphs,f)}if(c){m.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t);if(n.hidden)qt(n.numGlyphs,m);else{const i=g[t];if(i)for(let t=0;t<n.numGlyphs;t++)e.as(m,i.shiftedAnchor,i.angle);else qt(n.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(f)}function Jn(t,e,i){return i.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function Qn(t,i,n,r,o,s,a,l,c,u,h,p,d){const f=t.context,m=f.gl,g=t.transform,y="map"===l,_="map"===c,v="viewport"!==l&&"point"!==n.layout.get("symbol-placement"),x=y&&!_&&!v,b=!n.layout.get("symbol-sort-key").isConstant();let w=!1;const T=t.getDepthModeForSublayer(0,Ue.ReadOnly),S=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=[],E=g.getCircleRadiusCorrection();for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const p=h.programConfigurations.get(n.id),f=o||c.sdfIcons,T=o?c.textSizeData:c.iconSizeData,I=_||0!==g.pitch,M=t.useProgram(Jn(f,o,c),p),A=e.ak(T,g.zoom),k=t.style.map.terrain&&t.style.map.terrain.getTerrainData(l);let P,L,z,D,R=[0,0],O=null;if(o)L=r.glyphAtlasTexture,z=m.LINEAR,P=r.glyphAtlasTexture.size,c.iconsInText&&(R=r.imageAtlasTexture.size,O=r.imageAtlasTexture,D=I||t.options.rotating||t.options.zooming||"composite"===T.kind||"camera"===T.kind?m.LINEAR:m.NEAREST);else{const e=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=r.imageAtlasTexture,z=f||t.options.rotating||t.options.zooming||e||I?m.LINEAR:m.NEAREST,P=r.imageAtlasTexture.size}const F=e.az(r,1,t.transform.zoom),N=Et(y,t.transform,F),B=e.K();e.an(B,N);const j=It(_,y,t.transform,F),$=e.aA(g,r,s,a),U=g.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!d,applyTerrainMatrix:!0}),V=S&&c.hasTextData(),G="none"!==n.layout.get("icon-text-fit")&&V&&c.hasIconData();if(v){const e=t.style.map.terrain?(e,i)=>t.style.map.terrain.getElevation(l,e,i):null,i="map"===n.layout.get("text-rotation-alignment");Lt(c,t,o,N,B,_,u,i,l.toUnwrapped(),g.width,g.height,$,e)}const q=o&&S||G,Z=v||q?Hn:_?N:t.transform.clipSpaceToPixelsMatrix,W=f&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let H;H=f?c.iconsInText?Ji(T.kind,A,x,_,v,q,t,Z,j,$,P,R,E):Ki(T.kind,A,x,_,v,q,t,Z,j,$,o,P,0,E):Yi(T.kind,A,x,_,v,q,t,Z,j,$,o,P,E);const X={program:M,buffers:h,uniformValues:H,projectionData:U,atlasTexture:L,atlasTextureIcon:O,atlasInterpolation:z,atlasInterpolationIcon:D,isSDF:f,hasHalo:W};if(b&&c.canOverlap){w=!0;const t=h.segments.get();for(const i of t)C.push({segments:new e.aJ([i]),sortKey:i.sortKey,state:X,terrainData:k})}else C.push({segments:h.segments,sortKey:0,state:X,terrainData:k})}w&&C.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of C){const i=e.state;if(f.activeTexture.set(m.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,m.CLAMP_TO_EDGE),i.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,tr(i.buffers,e.segments,n,t,i.program,T,h,p,r,i.projectionData,e.terrainData)),r.u_is_halo=0}tr(i.buffers,e.segments,n,t,i.program,T,h,p,i.uniformValues,i.projectionData,e.terrainData)}}function tr(t,e,i,n,r,o,s,a,l,c,u){const h=n.context;r.draw(h,h.gl.TRIANGLES,o,s,a,$e.backCCW,l,u,c,i.id,t.layoutVertexBuffer,t.indexBuffer,e,i.paint,n.transform.zoom,t.programConfigurations.get(i.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function er(t,i,n,r,o){const s=t.context,a=s.gl,l=Ge.disabled,c=new Be([a.ONE,a.ONE],e.b7.transparent,[!0,!0,!0,!0]),u=i.getBucket(n);if(!u)return;const h=r.key;let p=n.heatmapFbos.get(h);p||(p=nr(s,i.tileSize,i.tileSize),n.heatmapFbos.set(h,p)),s.bindFramebuffer.set(p.framebuffer),s.viewport.set([0,0,i.tileSize,i.tileSize]),s.clear({color:e.b7.transparent});const d=u.programConfigurations.get(n.id),f=t.useProgram("heatmap",d,!o),m=t.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=t.style.map.terrain.getTerrainData(r);f.draw(s,a.TRIANGLES,Ue.disabled,l,c,$e.disabled,Fi(i,t.transform.zoom,n.paint.get("heatmap-intensity"),1),g,m,n.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,n.paint,t.transform.zoom,d)}function ir(t,e,i,n,r){const o=t.context,s=o.gl,a=t.transform;o.setColorMode(t.colorModeForRenderPass());const l=rr(o,e),c=i.key,u=e.heatmapFbos.get(c);if(!u)return;o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),l.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=a.getProjectionData({overscaledTileID:i,applyTerrainMatrix:r,applyGlobeMatrix:!n});t.useProgram("heatmapTexture").draw(o,s.TRIANGLES,Ue.disabled,Ge.disabled,t.colorModeForRenderPass(),$e.disabled,Ni(t,e,0,1),null,h,e.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments,e.paint,a.zoom),u.destroy(),e.heatmapFbos.delete(c)}function nr(t,e,i){var n,r;const o=t.gl,s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const a=null!==(n=t.HALF_FLOAT)&&void 0!==n?n:o.UNSIGNED_BYTE,l=null!==(r=t.RGBA16F)&&void 0!==r?r:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,e,i,0,o.RGBA,a,null);const c=t.createFramebuffer(e,i,!1,!1);return c.colorAttachment.set(s),c}function rr(t,e){return e.colorRampTexture||(e.colorRampTexture=new _(t,e.colorRamp,t.gl.RGBA)),e.colorRampTexture}function or(t,e,i,n,r){if(!i||!n||!n.imageAtlas)return;const o=n.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const t=r.getPaintProperty(e);s=o[t],a=o[t]}s&&a&&t.setConstantPatternPositions(s,a)}function sr(t,i,n,r,o,s,a,l){const c=t.context.gl,u="fill-pattern",h=n.paint.get(u),p=h&&h.constantOr(1),d=n.getCrossfadeParameters();let f,m,g,y,_;const v=t.transform,x=n.paint.get("fill-translate"),b=n.paint.get("fill-translate-anchor");a?(m=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=p?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const h of r){const r=i.getTile(h);if(p&&!r.patternsLoaded())continue;const T=r.getBucket(n);if(!T)continue;const S=T.programConfigurations.get(n.id),C=t.useProgram(m,S),E=t.style.map.terrain&&t.style.map.terrain.getTerrainData(h);p&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),S.updatePaintBuffers(d)),or(S,u,w,r,n);const I=v.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),M=e.aA(v,r,x,b);if(a){y=T.indexBuffer2,_=T.segments2;const e=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&p?Li(t,d,r,e,M):Pi(e,M)}else y=T.indexBuffer,_=T.segments,g=p?ki(t,d,r,M):{u_fill_translate:M};const A=t.stencilModeForClipping(h);C.draw(t.context,f,o,A,s,$e.backCCW,g,E,I,n.id,T.layoutVertexBuffer,y,_,n.paint,t.transform.zoom,S)}}function ar(t,i,n,r,o,s,a,l){const c=t.context,u=c.gl,h="fill-extrusion-pattern",p=n.paint.get(h),d=p.constantOr(1),f=n.getCrossfadeParameters(),m=n.paint.get("fill-extrusion-opacity"),g=p.constantOr(null),y=t.transform;for(const p of r){const r=i.getTile(p),_=r.getBucket(n);if(!_)continue;const v=t.style.map.terrain&&t.style.map.terrain.getTerrainData(p),x=_.programConfigurations.get(n.id),b=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",x);d&&(t.context.activeTexture.set(u.TEXTURE0),r.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers(f));const w=y.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!l,applyTerrainMatrix:!0});or(x,h,g,r,n);const T=e.aA(y,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),S=n.paint.get("fill-extrusion-vertical-gradient"),C=d?Ai(t,S,m,T,p,f,r):Mi(t,S,m,T);b.draw(c,c.gl.TRIANGLES,o,s,a,$e.backCCW,C,v,w,n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,n.paint,t.transform.zoom,x,t.style.map.terrain&&_.centroidVertexBuffer)}}function lr(t,e,i,n,r,o,s,a,l){var c;const u=t.style.projection,h=t.context,p=t.transform,d=h.gl,f=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],m=t.useProgram("hillshade",null,!1,f),g=!t.options.moving;for(const f of n){const n=e.getTile(f),y=n.fbo;if(!y)continue;const _=u.getMeshFromTileID(h,f.canonical,a,!0,"raster"),v=null===(c=t.style.map.terrain)||void 0===c?void 0:c.getTerrainData(f);h.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,y.colorAttachment.get());const x=p.getProjectionData({overscaledTileID:f,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,d.TRIANGLES,o,r[f.overscaledZ],s,$e.backCCW,Bi(t,n,i),v,x,i.id,_.vertexBuffer,_.indexBuffer,_.segments)}}const cr=[new e.P(0,0),new e.P(e.Z,0),new e.P(e.Z,e.Z),new e.P(0,e.Z)];function ur(t,e,i,n,r,o,s,a,l=!1,c=!1){const u=n[n.length-1].overscaledZ,h=t.context,p=h.gl,d=t.useProgram("raster"),f=t.transform,m=t.style.projection,g=t.colorModeForRenderPass(),y=!t.options.moving;for(const _ of n){const n=t.getDepthModeForSublayer(_.overscaledZ-u,1===i.paint.get("raster-opacity")?Ue.ReadWrite:Ue.ReadOnly,p.LESS),v=e.getTile(_);v.registerFadeDuration(i.paint.get("raster-fade-duration"));const x=e.findLoadedParent(_,0),b=e.findLoadedSibling(_),w=hr(v,x||b||null,e,i,t.transform,t.style.map.terrain);let T,S;const C="nearest"===i.paint.get("raster-resampling")?p.NEAREST:p.LINEAR;h.activeTexture.set(p.TEXTURE0),v.texture.bind(C,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(p.TEXTURE1),x?(x.texture.bind(C,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),T=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*T%1,v.tileID.canonical.y*T%1]):v.texture.bind(C,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST),v.texture.useMipmap&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&p.texParameterf(p.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const E=t.style.map.terrain&&t.style.map.terrain.getTerrainData(_),I=f.getProjectionData({overscaledTileID:_,aligned:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),M=Hi(S||[0,0],T||1,w,i,a),A=m.getMeshFromTileID(h,_.canonical,o,s,"raster");d.draw(h,p.TRIANGLES,n,r?r[_.overscaledZ]:Ge.disabled,g,l?$e.frontCCW:$e.backCCW,M,E,I,i.id,A.vertexBuffer,A.indexBuffer,A.segments)}}function hr(t,i,n,r,o,a){const l=r.paint.get("raster-fade-duration");if(!a&&l>0){const r=s.now(),a=(r-t.timeAdded)/l,c=i?(r-i.timeAdded)/l:-1,u=n.getSource(),h=_t(o,{tileSize:u.tileSize,roundZoom:u.roundZoom}),p=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=p&&t.refreshedUponExpiration?1:e.ae(p?a:1-c,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}const pr=new e.b7(1,0,0,1),dr=new e.b7(0,1,0,1),fr=new e.b7(0,0,1,1),mr=new e.b7(1,0,1,1),gr=new e.b7(0,1,1,1);function yr(t,e,i,n){vr(t,0,e+i/2,t.transform.width,i,n)}function _r(t,e,i,n){vr(t,e-i/2,0,i,t.transform.height,n)}function vr(t,e,i,n,r,o){const s=t.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(e*t.pixelRatio,i*t.pixelRatio,n*t.pixelRatio,r*t.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function xr(t,i,n){const r=t.context,o=r.gl,s=t.useProgram("debug"),a=Ue.disabled,l=Ge.disabled,c=t.colorModeForRenderPass(),u="$debug",h=t.style.map.terrain&&t.style.map.terrain.getTerrainData(n);r.activeTexture.set(o.TEXTURE0);const p=i.getTileByID(n.key).latestRawTileData,d=Math.floor((p&&p.byteLength||0)/1024),f=i.getTile(n).tileSize,m=512/Math.min(f,512)*(n.overscaledZ/t.transform.zoom)*.5;let g=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(g+=` => ${n.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,r=t.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(e,5,5),r.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,`${g} ${d}kB`);const y=t.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});s.draw(r,o.TRIANGLES,a,l,Be.alphaBlended,$e.disabled,Oi(e.b7.transparent,m),null,y,u,t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments),s.draw(r,o.LINE_STRIP,a,l,c,$e.disabled,Oi(e.b7.red),h,y,u,t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments)}function br(t,e,i,n){const{isRenderingGlobe:r}=n,o=t.context,s=o.gl,a=t.transform,l=t.colorModeForRenderPass(),c=t.getDepthModeFor3D(),u=t.useProgram("terrain");o.bindFramebuffer.set(null),o.viewport.set([0,0,t.width,t.height]);for(const n of i){const i=e.getTerrainMesh(n.tileID),h=t.renderToTexture.getTexture(n),p=e.getTerrainData(n.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,h.texture);const d=e.getMeshFrameDelta(a.zoom),f=a.calculateFogMatrix(n.tileID.toUnwrapped()),m=Ti(d,f,t.style.sky,a.pitch,r),g=a.getProjectionData({overscaledTileID:n.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(o,s.TRIANGLES,c,Ge.disabled,l,$e.backCCW,m,p,g,"terrain",i.vertexBuffer,i.indexBuffer,i.segments)}}function wr(t,i){if(!i.mesh){const n=new e.aI;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const r=new e.aK;r.emplaceBack(0,1,2),r.emplaceBack(0,2,3),i.mesh=new we(t.createVertexBuffer(n,Te.members),t.createIndexBuffer(r),e.aJ.simpleSegment(0,0,n.length,r.length))}return i.mesh}class Tr{constructor(t,i){this.context=new qn(t),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:e.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xt.maxUnderzooming+xt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _e}resize(t,e,i){if(this.width=Math.floor(t*i),this.height=Math.floor(e*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style._order)this.style._layers[t].resize()}setup(){const t=this.context,i=new e.aI;i.emplaceBack(0,0),i.emplaceBack(e.Z,0),i.emplaceBack(0,e.Z),i.emplaceBack(e.Z,e.Z),this.tileExtentBuffer=t.createVertexBuffer(i,Te.members),this.tileExtentSegments=e.aJ.simpleSegment(0,0,4,2);const n=new e.aI;n.emplaceBack(0,0),n.emplaceBack(e.Z,0),n.emplaceBack(0,e.Z),n.emplaceBack(e.Z,e.Z),this.debugBuffer=t.createVertexBuffer(n,Te.members),this.debugSegments=e.aJ.simpleSegment(0,0,4,5);const r=new e.b_;r.emplaceBack(0,0,0,0),r.emplaceBack(e.Z,0,e.Z,0),r.emplaceBack(0,e.Z,0,e.Z),r.emplaceBack(e.Z,e.Z,e.Z,e.Z),this.rasterBoundsBuffer=t.createVertexBuffer(r,bi.members),this.rasterBoundsSegments=e.aJ.simpleSegment(0,0,4,2);const o=new e.aI;o.emplaceBack(0,0),o.emplaceBack(e.Z,0),o.emplaceBack(0,e.Z),o.emplaceBack(e.Z,e.Z),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(o,Te.members),this.rasterBoundsSegmentsPosOnly=e.aJ.simpleSegment(0,0,4,5);const s=new e.aI;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(s,Te.members),this.viewportSegments=e.aJ.simpleSegment(0,0,4,2);const a=new e.b$;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(a);const l=new e.aK;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Ge({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new we(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const n=e.K();e.bQ(n,0,this.width,this.height,0,0,1),e.M(n,n,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const r={mainMatrix:n,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:n};this.useProgram("clippingMask",null,!0).draw(t,i.TRIANGLES,Ue.disabled,this.stencilClearMode,Be.disabled,$e.disabled,null,null,r,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,e,i){if(this.currentStencilSource===t.source||!t.isTileClipped()||!e||!e.length)return;this.currentStencilSource=t.source,this.nextStencilID+e.length>256&&this.clearStencil();const n=this.context;n.setColorMode(Be.disabled),n.setDepthMode(Ue.disabled);const r={};for(const t of e)r[t.key]=this.nextStencilID++;this._renderTileMasks(r,e,i,!0),this._renderTileMasks(r,e,i,!1),this._tileClippingMaskIDs=r}_renderTileMasks(t,e,i,n){const r=this.context,o=r.gl,s=this.style.projection,a=this.transform,l=this.useProgram("clippingMask");for(const c of e){const e=t[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=s.getMeshFromTileID(this.context,c.canonical,n,!0,"stencil"),p=a.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!i,applyTerrainMatrix:!0});l.draw(r,o.TRIANGLES,Ue.disabled,new Ge({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),Be.disabled,i?$e.disabled:$e.backCCW,null,u,p,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const t=this.context,e=t.gl,i=this.style.projection,n=this.transform,r=this.useProgram("depth"),o=this.getDepthModeFor3D(),s=vt(n,{tileSize:n.tileSize});for(const a of s){const s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a),l=i.getMeshFromTileID(this.context,a.canonical,!0,!0,"raster"),c=n.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});r.draw(t,e.TRIANGLES,o,Ge.disabled,Be.disabled,$e.backCCW,null,s,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,e=this.context.gl;return new Ge({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)}stencilModeForClipping(t){const e=this.context.gl;return new Ge({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,r=i[0].overscaledZ-n+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const t={};for(let i=0;i<r;i++)t[i+n]=new Ge({func:e.GEQUAL,mask:255},i+this.nextStencilID,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID+=r,[t,i]}return[{[n]:Ge.disabled},i]}stencilConfigForOverlapTwoPass(t){const e=this.context.gl,i=t.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),n=i[i.length-1].overscaledZ,r=i[0].overscaledZ-n+1;if(this.clearStencil(),r>1){const t={},o={};for(let i=0;i<r;i++)t[i+n]=new Ge({func:e.GREATER,mask:255},r+1+i,255,e.KEEP,e.KEEP,e.REPLACE),o[i+n]=new Ge({func:e.GREATER,mask:255},1+i,255,e.KEEP,e.KEEP,e.REPLACE);return this.nextStencilID=2*r+1,[t,o,i]}return this.nextStencilID=3,[{[n]:new Ge({func:e.GREATER,mask:255},2,255,e.KEEP,e.KEEP,e.REPLACE)},{[n]:new Ge({func:e.GREATER,mask:255},1,255,e.KEEP,e.KEEP,e.REPLACE)},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new Be([t.CONSTANT_COLOR,t.ONE],new e.b7(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Be.unblended:Be.alphaBlended}getDepthModeForSublayer(t,e,i){if(!this.opaquePassEnabledForLayer())return Ue.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ue(i||this.context.gl.LEQUAL,e,[n,n])}getDepthModeFor3D(){return new Ue(this.context.gl.LEQUAL,Ue.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){var n,r;this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.now()),this.imageManager.beginFrame();const o=this.style._order,a=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(n=t.projection)||void 0===n?void 0:n.transitionState)>0};for(const t in a){const e=a[t];e.used&&e.prepare(this.context),l[t]=e.getVisibleCoordinates(!1),c[t]=l[t].slice().reverse(),u[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<o.length;t++)if(this.style._layers[o[t]].is3D()){this.opaquePassCutoff=t;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const t of o){const e=this.style._layers[t];if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const i=c[e.source];("custom"===e.type||i.length)&&this.renderLayer(this,a[e.source],e,i,h)}if(null===(r=this.style.projection)||void 0===r||r.updateGPUdependent({context:this.context,useProgram:t=>this.useProgram(t)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.b7.black:e.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(t,e){const i=t.context,n=i.gl,r=((t,e,i)=>{const n=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),o=ht(e),s=e.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:t.properties.get("sky-color"),u_horizon_color:t.properties.get("horizon-color"),u_horizon:[(e.width/2-o*r)*i,(e.height/2+o*n)*i],u_horizon_normal:[-r,n],u_sky_horizon_blend:t.properties.get("sky-horizon-blend")*e.height/2*i,u_sky_blend:s}})(e,t.style.map.transform,t.pixelRatio),o=new Ue(n.LEQUAL,Ue.ReadWrite,[0,1]),s=Ge.disabled,a=t.colorModeForRenderPass(),l=t.useProgram("sky"),c=wr(i,e);l.draw(i,n.TRIANGLES,o,s,a,$e.disabled,r,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[o[this.currentLayer]],e=a[t.source],i=l[t.source];this._renderTileClippingMasks(t,i,!1),this.renderLayer(this,e,t,i,h)}this.renderPass="translucent";let p=!1;for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const t=this.style._layers[o[this.currentLayer]],e=a[t.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(t,h))continue;this.opaquePassEnabledForLayer()||p||(p=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const i=("symbol"===t.type?u:c)[t.source];this._renderTileClippingMasks(t,l[t.source],!!this.renderToTexture),this.renderLayer(this,e,t,i,h)}if(h.isRenderingGlobe&&function(t,i,n){const r=t.context,o=r.gl,s=t.useProgram("atmosphere"),a=new Ue(o.LEQUAL,Ue.ReadOnly,[0,1]),l=t.transform,c=function(t,i){const n=t.properties.get("position"),r=[-n.x,-n.y,-n.z],o=e.ad(new Float64Array(16));return"map"===t.properties.get("anchor")&&(e.a_(o,o,i.rollInRadians),e.a$(o,o,-i.pitchInRadians),e.a_(o,o,i.bearingInRadians),e.a$(o,o,i.center.lat*Math.PI/180),e.bp(o,o,-i.center.lng*Math.PI/180)),e.bZ(r,r,o),r}(n,t.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=i.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const p=ni(l.worldSize,l.center.lat),d=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,e.at(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,e.at(f,f,d),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((t,e,i,n,r)=>({u_sun_pos:t,u_atmosphere_blend:e,u_globe_position:i,u_globe_radius:n,u_inv_proj_matrix:r}))(c,h,[f[0],f[1],f[2]],p,d),g=wr(r,i);s.draw(r,o.TRIANGLES,a,Ge.disabled,Be.alphaBlended,$e.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const t=function(t,e){let i=null;const n=Object.values(t._layers).flatMap((i=>i.source&&!i.isHidden(e)?[t.sourceCaches[i.source]]:[])),r=n.filter((t=>"vector"===t.getSource().type)),o=n.filter((t=>"vector"!==t.getSource().type)),s=t=>{(!i||i.getSource().maxzoom<t.getSource().maxzoom)&&(i=t)};return r.forEach((t=>s(t))),i||o.forEach((t=>s(t))),i}(this.style,this.transform.zoom);t&&function(t,e,i){for(let n=0;n<i.length;n++)xr(t,e,i[n])}(this,t,t.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;yr(t,t.transform.height-(e.top||0),3,pr),yr(t,e.bottom||0,3,dr),_r(t,e.left||0,3,fr),_r(t,t.transform.width-(e.right||0),3,mr);const i=t.transform.centerPoint;!function(t,e,i,n){vr(t,e-1,i-10,2,20,n),vr(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,gr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,n=this.transform.modelViewProjectionMatrix;let r=this.terrainFacilitator.dirty;r||(r=t?!e.c0(i,n):!e.c1(i,n)),r||(r=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),r&&(e.c2(i,n),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(t,i){const n=t.context,r=n.gl,o=t.transform,s=Be.unblended,a=new Ue(r.LEQUAL,Ue.ReadWrite,[0,1]),l=i.sourceCache.getRenderableTiles(),c=t.useProgram("terrainDepth");n.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),n.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),n.clear({color:e.b7.transparent,depth:1});for(const t of l){const e=i.getTerrainMesh(t.tileID),l=i.getTerrainData(t.tileID),u=o.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:i.getMeshFrameDelta(o.zoom)};c.draw(n,r.TRIANGLES,a,Ge.disabled,s,$e.backCCW,h,l,u,"terrain",e.vertexBuffer,e.indexBuffer,e.segments)}n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain),function(t,i){const n=t.context,r=n.gl,o=t.transform,s=Be.unblended,a=new Ue(r.LEQUAL,Ue.ReadWrite,[0,1]),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=t.useProgram("terrainCoords");n.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),n.viewport.set([0,0,t.width/devicePixelRatio,t.height/devicePixelRatio]),n.clear({color:e.b7.transparent,depth:1}),i.coordsIndex=[];for(const t of c){const e=i.getTerrainMesh(t.tileID),c=i.getTerrainData(t.tileID);n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(o.zoom)},p=o.getProjectionData({overscaledTileID:t.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(n,r.TRIANGLES,a,Ge.disabled,s,$e.backCCW,h,c,p,"terrain",e.vertexBuffer,e.indexBuffer,e.segments),i.coordsIndex.push(t.tileID.key)}n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height])}(this,this.style.map.terrain))}renderLayer(t,i,n,r,o){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||(r||[]).length)&&(this.id=n.id,e.c3(n)?function(t,i,n,r,o,s){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:a}=s,l=Ge.disabled,c=t.colorModeForRenderPass();(n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(t,i,n,r,o,s,a,l,c){const u=i.transform,h=i.style.map.terrain,p="map"===o,d="map"===s;for(const o of t){const t=r.getTile(o),s=t.getBucket(n);if(!s||!s.text||!s.text.segments.get().length)continue;const f=e.ak(s.textSizeData,u.zoom),m=e.az(t,1,i.transform.zoom),g=Et(p,i.transform,m),y="none"!==n.layout.get("icon-text-fit")&&s.hasIconData();if(f){const i=Math.pow(2,u.zoom-t.tileID.overscaledZ),n=h?(t,e)=>h.getElevation(o,t,e):null;Kn(s,p,d,c,u,g,i,f,y,e.aA(u,t,a,l),o.toUnwrapped(),n)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&Qn(t,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),l,c,a),0!==n.paint.get("text-opacity").constantOr(1)&&Qn(t,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),l,c,a),i.map.showCollisionBoxes&&(Wn(t,i,n,r,!0),Wn(t,i,n,r,!1))}(t,i,n,r,this.style.placement.variableOffsets,o):e.c4(n)?function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:s}=o,a=n.paint.get("circle-opacity"),l=n.paint.get("circle-stroke-width"),c=n.paint.get("circle-stroke-opacity"),u=!n.layout.get("circle-sort-key").isConstant();if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=t.context,p=h.gl,d=t.transform,f=t.getDepthModeForSublayer(0,Ue.ReadOnly),m=Ge.disabled,g=t.colorModeForRenderPass(),y=[],_=d.getCircleRadiusCorrection();for(let o=0;o<r.length;o++){const a=r[o],l=i.getTile(a),c=l.getBucket(n);if(!c)continue;const h=n.paint.get("circle-translate"),p=n.paint.get("circle-translate-anchor"),f=e.aA(d,l,h,p),m=c.programConfigurations.get(n.id),g=t.useProgram("circle",m),v=c.layoutVertexBuffer,x=c.indexBuffer,b=t.style.map.terrain&&t.style.map.terrain.getTerrainData(a),w={programConfiguration:m,program:g,layoutVertexBuffer:v,indexBuffer:x,uniformValues:zi(t,l,n,f,_),terrainData:b,projectionData:d.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!s,applyTerrainMatrix:!0})};if(u){const t=c.segments.get();for(const i of t)y.push({segments:new e.aJ([i]),sortKey:i.sortKey,state:w})}else y.push({segments:c.segments,sortKey:0,state:w})}u&&y.sort(((t,e)=>t.sortKey-e.sortKey));for(const e of y){const{programConfiguration:i,program:r,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l,projectionData:c}=e.state;r.draw(h,p.TRIANGLES,f,m,g,$e.backCCW,a,l,c,n.id,o,s,e.segments,n.paint,t.transform.zoom,i)}}(t,i,n,r,o):e.c5(n)?function(t,i,n,r,o){if(0===n.paint.get("heatmap-opacity"))return;const s=t.context,{isRenderingToTexture:a,isRenderingGlobe:l}=o;if(t.style.map.terrain){for(const e of r){const r=i.getTile(e);i.hasRenderableParent(e)||("offscreen"===t.renderPass?er(t,r,n,e,l):"translucent"===t.renderPass&&ir(t,n,e,a,l))}s.viewport.set([0,0,t.width,t.height])}else"offscreen"===t.renderPass?function(t,i,n,r){const o=t.context,s=o.gl,a=t.transform,l=Ge.disabled,c=new Be([s.ONE,s.ONE],e.b7.transparent,[!0,!0,!0,!0]);(function(t,i,n){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,i.width/4,i.height/4]);let o=n.heatmapFbos.get(e.bW);o?(r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),t.bindFramebuffer.set(o.framebuffer)):(o=nr(t,i.width/4,i.height/4),n.heatmapFbos.set(e.bW,o))})(o,t,n),o.clear({color:e.b7.transparent});for(let e=0;e<r.length;e++){const u=r[e];if(i.hasRenderableParent(u))continue;const h=i.getTile(u),p=h.getBucket(n);if(!p)continue;const d=p.programConfigurations.get(n.id),f=t.useProgram("heatmap",d),m=a.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=a.getCircleRadiusCorrection();f.draw(o,s.TRIANGLES,Ue.disabled,l,c,$e.backCCW,Fi(h,a.zoom,n.paint.get("heatmap-intensity"),g),null,m,n.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,n.paint,a.zoom,d)}o.viewport.set([0,0,t.width,t.height])}(t,i,n,r):"translucent"===t.renderPass&&function(t,i){const n=t.context,r=n.gl;n.setColorMode(t.colorModeForRenderPass());const o=i.heatmapFbos.get(e.bW);o&&(n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1),rr(n,i).bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(n,r.TRIANGLES,Ue.disabled,Ge.disabled,t.colorModeForRenderPass(),$e.disabled,Ni(t,i,0,1),null,null,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom))}(t,n)}(t,i,n,r,o):e.c6(n)?function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const{isRenderingToTexture:s}=o,a=n.paint.get("line-opacity"),l=n.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const c=t.getDepthModeForSublayer(0,Ue.ReadOnly),u=t.colorModeForRenderPass(),h=n.paint.get("line-dasharray"),p=n.paint.get("line-pattern"),d=p.constantOr(1),f=n.paint.get("line-gradient"),m=n.getCrossfadeParameters(),g=d?"linePattern":h?"lineSDF":f?"lineGradient":"line",y=t.context,v=y.gl,x=t.transform;let b=!0;for(const o of r){const r=i.getTile(o);if(d&&!r.patternsLoaded())continue;const a=r.getBucket(n);if(!a)continue;const l=a.programConfigurations.get(n.id),w=t.context.program.get(),T=t.useProgram(g,l),S=b||T.program!==w,C=t.style.map.terrain&&t.style.map.terrain.getTerrainData(o),E=p.constantOr(null);if(E&&r.imageAtlas){const t=r.imageAtlas,e=t.patternPositions[E.to.toString()],i=t.patternPositions[E.from.toString()];e&&i&&l.setConstantPatternPositions(e,i)}const I=x.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),M=x.getPixelScale(),A=d?Gi(t,r,n,M,m):h?qi(t,r,n,M,h,m):f?Vi(t,r,n,M,a.lineClipsArray.length):Ui(t,r,n,M);if(d)y.activeTexture.set(v.TEXTURE0),r.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),l.updatePaintBuffers(m);else if(h&&(S||t.lineAtlas.dirty))y.activeTexture.set(v.TEXTURE0),t.lineAtlas.bind(y);else if(f){const r=a.gradients[n.id];let s=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.ae(e.bX(a.maxLineLength/e.Z*1024*r),256,y.maxTextureSize)}r.gradient=e.bY({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:a.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new _(y,r.gradient,v.RGBA),r.version=n.gradientVersion,s=r.texture}y.activeTexture.set(v.TEXTURE0),s.bind(n.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}const k=t.stencilModeForClipping(o);T.draw(y,v.TRIANGLES,c,k,u,$e.disabled,A,C,I,n.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,n.paint,t.transform.zoom,l,a.layoutVertexBuffer2),b=!1}}(t,i,n,r,o):e.c7(n)?function(t,i,n,r,o){const s=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0===a.constantOr(1))return;const{isRenderingToTexture:l}=o,c=t.colorModeForRenderPass(),u=n.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===s.constantOr(e.b7.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(t.renderPass===h){const e=t.getDepthModeForSublayer(1,"opaque"===t.renderPass?Ue.ReadWrite:Ue.ReadOnly);sr(t,i,n,r,e,c,!1,l)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const e=t.getDepthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ue.ReadOnly);sr(t,i,n,r,e,c,!0,l)}}(t,i,n,r,o):e.c8(n)?function(t,e,i,n,r){const o=i.paint.get("fill-extrusion-opacity");if(0===o)return;const{isRenderingToTexture:s}=r;if("translucent"===t.renderPass){const r=new Ue(t.context.gl.LEQUAL,Ue.ReadWrite,t.depthRangeFor3D);if(1!==o||i.paint.get("fill-extrusion-pattern").constantOr(1))ar(t,e,i,n,r,Ge.disabled,Be.disabled,s),ar(t,e,i,n,r,t.stencilModeFor3D(),t.colorModeForRenderPass(),s);else{const o=t.colorModeForRenderPass();ar(t,e,i,n,r,Ge.disabled,o,s)}}}(t,i,n,r,o):e.c9(n)?function(t,e,i,n,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const{isRenderingToTexture:o}=r,s=t.context,a=t.style.projection.useSubdivision,l=t.getDepthModeForSublayer(0,Ue.ReadOnly),c=t.colorModeForRenderPass();if("offscreen"===t.renderPass)!function(t,e,i,n,r,o,s){const a=t.context,l=a.gl;for(const c of i){const i=e.getTile(c),u=i.dem;if(!u||!u.data)continue;if(!i.needsHillshadePrepare)continue;const h=u.dim,p=u.stride,d=u.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(p),i.demTexture){const t=i.demTexture;t.update(d,{premultiply:!1}),t.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new _(a,d,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let f=i.fbo;if(!f){const t=new _(a,{width:h,height:h,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),f=i.fbo=a.createFramebuffer(h,h,!0,!1),f.colorAttachment.set(t.texture)}a.bindFramebuffer.set(f.framebuffer),a.viewport.set([0,0,h,h]),t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,$e.disabled,ji(i.tileID,u),null,null,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(t,e,n,i,l,Ge.disabled,c),s.viewport.set([0,0,t.width,t.height]);else if("translucent"===t.renderPass)if(a){const[r,s,a]=t.stencilConfigForOverlapTwoPass(n);lr(t,e,i,a,r,l,c,!1,o),lr(t,e,i,a,s,l,c,!0,o)}else{const[r,s]=t.getStencilConfigForOverlapAndUpdateStencilID(n);lr(t,e,i,s,r,l,c,!1,o)}}(t,i,n,r,o):e.ca(n)?function(t,e,i,n,r){if("translucent"!==t.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!n.length)return;const{isRenderingToTexture:o}=r,s=e.getSource(),a=t.style.projection.useSubdivision;if(s instanceof Y)ur(t,e,i,n,null,!1,!1,s.tileCoords,s.flippedWindingOrder,o);else if(a){const[r,s,a]=t.stencilConfigForOverlapTwoPass(n);ur(t,e,i,a,r,!1,!0,cr,!1,o),ur(t,e,i,a,s,!0,!0,cr,!1,o)}else{const[r,s]=t.getStencilConfigForOverlapAndUpdateStencilID(n);ur(t,e,i,s,r,!1,!0,cr,!1,o)}}(t,i,n,r,o):e.cb(n)?function(t,e,i,n,r){const o=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0===s)return;const{isRenderingToTexture:a}=r,l=t.context,c=l.gl,u=t.style.projection,h=t.transform,p=h.tileSize,d=i.paint.get("background-pattern");if(t.isPatternMissing(d))return;const f=!d&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==f)return;const m=Ge.disabled,g=t.getDepthModeForSublayer(0,"opaque"===f?Ue.ReadWrite:Ue.ReadOnly),y=t.colorModeForRenderPass(),_=t.useProgram(d?"backgroundPattern":"background"),v=n||vt(h,{tileSize:p,terrain:t.style.map.terrain});d&&(l.activeTexture.set(c.TEXTURE0),t.imageManager.bind(t.context));const x=i.getCrossfadeParameters();for(const e of v){const n=h.getProjectionData({overscaledTileID:e,applyGlobeMatrix:!a,applyTerrainMatrix:!0}),r=d?tn(s,t,d,{tileID:e,tileSize:p},x):Qi(s,o),f=t.style.map.terrain&&t.style.map.terrain.getTerrainData(e),v=u.getMeshFromTileID(l,e.canonical,!1,!0,"raster");_.draw(l,c.TRIANGLES,g,m,y,$e.backCCW,r,f,n,i.id,v.vertexBuffer,v.indexBuffer,v.segments)}}(t,0,n,r,o):e.cc(n)&&function(t,e,i,n){const{isRenderingGlobe:r}=n,o=t.context,s=i.implementation,a=t.style.projection,l=t.transform,c=l.getProjectionDataForCustomLayer(r),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:a.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${a.shaderPreludeCode.vertexSource}`,define:a.shaderDefine},defaultProjectionData:c},h=s.renderingMode?s.renderingMode:"2d";if("offscreen"===t.renderPass){const e=s.prerender;e&&(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),e.call(s,o.gl,u),o.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(Ge.disabled);const e="3d"===h?t.getDepthModeFor3D():t.getDepthModeForSublayer(0,Ue.ReadOnly);o.setDepthMode(e),s.render(o.gl,u),o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}(t,0,n,o))}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),i=this.imageManager.getPattern(t.to.toString());return!e||!i}useProgram(t,e,i=!1,n=[]){this.cache=this.cache||{};const r=!!this.style.map.terrain,o=this.style.projection,s=i?xe.projectionMercator:o.shaderPreludeCode,a=i?Se:o.shaderDefine,l=t+(e?e.cacheKey:"")+`/${i?Ce:o.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(r?"/terrain":"")+(n?`/${n.join("/")}`:"");return this.cache[l]||(this.cache[l]=new Ei(this.context,xe[t],e,nn[t],this._showOverdrawInspector,r,s,a,n)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:e}=this.context.gl;return this.width!==t||this.height!==e}}function Sr(t,e){let i,n=!1,r=null,o=null;const s=()=>{r=null,n&&(t.apply(o,i),r=setTimeout(s,e),n=!1)};return(...t)=>(n=!0,o=this,i=t,r||s(),r)}class Cr{constructor(t){this._getCurrentHash=()=>{const t=window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")},this._onHashChange=()=>{const t=this._getCurrentHash();if(!this._isValidHash(t))return!1;const e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0},this._updateHashUnthrottled=()=>{const t=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,t)},this._removeHash=()=>{const t=this._getCurrentHash();if(0===t.length)return;const e=t.join("/");let i=e;i.split("&").length>0&&(i=i.split("&")[0]),this._hashName&&(i=`${this._hashName}=${e}`);let n=window.location.hash.replace(i,"");n.startsWith("#&")?n=n.slice(0,1)+n.slice(2):"#"===n&&(n="");let r=window.location.href.replace(/(#.+)?$/,n);r=r.replace("&&","&"),window.history.replaceState(window.history.state,null,r)},this._updateHash=Sr(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const e=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,n=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,n),o=Math.round(e.lng*r)/r,s=Math.round(e.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=t?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const t=this._hashName;let e=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const n=i.split("=")[0];return n===t?(e=!0,`${n}=${c}`):i})).filter((t=>t));return e||i.push(`${t}=${c}`),`#${i.join("&")}`}return`#${c}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new e.Q(+t[2],+t[1])}catch(t){return!1}const i=+t[0],n=+(t[3]||0),r=+(t[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&n>=-180&&n<=180&&r>=this._map.getMinPitch()&&r<=this._map.getMaxPitch()}}const Er={linearity:.3,easing:e.cd(0,0,.3,1)},Ir=e.e({deceleration:2500,maxSpeed:1400},Er),Mr=e.e({deceleration:20,maxSpeed:1400},Er),Ar=e.e({deceleration:1e3,maxSpeed:360},Er),kr=e.e({deceleration:1e3,maxSpeed:90},Er),Pr=e.e({deceleration:1e3,maxSpeed:360},Er);class Lr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=s.now();for(;t.length>0&&e-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,i.roll+=t.rollDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=Dr(i.pan.mag(),n,e.e({},Ir,t||{})),s=i.pan.mult(o.amount/i.pan.mag()),a=this._map.cameraHelper.handlePanInertia(s,this._map.transform);r.center=a.easingCenter,r.offset=a.easingOffset,zr(r,o)}if(i.zoom){const t=Dr(i.zoom,n,Mr);r.zoom=this._map.transform.zoom+t.amount,zr(r,t)}if(i.bearing){const t=Dr(i.bearing,n,Ar);r.bearing=this._map.transform.bearing+e.ae(t.amount,-179,179),zr(r,t)}if(i.pitch){const t=Dr(i.pitch,n,kr);r.pitch=this._map.transform.pitch+t.amount,zr(r,t)}if(i.roll){const t=Dr(i.roll,n,Pr);r.roll=this._map.transform.roll+e.ae(t.amount,-179,179),zr(r,t)}if(r.zoom||r.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;r.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),e.e(r,{noMoveStart:!0})}}function zr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Dr(t,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=e.ae(t*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class Rr extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){n=n instanceof MouseEvent?n:new MouseEvent(t,n);const o=a.mousePos(i.getCanvas(),n),s=i.unproject(o);super(t,e.e({point:o,lngLat:s,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class Or extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,o=a.touchPos(i.getCanvasContainer(),r),s=o.map((t=>i.unproject(t))),l=o.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new e.P(0,0));super(t,{points:o,point:l,lngLats:s,lngLat:i.unproject(l),originalEvent:n}),this._defaultPrevented=!1}}class Fr extends e.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t,{originalEvent:i}),this._defaultPrevented=!1}}class Nr{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Fr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Rr(t.type,this._map,t))}mouseup(t){this._map.fire(new Rr(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Rr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Rr(t.type,this._map,t))}mouseover(t){this._map.fire(new Rr(t.type,this._map,t))}mouseout(t){this._map.fire(new Rr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Or(t.type,this._map,t))}touchmove(t){this._map.fire(new Or(t.type,this._map,t))}touchend(t){this._map.fire(new Or(t.type,this._map,t))}touchcancel(t){this._map.fire(new Or(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Br{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Rr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Rr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this._map.terrain)}}class $r{constructor(t,e){this._map=t,this._tr=new jr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(a.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const r=Math.min(n.x,i.x),o=Math.max(n.x,i.x),s=Math.min(n.y,i.y),l=Math.max(n.y,i.y);a.setTransform(this._box,`translate(${r}px,${s}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-s+"px"}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const n=this._startPos,r=i;if(this.reset(),a.suppressClick(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.l("boxzoomend",{originalEvent:t})),{cameraAnimation:t=>t.fitScreenCoordinates(n,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.l(t,{originalEvent:i}))}}function Ur(t,e){if(t.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${t.length}, points ${e.length}`);const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class Vr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=Ur(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=Ur(i,e);for(const t in this.touches){const e=n[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class Gr{constructor(t){this.singleTap=new Vr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class qr{constructor(t){this._tr=new jr(t),this._zoomIn=new Gr({numTouches:1,numTaps:2}),this._zoomOut=new Gr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),r=this._zoomOut.touchend(t,e,i),o=this._tr;return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(n)},{originalEvent:t})}):r?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(r)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.rollDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(e)?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const n=Array.isArray(e)?e[0]:e;return!this._moved&&n.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=n,this._move(i,n))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&a.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Wr={0:1,2:2};class Hr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const e=a.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(t,e){const i=Wr[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton)}isValidEndEvent(t){return a.mouseButton(t)===this._eventButton}}class Xr{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return 1===t.targetTouches.length}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Yr{constructor(t=new Hr({checkCorrectEvent:()=>!0}),e=new Xr){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=e}_executeRelevantHandler(t,e,i){return t instanceof MouseEvent?e(t):"undefined"!=typeof TouchEvent&&t instanceof TouchEvent?i(t):void 0}startMove(t){this._executeRelevantHandler(t,(t=>this.mouseMoveStateManager.startMove(t)),(t=>this.oneFingerTouchMoveStateManager.startMove(t)))}endMove(t){this._executeRelevantHandler(t,(t=>this.mouseMoveStateManager.endMove(t)),(t=>this.oneFingerTouchMoveStateManager.endMove(t)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(t=>this.mouseMoveStateManager.isValidStartEvent(t)),(t=>this.oneFingerTouchMoveStateManager.isValidStartEvent(t)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(t=>this.mouseMoveStateManager.isValidMoveEvent(t)),(t=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(t)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(t=>this.mouseMoveStateManager.isValidEndEvent(t)),(t=>this.oneFingerTouchMoveStateManager.isValidEndEvent(t)))}}const Kr=t=>{t.mousedown=t.dragStart,t.mousemoveWindow=t.dragMove,t.mouseup=t.dragEnd,t.contextmenu=t=>{t.preventDefault()}};class Jr{constructor(t,e){this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(this._active){if(!this._shouldBePrevented(i.length))return t.preventDefault(),this._calculateTransform(t,e,i);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&this._shouldBePrevented(i.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=Ur(n,i),o=new e.P(0,0),s=new e.P(0,0);let a=0;for(const t in r){const e=r[t],i=this._touches[t];i&&(o._add(e),s._add(e.sub(i)),a++,r[t]=e)}if(this._touches=r,this._shouldBePrevented(a)||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[n,r]=this._firstTwoTouches,o=to(i,e,n),s=to(i,e,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=to(i,e,n),s=to(i,e,r);o&&s||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function to(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function eo(t,e){return Math.log(t/e)/Math.LN2}class io extends Qr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(eo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eo(this._distance,i),pinchAround:e}}}function no(t,e){return 180*t.angleWith(e)/Math.PI}class ro extends Qr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,i){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:no(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=no(t,this._startVector);return Math.abs(i)<e}}function oo(t){return Math.abs(t.y)>Math.abs(t.x)}class so extends Qr{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,oo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const n=t[0].sub(this._lastPoints[0]),r=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(n,r,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,r=e.mag()>=2;if(!n&&!r)return;if(!n||!r)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return oo(t)&&oo(e)&&o}}const ao={panStep:100,bearingStep:15,pitchStep:10};class lo{constructor(t){this._tr=new jr(t);const e=ao;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,r=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),r=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),r=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:co,zoom:e?Math.round(a.zoom)+e*(t.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function co(t){return t*(2-t)}const uo=4.000244140625;class ho{constructor(t,e){this._onTimeout=t=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},this._map=t,this._tr=new jr(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const i=s.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%uo==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=a.mousePos(this._map.getCanvas(),t),n=this._tr;this._aroundPoint=this._aroundCenter?n.transform.locationToScreenPoint(e.Q.convert(n.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const e=t.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=e),"number"==typeof this._targetZoom&&(this._targetZoom+=e)}if(0!==this._delta){const i="wheel"===this._type&&Math.abs(this._delta)>uo?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==n&&(n=1/n);const r="number"!=typeof this._targetZoom?t.scale:e.ac(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),e.ah(r*n)).zoom,"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"!=typeof this._targetZoom?t.zoom:this._targetZoom,n=this._startZoom,r=this._easing;let o,a=!1;if("wheel"===this._type&&n&&r){const t=s.now()-this._lastWheelEventTime,l=Math.min((t+5)/200,1),c=r(l);o=e.B.number(n,i,c),l<1?this._frameId||(this._frameId=!0):a=!0}else o=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=o,{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.cf;if(this._prevEase){const t=this._prevEase,n=(s.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-o*o);i=e.cd(o,a,.25,1)}return this._prevEase={start:s.now(),duration:t,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fo{constructor(t){this._tr=new jr(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(){this._tap=new Gr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(this._tapTime){const n=e[0],r=t.timeStamp-this._tapTime<500,o=this._tapPoint.dist(n)<30;r&&o?i.length>0&&(this._swipePoint=n,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(t,e,i)}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const n=this._tap.touchend(t,e,i);n&&(this._tapTime=t.timeStamp,this._tapPoint=n)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yo{constructor(t,e,i,n){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=e,this._mousePitch=i,this._mouseRoll=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class _o{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vo{constructor(t,e){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=a.create("div","maplibregl-cooperative-gesture-screen",t);let e=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(e=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const i=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),n=document.createElement("div");n.className="maplibregl-desktop-message",n.textContent=e,this._container.appendChild(n);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=i,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(a.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,i){this._enabled&&(this._map.fire(new e.l("cooperativegestureprevented",{gestureType:t,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const xo=t=>t.zoom||t.drag||t.roll||t.pitch||t.rotate;class bo extends e.l{}function wo(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta||t.rollDelta}class To{constructor(t,i){this.handleWindowEvent=t=>{this.handleEvent(t,`${t.type}Window`)},this.handleEvent=(t,i)=>{if("blur"===t.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===t.type?void 0:t,r={needsRenderFrame:!1},o={},s={};for(const{handlerName:l,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;if(this._blockedByActive(s,u,l))c.reset();else if(c[i||t.type]){if(e.cg(t,i||t.type)){const e=a.mousePos(this._map.getCanvas(),t);h=c[i||t.type](t,e)}else if(e.ch(t,i||t.type)){const e=this._getMapTouches(t.touches),n=a.touchPos(this._map.getCanvas(),e);h=c[i||t.type](t,n,e)}else e.ci(i||t.type)||(h=c[i||t.type](t));this.mergeHandlerResult(r,o,h,l,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()}(h||c.isActive())&&(s[l]=c)}const l={};for(const t in this._previousActiveHandlers)s[t]||(l[t]=n);this._previousActiveHandlers=s,(Object.keys(l).length||wo(r))&&(this._changes.push([r,o,l]),this._triggerRenderFrame()),(Object.keys(s).length||wo(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=r;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lr(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners)a.addEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[t,e,i]of this._listeners)a.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const i=this._map,n=i.getCanvasContainer();this._add("mapEvent",new Nr(i,t));const r=i.boxZoom=new $r(i,t);this._add("boxZoom",r),t.interactive&&t.boxZoom&&r.enable();const o=i.cooperativeGestures=new vo(i,t.cooperativeGestures);this._add("cooperativeGestures",o),t.cooperativeGestures&&o.enable();const s=new qr(i),l=new fo(i);i.doubleClickZoom=new po(l,s),this._add("tapZoom",s),this._add("clickZoom",l),t.interactive&&t.doubleClickZoom&&i.doubleClickZoom.enable();const c=new mo;this._add("tapDragZoom",c);const u=i.touchPitch=new so(i);this._add("touchPitch",u),t.interactive&&t.touchPitch&&i.touchPitch.enable(t.touchPitch);const h=()=>i.project(i.getCenter()),p=function({enable:t,clickTolerance:i,aroundCenter:n=!0,minPixelCenterThreshold:r=100,rotateDegreesPerPixelMoved:o=.8},s){const l=new Hr({checkCorrectEvent:t=>0===a.mouseButton(t)&&t.ctrlKey||2===a.mouseButton(t)&&!t.ctrlKey});return new Zr({clickTolerance:i,move:(t,i)=>{const a=s();if(n&&Math.abs(a.y-t.y)>r)return{bearingDelta:e.ce(new e.P(t.x,i.y),i,a)};let l=(i.x-t.x)*o;return n&&i.y<a.y&&(l=-l),{bearingDelta:l}},moveStateManager:l,enable:t,assignEvents:Kr})}(t,h),d=function({enable:t,clickTolerance:e,pitchDegreesPerPixelMoved:i=-.5}){const n=new Hr({checkCorrectEvent:t=>0===a.mouseButton(t)&&t.ctrlKey||2===a.mouseButton(t)});return new Zr({clickTolerance:e,move:(t,e)=>({pitchDelta:(e.y-t.y)*i}),moveStateManager:n,enable:t,assignEvents:Kr})}(t),f=function({enable:t,clickTolerance:e,rollDegreesPerPixelMoved:i=.3},n){const r=new Hr({checkCorrectEvent:t=>2===a.mouseButton(t)&&t.ctrlKey});return new Zr({clickTolerance:e,move:(t,e)=>{const r=n();let o=(e.x-t.x)*i;return e.y<r.y&&(o=-o),{rollDelta:o}},moveStateManager:r,enable:t,assignEvents:Kr})}(t,h);i.dragRotate=new yo(t,p,d,f),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",d,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),t.interactive&&t.dragRotate&&i.dragRotate.enable();const m=function({enable:t,clickTolerance:e}){const i=new Hr({checkCorrectEvent:t=>0===a.mouseButton(t)&&!t.ctrlKey});return new Zr({clickTolerance:e,move:(t,e)=>({around:e,panDelta:e.sub(t)}),activateOnStart:!0,moveStateManager:i,enable:t,assignEvents:Kr})}(t),g=new Jr(t,i);i.dragPan=new go(n,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&i.dragPan.enable(t.dragPan);const y=new ro,_=new io;i.touchZoomRotate=new _o(n,_,y,c),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&i.touchZoomRotate.enable(t.touchZoomRotate);const v=i.scrollZoom=new ho(i,(()=>this._triggerRenderFrame()));this._add("scrollZoom",v,["mousePan"]),t.interactive&&t.scrollZoom&&i.scrollZoom.enable(t.scrollZoom);const x=i.keyboard=new lo(i);this._add("keyboard",x),t.interactive&&t.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new Br(i))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(xo(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}mergeHandlerResult(t,i,n,r,o){if(!n)return;e.e(t,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.rollDelta&&(i.roll=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),r.rollDelta&&(t.rollDelta=(t.rollDelta||0)+r.rollDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.e(i,o),e.e(n,s);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,e,i){const n=this._map,r=n._getTransformForUpdate(),o=n.terrain;if(!(wo(t)||o&&this._terrainMovement))return this._fireEvents(e,i,!0);n._stop(!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:p}=t;void 0!==p&&(h=p),h=h||n.transform.centerPoint,o&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const d={panDelta:s,zoomDelta:a,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!r.isPointOnMapSurface(h)&&(h=r.centerPoint);const f=h.distSqr(r.centerPoint)<.01?r.center:r.screenPointToLocation(s?h.sub(s):h);o?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(d,r),this._terrainMovement||!e.drag&&!e.zoom?e.drag&&this._terrainMovement?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(s))):this._map.cameraHelper.handleMapControlsPan(d,r,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(d,r,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(d,r),this._map.cameraHelper.handleMapControlsPan(d,r,f)),n._applyUpdatedTransform(r),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,i,n){const r=xo(this._eventsInProgress),o=xo(t),a={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(a[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in a)this._fireEvent(t,a[t]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const l={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=i[e]||n,l[`${t}end`]=c)}for(const t in l)this._fireEvent(t,l[t]);const u=xo(this._eventsInProgress),h=(r||o)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const t=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&t.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(t)}if(n&&h){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;!t||!t.essential&&s.prefersReducedMotion?(this._map.fire(new e.l("moveend",{originalEvent:c})),i(this._map.getBearing())&&this._map.resetNorth()):(i(t.bearing||this._map.getBearing())&&(t.bearing=0),t.freezeElevation=!0,this._map.easeTo(t,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.l(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new bo("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class So extends e.E{constructor(t,e,i){super(),this._renderFrameCallback=()=>{const t=Math.min((s.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this.cameraHelper=e,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,e){t.apply(this.transform),this.transform=t,this.cameraHelper=e}getCenter(){return new e.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,e){return this.jumpTo({elevation:t},e),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,i,n){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.e({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,i,n){return this.easeTo(e.e({zoom:t},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,i){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new e.l("movestart",i)).fire(new e.l("move",i)).fire(new e.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,i,n){return this.easeTo(e.e({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.e({bearing:0,pitch:0,roll:0,duration:1e3},t),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}getRoll(){return this.transform.roll}setRoll(t,e){return this.jumpTo({roll:t},e),this}cameraForBounds(t,e){t=G.convert(t).adjustAntiMeridian();const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(t,i,n,r){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=e.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const t=r.padding;r.padding={top:t,bottom:t,right:t,left:t}}const s=e.e(o,r.padding);r.padding=s;const a=this.transform,l=new G(t,i);return this.cameraHelper.cameraForBoxAndBearing(r,s,l,n,a)}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(t,i,n,r,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(e.P.convert(t)),this.transform.screenPointToLocation(e.P.convert(i)),n,r),r,o)}_fitInternal(t,i,n){return t?(delete(i=e.e(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=this._getTransformForUpdate();let r=!1,o=!1,s=!1;const a=n.zoom;this.cameraHelper.handleJumpToCenterZoom(n,t);const l=n.zoom!==a;return"elevation"in t&&n.elevation!==+t.elevation&&n.setElevation(+t.elevation),"bearing"in t&&n.bearing!==+t.bearing&&(r=!0,n.setBearing(+t.bearing)),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.setPitch(+t.pitch)),"roll"in t&&n.roll!==+t.roll&&(s=!0,n.setRoll(+t.roll)),null==t.padding||n.isPaddingEqual(t.padding)||n.setPadding(t.padding),this._applyUpdatedTransform(n),this.fire(new e.l("movestart",i)).fire(new e.l("move",i)),l&&this.fire(new e.l("zoomstart",i)).fire(new e.l("zoom",i)).fire(new e.l("zoomend",i)),r&&this.fire(new e.l("rotatestart",i)).fire(new e.l("rotate",i)).fire(new e.l("rotateend",i)),o&&this.fire(new e.l("pitchstart",i)).fire(new e.l("pitch",i)).fire(new e.l("pitchend",i)),s&&this.fire(new e.l("rollstart",i)).fire(new e.l("roll",i)).fire(new e.l("rollend",i)),this.fire(new e.l("moveend",i))}calculateCameraOptionsFromTo(t,i,n,r=0){const o=e.$.fromLngLat(t,i),s=e.$.fromLngLat(n,r),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),p=e.ah(this.transform.cameraToCenterDistance/u/this.transform.tileSize),d=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),elevation:r,zoom:p,pitch:f,bearing:d}}calculateCameraOptionsFromCameraLngLatAltRotation(t,e,i,n,r){const o=this.transform.calculateCenterFromCameraLngLatAlt(t,e,i,n);return{center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:i,pitch:n,roll:r}}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.cf},t)).animate||!t.essential&&s.prefersReducedMotion)&&(t.duration=0);const n=this._getTransformForUpdate(),r=this.getBearing(),o=n.pitch,a=n.roll,l="bearing"in t?this._normalizeBearing(t.bearing,r):r,c="pitch"in t?+t.pitch:o,u="roll"in t?this._normalizeBearing(t.roll,a):a,h="padding"in t?t.padding:n.padding,p=e.P.convert(t.offset);let d,f;t.around&&(d=e.Q.convert(t.around),f=n.locationToScreenPoint(d));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(n,{bearing:l,pitch:c,roll:u,padding:h,around:d,aroundPoint:f,offsetAsPoint:p,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||r!==l,this._pitching=this._pitching||c!==o,this._rolling=this._rolling||u!==a,this._padding=!n.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease((e=>{g.easeFunc(e),this.terrain&&!t.freezeElevation&&this._updateElevation(e),this._applyUpdatedTransform(n),this._fireMoveEvents(i)}),(e=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,i||n.moving||this.fire(new e.l("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.l("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.l("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.l("pitchstart",t)),this._rolling&&!n.rolling&&this.fire(new e.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&i!==this._elevationTarget){const e=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(e-(i-(e*t+this._elevationStart))/(1-t)),this._elevationTarget=i}this.transform.setElevation(e.B.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const e=t.getCameraLngLat(),i=t.getCameraAltitude(),n=this.terrain?this.terrain.getElevationForLngLatZoom(e,t.zoom):0;if(i<n){const i=this.calculateCameraOptionsFromTo(e,n,t.center,t.elevation);return{pitch:i.pitch,zoom:i.zoom}}return{}}_applyUpdatedTransform(t){const e=[];if(e.push((t=>this._elevateCameraIfInsideTerrain(t))),this.transformCameraUpdate&&e.push((t=>this.transformCameraUpdate(t))),!e.length)return;const i=t.clone();for(const t of e){const e=i.clone(),{center:n,zoom:r,roll:o,pitch:s,bearing:a,elevation:l}=t(e);n&&e.setCenter(n),void 0!==l&&e.setElevation(l),void 0!==r&&e.setZoom(r),void 0!==o&&e.setRoll(o),void 0!==s&&e.setPitch(s),void 0!==a&&e.setBearing(a),i.apply(e)}this.transform.apply(i)}_fireMoveEvents(t){this.fire(new e.l("move",t)),this._zooming&&this.fire(new e.l("zoom",t)),this._rotating&&this.fire(new e.l("rotate",t)),this._pitching&&this.fire(new e.l("pitch",t)),this._rolling&&this.fire(new e.l("roll",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const n=this._zooming,r=this._rotating,o=this._pitching,s=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,n&&this.fire(new e.l("zoomend",t)),r&&this.fire(new e.l("rotateend",t)),o&&this.fire(new e.l("pitchend",t)),s&&this.fire(new e.l("rollend",t)),this.fire(new e.l("moveend",t))}flyTo(t,i){if(!t.essential&&s.prefersReducedMotion){const n=e.O(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(n,i)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.cf},t);const n=this._getTransformForUpdate(),r=n.bearing,o=n.pitch,a=n.roll,l=n.padding,c="bearing"in t?this._normalizeBearing(t.bearing,r):r,u="pitch"in t?+t.pitch:o,h="roll"in t?this._normalizeBearing(t.roll,a):a,p="padding"in t?t.padding:n.padding,d=e.P.convert(t.offset);let f=n.centerPoint.add(d);const m=n.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(n,{bearing:c,pitch:u,roll:h,padding:p,locationAtOffset:m,offsetAsPoint:d,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let y=t.curve;const _=Math.max(n.width,n.height),v=_/g.scaleOfZoom,x=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(y=Math.sqrt(_/g.scaleOfMinZoom/x*2));const b=y*y;function w(t){const e=(v*v-_*_+(t?-1:1)*b*b*x*x)/(2*(t?v:_)*b*x);return Math.log(Math.sqrt(e*e+1)-e)}function T(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}const C=w(!1);let E=function(t){return S(C)/S(C+y*t)},I=function(t){return _*((S(C)*(T(e=C+y*t)/S(e))-T(C))/b)/x;var e},M=(w(!0)-C)/y;if(Math.abs(x)<2e-6||!isFinite(M)){if(Math.abs(_-v)<1e-6)return this.easeTo(t,i);const e=v<_?-1:1;M=Math.abs(Math.log(v/_))/y,I=()=>0,E=t=>Math.exp(e*y*t)}return t.duration="duration"in t?+t.duration:1e3*M/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=r!==c,this._pitching=u!==o,this._rolling=h!==a,this._padding=!n.isPaddingEqual(p),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease((s=>{const m=s*M,y=1/E(m),_=I(m);this._rotating&&n.setBearing(e.B.number(r,c,s)),this._pitching&&n.setPitch(e.B.number(o,u,s)),this._rolling&&n.setRoll(e.B.number(a,h,s)),this._padding&&(n.interpolatePadding(l,p,s),f=n.centerPoint.add(d)),g.easeFunc(s,y,_,f),this.terrain&&!t.freezeElevation&&this._updateElevation(s),this._applyUpdatedTransform(n),this._fireMoveEvents(i)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){var i;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const t=this._onEaseEnd;delete this._onEaseEnd,t.call(this,e)}return t||null===(i=this.handlers)||void 0===i||i.stop(!1),this}_ease(t,e,i){!1===i.animate||0===i.duration?(t(1),e()):(this._easeStart=s.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,i){t=e.aL(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(e.Q.convert(t),this.transform.tileZoom):null}}const Co={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Eo{constructor(t=Co){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=t=>{!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType&&"terrain"!==t.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const i=this._map._getUIString(`AttributionControl.${e}`);t.title=i,t.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((t=>"string"!=typeof t?"":t))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style.sourceCaches;for(const i in e){const n=e[i];if(n.used||n.usedForTerrain){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t=t.filter((t=>String(t).trim())),t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=a.sanitize(i),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Io{constructor(t={}){this._updateCompact=()=>{const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&e.classList.add("maplibregl-compact"):e.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");const e=a.create("a","maplibregl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://maplibre.org/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Mo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ao=e.aG([{name:"a_pos3d",type:"Int16",components:3}]);class ko extends e.E{constructor(t){super(),this._lastTilesetChange=s.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,i){this.sourceCache.update(t,i),this._renderableTilesKeys=[];const n={};for(const r of vt(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))n[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.terrainRttPosMatrix32f=new Float64Array(16),e.bQ(r.terrainRttPosMatrix32f,0,e.Z,e.Z,0,0,1),this._tiles[r.key]=new ot(r,this.tileSize),this._lastTilesetChange=s.now());for(const t in this._tiles)n[t]||delete this._tiles[t]}freeRtt(t){for(const e in this._tiles){const i=this._tiles[e];(!t||i.tileID.equals(t)||i.tileID.isChildOf(t)||t.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,e){return e?this._getTerrainCoordsForTileRanges(t,e):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const i={};for(const n of this._renderableTilesKeys){const r=this._tiles[n].tileID,o=t.clone(),s=e.b2();if(r.canonical.equals(t.canonical))e.bQ(s,0,e.Z,e.Z,0,0,1);else if(r.canonical.isChildOf(t.canonical)){const i=r.canonical.z-t.canonical.z,n=r.canonical.x-(r.canonical.x>>i<<i),o=r.canonical.y-(r.canonical.y>>i<<i),a=e.Z>>i;e.bQ(s,0,a,a,0,0,1),e.L(s,s,[-n*a,-o*a,0])}else{if(!t.canonical.isChildOf(r.canonical))continue;{const i=t.canonical.z-r.canonical.z,n=t.canonical.x-(t.canonical.x>>i<<i),o=t.canonical.y-(t.canonical.y>>i<<i),a=e.Z>>i;e.bQ(s,0,e.Z,e.Z,0,0,1),e.L(s,s,[n*a,o*a,0]),e.M(s,s,[1/2**i,1/2**i,0])}}o.terrainRttPosMatrix32f=new Float32Array(s),i[n]=o}return i}_getTerrainCoordsForTileRanges(t,i){const n={};for(const r of this._renderableTilesKeys){const o=this._tiles[r].tileID;if(!this._isWithinTileRanges(o,i))continue;const s=t.clone(),a=e.b2();if(o.canonical.z===t.canonical.z){const i=t.canonical.x-o.canonical.x,n=t.canonical.y-o.canonical.y;e.bQ(a,0,e.Z,e.Z,0,0,1),e.L(a,a,[i*e.Z,n*e.Z,0])}else if(o.canonical.z>t.canonical.z){const i=o.canonical.z-t.canonical.z,n=o.canonical.x-(o.canonical.x>>i<<i),r=o.canonical.y-(o.canonical.y>>i<<i),s=t.canonical.x-(o.canonical.x>>i),l=t.canonical.y-(o.canonical.y>>i),c=e.Z>>i;e.bQ(a,0,c,c,0,0,1),e.L(a,a,[-n*c+s*e.Z,-r*c+l*e.Z,0])}else{const i=t.canonical.z-o.canonical.z,n=t.canonical.x-(t.canonical.x>>i<<i),r=t.canonical.y-(t.canonical.y>>i<<i),s=(t.canonical.x>>i)-o.canonical.x,l=(t.canonical.y>>i)-o.canonical.y,c=e.Z<<i;e.bQ(a,0,c,c,0,0,1),e.L(a,a,[n*e.Z+s*c,r*e.Z+l*c,0])}s.terrainRttPosMatrix32f=new Float32Array(a),n[r]=s}return n}getSourceTile(t,e){const i=this.sourceCache._source;let n=t.overscaledZ-this.deltaZoom;if(n>i.maxzoom&&(n=i.maxzoom),n<i.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(n).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!r||!r.dem)&&e)for(;n>=i.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(t.scaledTo(n--).key);return r}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,e){return e[t.canonical.z]&&t.canonical.x>=e[t.canonical.z].minTileX&&t.canonical.x<=e[t.canonical.z].maxTileX&&t.canonical.y>=e[t.canonical.z].minTileY&&t.canonical.y<=e[t.canonical.z].maxTileY}}class Po{constructor(t,e,i){this._meshCache={},this.painter=t,this.sourceCache=new ko(e),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,i,n,r=e.Z){var o;if(!(i>=0&&i<r&&n>=0&&n<r))return 0;const s=this.getTerrainData(t),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=e.cj([],[i/r*e.Z,n/r*e.Z],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),p=c[0]-u,d=c[1]-h;return a.get(u,h)*(1-p)*(1-d)+a.get(u+1,h)*p*(1-d)+a.get(u,h+1)*(1-p)*d+a.get(u+1,h+1)*p*d}getElevationForLngLatZoom(t,i){if(!e.ck(i,t.wrap()))return 0;const{tileID:n,mercatorX:r,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(t,i);return this.getElevation(n,r%e.Z,o%e.Z,e.Z)}getElevation(t,i,n,r=e.Z){return this.getDEMElevation(t,i,n,r)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const t=this.painter.context,i=new e.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _(t,i,t.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _(t,new e.R({width:1,height:1}),t.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=e.ad([])}const i=this.sourceCache.getSourceTile(t,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const t=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new _(t,i.dem.getPixels(),t.gl.RGBA,{premultiply:!1}),i.demTexture.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const n=i&&i+i.tileID.key+t.key;if(n&&!this._demMatrixCache[n]){const n=this.sourceCache.sourceCache._source.maxzoom;let r=t.canonical.z-i.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=n?r=t.canonical.z-n:e.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=t.canonical.x-(t.canonical.x>>r<<r),s=t.canonical.y-(t.canonical.y>>r<<r),a=e.cl(new Float64Array(16),[1/(e.Z<<r),1/(e.Z<<r),0]);e.L(a,a,[o*e.Z,s*e.Z,0]),this._demMatrixCache[t.key]={matrix:a,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:n?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(t){const e=this.painter,i=e.width/devicePixelRatio,n=e.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===n||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _(e.context,{width:i,height:n,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _(e.context,{width:i,height:n,data:null},e.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(e.context.gl.NEAREST,e.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=e.context.createFramebuffer(i,n,!0,!1),this._fbo.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,i,n))),this._fbo.colorAttachment.set("coords"===t?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let t=0,e=0;t<this._coordsTextureSize;t++)for(let n=0;n<this._coordsTextureSize;n++,e+=4)i[e+0]=255&n,i[e+1]=255&t,i[e+2]=n>>8<<4|t>>8,i[e+3]=0;const n=new e.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),r=new _(t,n,t.gl.RGBA,{premultiply:!1});return r.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),n=this.painter.context,r=n.gl,o=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);n.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(o,a-s-1,1,1,r.RGBA,r.UNSIGNED_BYTE,i),n.bindFramebuffer.set(null);const l=i[0]+(i[2]>>4<<8),c=i[1]+((15&i[2])<<8),u=this.coordsIndex[255-i[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const p=this._coordsTextureSize,d=(1<<h.tileID.canonical.z)*p;return new e.$((h.tileID.canonical.x*p+l)/d+h.tileID.wrap,(h.tileID.canonical.y*p+c)/d,this.getElevation(h.tileID,l,c,p))}depthAtPoint(t){const e=new Uint8Array(4),i=this.painter.context,n=i.gl;return i.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),n.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,n.RGBA,n.UNSIGNED_BYTE,e),i.bindFramebuffer.set(null),(e[0]/16777216+e[1]/65536+e[2]/256+e[3])/256}getTerrainMesh(t){var i;const n=(null===(i=this.painter.style.projection)||void 0===i?void 0:i.transitionState)>0,r=n&&0===t.canonical.y,o=n&&t.canonical.y===(1<<t.canonical.z)-1,s=`m_${r?"n":""}_${o?"s":""}`;if(this._meshCache[s])return this._meshCache[s];const a=this.painter.context,l=new e.cm,c=new e.aK,u=this.meshSize,h=e.Z/u,p=u*u;for(let t=0;t<=u;t++)for(let e=0;e<=u;e++)l.emplaceBack(e*h,t*h,0);for(let t=0;t<p;t+=u+1)for(let e=0;e<u;e++)c.emplaceBack(e+t,u+e+t+1,u+e+t+2),c.emplaceBack(e+t,u+e+t+2,e+t+1);const d=l.length,f=d+(u+1),m=(u+1)*u,g=r?e.b9:0,y=r?0:1,_=o?e.ba:e.Z,v=o?0:1;for(let t=0;t<=u;t++)l.emplaceBack(t*h,g,y);for(let t=0;t<=u;t++)l.emplaceBack(t*h,_,v);for(let t=0;t<u;t++)c.emplaceBack(m+t,f+t,f+t+1),c.emplaceBack(m+t,f+t+1,m+t+1),c.emplaceBack(0+t,d+t+1,d+t),c.emplaceBack(0+t,0+t+1,d+t+1);const x=l.length,b=x+2*(u+1);for(const t of[0,1])for(let i=0;i<=u;i++)for(const n of[0,1])l.emplaceBack(t*e.Z,i*h,n);for(let t=0;t<2*u;t+=2)c.emplaceBack(x+t,x+t+1,x+t+3),c.emplaceBack(x+t,x+t+3,x+t+2),c.emplaceBack(b+t,b+t+3,b+t+1),c.emplaceBack(b+t,b+t+2,b+t+3);const w=new we(a.createVertexBuffer(l,Ao.members),a.createIndexBuffer(c),e.aJ.simpleSegment(0,0,l.length,c.length));return this._meshCache[s]=w,w}getMeshFrameDelta(t){return 2*Math.PI*e.bu/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,e){var i;const{tileID:n}=this._getOverscaledTileIDFromLngLatZoom(t,e);return null!==(i=this.getMinMaxElevation(n).minElevation)&&void 0!==i?i:0}getMinMaxElevation(t){const e=this.getTerrainData(t).tile,i={minElevation:null,maxElevation:null};return e&&e.dem&&(i.minElevation=e.dem.min*this.exaggeration,i.maxElevation=e.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(t,i){const n=e.$.fromLngLat(t.wrap()),r=(1<<i)*e.Z,o=n.x*r,s=n.y*r,a=Math.floor(o/e.Z),l=Math.floor(s/e.Z);return{tileID:new e.Y(i,0,i,a,l),mercatorX:o,mercatorY:s}}}class Lo{constructor(t,e,i){this._context=t,this._size=e,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const e=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new _(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),e.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),e.colorAttachment.set(i.texture),{id:t,fbo:e,texture:i,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((e=>t.id!==e)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const t of this._recentlyUsed)if(!this._objects[t].inUse)return this._objects[t];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((t=>!t.inUse))}}const zo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Do{constructor(t,e){this.painter=t,this.terrain=e,this.pool=new Lo(t.context,30,e.sourceCache.tileSize*e.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,e){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter((i=>!t._layers[i].isHidden(e))),this._coordsAscending={};for(const e in t.sourceCaches){this._coordsAscending[e]={};const i=t.sourceCaches[e].getVisibleCoordinates(),n=t.sourceCaches[e].getSource(),r=n instanceof Y?n.terrainTileRanges:null;for(const t of i){const i=this.terrain.sourceCache.getTerrainCoords(t,r);for(const t in i)this._coordsAscending[e][t]||(this._coordsAscending[e][t]=[]),this._coordsAscending[e][t].push(i[t])}}this._coordsAscendingStr={};for(const e of t._order){const i=t._layers[e],n=i.source;if(zo[i.type]&&!this._coordsAscendingStr[n]){this._coordsAscendingStr[n]={};for(const t in this._coordsAscending[n])this._coordsAscendingStr[n][t]=this._coordsAscending[n][t].map((t=>t.key)).sort().join()}}for(const t of this._renderableTiles)for(const e in this._coordsAscendingStr){const i=this._coordsAscendingStr[e][t.tileID.key];i&&i!==t.rttCoords[e]&&(t.rtt=[])}}renderLayer(t,i){if(t.isHidden(this.painter.transform.zoom))return!1;const n=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),r=t.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(zo[r]&&(this._prevType&&zo[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(t.id),!s))return!0;if(zo[this._prevType]||zo[r]&&s){this._prevType=r;const t=this._stacks.length-1,i=this._stacks[t]||[];for(const r of this._renderableTiles){if(this.pool.isFull()&&(br(this.painter,this.terrain,this._rttTiles,n),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(r),r.rtt[t]){const e=this.pool.getObjectForId(r.rtt[t].id);if(e.stamp===r.rtt[t].stamp){this.pool.useObject(e);continue}}const s=this.pool.getOrCreateFreeObject();this.pool.useObject(s),this.pool.stampObject(s),r.rtt[t]={id:s.id,stamp:s.stamp},o.context.bindFramebuffer.set(s.fbo.framebuffer),o.context.clear({color:e.b7.transparent,stencil:0}),o.currentStencilSource=void 0;for(let t=0;t<i.length;t++){const e=o.style._layers[i[t]],a=e.source?this._coordsAscending[e.source][r.tileID.key]:[r.tileID];o.context.viewport.set([0,0,s.fbo.width,s.fbo.height]),o._renderTileClippingMasks(e,a,!0),o.renderLayer(o,o.style.sourceCaches[e.source],e,a,n),e.source&&(r.rttCoords[e.source]=this._coordsAscendingStr[e.source][r.tileID.key])}}return br(this.painter,this.terrain,this._rttTiles,n),this._rttTiles=[],this.pool.freeAllObjects(),zo[r]}return!1}}const Ro={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Oo=i,Fo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Co,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:e.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},No={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Bo{constructor(t,i,n=!1){this.mousedown=t=>{this.startMove(t,a.mousePos(this.element,t)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=t=>{this.move(t,a.mousePos(this.element,t))},this.mouseup=t=>{this._rotatePitchHanlder.dragEnd(t),this.offTemp()},this.touchstart=t=>{1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,t.targetTouches)[0],this.startMove(t,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=t=>{1!==t.targetTouches.length?this.reset():(this._lastPos=a.touchPos(this.element,t.targetTouches)[0],this.move(t,this._lastPos))},this.touchend=t=>{0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const r=new Yr;this._rotatePitchHanlder=new Zr({clickTolerance:3,move:(t,r)=>{const o=i.getBoundingClientRect(),s=new e.P((o.bottom-o.top)/2,(o.right-o.left)/2);return{bearingDelta:e.ce(new e.P(t.x,r.y),r,s),pitchDelta:n?-.5*(r.y-t.y):void 0}},moveStateManager:r,enable:!0,assignEvents:()=>{}}),this.map=t,a.addEventListener(i,"mousedown",this.mousedown),a.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(i,"touchcancel",this.reset)}startMove(t,e){this._rotatePitchHanlder.dragStart(t,e),a.disableDrag()}move(t,e){const i=this.map,{bearingDelta:n,pitchDelta:r}=this._rotatePitchHanlder.dragMove(t,e)||{};n&&i.setBearing(i.getBearing()+n),r&&i.setPitch(i.getPitch()+r)}off(){const t=this.element;a.removeEventListener(t,"mousedown",this.mousedown),a.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let jo;function $o(t,i,n,r=!1){if(r||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return null==t?void 0:t.wrap();const o=new e.Q(t.lng,t.lat);if(t=new e.Q(t.lng,t.lat),i){const r=new e.Q(t.lng-360,t.lat),o=new e.Q(t.lng+360,t.lat),s=n.locationToScreenPoint(t).distSqr(i);n.locationToScreenPoint(r).distSqr(i)<s?t=r:n.locationToScreenPoint(o).distSqr(i)<s&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationToScreenPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t.lng!==o.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(t))?t:o}const Uo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vo(t,e,i){const n=t.classList;for(const t in Uo)n.remove(`maplibregl-${i}-anchor-${t}`);n.add(`maplibregl-${i}-anchor-${e}`)}class Go extends e.E{constructor(t){if(super(),this._onKeyPress=t=>{const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=t=>{const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},this._update=t=>{if(!this._map)return;const e=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==t?void 0:t.type)||"render"===(null==t?void 0:t.type)&&!e)&&this._map.once("render",this._update),this._lngLat=$o(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let i="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?i=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(i=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||t&&"moveend"!==t.type||(this._pos=this._pos.round()),a.setTransform(this._element,`${Uo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${n} ${i}`),s.frameAsync(new AbortController).then((()=>{this._updateOpacity(t&&"moveend"===t.type)})).catch((()=>{}))},this._onMove=t=>{if(!this._isDragging){const e=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.l("dragstart"))),this.fire(new e.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.l("dragend")),this._state="inactive"},this._addDragHandler=t=>{this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:this._rotationAlignment,this.setOpacity(null==t?void 0:t.opacity,null==t?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div");const i=a.createNS("http://www.w3.org/2000/svg","svg"),n=41,r=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${n}px`),i.setAttributeNS(null,"width",`${r}px`),i.setAttributeNS(null,"viewBox",`0 0 ${r} ${n}`);const o=a.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=a.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=a.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const t of c){const e=a.createNS("http://www.w3.org/2000/svg","ellipse");e.setAttributeNS(null,"opacity","0.04"),e.setAttributeNS(null,"cx","10.5"),e.setAttributeNS(null,"cy","5.80029008"),e.setAttributeNS(null,"rx",t.rx),e.setAttributeNS(null,"ry",t.ry),l.appendChild(e)}const u=a.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=a.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const p=a.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"opacity","0.25"),p.setAttributeNS(null,"fill","#000000");const d=a.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),p.appendChild(d);const f=a.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=a.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=a.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=a.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),s.appendChild(l),s.appendChild(u),s.appendChild(p),s.appendChild(f),s.appendChild(m),i.appendChild(s),i.setAttributeNS(null,"height",n*this._scale+"px"),i.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(i),this._offset=e.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()})),Vo(this._element,this._anchor,"marker"),t&&t.className)for(const e of t.className.split(" "))this._element.classList.add(e);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.Q.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.abs(i)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-13.5,-1*(e-i)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var i,n;const r=null===(i=this._map)||void 0===i?void 0:i.terrain,o=this._map.transform.isLocationOccluded(this._lngLat);if(!r||o){const t=o?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==t&&(this._element.style.opacity=t))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const s=this._map,a=s.terrain.depthAtPoint(this._pos),l=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,l)-a<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/s.transform.pixelsPerMeter,u=Math.sin(s.getPitch()*Math.PI/180)*c,h=s.terrain.depthAtPoint(new e.P(this._pos.x,this._pos.y-this._offset.y)),p=s.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(n=this._popup)||void 0===n?void 0:n.isOpen())&&p&&this._popup.remove(),this._element.style.opacity=p?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,e){return(void 0===this._opacity||void 0===t&&void 0===e)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==t&&(this._opacity=t),void 0!==e&&(this._opacityWhenCovered=e),this._map&&this._updateOpacity(!0),this}}const qo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zo=0,Wo=!1;const Ho={maxWidth:100,unit:"metric"};function Xo(t,e,i){const n=i&&i.maxWidth||100,r=t._container.clientHeight/2,o=t._container.clientWidth/2,s=t.unproject([o-n/2,r]),a=t.unproject([o+n/2,r]),l=Math.round(t.project(a).x-t.project(s).x),c=Math.min(n,l,t._container.clientWidth),u=s.distanceTo(a);if(i&&"imperial"===i.unit){const i=3.2808*u;i>5280?Yo(e,c,i/5280,t._getUIString("ScaleControl.Miles")):Yo(e,c,i,t._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Yo(e,c,u/1852,t._getUIString("ScaleControl.NauticalMiles")):u>=1e3?Yo(e,c,u/1e3,t._getUIString("ScaleControl.Kilometers")):Yo(e,c,u,t._getUIString("ScaleControl.Meters"))}function Yo(t,e,i,n){const r=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(i);t.style.width=e*(r/i)+"px",t.innerHTML=`${r}&nbsp;${n}`}const Ko={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Jo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qo(t){if(t){if("number"==typeof t){const i=Math.round(Math.abs(t)/Math.SQRT2);return{center:new e.P(0,0),top:new e.P(0,t),"top-left":new e.P(i,i),"top-right":new e.P(-i,i),bottom:new e.P(0,-t),"bottom-left":new e.P(i,-i),"bottom-right":new e.P(-i,-i),left:new e.P(t,0),right:new e.P(-t,0)}}if(t instanceof e.P||Array.isArray(t)){const i=e.P.convert(t);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.P.convert(t.center||[0,0]),top:e.P.convert(t.top||[0,0]),"top-left":e.P.convert(t["top-left"]||[0,0]),"top-right":e.P.convert(t["top-right"]||[0,0]),bottom:e.P.convert(t.bottom||[0,0]),"bottom-left":e.P.convert(t["bottom-left"]||[0,0]),"bottom-right":e.P.convert(t["bottom-right"]||[0,0]),left:e.P.convert(t.left||[0,0]),right:e.P.convert(t.right||[0,0])}}return Qo(new e.P(0,0))}const ts=i;t.AJAXError=e.cq,t.Event=e.l,t.Evented=e.E,t.LngLat=e.Q,t.MercatorCoordinate=e.$,t.Point=e.P,t.addProtocol=e.cr,t.config=e.a,t.removeProtocol=e.cs,t.AttributionControl=Eo,t.BoxZoomHandler=$r,t.CanvasSource=J,t.CooperativeGesturesHandler=vo,t.DoubleClickZoomHandler=po,t.DragPanHandler=go,t.DragRotateHandler=yo,t.EdgeInsets=Ie,t.FullscreenControl=class extends e.E{constructor(t={}){super(),this._onFullscreenChange=()=>{var t;let e=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.fullscreenElement;)e=e.shadowRoot.fullscreenElement;e===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const t=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new e.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new e.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},t.GeoJSONSource=X,t.GeolocateControl=class extends e.E{constructor(t){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new e.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const i=new e.Q(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),o=e.e({bearing:r},this.options.fitBoundsOptions),s=G.fromLngLat(i,n);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const i=new e.Q(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Wo)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new e.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Go({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Go({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new e.l("trackuserlocationend")),this.fire(new e.l("userlocationlostfocus")))}))}},this.options=e.e({},qo,t)}onAdd(t){return this._map=t,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return e._(this,arguments,void 0,(function*(t=!1){if(void 0!==jo&&!t)return jo;if(void 0===window.navigator.permissions)return jo=!!window.navigator.geolocation,jo;try{const t=yield window.navigator.permissions.query({name:"geolocation"});jo="denied"!==t.state}catch(t){jo=!!window.navigator.geolocation}return jo}))}().then((t=>this._finishSetupUI(t))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zo=0,Wo=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const t=this._map.getBounds(),e=t.getSouthEast(),i=t.getNorthEast(),n=e.distanceTo(i),r=Math.ceil(this._accuracy/(n/this._map._container.clientHeight)*2);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zo--,Wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new e.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.l("trackuserlocationstart")),this.fire(new e.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zo++,Zo>1?(t={maximumAge:6e5,timeout:0},Wo=!0):(t=this.options.positionOptions,Wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},t.GlobeControl=class{constructor(){this._toggleProjection=()=>{var t;const e=null===(t=this._map.getProjection())||void 0===t?void 0:t.type;this._map.setProjection("mercator"!==e&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var t;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(t=this._map.getProjection())||void 0===t?void 0:t.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(t){return this._map=t,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=a.create("button","maplibregl-ctrl-globe",this._container),a.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},t.Hash=Cr,t.ImageSource=Y,t.KeyboardHandler=lo,t.LngLatBounds=G,t.LogoControl=Io,t.Map=class extends So{constructor(t){var i,n;e.cn.mark(e.co.create);const r=Object.assign(Object.assign(Object.assign({},Fo),t),{canvasContextAttributes:Object.assign(Object.assign({},Fo.canvasContextAttributes),t.canvasContextAttributes)});if(null!=r.minZoom&&null!=r.maxZoom&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=r.minPitch&&null!=r.maxPitch&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=r.minPitch&&r.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=r.maxPitch&&r.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new De,s=new Ne;if(void 0!==r.minZoom&&o.setMinZoom(r.minZoom),void 0!==r.maxZoom&&o.setMaxZoom(r.maxZoom),void 0!==r.minPitch&&o.setMinPitch(r.minPitch),void 0!==r.maxPitch&&o.setMaxPitch(r.maxPitch),void 0!==r.renderWorldCopies&&o.setRenderWorldCopies(r.renderWorldCopies),super(o,s,{bearingSnap:r.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Mo,this._controls=[],this._mapId=e.a4(),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new e.l("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new e.l("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=r.interactive,this._maxTileCacheSize=r.maxTileCacheSize,this._maxTileCacheZoomLevels=r.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},r.canvasContextAttributes),this._trackResize=!0===r.trackResize,this._bearingSnap=r.bearingSnap,this._centerClampedToGround=r.centerClampedToGround,this._refreshExpiredTiles=!0===r.refreshExpiredTiles,this._fadeDuration=r.fadeDuration,this._crossSourceCollisions=!0===r.crossSourceCollisions,this._collectResourceTiming=!0===r.collectResourceTiming,this._locale=Object.assign(Object.assign({},Ro),r.locale),this._clickTolerance=r.clickTolerance,this._overridePixelRatio=r.pixelRatio,this._maxCanvasSize=r.maxCanvasSize,this.transformCameraUpdate=r.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===r.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl((()=>this.isMoving())),this._requestManager=new m(r.transformRequest),"string"==typeof r.container){if(this._container=document.getElementById(r.container),!this._container)throw new Error(`Container '${r.container}' not found.`)}else{if(!(r.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=r.container}if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let t=!1;const e=Sr((t=>{this._trackResize&&!this._removed&&(this.resize(t),this.redraw())}),50);this._resizeObserver=new ResizeObserver((i=>{t?e(i):t=!0})),this._resizeObserver.observe(this._container)}this.handlers=new To(this,r),this._hash=r.hash&&new Cr("string"==typeof r.hash&&r.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:r.center,elevation:r.elevation,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,roll:r.roll}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,e.e({},r.fitBoundsOptions,{duration:0}))));const a="string"==typeof r.style||!("globe"===(null===(n=null===(i=r.style)||void 0===i?void 0:i.projection)||void 0===n?void 0:n.type));this.resize(null,a),this._localIdeographFontFamily=r.localIdeographFontFamily,this._validateStyle=r.validateStyle,r.style&&this.setStyle(r.style,{localIdeographFontFamily:r.localIdeographFontFamily}),r.attributionControl&&this.addControl(new Eo("boolean"==typeof r.attributionControl?void 0:r.attributionControl)),r.maplibreLogo&&this.addControl(new Io,r.logoPosition),this.on("style.load",(()=>{if(a||this._resizeTransform(),this.transform.unmodified){const t=e.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(t)}})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.l(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.l(`${t.dataType}dataloading`,t))})),this.on("dataabort",(t=>{this.fire(new e.l("sourcedataabort",t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}calculateCameraOptionsFromTo(t,e,i,n){return null==n&&this.terrain&&(n=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(t,e,i,n)}resize(t,i=!0){const[n,r]=this._containerDimensions(),o=this._getClampedPixelRatio(n,r);if(this._resizeCanvas(n,r,o),this.painter.resize(n,r,o),this.painter.overLimit()){const t=this.painter.context.gl;this._maxCanvasSize=[t.drawingBufferWidth,t.drawingBufferHeight];const e=this._getClampedPixelRatio(n,r);this._resizeCanvas(n,r,e),this.painter.resize(n,r,e)}this._resizeTransform(i);const s=!this._moving;return s&&(this.stop(),this.fire(new e.l("movestart",t)).fire(new e.l("move",t))),this.fire(new e.l("resize",t)),s&&this.fire(new e.l("moveend",t)),this}_resizeTransform(t=!0){var e;const[i,n]=this._containerDimensions();this.transform.resize(i,n,t),null===(e=this._requestedCameraState)||void 0===e||e.resize(i,n,t)}_getClampedPixelRatio(t,e){const{0:i,1:n}=this._maxCanvasSize,r=this.getPixelRatio(),o=t*r,s=e*r;return Math.min(o>i?i/o:1,s>n?n/s:1)*r}getPixelRatio(){var t;return null!==(t=this._overridePixelRatio)&&void 0!==t?t:devicePixelRatio}setPixelRatio(t){this._overridePixelRatio=t,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(G.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.setMinZoom(t),this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.setMaxZoom(t),this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.setMinPitch(t),this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?60:t)>180)throw new Error("maxPitch must be less than or equal to 180");if(t>=this.transform.minPitch)return this.transform.setMaxPitch(t),this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.setRenderWorldCopies(t),this._update()}project(t){return this.transform.locationToScreenPoint(e.Q.convert(t),this.style&&this.terrain)}unproject(t){return this.transform.screenPointToLocation(e.P.convert(t),this.terrain)}isMoving(){var t;return this._moving||(null===(t=this.handlers)||void 0===t?void 0:t.isMoving())}isZooming(){var t;return this._zooming||(null===(t=this.handlers)||void 0===t?void 0:t.isZooming())}isRotating(){var t;return this._rotating||(null===(t=this.handlers)||void 0===t?void 0:t.isRotating())}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t))),s=0!==o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?n||(n=!0,i.call(this,new Rr(t,this,r.originalEvent,{features:s}))):n=!1};return{layers:e,listener:i,delegates:{mousemove:r,mouseout:()=>{n=!1}}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const r=r=>{const o=e.filter((t=>this.getLayer(t)));(0!==o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new Rr(t,this,r.originalEvent)))},o=e=>{n&&(n=!1,i.call(this,new Rr(t,this,e.originalEvent)))};return{layers:e,listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=t=>{const n=e.filter((t=>this.getLayer(t))),r=0!==n.length?this.queryRenderedFeatures(t.point,{layers:n}):[];r.length&&(t.features=r,i.call(this,t),delete t.features)};return{layers:e,listener:i,delegates:{[t]:n}}}}_saveDelegatedListener(t,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(e)}_removeDelegatedListener(t,e,i){if(!this._delegatedListeners||!this._delegatedListeners[t])return;const n=this._delegatedListeners[t];for(let t=0;t<n.length;t++){const r=n[t];if(r.listener===i&&r.layers.length===e.length&&r.layers.every((t=>e.includes(t)))){for(const t in r.delegates)this.off(t,r.delegates[t]);return void n.splice(t,1)}}}on(t,e,i){if(void 0===i)return super.on(t,e);const n="string"==typeof e?[e]:e,r=this._createDelegatedListener(t,n,i);this._saveDelegatedListener(t,r);for(const t in r.delegates)this.on(t,r.delegates[t]);return{unsubscribe:()=>{this._removeDelegatedListener(t,n,i)}}}once(t,e,i){if(void 0===i)return super.once(t,e);const n="string"==typeof e?[e]:e,r=this._createDelegatedListener(t,n,i);for(const e in r.delegates){const o=r.delegates[e];r.delegates[e]=(...e)=>{this._removeDelegatedListener(t,n,i),o(...e)}}this._saveDelegatedListener(t,r);for(const t in r.delegates)this.once(t,r.delegates[t]);return this}off(t,e,i){return void 0===i?super.off(t,e):(this._removeDelegatedListener(t,"string"==typeof e?[e]:e,i),this)}queryRenderedFeatures(t,i){if(!this.style)return[];let n;const r=t instanceof e.P||Array.isArray(t),o=r?t:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(r?{}:t)||{},o instanceof e.P||"number"==typeof o[0])n=[e.P.convert(o)];else{const t=e.P.convert(o[0]),i=e.P.convert(o[1]);n=[t,new e.P(i.x,t.y),i,new e.P(t.x,i.y),t]}return this.style.queryRenderedFeatures(n,i,this.transform)}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}setStyle(t,i){return!1!==(i=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(t,i))}setTransformRequest(t){return this._requestManager.setTransformRequest(t),this}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){var i,n;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(t,e)));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!t)),t?(this.style=new xi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t,e,r):this.style.loadJSON(t,e,r),this):(null===(n=null===(i=this.style)||void 0===i?void 0:i.projection)||void 0===n||n.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.transformRequest(t,"Style");e.j(n,new AbortController).then((t=>{this._updateDiff(t.data,i)})).catch((t=>{t&&this.fire(new e.k(t))}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t,i)&&this._update(!0)}catch(n){e.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():e.w("There is no style added to the map.")}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){const i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.k(new Error(`There is no source with ID '${t}'`)))}setTerrain(t){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),t){const i=this.style.sourceCaches[t.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);null===this.terrain&&i.reload();for(const i in this.style._layers){const n=this.style._layers[i];"hillshade"===n.type&&n.source===t.source&&e.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Po(this.painter,i,t),this.painter.renderToTexture=new Do(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=e=>{var i;"style"===e.dataType?this.terrain.sourceCache.freeRtt():"source"===e.dataType&&e.tile&&(e.sourceId!==t.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(i=e.source)||void 0===i?void 0:i.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(e.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new e.l("terrain",{terrain:t})),this}getTerrain(){var t,e;return null!==(e=null===(t=this.terrain)||void 0===t?void 0:t.options)&&void 0!==e?e:null}areTilesLoaded(){const t=this.style&&this.style.sourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}removeSource(t){return this.style.removeSource(t),this._update(!0)}getSource(t){return this.style.getSource(t)}setSourceTileLodParams(t,e,i){if(i){const n=this.getSource(i);if(!n)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);n.calculateTileZoom=gt(Math.max(1,t),Math.max(1,e))}else for(const i in this.style.sourceCaches)this.style.sourceCaches[i].getSource().calculateTileZoom=gt(Math.max(1,t),Math.max(1,e));return this._update(!0),this}refreshTiles(t,i){const n=this.style.sourceCaches[t];if(!n)throw new Error(`There is no source cache with ID "${t}", cannot refresh tile`);void 0===i?n.reload():n.refreshTiles(i.map((t=>new e.a1(t.z,t.x,t.y))))}addImage(t,i,n={}){const{pixelRatio:r=1,sdf:o=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=n;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||e.b(i))){if(void 0===i.width||void 0===i.height)return this.fire(new e.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:n,height:s,data:p}=i,d=i;return this.style.addImage(t,{data:new e.R({width:n,height:s},new Uint8Array(p)),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t),this}}{const{width:n,height:p,data:d}=s.getImageData(i);this.style.addImage(t,{data:new e.R({width:n,height:p},d),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0})}}updateImage(t,i){const n=this.style.getImage(t);if(!n)return this.fire(new e.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof HTMLImageElement||e.b(i)?s.getImageData(i):i,{width:o,height:a,data:l}=r;if(void 0===o||void 0===a)return this.fire(new e.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==n.data.width||a!==n.data.height)return this.fire(new e.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(i instanceof HTMLImageElement||e.b(i));return n.data.replace(l,c),this.style.updateImage(t,n),this}getImage(t){return this.style.getImage(t)}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.k(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t){return f.getImage(this._requestManager.transformRequest(t,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0)}setFilter(t,e,i={}){return this.style.setFilter(t,e,i),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,i,n={}){return this.style.setPaintProperty(t,e,i,n),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,i,n={}){return this.style.setLayoutProperty(t,e,i,n),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setGlyphs(t,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(t,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(t,e,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(t,e,i,(t=>{t||this._update(!0)})),this}removeSprite(t){return this._lazyInitEmptyStyle(),this.style.removeSprite(t),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(t,e,(t=>{t||this._update(!0)})),this}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(t,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(t,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("maplibregl-map");const e=this._canvasContainer=a.create("div","maplibregl-canvas-container",t);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),n=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],n);const r=this._controlContainer=a.create("div","maplibregl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{o[t]=a.create("div",`maplibregl-ctrl-${t} `,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e,i){this._canvas.width=Math.floor(i*t),this._canvas.height=Math.floor(i*e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const t=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{e={requestedAttributes:t},i&&(e.statusMessage=i.statusMessage,e.type=i.type)}),{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,t):this._canvas.getContext("webgl2",t)||this._canvas.getContext("webgl",t),!i){const t="Failed to initialize WebGL";throw e?(e.message=t,new Error(JSON.stringify(e))):new Error(t)}this.painter=new Tr(i,this.transform),l.testSupport(i)}migrateProjection(t,i){super.migrateProjection(t,i),this.painter.transform=t,this.fire(new e.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){var i,n,r,o,a;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=s.now();this.style.zoomHistory.update(t,i);const n=new e.C(t,{now:i,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=n.crossFadingFactor();1===r&&r===this._crossFadingFactor||(u=!0,this._crossFadingFactor=r),this.style.update(n)}const h=(null===(n=this.style.projection)||void 0===n?void 0:n.transitionState)>0!==c;null===(r=this.style.projection)||void 0===r||r.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState,null===(a=this.style.projection)||void 0===a?void 0:a.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new e.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,e.cn.mark(e.co.load),this.fire(new e.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new e.l("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,e.cn.mark(e.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var t;this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(t=this._resizeObserver)||void 0===t||t.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==i?void 0:i.loseContext)&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),e.cn.clearMetrics(),this._removed=!0,this.fire(new e.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,s.frame(this._frameRequest,(t=>{e.cn.frame(t),this._frameRequest=null;try{this._render(t)}catch(t){if(!e.cp(t)&&!function(t){return t.message===Vn}(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get version(){return Oo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(t){return this._lazyInitEmptyStyle(),this.style.setProjection(t),this._update(!0)}},t.MapMouseEvent=Rr,t.MapTouchEvent=Or,t.MapWheelEvent=Fr,t.Marker=Go,t.NavigationControl=class{constructor(t){this._updateZoomButtons=()=>{const t=this._map.getZoom(),e=t===this._map.getMaxZoom(),i=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,e)=>{const i=this._map._getUIString(`NavigationControl.${e}`);t.title=i,t.setAttribute("aria-label",i)},this.options=e.e({},No,t),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(t,e){const i=a.create("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}},t.Popup=class extends e.E{constructor(t){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new e.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const t of this.options.className.split(" "))this._container.classList.add(t);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=$o(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const e=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let i=this.options.anchor;const n=Qo(this.options.offset);if(!i){const t=this._container.offsetWidth,r=this._container.offsetHeight;let o;o=e.y+n.bottom.y<r?["top"]:e.y>this._map.transform.height-r?["bottom"]:[],e.x<t/2?o.push("left"):e.x>this._map.transform.width-t/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}let r=e.add(n[i]);this.options.subpixelPositioning||(r=r.round()),a.setTransform(this._container,`${Uo[i]} translate(${r.x}px,${r.y}px)`),Vo(this._container,i,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=e.e(Object.create(Ko),t)}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new e.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.Q.convert(t),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=t;n=i.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){var t;return null===(t=this._container)||void 0===t?void 0:t.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(t){return this._container&&this._container.classList.add(t),this}removeClassName(t){return this._container&&this._container.classList.remove(t),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){if(this._container)return this._container.classList.toggle(t)}setSubpixelPositioning(t){this.options.subpixelPositioning=t}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(Jo);t&&t.focus()}},t.RasterDEMTileSource=H,t.RasterTileSource=W,t.ScaleControl=class{constructor(t){this._onMove=()=>{Xo(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Xo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ho),t)}getDefaultPosition(){return"bottom-left"}onAdd(t){return this._map=t,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},t.ScrollZoomHandler=ho,t.Style=xi,t.TerrainControl=class{constructor(t){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=t}onAdd(t){return this._map=t,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},t.TwoFingersTouchPitchHandler=so,t.TwoFingersTouchRotateHandler=ro,t.TwoFingersTouchZoomHandler=io,t.TwoFingersTouchZoomRotateHandler=_o,t.VectorTileSource=Z,t.VideoSource=K,t.addSourceType=(t,i)=>e._(void 0,void 0,void 0,(function*(){if(tt(t))throw new Error(`A source type called "${t}" already exists.`);((t,e)=>{Q[t]=e})(t,i)})),t.clearPrewarmedResources=function(){const t=D;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(P),D=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.createTileMesh=Xe,t.getMaxParallelImageRequests=function(){return e.a.MAX_PARALLEL_IMAGE_REQUESTS},t.getRTLTextPluginStatus=function(){return rt().getRTLTextPluginStatus()},t.getVersion=function(){return ts},t.getWorkerCount=function(){return L.workerCount},t.getWorkerUrl=function(){return e.a.WORKER_URL},t.importScriptInWorkers=function(t){return N().broadcast("IS",t)},t.prewarm=function(){O().acquire(P)},t.setMaxParallelImageRequests=function(t){e.a.MAX_PARALLEL_IMAGE_REQUESTS=t},t.setRTLTextPlugin=function(t,e){return rt().setRTLTextPlugin(t,e)},t.setWorkerCount=function(t){L.workerCount=t},t.setWorkerUrl=function(t){e.a.WORKER_URL=t}})),t}()),xe=e({__proto__:null,default:ve},[_e.exports]),be={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carrée projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0° is directly above, at zenith, and 90° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0° is directly above, at zenith, and 90° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},we="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Te(t){var e={exports:{}};return t(e,e.exports),e.exports}function Se(t,e){return Object.prototype.hasOwnProperty.call(t,e)}
/*! https://mths.be/punycode v1.3.2 by @mathias */
Te((function(t,e){!function(i){var n=e&&!e.nodeType&&e,r=t&&!t.nodeType&&t,o="object"==typeof we&&we;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var s,a,l=2147483647,c=36,u=/^xn--/,h=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(t){throw RangeError(d[t])}function y(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function _(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+y((t=t.replace(p,".")).split("."),e).join(".")}function v(t){for(var e,i,n=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(i=t.charCodeAt(r++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),r--):n.push(e);return n}function x(t){return y(t,(function(t){var e="";return t>65535&&(e+=m((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=m(t)})).join("")}function b(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function w(t,e,i){var n=0;for(t=i?f(t/700):t>>1,t+=f(t/e);t>455;n+=c)t=f(t/35);return f(n+36*t/(t+38))}function T(t){var e,i,n,r,o,s,a,u,h,p,d,m=[],y=t.length,_=0,v=128,b=72;for((i=t.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&g("not-basic"),m.push(t.charCodeAt(n));for(r=i>0?i+1:0;r<y;){for(o=_,s=1,a=c;r>=y&&g("invalid-input"),((u=(d=t.charCodeAt(r++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:c)>=c||u>f((l-_)/s))&&g("overflow"),_+=u*s,!(u<(h=a<=b?1:a>=b+26?26:a-b));a+=c)s>f(l/(p=c-h))&&g("overflow"),s*=p;b=w(_-o,e=m.length+1,0==o),f(_/e)>l-v&&g("overflow"),v+=f(_/e),_%=e,m.splice(_++,0,v)}return x(m)}function S(t){var e,i,n,r,o,s,a,u,h,p,d,y,_,x,T,S=[];for(y=(t=v(t)).length,e=128,i=0,o=72,s=0;s<y;++s)(d=t[s])<128&&S.push(m(d));for(n=r=S.length,r&&S.push("-");n<y;){for(a=l,s=0;s<y;++s)(d=t[s])>=e&&d<a&&(a=d);for(a-e>f((l-i)/(_=n+1))&&g("overflow"),i+=(a-e)*_,e=a,s=0;s<y;++s)if((d=t[s])<e&&++i>l&&g("overflow"),d==e){for(u=i,h=c;!(u<(p=h<=o?1:h>=o+26?26:h-o));h+=c)T=u-p,x=c-p,S.push(m(b(p+T%x,0))),u=f(T/x);S.push(m(b(u,0))),o=w(i,_,n==r),i=0,++n}++i,++e}return S.join("")}if(s={version:"1.3.2",ucs2:{decode:v,encode:x},decode:T,encode:S,toASCII:function(t){return _(t,(function(t){return h.test(t)?"xn--"+S(t):t}))},toUnicode:function(t){return _(t,(function(t){return u.test(t)?T(t.slice(4).toLowerCase()):t}))}},n&&r)if(t.exports==n)r.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else i.punycode=s}(we)}));var Ce=function(t,e,i,n){e=e||"&",i=i||"=";var r={};if("string"!=typeof t||0===t.length)return r;var o=/\+/g;t=t.split(e);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=t.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var c,u,h,p,d=t[l].replace(o,"%20"),f=d.indexOf(i);f>=0?(c=d.substr(0,f),u=d.substr(f+1)):(c=d,u=""),h=decodeURIComponent(c),p=decodeURIComponent(u),Se(r,h)?Array.isArray(r[h])?r[h].push(p):r[h]=[r[h],p]:r[h]=p}return r},Ee=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}},Ie=function(t,e,i,n){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(n){var r=encodeURIComponent(Ee(n))+i;return Array.isArray(t[n])?t[n].map((function(t){return r+encodeURIComponent(Ee(t))})).join(e):r+encodeURIComponent(Ee(t[n]))})).join(e):n?encodeURIComponent(Ee(n))+i+encodeURIComponent(Ee(t)):""};function Me(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}Te((function(t,e){e.decode=e.parse=Ce,e.encode=e.stringify=Ie}));class Ae extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class ke{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new ke(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Pe={kind:"null"},Le={kind:"number"},ze={kind:"string"},De={kind:"boolean"},Re={kind:"color"},Oe={kind:"object"},Fe={kind:"value"},Ne={kind:"collator"},Be={kind:"formatted"},je={kind:"resolvedImage"};function $e(t,e){return{kind:"array",itemType:t,N:e}}function Ue(t){if("array"===t.kind){const e=Ue(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Ve=[Pe,Le,ze,De,Re,Be,Oe,$e(Fe),je];function Ge(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ge(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Ve)if(!Ge(t,e))return null}return`Expected ${Ue(t)} but found ${Ue(e)} instead.`}function qe(t,e){return e.some((e=>e.kind===t.kind))}function Ze(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}var We=Te((function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100*255):n(parseInt(t))}function s(t){return"%"===t[t.length-1]?r(parseFloat(t)/100):r(parseFloat(t))}function a(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{e.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=r.indexOf("("),c=r.indexOf(")");if(-1!==l&&c+1===r.length){var u=r.substr(0,l),h=r.substr(l+1,c-(l+1)).split(","),p=1;switch(u){case"rgba":if(4!==h.length)return null;p=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=s(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[n(255*a(y,g,d+1/3)),n(255*a(y,g,d)),n(255*a(y,g,d-1/3)),p];default:return null}}return null}}catch(t){}}));class He{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(t){if(!t)return;if(t instanceof He)return t;if("string"!=typeof t)return;const e=We.parseCSSColor(t);return e?new He(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,i,n]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}}He.black=new He(0,0,0,1),He.white=new He(1,1,1,1),He.transparent=new He(0,0,0,0),He.red=new He(1,0,0,1),He.blue=new He(0,0,1,1);class Xe{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ye{constructor(t,e,i,n,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=r}}class Ke{constructor(t){this.sections=t}static fromString(t){return new Ke([new Ye(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Ke?t:Ke.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(i)}return t}}class Je{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Je({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Qe(t,e,i,n){if(!("number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255)){return`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`}function ti(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof He)return!0;if(t instanceof Xe)return!0;if(t instanceof Ke)return!0;if(t instanceof Je)return!0;if(Array.isArray(t)){for(const e of t)if(!ti(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ti(t[e]))return!1;return!0}return!1}function ei(t){if(null===t)return Pe;if("string"==typeof t)return ze;if("boolean"==typeof t)return De;if("number"==typeof t)return Le;if(t instanceof He)return Re;if(t instanceof Xe)return Ne;if(t instanceof Ke)return Be;if(t instanceof Je)return je;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=ei(e);if(i){if(i===t)continue;i=Fe;break}i=t}return $e(i||Fe,e)}return Oe}function ii(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof He||t instanceof Ke||t instanceof Je?t.toString():JSON.stringify(t)}class ni{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ti(t[1]))return e.error("invalid value");const i=t[1];let n=ei(i);const r=e.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new ni(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof He?["rgba"].concat(this.value.toArray()):this.value instanceof Ke?this.value.serialize():this.value}}class ri{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const oi={string:ze,number:Le,boolean:De,object:Oe};class si{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const r=t[0];if("array"===r){let r,o;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in oi)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=oi[i],n++}else r=Fe;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}i=$e(r,o)}else i=oi[r];const o=[];for(;n<t.length;n++){const i=e.parse(t[n],n,Fe);if(!i)return null;o.push(i)}return new si(i,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!Ge(this.type,ei(i)))return i;if(e===this.args.length-1)throw new ri(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(ei(i))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}class ai{constructor(t){this.type=Be,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=t.length-1;++i){const o=t[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let t=null;if(o["font-scale"]&&(t=e.parse(o["font-scale"],1,Le),!t))return null;let i=null;if(o["text-font"]&&(i=e.parse(o["text-font"],1,$e(ze)),!i))return null;let s=null;if(o["text-color"]&&(s=e.parse(o["text-color"],1,Re),!s))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=s}else{const o=e.parse(t[i],1,Fe);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new ai(n)}evaluate(t){return new Ke(this.sections.map((e=>{const i=e.content.evaluate(t);return ei(i)===je?new Ye("",i,null,null,null):new Ye(ii(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class li{constructor(t){this.type=je,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ze);return i?new li(i):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),i=Je.fromString(e);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(e)>-1),i}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ci={"to-boolean":De,"to-color":Re,"to-number":Le,"to-string":ze};class ui{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0];if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");const n=ci[i],r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],i,Fe);if(!n)return null;r.push(n)}return new ui(n,r)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof He)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Qe(e[0],e[1],e[2],e[3]),!i))return new He(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ri(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new ri(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Ke.fromString(ii(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Je.fromString(ii(this.args[0].evaluate(t))):ii(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new ai([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new li(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const hi=["Unknown","Point","LineString","Polygon"];class pi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?hi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord,r=i*e-t[0],o=n*e-t[1];return this.featureDistanceData.bearing[0]*r+this.featureDistanceData.bearing[1]*o}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=He.parse(t)),e}}class di{constructor(t,e,i,n){this.name=t,this.type=e,this._evaluate=i,this.args=n}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=di.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let a=null;for(const[n,o]of s){a=new Oi(e.registry,e.path,null,e.scope);const s=[];let l=!1;for(let e=1;e<t.length;e++){const i=t[e],r=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=s[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new di(i,r,o,s)}}if(1===s.length)e.errors.push(...a.errors);else{const i=(s.length?s:o).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Ue).join(", ")})`:`(${Ue(e.type)}...)`;var e})).join(" | "),n=[];for(let i=1;i<t.length;i++){const r=e.parse(t[i],1+n.length);if(!r)return null;n.push(Ue(r.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){di.definitions=e;for(const i in e)t[i]=di}}class fi{constructor(t,e,i){this.type=Ne,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,De);if(!n)return null;const r=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,De);if(!r)return null;let o=null;return i.locale&&(o=e.parse(i.locale,1,ze),!o)?null:new fi(n,r,o)}evaluate(t){return new Xe(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function mi(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function gi(t,e){return!(t[0]<=e[0])&&(!(t[2]>=e[2])&&(!(t[1]<=e[1])&&!(t[3]>=e[3])))}function yi(t,e){const i=(180+t[0])/360;const n=(r=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360);var r;const o=Math.pow(2,e.z);return[Math.round(i*o*8192),Math.round(n*o*8192)]}function _i(t,e,i){const n=t[0]-e[0],r=t[1]-e[1],o=t[0]-i[0],s=t[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function vi(t,e){let i=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(_i(t,a[e],a[e+1]))return!1;n=t,r=a[e],o=a[e+1],r[1]>n[1]!=o[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function xi(t,e){for(let i=0;i<e.length;i++)if(vi(t,e[i]))return!0;return!1}function bi(t,e,i,n){const r=t[0]-i[0],o=t[1]-i[1],s=e[0]-i[0],a=e[1]-i[1],l=n[0]-i[0],c=n[1]-i[1],u=r*c-l*o,h=s*c-l*a;return u>0&&h<0||u<0&&h>0}function wi(t,e,i,n){const r=[e[0]-t[0],e[1]-t[1]],o=[n[0]-i[0],n[1]-i[1]];return 0!=(s=o)[0]*(a=r)[1]-s[1]*a[0]&&!(!bi(t,e,i,n)||!bi(i,n,t,e));var s,a}function Ti(t,e,i){for(const n of i)for(let i=0;i<n.length-1;++i)if(wi(t,e,n[i],n[i+1]))return!0;return!1}function Si(t,e){for(let i=0;i<t.length;++i)if(!vi(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ti(t[i],t[i+1],e))return!1;return!0}function Ci(t,e){for(let i=0;i<e.length;i++)if(Si(t,e[i]))return!0;return!1}function Ei(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=[];for(let n=0;n<t[r].length;n++){const s=yi(t[r][n],i);mi(e,s),o.push(s)}n.push(o)}return n}function Ii(t,e,i){const n=[];for(let r=0;r<t.length;r++){const o=Ei(t[r],e,i);n.push(o)}return n}function Mi(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let r=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===r&&(r=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=r}mi(e,t)}function Ai(t,e,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!t)return s;for(const n of t)for(const t of n){const n=[t.x+o[0],t.y+o[1]];Mi(n,e,i,r),s.push(n)}return s}function ki(t,e,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!t)return s;for(const i of t){const t=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];mi(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){!function(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}(e);for(const t of s)for(const n of t)Mi(n,e,i,r)}return s}class Pi{constructor(t,e){this.type=De,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ti(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Pi(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Pi(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Pi(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=Ei(e.coordinates,n,r),s=Ai(t.geometry(),i,n,r);if(!gi(i,n))return!1;for(const t of s)if(!vi(t,o))return!1}if("MultiPolygon"===e.type){const o=Ii(e.coordinates,n,r),s=Ai(t.geometry(),i,n,r);if(!gi(i,n))return!1;for(const t of s)if(!xi(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=Ei(e.coordinates,n,r),s=ki(t.geometry(),i,n,r);if(!gi(i,n))return!1;for(const t of s)if(!Si(t,o))return!1}if("MultiPolygon"===e.type){const o=Ii(e.coordinates,n,r),s=ki(t.geometry(),i,n,r);if(!gi(i,n))return!1;for(const t of s)if(!Ci(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Li(t){if(t instanceof di){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Pi)return!1;let e=!0;return t.eachChild((t=>{e&&!Li(t)&&(e=!1)})),e}function zi(t){if(t instanceof di&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!zi(t)&&(e=!1)})),e}function Di(t,e){if(t instanceof di&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Di(t,e)&&(i=!1)})),i}class Ri{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Ri(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Oi{constructor(t,e=[],i,n=new ke,r=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(t,e,i,n,r={}){return e?this.concat(e,i,n)._parse(t,r):this._parse(t,r)}_parse(t,e){function i(t,e,i){return"assert"===i?new si(e,[t]):"coerce"===i?new ui(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=t[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(t,this);if(!n)return null;if(this.expectedType){const t=this.expectedType,r=n.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==r.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(t,r))return null}else n=i(n,t,e.typeAnnotation||"coerce");else n=i(n,t,e.typeAnnotation||"assert")}if(!(n instanceof ni)&&"resolvedImage"!==n.type.kind&&Fi(n)){const t=new pi;try{n=new ni(n.type,n.evaluate(t))}catch(t){return this.error(t.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,r=i?this.scope.concat(i):this.scope;return new Oi(this.registry,n,e||null,r,this.errors)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Ae(i,t))}checkSubtype(t,e){const i=Ge(t,e);return i&&this.error(i),i}}function Fi(t){if(t instanceof Ri)return Fi(t.boundExpression);if(t instanceof di&&"error"===t.name)return!1;if(t instanceof fi)return!1;if(t instanceof Pi)return!1;const e=t instanceof ui||t instanceof si;let i=!0;return t.eachChild((t=>{i=e?i&&Fi(t):i&&t instanceof ni})),!!i&&(Li(t)&&Di(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function Ni(t,e){const i=t.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=t[a],r=t[a+1],n<=e){if(a===i||e<r)return a;o=a+1}else{if(!(n>e))throw new ri("Input is not a number.");s=a-1}return 0}class Bi{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,Le);if(!i)return null;const n=[];let r=null;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(let i=1;i<t.length;i+=2){const o=1===i?-1/0:t[i],s=t[i+1],a=i,l=i+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Bi(r,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);return i[Ni(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var ji=$i;function $i(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}function Ui(t,e,i){return t*(1-i)+e*i}$i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},$i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},$i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},$i.prototype.solveCurveX=function(t,e){var i,n,r,o,s;for(void 0===e&&(e=1e-6),r=t,s=0;s<8;s++){if(o=this.sampleCurveX(r)-t,Math.abs(o)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=t)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-t)<e)return r;t>o?i=r:n=r,r=.5*(n-i)+i}return r},$i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var Vi=Object.freeze({__proto__:null,number:Ui,color:function(t,e,i){return new He(Ui(t.r,e.r,i),Ui(t.g,e.g,i),Ui(t.b,e.b,i),Ui(t.a,e.a,i))},array:function(t,e,i){return t.map(((t,n)=>Ui(t,e[n],i)))}});const Gi=4/29,qi=6/29,Zi=3*qi*qi,Wi=Math.PI/180,Hi=180/Math.PI;function Xi(t){return t>.008856451679035631?Math.pow(t,1/3):t/Zi+Gi}function Yi(t){return t>qi?t*t*t:Zi*(t-Gi)}function Ki(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ji(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qi(t){const e=Ji(t.r),i=Ji(t.g),n=Ji(t.b),r=Xi((.4124564*e+.3575761*i+.1804375*n)/.95047),o=Xi((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Xi((.0193339*e+.119192*i+.9503041*n)/1.08883)),alpha:t.a}}function tn(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Yi(e),i=.95047*Yi(i),n=1.08883*Yi(n),new He(Ki(3.2404542*i-1.5371385*e-.4985314*n),Ki(-.969266*i+1.8760108*e+.041556*n),Ki(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function en(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const nn={forward:Qi,reverse:tn,interpolate:function(t,e,i){return{l:Ui(t.l,e.l,i),a:Ui(t.a,e.a,i),b:Ui(t.b,e.b,i),alpha:Ui(t.alpha,e.alpha,i)}}},rn={forward:function(t){const{l:e,a:i,b:n}=Qi(t),r=Math.atan2(n,i)*Hi;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Wi,i=t.c;return tn({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:en(t.h,e.h,i),c:Ui(t.c,e.c,i),l:Ui(t.l,e.l,i),alpha:Ui(t.alpha,e.alpha,i)}}};class on{constructor(t,e,i,n,r){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let r=0;if("exponential"===t.name)r=sn(e,t.base,i,n);else if("linear"===t.name)r=sn(e,1,i,n);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new ji(o[0],o[1],o[2],o[3]).solve(sn(e,1,i,n))}return r}static parse(t,e){let[i,n,r,...o]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(r=e.parse(r,2,Le),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Re:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<o.length;t+=2){const i=o[t],n=o[t+1],r=t+3,l=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=e.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new on(a,i,n,r,s):e.error(`Type ${Ue(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const r=e.length;if(n>=e[r-1])return i[r-1].evaluate(t);const o=Ni(e,n),s=e[o],a=e[o+1],l=on.interpolationFactor(this.interpolation,n,s,a),c=i[o].evaluate(t),u=i[o+1].evaluate(t);return"interpolate"===this.operator?Vi[this.type.kind.toLowerCase()](c,u,l):"interpolate-hcl"===this.operator?rn.reverse(rn.interpolate(rn.forward(c),rn.forward(u),l)):nn.reverse(nn.interpolate(nn.forward(c),nn.forward(u),l))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function sn(t,e,i,n){const r=n-i,o=t-i;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}class an{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of t.slice(1)){const t=e.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,r.push(t)}const o=n&&r.some((t=>Ge(n,t.type)));return new an(o?Fe:i,r)}evaluate(t){let e,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(t),i&&i instanceof Je&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class ln{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const r=t[n];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=e.parse(t[n+1],n+1);if(!o)return null;i.push([r,o])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new ln(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}class cn{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Le),n=e.parse(t[2],2,$e(e.expectedType||Fe));if(!i||!n)return null;const r=n.type;return new cn(r.itemType,i,n)}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new ri(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new ri(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new ri(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class un{constructor(t,e){this.type=De,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Fe),n=e.parse(t[2],2,Fe);return i&&n?qe(i.type,[De,ze,Le,Pe,Fe])?new un(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!Ze(e,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(ei(e))} instead.`);if(!Ze(i,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${Ue(ei(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hn{constructor(t,e,i){this.type=Le,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Fe),n=e.parse(t[2],2,Fe);if(!i||!n)return null;if(!qe(i.type,[De,ze,Le,Pe,Fe]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Le);return r?new hn(i,n,r):null}return new hn(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!Ze(e,["boolean","string","number","null"]))throw new ri(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(ei(e))} instead.`);if(!Ze(i,["string","array"]))throw new ri(`Expected second argument to be of type array or string, but found ${Ue(ei(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class pn{constructor(t,e,i,n,r,o){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r={},o=[];for(let s=2;s<t.length-1;s+=2){let a=t[s];const l=t[s+1];Array.isArray(a)||(a=[a]);const c=e.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ei(t)))return null}else i=ei(t);if(void 0!==r[String(t)])return c.error("Branch labels must be unique.");r[String(t)]=o.length}const u=e.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=e.parse(t[1],1,Fe);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(i,s.type)?null:new pn(i,n,s,r,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(ei(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)1===n.length?t.push(r(n[0])):t.push(n.map(r)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class dn{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let r=1;r<t.length-1;r+=2){const o=e.parse(t[r],r,De);if(!o)return null;const s=e.parse(t[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=e.parse(t[t.length-1],t.length-1,i);return r?new dn(i,n,r):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class fn{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,Fe),n=e.parse(t[2],2,Le);if(!i||!n)return null;if(!qe(i.type,[$e(Fe),ze,Fe]))return e.error(`Expected first argument to be of type array or string, but found ${Ue(i.type)} instead`);if(4===t.length){const r=e.parse(t[3],3,Le);return r?new fn(i.type,i,n,r):null}return new fn(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!Ze(e,["string","array"]))throw new ri(`Expected first argument to be of type array or string, but found ${Ue(ei(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function mn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function gn(t,e,i,n){return 0===n.compare(e,i)}function yn(t,e,i){const n="=="!==t&&"!="!==t;return class r{constructor(t,e,i){this.type=De,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let o=e.parse(t[1],1,Fe);if(!o)return null;if(!mn(i,o.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${Ue(o.type)}'.`);let s=e.parse(t[2],2,Fe);if(!s)return null;if(!mn(i,s.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${Ue(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Ue(o.type)}' and '${Ue(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new si(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new si(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Ne),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const e=ei(o),i=ei(s);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new ri(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=ei(o),i=ei(s);if("string"!==t.kind||"string"!==i.kind)return e(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const _n=yn("==",(function(t,e,i){return e===i}),gn),vn=yn("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!gn(0,e,i,n)})),xn=yn("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),bn=yn(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),wn=yn("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),Tn=yn(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class Sn{constructor(t,e,i,n,r){this.type=ze,this.number=t,this.locale=e,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,Le);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=e.parse(n.locale,1,ze),!r))return null;let o=null;if(n.currency&&(o=e.parse(n.currency,1,ze),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=e.parse(n["min-fraction-digits"],1,Le),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=e.parse(n["max-fraction-digits"],1,Le),!a)?null:new Sn(i,r,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Cn{constructor(t){this.type=Le,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${Ue(i.type)} instead.`):new Cn(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ri(`Expected value to be of type string or array, but found ${Ue(ei(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const En={"==":_n,"!=":vn,">":bn,"<":xn,">=":Tn,"<=":wn,array:si,at:cn,boolean:si,case:dn,coalesce:an,collator:fi,format:ai,image:li,in:un,"index-of":hn,interpolate:on,"interpolate-hcl":on,"interpolate-lab":on,length:Cn,let:ln,literal:ni,match:pn,number:si,"number-format":Sn,object:si,slice:fn,step:Bi,string:si,"to-boolean":ui,"to-color":ui,"to-number":ui,"to-string":ui,var:Ri,within:Pi};function In(t,[e,i,n,r]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const o=r?r.evaluate(t):1,s=Qe(e,i,n,o);if(s)throw new ri(s);return new He(e/255*o,i/255*o,n/255*o,o)}function Mn(t,e){return t in e}function An(t,e){const i=e[t];return void 0===i?null:i}function kn(t){return{type:t}}function Pn(t){return{result:"success",value:t}}function Ln(t){return{result:"error",value:t}}function zn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Dn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Rn(t){return!!t.expression&&t.expression.interpolated}function On(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Fn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}di.register(En,{error:[{kind:"error"},[ze],(t,[e])=>{throw new ri(e.evaluate(t))}],typeof:[ze,[Fe],(t,[e])=>Ue(ei(e.evaluate(t)))],"to-rgba":[$e(Le,4),[Re],(t,[e])=>e.evaluate(t).toArray()],rgb:[Re,[Le,Le,Le],In],rgba:[Re,[Le,Le,Le,Le],In],has:{type:De,overloads:[[[ze],(t,[e])=>Mn(e.evaluate(t),t.properties())],[[ze,Oe],(t,[e,i])=>Mn(e.evaluate(t),i.evaluate(t))]]},get:{type:Fe,overloads:[[[ze],(t,[e])=>An(e.evaluate(t),t.properties())],[[ze,Oe],(t,[e,i])=>An(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Fe,[ze],(t,[e])=>An(e.evaluate(t),t.featureState||{})],properties:[Oe,[],t=>t.properties()],"geometry-type":[ze,[],t=>t.geometryType()],id:[Fe,[],t=>t.id()],zoom:[Le,[],t=>t.globals.zoom],pitch:[Le,[],t=>t.globals.pitch||0],"distance-from-center":[Le,[],t=>t.distanceFromCenter()],"heatmap-density":[Le,[],t=>t.globals.heatmapDensity||0],"line-progress":[Le,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Le,[],t=>t.globals.skyRadialProgress||0],accumulated:[Fe,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Le,kn(Le),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Le,kn(Le),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Le,overloads:[[[Le,Le],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Le],(t,[e])=>-e.evaluate(t)]]},"/":[Le,[Le,Le],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Le,[Le,Le],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Le,[Le],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Le,[Le],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Le,[Le],(t,[e])=>Math.log(e.evaluate(t))],log2:[Le,[Le],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Le,[Le],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Le,[Le],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Le,[Le],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Le,[Le],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Le,[Le],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Le,[Le],(t,[e])=>Math.atan(e.evaluate(t))],min:[Le,kn(Le),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Le,kn(Le),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Le,[Le],(t,[e])=>Math.abs(e.evaluate(t))],round:[Le,[Le],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Le,[Le],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Le,[Le],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[De,[ze,Fe],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[De,[Fe],(t,[e])=>t.id()===e.value],"filter-type-==":[De,[ze],(t,[e])=>t.geometryType()===e.value],"filter-<":[De,[ze,Fe],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[De,[Fe],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[De,[ze,Fe],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[De,[Fe],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[De,[ze,Fe],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[De,[Fe],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[De,[ze,Fe],(t,[e,i])=>{const n=t.properties()[e.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[De,[Fe],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[De,[Fe],(t,[e])=>e.value in t.properties()],"filter-has-id":[De,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[De,[$e(ze)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[De,[$e(Fe)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[De,[ze,$e(Fe)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[De,[ze,$e(Fe)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const r=i+n>>1;if(e[r]===t)return!0;e[r]>t?n=r-1:i=r+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:De,overloads:[[[De,De],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[kn(De),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:De,overloads:[[[De,De],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[kn(De),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[De,[De],(t,[e])=>!e.evaluate(t)],"is-supported-script":[De,[ze],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[ze,[ze],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ze,[ze],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ze,kn(Fe),(t,e)=>e.map((e=>ii(e.evaluate(t)))).join("")],"resolved-locale":[ze,[Ne],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Nn{constructor(t,e){var i;this.expression=t,this._warningHistory={},this._evaluator=new pi,this._defaultValue=e?"color"===(i=e).type&&Fn(i.default)?new He(0,0,0,0):"color"===i.type?He.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,r,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,r,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new ri(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function Bn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in En}function jn(t,e){const i=new Oi(En,[],e?function(t){const e={color:Re,string:ze,number:Le,enum:ze,boolean:De,formatted:Be,resolvedImage:je};if("array"===t.type)return $e(e[t.value]||Fe,t.length);return e[t.type]}(e):void 0),n=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?Pn(new Nn(n,e)):Ln(i.errors)}class $n{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!zi(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}}class Un{constructor(t,e,i,n){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!zi(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,r,o)}evaluate(t,e,i,n,r,o){return this._styleExpression.evaluate(t,e,i,n,r,o)}interpolationFactor(t,e,i){return this.interpolationType?on.interpolationFactor(this.interpolationType,t,e,i):0}}function Vn(t,e){if("error"===(t=jn(t,e)).result)return t;const i=t.value.expression,n=Li(i);if(!n&&!zn(e))return Ln([new Ae("","data expressions not supported")]);const r=Di(i,["zoom","pitch","distance-from-center"]);if(!r&&!Dn(e))return Ln([new Ae("","zoom expressions not supported")]);const o=Gn(i);if(!o&&!r)return Ln([new Ae("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Ae)return Ln([o]);if(o instanceof on&&!Rn(e))return Ln([new Ae("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Pn(new $n(n?"constant":"source",t.value));const s=o instanceof on?o.interpolation:void 0;return Pn(new Un(n?"camera":"composite",t.value,o.labels,s))}function Gn(t){let e=null;if(t instanceof ln)e=Gn(t.result);else if(t instanceof an){for(const i of t.args)if(e=Gn(i),e)break}else(t instanceof Bi||t instanceof on)&&t.input instanceof di&&"zoom"===t.input.name&&(e=t);return e instanceof Ae||t.eachChild((t=>{const i=Gn(t);i instanceof Ae?e=i:!e&&i?e=new Ae("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Ae("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function qn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Zn(t){if(Array.isArray(t))return t.map(Zn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Zn(t[i]);return e}return qn(t)}function Wn(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Wn(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}class Hn{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}class Xn{constructor(t){this.error=t,this.message=t.message;const e=t.message.match(/line (\d+)/);this.line=e?parseInt(e[1],10):0}}function Yn(t){const e=t.key,i=t.value,n=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const l=On(i);if("object"!==l)return[new Hn(e,i,`object expected, ${l} found`)];for(const t in i){const l=t.split(".")[0],c=n[l]||n["*"];let u;r[l]?u=r[l]:n[l]?u=cr:r["*"]?u=r["*"]:n["*"]&&(u=cr),u?a=a.concat(u({key:(e?`${e}.`:e)+t,value:i[t],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:t},i)):a.push(new Hn(e,i[t],`unknown property "${t}"`))}for(const t in n)r[t]||n[t].required&&void 0===n[t].default&&void 0===i[t]&&a.push(new Hn(e,i,`missing required property "${t}"`));return a}function Kn(t){const e=t.value,i=t.valueSpec,n=t.style,r=t.styleSpec,o=t.key,s=t.arrayElementValidator||cr;if("array"!==On(e))return[new Hn(o,e,`array expected, ${On(e)} found`)];if(i.length&&e.length!==i.length)return[new Hn(o,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Hn(o,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(a.function=i.function),"object"===On(i.value)&&(a=i.value);let l=[];for(let t=0;t<e.length;t++)l=l.concat(s({array:e,arrayIndex:t,value:e[t],valueSpec:a,style:n,styleSpec:r,key:`${o}[${t}]`}));return l}function Jn(t){const e=t.key,i=t.value,n=t.valueSpec;let r=On(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new Hn(e,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===On(n.minimum)){const e=t.arrayIndex;r=n.minimum[e]}if(i<r)return[new Hn(e,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===On(n.maximum)){const e=t.arrayIndex;r=n.maximum[e]}if(i>r)return[new Hn(e,i,`${i} is greater than the maximum value ${r}`)]}return[]}function Qn(t){const e=t.valueSpec,i=qn(t.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===t.value.property,l=!a,c="array"===On(t.value.stops)&&"array"===On(t.value.stops[0])&&"object"===On(t.value.stops[0][0]),u=Yn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===i)return[new Hn(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const n=t.value;e=e.concat(Kn({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===On(n)&&0===n.length&&e.push(new Hn(t.key,n,"array must have at least one stop"));return e},default:function(t){return cr({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===i&&a&&u.push(new Hn(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||u.push(new Hn(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Rn(t.valueSpec)&&u.push(new Hn(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(l&&!zn(t.valueSpec)?u.push(new Hn(t.key,t.value,"property functions not supported")):a&&!Dn(t.valueSpec)&&u.push(new Hn(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==t.value.property||u.push(new Hn(t.key,t.value,'"property" property is required')),u;function h(t){let i=[];const n=t.value,a=t.key;if("array"!==On(n))return[new Hn(a,n,`array expected, ${On(n)} found`)];if(2!==n.length)return[new Hn(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==On(n[0]))return[new Hn(a,n,`object expected, ${On(n[0])} found`)];if(void 0===n[0].zoom)return[new Hn(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Hn(a,n,"object stop key must have value")];const e=qn(n[0].zoom);if("number"!=typeof e)return[new Hn(a,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>e)return[new Hn(a,n[0].zoom,"stop zoom values must appear in ascending order")];e!==o&&(o=e,r=void 0,s={}),i=i.concat(Yn({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Jn,value:p}}))}else i=i.concat(p({key:`${a}[0]`,value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return Bn(Zn(n[1]))?i.concat([new Hn(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(cr({key:`${a}[1]`,value:n[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const a=On(t.value),l=qn(t.value),c=null!==t.value?t.value:o;if(n){if(a!==n)return[new Hn(t.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Hn(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return zn(e)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Hn(t.key,c,n)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new Hn(t.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new Hn(t.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Hn(t.key,c,`integer expected, found ${String(l)}`)]}}function tr(t){const e=("property"===t.expressionContext?Vn:jn)(Zn(t.value),t.valueSpec);if("error"===e.result)return e.value.map((e=>new Hn(`${t.key}${e.key}`,t.value,e.message)));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new Hn(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!zi(i))return[new Hn(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return er(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Di(i,["zoom","feature-state"]))return[new Hn(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Li(i))return[new Hn(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function er(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const t of e.valueSpec.expression.parameters)i.delete(t);if(0===i.size)return[];const n=[];return t instanceof di&&i.has(t.name)?[new Hn(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild((t=>{n.push(...er(t,e))})),n)}function ir(t){const e=t.key,i=t.value,n=t.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(qn(i))&&r.push(new Hn(e,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(qn(i))&&r.push(new Hn(e,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function nr(t){if(Wn(Zn(t.value))){const e=t.layerType||"fill";return tr(Me({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e}`]}))}return rr(t)}function rr(t){const e=t.value,i=t.key;if("array"!==On(e))return[new Hn(i,e,`array expected, ${On(e)} found`)];const n=t.styleSpec;let r,o=[];if(e.length<1)return[new Hn(i,e,"filter array must have at least 1 element")];switch(o=o.concat(ir({key:`${i}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),qn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===qn(e[1])&&o.push(new Hn(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new Hn(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=On(e[1]),"string"!==r&&o.push(new Hn(`${i}[1]`,e[1],`string expected, ${r} found`)));for(let s=2;s<e.length;s++)r=On(e[s]),"$type"===qn(e[1])?o=o.concat(ir({key:`${i}[${s}]`,value:e[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Hn(`${i}[${s}]`,e[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<e.length;n++)o=o.concat(rr({key:`${i}[${n}]`,value:e[n],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=On(e[1]),2!==e.length?o.push(new Hn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Hn(`${i}[1]`,e[1],`string expected, ${r} found`));break;case"within":r=On(e[1]),2!==e.length?o.push(new Hn(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Hn(`${i}[1]`,e[1],`object expected, ${r} found`))}return o}function or(t,e){const i=t.key,n=t.style,r=t.styleSpec,o=t.value,s=t.objectKey,a=r[`${e}_${t.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===e&&l&&a[l[1]]&&a[l[1]].transition)return cr({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=t.valueSpec||a[s];if(!c)return[new Hn(i,o,`unknown property "${s}"`)];let u;if("string"===On(o)&&zn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Hn(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new Hn(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Fn(Zn(o))&&"identity"===qn(o.type)&&h.push(new Hn(i,o,'"text-font" does not support identity functions'))),h.concat(cr({key:t.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:e,propertyKey:s}))}function sr(t){const e=t.value,i=t.key,n=On(e);return"string"!==n?[new Hn(i,e,`string expected, ${n} found`)]:[]}const ar={promoteId:function({key:t,value:e}){if("string"===On(e))return sr({key:t,value:e});{const i=[];for(const n in e)i.push(...sr({key:`${t}.${n}`,value:e[n]}));return i}}};const lr={"*":()=>[],array:Kn,boolean:function(t){const e=t.value,i=t.key,n=On(e);return"boolean"!==n?[new Hn(i,e,`boolean expected, ${n} found`)]:[]},number:Jn,color:function(t){const e=t.key,i=t.value,n=On(i);return"string"!==n?[new Hn(e,i,`color expected, ${n} found`)]:null===We.parseCSSColor(i)?[new Hn(e,i,`color expected, "${i}" found`)]:[]},enum:ir,filter:nr,function:Qn,layer:function(t){let e=[];const i=t.value,n=t.key,r=t.style,o=t.styleSpec;i.type||i.ref||e.push(new Hn(n,i,'either "type" or "ref" is required'));let s=qn(i.type);const a=qn(i.ref);if(i.id){const o=qn(i.id);for(let s=0;s<t.arrayIndex;s++){const t=r.layers[s];qn(t.id)===o&&e.push(new Hn(n,i.id,`duplicate layer id "${i.id}", previously used at line ${t.id.__line__}`))}}if("ref"in i){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in i&&e.push(new Hn(n,i[t],`"${t}" is prohibited for ref layers`))})),r.layers.forEach((e=>{qn(e.id)===a&&(t=e)})),t?t.ref?e.push(new Hn(n,i.ref,"ref cannot reference another ref layer")):s=qn(t.type):"string"==typeof a&&e.push(new Hn(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const t=r.sources&&r.sources[i.source],o=t&&qn(t.type);t?"vector"===o&&"raster"===s?e.push(new Hn(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new Hn(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new Hn(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new Hn(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Hn(n,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Hn(n,i.source,`source "${i.source}" not found`))}else e.push(new Hn(n,i,'missing required property "source"'));return e=e.concat(Yn({key:n,value:i,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>cr({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:t=>nr(Me({layerType:s},t)),layout:t=>Yn({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>function(t){return or(t,"layout")}(Me({layerType:s},t))}}),paint:t=>Yn({layer:i,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>function(t){return or(t,"paint")}(Me({layerType:s},t))}})}})),e},object:Yn,source:function(t){const e=t.value,i=t.key,n=t.styleSpec,r=t.style;if(!e.type)return[new Hn(i,e,'"type" is required')];const o=qn(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Yn({key:i,value:e,valueSpec:n[`source_${o.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:ar}),s;case"geojson":if(s=Yn({key:i,value:e,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:ar}),e.cluster)for(const t in e.clusterProperties){const[n,r]=e.clusterProperties[t],o="string"==typeof n?[n,["accumulated"],["get",t]]:n;s.push(...tr({key:`${i}.${t}.map`,value:r,expressionContext:"cluster-map"})),s.push(...tr({key:`${i}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Yn({key:i,value:e,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Yn({key:i,value:e,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new Hn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ir({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}},light:function(t){const e=t.value,i=t.styleSpec,n=i.light,r=t.style;let o=[];const s=On(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Hn("light",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=s&&n[s[1]]&&n[s[1]].transition?o.concat(cr({key:t,value:e[t],valueSpec:i.transition,style:r,styleSpec:i})):n[t]?o.concat(cr({key:t,value:e[t],valueSpec:n[t],style:r,styleSpec:i})):o.concat([new Hn(t,e[t],`unknown property "${t}"`)])}return o},terrain:function(t){const e=t.value,i=t.key,n=t.style,r=t.styleSpec,o=r.terrain;let s=[];const a=On(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new Hn("terrain",e,`object expected, ${a} found`)]),s;for(const t in e){const i=t.match(/^(.*)-transition$/);s=i&&o[i[1]]&&o[i[1]].transition?s.concat(cr({key:t,value:e[t],valueSpec:r.transition,style:n,styleSpec:r})):o[t]?s.concat(cr({key:t,value:e[t],valueSpec:o[t],style:n,styleSpec:r})):s.concat([new Hn(t,e[t],`unknown property "${t}"`)])}if(e.source){const t=n.sources&&n.sources[e.source],r=t&&qn(t.type);t?"raster-dem"!==r&&s.push(new Hn(i,e.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):s.push(new Hn(i,e.source,`source "${e.source}" not found`))}else s.push(new Hn(i,e,'terrain is missing required property "source"'));return s},fog:function(t){const e=t.value,i=t.style,n=t.styleSpec,r=n.fog;let o=[];const s=On(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new Hn("fog",e,`object expected, ${s} found`)]),o;for(const t in e){const s=t.match(/^(.*)-transition$/);o=s&&r[s[1]]&&r[s[1]].transition?o.concat(cr({key:t,value:e[t],valueSpec:n.transition,style:i,styleSpec:n})):r[t]?o.concat(cr({key:t,value:e[t],valueSpec:r[t],style:i,styleSpec:n})):o.concat([new Hn(t,e[t],`unknown property "${t}"`)])}return o},string:sr,formatted:function(t){return 0===sr(t).length?[]:tr(t)},resolvedImage:function(t){return 0===sr(t).length?[]:tr(t)},projection:function(t){const e=t.value,i=t.styleSpec,n=i.projection,r=t.style;let o=[];const s=On(e);if("object"===s)for(const t in e)o=o.concat(cr({key:t,value:e[t],valueSpec:n[t],style:r,styleSpec:i}));else"string"!==s&&(o=o.concat([new Hn("projection",e,`object or string expected, ${s} found`)]));return o}};function cr(t){const e=t.value,i=t.valueSpec,n=t.styleSpec;if(i.expression&&Fn(qn(e)))return Qn(t);if(i.expression&&Bn(Zn(e)))return tr(t);if(i.type&&lr[i.type])return lr[i.type](t);return Yn(Me({},t,{valueSpec:i.type?n[i.type]:i}))}function ur(t){const e=t.value,i=t.key,n=sr(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new Hn(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Hn(i,e,'"glyphs" url must include a "{range}" token'))),n}var hr=Te((function(t,e){var i=function(){var t=function(t,e,i,n){for(i=i||{},n=t.length;n--;i[t[n]]=e);return i},e=[1,12],i=[1,13],n=[1,9],r=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],c=[18,22],u=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(t,e,i,n,r,o,s){var a=o.length-1;switch(r){case 1:this.$=new String(t.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(t),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a])}},table:[{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},t(l,[2,7]),t(l,[2,8]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,3]),t(l,[2,4]),t(l,[2,5]),t([14,18,21,22,24],[2,1]),t(l,[2,2]),{3:20,4:e,18:[1,17],19:18,20:19},{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},t(l,[2,13]),{18:[1,24],22:[1,25]},t(c,[2,16]),{21:[1,26]},t(l,[2,18]),{22:[1,28],24:[1,27]},t(u,[2,20]),t(l,[2,14]),{3:20,4:e,20:29},{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:30,15:7,16:8,17:s,23:a},t(l,[2,19]),{3:5,4:e,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:31,15:7,16:8,17:s,23:a},t(c,[2,17]),t(c,[2,15]),t(u,[2,21])],defaultActions:{16:[2,6]},parseError:function(t,e){if(!e.recoverable)throw new Error(t);this.trace(t)},parse:function(t){var e=this,i=[0],n=[null],r=[],o=this.table,s="",a=0,l=0,c=2,u=1,h=r.slice.call(arguments,1),p=Object.create(this.lexer),d={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(d.yy[f]=this.yy[f]);p.setInput(t,d.yy),d.yy.lexer=p,d.yy.parser=this,void 0===p.yylloc&&(p.yylloc={});var m=p.yylloc;r.push(m);var g=p.options&&p.options.ranges;function y(){var t;return"number"!=typeof(t=p.lex()||u)&&(t=e.symbols_[t]||t),t}"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,v,x,b,w,T,S,C,E={};;){if(v=i[i.length-1],this.defaultActions[v]?x=this.defaultActions[v]:(null==_&&(_=y()),x=o[v]&&o[v][_]),void 0===x||!x.length||!x[0]){var I="";for(w in C=[],o[v])this.terminals_[w]&&w>c&&C.push("'"+this.terminals_[w]+"'");I=p.showPosition?"Parse error on line "+(a+1)+":\n"+p.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(a+1)+": Unexpected "+(_==u?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(I,{text:p.match,token:this.terminals_[_]||_,line:p.yylineno,loc:m,expected:C})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+_);switch(x[0]){case 1:i.push(_),n.push(p.yytext),r.push(p.yylloc),i.push(x[1]),_=null,l=p.yyleng,s=p.yytext,a=p.yylineno,m=p.yylloc;break;case 2:if(T=this.productions_[x[1]][1],E.$=n[n.length-T],E._$={first_line:r[r.length-(T||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(T||1)].first_column,last_column:r[r.length-1].last_column},g&&(E._$.range=[r[r.length-(T||1)].range[0],r[r.length-1].range[1]]),void 0!==(b=this.performAction.apply(E,[s,l,a,d.yy,x[1],n,r].concat(h))))return b;T&&(i=i.slice(0,-1*T*2),n=n.slice(0,-1*T),r=r.slice(0,-1*T)),i.push(this.productions_[x[1]][0]),n.push(E.$),r.push(E._$),S=o[i[i.length-2]][i[i.length-1]],i.push(S);break;case 3:return!0}}return!0}},p={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var i,n,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(n=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,e,i,n;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length;o++)if((i=this._input.match(this.rules[r[o]]))&&(!e||i[0].length>e[0].length)){if(e=i,n=o,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,r[o])))return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?!1!==(t=this.test_match(e,r[n]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,e,i,n){switch(i){case 0:break;case 1:return 6;case 2:return e.yytext=e.yytext.substr(1,e.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};function d(){this.yy={}}return h.lexer=p,d.prototype=h,h.Parser=d,new d}();e.parser=i,e.Parser=i.Parser,e.parse=function(){return i.parse.apply(i,arguments)}}));function pr(t,e=be){let i=t;try{i=function(t){if(t instanceof String||"string"==typeof t||t instanceof Buffer)try{return hr.parse(t.toString())}catch(t){throw new Xn(t)}return t}(i)}catch(t){return[t]}return function(t,e=be){return i=cr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ur,"*":()=>[]}}),i.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0));var i}(i,e)}var dr={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function fr(t,e,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=e||{},n.geometry=t,n}function mr(t,e,i){if(void 0===i&&(i={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wr(t[0])||!wr(t[1]))throw new Error("coordinates must contain numbers");return fr({type:"Point",coordinates:t},e,i)}function gr(t,e,i){if(void 0===i&&(i={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return fr({type:"LineString",coordinates:t},e,i)}function yr(t,e){void 0===e&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function _r(t,e){void 0===e&&(e="kilometers");var i=dr[e];if(!i)throw new Error(e+" units is invalid");return t*i}function vr(t,e){void 0===e&&(e="kilometers");var i=dr[e];if(!i)throw new Error(e+" units is invalid");return t/i}function xr(t){return 180*(t%(2*Math.PI))/Math.PI}function br(t){return t%360*Math.PI/180}function wr(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function Tr(t,e,i){if(null!==t)for(var n,r,o,s,a,l,c,u,h=0,p=0,d=t.type,f="FeatureCollection"===d,m="Feature"===d,g=f?t.features.length:1,y=0;y<g;y++){a=(u=!!(c=f?t.features[y].geometry:m?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<a;_++){var v=0,x=0;if(null!==(s=u?c.geometries[_]:c)){l=s.coordinates;var b=s.type;switch(h=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(l,p,y,v,x))return!1;p++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===e(l[n],p,y,v,x))return!1;p++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===e(l[n][r],p,y,v,x))return!1;p++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===e(l[n][r][o],p,y,v,x))return!1;p++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===Tr(s.geometries[n],e,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Sr(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}function Cr(t,e){var i,n,r,o,s,a,l,c,u,h,p=0,d="FeatureCollection"===t.type,f="Feature"===t.type,m=d?t.features.length:1;for(i=0;i<m;i++){for(a=d?t.features[i].geometry:f?t.geometry:t,c=d?t.features[i].properties:f?t.properties:{},u=d?t.features[i].bbox:f?t.bbox:void 0,h=d?t.features[i].id:f?t.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,p,c,u,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===e(o.geometries[n],p,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,p,c,u,h))return!1;p++}}function Er(t,e){!function(t,e){Cr(t,(function(t,i,n,r,o){var s,a=null===t?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==e(fr(t,n,{bbox:r,id:o}),i,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var c=t.coordinates[l];if(!1===e(fr({type:s,coordinates:c},n),i,l))return!1}}))}(t,(function(t,i,n){var r=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,c=0;return!1!==Tr(t,(function(o,u,h,p,d){if(void 0===s||i>a||p>l||d>c)return s=o,a=i,l=p,c=d,void(r=0);var f=gr([s,o],t.properties);if(!1===e(f,i,n,d,r))return!1;r++,s=o}))&&void 0}}}))}function Ir(t){var e=[1/0,1/0,-1/0,-1/0];return Tr(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function Mr(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ar(t,e,i){void 0===i&&(i={});var n=Mr(t),r=Mr(e),o=br(r[1]-n[1]),s=br(r[0]-n[0]),a=br(n[1]),l=br(r[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return _r(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}function kr(t,e,i,n){void 0===n&&(n={});var r=Mr(t),o=br(r[0]),s=br(r[1]),a=br(i),l=vr(e,n.units),c=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a));return mr([xr(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(c))),xr(c)],n.properties)}function Pr(t,e,i){if(void 0===i&&(i={}),!0===i.final)return function(t,e){var i=Pr(e,t);return i=(i+180)%360}(t,e);var n=Mr(t),r=Mr(e),o=br(n[0]),s=br(r[0]),a=br(n[1]),l=br(r[1]),c=Math.sin(s-o)*Math.cos(l),u=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return xr(Math.atan2(c,u))}function Lr(t,e,i){void 0===i&&(i={});for(var n,r=("Feature"===(n=t).type?n.geometry:n).coordinates,o=0,s=0;s<r.length&&!(e>=o&&s===r.length-1);s++){if(o>=e){var a=e-o;if(a){var l=Pr(r[s],r[s-1])-180;return kr(r[s],a,l,i)}return mr(r[s])}o+=Ar(r[s],r[s+1],i)}return mr(r[r.length-1])}function zr(t,e){return void 0===e&&(e={}),function(t,e,i){var n=i,r=!1;return Er(t,(function(t,o,s,a,l){n=!1===r&&void 0===i?t:e(n,t,o,s,a,l),r=!0})),n}(t,(function(t,i){var n=i.geometry.coordinates;return t+Ar(n[0],n[1],e)}),0)}function Dr(t,e,i,n){if(!(r=n=n||{})||r.constructor!==Object)throw new Error("options is invalid");var r,o,s=[];if("Feature"===t.type)o=t.geometry.coordinates;else{if("LineString"!==t.type)throw new Error("input must be a LineString Feature or Geometry");o=t.coordinates}for(var a,l,c,u=o.length,h=0,p=0;p<o.length&&!(e>=h&&p===o.length-1);p++){if(h>e&&0===s.length){if(!(a=e-h))return s.push(o[p]),gr(s);l=Pr(o[p],o[p-1])-180,c=kr(o[p],a,l,n),s.push(c.geometry.coordinates)}if(h>=i)return(a=i-h)?(l=Pr(o[p],o[p-1])-180,c=kr(o[p],a,l,n),s.push(c.geometry.coordinates),gr(s)):(s.push(o[p]),gr(s));if(h>=e&&s.push(o[p]),p===o.length-1)return gr(s);h+=Ar(o[p],o[p+1],n)}if(h<e&&o.length===u)throw new Error("Start position is beyond line");var d=o[o.length-1];return gr([d,d])}function Rr(t,e,i){var n;return void 0===i&&(i={}),(n=i.final?Or(Mr(e),Mr(t)):Or(Mr(t),Mr(e)))>180?-(360-n):n}function Or(t,e){var i=br(t[1]),n=br(e[1]),r=br(e[0]-t[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(xr(Math.atan2(r,o))+360)%360}Ir.default=Ir;var Fr={exports:{}};function Nr(){return new Br}function Br(){this.reset()}!function(t){function e(){}function i(t){this.message=t||""}function n(t){this.message=t||""}function r(t){this.message=t||""}function o(){}function s(t){return null===t?Dt:t.color}function a(t){return null===t?null:t.parent}function l(t,e){null!==t&&(t.color=e)}function c(t){return null===t?null:t.left}function u(t){return null===t?null:t.right}function h(){this.root_=null,this.size_=0}function p(){}function d(){this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}function f(){}function m(t){this.message=t||""}function g(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),i=Math.max(Math.min(e.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(i+n,0):Math.min(n,i);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:i;for(r=r<0?Math.max(i+arguments[2],0):Math.min(r,i);n<r;)e[n]=t,++n;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var y=function(){};y.prototype.interfaces_=function(){return[]},y.prototype.getClass=function(){return y},y.prototype.equalsWithTolerance=function(t,e,i){return Math.abs(t-e)<=i};var _=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),v=function(){},x={MAX_VALUE:{configurable:!0}};v.isNaN=function(t){return Number.isNaN(t)},v.doubleToLongBits=function(t){return t},v.longBitsToDouble=function(t){return t},v.isInfinite=function(t){return!Number.isFinite(t)},x.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(v,x);var b=function(){},w=function(){},T=function(){},S=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},C={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};S.prototype.setOrdinate=function(t,e){switch(t){case S.X:this.x=e;break;case S.Y:this.y=e;break;case S.Z:this.z=e;break;default:throw new _("Invalid ordinate index: "+t)}},S.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!y.equalsWithTolerance(this.x,e.x,i)&&!!y.equalsWithTolerance(this.y,e.y,i)}},S.prototype.getOrdinate=function(t){switch(t){case S.X:return this.x;case S.Y:return this.y;case S.Z:return this.z}throw new _("Invalid ordinate index: "+t)},S.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||v.isNaN(this.z))&&v.isNaN(t.z)},S.prototype.equals=function(t){return t instanceof S&&this.equals2D(t)},S.prototype.equalInZ=function(t,e){return y.equalsWithTolerance(this.z,t.z,e)},S.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},S.prototype.clone=function(){},S.prototype.copy=function(){return new S(this)},S.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},S.prototype.distance3D=function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return Math.sqrt(e*e+i*i+n*n)},S.prototype.distance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},S.prototype.hashCode=function(){var t=17;return 37*(t=37*t+S.hashCode(this.x))+S.hashCode(this.y)},S.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},S.prototype.interfaces_=function(){return[b,w,e]},S.prototype.getClass=function(){return S},S.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=v.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}},C.DimensionalComparator.get=function(){return E},C.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},C.NULL_ORDINATE.get=function(){return v.NaN},C.X.get=function(){return 0},C.Y.get=function(){return 1},C.Z.get=function(){return 2},Object.defineProperties(S,C);var E=function(t){if(this._dimensionsToTest=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new _("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};E.prototype.compare=function(t,e){var i=t,n=e,r=E.compare(i.x,n.x);if(0!==r)return r;var o=E.compare(i.y,n.y);return 0!==o?o:this._dimensionsToTest<=2?0:E.compare(i.z,n.z)},E.prototype.interfaces_=function(){return[T]},E.prototype.getClass=function(){return E},E.compare=function(t,e){return t<e?-1:t>e?1:v.isNaN(t)?v.isNaN(e)?0:-1:v.isNaN(e)?1:0};var I=function(){};I.prototype.create=function(){},I.prototype.interfaces_=function(){return[]},I.prototype.getClass=function(){return I};var M=function(){},A={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};M.prototype.interfaces_=function(){return[]},M.prototype.getClass=function(){return M},M.toLocationSymbol=function(t){switch(t){case M.EXTERIOR:return"e";case M.BOUNDARY:return"b";case M.INTERIOR:return"i";case M.NONE:return"-"}throw new _("Unknown location value: "+t)},A.INTERIOR.get=function(){return 0},A.BOUNDARY.get=function(){return 1},A.EXTERIOR.get=function(){return 2},A.NONE.get=function(){return-1},Object.defineProperties(M,A);var k=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},P=function(){},L={LOG_10:{configurable:!0}};P.prototype.interfaces_=function(){return[]},P.prototype.getClass=function(){return P},P.log10=function(t){var e=Math.log(t);return v.isInfinite(e)||v.isNaN(e)?e:e/P.LOG_10},P.min=function(t,e,i,n){var r=t;return e<r&&(r=e),i<r&&(r=i),n<r&&(r=n),r},P.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],i=arguments[2];return t<e?e:t>i?i:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],r=arguments[1],o=arguments[2];return n<r?r:n>o?o:n}},P.wrap=function(t,e){return t<0?e- -t%e:t%e},P.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[0];return t>i&&(i=t),e>i&&(i=e),i}if(4===arguments.length){var n=arguments[1],r=arguments[2],o=arguments[3],s=arguments[0];return n>s&&(s=n),r>s&&(s=r),o>s&&(s=o),s}},P.average=function(t,e){return(t+e)/2},L.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(P,L);var z=function(t){this.str=t};z.prototype.append=function(t){this.str+=t},z.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},z.prototype.toString=function(t){return this.str};var D=function(t){this.value=t};D.prototype.intValue=function(){return this.value},D.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},D.isNaN=function(t){return Number.isNaN(t)};var R=function(){};R.isWhitespace=function(t){return t<=32&&t>=0||127===t},R.toUpperCase=function(t){return t.toUpperCase()};var O=function t(){if(this._hi=0,this._lo=0,0===arguments.length)this.init(0);else if(1===arguments.length)if("number"==typeof arguments[0]){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}else"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0]));else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n,r)}},F={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};O.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo},O.prototype.extractSignificantDigits=function(t,e){var i=this.abs(),n=O.magnitude(i._hi),r=O.TEN.pow(n);(i=i.divide(r)).gt(O.TEN)?(i=i.divide(O.TEN),n+=1):i.lt(O.ONE)&&(i=i.multiply(O.TEN),n-=1);for(var o=n+1,s=new z,a=O.MAX_PRINT_DIGITS-1,l=0;l<=a;l++){t&&l===o&&s.append(".");var c=Math.trunc(i._hi);if(c<0)break;var u=!1,h=0;c>9?(u=!0,h="9"):h="0"+c,s.append(h),i=i.subtract(O.valueOf(c)).multiply(O.TEN),u&&i.selfAdd(O.TEN);var p=!0,d=O.magnitude(i._hi);if(d<0&&Math.abs(d)>=a-l&&(p=!1),!p)break}return e[0]=n,s.toString()},O.prototype.sqr=function(){return this.multiply(this)},O.prototype.doubleValue=function(){return this._hi+this._lo},O.prototype.subtract=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},O.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}},O.prototype.isZero=function(){return 0===this._hi&&0===this._lo},O.prototype.selfSubtract=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},O.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},O.prototype.min=function(t){return this.le(t)?this:t},O.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1],r=null,o=null,s=null,a=null,l=null,c=null,u=null,h=null;return l=this._hi/i,h=(r=(c=O.SPLIT*l)-(r=c-l))*(s=(h=O.SPLIT*i)-(s=h-i))-(u=l*i)+r*(a=i-s)+(o=l-r)*s+o*a,h=l+(c=(this._hi-u-h+this._lo-l*n)/i),this._hi=h,this._lo=l-h+c,this}},O.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},O.prototype.divide=function(){if(arguments[0]instanceof O){var t=arguments[0],e=null,i=null,n=null,r=null,o=null,s=null,a=null,l=null;return i=(o=this._hi/t._hi)-(e=(s=O.SPLIT*o)-(e=s-o)),l=e*(n=(l=O.SPLIT*t._hi)-(n=l-t._hi))-(a=o*t._hi)+e*(r=t._hi-n)+i*n+i*r,s=(this._hi-a-l+this._lo-o*t._lo)/t._hi,new O(l=o+s,o-l+s)}if("number"==typeof arguments[0]){var c=arguments[0];return v.isNaN(c)?O.createNaN():O.copy(this).selfDivide(c,0)}},O.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo},O.prototype.pow=function(t){if(0===t)return O.valueOf(1);var e=new O(this),i=O.valueOf(1),n=Math.abs(t);if(n>1)for(;n>0;)n%2==1&&i.selfMultiply(e),(n/=2)>0&&(e=e.sqr());else i=e;return t<0?i.reciprocal():i},O.prototype.ceil=function(){if(this.isNaN())return O.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new O(t,e)},O.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0},O.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},O.prototype.setValue=function(){if(arguments[0]instanceof O){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},O.prototype.max=function(t){return this.ge(t)?this:t},O.prototype.sqrt=function(){if(this.isZero())return O.valueOf(0);if(this.isNegative())return O.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,i=O.valueOf(e),n=this.subtract(i.sqr())._hi*(.5*t);return i.add(n)},O.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0],i=null,n=null,r=null,o=null,s=null,a=null;return o=(r=this._hi+e)-(s=r-this._hi),n=(a=(o=e-s+(this._hi-o))+this._lo)+(r-(i=r+a)),this._hi=i+n,this._lo=n+(i-this._hi),this}}else if(2===arguments.length){var l=arguments[0],c=arguments[1],u=null,h=null,p=null,d=null,f=null,m=null,g=null;d=this._hi+l,h=this._lo+c,f=d-(m=d-this._hi),p=h-(g=h-this._lo);var y=(u=d+(m=(f=l-m+(this._hi-f))+h))+(m=(p=c-g+(this._lo-p))+(m+(d-u))),_=m+(u-y);return this._hi=y,this._lo=_,this}},O.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof O){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1],r=null,o=null,s=null,a=null,l=null,c=null;r=(l=O.SPLIT*this._hi)-this._hi,c=O.SPLIT*i,r=l-r,o=this._hi-r,s=c-i;var u=(l=this._hi*i)+(c=r*(s=c-s)-l+r*(a=i-s)+o*s+o*a+(this._hi*n+this._lo*i)),h=c+(r=l-u);return this._hi=u,this._lo=h,this}},O.prototype.selfSqr=function(){return this.selfMultiply(this)},O.prototype.floor=function(){if(this.isNaN())return O.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new O(t,e)},O.prototype.negate=function(){return this.isNaN()?this:new O(-this._hi,-this._lo)},O.prototype.clone=function(){},O.prototype.multiply=function(){if(arguments[0]instanceof O){var t=arguments[0];return t.isNaN()?O.createNaN():O.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return v.isNaN(e)?O.createNaN():O.copy(this).selfMultiply(e,0)}},O.prototype.isNaN=function(){return v.isNaN(this._hi)},O.prototype.intValue=function(){return Math.trunc(this._hi)},O.prototype.toString=function(){var t=O.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},O.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!0,e),n=e[0]+1,r=i;if("."===i.charAt(0))r="0"+i;else if(n<0)r="0."+O.stringOfChar("0",-n)+i;else if(-1===i.indexOf(".")){var o=n-i.length;r=i+O.stringOfChar("0",o)+".0"}return this.isNegative()?"-"+r:r},O.prototype.reciprocal=function(){var t=null,e=null,i=null,n=null,r=null,o=null,s=null,a=null;e=(r=1/this._hi)-(t=(o=O.SPLIT*r)-(t=o-r)),i=(a=O.SPLIT*this._hi)-this._hi;var l=r+(o=(1-(s=r*this._hi)-(a=t*(i=a-i)-s+t*(n=this._hi-i)+e*i+e*n)-r*this._lo)/this._hi);return new O(l,r-l+o)},O.prototype.toSciNotation=function(){if(this.isZero())return O.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),i=this.extractSignificantDigits(!1,e),n=O.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===i.charAt(0))throw new Error("Found leading zero: "+i);var r="";i.length>1&&(r=i.substring(1));var o=i.charAt(0)+"."+r;return this.isNegative()?"-"+o+n:o+n},O.prototype.abs=function(){return this.isNaN()?O.NaN:this.isNegative()?this.negate():new O(this)},O.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},O.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo},O.prototype.add=function(){if(arguments[0]instanceof O){var t=arguments[0];return O.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return O.copy(this).selfAdd(e)}},O.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof O){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._hi=i,this._lo=n}},O.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo},O.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},O.prototype.trunc=function(){return this.isNaN()?O.NaN:this.isPositive()?this.floor():this.ceil()},O.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},O.prototype.interfaces_=function(){return[e,b,w]},O.prototype.getClass=function(){return O},O.sqr=function(t){return O.valueOf(t).selfMultiply(t)},O.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return O.parse(t)}if("number"==typeof arguments[0])return new O(arguments[0])},O.sqrt=function(t){return O.valueOf(t).sqrt()},O.parse=function(t){for(var e=0,i=t.length;R.isWhitespace(t.charAt(e));)e++;var n=!1;if(e<i){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(n=!0))}for(var o=new O,s=0,a=0,l=0;!(e>=i);){var c=t.charAt(e);if(e++,R.isDigit(c)){var u=c-"0";o.selfMultiply(O.TEN),o.selfAdd(u),s++}else{if("."!==c){if("e"===c||"E"===c){var h=t.substring(e);try{l=D.parseInt(h)}catch(e){throw e instanceof Error?new Error("Invalid exponent "+h+" in string "+t):e}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}a=s}}var p=o,d=s-a-l;if(0===d)p=o;else if(d>0){var f=O.TEN.pow(d);p=o.divide(f)}else if(d<0){var m=O.TEN.pow(-d);p=o.multiply(m)}return n?p.negate():p},O.createNaN=function(){return new O(v.NaN,v.NaN)},O.copy=function(t){return new O(t)},O.magnitude=function(t){var e=Math.abs(t),i=Math.log(e)/Math.log(10),n=Math.trunc(Math.floor(i));return 10*Math.pow(10,n)<=e&&(n+=1),n},O.stringOfChar=function(t,e){for(var i=new z,n=0;n<e;n++)i.append(t);return i.toString()},F.PI.get=function(){return new O(3.141592653589793,12246467991473532e-32)},F.TWO_PI.get=function(){return new O(6.283185307179586,24492935982947064e-32)},F.PI_2.get=function(){return new O(1.5707963267948966,6123233995736766e-32)},F.E.get=function(){return new O(2.718281828459045,14456468917292502e-32)},F.NaN.get=function(){return new O(v.NaN,v.NaN)},F.EPS.get=function(){return 123259516440783e-46},F.SPLIT.get=function(){return 134217729},F.MAX_PRINT_DIGITS.get=function(){return 32},F.TEN.get=function(){return O.valueOf(10)},F.ONE.get=function(){return O.valueOf(1)},F.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},F.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(O,F);var N=function(){},B={DP_SAFE_EPSILON:{configurable:!0}};N.prototype.interfaces_=function(){return[]},N.prototype.getClass=function(){return N},N.orientationIndex=function(t,e,i){var n=N.orientationIndexFilter(t,e,i);if(n<=1)return n;var r=O.valueOf(e.x).selfAdd(-t.x),o=O.valueOf(e.y).selfAdd(-t.y),s=O.valueOf(i.x).selfAdd(-e.x),a=O.valueOf(i.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},N.signOfDet2x2=function(t,e,i,n){return t.multiply(n).selfSubtract(e.multiply(i)).signum()},N.intersection=function(t,e,i,n){var r=O.valueOf(n.y).selfSubtract(i.y).selfMultiply(O.valueOf(e.x).selfSubtract(t.x)),o=O.valueOf(n.x).selfSubtract(i.x).selfMultiply(O.valueOf(e.y).selfSubtract(t.y)),s=r.subtract(o),a=O.valueOf(n.x).selfSubtract(i.x).selfMultiply(O.valueOf(t.y).selfSubtract(i.y)),l=O.valueOf(n.y).selfSubtract(i.y).selfMultiply(O.valueOf(t.x).selfSubtract(i.x)),c=a.subtract(l).selfDivide(s).doubleValue(),u=O.valueOf(t.x).selfAdd(O.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),h=O.valueOf(e.x).selfSubtract(t.x).selfMultiply(O.valueOf(t.y).selfSubtract(i.y)),p=O.valueOf(e.y).selfSubtract(t.y).selfMultiply(O.valueOf(t.x).selfSubtract(i.x)),d=h.subtract(p).selfDivide(s).doubleValue(),f=O.valueOf(i.y).selfAdd(O.valueOf(n.y).selfSubtract(i.y).selfMultiply(d)).doubleValue();return new S(u,f)},N.orientationIndexFilter=function(t,e,i){var n=null,r=(t.x-i.x)*(e.y-i.y),o=(t.y-i.y)*(e.x-i.x),s=r-o;if(r>0){if(o<=0)return N.signum(s);n=r+o}else{if(!(r<0))return N.signum(s);if(o>=0)return N.signum(s);n=-r-o}var a=N.DP_SAFE_EPSILON*n;return s>=a||-s>=a?N.signum(s):2},N.signum=function(t){return t>0?1:t<0?-1:0},B.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(N,B);var j=function(){},$={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};$.X.get=function(){return 0},$.Y.get=function(){return 1},$.Z.get=function(){return 2},$.M.get=function(){return 3},j.prototype.setOrdinate=function(t,e,i){},j.prototype.size=function(){},j.prototype.getOrdinate=function(t,e){},j.prototype.getCoordinate=function(){},j.prototype.getCoordinateCopy=function(t){},j.prototype.getDimension=function(){},j.prototype.getX=function(t){},j.prototype.clone=function(){},j.prototype.expandEnvelope=function(t){},j.prototype.copy=function(){},j.prototype.getY=function(t){},j.prototype.toCoordinateArray=function(){},j.prototype.interfaces_=function(){return[w]},j.prototype.getClass=function(){return j},Object.defineProperties(j,$);var U=function(){},V=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(U),G=function(){};G.arraycopy=function(t,e,i,n,r){for(var o=0,s=e;s<e+r;s++)i[n+o]=t[s],o++},G.getProperty=function(t){return{"line.separator":"\n"}[t]};var q=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var i=arguments[0],n=arguments[1];this.x=i,this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var r=arguments[0],o=arguments[1];this.x=r.y*o.w-o.y*r.w,this.y=o.x*r.w-r.x*o.w,this.w=r.x*o.y-o.x*r.y}else if(arguments[0]instanceof S&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1];this.x=s.y-a.y,this.y=a.x-s.x,this.w=s.x*a.y-a.x*s.y}}else if(3===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2];this.x=l,this.y=c,this.w=u}else if(4===arguments.length){var h=arguments[0],p=arguments[1],d=arguments[2],f=arguments[3],m=h.y-p.y,g=p.x-h.x,y=h.x*p.y-p.x*h.y,_=d.y-f.y,v=f.x-d.x,x=d.x*f.y-f.x*d.y;this.x=g*x-v*y,this.y=_*y-m*x,this.w=m*v-_*g}};q.prototype.getY=function(){var t=this.y/this.w;if(v.isNaN(t)||v.isInfinite(t))throw new V;return t},q.prototype.getX=function(){var t=this.x/this.w;if(v.isNaN(t)||v.isInfinite(t))throw new V;return t},q.prototype.getCoordinate=function(){var t=new S;return t.x=this.getX(),t.y=this.getY(),t},q.prototype.interfaces_=function(){return[]},q.prototype.getClass=function(){return q},q.intersection=function(t,e,i,n){var r=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=i.y-n.y,l=n.x-i.x,c=i.x*n.y-n.x*i.y,u=r*l-a*o,h=(o*c-l*s)/u,p=(a*s-r*c)/u;if(v.isNaN(h)||v.isInfinite(h)||v.isNaN(p)||v.isInfinite(p))throw new V;return new S(h,p)};var Z=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof S){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var i=arguments[0];this.init(i)}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(4===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2],l=arguments[3];this.init(o,s,a,l)}},W={serialVersionUID:{configurable:!0}};Z.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Z.prototype.equals=function(t){if(!(t instanceof Z))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()},Z.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Z;var e=this._minx>t._minx?this._minx:t._minx,i=this._miny>t._miny?this._miny:t._miny,n=this._maxx<t._maxx?this._maxx:t._maxx,r=this._maxy<t._maxy?this._maxy:t._maxy;return new Z(e,n,i,r)},Z.prototype.isNull=function(){return this._maxx<this._minx},Z.prototype.getMaxX=function(){return this._maxx},Z.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Z){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&i>=this._minx&&i<=this._maxx&&n>=this._miny&&n<=this._maxy}},Z.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Z){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}if(arguments[0]instanceof S){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return!this.isNull()&&!(i>this._maxx||i<this._minx||n>this._maxy||n<this._miny)}},Z.prototype.getMinY=function(){return this._miny},Z.prototype.getMinX=function(){return this._minx},Z.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Z){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=n,this._maxy=n):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}},Z.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Z.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},Z.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0},Z.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Z.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},Z.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},Z.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},Z.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Z.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},Z.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Z){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof S){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.covers(i,n)}},Z.prototype.centre=function(){return this.isNull()?null:new S((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Z.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Z){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.init(i.x,n.x,i.y,n.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];r<o?(this._minx=r,this._maxx=o):(this._minx=o,this._maxx=r),s<a?(this._miny=s,this._maxy=a):(this._miny=a,this._maxy=s)}},Z.prototype.getMaxY=function(){return this._maxy},Z.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var i=0;return this._maxy<t._miny?i=t._miny-this._maxy:this._miny>t._maxy&&(i=this._miny-t._maxy),0===e?i:0===i?e:Math.sqrt(e*e+i*i)},Z.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+S.hashCode(this._minx))+S.hashCode(this._maxx))+S.hashCode(this._miny))+S.hashCode(this._maxy)},Z.prototype.interfaces_=function(){return[b,e]},Z.prototype.getClass=function(){return Z},Z.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2];return i.x>=(t.x<e.x?t.x:e.x)&&i.x<=(t.x>e.x?t.x:e.x)&&i.y>=(t.y<e.y?t.y:e.y)&&i.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),l=Math.max(o.x,s.x),c=Math.min(n.x,r.x),u=Math.max(n.x,r.x);return!(c>l||u<a||(a=Math.min(o.y,s.y),l=Math.max(o.y,s.y),c=Math.min(n.y,r.y),u=Math.max(n.y,r.y),c>l||u<a))}},W.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Z,W);var H={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},X=function(t){this.geometryFactory=t||new ye};X.prototype.read=function(t){var e,i,n;t=t.replace(/[\n\r]/g," ");var r=H.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((r=H.emptyTypeStr.exec(t))[2]=void 0),r&&(i=r[1].toLowerCase(),n=r[2],K[i]&&(e=K[i].apply(this,[n]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},X.prototype.write=function(t){return this.extractGeometry(t)},X.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Y[e])return null;var i=e.toUpperCase();return t.isEmpty()?i+" EMPTY":i+"("+Y[e].apply(this,[t])+")"};var Y={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Y.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Y.point.apply(this,[t._geometries[i]])+")");return e.join(",")},linestring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(Y.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},linearring:function(t){for(var e=[],i=0,n=t._points._coordinates.length;i<n;++i)e.push(Y.coordinate.apply(this,[t._points._coordinates[i]]));return e.join(",")},multilinestring:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Y.linestring.apply(this,[t._geometries[i]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Y.linestring.apply(this,[t._shell])+")");for(var i=0,n=t._holes.length;i<n;++i)e.push("("+Y.linestring.apply(this,[t._holes[i]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push("("+Y.polygon.apply(this,[t._geometries[i]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],i=0,n=t._geometries.length;i<n;++i)e.push(this.extractGeometry(t._geometries[i]));return e.join(",")}},K={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(H.spaces);return this.geometryFactory.createPoint(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(H.trimParens,"$1"),n.push(K.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(n)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split(H.spaces),n.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,i=t.trim().split(","),n=[],r=0,o=i.length;r<o;++r)e=i[r].trim().split(H.spaces),n.push(new S(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,i=t.trim().split(H.parenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(H.trimParens,"$1"),n.push(K.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(n)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,i,n,r,o=t.trim().split(H.parenComma),s=[],a=0,l=o.length;a<l;++a)e=o[a].replace(H.trimParens,"$1"),i=K.linestring.apply(this,[e]),n=this.geometryFactory.createLinearRing(i._points),0===a?r=n:s.push(n);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,i=t.trim().split(H.doubleParenComma),n=[],r=0,o=i.length;r<o;++r)e=i[r].replace(H.trimParens,"$1"),n.push(K.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(n)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),i=[],n=0,r=e.length;n<r;++n)i.push(this.read(e[n]));return this.geometryFactory.createGeometryCollection(i)}},J=function(t){this.parser=new X(t)};J.prototype.write=function(t){return this.parser.write(t)},J.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Q=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),tt=function(t){function e(){if(t.call(this),0===arguments.length)t.call(this);else if(1===arguments.length){var e=arguments[0];t.call(this,e)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Q),et=function(){};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.shouldNeverReachHere=function(){if(0===arguments.length)et.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new tt("Should never reach here"+(null!==t?": "+t:""))}},et.isTrue=function(){var t,e;if(1===arguments.length)t=arguments[0],et.isTrue(t,null);else if(2===arguments.length&&(e=arguments[1],!(t=arguments[0])))throw null===e?new tt:new tt(e)},et.equals=function(){var t,e,i;if(2===arguments.length)t=arguments[0],e=arguments[1],et.equals(t,e,null);else if(3===arguments.length&&(t=arguments[0],i=arguments[2],!(e=arguments[1]).equals(t)))throw new tt("Expected "+t+" but encountered "+e+(null!==i?": "+i:""))};var it=function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new S,this._intPt[1]=new S,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},nt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};it.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]},it.prototype.getTopologySummary=function(){var t=new z;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},it.prototype.computeIntersection=function(t,e,i,n){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=i,this._inputLines[1][1]=n,this._result=this.computeIntersect(t,e,i,n)},it.prototype.getIntersectionNum=function(){return this._result},it.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}},it.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},it.prototype.setPrecisionModel=function(t){this._precisionModel=t},it.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this._result;e++)if(!this._intPt[e].equals2D(this._inputLines[t][0])&&!this._intPt[e].equals2D(this._inputLines[t][1]))return!0;return!1}},it.prototype.getIntersection=function(t){return this._intPt[t]},it.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},it.prototype.hasIntersection=function(){return this._result!==it.NO_INTERSECTION},it.prototype.getEdgeDistance=function(t,e){return it.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1])},it.prototype.isCollinear=function(){return this._result===it.COLLINEAR_INTERSECTION},it.prototype.toString=function(){return J.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+J.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},it.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]},it.prototype.isIntersection=function(t){for(var e=0;e<this._result;e++)if(this._intPt[e].equals2D(t))return!0;return!1},it.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]},it.prototype.interfaces_=function(){return[]},it.prototype.getClass=function(){return it},it.computeEdgeDistance=function(t,e,i){var n=Math.abs(i.x-e.x),r=Math.abs(i.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(i))o=n>r?n:r;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=n>r?s:a)||t.equals(e)||(o=Math.max(s,a))}return et.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},it.nonRobustComputeEdgeDistance=function(t,e,i){var n=t.x-e.x,r=t.y-e.y,o=Math.sqrt(n*n+r*r);return et.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},nt.DONT_INTERSECT.get=function(){return 0},nt.DO_INTERSECT.get=function(){return 1},nt.COLLINEAR.get=function(){return 2},nt.NO_INTERSECTION.get=function(){return 0},nt.POINT_INTERSECTION.get=function(){return 1},nt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(it,nt);var rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Z(this._inputLines[0][0],this._inputLines[0][1]),i=new Z(this._inputLines[1][0],this._inputLines[1][1]);return e.contains(t)&&i.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],i=arguments[1],n=arguments[2];if(this._isProper=!1,Z.intersects(i,n,e)&&0===at.orientationIndex(i,n,e)&&0===at.orientationIndex(n,i,e))return this._isProper=!0,(e.equals(i)||e.equals(n))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,i,n,r){r.x=this.smallestInAbsValue(t.x,e.x,i.x,n.x),r.y=this.smallestInAbsValue(t.y,e.y,i.y,n.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.safeHCoordinateIntersection=function(t,i,n,r){var o=null;try{o=q.intersection(t,i,n,r)}catch(s){if(!(s instanceof V))throw s;o=e.nearestEndpoint(t,i,n,r)}return o},e.prototype.intersection=function(t,i,n,r){var o=this.intersectionWithNormalization(t,i,n,r);return this.isInSegmentEnvelopes(o)||(o=new S(e.nearestEndpoint(t,i,n,r))),null!==this._precisionModel&&this._precisionModel.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,i,n){var r=t,o=Math.abs(r);return Math.abs(e)<o&&(r=e,o=Math.abs(e)),Math.abs(i)<o&&(r=i,o=Math.abs(i)),Math.abs(n)<o&&(r=n),r},e.prototype.checkDD=function(t,e,i,n,r){var o=N.intersection(t,e,i,n),s=this.isInSegmentEnvelopes(o);G.out.println("DD in env = "+s+"  --------------------- "+o),r.distance(o)>1e-4&&G.out.println("Distance = "+r.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,i,n){var r=new S(t),o=new S(e),s=new S(i),a=new S(n),l=new S;this.normalizeToEnvCentre(r,o,s,a,l);var c=this.safeHCoordinateIntersection(r,o,s,a);return c.x+=l.x,c.y+=l.y,c},e.prototype.computeCollinearIntersection=function(e,i,n,r){var o=Z.intersects(e,i,n),s=Z.intersects(e,i,r),a=Z.intersects(n,r,e),l=Z.intersects(n,r,i);return o&&s?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=e,this._intPt[1]=i,t.COLLINEAR_INTERSECTION):o&&a?(this._intPt[0]=n,this._intPt[1]=e,!n.equals(e)||s||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&l?(this._intPt[0]=n,this._intPt[1]=i,!n.equals(i)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this._intPt[0]=r,this._intPt[1]=e,!r.equals(e)||o||l?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&l?(this._intPt[0]=r,this._intPt[1]=i,!r.equals(i)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,i,n,r){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,l=t.y>e.y?t.y:e.y,c=i.x<n.x?i.x:n.x,u=i.y<n.y?i.y:n.y,h=i.x>n.x?i.x:n.x,p=i.y>n.y?i.y:n.y,d=((o>c?o:c)+(a<h?a:h))/2,f=((s>u?s:u)+(l<p?l:p))/2;r.x=d,r.y=f,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,i.x-=r.x,i.y-=r.y,n.x-=r.x,n.y-=r.y},e.prototype.computeIntersect=function(e,i,n,r){if(this._isProper=!1,!Z.intersects(e,i,n,r))return t.NO_INTERSECTION;var o=at.orientationIndex(e,i,n),s=at.orientationIndex(e,i,r);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=at.orientationIndex(n,r,e),l=at.orientationIndex(n,r,i);return a>0&&l>0||a<0&&l<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===l?this.computeCollinearIntersection(e,i,n,r):(0===o||0===s||0===a||0===l?(this._isProper=!1,e.equals2D(n)||e.equals2D(r)?this._intPt[0]=e:i.equals2D(n)||i.equals2D(r)?this._intPt[0]=i:0===o?this._intPt[0]=new S(n):0===s?this._intPt[0]=new S(r):0===a?this._intPt[0]=new S(e):0===l&&(this._intPt[0]=new S(i))):(this._isProper=!0,this._intPt[0]=this.intersection(e,i,n,r)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,i,n){var r=t,o=at.distancePointLine(t,i,n),s=at.distancePointLine(e,i,n);return s<o&&(o=s,r=e),(s=at.distancePointLine(i,t,e))<o&&(o=s,r=i),(s=at.distancePointLine(n,t,e))<o&&(o=s,r=n),r},e}(it),ot=function(){};ot.prototype.interfaces_=function(){return[]},ot.prototype.getClass=function(){return ot},ot.orientationIndex=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=i.x-e.x,s=i.y-e.y;return ot.signOfDet2x2(n,r,o,s)},ot.signOfDet2x2=function(t,e,i,n){var r=null,o=null,s=null;if(r=1,0===t||0===n)return 0===e||0===i?0:e>0?i>0?-r:r:i>0?r:-r;if(0===e||0===i)return n>0?t>0?r:-r:t>0?-r:r;if(e>0?n>0?e<=n||(r=-r,o=t,t=i,i=o,o=e,e=n,n=o):e<=-n?(r=-r,i=-i,n=-n):(o=t,t=-i,i=o,o=e,e=-n,n=o):n>0?-e<=n?(r=-r,t=-t,e=-e):(o=-t,t=i,i=o,o=-e,e=n,n=o):e>=n?(t=-t,e=-e,i=-i,n=-n):(r=-r,o=-t,t=-i,i=o,o=-e,e=-n,n=o),t>0){if(!(i>0))return r;if(!(t<=i))return r}else{if(i>0)return-r;if(!(t>=i))return-r;r=-r,t=-t,i=-i}for(;;){if((n-=(s=Math.floor(i/t))*e)<0)return-r;if(n>e)return r;if(t>(i-=s*t)+i){if(e<n+n)return r}else{if(e>n+n)return-r;i=t-i,n=e-n,r=-r}if(0===n)return 0===i?0:-r;if(0===i)return r;if((e-=(s=Math.floor(t/i))*n)<0)return r;if(e>n)return-r;if(i>(t-=s*i)+t){if(n<e+e)return-r}else{if(n>e+e)return r;t=i-t,e=n-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}};var st=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};st.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var i=t.x,n=e.x;return i>n&&(i=e.x,n=t.x),this._p.x>=i&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var r=t.x-this._p.x,o=t.y-this._p.y,s=e.x-this._p.x,a=e.y-this._p.y,l=ot.signOfDet2x2(r,o,s,a);if(0===l)return this._isPointOnSegment=!0,null;a<o&&(l=-l),l>0&&this._crossingCount++}},st.prototype.isPointInPolygon=function(){return this.getLocation()!==M.EXTERIOR},st.prototype.getLocation=function(){return this._isPointOnSegment?M.BOUNDARY:this._crossingCount%2==1?M.INTERIOR:M.EXTERIOR},st.prototype.isOnSegment=function(){return this._isPointOnSegment},st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.locatePointInRing=function(){if(arguments[0]instanceof S&&k(arguments[1],j)){for(var t=arguments[1],e=new st(arguments[0]),i=new S,n=new S,r=1;r<t.size();r++)if(t.getCoordinate(r,i),t.getCoordinate(r-1,n),e.countSegment(i,n),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof S&&arguments[1]instanceof Array){for(var o=arguments[1],s=new st(arguments[0]),a=1;a<o.length;a++){var l=o[a],c=o[a-1];if(s.countSegment(l,c),s.isOnSegment())return s.getLocation()}return s.getLocation()}};var at=function(){},lt={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};at.prototype.interfaces_=function(){return[]},at.prototype.getClass=function(){return at},at.orientationIndex=function(t,e,i){return N.orientationIndex(t,e,i)},at.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,i=t[0].x,n=1;n<t.length-1;n++){var r=t[n].x-i,o=t[n+1].y;e+=r*(t[n-1].y-o)}return e/2}if(k(arguments[0],j)){var s=arguments[0],a=s.size();if(a<3)return 0;var l=new S,c=new S,u=new S;s.getCoordinate(0,c),s.getCoordinate(1,u);var h=c.x;u.x-=h;for(var p=0,d=1;d<a-1;d++)l.y=c.y,c.x=u.x,c.y=u.y,s.getCoordinate(d+1,u),u.x-=h,p+=c.x*(l.y-u.y);return p/2}},at.distanceLineLine=function(t,e,i,n){if(t.equals(e))return at.distancePointLine(t,i,n);if(i.equals(n))return at.distancePointLine(n,t,e);var r=!1;if(Z.intersects(t,e,i,n)){var o=(e.x-t.x)*(n.y-i.y)-(e.y-t.y)*(n.x-i.x);if(0===o)r=!0;else{var s=(t.y-i.y)*(n.x-i.x)-(t.x-i.x)*(n.y-i.y),a=((t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y))/o,l=s/o;(l<0||l>1||a<0||a>1)&&(r=!0)}}else r=!0;return r?P.min(at.distancePointLine(t,i,n),at.distancePointLine(e,i,n),at.distancePointLine(i,t,e),at.distancePointLine(n,t,e)):0},at.isPointInRing=function(t,e){return at.locatePointInRing(t,e)!==M.EXTERIOR},at.computeLength=function(t){var e=t.size();if(e<=1)return 0;var i=0,n=new S;t.getCoordinate(0,n);for(var r=n.x,o=n.y,s=1;s<e;s++){t.getCoordinate(s,n);var a=n.x,l=n.y,c=a-r,u=l-o;i+=Math.sqrt(c*c+u*u),r=a,o=l}return i},at.isCCW=function(t){var e=t.length-1;if(e<3)throw new _("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],n=0,r=1;r<=e;r++){var o=t[r];o.y>i.y&&(i=o,n=r)}var s=n;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(i)&&s!==n);var a=n;do{a=(a+1)%e}while(t[a].equals2D(i)&&a!==n);var l=t[s],c=t[a];if(l.equals2D(i)||c.equals2D(i)||l.equals2D(c))return!1;var u=at.computeOrientation(l,i,c);return 0===u?l.x>c.x:u>0},at.locatePointInRing=function(t,e){return st.locatePointInRing(t,e)},at.distancePointLinePerpendicular=function(t,e,i){var n=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),r=((e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y))/n;return Math.abs(r)*Math.sqrt(n)},at.computeOrientation=function(t,e,i){return at.orientationIndex(t,e,i)},at.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new _("Line array must contain at least one vertex");for(var i=t.distance(e[0]),n=0;n<e.length-1;n++){var r=at.distancePointLine(t,e[n],e[n+1]);r<i&&(i=r)}return i}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var l=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),c=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/l;if(c<=0)return o.distance(s);if(c>=1)return o.distance(a);var u=((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/l;return Math.abs(u)*Math.sqrt(l)}},at.isOnLine=function(t,e){for(var i=new rt,n=1;n<e.length;n++){var r=e[n-1],o=e[n];if(i.computeIntersection(t,r,o),i.hasIntersection())return!0}return!1},lt.CLOCKWISE.get=function(){return-1},lt.RIGHT.get=function(){return at.CLOCKWISE},lt.COUNTERCLOCKWISE.get=function(){return 1},lt.LEFT.get=function(){return at.COUNTERCLOCKWISE},lt.COLLINEAR.get=function(){return 0},lt.STRAIGHT.get=function(){return at.COLLINEAR},Object.defineProperties(at,lt);var ct=function(){};ct.prototype.filter=function(t){},ct.prototype.interfaces_=function(){return[]},ct.prototype.getClass=function(){return ct};var ut=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},ht={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ut.prototype.isGeometryCollection=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION},ut.prototype.getFactory=function(){return this._factory},ut.prototype.getGeometryN=function(t){return this},ut.prototype.getArea=function(){return 0},ut.prototype.isRectangle=function(){return!1},ut.prototype.equals=function(){if(arguments[0]instanceof ut){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof ut))return!1;var i=e;return this.equalsExact(i)}},ut.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},ut.prototype.geometryChanged=function(){this.apply(ut.geometryChangedFilter)},ut.prototype.geometryChangedAction=function(){this._envelope=null},ut.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},ut.prototype.getLength=function(){return 0},ut.prototype.getNumGeometries=function(){return 1},ut.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var i=arguments[0],n=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,n)}},ut.prototype.getUserData=function(){return this._userData},ut.prototype.getSRID=function(){return this._SRID},ut.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ut.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION)throw new _("This method does not support GeometryCollection arguments")},ut.prototype.equal=function(t,e,i){return 0===i?t.equals(e):t.distance(e)<=i},ut.prototype.norm=function(){var t=this.copy();return t.normalize(),t},ut.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},ut.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new Z(this._envelope)},ut.prototype.setSRID=function(t){this._SRID=t},ut.prototype.setUserData=function(t){this._userData=t},ut.prototype.compare=function(t,e){for(var i=t.iterator(),n=e.iterator();i.hasNext()&&n.hasNext();){var r=i.next(),o=n.next(),s=r.compareTo(o);if(0!==s)return s}return i.hasNext()?1:n.hasNext()?-1:0},ut.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ut.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ut.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ut.SORTINDEX_MULTIPOINT||this.getSortIndex()===ut.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ut.SORTINDEX_MULTIPOLYGON},ut.prototype.interfaces_=function(){return[w,b,e]},ut.prototype.getClass=function(){return ut},ut.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},ut.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},ht.serialVersionUID.get=function(){return 0x799ea46522854c00},ht.SORTINDEX_POINT.get=function(){return 0},ht.SORTINDEX_MULTIPOINT.get=function(){return 1},ht.SORTINDEX_LINESTRING.get=function(){return 2},ht.SORTINDEX_LINEARRING.get=function(){return 3},ht.SORTINDEX_MULTILINESTRING.get=function(){return 4},ht.SORTINDEX_POLYGON.get=function(){return 5},ht.SORTINDEX_MULTIPOLYGON.get=function(){return 6},ht.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},ht.geometryChangedFilter.get=function(){return pt},Object.defineProperties(ut,ht);var pt=function(){};pt.interfaces_=function(){return[ct]},pt.filter=function(t){t.geometryChangedAction()};var dt=function(){};dt.prototype.filter=function(t){},dt.prototype.interfaces_=function(){return[]},dt.prototype.getClass=function(){return dt};var ft=function(){},mt={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ft.prototype.isInBoundary=function(t){},ft.prototype.interfaces_=function(){return[]},ft.prototype.getClass=function(){return ft},mt.Mod2BoundaryNodeRule.get=function(){return gt},mt.EndPointBoundaryNodeRule.get=function(){return yt},mt.MultiValentEndPointBoundaryNodeRule.get=function(){return _t},mt.MonoValentEndPointBoundaryNodeRule.get=function(){return vt},mt.MOD2_BOUNDARY_RULE.get=function(){return new gt},mt.ENDPOINT_BOUNDARY_RULE.get=function(){return new yt},mt.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _t},mt.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new vt},mt.OGC_SFS_BOUNDARY_RULE.get=function(){return ft.MOD2_BOUNDARY_RULE},Object.defineProperties(ft,mt);var gt=function(){};gt.prototype.isInBoundary=function(t){return t%2==1},gt.prototype.interfaces_=function(){return[ft]},gt.prototype.getClass=function(){return gt};var yt=function(){};yt.prototype.isInBoundary=function(t){return t>0},yt.prototype.interfaces_=function(){return[ft]},yt.prototype.getClass=function(){return yt};var _t=function(){};_t.prototype.isInBoundary=function(t){return t>1},_t.prototype.interfaces_=function(){return[ft]},_t.prototype.getClass=function(){return _t};var vt=function(){};vt.prototype.isInBoundary=function(t){return 1===t},vt.prototype.interfaces_=function(){return[ft]},vt.prototype.getClass=function(){return vt};var xt=function(){};xt.prototype.add=function(){},xt.prototype.addAll=function(){},xt.prototype.isEmpty=function(){},xt.prototype.iterator=function(){},xt.prototype.size=function(){},xt.prototype.toArray=function(){},xt.prototype.remove=function(){},(i.prototype=new Error).name="IndexOutOfBoundsException";var bt=function(){};bt.prototype.hasNext=function(){},bt.prototype.next=function(){},bt.prototype.remove=function(){};var wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(xt);(n.prototype=new Error).name="NoSuchElementException";var Tt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,xt]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var i=this.array_[t];return this.array_[t]=e,i},e.prototype.iterator=function(){return new St(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new i;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,i=0,n=this.array_.length;i<n;i++)if(this.array_[i]===t){this.array_.splice(i,1),e=!0;break}return e},e}(wt),St=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new n;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(bt),Ct=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.ensureCapacity(i.length),this.add(i,n)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={coordArrayType:{configurable:!0}};return i.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],i=!1,n=arguments[0].iterator();n.hasNext();)this.add(n.next(),e),i=!0;return i}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),i=0;i<this.size();i++)e.add(i,this.get(i).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){if(1===arguments.length){var e=arguments[0];t.prototype.add.call(this,e)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],n=arguments[1];return this.add(i,n,!0),!0}if(arguments[0]instanceof S&&"boolean"==typeof arguments[1]){var r=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(r))return null;t.prototype.add.call(this,r)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],s=arguments[1];return this.add(o,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var a=arguments[0],l=arguments[1];if(arguments[2])for(var c=0;c<a.length;c++)this.add(a[c],l);else for(var u=a.length-1;u>=0;u--)this.add(a[u],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof S){var h=arguments[0],p=arguments[1];if(!arguments[2]){var d=this.size();if(d>0){if(h>0&&this.get(h-1).equals2D(p))return null;if(h<d&&this.get(h).equals2D(p))return null}}t.prototype.add.call(this,h,p)}}else if(4===arguments.length){var f=arguments[0],m=arguments[1],g=arguments[2],y=arguments[3],_=1;g>y&&(_=-1);for(var v=g;v!==y;v+=_)this.add(f[v],m);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new S(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,i),e}(Tt),Et=function(){},It={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};It.ForwardComparator.get=function(){return Mt},It.BidirectionalComparator.get=function(){return At},It.coordArrayType.get=function(){return new Array(0).fill(null)},Et.prototype.interfaces_=function(){return[]},Et.prototype.getClass=function(){return Et},Et.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},Et.ptNotInList=function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(Et.indexOf(n,e)<0)return n}return null},Et.scroll=function(t,e){var i=Et.indexOf(e,t);if(i<0)return null;var n=new Array(t.length).fill(null);G.arraycopy(t,i,n,0,t.length-i),G.arraycopy(t,0,n,t.length-i,i),G.arraycopy(n,0,t,0,t.length)},Et.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(e[i]))return!1;return!0}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];if(n===r)return!0;if(null===n||null===r)return!1;if(n.length!==r.length)return!1;for(var s=0;s<n.length;s++)if(0!==o.compare(n[s],r[s]))return!1;return!0}},Et.intersection=function(t,e){for(var i=new Ct,n=0;n<t.length;n++)e.intersects(t[n])&&i.add(t[n],!0);return i.toCoordinateArray()},Et.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},Et.removeRepeatedPoints=function(t){return Et.hasRepeatedPoints(t)?new Ct(t,!1).toCoordinateArray():t},Et.reverse=function(t){for(var e=t.length-1,i=Math.trunc(e/2),n=0;n<=i;n++){var r=t[n];t[n]=t[e-n],t[e-n]=r}},Et.removeNull=function(t){for(var e=0,i=0;i<t.length;i++)null!==t[i]&&e++;var n=new Array(e).fill(null);if(0===e)return n;for(var r=0,o=0;o<t.length;o++)null!==t[o]&&(n[r++]=t[o]);return n},Et.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),i=0;i<t.length;i++)e[i]=new S(t[i]);return e}if(5===arguments.length)for(var n=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],l=0;l<a;l++)o[s+l]=new S(n[r+l])},Et.isEqualReversed=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=e[t.length-i-1];if(0!==n.compareTo(r))return!1}return!0},Et.envelope=function(t){for(var e=new Z,i=0;i<t.length;i++)e.expandToInclude(t[i]);return e},Et.toCoordinateArray=function(t){return t.toArray(Et.coordArrayType)},Et.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},Et.indexOf=function(t,e){for(var i=0;i<e.length;i++)if(t.equals(e[i]))return i;return-1},Et.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var i=t.length-1-e,n=t[e].compareTo(t[i]);if(0!==n)return n}return 1},Et.compare=function(t,e){for(var i=0;i<t.length&&i<e.length;){var n=t[i].compareTo(e[i]);if(0!==n)return n;i++}return i<e.length?-1:i<t.length?1:0},Et.minCoordinate=function(t){for(var e=null,i=0;i<t.length;i++)(null===e||e.compareTo(t[i])>0)&&(e=t[i]);return e},Et.extract=function(t,e,i){e=P.clamp(e,0,t.length);var n=(i=P.clamp(i,-1,t.length))-e+1;i<0&&(n=0),e>=t.length&&(n=0),i<e&&(n=0);var r=new Array(n).fill(null);if(0===n)return r;for(var o=0,s=e;s<=i;s++)r[o++]=t[s];return r},Object.defineProperties(Et,It);var Mt=function(){};Mt.prototype.compare=function(t,e){return Et.compare(t,e)},Mt.prototype.interfaces_=function(){return[T]},Mt.prototype.getClass=function(){return Mt};var At=function(){};At.prototype.compare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;var r=Et.compare(i,n);return Et.isEqualReversed(i,n)?0:r},At.prototype.OLDcompare=function(t,e){var i=t,n=e;if(i.length<n.length)return-1;if(i.length>n.length)return 1;if(0===i.length)return 0;for(var r=Et.increasingDirection(i),o=Et.increasingDirection(n),s=r>0?0:i.length-1,a=o>0?0:i.length-1,l=0;l<i.length;l++){var c=i[s].compareTo(n[a]);if(0!==c)return c;s+=r,a+=o}return 0},At.prototype.interfaces_=function(){return[T]},At.prototype.getClass=function(){return At};var kt=function(){};kt.prototype.get=function(){},kt.prototype.put=function(){},kt.prototype.size=function(){},kt.prototype.values=function(){},kt.prototype.entrySet=function(){};var Pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(kt);(r.prototype=new Error).name="OperationNotSupported",(o.prototype=new xt).contains=function(){};var Lt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof xt&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new zt(this)},e}(o),zt=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new n;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new r},e}(bt),Dt=0;(h.prototype=new Pt).get=function(t){for(var e=this.root_;null!==e;){var i=t.compareTo(e.key);if(i<0)e=e.left;else{if(!(i>0))return e.value;e=e.right}}return null},h.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Dt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var i,n,r=this.root_;do{if(i=r,(n=t.compareTo(r.key))<0)r=r.left;else{if(!(n>0)){var o=r.value;return r.value=e,o}r=r.right}}while(null!==r);var s={key:t,left:null,right:null,value:e,parent:i,color:Dt,getValue:function(){return this.value},getKey:function(){return this.key}};return n<0?i.left=s:i.right=s,this.fixAfterInsertion(s),this.size_++,null},h.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(a(t)===c(a(a(t)))){var e=u(a(a(t)));1===s(e)?(l(a(t),Dt),l(e,Dt),l(a(a(t)),1),t=a(a(t))):(t===u(a(t))&&(t=a(t),this.rotateLeft(t)),l(a(t),Dt),l(a(a(t)),1),this.rotateRight(a(a(t))))}else{var i=c(a(a(t)));1===s(i)?(l(a(t),Dt),l(i,Dt),l(a(a(t)),1),t=a(a(t))):(t===c(a(t))&&(t=a(t),this.rotateRight(t)),l(a(t),Dt),l(a(a(t)),1),this.rotateLeft(a(a(t))))}this.root_.color=Dt},h.prototype.values=function(){var t=new Tt,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=h.successor(e));)t.add(e.value);return t},h.prototype.entrySet=function(){var t=new Lt,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=h.successor(e));)t.add(e);return t},h.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},h.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},h.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},h.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var i=t.parent,n=t;null!==i&&n===i.right;)n=i,i=i.parent;return i},h.prototype.size=function(){return this.size_};var Rt=function(){};Rt.prototype.interfaces_=function(){return[]},Rt.prototype.getClass=function(){return Rt},p.prototype=new o,(d.prototype=new p).contains=function(t){for(var e=0,i=this.array_.length;e<i;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},d.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,i=this.array_.length;e<i;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},d.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},d.prototype.remove=function(t){throw new r},d.prototype.size=function(){return this.array_.length},d.prototype.isEmpty=function(){return 0===this.array_.length},d.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t},d.prototype.iterator=function(){return new Ot(this)};var Ot=function(t){this.treeSet_=t,this.position_=0};Ot.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new n;return this.treeSet_.array_[this.position_++]},Ot.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ot.prototype.remove=function(){throw new r};var Ft=function(){};Ft.sort=function(){var t,e,i,n,r=arguments[0];if(1===arguments.length)n=function(t,e){return t.compareTo(e)},r.sort(n);else if(2===arguments.length)i=arguments[1],n=function(t,e){return i.compare(t,e)},r.sort(n);else if(3===arguments.length){(e=r.slice(arguments[1],arguments[2])).sort();var o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])}else if(4===arguments.length)for(e=r.slice(arguments[1],arguments[2]),i=arguments[3],n=function(t,e){return i.compare(t,e)},e.sort(n),o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])},Ft.asList=function(t){for(var e=new Tt,i=0,n=t.length;i<n;i++)e.add(t[i]);return e};var Nt=function(){},Bt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Bt.P.get=function(){return 0},Bt.L.get=function(){return 1},Bt.A.get=function(){return 2},Bt.FALSE.get=function(){return-1},Bt.TRUE.get=function(){return-2},Bt.DONTCARE.get=function(){return-3},Bt.SYM_FALSE.get=function(){return"F"},Bt.SYM_TRUE.get=function(){return"T"},Bt.SYM_DONTCARE.get=function(){return"*"},Bt.SYM_P.get=function(){return"0"},Bt.SYM_L.get=function(){return"1"},Bt.SYM_A.get=function(){return"2"},Nt.prototype.interfaces_=function(){return[]},Nt.prototype.getClass=function(){return Nt},Nt.toDimensionSymbol=function(t){switch(t){case Nt.FALSE:return Nt.SYM_FALSE;case Nt.TRUE:return Nt.SYM_TRUE;case Nt.DONTCARE:return Nt.SYM_DONTCARE;case Nt.P:return Nt.SYM_P;case Nt.L:return Nt.SYM_L;case Nt.A:return Nt.SYM_A}throw new _("Unknown dimension value: "+t)},Nt.toDimensionValue=function(t){switch(R.toUpperCase(t)){case Nt.SYM_FALSE:return Nt.FALSE;case Nt.SYM_TRUE:return Nt.TRUE;case Nt.SYM_DONTCARE:return Nt.DONTCARE;case Nt.SYM_P:return Nt.P;case Nt.SYM_L:return Nt.L;case Nt.SYM_A:return Nt.A}throw new _("Unknown dimension symbol: "+t)},Object.defineProperties(Nt,Bt);var jt=function(){};jt.prototype.filter=function(t){},jt.prototype.interfaces_=function(){return[]},jt.prototype.getClass=function(){return jt};var $t=function(){};$t.prototype.filter=function(t,e){},$t.prototype.isDone=function(){},$t.prototype.isGeometryChanged=function(){},$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t};var Ut=function(t){function e(e,i){if(t.call(this,i),this._geometries=e||[],t.hasNullElements(this._geometries))throw new _("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new Z,e=0;e<this._geometries.length;e++)t.expandToInclude(this._geometries[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this._geometries[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=0;i<this._geometries.length;i++)for(var n=this._geometries[i].getCoordinates(),r=0;r<n.length;r++)t[++e]=n[r];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._geometries.length!==n._geometries.length)return!1;for(var r=0;r<this._geometries.length;r++)if(!this._geometries[r].equalsExact(n._geometries[r],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this._geometries.length;t++)this._geometries[t].normalize();Ft.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Nt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Nt.FALSE,e=0;e<this._geometries.length;e++)t=Math.max(t,this._geometries[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this._geometries.length;e++)t+=this._geometries[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createGeometryCollection(e)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new d(Ft.asList(this._geometries)),i=new d(Ft.asList(t._geometries));return this.compare(e,i)}if(2===arguments.length){for(var n=arguments[1],r=arguments[0],o=this.getNumGeometries(),s=r.getNumGeometries(),a=0;a<o&&a<s;){var l=this.getGeometryN(a),c=r.getGeometryN(a),u=l.compareToSameClass(c,n);if(0!==u)return u;a++}return a<o?1:a<s?-1:0}},e.prototype.apply=function(){if(k(arguments[0],dt))for(var t=arguments[0],e=0;e<this._geometries.length;e++)this._geometries[e].apply(t);else if(k(arguments[0],$t)){var i=arguments[0];if(0===this._geometries.length)return null;for(var n=0;n<this._geometries.length&&(this._geometries[n].apply(i),!i.isDone());n++);i.isGeometryChanged()&&this.geometryChanged()}else if(k(arguments[0],jt)){var r=arguments[0];r.filter(this);for(var o=0;o<this._geometries.length;o++)this._geometries[o].apply(r)}else if(k(arguments[0],ct)){var s=arguments[0];s.filter(this);for(var a=0;a<this._geometries.length;a++)this._geometries[a].apply(s)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._geometries=new Array(this._geometries.length).fill(null);for(var i=0;i<this._geometries.length;i++)e._geometries[i]=this._geometries[i].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.isEmpty=function(){for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,i),e}(ut),Vt=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Nt.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this._geometries.length;t++)if(!this._geometries[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[t-1-i]=this._geometries[i].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Gt(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Rt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,i),e}(Ut),Gt=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var t=arguments[0],e=ft.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=n}};Gt.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)},Gt.prototype.getBoundary=function(){return this._geom instanceof Xt?this.boundaryLineString(this._geom):this._geom instanceof Vt?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Gt.prototype.boundaryLineString=function(t){return this._geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this._bnRule.isInBoundary(2)?t.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Gt.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Gt.prototype.computeBoundaryCoordinates=function(t){var e=new Tt;this._endpointMap=new h;for(var i=0;i<t.getNumGeometries();i++){var n=t.getGeometryN(i);0!==n.getNumPoints()&&(this.addEndpoint(n.getCoordinateN(0)),this.addEndpoint(n.getCoordinateN(n.getNumPoints()-1)))}for(var r=this._endpointMap.entrySet().iterator();r.hasNext();){var o=r.next(),s=o.getValue().count;this._bnRule.isInBoundary(s)&&e.add(o.getKey())}return Et.toCoordinateArray(e)},Gt.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);null===e&&(e=new qt,this._endpointMap.put(t,e)),e.count++},Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt},Gt.getBoundary=function(){return 1===arguments.length?new Gt(arguments[0]).getBoundary():2===arguments.length?new Gt(arguments[0],arguments[1]).getBoundary():void 0};var qt=function(){this.count=null};qt.prototype.interfaces_=function(){return[]},qt.prototype.getClass=function(){return qt};var Zt=function(){},Wt={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Zt.prototype.interfaces_=function(){return[]},Zt.prototype.getClass=function(){return Zt},Zt.chars=function(t,e){for(var i=new Array(e).fill(null),n=0;n<e;n++)i[n]=t;return String(i)},Zt.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new function(){},i=new function(){}(e);return t.printStackTrace(i),e.toString()}if(2===arguments.length){for(var n=arguments[0],r=arguments[1],o="",s=new function(){}(new function(){}(Zt.getStackTrace(n))),a=0;a<r;a++)try{o+=s.readLine()+Zt.NEWLINE}catch(t){if(!(t instanceof f))throw t;et.shouldNeverReachHere()}return o}},Zt.split=function(t,e){for(var i=e.length,n=new Tt,r=""+t,o=r.indexOf(e);o>=0;){var s=r.substring(0,o);n.add(s),o=(r=r.substring(o+i)).indexOf(e)}r.length>0&&n.add(r);for(var a=new Array(n.size()).fill(null),l=0;l<a.length;l++)a[l]=n.get(l);return a},Zt.toString=function(){if(1===arguments.length){var t=arguments[0];return Zt.SIMPLE_ORDINATE_FORMAT.format(t)}},Zt.spaces=function(t){return Zt.chars(" ",t)},Wt.NEWLINE.get=function(){return G.getProperty("line.separator")},Wt.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Zt,Wt);var Ht=function(){};Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht},Ht.copyCoord=function(t,e,i,n){for(var r=Math.min(t.getDimension(),i.getDimension()),o=0;o<r;o++)i.setOrdinate(n,o,t.getOrdinate(e,o))},Ht.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,j.X)===t.getOrdinate(e-1,j.X)&&t.getOrdinate(0,j.Y)===t.getOrdinate(e-1,j.Y)},Ht.isEqual=function(t,e){var i=t.size();if(i!==e.size())return!1;for(var n=Math.min(t.getDimension(),e.getDimension()),r=0;r<i;r++)for(var o=0;o<n;o++){var s=t.getOrdinate(r,o),a=e.getOrdinate(r,o);if(!(t.getOrdinate(r,o)===e.getOrdinate(r,o)||v.isNaN(s)&&v.isNaN(a)))return!1}return!0},Ht.extend=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();if(Ht.copy(e,0,n,0,r),r>0)for(var o=r;o<i;o++)Ht.copy(e,r-1,n,o,1);return n},Ht.reverse=function(t){for(var e=t.size()-1,i=Math.trunc(e/2),n=0;n<=i;n++)Ht.swap(t,n,e-n)},Ht.swap=function(t,e,i){if(e===i)return null;for(var n=0;n<t.getDimension();n++){var r=t.getOrdinate(e,n);t.setOrdinate(e,n,t.getOrdinate(i,n)),t.setOrdinate(i,n,r)}},Ht.copy=function(t,e,i,n,r){for(var o=0;o<r;o++)Ht.copyCoord(t,e+o,i,n+o)},Ht.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var i=t.getDimension(),n=new z;n.append("(");for(var r=0;r<e;r++){r>0&&n.append(" ");for(var o=0;o<i;o++)o>0&&n.append(","),n.append(Zt.toString(t.getOrdinate(r,o)))}return n.append(")"),n.toString()}},Ht.ensureValidRing=function(t,e){var i=e.size();return 0===i?e:i<=3?Ht.createClosedRing(t,e,4):e.getOrdinate(0,j.X)===e.getOrdinate(i-1,j.X)&&e.getOrdinate(0,j.Y)===e.getOrdinate(i-1,j.Y)?e:Ht.createClosedRing(t,e,i+1)},Ht.createClosedRing=function(t,e,i){var n=t.create(i,e.getDimension()),r=e.size();Ht.copy(e,0,n,0,r);for(var o=r;o<i;o++)Ht.copy(e,0,n,o,1);return n};var Xt=function(t){function e(e,i){t.call(this,i),this._points=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Z:this._points.expandEnvelope(new Z)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e;if(this._points.size()!==n._points.size())return!1;for(var r=0;r<this._points.size();r++)if(!this.equal(this._points.getCoordinate(r),n._points.getCoordinate(r),i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<Math.trunc(this._points.size()/2);t++){var e=this._points.size()-1-t;if(!this._points.getCoordinate(t).equals(this._points.getCoordinate(e)))return this._points.getCoordinate(t).compareTo(this._points.getCoordinate(e))>0&&Ht.reverse(this._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Nt.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return at.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var t=this._points.copy();return Ht.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,i=0;e<this._points.size()&&i<t._points.size();){var n=this._points.getCoordinate(e).compareTo(t._points.getCoordinate(i));if(0!==n)return n;e++,i++}return e<this._points.size()?1:i<t._points.size()?-1:0}if(2===arguments.length){var r=arguments[0];return arguments[1].compare(this._points,r._points)}},e.prototype.apply=function(){if(k(arguments[0],dt))for(var t=arguments[0],e=0;e<this._points.size();e++)t.filter(this._points.getCoordinate(e));else if(k(arguments[0],$t)){var i=arguments[0];if(0===this._points.size())return null;for(var n=0;n<this._points.size()&&(i.filter(this._points,n),!i.isDone());n++);i.isGeometryChanged()&&this.geometryChanged()}else(k(arguments[0],jt)||k(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Gt(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._points=this._points.clone(),e},e.prototype.getCoordinateN=function(t){return this._points.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return 0===this._points.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new _("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this._points=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this._points.size();e++)if(this._points.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this._points.getCoordinate(t))},e.prototype.interfaces_=function(){return[Rt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,i),e}(ut),Yt=function(){};Yt.prototype.interfaces_=function(){return[]},Yt.prototype.getClass=function(){return Yt};var Kt=function(t){function e(e,i){t.call(this,i),this._coordinates=e||null,this.init(this._coordinates)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Z;var t=new Z;return t.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),i))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Nt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var e=arguments[0];return arguments[1].compare(this._coordinates,e._coordinates)}},e.prototype.apply=function(){if(k(arguments[0],dt)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(k(arguments[0],$t)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this._coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else(k(arguments[0],jt)||k(arguments[0],ct))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e._coordinates=this._coordinates.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this._coordinates.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(t.size()<=1),this._coordinates=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Yt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,i),e}(ut),Jt=function(){};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt};var Qt=function(t){function e(e,i,n){if(t.call(this,n),this._shell=null,this._holes=null,null===e&&(e=this.getFactory().createLinearRing()),null===i&&(i=[]),t.hasNullElements(i))throw new _("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(i))throw new _("shell is empty but holes are not");this._shell=e,this._holes=i}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,i=this._shell.getCoordinates(),n=0;n<i.length;n++)t[++e]=i[n];for(var r=0;r<this._holes.length;r++)for(var o=this._holes[r].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(at.signedArea(this._shell.getCoordinateSequence()));for(var e=0;e<this._holes.length;e++)t-=Math.abs(at.signedArea(this._holes[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this._shell)return!1;if(5!==this._shell.getNumPoints())return!1;for(var t=this._shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),i=0;i<5;i++){var n=t.getX(i);if(n!==e.getMinX()&&n!==e.getMaxX())return!1;var r=t.getY(i);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var l=t.getX(a),c=t.getY(a);if(l!==o==(c!==s))return!1;o=l,s=c}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];if(!this.isEquivalentClass(e))return!1;var n=e,r=this._shell,o=n._shell;if(!r.equalsExact(o,i))return!1;if(this._holes.length!==n._holes.length)return!1;for(var s=0;s<this._holes.length;s++)if(!this._holes[s].equalsExact(n._holes[s],i))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var t=0;t<this._holes.length;t++)this.normalize(this._holes[t],!1);Ft.sort(this._holes)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(e.isEmpty())return null;var n=new Array(e.getCoordinates().length-1).fill(null);G.arraycopy(e.getCoordinates(),0,n,0,n.length);var r=Et.minCoordinate(e.getCoordinates());Et.scroll(n,r),G.arraycopy(n,0,e.getCoordinates(),0,n.length),e.getCoordinates()[n.length]=n[0],at.isCCW(e.getCoordinates())===i&&Et.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this._shell.getLength();for(var e=0;e<this._holes.length;e++)t+=this._holes[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this._shell.getNumPoints(),e=0;e<this._holes.length;e++)t+=this._holes[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t._shell=this._shell.copy().reverse(),t._holes=new Array(this._holes.length).fill(null);for(var e=0;e<this._holes.length;e++)t._holes[e]=this._holes[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=this._shell,i=t._shell;return e.compareToSameClass(i)}if(2===arguments.length){var n=arguments[1],r=arguments[0],o=this._shell,s=r._shell,a=o.compareToSameClass(s,n);if(0!==a)return a;for(var l=this.getNumInteriorRing(),c=r.getNumInteriorRing(),u=0;u<l&&u<c;){var h=this.getInteriorRingN(u),p=r.getInteriorRingN(u),d=h.compareToSameClass(p,n);if(0!==d)return d;u++}return u<l?1:u<c?-1:0}},e.prototype.apply=function(t){if(k(t,dt)){this._shell.apply(t);for(var e=0;e<this._holes.length;e++)this._holes[e].apply(t)}else if(k(t,$t)){if(this._shell.apply(t),!t.isDone())for(var i=0;i<this._holes.length&&(this._holes[i].apply(t),!t.isDone());i++);t.isGeometryChanged()&&this.geometryChanged()}else if(k(t,jt))t.filter(this);else if(k(t,ct)){t.filter(this),this._shell.apply(t);for(var n=0;n<this._holes.length;n++)this._holes[n].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this._holes.length+1).fill(null);t[0]=this._shell;for(var e=0;e<this._holes.length;e++)t[e+1]=this._holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e._shell=this._shell.clone(),e._holes=new Array(this._holes.length).fill(null);for(var i=0;i<this._holes.length;i++)e._holes[i]=this._holes[i].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this._shell.copy(),i=new Array(this._holes.length).fill(null),n=0;n<i.length;n++)i[n]=this._holes[n].copy();return new e(t,i,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(t){return this._holes[t]},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,i),e}(ut),te=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(1===arguments.length){var e=arguments[0];return this._geometries[e].getCoordinate()}return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Nt.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Yt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,i),e}(Ut),ee=function(t){function e(e,i){e instanceof S&&i instanceof ye&&(e=i.getCoordinateSequenceFactory().create(e)),t.call(this,e,i),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Nt.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this._points.copy();return Ht.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new _("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new _("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.MINIMUM_VALID_SIZE.get=function(){return 4},i.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,i),e}(Xt),ie=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return ut.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,i)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=this._geometries.length,e=new Array(t).fill(null),i=0;i<this._geometries.length;i++)e[i]=this._geometries[i].reverse();return this.getFactory().createMultiPolygon(e)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new Tt,e=0;e<this._geometries.length;e++)for(var i=this._geometries[e].getBoundary(),n=0;n<i.getNumGeometries();n++)t.add(i.getGeometryN(n));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this._geometries.length).fill(null),i=0;i<t.length;i++)t[i]=this._geometries[i].copy();return new e(t,this._factory)},e.prototype.interfaces_=function(){return[Jt]},e.prototype.getClass=function(){return e},i.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,i),e}(Ut),ne=function(t){this._factory=t||null,this._isUserDataCopied=!1},re={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ne.prototype.setCopyUserData=function(t){this._isUserDataCopied=t},ne.prototype.edit=function(t,e){if(null===t)return null;var i=this.editInternal(t,e);return this._isUserDataCopied&&i.setUserData(t.getUserData()),i},ne.prototype.editInternal=function(t,e){return null===this._factory&&(this._factory=t.getFactory()),t instanceof Ut?this.editGeometryCollection(t,e):t instanceof Qt?this.editPolygon(t,e):t instanceof Kt||t instanceof Xt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},ne.prototype.editGeometryCollection=function(t,e){for(var i=e.edit(t,this._factory),n=new Tt,r=0;r<i.getNumGeometries();r++){var o=this.edit(i.getGeometryN(r),e);null===o||o.isEmpty()||n.add(o)}return i.getClass()===te?this._factory.createMultiPoint(n.toArray([])):i.getClass()===Vt?this._factory.createMultiLineString(n.toArray([])):i.getClass()===ie?this._factory.createMultiPolygon(n.toArray([])):this._factory.createGeometryCollection(n.toArray([]))},ne.prototype.editPolygon=function(t,e){var i=e.edit(t,this._factory);if(null===i&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var n=this.edit(i.getExteriorRing(),e);if(null===n||n.isEmpty())return this._factory.createPolygon();for(var r=new Tt,o=0;o<i.getNumInteriorRing();o++){var s=this.edit(i.getInteriorRingN(o),e);null===s||s.isEmpty()||r.add(s)}return this._factory.createPolygon(n,r.toArray([]))},ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne},ne.GeometryEditorOperation=function(){},re.NoOpGeometryOperation.get=function(){return oe},re.CoordinateOperation.get=function(){return se},re.CoordinateSequenceOperation.get=function(){return ae},Object.defineProperties(ne,re);var oe=function(){};oe.prototype.edit=function(t,e){return t},oe.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},oe.prototype.getClass=function(){return oe};var se=function(){};se.prototype.edit=function(t,e){var i=this.editCoordinates(t.getCoordinates(),t);return null===i?t:t instanceof ee?e.createLinearRing(i):t instanceof Xt?e.createLineString(i):t instanceof Kt?i.length>0?e.createPoint(i[0]):e.createPoint():t},se.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},se.prototype.getClass=function(){return se};var ae=function(){};ae.prototype.edit=function(t,e){return t instanceof ee?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Xt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Kt?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},ae.prototype.interfaces_=function(){return[ne.GeometryEditorOperation]},ae.prototype.getClass=function(){return ae};var le=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var e=0;e<t;e++)this._coordinates[e]=new S}else if(k(arguments[0],j)){var i=arguments[0];if(null===i)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var n=0;n<this._coordinates.length;n++)this._coordinates[n]=i.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var r=arguments[0],o=arguments[1];this._coordinates=r,this._dimension=o,null===r&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var s=arguments[0],a=arguments[1];this._coordinates=new Array(s).fill(null),this._dimension=a;for(var l=0;l<s;l++)this._coordinates[l]=new S}},ce={serialVersionUID:{configurable:!0}};le.prototype.setOrdinate=function(t,e,i){switch(e){case j.X:this._coordinates[t].x=i;break;case j.Y:this._coordinates[t].y=i;break;case j.Z:this._coordinates[t].z=i;break;default:throw new _("invalid ordinateIndex")}},le.prototype.size=function(){return this._coordinates.length},le.prototype.getOrdinate=function(t,e){switch(e){case j.X:return this._coordinates[t].x;case j.Y:return this._coordinates[t].y;case j.Z:return this._coordinates[t].z}return v.NaN},le.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this._coordinates[t]}if(2===arguments.length){var e=arguments[0],i=arguments[1];i.x=this._coordinates[e].x,i.y=this._coordinates[e].y,i.z=this._coordinates[e].z}},le.prototype.getCoordinateCopy=function(t){return new S(this._coordinates[t])},le.prototype.getDimension=function(){return this._dimension},le.prototype.getX=function(t){return this._coordinates[t].x},le.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].clone();return new le(t,this._dimension)},le.prototype.expandEnvelope=function(t){for(var e=0;e<this._coordinates.length;e++)t.expandToInclude(this._coordinates[e]);return t},le.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this._coordinates.length;e++)t[e]=this._coordinates[e].copy();return new le(t,this._dimension)},le.prototype.toString=function(){if(this._coordinates.length>0){var t=new z(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var e=1;e<this._coordinates.length;e++)t.append(", "),t.append(this._coordinates[e]);return t.append(")"),t.toString()}return"()"},le.prototype.getY=function(t){return this._coordinates[t].y},le.prototype.toCoordinateArray=function(){return this._coordinates},le.prototype.interfaces_=function(){return[j,e]},le.prototype.getClass=function(){return le},ce.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(le,ce);var ue=function(){},he={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};ue.prototype.readResolve=function(){return ue.instance()},ue.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new le(arguments[0]);if(k(arguments[0],j))return new le(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new le(t):new le(t,e)}},ue.prototype.interfaces_=function(){return[I,e]},ue.prototype.getClass=function(){return ue},ue.instance=function(){return ue.instanceObject},he.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},he.instanceObject.get=function(){return new ue},Object.defineProperties(ue,he);var pe=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new Tt,e=this.map_.values(),i=e.next();!i.done;)t.add(i.value),i=e.next();return t},e.prototype.entrySet=function(){var t=new Lt;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(kt),de=function t(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof me){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var i=arguments[0];this._modelType=t.FIXED,this.setScale(i)}else if(arguments[0]instanceof t){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}},fe={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};de.prototype.equals=function(t){if(!(t instanceof de))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale},de.prototype.compareTo=function(t){var e=t,i=this.getMaximumSignificantDigits(),n=e.getMaximumSignificantDigits();return new D(i).compareTo(new D(n))},de.prototype.getScale=function(){return this._scale},de.prototype.isFloating=function(){return this._modelType===de.FLOATING||this._modelType===de.FLOATING_SINGLE},de.prototype.getType=function(){return this._modelType},de.prototype.toString=function(){var t="UNKNOWN";return this._modelType===de.FLOATING?t="Floating":this._modelType===de.FLOATING_SINGLE?t="Floating-Single":this._modelType===de.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},de.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return v.isNaN(t)||this._modelType===de.FLOATING_SINGLE?t:this._modelType===de.FIXED?Math.round(t*this._scale)/this._scale:t}if(arguments[0]instanceof S){var e=arguments[0];if(this._modelType===de.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},de.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===de.FLOATING?t=16:this._modelType===de.FLOATING_SINGLE?t=6:this._modelType===de.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},de.prototype.setScale=function(t){this._scale=Math.abs(t)},de.prototype.interfaces_=function(){return[e,b]},de.prototype.getClass=function(){return de},de.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},fe.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},fe.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(de,fe);var me=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},ge={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};me.prototype.readResolve=function(){return me.nameToTypeMap.get(this._name)},me.prototype.toString=function(){return this._name},me.prototype.interfaces_=function(){return[e]},me.prototype.getClass=function(){return me},ge.serialVersionUID.get=function(){return-552860263173159e4},ge.nameToTypeMap.get=function(){return new pe},Object.defineProperties(me,ge),de.Type=me,de.FIXED=new me("FIXED"),de.FLOATING=new me("FLOATING"),de.FLOATING_SINGLE=new me("FLOATING SINGLE");var ye=function t(){this._precisionModel=new de,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?k(arguments[0],I)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof de&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},_e={serialVersionUID:{configurable:!0}};ye.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new S(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new S(t.getMinX(),t.getMinY()),new S(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new S(t.getMinX(),t.getMinY()),new S(t.getMinX(),t.getMaxY()),new S(t.getMaxX(),t.getMaxY()),new S(t.getMaxX(),t.getMinY()),new S(t.getMinX(),t.getMinY())]),null)},ye.prototype.createLineString=function(t){return t?t instanceof Array?new Xt(this.getCoordinateSequenceFactory().create(t),this):k(t,j)?new Xt(t,this):void 0:new Xt(this.getCoordinateSequenceFactory().create([]),this)},ye.prototype.createMultiLineString=function(){return 0===arguments.length?new Vt(null,this):1===arguments.length?new Vt(arguments[0],this):void 0},ye.prototype.buildGeometry=function(t){for(var e=null,i=!1,n=!1,r=t.iterator();r.hasNext();){var o=r.next(),s=o.getClass();null===e&&(e=s),s!==e&&(i=!0),o.isGeometryCollectionOrDerived()&&(n=!0)}if(null===e)return this.createGeometryCollection();if(i||n)return this.createGeometryCollection(ye.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Qt)return this.createMultiPolygon(ye.toPolygonArray(t));if(a instanceof Xt)return this.createMultiLineString(ye.toLineStringArray(t));if(a instanceof Kt)return this.createMultiPoint(ye.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},ye.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},ye.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof S){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(k(arguments[0],j))return new Kt(arguments[0],this)}},ye.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},ye.prototype.createPolygon=function(){if(0===arguments.length)return new Qt(null,null,this);if(1===arguments.length){if(k(arguments[0],j)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof ee){var i=arguments[0];return this.createPolygon(i,null)}}else if(2===arguments.length)return new Qt(arguments[0],arguments[1],this)},ye.prototype.getSRID=function(){return this._SRID},ye.prototype.createGeometryCollection=function(){return 0===arguments.length?new Ut(null,this):1===arguments.length?new Ut(arguments[0],this):void 0},ye.prototype.createGeometry=function(t){return new ne(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return this._coordinateSequenceFactory.create(t)}}})},ye.prototype.getPrecisionModel=function(){return this._precisionModel},ye.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(k(arguments[0],j))return new ee(arguments[0],this)}},ye.prototype.createMultiPolygon=function(){return 0===arguments.length?new ie(null,this):1===arguments.length?new ie(arguments[0],this):void 0},ye.prototype.createMultiPoint=function(){if(0===arguments.length)return new te(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new te(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(k(arguments[0],j)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(e.size()).fill(null),n=0;n<e.size();n++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension());Ht.copy(e,n,r,0,1),i[n]=this.createPoint(r)}return this.createMultiPoint(i)}}},ye.prototype.interfaces_=function(){return[e]},ye.prototype.getClass=function(){return ye},ye.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.getDefaultCoordinateSequenceFactory=function(){return ue.instance()},ye.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},ye.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},_e.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(ye,_e);var ve=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],xe=function(t){this.geometryFactory=t||new ye};xe.prototype.read=function(t){var e,i=(e="string"==typeof t?JSON.parse(t):t).type;if(!be[i])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==ve.indexOf(i)?be[i].apply(this,[e.coordinates]):"GeometryCollection"===i?be[i].apply(this,[e.geometries]):be[i].apply(this,[e])},xe.prototype.write=function(t){var e=t.getGeometryType();if(!we[e])throw new Error("Geometry is not supported");return we[e].apply(this,[t])};var be={Feature:function(t){var e={};for(var i in t)e[i]=t[i];if(t.geometry){var n=t.geometry.type;if(!be[n])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=be.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var i=0;i<t.features.length;++i)e.features.push(this.read(t.features[i]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(new S(n[0],n[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new S(t[0],t[1]),new S(t[2],t[1]),new S(t[2],t[3]),new S(t[0],t[3]),new S(t[0],t[1])])},Point:function(t){var e=new S(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],i=0;i<t.length;++i)e.push(be.Point.apply(this,[t[i]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=be.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],i=0;i<t.length;++i)e.push(be.LineString.apply(this,[t[i]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=be.coordinates.apply(this,[t[0]]),i=this.geometryFactory.createLinearRing(e),n=[],r=1;r<t.length;++r){var o=t[r],s=be.coordinates.apply(this,[o]),a=this.geometryFactory.createLinearRing(s);n.push(a)}return this.geometryFactory.createPolygon(i,n)},MultiPolygon:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(be.Polygon.apply(this,[n]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],i=0;i<t.length;++i){var n=t[i];e.push(this.read(n))}return this.geometryFactory.createGeometryCollection(e)}},we={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:we.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.Point.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],i=t.getCoordinates(),n=0;n<i.length;++n){var r=i[n];e.push(we.coordinate.apply(this,[r]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.LineString.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],i=we.LineString.apply(this,[t._shell]);e.push(i.coordinates);for(var n=0;n<t._holes.length;++n){var r=t._holes[n],o=we.LineString.apply(this,[r]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=we.Polygon.apply(this,[n]);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],i=0;i<t._geometries.length;++i){var n=t._geometries[i],r=n.getGeometryType();e.push(we[r].apply(this,[n]))}return{type:"GeometryCollection",geometries:e}}},Te=function(t){this.geometryFactory=t||new ye,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new xe(this.geometryFactory)};Te.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===de.FIXED&&this.reducePrecision(e),e},Te.prototype.reducePrecision=function(t){var e,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,i=t.points.length;e<i;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,i=t.geometries.length;e<i;e++)this.reducePrecision(t.geometries[e])};var Se=function(){this.parser=new xe(this.geometryFactory)};Se.prototype.write=function(t){return this.parser.write(t)};var Ce=function(){},Ee={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Ce.prototype.interfaces_=function(){return[]},Ce.prototype.getClass=function(){return Ce},Ce.opposite=function(t){return t===Ce.LEFT?Ce.RIGHT:t===Ce.RIGHT?Ce.LEFT:t},Ee.ON.get=function(){return 0},Ee.LEFT.get=function(){return 1},Ee.RIGHT.get=function(){return 2},Object.defineProperties(Ce,Ee),(m.prototype=new Error).name="EmptyStackException",(g.prototype=new wt).add=function(t){return this.array_.push(t),!0},g.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},g.prototype.push=function(t){return this.array_.push(t),t},g.prototype.pop=function(t){if(0===this.array_.length)throw new m;return this.array_.pop()},g.prototype.peek=function(){if(0===this.array_.length)throw new m;return this.array_[this.array_.length-1]},g.prototype.empty=function(){return 0===this.array_.length},g.prototype.isEmpty=function(){return this.empty()},g.prototype.search=function(t){return this.array_.indexOf(t)},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var t=[],e=0,i=this.array_.length;e<i;e++)t.push(this.array_[e]);return t};var Ie=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ie.prototype.getCoordinate=function(){return this._minCoord},Ie.prototype.getRightmostSide=function(t,e){var i=this.getRightmostSideOfSegment(t,e);return i<0&&(i=this.getRightmostSideOfSegment(t,e-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),i},Ie.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],i=t[this._minIndex+1],n=at.computeOrientation(this._minCoord,i,e),r=!1;(e.y<this._minCoord.y&&i.y<this._minCoord.y&&n===at.COUNTERCLOCKWISE||e.y>this._minCoord.y&&i.y>this._minCoord.y&&n===at.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)},Ie.prototype.getRightmostSideOfSegment=function(t,e){var i=t.getEdge().getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var n=Ce.LEFT;return i[e].y<i[e+1].y&&(n=Ce.RIGHT),n},Ie.prototype.getEdge=function(){return this._orientedDe},Ie.prototype.checkForRightmostCoordinate=function(t){for(var e=t.getEdge().getCoordinates(),i=0;i<e.length-1;i++)(null===this._minCoord||e[i].x>this._minCoord.x)&&(this._minDe=t,this._minIndex=i,this._minCoord=e[i])},Ie.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode().getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ie.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();i.isForward()&&this.checkForRightmostCoordinate(i)}et.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ce.LEFT&&(this._orientedDe=this._minDe.getSym())},Ie.prototype.interfaces_=function(){return[]},Ie.prototype.getClass=function(){return Ie};var Me=function(t){function e(i,n){t.call(this,e.msgWithCoord(i,n)),this.pt=n?new S(n):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(Q),Ae=function(){this.array_=[]};Ae.prototype.addLast=function(t){this.array_.push(t)},Ae.prototype.removeFirst=function(){return this.array_.shift()},Ae.prototype.isEmpty=function(){return 0===this.array_.length};var ke=function(){this._finder=null,this._dirEdgeList=new Tt,this._nodes=new Tt,this._rightMostCoord=null,this._env=null,this._finder=new Ie};ke.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},ke.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},ke.prototype.computeNodeDepth=function(t){for(var e=null,i=t.getEdges().iterator();i.hasNext();){var n=i.next();if(n.isVisited()||n.getSym().isVisited()){e=n;break}}if(null===e)throw new Me("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var r=t.getEdges().iterator();r.hasNext();){var o=r.next();o.setVisited(!0),this.copySymDepths(o)}},ke.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Ce.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},ke.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},ke.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ce.RIGHT)>=1&&e.getDepth(Ce.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},ke.prototype.computeDepths=function(t){var e=new Lt,i=new Ae,n=t.getNode();for(i.addLast(n),e.add(n),t.setVisited(!0);!i.isEmpty();){var r=i.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(i.addLast(a),e.add(a))}}}},ke.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0},ke.prototype.getEnvelope=function(){if(null===this._env){for(var t=new Z,e=this._dirEdgeList.iterator();e.hasNext();)for(var i=e.next().getEdge().getCoordinates(),n=0;n<i.length-1;n++)t.expandToInclude(i[n]);this._env=t}return this._env},ke.prototype.addReachable=function(t){var e=new g;for(e.add(t);!e.empty();){var i=e.pop();this.add(i,e)}},ke.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Ce.LEFT,t.getDepth(Ce.RIGHT)),e.setDepth(Ce.RIGHT,t.getDepth(Ce.LEFT))},ke.prototype.add=function(t,e){t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var n=i.next();this._dirEdgeList.add(n);var r=n.getSym().getNode();r.isVisited()||e.push(r)}},ke.prototype.getNodes=function(){return this._nodes},ke.prototype.getDirectedEdges=function(){return this._dirEdgeList},ke.prototype.interfaces_=function(){return[b]},ke.prototype.getClass=function(){return ke};var Pe=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[Ce.ON]=i}else if(arguments[0]instanceof t){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var r=0;r<this.location.length;r++)this.location[r]=n.location[r]}}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.init(3),this.location[Ce.ON]=o,this.location[Ce.LEFT]=s,this.location[Ce.RIGHT]=a}};Pe.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Pe.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==M.NONE)return!1;return!0},Pe.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===M.NONE&&(this.location[e]=t)},Pe.prototype.isLine=function(){return 1===this.location.length},Pe.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ce.ON]=this.location[Ce.ON],e[Ce.LEFT]=M.NONE,e[Ce.RIGHT]=M.NONE,this.location=e}for(var i=0;i<this.location.length;i++)this.location[i]===M.NONE&&i<t.location.length&&(this.location[i]=t.location[i])},Pe.prototype.getLocations=function(){return this.location},Pe.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Ce.LEFT];this.location[Ce.LEFT]=this.location[Ce.RIGHT],this.location[Ce.RIGHT]=t},Pe.prototype.toString=function(){var t=new z;return this.location.length>1&&t.append(M.toLocationSymbol(this.location[Ce.LEFT])),t.append(M.toLocationSymbol(this.location[Ce.ON])),this.location.length>1&&t.append(M.toLocationSymbol(this.location[Ce.RIGHT])),t.toString()},Pe.prototype.setLocations=function(t,e,i){this.location[Ce.ON]=t,this.location[Ce.LEFT]=e,this.location[Ce.RIGHT]=i},Pe.prototype.get=function(t){return t<this.location.length?this.location[t]:M.NONE},Pe.prototype.isArea=function(){return this.location.length>1},Pe.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===M.NONE)return!0;return!1},Pe.prototype.setLocation=function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ce.ON,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.location[e]=i}},Pe.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(M.NONE)},Pe.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Pe.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe};var Le=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Pe(e),this.elt[1]=new Pe(e)}else if(arguments[0]instanceof t){var i=arguments[0];this.elt[0]=new Pe(i.elt[0]),this.elt[1]=new Pe(i.elt[1])}}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.elt[0]=new Pe(M.NONE),this.elt[1]=new Pe(M.NONE),this.elt[n].setLocation(r)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Pe(o,s,a),this.elt[1]=new Pe(o,s,a)}else if(4===arguments.length){var l=arguments[0],c=arguments[1],u=arguments[2],h=arguments[3];this.elt[0]=new Pe(M.NONE,M.NONE,M.NONE),this.elt[1]=new Pe(M.NONE,M.NONE,M.NONE),this.elt[l].setLocations(c,u,h)}};Le.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Le.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Le.prototype.isNull=function(t){return this.elt[t].isNull()},Le.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.elt[e].setAllLocationsIfNull(i)}},Le.prototype.isLine=function(t){return this.elt[t].isLine()},Le.prototype.merge=function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Pe(t.elt[e]):this.elt[e].merge(t.elt[e])},Le.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Le.prototype.getLocation=function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ce.ON)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return this.elt[e].get(i)}},Le.prototype.toString=function(){var t=new z;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Le.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},Le.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Le.prototype.setLocation=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ce.ON,e)}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this.elt[i].setLocation(n,r)}},Le.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Le.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Le.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Pe(this.elt[t].location[0]))},Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le},Le.toLineLabel=function(t){for(var e=new Le(M.NONE),i=0;i<2;i++)e.setLocation(i,t.getLocation(i));return e};var ze=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Tt,this._pts=new Tt,this._label=new Le(M.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Tt,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};ze.prototype.computeRing=function(){if(null!==this._ring)return null;for(var t=new Array(this._pts.size()).fill(null),e=0;e<this._pts.size();e++)t[e]=this._pts.get(e);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=at.isCCW(this._ring.getCoordinates())},ze.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},ze.prototype.computePoints=function(t){this._startDe=t;var e=t,i=!0;do{if(null===e)throw new Me("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Me("Directed Edge visited twice during ring-building at "+e.getCoordinate());this._edges.add(e);var n=e.getLabel();et.isTrue(n.isArea()),this.mergeLabel(n),this.addPoints(e.getEdge(),e.isForward(),i),i=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this._startDe)},ze.prototype.getLinearRing=function(){return this._ring},ze.prototype.getCoordinate=function(t){return this._pts.get(t)},ze.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var t=this._startDe;do{var e=t.getNode().getEdges().getOutgoingDegree(this);e>this._maxNodeDegree&&(this._maxNodeDegree=e),t=this.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2},ze.prototype.addPoints=function(t,e,i){var n=t.getCoordinates();if(e){var r=1;i&&(r=0);for(var o=r;o<n.length;o++)this._pts.add(n[o])}else{var s=n.length-2;i&&(s=n.length-1);for(var a=s;a>=0;a--)this._pts.add(n[a])}},ze.prototype.isHole=function(){return this._isHole},ze.prototype.setInResult=function(){var t=this._startDe;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this._startDe)},ze.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!at.isPointInRing(t,e.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();)if(i.next().containsPoint(t))return!1;return!0},ze.prototype.addHole=function(t){this._holes.add(t)},ze.prototype.isShell=function(){return null===this._shell},ze.prototype.getLabel=function(){return this._label},ze.prototype.getEdges=function(){return this._edges},ze.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},ze.prototype.getShell=function(){return this._shell},ze.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],i=arguments[0].getLocation(e,Ce.RIGHT);if(i===M.NONE)return null;if(this._label.getLocation(e)===M.NONE)return this._label.setLocation(e,i),null}},ze.prototype.setShell=function(t){this._shell=t,null!==t&&t.addHole(this)},ze.prototype.toPolygon=function(t){for(var e=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)e[i]=this._holes.get(i).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze};var De=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ze),Re=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var t=new Tt,e=this._startDe;do{if(null===e.getMinEdgeRing()){var i=new De(e,this._geometryFactory);t.add(i)}e=e.getNext()}while(e!==this._startDe);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this._startDe;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this._startDe)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ze),Oe=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._label=t}};Oe.prototype.setVisited=function(t){this._isVisited=t},Oe.prototype.setInResult=function(t){this._isInResult=t},Oe.prototype.isCovered=function(){return this._isCovered},Oe.prototype.isCoveredSet=function(){return this._isCoveredSet},Oe.prototype.setLabel=function(t){this._label=t},Oe.prototype.getLabel=function(){return this._label},Oe.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0},Oe.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Oe.prototype.isInResult=function(){return this._isInResult},Oe.prototype.isVisited=function(){return this._isVisited},Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe};var Fe=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var e=arguments[0],i=arguments[1];this._coord=e,this._edges=i,this._label=new Le(0,M.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(t){t.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var i=M.NONE;if(i=this._label.getLocation(e),!t.isNull(e)){var n=t.getLocation(e);i!==M.BOUNDARY&&(i=n)}return i},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],i=arguments[1];null===this._label?this._label=new Le(e,i):this._label.setLocation(e,i)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){if(arguments[0]instanceof e){var t=arguments[0];this.mergeLabel(t._label)}else if(arguments[0]instanceof Le)for(var i=arguments[0],n=0;n<2;n++){var r=this.computeMergedLocation(i,n);this._label.getLocation(n)===M.NONE&&this._label.setLocation(n,r)}},e.prototype.add=function(t){this._edges.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this._label)return null;var e=M.NONE;null!==this._label&&(e=this._label.getLocation(t));var i=null;switch(e){case M.BOUNDARY:i=M.INTERIOR;break;case M.INTERIOR:default:i=M.BOUNDARY}this._label.setLocation(t,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Oe),Ne=function(){this.nodeMap=new h,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Ne.prototype.find=function(t){return this.nodeMap.get(t)},Ne.prototype.addNode=function(){if(arguments[0]instanceof S){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Fe){var i=arguments[0],n=this.nodeMap.get(i.getCoordinate());return null===n?(this.nodeMap.put(i.getCoordinate(),i),i):(n.mergeLabel(i),n)}},Ne.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},Ne.prototype.iterator=function(){return this.nodeMap.values().iterator()},Ne.prototype.values=function(){return this.nodeMap.values()},Ne.prototype.getBoundaryNodes=function(t){for(var e=new Tt,i=this.iterator();i.hasNext();){var n=i.next();n.getLabel().getLocation(t)===M.BOUNDARY&&e.add(n)}return e},Ne.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne};var Be=function(){},je={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Be.prototype.interfaces_=function(){return[]},Be.prototype.getClass=function(){return Be},Be.isNorthern=function(t){return t===Be.NE||t===Be.NW},Be.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Be.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var i=t<e?t:e;return 0===i&&3===(t>e?t:e)?3:i},Be.isInHalfPlane=function(t,e){return e===Be.SE?t===Be.SE||t===Be.SW:t===e||t===e+1},Be.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new _("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Be.NE:Be.SE:e>=0?Be.NW:Be.SW}if(arguments[0]instanceof S&&arguments[1]instanceof S){var i=arguments[0],n=arguments[1];if(n.x===i.x&&n.y===i.y)throw new _("Cannot compute the quadrant for two identical points "+i);return n.x>=i.x?n.y>=i.y?Be.NE:Be.SE:n.y>=i.y?Be.NW:Be.SW}},je.NE.get=function(){return 0},je.NW.get=function(){return 1},je.SW.get=function(){return 2},je.SE.get=function(){return 3},Object.defineProperties(Be,je);var $e=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length){var t=arguments[0];this._edge=t}else if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];this._edge=e,this.init(i,n),this._label=null}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this._edge=r,this.init(o,s),this._label=a}};$e.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:at.computeOrientation(t._p0,t._p1,this._p1)},$e.prototype.getDy=function(){return this._dy},$e.prototype.getCoordinate=function(){return this._p0},$e.prototype.setNode=function(t){this._node=t},$e.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),n=i.lastIndexOf("."),r=i.substring(n+1);t.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)},$e.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)},$e.prototype.getDirectedCoordinate=function(){return this._p1},$e.prototype.getDx=function(){return this._dx},$e.prototype.getLabel=function(){return this._label},$e.prototype.getEdge=function(){return this._edge},$e.prototype.getQuadrant=function(){return this._quadrant},$e.prototype.getNode=function(){return this._node},$e.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),i=e.lastIndexOf(".");return"  "+e.substring(i+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label},$e.prototype.computeLabel=function(t){},$e.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Be.quadrant(this._dx,this._dy),et.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},$e.prototype.interfaces_=function(){return[b]},$e.prototype.getClass=function(){return $e};var Ue=function(t){function e(){var e=arguments[0],i=arguments[1];if(t.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var n=e.getNumPoints()-1;this.init(e.getCoordinate(n),e.getCoordinate(n-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(t){return this._depth[t]},e.prototype.setVisited=function(t){this._isVisited=t},e.prototype.computeDirectedLabel=function(){this._label=new Le(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(t,e){if(-999!==this._depth[t]&&this._depth[t]!==e)throw new Me("assigned depths do not match",this.getCoordinate());this._depth[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=!0,e=0;e<2;e++)this._label.isArea(e)&&this._label.getLocation(e,Ce.LEFT)===M.INTERIOR&&this._label.getLocation(e,Ce.RIGHT)===M.INTERIOR||(t=!1);return t},e.prototype.setNextMin=function(t){this._nextMin=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._depth[Ce.LEFT]+"/"+this._depth[Ce.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this._isInResult&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this._minEdgeRing=t},e.prototype.isLineEdge=function(){var t=this._label.isLine(0)||this._label.isLine(1),e=!this._label.isArea(0)||this._label.allPositionsEqual(0,M.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,M.EXTERIOR);return t&&e&&i},e.prototype.setEdgeRing=function(t){this._edgeRing=t},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var t=this._edge.getDepthDelta();return this._isForward||(t=-t),t},e.prototype.setInResult=function(t){this._isInResult=t},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this._isForward?this._edge.print(t):this._edge.printReverse(t)},e.prototype.setSym=function(t){this._sym=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this._sym.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var n=1;t===Ce.LEFT&&(n=-1);var r=Ce.opposite(t),o=e+i*n;this.setDepth(t,e),this.setDepth(r,o)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(t){this._next=t},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===M.EXTERIOR&&e===M.INTERIOR?1:t===M.INTERIOR&&e===M.EXTERIOR?-1:0},e}($e),Ve=function(){};Ve.prototype.createNode=function(t){return new Fe(t,null)},Ve.prototype.interfaces_=function(){return[]},Ve.prototype.getClass=function(){return Ve};var Ge=function(){if(this._edges=new Tt,this._nodes=null,this._edgeEndList=new Tt,0===arguments.length)this._nodes=new Ne(new Ve);else if(1===arguments.length){var t=arguments[0];this._nodes=new Ne(t)}};Ge.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this._edges.size();e++){t.println("edge "+e+":");var i=this._edges.get(e);i.print(t),i.eiList.print(t)}},Ge.prototype.find=function(t){return this._nodes.find(t)},Ge.prototype.addNode=function(){if(arguments[0]instanceof Fe){var t=arguments[0];return this._nodes.addNode(t)}if(arguments[0]instanceof S){var e=arguments[0];return this._nodes.addNode(e)}},Ge.prototype.getNodeIterator=function(){return this._nodes.iterator()},Ge.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Ge.prototype.debugPrintln=function(t){G.out.println(t)},Ge.prototype.isBoundaryNode=function(t,e){var i=this._nodes.find(e);if(null===i)return!1;var n=i.getLabel();return null!==n&&n.getLocation(t)===M.BOUNDARY},Ge.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Ge.prototype.matchInSameDirection=function(t,e,i,n){return!!t.equals(i)&&at.computeOrientation(t,e,n)===at.COLLINEAR&&Be.quadrant(t,e)===Be.quadrant(i,n)},Ge.prototype.getEdgeEnds=function(){return this._edgeEndList},Ge.prototype.debugPrint=function(t){G.out.print(t)},Ge.prototype.getEdgeIterator=function(){return this._edges.iterator()},Ge.prototype.findEdgeInSameDirection=function(t,e){for(var i=0;i<this._edges.size();i++){var n=this._edges.get(i),r=n.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return n;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return n}return null},Ge.prototype.insertEdge=function(t){this._edges.add(t)},Ge.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var i=e.next();if(i.getEdge()===t)return i}return null},Ge.prototype.addEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this._edges.add(i);var n=new Ue(i,!0),r=new Ue(i,!1);n.setSym(r),r.setSym(n),this.add(n),this.add(r)}},Ge.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)},Ge.prototype.getNodes=function(){return this._nodes.values()},Ge.prototype.findEdge=function(t,e){for(var i=0;i<this._edges.size();i++){var n=this._edges.get(i),r=n.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return n}return null},Ge.prototype.interfaces_=function(){return[]},Ge.prototype.getClass=function(){return Ge},Ge.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var qe=function(){this._geometryFactory=null,this._shellList=new Tt;var t=arguments[0];this._geometryFactory=t};qe.prototype.sortShellsAndHoles=function(t,e,i){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()?i.add(r):e.add(r)}},qe.prototype.computePolygons=function(t){for(var e=new Tt,i=t.iterator();i.hasNext();){var n=i.next().toPolygon(this._geometryFactory);e.add(n)}return e},qe.prototype.placeFreeHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(null===n.getShell()){var r=this.findEdgeRingContaining(n,t);if(null===r)throw new Me("unable to assign hole to a shell",n.getCoordinate(0));n.setShell(r)}}},qe.prototype.buildMinimalEdgeRings=function(t,e,i){for(var n=new Tt,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):i.addAll(s)}else n.add(o)}return n},qe.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},qe.prototype.buildMaximalEdgeRings=function(t){for(var e=new Tt,i=t.iterator();i.hasNext();){var n=i.next();if(n.isInResult()&&n.getLabel().isArea()&&null===n.getEdgeRing()){var r=new Re(n,this._geometryFactory);e.add(r),r.setInResult()}}return e},qe.prototype.placePolygonHoles=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();n.isHole()&&n.setShell(t)}},qe.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},qe.prototype.findEdgeRingContaining=function(t,e){for(var i=t.getLinearRing(),n=i.getEnvelopeInternal(),r=i.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var l=a.next(),c=l.getLinearRing(),u=c.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var h=!1;u.contains(n)&&at.isPointInRing(r,c.getCoordinates())&&(h=!0),h&&(null===o||s.contains(u))&&(o=l)}return o},qe.prototype.findShell=function(t){for(var e=0,i=null,n=t.iterator();n.hasNext();){var r=n.next();r.isHole()||(i=r,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),i},qe.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],i=arguments[1];Ge.linkResultDirectedEdges(i);var n=this.buildMaximalEdgeRings(e),r=new Tt,o=this.buildMinimalEdgeRings(n,this._shellList,r);this.sortShellsAndHoles(o,this._shellList,r),this.placeFreeHoles(this._shellList,r)}},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe};var Ze=function(){};Ze.prototype.getBounds=function(){},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze};var We=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};We.prototype.getItem=function(){return this._item},We.prototype.getBounds=function(){return this._bounds},We.prototype.interfaces_=function(){return[Ze,e]},We.prototype.getClass=function(){return We};var He=function(){this._size=null,this._items=null,this._size=0,this._items=new Tt,this._items.add(null)};He.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t},He.prototype.size=function(){return this._size},He.prototype.reorder=function(t){for(var e=null,i=this._items.get(t);2*t<=this._size&&((e=2*t)!==this._size&&this._items.get(e+1).compareTo(this._items.get(e))<0&&e++,this._items.get(e).compareTo(i)<0);t=e)this._items.set(t,this._items.get(e));this._items.set(t,i)},He.prototype.clear=function(){this._size=0,this._items.clear()},He.prototype.isEmpty=function(){return 0===this._size},He.prototype.add=function(t){this._items.add(null),this._size+=1;var e=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(e/2)))<0;e/=2)this._items.set(e,this._items.get(Math.trunc(e/2)));this._items.set(e,t)},He.prototype.interfaces_=function(){return[]},He.prototype.getClass=function(){return He};var Xe=function(){};Xe.prototype.visitItem=function(t){},Xe.prototype.interfaces_=function(){return[]},Xe.prototype.getClass=function(){return Xe};var Ye=function(){};Ye.prototype.insert=function(t,e){},Ye.prototype.remove=function(t,e){},Ye.prototype.query=function(){},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ke=function(){if(this._childBoundables=new Tt,this._bounds=null,this._level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this._level=t}},Je={serialVersionUID:{configurable:!0}};Ke.prototype.getLevel=function(){return this._level},Ke.prototype.size=function(){return this._childBoundables.size()},Ke.prototype.getChildBoundables=function(){return this._childBoundables},Ke.prototype.addChildBoundable=function(t){et.isTrue(null===this._bounds),this._childBoundables.add(t)},Ke.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Ke.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Ke.prototype.interfaces_=function(){return[Ze,e]},Ke.prototype.getClass=function(){return Ke},Je.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Ke,Je);var Qe=function(){};Qe.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},Qe.min=function(t){return Qe.sort(t),t.get(0)},Qe.sort=function(t,e){var i=t.toArray();e?Ft.sort(i,e):Ft.sort(i);for(var n=t.iterator(),r=0,o=i.length;r<o;r++)n.next(),n.set(i[r])},Qe.singletonList=function(t){var e=new Tt;return e.add(t),e};var ti=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],i=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=i,this._distance=this.distance()};ti.prototype.expandToQueue=function(t,e){var i=ti.isComposite(this._boundable1),n=ti.isComposite(this._boundable2);if(i&&n)return ti.area(this._boundable1)>ti.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(i)return this.expand(this._boundable1,this._boundable2,t,e),null;if(n)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new _("neither boundable is composite")},ti.prototype.isLeaves=function(){return!(ti.isComposite(this._boundable1)||ti.isComposite(this._boundable2))},ti.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},ti.prototype.expand=function(t,e,i,n){for(var r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next(),s=new ti(o,e,this._itemDistance);s.getDistance()<n&&i.add(s)}},ti.prototype.getBoundable=function(t){return 0===t?this._boundable1:this._boundable2},ti.prototype.getDistance=function(){return this._distance},ti.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},ti.prototype.interfaces_=function(){return[b]},ti.prototype.getClass=function(){return ti},ti.area=function(t){return t.getBounds().getArea()},ti.isComposite=function(t){return t instanceof Ke};var ei=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new Tt,this._nodeCapacity=null,0===arguments.length){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(1===arguments.length){var i=arguments[0];et.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}},ii={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ei.prototype.getNodeCapacity=function(){return this._nodeCapacity},ei.prototype.lastNode=function(t){return t.get(t.size()-1)},ei.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();i instanceof Ke?t+=this.size(i):i instanceof We&&(t+=1)}return t}},ei.prototype.removeItem=function(t,e){for(var i=null,n=t.getChildBoundables().iterator();n.hasNext();){var r=n.next();r instanceof We&&r.getItem()===e&&(i=r)}return null!==i&&(t.getChildBoundables().remove(i),!0)},ei.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this._root);return null===t?new Tt:t}if(1===arguments.length){for(var e=arguments[0],i=new Tt,n=e.getChildBoundables().iterator();n.hasNext();){var r=n.next();if(r instanceof Ke){var o=this.itemsTree(r);null!==o&&i.add(o)}else r instanceof We?i.add(r.getItem()):et.shouldNeverReachHere()}return i.size()<=0?null:i}},ei.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new We(t,e))},ei.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new Tt;return this.boundablesAtLevel(t,this._root,e),e}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];if(et.isTrue(i>-2),n.getLevel()===i)return r.add(n),null;for(var o=n.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Ke?this.boundablesAtLevel(i,s,r):(et.isTrue(s instanceof We),-1===i&&r.add(s))}return null}},ei.prototype.query=function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new Tt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,e),e}if(2===arguments.length){var i=arguments[0],n=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,n)}else if(3===arguments.length)if(k(arguments[2],Xe)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke)for(var r=arguments[0],o=arguments[2],s=arguments[1].getChildBoundables(),a=0;a<s.size();a++){var l=s.get(a);this.getIntersectsOp().intersects(l.getBounds(),r)&&(l instanceof Ke?this.query(r,l,o):l instanceof We?o.visitItem(l.getItem()):et.shouldNeverReachHere())}else if(k(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke)for(var c=arguments[0],u=arguments[2],h=arguments[1].getChildBoundables(),p=0;p<h.size();p++){var d=h.get(p);this.getIntersectsOp().intersects(d.getBounds(),c)&&(d instanceof Ke?this.query(c,d,u):d instanceof We?u.add(d.getItem()):et.shouldNeverReachHere())}},ei.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},ei.prototype.getRoot=function(){return this.build(),this._root},ei.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.remove(t,this._root,e)}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=this.removeItem(n,r);if(o)return!0;for(var s=null,a=n.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(this.getIntersectsOp().intersects(l.getBounds(),i)&&l instanceof Ke&&(o=this.remove(i,l,r))){s=l;break}}return null!==s&&s.getChildBoundables().isEmpty()&&n.getChildBoundables().remove(s),o}},ei.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var i=this.createParentBoundables(t,e+1);return 1===i.size()?i.get(0):this.createHigherLevels(i,e+1)},ei.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var i=e.next();if(i instanceof Ke){var n=this.depth(i);n>t&&(t=n)}}return t+1}},ei.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var i=new Tt;i.add(this.createNode(e));var n=new Tt(t);Qe.sort(n,this.getComparator());for(var r=n.iterator();r.hasNext();){var o=r.next();this.lastNode(i).getChildBoundables().size()===this.getNodeCapacity()&&i.add(this.createNode(e)),this.lastNode(i).addChildBoundable(o)}return i},ei.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},ei.prototype.interfaces_=function(){return[e]},ei.prototype.getClass=function(){return ei},ei.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},ii.IntersectsOp.get=function(){return ni},ii.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ii.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(ei,ii);var ni=function(){},ri=function(){};ri.prototype.distance=function(t,e){},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri};var oi=function(t){function i(e){e=e||i.DEFAULT_NODE_CAPACITY,t.call(this,e)}t&&(i.__proto__=t),(i.prototype=Object.create(t&&t.prototype)).constructor=i;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return i.prototype.createParentBoundablesFromVerticalSlices=function(t,e){et.isTrue(t.length>0);for(var i=new Tt,n=0;n<t.length;n++)i.addAll(this.createParentBoundablesFromVerticalSlice(t[n],e));return i},i.prototype.createNode=function(t){return new si(t)},i.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},i.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],i=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,i)},i.prototype.getIntersectsOp=function(){return i.intersectsOp},i.prototype.verticalSlices=function(t,e){for(var i=Math.trunc(Math.ceil(t.size()/e)),n=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){n[o]=new Tt;for(var s=0;r.hasNext()&&s<i;){var a=r.next();n[o].add(a),s++}}return n},i.prototype.query=function(){if(1===arguments.length){var e=arguments[0];return t.prototype.query.call(this,e)}if(2===arguments.length){var i=arguments[0],n=arguments[1];t.prototype.query.call(this,i,n)}else if(3===arguments.length)if(k(arguments[2],Xe)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke){var r=arguments[0],o=arguments[1],s=arguments[2];t.prototype.query.call(this,r,o,s)}else if(k(arguments[2],wt)&&arguments[0]instanceof Object&&arguments[1]instanceof Ke){var a=arguments[0],l=arguments[1],c=arguments[2];t.prototype.query.call(this,a,l,c)}},i.prototype.getComparator=function(){return i.yComparator},i.prototype.createParentBoundablesFromVerticalSlice=function(e,i){return t.prototype.createParentBoundables.call(this,e,i)},i.prototype.remove=function(){if(2===arguments.length){var e=arguments[0],i=arguments[1];return t.prototype.remove.call(this,e,i)}return t.prototype.remove.apply(this,arguments)},i.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},i.prototype.createParentBoundables=function(t,e){et.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),r=new Tt(t);Qe.sort(r,i.xComparator);var o=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(o,e)},i.prototype.nearestNeighbour=function(){if(1===arguments.length){if(k(arguments[0],ri)){var t=arguments[0],e=new ti(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof ti){var n=arguments[0];return this.nearestNeighbour(n,v.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof i&&k(arguments[1],ri)){var r=arguments[0],o=arguments[1],s=new ti(this.getRoot(),r.getRoot(),o);return this.nearestNeighbour(s)}if(arguments[0]instanceof ti&&"number"==typeof arguments[1]){var a=arguments[0],l=arguments[1],c=null,u=new He;for(u.add(a);!u.isEmpty()&&l>0;){var h=u.poll(),p=h.getDistance();if(p>=l)break;h.isLeaves()?(l=p,c=h):h.expandToQueue(u,l)}return[c.getBoundable(0).getItem(),c.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=arguments[2],f=new We(arguments[0],arguments[1]),m=new ti(this.getRoot(),f,d);return this.nearestNeighbour(m)[0]}},i.prototype.interfaces_=function(){return[Ye,e]},i.prototype.getClass=function(){return i},i.centreX=function(t){return i.avg(t.getMinX(),t.getMaxX())},i.avg=function(t,e){return(t+e)/2},i.centreY=function(t){return i.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return si},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[T]},compare:function(e,n){return t.compareDoubles(i.centreX(e.getBounds()),i.centreX(n.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[T]},compare:function(e,n){return t.compareDoubles(i.centreY(e.getBounds()),i.centreY(n.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(i,n),i}(ei),si=function(t){function e(){var e=arguments[0];t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var i=e.next();null===t?t=new Z(i.getBounds()):t.expandToInclude(i.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ke),ai=function(){};ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai},ai.relativeSign=function(t,e){return t<e?-1:t>e?1:0},ai.compare=function(t,e,i){if(e.equals2D(i))return 0;var n=ai.relativeSign(e.x,i.x),r=ai.relativeSign(e.y,i.y);switch(t){case 0:return ai.compareValue(n,r);case 1:return ai.compareValue(r,n);case 2:return ai.compareValue(r,-n);case 3:return ai.compareValue(-n,r);case 4:return ai.compareValue(-n,-r);case 5:return ai.compareValue(-r,-n);case 6:return ai.compareValue(-r,n);case 7:return ai.compareValue(n,-r)}return et.shouldNeverReachHere("invalid octant value"),0},ai.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var li=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._segString=t,this.coord=new S(e),this.segmentIndex=i,this._segmentOctant=n,this._isInterior=!e.equals2D(t.getCoordinate(i))};li.prototype.getCoordinate=function(){return this.coord},li.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},li.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ai.compare(this._segmentOctant,this.coord,e.coord)},li.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},li.prototype.isInterior=function(){return this._isInterior},li.prototype.interfaces_=function(){return[b]},li.prototype.getClass=function(){return li};var ci=function(){this._nodeMap=new h,this._edge=null;var t=arguments[0];this._edge=t};ci.prototype.getSplitCoordinates=function(){var t=new Ct;this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next();this.addEdgeCoordinates(i,n,t),i=n}return t.toCoordinateArray()},ci.prototype.addCollapsedNodes=function(){var t=new Tt;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var i=e.next().intValue();this.add(this._edge.getCoordinate(i),i)}},ci.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},ci.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this._edge.size()-2;e++){var i=this._edge.getCoordinate(e),n=this._edge.getCoordinate(e+2);i.equals2D(n)&&t.add(new D(e+1))}},ci.prototype.addEdgeCoordinates=function(t,e,i){var n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);i.add(new S(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)i.add(this._edge.getCoordinate(o));r&&i.add(new S(e.coord))},ci.prototype.iterator=function(){return this._nodeMap.values().iterator()},ci.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},ci.prototype.findCollapseIndex=function(t,e,i){if(!t.coord.equals2D(e.coord))return!1;var n=e.segmentIndex-t.segmentIndex;return e.isInterior()||n--,1===n&&(i[0]=t.segmentIndex+1,!0)},ci.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),i=this.iterator(),n=i.next();i.hasNext();){var r=i.next();this.findCollapseIndex(n,r,e)&&t.add(new D(e[0])),n=r}},ci.prototype.getEdge=function(){return this._edge},ci.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)},ci.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this._edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this._edge.getCoordinate(a);return r&&(o[s]=new S(e.coord)),new di(o,this._edge.getData())},ci.prototype.add=function(t,e){var i=new li(this._edge,t,e,this._edge.getSegmentOctant(e)),n=this._nodeMap.get(i);return null!==n?(et.isTrue(n.coord.equals2D(t),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(i,i),i)},ci.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),i=t.get(0).getCoordinate(0);if(!i.equals2D(e[0]))throw new Q("bad split edge start point at "+i);var n=t.get(t.size()-1).getCoordinates(),r=n[n.length-1];if(!r.equals2D(e[e.length-1]))throw new Q("bad split edge end point at "+r)},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var ui=function(){};ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new _("Cannot compute the octant for point ( "+t+", "+e+" )");var i=Math.abs(t),n=Math.abs(e);return t>=0?e>=0?i>=n?0:1:i>=n?7:6:e>=0?i>=n?3:2:i>=n?4:5}if(arguments[0]instanceof S&&arguments[1]instanceof S){var r=arguments[0],o=arguments[1],s=o.x-r.x,a=o.y-r.y;if(0===s&&0===a)throw new _("Cannot compute the octant for two identical points "+r);return ui.octant(s,a)}};var hi=function(){};hi.prototype.getCoordinates=function(){},hi.prototype.size=function(){},hi.prototype.getCoordinate=function(t){},hi.prototype.isClosed=function(){},hi.prototype.setData=function(t){},hi.prototype.getData=function(){},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi};var pi=function(){};pi.prototype.addIntersection=function(t,e){},pi.prototype.interfaces_=function(){return[hi]},pi.prototype.getClass=function(){return pi};var di=function(){this._nodeList=new ci(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};di.prototype.getCoordinates=function(){return this._pts},di.prototype.size=function(){return this._pts.length},di.prototype.getCoordinate=function(t){return this._pts[t]},di.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},di.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},di.prototype.setData=function(t){this._data=t},di.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ui.octant(t,e)},di.prototype.getData=function(){return this._data},di.prototype.addIntersection=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var i=arguments[1],n=arguments[3],r=new S(arguments[0].getIntersection(n));this.addIntersection(r,i)}},di.prototype.toString=function(){return J.toLineString(new le(this._pts))},di.prototype.getNodeList=function(){return this._nodeList},di.prototype.addIntersectionNode=function(t,e){var i=e,n=i+1;if(n<this._pts.length){var r=this._pts[n];t.equals2D(r)&&(i=n)}return this._nodeList.add(t,i)},di.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},di.prototype.interfaces_=function(){return[pi]},di.prototype.getClass=function(){return di},di.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new Tt;return di.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var i=arguments[1],n=arguments[0].iterator();n.hasNext();)n.next().getNodeList().addSplitEdges(i)};var fi=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new S,this.p1=new S;else if(1===arguments.length){var t=arguments[0];this.p0=new S(t.p0),this.p1=new S(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=arguments[3];this.p0=new S(e,i),this.p1=new S(n,r)}},mi={serialVersionUID:{configurable:!0}};fi.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},fi.prototype.orientationIndex=function(){if(arguments[0]instanceof fi){var t=arguments[0],e=at.orientationIndex(this.p0,this.p1,t.p0),i=at.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&i>=0||e<=0&&i<=0?Math.max(e,i):0}if(arguments[0]instanceof S){var n=arguments[0];return at.orientationIndex(this.p0,this.p1,n)}},fi.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},fi.prototype.isVertical=function(){return this.p0.x===this.p1.x},fi.prototype.equals=function(t){if(!(t instanceof fi))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},fi.prototype.intersection=function(t){var e=new rt;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},fi.prototype.project=function(){if(arguments[0]instanceof S){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new S(t);var e=this.projectionFactor(t),i=new S;return i.x=this.p0.x+e*(this.p1.x-this.p0.x),i.y=this.p0.y+e*(this.p1.y-this.p0.y),i}if(arguments[0]instanceof fi){var n=arguments[0],r=this.projectionFactor(n.p0),o=this.projectionFactor(n.p1);if(r>=1&&o>=1)return null;if(r<=0&&o<=0)return null;var s=this.project(n.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var a=this.project(n.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new fi(s,a)}},fi.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},fi.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},fi.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},fi.prototype.distancePerpendicular=function(t){return at.distancePointLinePerpendicular(t,this.p0,this.p1)},fi.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},fi.prototype.midPoint=function(){return fi.midPoint(this.p0,this.p1)},fi.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,n=e*e+i*i;return n<=0?v.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*i)/n},fi.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var i=new Array(2).fill(null),n=v.MAX_VALUE,r=null,o=this.closestPoint(t.p0);n=o.distance(t.p0),i[0]=o,i[1]=t.p0;var s=this.closestPoint(t.p1);(r=s.distance(t.p1))<n&&(n=r,i[0]=s,i[1]=t.p1);var a=t.closestPoint(this.p0);(r=a.distance(this.p0))<n&&(n=r,i[0]=this.p0,i[1]=a);var l=t.closestPoint(this.p1);return(r=l.distance(this.p1))<n&&(n=r,i[0]=this.p1,i[1]=l),i},fi.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},fi.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},fi.prototype.getLength=function(){return this.p0.distance(this.p1)},fi.prototype.compareTo=function(t){var e=t,i=this.p0.compareTo(e.p0);return 0!==i?i:this.p1.compareTo(e.p1)},fi.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},fi.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},fi.prototype.lineIntersection=function(t){try{return q.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof V))throw t}return null},fi.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},fi.prototype.pointAlongOffset=function(t,e){var i=this.p0.x+t*(this.p1.x-this.p0.x),n=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(r*r+o*o),a=0,l=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*r/s,l=e*o/s}return new S(i-l,n+a)},fi.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=i.x,this.p1.y=i.y}},fi.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||v.isNaN(e))&&(e=1),e},fi.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},fi.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},fi.prototype.distance=function(){if(arguments[0]instanceof fi){var t=arguments[0];return at.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof S){var e=arguments[0];return at.distancePointLine(e,this.p0,this.p1)}},fi.prototype.pointAlong=function(t){var e=new S;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},fi.prototype.hashCode=function(){var t=v.doubleToLongBits(this.p0.x);t^=31*v.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),i=v.doubleToLongBits(this.p1.x);return i^=31*v.doubleToLongBits(this.p1.y),e^Math.trunc(i)^Math.trunc(i>>32)},fi.prototype.interfaces_=function(){return[b,e]},fi.prototype.getClass=function(){return fi},fi.midPoint=function(t,e){return new S((t.x+e.x)/2,(t.y+e.y)/2)},mi.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(fi,mi);var gi=function(){this.tempEnv1=new Z,this.tempEnv2=new Z,this._overlapSeg1=new fi,this._overlapSeg2=new fi};gi.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[1],e=arguments[2],i=arguments[3];arguments[0].getLineSegment(t,this._overlapSeg1),e.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi};var yi=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this._pts=t,this._start=e,this._end=i,this._context=n};yi.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]},yi.prototype.computeSelect=function(t,e,i,n){var r=this._pts[e],o=this._pts[i];if(n.tempEnv1.init(r,o),i-e==1)return n.select(this,e),null;if(!t.intersects(n.tempEnv1))return null;var s=Math.trunc((e+i)/2);e<s&&this.computeSelect(t,e,s,n),s<i&&this.computeSelect(t,s,i,n)},yi.prototype.getCoordinates=function(){for(var t=new Array(this._end-this._start+1).fill(null),e=0,i=this._start;i<=this._end;i++)t[e++]=this._pts[i];return t},yi.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)},yi.prototype.setId=function(t){this._id=t},yi.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)},yi.prototype.getEnvelope=function(){if(null===this._env){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Z(t,e)}return this._env},yi.prototype.getEndIndex=function(){return this._end},yi.prototype.getStartIndex=function(){return this._start},yi.prototype.getContext=function(){return this._context},yi.prototype.getId=function(){return this._id},yi.prototype.computeOverlapsInternal=function(t,e,i,n,r,o){var s=this._pts[t],a=this._pts[e],l=i._pts[n],c=i._pts[r];if(e-t==1&&r-n==1)return o.overlap(this,t,i,n),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((t+e)/2),h=Math.trunc((n+r)/2);t<u&&(n<h&&this.computeOverlapsInternal(t,u,i,n,h,o),h<r&&this.computeOverlapsInternal(t,u,i,h,r,o)),u<e&&(n<h&&this.computeOverlapsInternal(u,e,i,n,h,o),h<r&&this.computeOverlapsInternal(u,e,i,h,r,o))},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi};var _i=function(){};_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i},_i.getChainStartIndices=function(t){var e=0,i=new Tt;i.add(new D(e));do{var n=_i.findChainEnd(t,e);i.add(new D(n)),e=n}while(e<t.length-1);return _i.toIntArray(i)},_i.findChainEnd=function(t,e){for(var i=e;i<t.length-1&&t[i].equals2D(t[i+1]);)i++;if(i>=t.length-1)return t.length-1;for(var n=Be.quadrant(t[i],t[i+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||Be.quadrant(t[r-1],t[r])===n);)r++;return r-1},_i.getChains=function(){if(1===arguments.length){var t=arguments[0];return _i.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],i=arguments[1],n=new Tt,r=_i.getChainStartIndices(e),o=0;o<r.length-1;o++){var s=new yi(e,r[o],r[o+1],i);n.add(s)}return n}},_i.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var vi=function(){};vi.prototype.computeNodes=function(t){},vi.prototype.getNodedSubstrings=function(){},vi.prototype.interfaces_=function(){return[]},vi.prototype.getClass=function(){return vi};var xi=function(){if(this._segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}};xi.prototype.setSegmentIntersector=function(t){this._segInt=t},xi.prototype.interfaces_=function(){return[vi]},xi.prototype.getClass=function(){return xi};var bi=function(t){function e(e){e?t.call(this,e):t.call(this),this._monoChains=new Tt,this._index=new oi,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var i={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return di.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(t){for(var e=_i.getChains(t.getCoordinates(),t).iterator();e.hasNext();){var i=e.next();i.setId(this._idCounter++),this._index.insert(i.getEnvelope(),i),this._monoChains.add(i)}},e.prototype.computeNodes=function(t){this._nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=new wi(this._segInt),e=this._monoChains.iterator();e.hasNext();)for(var i=e.next(),n=this._index.query(i.getEnvelope()).iterator();n.hasNext();){var r=n.next();if(r.getId()>i.getId()&&(i.computeOverlaps(r,t),this._nOverlaps++),this._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},i.SegmentOverlapAction.get=function(){return wi},Object.defineProperties(e,i),e}(xi),wi=function(t){function e(){t.call(this),this._si=null;var e=arguments[0];this._si=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[0].getContext(),o=i.getContext();this._si.processIntersections(r,e,o,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(gi),Ti=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.setQuadrantSegments(e)}else if(2===arguments.length){var i=arguments[0],n=arguments[1];this.setQuadrantSegments(i),this.setEndCapStyle(n)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(o),this.setJoinStyle(s),this.setMitreLimit(a)}},Si={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Ti.prototype.getEndCapStyle=function(){return this._endCapStyle},Ti.prototype.isSingleSided=function(){return this._isSingleSided},Ti.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,0===this._quadrantSegments&&(this._joinStyle=Ti.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Ti.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Ti.JOIN_ROUND&&(this._quadrantSegments=Ti.DEFAULT_QUADRANT_SEGMENTS)},Ti.prototype.getJoinStyle=function(){return this._joinStyle},Ti.prototype.setJoinStyle=function(t){this._joinStyle=t},Ti.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t},Ti.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Ti.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Ti.prototype.setEndCapStyle=function(t){this._endCapStyle=t},Ti.prototype.getMitreLimit=function(){return this._mitreLimit},Ti.prototype.setMitreLimit=function(t){this._mitreLimit=t},Ti.prototype.setSingleSided=function(t){this._isSingleSided=t},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti},Ti.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Si.CAP_ROUND.get=function(){return 1},Si.CAP_FLAT.get=function(){return 2},Si.CAP_SQUARE.get=function(){return 3},Si.JOIN_ROUND.get=function(){return 1},Si.JOIN_MITRE.get=function(){return 2},Si.JOIN_BEVEL.get=function(){return 3},Si.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Si.DEFAULT_MITRE_LIMIT.get=function(){return 5},Si.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Ti,Si);var Ci=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=at.COUNTERCLOCKWISE,this._inputLine=t||null},Ei={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ci.prototype.isDeletable=function(t,e,i,n){var r=this._inputLine[t],o=this._inputLine[e],s=this._inputLine[i];return!!this.isConcave(r,o,s)&&!!this.isShallow(r,o,s,n)&&this.isShallowSampled(r,o,t,i,n)},Ci.prototype.deleteShallowConcavities=function(){for(var t=1,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e),n=!1;i<this._inputLine.length;){var r=!1;this.isDeletable(t,e,i,this._distanceTol)&&(this._isDeleted[e]=Ci.DELETE,r=!0,n=!0),t=r?i:e,e=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(e)}return n},Ci.prototype.isShallowConcavity=function(t,e,i,n){return at.computeOrientation(t,e,i)===this._angleOrientation&&at.distancePointLine(e,t,i)<n},Ci.prototype.isShallowSampled=function(t,e,i,n,r){var o=Math.trunc((n-i)/Ci.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=i;s<n;s+=o)if(!this.isShallow(t,e,this._inputLine[s],r))return!1;return!0},Ci.prototype.isConcave=function(t,e,i){return at.computeOrientation(t,e,i)===this._angleOrientation},Ci.prototype.simplify=function(t){this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=at.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Ci.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ci.DELETE;)e++;return e},Ci.prototype.isShallow=function(t,e,i,n){return at.distancePointLine(e,t,i)<n},Ci.prototype.collapseLine=function(){for(var t=new Ct,e=0;e<this._inputLine.length;e++)this._isDeleted[e]!==Ci.DELETE&&t.add(this._inputLine[e]);return t.toCoordinateArray()},Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ci.simplify=function(t,e){return new Ci(t).simplify(e)},Ei.INIT.get=function(){return 0},Ei.DELETE.get=function(){return 1},Ei.KEEP.get=function(){return 1},Ei.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ci,Ei);var Ii=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Tt},Mi={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ii.prototype.getCoordinates=function(){return this._ptList.toArray(Ii.COORDINATE_ARRAY_TYPE)},Ii.prototype.setPrecisionModel=function(t){this._precisionModel=t},Ii.prototype.addPt=function(t){var e=new S(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)},Ii.prototype.revere=function(){},Ii.prototype.addPts=function(t,e){if(e)for(var i=0;i<t.length;i++)this.addPt(t[i]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},Ii.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1);return t.distance(e)<this._minimimVertexDistance},Ii.prototype.toString=function(){return(new ye).createLineString(this.getCoordinates()).toString()},Ii.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new S(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)},Ii.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Mi.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ii,Mi);var Ai=function(){},ki={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ai.prototype.interfaces_=function(){return[]},Ai.prototype.getClass=function(){return Ai},Ai.toDegrees=function(t){return 180*t/Math.PI},Ai.normalize=function(t){for(;t>Math.PI;)t-=Ai.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ai.PI_TIMES_2;return t},Ai.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],i=arguments[1],n=i.x-e.x,r=i.y-e.y;return Math.atan2(r,n)}},Ai.isAcute=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)>0},Ai.isObtuse=function(t,e,i){var n=t.x-e.x,r=t.y-e.y;return n*(i.x-e.x)+r*(i.y-e.y)<0},Ai.interiorAngle=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i);return Math.abs(r-n)},Ai.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ai.PI_TIMES_2;t>=Ai.PI_TIMES_2&&(t=0)}else{for(;t>=Ai.PI_TIMES_2;)t-=Ai.PI_TIMES_2;t<0&&(t=0)}return t},Ai.angleBetween=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i);return Ai.diff(n,r)},Ai.diff=function(t,e){var i=null;return(i=t<e?e-t:t-e)>Math.PI&&(i=2*Math.PI-i),i},Ai.toRadians=function(t){return t*Math.PI/180},Ai.getTurn=function(t,e){var i=Math.sin(e-t);return i>0?Ai.COUNTERCLOCKWISE:i<0?Ai.CLOCKWISE:Ai.NONE},Ai.angleBetweenOriented=function(t,e,i){var n=Ai.angle(e,t),r=Ai.angle(e,i)-n;return r<=-Math.PI?r+Ai.PI_TIMES_2:r>Math.PI?r-Ai.PI_TIMES_2:r},ki.PI_TIMES_2.get=function(){return 2*Math.PI},ki.PI_OVER_2.get=function(){return Math.PI/2},ki.PI_OVER_4.get=function(){return Math.PI/4},ki.COUNTERCLOCKWISE.get=function(){return at.COUNTERCLOCKWISE},ki.CLOCKWISE.get=function(){return at.CLOCKWISE},ki.NONE.get=function(){return at.COLLINEAR},Object.defineProperties(Ai,ki);var Pi=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new fi,this._seg1=new fi,this._offset0=new fi,this._offset1=new fi,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._precisionModel=e,this._bufParams=i,this._li=new rt,this._filletAngleQuantum=Math.PI/2/i.getQuadrantSegments(),i.getQuadrantSegments()>=8&&i.getJoinStyle()===Ti.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Li={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Pi.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=at.computeOrientation(this._s0,this._s1,this._s2),n=i===at.CLOCKWISE&&this._side===Ce.LEFT||i===at.COUNTERCLOCKWISE&&this._side===Ce.RIGHT;0===i?this.addCollinear(e):n?this.addOutsideTurn(i,e):this.addInsideTurn(i,e)},Pi.prototype.addLineEndCap=function(t,e){var i=new fi(t,e),n=new fi;this.computeOffsetSegment(i,Ce.LEFT,this._distance,n);var r=new fi;this.computeOffsetSegment(i,Ce.RIGHT,this._distance,r);var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o);switch(this._bufParams.getEndCapStyle()){case Ti.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(e,a+Math.PI/2,a-Math.PI/2,at.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case Ti.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(r.p1);break;case Ti.CAP_SQUARE:var l=new S;l.x=Math.abs(this._distance)*Math.cos(a),l.y=Math.abs(this._distance)*Math.sin(a);var c=new S(n.p1.x+l.x,n.p1.y+l.y),u=new S(r.p1.x+l.x,r.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(u)}},Pi.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Pi.prototype.addMitreJoin=function(t,e,i,n){var r=!0,o=null;try{o=q.intersection(e.p0,e.p1,i.p0,i.p1),(n<=0?1:o.distance(t)/Math.abs(n))>this._bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof V))throw t;o=new S(0,0),r=!1}r?this._segList.addPt(o):this.addLimitedMitreJoin(e,i,n,this._bufParams.getMitreLimit())},Pi.prototype.addFilletCorner=function(t,e,i,n,r){var o=e.x-t.x,s=e.y-t.y,a=Math.atan2(s,o),l=i.x-t.x,c=i.y-t.y,u=Math.atan2(c,l);n===at.CLOCKWISE?a<=u&&(a+=2*Math.PI):a>=u&&(a-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,a,u,n,r),this._segList.addPt(i)},Pi.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Pi.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Ti.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Ti.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))},Pi.prototype.createSquare=function(t){this._segList.addPt(new S(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new S(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new S(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()},Pi.prototype.addSegments=function(t,e){this._segList.addPts(t,e)},Pi.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Pi.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Pi.prototype.initSideSegments=function(t,e,i){this._s1=t,this._s2=e,this._side=i,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)},Pi.prototype.addLimitedMitreJoin=function(t,e,i,n){var r=this._seg0.p1,o=Ai.angle(r,this._seg0.p0),s=Ai.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1)/2,a=Ai.normalize(o+s),l=Ai.normalize(a+Math.PI),c=n*i,u=i-c*Math.abs(Math.sin(s)),h=r.x+c*Math.cos(l),p=r.y+c*Math.sin(l),d=new S(h,p),f=new fi(r,d),m=f.pointAlongOffset(1,u),g=f.pointAlongOffset(1,-u);this._side===Ce.LEFT?(this._segList.addPt(m),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(m))},Pi.prototype.computeOffsetSegment=function(t,e,i,n){var r=e===Ce.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),l=r*i*o/a,c=r*i*s/a;n.p0.x=t.p0.x-c,n.p0.y=t.p0.y+l,n.p1.x=t.p1.x-c,n.p1.y=t.p1.y+l},Pi.prototype.addFilletArc=function(t,e,i,n,r){var o=n===at.CLOCKWISE?-1:1,s=Math.abs(e-i),a=Math.trunc(s/this._filletAngleQuantum+.5);if(a<1)return null;for(var l=s/a,c=0,u=new S;c<s;){var h=e+o*c;u.x=t.x+r*Math.cos(h),u.y=t.y+r*Math.sin(h),this._segList.addPt(u),c+=l}},Pi.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Pi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new S((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var n=new S((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Pi.prototype.createCircle=function(t){var e=new S(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Pi.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)},Pi.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ii,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Pi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Pi.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Ti.JOIN_BEVEL||this._bufParams.getJoinStyle()===Ti.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,at.CLOCKWISE,this._distance))},Pi.prototype.closeRing=function(){this._segList.closeRing()},Pi.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},Li.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Li.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Li.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Li.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Pi,Li);var zi=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};zi.prototype.getOffsetCurve=function(t,e){if(this._distance=e,0===e)return null;var i=e<0,n=Math.abs(e),r=this.getSegGen(n);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,i,r);var o=r.getCoordinates();return i&&Et.reverse(o),o},zi.prototype.computeSingleSidedBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){i.addSegments(t,!0);var r=Ci.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],Ce.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{i.addSegments(t,!1);var a=Ci.simplify(t,n),l=a.length-1;i.initSideSegments(a[0],a[1],Ce.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment(),i.closeRing()},zi.prototype.computeRingBufferCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);e===Ce.RIGHT&&(n=-n);var r=Ci.simplify(t,n),o=r.length-1;i.initSideSegments(r[o-1],r[0],e);for(var s=1;s<=o;s++){var a=1!==s;i.addNextSegment(r[s],a)}i.closeRing()},zi.prototype.computeLineBufferCurve=function(t,e){var i=this.simplifyTolerance(this._distance),n=Ci.simplify(t,i),r=n.length-1;e.initSideSegments(n[0],n[1],Ce.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(n[o],!0);e.addLastSegment(),e.addLineEndCap(n[r-1],n[r]);var s=Ci.simplify(t,-i),a=s.length-1;e.initSideSegments(s[a],s[a-1],Ce.LEFT);for(var l=a-2;l>=0;l--)e.addNextSegment(s[l],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},zi.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Ti.CAP_ROUND:e.createCircle(t);break;case Ti.CAP_SQUARE:e.createSquare(t)}},zi.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided())return null;if(0===e)return null;var i=Math.abs(e),n=this.getSegGen(i);if(t.length<=1)this.computePointCurve(t[0],n);else if(this._bufParams.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,n)}else this.computeLineBufferCurve(t,n);return n.getCoordinates()},zi.prototype.getBufferParameters=function(){return this._bufParams},zi.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()},zi.prototype.getRingCurve=function(t,e,i){if(this._distance=i,t.length<=2)return this.getLineCurve(t,i);if(0===i)return zi.copyCoordinates(t);var n=this.getSegGen(i);return this.computeRingBufferCurve(t,e,n),n.getCoordinates()},zi.prototype.computeOffsetCurve=function(t,e,i){var n=this.simplifyTolerance(this._distance);if(e){var r=Ci.simplify(t,-n),o=r.length-1;i.initSideSegments(r[o],r[o-1],Ce.LEFT),i.addFirstSegment();for(var s=o-2;s>=0;s--)i.addNextSegment(r[s],!0)}else{var a=Ci.simplify(t,n),l=a.length-1;i.initSideSegments(a[0],a[1],Ce.LEFT),i.addFirstSegment();for(var c=2;c<=l;c++)i.addNextSegment(a[c],!0)}i.addLastSegment()},zi.prototype.getSegGen=function(t){return new Pi(this._precisionModel,this._bufParams,t)},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi},zi.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),i=0;i<e.length;i++)e[i]=new S(t[i]);return e};var Di=function(){this._subgraphs=null,this._seg=new fi,this._cga=new at;var t=arguments[0];this._subgraphs=t},Ri={DepthSegment:{configurable:!0}};Di.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var t=arguments[0],e=new Tt,i=this._subgraphs.iterator();i.hasNext();){var n=i.next(),r=n.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,n.getDirectedEdges(),e)}return e}if(3===arguments.length)if(k(arguments[2],wt)&&arguments[0]instanceof S&&arguments[1]instanceof Ue){for(var o=arguments[0],s=arguments[1],a=arguments[2],l=s.getEdge().getCoordinates(),c=0;c<l.length-1;c++)if(this._seg.p0=l[c],this._seg.p1=l[c+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<o.x||this._seg.isHorizontal()||o.y<this._seg.p0.y||o.y>this._seg.p1.y||at.computeOrientation(this._seg.p0,this._seg.p1,o)===at.RIGHT)){var u=s.getDepth(Ce.LEFT);this._seg.p0.equals(l[c])||(u=s.getDepth(Ce.RIGHT));var h=new Oi(this._seg,u);a.add(h)}}else if(k(arguments[2],wt)&&arguments[0]instanceof S&&k(arguments[1],wt))for(var p=arguments[0],d=arguments[2],f=arguments[1].iterator();f.hasNext();){var m=f.next();m.isForward()&&this.findStabbedSegments(p,m,d)}},Di.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Qe.min(e)._leftDepth},Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Ri.DepthSegment.get=function(){return Oi},Object.defineProperties(Di,Ri);var Oi=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new fi(t),this._leftDepth=e};Oi.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(e._upwardSeg);return 0!==i||0!=(i=-1*e._upwardSeg.orientationIndex(this._upwardSeg))?i:this._upwardSeg.compareTo(e._upwardSeg)},Oi.prototype.compareX=function(t,e){var i=t.p0.compareTo(e.p0);return 0!==i?i:t.p1.compareTo(e.p1)},Oi.prototype.toString=function(){return this._upwardSeg.toString()},Oi.prototype.interfaces_=function(){return[b]},Oi.prototype.getClass=function(){return Oi};var Fi=function(t,e,i){this.p0=t||null,this.p1=e||null,this.p2=i||null};Fi.prototype.area=function(){return Fi.area(this.p0,this.p1,this.p2)},Fi.prototype.signedArea=function(){return Fi.signedArea(this.p0,this.p1,this.p2)},Fi.prototype.interpolateZ=function(t){if(null===t)throw new _("Supplied point is null.");return Fi.interpolateZ(t,this.p0,this.p1,this.p2)},Fi.prototype.longestSideLength=function(){return Fi.longestSideLength(this.p0,this.p1,this.p2)},Fi.prototype.isAcute=function(){return Fi.isAcute(this.p0,this.p1,this.p2)},Fi.prototype.circumcentre=function(){return Fi.circumcentre(this.p0,this.p1,this.p2)},Fi.prototype.area3D=function(){return Fi.area3D(this.p0,this.p1,this.p2)},Fi.prototype.centroid=function(){return Fi.centroid(this.p0,this.p1,this.p2)},Fi.prototype.inCentre=function(){return Fi.inCentre(this.p0,this.p1,this.p2)},Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Fi.area=function(t,e,i){return Math.abs(((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2)},Fi.signedArea=function(t,e,i){return((i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y))/2},Fi.det=function(t,e,i,n){return t*n-e*i},Fi.interpolateZ=function(t,e,i,n){var r=e.x,o=e.y,s=i.x-r,a=n.x-r,l=i.y-o,c=n.y-o,u=s*c-a*l,h=t.x-r,p=t.y-o,d=(c*h-a*p)/u,f=(-l*h+s*p)/u;return e.z+d*(i.z-e.z)+f*(n.z-e.z)},Fi.longestSideLength=function(t,e,i){var n=t.distance(e),r=e.distance(i),o=i.distance(t),s=n;return r>s&&(s=r),o>s&&(s=o),s},Fi.isAcute=function(t,e,i){return!!Ai.isAcute(t,e,i)&&!!Ai.isAcute(e,i,t)&&!!Ai.isAcute(i,t,e)},Fi.circumcentre=function(t,e,i){var n=i.x,r=i.y,o=t.x-n,s=t.y-r,a=e.x-n,l=e.y-r,c=2*Fi.det(o,s,a,l),u=Fi.det(s,o*o+s*s,l,a*a+l*l),h=Fi.det(o,o*o+s*s,a,a*a+l*l);return new S(n-u/c,r+h/c)},Fi.perpendicularBisector=function(t,e){var i=e.x-t.x,n=e.y-t.y,r=new q(t.x+i/2,t.y+n/2,1),o=new q(t.x-n+i/2,t.y+i+n/2,1);return new q(r,o)},Fi.angleBisector=function(t,e,i){var n=e.distance(t),r=n/(n+e.distance(i)),o=i.x-t.x,s=i.y-t.y;return new S(t.x+r*o,t.y+r*s)},Fi.area3D=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,o=e.z-t.z,s=i.x-t.x,a=i.y-t.y,l=i.z-t.z,c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,p=c*c+u*u+h*h;return Math.sqrt(p)/2},Fi.centroid=function(t,e,i){var n=(t.x+e.x+i.x)/3,r=(t.y+e.y+i.y)/3;return new S(n,r)},Fi.inCentre=function(t,e,i){var n=e.distance(i),r=t.distance(i),o=t.distance(e),s=n+r+o,a=(n*t.x+r*e.x+o*i.x)/s,l=(n*t.y+r*e.y+o*i.y)/s;return new S(a,l)};var Ni=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Tt;var t=arguments[0],e=arguments[1],i=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=i};Ni.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,M.EXTERIOR,M.INTERIOR)},Ni.prototype.addPolygon=function(t){var e=this._distance,i=Ce.LEFT;this._distance<0&&(e=-this._distance,i=Ce.RIGHT);var n=t.getExteriorRing(),r=Et.removeRepeatedPoints(n.getCoordinates());if(this._distance<0&&this.isErodedCompletely(n,this._distance))return null;if(this._distance<=0&&r.length<3)return null;this.addPolygonRing(r,e,i,M.EXTERIOR,M.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var s=t.getInteriorRingN(o),a=Et.removeRepeatedPoints(s.getCoordinates());this._distance>0&&this.isErodedCompletely(s,-this._distance)||this.addPolygonRing(a,e,Ce.opposite(i),M.INTERIOR,M.EXTERIOR)}},Ni.prototype.isTriangleErodedCompletely=function(t,e){var i=new Fi(t[0],t[1],t[2]),n=i.inCentre();return at.distancePointLine(n,i.p0,i.p1)<Math.abs(e)},Ni.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Et.removeRepeatedPoints(t.getCoordinates()),i=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(i,M.EXTERIOR,M.INTERIOR)},Ni.prototype.addCurve=function(t,e,i){if(null===t||t.length<2)return null;var n=new di(t,new Le(0,M.BOUNDARY,e,i));this._curveList.add(n)},Ni.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Ni.prototype.addPolygonRing=function(t,e,i,n,r){if(0===e&&t.length<ee.MINIMUM_VALID_SIZE)return null;var o=n,s=r;t.length>=ee.MINIMUM_VALID_SIZE&&at.isCCW(t)&&(o=r,s=n,i=Ce.opposite(i));var a=this._curveBuilder.getRingCurve(t,i,e);this.addCurve(a,o,s)},Ni.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Qt?this.addPolygon(t):t instanceof Xt?this.addLineString(t):t instanceof Kt?this.addPoint(t):(t instanceof te||t instanceof Vt||t instanceof ie||t instanceof Ut)&&this.addCollection(t)},Ni.prototype.isErodedCompletely=function(t,e){var i=t.getCoordinates();if(i.length<4)return e<0;if(4===i.length)return this.isTriangleErodedCompletely(i,e);var n=t.getEnvelopeInternal(),r=Math.min(n.getHeight(),n.getWidth());return e<0&&2*Math.abs(e)>r},Ni.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni};var Bi=function(){};Bi.prototype.locate=function(t){},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi};var ji=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};ji.prototype.next=function(){if(this._atStart)return this._atStart=!1,ji.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new n;var t=this._parent.getGeometryN(this._index++);return t instanceof Ut?(this._subcollectionIterator=new ji(t),this._subcollectionIterator.next()):t},ji.prototype.remove=function(){throw new Error(this.getClass().getName())},ji.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},ji.prototype.interfaces_=function(){return[bt]},ji.prototype.getClass=function(){return ji},ji.isAtomic=function(t){return!(t instanceof Ut)};var $i=function(){this._geom=null;var t=arguments[0];this._geom=t};$i.prototype.locate=function(t){return $i.locate(t,this._geom)},$i.prototype.interfaces_=function(){return[Bi]},$i.prototype.getClass=function(){return $i},$i.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&at.isPointInRing(t,e.getCoordinates())},$i.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var i=e.getExteriorRing();if(!$i.isPointInRing(t,i))return!1;for(var n=0;n<e.getNumInteriorRing();n++){var r=e.getInteriorRingN(n);if($i.isPointInRing(t,r))return!1}return!0},$i.containsPoint=function(t,e){if(e instanceof Qt)return $i.containsPointInPolygon(t,e);if(e instanceof Ut)for(var i=new ji(e);i.hasNext();){var n=i.next();if(n!==e&&$i.containsPoint(t,n))return!0}return!1},$i.locate=function(t,e){return e.isEmpty()?M.EXTERIOR:$i.containsPoint(t,e)?M.INTERIOR:M.EXTERIOR};var Ui=function(){this._edgeMap=new h,this._edgeList=null,this._ptInAreaLocation=[M.NONE,M.NONE]};Ui.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),i=e-1;return 0===e&&(i=this._edgeList.size()-1),this._edgeList.get(i)},Ui.prototype.propagateSideLabels=function(t){for(var e=M.NONE,i=this.iterator();i.hasNext();){var n=i.next().getLabel();n.isArea(t)&&n.getLocation(t,Ce.LEFT)!==M.NONE&&(e=n.getLocation(t,Ce.LEFT))}if(e===M.NONE)return null;for(var r=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,Ce.ON)===M.NONE&&a.setLocation(t,Ce.ON,r),a.isArea(t)){var l=a.getLocation(t,Ce.LEFT),c=a.getLocation(t,Ce.RIGHT);if(c!==M.NONE){if(c!==r)throw new Me("side location conflict",s.getCoordinate());l===M.NONE&&et.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=l}else et.isTrue(a.getLocation(t,Ce.LEFT)===M.NONE,"found single null side"),a.setLocation(t,Ce.RIGHT,r),a.setLocation(t,Ce.LEFT,r)}}},Ui.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Ui.prototype.print=function(t){G.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Ui.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ui.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var i=e.size()-1,n=e.get(i).getLabel().getLocation(t,Ce.LEFT);et.isTrue(n!==M.NONE,"Found unlabelled area edge");for(var r=n,o=this.iterator();o.hasNext();){var s=o.next().getLabel();et.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,Ce.LEFT),l=s.getLocation(t,Ce.RIGHT);if(a===l)return!1;if(l!==r)return!1;r=a}return!0},Ui.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this._edgeList.size();e++)if(this._edgeList.get(e)===t)return e;return-1},Ui.prototype.iterator=function(){return this.getEdges().iterator()},Ui.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Tt(this._edgeMap.values())),this._edgeList},Ui.prototype.getLocation=function(t,e,i){return this._ptInAreaLocation[t]===M.NONE&&(this._ptInAreaLocation[t]=$i.locate(e,i[t].getGeometry())),this._ptInAreaLocation[t]},Ui.prototype.toString=function(){var t=new z;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var i=e.next();t.append(i),t.append("\n")}return t.toString()},Ui.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Ui.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],i=this.iterator();i.hasNext();)for(var n=i.next().getLabel(),r=0;r<2;r++)n.isLine(r)&&n.getLocation(r)===M.BOUNDARY&&(e[r]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),l=0;l<2;l++)if(a.isAnyNull(l)){var c=M.NONE;if(e[l])c=M.EXTERIOR;else{var u=s.getCoordinate();c=this.getLocation(l,u,t)}a.setAllLocationsIfNull(l,c)}},Ui.prototype.getDegree=function(){return this._edgeMap.size()},Ui.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null},Ui.prototype.interfaces_=function(){return[]},Ui.prototype.getClass=function(){return Ui};var Vi=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var t=null,e=null,i=this._SCANNING_FOR_INCOMING,n=0;n<this._resultAreaEdgeList.size();n++){var r=this._resultAreaEdgeList.get(n),o=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),i){case this._SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,i=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!r.isInResult())continue;e.setNext(r),i=this._SCANNING_FOR_INCOMING}}if(i===this._LINKING_TO_OUTGOING){if(null===t)throw new Me("no outgoing dirEdge found",this.getCoordinate());et.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},e.prototype.insert=function(t){var e=t;this.insertEdgeEnd(e,e)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var i=t.get(0);if(1===e)return i;var n=t.get(e-1),r=i.getQuadrant(),o=n.getQuadrant();return Be.isNorthern(r)&&Be.isNorthern(o)?i:Be.isNorthern(r)||Be.isNorthern(o)?0!==i.getDy()?i:0!==n.getDy()?n:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null):n},e.prototype.print=function(t){G.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var i=e.next();t.print("out "),i.print(t),t.println(),t.print("in "),i.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Tt;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this._resultAreaEdgeList.add(e)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var i=e.next().getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,i=this._edgeList.size()-1;i>=0;i--){var n=this._edgeList.get(i),r=n.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=n}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),i=t.getDepth(Ce.LEFT),n=t.getDepth(Ce.RIGHT),r=this.computeDepths(e+1,this._edgeList.size(),i);if(this.computeDepths(0,e,r)!==n)throw new Me("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var l=this._edgeList.get(a);l.setEdgeDepths(Ce.RIGHT,s),s=l.getDepth(Ce.LEFT)}return s}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=null,i=null,n=this._SCANNING_FOR_INCOMING,r=this._resultAreaEdgeList.size()-1;r>=0;r--){var o=this._resultAreaEdgeList.get(r),s=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),n){case this._SCANNING_FOR_INCOMING:if(s.getEdgeRing()!==t)continue;i=s,n=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;i.setNextMin(o),n=this._SCANNING_FOR_INCOMING}}n===this._LINKING_TO_OUTGOING&&(et.isTrue(null!==e,"found null for first outgoing dirEdge"),et.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(e))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var i=arguments[0],n=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===i&&n++;return n}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var t=M.NONE,e=this.iterator();e.hasNext();){var i=e.next(),n=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){t=M.INTERIOR;break}if(n.isInResult()){t=M.EXTERIOR;break}}}if(t===M.NONE)return null;for(var r=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===M.INTERIOR):(s.isInResult()&&(r=M.EXTERIOR),a.isInResult()&&(r=M.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this._label=new Le(M.NONE);for(var i=this.iterator();i.hasNext();)for(var n=i.next().getEdge().getLabel(),r=0;r<2;r++){var o=n.getLocation(r);o!==M.INTERIOR&&o!==M.BOUNDARY||this._label.setLocation(r,M.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ui),Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(t){return new Fe(t,new Vi)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ve),qi=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};qi.prototype.compareTo=function(t){var e=t;return qi.compareOriented(this._pts,this._orientation,e._pts,e._orientation)},qi.prototype.interfaces_=function(){return[b]},qi.prototype.getClass=function(){return qi},qi.orientation=function(t){return 1===Et.increasingDirection(t)},qi.compareOriented=function(t,e,i,n){for(var r=e?1:-1,o=n?1:-1,s=e?t.length:-1,a=n?i.length:-1,l=e?0:t.length-1,c=n?0:i.length-1;;){var u=t[l].compareTo(i[c]);if(0!==u)return u;var h=(l+=r)===s,p=(c+=o)===a;if(h&&!p)return-1;if(!h&&p)return 1;if(h&&p)return 0}};var Zi=function(){this._edges=new Tt,this._ocaMap=new h};Zi.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this._edges.size();e++){var i=this._edges.get(e);e>0&&t.print(","),t.print("(");for(var n=i.getCoordinates(),r=0;r<n.length;r++)r>0&&t.print(","),t.print(n[r].x+" "+n[r].y);t.println(")")}t.print(")  ")},Zi.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},Zi.prototype.findEdgeIndex=function(t){for(var e=0;e<this._edges.size();e++)if(this._edges.get(e).equals(t))return e;return-1},Zi.prototype.iterator=function(){return this._edges.iterator()},Zi.prototype.getEdges=function(){return this._edges},Zi.prototype.get=function(t){return this._edges.get(t)},Zi.prototype.findEqualEdge=function(t){var e=new qi(t.getCoordinates());return this._ocaMap.get(e)},Zi.prototype.add=function(t){this._edges.add(t);var e=new qi(t.getCoordinates());this._ocaMap.put(e,t)},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi};var Wi=function(){};Wi.prototype.processIntersections=function(t,e,i,n){},Wi.prototype.isDone=function(){},Wi.prototype.interfaces_=function(){return[]},Wi.prototype.getClass=function(){return Wi};var Hi=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Hi.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if(Hi.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},Hi.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Hi.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Hi.prototype.getLineIntersector=function(){return this._li},Hi.prototype.hasProperIntersection=function(){return this._hasProper},Hi.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Hi.prototype.hasIntersection=function(){return this._hasIntersection},Hi.prototype.isDone=function(){return!1},Hi.prototype.hasInteriorIntersection=function(){return this._hasInterior},Hi.prototype.interfaces_=function(){return[Wi]},Hi.prototype.getClass=function(){return Hi},Hi.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Xi=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],i=arguments[2];this.coord=new S(t),this.segmentIndex=e,this.dist=i};Xi.prototype.getSegmentIndex=function(){return this.segmentIndex},Xi.prototype.getCoordinate=function(){return this.coord},Xi.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Xi.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},Xi.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Xi.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Xi.prototype.getDistance=function(){return this.dist},Xi.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Xi.prototype.interfaces_=function(){return[b]},Xi.prototype.getClass=function(){return Xi};var Yi=function(){this._nodeMap=new h,this.edge=null;var t=arguments[0];this.edge=t};Yi.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},Yi.prototype.iterator=function(){return this._nodeMap.values().iterator()},Yi.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),i=e.next();e.hasNext();){var n=e.next(),r=this.createSplitEdge(i,n);t.add(r),i=n}},Yi.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Yi.prototype.createSplitEdge=function(t,e){var i=e.segmentIndex-t.segmentIndex+2,n=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(n);r||i--;var o=new Array(i).fill(null),s=0;o[s++]=new S(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.edge.pts[a];return r&&(o[s]=e.coord),new en(o,new Le(this.edge._label))},Yi.prototype.add=function(t,e,i){var n=new Xi(t,e,i),r=this._nodeMap.get(n);return null!==r?r:(this._nodeMap.put(n,n),n)},Yi.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},Yi.prototype.interfaces_=function(){return[]},Yi.prototype.getClass=function(){return Yi};var Ki=function(){};Ki.prototype.getChainStartIndices=function(t){var e=0,i=new Tt;i.add(new D(e));do{var n=this.findChainEnd(t,e);i.add(new D(n)),e=n}while(e<t.length-1);return Ki.toIntArray(i)},Ki.prototype.findChainEnd=function(t,e){for(var i=Be.quadrant(t[e],t[e+1]),n=e+1;n<t.length&&Be.quadrant(t[n-1],t[n])===i;)n++;return n-1},Ki.prototype.interfaces_=function(){return[]},Ki.prototype.getClass=function(){return Ki},Ki.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),i=0;i<e.length;i++)e[i]=t.get(i).intValue();return e};var Ji=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Z,this.env2=new Z;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Ki;this.startIndex=e.getChainStartIndices(this.pts)};Ji.prototype.getCoordinates=function(){return this.pts},Ji.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e>i?e:i},Ji.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,i=this.pts[this.startIndex[t+1]].x;return e<i?e:i},Ji.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[i],e.startIndex[i+1],n)}else if(6===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3],l=arguments[4],c=arguments[5],u=this.pts[r],h=this.pts[o],p=s.pts[a],d=s.pts[l];if(o-r==1&&l-a==1)return c.addIntersections(this.e,r,s.e,a),null;if(this.env1.init(u,h),this.env2.init(p,d),!this.env1.intersects(this.env2))return null;var f=Math.trunc((r+o)/2),m=Math.trunc((a+l)/2);r<f&&(a<m&&this.computeIntersectsForChain(r,f,s,a,m,c),m<l&&this.computeIntersectsForChain(r,f,s,m,l,c)),f<o&&(a<m&&this.computeIntersectsForChain(f,o,s,a,m,c),m<l&&this.computeIntersectsForChain(f,o,s,m,l,c))}},Ji.prototype.getStartIndexes=function(){return this.startIndex},Ji.prototype.computeIntersects=function(t,e){for(var i=0;i<this.startIndex.length-1;i++)for(var n=0;n<t.startIndex.length-1;n++)this.computeIntersectsForChain(i,t,n,e)},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji};var Qi=function t(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var i=0;i<3;i++)this._depth[e][i]=t.NULL_VALUE},tn={NULL_VALUE:{configurable:!0}};Qi.prototype.getDepth=function(t,e){return this._depth[t][e]},Qi.prototype.setDepth=function(t,e,i){this._depth[t][e]=i},Qi.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._depth[t][e]!==Qi.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this._depth[i][1]===Qi.NULL_VALUE}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this._depth[n][r]===Qi.NULL_VALUE}},Qi.prototype.normalize=function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this._depth[t][1];this._depth[t][2]<e&&(e=this._depth[t][2]),e<0&&(e=0);for(var i=1;i<3;i++){var n=0;this._depth[t][i]>e&&(n=1),this._depth[t][i]=n}}},Qi.prototype.getDelta=function(t){return this._depth[t][Ce.RIGHT]-this._depth[t][Ce.LEFT]},Qi.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?M.EXTERIOR:M.INTERIOR},Qi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Qi.prototype.add=function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var i=1;i<3;i++){var n=t.getLocation(e,i);n!==M.EXTERIOR&&n!==M.INTERIOR||(this.isNull(e,i)?this._depth[e][i]=Qi.depthAtLocation(n):this._depth[e][i]+=Qi.depthAtLocation(n))}else if(3===arguments.length){var r=arguments[0],o=arguments[1];arguments[2]===M.INTERIOR&&this._depth[r][o]++}},Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi},Qi.depthAtLocation=function(t){return t===M.EXTERIOR?0:t===M.INTERIOR?1:Qi.NULL_VALUE},tn.NULL_VALUE.get=function(){return-1},Object.defineProperties(Qi,tn);var en=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Yi(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Qi,this._depthDelta=0,1===arguments.length){var i=arguments[0];e.call(this,i,null)}else if(2===arguments.length){var n=arguments[0],r=arguments[1];this.pts=n,this._label=r}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Le.toLineLabel(this._label))},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this._isIsolated=t},e.prototype.setName=function(t){this._name=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var i=t;if(this.pts.length!==i.pts.length)return!1;for(var n=!0,r=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(i.pts[s])||(n=!1),this.pts[s].equals2D(i.pts[--o])||(r=!1),!n&&!r)return!1;return!0},e.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},e.prototype.print=function(t){t.print("edge "+this._name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(t){e.updateIM(this._label,t)},e.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this._name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new Ji(this)),this._mce},e.prototype.getEnvelope=function(){if(null===this._env){this._env=new Z;for(var t=0;t<this.pts.length;t++)this._env.expandToInclude(this.pts[t])}return this._env},e.prototype.addIntersection=function(t,e,i,n){var r=new S(t.getIntersection(n)),o=e,s=t.getEdgeDistance(i,n),a=o+1;if(a<this.pts.length){var l=this.pts[a];r.equals2D(l)&&(o=a,s=0)}this.eiList.add(r,o,s)},e.prototype.toString=function(){var t=new z;t.append("edge "+this._name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this._label+" "+this._depthDelta),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this._depthDelta=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++)this.addIntersection(t,e,i,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],i=arguments[1];i.setAtLeastIfValid(e.getLocation(0,Ce.ON),e.getLocation(1,Ce.ON),1),e.isArea()&&(i.setAtLeastIfValid(e.getLocation(0,Ce.LEFT),e.getLocation(1,Ce.LEFT),2),i.setAtLeastIfValid(e.getLocation(0,Ce.RIGHT),e.getLocation(1,Ce.RIGHT),2))},e}(Oe),nn=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Zi,this._bufParams=t||null};nn.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t},nn.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Le(t.getLabel())).flip(),i.merge(n);var r=nn.depthDelta(n),o=e.getDepthDelta()+r;e.setDepthDelta(o)}else this._edgeList.add(t),t.setDepthDelta(nn.depthDelta(t.getLabel()))},nn.prototype.buildSubgraphs=function(t,e){for(var i=new Tt,n=t.iterator();n.hasNext();){var r=n.next(),o=r.getRightmostCoordinate(),s=new Di(i).getDepth(o);r.computeDepth(s),r.findResultEdges(),i.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},nn.prototype.createSubgraphs=function(t){for(var e=new Tt,i=t.getNodes().iterator();i.hasNext();){var n=i.next();if(!n.isVisited()){var r=new ke;r.create(n),e.add(r)}}return Qe.sort(e,Qe.reverseOrder()),e},nn.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},nn.prototype.getNoder=function(t){if(null!==this._workingNoder)return this._workingNoder;var e=new bi,i=new rt;return i.setPrecisionModel(t),e.setSegmentIntersector(new Hi(i)),e},nn.prototype.buffer=function(t,e){var i=this._workingPrecisionModel;null===i&&(i=t.getPrecisionModel()),this._geomFact=t.getFactory();var n=new zi(i,this._bufParams),r=new Ni(t,e,n).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,i),this._graph=new Ge(new Gi),this._graph.addEdges(this._edgeList.getEdges());var o=this.createSubgraphs(this._graph),s=new qe(this._geomFact);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(a)},nn.prototype.computeNodedEdges=function(t,e){var i=this.getNoder(e);i.computeNodes(t);for(var n=i.getNodedSubstrings().iterator();n.hasNext();){var r=n.next(),o=r.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=r.getData(),a=new en(r.getCoordinates(),new Le(s));this.insertUniqueEdge(a)}}},nn.prototype.setNoder=function(t){this._workingNoder=t},nn.prototype.interfaces_=function(){return[]},nn.prototype.getClass=function(){return nn},nn.depthDelta=function(t){var e=t.getLocation(0,Ce.LEFT),i=t.getLocation(0,Ce.RIGHT);return e===M.INTERIOR&&i===M.EXTERIOR?1:e===M.EXTERIOR&&i===M.INTERIOR?-1:0},nn.convertSegStrings=function(t){for(var e=new ye,i=new Tt;t.hasNext();){var n=t.next(),r=e.createLineString(n.getCoordinates());i.add(r)}return e.buildGeometry(i)};var rn=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2],o=arguments[3];this._noder=i,this._scaleFactor=n,this._offsetX=r,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};rn.prototype.rescale=function(){if(k(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.rescale(e.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],n=0;n<i.length;n++)i[n].x=i[n].x/this._scaleFactor+this._offsetX,i[n].y=i[n].y/this._scaleFactor+this._offsetY;2===i.length&&i[0].equals2D(i[1])&&G.out.println(i)}},rn.prototype.scale=function(){if(k(arguments[0],xt)){for(var t=arguments[0],e=new Tt,i=t.iterator();i.hasNext();){var n=i.next();e.add(new di(this.scale(n.getCoordinates()),n.getData()))}return e}if(arguments[0]instanceof Array){for(var r=arguments[0],o=new Array(r.length).fill(null),s=0;s<r.length;s++)o[s]=new S(Math.round((r[s].x-this._offsetX)*this._scaleFactor),Math.round((r[s].y-this._offsetY)*this._scaleFactor),r[s].z);return Et.removeRepeatedPoints(o)}},rn.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},rn.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t},rn.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)},rn.prototype.interfaces_=function(){return[vi]},rn.prototype.getClass=function(){return rn};var on=function(){this._li=new rt,this._segStrings=null;var t=arguments[0];this._segStrings=t},sn={fact:{configurable:!0}};on.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next().getCoordinates();this.checkEndPtVertexIntersections(e[0],this._segStrings),this.checkEndPtVertexIntersections(e[e.length-1],this._segStrings)}else if(2===arguments.length)for(var i=arguments[0],n=arguments[1].iterator();n.hasNext();)for(var r=n.next().getCoordinates(),o=1;o<r.length-1;o++)if(r[o].equals(i))throw new Q("found endpt/interior pt intersection at index "+o+" :pt "+i)},on.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();)for(var e=t.next(),i=this._segStrings.iterator();i.hasNext();){var n=i.next();this.checkInteriorIntersections(e,n)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=r.getCoordinates(),a=o.getCoordinates(),l=0;l<s.length-1;l++)for(var c=0;c<a.length-1;c++)this.checkInteriorIntersections(r,l,o,c);else if(4===arguments.length){var u=arguments[0],h=arguments[1],p=arguments[2],d=arguments[3];if(u===p&&h===d)return null;var f=u.getCoordinates()[h],m=u.getCoordinates()[h+1],g=p.getCoordinates()[d],y=p.getCoordinates()[d+1];if(this._li.computeIntersection(f,m,g,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,f,m)||this.hasInteriorIntersection(this._li,g,y)))throw new Q("found non-noded intersection at "+f+"-"+m+" and "+g+"-"+y)}},on.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},on.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this._segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var i=arguments[0].getCoordinates(),n=0;n<i.length-2;n++)this.checkCollapse(i[n],i[n+1],i[n+2])},on.prototype.hasInteriorIntersection=function(t,e,i){for(var n=0;n<t.getIntersectionNum();n++){var r=t.getIntersection(n);if(!r.equals(e)&&!r.equals(i))return!0}return!1},on.prototype.checkCollapse=function(t,e,i){if(t.equals(i))throw new Q("found non-noded collapse at "+on.fact.createLineString([t,e,i]))},on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},sn.fact.get=function(){return new ye},Object.defineProperties(on,sn);var an=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=i,e<=0)throw new _("Scale factor must be non-zero");1!==e&&(this._pt=new S(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new S,this._p1Scaled=new S),this.initCorners(this._pt)},ln={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};an.prototype.intersectsScaled=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this._maxx<i||this._minx>n||this._maxy<r||this._miny>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return et.isTrue(!(s&&a),"Found bad envelope test"),a},an.prototype.initCorners=function(t){this._minx=t.x-.5,this._maxx=t.x+.5,this._miny=t.y-.5,this._maxy=t.y+.5,this._corner[0]=new S(this._maxx,this._maxy),this._corner[1]=new S(this._minx,this._maxy),this._corner[2]=new S(this._minx,this._miny),this._corner[3]=new S(this._maxx,this._miny)},an.prototype.intersects=function(t,e){return 1===this._scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},an.prototype.scale=function(t){return Math.round(t*this._scaleFactor)},an.prototype.getCoordinate=function(){return this._originalPt},an.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},an.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var t=an.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Z(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv},an.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},an.prototype.intersectsToleranceSquare=function(t,e){var i=!1,n=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper()||i&&n||t.equals(this._pt)||e.equals(this._pt)))))},an.prototype.addSnappedNode=function(t,e){var i=t.getCoordinate(e),n=t.getCoordinate(e+1);return!!this.intersects(i,n)&&(t.addIntersection(this.getCoordinate(),e),!0)},an.prototype.interfaces_=function(){return[]},an.prototype.getClass=function(){return an},ln.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(an,ln);var cn=function(){this.tempEnv1=new Z,this.selectedSegment=new fi};cn.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var t=arguments[1];arguments[0].getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn};var un=function(){this._index=null;var t=arguments[0];this._index=t},hn={HotPixelSnapAction:{configurable:!0}};un.prototype.snap=function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2],r=e.getSafeEnvelope(),o=new pn(e,i,n);return this._index.query(r,{interfaces_:function(){return[Xe]},visitItem:function(t){t.select(r,o)}}),o.isNodeAdded()}},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un},hn.HotPixelSnapAction.get=function(){return pn},Object.defineProperties(un,hn);var pn=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],i=arguments[1],n=arguments[2];this._hotPixel=e,this._parentEdge=i,this._hotPixelVertexIndex=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],i=arguments[0].getContext();if(null!==this._parentEdge&&i===this._parentEdge&&e===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cn),dn=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new Tt};dn.prototype.processIntersections=function(t,e,i,n){if(t===i&&e===n)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];if(this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var l=0;l<this._li.getIntersectionNum();l++)this._interiorIntersections.add(this._li.getIntersection(l));t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)}},dn.prototype.isDone=function(){return!1},dn.prototype.getInteriorIntersections=function(){return this._interiorIntersections},dn.prototype.interfaces_=function(){return[Wi]},dn.prototype.getClass=function(){return dn};var fn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new rt,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};fn.prototype.checkCorrectness=function(t){var e=di.getNodedSubstrings(t),i=new on(e);try{i.checkValid()}catch(t){if(!(t instanceof U))throw t;t.printStackTrace()}},fn.prototype.getNodedSubstrings=function(){return di.getNodedSubstrings(this._nodedSegStrings)},fn.prototype.snapRound=function(t,e){var i=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(i),this.computeVertexSnaps(t)},fn.prototype.findInteriorIntersections=function(t,e){var i=new dn(e);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(t),i.getInteriorIntersections()},fn.prototype.computeVertexSnaps=function(){if(k(arguments[0],xt))for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.computeVertexSnaps(e)}else if(arguments[0]instanceof di)for(var i=arguments[0],n=i.getCoordinates(),r=0;r<n.length;r++){var o=new an(n[r],this._scaleFactor,this._li);this._pointSnapper.snap(o,i,r)&&i.addIntersection(n[r],r)}},fn.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new bi,this._pointSnapper=new un(this._noder.getIndex()),this.snapRound(t,this._li)},fn.prototype.computeIntersectionSnaps=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),n=new an(i,this._scaleFactor,this._li);this._pointSnapper.snap(n)}},fn.prototype.interfaces_=function(){return[vi]},fn.prototype.getClass=function(){return fn};var mn=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Ti,this._resultGeometry=null,this._saveException=null,1===arguments.length){var t=arguments[0];this._argGeom=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._argGeom=e,this._bufParams=i}},gn={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};mn.prototype.bufferFixedPrecision=function(t){var e=new rn(new fn(new de(1)),t.getScale()),i=new nn(this._bufParams);i.setWorkingPrecisionModel(t),i.setNoder(e),this._resultGeometry=i.buffer(this._argGeom,this._distance)},mn.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=mn.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(e){if(!(e instanceof Me))throw e;t._saveException=e}if(null!==t._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var i=arguments[0],n=mn.precisionScaleFactor(this._argGeom,this._distance,i),r=new de(n);this.bufferFixedPrecision(r)}},mn.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===de.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},mn.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)},mn.prototype.bufferOriginalPrecision=function(){try{var t=new nn(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(t){if(!(t instanceof Q))throw t;this._saveException=t}},mn.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry},mn.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)},mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn},mn.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new mn(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var e=arguments[1],i=arguments[2],n=new mn(arguments[0]);return n.setQuadrantSegments(i),n.getResultGeometry(e)}if(arguments[2]instanceof Ti&&arguments[0]instanceof ut&&"number"==typeof arguments[1]){var r=arguments[1];return new mn(arguments[0],arguments[2]).getResultGeometry(r)}}else if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],l=new mn(arguments[0]);return l.setQuadrantSegments(s),l.setEndCapStyle(a),l.getResultGeometry(o)}},mn.precisionScaleFactor=function(t,e,i){var n=t.getEnvelopeInternal(),r=P.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY()))+2*(e>0?e:0),o=i-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,o)},gn.CAP_ROUND.get=function(){return Ti.CAP_ROUND},gn.CAP_BUTT.get=function(){return Ti.CAP_FLAT},gn.CAP_FLAT.get=function(){return Ti.CAP_FLAT},gn.CAP_SQUARE.get=function(){return Ti.CAP_SQUARE},gn.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(mn,gn);var yn=function(){this._pt=[new S,new S],this._distance=v.NaN,this._isNull=!0};yn.prototype.getCoordinates=function(){return this._pt},yn.prototype.getCoordinate=function(t){return this._pt[t]},yn.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},yn.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},yn.prototype.getDistance=function(){return this._distance},yn.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn};var _n=function(){};_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},_n.computeDistance=function(){if(arguments[2]instanceof yn&&arguments[0]instanceof Xt&&arguments[1]instanceof S)for(var t=arguments[1],e=arguments[2],i=arguments[0].getCoordinates(),n=new fi,r=0;r<i.length-1;r++){n.setCoordinates(i[r],i[r+1]);var o=n.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof yn&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var s=arguments[0],a=arguments[1],l=arguments[2];_n.computeDistance(s.getExteriorRing(),a,l);for(var c=0;c<s.getNumInteriorRing();c++)_n.computeDistance(s.getInteriorRingN(c),a,l)}else if(arguments[2]instanceof yn&&arguments[0]instanceof ut&&arguments[1]instanceof S){var u=arguments[0],h=arguments[1],p=arguments[2];if(u instanceof Xt)_n.computeDistance(u,h,p);else if(u instanceof Qt)_n.computeDistance(u,h,p);else if(u instanceof Ut)for(var d=u,f=0;f<d.getNumGeometries();f++){var m=d.getGeometryN(f);_n.computeDistance(m,h,p)}else p.setMinimum(u.getCoordinate(),h)}else if(arguments[2]instanceof yn&&arguments[0]instanceof fi&&arguments[1]instanceof S){var g=arguments[1],y=arguments[2],_=arguments[0].closestPoint(g);y.setMinimum(_,g)}};var vn=function(t){this._maxPtDist=new yn,this._inputGeom=t||null},xn={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};vn.prototype.computeMaxMidpointDistance=function(t){var e=new wn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},vn.prototype.computeMaxVertexDistance=function(t){var e=new bn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())},vn.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()},vn.prototype.getDistancePoints=function(){return this._maxPtDist},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn},xn.MaxPointDistanceFilter.get=function(){return bn},xn.MaxMidpointDistanceFilter.get=function(){return wn},Object.defineProperties(vn,xn);var bn=function(t){this._maxPtDist=new yn,this._minPtDist=new yn,this._geom=t||null};bn.prototype.filter=function(t){this._minPtDist.initialize(),_n.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},bn.prototype.getMaxPointDistance=function(){return this._maxPtDist},bn.prototype.interfaces_=function(){return[dt]},bn.prototype.getClass=function(){return bn};var wn=function(t){this._maxPtDist=new yn,this._minPtDist=new yn,this._geom=t||null};wn.prototype.filter=function(t,e){if(0===e)return null;var i=t.getCoordinate(e-1),n=t.getCoordinate(e),r=new S((i.x+n.x)/2,(i.y+n.y)/2);this._minPtDist.initialize(),_n.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},wn.prototype.isDone=function(){return!1},wn.prototype.isGeometryChanged=function(){return!1},wn.prototype.getMaxPointDistance=function(){return this._maxPtDist},wn.prototype.interfaces_=function(){return[$t]},wn.prototype.getClass=function(){return wn};var Tn=function(t){this._comps=t||null};Tn.prototype.filter=function(t){t instanceof Qt&&this._comps.add(t)},Tn.prototype.interfaces_=function(){return[jt]},Tn.prototype.getClass=function(){return Tn},Tn.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Tn.getPolygons(t,new Tt)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof Qt?i.add(e):e instanceof Ut&&e.apply(new Tn(i)),i}};var Sn=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this._lines=t}else if(2===arguments.length){var e=arguments[0],i=arguments[1];this._lines=e,this._isForcedToLineString=i}};Sn.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ee){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Xt&&this._lines.add(t)},Sn.prototype.setForceToLineString=function(t){this._isForcedToLineString=t},Sn.prototype.interfaces_=function(){return[ct]},Sn.prototype.getClass=function(){return Sn},Sn.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Sn.getLines(t))}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().buildGeometry(Sn.getLines(e,i))}},Sn.getLines=function(){if(1===arguments.length){var t=arguments[0];return Sn.getLines(t,!1)}if(2===arguments.length){if(k(arguments[0],xt)&&k(arguments[1],xt)){for(var e=arguments[1],i=arguments[0].iterator();i.hasNext();){var n=i.next();Sn.getLines(n,e)}return e}if(arguments[0]instanceof ut&&"boolean"==typeof arguments[1]){var r=arguments[0],o=arguments[1],s=new Tt;return r.apply(new Sn(s,o)),s}if(arguments[0]instanceof ut&&k(arguments[1],xt)){var a=arguments[0],l=arguments[1];return a instanceof Xt?l.add(a):a.apply(new Sn(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&k(arguments[0],xt)&&k(arguments[1],xt)){for(var c=arguments[1],u=arguments[2],h=arguments[0].iterator();h.hasNext();){var p=h.next();Sn.getLines(p,c,u)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ut&&k(arguments[1],xt)){var d=arguments[1],f=arguments[2];return arguments[0].apply(new Sn(d,f)),d}}};var Cn=function(){if(this._boundaryRule=ft.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new _("Rule must be non-null");this._boundaryRule=t}};Cn.prototype.locateInternal=function(){if(arguments[0]instanceof S&&arguments[1]instanceof Qt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return M.EXTERIOR;var i=e.getExteriorRing(),n=this.locateInPolygonRing(t,i);if(n===M.EXTERIOR)return M.EXTERIOR;if(n===M.BOUNDARY)return M.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var o=e.getInteriorRingN(r),s=this.locateInPolygonRing(t,o);if(s===M.INTERIOR)return M.EXTERIOR;if(s===M.BOUNDARY)return M.BOUNDARY}return M.INTERIOR}if(arguments[0]instanceof S&&arguments[1]instanceof Xt){var a=arguments[0],l=arguments[1];if(!l.getEnvelopeInternal().intersects(a))return M.EXTERIOR;var c=l.getCoordinates();return l.isClosed()||!a.equals(c[0])&&!a.equals(c[c.length-1])?at.isOnLine(a,c)?M.INTERIOR:M.EXTERIOR:M.BOUNDARY}if(arguments[0]instanceof S&&arguments[1]instanceof Kt){var u=arguments[0];return arguments[1].getCoordinate().equals2D(u)?M.INTERIOR:M.EXTERIOR}},Cn.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?at.locatePointInRing(t,e.getCoordinates()):M.EXTERIOR},Cn.prototype.intersects=function(t,e){return this.locate(t,e)!==M.EXTERIOR},Cn.prototype.updateLocationInfo=function(t){t===M.INTERIOR&&(this._isIn=!0),t===M.BOUNDARY&&this._numBoundaries++},Cn.prototype.computeLocation=function(t,e){if(e instanceof Kt&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Xt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Qt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Vt)for(var i=e,n=0;n<i.getNumGeometries();n++){var r=i.getGeometryN(n);this.updateLocationInfo(this.locateInternal(t,r))}else if(e instanceof ie)for(var o=e,s=0;s<o.getNumGeometries();s++){var a=o.getGeometryN(s);this.updateLocationInfo(this.locateInternal(t,a))}else if(e instanceof Ut)for(var l=new ji(e);l.hasNext();){var c=l.next();c!==e&&this.computeLocation(t,c)}},Cn.prototype.locate=function(t,e){return e.isEmpty()?M.EXTERIOR:e instanceof Xt||e instanceof Qt?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?M.BOUNDARY:this._numBoundaries>0||this._isIn?M.INTERIOR:M.EXTERIOR)},Cn.prototype.interfaces_=function(){return[]},Cn.prototype.getClass=function(){return Cn};var En=function t(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];this._component=e,this._segIndex=i,this._pt=n}},In={INSIDE_AREA:{configurable:!0}};En.prototype.isInsideArea=function(){return this._segIndex===En.INSIDE_AREA},En.prototype.getCoordinate=function(){return this._pt},En.prototype.getGeometryComponent=function(){return this._component},En.prototype.getSegmentIndex=function(){return this._segIndex},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},In.INSIDE_AREA.get=function(){return-1},Object.defineProperties(En,In);var Mn=function(t){this._pts=t||null};Mn.prototype.filter=function(t){t instanceof Kt&&this._pts.add(t)},Mn.prototype.interfaces_=function(){return[jt]},Mn.prototype.getClass=function(){return Mn},Mn.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Kt?Qe.singletonList(t):Mn.getPoints(t,new Tt)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e instanceof Kt?i.add(e):e instanceof Ut&&e.apply(new Mn(i)),i}};var An=function(){this._locations=null;var t=arguments[0];this._locations=t};An.prototype.filter=function(t){(t instanceof Kt||t instanceof Xt||t instanceof Qt)&&this._locations.add(new En(t,0,t.getCoordinate()))},An.prototype.interfaces_=function(){return[jt]},An.prototype.getClass=function(){return An},An.getLocations=function(t){var e=new Tt;return t.apply(new An(e)),e};var kn=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Cn,this._minDistanceLocation=null,this._minDistance=v.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=n,this._terminateDistance=r}};kn.prototype.computeContainmentDistance=function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=1-e,r=Tn.getPolygons(this._geom[e]);if(r.size()>0){var o=An.getLocations(this._geom[n]);if(this.computeContainmentDistance(o,r,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[n]=i[0],this._minDistanceLocation[e]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&k(arguments[0],wt)&&k(arguments[1],wt)){for(var s=arguments[0],a=arguments[1],l=arguments[2],c=0;c<s.size();c++)for(var u=s.get(c),h=0;h<a.size();h++)if(this.computeContainmentDistance(u,a.get(h),l),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof En&&arguments[1]instanceof Qt){var p=arguments[0],d=arguments[1],f=arguments[2],m=p.getCoordinate();if(M.EXTERIOR!==this._ptLocator.locate(m,d))return this._minDistance=0,f[0]=p,f[1]=new En(d,m),null}},kn.prototype.computeMinDistanceLinesPoints=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(r,s,i),this._minDistance<=this._terminateDistance)return null}},kn.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Sn.getLines(this._geom[0]),i=Sn.getLines(this._geom[1]),n=Mn.getPoints(this._geom[0]),r=Mn.getPoints(this._geom[1]);return this.computeMinDistanceLines(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(i,n,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(n,r,t),void this.updateMinDistance(t,!1))))},kn.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},kn.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])},kn.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},kn.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation)return null;if(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Xt&&arguments[1]instanceof Kt){var t=arguments[0],e=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this._minDistance)return null;for(var n=t.getCoordinates(),r=e.getCoordinate(),o=0;o<n.length-1;o++){var s=at.distancePointLine(r,n[o],n[o+1]);if(s<this._minDistance){this._minDistance=s;var a=new fi(n[o],n[o+1]).closestPoint(r);i[0]=new En(t,o,a),i[1]=new En(e,0,r)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Xt&&arguments[1]instanceof Xt){var l=arguments[0],c=arguments[1],u=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this._minDistance)return null;for(var h=l.getCoordinates(),p=c.getCoordinates(),d=0;d<h.length-1;d++)for(var f=0;f<p.length-1;f++){var m=at.distanceLineLine(h[d],h[d+1],p[f],p[f+1]);if(m<this._minDistance){this._minDistance=m;var g=new fi(h[d],h[d+1]),y=new fi(p[f],p[f+1]),_=g.closestPoints(y);u[0]=new En(l,d,_[0]),u[1]=new En(c,f,_[1])}if(this._minDistance<=this._terminateDistance)return null}}},kn.prototype.computeMinDistancePoints=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o),a=r.getCoordinate().distance(s.getCoordinate());if(a<this._minDistance&&(this._minDistance=a,i[0]=new En(r,0,r.getCoordinate()),i[1]=new En(s,0,s.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},kn.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new _("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},kn.prototype.computeMinDistanceLines=function(t,e,i){for(var n=0;n<t.size();n++)for(var r=t.get(n),o=0;o<e.size();o++){var s=e.get(o);if(this.computeMinDistance(r,s,i),this._minDistance<=this._terminateDistance)return null}},kn.prototype.interfaces_=function(){return[]},kn.prototype.getClass=function(){return kn},kn.distance=function(t,e){return new kn(t,e).distance()},kn.isWithinDistance=function(t,e,i){return new kn(t,e,i).distance()<=i},kn.nearestPoints=function(t,e){return new kn(t,e).nearestPoints()};var Pn=function(){this._pt=[new S,new S],this._distance=v.NaN,this._isNull=!0};Pn.prototype.getCoordinates=function(){return this._pt},Pn.prototype.getCoordinate=function(t){return this._pt[t]},Pn.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n<this._distance&&this.initialize(e,i,n)}},Pn.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(n),this._distance=r,this._isNull=!1}},Pn.prototype.toString=function(){return J.toLineString(this._pt[0],this._pt[1])},Pn.prototype.getDistance=function(){return this._distance},Pn.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(2===arguments.length){var e=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(e,i),null;var n=e.distance(i);n>this._distance&&this.initialize(e,i,n)}},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn};var Ln=function(){};Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln},Ln.computeDistance=function(){if(arguments[2]instanceof Pn&&arguments[0]instanceof Xt&&arguments[1]instanceof S)for(var t=arguments[0],e=arguments[1],i=arguments[2],n=new fi,r=t.getCoordinates(),o=0;o<r.length-1;o++){n.setCoordinates(r[o],r[o+1]);var s=n.closestPoint(e);i.setMinimum(s,e)}else if(arguments[2]instanceof Pn&&arguments[0]instanceof Qt&&arguments[1]instanceof S){var a=arguments[0],l=arguments[1],c=arguments[2];Ln.computeDistance(a.getExteriorRing(),l,c);for(var u=0;u<a.getNumInteriorRing();u++)Ln.computeDistance(a.getInteriorRingN(u),l,c)}else if(arguments[2]instanceof Pn&&arguments[0]instanceof ut&&arguments[1]instanceof S){var h=arguments[0],p=arguments[1],d=arguments[2];if(h instanceof Xt)Ln.computeDistance(h,p,d);else if(h instanceof Qt)Ln.computeDistance(h,p,d);else if(h instanceof Ut)for(var f=h,m=0;m<f.getNumGeometries();m++){var g=f.getGeometryN(m);Ln.computeDistance(g,p,d)}else d.setMinimum(h.getCoordinate(),p)}else if(arguments[2]instanceof Pn&&arguments[0]instanceof fi&&arguments[1]instanceof S){var y=arguments[1],_=arguments[2],v=arguments[0].closestPoint(y);_.setMinimum(v,y)}};var zn=function(){this._g0=null,this._g1=null,this._ptDist=new Pn,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Dn={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};zn.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},zn.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new _("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t},zn.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)},zn.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},zn.prototype.computeOrientedDistance=function(t,e,i){var n=new Rn(e);if(t.apply(n),i.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var r=new On(e,this._densifyFrac);t.apply(r),i.setMaximum(r.getMaxPointDistance())}},zn.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.distance=function(){if(2===arguments.length)return new zn(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new zn(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},Dn.MaxPointDistanceFilter.get=function(){return Rn},Dn.MaxDensifiedByFractionDistanceFilter.get=function(){return On},Object.defineProperties(zn,Dn);var Rn=function(){this._maxPtDist=new Pn,this._minPtDist=new Pn,this._euclideanDist=new Ln,this._geom=null;var t=arguments[0];this._geom=t};Rn.prototype.filter=function(t){this._minPtDist.initialize(),Ln.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Rn.prototype.getMaxPointDistance=function(){return this._maxPtDist},Rn.prototype.interfaces_=function(){return[dt]},Rn.prototype.getClass=function(){return Rn};var On=function(){this._maxPtDist=new Pn,this._minPtDist=new Pn,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};On.prototype.filter=function(t,e){if(0===e)return null;for(var i=t.getCoordinate(e-1),n=t.getCoordinate(e),r=(n.x-i.x)/this._numSubSegs,o=(n.y-i.y)/this._numSubSegs,s=0;s<this._numSubSegs;s++){var a=i.x+s*r,l=i.y+s*o,c=new S(a,l);this._minPtDist.initialize(),Ln.computeDistance(this._geom,c,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},On.prototype.isDone=function(){return!1},On.prototype.isGeometryChanged=function(){return!1},On.prototype.getMaxPointDistance=function(){return this._maxPtDist},On.prototype.interfaces_=function(){return[$t]},On.prototype.getClass=function(){return On};var Fn=function(t,e,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=i||null},Nn={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fn.prototype.checkMaximumDistance=function(t,e,i){var n=new zn(e,t);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var r=n.getCoordinates();this._errorLocation=r[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+J.toLineString(r[0],r[1])+")"}},Fn.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Fn.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fn.VERBOSE&&G.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Fn.prototype.checkNegativeValid=function(){if(!(this._input instanceof Qt||this._input instanceof ie||this._input instanceof Ut))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)},Fn.prototype.getErrorIndicator=function(){return this._errorIndicator},Fn.prototype.checkMinimumDistance=function(t,e,i){var n=new kn(t,e,i);if(this._minDistanceFound=n.distance(),this._minDistanceFound<i){this._isValid=!1;var r=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+J.toLineString(r[0],r[1])+" )"}},Fn.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)},Fn.prototype.getErrorLocation=function(){return this._errorLocation},Fn.prototype.getPolygonLines=function(t){for(var e=new Tt,i=new Sn(e),n=Tn.getPolygons(t).iterator();n.hasNext();)n.next().apply(i);return t.getFactory().buildGeometry(e)},Fn.prototype.getErrorMessage=function(){return this._errMsg},Fn.prototype.interfaces_=function(){return[]},Fn.prototype.getClass=function(){return Fn},Nn.VERBOSE.get=function(){return!1},Nn.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fn,Nn);var Bn=function(t,e,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=i||null},jn={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Bn.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Bn.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Bn.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Z(this._input.getEnvelopeInternal());e.expandBy(this._distance);var i=new Z(this._result.getEnvelopeInternal());i.expandBy(t),i.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")},Bn.prototype.checkDistance=function(){var t=new Fn(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")},Bn.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Bn.prototype.checkPolygonal=function(){this._result instanceof Qt||this._result instanceof ie||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Bn.prototype.getErrorIndicator=function(){return this._errorIndicator},Bn.prototype.getErrorLocation=function(){return this._errorLocation},Bn.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Bn.prototype.report=function(t){if(!Bn.VERBOSE)return null;G.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))},Bn.prototype.getErrorMessage=function(){return this._errorMsg},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn},Bn.isValidMsg=function(t,e,i){var n=new Bn(t,e,i);return n.isValid()?null:n.getErrorMessage()},Bn.isValid=function(t,e,i){return!!new Bn(t,e,i).isValid()},jn.VERBOSE.get=function(){return!1},jn.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Bn,jn);var $n=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};$n.prototype.getCoordinates=function(){return this._pts},$n.prototype.size=function(){return this._pts.length},$n.prototype.getCoordinate=function(t){return this._pts[t]},$n.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},$n.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:ui.octant(this.getCoordinate(t),this.getCoordinate(t+1))},$n.prototype.setData=function(t){this._data=t},$n.prototype.getData=function(){return this._data},$n.prototype.toString=function(){return J.toLineString(new le(this._pts))},$n.prototype.interfaces_=function(){return[hi]},$n.prototype.getClass=function(){return $n};var Un=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Tt,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Un.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Un.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t},Un.prototype.getIntersectionSegments=function(){return this._intSegments},Un.prototype.count=function(){return this._intersectionCount},Un.prototype.getIntersections=function(){return this._intersections},Un.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Un.prototype.setKeepIntersections=function(t){this._keepIntersections=t},Un.prototype.processIntersections=function(t,e,i,n){if(!this._findAllIntersections&&this.hasIntersection())return null;if(t===i&&e===n)return null;if(this._isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(i,n))return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=r,this._intSegments[1]=o,this._intSegments[2]=s,this._intSegments[3]=a,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Un.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},Un.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Un.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Un.prototype.interfaces_=function(){return[Wi]},Un.prototype.getClass=function(){return Un},Un.createAllIntersectionsFinder=function(t){var e=new Un(t);return e.setFindAllIntersections(!0),e},Un.createAnyIntersectionFinder=function(t){return new Un(t)},Un.createIntersectionCounter=function(t){var e=new Un(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Vn=function(){this._li=new rt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};Vn.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Vn.prototype.getIntersections=function(){return this._segInt.getIntersections()},Vn.prototype.isValid=function(){return this.execute(),this._isValid},Vn.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t},Vn.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Un(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new bi;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Vn.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Me(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Vn.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+J.toLineString(t[0],t[1])+" and "+J.toLineString(t[2],t[3])},Vn.prototype.interfaces_=function(){return[]},Vn.prototype.getClass=function(){return Vn},Vn.computeIntersections=function(t){var e=new Vn(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Gn=function t(){this._nv=null;var e=arguments[0];this._nv=new Vn(t.toSegmentStrings(e))};Gn.prototype.checkValid=function(){this._nv.checkValid()},Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn},Gn.toSegmentStrings=function(t){for(var e=new Tt,i=t.iterator();i.hasNext();){var n=i.next();e.add(new $n(n.getCoordinates(),n))}return e},Gn.checkValid=function(t){new Gn(t).checkValid()};var qn=function(t){this._mapOp=t};qn.prototype.map=function(t){for(var e=new Tt,i=0;i<t.getNumGeometries();i++){var n=this._mapOp.map(t.getGeometryN(i));n.isEmpty()||e.add(n)}return t.getFactory().createGeometryCollection(ye.toGeometryArray(e))},qn.prototype.interfaces_=function(){return[]},qn.prototype.getClass=function(){return qn},qn.map=function(t,e){return new qn(e).map(t)};var Zn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Tt,this._resultLineList=new Tt;var t=arguments[0],e=arguments[1],i=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=i};Zn.prototype.collectLines=function(t){for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next();this.collectLineEdge(i,t,this._lineEdgesList),this.collectBoundaryTouchEdge(i,t,this._lineEdgesList)}},Zn.prototype.labelIsolatedLine=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,i)},Zn.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList},Zn.prototype.collectLineEdge=function(t,e,i){var n=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Er.isResultOfOp(n,e)||r.isCovered()||(i.add(r),t.setVisitedEdge(!0)))},Zn.prototype.findCoveredLineEdges=function(){for(var t=this._op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this._op.getGraph().getEdgeEnds().iterator();e.hasNext();){var i=e.next(),n=i.getEdge();if(i.isLineEdge()&&!n.isCoveredSet()){var r=this._op.isCoveredByA(i.getCoordinate());n.setCovered(r)}}},Zn.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next(),n=i.getLabel();i.isIsolated()&&(n.isNull(0)?this.labelIsolatedLine(i,0):this.labelIsolatedLine(i,1))}},Zn.prototype.buildLines=function(t){for(var e=this._lineEdgesList.iterator();e.hasNext();){var i=e.next(),n=this._geometryFactory.createLineString(i.getCoordinates());this._resultLineList.add(n),i.setInResult(!0)}},Zn.prototype.collectBoundaryTouchEdge=function(t,e,i){var n=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Er.isResultOfOp(n,e)&&e===Er.INTERSECTION&&(i.add(t.getEdge()),t.setVisitedEdge(!0))))},Zn.prototype.interfaces_=function(){return[]},Zn.prototype.getClass=function(){return Zn};var Wn=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Tt;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Wn.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var i=this._geometryFactory.createPoint(e);this._resultPointList.add(i)}},Wn.prototype.extractNonCoveredResultNodes=function(t){for(var e=this._op.getGraph().getNodes().iterator();e.hasNext();){var i=e.next();if(!(i.isInResult()||i.isIncidentEdgeInResult()||0!==i.getEdges().getDegree()&&t!==Er.INTERSECTION)){var n=i.getLabel();Er.isResultOfOp(n,t)&&this.filterCoveredNodeToPoint(i)}}},Wn.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList},Wn.prototype.interfaces_=function(){return[]},Wn.prototype.getClass=function(){return Wn};var Hn=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Hn.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Hn.prototype.transformPolygon=function(t,e){var i=!0,n=this.transformLinearRing(t.getExteriorRing(),t);null!==n&&n instanceof ee&&!n.isEmpty()||(i=!1);for(var r=new Tt,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof ee||(i=!1),r.add(s))}if(i)return this._factory.createPolygon(n,r.toArray([]));var a=new Tt;return null!==n&&a.add(n),a.addAll(r),this._factory.buildGeometry(a)},Hn.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)},Hn.prototype.getInputGeometry=function(){return this._inputGeom},Hn.prototype.transformMultiLineString=function(t,e){for(var i=new Tt,n=0;n<t.getNumGeometries();n++){var r=this.transformLineString(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},Hn.prototype.transformCoordinates=function(t,e){return this.copy(t)},Hn.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Hn.prototype.transformMultiPoint=function(t,e){for(var i=new Tt,n=0;n<t.getNumGeometries();n++){var r=this.transformPoint(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},Hn.prototype.transformMultiPolygon=function(t,e){for(var i=new Tt,n=0;n<t.getNumGeometries();n++){var r=this.transformPolygon(t.getGeometryN(n),t);null!==r&&(r.isEmpty()||i.add(r))}return this._factory.buildGeometry(i)},Hn.prototype.copy=function(t){return t.copy()},Hn.prototype.transformGeometryCollection=function(t,e){for(var i=new Tt,n=0;n<t.getNumGeometries();n++){var r=this.transform(t.getGeometryN(n));null!==r&&(this._pruneEmptyGeometry&&r.isEmpty()||i.add(r))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ye.toGeometryArray(i)):this._factory.buildGeometry(i)},Hn.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Kt)return this.transformPoint(t,null);if(t instanceof te)return this.transformMultiPoint(t,null);if(t instanceof ee)return this.transformLinearRing(t,null);if(t instanceof Xt)return this.transformLineString(t,null);if(t instanceof Vt)return this.transformMultiLineString(t,null);if(t instanceof Qt)return this.transformPolygon(t,null);if(t instanceof ie)return this.transformMultiPolygon(t,null);if(t instanceof Ut)return this.transformGeometryCollection(t,null);throw new _("Unknown Geometry subtype: "+t.getClass().getName())},Hn.prototype.transformLinearRing=function(t,e){var i=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===i)return this._factory.createLinearRing(null);var n=i.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)},Hn.prototype.interfaces_=function(){return[]},Hn.prototype.getClass=function(){return Hn};var Xn=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new fi,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Xt&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],n=arguments[1];this._srcPts=i,this._isClosed=t.isClosed(i),this._snapTolerance=n}};Xn.prototype.snapVertices=function(t,e){for(var i=this._isClosed?t.size()-1:t.size(),n=0;n<i;n++){var r=t.get(n),o=this.findSnapForVertex(r,e);null!==o&&(t.set(n,new S(o)),0===n&&this._isClosed&&t.set(t.size()-1,new S(o)))}},Xn.prototype.findSnapForVertex=function(t,e){for(var i=0;i<e.length;i++){if(t.equals2D(e[i]))return null;if(t.distance(e[i])<this._snapTolerance)return e[i]}return null},Xn.prototype.snapTo=function(t){var e=new Ct(this._srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Xn.prototype.snapSegments=function(t,e){if(0===e.length)return null;var i=e.length;e[0].equals2D(e[e.length-1])&&(i=e.length-1);for(var n=0;n<i;n++){var r=e[n],o=this.findSegmentIndexToSnap(r,t);o>=0&&t.add(o+1,new S(r),!1)}},Xn.prototype.findSegmentIndexToSnap=function(t,e){for(var i=v.MAX_VALUE,n=-1,r=0;r<e.size()-1;r++){if(this._seg.p0=e.get(r),this._seg.p1=e.get(r+1),this._seg.p0.equals2D(t)||this._seg.p1.equals2D(t)){if(this._allowSnappingToSourceVertices)continue;return-1}var o=this._seg.distance(t);o<this._snapTolerance&&o<i&&(i=o,n=r)}return n},Xn.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t},Xn.prototype.interfaces_=function(){return[]},Xn.prototype.getClass=function(){return Xn},Xn.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Yn=function(t){this._srcGeom=t||null},Kn={SNAP_PRECISION_FACTOR:{configurable:!0}};Yn.prototype.snapTo=function(t,e){var i=this.extractTargetCoordinates(t);return new Jn(e,i).transform(this._srcGeom)},Yn.prototype.snapToSelf=function(t,e){var i=this.extractTargetCoordinates(this._srcGeom),n=new Jn(t,i,!0).transform(this._srcGeom),r=n;return e&&k(r,Jt)&&(r=n.buffer(0)),r},Yn.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Yn.prototype.extractTargetCoordinates=function(t){for(var e=new d,i=t.getCoordinates(),n=0;n<i.length;n++)e.add(i[n]);return e.toArray(new Array(0).fill(null))},Yn.prototype.computeMinimumSegmentLength=function(t){for(var e=v.MAX_VALUE,i=0;i<t.length-1;i++){var n=t[i].distance(t[i+1]);n<e&&(e=n)}return e},Yn.prototype.interfaces_=function(){return[]},Yn.prototype.getClass=function(){return Yn},Yn.snap=function(t,e,i){var n=new Array(2).fill(null),r=new Yn(t);n[0]=r.snapTo(e,i);var o=new Yn(e);return n[1]=o.snapTo(n[0],i),n},Yn.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Yn.computeSizeBasedSnapTolerance(t),i=t.getPrecisionModel();if(i.getType()===de.FIXED){var n=1/i.getScale()*2/1.415;n>e&&(e=n)}return e}if(2===arguments.length){var r=arguments[0],o=arguments[1];return Math.min(Yn.computeOverlaySnapTolerance(r),Yn.computeOverlaySnapTolerance(o))}},Yn.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Yn.SNAP_PRECISION_FACTOR},Yn.snapToSelf=function(t,e,i){return new Yn(t).snapToSelf(e,i)},Kn.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Yn,Kn);var Jn=function(t){function e(e,i,n){t.call(this),this._snapTolerance=e||null,this._snapPts=i||null,this._isSelfSnap=void 0!==n&&n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(t,e){var i=new Xn(t,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var i=t.toCoordinateArray(),n=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Hn),Qn=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Qn.prototype.getCommon=function(){return v.longBitsToDouble(this._commonBits)},Qn.prototype.add=function(t){var e=v.doubleToLongBits(t);return this._isFirst?(this._commonBits=e,this._commonSignExp=Qn.signExpBits(this._commonBits),this._isFirst=!1,null):Qn.signExpBits(e)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Qn.numCommonMostSigMantissaBits(this._commonBits,e),void(this._commonBits=Qn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Qn.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=v.longBitsToDouble(t),i="0000000000000000000000000000000000000000000000000000000000000000"+v.toBinaryString(t),n=i.substring(i.length-64);return n.substring(0,1)+"  "+n.substring(1,12)+"(exp) "+n.substring(12)+" [ "+e+" ]"}},Qn.prototype.interfaces_=function(){return[]},Qn.prototype.getClass=function(){return Qn},Qn.getBit=function(t,e){return 0!=(t&1<<e)?1:0},Qn.signExpBits=function(t){return t>>52},Qn.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Qn.numCommonMostSigMantissaBits=function(t,e){for(var i=0,n=52;n>=0;n--){if(Qn.getBit(t,n)!==Qn.getBit(e,n))return i;i++}return 52};var tr=function(){this._commonCoord=null,this._ccFilter=new ir},er={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};tr.prototype.addCommonBits=function(t){var e=new nr(this._commonCoord);t.apply(e),t.geometryChanged()},tr.prototype.removeCommonBits=function(t){if(0===this._commonCoord.x&&0===this._commonCoord.y)return t;var e=new S(this._commonCoord);e.x=-e.x,e.y=-e.y;var i=new nr(e);return t.apply(i),t.geometryChanged(),t},tr.prototype.getCommonCoordinate=function(){return this._commonCoord},tr.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},er.CommonCoordinateFilter.get=function(){return ir},er.Translater.get=function(){return nr},Object.defineProperties(tr,er);var ir=function(){this._commonBitsX=new Qn,this._commonBitsY=new Qn};ir.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)},ir.prototype.getCommonCoordinate=function(){return new S(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},ir.prototype.interfaces_=function(){return[dt]},ir.prototype.getClass=function(){return ir};var nr=function(){this.trans=null;var t=arguments[0];this.trans=t};nr.prototype.filter=function(t,e){var i=t.getOrdinate(e,0)+this.trans.x,n=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,i),t.setOrdinate(e,1,n)},nr.prototype.isDone=function(){return!1},nr.prototype.isGeometryChanged=function(){return!0},nr.prototype.interfaces_=function(){return[$t]},nr.prototype.getClass=function(){return nr};var rr=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};rr.prototype.selfSnap=function(t){return new Yn(t).snapTo(t,this._snapTolerance)},rr.prototype.removeCommonBits=function(t){this._cbr=new tr,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e},rr.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t},rr.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),i=Er.overlayOp(e[0],e[1],t);return this.prepareResult(i)},rr.prototype.checkValid=function(t){t.isValid()||G.out.println("Snapped geometry is invalid")},rr.prototype.computeSnapTolerance=function(){this._snapTolerance=Yn.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},rr.prototype.snap=function(t){var e=this.removeCommonBits(t);return Yn.snap(e[0],e[1],this._snapTolerance)},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.overlayOp=function(t,e,i){return new rr(t,e).getResultGeometry(i)},rr.union=function(t,e){return rr.overlayOp(t,e,Er.UNION)},rr.intersection=function(t,e){return rr.overlayOp(t,e,Er.INTERSECTION)},rr.symDifference=function(t,e){return rr.overlayOp(t,e,Er.SYMDIFFERENCE)},rr.difference=function(t,e){return rr.overlayOp(t,e,Er.DIFFERENCE)};var or=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};or.prototype.getResultGeometry=function(t){var e=null,i=!1,n=null;try{e=Er.overlayOp(this._geom[0],this._geom[1],t),i=!0}catch(t){if(!(t instanceof Q))throw t;n=t}if(!i)try{e=rr.overlayOp(this._geom[0],this._geom[1],t)}catch(t){throw t instanceof Q?n:t}return e},or.prototype.interfaces_=function(){return[]},or.prototype.getClass=function(){return or},or.overlayOp=function(t,e,i){return new or(t,e).getResultGeometry(i)},or.union=function(t,e){return or.overlayOp(t,e,Er.UNION)},or.intersection=function(t,e){return or.overlayOp(t,e,Er.INTERSECTION)},or.symDifference=function(t,e){return or.overlayOp(t,e,Er.SYMDIFFERENCE)},or.difference=function(t,e){return or.overlayOp(t,e,Er.DIFFERENCE)};var sr=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};sr.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},sr.prototype.interfaces_=function(){return[]},sr.prototype.getClass=function(){return sr};var ar=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var e=arguments[0],i=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=i}else if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._eventType=t.INSERT,this._label=n,this._xValue=r,this._obj=o}},lr={INSERT:{configurable:!0},DELETE:{configurable:!0}};ar.prototype.isDelete=function(){return this._eventType===ar.DELETE},ar.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t},ar.prototype.getObject=function(){return this._obj},ar.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0},ar.prototype.getInsertEvent=function(){return this._insertEvent},ar.prototype.isInsert=function(){return this._eventType===ar.INSERT},ar.prototype.isSameLabel=function(t){return null!==this._label&&this._label===t._label},ar.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ar.prototype.interfaces_=function(){return[b]},ar.prototype.getClass=function(){return ar},lr.INSERT.get=function(){return 1},lr.DELETE.get=function(){return 2},Object.defineProperties(ar,lr);var cr=function(){};cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr};var ur=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],i=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=i};ur.prototype.isTrivialIntersection=function(t,e,i,n){if(t===i&&1===this._li.getIntersectionNum()){if(ur.isAdjacentSegments(e,n))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&n===r||0===n&&e===r)return!0}}return!1},ur.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ur.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t},ur.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ur.prototype.isBoundaryPointInternal=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next().getCoordinate();if(t.isIntersection(n))return!0}return!1},ur.prototype.hasProperIntersection=function(){return this._hasProper},ur.prototype.hasIntersection=function(){return this._hasIntersection},ur.prototype.isDone=function(){return this._isDone},ur.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},ur.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e},ur.prototype.addIntersections=function(t,e,i,n){if(t===i&&e===n)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=i.getCoordinates()[n],a=i.getCoordinates()[n+1];this._li.computeIntersection(r,o,s,a),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,i,n)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(t.addIntersections(this._li,e,0),i.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ur.prototype.interfaces_=function(){return[]},ur.prototype.getClass=function(){return ur},ur.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var hr=function(t){function e(){t.call(this),this.events=new Tt,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){Qe.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var i=this.events.get(e);if(i.isInsert()&&this.processOverlaps(e,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ur&&k(arguments[0],wt)&&k(arguments[1],wt)){var n=arguments[0],r=arguments[1],o=arguments[2];this.addEdges(n,n),this.addEdges(r,r),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&k(arguments[0],wt)&&arguments[1]instanceof ur){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},e.prototype.addEdge=function(t,e){for(var i=t.getMonotoneChainEdge(),n=i.getStartIndexes(),r=0;r<n.length-1;r++){var o=new sr(i,r),s=new ar(e,i.getMinX(r),o);this.events.add(s),this.events.add(new ar(i.getMaxX(r),s))}},e.prototype.processOverlaps=function(t,e,i,n){for(var r=i.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();i.isSameLabel(s)||(r.computeIntersections(a,n),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var i=arguments[1],n=arguments[0].iterator();n.hasNext();){var r=n.next();this.addEdge(r,i)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cr),pr=function(){this._min=v.POSITIVE_INFINITY,this._max=v.NEGATIVE_INFINITY},dr={NodeComparator:{configurable:!0}};pr.prototype.getMin=function(){return this._min},pr.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)},pr.prototype.getMax=function(){return this._max},pr.prototype.toString=function(){return J.toLineString(new S(this._min,0),new S(this._max,0))},pr.prototype.interfaces_=function(){return[]},pr.prototype.getClass=function(){return pr},dr.NodeComparator.get=function(){return fr},Object.defineProperties(pr,dr);var fr=function(){};fr.prototype.compare=function(t,e){var i=t,n=e,r=(i._min+i._max)/2,o=(n._min+n._max)/2;return r<o?-1:r>o?1:0},fr.prototype.interfaces_=function(){return[T]},fr.prototype.getClass=function(){return fr};var mr=function(t){function e(){t.call(this),this._item=null;var e=arguments[0],i=arguments[1],n=arguments[2];this._min=e,this._max=i,this._item=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pr),gr=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var e=arguments[0],i=arguments[1];this._node1=e,this._node2=i,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(t,e){this._min=Math.min(t._min,e._min),this._max=Math.max(t._max,e._max)},e.prototype.query=function(t,e,i){if(!this.intersects(t,e))return null;null!==this._node1&&this._node1.query(t,e,i),null!==this._node2&&this._node2.query(t,e,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pr),yr=function(){this._leaves=new Tt,this._root=null,this._level=0};yr.prototype.buildTree=function(){Qe.sort(this._leaves,new pr.NodeComparator);for(var t=this._leaves,e=null,i=new Tt;;){if(this.buildLevel(t,i),1===i.size())return i.get(0);e=t,t=i,i=e}},yr.prototype.insert=function(t,e,i){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new mr(t,e,i))},yr.prototype.query=function(t,e,i){this.init(),this._root.query(t,e,i)},yr.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},yr.prototype.printNode=function(t){G.out.println(J.toLineString(new S(t._min,this._level),new S(t._max,this._level)))},yr.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},yr.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var i=0;i<t.size();i+=2){var n=t.get(i);if(null===(i+1<t.size()?t.get(i):null))e.add(n);else{var r=new gr(t.get(i),t.get(i+1));e.add(r)}}},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr};var _r=function(){this._items=new Tt};_r.prototype.visitItem=function(t){this._items.add(t)},_r.prototype.getItems=function(){return this._items},_r.prototype.interfaces_=function(){return[Xe]},_r.prototype.getClass=function(){return _r};var vr=function(){this._index=null;var t=arguments[0];if(!k(t,Jt))throw new _("Argument must be Polygonal");this._index=new wr(t)},xr={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};vr.prototype.locate=function(t){var e=new st(t),i=new br(e);return this._index.query(t.y,t.y,i),e.getLocation()},vr.prototype.interfaces_=function(){return[Bi]},vr.prototype.getClass=function(){return vr},xr.SegmentVisitor.get=function(){return br},xr.IntervalIndexedGeometry.get=function(){return wr},Object.defineProperties(vr,xr);var br=function(){this._counter=null;var t=arguments[0];this._counter=t};br.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},br.prototype.interfaces_=function(){return[Xe]},br.prototype.getClass=function(){return br};var wr=function(){this._index=new yr;var t=arguments[0];this.init(t)};wr.prototype.init=function(t){for(var e=Sn.getLines(t).iterator();e.hasNext();){var i=e.next().getCoordinates();this.addLine(i)}},wr.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var i=new fi(t[e-1],t[e]),n=Math.min(i.p0.y,i.p1.y),r=Math.max(i.p0.y,i.p1.y);this._index.insert(n,r,i)}},wr.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new _r;return this._index.query(t,e,i),i.getItems()}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this._index.query(n,r,o)}},wr.prototype.interfaces_=function(){return[]},wr.prototype.getClass=function(){return wr};var Tr=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new pe,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Cn,2===arguments.length){var e=arguments[0],i=arguments[1],n=ft.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=i,this._boundaryNodeRule=n,null!==i&&this.add(i)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this._argIndex=r,this._parentGeom=o,this._boundaryNodeRule=s,null!==o&&this.add(o)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(t,i){var n=this._nodes.addNode(i).getLabel(),r=1;M.NONE,n.getLocation(t,Ce.ON)===M.BOUNDARY&&r++;var o=e.determineBoundary(this._boundaryNodeRule,r);n.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var i=arguments[1],n=arguments[2],r=new ur(arguments[0],!0,!1);r.setIsDoneIfProperInt(n);var o=this.createEdgeSetIntersector(),s=this._parentGeom instanceof ee||this._parentGeom instanceof Qt||this._parentGeom instanceof ie,a=i||!s;return o.computeIntersections(this._edges,r,a),this.addSelfIntersectionNodes(this._argIndex),r}},e.prototype.computeSplitEdges=function(t){for(var e=this._edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,i){var n=new ur(e,i,!0);return n.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,t._edges,n),n},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Kt){var t=arguments[0].getCoordinate();this.insertPoint(this._argIndex,t,M.INTERIOR)}else if(arguments[0]instanceof S){var e=arguments[0];this.insertPoint(this._argIndex,e,M.INTERIOR)}},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),M.EXTERIOR,M.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var i=t.getInteriorRingN(e);this.addPolygonRing(i,M.INTERIOR,M.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this._argIndex,e[0],M.BOUNDARY),this.insertPoint(this._argIndex,e[e.length-1],M.BOUNDARY)},e.prototype.addLineString=function(t){var e=Et.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=e[0],null;var i=new en(e,new Le(this._argIndex,M.INTERIOR));this._lineEdgeMap.put(t,i),this.insertEdge(i),et.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,e[0]),this.insertBoundaryPoint(this._argIndex,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),i=0,n=t.iterator();n.hasNext();){var r=n.next();e[i++]=r.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(t,e,i){if(this.isBoundaryNode(t,e))return null;i===M.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,i)},e.prototype.addPolygonRing=function(t,e,i){if(t.isEmpty())return null;var n=Et.removeRepeatedPoints(t.getCoordinates());if(n.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var r=e,o=i;at.isCCW(n)&&(r=i,o=e);var s=new en(n,new Le(this._argIndex,M.BOUNDARY,r,o));this._lineEdgeMap.put(t,s),this.insertEdge(s),this.insertPoint(this._argIndex,n[0],M.BOUNDARY)},e.prototype.insertPoint=function(t,e,i){var n=this._nodes.addNode(e),r=n.getLabel();null===r?n._label=new Le(t,i):r.setLocation(t,i)},e.prototype.createEdgeSetIntersector=function(){return new hr},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this._edges.iterator();e.hasNext();)for(var i=e.next(),n=i.getLabel().getLocation(t),r=i.eiList.iterator();r.hasNext();){var o=r.next();this.addSelfIntersectionNode(t,o.coord,n)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof ie&&(this._useBoundaryDeterminationRule=!1),e instanceof Qt)this.addPolygon(e);else if(e instanceof Xt)this.addLineString(e);else if(e instanceof Kt)this.addPoint(e);else if(e instanceof te)this.addCollection(e);else if(e instanceof Vt)this.addCollection(e);else if(e instanceof ie)this.addCollection(e);else{if(!(e instanceof Ut))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var i=t.getGeometryN(e);this.add(i)}},e.prototype.locate=function(t){return k(this._parentGeom,Jt)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new vr(this._parentGeom)),this._areaPtLocator.locate(t)):this._ptLocator.locate(t,this._parentGeom)},e.prototype.findEdge=function(){if(1===arguments.length){var e=arguments[0];return this._lineEdgeMap.get(e)}return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?M.BOUNDARY:M.INTERIOR},e}(Ge),Sr=function(){if(this._li=new rt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Tr(0,t)}else if(2===arguments.length){var e=arguments[0],i=arguments[1],n=ft.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Tr(0,e,n),this._arg[1]=new Tr(1,i,n)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Tr(0,r,s),this._arg[1]=new Tr(1,o,s)}};Sr.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()},Sr.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)},Sr.prototype.interfaces_=function(){return[]},Sr.prototype.getClass=function(){return Sr};var Cr=function(){};Cr.prototype.interfaces_=function(){return[]},Cr.prototype.getClass=function(){return Cr},Cr.map=function(){if(arguments[0]instanceof ut&&k(arguments[1],Cr.MapOp)){for(var t=arguments[0],e=arguments[1],i=new Tt,n=0;n<t.getNumGeometries();n++){var r=e.map(t.getGeometryN(n));null!==r&&i.add(r)}return t.getFactory().buildGeometry(i)}if(k(arguments[0],xt)&&k(arguments[1],Cr.MapOp)){for(var o=arguments[0],s=arguments[1],a=new Tt,l=o.iterator();l.hasNext();){var c=l.next(),u=s.map(c);null!==u&&a.add(u)}return a}},Cr.MapOp=function(){};var Er=function(t){function e(){var e=arguments[0],i=arguments[1];t.call(this,e,i),this._ptLocator=new Cn,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Zi,this._resultPolyList=new Tt,this._resultLineList=new Tt,this._resultPointList=new Tt,this._graph=new Ge(new Gi),this._geomFact=e.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(null!==e){var i=e.getLabel(),n=t.getLabel();e.isPointwiseEqual(t)||(n=new Le(t.getLabel())).flip();var r=e.getDepth();r.isNull()&&r.add(i),r.add(n),i.merge(n)}else this._edgeList.add(t)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this._graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),i=e.getSym();e.isInResult()&&i.isInResult()&&(e.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this._resultLineList)||!!this.isCovered(t,this._resultPolyList)},e.prototype.computeGeometry=function(t,i,n,r){var o=new Tt;return o.addAll(t),o.addAll(i),o.addAll(n),o.isEmpty()?e.createEmptyResult(r,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var i=e.iterator();i.hasNext();){var n=i.next();if(this._ptLocator.locate(t,n)!==M.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new Tt,e=this._edgeList.iterator();e.hasNext();){var i=e.next();i.isCollapsed()&&(e.remove(),t.add(i.getCollapsedEdge()))}this._edgeList.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getEdges().getLabel();e.getLabel().merge(i)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this._resultGeom},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var i=e.next();this.insertUniqueEdge(i)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var e=new Tt;this._arg[0].computeSplitEdges(e),this._arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gn.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var i=new qe(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var n=new Zn(this,this._geomFact,this._ptLocator);this._resultLineList=n.build(t);var r=new Wn(this,this._geomFact,this._ptLocator);this._resultPointList=r.build(t),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,t)},e.prototype.labelIncompleteNode=function(t,e){var i=this._ptLocator.locate(t.getCoordinate(),this._arg[e].getGeometry());t.getLabel().setLocation(e,i)},e.prototype.copyPoints=function(t){for(var e=this._arg[t].getNodeIterator();e.hasNext();){var i=e.next();this._graph.addNode(i.getCoordinate()).setLabel(t,i.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var n=i.next(),r=n.getLabel();r.isArea()&&!n.isInteriorAreaEdge()&&e.isResultOfOp(r.getLocation(0,Ce.RIGHT),r.getLocation(1,Ce.RIGHT),t)&&n.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this._edgeList.iterator();t.hasNext();){var e=t.next(),i=e.getLabel(),n=e.getDepth();if(!n.isNull()){n.normalize();for(var r=0;r<2;r++)i.isNull(r)||!i.isArea()||n.isNull(r)||(0===n.getDelta(r)?i.toLine(r):(et.isTrue(!n.isNull(r,Ce.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(r,Ce.LEFT,n.getLocation(r,Ce.LEFT)),et.isTrue(!n.isNull(r,Ce.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(r,Ce.RIGHT,n.getLocation(r,Ce.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this._graph.getNodes().iterator();t.hasNext();){var e=t.next(),i=e.getLabel();e.isIsolated()&&(i.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(i)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Sr);Er.overlayOp=function(t,e,i){return new Er(t,e).getResultGeometry(i)},Er.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Er.createEmptyResult(Er.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var i=e;return qn.map(t,{interfaces_:function(){return[Cr.MapOp]},map:function(t){return t.intersection(i)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Er.INTERSECTION)},Er.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Er.createEmptyResult(Er.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Er.SYMDIFFERENCE)},Er.resultDimension=function(t,e,i){var n=e.getDimension(),r=i.getDimension(),o=-1;switch(t){case Er.INTERSECTION:o=Math.min(n,r);break;case Er.UNION:o=Math.max(n,r);break;case Er.DIFFERENCE:o=n;break;case Er.SYMDIFFERENCE:o=Math.max(n,r)}return o},Er.createEmptyResult=function(t,e,i,n){var r=null;switch(Er.resultDimension(t,e,i)){case-1:r=n.createGeometryCollection(new Array(0).fill(null));break;case 0:r=n.createPoint();break;case 1:r=n.createLineString();break;case 2:r=n.createPolygon()}return r},Er.difference=function(t,e){return t.isEmpty()?Er.createEmptyResult(Er.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Er.DIFFERENCE))},Er.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=t.getLocation(0),n=t.getLocation(1);return Er.isResultOfOp(i,n,e)}if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];switch(r===M.BOUNDARY&&(r=M.INTERIOR),o===M.BOUNDARY&&(o=M.INTERIOR),s){case Er.INTERSECTION:return r===M.INTERIOR&&o===M.INTERIOR;case Er.UNION:return r===M.INTERIOR||o===M.INTERIOR;case Er.DIFFERENCE:return r===M.INTERIOR&&o!==M.INTERIOR;case Er.SYMDIFFERENCE:return r===M.INTERIOR&&o!==M.INTERIOR||r!==M.INTERIOR&&o===M.INTERIOR}return!1}},Er.INTERSECTION=1,Er.UNION=2,Er.DIFFERENCE=3,Er.SYMDIFFERENCE=4;var Ir=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Cn,this._seg=new fi;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Ir.prototype.isWithinToleranceOfBoundary=function(t){for(var e=0;e<this._linework.getNumGeometries();e++)for(var i=this._linework.getGeometryN(e).getCoordinateSequence(),n=0;n<i.size()-1;n++)if(i.getCoordinate(n,this._seg.p0),i.getCoordinate(n+1,this._seg.p1),this._seg.distance(t)<=this._boundaryDistanceTolerance)return!0;return!1},Ir.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?M.BOUNDARY:this._ptLocator.locate(t,this._g)},Ir.prototype.extractLinework=function(t){var e=new Mr;t.apply(e);var i=e.getLinework(),n=ye.toLineStringArray(i);return t.getFactory().createMultiLineString(n)},Ir.prototype.interfaces_=function(){return[]},Ir.prototype.getClass=function(){return Ir};var Mr=function(){this._linework=null,this._linework=new Tt};Mr.prototype.getLinework=function(){return this._linework},Mr.prototype.filter=function(t){if(t instanceof Qt){var e=t;this._linework.add(e.getExteriorRing());for(var i=0;i<e.getNumInteriorRing();i++)this._linework.add(e.getInteriorRingN(i))}},Mr.prototype.interfaces_=function(){return[jt]},Mr.prototype.getClass=function(){return Mr};var Ar=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Ar.prototype.extractPoints=function(t,e,i){for(var n=t.getCoordinates(),r=0;r<n.length-1;r++)this.computeOffsetPoints(n[r],n[r+1],e,i)},Ar.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e},Ar.prototype.getPoints=function(t){for(var e=new Tt,i=Sn.getLines(this._g).iterator();i.hasNext();){var n=i.next();this.extractPoints(n,t,e)}return e},Ar.prototype.computeOffsetPoints=function(t,e,i,n){var r=e.x-t.x,o=e.y-t.y,s=Math.sqrt(r*r+o*o),a=i*r/s,l=i*o/s,c=(e.x+t.x)/2,u=(e.y+t.y)/2;if(this._doLeft){var h=new S(c-l,u+a);n.add(h)}if(this._doRight){var p=new S(c+l,u-a);n.add(p)}},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar};var kr=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new Tt;var e=arguments[0],i=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,i),this._geom=[e,i,n],this._locFinder=[new Ir(this._geom[0],this._boundaryDistanceTolerance),new Ir(this._geom[1],this._boundaryDistanceTolerance),new Ir(this._geom[2],this._boundaryDistanceTolerance)]},Pr={TOLERANCE:{configurable:!0}};kr.prototype.reportResult=function(t,e,i){G.out.println("Overlay result invalid - A:"+M.toLocationSymbol(e[0])+" B:"+M.toLocationSymbol(e[1])+" expected:"+(i?"i":"e")+" actual:"+M.toLocationSymbol(e[2]))},kr.prototype.isValid=function(t){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(t)},kr.prototype.checkValid=function(){if(1===arguments.length){for(var t=arguments[0],e=0;e<this._testCoords.size();e++){var i=this._testCoords.get(e);if(!this.checkValid(t,i))return this._invalidLocation=i,!1}return!0}if(2===arguments.length){var n=arguments[0],r=arguments[1];return this._location[0]=this._locFinder[0].getLocation(r),this._location[1]=this._locFinder[1].getLocation(r),this._location[2]=this._locFinder[2].getLocation(r),!!kr.hasLocation(this._location,M.BOUNDARY)||this.isValidResult(n,this._location)}},kr.prototype.addTestPts=function(t){var e=new Ar(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))},kr.prototype.isValidResult=function(t,e){var i=Er.isResultOfOp(e[0],e[1],t),n=!(i^e[2]===M.INTERIOR);return n||this.reportResult(t,e,i),n},kr.prototype.getInvalidLocation=function(){return this._invalidLocation},kr.prototype.interfaces_=function(){return[]},kr.prototype.getClass=function(){return kr},kr.hasLocation=function(t,e){for(var i=0;i<3;i++)if(t[i]===e)return!0;return!1},kr.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Yn.computeSizeBasedSnapTolerance(t),Yn.computeSizeBasedSnapTolerance(e))},kr.isValid=function(t,e,i,n){return new kr(t,e,n).isValid(i)},Pr.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(kr,Pr);var Lr=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Lr.prototype.extractElements=function(t,e){if(null===t)return null;for(var i=0;i<t.getNumGeometries();i++){var n=t.getGeometryN(i);this._skipEmpty&&n.isEmpty()||e.add(n)}},Lr.prototype.combine=function(){for(var t=new Tt,e=this._inputGeoms.iterator();e.hasNext();){var i=e.next();this.extractElements(i,t)}return 0===t.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},Lr.combine=function(){if(1===arguments.length)return new Lr(arguments[0]).combine();if(2===arguments.length){var t=arguments[0],e=arguments[1];return new Lr(Lr.createList(t,e)).combine()}if(3===arguments.length){var i=arguments[0],n=arguments[1],r=arguments[2];return new Lr(Lr.createList(i,n,r)).combine()}},Lr.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Lr.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],i=new Tt;return i.add(t),i.add(e),i}if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2],s=new Tt;return s.add(n),s.add(r),s.add(o),s}};var zr=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,null===this._inputPolys&&(this._inputPolys=new Tt)},Dr={STRTREE_NODE_CAPACITY:{configurable:!0}};zr.prototype.reduceToGeometries=function(t){for(var e=new Tt,i=t.iterator();i.hasNext();){var n=i.next(),r=null;k(n,wt)?r=this.unionTree(n):n instanceof ut&&(r=n),e.add(r)}return e},zr.prototype.extractByEnvelope=function(t,e,i){for(var n=new Tt,r=0;r<e.getNumGeometries();r++){var o=e.getGeometryN(r);o.getEnvelopeInternal().intersects(t)?n.add(o):i.add(o)}return this._geomFactory.buildGeometry(n)},zr.prototype.unionOptimized=function(t,e){var i=t.getEnvelopeInternal(),n=e.getEnvelopeInternal();if(!i.intersects(n))return Lr.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=i.intersection(n);return this.unionUsingEnvelopeIntersection(t,e,r)},zr.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new oi(zr.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var i=e.next();t.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var n=t.itemsTree();return this.unionTree(n)},zr.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],i=arguments[1],n=arguments[2];if(n-i<=1){var r=zr.getGeometry(e,i);return this.unionSafe(r,null)}if(n-i==2)return this.unionSafe(zr.getGeometry(e,i),zr.getGeometry(e,i+1));var o=Math.trunc((n+i)/2),s=this.binaryUnion(e,i,o),a=this.binaryUnion(e,o,n);return this.unionSafe(s,a)}},zr.prototype.repeatedUnion=function(t){for(var e=null,i=t.iterator();i.hasNext();){var n=i.next();e=null===e?n.copy():e.union(n)}return e},zr.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},zr.prototype.unionActual=function(t,e){return zr.restrictToPolygons(t.union(e))},zr.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},zr.prototype.unionUsingEnvelopeIntersection=function(t,e,i){var n=new Tt,r=this.extractByEnvelope(i,t,n),o=this.extractByEnvelope(i,e,n),s=this.unionActual(r,o);return n.add(s),Lr.combine(n)},zr.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],i=arguments[1];return e.getFactory().createGeometryCollection([e,i]).buffer(0)}},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr},zr.restrictToPolygons=function(t){if(k(t,Jt))return t;var e=Tn.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(ye.toPolygonArray(e))},zr.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},zr.union=function(t){return new zr(t).union()},Dr.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(zr,Dr);var Rr=function(){};Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr},Rr.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Er.createEmptyResult(Er.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),or.overlayOp(t,e,Er.UNION)},t.GeoJSONReader=Te,t.GeoJSONWriter=Se,t.OverlayOp=Er,t.UnionOp=Rr,t.BufferOp=mn,Object.defineProperty(t,"__esModule",{value:!0})}(Fr.exports),Br.prototype={constructor:Br,reset:function(){this.s=this.t=0},add:function(t){$r(jr,t,this.t),$r(this,jr.s,this.s),this.s?this.t+=jr.t:this.s=jr.t},valueOf:function(){return this.s}};var jr=new Br;function $r(t,e,i){var n=t.s=e+i,r=n-e,o=n-r;t.t=e-o+(i-r)}var Ur=1e-6,Vr=Math.PI,Gr=Vr/2,qr=Vr/4,Zr=2*Vr,Wr=180/Vr,Hr=Vr/180,Xr=Math.abs,Yr=Math.atan,Kr=Math.atan2,Jr=Math.cos,Qr=Math.sin,to=Math.sqrt;function eo(t){return t>1?0:t<-1?Vr:Math.acos(t)}function io(t){return t>1?Gr:t<-1?-Gr:Math.asin(t)}function no(){}function ro(t,e){t&&lo.hasOwnProperty(t.type)&&lo[t.type](t,e)}var oo,so,ao={Feature:function(t,e){ro(t.geometry,e)},FeatureCollection:function(t,e){for(var i=t.features,n=-1,r=i.length;++n<r;)ro(i[n].geometry,e)}},lo={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)t=i[n],e.point(t[0],t[1],t[2])},LineString:function(t,e){co(t.coordinates,e,0)},MultiLineString:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)co(i[n],e,0)},Polygon:function(t,e){uo(t.coordinates,e)},MultiPolygon:function(t,e){for(var i=t.coordinates,n=-1,r=i.length;++n<r;)uo(i[n],e)},GeometryCollection:function(t,e){for(var i=t.geometries,n=-1,r=i.length;++n<r;)ro(i[n],e)}};function co(t,e,i){var n,r=-1,o=t.length-i;for(e.lineStart();++r<o;)n=t[r],e.point(n[0],n[1],n[2]);e.lineEnd()}function uo(t,e){var i=-1,n=t.length;for(e.polygonStart();++i<n;)co(t[i],e,1);e.polygonEnd()}function ho(t){return[Kr(t[1],t[0]),io(t[2])]}function po(t){var e=t[0],i=t[1],n=Jr(i);return[n*Jr(e),n*Qr(e),Qr(i)]}function fo(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function mo(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function go(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function yo(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function _o(t){var e=to(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function vo(t,e){function i(i,n){return i=t(i,n),e(i[0],i[1])}return t.invert&&e.invert&&(i.invert=function(i,n){return(i=e.invert(i,n))&&t.invert(i[0],i[1])}),i}function xo(t,e){return[t>Vr?t-Zr:t<-Vr?t+Zr:t,e]}function bo(t){return function(e,i){return[(e+=t)>Vr?e-Zr:e<-Vr?e+Zr:e,i]}}function wo(t){var e=bo(t);return e.invert=bo(-t),e}function To(t,e){var i=Jr(t),n=Qr(t),r=Jr(e),o=Qr(e);function s(t,e){var s=Jr(e),a=Jr(t)*s,l=Qr(t)*s,c=Qr(e),u=c*i+a*n;return[Kr(l*r-u*o,a*i-c*n),io(u*r+l*o)]}return s.invert=function(t,e){var s=Jr(e),a=Jr(t)*s,l=Qr(t)*s,c=Qr(e),u=c*r-l*o;return[Kr(l*r+c*o,a*i+u*n),io(u*i-a*n)]},s}function So(t,e){(e=po(e))[0]-=t,_o(e);var i=eo(-e[1]);return((-e[2]<0?-i:i)+Zr-Ur)%Zr}function Co(){var t,e=[];return{point:function(e,i){t.push([e,i])},lineStart:function(){e.push(t=[])},lineEnd:no,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var i=e;return e=[],t=null,i}}}function Eo(t,e){return Xr(t[0]-e[0])<Ur&&Xr(t[1]-e[1])<Ur}function Io(t,e,i,n){this.x=t,this.z=e,this.o=i,this.e=n,this.v=!1,this.n=this.p=null}function Mo(t,e,i,n,r){var o,s,a=[],l=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,i,n=t[0],s=t[e];if(Eo(n,s)){for(r.lineStart(),o=0;o<e;++o)r.point((n=t[o])[0],n[1]);r.lineEnd()}else a.push(i=new Io(n,t,null,!0)),l.push(i.o=new Io(n,null,i,!1)),a.push(i=new Io(s,t,null,!1)),l.push(i.o=new Io(s,null,i,!0))}})),a.length){for(l.sort(e),Ao(a),Ao(l),o=0,s=l.length;o<s;++o)l[o].e=i=!i;for(var c,u,h=a[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;c=p.z,r.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(o=0,s=c.length;o<s;++o)r.point((u=c[o])[0],u[1]);else n(p.x,p.n.x,1,r);p=p.n}else{if(d)for(c=p.p.z,o=c.length-1;o>=0;--o)r.point((u=c[o])[0],u[1]);else n(p.x,p.p.x,-1,r);p=p.p}c=(p=p.o).z,d=!d}while(!p.v);r.lineEnd()}}}function Ao(t){if(e=t.length){for(var e,i,n=0,r=t[0];++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function ko(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Po(t){for(var e,i,n,r=t.length,o=-1,s=0;++o<r;)s+=t[o].length;for(i=new Array(s);--r>=0;)for(e=(n=t[r]).length;--e>=0;)i[--s]=n[e];return i}Nr(),Nr(),Nr(),xo.invert=xo,1===(oo=ko).length&&(so=oo,oo=function(t,e){return ko(so(t),e)});function Lo(t,e,i,n){function r(r,o){return t<=r&&r<=i&&e<=o&&o<=n}function o(r,o,a,c){var u=0,h=0;if(null==r||(u=s(r,a))!==(h=s(o,a))||l(r,o)<0^a>0)do{c.point(0===u||3===u?t:i,u>1?n:e)}while((u=(u+a+4)%4)!==h);else c.point(o[0],o[1])}function s(n,r){return Xr(n[0]-t)<Ur?r>0?0:3:Xr(n[0]-i)<Ur?r>0?2:1:Xr(n[1]-e)<Ur?r>0?1:0:r>0?3:2}function a(t,e){return l(t.x,e.x)}function l(t,e){var i=s(t,1),n=s(e,1);return i!==n?i-n:0===i?e[1]-t[1]:1===i?t[0]-e[0]:2===i?t[1]-e[1]:e[0]-t[0]}return function(s){var l,c,u,h,p,d,f,m,g,y,_,v=s,x=Co(),b={point:w,lineStart:function(){b.point=T,c&&c.push(u=[]);y=!0,g=!1,f=m=NaN},lineEnd:function(){l&&(T(h,p),d&&g&&x.rejoin(),l.push(x.result()));b.point=w,g&&v.lineEnd()},polygonStart:function(){v=x,l=[],c=[],_=!0},polygonEnd:function(){var e=function(){for(var e=0,i=0,r=c.length;i<r;++i)for(var o,s,a=c[i],l=1,u=a.length,h=a[0],p=h[0],d=h[1];l<u;++l)o=p,s=d,p=(h=a[l])[0],d=h[1],s<=n?d>n&&(p-o)*(n-s)>(d-s)*(t-o)&&++e:d<=n&&(p-o)*(n-s)<(d-s)*(t-o)&&--e;return e}(),i=_&&e,r=(l=Po(l)).length;(i||r)&&(s.polygonStart(),i&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),r&&Mo(l,a,e,o,s),s.polygonEnd());v=s,l=c=u=null}};function w(t,e){r(t,e)&&v.point(t,e)}function T(o,s){var a=r(o,s);if(c&&u.push([o,s]),y)h=o,p=s,d=a,y=!1,a&&(v.lineStart(),v.point(o,s));else if(a&&g)v.point(o,s);else{var l=[f=Math.max(-1e9,Math.min(1e9,f)),m=Math.max(-1e9,Math.min(1e9,m))],x=[o=Math.max(-1e9,Math.min(1e9,o)),s=Math.max(-1e9,Math.min(1e9,s))];!function(t,e,i,n,r,o){var s,a=t[0],l=t[1],c=0,u=1,h=e[0]-a,p=e[1]-l;if(s=i-a,h||!(s>0)){if(s/=h,h<0){if(s<c)return;s<u&&(u=s)}else if(h>0){if(s>u)return;s>c&&(c=s)}if(s=r-a,h||!(s<0)){if(s/=h,h<0){if(s>u)return;s>c&&(c=s)}else if(h>0){if(s<c)return;s<u&&(u=s)}if(s=n-l,p||!(s>0)){if(s/=p,p<0){if(s<c)return;s<u&&(u=s)}else if(p>0){if(s>u)return;s>c&&(c=s)}if(s=o-l,p||!(s<0)){if(s/=p,p<0){if(s>u)return;s>c&&(c=s)}else if(p>0){if(s<c)return;s<u&&(u=s)}return c>0&&(t[0]=a+c*h,t[1]=l+c*p),u<1&&(e[0]=a+u*h,e[1]=l+u*p),!0}}}}}(l,x,t,e,i,n)?a&&(v.lineStart(),v.point(o,s),_=!1):(g||(v.lineStart(),v.point(l[0],l[1])),v.point(x[0],x[1]),a||v.lineEnd(),_=!1)}f=o,m=s,g=a}return b}}var zo=Nr();function Do(t){return t}Nr(),Nr(),Nr();var Ro=1/0,Oo=Ro,Fo=-Ro,No=Fo,Bo={point:function(t,e){t<Ro&&(Ro=t);t>Fo&&(Fo=t);e<Oo&&(Oo=e);e>No&&(No=e)},lineStart:no,lineEnd:no,polygonStart:no,polygonEnd:no,result:function(){var t=[[Ro,Oo],[Fo,No]];return Fo=No=-(Oo=Ro=1/0),t}};function jo(t,e,i,n){return function(r,o){var s,a,l,c=e(o),u=r.invert(n[0],n[1]),h=Co(),p=e(h),d=!1,f={point:m,lineStart:y,lineEnd:_,polygonStart:function(){f.point=v,f.lineStart=x,f.lineEnd=b,a=[],s=[]},polygonEnd:function(){f.point=m,f.lineStart=y,f.lineEnd=_,a=Po(a);var t=function(t,e){var i=e[0],n=e[1],r=[Qr(i),-Jr(i),0],o=0,s=0;zo.reset();for(var a=0,l=t.length;a<l;++a)if(u=(c=t[a]).length)for(var c,u,h=c[u-1],p=h[0],d=h[1]/2+qr,f=Qr(d),m=Jr(d),g=0;g<u;++g,p=_,f=x,m=b,h=y){var y=c[g],_=y[0],v=y[1]/2+qr,x=Qr(v),b=Jr(v),w=_-p,T=w>=0?1:-1,S=T*w,C=S>Vr,E=f*x;if(zo.add(Kr(E*T*Qr(S),m*b+E*Jr(S))),o+=C?w+T*Zr:w,C^p>=i^_>=i){var I=mo(po(h),po(y));_o(I);var M=mo(r,I);_o(M);var A=(C^w>=0?-1:1)*io(M[2]);(n>A||n===A&&(I[0]||I[1]))&&(s+=C^w>=0?1:-1)}}return(o<-Ur||o<Ur&&zo<-Ur)^1&s}(s,u);a.length?(d||(o.polygonStart(),d=!0),Mo(a,Uo,t,i,o)):t&&(d||(o.polygonStart(),d=!0),o.lineStart(),i(null,null,1,o),o.lineEnd()),d&&(o.polygonEnd(),d=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),i(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function m(e,i){var n=r(e,i);t(e=n[0],i=n[1])&&o.point(e,i)}function g(t,e){var i=r(t,e);c.point(i[0],i[1])}function y(){f.point=g,c.lineStart()}function _(){f.point=m,c.lineEnd()}function v(t,e){l.push([t,e]);var i=r(t,e);p.point(i[0],i[1])}function x(){p.lineStart(),l=[]}function b(){v(l[0][0],l[0][1]),p.lineEnd();var t,e,i,n,r=p.clean(),c=h.result(),u=c.length;if(l.pop(),s.push(l),l=null,u)if(1&r){if((e=(i=c[0]).length-1)>0){for(d||(o.polygonStart(),d=!0),o.lineStart(),t=0;t<e;++t)o.point((n=i[t])[0],n[1]);o.lineEnd()}}else u>1&&2&r&&c.push(c.pop().concat(c.shift())),a.push(c.filter($o))}return f}}function $o(t){return t.length>1}function Uo(t,e){return((t=t.x)[0]<0?t[1]-Gr-Ur:Gr-t[1])-((e=e.x)[0]<0?e[1]-Gr-Ur:Gr-e[1])}Nr();var Vo=jo((function(){return!0}),(function(t){var e,i=NaN,n=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a=o>0?Vr:-Vr,l=Xr(o-i);Xr(l-Vr)<Ur?(t.point(i,n=(n+s)/2>0?Gr:-Gr),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),t.point(o,n),e=0):r!==a&&l>=Vr&&(Xr(i-r)<Ur&&(i-=r*Ur),Xr(o-a)<Ur&&(o-=a*Ur),n=function(t,e,i,n){var r,o,s=Qr(t-i);return Xr(s)>Ur?Yr((Qr(e)*(o=Jr(n))*Qr(i)-Qr(n)*(r=Jr(e))*Qr(t))/(r*o*s)):(e+n)/2}(i,n,o,s),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(a,n),e=0),t.point(i=o,n=s),r=a},lineEnd:function(){t.lineEnd(),i=n=NaN},clean:function(){return 2-e}}}),(function(t,e,i,n){var r;if(null==t)r=i*Gr,n.point(-Vr,r),n.point(0,r),n.point(Vr,r),n.point(Vr,0),n.point(Vr,-r),n.point(0,-r),n.point(-Vr,-r),n.point(-Vr,0),n.point(-Vr,r);else if(Xr(t[0]-e[0])>Ur){var o=t[0]<e[0]?Vr:-Vr;r=i*o/2,n.point(-o,r),n.point(0,r),n.point(o,r)}else n.point(e[0],e[1])}),[-Vr,-Gr]);function Go(t,e){var i=Jr(t),n=i>0,r=Xr(i)>Ur;function o(t,e){return Jr(t)*Jr(e)>i}function s(t,e,n){var r=[1,0,0],o=mo(po(t),po(e)),s=fo(o,o),a=o[0],l=s-a*a;if(!l)return!n&&t;var c=i*s/l,u=-i*a/l,h=mo(r,o),p=yo(r,c);go(p,yo(o,u));var d=h,f=fo(p,d),m=fo(d,d),g=f*f-m*(fo(p,p)-1);if(!(g<0)){var y=to(g),_=yo(d,(-f-y)/m);if(go(_,p),_=ho(_),!n)return _;var v,x=t[0],b=e[0],w=t[1],T=e[1];b<x&&(v=x,x=b,b=v);var S=b-x,C=Xr(S-Vr)<Ur;if(!C&&T<w&&(v=w,w=T,T=v),C||S<Ur?C?w+T>0^_[1]<(Xr(_[0]-x)<Ur?w:T):w<=_[1]&&_[1]<=T:S>Vr^(x<=_[0]&&_[0]<=b)){var E=yo(d,(-f+y)/m);return go(E,p),[_,ho(E)]}}}function a(e,i){var r=n?t:Vr-t,o=0;return e<-r?o|=1:e>r&&(o|=2),i<-r?o|=4:i>r&&(o|=8),o}return jo(o,(function(t){var e,i,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(h,p){var d,f=[h,p],m=o(h,p),g=n?m?0:a(h,p):m?a(h+(h<0?Vr:-Vr),p):0;if(!e&&(c=l=m)&&t.lineStart(),m!==l&&(!(d=s(e,f))||Eo(e,d)||Eo(f,d))&&(f[0]+=Ur,f[1]+=Ur,m=o(f[0],f[1])),m!==l)u=0,m?(t.lineStart(),d=s(f,e),t.point(d[0],d[1])):(d=s(e,f),t.point(d[0],d[1]),t.lineEnd()),e=d;else if(r&&e&&n^m){var y;g&i||!(y=s(f,e,!0))||(u=0,n?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1])))}!m||e&&Eo(e,f)||t.point(f[0],f[1]),e=f,l=m,i=g},lineEnd:function(){l&&t.lineEnd(),e=null},clean:function(){return u|(c&&l)<<1}}}),(function(i,n,r,o){!function(t,e,i,n,r,o){if(i){var s=Jr(e),a=Qr(e),l=n*i;null==r?(r=e+n*Zr,o=e-l/2):(r=So(s,r),o=So(s,o),(n>0?r<o:r>o)&&(r+=n*Zr));for(var c,u=r;n>0?u>o:u<o;u-=l)c=ho([s,-a*Jr(u),-a*Qr(u)]),t.point(c[0],c[1])}}(o,t,e,r,i,n)}),n?[0,-t]:[-Vr,t-Vr])}function qo(t){return function(e){var i=new Zo;for(var n in t)i[n]=t[n];return i.stream=e,i}}function Zo(){}function Wo(t,e,i){var n=e[1][0]-e[0][0],r=e[1][1]-e[0][1],o=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=o&&t.clipExtent(null),function(t,e){t&&ao.hasOwnProperty(t.type)?ao[t.type](t,e):ro(t,e)}(i,t.stream(Bo));var s=Bo.result(),a=Math.min(n/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),l=+e[0][0]+(n-a*(s[1][0]+s[0][0]))/2,c=+e[0][1]+(r-a*(s[1][1]+s[0][1]))/2;return null!=o&&t.clipExtent(o),t.scale(150*a).translate([l,c])}Zo.prototype={constructor:Zo,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var Ho=Jr(30*Hr);function Xo(t,e){return+e?function(t,e){function i(n,r,o,s,a,l,c,u,h,p,d,f,m,g){var y=c-n,_=u-r,v=y*y+_*_;if(v>4*e&&m--){var x=s+p,b=a+d,w=l+f,T=to(x*x+b*b+w*w),S=io(w/=T),C=Xr(Xr(w)-1)<Ur||Xr(o-h)<Ur?(o+h)/2:Kr(b,x),E=t(C,S),I=E[0],M=E[1],A=I-n,k=M-r,P=_*A-y*k;(P*P/v>e||Xr((y*A+_*k)/v-.5)>.3||s*p+a*d+l*f<Ho)&&(i(n,r,o,s,a,l,I,M,C,x/=T,b/=T,w,m,g),g.point(I,M),i(I,M,C,x,b,w,c,u,h,p,d,f,m,g))}}return function(e){var n,r,o,s,a,l,c,u,h,p,d,f,m={point:g,lineStart:y,lineEnd:v,polygonStart:function(){e.polygonStart(),m.lineStart=x},polygonEnd:function(){e.polygonEnd(),m.lineStart=y}};function g(i,n){i=t(i,n),e.point(i[0],i[1])}function y(){u=NaN,m.point=_,e.lineStart()}function _(n,r){var o=po([n,r]),s=t(n,r);i(u,h,c,p,d,f,u=s[0],h=s[1],c=n,p=o[0],d=o[1],f=o[2],16,e),e.point(u,h)}function v(){m.point=g,e.lineEnd()}function x(){y(),m.point=b,m.lineEnd=w}function b(t,e){_(n=t,e),r=u,o=h,s=p,a=d,l=f,m.point=_}function w(){i(u,h,c,p,d,f,r,o,n,s,a,l,16,e),m.lineEnd=v,v()}return m}}(t,e):function(t){return qo({point:function(e,i){e=t(e,i),this.stream.point(e[0],e[1])}})}(t)}var Yo=qo({point:function(t,e){this.stream.point(t*Hr,e*Hr)}});function Ko(t){return function(t){var e,i,n,r,o,s,a,l,c,u,h=150,p=480,d=250,f=0,m=0,g=0,y=0,_=0,v=null,x=Vo,b=null,w=Do,T=.5,S=Xo(I,T);function C(t){return[(t=o(t[0]*Hr,t[1]*Hr))[0]*h+i,n-t[1]*h]}function E(t){return(t=o.invert((t[0]-i)/h,(n-t[1])/h))&&[t[0]*Wr,t[1]*Wr]}function I(t,r){return[(t=e(t,r))[0]*h+i,n-t[1]*h]}function M(){o=vo(r=function(t,e,i){return(t%=Zr)?e||i?vo(wo(t),To(e,i)):wo(t):e||i?To(e,i):xo}(g,y,_),e);var t=e(f,m);return i=p-t[0]*h,n=d+t[1]*h,A()}function A(){return c=u=null,C}return C.stream=function(t){return c&&u===t?c:c=Yo(x(r,S(w(u=t))))},C.clipAngle=function(t){return arguments.length?(x=+t?Go(v=t*Hr,6*Hr):(v=null,Vo),A()):v*Wr},C.clipExtent=function(t){return arguments.length?(w=null==t?(b=s=a=l=null,Do):Lo(b=+t[0][0],s=+t[0][1],a=+t[1][0],l=+t[1][1]),A()):null==b?null:[[b,s],[a,l]]},C.scale=function(t){return arguments.length?(h=+t,M()):h},C.translate=function(t){return arguments.length?(p=+t[0],d=+t[1],M()):[p,d]},C.center=function(t){return arguments.length?(f=t[0]%360*Hr,m=t[1]%360*Hr,M()):[f*Wr,m*Wr]},C.rotate=function(t){return arguments.length?(g=t[0]%360*Hr,y=t[1]%360*Hr,_=t.length>2?t[2]%360*Hr:0,M()):[g*Wr,y*Wr,_*Wr]},C.precision=function(t){return arguments.length?(S=Xo(I,T=t*t),A()):to(T)},C.fitExtent=function(t,e){return Wo(C,t,e)},C.fitSize=function(t,e){return function(t,e,i){return Wo(t,[[0,0],e],i)}(C,t,e)},function(){return e=t.apply(this,arguments),C.invert=e.invert&&E,M()}}((function(){return t}))()}function Jo(t){return function(e,i){var n=Jr(e),r=Jr(i),o=t(n*r);return[o*r*Qr(e),o*Qr(i)]}}function Qo(t){return function(e,i){var n=to(e*e+i*i),r=t(n),o=Qr(r),s=Jr(r);return[Kr(e*o,n*s),io(n&&i*o/n)]}}Jo((function(t){return to(2/(1+t))})).invert=Qo((function(t){return 2*io(t/2)}));var ts=Jo((function(t){return(t=eo(t))&&t/Qr(t)}));function es(){return Ko(ts).scale(79.4188).clipAngle(179.999)}function is(t,e){return[t,e]}function ns(t,e,i){var n=(i=i||{}).units||"kilometers",r=i.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof i)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(void 0===e)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return Cr(t,(function(t){var i=rs(t,e,n,r);i&&o.push(i)})),yr(o);case"FeatureCollection":return Sr(t,(function(t){var i=rs(t,e,n,r);i&&Sr(i,(function(t){t&&o.push(t)}))})),yr(o)}return rs(t,e,n,r)}function rs(t,e,i,n){var r=t.properties||{},o="Feature"===t.type?t.geometry:t;if("GeometryCollection"===o.type){var s=[];return Cr(t,(function(t){var r=rs(t,e,i,n);r&&s.push(r)})),yr(s)}var a=function(t){var e=function(t,e){void 0===e&&(e={});var i=Ir(t);return mr([(i[0]+i[2])/2,(i[1]+i[3])/2],e.properties,e)}(t).geometry.coordinates,i=[-e[0],-e[1]];return es().rotate(i).scale(6371008.8)}(o),l={type:o.type,coordinates:ss(o.coordinates,a)},c=(new Fr.exports.GeoJSONReader).read(l),u=_r(vr(e,i),"meters"),h=Fr.exports.BufferOp.bufferOp(c,u,n);if(!os((h=(new Fr.exports.GeoJSONWriter).write(h)).coordinates))return fr({type:h.type,coordinates:as(h.coordinates,a)},r)}function os(t){return Array.isArray(t[0])?os(t[0]):isNaN(t[0])}function ss(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return ss(t,e)}))}function as(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return as(t,e)}))}ts.invert=Qo((function(t){return t})),is.invert=is;let ls,cs,us={};Yt.subscribe((t=>us=t)),Kt.subscribe((t=>{ls=t?.routeLineBuffer})),Jt.subscribe((t=>cs=t));const hs=(t,e)=>{t.once("styledata",(()=>{const i=()=>{t.isStyleLoaded()?e():setTimeout(i,150)};i()}))},ps=(t,e,i)=>{if(!us.puck)return;const n={type:"Feature",geometry:{type:"Point",coordinates:e}};t.getSource(Rt)&&t.getSource(Rt).setData(n),t.getLayer(Rt)&&t.setLayoutProperty(Rt,"icon-rotate",i)},ds=(t,e,i,n)=>{const r=us[i];if(!us[i])return void console.warn(`${i} is not loaded.`);if(!t.hasImage(i)){const{url:e}=r;t.loadImage(e,((e,n)=>{if(e)throw e;t.addImage(i,n)}))}t.getSource(i)||t.addSource(i,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:e}}});t.getLayer(i)||t.addLayer({id:i,type:"symbol",source:i,layout:{"icon-image":i,"icon-allow-overlap":!0,...n}})},fs=(t,e)=>{t.removeLayer(e),t.removeSource(e)},ms=t=>{!!t.getSource(Nt)||t.addSource(Nt,{type:"geojson",data:{type:"FeatureCollection",features:[]}});if(!!!t.getLayer("route-line-internal-mock-layer_0")){let e=t.getStyle().layers.find((t=>"symbol"===t.type&&t?.layout?.["text-field"]))?.id;cs.forEach((i=>{!!!t.getLayer(i.id)&&t.addLayer(i,e),e=i.id}))}},gs=(t,e,i,n={fitToBounds:!0})=>{if(!i)return;const{fitToBounds:r}=n,{coordinates:o}=i,s={type:"Feature",geometry:{type:"LineString",coordinates:o}};if(ls){let e=[],i=t.getStyle();for(const t of ls){const{padding:n,layers:r,type:o}=t,a=["case",["within",ns(s,n,{units:"meters"})],..."include"===o?[!0,!1]:[!1,!0]],l=r.map((e=>{const n=i.layers.find((t=>t.id===e));if(n?.metadata?.routeLineBufferOriginalFilter&&(n.filter=n?.metadata?.routeLineBufferOriginalFilter,delete n?.metadata?.routeLineBufferOriginalFilter),t?.state){let t=n?.filter;t&&"all"!==t[0]&&(t=["all",t]),t||(t=["all"]),t=t.concat([a]),r.includes(n.id)&&(n.metadata||(n.metadata={}),n.metadata.routeLineBufferOriginalFilter=n.filter,n.filter=t)}return n}));e=e.concat(l)}i={...i,layers:i.layers.map((t=>{const i=e.find((e=>e.id===t.id));return i||t}))},t.setStyle(i)}t.getSource(Nt).setData(s);if(r){const i=new("maplibre-gl"===e?ve:ge).LngLatBounds(o[0],o[o.length-1]);for(const t of o)i.extend(t);t.setPitch(0),t.fitBounds(i,{padding:20})}};function ys(t){let e;return{c(){e=w("div"),A(e,"id","map-viewer"),A(e,"class","map svelte-16q73l0")},m(t,i){v(t,e,i)},p:i,i:i,o:i,d(t){t&&x(e)}}}function _s(t,e,i){let n,r,o,{id:s}=e,{url:a}=e,{mapRenderer:l}=e;Kt.subscribe((t=>{i(3,r=t?.routeLineBuffer)})),Gt.subscribe((t=>({mapboxGlAccessToken:o}=t)));let c,u,h,p;Zt.subscribe((t=>i(4,({response:c}=t),c))),Ht.subscribe((t=>u=t)),Jt.subscribe((t=>i(5,h=t))),Yt.subscribe((t=>t));const d=Et.throttle((()=>{if(!p)return;const t=p.getBearing(),e=p.getPitch(),i=p.getZoom(),n={bearing:t,center:p.getCenter(),pitch:e,zoom:i};Ht.set(n)}),250);var f;return B((async()=>{await(async()=>{"maplibre-gl"===l?(await Promise.resolve().then((function(){return ix})),n=await Promise.resolve().then((function(){return xe}))):(await Promise.resolve().then((function(){return nx})),n=await Promise.resolve().then((function(){return ye})),n.accessToken=o)})();i(6,p=new n.Map({id:s,container:"map-viewer",style:a,preserveDrawingBuffer:!0,...u})),Xt.set(p),p.once("styledata",(()=>{hs(p,(()=>{te.set({loading:!0,helperText:"Loading assets"}),fe(p,l).then((t=>{Yt.update((e=>Object.keys(e).reduce(((e,i)=>(e[i]=t.find((t=>t.name===i))??null,e)),{}))),te.set({loading:!1})})).catch((t=>{te.set({loading:!1}),console.error(t)})),ms(p),gs(p,l,c)}))})),p.on("move",(()=>{d()}))})),f=()=>{p&&p.remove()},N().$$.on_destroy.push(f),t.$$set=t=>{"id"in t&&i(0,s=t.id),"url"in t&&i(1,a=t.url),"mapRenderer"in t&&i(2,l=t.mapRenderer)},t.$$.update=()=>{if(118&t.$$.dirty&&p&&a){let t,e,i,n;try{const{layers:r,sources:o}=p.getStyle();t=r.find((t=>t.id===Rt)),e=r.find((t=>"destination-pin"===t.id)),i=o.puck,n=o["destination-pin"]}catch(t){}if("string"==typeof a){p.setStyle(a);const r=()=>{ms(p),gs(p,l,c,{fitToBounds:!1}),e&&!p.getLayer("destination-pin")&&(p.addSource("destination-pin",n),p.addLayer(e)),t&&!p.getLayer(Rt)&&(p.addSource(Rt,i),p.addLayer(t))};hs(p,r)}else{const r=a,o=r.layers.find((t=>t.id.includes("route-line-internal-mock-layer"))),s=r.layers.findIndex((t=>"symbol"===t.type&&t?.layout?.["text-field"]))||r.layers.length;!o&&r.layers.splice(s,0,...h);const l=r.layers.find((t=>"destination-pin"===t.id)),u=r.layers.find((t=>t.id===Rt));e&&!l&&(r.sources["destination-pin"]=n,r.layers.push(e)),t&&!u&&(r.sources.puck=i,r.layers.push(t));const{coordinates:d}=c,f={type:"Feature",geometry:{type:"LineString",coordinates:d}};let m=geometries?{type:"geojson",data:f}:Bt;r.sources[Nt]=m,p.setStyle(r)}}64&t.$$.dirty&&p&&p.once("render",(()=>{const t=document.getElementById("map-viewer");if(t){new ResizeObserver((()=>{p.resize({resize:!0})})).observe(t)}})),84&t.$$.dirty&&p&&p.isStyleLoaded()&&c&&gs(p,l,c,{fitToBounds:!0}),92&t.$$.dirty&&p&&p.isStyleLoaded()&&r&&gs(p,l,c,{fitToBounds:!1})},[s,a,l,r,c,h,p]}class vs extends vt{constructor(t){super(),_t(this,t,_s,ys,l,{id:0,url:1,mapRenderer:2})}}function xs(t){let e,i;return e=new oe({props:{height:t[1],width:t[0],children:vs,childProps:{id:t[2]?.id,url:t[2]?.url,mapRenderer:t[2]?.renderer??t[2]?.type}}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};2&i&&(n.height=t[1]),1&i&&(n.width=t[0]),4&i&&(n.childProps={id:t[2]?.id,url:t[2]?.url,mapRenderer:t[2]?.renderer??t[2]?.type}),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function bs(t){let e,n,r,o=t[2]?.renderer??t[2]?.type,s=xs(t);return{c(){e=w("div"),n=w("div"),s.c(),A(n,"class","device-container svelte-l666nc"),A(e,"class","display-area svelte-l666nc")},m(t,i){v(t,e,i),_(e,n),s.m(n,null),r=!0},p(t,[e]){4&e&&l(o,o=t[2]?.renderer??t[2]?.type)?(ot(),lt(s,1,1,i),st(),s=xs(t),s.c(),at(s,1),s.m(n,null)):s.p(t,e)},i(t){r||(at(s),r=!0)},o(t){lt(s),r=!1},d(t){t&&x(e),s.d(t)}}}function ws(t,e,i){let n,r;Gt.subscribe((t=>{({devices:n}=t),({styles:r}=t)}));let o=n[0].width,s=n[0].height;Qt.subscribe((t=>{t&&(i(0,o=t.width),i(1,s=t.height))}));let a=r[0];return Kt.subscribe((t=>{t&&i(2,a=t)})),[o,s,a]}class Ts extends vt{constructor(t){super(),_t(this,t,ws,bs,l,{})}}function Ss(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Cs(t){let e,r,o=t[1]&&Ss(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M22 16L12 26 10.6 24.6 19.2 16 10.6 7.4 12 6z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=Ss(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Es(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Is=class extends vt{constructor(t){super(),_t(this,t,Es,Cs,l,{size:0,title:1})}};function Ms(t,e,i){const n=t.slice();return n[2]=e[i].width,n}function As(t){let e,i,r,o,a=[t[4],{style:i="width: "+t[2]+";"+t[4].style}],l={};for(let t=0;t<a.length;t+=1)l=n(l,a[t]);return{c(){e=w("p"),k(e,l),R(e,"bx--skeleton__text",!0),R(e,"bx--skeleton__heading",t[0])},m(i,n){v(i,e,n),r||(o=[I(e,"click",t[12]),I(e,"mouseover",t[13]),I(e,"mouseenter",t[14]),I(e,"mouseleave",t[15])],r=!0)},p(t,n){k(e,l=pt(a,[16&n&&t[4],20&n&&i!==(i="width: "+t[2]+";"+t[4].style)&&{style:i}])),R(e,"bx--skeleton__text",!0),R(e,"bx--skeleton__heading",t[0])},d(t){t&&x(e),r=!1,s(o)}}}function ks(t){let e,i,r,o=t[3],a=[];for(let e=0;e<o.length;e+=1)a[e]=Ps(Ms(t,o,e));let l=[t[4]],c={};for(let t=0;t<l.length;t+=1)c=n(c,l[t]);return{c(){e=w("div");for(let t=0;t<a.length;t+=1)a[t].c();k(e,c)},m(n,o){v(n,e,o);for(let t=0;t<a.length;t+=1)a[t].m(e,null);i||(r=[I(e,"click",t[8]),I(e,"mouseover",t[9]),I(e,"mouseenter",t[10]),I(e,"mouseleave",t[11])],i=!0)},p(t,i){if(9&i){let n;for(o=t[3],n=0;n<o.length;n+=1){const r=Ms(t,o,n);a[n]?a[n].p(r,i):(a[n]=Ps(r),a[n].c(),a[n].m(e,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}k(e,c=pt(l,[16&i&&t[4]]))},d(t){t&&x(e),b(a,t),i=!1,s(r)}}}function Ps(t){let e;return{c(){e=w("p"),D(e,"width",t[2]),R(e,"bx--skeleton__text",!0),R(e,"bx--skeleton__heading",t[0])},m(t,i){v(t,e,i)},p(t,i){8&i&&D(e,"width",t[2]),1&i&&R(e,"bx--skeleton__heading",t[0])},d(t){t&&x(e)}}}function Ls(t){let e;function n(t,e){return t[1]?ks:As}let r=n(t),o=r(t);return{c(){o.c(),e=E()},m(t,i){o.m(t,i),v(t,e,i)},p(t,[i]){r===(r=n(t))&&o?o.p(t,i):(o.d(1),o=r(t),o&&(o.c(),o.m(e.parentNode,e)))},i:i,o:i,d(t){o.d(t),t&&x(e)}}}function zs(t,e,i){let r,o,s;const a=["lines","heading","paragraph","width"];let l=m(e,a),{lines:c=3}=e,{heading:u=!1}=e,{paragraph:h=!1}=e,{width:p="100%"}=e;const d=[.973,.153,.567];return t.$$set=t=>{e=n(n({},e),f(t)),i(4,l=m(e,a)),"lines"in t&&i(5,c=t.lines),"heading"in t&&i(0,u=t.heading),"paragraph"in t&&i(1,h=t.paragraph),"width"in t&&i(2,p=t.width)},t.$$.update=()=>{if(4&t.$$.dirty&&i(7,o=parseInt(p,10)),4&t.$$.dirty&&i(6,s=p.includes("px")),238&t.$$.dirty&&h)for(let t=0;t<c;t++){const e=s?o-75:0,n=s?o:75,a=Math.floor(d[t%3]*(n-e+1))+e+"px";i(3,r=[...r,{width:s?a:`calc(${p} - ${a})`}])}},i(3,r=[]),[u,h,p,r,l,c,s,o,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var Ds=class extends vt{constructor(t){super(),_t(this,t,zs,Ls,l,{lines:5,heading:0,paragraph:1,width:2})}};function Rs(t,e,i){const n=t.slice();return n[9]=e[i],n}function Os(t){let e,i,n,r,o,s,a,l,c,u,h,p,d;return n=new Is({props:{class:"bx--accordion__arrow"}}),o=new Ds({props:{class:"bx--accordion__title"}}),l=new Ds({props:{width:"90%"}}),u=new Ds({props:{width:"80%"}}),p=new Ds({props:{width:"95%"}}),{c(){e=w("li"),i=w("span"),mt(n.$$.fragment),r=C(),mt(o.$$.fragment),s=C(),a=w("div"),mt(l.$$.fragment),c=C(),mt(u.$$.fragment),h=C(),mt(p.$$.fragment),R(i,"bx--accordion__heading",!0),A(a,"class","bx--accordion__content"),R(e,"bx--accordion__item",!0),R(e,"bx--accordion__item--active",!0)},m(t,f){v(t,e,f),_(e,i),gt(n,i,null),_(i,r),gt(o,i,null),_(e,s),_(e,a),gt(l,a,null),_(a,c),gt(u,a,null),_(a,h),gt(p,a,null),d=!0},i(t){d||(at(n.$$.fragment,t),at(o.$$.fragment,t),at(l.$$.fragment,t),at(u.$$.fragment,t),at(p.$$.fragment,t),d=!0)},o(t){lt(n.$$.fragment,t),lt(o.$$.fragment,t),lt(l.$$.fragment,t),lt(u.$$.fragment,t),lt(p.$$.fragment,t),d=!1},d(t){t&&x(e),yt(n),yt(o),yt(l),yt(u),yt(p)}}}function Fs(t,e){let i,n,r,o,s,a,l;return r=new Is({props:{class:"bx--accordion__arrow"}}),s=new Ds({props:{class:"bx--accordion__title"}}),{key:t,first:null,c(){i=w("li"),n=w("span"),mt(r.$$.fragment),o=C(),mt(s.$$.fragment),a=C(),A(n,"class","bx--accordion__heading"),A(i,"class","bx--accordion__item"),this.first=i},m(t,e){v(t,i,e),_(i,n),gt(r,n,null),_(n,o),gt(s,n,null),_(i,a),l=!0},p(t,e){t},i(t){l||(at(r.$$.fragment,t),at(s.$$.fragment,t),l=!0)},o(t){lt(r.$$.fragment,t),lt(s.$$.fragment,t),l=!1},d(t){t&&x(i),yt(r),yt(s)}}}function Ns(t){let e,i,r,o,a,l=[],c=new Map,u=t[3]&&Os(),h=Array.from({length:t[3]?t[0]-1:t[0]},Bs);const p=t=>t[9];for(let e=0;e<h.length;e+=1){let i=Rs(t,h,e),n=p(i);c.set(n,l[e]=Fs(n))}let d=[t[4]],f={};for(let t=0;t<d.length;t+=1)f=n(f,d[t]);return{c(){e=w("ul"),u&&u.c(),i=C();for(let t=0;t<l.length;t+=1)l[t].c();k(e,f),R(e,"bx--skeleton",!0),R(e,"bx--accordion",!0),R(e,"bx--accordion--start","start"===t[1]),R(e,"bx--accordion--end","end"===t[1]),R(e,"bx--accordion--sm","sm"===t[2]),R(e,"bx--accordion--xl","xl"===t[2])},m(n,s){v(n,e,s),u&&u.m(e,null),_(e,i);for(let t=0;t<l.length;t+=1)l[t].m(e,null);r=!0,o||(a=[I(e,"click",t[5]),I(e,"mouseover",t[6]),I(e,"mouseenter",t[7]),I(e,"mouseleave",t[8])],o=!0)},p(t,[n]){t[3]?u?8&n&&at(u,1):(u=Os(),u.c(),at(u,1),u.m(e,i)):u&&(ot(),lt(u,1,1,(()=>{u=null})),st()),9&n&&(h=Array.from({length:t[3]?t[0]-1:t[0]},Bs),ot(),l=ht(l,n,p,1,t,h,c,e,ut,Fs,null,Rs),st()),k(e,f=pt(d,[16&n&&t[4]])),R(e,"bx--skeleton",!0),R(e,"bx--accordion",!0),R(e,"bx--accordion--start","start"===t[1]),R(e,"bx--accordion--end","end"===t[1]),R(e,"bx--accordion--sm","sm"===t[2]),R(e,"bx--accordion--xl","xl"===t[2])},i(t){if(!r){at(u);for(let t=0;t<h.length;t+=1)at(l[t]);r=!0}},o(t){lt(u);for(let t=0;t<l.length;t+=1)lt(l[t]);r=!1},d(t){t&&x(e),u&&u.d();for(let t=0;t<l.length;t+=1)l[t].d();o=!1,s(a)}}}const Bs=(t,e)=>e;function js(t,e,i){const r=["count","align","size","open"];let o=m(e,r),{count:s=4}=e,{align:a="end"}=e,{size:l}=e,{open:c=!0}=e;return t.$$set=t=>{e=n(n({},e),f(t)),i(4,o=m(e,r)),"count"in t&&i(0,s=t.count),"align"in t&&i(1,a=t.align),"size"in t&&i(2,l=t.size),"open"in t&&i(3,c=t.open)},[s,a,l,c,o,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var $s=class extends vt{constructor(t){super(),_t(this,t,js,Ns,l,{count:0,align:1,size:2,open:3})}};function Us(t){let e,i,r,o;const a=t[6].default,l=c(a,t,t[5],null);let u=[t[3]],f={};for(let t=0;t<u.length;t+=1)f=n(f,u[t]);return{c(){e=w("ul"),l&&l.c(),k(e,f),R(e,"bx--accordion",!0),R(e,"bx--accordion--start","start"===t[0]),R(e,"bx--accordion--end","end"===t[0]),R(e,"bx--accordion--sm","sm"===t[1]),R(e,"bx--accordion--xl","xl"===t[1])},m(n,s){v(n,e,s),l&&l.m(e,null),i=!0,r||(o=[I(e,"click",t[7]),I(e,"mouseover",t[8]),I(e,"mouseenter",t[9]),I(e,"mouseleave",t[10])],r=!0)},p(t,n){l&&l.p&&(!i||32&n)&&p(l,a,t,t[5],i?h(a,t[5],n,null):d(t[5]),null),k(e,f=pt(u,[8&n&&t[3]])),R(e,"bx--accordion",!0),R(e,"bx--accordion--start","start"===t[0]),R(e,"bx--accordion--end","end"===t[0]),R(e,"bx--accordion--sm","sm"===t[1]),R(e,"bx--accordion--xl","xl"===t[1])},i(t){i||(at(l,t),i=!0)},o(t){lt(l,t),i=!1},d(t){t&&x(e),l&&l.d(t),r=!1,s(o)}}}function Vs(t){let e,i;const r=[t[3],{align:t[0]},{size:t[1]}];let o={};for(let t=0;t<r.length;t+=1)o=n(o,r[t]);return e=new $s({props:o}),e.$on("click",t[11]),e.$on("mouseover",t[12]),e.$on("mouseenter",t[13]),e.$on("mouseleave",t[14]),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n=11&i?pt(r,[8&i&&dt(t[3]),1&i&&{align:t[0]},2&i&&{size:t[1]}]):{};e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Gs(t){let e,i,n,r;const o=[Vs,Us],s=[];function a(t,e){return t[2]?0:1}return e=a(t),i=s[e]=o[e](t),{c(){i.c(),n=E()},m(t,i){s[e].m(t,i),v(t,n,i),r=!0},p(t,[r]){let l=e;e=a(t),e===l?s[e].p(t,r):(ot(),lt(s[l],1,1,(()=>{s[l]=null})),st(),i=s[e],i?i.p(t,r):(i=s[e]=o[e](t),i.c()),at(i,1),i.m(n.parentNode,n))},i(t){r||(at(i),r=!0)},o(t){lt(i),r=!1},d(t){s[e].d(t),t&&x(n)}}}function qs(t,e,i){const r=["align","size","disabled","skeleton"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{align:l="end"}=e,{size:c}=e,{disabled:u=!1}=e,{skeleton:h=!1}=e;const p=Dt(u);var d,g;return d="Accordion",g={disableItems:p},N().$$.context.set(d,g),t.$$set=t=>{e=n(n({},e),f(t)),i(3,o=m(e,r)),"align"in t&&i(0,l=t.align),"size"in t&&i(1,c=t.size),"disabled"in t&&i(4,u=t.disabled),"skeleton"in t&&i(2,h=t.skeleton),"$$scope"in t&&i(5,a=t.$$scope)},t.$$.update=()=>{16&t.$$.dirty&&p.set(u)},[l,c,h,o,u,a,s,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var Zs=class extends vt{constructor(t){super(),_t(this,t,qs,Gs,l,{align:0,size:1,disabled:4,skeleton:2})}};const Ws=t=>({}),Hs=t=>({});function Xs(t){let e,i,r,o,a,l,u,f,m,g;r=new Is({props:{class:"bx--accordion__arrow","aria-label":t[3]}});const y=t[7].title,b=c(y,t,t[6],Hs),T=b||function(t){let e;return{c(){e=S(t[2])},m(t,i){v(t,e,i)},p(t,i){4&i&&L(e,t[2])},d(t){t&&x(e)}}}(t),E=t[7].default,M=c(E,t,t[6],null);let P=[t[5]],z={};for(let t=0;t<P.length;t+=1)z=n(z,P[t]);return{c(){e=w("li"),i=w("button"),mt(r.$$.fragment),o=C(),a=w("div"),T&&T.c(),l=C(),u=w("div"),M&&M.c(),R(a,"bx--accordion__title",!0),A(i,"type","button"),A(i,"title",t[3]),A(i,"aria-expanded",t[0]),i.disabled=t[1],R(i,"bx--accordion__heading",!0),R(u,"bx--accordion__content",!0),k(e,z),R(e,"bx--accordion__item",!0),R(e,"bx--accordion__item--active",t[0]),R(e,"bx--accordion__item--disabled",t[1]),R(e,"bx--accordion__item--expanding","expanding"===t[4]),R(e,"bx--accordion__item--collapsing","collapsing"===t[4])},m(n,s){v(n,e,s),_(e,i),gt(r,i,null),_(i,o),_(i,a),T&&T.m(a,null),_(e,l),_(e,u),M&&M.m(u,null),f=!0,m||(g=[I(i,"click",t[9]),I(i,"click",t[14]),I(i,"mouseover",t[10]),I(i,"mouseenter",t[11]),I(i,"mouseleave",t[12]),I(i,"keydown",t[13]),I(i,"keydown",t[15]),I(e,"animationend",t[8]),I(e,"animationend",t[16])],m=!0)},p(t,[n]){const o={};8&n&&(o["aria-label"]=t[3]),r.$set(o),b?b.p&&(!f||64&n)&&p(b,y,t,t[6],f?h(y,t[6],n,Ws):d(t[6]),Hs):T&&T.p&&(!f||4&n)&&T.p(t,f?n:-1),(!f||8&n)&&A(i,"title",t[3]),(!f||1&n)&&A(i,"aria-expanded",t[0]),(!f||2&n)&&(i.disabled=t[1]),M&&M.p&&(!f||64&n)&&p(M,E,t,t[6],f?h(E,t[6],n,null):d(t[6]),null),k(e,z=pt(P,[32&n&&t[5]])),R(e,"bx--accordion__item",!0),R(e,"bx--accordion__item--active",t[0]),R(e,"bx--accordion__item--disabled",t[1]),R(e,"bx--accordion__item--expanding","expanding"===t[4]),R(e,"bx--accordion__item--collapsing","collapsing"===t[4])},i(t){f||(at(r.$$.fragment,t),at(T,t),at(M,t),f=!0)},o(t){lt(r.$$.fragment,t),lt(T,t),lt(M,t),f=!1},d(t){t&&x(e),yt(r),T&&T.d(t),M&&M.d(t),m=!1,s(g)}}}function Ys(t,e,i){const r=["title","open","disabled","iconDescription"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{title:l="title"}=e,{open:c=!1}=e,{disabled:u=!1}=e,{iconDescription:h="Expand/Collapse"}=e,p=u;const d=$("Accordion").disableItems.subscribe((t=>{!t&&p||i(1,u=t)}));let g;B((()=>()=>{d()}));return t.$$set=t=>{e=n(n({},e),f(t)),i(5,o=m(e,r)),"title"in t&&i(2,l=t.title),"open"in t&&i(0,c=t.open),"disabled"in t&&i(1,u=t.disabled),"iconDescription"in t&&i(3,h=t.iconDescription),"$$scope"in t&&i(6,a=t.$$scope)},[c,u,l,h,g,o,a,s,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},()=>{i(0,c=!c),i(4,g=c?"expanding":"collapsing")},({key:t})=>{c&&"Escape"===t&&i(0,c=!1)},()=>{i(4,g=void 0)}]}var Ks=class extends vt{constructor(t){super(),_t(this,t,Ys,Xs,l,{title:2,open:0,disabled:1,iconDescription:3})}};function Js(t){let e,i,r,o=[t[2]],a={};for(let t=0;t<o.length;t+=1)a=n(a,o[t]);return{c(){e=w("div"),k(e,a),R(e,"bx--skeleton",!0),R(e,"bx--btn",!0),R(e,"bx--btn--field","field"===t[1]),R(e,"bx--btn--sm","small"===t[1]),R(e,"bx--btn--lg","lg"===t[1]),R(e,"bx--btn--xl","xl"===t[1])},m(n,o){v(n,e,o),i||(r=[I(e,"click",t[7]),I(e,"mouseover",t[8]),I(e,"mouseenter",t[9]),I(e,"mouseleave",t[10])],i=!0)},p(t,i){k(e,a=pt(o,[4&i&&t[2]])),R(e,"bx--skeleton",!0),R(e,"bx--btn",!0),R(e,"bx--btn--field","field"===t[1]),R(e,"bx--btn--sm","small"===t[1]),R(e,"bx--btn--lg","lg"===t[1]),R(e,"bx--btn--xl","xl"===t[1])},d(t){t&&x(e),i=!1,s(r)}}}function Qs(t){let e,i,r,o,a,l=[{href:t[0]},{rel:r="_blank"===t[2].target?"noopener noreferrer":void 0},{role:"button"},t[2]],c={};for(let t=0;t<l.length;t+=1)c=n(c,l[t]);return{c(){e=w("a"),i=S(""),k(e,c),R(e,"bx--skeleton",!0),R(e,"bx--btn",!0),R(e,"bx--btn--field","field"===t[1]),R(e,"bx--btn--sm","small"===t[1]),R(e,"bx--btn--lg","lg"===t[1]),R(e,"bx--btn--xl","xl"===t[1])},m(n,r){v(n,e,r),_(e,i),o||(a=[I(e,"click",t[3]),I(e,"mouseover",t[4]),I(e,"mouseenter",t[5]),I(e,"mouseleave",t[6])],o=!0)},p(t,i){k(e,c=pt(l,[1&i&&{href:t[0]},4&i&&r!==(r="_blank"===t[2].target?"noopener noreferrer":void 0)&&{rel:r},{role:"button"},4&i&&t[2]])),R(e,"bx--skeleton",!0),R(e,"bx--btn",!0),R(e,"bx--btn--field","field"===t[1]),R(e,"bx--btn--sm","small"===t[1]),R(e,"bx--btn--lg","lg"===t[1]),R(e,"bx--btn--xl","xl"===t[1])},d(t){t&&x(e),o=!1,s(a)}}}function ta(t){let e;function n(t,e){return t[0]?Qs:Js}let r=n(t),o=r(t);return{c(){o.c(),e=E()},m(t,i){o.m(t,i),v(t,e,i)},p(t,[i]){r===(r=n(t))&&o?o.p(t,i):(o.d(1),o=r(t),o&&(o.c(),o.m(e.parentNode,e)))},i:i,o:i,d(t){o.d(t),t&&x(e)}}}function ea(t,e,i){const r=["href","size"];let o=m(e,r),{href:s}=e,{size:a="default"}=e;return t.$$set=t=>{e=n(n({},e),f(t)),i(2,o=m(e,r)),"href"in t&&i(0,s=t.href),"size"in t&&i(1,a=t.size)},[s,a,o,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var ia=class extends vt{constructor(t){super(),_t(this,t,ea,ta,l,{href:0,size:1})}};const na=t=>({props:512&t[0]}),ra=t=>({props:t[9]});function oa(t){let e,i,r,o,a,l,u=t[8]&&ca(t);const f=t[19].default,m=c(f,t,t[18],null);var g=t[2];function y(t){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":t[3]}}}g&&(r=new g(y(t)));let b=[t[9]],T={};for(let t=0;t<b.length;t+=1)T=n(T,b[t]);return{c(){e=w("button"),u&&u.c(),i=C(),m&&m.c(),r&&mt(r.$$.fragment),k(e,T)},m(n,s){v(n,e,s),u&&u.m(e,null),_(e,i),m&&m.m(e,null),r&&gt(r,e,null),e.autofocus&&e.focus(),t[33](e),o=!0,a||(l=[I(e,"click",t[24]),I(e,"mouseover",t[25]),I(e,"mouseenter",t[26]),I(e,"mouseleave",t[27])],a=!0)},p(t,n){t[8]?u?u.p(t,n):(u=ca(t),u.c(),u.m(e,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&n[0])&&p(m,f,t,t[18],o?h(f,t[18],n,null):d(t[18]),null);const s={};if(8&n[0]&&(s["aria-label"]=t[3]),g!==(g=t[2])){if(r){ot();const t=r;lt(t.$$.fragment,1,0,(()=>{yt(t,1)})),st()}g?(r=new g(y(t)),mt(r.$$.fragment),at(r.$$.fragment,1),gt(r,e,null)):r=null}else g&&r.$set(s);k(e,T=pt(b,[512&n[0]&&t[9]]))},i(t){o||(at(m,t),r&&at(r.$$.fragment,t),o=!0)},o(t){lt(m,t),r&&lt(r.$$.fragment,t),o=!1},d(i){i&&x(e),u&&u.d(),m&&m.d(i),r&&yt(r),t[33](null),a=!1,s(l)}}}function sa(t){let e,i,r,o,a,l,u=t[8]&&ua(t);const f=t[19].default,m=c(f,t,t[18],null);var g=t[2];function y(t){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":t[3]}}}g&&(r=new g(y(t)));let b=[t[9]],T={};for(let t=0;t<b.length;t+=1)T=n(T,b[t]);return{c(){e=w("a"),u&&u.c(),i=C(),m&&m.c(),r&&mt(r.$$.fragment),k(e,T)},m(n,s){v(n,e,s),u&&u.m(e,null),_(e,i),m&&m.m(e,null),r&&gt(r,e,null),t[32](e),o=!0,a||(l=[I(e,"click",t[20]),I(e,"mouseover",t[21]),I(e,"mouseenter",t[22]),I(e,"mouseleave",t[23])],a=!0)},p(t,n){t[8]?u?u.p(t,n):(u=ua(t),u.c(),u.m(e,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&n[0])&&p(m,f,t,t[18],o?h(f,t[18],n,null):d(t[18]),null);const s={};if(8&n[0]&&(s["aria-label"]=t[3]),g!==(g=t[2])){if(r){ot();const t=r;lt(t.$$.fragment,1,0,(()=>{yt(t,1)})),st()}g?(r=new g(y(t)),mt(r.$$.fragment),at(r.$$.fragment,1),gt(r,e,null)):r=null}else g&&r.$set(s);k(e,T=pt(b,[512&n[0]&&t[9]]))},i(t){o||(at(m,t),r&&at(r.$$.fragment,t),o=!0)},o(t){lt(m,t),r&&lt(r.$$.fragment,t),o=!1},d(i){i&&x(e),u&&u.d(),m&&m.d(i),r&&yt(r),t[32](null),a=!1,s(l)}}}function aa(t){let e;const i=t[19].default,n=c(i,t,t[18],ra);return{c(){n&&n.c()},m(t,i){n&&n.m(t,i),e=!0},p(t,r){n&&n.p&&(!e||262656&r[0])&&p(n,i,t,t[18],e?h(i,t[18],r,na):d(t[18]),ra)},i(t){e||(at(n,t),e=!0)},o(t){lt(n,t),e=!1},d(t){n&&n.d(t)}}}function la(t){let e,i;const r=[{href:t[7]},{size:t[1]},t[10],{style:t[8]&&"width: 3rem;"}];let o={};for(let t=0;t<r.length;t+=1)o=n(o,r[t]);return e=new ia({props:o}),e.$on("click",t[28]),e.$on("mouseover",t[29]),e.$on("mouseenter",t[30]),e.$on("mouseleave",t[31]),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n=1410&i[0]?pt(r,[128&i[0]&&{href:t[7]},2&i[0]&&{size:t[1]},1024&i[0]&&dt(t[10]),256&i[0]&&{style:t[8]&&"width: 3rem;"}]):{};e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function ca(t){let e,i;return{c(){e=w("span"),i=S(t[3]),R(e,"bx--assistive-text",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,e){8&e[0]&&L(i,t[3])},d(t){t&&x(e)}}}function ua(t){let e,i;return{c(){e=w("span"),i=S(t[3]),R(e,"bx--assistive-text",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,e){8&e[0]&&L(i,t[3])},d(t){t&&x(e)}}}function ha(t){let e,i,n,r;const o=[la,aa,sa,oa],s=[];function a(t,e){return t[5]?0:t[4]?1:t[7]&&!t[6]?2:3}return e=a(t),i=s[e]=o[e](t),{c(){i.c(),n=E()},m(t,i){s[e].m(t,i),v(t,n,i),r=!0},p(t,r){let l=e;e=a(t),e===l?s[e].p(t,r):(ot(),lt(s[l],1,1,(()=>{s[l]=null})),st(),i=s[e],i?i.p(t,r):(i=s[e]=o[e](t),i.c()),at(i,1),i.m(n.parentNode,n))},i(t){r||(at(i),r=!0)},o(t){lt(i),r=!1},d(t){s[e].d(t),t&&x(n)}}}function pa(t,e,i){let r,o;const s=["kind","size","expressive","isSelected","icon","iconDescription","tooltipAlignment","tooltipPosition","as","skeleton","disabled","href","tabindex","type","ref"];let a=m(e,s),{$$slots:l={},$$scope:c}=e;const u=g(l);let{kind:h="primary"}=e,{size:p="default"}=e,{expressive:d=!1}=e,{isSelected:y=!1}=e,{icon:_}=e,{iconDescription:v}=e,{tooltipAlignment:x="center"}=e,{tooltipPosition:b="bottom"}=e,{as:w=!1}=e,{skeleton:T=!1}=e,{disabled:S=!1}=e,{href:C}=e,{tabindex:E="0"}=e,{type:I="button"}=e,{ref:M=null}=e;const A=$("ComposedModal");return t.$$set=t=>{e=n(n({},e),f(t)),i(10,a=m(e,s)),"kind"in t&&i(11,h=t.kind),"size"in t&&i(1,p=t.size),"expressive"in t&&i(12,d=t.expressive),"isSelected"in t&&i(13,y=t.isSelected),"icon"in t&&i(2,_=t.icon),"iconDescription"in t&&i(3,v=t.iconDescription),"tooltipAlignment"in t&&i(14,x=t.tooltipAlignment),"tooltipPosition"in t&&i(15,b=t.tooltipPosition),"as"in t&&i(4,w=t.as),"skeleton"in t&&i(5,T=t.skeleton),"disabled"in t&&i(6,S=t.disabled),"href"in t&&i(7,C=t.href),"tabindex"in t&&i(16,E=t.tabindex),"type"in t&&i(17,I=t.type),"ref"in t&&i(0,M=t.ref),"$$scope"in t&&i(18,c=t.$$scope)},t.$$.update=()=>{1&t.$$.dirty[0]&&A&&M&&A.declareRef(M),4&t.$$.dirty[0]&&i(8,r=_&&!u.default),i(9,o={type:C&&!S?void 0:I,tabindex:E,disabled:!0===S||void 0,href:C,"aria-pressed":r&&"ghost"===h&&!C?y:void 0,...a,class:["bx--btn",d&&"bx--btn--expressive",("small"===p&&!d||"sm"===p&&!d||"small"===p&&!d)&&"bx--btn--sm","field"===p&&!d||"md"===p&&!d&&"bx--btn--md","field"===p&&"bx--btn--field","small"===p&&"bx--btn--sm","lg"===p&&"bx--btn--lg","xl"===p&&"bx--btn--xl",h&&`bx--btn--${h}`,S&&"bx--btn--disabled",r&&"bx--btn--icon-only",r&&"bx--tooltip__trigger",r&&"bx--tooltip--a11y",r&&b&&`bx--btn--icon-only--${b}`,r&&x&&`bx--tooltip--align-${x}`,r&&y&&"ghost"===h&&"bx--btn--selected",a.class].filter(Boolean).join(" ")})},[M,p,_,v,w,T,S,C,r,o,a,h,d,y,x,b,E,I,c,l,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{M=t,i(0,M)}))},function(t){G[t?"unshift":"push"]((()=>{M=t,i(0,M)}))}]}var da=class extends vt{constructor(t){super(),_t(this,t,pa,ha,l,{kind:11,size:1,expressive:12,isSelected:13,icon:2,iconDescription:3,tooltipAlignment:14,tooltipPosition:15,as:4,skeleton:5,disabled:6,href:7,tabindex:16,type:17,ref:0},null,[-1,-1])}};function fa(t){let e,r,o,a,l=[t[0]],c={};for(let t=0;t<l.length;t+=1)c=n(c,l[t]);return{c(){e=w("div"),r=w("span"),R(r,"bx--checkbox-label-text",!0),R(r,"bx--skeleton",!0),k(e,c),R(e,"bx--form-item",!0),R(e,"bx--checkbox-wrapper",!0),R(e,"bx--checkbox-label",!0)},m(i,n){v(i,e,n),_(e,r),o||(a=[I(e,"click",t[1]),I(e,"mouseover",t[2]),I(e,"mouseenter",t[3]),I(e,"mouseleave",t[4])],o=!0)},p(t,[i]){k(e,c=pt(l,[1&i&&t[0]])),R(e,"bx--form-item",!0),R(e,"bx--checkbox-wrapper",!0),R(e,"bx--checkbox-label",!0)},i:i,o:i,d(t){t&&x(e),o=!1,s(a)}}}function ma(t,e,i){const r=[];let o=m(e,r);return t.$$set=t=>{e=n(n({},e),f(t)),i(0,o=m(e,r))},[o,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var ga=class extends vt{constructor(t){super(),_t(this,t,ma,fa,l,{})}};const ya=t=>({}),_a=t=>({});function va(t){let e,i,r,o,a,l,u,f;const m=t[17].labelText,g=c(m,t,t[16],_a),y=g||function(t){let e;return{c(){e=S(t[9])},m(t,i){v(t,e,i)},p(t,i){512&i&&L(e,t[9])},d(t){t&&x(e)}}}(t);let b=[t[15]],T={};for(let t=0;t<b.length;t+=1)T=n(T,b[t]);return{c(){e=w("div"),i=w("input"),r=C(),o=w("label"),a=w("span"),y&&y.c(),A(i,"type","checkbox"),i.value=t[3],i.checked=t[0],i.disabled=t[8],A(i,"id",t[13]),i.indeterminate=t[4],A(i,"name",t[11]),i.required=t[6],i.readOnly=t[7],R(i,"bx--checkbox",!0),R(a,"bx--checkbox-label-text",!0),R(a,"bx--visually-hidden",t[10]),A(o,"for",t[13]),A(o,"title",t[12]),R(o,"bx--checkbox-label",!0),k(e,T),R(e,"bx--form-item",!0),R(e,"bx--checkbox-wrapper",!0)},m(n,s){v(n,e,s),_(e,i),t[28](i),_(e,r),_(e,o),_(o,a),y&&y.m(a,null),l=!0,u||(f=[I(i,"change",t[29]),I(i,"change",t[22]),I(i,"blur",t[23]),I(e,"click",t[18]),I(e,"mouseover",t[19]),I(e,"mouseenter",t[20]),I(e,"mouseleave",t[21])],u=!0)},p(t,n){(!l||8&n)&&(i.value=t[3]),(!l||1&n)&&(i.checked=t[0]),(!l||256&n)&&(i.disabled=t[8]),(!l||8192&n)&&A(i,"id",t[13]),(!l||16&n)&&(i.indeterminate=t[4]),(!l||2048&n)&&A(i,"name",t[11]),(!l||64&n)&&(i.required=t[6]),(!l||128&n)&&(i.readOnly=t[7]),g?g.p&&(!l||65536&n)&&p(g,m,t,t[16],l?h(m,t[16],n,ya):d(t[16]),_a):y&&y.p&&(!l||512&n)&&y.p(t,l?n:-1),1024&n&&R(a,"bx--visually-hidden",t[10]),(!l||8192&n)&&A(o,"for",t[13]),(!l||4096&n)&&A(o,"title",t[12]),k(e,T=pt(b,[32768&n&&t[15]])),R(e,"bx--form-item",!0),R(e,"bx--checkbox-wrapper",!0)},i(t){l||(at(y,t),l=!0)},o(t){lt(y,t),l=!1},d(i){i&&x(e),t[28](null),y&&y.d(i),u=!1,s(f)}}}function xa(t){let e,i;const r=[t[15]];let o={};for(let t=0;t<r.length;t+=1)o=n(o,r[t]);return e=new ga({props:o}),e.$on("click",t[24]),e.$on("mouseover",t[25]),e.$on("mouseenter",t[26]),e.$on("mouseleave",t[27]),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n=32768&i?pt(r,[dt(t[15])]):{};e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function ba(t){let e,i,n,r;const o=[xa,va],s=[];function a(t,e){return t[5]?0:1}return e=a(t),i=s[e]=o[e](t),{c(){i.c(),n=E()},m(t,i){s[e].m(t,i),v(t,n,i),r=!0},p(t,[r]){let l=e;e=a(t),e===l?s[e].p(t,r):(ot(),lt(s[l],1,1,(()=>{s[l]=null})),st(),i=s[e],i?i.p(t,r):(i=s[e]=o[e](t),i.c()),at(i,1),i.m(n.parentNode,n))},i(t){r||(at(i),r=!0)},o(t){lt(i),r=!1},d(t){s[e].d(t),t&&x(n)}}}function wa(t,e,i){let r;const o=["value","checked","group","indeterminate","skeleton","required","readonly","disabled","labelText","hideLabel","name","title","id","ref"];let s=m(e,o),{$$slots:a={},$$scope:l}=e,{value:c=""}=e,{checked:u=!1}=e,{group:h}=e,{indeterminate:p=!1}=e,{skeleton:d=!1}=e,{required:g=!1}=e,{readonly:y=!1}=e,{disabled:_=!1}=e,{labelText:v=""}=e,{hideLabel:x=!1}=e,{name:b=""}=e,{title:w}=e,{id:T="ccs-"+Math.random().toString(36)}=e,{ref:S=null}=e;const C=j();return t.$$set=t=>{e=n(n({},e),f(t)),i(15,s=m(e,o)),"value"in t&&i(3,c=t.value),"checked"in t&&i(0,u=t.checked),"group"in t&&i(1,h=t.group),"indeterminate"in t&&i(4,p=t.indeterminate),"skeleton"in t&&i(5,d=t.skeleton),"required"in t&&i(6,g=t.required),"readonly"in t&&i(7,y=t.readonly),"disabled"in t&&i(8,_=t.disabled),"labelText"in t&&i(9,v=t.labelText),"hideLabel"in t&&i(10,x=t.hideLabel),"name"in t&&i(11,b=t.name),"title"in t&&i(12,w=t.title),"id"in t&&i(13,T=t.id),"ref"in t&&i(2,S=t.ref),"$$scope"in t&&i(16,l=t.$$scope)},t.$$.update=()=>{2&t.$$.dirty&&i(14,r=Array.isArray(h)),16395&t.$$.dirty&&i(0,u=r?h.includes(c):u),1&t.$$.dirty&&C("check",u)},[u,h,S,c,p,d,g,y,_,v,x,b,w,T,r,s,l,a,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{S=t,i(2,S)}))},()=>{r?i(1,h=h.includes(c)?h.filter((t=>t!==c)):[...h,c]):i(0,u=!u)}]}var Ta=class extends vt{constructor(t){super(),_t(this,t,wa,ba,l,{value:3,checked:0,group:1,indeterminate:4,skeleton:5,required:6,readonly:7,disabled:8,labelText:9,hideLabel:10,name:11,title:12,id:13,ref:2})}};function Sa(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Ca(t){let e,r,o,s=t[1]&&Sa(t),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],l={};for(let t=0;t<a.length;t+=1)l=n(l,a[t]);return{c(){e=T("svg"),s&&s.c(),r=T("path"),o=T("path"),A(r,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25\tc-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),A(o,"fill","none"),A(o,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22\tC16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),A(o,"data-icon-path","inner-path"),A(o,"opacity","0"),P(e,l)},m(t,i){v(t,e,i),s&&s.m(e,null),_(e,r),_(e,o)},p(t,[i]){t[1]?s?s.p(t,i):(s=Sa(t),s.c(),s.m(e,r)):s&&(s.d(1),s=null),P(e,l=pt(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),s&&s.d()}}}function Ea(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Ia=class extends vt{constructor(t){super(),_t(this,t,Ea,Ca,l,{size:0,title:1})}};function Ma(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Aa(t){let e,r,o,s,a=t[1]&&Ma(t),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],c={};for(let t=0;t<l.length;t+=1)c=n(c,l[t]);return{c(){e=T("svg"),a&&a.c(),r=T("path"),o=T("path"),s=T("path"),A(r,"fill","none"),A(r,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),A(r,"data-icon-path","inner-path"),A(o,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),A(s,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),P(e,c)},m(t,i){v(t,e,i),a&&a.m(e,null),_(e,r),_(e,o),_(e,s)},p(t,[i]){t[1]?a?a.p(t,i):(a=Ma(t),a.c(),a.m(e,r)):a&&(a.d(1),a=null),P(e,c=pt(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),a&&a.d()}}}function ka(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Pa=class extends vt{constructor(t){super(),_t(this,t,ka,Aa,l,{size:0,title:1})}};function La(t){let e,i;return{c(){e=w("div"),i=S(t[6]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,e){64&e&&L(i,t[6])},d(t){t&&x(e)}}}function za(t){let e,i;return{c(){e=w("div"),i=S(t[8]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,e){256&e&&L(i,t[8])},d(t){t&&x(e)}}}function Da(t){let e,i,r,o,a,l,u,f;const m=t[11].default,g=c(m,t,t[10],null);let y=[{role:"listbox"},{tabindex:"-1"},{"data-invalid":i=t[5]||void 0},t[9]],_={};for(let t=0;t<y.length;t+=1)_=n(_,y[t]);let b=t[5]&&La(t),T=!t[5]&&t[7]&&za(t);return{c(){e=w("div"),g&&g.c(),r=C(),b&&b.c(),o=C(),T&&T.c(),a=E(),k(e,_),R(e,"bx--list-box",!0),R(e,"bx--list-box--sm","sm"===t[0]),R(e,"bx--list-box--xl","xl"===t[0]),R(e,"bx--list-box--inline","inline"===t[1]),R(e,"bx--list-box--disabled",t[4]),R(e,"bx--list-box--expanded",t[2]),R(e,"bx--list-box--light",t[3]),R(e,"bx--list-box--warning",!t[5]&&t[7])},m(i,n){v(i,e,n),g&&g.m(e,null),v(i,r,n),b&&b.m(i,n),v(i,o,n),T&&T.m(i,n),v(i,a,n),l=!0,u||(f=[I(e,"keydown",t[12]),I(e,"keydown",Ra),I(e,"click",M(t[13]))],u=!0)},p(t,[n]){g&&g.p&&(!l||1024&n)&&p(g,m,t,t[10],l?h(m,t[10],n,null):d(t[10]),null),k(e,_=pt(y,[{role:"listbox"},{tabindex:"-1"},(!l||32&n&&i!==(i=t[5]||void 0))&&{"data-invalid":i},512&n&&t[9]])),R(e,"bx--list-box",!0),R(e,"bx--list-box--sm","sm"===t[0]),R(e,"bx--list-box--xl","xl"===t[0]),R(e,"bx--list-box--inline","inline"===t[1]),R(e,"bx--list-box--disabled",t[4]),R(e,"bx--list-box--expanded",t[2]),R(e,"bx--list-box--light",t[3]),R(e,"bx--list-box--warning",!t[5]&&t[7]),t[5]?b?b.p(t,n):(b=La(t),b.c(),b.m(o.parentNode,o)):b&&(b.d(1),b=null),!t[5]&&t[7]?T?T.p(t,n):(T=za(t),T.c(),T.m(a.parentNode,a)):T&&(T.d(1),T=null)},i(t){l||(at(g,t),l=!0)},o(t){lt(g,t),l=!1},d(t){t&&x(e),g&&g.d(t),t&&x(r),b&&b.d(t),t&&x(o),T&&T.d(t),t&&x(a),u=!1,s(f)}}}const Ra=t=>{"Escape"===t.key&&t.stopPropagation()};function Oa(t,e,i){const r=["size","type","open","light","disabled","invalid","invalidText","warn","warnText"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{size:l}=e,{type:c="default"}=e,{open:u=!1}=e,{light:h=!1}=e,{disabled:p=!1}=e,{invalid:d=!1}=e,{invalidText:g=""}=e,{warn:y=!1}=e,{warnText:_=""}=e;return t.$$set=t=>{e=n(n({},e),f(t)),i(9,o=m(e,r)),"size"in t&&i(0,l=t.size),"type"in t&&i(1,c=t.type),"open"in t&&i(2,u=t.open),"light"in t&&i(3,h=t.light),"disabled"in t&&i(4,p=t.disabled),"invalid"in t&&i(5,d=t.invalid),"invalidText"in t&&i(6,g=t.invalidText),"warn"in t&&i(7,y=t.warn),"warnText"in t&&i(8,_=t.warnText),"$$scope"in t&&i(10,a=t.$$scope)},[l,c,u,h,p,d,g,y,_,o,a,s,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var Fa=class extends vt{constructor(t){super(),_t(this,t,Oa,Da,l,{size:0,type:1,open:2,light:3,disabled:4,invalid:5,invalidText:6,warn:7,warnText:8})}};function Na(t){let e,i,r,o,s;const a=t[4].default,l=c(a,t,t[3],null);let u=[{role:"listbox"},{id:i="menu-"+t[1]},t[2]],f={};for(let t=0;t<u.length;t+=1)f=n(f,u[t]);return{c(){e=w("div"),l&&l.c(),k(e,f),R(e,"bx--list-box__menu",!0)},m(i,n){v(i,e,n),l&&l.m(e,null),t[6](e),r=!0,o||(s=I(e,"scroll",t[5]),o=!0)},p(t,[n]){l&&l.p&&(!r||8&n)&&p(l,a,t,t[3],r?h(a,t[3],n,null):d(t[3]),null),k(e,f=pt(u,[{role:"listbox"},(!r||2&n&&i!==(i="menu-"+t[1]))&&{id:i},4&n&&t[2]])),R(e,"bx--list-box__menu",!0)},i(t){r||(at(l,t),r=!0)},o(t){lt(l,t),r=!1},d(i){i&&x(e),l&&l.d(i),t[6](null),o=!1,s()}}}function Ba(t,e,i){const r=["id","ref"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{id:l="ccs-"+Math.random().toString(36)}=e,{ref:c=null}=e;return t.$$set=t=>{e=n(n({},e),f(t)),i(2,o=m(e,r)),"id"in t&&i(1,l=t.id),"ref"in t&&i(0,c=t.ref),"$$scope"in t&&i(3,a=t.$$scope)},[c,l,o,a,s,function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{c=t,i(0,c)}))}]}var ja=class extends vt{constructor(t){super(),_t(this,t,Ba,Na,l,{id:1,ref:0})}};function $a(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Ua(t){let e,r,o=t[1]&&$a(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M16 22L6 12 7.4 10.6 16 19.2 24.6 10.6 26 12z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=$a(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Va(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Ga=class extends vt{constructor(t){super(),_t(this,t,Va,Ua,l,{size:0,title:1})}};function qa(t){let e,i,r,o,s;i=new Ga({props:{"aria-label":t[1],title:t[1]}});let a=[t[2]],l={};for(let t=0;t<a.length;t+=1)l=n(l,a[t]);return{c(){e=w("div"),mt(i.$$.fragment),k(e,l),R(e,"bx--list-box__menu-icon",!0),R(e,"bx--list-box__menu-icon--open",t[0])},m(n,a){v(n,e,a),gt(i,e,null),r=!0,o||(s=I(e,"click",M(t[6])),o=!0)},p(t,[n]){const r={};2&n&&(r["aria-label"]=t[1]),2&n&&(r.title=t[1]),i.$set(r),k(e,l=pt(a,[4&n&&t[2]])),R(e,"bx--list-box__menu-icon",!0),R(e,"bx--list-box__menu-icon--open",t[0])},i(t){r||(at(i.$$.fragment,t),r=!0)},o(t){lt(i.$$.fragment,t),r=!1},d(t){t&&x(e),yt(i),o=!1,s()}}}function Za(t,e,i){let r,o;const s=["open","translationIds","translateWithId"];let a=m(e,s),{open:l=!1}=e;const c={close:"close",open:"open"};let{translateWithId:u=(t=>h[t])}=e;const h={[c.close]:"Close menu",[c.open]:"Open menu"};return t.$$set=t=>{e=n(n({},e),f(t)),i(2,a=m(e,s)),"open"in t&&i(0,l=t.open),"translateWithId"in t&&i(4,u=t.translateWithId)},t.$$.update=()=>{1&t.$$.dirty&&i(5,r=l?c.close:c.open),48&t.$$.dirty&&i(1,o=u?.(r)??h[r])},[l,o,a,c,u,r,function(e){U.call(this,t,e)}]}var Wa=class extends vt{constructor(t){super(),_t(this,t,Za,qa,l,{open:0,translationIds:3,translateWithId:4})}get translationIds(){return this.$$.ctx[3]}};function Ha(t){let e,i,r,o,a;const l=t[4].default,u=c(l,t,t[3],null);let f=[t[2]],m={};for(let t=0;t<f.length;t+=1)m=n(m,f[t]);return{c(){e=w("div"),i=w("div"),u&&u.c(),R(i,"bx--list-box__menu-item__option",!0),k(e,m),R(e,"bx--list-box__menu-item",!0),R(e,"bx--list-box__menu-item--active",t[0]),R(e,"bx--list-box__menu-item--highlighted",t[1])},m(n,s){v(n,e,s),_(e,i),u&&u.m(i,null),r=!0,o||(a=[I(e,"click",t[5]),I(e,"mouseenter",t[6]),I(e,"mouseleave",t[7])],o=!0)},p(t,[i]){u&&u.p&&(!r||8&i)&&p(u,l,t,t[3],r?h(l,t[3],i,null):d(t[3]),null),k(e,m=pt(f,[4&i&&t[2]])),R(e,"bx--list-box__menu-item",!0),R(e,"bx--list-box__menu-item--active",t[0]),R(e,"bx--list-box__menu-item--highlighted",t[1])},i(t){r||(at(u,t),r=!0)},o(t){lt(u,t),r=!1},d(t){t&&x(e),u&&u.d(t),o=!1,s(a)}}}function Xa(t,e,i){const r=["active","highlighted"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{active:l=!1}=e,{highlighted:c=!1}=e;return t.$$set=t=>{e=n(n({},e),f(t)),i(2,o=m(e,r)),"active"in t&&i(0,l=t.active),"highlighted"in t&&i(1,c=t.highlighted),"$$scope"in t&&i(3,a=t.$$scope)},[l,c,o,a,s,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)}]}var Ya=class extends vt{constructor(t){super(),_t(this,t,Xa,Ha,l,{active:0,highlighted:1})}};function Ka(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Ja(t){let e,r,o=t[1]&&Ka(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=Ka(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Qa(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var tl=class extends vt{constructor(t){super(),_t(this,t,Qa,Ja,l,{size:0,title:1})}};function el(t,e,i){const n=t.slice();return n[37]=e[i],n[39]=i,n}const il=t=>({item:16&t[0],index:16&t[0]}),nl=t=>({item:t[37],index:t[39]});function rl(t){let e,i;return{c(){e=w("label"),i=S(t[11]),A(e,"for",t[20]),R(e,"bx--label",!0),R(e,"bx--label--disabled",t[10]),R(e,"bx--visually-hidden",t[18])},m(t,n){v(t,e,n),_(e,i)},p(t,n){2048&n[0]&&L(i,t[11]),1048576&n[0]&&A(e,"for",t[20]),1024&n[0]&&R(e,"bx--label--disabled",t[10]),262144&n[0]&&R(e,"bx--visually-hidden",t[18])},d(t){t&&x(e)}}}function ol(t){let e,i;return e=new Ia({props:{class:"bx--list-box__invalid-icon"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function sl(t){let e,i;return e=new Pa({props:{class:"bx--list-box__invalid-icon bx--list-box__invalid-icon--warning"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function al(t){let e;return{c(){e=S(t[17])},m(t,i){v(t,e,i)},p(t,i){131072&i[0]&&L(e,t[17])},d(t){t&&x(e)}}}function ll(t){let e,i=t[5](t[22])+"";return{c(){e=S(i)},m(t,i){v(t,e,i)},p(t,n){4194336&n[0]&&i!==(i=t[5](t[22])+"")&&L(e,i)},d(t){t&&x(e)}}}function cl(t){let e,i;return e=new ja({props:{"aria-labelledby":t[20],id:t[20],$$slots:{default:[pl]},$$scope:{ctx:t}}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};1048576&i[0]&&(n["aria-labelledby"]=t[20]),1048576&i[0]&&(n.id=t[20]),8388665&i[0]|16&i[1]&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function ul(t){let e,i;const n=t[27].default,r=c(n,t,t[35],nl),o=r||function(t){let e,i=t[5](t[37])+"";return{c(){e=S(i)},m(t,i){v(t,e,i)},p(t,n){48&n[0]&&i!==(i=t[5](t[37])+"")&&L(e,i)},d(t){t&&x(e)}}}(t);return{c(){o&&o.c(),e=C()},m(t,n){o&&o.m(t,n),v(t,e,n),i=!0},p(t,e){r?r.p&&(!i||16&e[0]|16&e[1])&&p(r,n,t,t[35],i?h(n,t[35],e,il):d(t[35]),nl):o&&o.p&&(!i||48&e[0])&&o.p(t,i?e:[-1,-1])},i(t){i||(at(o,t),i=!0)},o(t){lt(o,t),i=!1},d(t){o&&o.d(t),t&&x(e)}}}function hl(t,e){let i,n,r;return n=new Ya({props:{id:e[37].id,active:e[0]===e[37].id,highlighted:e[23]===e[39]||e[0]===e[37].id,$$slots:{default:[ul]},$$scope:{ctx:e}}}),n.$on("click",(function(){return e[32](e[37])})),n.$on("mouseenter",(function(){return e[33](e[39])})),{key:t,first:null,c(){i=E(),mt(n.$$.fragment),this.first=i},m(t,e){v(t,i,e),gt(n,t,e),r=!0},p(t,i){e=t;const r={};16&i[0]&&(r.id=e[37].id),17&i[0]&&(r.active=e[0]===e[37].id),8388625&i[0]&&(r.highlighted=e[23]===e[39]||e[0]===e[37].id),48&i[0]|16&i[1]&&(r.$$scope={dirty:i,ctx:e}),n.$set(r)},i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(i),yt(n,t)}}}function pl(t){let e,i,n=[],r=new Map,o=t[4];const s=t=>t[37].id;for(let e=0;e<o.length;e+=1){let i=el(t,o,e),a=s(i);r.set(a,n[e]=hl(a,i))}return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=E()},m(t,r){for(let e=0;e<n.length;e+=1)n[e].m(t,r);v(t,e,r),i=!0},p(t,i){8388665&i[0]|16&i[1]&&(o=t[4],ot(),n=ht(n,i,s,1,t,o,r,e.parentNode,ut,hl,e,el),st())},i(t){if(!i){for(let t=0;t<o.length;t+=1)at(n[t]);i=!0}},o(t){for(let t=0;t<n.length;t+=1)lt(n[t]);i=!1},d(t){for(let e=0;e<n.length;e+=1)n[e].d(t);t&&x(e)}}}function dl(t){let e,i,n,r,o,s,a,l,c,u,h,p=t[12]&&ol(),d=!t[12]&&t[14]&&sl();function f(t,e){return t[22]?ll:al}let m=f(t),g=m(t);s=new Wa({props:{translateWithId:t[19],open:t[1]}}),s.$on("click",t[29]);let y=t[1]&&cl(t);return{c(){p&&p.c(),e=C(),d&&d.c(),i=C(),n=w("button"),r=w("span"),g.c(),o=C(),mt(s.$$.fragment),a=C(),y&&y.c(),l=E(),A(r,"class","bx--list-box__label"),A(n,"type","button"),A(n,"tabindex","0"),A(n,"aria-expanded",t[1]),n.disabled=t[10],A(n,"translatewithid",t[19]),A(n,"id",t[20]),R(n,"bx--list-box__field",!0)},m(f,m){p&&p.m(f,m),v(f,e,m),d&&d.m(f,m),v(f,i,m),v(f,n,m),_(n,r),g.m(r,null),_(n,o),gt(s,n,null),t[30](n),v(f,a,m),y&&y.m(f,m),v(f,l,m),c=!0,u||(h=I(n,"keydown",t[31]),u=!0)},p(t,o){t[12]?p?4096&o[0]&&at(p,1):(p=ol(),p.c(),at(p,1),p.m(e.parentNode,e)):p&&(ot(),lt(p,1,1,(()=>{p=null})),st()),!t[12]&&t[14]?d?20480&o[0]&&at(d,1):(d=sl(),d.c(),at(d,1),d.m(i.parentNode,i)):d&&(ot(),lt(d,1,1,(()=>{d=null})),st()),m===(m=f(t))&&g?g.p(t,o):(g.d(1),g=m(t),g&&(g.c(),g.m(r,null)));const a={};524288&o[0]&&(a.translateWithId=t[19]),2&o[0]&&(a.open=t[1]),s.$set(a),(!c||2&o[0])&&A(n,"aria-expanded",t[1]),(!c||1024&o[0])&&(n.disabled=t[10]),(!c||524288&o[0])&&A(n,"translatewithid",t[19]),(!c||1048576&o[0])&&A(n,"id",t[20]),t[1]?y?(y.p(t,o),2&o[0]&&at(y,1)):(y=cl(t),y.c(),at(y,1),y.m(l.parentNode,l)):y&&(ot(),lt(y,1,1,(()=>{y=null})),st())},i(t){c||(at(p),at(d),at(s.$$.fragment,t),at(y),c=!0)},o(t){lt(p),lt(d),lt(s.$$.fragment,t),lt(y),c=!1},d(r){p&&p.d(r),r&&x(e),d&&d.d(r),r&&x(i),r&&x(n),g.d(),yt(s),t[30](null),r&&x(a),y&&y.d(r),r&&x(l),u=!1,h()}}}function fl(t){let e,i;return{c(){e=w("div"),i=S(t[16]),R(e,"bx--form__helper-text",!0),R(e,"bx--form__helper-text--disabled",t[10])},m(t,n){v(t,e,n),_(e,i)},p(t,n){65536&n[0]&&L(i,t[16]),1024&n[0]&&R(e,"bx--form__helper-text--disabled",t[10])},d(t){t&&x(e)}}}function ml(t){let e,i,r,o,s,a,l,c=t[11]&&rl(t);r=new Fa({props:{type:t[6],size:t[8],id:t[20],name:t[21],"aria-label":t[26]["aria-label"],class:"bx--dropdown "+("top"===t[7]&&"bx--list-box--up")+" "+(t[12]&&"bx--dropdown--invalid")+" "+(!t[12]&&t[14]&&"bx--dropdown--warning")+" "+(t[1]&&"bx--dropdown--open")+"\n      "+("sm"===t[8]&&"bx--dropdown--sm")+"\n      "+("xl"===t[8]&&"bx--dropdown--xl")+"\n      "+(t[2]&&"bx--dropdown--inline")+"\n      "+(t[10]&&"bx--dropdown--disabled")+"\n      "+(t[9]&&"bx--dropdown--light"),disabled:t[10],open:t[1],invalid:t[12],invalidText:t[13],light:t[9],warn:t[14],warnText:t[15],$$slots:{default:[dl]},$$scope:{ctx:t}}}),r.$on("click",t[34]);let u=!t[2]&&!t[12]&&!t[14]&&t[16]&&fl(t),h=[t[25]],p={};for(let t=0;t<h.length;t+=1)p=n(p,h[t]);return{c(){e=w("div"),c&&c.c(),i=C(),mt(r.$$.fragment),o=C(),u&&u.c(),k(e,p),R(e,"bx--dropdown__wrapper",!0),R(e,"bx--list-box__wrapper",!0),R(e,"bx--dropdown__wrapper--inline",t[2]),R(e,"bx--list-box__wrapper--inline",t[2]),R(e,"bx--dropdown__wrapper--inline--invalid",t[2]&&t[12])},m(n,h){v(n,e,h),c&&c.m(e,null),_(e,i),gt(r,e,null),_(e,o),u&&u.m(e,null),s=!0,a||(l=I(window,"click",t[28]),a=!0)},p(t,n){t[11]?c?c.p(t,n):(c=rl(t),c.c(),c.m(e,i)):c&&(c.d(1),c=null);const o={};64&n[0]&&(o.type=t[6]),256&n[0]&&(o.size=t[8]),1048576&n[0]&&(o.id=t[20]),2097152&n[0]&&(o.name=t[21]),67108864&n[0]&&(o["aria-label"]=t[26]["aria-label"]),22406&n[0]&&(o.class="bx--dropdown "+("top"===t[7]&&"bx--list-box--up")+" "+(t[12]&&"bx--dropdown--invalid")+" "+(!t[12]&&t[14]&&"bx--dropdown--warning")+" "+(t[1]&&"bx--dropdown--open")+"\n      "+("sm"===t[8]&&"bx--dropdown--sm")+"\n      "+("xl"===t[8]&&"bx--dropdown--xl")+"\n      "+(t[2]&&"bx--dropdown--inline")+"\n      "+(t[10]&&"bx--dropdown--disabled")+"\n      "+(t[9]&&"bx--dropdown--light")),1024&n[0]&&(o.disabled=t[10]),2&n[0]&&(o.open=t[1]),4096&n[0]&&(o.invalid=t[12]),8192&n[0]&&(o.invalidText=t[13]),512&n[0]&&(o.light=t[9]),16384&n[0]&&(o.warn=t[14]),32768&n[0]&&(o.warnText=t[15]),14308411&n[0]|16&n[1]&&(o.$$scope={dirty:n,ctx:t}),r.$set(o),t[2]||t[12]||t[14]||!t[16]?u&&(u.d(1),u=null):u?u.p(t,n):(u=fl(t),u.c(),u.m(e,null)),k(e,p=pt(h,[33554432&n[0]&&t[25]])),R(e,"bx--dropdown__wrapper",!0),R(e,"bx--list-box__wrapper",!0),R(e,"bx--dropdown__wrapper--inline",t[2]),R(e,"bx--list-box__wrapper--inline",t[2]),R(e,"bx--dropdown__wrapper--inline--invalid",t[2]&&t[12])},i(t){s||(at(r.$$.fragment,t),s=!0)},o(t){lt(r.$$.fragment,t),s=!1},d(t){t&&x(e),c&&c.d(),yt(r),u&&u.d(),a=!1,l()}}}function gl(t,e,i){let r;const o=["items","itemToString","selectedId","type","direction","size","open","inline","light","disabled","titleText","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","id","name","ref"];let s=m(e,o),{$$slots:a={},$$scope:l}=e,{items:c=[]}=e,{itemToString:u=(t=>t.text||t.id)}=e,{selectedId:h}=e,{type:p="default"}=e,{direction:d="bottom"}=e,{size:g}=e,{open:y=!1}=e,{inline:_=!1}=e,{light:v=!1}=e,{disabled:x=!1}=e,{titleText:b=""}=e,{invalid:w=!1}=e,{invalidText:T=""}=e,{warn:S=!1}=e,{warnText:C=""}=e,{helperText:E=""}=e,{label:I}=e,{hideLabel:M=!1}=e,{translateWithId:A}=e,{id:k="ccs-"+Math.random().toString(36)}=e,{name:P}=e,{ref:L=null}=e;const z=j();let D=-1;function R(t){let e=D+t;e<0?e=c.length-1:e>=c.length&&(e=0),i(23,D=e)}return t.$$set=t=>{i(26,e=n(n({},e),f(t))),i(25,s=m(e,o)),"items"in t&&i(4,c=t.items),"itemToString"in t&&i(5,u=t.itemToString),"selectedId"in t&&i(0,h=t.selectedId),"type"in t&&i(6,p=t.type),"direction"in t&&i(7,d=t.direction),"size"in t&&i(8,g=t.size),"open"in t&&i(1,y=t.open),"inline"in t&&i(2,_=t.inline),"light"in t&&i(9,v=t.light),"disabled"in t&&i(10,x=t.disabled),"titleText"in t&&i(11,b=t.titleText),"invalid"in t&&i(12,w=t.invalid),"invalidText"in t&&i(13,T=t.invalidText),"warn"in t&&i(14,S=t.warn),"warnText"in t&&i(15,C=t.warnText),"helperText"in t&&i(16,E=t.helperText),"label"in t&&i(17,I=t.label),"hideLabel"in t&&i(18,M=t.hideLabel),"translateWithId"in t&&i(19,A=t.translateWithId),"id"in t&&i(20,k=t.id),"name"in t&&i(21,P=t.name),"ref"in t&&i(3,L=t.ref),"$$scope"in t&&i(35,l=t.$$scope)},t.$$.update=()=>{17&t.$$.dirty[0]&&i(22,r=c.find((t=>t.id===h))),4194305&t.$$.dirty[0]&&void 0!==h&&z("select",{selectedId:h,selectedItem:r}),64&t.$$.dirty[0]&&i(2,_="inline"===p),2&t.$$.dirty[0]&&(y||i(23,D=-1))},e=f(e),[h,y,_,L,c,u,p,d,g,v,x,b,w,T,S,C,E,I,M,A,k,P,r,D,R,s,e,a,({target:t})=>{y&&L&&!L.contains(t)&&i(1,y=!1)},t=>{t.stopPropagation(),x||i(1,y=!y)},function(t){G[t?"unshift":"push"]((()=>{L=t,i(3,L)}))},t=>{const{key:e}=t;["Enter","ArrowDown","ArrowUp"].includes(e)&&t.preventDefault(),"Enter"===e?(i(1,y=!y),D>-1&&c[D].id!==h&&(i(0,h=c[D].id),i(1,y=!1))):"Tab"===e?(i(1,y=!1),L.blur()):"ArrowDown"===e?R(1):"ArrowUp"===e&&R(-1)},t=>{i(0,h=t.id),L.focus()},t=>{i(23,D=t)},({target:t})=>{x||i(1,y=!!L.contains(t)&&!y)},l]}var yl=class extends vt{constructor(t){super(),_t(this,t,gl,ml,l,{items:4,itemToString:5,selectedId:0,type:6,direction:7,size:8,open:1,inline:2,light:9,disabled:10,titleText:11,invalid:12,invalidText:13,warn:14,warnText:15,helperText:16,label:17,hideLabel:18,translateWithId:19,id:20,name:21,ref:3},null,[-1,-1])}};function _l(t,e,i){const n=t.slice();return n[54]=e[i],n}const vl=t=>({}),xl=t=>({}),bl=t=>({}),wl=t=>({});function Tl(t){let e,i,n,r,o;return i=new tl({props:{size:20,"aria-label":t[7],class:"bx--modal-close__icon"}}),{c(){e=w("button"),mt(i.$$.fragment),A(e,"type","button"),A(e,"aria-label",t[7]),A(e,"title",t[7]),R(e,"bx--modal-close",!0)},m(s,a){v(s,e,a),gt(i,e,null),t[37](e),n=!0,r||(o=I(e,"click",t[38]),r=!0)},p(t,r){const o={};128&r[0]&&(o["aria-label"]=t[7]),i.$set(o),(!n||128&r[0])&&A(e,"aria-label",t[7]),(!n||128&r[0])&&A(e,"title",t[7])},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(n){n&&x(e),yt(i),t[37](null),r=!1,o()}}}function Sl(t){let e,i;const n=t[31].label,r=c(n,t,t[50],wl),o=r||function(t){let e;return{c(){e=S(t[6])},m(t,i){v(t,e,i)},p(t,i){64&i[0]&&L(e,t[6])},d(t){t&&x(e)}}}(t);return{c(){e=w("h2"),o&&o.c(),A(e,"id",t[25]),R(e,"bx--modal-header__label",!0)},m(t,n){v(t,e,n),o&&o.m(e,null),i=!0},p(t,s){r?r.p&&(!i||524288&s[1])&&p(r,n,t,t[50],i?h(n,t[50],s,bl):d(t[50]),wl):o&&o.p&&(!i||64&s[0])&&o.p(t,i?s:[-1,-1]),(!i||33554432&s[0])&&A(e,"id",t[25])},i(t){i||(at(o,t),i=!0)},o(t){lt(o,t),i=!1},d(t){t&&x(e),o&&o.d(t)}}}function Cl(t){let e,i,n,r,o;return i=new tl({props:{size:20,"aria-label":t[7],class:"bx--modal-close__icon"}}),{c(){e=w("button"),mt(i.$$.fragment),A(e,"type","button"),A(e,"aria-label",t[7]),A(e,"title",t[7]),R(e,"bx--modal-close",!0)},m(s,a){v(s,e,a),gt(i,e,null),t[39](e),n=!0,r||(o=I(e,"click",t[40]),r=!0)},p(t,r){const o={};128&r[0]&&(o["aria-label"]=t[7]),i.$set(o),(!n||128&r[0])&&A(e,"aria-label",t[7]),(!n||128&r[0])&&A(e,"title",t[7])},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(n){n&&x(e),yt(i),t[39](null),r=!1,o()}}}function El(t){let e;return{c(){e=w("div"),R(e,"bx--modal-content--overflow-indicator",!0)},m(t,i){v(t,e,i)},d(t){t&&x(e)}}}function Il(t){let e,i,n,r,o,s;const a=[Al,Ml],l=[];function c(t,e){return t[15].length>0?0:t[14]?1:-1}return~(i=c(t))&&(n=l[i]=a[i](t)),o=new da({props:{kind:t[3]?"danger":"primary",disabled:t[11],icon:t[12],$$slots:{default:[zl]},$$scope:{ctx:t}}}),o.$on("click",t[43]),{c(){e=w("div"),n&&n.c(),r=C(),mt(o.$$.fragment),R(e,"bx--modal-footer",!0),R(e,"bx--modal-footer--three-button",2===t[15].length)},m(t,n){v(t,e,n),~i&&l[i].m(e,null),_(e,r),gt(o,e,null),s=!0},p(t,s){let u=i;i=c(t),i===u?~i&&l[i].p(t,s):(n&&(ot(),lt(l[u],1,1,(()=>{l[u]=null})),st()),~i?(n=l[i],n?n.p(t,s):(n=l[i]=a[i](t),n.c()),at(n,1),n.m(e,r)):n=null);const h={};8&s[0]&&(h.kind=t[3]?"danger":"primary"),2048&s[0]&&(h.disabled=t[11]),4096&s[0]&&(h.icon=t[12]),1024&s[0]|524288&s[1]&&(h.$$scope={dirty:s,ctx:t}),o.$set(h),32768&s[0]&&R(e,"bx--modal-footer--three-button",2===t[15].length)},i(t){s||(at(n),at(o.$$.fragment,t),s=!0)},o(t){lt(n),lt(o.$$.fragment,t),s=!1},d(t){t&&x(e),~i&&l[i].d(),yt(o)}}}function Ml(t){let e,i;return e=new da({props:{kind:"secondary",$$slots:{default:[kl]},$$scope:{ctx:t}}}),e.$on("click",t[42]),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};16384&i[0]|524288&i[1]&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Al(t){let e,i,n=t[15],r=[];for(let e=0;e<n.length;e+=1)r[e]=Ll(_l(t,n,e));const o=t=>lt(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=E()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);v(t,e,n),i=!0},p(t,i){if(67141632&i[0]){let s;for(n=t[15],s=0;s<n.length;s+=1){const o=_l(t,n,s);r[s]?(r[s].p(o,i),at(r[s],1)):(r[s]=Ll(o),r[s].c(),at(r[s],1),r[s].m(e.parentNode,e))}for(ot(),s=n.length;s<r.length;s+=1)o(s);st()}},i(t){if(!i){for(let t=0;t<n.length;t+=1)at(r[t]);i=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)lt(r[t]);i=!1},d(t){b(r,t),t&&x(e)}}}function kl(t){let e;return{c(){e=S(t[14])},m(t,i){v(t,e,i)},p(t,i){16384&i[0]&&L(e,t[14])},d(t){t&&x(e)}}}function Pl(t){let e,i,n=t[54].text+"";return{c(){e=S(n),i=C()},m(t,n){v(t,e,n),v(t,i,n)},p(t,i){32768&i[0]&&n!==(n=t[54].text+"")&&L(e,n)},d(t){t&&x(e),t&&x(i)}}}function Ll(t){let e,i;return e=new da({props:{kind:"secondary",$$slots:{default:[Pl]},$$scope:{ctx:t}}}),e.$on("click",(function(){return t[41](t[54])})),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(i,n){t=i;const r={};32768&n[0]|524288&n[1]&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function zl(t){let e;return{c(){e=S(t[10])},m(t,i){v(t,e,i)},p(t,i){1024&i[0]&&L(e,t[10])},d(t){t&&x(e)}}}function Dl(t){let e,i,r,o,a,l,u,f,m,g,y,b,T,E,M,P,z,D,O=t[4]&&Tl(t),F=t[6]&&Sl(t);const N=t[31].heading,B=c(N,t,t[50],xl),j=B||function(t){let e;return{c(){e=S(t[5])},m(t,i){v(t,e,i)},p(t,i){32&i[0]&&L(e,t[5])},d(t){t&&x(e)}}}(t);let $=!t[4]&&Cl(t);const U=t[31].default,V=c(U,t,t[50],null);let G=t[9]&&El(),q=!t[4]&&Il(t),Z=[{role:"dialog"},{tabindex:"-1"},t[22],{"aria-modal":"true"},{"aria-label":t[23]}],W={};for(let t=0;t<Z.length;t+=1)W=n(W,Z[t]);let H=[{role:"presentation"},{id:t[17]},t[27]],X={};for(let t=0;t<H.length;t+=1)X=n(X,H[t]);return{c(){e=w("div"),i=w("div"),r=w("div"),O&&O.c(),o=C(),F&&F.c(),a=C(),l=w("h3"),j&&j.c(),u=C(),$&&$.c(),f=C(),m=w("div"),V&&V.c(),E=C(),G&&G.c(),M=C(),q&&q.c(),A(l,"id",t[24]),R(l,"bx--modal-header__heading",!0),R(r,"bx--modal-header",!0),A(m,"id",t[18]),A(m,"tabindex",g=t[9]?"0":void 0),A(m,"role",y=t[9]?"region":void 0),A(m,"aria-label",b=t[9]?t[23]:void 0),A(m,"aria-labelledby",T=t[6]?t[25]:t[24]),R(m,"bx--modal-content",!0),R(m,"bx--modal-content--with-form",t[8]),R(m,"bx--modal-scroll-content",t[9]),k(i,W),R(i,"bx--modal-container",!0),R(i,"bx--modal-container--xs","xs"===t[2]),R(i,"bx--modal-container--sm","sm"===t[2]),R(i,"bx--modal-container--lg","lg"===t[2]),k(e,X),R(e,"bx--modal",!0),R(e,"bx--modal-tall",!t[4]),R(e,"is-visible",t[0]),R(e,"bx--modal--danger",t[3])},m(n,s){v(n,e,s),_(e,i),_(i,r),O&&O.m(r,null),_(r,o),F&&F.m(r,null),_(r,a),_(r,l),j&&j.m(l,null),_(r,u),$&&$.m(r,null),_(i,f),_(i,m),V&&V.m(m,null),_(i,E),G&&G.m(i,null),_(i,M),q&&q.m(i,null),t[44](i),t[46](e),P=!0,z||(D=[I(i,"click",t[45]),I(e,"keydown",t[32]),I(e,"keydown",t[47]),I(e,"click",t[33]),I(e,"click",t[48]),I(e,"mouseover",t[34]),I(e,"mouseenter",t[35]),I(e,"mouseleave",t[36]),I(e,"transitionend",t[49])],z=!0)},p(t,n){t[4]?O?(O.p(t,n),16&n[0]&&at(O,1)):(O=Tl(t),O.c(),at(O,1),O.m(r,o)):O&&(ot(),lt(O,1,1,(()=>{O=null})),st()),t[6]?F?(F.p(t,n),64&n[0]&&at(F,1)):(F=Sl(t),F.c(),at(F,1),F.m(r,a)):F&&(ot(),lt(F,1,1,(()=>{F=null})),st()),B?B.p&&(!P||524288&n[1])&&p(B,N,t,t[50],P?h(N,t[50],n,vl):d(t[50]),xl):j&&j.p&&(!P||32&n[0])&&j.p(t,P?n:[-1,-1]),(!P||16777216&n[0])&&A(l,"id",t[24]),t[4]?$&&(ot(),lt($,1,1,(()=>{$=null})),st()):$?($.p(t,n),16&n[0]&&at($,1)):($=Cl(t),$.c(),at($,1),$.m(r,null)),V&&V.p&&(!P||524288&n[1])&&p(V,U,t,t[50],P?h(U,t[50],n,null):d(t[50]),null),(!P||262144&n[0])&&A(m,"id",t[18]),(!P||512&n[0]&&g!==(g=t[9]?"0":void 0))&&A(m,"tabindex",g),(!P||512&n[0]&&y!==(y=t[9]?"region":void 0))&&A(m,"role",y),(!P||8389120&n[0]&&b!==(b=t[9]?t[23]:void 0))&&A(m,"aria-label",b),(!P||50331712&n[0]&&T!==(T=t[6]?t[25]:t[24]))&&A(m,"aria-labelledby",T),256&n[0]&&R(m,"bx--modal-content--with-form",t[8]),512&n[0]&&R(m,"bx--modal-scroll-content",t[9]),t[9]?G||(G=El(),G.c(),G.m(i,M)):G&&(G.d(1),G=null),t[4]?q&&(ot(),lt(q,1,1,(()=>{q=null})),st()):q?(q.p(t,n),16&n[0]&&at(q,1)):(q=Il(t),q.c(),at(q,1),q.m(i,null)),k(i,W=pt(Z,[{role:"dialog"},{tabindex:"-1"},4194304&n[0]&&t[22],{"aria-modal":"true"},(!P||8388608&n[0])&&{"aria-label":t[23]}])),R(i,"bx--modal-container",!0),R(i,"bx--modal-container--xs","xs"===t[2]),R(i,"bx--modal-container--sm","sm"===t[2]),R(i,"bx--modal-container--lg","lg"===t[2]),k(e,X=pt(H,[{role:"presentation"},(!P||131072&n[0])&&{id:t[17]},134217728&n[0]&&t[27]])),R(e,"bx--modal",!0),R(e,"bx--modal-tall",!t[4]),R(e,"is-visible",t[0]),R(e,"bx--modal--danger",t[3])},i(t){P||(at(O),at(F),at(j,t),at($),at(V,t),at(q),P=!0)},o(t){lt(O),lt(F),lt(j,t),lt($),lt(V,t),lt(q),P=!1},d(i){i&&x(e),O&&O.d(),F&&F.d(),j&&j.d(i),$&&$.d(),V&&V.d(i),G&&G.d(),q&&q.d(),t[44](null),t[46](null),z=!1,s(D)}}}function Rl(t,e,i){let r,o,s,a;const l=["size","open","danger","alert","passiveModal","modalHeading","modalLabel","modalAriaLabel","iconDescription","hasForm","hasScrollingContent","primaryButtonText","primaryButtonDisabled","primaryButtonIcon","shouldSubmitOnEnter","secondaryButtonText","secondaryButtons","selectorPrimaryFocus","preventCloseOnClickOutside","id","ref"];let c=m(e,l),{$$slots:u={},$$scope:h}=e,{size:p}=e,{open:d=!1}=e,{danger:g=!1}=e,{alert:y=!1}=e,{passiveModal:_=!1}=e,{modalHeading:v}=e,{modalLabel:x}=e,{modalAriaLabel:b}=e,{iconDescription:w="Close the modal"}=e,{hasForm:T=!1}=e,{hasScrollingContent:S=!1}=e,{primaryButtonText:C=""}=e,{primaryButtonDisabled:E=!1}=e,{primaryButtonIcon:I}=e,{shouldSubmitOnEnter:M=!0}=e,{secondaryButtonText:A=""}=e,{secondaryButtons:k=[]}=e,{selectorPrimaryFocus:P="[data-modal-primary-focus]"}=e,{preventCloseOnClickOutside:L=!1}=e,{id:z="ccs-"+Math.random().toString(36)}=e,{ref:D=null}=e;const R=j();let O=null,F=null,$=!1,V=!1;var q;B((()=>()=>{document.body.classList.remove("bx--body--with-modal-open")})),q=()=>{$?d||($=!1,R("close"),document.body.classList.remove("bx--body--with-modal-open")):d&&($=!0,function(t){((t||F).querySelector(P)||O).focus()}(),R("open"),document.body.classList.add("bx--body--with-modal-open"))},N().$$.after_update.push(q);let Z={};return t.$$set=t=>{i(53,e=n(n({},e),f(t))),i(27,c=m(e,l)),"size"in t&&i(2,p=t.size),"open"in t&&i(0,d=t.open),"danger"in t&&i(3,g=t.danger),"alert"in t&&i(28,y=t.alert),"passiveModal"in t&&i(4,_=t.passiveModal),"modalHeading"in t&&i(5,v=t.modalHeading),"modalLabel"in t&&i(6,x=t.modalLabel),"modalAriaLabel"in t&&i(29,b=t.modalAriaLabel),"iconDescription"in t&&i(7,w=t.iconDescription),"hasForm"in t&&i(8,T=t.hasForm),"hasScrollingContent"in t&&i(9,S=t.hasScrollingContent),"primaryButtonText"in t&&i(10,C=t.primaryButtonText),"primaryButtonDisabled"in t&&i(11,E=t.primaryButtonDisabled),"primaryButtonIcon"in t&&i(12,I=t.primaryButtonIcon),"shouldSubmitOnEnter"in t&&i(13,M=t.shouldSubmitOnEnter),"secondaryButtonText"in t&&i(14,A=t.secondaryButtonText),"secondaryButtons"in t&&i(15,k=t.secondaryButtons),"selectorPrimaryFocus"in t&&i(30,P=t.selectorPrimaryFocus),"preventCloseOnClickOutside"in t&&i(16,L=t.preventCloseOnClickOutside),"id"in t&&i(17,z=t.id),"ref"in t&&i(1,D=t.ref),"$$scope"in t&&i(50,h=t.$$scope)},t.$$.update=()=>{131072&t.$$.dirty[0]&&i(25,r=`bx--modal-header__label--modal-${z}`),131072&t.$$.dirty[0]&&i(24,o=`bx--modal-header__heading--modal-${z}`),131072&t.$$.dirty[0]&&i(18,s=`bx--modal-body--${z}`),i(23,a=x||e["aria-label"]||b||v),268697616&t.$$.dirty[0]&&y&&(_&&i(22,Z.role="alert",Z),_||(i(22,Z.role="alertdialog",Z),i(22,Z["aria-describedby"]=s,Z)))},e=f(e),[d,D,p,g,_,v,x,w,T,S,C,E,I,M,A,k,L,z,s,O,F,V,Z,a,o,r,R,c,y,b,P,u,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{O=t,i(19,O)}))},()=>{i(0,d=!1)},function(t){G[t?"unshift":"push"]((()=>{O=t,i(19,O)}))},()=>{i(0,d=!1)},t=>{R("click:button--secondary",{text:t.text})},()=>{R("click:button--secondary",{text:A})},()=>{R("submit"),R("click:button--primary")},function(t){G[t?"unshift":"push"]((()=>{F=t,i(20,F)}))},()=>{i(21,V=!0)},function(t){G[t?"unshift":"push"]((()=>{D=t,i(1,D)}))},t=>{if(d)if("Escape"===t.key)i(0,d=!1);else if("Tab"===t.key){const e="\n  a[href], area[href], input:not([disabled]):not([tabindex='-1']),\n  button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),\n  textarea:not([disabled]):not([tabindex='-1']),\n  iframe, object, embed, *[tabindex]:not([tabindex='-1']):not([disabled]), *[contenteditable=true]\n",i=Array.from(D.querySelectorAll(e));let n=i.indexOf(document.activeElement);-1===n&&t.shiftKey&&(n=0),n+=i.length+(t.shiftKey?-1:1),n%=i.length,i[n].focus(),t.preventDefault()}else M&&"Enter"===t.key&&(R("submit"),R("click:button--primary"))},()=>{V||L||i(0,d=!1),i(21,V=!1)},t=>{"transform"===t.propertyName&&R("transitionend",{open:d})},h]}var Ol=class extends vt{constructor(t){super(),_t(this,t,Rl,Dl,l,{size:2,open:0,danger:3,alert:28,passiveModal:4,modalHeading:5,modalLabel:6,modalAriaLabel:29,iconDescription:7,hasForm:8,hasScrollingContent:9,primaryButtonText:10,primaryButtonDisabled:11,primaryButtonIcon:12,shouldSubmitOnEnter:13,secondaryButtonText:14,secondaryButtons:15,selectorPrimaryFocus:30,preventCloseOnClickOutside:16,id:17,ref:1},null,[-1,-1])}};function Fl(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Nl(t){let e,r,o=t[1]&&Fl(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M17 15L17 8 15 8 15 15 8 15 8 17 15 17 15 24 17 24 17 17 24 17 24 15z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=Fl(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Bl(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var jl=class extends vt{constructor(t){super(),_t(this,t,Bl,Nl,l,{size:0,title:1})}};function $l(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Ul(t){let e,r,o=t[1]&&$l(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M8 15H24V17H8z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=$l(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Vl(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Gl=class extends vt{constructor(t){super(),_t(this,t,Vl,Ul,l,{size:0,title:1})}};function ql(t){let e,i;return{c(){e=T("title"),i=S(t[1])},m(t,n){v(t,e,n),_(e,i)},p(t,e){2&e&&L(i,t[1])},d(t){t&&x(e)}}}function Zl(t){let e,r,o=t[1]&&ql(t),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:t[0]},{height:t[0]},t[2],t[3]],a={};for(let t=0;t<s.length;t+=1)a=n(a,s[t]);return{c(){e=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),P(e,a)},m(t,i){v(t,e,i),o&&o.m(e,null),_(e,r)},p(t,[i]){t[1]?o?o.p(t,i):(o=ql(t),o.c(),o.m(e,r)):o&&(o.d(1),o=null),P(e,a=pt(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:t[0]},1&i&&{height:t[0]},4&i&&t[2],8&i&&t[3]]))},i:i,o:i,d(t){t&&x(e),o&&o.d()}}}function Wl(t,e,i){let r,o;const s=["size","title"];let a=m(e,s),{size:l=16}=e,{title:c}=e;return t.$$set=t=>{i(5,e=n(n({},e),f(t))),i(3,a=m(e,s)),"size"in t&&i(0,l=t.size),"title"in t&&i(1,c=t.title)},t.$$.update=()=>{i(4,r=e["aria-label"]||e["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(e.tabindex)||void 0})},e=f(e),[l,c,o,a,r]}var Hl=class extends vt{constructor(t){super(),_t(this,t,Wl,Zl,l,{size:0,title:1})}};const Xl=t=>({}),Yl=t=>({});function Kl(t){let e,i;const n=t[34].label,r=c(n,t,t[33],Yl),o=r||function(t){let e;return{c(){e=S(t[16])},m(t,i){v(t,e,i)},p(t,i){65536&i[0]&&L(e,t[16])},d(t){t&&x(e)}}}(t);return{c(){e=w("label"),o&&o.c(),A(e,"for",t[18]),R(e,"bx--label",!0),R(e,"bx--label--disabled",t[8]),R(e,"bx--visually-hidden",t[17])},m(t,n){v(t,e,n),o&&o.m(e,null),i=!0},p(t,s){r?r.p&&(!i||4&s[1])&&p(r,n,t,t[33],i?h(n,t[33],s,Xl):d(t[33]),Yl):o&&o.p&&(!i||65536&s[0])&&o.p(t,i?s:[-1,-1]),(!i||262144&s[0])&&A(e,"for",t[18]),256&s[0]&&R(e,"bx--label--disabled",t[8]),131072&s[0]&&R(e,"bx--visually-hidden",t[17])},i(t){i||(at(o,t),i=!0)},o(t){lt(o,t),i=!1},d(t){t&&x(e),o&&o.d(t)}}}function Jl(t){let e,i;return e=new Ia({props:{class:"bx--number__invalid"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Ql(t){let e,i;return e=new Pa({props:{class:"bx--number__invalid bx--number__invalid--warning"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function tc(t){let e,i;return e=new Hl({props:{class:"bx--text-input__readonly-icon"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function ec(t){let e,i,n,r,o,a,l,c,u,h,p,d,f,m,g,y,b;return n=new Gl({props:{class:"down-icon"}}),h=new jl({props:{class:"up-icon"}}),{c(){e=w("div"),i=w("button"),mt(n.$$.fragment),a=C(),l=w("div"),c=C(),u=w("button"),mt(h.$$.fragment),f=C(),m=w("div"),A(i,"type","button"),A(i,"tabindex","-1"),A(i,"title",r=t[23]||t[10]),A(i,"aria-label",o=t[23]||t[10]),i.disabled=t[8],R(i,"bx--number__control-btn",!0),R(i,"down-icon",!0),R(l,"bx--number__rule-divider",!0),A(u,"type","button"),A(u,"tabindex","-1"),A(u,"title",p=t[24]||t[10]),A(u,"aria-label",d=t[24]||t[10]),u.disabled=t[8],R(u,"bx--number__control-btn",!0),R(u,"up-icon",!0),R(m,"bx--number__rule-divider",!0),R(e,"bx--number__controls",!0)},m(r,o){v(r,e,o),_(e,i),gt(n,i,null),_(e,a),_(e,l),_(e,c),_(e,u),gt(h,u,null),_(e,f),_(e,m),g=!0,y||(b=[I(i,"click",t[42]),I(u,"click",t[43])],y=!0)},p(t,e){(!g||8389632&e[0]&&r!==(r=t[23]||t[10]))&&A(i,"title",r),(!g||8389632&e[0]&&o!==(o=t[23]||t[10]))&&A(i,"aria-label",o),(!g||256&e[0])&&(i.disabled=t[8]),(!g||16778240&e[0]&&p!==(p=t[24]||t[10]))&&A(u,"title",p),(!g||16778240&e[0]&&d!==(d=t[24]||t[10]))&&A(u,"aria-label",d),(!g||256&e[0])&&(u.disabled=t[8])},i(t){g||(at(n.$$.fragment,t),at(h.$$.fragment,t),g=!0)},o(t){lt(n.$$.fragment,t),lt(h.$$.fragment,t),g=!1},d(t){t&&x(e),yt(n),yt(h),y=!1,s(b)}}}function ic(t){let e,i;return{c(){e=w("div"),i=S(t[15]),R(e,"bx--form__helper-text",!0),R(e,"bx--form__helper-text--disabled",t[8])},m(t,n){v(t,e,n),_(e,i)},p(t,n){32768&n[0]&&L(i,t[15]),256&n[0]&&R(e,"bx--form__helper-text--disabled",t[8])},d(t){t&&x(e)}}}function nc(t){let e,i;return{c(){e=w("div"),i=S(t[12]),A(e,"id",t[21]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){4096&n[0]&&L(i,t[12]),2097152&n[0]&&A(e,"id",t[21])},d(t){t&&x(e)}}}function rc(t){let e,i;return{c(){e=w("div"),i=S(t[14]),A(e,"id",t[21]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){16384&n[0]&&L(i,t[14]),2097152&n[0]&&A(e,"id",t[21])},d(t){t&&x(e)}}}function oc(t){let e,i,r,o,a,l,c,u,h,p,d,f,m,g,y,b,T,S,E,M,P,L=(t[28].label||t[16])&&Kl(t),z=[{type:"number"},{pattern:"[0-9]*"},{"aria-describedby":t[21]},{"data-invalid":l=t[11]||void 0},{"aria-invalid":c=t[11]||void 0},{"aria-label":u=t[16]?void 0:t[20]},{disabled:t[8]},{id:t[18]},{name:t[19]},{max:t[4]},{min:t[5]},{step:t[3]},{value:h=t[0]??""},{readOnly:t[7]},t[29]],D={};for(let t=0;t<z.length;t+=1)D=n(D,z[t]);let O=t[11]&&Jl(),F=!t[11]&&t[13]&&Ql(),N=t[7]&&tc(),B=!t[9]&&ec(t),j=!t[22]&&!t[13]&&t[15]&&ic(t),$=t[22]&&nc(t),U=!t[22]&&t[13]&&rc(t);return{c(){e=w("div"),i=w("div"),L&&L.c(),r=C(),o=w("div"),a=w("input"),p=C(),O&&O.c(),d=C(),F&&F.c(),f=C(),N&&N.c(),m=C(),B&&B.c(),g=C(),j&&j.c(),y=C(),$&&$.c(),b=C(),U&&U.c(),k(a,D),R(o,"bx--number__input-wrapper",!0),R(o,"bx--number__input-wrapper--warning",!t[11]&&t[13]),A(i,"data-invalid",T=t[22]||void 0),A(i,"class",S=t[2]&&`bx--number--${t[2]}`),R(i,"bx--number",!0),R(i,"bx--number--helpertext",!0),R(i,"bx--number--readonly",t[7]),R(i,"bx--number--light",t[6]),R(i,"bx--number--nolabel",t[17]),R(i,"bx--number--nosteppers",t[9]),R(e,"bx--form-item",!0)},m(n,s){v(n,e,s),_(e,i),L&&L.m(i,null),_(i,r),_(i,o),_(o,a),a.autofocus&&a.focus(),t[41](a),_(o,p),O&&O.m(o,null),_(o,d),F&&F.m(o,null),_(o,f),N&&N.m(o,null),_(o,m),B&&B.m(o,null),_(i,g),j&&j.m(i,null),_(i,y),$&&$.m(i,null),_(i,b),U&&U.m(i,null),E=!0,M||(P=[I(a,"change",t[27]),I(a,"input",t[26]),I(a,"focus",t[39]),I(a,"blur",t[40]),I(e,"click",t[35]),I(e,"mouseover",t[36]),I(e,"mouseenter",t[37]),I(e,"mouseleave",t[38])],M=!0)},p(t,e){t[28].label||t[16]?L?(L.p(t,e),268500992&e[0]&&at(L,1)):(L=Kl(t),L.c(),at(L,1),L.m(i,r)):L&&(ot(),lt(L,1,1,(()=>{L=null})),st()),k(a,D=pt(z,[{type:"number"},{pattern:"[0-9]*"},(!E||2097152&e[0])&&{"aria-describedby":t[21]},(!E||2048&e[0]&&l!==(l=t[11]||void 0))&&{"data-invalid":l},(!E||2048&e[0]&&c!==(c=t[11]||void 0))&&{"aria-invalid":c},(!E||1114112&e[0]&&u!==(u=t[16]?void 0:t[20]))&&{"aria-label":u},(!E||256&e[0])&&{disabled:t[8]},(!E||262144&e[0])&&{id:t[18]},(!E||524288&e[0])&&{name:t[19]},(!E||16&e[0])&&{max:t[4]},(!E||32&e[0])&&{min:t[5]},(!E||8&e[0])&&{step:t[3]},(!E||1&e[0]&&h!==(h=t[0]??"")&&a.value!==h)&&{value:h},(!E||128&e[0])&&{readOnly:t[7]},536870912&e[0]&&t[29]])),t[11]?O?2048&e[0]&&at(O,1):(O=Jl(),O.c(),at(O,1),O.m(o,d)):O&&(ot(),lt(O,1,1,(()=>{O=null})),st()),!t[11]&&t[13]?F?10240&e[0]&&at(F,1):(F=Ql(),F.c(),at(F,1),F.m(o,f)):F&&(ot(),lt(F,1,1,(()=>{F=null})),st()),t[7]?N?128&e[0]&&at(N,1):(N=tc(),N.c(),at(N,1),N.m(o,m)):N&&(ot(),lt(N,1,1,(()=>{N=null})),st()),t[9]?B&&(ot(),lt(B,1,1,(()=>{B=null})),st()):B?(B.p(t,e),512&e[0]&&at(B,1)):(B=ec(t),B.c(),at(B,1),B.m(o,null)),10240&e[0]&&R(o,"bx--number__input-wrapper--warning",!t[11]&&t[13]),t[22]||t[13]||!t[15]?j&&(j.d(1),j=null):j?j.p(t,e):(j=ic(t),j.c(),j.m(i,y)),t[22]?$?$.p(t,e):($=nc(t),$.c(),$.m(i,b)):$&&($.d(1),$=null),!t[22]&&t[13]?U?U.p(t,e):(U=rc(t),U.c(),U.m(i,null)):U&&(U.d(1),U=null),(!E||4194304&e[0]&&T!==(T=t[22]||void 0))&&A(i,"data-invalid",T),(!E||4&e[0]&&S!==(S=t[2]&&`bx--number--${t[2]}`))&&A(i,"class",S),4&e[0]&&R(i,"bx--number",!0),4&e[0]&&R(i,"bx--number--helpertext",!0),132&e[0]&&R(i,"bx--number--readonly",t[7]),68&e[0]&&R(i,"bx--number--light",t[6]),131076&e[0]&&R(i,"bx--number--nolabel",t[17]),516&e[0]&&R(i,"bx--number--nosteppers",t[9])},i(t){E||(at(L),at(O),at(F),at(N),at(B),E=!0)},o(t){lt(L),lt(O),lt(F),lt(N),lt(B),E=!1},d(i){i&&x(e),L&&L.d(),t[41](null),O&&O.d(),F&&F.d(),N&&N.d(),B&&B.d(),j&&j.d(),$&&$.d(),U&&U.d(),M=!1,s(P)}}}function sc(t){return""!=t?Number(t):null}function ac(t,e,i){let r,o,s,a,l;const c=["size","value","step","max","min","light","readonly","allowEmpty","disabled","hideSteppers","iconDescription","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","translationIds","id","name","ref"];let u=m(e,c),{$$slots:h={},$$scope:p}=e;const d=g(h);let{size:y}=e,{value:_=null}=e,{step:v=1}=e,{max:x}=e,{min:b}=e,{light:w=!1}=e,{readonly:T=!1}=e,{allowEmpty:S=!1}=e,{disabled:C=!1}=e,{hideSteppers:E=!1}=e,{iconDescription:I=""}=e,{invalid:M=!1}=e,{invalidText:A=""}=e,{warn:k=!1}=e,{warnText:P=""}=e,{helperText:L=""}=e,{label:z=""}=e,{hideLabel:D=!1}=e,{translateWithId:R=(t=>$[t])}=e;const O={increment:"increment",decrement:"decrement"};let{id:F="ccs-"+Math.random().toString(36)}=e,{name:N}=e,{ref:B=null}=e;const $={[O.increment]:"Increment number",[O.decrement]:"Decrement number"},V=j();function q(t){const e=i(0,_+=t*v);i(0,_=e<b?b:e>x?x:e),V("input",_),V("change",_)}return t.$$set=t=>{i(46,e=n(n({},e),f(t))),i(29,u=m(e,c)),"size"in t&&i(2,y=t.size),"value"in t&&i(0,_=t.value),"step"in t&&i(3,v=t.step),"max"in t&&i(4,x=t.max),"min"in t&&i(5,b=t.min),"light"in t&&i(6,w=t.light),"readonly"in t&&i(7,T=t.readonly),"allowEmpty"in t&&i(30,S=t.allowEmpty),"disabled"in t&&i(8,C=t.disabled),"hideSteppers"in t&&i(9,E=t.hideSteppers),"iconDescription"in t&&i(10,I=t.iconDescription),"invalid"in t&&i(11,M=t.invalid),"invalidText"in t&&i(12,A=t.invalidText),"warn"in t&&i(13,k=t.warn),"warnText"in t&&i(14,P=t.warnText),"helperText"in t&&i(15,L=t.helperText),"label"in t&&i(16,z=t.label),"hideLabel"in t&&i(17,D=t.hideLabel),"translateWithId"in t&&i(31,R=t.translateWithId),"id"in t&&i(18,F=t.id),"name"in t&&i(19,N=t.name),"ref"in t&&i(1,B=t.ref),"$$scope"in t&&i(33,p=t.$$scope)},t.$$.update=()=>{1&t.$$.dirty[1]&&i(24,r=R("increment")),1&t.$$.dirty[1]&&i(23,o=R("decrement")),1073743921&t.$$.dirty[0]&&i(22,s=M||!S&&null==_||_>x||_<b),262144&t.$$.dirty[0]&&i(21,a=`error-${F}`),i(20,l=e["aria-label"]||"Numeric input field with increment and decrement buttons")},e=f(e),[_,B,y,v,x,b,w,T,C,E,I,M,A,k,P,L,z,D,F,N,l,a,s,o,r,q,function({target:t}){i(0,_=sc(t.value)),V("input",_)},function({target:t}){V("change",sc(t.value))},d,u,S,R,O,p,h,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{B=t,i(1,B)}))},()=>{q(-1)},()=>{q(1)}]}var lc=class extends vt{constructor(t){super(),_t(this,t,ac,oc,l,{size:2,value:0,step:3,max:4,min:5,light:6,readonly:7,allowEmpty:30,disabled:8,hideSteppers:9,iconDescription:10,invalid:11,invalidText:12,warn:13,warnText:14,helperText:15,label:16,hideLabel:17,translateWithId:31,translationIds:32,id:18,name:19,ref:1},null,[-1,-1])}get translationIds(){return this.$$.ctx[32]}};const cc=t=>({}),uc=t=>({});function hc(t){let e,i,r,o,a,l,u,f,m,g,y,b,T,E,M,P,z,O,F,N,B,j,$,U,V,G,q,Z,W,H,X=(t[5]||t[4])+"",Y=(t[3]||t[2])+"";const K=t[30].labelText,J=c(K,t,t[29],uc),Q=J||function(t){let e;return{c(){e=S(t[15])},m(t,i){v(t,e,i)},p(t,i){32768&i[0]&&L(e,t[15])},d(t){t&&x(e)}}}(t);let tt=[t[25]],et={};for(let t=0;t<tt.length;t+=1)et=n(et,tt[t]);return{c(){e=w("div"),i=w("label"),Q&&Q.c(),r=C(),o=w("div"),a=w("span"),l=S(X),u=C(),f=w("div"),m=w("div"),g=C(),y=w("div"),b=C(),T=w("div"),E=C(),M=w("input"),P=C(),z=w("span"),O=S(Y),F=C(),N=w("input"),A(i,"for",t[13]),A(i,"id",t[20]),R(i,"bx--label",!0),R(i,"bx--label--disabled",t[10]),R(a,"bx--slider__range-label",!0),A(m,"role","slider"),A(m,"tabindex","0"),D(m,"left",t[19]+"%"),A(m,"aria-valuemax",t[2]),A(m,"aria-valuemin",t[4]),A(m,"aria-valuenow",t[0]),A(m,"id",t[13]),R(m,"bx--slider__thumb",!0),R(y,"bx--slider__track",!0),D(T,"transform","translate(0, -50%) scaleX("+t[19]/100+")"),R(T,"bx--slider__filled-track",!0),A(M,"type","hidden"),A(M,"name",t[16]),M.value=t[0],M.required=t[8],A(M,"min",t[4]),A(M,"max",t[2]),A(M,"step",t[6]),R(M,"bx--slider__input",!0),A(f,"role","presentation"),A(f,"tabindex","-1"),R(f,"bx--slider",!0),R(f,"bx--slider--disabled",t[10]),R(z,"bx--slider__range-label",!0),A(N,"type",B=t[12]?"hidden":t[9]),A(N,"style",j=t[12]?"display: none":void 0),A(N,"id",$="input-"+t[13]),A(N,"name",t[16]),N.value=t[0],A(N,"aria-labelledby",U=t[26]["aria-label"]?void 0:t[20]),A(N,"aria-label",V=t[26]["aria-label"]||"Slider number input"),N.disabled=t[10],N.required=t[8],A(N,"min",t[4]),A(N,"max",t[2]),A(N,"step",t[6]),A(N,"data-invalid",G=t[14]||null),A(N,"aria-invalid",q=t[14]||null),R(N,"bx--text-input",!0),R(N,"bx--slider-text-input",!0),R(N,"bx--text-input--light",t[11]),R(N,"bx--text-input--invalid",t[14]),R(o,"bx--slider-container",!0),k(e,et),R(e,"bx--form-item",!0)},m(n,s){v(n,e,s),_(e,i),Q&&Q.m(i,null),_(e,r),_(e,o),_(o,a),_(a,l),_(o,u),_(o,f),_(f,m),_(f,g),_(f,y),t[35](y),_(f,b),_(f,T),_(f,E),_(f,M),t[36](f),_(o,P),_(o,z),_(z,O),_(o,F),_(o,N),Z=!0,W||(H=[I(window,"mousemove",t[24]),I(window,"touchmove",t[24]),I(window,"mouseup",t[23]),I(window,"touchend",t[23]),I(window,"touchcancel",t[23]),I(f,"mousedown",t[21]),I(f,"mousedown",t[22]),I(f,"touchstart",t[22],{passive:!0}),I(f,"keydown",t[37]),I(N,"change",t[38]),I(e,"click",t[31]),I(e,"mouseover",t[32]),I(e,"mouseenter",t[33]),I(e,"mouseleave",t[34])],W=!0)},p(t,n){J?J.p&&(!Z||536870912&n[0])&&p(J,K,t,t[29],Z?h(K,t[29],n,cc):d(t[29]),uc):Q&&Q.p&&(!Z||32768&n[0])&&Q.p(t,Z?n:[-1,-1]),(!Z||8192&n[0])&&A(i,"for",t[13]),(!Z||1048576&n[0])&&A(i,"id",t[20]),1024&n[0]&&R(i,"bx--label--disabled",t[10]),(!Z||48&n[0])&&X!==(X=(t[5]||t[4])+"")&&L(l,X),(!Z||524288&n[0])&&D(m,"left",t[19]+"%"),(!Z||4&n[0])&&A(m,"aria-valuemax",t[2]),(!Z||16&n[0])&&A(m,"aria-valuemin",t[4]),(!Z||1&n[0])&&A(m,"aria-valuenow",t[0]),(!Z||8192&n[0])&&A(m,"id",t[13]),(!Z||524288&n[0])&&D(T,"transform","translate(0, -50%) scaleX("+t[19]/100+")"),(!Z||65536&n[0])&&A(M,"name",t[16]),(!Z||1&n[0])&&(M.value=t[0]),(!Z||256&n[0])&&(M.required=t[8]),(!Z||16&n[0])&&A(M,"min",t[4]),(!Z||4&n[0])&&A(M,"max",t[2]),(!Z||64&n[0])&&A(M,"step",t[6]),1024&n[0]&&R(f,"bx--slider--disabled",t[10]),(!Z||12&n[0])&&Y!==(Y=(t[3]||t[2])+"")&&L(O,Y),(!Z||4608&n[0]&&B!==(B=t[12]?"hidden":t[9]))&&A(N,"type",B),(!Z||4096&n[0]&&j!==(j=t[12]?"display: none":void 0))&&A(N,"style",j),(!Z||8192&n[0]&&$!==($="input-"+t[13]))&&A(N,"id",$),(!Z||65536&n[0])&&A(N,"name",t[16]),(!Z||1&n[0]&&N.value!==t[0])&&(N.value=t[0]),(!Z||68157440&n[0]&&U!==(U=t[26]["aria-label"]?void 0:t[20]))&&A(N,"aria-labelledby",U),(!Z||67108864&n[0]&&V!==(V=t[26]["aria-label"]||"Slider number input"))&&A(N,"aria-label",V),(!Z||1024&n[0])&&(N.disabled=t[10]),(!Z||256&n[0])&&(N.required=t[8]),(!Z||16&n[0])&&A(N,"min",t[4]),(!Z||4&n[0])&&A(N,"max",t[2]),(!Z||64&n[0])&&A(N,"step",t[6]),(!Z||16384&n[0]&&G!==(G=t[14]||null))&&A(N,"data-invalid",G),(!Z||16384&n[0]&&q!==(q=t[14]||null))&&A(N,"aria-invalid",q),2048&n[0]&&R(N,"bx--text-input--light",t[11]),16384&n[0]&&R(N,"bx--text-input--invalid",t[14]),k(e,et=pt(tt,[33554432&n[0]&&t[25]])),R(e,"bx--form-item",!0)},i(t){Z||(at(Q,t),Z=!0)},o(t){lt(Q,t),Z=!1},d(i){i&&x(e),Q&&Q.d(i),t[35](null),t[36](null),W=!1,s(H)}}}function pc(t,e,i){let r,o,s;const a=["value","max","maxLabel","min","minLabel","step","stepMultiplier","required","inputType","disabled","light","hideTextInput","id","invalid","labelText","name","ref"];let l=m(e,a),{$$slots:c={},$$scope:u}=e,{value:h=0}=e,{max:p=100}=e,{maxLabel:d=""}=e,{min:g=0}=e,{minLabel:y=""}=e,{step:_=1}=e,{stepMultiplier:v=4}=e,{required:x=!1}=e,{inputType:b="number"}=e,{disabled:w=!1}=e,{light:T=!1}=e,{hideTextInput:S=!1}=e,{id:C="ccs-"+Math.random().toString(36)}=e,{invalid:E=!1}=e,{labelText:I=""}=e,{name:M=""}=e,{ref:A=null}=e;const k=j();let P=null,L=!1,z=!1;function D(){i(27,L=!0)}return t.$$set=t=>{i(26,e=n(n({},e),f(t))),i(25,l=m(e,a)),"value"in t&&i(0,h=t.value),"max"in t&&i(2,p=t.max),"maxLabel"in t&&i(3,d=t.maxLabel),"min"in t&&i(4,g=t.min),"minLabel"in t&&i(5,y=t.minLabel),"step"in t&&i(6,_=t.step),"stepMultiplier"in t&&i(7,v=t.stepMultiplier),"required"in t&&i(8,x=t.required),"inputType"in t&&i(9,b=t.inputType),"disabled"in t&&i(10,w=t.disabled),"light"in t&&i(11,T=t.light),"hideTextInput"in t&&i(12,S=t.hideTextInput),"id"in t&&i(13,C=t.id),"invalid"in t&&i(14,E=t.invalid),"labelText"in t&&i(15,I=t.labelText),"name"in t&&i(16,M=t.name),"ref"in t&&i(1,A=t.ref),"$$scope"in t&&i(29,u=t.$$scope)},t.$$.update=()=>{8192&t.$$.dirty[0]&&i(20,r=`label-${C}`),20&t.$$.dirty[0]&&i(17,o=p-g),402654229&t.$$.dirty[0]&&(h<=g?i(0,h=g):h>=p&&i(0,h=p),L&&(!function(t){if(w)return;const e=t.touches?t.touches[0].clientX:t.clientX,{left:n,width:r}=P.getBoundingClientRect();let o=g+Math.round((e-n)/r*(p-g)/_)*_;o<=g?o=g:o>=p&&(o=p),i(0,h=o)}(event),i(27,L=!1)),z||w||k("change",h)),131089&t.$$.dirty[0]&&i(19,s=(h-g)/o*100)},e=f(e),[h,A,p,d,g,y,_,v,x,b,w,T,S,C,E,I,M,o,P,s,r,D,function(){i(28,z=!0)},function(){i(28,z=!1),i(27,L=!1)},function(){z&&D()},l,e,L,z,u,c,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{P=t,i(18,P)}))},function(t){G[t?"unshift":"push"]((()=>{A=t,i(1,A)}))},({shiftKey:t,key:e})=>{const n={ArrowDown:-1,ArrowLeft:-1,ArrowRight:1,ArrowUp:1};n[e]&&i(0,h+=_*(t?o/_/v:1)*n[e])},({target:t})=>{i(0,h=Number(t.value))}]}var dc=class extends vt{constructor(t){super(),_t(this,t,pc,hc,l,{value:0,max:2,maxLabel:3,min:4,minLabel:5,step:6,stepMultiplier:7,required:8,inputType:9,disabled:10,light:11,hideTextInput:12,id:13,invalid:14,labelText:15,name:16,ref:1},null,[-1,-1])}};const fc=t=>({}),mc=t=>({}),gc=t=>({}),yc=t=>({});function _c(t){let e,i,n,r=t[9]&&vc(t),o=!t[20]&&t[6]&&xc(t);return{c(){e=w("div"),r&&r.c(),i=C(),o&&o.c(),R(e,"bx--text-input__label-helper-wrapper",!0)},m(t,s){v(t,e,s),r&&r.m(e,null),_(e,i),o&&o.m(e,null),n=!0},p(t,n){t[9]?r?(r.p(t,n),512&n[0]&&at(r,1)):(r=vc(t),r.c(),at(r,1),r.m(e,i)):r&&(ot(),lt(r,1,1,(()=>{r=null})),st()),!t[20]&&t[6]?o?o.p(t,n):(o=xc(t),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(t){n||(at(r),n=!0)},o(t){lt(r),n=!1},d(t){t&&x(e),r&&r.d(),o&&o.d()}}}function vc(t){let e,i,n;const r=t[26].labelText,o=c(r,t,t[25],yc),s=o||function(t){let e;return{c(){e=S(t[9])},m(t,i){v(t,e,i)},p(t,i){512&i[0]&&L(e,t[9])},d(t){t&&x(e)}}}(t);return{c(){e=w("label"),s&&s.c(),A(e,"for",t[7]),A(e,"class",i=t[16]&&!!t[2]&&`bx--label--inline--${t[2]}`),R(e,"bx--label",!0),R(e,"bx--visually-hidden",t[10]),R(e,"bx--label--disabled",t[5]),R(e,"bx--label--inline",t[16])},m(t,i){v(t,e,i),s&&s.m(e,null),n=!0},p(t,a){o?o.p&&(!n||33554432&a[0])&&p(o,r,t,t[25],n?h(r,t[25],a,gc):d(t[25]),yc):s&&s.p&&(!n||512&a[0])&&s.p(t,n?a:[-1,-1]),(!n||128&a[0])&&A(e,"for",t[7]),(!n||65540&a[0]&&i!==(i=t[16]&&!!t[2]&&`bx--label--inline--${t[2]}`))&&A(e,"class",i),65540&a[0]&&R(e,"bx--label",!0),66564&a[0]&&R(e,"bx--visually-hidden",t[10]),65572&a[0]&&R(e,"bx--label--disabled",t[5]),65540&a[0]&&R(e,"bx--label--inline",t[16])},i(t){n||(at(s,t),n=!0)},o(t){lt(s,t),n=!1},d(t){t&&x(e),s&&s.d(t)}}}function xc(t){let e,i;return{c(){e=w("div"),i=S(t[6]),R(e,"bx--form__helper-text",!0),R(e,"bx--form__helper-text--disabled",t[5]),R(e,"bx--form__helper-text--inline",t[16])},m(t,n){v(t,e,n),_(e,i)},p(t,n){64&n[0]&&L(i,t[6]),32&n[0]&&R(e,"bx--form__helper-text--disabled",t[5]),65536&n[0]&&R(e,"bx--form__helper-text--inline",t[16])},d(t){t&&x(e)}}}function bc(t){let e,i,n;const r=t[26].labelText,o=c(r,t,t[25],mc),s=o||function(t){let e;return{c(){e=S(t[9])},m(t,i){v(t,e,i)},p(t,i){512&i[0]&&L(e,t[9])},d(t){t&&x(e)}}}(t);return{c(){e=w("label"),s&&s.c(),A(e,"for",t[7]),A(e,"class",i=t[16]&&!!t[2]&&`bx--label--inline--${t[2]}`),R(e,"bx--label",!0),R(e,"bx--visually-hidden",t[10]),R(e,"bx--label--disabled",t[5]),R(e,"bx--label--inline",t[16])},m(t,i){v(t,e,i),s&&s.m(e,null),n=!0},p(t,a){o?o.p&&(!n||33554432&a[0])&&p(o,r,t,t[25],n?h(r,t[25],a,fc):d(t[25]),mc):s&&s.p&&(!n||512&a[0])&&s.p(t,n?a:[-1,-1]),(!n||128&a[0])&&A(e,"for",t[7]),(!n||65540&a[0]&&i!==(i=t[16]&&!!t[2]&&`bx--label--inline--${t[2]}`))&&A(e,"class",i),65540&a[0]&&R(e,"bx--label",!0),66564&a[0]&&R(e,"bx--visually-hidden",t[10]),65572&a[0]&&R(e,"bx--label--disabled",t[5]),65540&a[0]&&R(e,"bx--label--inline",t[16])},i(t){n||(at(s,t),n=!0)},o(t){lt(s,t),n=!1},d(t){t&&x(e),s&&s.d(t)}}}function wc(t){let e,i;return e=new Ia({props:{class:"bx--text-input__invalid-icon"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Tc(t){let e,i;return e=new Pa({props:{class:"bx--text-input__invalid-icon\n            bx--text-input__invalid-icon--warning"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Sc(t){let e,i;return e=new Hl({props:{class:"bx--text-input__readonly-icon"}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Cc(t){let e;return{c(){e=w("hr"),R(e,"bx--text-input__divider",!0)},m(t,i){v(t,e,i)},d(t){t&&x(e)}}}function Ec(t){let e,i;return{c(){e=w("div"),i=S(t[12]),A(e,"id",t[19]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){4096&n[0]&&L(i,t[12]),524288&n[0]&&A(e,"id",t[19])},d(t){t&&x(e)}}}function Ic(t){let e,i;return{c(){e=w("div"),i=S(t[14]),A(e,"id",t[18]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){16384&n[0]&&L(i,t[14]),262144&n[0]&&A(e,"id",t[18])},d(t){t&&x(e)}}}function Mc(t){let e,i;return{c(){e=w("div"),i=S(t[6]),R(e,"bx--form__helper-text",!0),R(e,"bx--form__helper-text--disabled",t[5]),R(e,"bx--form__helper-text--inline",t[16])},m(t,n){v(t,e,n),_(e,i)},p(t,n){64&n[0]&&L(i,t[6]),32&n[0]&&R(e,"bx--form__helper-text--disabled",t[5]),65536&n[0]&&R(e,"bx--form__helper-text--inline",t[16])},d(t){t&&x(e)}}}function Ac(t){let e,i;return{c(){e=w("div"),i=S(t[12]),A(e,"id",t[19]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){4096&n[0]&&L(i,t[12]),524288&n[0]&&A(e,"id",t[19])},d(t){t&&x(e)}}}function kc(t){let e,i;return{c(){e=w("div"),i=S(t[14]),A(e,"id",t[18]),R(e,"bx--form-requirement",!0)},m(t,n){v(t,e,n),_(e,i)},p(t,n){16384&n[0]&&L(i,t[14]),262144&n[0]&&A(e,"id",t[18])},d(t){t&&x(e)}}}function Pc(t){let e,i,r,o,a,l,c,u,h,p,d,f,m,g,y,b,T,S,E,M,P,L,D,O,F,N=t[16]&&_c(t),B=!t[16]&&(t[9]||t[24].labelText)&&bc(t),j=t[11]&&wc(),$=!t[11]&&t[13]&&Tc(),U=t[17]&&Sc(),V=[{"data-invalid":p=t[11]||void 0},{"aria-invalid":d=t[11]||void 0},{"data-warn":f=t[13]||void 0},{"aria-describedby":m=t[11]?t[19]:t[13]?t[18]:void 0},{disabled:t[5]},{id:t[7]},{name:t[8]},{placeholder:t[3]},{required:t[15]},{readOnly:t[17]},t[23],{class:g=t[2]&&`bx--text-input--${t[2]}`}],G={};for(let t=0;t<V.length;t+=1)G=n(G,V[t]);let q=t[20]&&Cc(),Z=t[20]&&!t[16]&&t[11]&&Ec(t),W=t[20]&&!t[16]&&t[13]&&Ic(t),H=!t[11]&&!t[13]&&!t[20]&&!t[16]&&t[6]&&Mc(t),X=!t[20]&&t[11]&&Ac(t),Y=!t[20]&&!t[11]&&t[13]&&kc(t);return{c(){e=w("div"),N&&N.c(),i=C(),B&&B.c(),r=C(),o=w("div"),a=w("div"),j&&j.c(),l=C(),$&&$.c(),c=C(),U&&U.c(),u=C(),h=w("input"),y=C(),q&&q.c(),b=C(),Z&&Z.c(),T=C(),W&&W.c(),M=C(),H&&H.c(),P=C(),X&&X.c(),L=C(),Y&&Y.c(),k(h,G),R(h,"bx--text-input",!0),R(h,"bx--text-input--light",t[4]),R(h,"bx--text-input--invalid",t[11]),R(h,"bx--text-input--warn",t[13]),A(a,"data-invalid",S=t[11]||void 0),A(a,"data-warn",E=t[13]||void 0),R(a,"bx--text-input__field-wrapper",!0),R(a,"bx--text-input__field-wrapper--warning",!t[11]&&t[13]),R(o,"bx--text-input__field-outer-wrapper",!0),R(o,"bx--text-input__field-outer-wrapper--inline",t[16]),R(e,"bx--form-item",!0),R(e,"bx--text-input-wrapper",!0),R(e,"bx--text-input-wrapper--inline",t[16]),R(e,"bx--text-input-wrapper--light",t[4]),R(e,"bx--text-input-wrapper--readonly",t[17])},m(n,s){v(n,e,s),N&&N.m(e,null),_(e,i),B&&B.m(e,null),_(e,r),_(e,o),_(o,a),j&&j.m(a,null),_(a,l),$&&$.m(a,null),_(a,c),U&&U.m(a,null),_(a,u),_(a,h),h.autofocus&&h.focus(),t[35](h),z(h,t[0]),_(a,y),q&&q.m(a,null),_(a,b),Z&&Z.m(a,null),_(a,T),W&&W.m(a,null),_(o,M),H&&H.m(o,null),_(o,P),X&&X.m(o,null),_(o,L),Y&&Y.m(o,null),D=!0,O||(F=[I(h,"input",t[36]),I(h,"change",t[22]),I(h,"input",t[21]),I(h,"keydown",t[31]),I(h,"keyup",t[32]),I(h,"focus",t[33]),I(h,"blur",t[34]),I(e,"click",t[27]),I(e,"mouseover",t[28]),I(e,"mouseenter",t[29]),I(e,"mouseleave",t[30])],O=!0)},p(t,n){t[16]?N?(N.p(t,n),65536&n[0]&&at(N,1)):(N=_c(t),N.c(),at(N,1),N.m(e,i)):N&&(ot(),lt(N,1,1,(()=>{N=null})),st()),t[16]||!t[9]&&!t[24].labelText?B&&(ot(),lt(B,1,1,(()=>{B=null})),st()):B?(B.p(t,n),16843264&n[0]&&at(B,1)):(B=bc(t),B.c(),at(B,1),B.m(e,r)),t[11]?j?2048&n[0]&&at(j,1):(j=wc(),j.c(),at(j,1),j.m(a,l)):j&&(ot(),lt(j,1,1,(()=>{j=null})),st()),!t[11]&&t[13]?$?10240&n[0]&&at($,1):($=Tc(),$.c(),at($,1),$.m(a,c)):$&&(ot(),lt($,1,1,(()=>{$=null})),st()),t[17]?U?131072&n[0]&&at(U,1):(U=Sc(),U.c(),at(U,1),U.m(a,u)):U&&(ot(),lt(U,1,1,(()=>{U=null})),st()),k(h,G=pt(V,[(!D||2048&n[0]&&p!==(p=t[11]||void 0))&&{"data-invalid":p},(!D||2048&n[0]&&d!==(d=t[11]||void 0))&&{"aria-invalid":d},(!D||8192&n[0]&&f!==(f=t[13]||void 0))&&{"data-warn":f},(!D||796672&n[0]&&m!==(m=t[11]?t[19]:t[13]?t[18]:void 0))&&{"aria-describedby":m},(!D||32&n[0])&&{disabled:t[5]},(!D||128&n[0])&&{id:t[7]},(!D||256&n[0])&&{name:t[8]},(!D||8&n[0])&&{placeholder:t[3]},(!D||32768&n[0])&&{required:t[15]},(!D||131072&n[0])&&{readOnly:t[17]},8388608&n[0]&&t[23],(!D||4&n[0]&&g!==(g=t[2]&&`bx--text-input--${t[2]}`))&&{class:g}])),1&n[0]&&h.value!==t[0]&&z(h,t[0]),R(h,"bx--text-input",!0),R(h,"bx--text-input--light",t[4]),R(h,"bx--text-input--invalid",t[11]),R(h,"bx--text-input--warn",t[13]),t[20]?q||(q=Cc(),q.c(),q.m(a,b)):q&&(q.d(1),q=null),t[20]&&!t[16]&&t[11]?Z?Z.p(t,n):(Z=Ec(t),Z.c(),Z.m(a,T)):Z&&(Z.d(1),Z=null),t[20]&&!t[16]&&t[13]?W?W.p(t,n):(W=Ic(t),W.c(),W.m(a,null)):W&&(W.d(1),W=null),(!D||2048&n[0]&&S!==(S=t[11]||void 0))&&A(a,"data-invalid",S),(!D||8192&n[0]&&E!==(E=t[13]||void 0))&&A(a,"data-warn",E),10240&n[0]&&R(a,"bx--text-input__field-wrapper--warning",!t[11]&&t[13]),t[11]||t[13]||t[20]||t[16]||!t[6]?H&&(H.d(1),H=null):H?H.p(t,n):(H=Mc(t),H.c(),H.m(o,P)),!t[20]&&t[11]?X?X.p(t,n):(X=Ac(t),X.c(),X.m(o,L)):X&&(X.d(1),X=null),t[20]||t[11]||!t[13]?Y&&(Y.d(1),Y=null):Y?Y.p(t,n):(Y=kc(t),Y.c(),Y.m(o,null)),65536&n[0]&&R(o,"bx--text-input__field-outer-wrapper--inline",t[16]),65536&n[0]&&R(e,"bx--text-input-wrapper--inline",t[16]),16&n[0]&&R(e,"bx--text-input-wrapper--light",t[4]),131072&n[0]&&R(e,"bx--text-input-wrapper--readonly",t[17])},i(t){D||(at(N),at(B),at(j),at($),at(U),D=!0)},o(t){lt(N),lt(B),lt(j),lt($),lt(U),D=!1},d(i){i&&x(e),N&&N.d(),B&&B.d(),j&&j.d(),$&&$.d(),U&&U.d(),t[35](null),q&&q.d(),Z&&Z.d(),W&&W.d(),H&&H.d(),X&&X.d(),Y&&Y.d(),O=!1,s(F)}}}function Lc(t,e,i){let r,o,s;const a=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let l=m(e,a),{$$slots:c={},$$scope:u}=e;const h=g(c);let{size:p}=e,{value:d=""}=e,{placeholder:y=""}=e,{light:_=!1}=e,{disabled:v=!1}=e,{helperText:x=""}=e,{id:b="ccs-"+Math.random().toString(36)}=e,{name:w}=e,{labelText:T=""}=e,{hideLabel:S=!1}=e,{invalid:C=!1}=e,{invalidText:E=""}=e,{warn:I=!1}=e,{warnText:M=""}=e,{ref:A=null}=e,{required:k=!1}=e,{inline:P=!1}=e,{readonly:L=!1}=e;const z=$("Form"),D=j();function R(t){return"number"!==l.type?t:""!=t?Number(t):null}return t.$$set=t=>{e=n(n({},e),f(t)),i(23,l=m(e,a)),"size"in t&&i(2,p=t.size),"value"in t&&i(0,d=t.value),"placeholder"in t&&i(3,y=t.placeholder),"light"in t&&i(4,_=t.light),"disabled"in t&&i(5,v=t.disabled),"helperText"in t&&i(6,x=t.helperText),"id"in t&&i(7,b=t.id),"name"in t&&i(8,w=t.name),"labelText"in t&&i(9,T=t.labelText),"hideLabel"in t&&i(10,S=t.hideLabel),"invalid"in t&&i(11,C=t.invalid),"invalidText"in t&&i(12,E=t.invalidText),"warn"in t&&i(13,I=t.warn),"warnText"in t&&i(14,M=t.warnText),"ref"in t&&i(1,A=t.ref),"required"in t&&i(15,k=t.required),"inline"in t&&i(16,P=t.inline),"readonly"in t&&i(17,L=t.readonly),"$$scope"in t&&i(25,u=t.$$scope)},t.$$.update=()=>{128&t.$$.dirty[0]&&i(19,o=`error-${b}`),128&t.$$.dirty[0]&&i(18,s=`warn-${b}`)},i(20,r=!!z&&z.isFluid),[d,A,p,y,_,v,x,b,w,T,S,C,E,I,M,k,P,L,s,o,r,t=>{i(0,d=R(t.target.value)),D("input",d)},t=>{D("change",R(t.target.value))},l,h,u,c,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(t){G[t?"unshift":"push"]((()=>{A=t,i(1,A)}))},function(){d=this.value,i(0,d)}]}var zc=class extends vt{constructor(t){super(),_t(this,t,Lc,Pc,l,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}};const Dc=t=>({}),Rc=t=>({}),Oc=t=>({}),Fc=t=>({}),Nc=t=>({}),Bc=t=>({});function jc(t){let e,i,r,o,a,l,u,f,m,g,y,b,T;const E=t[11].labelText,M=c(E,t,t[10],Bc),P=M||function(t){let e;return{c(){e=S(t[5])},m(t,i){v(t,e,i)},p(t,i){32&i&&L(e,t[5])},d(t){t&&x(e)}}}(t),z=t[11].labelA,D=c(z,t,t[10],Fc),O=D||function(t){let e;return{c(){e=S(t[3])},m(t,i){v(t,e,i)},p(t,i){8&i&&L(e,t[3])},d(t){t&&x(e)}}}(t),F=t[11].labelB,N=c(F,t,t[10],Rc),B=N||function(t){let e;return{c(){e=S(t[4])},m(t,i){v(t,e,i)},p(t,i){16&i&&L(e,t[4])},d(t){t&&x(e)}}}(t);let j=[t[8]],$={};for(let t=0;t<j.length;t+=1)$=n($,j[t]);return{c(){e=w("div"),i=w("input"),r=C(),o=w("label"),P&&P.c(),a=C(),l=w("span"),u=w("span"),O&&O.c(),f=C(),m=w("span"),B&&B.c(),A(i,"type","checkbox"),i.checked=t[0],i.disabled=t[2],A(i,"id",t[6]),A(i,"name",t[7]),R(i,"bx--toggle-input",!0),R(i,"bx--toggle-input--small","sm"===t[1]),A(u,"aria-hidden","true"),R(u,"bx--toggle__text--off",!0),A(m,"aria-hidden","true"),R(m,"bx--toggle__text--on",!0),R(l,"bx--toggle__switch",!0),A(o,"aria-label",g=t[5]?void 0:t[9]["aria-label"]||"Toggle"),A(o,"for",t[6]),R(o,"bx--toggle-input__label",!0),k(e,$),R(e,"bx--form-item",!0)},m(n,s){v(n,e,s),_(e,i),_(e,r),_(e,o),P&&P.m(o,null),_(o,a),_(o,l),_(l,u),O&&O.m(u,null),_(l,f),_(l,m),B&&B.m(m,null),y=!0,b||(T=[I(i,"change",t[16]),I(i,"change",t[20]),I(i,"keyup",t[17]),I(i,"keyup",t[21]),I(i,"focus",t[18]),I(i,"blur",t[19]),I(e,"click",t[12]),I(e,"mouseover",t[13]),I(e,"mouseenter",t[14]),I(e,"mouseleave",t[15])],b=!0)},p(t,[n]){(!y||1&n)&&(i.checked=t[0]),(!y||4&n)&&(i.disabled=t[2]),(!y||64&n)&&A(i,"id",t[6]),(!y||128&n)&&A(i,"name",t[7]),2&n&&R(i,"bx--toggle-input--small","sm"===t[1]),M?M.p&&(!y||1024&n)&&p(M,E,t,t[10],y?h(E,t[10],n,Nc):d(t[10]),Bc):P&&P.p&&(!y||32&n)&&P.p(t,y?n:-1),D?D.p&&(!y||1024&n)&&p(D,z,t,t[10],y?h(z,t[10],n,Oc):d(t[10]),Fc):O&&O.p&&(!y||8&n)&&O.p(t,y?n:-1),N?N.p&&(!y||1024&n)&&p(N,F,t,t[10],y?h(F,t[10],n,Dc):d(t[10]),Rc):B&&B.p&&(!y||16&n)&&B.p(t,y?n:-1),(!y||544&n&&g!==(g=t[5]?void 0:t[9]["aria-label"]||"Toggle"))&&A(o,"aria-label",g),(!y||64&n)&&A(o,"for",t[6]),k(e,$=pt(j,[256&n&&t[8]])),R(e,"bx--form-item",!0)},i(t){y||(at(P,t),at(O,t),at(B,t),y=!0)},o(t){lt(P,t),lt(O,t),lt(B,t),y=!1},d(t){t&&x(e),P&&P.d(t),O&&O.d(t),B&&B.d(t),b=!1,s(T)}}}function $c(t,e,i){const r=["size","toggled","disabled","labelA","labelB","labelText","id","name"];let o=m(e,r),{$$slots:s={},$$scope:a}=e,{size:l="default"}=e,{toggled:c=!1}=e,{disabled:u=!1}=e,{labelA:h="Off"}=e,{labelB:p="On"}=e,{labelText:d=""}=e,{id:g="ccs-"+Math.random().toString(36)}=e,{name:y}=e;const _=j();return t.$$set=t=>{i(9,e=n(n({},e),f(t))),i(8,o=m(e,r)),"size"in t&&i(1,l=t.size),"toggled"in t&&i(0,c=t.toggled),"disabled"in t&&i(2,u=t.disabled),"labelA"in t&&i(3,h=t.labelA),"labelB"in t&&i(4,p=t.labelB),"labelText"in t&&i(5,d=t.labelText),"id"in t&&i(6,g=t.id),"name"in t&&i(7,y=t.name),"$$scope"in t&&i(10,a=t.$$scope)},t.$$.update=()=>{1&t.$$.dirty&&_("toggle",{toggled:c})},e=f(e),[c,l,u,h,p,d,g,y,o,e,a,s,function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},function(e){U.call(this,t,e)},()=>{i(0,c=!c)},t=>{" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),i(0,c=!c))}]}var Uc=class extends vt{constructor(t){super(),_t(this,t,$c,jc,l,{size:1,toggled:0,disabled:2,labelA:3,labelB:4,labelText:5,id:6,name:7})}},Vc={prefix:"fas",iconName:"check",icon:[448,512,[10004,10003],"f00c","M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"]},Gc={prefix:"fas",iconName:"pencil",icon:[512,512,[61504,9999,"pencil-alt"],"f303","M421.7 220.3L188.5 453.4L154.6 419.5L158.1 416H112C103.2 416 96 408.8 96 400V353.9L92.51 357.4C87.78 362.2 84.31 368 82.42 374.4L59.44 452.6L137.6 429.6C143.1 427.7 149.8 424.2 154.6 419.5L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3zM492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75z"]},qc={prefix:"fas",iconName:"plus",icon:[448,512,[10133,61543,"add"],"2b","M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"]},Zc={prefix:"fas",iconName:"trash",icon:[448,512,[],"f1f8","M135.2 17.69C140.6 6.848 151.7 0 163.8 0H284.2C296.3 0 307.4 6.848 312.8 17.69L320 32H416C433.7 32 448 46.33 448 64C448 81.67 433.7 96 416 96H32C14.33 96 0 81.67 0 64C0 46.33 14.33 32 32 32H128L135.2 17.69zM394.8 466.1C393.2 492.3 372.3 512 346.9 512H101.1C75.75 512 54.77 492.3 53.19 466.1L31.1 128H416L394.8 466.1z"]},Wc={prefix:"fas",iconName:"xmark",icon:[320,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"]};
/*!
 * Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2022 Fonticons, Inc.
 */const Hc=parseFloat;function Xc(t,e=";"){let i;if(Array.isArray(t))i=t.filter((t=>t));else{i=[];for(const e in t)t[e]&&i.push(`${e}:${t[e]}`)}return i.join(e)}function Yc(t){let e,i,n,r,o,s,a;function l(t,e){return"string"==typeof t[7][4]?Jc:Kc}let c=l(t),u=c(t);return{c(){e=T("svg"),i=T("g"),n=T("g"),u.c(),A(n,"transform",t[10]),A(i,"transform",r=`translate(${t[7][0]/2} ${t[7][1]/2})`),A(i,"transform-origin",o=t[7][0]/4+" 0"),A(e,"id",t[0]),A(e,"class",s=y(t[8])+" svelte-1cj2gr0"),A(e,"style",t[9]),A(e,"viewBox",a=`0 0 ${t[7][0]} ${t[7][1]}`),A(e,"aria-hidden","true"),A(e,"role","img"),A(e,"xmlns","http://www.w3.org/2000/svg")},m(t,r){v(t,e,r),_(e,i),_(i,n),u.m(n,null)},p(t,h){c===(c=l(t))&&u?u.p(t,h):(u.d(1),u=c(t),u&&(u.c(),u.m(n,null))),1024&h&&A(n,"transform",t[10]),128&h&&r!==(r=`translate(${t[7][0]/2} ${t[7][1]/2})`)&&A(i,"transform",r),128&h&&o!==(o=t[7][0]/4+" 0")&&A(i,"transform-origin",o),1&h&&A(e,"id",t[0]),256&h&&s!==(s=y(t[8])+" svelte-1cj2gr0")&&A(e,"class",s),512&h&&A(e,"style",t[9]),128&h&&a!==(a=`0 0 ${t[7][0]} ${t[7][1]}`)&&A(e,"viewBox",a)},d(t){t&&x(e),u.d()}}}function Kc(t){let e,i,n,r,o,s,a,l,c,u;return{c(){e=T("path"),s=T("path"),A(e,"d",i=t[7][4][0]),A(e,"fill",n=t[3]||t[1]||"currentColor"),A(e,"fill-opacity",r=0!=t[6]?t[4]:t[5]),A(e,"transform",o=`translate(${t[7][0]/-2} ${t[7][1]/-2})`),A(s,"d",a=t[7][4][1]),A(s,"fill",l=t[2]||t[1]||"currentColor"),A(s,"fill-opacity",c=0!=t[6]?t[5]:t[4]),A(s,"transform",u=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)},m(t,i){v(t,e,i),v(t,s,i)},p(t,h){128&h&&i!==(i=t[7][4][0])&&A(e,"d",i),10&h&&n!==(n=t[3]||t[1]||"currentColor")&&A(e,"fill",n),112&h&&r!==(r=0!=t[6]?t[4]:t[5])&&A(e,"fill-opacity",r),128&h&&o!==(o=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&A(e,"transform",o),128&h&&a!==(a=t[7][4][1])&&A(s,"d",a),6&h&&l!==(l=t[2]||t[1]||"currentColor")&&A(s,"fill",l),112&h&&c!==(c=0!=t[6]?t[5]:t[4])&&A(s,"fill-opacity",c),128&h&&u!==(u=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&A(s,"transform",u)},d(t){t&&x(e),t&&x(s)}}}function Jc(t){let e,i,n,r;return{c(){e=T("path"),A(e,"d",i=t[7][4]),A(e,"fill",n=t[1]||t[2]||"currentColor"),A(e,"transform",r=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)},m(t,i){v(t,e,i)},p(t,o){128&o&&i!==(i=t[7][4])&&A(e,"d",i),6&o&&n!==(n=t[1]||t[2]||"currentColor")&&A(e,"fill",n),128&o&&r!==(r=`translate(${t[7][0]/-2} ${t[7][1]/-2})`)&&A(e,"transform",r)},d(t){t&&x(e)}}}function Qc(t){let e,n=t[7][4]&&Yc(t);return{c(){n&&n.c(),e=E()},m(t,i){n&&n.m(t,i),v(t,e,i)},p(t,[i]){t[7][4]?n?n.p(t,i):(n=Yc(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:i,o:i,d(t){n&&n.d(t),t&&x(e)}}}function tu(t,e,i){let n,r,o,s,{class:a=""}=e,{id:l=""}=e,{style:c=""}=e,{icon:u}=e,{size:h=""}=e,{color:p=""}=e,{fw:d=!1}=e,{pull:f=""}=e,{scale:m=1}=e,{translateX:g=0}=e,{translateY:y=0}=e,{rotate:_=""}=e,{flip:v=!1}=e,{spin:x=!1}=e,{pulse:b=!1}=e,{primaryColor:w=""}=e,{secondaryColor:T=""}=e,{primaryOpacity:S=1}=e,{secondaryOpacity:C=.4}=e,{swapOpacity:E=!1}=e;return t.$$set=t=>{"class"in t&&i(11,a=t.class),"id"in t&&i(0,l=t.id),"style"in t&&i(12,c=t.style),"icon"in t&&i(13,u=t.icon),"size"in t&&i(14,h=t.size),"color"in t&&i(1,p=t.color),"fw"in t&&i(15,d=t.fw),"pull"in t&&i(16,f=t.pull),"scale"in t&&i(17,m=t.scale),"translateX"in t&&i(18,g=t.translateX),"translateY"in t&&i(19,y=t.translateY),"rotate"in t&&i(20,_=t.rotate),"flip"in t&&i(21,v=t.flip),"spin"in t&&i(22,x=t.spin),"pulse"in t&&i(23,b=t.pulse),"primaryColor"in t&&i(2,w=t.primaryColor),"secondaryColor"in t&&i(3,T=t.secondaryColor),"primaryOpacity"in t&&i(4,S=t.primaryOpacity),"secondaryOpacity"in t&&i(5,C=t.secondaryOpacity),"swapOpacity"in t&&i(6,E=t.swapOpacity)},t.$$.update=()=>{8192&t.$$.dirty&&i(7,n=u&&u.icon||[0,0,"",[],""]),12584960&t.$$.dirty&&i(8,r=Xc([a,"svelte-fa",x&&"spin",b&&"pulse"]," ")),118784&t.$$.dirty&&i(9,o=function(t,e,i,n){let r,o,s,a,l,c="-.125em";return n&&(l="center",o="1.25em"),i&&(r=i),e&&("lg"==e?(a="1.33333em",s=".75em",c="-.225em"):a="xs"==e?".75em":"sm"==e?".875em":e.replace("x","em")),Xc([Xc({float:r,width:o,height:"1em","line-height":s,"font-size":a,"text-align":l,"vertical-align":c,"transform-origin":"center",overflow:"visible"}),t])}(c,h,f,d)),4063232&t.$$.dirty&&i(10,s=function(t,e,i,n,r,o,s="",a=""){let l=1,c=1;return r&&("horizontal"==r?l=-1:"vertical"==r?c=-1:l=c=-1),Xc([`translate(${Hc(e)*o}${s},${Hc(i)*o}${s})`,`scale(${l*Hc(t)},${c*Hc(t)})`,n&&`rotate(${n}${a})`]," ")}(m,g,y,_,v,512))},[l,p,w,T,S,C,E,n,r,o,s,a,c,u,h,d,f,m,g,y,_,v,x,b]}var eu=class extends vt{constructor(t){super(),_t(this,t,tu,Qc,l,{class:11,id:0,style:12,icon:13,size:14,color:1,fw:15,pull:16,scale:17,translateX:18,translateY:19,rotate:20,flip:21,spin:22,pulse:23,primaryColor:2,secondaryColor:3,primaryOpacity:4,secondaryOpacity:5,swapOpacity:6})}},iu={exports:{}},nu=iu.exports=function(){function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){if(!a&&wt)return wt(s);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};e[s][0].call(c.exports,(function(t){return r(e[s][1][t]||t)}),c,c.exports,t,e,i,n)}return i[s].exports}for(var o=wt,s=0;s<n.length;s++)r(n[s]);return r}return t}()({1:[function(t,e,i){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var o=t("nanoid").nanoid;r.prototype={select:function(t,e){var i=this.getSelectedIndex(t,e),n=this.getEventPayload("search.select",e);if(n.resultIndex=i,n.resultPlaceName=t.place_name,n.resultId=t.id,(i!==this.lastSentIndex||n.queryString!==this.lastSentInput)&&-1!=i&&(this.lastSentIndex=i,this.lastSentInput=n.queryString,n.queryString))return this.push(n)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!t.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(t.keyCode)){var i=this.getEventPayload("search.keystroke",e);if(i.lastAction=t.key,i.queryString)return this.push(i)}},send:function(t,e){if(this.enableEventLogging){var i=this.getRequestOptions(t);this.request(i,function(t){return t?this.handleError(t,e):e?e():void 0}.bind(this))}else if(e)return e()},getRequestOptions:function(t){return Array.isArray(t)||(t=[t]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}},getEventPayload:function(t,e){var i;i=e.options.proximity?"object"===n(e.options.proximity)?[e.options.proximity.longitude,e.options.proximity.latitude]:"ip"===e.options.proximity?[999,999]:e.options.proximity:null;var r=e._map?e._map.getZoom():void 0,o={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:i,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:r,keyboardLocale:this.locale};return"search.select"===t?o.queryString=e.inputString:"search.select"!=t&&e._inputEl?o.queryString=e._inputEl.value:o.queryString=e.inputString,o},request:function(t,e){var i=new XMLHttpRequest;for(var n in i.onreadystatechange=function(){if(4==this.readyState)return e(204==this.status?null:this.statusText)},i.open(t.method,t.host+"/"+t.path,!0),t.headers){var r=t.headers[n];i.setRequestHeader(n,r)}i.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return o()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var i=e._typeahead.data,n=t.id;return i.map((function(t){return t.id})).indexOf(n)}},shouldEnableLogging:function(t){return!(!1===t.enableEventLogging||t.origin&&"https://api.mapbox.com"!==t.origin||t.localGeocoder||t.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}},e.exports=r},{nanoid:32}],2:[function(t,e,i){e.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(t,e,i){function n(){}n.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){var t={enableHighAccuracy:!0};return new Promise((function(e,i){window.navigator.geolocation.getCurrentPosition(e,i,t)}))}},e.exports=n},{}],4:[function(t,e,i){function n(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function r(t){this._eventEmitter=new l,this.options=a({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new m}var o=t("suggestions"),s=t("lodash.debounce"),a=t("xtend"),l=t("events").EventEmitter,c=t("./exceptions"),u=t("@mapbox/mapbox-sdk"),h=t("@mapbox/mapbox-sdk/services/geocoding"),p=t("./events"),d=t("./localization"),f=t("subtag"),m=t("./geolocation"),g=t("./utils"),y={FORWARD:0,LOCAL:1,REVERSE:2};r.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(t,e){if(!document.body.contains(e))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var i=t.onAdd();e.appendChild(i)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else{if("string"!=typeof t)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");var i=document.querySelectorAll(t);if(0===i.length)throw new Error("Element ",t,"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,i[0])}},onAdd:function(t){if(t&&"string"!=typeof t&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new p(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(t){this.eventManager.keyevent(t,this)}.bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(i),e.appendChild(this._inputEl),e.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var l=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(l),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var c=this._typeahead=new o(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),c.getItemValue=this.options.getItemValue;var d=c.list.draw,f=this._footerNode=n();return c.list.draw=function(){d.call(this),f.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),f.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(f)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(t){this._hideLoadingIcon();var e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;var i={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){var n=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(i).send().then(function(t){var i=t.body.features[0];if(i){var n=g.transformFeatureToGeolocationText(i,this.options.addressAccuracy);this._setInputValue(n),i.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:i})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(t){1===t.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=e,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){if(27===t.keyCode&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var e=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target;if(!e||!e.value)return this.fresh=!0,9!==t.keyCode&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),t.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(t.keyCode)||e.value.length>=this.options.minLength&&this._geocode(e.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&c[t.properties.short_code])e=a({},this.options.flyTo),this._map&&this._map.fitBounds(c[t.properties.short_code].bbox,e);else if(t.bbox){var i=t.bbox;e=a({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],e)}else{var n={zoom:this.options.zoom};e=a({},n,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&"Point"===t.geometry.type&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){return t.localGeocoderOnly?y.LOCAL:t.reverseGeocode&&g.REVERSE_GEOCODE_COORD_RGX.test(e)?y.REVERSE:y.FORWARD},_setupConfig:function(t,e){var i=/[\s,]+/,n=this,r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce((function(t,e){if(void 0===n.options[e]||null===n.options[e])return t;["countries","types","language"].indexOf(e)>-1?t[e]=n.options[e].split(i):t[e]=n.options[e];var r="number"==typeof n.options[e].longitude&&"number"==typeof n.options[e].latitude;if("proximity"===e&&r){var o=n.options[e].longitude,s=n.options[e].latitude;t[e]=[o,s]}return t}),{});switch(t){case y.REVERSE:var o=e.split(i).map((function(t){return parseFloat(t,10)}));n.options.flipCoordinates||o.reverse(),r.types&&r.types[0],r=a(r,{query:o,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach((function(t){t in r&&delete r[t]}));break;case y.FORWARD:/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(e.trim())&&(e=e.replace(/,/g," ")),r=a(r,{query:e})}return r},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});var e,i=this._requestType(this.options,t),n=this._setupConfig(i,t);switch(i){case y.LOCAL:e=Promise.resolve();break;case y.FORWARD:e=this.geocoderService.forwardGeocode(n).send();break;case y.REVERSE:e=this.geocoderService.reverseGeocode(n).send()}var r=this.options.localGeocoder&&this.options.localGeocoder(t)||[],o=[],s=null;return e.catch(function(t){s=t}.bind(this)).then(function(e){this._hideLoadingIcon();var i={};return e?"200"==e.statusCode&&((i=e.body).request=e.request,i.headers=e.headers):i={type:"FeatureCollection",features:[]},i.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),i.features=i.features?r.concat(i.features):r,this.options.externalGeocoder?(o=this.options.externalGeocoder(t,i.features)||Promise.resolve([])).then((function(t){return i.features=i.features?t.concat(i.features):t,i}),(function(){return i})):i}.bind(this)).then(function(t){if(s)throw s;this.options.filter&&t.features.length&&(t.features=t.features.filter(this.options.filter)),t.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",t),this._typeahead.update(t.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",t))}.bind(this)).catch(function(t){this._hideLoadingIcon(),this._hideAttribution(),r.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(r)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:r}),this._eventEmitter.emit("error",{error:t})}.bind(this)),e},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var i=e.features[0];this._typeahead.selected=i,this._inputEl.value=i.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=f.language(t),i=d.placeholder[e];if(i)return i}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&"function"==typeof t&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e=a({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(e),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&"Point"===t.geometry.type&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}},e.exports=r},{"./events":1,"./exceptions":2,"./geolocation":3,"./localization":5,"./utils":6,"@mapbox/mapbox-sdk":8,"@mapbox/mapbox-sdk/services/geocoding":19,events:28,"lodash.debounce":31,subtag:35,suggestions:36,xtend:39}],5:[function(t,e,i){var n={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"};e.exports={placeholder:n}},{}],6:[function(t,e,i){function n(t,e){var i=r(t),n=["address","street","place","country"];if("function"==typeof e)return e(i);var o=n.indexOf(e);return(-1===o?n:n.slice(o)).reduce((function(t,e){return i[e]?(""!==t&&(t+=", "),t+i[e]):t}),"")}function r(t){var e=t.address||"",i=t.text||"",n=t.place_name||"",r={address:n.split(",")[0],houseNumber:e,street:i,placeName:n};return t.context.forEach((function(t){var e=t.id.split(".")[0];r[e]=t.text})),r}var o=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;e.exports={transformFeatureToGeolocationText:n,getAddressInfo:r,REVERSE_GEOCODE_COORD_RGX:o}},{}],7:[function(t,e,i){function n(t){var e=Array.isArray(t),i=function(i){return e?t[i]:t};return function(n){var o=r(m.plainArray,n);if(o)return o;if(e&&n.length!==t.length)return"an array with "+t.length+" items";for(var s=0;s<n.length;s++)if(o=r(i(s),n[s]))return[s].concat(o)}}function r(t,e){if(null!=e||t.hasOwnProperty("__required")){var i=t(e);return i?Array.isArray(i)?i:[i]:void 0}}function o(t,e){var i=t.length,n=t[i-1],r=t.slice(0,i-1);return 0===r.length&&(r=[f]),e=d(e,{path:r}),"function"==typeof n?n(e):c(e,a(n))}function s(t){return t.length<2?t[0]:2===t.length?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function a(t){return"must be "+l(t)+"."}function l(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function c(t,e){return(u(t.path)?"Item at position ":"")+t.path.join(".")+" "+e}function u(t){return"number"==typeof t[t.length-1]||"number"==typeof t[0]}function h(t){return Object.keys(t||{}).map((function(e){return{key:e,value:t[e]}}))}var p=t("is-plain-obj"),d=t("xtend"),f="value",m={assert:function(t,e){return e=e||{},function(i){var n=r(t,i);if(n){var s=o(n,e);throw e.apiName&&(s=e.apiName+": "+s),new Error(s)}}},shape:function(t){var e=h(t);return function(t){var i=r(m.plainObject,t);if(i)return i;for(var n,s=[],a=0;a<e.length;a++)n=e[a].key,(i=r(e[a].value,t[n]))&&s.push([n].concat(i));return s.length<2?s[0]:function(t){s=s.map((function(e){return"- "+e[0]+": "+o(e,t).split("\n").join("\n  ")}));var e=t.path.join(".");return"The following properties"+(e===f?"":" of "+e)+" have invalid values:\n  "+s.join("\n  ")}}},strictShape:function(t){var e=m.shape(t);return function(i){var n=e(i);if(n)return n;var r=Object.keys(i).reduce((function(e,i){return void 0===t[i]&&e.push(i),e}),[]);return 0!==r.length?function(){return"The following keys are invalid: "+r.join(", ")}:void 0}},arrayOf:function(t){return n(t)},tuple:function(){return n(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},required:function(t){function e(e){return null==e?function(t){return c(t,u(t.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return e.__required=!0,e},oneOfType:function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(e){var i=t.map((function(t){return r(t,e)})).filter(Boolean);if(i.length===t.length)return i.every((function(t){return 1===t.length&&"string"==typeof t[0]}))?s(i.map((function(t){return t[0]}))):i.reduce((function(t,e){return e.length>t.length?e:t}))}},equal:function(t){return function(e){if(e!==t)return JSON.stringify(t)}},oneOf:function(){var t=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map((function(t){return m.equal(t)}));return m.oneOfType.apply(this,t)},range:function(t){var e=t[0],i=t[1];return function(t){if(r(m.number,t)||t<e||t>i)return"number between "+e+" & "+i+" (inclusive)"}},any:function(){},boolean:function(t){if("boolean"!=typeof t)return"boolean"},number:function(t){if("number"!=typeof t)return"number"},plainArray:function(t){if(!Array.isArray(t))return"array"},plainObject:function(t){if(!p(t))return"object"},string:function(t){if("string"!=typeof t)return"string"},func:function(t){if("function"!=typeof t)return"function"}};m.validate=r,m.processMessage=o,e.exports=m},{"is-plain-obj":30,xtend:39}],8:[function(t,e,i){var n=t("./lib/client");e.exports=n},{"./lib/client":9}],9:[function(t,e,i){function n(t){s.call(this,t)}function r(t){return new n(t)}var o=t("./browser-layer"),s=t("../classes/mapi-client");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.sendRequest=o.browserSend,n.prototype.abortRequest=o.browserAbort,e.exports=r},{"../classes/mapi-client":11,"./browser-layer":10}],10:[function(t,e,i){function n(t){var e=d[t.id];e&&(e.abort(),delete d[t.id])}function r(t,e){return new c(t,{body:e.response,headers:p(e.getAllResponseHeaders()),statusCode:e.status})}function o(t){var e=t.total,i=t.loaded;return{total:e,transferred:i,percent:100*i/e}}function s(t,e){return new Promise((function(i,n){e.onprogress=function(e){t.emitter.emit(h.EVENT_PROGRESS_DOWNLOAD,o(e))};var r=t.file;r&&(e.upload.onprogress=function(e){t.emitter.emit(h.EVENT_PROGRESS_UPLOAD,o(e))}),e.onerror=function(t){n(t)},e.onabort=function(){var e=new u({request:t,type:h.ERROR_REQUEST_ABORTED});n(e)},e.onload=function(){if(delete d[t.id],e.status<200||e.status>=400){var r=new u({request:t,body:e.response,statusCode:e.status});n(r)}else i(e)};var s=t.body;"string"==typeof s?e.send(s):s?e.send(JSON.stringify(s)):r?e.send(r):e.send(),d[t.id]=e})).then((function(e){return r(t,e)}))}function a(t,e){var i=t.url(e),n=new window.XMLHttpRequest;return n.open(t.method,i),Object.keys(t.headers).forEach((function(e){n.setRequestHeader(e,t.headers[e])})),n}function l(t){return Promise.resolve().then((function(){var e=a(t,t.client.accessToken);return s(t,e)}))}var c=t("../classes/mapi-response"),u=t("../classes/mapi-error"),h=t("../constants"),p=t("../helpers/parse-headers"),d={};e.exports={browserAbort:n,sendRequestXhr:s,browserSend:l,createRequestXhr:a}},{"../classes/mapi-error":12,"../classes/mapi-response":14,"../constants":15,"../helpers/parse-headers":16}],11:[function(t,e,i){function n(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");r(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||s.API_ORIGIN}var r=t("@mapbox/parse-mapbox-token"),o=t("./mapi-request"),s=t("../constants");n.prototype.createRequest=function(t){return new o(this,t)},e.exports=n},{"../constants":15,"./mapi-request":13,"@mapbox/parse-mapbox-token":25}],12:[function(t,e,i){function n(t){var e,i=t.type||r.ERROR_HTTP;if(t.body)try{e=JSON.parse(t.body)}catch(i){e=t.body}else e=null;var n=t.message||null;n||("string"==typeof e?n=e:e&&"string"==typeof e.message?n=e.message:i===r.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=i,this.statusCode=t.statusCode||null,this.request=t.request,this.body=e}var r=t("../constants");e.exports=n},{"../constants":15}],13:[function(t,e,i){function n(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={};e.body&&(i["content-type"]="application/json");var n=o(i,e.headers),r=Object.keys(n).reduce((function(t,e){return t[e.toLowerCase()]=n[e],t}),{});this.id=c++,this._options=e,this.emitter=new s,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=r}var r=t("@mapbox/parse-mapbox-token"),o=t("xtend"),s=t("eventemitter3"),a=t("../helpers/url-utils"),l=t("../constants"),c=1;n.prototype.url=function(t){var e=a.prependOrigin(this.path,this.origin);e=a.appendQueryObject(e,this.query);var i=this.params,n=null==t?this.client.accessToken:t;if(n){e=a.appendQueryParam(e,"access_token",n);var s=r(n).user;i=o({ownerId:s},i)}return e=a.interpolateRouteParams(e,i)},n.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then((function(e){return t.response=e,t.emitter.emit(l.EVENT_RESPONSE,e),e}),(function(e){throw t.error=e,t.emitter.emit(l.EVENT_ERROR,e),e}))},n.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},n.prototype.eachPage=function(t){function e(e){function i(){delete r._nextPageRequest;var t=e.nextPage();t&&(r._nextPageRequest=t,n(t))}t(null,e,i)}function i(e){t(e,null,(function(){}))}function n(t){t.send().then(e,i)}var r=this;n(this)},n.prototype.clone=function(){return this._extend()},n.prototype._extend=function(t){var e=o(this._options,t);return new n(this.client,e)},e.exports=n},{"../constants":15,"../helpers/url-utils":18,"@mapbox/parse-mapbox-token":25,eventemitter3:27,xtend:39}],14:[function(t,e,i){function n(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch(t){this.body=e.body}this.links=r(this.headers.link)}var r=t("../helpers/parse-link-header");n.prototype.hasNextPage=function(){return!!this.links.next},n.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},e.exports=n},{"../helpers/parse-link-header":17}],15:[function(t,e,i){e.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],16:[function(t,e,i){function n(t){var e=t.indexOf(":");return{name:t.substring(0,e).trim().toLowerCase(),value:t.substring(e+1).trim()}}function r(t){var e={};return t?(t.trim().split(/[\r|\n]+/).forEach((function(t){var i=n(t);e[i.name]=i.value})),e):e}e.exports=r},{}],17:[function(t,e,i){function n(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function r(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var i=e[1],r=e[2].split(";"),o=null,s=r.reduce((function(t,e){var i=n(e);return i?"rel"===i.key?(o||(o=i.value),t):(t[i.key]=i.value,t):t}),{});return o?{url:i,rel:o,params:s}:null}function o(t){return t?t.split(/,\s*</).reduce((function(t,e){var i=r(e);return i?(i.rel.split(/\s+/).forEach((function(e){t[e]||(t[e]={url:i.url,params:i.params})})),t):t}),{}):{}}e.exports=o},{}],18:[function(t,e,i){function n(t){return t.map(encodeURIComponent).join(",")}function r(t){return Array.isArray(t)?n(t):encodeURIComponent(String(t))}function o(t,e,i){if(!1===i||null===i)return t;var n=/\?/.test(t)?"&":"?",o=encodeURIComponent(e);return void 0!==i&&""!==i&&!0!==i&&(o+="="+r(i)),""+t+n+o}function s(t,e){if(!e)return t;var i=t;return Object.keys(e).forEach((function(t){var n=e[t];void 0!==n&&(Array.isArray(n)&&(n=n.filter((function(t){return null!=t})).join(",")),i=o(i,t,n))})),i}function a(t,e){if(!e)return t;if("http"===t.slice(0,4))return t;var i="/"===t[0]?"":"/";return""+e.replace(/\/$/,"")+i+t}function l(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,(function(t,i){var n=e[i];if(void 0===n)throw new Error("Unspecified route parameter "+i);return"/"+r(n)})):t}e.exports={appendQueryObject:s,appendQueryParam:o,prependOrigin:a,interpolateRouteParams:l}},{}],19:[function(t,e,i){var n=t("xtend"),r=t("./service-helpers/validator"),o=t("./service-helpers/pick"),s=t("./service-helpers/stringify-booleans"),a=t("./service-helpers/create-service-factory"),l={},c=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];l.forwardGeocode=function(t){r.assertShape({query:r.required(r.string),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),proximity:r.oneOf(r.coordinates,"ip"),types:r.arrayOf(r.oneOf(c)),autocomplete:r.boolean,bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),routing:r.boolean,fuzzyMatch:r.boolean,worldview:r.string})(t),t.mode=t.mode||"mapbox.places";var e=s(n({country:t.countries},o(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(t,["mode","query"]),query:e})},l.reverseGeocode=function(t){r.assertShape({query:r.required(r.coordinates),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),types:r.arrayOf(r.oneOf(c)),bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),reverseMode:r.oneOf("distance","score"),routing:r.boolean,worldview:r.string})(t),t.mode=t.mode||"mapbox.places";var e=s(n({country:t.countries},o(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(t,["mode","query"]),query:e})},e.exports=a(l)},{"./service-helpers/create-service-factory":20,"./service-helpers/pick":22,"./service-helpers/stringify-booleans":23,"./service-helpers/validator":24,xtend:39}],20:[function(t,e,i){function n(t){return function(e){var i;i=r.prototype.isPrototypeOf(e)?e:o(e);var n=Object.create(t);return n.client=i,n}}var r=t("../../lib/classes/mapi-client"),o=t("../../lib/client");e.exports=n},{"../../lib/classes/mapi-client":11,"../../lib/client":9}],21:[function(t,e,i){function n(t,e){return Object.keys(t).reduce((function(i,n){return i[n]=e(n,t[n]),i}),{})}e.exports=n},{}],22:[function(t,e,i){function n(t,e){var i=function(t,i){return-1!==e.indexOf(t)&&void 0!==i};return"function"==typeof e&&(i=e),Object.keys(t).filter((function(e){return i(e,t[e])})).reduce((function(e,i){return e[i]=t[i],e}),{})}e.exports=n},{}],23:[function(t,e,i){function n(t){return r(t,(function(t,e){return"boolean"==typeof e?JSON.stringify(e):e}))}var r=t("./object-map");e.exports=n},{"./object-map":21}],24:[function(t,e,i){(function(i){(function(){function n(t){if("undefined"!=typeof window){if(t instanceof i.Blob||t instanceof i.ArrayBuffer)return;return"Blob or ArrayBuffer"}if("string"!=typeof t&&void 0===t.pipe)return"Filename or Readable stream"}function r(t,e){return l.assert(l.strictShape(t),e)}function o(t){if("boolean"==typeof t)return"date";try{var e=new Date(t);if(e.getTime&&isNaN(e.getTime()))return"date"}catch(t){return"date"}}function s(t){return l.tuple(l.number,l.number)(t)}var a=t("xtend"),l=t("@mapbox/fusspot");e.exports=a(l,{file:n,date:o,coordinates:s,assertShape:r})}).call(this)}).call(this,void 0!==xt?xt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@mapbox/fusspot":7,xtend:39}],25:[function(t,e,i){function n(t){if(a[t])return a[t];var e=t.split("."),i=e[0],n=e[1];if(!n)throw new Error("Invalid token");var s=r(n),l={usage:i,user:s.u};return o(s,"a")&&(l.authorization=s.a),o(s,"exp")&&(l.expires=1e3*s.exp),o(s,"iat")&&(l.created=1e3*s.iat),o(s,"scopes")&&(l.scopes=s.scopes),o(s,"client")&&(l.client=s.client),o(s,"ll")&&(l.lastLogin=s.ll),o(s,"iu")&&(l.impersonator=s.iu),a[t]=l,l}function r(t){try{return JSON.parse(s.decode(t))}catch(t){throw new Error("Invalid token")}}function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var s=t("base-64"),a={};e.exports=n},{"base-64":26}],26:[function(t,e,i){(function(t){(function(){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(r){var o="object"==(void 0===i?"undefined":n(i))&&i,s="object"==(void 0===e?"undefined":n(e))&&e&&e.exports==o&&e,a="object"==(void 0===t?"undefined":n(t))&&t;a.global!==a&&a.window!==a||(r=a);var l=function(t){this.message=t};l.prototype=new Error,l.prototype.name="InvalidCharacterError";var c=function(t){throw new l(t)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=/[\t\n\f\r ]/g,p=function(t){var e=(t=String(t).replace(h,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9\/]/.test(t))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var i,n,r=0,o="",s=-1;++s<e;)n=u.indexOf(t.charAt(s)),i=r%4?64*i+n:n,r++%4&&(o+=String.fromCharCode(255&i>>(-2*r&6)));return o},d=function(t){t=String(t),/[^\0-\xFF]/.test(t)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var e,i=t.length%3,n="",r=-1,o=t.length-i;++r<o;)e=(t.charCodeAt(r)<<16)+(t.charCodeAt(++r)<<8)+t.charCodeAt(++r),n+=u.charAt(e>>18&63)+u.charAt(e>>12&63)+u.charAt(e>>6&63)+u.charAt(63&e);return 2==i?(e=(t.charCodeAt(r)<<8)+t.charCodeAt(++r),n+=u.charAt(e>>10)+u.charAt(e>>4&63)+u.charAt(e<<2&63)+"="):1==i&&(e=t.charCodeAt(r),n+=u.charAt(e>>2)+u.charAt(e<<4&63)+"=="),n},f={encode:d,decode:p,version:"0.1.0"};if(o&&!o.nodeType)if(s)s.exports=f;else for(var m in f)f.hasOwnProperty(m)&&(o[m]=f[m]);else r.base64=f}(void 0)}).call(this)}).call(this,void 0!==xt?xt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(t,e,i){function n(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,i,n,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,n||t,o),a=c?c+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,c="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(c=!1)),a.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)l.call(t,e)&&i.push(c?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=c?c+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(t){var e=c?c+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,r,o){var s=c?c+t:t;if(!this._events[s])return!1;var a,l,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(l=1,a=new Array(h-1);l<h;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var p,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,i);break;case 4:u[l].fn.call(u[l].context,e,i,n);break;default:if(!a)for(p=1,a=new Array(h-1);p<h;p++)a[p-1]=arguments[p];u[l].fn.apply(u[l].context,a)}}return!0},a.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,i,n){var r=c?c+t:t;if(!this._events[r])return this;if(!e)return s(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||n&&!o.once||i&&o.context!==i||s(this,r);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==e||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=1===l.length?l[0]:l:s(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=c?c+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=c,a.EventEmitter=a,void 0!==e&&(e.exports=a)},{}],28:[function(t,e,i){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=w(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function o(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function s(t,e,i){if(e)t.call(i);else for(var n=t.length,r=y(t,n),o=0;o<n;++o)r[o].call(i)}function a(t,e,i,n){if(e)t.call(i,n);else for(var r=t.length,o=y(t,r),s=0;s<r;++s)o[s].call(i,n)}function l(t,e,i,n,r){if(e)t.call(i,n,r);else for(var o=t.length,s=y(t,o),a=0;a<o;++a)s[a].call(i,n,r)}function c(t,e,i,n,r,o){if(e)t.call(i,n,r,o);else for(var s=t.length,a=y(t,s),l=0;l<s;++l)a[l].call(i,n,r,o)}function u(t,e,i,n){if(e)t.apply(i,n);else for(var r=t.length,o=y(t,r),s=0;s<r;++s)o[s].apply(i,n)}function h(t,e,i,r){var s,a,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=t._events)?(a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),l=a[e]):(a=t._events=w(null),t._eventsCount=0),l){if("function"==typeof l?l=a[e]=r?[i,l]:[l,i]:r?l.unshift(i):l.push(i),!l.warned&&(s=o(t))&&s>0&&l.length>s){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=l.length,"object"===("undefined"==typeof console?"undefined":n(console))&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else l=a[e]=i,++t._eventsCount;return t}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function d(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},r=S.call(p,n);return r.listener=i,n.wrapFn=r,r}function f(t,e,i){var n=t._events;if(!n)return[];var r=n[e];return r?"function"==typeof r?i?[r.listener||r]:[r]:i?_(r):y(r,r.length):[]}function m(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function g(t,e){for(var i=e,n=i+1,r=t.length;n<r;i+=1,n+=1)t[i]=t[n];t.pop()}function y(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function _(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function v(t){var e=function(){};return e.prototype=t,new e}function x(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return i}function b(t){var e=this;return function(){return e.apply(t,arguments)}}var w=Object.create||v,T=Object.keys||x,S=Function.prototype.bind||b;e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var C,E=10;try{var I={};Object.defineProperty&&Object.defineProperty(I,"x",{value:0}),C=0===I.x}catch(t){C=!1}C?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return E},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');E=t}}):r.defaultMaxListeners=E,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return o(this)},r.prototype.emit=function(t){var e,i,n,r,o,h,p="error"===t;if(h=this._events)p=p&&null==h.error;else if(!p)return!1;if(p){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var d=new Error('Unhandled "error" event. ('+e+")");throw d.context=e,d}if(!(i=h[t]))return!1;var f="function"==typeof i;switch(n=arguments.length){case 1:s(i,f,this);break;case 2:a(i,f,this,arguments[1]);break;case 3:l(i,f,this,arguments[1],arguments[2]);break;case 4:c(i,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];u(i,f,this,r)}return!0},r.prototype.addListener=function(t,e){return h(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return h(this,t,e,!0)},r.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,d(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,d(this,t,e)),this},r.prototype.removeListener=function(t,e){var i,n,r,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=w(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():g(i,r),1===i.length&&(n[t]=i[0]),n.removeListener&&this.emit("removeListener",t,s||e)}return this},r.prototype.removeAllListeners=function(t){var e,i,n;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=w(null),this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=w(null):delete i[t]),this;if(0===arguments.length){var r,o=T(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=w(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},r.prototype.listeners=function(t){return f(this,t,!0)},r.prototype.rawListeners=function(t){return f(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):m.call(t,e)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],29:[function(t,e,i){!function(){var t=this,n={};void 0!==i?e.exports=n:t.fuzzy=n,n.simpleFilter=function(t,e){return e.filter((function(e){return n.test(t,e)}))},n.test=function(t,e){return null!==n.match(t,e)},n.match=function(t,e,i){i=i||{};var n,r=0,o=[],s=e.length,a=0,l=0,c=i.pre||"",u=i.post||"",h=i.caseSensitive&&e||e.toLowerCase();t=i.caseSensitive&&t||t.toLowerCase();for(var p=0;p<s;p++)n=e[p],h[p]===t[r]?(n=c+n+u,r+=1,l+=1+l):l=0,a+=l,o[o.length]=n;return r===t.length?(a=h===t?1/0:a,{rendered:o.join(""),score:a}):null},n.filter=function(t,e,i){return e&&0!==e.length?"string"!=typeof t?e:(i=i||{},e.reduce((function(e,r,o,s){var a=r;i.extract&&(a=i.extract(r));var l=n.match(t,a,i);return null!=l&&(e[e.length]={string:l.rendered,score:l.score,index:o,original:r}),e}),[]).sort((function(t,e){return e.score-t.score||t.index-e.index}))):[]}}()},{}],30:[function(t,e,i){var n=Object.prototype.toString;e.exports=function(t){var e;return"[object Object]"===n.call(t)&&(null===(e=Object.getPrototypeOf(t))||e===Object.getPrototypeOf({}))}},{}],31:[function(t,e,i){(function(t){(function(){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e,i){function n(e){var i=m,n=g;return m=g=void 0,S=e,_=t.apply(n,i)}function o(t){return S=t,v=setTimeout(u,e),C?n(t):_}function s(t){var i=e-(t-T);return E?b(i,y-(t-S)):i}function c(t){var i=t-T;return void 0===T||i>=e||i<0||E&&t-S>=y}function u(){var t=w();if(c(t))return h(t);v=setTimeout(u,s(t))}function h(t){return v=void 0,I&&m?n(t):(m=g=void 0,_)}function p(){void 0!==v&&clearTimeout(v),S=0,m=T=g=v=void 0}function d(){return void 0===v?_:h(w())}function f(){var t=w(),i=c(t);if(m=arguments,g=this,T=t,i){if(void 0===v)return o(T);if(E)return v=setTimeout(u,e),n(T)}return void 0===v&&(v=setTimeout(u,e)),_}var m,g,y,_,v,T,S=0,C=!1,E=!1,I=!0;if("function"!=typeof t)throw new TypeError(l);return e=a(e)||0,r(i)&&(C=!!i.leading,y=(E="maxWait"in i)?x(a(i.maxWait)||0,e):y,I="trailing"in i?!!i.trailing:I),f.cancel=p,f.flush=d,f}function r(t){var e=i(t);return!!t&&("object"==e||"function"==e)}function o(t){return!!t&&"object"==i(t)}function s(t){return"symbol"==i(t)||o(t)&&v.call(t)==u}function a(t){if("number"==typeof t)return t;if(s(t))return c;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(h,"");var i=d.test(t);return i||f.test(t)?m(t.slice(2),i?2:8):p.test(t)?c:+t}var l="Expected a function",c=NaN,u="[object Symbol]",h=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,f=/^0o[0-7]+$/i,m=parseInt,g="object"==(void 0===t?"undefined":i(t))&&t&&t.Object===Object&&t,y="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,_=g||y||Function("return this")(),v=Object.prototype.toString,x=Math.max,b=Math.min,w=function(){return _.Date.now()};e.exports=n}).call(this)}).call(this,void 0!==xt?xt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(t,e,i){(function(i){(function(){var n=t("./url-alphabet/index.cjs").urlAlphabet;if("production"!==i.env.NODE_ENV){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}var r=function(t){return crypto.getRandomValues(new Uint8Array(t))},o=function(t,e,i){var n=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*n*e/t.length);return function(){for(var o="";;)for(var s=i(r),a=r;a--;)if((o+=t[s[a]&n]||"").length===e)return o}},s=function(t,e){return o(t,e,r)},a=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,e="",i=crypto.getRandomValues(new Uint8Array(t));t--;){var n=63&i[t];e+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return e};e.exports={nanoid:a,customAlphabet:s,customRandom:o,urlAlphabet:n,random:r}}).call(this)}).call(this,t("_process"))},{"./url-alphabet/index.cjs":33,_process:34}],33:[function(t,e,i){e.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}},{}],34:[function(t,e,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function s(t){if(p===clearTimeout)return clearTimeout(t);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function a(){g&&f&&(g=!1,f.length?m=f.concat(m):y=-1,m.length&&l())}function l(){if(!g){var t=o(a);g=!0;for(var e=m.length;e;){for(f=m,m=[];++y<e;)f&&f[y].run();y=-1,e=m.length}f=null,g=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var h,p,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{p="function"==typeof clearTimeout?clearTimeout:r}catch(t){p=r}}();var f,m=[],g=!1,y=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];m.push(new c(t,e)),1!==m.length||g||o(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],35:[function(t,e,i){!function(t,i,n){void 0!==e&&e.exports?e.exports=n():t.subtag=n()}(void 0,0,(function(){function t(t){return t.match(s)||[]}function e(e){return t(e).filter((function(t,e){return t&&e}))}function i(e){return{language:(e=t(e))[1]||o,extlang:e[2]||o,script:e[3]||o,region:e[4]||o}}function n(t,e,i){Object.defineProperty(t,e,{value:i,enumerable:!0})}function r(e,r,s){function a(i){return t(i)[e]||o}n(a,"pattern",r),n(i,s,a)}var o="",s=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),n(i,"split",e),i}))},{}],36:[function(t,e,i){var n=t("./src/suggestions");e.exports=n,"undefined"!=typeof window&&(window.Suggestions=n)},{"./src/suggestions":38}],37:[function(t,e,i){var n=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};n.prototype.show=function(){this.element.style.display="block"},n.prototype.hide=function(){this.element.style.display="none"},n.prototype.add=function(t){this.items.push(t)},n.prototype.clear=function(){this.items=[],this.active=0},n.prototype.isEmpty=function(){return!this.items.length},n.prototype.isVisible=function(){return"block"===this.element.style.display},n.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()}else this.hide()},n.prototype.drawItem=function(t,e){var i=document.createElement("li"),n=document.createElement("a");e&&(i.className+=" active"),n.innerHTML=t.string,i.appendChild(n),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,t)}.bind(this))},n.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()},n.prototype.move=function(t){this.active=t,this.draw()},n.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},n.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},n.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()},e.exports=n},{}],38:[function(t,e,i){var n=t("xtend"),r=t("fuzzy"),o=t("./list"),s=function(t,e,i){return i=i||{},this.options=n({minLength:2,limit:5,filter:!0,hideOnBlur:!0},i),this.el=t,this.data=e||[],this.list=new o(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(t){this.handleKeyUp(t.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(t){this.handleKeyDown(t)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(t){this.handlePaste(t)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};s.prototype.handleKeyUp=function(t){40!==t&&38!==t&&27!==t&&13!==t&&9!==t&&this.handleInputChange(this.el.value)},s.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},s.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},s.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout((function(){e.handleInputChange(t.target.value)}),100)}},s.prototype.handleInputChange=function(t){this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}.bind(this))},s.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},s.prototype.update=function(t){this.data=t,this.handleKeyUp()},s.prototype.clear=function(){this.data=[],this.list.clear()},s.prototype.normalize=function(t){return t.toLowerCase()},s.prototype.match=function(t,e){return t.indexOf(e)>-1},s.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},s.prototype.getCandidates=function(t){var e,i={pre:"<strong>",post:"</strong>",extract:function(t){return this.getItemValue(t)}.bind(this)};e=this.options.filter?(e=r.filter(this.query,this.data,i)).map(function(t){return{original:t.original,string:this.render(t.original,t.string)}}.bind(this)):this.data.map(function(t){return{original:t,string:this.render(t)}}.bind(this)),t(e)},s.prototype.getItemValue=function(t){return t},s.prototype.render=function(t,e){if(e)return e;for(var i=t.original?this.getItemValue(t.original):this.getItemValue(t),n=this.normalize(i),r=n.lastIndexOf(this.query);r>-1;){var o=r+this.query.length;i=i.slice(0,r)+"<strong>"+i.slice(r,o)+"</strong>"+i.slice(o),r=n.slice(0,r).lastIndexOf(this.query)}return i},s.prototype.renderError=function(t){this.list.drawError(t)},e.exports=s},{"./list":37,fuzzy:29,xtend:39}],39:[function(t,e,i){function n(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var n in i)r.call(i,n)&&(t[n]=i[n])}return t}e.exports=n;var r=Object.prototype.hasOwnProperty},{}]},{},[4])(4);let ru;Gt.subscribe((t=>({mapboxGlAccessToken:ru}=t)));const ou=async(...t)=>{let e;try{const i=((...t)=>`https://api.mapbox.com/directions/v5/mapbox/driving/${t.map((t=>{const{lng:e,lat:i}=t;return`${e},${i}`})).join(";")}?geometries=geojson&steps=true&access_token=${ru}`)(...t),n=await fetch(i);e=await n.json()}catch(t){console.error(t)}return(t=>{const e=t.routes[0].legs.reduce(((t,e)=>{const i=e.steps.reduce(((t,e)=>t.concat(e)),[]);return t.concat(i)}),[]);let i=e.map((t=>t.geometry));return i=i.reduce(((t,e)=>t.concat(e.coordinates)),[]),{steps:e,coordinates:i}})(e)};let su,au,lu,cu,uu,hu={};Yt.subscribe((t=>hu=t)),ie.subscribe((t=>({routingOptions:au,maneuverOptions:lu,speedOptions:cu,durationMultiplier:uu}=t)));const pu=(t,e,i,n,r)=>(t-e)*(r-n)/(i-e)+n,du=(t,e,i)=>i?((t,e)=>{let i=e+(360-t);return i>360?i-360:i})(t,e):((t,e)=>{let i=t+(360-e);return i>360?i-360:i})(t,e),fu=t=>(t>360&&(t-=360),t<0&&(t=360+t),360===t&&(t=0),t),mu=(t,e,i,n)=>{let r=du(t,e,i);return fu(i?t+r*n:t-r*n)},gu=(t,e,i,n)=>{const r=1-pu(Math.min(i,n),0,n,0,1);let o=t.pitch,s=t.zoom;if(void 0!==e.pitch){const i=e.pitch>t.pitch,n=Math.min(t.pitch,e.pitch),s=Math.max(t.pitch,e.pitch);o=pu(i?r:1-r,0,1,n,s)}if(void 0!==e.zoom){const i=e.zoom>t.zoom,n=Math.min(t.zoom,e.zoom),o=Math.max(t.zoom,e.zoom);s=pu(i?r:1-r,0,1,n,o)}return{pitch:o,zoom:s}},yu=(t,e)=>new Promise((async i=>{const{steps:n,distance:r,duration:o,coordinates:s,maneuver:a,nextManeuver:l}=e,c=r/o;let u=cu?.speed&&cu?.speed<c?{...au,...cu}:au;if("arrive"===a.type)return i({segmentComplete:!0});const h=t.getBearing()<0?360+t.getBearing():t.getBearing();let p=await((t,e,i)=>new Promise((n=>{let r,{bearing_after:o,location:s,modifier:a}=e,l=i;if(!a||!o)return n(l);const c=du(i,o,!0),u=du(i,o,!1),h=c<u,p=(h?c:u)*uu/10;window.requestAnimationFrame((function e(a){r||(r=a);const c=(a-r)/p;if(c>1)return n(l);l=mu(i,o,h,c),ps(t,s,l),t.jumpTo({center:s,bearing:l}),window.requestAnimationFrame(e)}))})))(t,a,h);const d=s,f=o*uu,m=zr(gr(d));let g,y,_,v,x;window.requestAnimationFrame((function e(o){if(JSON.stringify(n)!==JSON.stringify(su))return i({segmentComplete:!0});x||(x=o);const s=(o-x)/f,a=Lr(gr(d),m*s).geometry.coordinates,c=Lr(gr(d),m*Math.min(s+.025,1)).geometry.coordinates;if(s>1)return i({segmentComplete:!0});let h,b,w=fu(Rr(mr(a),mr(c)));p=((t,e)=>{const i=du(t,e,!1),n=du(t,e,!0);let r=n<i,o=r?n:i;o=Math.min(o,5);const s=pu(5-o,0,5,.05,.5);return mu(t,e,r,s)})(p,w);const T=Lr(gr(d.slice(1).concat([d[d.length-1]])),m*s).geometry.coordinates,S=Rr(mr(a),mr(T));ps(t,a,S);const C=r-r*s,E=u?.leadDistance;if(E&&C<=E){g||(g=t.getPitch()),y||(y=t.getZoom());const e=lu?.["*"]||lu?.[l?.type],i=gu({pitch:g,zoom:y},{pitch:void 0!==e?.pitch?e?.pitch:u.pitch,zoom:void 0!==e?.zoom?e?.zoom:u.zoom},C,Math.min(E,r));h=i.pitch,b=i.zoom}else if(E&&r*s<=E){_||(_=t.getPitch()),v||(v=t.getZoom());const e=gu({pitch:_,zoom:v},{pitch:u.pitch,zoom:u.zoom},E-r*s,Math.min(E,r));h=e.pitch,b=e.zoom}else h=u.pitch,b=u.zoom;t.jumpTo({center:a,zoom:b,pitch:h,bearing:p}),window.requestAnimationFrame(e)}))})),_u=async(t,e)=>{const{coordinates:i,steps:n}=e;if(su=n,n)return new Promise((e=>{const r=i[0],o=i[i.length-1],s=n?.[0]?.maneuver?.bearing_after||0,a="arrive"===n[n.length-1]?.maneuver?.type;t.easeTo({center:r,speed:.2,curve:1,duration:1e3,zoom:au.zoom,pitch:au.pitch,bearing:s}),t.once("moveend",(()=>{hu["destination-pin"]&&a&&ds(t,o,"destination-pin",{"icon-pitch-alignment":"viewport","icon-offset":[0,-.5*hu["destination-pin"].height]}),hu.puck&&ds(t,r,Rt,{"icon-pitch-alignment":"map","icon-rotation-alignment":"map"}),(async(t,e)=>{for(let i=0;i<e.length;i++){const n=e[i],{distance:r,duration:o,geometry:s,maneuver:a}=n,l=e?.[i+1]?.maneuver;if(JSON.stringify(e)!==JSON.stringify(su))return;await yu(t,{steps:e,duration:o,distance:r,coordinates:s.coordinates,maneuver:a,nextManeuver:l})}return{routeComplete:!0}})(t,n).then((t=>{e(t)}))}))}))},{Boolean:vu}=ct;function xu(t,e,i){const n=t.slice();return n[26]=e[i],n[28]=i,n}function bu(t){let e,i,n,r,o,s,a,l,c,u,h,p=t[26].id.toUpperCase()+"",d=t[28]>=2&&function(t){let e,i,n,r,o;function s(){return t[16](t[26])}return i=new eu({props:{icon:Wc}}),{c(){e=w("button"),mt(i.$$.fragment),A(e,"class","remove-stop svelte-17426y6"),e.disabled=t[0]},m(t,a){v(t,e,a),gt(i,e,null),n=!0,r||(o=I(e,"click",s),r=!0)},p(i,r){t=i,(!n||1&r)&&(e.disabled=t[0])},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(t){t&&x(e),yt(i),r=!1,o()}}}(t);return{c(){e=w("div"),i=w("div"),n=w("span"),r=S(p),o=S(":"),s=C(),a=w("div"),l=w("div"),u=C(),d&&d.c(),A(n,"class","label svelte-17426y6"),A(l,"id",c=t[26].id),A(l,"class","geocoder unfocused-input svelte-17426y6"),A(a,"class","geocoder-container svelte-17426y6"),A(i,"class","search-container svelte-17426y6"),A(e,"class","stop svelte-17426y6")},m(t,c){v(t,e,c),_(e,i),_(i,n),_(n,r),_(n,o),_(i,s),_(i,a),_(a,l),_(e,u),d&&d.m(e,null),h=!0},p(t,e){(!h||2&e)&&p!==(p=t[26].id.toUpperCase()+"")&&L(r,p),(!h||2&e&&c!==(c=t[26].id))&&A(l,"id",c),t[28]>=2&&d.p(t,e)},i(t){h||(at(d),h=!0)},o(t){lt(d),h=!1},d(t){t&&x(e),d&&d.d()}}}function wu(t){let e,i,n,r,o,l,c,u,h,p,d,f,m,g,y,T,E,M,k,P,z,D,R,O,F,N,B,j=t[0]?"Cancel route":"Run route",$=t[11]&&t[11].length&&function(t){let e,i,n;return i=new yl({props:{titleText:"Presets",selectedId:t[4],items:t[11]}}),i.$on("select",t[12]),{c(){e=w("div"),mt(i.$$.fragment),A(e,"class","dropdown svelte-17426y6")},m(t,r){v(t,e,r),gt(i,e,null),n=!0},p(t,e){const n={};16&e&&(n.selectedId=t[4]),i.$set(n)},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(t){t&&x(e),yt(i)}}}(t),U=t[1],V=[];for(let e=0;e<U.length;e+=1)V[e]=bu(xu(t,U,e));const G=t=>lt(V[t],1,1,(()=>{V[t]=null}));return{c(){e=w("div"),$&&$.c(),i=C();for(let t=0;t<V.length;t+=1)V[t].c();n=C(),r=w("div"),o=w("button"),l=S("Add stop"),h=C(),p=w("button"),d=S("Clear route"),m=C(),g=w("button"),y=S("Submit"),E=C(),M=w("button"),k=S("Copy route to clipboard"),z=C(),D=w("button"),R=S(j),A(o,"class","secondary-button svelte-17426y6"),o.disabled=c=t[1].length>=4||t[0],A(o,"title",u=t[1].length>=4?"maximum of 4 stops allowed":""),A(p,"class","secondary-button svelte-17426y6"),p.disabled=t[0],A(p,"title",f=t[1].length>=4?"maximum of 4 stops allowed":""),A(r,"class","button-margin svelte-17426y6"),A(g,"class","primary-button button-margin svelte-17426y6"),g.disabled=T=t[3]||t[0],A(M,"class","primary-button button-margin mt12 svelte-17426y6"),M.disabled=P=!t[2],A(D,"class","primary-button button-margin svelte-17426y6"),D.disabled=O=!t[2],A(e,"class","directions svelte-17426y6")},m(s,c){v(s,e,c),$&&$.m(e,null),_(e,i);for(let t=0;t<V.length;t+=1)V[t].m(e,null);_(e,n),_(e,r),_(r,o),_(o,l),_(r,h),_(r,p),_(p,d),_(e,m),_(e,g),_(g,y),_(e,E),_(e,M),_(M,k),_(e,z),_(e,D),_(D,R),F=!0,N||(B=[I(o,"click",t[6]),I(p,"click",t[8]),I(g,"click",t[5]),I(M,"click",t[13]),I(D,"click",(function(){a(t[0]?t[10]:t[9])&&(t[0]?t[10]:t[9]).apply(this,arguments)}))],N=!0)},p(i,[r]){if((t=i)[11]&&t[11].length&&$.p(t,r),131&r){let i;for(U=t[1],i=0;i<U.length;i+=1){const o=xu(t,U,i);V[i]?(V[i].p(o,r),at(V[i],1)):(V[i]=bu(o),V[i].c(),at(V[i],1),V[i].m(e,n))}for(ot(),i=U.length;i<V.length;i+=1)G(i);st()}(!F||3&r&&c!==(c=t[1].length>=4||t[0]))&&(o.disabled=c),(!F||2&r&&u!==(u=t[1].length>=4?"maximum of 4 stops allowed":""))&&A(o,"title",u),(!F||1&r)&&(p.disabled=t[0]),(!F||2&r&&f!==(f=t[1].length>=4?"maximum of 4 stops allowed":""))&&A(p,"title",f),(!F||9&r&&T!==(T=t[3]||t[0]))&&(g.disabled=T),(!F||4&r&&P!==(P=!t[2]))&&(M.disabled=P),(!F||1&r)&&j!==(j=t[0]?"Cancel route":"Run route")&&L(R,j),(!F||4&r&&O!==(O=!t[2]))&&(D.disabled=O)},i(t){if(!F){at($);for(let t=0;t<U.length;t+=1)at(V[t]);F=!0}},o(t){lt($),V=V.filter(vu);for(let t=0;t<V.length;t+=1)lt(V[t]);F=!1},d(t){t&&x(e),$&&$.d(),b(V,t),N=!1,s(B)}}}function Tu(t,e,i){let n,r,o,{routeFlag:s}=e,{setRouteFlag:a}=e;Gt.subscribe((t=>i(15,({mapboxGlAccessToken:n,directionsApiCall:r,presetRoutes:o}=t),o)));let l,c,u=!1,h="custom",p=Ft;Zt.subscribe((t=>{t&&t.hasOwnProperty("locations")&&i(1,p=t.locations)})),Xt.subscribe((t=>l=t));const d=()=>p.map((t=>t.center)).filter(Boolean).length>=2,f=async()=>{const t=p.map((t=>t.center?t.center:_(t.id))).filter(Boolean),e=r?await r(...t):await ou(...t);e&&(i(2,c=e),Zt.set({locations:p,response:e}))},m=t=>{const e=new nu({accessToken:n,mapboxgl:ge});e.addTo(`#${t}`),e.on("result",(e=>{const{center:n,placeName:r}=(t=>{const{place_name:e}=t;return{center:{lat:t.center[1],lng:t.center[0]},placeName:e}})(e.result);i(1,p=p.map((e=>e.id===t?{...e,center:n,locationText:r}:e)))})),e.on("clear",(e=>{i(1,p=p.map((e=>e.id===t?{...e,center:null,locationText:""}:e)))}))},g=t=>{const e=document.getElementById(t);e.classList.remove("focused-input"),e.classList.add("unfocused-input")},y=()=>{[...document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")].forEach(((t,e)=>{t.value=p[e].locationText,t.addEventListener("focusin",(()=>(t=>{const e=document.getElementById(t);e.classList.remove("unfocused-input"),e.classList.add("focused-input"),p.filter((e=>e.id!==t)).map((t=>t.id)).forEach((t=>{g(t)}))})(p[e].id)))}))};B((()=>{p.forEach((t=>m(t.id))),y(),d()&&f()}));const _=t=>{i(1,p=p.filter((e=>e.id!==t)))},v=async()=>{i(1,p=Ft),await Y(),y(),Zt.set({locations:p,response:null}),i(2,c=void 0);l.getSource(Nt).setData({type:"FeatureCollection",features:[]})},x=o?o.map((t=>({id:t.id,text:t.name}))).concat([{id:"custom",text:"Custom"}]):null;return t.$$set=t=>{"routeFlag"in t&&i(0,s=t.routeFlag),"setRouteFlag"in t&&i(14,a=t.setRouteFlag)},t.$$.update=()=>{if(2&t.$$.dirty&&p&&i(3,u=!d()),32770&t.$$.dirty){const t=o&&o.find((t=>{const{route:e}=t;return p.every((t=>Object.entries(t).every((([t,i])=>e.some((e=>JSON.stringify(e[t])===JSON.stringify(i)))))))}));i(4,h=t?t?.id:"custom")}},[s,p,c,u,h,f,async()=>{const t=String.fromCharCode(p.length+1+64).toLowerCase();i(1,p=p.concat([{id:t,center:null,locationText:""}])),await Y(),m(t)},_,v,async()=>{a(!0),await _u(l,c),a(!1)},async()=>{await _u(l,{steps:null}),a(!1)},x,t=>{const{selectedId:e}=t.detail;if(i(4,h=e),"custom"===e)return;v();const n=o.find((t=>t.id===h));n&&i(1,p=n.route)},()=>{navigator.clipboard.writeText(JSON.stringify(p,null,2))},a,o,t=>_(t.id)]}class Su extends vt{constructor(t){super(),_t(this,t,Tu,wu,l,{routeFlag:0,setRouteFlag:14})}}let Cu,Eu,Iu,Mu,Au;const ku=()=>{const t=Cu.memory().subarray(Eu);Iu.readPixels(0,0,Mu,Au,Iu.RGBA,Iu.UNSIGNED_BYTE,t),Cu.encodeRGBPointer()};function Pu(t){let e;return{c(){e=w("div"),A(e,"class","record svelte-2yk0nq")},m(t,i){v(t,e,i)},d(t){t&&x(e)}}}function Lu(t){let e,i,n,r,o,a,l,c,u,h,p,d,f,m,g,y;n=new yl({props:{titleText:"Moments",selectedId:t[3],label:"Select a maneuver",items:t[2],disabled:!t[0].length}}),n.$on("select",t[10]);let b=t[1]&&Pu();return{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),r=C(),o=w("button"),a=S("Submit"),c=C(),u=w("button"),h=S("Record"),d=C(),b&&b.c(),f=E(),A(i,"class","dropdown-container svelte-2yk0nq"),A(o,"class","primary-button svelte-2yk0nq"),o.disabled=l=!t[3]||!t[0].length,A(u,"class","primary-button svelte-2yk0nq"),u.disabled=p=!t[3]||!t[0].length,A(e,"class","container svelte-2yk0nq")},m(s,l){v(s,e,l),_(e,i),gt(n,i,null),_(e,r),_(e,o),_(o,a),_(e,c),_(e,u),_(u,h),v(s,d,l),b&&b.m(s,l),v(s,f,l),m=!0,g||(y=[I(o,"click",t[5]),I(u,"click",t[6])],g=!0)},p(t,[e]){const i={};8&e&&(i.selectedId=t[3]),4&e&&(i.items=t[2]),1&e&&(i.disabled=!t[0].length),n.$set(i),(!m||9&e&&l!==(l=!t[3]||!t[0].length))&&(o.disabled=l),(!m||9&e&&p!==(p=!t[3]||!t[0].length))&&(u.disabled=p),t[1]?b||(b=Pu(),b.c(),b.m(f.parentNode,f)):b&&(b.d(1),b=null)},i(t){m||(at(n.$$.fragment,t),m=!0)},o(t){lt(n.$$.fragment,t),m=!1},d(t){t&&x(e),yt(n),t&&x(d),b&&b.d(t),t&&x(f),g=!1,s(y)}}}function zu(e,i,n){let r,o,s,{routeFlag:a}=i,{setRouteFlag:l}=i,c=!1,u=null,h="";Zt.subscribe((t=>{if(n(9,u=t&&t?.response?t?.response:null),t&&t?.locations&&t?.locations.every((t=>!!t?.center))){h=0;for(const e of t?.locations){const{center:t}=e;h=h+t.lat+t.lng}h=`${h}`.replace(".","")}})),Xt.subscribe((t=>r=t)),Gt.subscribe((t=>({routingOptions:o,speedOptions:s}=t)));let p,d=[],f=[];const m=t=>{n(3,p=t)},g=async()=>{const t=d.find((t=>t.id===p));await(async t=>{const e={coordinates:(t?.steps||[]).reduce(((t,e)=>t.concat(e?.geometry?.coordinates||[])),[]),steps:t.steps};l(!0),await _u(r,e),l(!1)})(t)};return e.$$set=t=>{"routeFlag"in t&&n(7,a=t.routeFlag),"setRouteFlag"in t&&n(8,l=t.setRouteFlag)},e.$$.update=()=>{512&e.$$.dirty&&(u?(t=>{const e=t.steps;for(let t=0;t<e.length;t++){const i={units:"meters"},r=e?.[t-1],a=e[t],{distance:l,geometry:c,duration:u,maneuver:h}=a,p=r?.geometry,f=p&&zr(p,i),m=zr(c,i),g=r&&r?.distance/r?.duration,y=l/u,_=g&&g>=s?.speed?s?.leadDistance:o?.leadDistance,v=y&&y>=s?.speed?s?.leadDistance:o?.leadDistance;let x=p,b=c,w=f&&Math.min(_,f),T=Math.min(v,m);f&&(x=Dr(p,Math.max(0,f-_),f,i)?.geometry),T&&(b=Dr(c,0,T,i)?.geometry);let S=Math.min(_,f)/f*r?.duration??0,C=Math.min(v,m)/m*u;const E={geometry:x,distance:w,duration:S,maneuver:{bearing_after:h.bearing_before}},I={geometry:b,distance:T,duration:C,maneuver:h};n(0,d=d.concat([{maneuver:h,steps:x?[E,I]:[I],id:`${t}`}]))}})(u):n(0,d=[])),128&e.$$.dirty&&(a||n(1,c=!1)),1&e.$$.dirty&&n(2,f=d.map((t=>{const{type:e,instruction:i}=t.maneuver,n=`${e}: ${i}`;return{id:t.id,text:n}})))},[d,c,f,p,m,g,async()=>{const{id:e,maneuver:i}=d.find((t=>t.id===p));let o=i?.instruction||i?.type;o=`${h}-${e}-${o.toLowerCase().replaceAll(" ","-")}`,n(1,c=!0),await(async e=>{const i=await t();Iu=e.painter.context.gl,Mu=Iu.drawingBufferWidth,Au=Iu.drawingBufferHeight,Cu=i.create({width:Mu,height:Au,fps:30,kbps:8e3,rgbFlipY:!0}),Eu=Cu.getRGBPointer()})(r),r.on("render",ku),await g(),r.off("render",ku),(t=>{const e=Cu.end(),i=document.createElement("a");i.href=URL.createObjectURL(new Blob([e],{type:"video/mp4"})),i.download=t,i.click()})(o),n(1,c=!1)},a,l,u,t=>m(t.detail.selectedId)]}class Du extends vt{constructor(t){super(),_t(this,t,zu,Lu,l,{routeFlag:7,setRouteFlag:8})}}var Ru={exports:{}};!function(t){t.defineMode("javascript",(function(e,i){var n,r,o=e.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,c=!1!==i.trackScope,u=i.typescript,h=i.wordCharacters||/[\w$\xa1-\uffff]/,p=function(){function t(t){return{type:t,style:"keyword"}}var e=t("keyword a"),i=t("keyword b"),n=t("keyword c"),r=t("keyword d"),o=t("operator"),s={type:"atom",style:"atom"};return{if:t("if"),while:e,with:e,else:i,do:i,try:i,finally:i,return:r,break:r,continue:r,new:t("new"),delete:n,void:n,throw:n,debugger:t("debugger"),var:t("var"),const:t("var"),let:t("var"),function:t("function"),catch:t("catch"),for:t("for"),switch:t("switch"),case:t("case"),default:t("default"),in:o,typeof:o,instanceof:o,true:s,false:s,null:s,undefined:s,NaN:s,Infinity:s,this:t("this"),class:t("class"),super:t("atom"),yield:n,export:t("export"),import:t("import"),extends:n,await:n}}(),d=/[+\-*&%=<>!?|~^@]/,f=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function m(t){for(var e,i=!1,n=!1;null!=(e=t.next());){if(!i){if("/"==e&&!n)return;"["==e?n=!0:n&&"]"==e&&(n=!1)}i=!i&&"\\"==e}}function g(t,e,i){return n=t,r=i,e}function y(t,e){var i=t.next();if('"'==i||"'"==i)return e.tokenize=_(i),e.tokenize(t,e);if("."==i&&t.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return g("number","number");if("."==i&&t.match(".."))return g("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return g(i);if("="==i&&t.eat(">"))return g("=>","operator");if("0"==i&&t.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return g("number","number");if(/\d/.test(i))return t.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),g("number","number");if("/"==i)return t.eat("*")?(e.tokenize=v,v(t,e)):t.eat("/")?(t.skipToEnd(),g("comment","comment")):re(t,e,1)?(m(t),t.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),g("regexp","string-2")):(t.eat("="),g("operator","operator",t.current()));if("`"==i)return e.tokenize=x,x(t,e);if("#"==i&&"!"==t.peek())return t.skipToEnd(),g("meta","meta");if("#"==i&&t.eatWhile(h))return g("variable","property");if("<"==i&&t.match("!--")||"-"==i&&t.match("->")&&!/\S/.test(t.string.slice(0,t.start)))return t.skipToEnd(),g("comment","comment");if(d.test(i))return">"==i&&e.lexical&&">"==e.lexical.type||(t.eat("=")?"!"!=i&&"="!=i||t.eat("="):/[<>*+\-|&?]/.test(i)&&(t.eat(i),">"==i&&t.eat(i))),"?"==i&&t.eat(".")?g("."):g("operator","operator",t.current());if(h.test(i)){t.eatWhile(h);var n=t.current();if("."!=e.lastType){if(p.propertyIsEnumerable(n)){var r=p[n];return g(r.type,r.style,n)}if("async"==n&&t.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return g("async","keyword",n)}return g("variable","variable",n)}}function _(t){return function(e,i){var n,r=!1;if(a&&"@"==e.peek()&&e.match(f))return i.tokenize=y,g("jsonld-keyword","meta");for(;null!=(n=e.next())&&(n!=t||r);)r=!r&&"\\"==n;return r||(i.tokenize=y),g("string","string")}}function v(t,e){for(var i,n=!1;i=t.next();){if("/"==i&&n){e.tokenize=y;break}n="*"==i}return g("comment","comment")}function x(t,e){for(var i,n=!1;null!=(i=t.next());){if(!n&&("`"==i||"$"==i&&t.eat("{"))){e.tokenize=y;break}n=!n&&"\\"==i}return g("quasi","string-2",t.current())}var b="([{}])";function w(t,e){e.fatArrowAt&&(e.fatArrowAt=null);var i=t.string.indexOf("=>",t.start);if(!(i<0)){if(u){var n=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(t.string.slice(t.start,i));n&&(i=n.index)}for(var r=0,o=!1,s=i-1;s>=0;--s){var a=t.string.charAt(s),l=b.indexOf(a);if(l>=0&&l<3){if(!r){++s;break}if(0==--r){"("==a&&(o=!0);break}}else if(l>=3&&l<6)++r;else if(h.test(a))o=!0;else if(/["'\/`]/.test(a))for(;;--s){if(0==s)return;if(t.string.charAt(s-1)==a&&"\\"!=t.string.charAt(s-2)){s--;break}}else if(o&&!r){++s;break}}o&&!r&&(e.fatArrowAt=s)}}var T={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function S(t,e,i,n,r,o){this.indented=t,this.column=e,this.type=i,this.prev=r,this.info=o,null!=n&&(this.align=n)}function C(t,e){if(!c)return!1;for(var i=t.localVars;i;i=i.next)if(i.name==e)return!0;for(var n=t.context;n;n=n.prev)for(i=n.vars;i;i=i.next)if(i.name==e)return!0}function E(t,e,i,n,r){var o=t.cc;for(I.state=t,I.stream=r,I.marked=null,I.cc=o,I.style=e,t.lexical.hasOwnProperty("align")||(t.lexical.align=!0);;)if((o.length?o.pop():l?q:V)(i,n)){for(;o.length&&o[o.length-1].lex;)o.pop()();return I.marked?I.marked:"variable"==i&&C(t,n)?"variable-2":e}}var I={state:null,column:null,marked:null,cc:null};function M(){for(var t=arguments.length-1;t>=0;t--)I.cc.push(arguments[t])}function A(){return M.apply(null,arguments),!0}function k(t,e){for(var i=e;i;i=i.next)if(i.name==t)return!0;return!1}function P(t){var e=I.state;if(I.marked="def",c){if(e.context)if("var"==e.lexical.info&&e.context&&e.context.block){var n=L(t,e.context);if(null!=n)return void(e.context=n)}else if(!k(t,e.localVars))return void(e.localVars=new R(t,e.localVars));i.globalVars&&!k(t,e.globalVars)&&(e.globalVars=new R(t,e.globalVars))}}function L(t,e){if(e){if(e.block){var i=L(t,e.prev);return i?i==e.prev?e:new D(i,e.vars,!0):null}return k(t,e.vars)?e:new D(e.prev,new R(t,e.vars),!1)}return null}function z(t){return"public"==t||"private"==t||"protected"==t||"abstract"==t||"readonly"==t}function D(t,e,i){this.prev=t,this.vars=e,this.block=i}function R(t,e){this.name=t,this.next=e}var O=new R("this",new R("arguments",null));function F(){I.state.context=new D(I.state.context,I.state.localVars,!1),I.state.localVars=O}function N(){I.state.context=new D(I.state.context,I.state.localVars,!0),I.state.localVars=null}function B(){I.state.localVars=I.state.context.vars,I.state.context=I.state.context.prev}function j(t,e){var i=function(){var i=I.state,n=i.indented;if("stat"==i.lexical.type)n=i.lexical.indented;else for(var r=i.lexical;r&&")"==r.type&&r.align;r=r.prev)n=r.indented;i.lexical=new S(n,I.stream.column(),t,null,i.lexical,e)};return i.lex=!0,i}function $(){var t=I.state;t.lexical.prev&&(")"==t.lexical.type&&(t.indented=t.lexical.indented),t.lexical=t.lexical.prev)}function U(t){function e(i){return i==t?A():";"==t||"}"==i||")"==i||"]"==i?M():A(e)}return e}function V(t,e){return"var"==t?A(j("vardef",e),Mt,U(";"),$):"keyword a"==t?A(j("form"),W,V,$):"keyword b"==t?A(j("form"),V,$):"keyword d"==t?I.stream.match(/^\s*$/,!1)?A():A(j("stat"),X,U(";"),$):"debugger"==t?A(U(";")):"{"==t?A(j("}"),N,pt,$,B):";"==t?A():"if"==t?("else"==I.state.lexical.info&&I.state.cc[I.state.cc.length-1]==$&&I.state.cc.pop()(),A(j("form"),W,V,$,Dt)):"function"==t?A(Nt):"for"==t?A(j("form"),N,Rt,V,B,$):"class"==t||u&&"interface"==e?(I.marked="keyword",A(j("form","class"==t?t:e),Vt,$)):"variable"==t?u&&"declare"==e?(I.marked="keyword",A(V)):u&&("module"==e||"enum"==e||"type"==e)&&I.stream.match(/^\s*\w/,!1)?(I.marked="keyword","enum"==e?A(ee):"type"==e?A(jt,U("operator"),yt,U(";")):A(j("form"),At,U("{"),j("}"),pt,$,$)):u&&"namespace"==e?(I.marked="keyword",A(j("form"),q,V,$)):u&&"abstract"==e?(I.marked="keyword",A(V)):A(j("stat"),ot):"switch"==t?A(j("form"),W,U("{"),j("}","switch"),N,pt,$,$,B):"case"==t?A(q,U(":")):"default"==t?A(U(":")):"catch"==t?A(j("form"),F,G,V,$,B):"export"==t?A(j("stat"),Wt,$):"import"==t?A(j("stat"),Xt,$):"async"==t?A(V):"@"==e?A(q,V):M(j("stat"),q,U(";"),$)}function G(t){if("("==t)return A($t,U(")"))}function q(t,e){return H(t,e,!1)}function Z(t,e){return H(t,e,!0)}function W(t){return"("!=t?M():A(j(")"),X,U(")"),$)}function H(t,e,i){if(I.state.fatArrowAt==I.stream.start){var n=i?et:tt;if("("==t)return A(F,j(")"),ut($t,")"),$,U("=>"),n,B);if("variable"==t)return M(F,At,U("=>"),n,B)}var r=i?K:Y;return T.hasOwnProperty(t)?A(r):"function"==t?A(Nt,r):"class"==t||u&&"interface"==e?(I.marked="keyword",A(j("form"),Ut,$)):"keyword c"==t||"async"==t?A(i?Z:q):"("==t?A(j(")"),X,U(")"),$,r):"operator"==t||"spread"==t?A(i?Z:q):"["==t?A(j("]"),te,$,r):"{"==t?ht(at,"}",null,r):"quasi"==t?M(J,r):"new"==t?A(it(i)):A()}function X(t){return t.match(/[;\}\)\],]/)?M():M(q)}function Y(t,e){return","==t?A(X):K(t,e,!1)}function K(t,e,i){var n=0==i?Y:K,r=0==i?q:Z;return"=>"==t?A(F,i?et:tt,B):"operator"==t?/\+\+|--/.test(e)||u&&"!"==e?A(n):u&&"<"==e&&I.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?A(j(">"),ut(yt,">"),$,n):"?"==e?A(q,U(":"),r):A(r):"quasi"==t?M(J,n):";"!=t?"("==t?ht(Z,")","call",n):"."==t?A(st,n):"["==t?A(j("]"),X,U("]"),$,n):u&&"as"==e?(I.marked="keyword",A(yt,n)):"regexp"==t?(I.state.lastType=I.marked="operator",I.stream.backUp(I.stream.pos-I.stream.start-1),A(r)):void 0:void 0}function J(t,e){return"quasi"!=t?M():"${"!=e.slice(e.length-2)?A(J):A(X,Q)}function Q(t){if("}"==t)return I.marked="string-2",I.state.tokenize=x,A(J)}function tt(t){return w(I.stream,I.state),M("{"==t?V:q)}function et(t){return w(I.stream,I.state),M("{"==t?V:Z)}function it(t){return function(e){return"."==e?A(t?rt:nt):"variable"==e&&u?A(Ct,t?K:Y):M(t?Z:q)}}function nt(t,e){if("target"==e)return I.marked="keyword",A(Y)}function rt(t,e){if("target"==e)return I.marked="keyword",A(K)}function ot(t){return":"==t?A($,V):M(Y,U(";"),$)}function st(t){if("variable"==t)return I.marked="property",A()}function at(t,e){return"async"==t?(I.marked="property",A(at)):"variable"==t||"keyword"==I.style?(I.marked="property","get"==e||"set"==e?A(lt):(u&&I.state.fatArrowAt==I.stream.start&&(i=I.stream.match(/^\s*:\s*/,!1))&&(I.state.fatArrowAt=I.stream.pos+i[0].length),A(ct))):"number"==t||"string"==t?(I.marked=a?"property":I.style+" property",A(ct)):"jsonld-keyword"==t?A(ct):u&&z(e)?(I.marked="keyword",A(at)):"["==t?A(q,dt,U("]"),ct):"spread"==t?A(Z,ct):"*"==e?(I.marked="keyword",A(at)):":"==t?M(ct):void 0;var i}function lt(t){return"variable"!=t?M(ct):(I.marked="property",A(Nt))}function ct(t){return":"==t?A(Z):"("==t?M(Nt):void 0}function ut(t,e,i){function n(r,o){if(i?i.indexOf(r)>-1:","==r){var s=I.state.lexical;return"call"==s.info&&(s.pos=(s.pos||0)+1),A((function(i,n){return i==e||n==e?M():M(t)}),n)}return r==e||o==e?A():i&&i.indexOf(";")>-1?M(t):A(U(e))}return function(i,r){return i==e||r==e?A():M(t,n)}}function ht(t,e,i){for(var n=3;n<arguments.length;n++)I.cc.push(arguments[n]);return A(j(e,i),ut(t,e),$)}function pt(t){return"}"==t?A():M(V,pt)}function dt(t,e){if(u){if(":"==t)return A(yt);if("?"==e)return A(dt)}}function ft(t,e){if(u&&(":"==t||"in"==e))return A(yt)}function mt(t){if(u&&":"==t)return I.stream.match(/^\s*\w+\s+is\b/,!1)?A(q,gt,yt):A(yt)}function gt(t,e){if("is"==e)return I.marked="keyword",A()}function yt(t,e){return"keyof"==e||"typeof"==e||"infer"==e||"readonly"==e?(I.marked="keyword",A("typeof"==e?Z:yt)):"variable"==t||"void"==e?(I.marked="type",A(St)):"|"==e||"&"==e?A(yt):"string"==t||"number"==t||"atom"==t?A(St):"["==t?A(j("]"),ut(yt,"]",","),$,St):"{"==t?A(j("}"),vt,$,St):"("==t?A(ut(Tt,")"),_t,St):"<"==t?A(ut(yt,">"),yt):"quasi"==t?M(bt,St):void 0}function _t(t){if("=>"==t)return A(yt)}function vt(t){return t.match(/[\}\)\]]/)?A():","==t||";"==t?A(vt):M(xt,vt)}function xt(t,e){return"variable"==t||"keyword"==I.style?(I.marked="property",A(xt)):"?"==e||"number"==t||"string"==t?A(xt):":"==t?A(yt):"["==t?A(U("variable"),ft,U("]"),xt):"("==t?M(Bt,xt):t.match(/[;\}\)\],]/)?void 0:A()}function bt(t,e){return"quasi"!=t?M():"${"!=e.slice(e.length-2)?A(bt):A(yt,wt)}function wt(t){if("}"==t)return I.marked="string-2",I.state.tokenize=x,A(bt)}function Tt(t,e){return"variable"==t&&I.stream.match(/^\s*[?:]/,!1)||"?"==e?A(Tt):":"==t?A(yt):"spread"==t?A(Tt):M(yt)}function St(t,e){return"<"==e?A(j(">"),ut(yt,">"),$,St):"|"==e||"."==t||"&"==e?A(yt):"["==t?A(yt,U("]"),St):"extends"==e||"implements"==e?(I.marked="keyword",A(yt)):"?"==e?A(yt,U(":"),yt):void 0}function Ct(t,e){if("<"==e)return A(j(">"),ut(yt,">"),$,St)}function Et(){return M(yt,It)}function It(t,e){if("="==e)return A(yt)}function Mt(t,e){return"enum"==e?(I.marked="keyword",A(ee)):M(At,dt,Lt,zt)}function At(t,e){return u&&z(e)?(I.marked="keyword",A(At)):"variable"==t?(P(e),A()):"spread"==t?A(At):"["==t?ht(Pt,"]"):"{"==t?ht(kt,"}"):void 0}function kt(t,e){return"variable"!=t||I.stream.match(/^\s*:/,!1)?("variable"==t&&(I.marked="property"),"spread"==t?A(At):"}"==t?M():"["==t?A(q,U("]"),U(":"),kt):A(U(":"),At,Lt)):(P(e),A(Lt))}function Pt(){return M(At,Lt)}function Lt(t,e){if("="==e)return A(Z)}function zt(t){if(","==t)return A(Mt)}function Dt(t,e){if("keyword b"==t&&"else"==e)return A(j("form","else"),V,$)}function Rt(t,e){return"await"==e?A(Rt):"("==t?A(j(")"),Ot,$):void 0}function Ot(t){return"var"==t?A(Mt,Ft):"variable"==t?A(Ft):M(Ft)}function Ft(t,e){return")"==t?A():";"==t?A(Ft):"in"==e||"of"==e?(I.marked="keyword",A(q,Ft)):M(q,Ft)}function Nt(t,e){return"*"==e?(I.marked="keyword",A(Nt)):"variable"==t?(P(e),A(Nt)):"("==t?A(F,j(")"),ut($t,")"),$,mt,V,B):u&&"<"==e?A(j(">"),ut(Et,">"),$,Nt):void 0}function Bt(t,e){return"*"==e?(I.marked="keyword",A(Bt)):"variable"==t?(P(e),A(Bt)):"("==t?A(F,j(")"),ut($t,")"),$,mt,B):u&&"<"==e?A(j(">"),ut(Et,">"),$,Bt):void 0}function jt(t,e){return"keyword"==t||"variable"==t?(I.marked="type",A(jt)):"<"==e?A(j(">"),ut(Et,">"),$):void 0}function $t(t,e){return"@"==e&&A(q,$t),"spread"==t?A($t):u&&z(e)?(I.marked="keyword",A($t)):u&&"this"==t?A(dt,Lt):M(At,dt,Lt)}function Ut(t,e){return"variable"==t?Vt(t,e):Gt(t,e)}function Vt(t,e){if("variable"==t)return P(e),A(Gt)}function Gt(t,e){return"<"==e?A(j(">"),ut(Et,">"),$,Gt):"extends"==e||"implements"==e||u&&","==t?("implements"==e&&(I.marked="keyword"),A(u?yt:q,Gt)):"{"==t?A(j("}"),qt,$):void 0}function qt(t,e){return"async"==t||"variable"==t&&("static"==e||"get"==e||"set"==e||u&&z(e))&&I.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(I.marked="keyword",A(qt)):"variable"==t||"keyword"==I.style?(I.marked="property",A(Zt,qt)):"number"==t||"string"==t?A(Zt,qt):"["==t?A(q,dt,U("]"),Zt,qt):"*"==e?(I.marked="keyword",A(qt)):u&&"("==t?M(Bt,qt):";"==t||","==t?A(qt):"}"==t?A():"@"==e?A(q,qt):void 0}function Zt(t,e){if("!"==e)return A(Zt);if("?"==e)return A(Zt);if(":"==t)return A(yt,Lt);if("="==e)return A(Z);var i=I.state.lexical.prev;return M(i&&"interface"==i.info?Bt:Nt)}function Wt(t,e){return"*"==e?(I.marked="keyword",A(Qt,U(";"))):"default"==e?(I.marked="keyword",A(q,U(";"))):"{"==t?A(ut(Ht,"}"),Qt,U(";")):M(V)}function Ht(t,e){return"as"==e?(I.marked="keyword",A(U("variable"))):"variable"==t?M(Z,Ht):void 0}function Xt(t){return"string"==t?A():"("==t?M(q):"."==t?M(Y):M(Yt,Kt,Qt)}function Yt(t,e){return"{"==t?ht(Yt,"}"):("variable"==t&&P(e),"*"==e&&(I.marked="keyword"),A(Jt))}function Kt(t){if(","==t)return A(Yt,Kt)}function Jt(t,e){if("as"==e)return I.marked="keyword",A(Yt)}function Qt(t,e){if("from"==e)return I.marked="keyword",A(q)}function te(t){return"]"==t?A():M(ut(Z,"]"))}function ee(){return M(j("form"),At,U("{"),j("}"),ut(ie,"}"),$,$)}function ie(){return M(At,Lt)}function ne(t,e){return"operator"==t.lastType||","==t.lastType||d.test(e.charAt(0))||/[,.]/.test(e.charAt(0))}function re(t,e,i){return e.tokenize==y&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(e.lastType)||"quasi"==e.lastType&&/\{\s*$/.test(t.string.slice(0,t.pos-(i||0)))}return F.lex=N.lex=!0,B.lex=!0,$.lex=!0,{startState:function(t){var e={tokenize:y,lastType:"sof",cc:[],lexical:new S((t||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new D(null,null,!1),indented:t||0};return i.globalVars&&"object"==typeof i.globalVars&&(e.globalVars=i.globalVars),e},token:function(t,e){if(t.sol()&&(e.lexical.hasOwnProperty("align")||(e.lexical.align=!1),e.indented=t.indentation(),w(t,e)),e.tokenize!=v&&t.eatSpace())return null;var i=e.tokenize(t,e);return"comment"==n?i:(e.lastType="operator"!=n||"++"!=r&&"--"!=r?n:"incdec",E(e,i,n,r,t))},indent:function(e,n){if(e.tokenize==v||e.tokenize==x)return t.Pass;if(e.tokenize!=y)return 0;var r,a=n&&n.charAt(0),l=e.lexical;if(!/^\s*else\b/.test(n))for(var c=e.cc.length-1;c>=0;--c){var u=e.cc[c];if(u==$)l=l.prev;else if(u!=Dt&&u!=B)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(r=e.cc[e.cc.length-1])&&(r==Y||r==K)&&!/^[,\.=+\-*:?[\(]/.test(n));)l=l.prev;s&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var h=l.type,p=a==h;return"vardef"==h?l.indented+("operator"==e.lastType||","==e.lastType?l.info.length+1:0):"form"==h&&"{"==a?l.indented:"form"==h?l.indented+o:"stat"==h?l.indented+(ne(e,n)?s||o:0):"switch"!=l.info||p||0==i.doubleIndentSwitch?l.align?l.column+(p?0:1):l.indented+(p?0:o):l.indented+(/^(?:case|default)\b/.test(n)?o:2*o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:re,skipExpression:function(e){E(e,"atom","atom","true",new t.StringStream("",2,null))}}})),t.registerHelper("wordChars","javascript",/[\w$]/),t.defineMIME("text/javascript","javascript"),t.defineMIME("text/ecmascript","javascript"),t.defineMIME("application/javascript","javascript"),t.defineMIME("application/x-javascript","javascript"),t.defineMIME("application/ecmascript","javascript"),t.defineMIME("application/json",{name:"javascript",json:!0}),t.defineMIME("application/x-json",{name:"javascript",json:!0}),t.defineMIME("application/manifest+json",{name:"javascript",json:!0}),t.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),t.defineMIME("text/typescript",{name:"javascript",typescript:!0}),t.defineMIME("application/typescript",{name:"javascript",typescript:!0})}(Ru.exports=function(){var t=navigator.userAgent,e=navigator.platform,i=/gecko\/\d/i.test(t),n=/MSIE \d/.test(t),r=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(t),o=/Edge\/(\d+)/.exec(t),s=n||r||o,a=s&&(n?document.documentMode||6:+(o||r)[1]),l=!o&&/WebKit\//.test(t),c=l&&/Qt\/\d+\.\d+/.test(t),u=!o&&/Chrome\/(\d+)/.exec(t),h=u&&+u[1],p=/Opera\//.test(t),d=/Apple Computer/.test(navigator.vendor),f=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(t),m=/PhantomJS/.test(t),g=d&&(/Mobile\/\w+/.test(t)||navigator.maxTouchPoints>2),y=/Android/.test(t),_=g||y||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(t),v=g||/Mac/.test(e),x=/\bCrOS\b/.test(t),b=/win/i.test(e),w=p&&t.match(/Version\/(\d*\.\d*)/);w&&(w=Number(w[1])),w&&w>=15&&(p=!1,l=!0);var T=v&&(c||p&&(null==w||w<12.11)),S=i||s&&a>=9;function C(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}var E,I=function(t,e){var i=t.className,n=C(e).exec(i);if(n){var r=i.slice(n.index+n[0].length);t.className=i.slice(0,n.index)+(r?n[1]+r:"")}};function M(t){for(var e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function A(t,e){return M(t).appendChild(e)}function k(t,e,i,n){var r=document.createElement(t);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof e)r.appendChild(document.createTextNode(e));else if(e)for(var o=0;o<e.length;++o)r.appendChild(e[o]);return r}function P(t,e,i,n){var r=k(t,e,i,n);return r.setAttribute("role","presentation"),r}function L(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function z(){var t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function D(t,e){var i=t.className;C(e).test(i)||(t.className+=(i?" ":"")+e)}function R(t,e){for(var i=t.split(" "),n=0;n<i.length;n++)i[n]&&!C(i[n]).test(e)&&(e+=" "+i[n]);return e}E=document.createRange?function(t,e,i,n){var r=document.createRange();return r.setEnd(n||t,i),r.setStart(t,e),r}:function(t,e,i){var n=document.body.createTextRange();try{n.moveToElementText(t.parentNode)}catch(t){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",e),n};var O=function(t){t.select()};function F(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function N(t,e,i){for(var n in e||(e={}),t)!t.hasOwnProperty(n)||!1===i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e}function B(t,e,i,n,r){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(var o=n||0,s=r||0;;){var a=t.indexOf("\t",o);if(a<0||a>=e)return s+(e-o);s+=a-o,s+=i-s%i,o=a+1}}g?O=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:s&&(O=function(t){try{t.select()}catch(t){}});var j=function(){this.id=null,this.f=null,this.time=0,this.handler=F(this.onTimeout,this)};function $(t,e){for(var i=0;i<t.length;++i)if(t[i]==e)return i;return-1}j.prototype.onTimeout=function(t){t.id=0,t.time<=+new Date?t.f():setTimeout(t.handler,t.time-+new Date)},j.prototype.set=function(t,e){this.f=e;var i=+new Date+t;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,t),this.time=i)};var U=50,V={toString:function(){return"CodeMirror.Pass"}},G={scroll:!1},q={origin:"*mouse"},Z={origin:"+move"};function W(t,e,i){for(var n=0,r=0;;){var o=t.indexOf("\t",n);-1==o&&(o=t.length);var s=o-n;if(o==t.length||r+s>=e)return n+Math.min(s,e-r);if(r+=o-n,n=o+1,(r+=i-r%i)>=e)return n}}var H=[""];function X(t){for(;H.length<=t;)H.push(Y(H)+" ");return H[t]}function Y(t){return t[t.length-1]}function K(t,e){for(var i=[],n=0;n<t.length;n++)i[n]=e(t[n],n);return i}function J(t,e,i){for(var n=0,r=i(e);n<t.length&&i(t[n])<=r;)n++;t.splice(n,0,e)}function Q(){}function tt(t,e){var i;return Object.create?i=Object.create(t):(Q.prototype=t,i=new Q),e&&N(e,i),i}var et=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function it(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||et.test(t))}function nt(t,e){return e?!!(e.source.indexOf("\\w")>-1&&it(t))||e.test(t):it(t)}function rt(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}var ot=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function st(t){return t.charCodeAt(0)>=768&&ot.test(t)}function at(t,e,i){for(;(i<0?e>0:e<t.length)&&st(t.charAt(e));)e+=i;return e}function lt(t,e,i){for(var n=e>i?-1:1;;){if(e==i)return e;var r=(e+i)/2,o=n<0?Math.ceil(r):Math.floor(r);if(o==e)return t(o)?e:i;t(o)?i=o:e=o+n}}function ct(t,e,i,n){if(!t)return n(e,i,"ltr",0);for(var r=!1,o=0;o<t.length;++o){var s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(n(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),r=!0)}r||n(e,i,"ltr")}var ut=null;function ht(t,e,i){var n;ut=null;for(var r=0;r<t.length;++r){var o=t[r];if(o.from<e&&o.to>e)return r;o.to==e&&(o.from!=o.to&&"before"==i?n=r:ut=r),o.from==e&&(o.from!=o.to&&"before"!=i?n=r:ut=r)}return null!=n?n:ut}var pt=function(){var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",e="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function i(i){return i<=247?t.charAt(i):1424<=i&&i<=1524?"R":1536<=i&&i<=1785?e.charAt(i-1536):1774<=i&&i<=2220?"r":8192<=i&&i<=8203?"w":8204==i?"b":"L"}var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;function l(t,e,i){this.level=t,this.from=e,this.to=i}return function(t,e){var c="ltr"==e?"L":"R";if(0==t.length||"ltr"==e&&!n.test(t))return!1;for(var u=t.length,h=[],p=0;p<u;++p)h.push(i(t.charCodeAt(p)));for(var d=0,f=c;d<u;++d){var m=h[d];"m"==m?h[d]=f:f=m}for(var g=0,y=c;g<u;++g){var _=h[g];"1"==_&&"r"==y?h[g]="n":o.test(_)&&(y=_,"r"==_&&(h[g]="R"))}for(var v=1,x=h[0];v<u-1;++v){var b=h[v];"+"==b&&"1"==x&&"1"==h[v+1]?h[v]="1":","!=b||x!=h[v+1]||"1"!=x&&"n"!=x||(h[v]=x),x=b}for(var w=0;w<u;++w){var T=h[w];if(","==T)h[w]="N";else if("%"==T){var S=void 0;for(S=w+1;S<u&&"%"==h[S];++S);for(var C=w&&"!"==h[w-1]||S<u&&"1"==h[S]?"1":"N",E=w;E<S;++E)h[E]=C;w=S-1}}for(var I=0,M=c;I<u;++I){var A=h[I];"L"==M&&"1"==A?h[I]="L":o.test(A)&&(M=A)}for(var k=0;k<u;++k)if(r.test(h[k])){var P=void 0;for(P=k+1;P<u&&r.test(h[P]);++P);for(var L="L"==(k?h[k-1]:c),z=L==("L"==(P<u?h[P]:c))?L?"L":"R":c,D=k;D<P;++D)h[D]=z;k=P-1}for(var R,O=[],F=0;F<u;)if(s.test(h[F])){var N=F;for(++F;F<u&&s.test(h[F]);++F);O.push(new l(0,N,F))}else{var B=F,j=O.length,$="rtl"==e?1:0;for(++F;F<u&&"L"!=h[F];++F);for(var U=B;U<F;)if(a.test(h[U])){B<U&&(O.splice(j,0,new l(1,B,U)),j+=$);var V=U;for(++U;U<F&&a.test(h[U]);++U);O.splice(j,0,new l(2,V,U)),j+=$,B=U}else++U;B<F&&O.splice(j,0,new l(1,B,F))}return"ltr"==e&&(1==O[0].level&&(R=t.match(/^\s+/))&&(O[0].from=R[0].length,O.unshift(new l(0,0,R[0].length))),1==Y(O).level&&(R=t.match(/\s+$/))&&(Y(O).to-=R[0].length,O.push(new l(0,u-R[0].length,u)))),"rtl"==e?O.reverse():O}}();function dt(t,e){var i=t.order;return null==i&&(i=t.order=pt(t.text,e)),i}var ft=[],mt=function(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{var n=t._handlers||(t._handlers={});n[e]=(n[e]||ft).concat(i)}};function gt(t,e){return t._handlers&&t._handlers[e]||ft}function yt(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else{var n=t._handlers,r=n&&n[e];if(r){var o=$(r,i);o>-1&&(n[e]=r.slice(0,o).concat(r.slice(o+1)))}}}function _t(t,e){var i=gt(t,e);if(i.length)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function vt(t,e,i){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),_t(t,i||e.type,t,e),Ct(e)||e.codemirrorIgnore}function xt(t){var e=t._handlers&&t._handlers.cursorActivity;if(e)for(var i=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]),n=0;n<e.length;++n)-1==$(i,e[n])&&i.push(e[n])}function bt(t,e){return gt(t,e).length>0}function wt(t){t.prototype.on=function(t,e){mt(this,t,e)},t.prototype.off=function(t,e){yt(this,t,e)}}function Tt(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function St(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function Ct(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function Et(t){Tt(t),St(t)}function It(t){return t.target||t.srcElement}function Mt(t){var e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),v&&t.ctrlKey&&1==e&&(e=3),e}var At,kt,Pt=function(){if(s&&a<9)return!1;var t=k("div");return"draggable"in t||"dragDrop"in t}();function Lt(t){if(null==At){var e=k("span","​");A(t,k("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(At=e.offsetWidth<=1&&e.offsetHeight>2&&!(s&&a<8))}var i=At?k("span","​"):k("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function zt(t){if(null!=kt)return kt;var e=A(t,document.createTextNode("AخA")),i=E(e,0,1).getBoundingClientRect(),n=E(e,1,2).getBoundingClientRect();return M(t),!(!i||i.left==i.right)&&(kt=n.right-i.right<3)}var Dt,Rt=3!="\n\nb".split(/\n/).length?function(t){for(var e=0,i=[],n=t.length;e<=n;){var r=t.indexOf("\n",e);-1==r&&(r=t.length);var o=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),e+=s+1):(i.push(o),e=r+1)}return i}:function(t){return t.split(/\r\n?|\n/)},Ot=window.getSelection?function(t){try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:function(t){var e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},Ft="oncopy"in(Dt=k("div"))||(Dt.setAttribute("oncopy","return;"),"function"==typeof Dt.oncopy),Nt=null;function Bt(t){if(null!=Nt)return Nt;var e=A(t,k("span","x")),i=e.getBoundingClientRect(),n=E(e,0,1).getBoundingClientRect();return Nt=Math.abs(i.left-n.left)>1}var jt={},$t={};function Ut(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),jt[t]=e}function Vt(t,e){$t[t]=e}function Gt(t){if("string"==typeof t&&$t.hasOwnProperty(t))t=$t[t];else if(t&&"string"==typeof t.name&&$t.hasOwnProperty(t.name)){var e=$t[t.name];"string"==typeof e&&(e={name:e}),(t=tt(e,t)).name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return Gt("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return Gt("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function qt(t,e){e=Gt(e);var i=jt[e.name];if(!i)return qt(t,"text/plain");var n=i(t,e);if(Zt.hasOwnProperty(e.name)){var r=Zt[e.name];for(var o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=r[o])}if(n.name=e.name,e.helperType&&(n.helperType=e.helperType),e.modeProps)for(var s in e.modeProps)n[s]=e.modeProps[s];return n}var Zt={};function Wt(t,e){N(e,Zt.hasOwnProperty(t)?Zt[t]:Zt[t]={})}function Ht(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);var i={};for(var n in e){var r=e[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Xt(t,e){for(var i;t.innerMode&&(i=t.innerMode(e))&&i.mode!=t;)e=i.state,t=i.mode;return i||{mode:t,state:e}}function Yt(t,e,i){return!t.startState||t.startState(e,i)}var Kt=function(t,e,i){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};function Jt(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");for(var i=t;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(e<o){i=r;break}e-=o}return i.lines[e]}function Qt(t,e,i){var n=[],r=e.line;return t.iter(e.line,i.line+1,(function(t){var o=t.text;r==i.line&&(o=o.slice(0,i.ch)),r==e.line&&(o=o.slice(e.ch)),n.push(o),++r})),n}function te(t,e,i){var n=[];return t.iter(e,i,(function(t){n.push(t.text)})),n}function ee(t,e){var i=e-t.height;if(i)for(var n=t;n;n=n.parent)n.height+=i}function ie(t){if(null==t.parent)return null;for(var e=t.parent,i=$(e.lines,t),n=e.parent;n;e=n,n=n.parent)for(var r=0;n.children[r]!=e;++r)i+=n.children[r].chunkSize();return i+e.first}function ne(t,e){var i=t.first;t:do{for(var n=0;n<t.children.length;++n){var r=t.children[n],o=r.height;if(e<o){t=r;continue t}e-=o,i+=r.chunkSize()}return i}while(!t.lines);for(var s=0;s<t.lines.length;++s){var a=t.lines[s].height;if(e<a)break;e-=a}return i+s}function re(t,e){return e>=t.first&&e<t.first+t.size}function oe(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function se(t,e,i){if(void 0===i&&(i=null),!(this instanceof se))return new se(t,e,i);this.line=t,this.ch=e,this.sticky=i}function ae(t,e){return t.line-e.line||t.ch-e.ch}function le(t,e){return t.sticky==e.sticky&&0==ae(t,e)}function ce(t){return se(t.line,t.ch)}function ue(t,e){return ae(t,e)<0?e:t}function he(t,e){return ae(t,e)<0?t:e}function pe(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function de(t,e){if(e.line<t.first)return se(t.first,0);var i=t.first+t.size-1;return e.line>i?se(i,Jt(t,i).text.length):fe(e,Jt(t,e.line).text.length)}function fe(t,e){var i=t.ch;return null==i||i>e?se(t.line,e):i<0?se(t.line,0):t}function me(t,e){for(var i=[],n=0;n<e.length;n++)i[n]=de(t,e[n]);return i}Kt.prototype.eol=function(){return this.pos>=this.string.length},Kt.prototype.sol=function(){return this.pos==this.lineStart},Kt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Kt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Kt.prototype.eat=function(t){var e=this.string.charAt(this.pos);if("string"==typeof t?e==t:e&&(t.test?t.test(e):t(e)))return++this.pos,e},Kt.prototype.eatWhile=function(t){for(var e=this.pos;this.eat(t););return this.pos>e},Kt.prototype.eatSpace=function(){for(var t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t},Kt.prototype.skipToEnd=function(){this.pos=this.string.length},Kt.prototype.skipTo=function(t){var e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0},Kt.prototype.backUp=function(t){this.pos-=t},Kt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=B(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?B(this.string,this.lineStart,this.tabSize):0)},Kt.prototype.indentation=function(){return B(this.string,null,this.tabSize)-(this.lineStart?B(this.string,this.lineStart,this.tabSize):0)},Kt.prototype.match=function(t,e,i){if("string"!=typeof t){var n=this.string.slice(this.pos).match(t);return n&&n.index>0?null:(n&&!1!==e&&(this.pos+=n[0].length),n)}var r=function(t){return i?t.toLowerCase():t};if(r(this.string.substr(this.pos,t.length))==r(t))return!1!==e&&(this.pos+=t.length),!0},Kt.prototype.current=function(){return this.string.slice(this.start,this.pos)},Kt.prototype.hideFirstChars=function(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}},Kt.prototype.lookAhead=function(t){var e=this.lineOracle;return e&&e.lookAhead(t)},Kt.prototype.baseToken=function(){var t=this.lineOracle;return t&&t.baseToken(this.pos)};var ge=function(t,e){this.state=t,this.lookAhead=e},ye=function(t,e,i,n){this.state=e,this.doc=t,this.line=i,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1};function _e(t,e,i,n){var r=[t.state.modeGen],o={};Ie(t,e.text,t.doc.mode,i,(function(t,e){return r.push(t,e)}),o,n);for(var s=i.state,a=function(n){i.baseTokens=r;var a=t.state.overlays[n],l=1,c=0;i.state=!0,Ie(t,e.text,a.mode,i,(function(t,e){for(var i=l;c<t;){var n=r[l];n>t&&r.splice(l,1,t,r[l+1],n),l+=2,c=Math.min(t,n)}if(e)if(a.opaque)r.splice(i,l-i,t,"overlay "+e),l=i+2;else for(;i<l;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"overlay "+e}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1},l=0;l<t.state.overlays.length;++l)a(l);return{styles:r,classes:o.bgClass||o.textClass?o:null}}function ve(t,e,i){if(!e.styles||e.styles[0]!=t.state.modeGen){var n=xe(t,ie(e)),r=e.text.length>t.options.maxHighlightLength&&Ht(t.doc.mode,n.state),o=_e(t,e,n);r&&(n.state=r),e.stateAfter=n.save(!r),e.styles=o.styles,o.classes?e.styleClasses=o.classes:e.styleClasses&&(e.styleClasses=null),i===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function xe(t,e,i){var n=t.doc,r=t.display;if(!n.mode.startState)return new ye(n,!0,e);var o=Me(t,e,i),s=o>n.first&&Jt(n,o-1).stateAfter,a=s?ye.fromSaved(n,s,o):new ye(n,Yt(n.mode),o);return n.iter(o,e,(function(i){be(t,i.text,a);var n=a.line;i.stateAfter=n==e-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()})),i&&(n.modeFrontier=a.line),a}function be(t,e,i,n){var r=t.doc.mode,o=new Kt(e,t.options.tabSize,i);for(o.start=o.pos=n||0,""==e&&we(r,i.state);!o.eol();)Te(r,o,i.state),o.start=o.pos}function we(t,e){if(t.blankLine)return t.blankLine(e);if(t.innerMode){var i=Xt(t,e);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function Te(t,e,i,n){for(var r=0;r<10;r++){n&&(n[0]=Xt(t,i).mode);var o=t.token(e,i);if(e.pos>e.start)return o}throw new Error("Mode "+t.name+" failed to advance stream.")}ye.prototype.lookAhead=function(t){var e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e},ye.prototype.baseToken=function(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;var e=this.baseTokens[this.baseTokenPos+1];return{type:e&&e.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}},ye.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},ye.fromSaved=function(t,e,i){return e instanceof ge?new ye(t,Ht(t.mode,e.state),i,e.lookAhead):new ye(t,Ht(t.mode,e),i)},ye.prototype.save=function(t){var e=!1!==t?Ht(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new ge(e,this.maxLookAhead):e};var Se=function(t,e,i){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=i};function Ce(t,e,i,n){var r,o,s=t.doc,a=s.mode,l=Jt(s,(e=de(s,e)).line),c=xe(t,e.line,i),u=new Kt(l.text,t.options.tabSize,c);for(n&&(o=[]);(n||u.pos<e.ch)&&!u.eol();)u.start=u.pos,r=Te(a,u,c.state),n&&o.push(new Se(u,r,Ht(s.mode,c.state)));return n?o:new Se(u,r,c.state)}function Ee(t,e){if(t)for(;;){var i=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;t=t.slice(0,i.index)+t.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==e[n]?e[n]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(e[n])||(e[n]+=" "+i[2])}return t}function Ie(t,e,i,n,r,o,s){var a=i.flattenSpans;null==a&&(a=t.options.flattenSpans);var l,c=0,u=null,h=new Kt(e,t.options.tabSize,n),p=t.options.addModeClass&&[null];for(""==e&&Ee(we(i,n.state),o);!h.eol();){if(h.pos>t.options.maxHighlightLength?(a=!1,s&&be(t,e,n,h.pos),h.pos=e.length,l=null):l=Ee(Te(i,h,n.state,p),o),p){var d=p[0].name;d&&(l="m-"+(l?d+" "+l:d))}if(!a||u!=l){for(;c<h.start;)r(c=Math.min(h.start,c+5e3),u);u=l}h.start=h.pos}for(;c<h.pos;){var f=Math.min(h.pos,c+5e3);r(f,u),c=f}}function Me(t,e,i){for(var n,r,o=t.doc,s=i?-1:e-(t.doc.mode.innerMode?1e3:100),a=e;a>s;--a){if(a<=o.first)return o.first;var l=Jt(o,a-1),c=l.stateAfter;if(c&&(!i||a+(c instanceof ge?c.lookAhead:0)<=o.modeFrontier))return a;var u=B(l.text,null,t.options.tabSize);(null==r||n>u)&&(r=a-1,n=u)}return r}function Ae(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),!(t.highlightFrontier<e-10)){for(var i=t.first,n=e-1;n>i;n--){var r=Jt(t,n).stateAfter;if(r&&(!(r instanceof ge)||n+r.lookAhead<e)){i=n+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,i)}}var ke=!1,Pe=!1;function Le(){ke=!0}function ze(){Pe=!0}function De(t,e,i){this.marker=t,this.from=e,this.to=i}function Re(t,e){if(t)for(var i=0;i<t.length;++i){var n=t[i];if(n.marker==e)return n}}function Oe(t,e){for(var i,n=0;n<t.length;++n)t[n]!=e&&(i||(i=[])).push(t[n]);return i}function Fe(t,e,i){var n=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));n&&t.markedSpans&&n.has(t.markedSpans)?t.markedSpans.push(e):(t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],n&&n.add(t.markedSpans)),e.marker.attachLine(t)}function Ne(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e)||o.from==e&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(n||(n=[])).push(new De(s,o.from,a?null:o.to))}}return n}function Be(t,e,i){var n;if(t)for(var r=0;r<t.length;++r){var o=t[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=e:o.to>e)||o.from==e&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(n||(n=[])).push(new De(s,a?null:o.from-e,null==o.to?null:o.to-e))}}return n}function je(t,e){if(e.full)return null;var i=re(t,e.from.line)&&Jt(t,e.from.line).markedSpans,n=re(t,e.to.line)&&Jt(t,e.to.line).markedSpans;if(!i&&!n)return null;var r=e.from.ch,o=e.to.ch,s=0==ae(e.from,e.to),a=Ne(i,r,s),l=Be(n,o,s),c=1==e.text.length,u=Y(e.text).length+(c?r:0);if(a)for(var h=0;h<a.length;++h){var p=a[h];if(null==p.to){var d=Re(l,p.marker);d?c&&(p.to=null==d.to?null:d.to+u):p.to=r}}if(l)for(var f=0;f<l.length;++f){var m=l[f];null!=m.to&&(m.to+=u),null==m.from?Re(a,m.marker)||(m.from=u,c&&(a||(a=[])).push(m)):(m.from+=u,c&&(a||(a=[])).push(m))}a&&(a=$e(a)),l&&l!=a&&(l=$e(l));var g=[a];if(!c){var y,_=e.text.length-2;if(_>0&&a)for(var v=0;v<a.length;++v)null==a[v].to&&(y||(y=[])).push(new De(a[v].marker,null,null));for(var x=0;x<_;++x)g.push(y);g.push(l)}return g}function $e(t){for(var e=0;e<t.length;++e){var i=t[e];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function Ue(t,e,i){var n=null;if(t.iter(e.line,i.line+1,(function(t){if(t.markedSpans)for(var e=0;e<t.markedSpans.length;++e){var i=t.markedSpans[e].marker;!i.readOnly||n&&-1!=$(n,i)||(n||(n=[])).push(i)}})),!n)return null;for(var r=[{from:e,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var c=r[l];if(!(ae(c.to,a.from)<0||ae(c.from,a.to)>0)){var u=[l,1],h=ae(c.from,a.from),p=ae(c.to,a.to);(h<0||!s.inclusiveLeft&&!h)&&u.push({from:c.from,to:a.from}),(p>0||!s.inclusiveRight&&!p)&&u.push({from:a.to,to:c.to}),r.splice.apply(r,u),l+=u.length-3}}return r}function Ve(t){var e=t.markedSpans;if(e){for(var i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function Ge(t,e){if(e){for(var i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function qe(t){return t.inclusiveLeft?-1:0}function Ze(t){return t.inclusiveRight?1:0}function We(t,e){var i=t.lines.length-e.lines.length;if(0!=i)return i;var n=t.find(),r=e.find(),o=ae(n.from,r.from)||qe(t)-qe(e);if(o)return-o;var s=ae(n.to,r.to)||Ze(t)-Ze(e);return s||e.id-t.id}function He(t,e){var i,n=Pe&&t.markedSpans;if(n)for(var r=void 0,o=0;o<n.length;++o)(r=n[o]).marker.collapsed&&null==(e?r.from:r.to)&&(!i||We(i,r.marker)<0)&&(i=r.marker);return i}function Xe(t){return He(t,!0)}function Ye(t){return He(t,!1)}function Ke(t,e){var i,n=Pe&&t.markedSpans;if(n)for(var r=0;r<n.length;++r){var o=n[r];o.marker.collapsed&&(null==o.from||o.from<e)&&(null==o.to||o.to>e)&&(!i||We(i,o.marker)<0)&&(i=o.marker)}return i}function Je(t,e,i,n,r){var o=Jt(t,e),s=Pe&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),u=ae(c.from,i)||qe(l.marker)-qe(r),h=ae(c.to,n)||Ze(l.marker)-Ze(r);if(!(u>=0&&h<=0||u<=0&&h>=0)&&(u<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?ae(c.to,i)>=0:ae(c.to,i)>0)||u>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?ae(c.from,n)<=0:ae(c.from,n)<0)))return!0}}}function Qe(t){for(var e;e=Xe(t);)t=e.find(-1,!0).line;return t}function ti(t){for(var e;e=Ye(t);)t=e.find(1,!0).line;return t}function ei(t){for(var e,i;e=Ye(t);)t=e.find(1,!0).line,(i||(i=[])).push(t);return i}function ii(t,e){var i=Jt(t,e),n=Qe(i);return i==n?e:ie(n)}function ni(t,e){if(e>t.lastLine())return e;var i,n=Jt(t,e);if(!ri(t,n))return e;for(;i=Ye(n);)n=i.find(1,!0).line;return ie(n)+1}function ri(t,e){var i=Pe&&e.markedSpans;if(i)for(var n=void 0,r=0;r<i.length;++r)if((n=i[r]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&oi(t,e,n))return!0}}function oi(t,e,i){if(null==i.to){var n=i.marker.find(1,!0);return oi(t,n.line,Re(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(var r=void 0,o=0;o<e.markedSpans.length;++o)if((r=e.markedSpans[o]).marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&oi(t,e,r))return!0}function si(t){for(var e=0,i=(t=Qe(t)).parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==t)break;e+=r.height}for(var o=i.parent;o;o=(i=o).parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;e+=a.height}return e}function ai(t){if(0==t.height)return 0;for(var e,i=t.text.length,n=t;e=Xe(n);){var r=e.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=t;e=Ye(n);){var o=e.find(0,!0);i-=n.text.length-o.from.ch,i+=(n=o.to.line).text.length-o.to.ch}return i}function li(t){var e=t.display,i=t.doc;e.maxLine=Jt(i,i.first),e.maxLineLength=ai(e.maxLine),e.maxLineChanged=!0,i.iter((function(t){var i=ai(t);i>e.maxLineLength&&(e.maxLineLength=i,e.maxLine=t)}))}var ci=function(t,e,i){this.text=t,Ge(this,e),this.height=i?i(this):1};function ui(t,e,i,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),Ve(t),Ge(t,i);var r=n?n(t):1;r!=t.height&&ee(t,r)}function hi(t){t.parent=null,Ve(t)}ci.prototype.lineNo=function(){return ie(this)},wt(ci);var pi={},di={};function fi(t,e){if(!t||/^\s*$/.test(t))return null;var i=e.addModeClass?di:pi;return i[t]||(i[t]=t.replace(/\S+/g,"cm-$&"))}function mi(t,e){var i=P("span",null,null,l?"padding-right: .1px":null),n={pre:P("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};e.measure={};for(var r=0;r<=(e.rest?e.rest.length:0);r++){var o=r?e.rest[r-1]:e.line,s=void 0;n.pos=0,n.addToken=yi,zt(t.display.measure)&&(s=dt(o,t.doc.direction))&&(n.addToken=vi(n.addToken,s)),n.map=[],bi(o,n,ve(t,o,e!=t.display.externalMeasured&&ie(o))),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=R(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=R(o.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Lt(t.display.measure))),0==r?(e.measure.map=n.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(n.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(l){var a=n.content.lastChild;(/\bcm-tab\b/.test(a.className)||a.querySelector&&a.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return _t(t,"renderLine",t,e.line,n.pre),n.pre.className&&(n.textClass=R(n.pre.className,n.textClass||"")),n}function gi(t){var e=k("span","•","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function yi(t,e,i,n,r,o,l){if(e){var c,u=t.splitSpaces?_i(e,t.trailingSpace):e,h=t.cm.state.specialChars,p=!1;if(h.test(e)){c=document.createDocumentFragment();for(var d=0;;){h.lastIndex=d;var f=h.exec(e),m=f?f.index-d:e.length-d;if(m){var g=document.createTextNode(u.slice(d,d+m));s&&a<9?c.appendChild(k("span",[g])):c.appendChild(g),t.map.push(t.pos,t.pos+m,g),t.col+=m,t.pos+=m}if(!f)break;d+=m+1;var y=void 0;if("\t"==f[0]){var _=t.cm.options.tabSize,v=_-t.col%_;(y=c.appendChild(k("span",X(v),"cm-tab"))).setAttribute("role","presentation"),y.setAttribute("cm-text","\t"),t.col+=v}else"\r"==f[0]||"\n"==f[0]?((y=c.appendChild(k("span","\r"==f[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",f[0]),t.col+=1):((y=t.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text",f[0]),s&&a<9?c.appendChild(k("span",[y])):c.appendChild(y),t.col+=1);t.map.push(t.pos,t.pos+1,y),t.pos++}}else t.col+=e.length,c=document.createTextNode(u),t.map.push(t.pos,t.pos+e.length,c),s&&a<9&&(p=!0),t.pos+=e.length;if(t.trailingSpace=32==u.charCodeAt(e.length-1),i||n||r||p||o||l){var x=i||"";n&&(x+=n),r&&(x+=r);var b=k("span",[c],x,o);if(l)for(var w in l)l.hasOwnProperty(w)&&"style"!=w&&"class"!=w&&b.setAttribute(w,l[w]);return t.content.appendChild(b)}t.content.appendChild(c)}}function _i(t,e){if(t.length>1&&!/  /.test(t))return t;for(var i=e,n="",r=0;r<t.length;r++){var o=t.charAt(r);" "!=o||!i||r!=t.length-1&&32!=t.charCodeAt(r+1)||(o=" "),n+=o,i=" "==o}return n}function vi(t,e){return function(i,n,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=i.pos,u=c+n.length;;){for(var h=void 0,p=0;p<e.length&&!((h=e[p]).to>c&&h.from<=c);p++);if(h.to>=u)return t(i,n,r,o,s,a,l);t(i,n.slice(0,h.to-c),r,o,null,a,l),o=null,n=n.slice(h.to-c),c=h.to}}}function xi(t,e,i,n){var r=!n&&i.widgetNode;r&&t.map.push(t.pos,t.pos+e,r),!n&&t.cm.display.input.needsContentAttribute&&(r||(r=t.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(t.cm.display.input.setUneditable(r),t.content.appendChild(r)),t.pos+=e,t.trailingSpace=!1}function bi(t,e,i){var n=t.markedSpans,r=t.text,o=0;if(n)for(var s,a,l,c,u,h,p,d=r.length,f=0,m=1,g="",y=0;;){if(y==f){l=c=u=a="",p=null,h=null,y=1/0;for(var _=[],v=void 0,x=0;x<n.length;++x){var b=n[x],w=b.marker;if("bookmark"==w.type&&b.from==f&&w.widgetNode)_.push(w);else if(b.from<=f&&(null==b.to||b.to>f||w.collapsed&&b.to==f&&b.from==f)){if(null!=b.to&&b.to!=f&&y>b.to&&(y=b.to,c=""),w.className&&(l+=" "+w.className),w.css&&(a=(a?a+";":"")+w.css),w.startStyle&&b.from==f&&(u+=" "+w.startStyle),w.endStyle&&b.to==y&&(v||(v=[])).push(w.endStyle,b.to),w.title&&((p||(p={})).title=w.title),w.attributes)for(var T in w.attributes)(p||(p={}))[T]=w.attributes[T];w.collapsed&&(!h||We(h.marker,w)<0)&&(h=b)}else b.from>f&&y>b.from&&(y=b.from)}if(v)for(var S=0;S<v.length;S+=2)v[S+1]==y&&(c+=" "+v[S]);if(!h||h.from==f)for(var C=0;C<_.length;++C)xi(e,0,_[C]);if(h&&(h.from||0)==f){if(xi(e,(null==h.to?d+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=d)break;for(var E=Math.min(d,y);;){if(g){var I=f+g.length;if(!h){var M=I>E?g.slice(0,E-f):g;e.addToken(e,M,s?s+l:l,u,f+M.length==y?c:"",a,p)}if(I>=E){g=g.slice(E-f),f=E;break}f=I,u=""}g=r.slice(o,o=i[m++]),s=fi(i[m++],e.cm.options)}}else for(var A=1;A<i.length;A+=2)e.addToken(e,r.slice(o,o=i[A]),fi(i[A+1],e.cm.options))}function wi(t,e,i){this.line=e,this.rest=ei(e),this.size=this.rest?ie(Y(this.rest))-i+1:1,this.node=this.text=null,this.hidden=ri(t,e)}function Ti(t,e,i){for(var n,r=[],o=e;o<i;o=n){var s=new wi(t.doc,Jt(t.doc,o),o);n=o+s.size,r.push(s)}return r}var Si=null;function Ci(t){Si?Si.ops.push(t):t.ownsGroup=Si={ops:[t],delayedCallbacks:[]}}function Ei(t){var e=t.delayedCallbacks,i=0;do{for(;i<e.length;i++)e[i].call(null);for(var n=0;n<t.ops.length;n++){var r=t.ops[n];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(i<e.length)}function Ii(t,e){var i=t.ownsGroup;if(i)try{Ei(i)}finally{Si=null,e(i)}}var Mi=null;function Ai(t,e){var i=gt(t,e);if(i.length){var n,r=Array.prototype.slice.call(arguments,2);Si?n=Si.delayedCallbacks:Mi?n=Mi:(n=Mi=[],setTimeout(ki,0));for(var o=function(t){n.push((function(){return i[t].apply(null,r)}))},s=0;s<i.length;++s)o(s)}}function ki(){var t=Mi;Mi=null;for(var e=0;e<t.length;++e)t[e]()}function Pi(t,e,i,n){for(var r=0;r<e.changes.length;r++){var o=e.changes[r];"text"==o?Ri(t,e):"gutter"==o?Fi(t,e,i,n):"class"==o?Oi(t,e):"widget"==o&&Ni(t,e,n)}e.changes=null}function Li(t){return t.node==t.text&&(t.node=k("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),s&&a<8&&(t.node.style.zIndex=2)),t.node}function zi(t,e){var i=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),e.background)i?e.background.className=i:(e.background.parentNode.removeChild(e.background),e.background=null);else if(i){var n=Li(e);e.background=n.insertBefore(k("div",null,i),n.firstChild),t.display.input.setUneditable(e.background)}}function Di(t,e){var i=t.display.externalMeasured;return i&&i.line==e.line?(t.display.externalMeasured=null,e.measure=i.measure,i.built):mi(t,e)}function Ri(t,e){var i=e.text.className,n=Di(t,e);e.text==e.node&&(e.node=n.pre),e.text.parentNode.replaceChild(n.pre,e.text),e.text=n.pre,n.bgClass!=e.bgClass||n.textClass!=e.textClass?(e.bgClass=n.bgClass,e.textClass=n.textClass,Oi(t,e)):i&&(e.text.className=i)}function Oi(t,e){zi(t,e),e.line.wrapClass?Li(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var i=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=i||""}function Fi(t,e,i,n){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){var r=Li(e);e.gutterBackground=k("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,"left: "+(t.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px"),t.display.input.setUneditable(e.gutterBackground),r.insertBefore(e.gutterBackground,e.text)}var o=e.line.gutterMarkers;if(t.options.lineNumbers||o){var s=Li(e),a=e.gutter=k("div",null,"CodeMirror-gutter-wrapper","left: "+(t.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");if(a.setAttribute("aria-hidden","true"),t.display.input.setUneditable(a),s.insertBefore(a,e.text),e.line.gutterClass&&(a.className+=" "+e.line.gutterClass),!t.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(e.lineNumber=a.appendChild(k("div",oe(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+t.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<t.display.gutterSpecs.length;++l){var c=t.display.gutterSpecs[l].className,u=o.hasOwnProperty(c)&&o[c];u&&a.appendChild(k("div",[u],"CodeMirror-gutter-elt","left: "+n.gutterLeft[c]+"px; width: "+n.gutterWidth[c]+"px"))}}}function Ni(t,e,i){e.alignable&&(e.alignable=null);for(var n=C("CodeMirror-linewidget"),r=e.node.firstChild,o=void 0;r;r=o)o=r.nextSibling,n.test(r.className)&&e.node.removeChild(r);ji(t,e,i)}function Bi(t,e,i,n){var r=Di(t,e);return e.text=e.node=r.pre,r.bgClass&&(e.bgClass=r.bgClass),r.textClass&&(e.textClass=r.textClass),Oi(t,e),Fi(t,e,i,n),ji(t,e,n),e.node}function ji(t,e,i){if($i(t,e.line,e,i,!0),e.rest)for(var n=0;n<e.rest.length;n++)$i(t,e.rest[n],e,i,!1)}function $i(t,e,i,n,r){if(e.widgets)for(var o=Li(i),s=0,a=e.widgets;s<a.length;++s){var l=a[s],c=k("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Ui(l,c,i,n),t.display.input.setUneditable(c),r&&l.above?o.insertBefore(c,i.gutter||i.text):o.appendChild(c),Ai(l,"redraw")}}function Ui(t,e,i,n){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);var r=n.wrapperWidth;e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function Vi(t){if(null!=t.height)return t.height;var e=t.doc.cm;if(!e)return 0;if(!L(document.body,t.node)){var i="position: relative;";t.coverGutter&&(i+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(i+="width: "+e.display.wrapper.clientWidth+"px;"),A(e.display.measure,k("div",[t.node],null,i))}return t.height=t.node.parentNode.offsetHeight}function Gi(t,e){for(var i=It(e);i!=t.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==t.sizer&&i!=t.mover)return!0}function qi(t){return t.lineSpace.offsetTop}function Zi(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function Wi(t){if(t.cachedPaddingH)return t.cachedPaddingH;var e=A(t.measure,k("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,n={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(t.cachedPaddingH=n),n}function Hi(t){return U-t.display.nativeBarWidth}function Xi(t){return t.display.scroller.clientWidth-Hi(t)-t.display.barWidth}function Yi(t){return t.display.scroller.clientHeight-Hi(t)-t.display.barHeight}function Ki(t,e,i){var n=t.options.lineWrapping,r=n&&Xi(t);if(!e.measure.heights||n&&e.measure.width!=r){var o=e.measure.heights=[];if(n){e.measure.width=r;for(var s=e.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ji(t,e,i){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};if(t.rest){for(var n=0;n<t.rest.length;n++)if(t.rest[n]==e)return{map:t.measure.maps[n],cache:t.measure.caches[n]};for(var r=0;r<t.rest.length;r++)if(ie(t.rest[r])>i)return{map:t.measure.maps[r],cache:t.measure.caches[r],before:!0}}}function Qi(t,e){var i=ie(e=Qe(e)),n=t.display.externalMeasured=new wi(t.doc,e,i);n.lineN=i;var r=n.built=mi(t,n);return n.text=r.pre,A(t.display.lineMeasure,r.pre),n}function tn(t,e,i,n){return rn(t,nn(t,e),i,n)}function en(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Fn(t,e)];var i=t.display.externalMeasured;return i&&e>=i.lineN&&e<i.lineN+i.size?i:void 0}function nn(t,e){var i=ie(e),n=en(t,i);n&&!n.text?n=null:n&&n.changes&&(Pi(t,n,i,Ln(t)),t.curOp.forceUpdate=!0),n||(n=Qi(t,e));var r=Ji(n,e,i);return{line:e,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function rn(t,e,i,n,r){e.before&&(i=-1);var o,s=i+(n||"");return e.cache.hasOwnProperty(s)?o=e.cache[s]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(Ki(t,e.view,e.rect),e.hasHeights=!0),(o=cn(t,e,i,n)).bogus||(e.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}var on,sn={left:0,right:0,top:0,bottom:0};function an(t,e,i){for(var n,r,o,s,a,l,c=0;c<t.length;c+=3)if(a=t[c],l=t[c+1],e<a?(r=0,o=1,s="left"):e<l?o=1+(r=e-a):(c==t.length-3||e==l&&t[c+3]>e)&&(r=(o=l-a)-1,e>=l&&(s="right")),null!=r){if(n=t[c+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;c&&t[c-2]==t[c-3]&&t[c-1].insertLeft;)n=t[2+(c-=3)],s="left";if("right"==i&&r==l-a)for(;c<t.length-3&&t[c+3]==t[c+4]&&!t[c+5].insertLeft;)n=t[(c+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ln(t,e){var i=sn;if("left"==e)for(var n=0;n<t.length&&(i=t[n]).left==i.right;n++);else for(var r=t.length-1;r>=0&&(i=t[r]).left==i.right;r--);return i}function cn(t,e,i,n){var r,o=an(e.map,i,n),l=o.node,c=o.start,u=o.end,h=o.collapse;if(3==l.nodeType){for(var p=0;p<4;p++){for(;c&&st(e.line.text.charAt(o.coverStart+c));)--c;for(;o.coverStart+u<o.coverEnd&&st(e.line.text.charAt(o.coverStart+u));)++u;if((r=s&&a<9&&0==c&&u==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():ln(E(l,c,u).getClientRects(),n)).left||r.right||0==c)break;u=c,c-=1,h="right"}s&&a<11&&(r=un(t.display.measure,r))}else{var d;c>0&&(h=n="right"),r=t.options.lineWrapping&&(d=l.getClientRects()).length>1?d["right"==n?d.length-1:0]:l.getBoundingClientRect()}if(s&&a<9&&!c&&(!r||!r.left&&!r.right)){var f=l.parentNode.getClientRects()[0];r=f?{left:f.left,right:f.left+Pn(t.display),top:f.top,bottom:f.bottom}:sn}for(var m=r.top-e.rect.top,g=r.bottom-e.rect.top,y=(m+g)/2,_=e.view.measure.heights,v=0;v<_.length-1&&!(y<_[v]);v++);var x=v?_[v-1]:0,b=_[v],w={left:("right"==h?r.right:r.left)-e.rect.left,right:("left"==h?r.left:r.right)-e.rect.left,top:x,bottom:b};return r.left||r.right||(w.bogus=!0),t.options.singleCursorHeightPerLine||(w.rtop=m,w.rbottom=g),w}function un(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Bt(t))return e;var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*i,right:e.right*i,top:e.top*n,bottom:e.bottom*n}}function hn(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(var e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function pn(t){t.display.externalMeasure=null,M(t.display.lineMeasure);for(var e=0;e<t.display.view.length;e++)hn(t.display.view[e])}function dn(t){pn(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function fn(){return u&&y?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function mn(){return u&&y?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function gn(t){var e=Qe(t).widgets,i=0;if(e)for(var n=0;n<e.length;++n)e[n].above&&(i+=Vi(e[n]));return i}function yn(t,e,i,n,r){if(!r){var o=gn(e);i.top+=o,i.bottom+=o}if("line"==n)return i;n||(n="local");var s=si(e);if("local"==n?s+=qi(t.display):s-=t.display.viewOffset,"page"==n||"window"==n){var a=t.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==n?0:mn());var l=a.left+("window"==n?0:fn());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function _n(t,e,i){if("div"==i)return e;var n=e.left,r=e.top;if("page"==i)n-=fn(),r-=mn();else if("local"==i||!i){var o=t.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=t.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function vn(t,e,i,n,r){return n||(n=Jt(t.doc,e.line)),yn(t,n,tn(t,n,e.ch,r),i)}function xn(t,e,i,n,r,o){function s(e,s){var a=rn(t,r,e,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,yn(t,n,a,i)}n=n||Jt(t.doc,e.line),r||(r=nn(t,n));var a=dt(n,t.doc.direction),l=e.ch,c=e.sticky;if(l>=n.text.length?(l=n.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(t,e,i){return s(i?t-1:t,1==a[e].level!=i)}var h=ht(a,l,c),p=ut,d=u(l,h,"before"==c);return null!=p&&(d.other=u(l,p,"before"!=c)),d}function bn(t,e){var i=0;e=de(t.doc,e),t.options.lineWrapping||(i=Pn(t.display)*e.ch);var n=Jt(t.doc,e.line),r=si(n)+qi(t.display);return{left:i,right:i,top:r,bottom:r+n.height}}function wn(t,e,i,n,r){var o=se(t,e,i);return o.xRel=r,n&&(o.outside=n),o}function Tn(t,e,i){var n=t.doc;if((i+=t.display.viewOffset)<0)return wn(n.first,0,null,-1,-1);var r=ne(n,i),o=n.first+n.size-1;if(r>o)return wn(n.first+n.size-1,Jt(n,o).text.length,null,1,1);e<0&&(e=0);for(var s=Jt(n,r);;){var a=In(t,s,r,e,i),l=Ke(s,a.ch+(a.xRel>0||a.outside>0?1:0));if(!l)return a;var c=l.find(1);if(c.line==r)return c;s=Jt(n,r=c.line)}}function Sn(t,e,i,n){n-=gn(e);var r=e.text.length,o=lt((function(e){return rn(t,i,e-1).bottom<=n}),r,0);return{begin:o,end:r=lt((function(e){return rn(t,i,e).top>n}),o,r)}}function Cn(t,e,i,n){return i||(i=nn(t,e)),Sn(t,e,i,yn(t,e,rn(t,i,n),"line").top)}function En(t,e,i,n){return!(t.bottom<=i)&&(t.top>i||(n?t.left:t.right)>e)}function In(t,e,i,n,r){r-=si(e);var o=nn(t,e),s=gn(e),a=0,l=e.text.length,c=!0,u=dt(e,t.doc.direction);if(u){var h=(t.options.lineWrapping?An:Mn)(t,e,i,o,u,n,r);a=(c=1!=h.level)?h.from:h.to-1,l=c?h.to:h.from-1}var p,d,f=null,m=null,g=lt((function(e){var i=rn(t,o,e);return i.top+=s,i.bottom+=s,!!En(i,n,r,!1)&&(i.top<=r&&i.left<=n&&(f=e,m=i),!0)}),a,l),y=!1;if(m){var _=n-m.left<m.right-n,v=_==c;g=f+(v?0:1),d=v?"after":"before",p=_?m.left:m.right}else{c||g!=l&&g!=a||g++,d=0==g?"after":g==e.text.length?"before":rn(t,o,g-(c?1:0)).bottom+s<=r==c?"after":"before";var x=xn(t,se(i,g,d),"line",e,o);p=x.left,y=r<x.top?-1:r>=x.bottom?1:0}return wn(i,g=at(e.text,g,1),d,y,n-p)}function Mn(t,e,i,n,r,o,s){var a=lt((function(a){var l=r[a],c=1!=l.level;return En(xn(t,se(i,c?l.to:l.from,c?"before":"after"),"line",e,n),o,s,!0)}),0,r.length-1),l=r[a];if(a>0){var c=1!=l.level,u=xn(t,se(i,c?l.from:l.to,c?"after":"before"),"line",e,n);En(u,o,s,!0)&&u.top>s&&(l=r[a-1])}return l}function An(t,e,i,n,r,o,s){var a=Sn(t,e,n,s),l=a.begin,c=a.end;/\s/.test(e.text.charAt(c-1))&&c--;for(var u=null,h=null,p=0;p<r.length;p++){var d=r[p];if(!(d.from>=c||d.to<=l)){var f=rn(t,n,1!=d.level?Math.min(c,d.to)-1:Math.max(l,d.from)).right,m=f<o?o-f+1e9:f-o;(!u||h>m)&&(u=d,h=m)}}return u||(u=r[r.length-1]),u.from<l&&(u={from:l,to:u.to,level:u.level}),u.to>c&&(u={from:u.from,to:c,level:u.level}),u}function kn(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==on){on=k("pre",null,"CodeMirror-line-like");for(var e=0;e<49;++e)on.appendChild(document.createTextNode("x")),on.appendChild(k("br"));on.appendChild(document.createTextNode("x"))}A(t.measure,on);var i=on.offsetHeight/50;return i>3&&(t.cachedTextHeight=i),M(t.measure),i||1}function Pn(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;var e=k("span","xxxxxxxxxx"),i=k("pre",[e],"CodeMirror-line-like");A(t.measure,i);var n=e.getBoundingClientRect(),r=(n.right-n.left)/10;return r>2&&(t.cachedCharWidth=r),r||10}function Ln(t){for(var e=t.display,i={},n={},r=e.gutters.clientLeft,o=e.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var a=t.display.gutterSpecs[s].className;i[a]=o.offsetLeft+o.clientLeft+r,n[a]=o.clientWidth}return{fixedPos:zn(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function zn(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function Dn(t){var e=kn(t.display),i=t.options.lineWrapping,n=i&&Math.max(5,t.display.scroller.clientWidth/Pn(t.display)-3);return function(r){if(ri(t.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*e:o+e}}function Rn(t){var e=t.doc,i=Dn(t);e.iter((function(t){var e=i(t);e!=t.height&&ee(t,e)}))}function On(t,e,i,n){var r=t.display;if(!i&&"true"==It(e).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=e.clientX-a.left,s=e.clientY-a.top}catch(t){return null}var l,c=Tn(t,o,s);if(n&&c.xRel>0&&(l=Jt(t.doc,c.line).text).length==c.ch){var u=B(l,l.length,t.options.tabSize)-l.length;c=se(c.line,Math.max(0,Math.round((o-Wi(t.display).left)/Pn(t.display))-u))}return c}function Fn(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;for(var i=t.display.view,n=0;n<i.length;n++)if((e-=i[n].size)<0)return n}function Nn(t,e,i,n){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),n||(n=0);var r=t.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>e)&&(r.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=r.viewTo)Pe&&ii(t.doc,e)<r.viewTo&&jn(t);else if(i<=r.viewFrom)Pe&&ni(t.doc,i+n)>r.viewFrom?jn(t):(r.viewFrom+=n,r.viewTo+=n);else if(e<=r.viewFrom&&i>=r.viewTo)jn(t);else if(e<=r.viewFrom){var o=$n(t,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):jn(t)}else if(i>=r.viewTo){var s=$n(t,e,e,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):jn(t)}else{var a=$n(t,e,e,-1),l=$n(t,i,i+n,1);a&&l?(r.view=r.view.slice(0,a.index).concat(Ti(t,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=n):jn(t)}var c=r.externalMeasured;c&&(i<c.lineN?c.lineN+=n:e<c.lineN+c.size&&(r.externalMeasured=null))}function Bn(t,e,i){t.curOp.viewChanged=!0;var n=t.display,r=t.display.externalMeasured;if(r&&e>=r.lineN&&e<r.lineN+r.size&&(n.externalMeasured=null),!(e<n.viewFrom||e>=n.viewTo)){var o=n.view[Fn(t,e)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==$(s,i)&&s.push(i)}}}function jn(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function $n(t,e,i,n){var r,o=Fn(t,e),s=t.display.view;if(!Pe||i==t.doc.first+t.doc.size)return{index:o,lineN:i};for(var a=t.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=e){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-e,o++}else r=a-e;e+=r,i+=r}for(;ii(t.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function Un(t,e,i){var n=t.display;0==n.view.length||e>=n.viewTo||i<=n.viewFrom?(n.view=Ti(t,e,i),n.viewFrom=e):(n.viewFrom>e?n.view=Ti(t,e,n.viewFrom).concat(n.view):n.viewFrom<e&&(n.view=n.view.slice(Fn(t,e))),n.viewFrom=e,n.viewTo<i?n.view=n.view.concat(Ti(t,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Fn(t,i)))),n.viewTo=i}function Vn(t){for(var e=t.display.view,i=0,n=0;n<e.length;n++){var r=e[n];r.hidden||r.node&&!r.changes||++i}return i}function Gn(t){t.display.input.showSelection(t.display.input.prepareSelection())}function qn(t,e){void 0===e&&(e=!0);var i=t.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=t.options.$customCursor;s&&(e=!0);for(var a=0;a<i.sel.ranges.length;a++)if(e||a!=i.sel.primIndex){var l=i.sel.ranges[a];if(!(l.from().line>=t.display.viewTo||l.to().line<t.display.viewFrom)){var c=l.empty();if(s){var u=s(t,l);u&&Zn(t,u,r)}else(c||t.options.showCursorWhenSelecting)&&Zn(t,l.head,r);c||Hn(t,l,o)}}return n}function Zn(t,e,i){var n=xn(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),r=i.appendChild(k("div"," ","CodeMirror-cursor"));if(r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.height=Math.max(0,n.bottom-n.top)*t.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(t.getWrapperElement().className)){var o=vn(t,e,"div",null,null),s=o.right-o.left;r.style.width=(s>0?s:t.defaultCharWidth())+"px"}if(n.other){var a=i.appendChild(k("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));a.style.display="",a.style.left=n.other.left+"px",a.style.top=n.other.top+"px",a.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function Wn(t,e){return t.top-e.top||t.left-e.left}function Hn(t,e,i){var n=t.display,r=t.doc,o=document.createDocumentFragment(),s=Wi(t.display),a=s.left,l=Math.max(n.sizerWidth,Xi(t)-n.sizer.offsetLeft)-s.right,c="ltr"==r.direction;function u(t,e,i,n){e<0&&(e=0),e=Math.round(e),n=Math.round(n),o.appendChild(k("div",null,"CodeMirror-selected","position: absolute; left: "+t+"px;\n                             top: "+e+"px; width: "+(null==i?l-t:i)+"px;\n                             height: "+(n-e)+"px"))}function h(e,i,n){var o,s,h=Jt(r,e),p=h.text.length;function d(i,n){return vn(t,se(e,i),"div",h,n)}function f(e,i,n){var r=Cn(t,h,null,e),o="ltr"==i==("after"==n)?"left":"right";return d("after"==n?r.begin:r.end-(/\s/.test(h.text.charAt(r.end-1))?2:1),o)[o]}var m=dt(h,r.direction);return ct(m,i||0,null==n?p:n,(function(t,e,r,h){var g="ltr"==r,y=d(t,g?"left":"right"),_=d(e-1,g?"right":"left"),v=null==i&&0==t,x=null==n&&e==p,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){var T=(c?x:v)&&w,S=(c?v:x)&&b?a:(g?y:_).left,C=T?l:(g?_:y).right;u(S,y.top,C-S,y.bottom)}else{var E,I,M,A;g?(E=c&&v&&b?a:y.left,I=c?l:f(t,r,"before"),M=c?a:f(e,r,"after"),A=c&&x&&w?l:_.right):(E=c?f(t,r,"before"):a,I=!c&&v&&b?l:y.right,M=!c&&x&&w?a:_.left,A=c?f(e,r,"after"):l),u(E,y.top,I-E,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(M,_.top,A-M,_.bottom)}(!o||Wn(y,o)<0)&&(o=y),Wn(_,o)<0&&(o=_),(!s||Wn(y,s)<0)&&(s=y),Wn(_,s)<0&&(s=_)})),{start:o,end:s}}var p=e.from(),d=e.to();if(p.line==d.line)h(p.line,p.ch,d.ch);else{var f=Jt(r,p.line),m=Jt(r,d.line),g=Qe(f)==Qe(m),y=h(p.line,p.ch,g?f.text.length+1:null).end,_=h(d.line,g?0:null,d.ch).start;g&&(y.top<_.top-2?(u(y.right,y.top,null,y.bottom),u(a,_.top,_.left,_.bottom)):u(y.right,y.top,_.left-y.right,y.bottom)),y.bottom<_.top&&u(a,y.bottom,null,_.top)}i.appendChild(o)}function Xn(t){if(t.state.focused){var e=t.display;clearInterval(e.blinker);var i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval((function(){t.hasFocus()||Qn(t),e.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}}function Yn(t){t.hasFocus()||(t.display.input.focus(),t.state.focused||Jn(t))}function Kn(t){t.state.delayingBlurEvent=!0,setTimeout((function(){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,t.state.focused&&Qn(t))}),100)}function Jn(t,e){t.state.delayingBlurEvent&&!t.state.draggingText&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(_t(t,"focus",t,e),t.state.focused=!0,D(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),l&&setTimeout((function(){return t.display.input.reset(!0)}),20)),t.display.input.receivedFocus()),Xn(t))}function Qn(t,e){t.state.delayingBlurEvent||(t.state.focused&&(_t(t,"blur",t,e),t.state.focused=!1,I(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout((function(){t.state.focused||(t.display.shift=!1)}),150))}function tr(t){for(var e=t.display,i=e.lineDiv.offsetTop,n=Math.max(0,e.scroller.getBoundingClientRect().top),r=e.lineDiv.getBoundingClientRect().top,o=0,l=0;l<e.view.length;l++){var c=e.view[l],u=t.options.lineWrapping,h=void 0,p=0;if(!c.hidden){if(r+=c.line.height,s&&a<8){var d=c.node.offsetTop+c.node.offsetHeight;h=d-i,i=d}else{var f=c.node.getBoundingClientRect();h=f.bottom-f.top,!u&&c.text.firstChild&&(p=c.text.firstChild.getBoundingClientRect().right-f.left-1)}var m=c.line.height-h;if((m>.005||m<-.005)&&(r<n&&(o-=m),ee(c.line,h),er(c.line),c.rest))for(var g=0;g<c.rest.length;g++)er(c.rest[g]);if(p>t.display.sizerWidth){var y=Math.ceil(p/Pn(t.display));y>t.display.maxLineLength&&(t.display.maxLineLength=y,t.display.maxLine=c.line,t.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(e.scroller.scrollTop+=o)}function er(t){if(t.widgets)for(var e=0;e<t.widgets.length;++e){var i=t.widgets[e],n=i.node.parentNode;n&&(i.height=n.offsetHeight)}}function ir(t,e,i){var n=i&&null!=i.top?Math.max(0,i.top):t.scroller.scrollTop;n=Math.floor(n-qi(t));var r=i&&null!=i.bottom?i.bottom:n+t.wrapper.clientHeight,o=ne(e,n),s=ne(e,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=ne(e,si(Jt(e,a))+t.wrapper.clientHeight)):Math.min(l,e.lastLine())>=s&&(o=ne(e,si(Jt(e,l))-t.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function nr(t,e){if(!vt(t,"scrollCursorIntoView")){var i=t.display,n=i.sizer.getBoundingClientRect(),r=null;if(e.top+n.top<0?r=!0:e.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!m){var o=k("div","​",null,"position: absolute;\n                         top: "+(e.top-i.viewOffset-qi(t.display))+"px;\n                         height: "+(e.bottom-e.top+Hi(t)+i.barHeight)+"px;\n                         left: "+e.left+"px; width: "+Math.max(2,e.right-e.left)+"px;");t.display.lineSpace.appendChild(o),o.scrollIntoView(r),t.display.lineSpace.removeChild(o)}}}function rr(t,e,i,n){var r;null==n&&(n=0),t.options.lineWrapping||e!=i||(i="before"==e.sticky?se(e.line,e.ch+1,"before"):e,e=e.ch?se(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e);for(var o=0;o<5;o++){var s=!1,a=xn(t,e),l=i&&i!=e?xn(t,i):a,c=sr(t,r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-n,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+n}),u=t.doc.scrollTop,h=t.doc.scrollLeft;if(null!=c.scrollTop&&(dr(t,c.scrollTop),Math.abs(t.doc.scrollTop-u)>1&&(s=!0)),null!=c.scrollLeft&&(mr(t,c.scrollLeft),Math.abs(t.doc.scrollLeft-h)>1&&(s=!0)),!s)break}return r}function or(t,e){var i=sr(t,e);null!=i.scrollTop&&dr(t,i.scrollTop),null!=i.scrollLeft&&mr(t,i.scrollLeft)}function sr(t,e){var i=t.display,n=kn(t.display);e.top<0&&(e.top=0);var r=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:i.scroller.scrollTop,o=Yi(t),s={};e.bottom-e.top>o&&(e.bottom=e.top+o);var a=t.doc.height+Zi(i),l=e.top<n,c=e.bottom>a-n;if(e.top<r)s.scrollTop=l?0:e.top;else if(e.bottom>r+o){var u=Math.min(e.top,(c?a:e.bottom)-o);u!=r&&(s.scrollTop=u)}var h=t.options.fixedGutter?0:i.gutters.offsetWidth,p=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:i.scroller.scrollLeft-h,d=Xi(t)-i.gutters.offsetWidth,f=e.right-e.left>d;return f&&(e.right=e.left+d),e.left<10?s.scrollLeft=0:e.left<p?s.scrollLeft=Math.max(0,e.left+h-(f?0:10)):e.right>d+p-3&&(s.scrollLeft=e.right+(f?0:10)-d),s}function ar(t,e){null!=e&&(hr(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function lr(t){hr(t);var e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function cr(t,e,i){null==e&&null==i||hr(t),null!=e&&(t.curOp.scrollLeft=e),null!=i&&(t.curOp.scrollTop=i)}function ur(t,e){hr(t),t.curOp.scrollToPos=e}function hr(t){var e=t.curOp.scrollToPos;e&&(t.curOp.scrollToPos=null,pr(t,bn(t,e.from),bn(t,e.to),e.margin))}function pr(t,e,i,n){var r=sr(t,{left:Math.min(e.left,i.left),top:Math.min(e.top,i.top)-n,right:Math.max(e.right,i.right),bottom:Math.max(e.bottom,i.bottom)+n});cr(t,r.scrollLeft,r.scrollTop)}function dr(t,e){Math.abs(t.doc.scrollTop-e)<2||(i||Gr(t,{top:e}),fr(t,e,!0),i&&Gr(t),Or(t,100))}function fr(t,e,i){e=Math.max(0,Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e)),(t.display.scroller.scrollTop!=e||i)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function mr(t,e,i,n){e=Math.max(0,Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth)),(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!n||(t.doc.scrollLeft=e,Hr(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function gr(t){var e=t.display,i=e.gutters.offsetWidth,n=Math.round(t.doc.height+Zi(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+Hi(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:i}}var yr=function(t,e,i){this.cm=i;var n=this.vert=k("div",[k("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=k("div",[k("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=r.tabIndex=-1,t(n),t(r),mt(n,"scroll",(function(){n.clientHeight&&e(n.scrollTop,"vertical")})),mt(r,"scroll",(function(){r.clientWidth&&e(r.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,s&&a<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};yr.prototype.update=function(t){var e=t.scrollWidth>t.clientWidth+1,i=t.scrollHeight>t.clientHeight+1,n=t.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=e?n+"px":"0";var r=t.viewHeight-(e?n:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+r)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=t.barLeft+"px";var o=t.viewWidth-t.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:e?n:0}},yr.prototype.setScrollLeft=function(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},yr.prototype.setScrollTop=function(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},yr.prototype.zeroWidthHack=function(){var t=v&&!f?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new j,this.disableVert=new j},yr.prototype.enableZeroWidthBar=function(t,e,i){function n(){var r=t.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=t?t.style.pointerEvents="none":e.set(1e3,n)}t.style.pointerEvents="auto",e.set(1e3,n)},yr.prototype.clear=function(){var t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)};var _r=function(){};function vr(t,e){e||(e=gr(t));var i=t.display.barWidth,n=t.display.barHeight;xr(t,e);for(var r=0;r<4&&i!=t.display.barWidth||n!=t.display.barHeight;r++)i!=t.display.barWidth&&t.options.lineWrapping&&tr(t),xr(t,gr(t)),i=t.display.barWidth,n=t.display.barHeight}function xr(t,e){var i=t.display,n=i.scrollbars.update(e);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=e.gutterWidth+"px"):i.gutterFiller.style.display=""}_r.prototype.update=function(){return{bottom:0,right:0}},_r.prototype.setScrollLeft=function(){},_r.prototype.setScrollTop=function(){},_r.prototype.clear=function(){};var br={native:yr,null:_r};function wr(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&I(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new br[t.options.scrollbarStyle]((function(e){t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),mt(e,"mousedown",(function(){t.state.focused&&setTimeout((function(){return t.display.input.focus()}),0)})),e.setAttribute("cm-not-content","true")}),(function(e,i){"horizontal"==i?mr(t,e):dr(t,e)}),t),t.display.scrollbars.addClass&&D(t.display.wrapper,t.display.scrollbars.addClass)}var Tr=0;function Sr(t){t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Tr,markArrays:null},Ci(t.curOp)}function Cr(t){var e=t.curOp;e&&Ii(e,(function(t){for(var e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;Er(t)}))}function Er(t){for(var e=t.ops,i=0;i<e.length;i++)Ir(e[i]);for(var n=0;n<e.length;n++)Mr(e[n]);for(var r=0;r<e.length;r++)Ar(e[r]);for(var o=0;o<e.length;o++)kr(e[o]);for(var s=0;s<e.length;s++)Pr(e[s])}function Ir(t){var e=t.cm,i=e.display;Br(e),t.updateMaxLine&&li(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<i.viewFrom||t.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new Nr(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function Mr(t){t.updatedDisplay=t.mustUpdate&&Ur(t.cm,t.update)}function Ar(t){var e=t.cm,i=e.display;t.updatedDisplay&&tr(e),t.barMeasure=gr(e),i.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=tn(e,i.maxLine,i.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+t.adjustWidthTo+Hi(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+t.adjustWidthTo-Xi(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=i.input.prepareSelection())}function kr(t){var e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&mr(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);var i=t.focus&&t.focus==z();t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,i),(t.updatedDisplay||t.startHeight!=e.doc.height)&&vr(e,t.barMeasure),t.updatedDisplay&&Wr(e,t.barMeasure),t.selectionChanged&&Xn(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),i&&Yn(t.cm)}function Pr(t){var e=t.cm,i=e.display,n=e.doc;t.updatedDisplay&&Vr(e,t.update),null==i.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=t.scrollTop&&fr(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&mr(e,t.scrollLeft,!0,!0),t.scrollToPos&&nr(e,rr(e,de(n,t.scrollToPos.from),de(n,t.scrollToPos.to),t.scrollToPos.margin));var r=t.maybeHiddenMarkers,o=t.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||_t(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&_t(o[a],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&_t(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function Lr(t,e){if(t.curOp)return e();Sr(t);try{return e()}finally{Cr(t)}}function zr(t,e){return function(){if(t.curOp)return e.apply(t,arguments);Sr(t);try{return e.apply(t,arguments)}finally{Cr(t)}}}function Dr(t){return function(){if(this.curOp)return t.apply(this,arguments);Sr(this);try{return t.apply(this,arguments)}finally{Cr(this)}}}function Rr(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);Sr(e);try{return t.apply(this,arguments)}finally{Cr(e)}}}function Or(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,F(Fr,t))}function Fr(t){var e=t.doc;if(!(e.highlightFrontier>=t.display.viewTo)){var i=+new Date+t.options.workTime,n=xe(t,e.highlightFrontier),r=[];e.iter(n.line,Math.min(e.first+e.size,t.display.viewTo+500),(function(o){if(n.line>=t.display.viewFrom){var s=o.styles,a=o.text.length>t.options.maxHighlightLength?Ht(e.mode,n.state):null,l=_e(t,o,n,!0);a&&(n.state=a),o.styles=l.styles;var c=o.styleClasses,u=l.classes;u?o.styleClasses=u:c&&(o.styleClasses=null);for(var h=!s||s.length!=o.styles.length||c!=u&&(!c||!u||c.bgClass!=u.bgClass||c.textClass!=u.textClass),p=0;!h&&p<s.length;++p)h=s[p]!=o.styles[p];h&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=t.options.maxHighlightLength&&be(t,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return Or(t,t.options.workDelay),!0})),e.highlightFrontier=n.line,e.modeFrontier=Math.max(e.modeFrontier,n.line),r.length&&Lr(t,(function(){for(var e=0;e<r.length;e++)Bn(t,r[e],"text")}))}}var Nr=function(t,e,i){var n=t.display;this.viewport=e,this.visible=ir(n,t.doc,e),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Xi(t),this.force=i,this.dims=Ln(t),this.events=[]};function Br(t){var e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=Hi(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=Hi(t)+"px",e.scrollbarsClipped=!0)}function jr(t){if(t.hasFocus())return null;var e=z();if(!e||!L(t.display.lineDiv,e))return null;var i={activeElt:e};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&L(t.display.lineDiv,n.anchorNode)&&(i.anchorNode=n.anchorNode,i.anchorOffset=n.anchorOffset,i.focusNode=n.focusNode,i.focusOffset=n.focusOffset)}return i}function $r(t){if(t&&t.activeElt&&t.activeElt!=z()&&(t.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(t.activeElt.nodeName)&&t.anchorNode&&L(document.body,t.anchorNode)&&L(document.body,t.focusNode))){var e=window.getSelection(),i=document.createRange();i.setEnd(t.anchorNode,t.anchorOffset),i.collapse(!1),e.removeAllRanges(),e.addRange(i),e.extend(t.focusNode,t.focusOffset)}}function Ur(t,e){var i=t.display,n=t.doc;if(e.editorIsHidden)return jn(t),!1;if(!e.force&&e.visible.from>=i.viewFrom&&e.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==Vn(t))return!1;Xr(t)&&(jn(t),e.dims=Ln(t));var r=n.first+n.size,o=Math.max(e.visible.from-t.options.viewportMargin,n.first),s=Math.min(r,e.visible.to+t.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(n.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(r,i.viewTo)),Pe&&(o=ii(t.doc,o),s=ni(t.doc,s));var a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=e.wrapperHeight||i.lastWrapWidth!=e.wrapperWidth;Un(t,o,s),i.viewOffset=si(Jt(t.doc,i.viewFrom)),t.display.mover.style.top=i.viewOffset+"px";var l=Vn(t);if(!a&&0==l&&!e.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var c=jr(t);return l>4&&(i.lineDiv.style.display="none"),qr(t,i.updateLineNumbers,e.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,$r(c),M(i.cursorDiv),M(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=e.wrapperHeight,i.lastWrapWidth=e.wrapperWidth,Or(t,400)),i.updateLineNumbers=null,!0}function Vr(t,e){for(var i=e.viewport,n=!0;;n=!1){if(n&&t.options.lineWrapping&&e.oldDisplayWidth!=Xi(t))n&&(e.visible=ir(t.display,t.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(t.doc.height+Zi(t.display)-Yi(t),i.top)}),e.visible=ir(t.display,t.doc,i),e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)break;if(!Ur(t,e))break;tr(t);var r=gr(t);Gn(t),vr(t,r),Wr(t,r),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function Gr(t,e){var i=new Nr(t,e);if(Ur(t,i)){tr(t),Vr(t,i);var n=gr(t);Gn(t),vr(t,n),Wr(t,n),i.finish()}}function qr(t,e,i){var n=t.display,r=t.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function a(e){var i=e.nextSibling;return l&&v&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),i}for(var c=n.view,u=n.viewFrom,h=0;h<c.length;h++){var p=c[h];if(p.hidden);else if(p.node&&p.node.parentNode==o){for(;s!=p.node;)s=a(s);var d=r&&null!=e&&e<=u&&p.lineNumber;p.changes&&($(p.changes,"gutter")>-1&&(d=!1),Pi(t,p,u,i)),d&&(M(p.lineNumber),p.lineNumber.appendChild(document.createTextNode(oe(t.options,u)))),s=p.node.nextSibling}else{var f=Bi(t,p,u,i);o.insertBefore(f,s)}u+=p.size}for(;s;)s=a(s)}function Zr(t){var e=t.gutters.offsetWidth;t.sizer.style.marginLeft=e+"px",Ai(t,"gutterChanged",t)}function Wr(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+Hi(t)+"px"}function Hr(t){var e=t.display,i=e.view;if(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter){for(var n=zn(e)-e.scroller.scrollLeft+t.doc.scrollLeft,r=e.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){t.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=n+r+"px")}}function Xr(t){if(!t.options.lineNumbers)return!1;var e=t.doc,i=oe(t.options,e.first+e.size-1),n=t.display;if(i.length!=n.lineNumChars){var r=n.measure.appendChild(k("div",[k("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s)+1,n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",Zr(t.display),!0}return!1}function Yr(t,e){for(var i=[],n=!1,r=0;r<t.length;r++){var o=t[r],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!e)continue;n=!0}i.push({className:o,style:s})}return e&&!n&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function Kr(t){var e=t.gutters,i=t.gutterSpecs;M(e),t.lineGutter=null;for(var n=0;n<i.length;++n){var r=i[n],o=r.className,s=r.style,a=e.appendChild(k("div",null,"CodeMirror-gutter "+o));s&&(a.style.cssText=s),"CodeMirror-linenumbers"==o&&(t.lineGutter=a,a.style.width=(t.lineNumWidth||1)+"px")}e.style.display=i.length?"":"none",Zr(t)}function Jr(t){Kr(t.display),Nn(t),Hr(t)}function Qr(t,e,n,r){var o=this;this.input=n,o.scrollbarFiller=k("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=k("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=P("div",null,"CodeMirror-code"),o.selectionDiv=k("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=k("div",null,"CodeMirror-cursors"),o.measure=k("div",null,"CodeMirror-measure"),o.lineMeasure=k("div",null,"CodeMirror-measure"),o.lineSpace=P("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var c=P("div",[o.lineSpace],"CodeMirror-lines");o.mover=k("div",[c],null,"position: relative"),o.sizer=k("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=k("div",null,null,"position: absolute; height: "+U+"px; width: 1px;"),o.gutters=k("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=k("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=k("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),o.wrapper.setAttribute("translate","no"),s&&a<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),l||i&&_||(o.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(o.wrapper):t(o.wrapper)),o.viewFrom=o.viewTo=e.first,o.reportedViewFrom=o.reportedViewTo=e.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=Yr(r.gutters,r.lineNumbers),Kr(o),n.init(o)}Nr.prototype.signal=function(t,e){bt(t,e)&&this.events.push(arguments)},Nr.prototype.finish=function(){for(var t=0;t<this.events.length;t++)_t.apply(null,this.events[t])};var to=0,eo=null;function io(t){var e=t.wheelDeltaX,i=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==i&&t.detail&&t.axis==t.VERTICAL_AXIS?i=t.detail:null==i&&(i=t.wheelDelta),{x:e,y:i}}function no(t){var e=io(t);return e.x*=eo,e.y*=eo,e}function ro(t,e){u&&h>=102&&(null==t.display.chromeScrollHack?t.display.sizer.style.pointerEvents="none":clearTimeout(t.display.chromeScrollHack),t.display.chromeScrollHack=setTimeout((function(){t.display.chromeScrollHack=null,t.display.sizer.style.pointerEvents=""}),100));var n=io(e),r=n.x,o=n.y,s=eo;0===e.deltaMode&&(r=e.deltaX,o=e.deltaY,s=1);var a=t.display,c=a.scroller,d=c.scrollWidth>c.clientWidth,f=c.scrollHeight>c.clientHeight;if(r&&d||o&&f){if(o&&v&&l)t:for(var m=e.target,g=a.view;m!=c;m=m.parentNode)for(var y=0;y<g.length;y++)if(g[y].node==m){t.display.currentWheelTarget=m;break t}if(r&&!i&&!p&&null!=s)return o&&f&&dr(t,Math.max(0,c.scrollTop+o*s)),mr(t,Math.max(0,c.scrollLeft+r*s)),(!o||o&&f)&&Tt(e),void(a.wheelStartX=null);if(o&&null!=s){var _=o*s,x=t.doc.scrollTop,b=x+a.wrapper.clientHeight;_<0?x=Math.max(0,x+_-50):b=Math.min(t.doc.height,b+_+50),Gr(t,{top:x,bottom:b})}to<20&&0!==e.deltaMode&&(null==a.wheelStartX?(a.wheelStartX=c.scrollLeft,a.wheelStartY=c.scrollTop,a.wheelDX=r,a.wheelDY=o,setTimeout((function(){if(null!=a.wheelStartX){var t=c.scrollLeft-a.wheelStartX,e=c.scrollTop-a.wheelStartY,i=e&&a.wheelDY&&e/a.wheelDY||t&&a.wheelDX&&t/a.wheelDX;a.wheelStartX=a.wheelStartY=null,i&&(eo=(eo*to+i)/(to+1),++to)}}),200)):(a.wheelDX+=r,a.wheelDY+=o))}}s?eo=-.53:i?eo=15:u?eo=-.7:d&&(eo=-1/3);var oo=function(t,e){this.ranges=t,this.primIndex=e};oo.prototype.primary=function(){return this.ranges[this.primIndex]},oo.prototype.equals=function(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(var e=0;e<this.ranges.length;e++){var i=this.ranges[e],n=t.ranges[e];if(!le(i.anchor,n.anchor)||!le(i.head,n.head))return!1}return!0},oo.prototype.deepCopy=function(){for(var t=[],e=0;e<this.ranges.length;e++)t[e]=new so(ce(this.ranges[e].anchor),ce(this.ranges[e].head));return new oo(t,this.primIndex)},oo.prototype.somethingSelected=function(){for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1},oo.prototype.contains=function(t,e){e||(e=t);for(var i=0;i<this.ranges.length;i++){var n=this.ranges[i];if(ae(e,n.from())>=0&&ae(t,n.to())<=0)return i}return-1};var so=function(t,e){this.anchor=t,this.head=e};function ao(t,e,i){var n=t&&t.options.selectionsMayTouch,r=e[i];e.sort((function(t,e){return ae(t.from(),e.from())})),i=$(e,r);for(var o=1;o<e.length;o++){var s=e[o],a=e[o-1],l=ae(a.to(),s.from());if(n&&!s.empty()?l>0:l>=0){var c=he(a.from(),s.from()),u=ue(a.to(),s.to()),h=a.empty()?s.from()==s.head:a.from()==a.head;o<=i&&--i,e.splice(--o,2,new so(h?u:c,h?c:u))}}return new oo(e,i)}function lo(t,e){return new oo([new so(t,e||t)],0)}function co(t){return t.text?se(t.from.line+t.text.length-1,Y(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function uo(t,e){if(ae(t,e.from)<0)return t;if(ae(t,e.to)<=0)return co(e);var i=t.line+e.text.length-(e.to.line-e.from.line)-1,n=t.ch;return t.line==e.to.line&&(n+=co(e).ch-e.to.ch),se(i,n)}function ho(t,e){for(var i=[],n=0;n<t.sel.ranges.length;n++){var r=t.sel.ranges[n];i.push(new so(uo(r.anchor,e),uo(r.head,e)))}return ao(t.cm,i,t.sel.primIndex)}function po(t,e,i){return t.line==e.line?se(i.line,t.ch-e.ch+i.ch):se(i.line+(t.line-e.line),t.ch)}function fo(t,e,i){for(var n=[],r=se(t.first,0),o=r,s=0;s<e.length;s++){var a=e[s],l=po(a.from,r,o),c=po(co(a),r,o);if(r=a.to,o=c,"around"==i){var u=t.sel.ranges[s],h=ae(u.head,u.anchor)<0;n[s]=new so(h?c:l,h?l:c)}else n[s]=new so(l,l)}return new oo(n,t.sel.primIndex)}function mo(t){t.doc.mode=qt(t.options,t.doc.modeOption),go(t)}function go(t){t.doc.iter((function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)})),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,Or(t,100),t.state.modeGen++,t.curOp&&Nn(t)}function yo(t,e){return 0==e.from.ch&&0==e.to.ch&&""==Y(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function _o(t,e,i,n){function r(t){return i?i[t]:null}function o(t,i,r){ui(t,i,r,n),Ai(t,"change",t,e)}function s(t,e){for(var i=[],o=t;o<e;++o)i.push(new ci(c[o],r(o),n));return i}var a=e.from,l=e.to,c=e.text,u=Jt(t,a.line),h=Jt(t,l.line),p=Y(c),d=r(c.length-1),f=l.line-a.line;if(e.full)t.insert(0,s(0,c.length)),t.remove(c.length,t.size-c.length);else if(yo(t,e)){var m=s(0,c.length-1);o(h,h.text,d),f&&t.remove(a.line,f),m.length&&t.insert(a.line,m)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+p+u.text.slice(l.ch),d);else{var g=s(1,c.length-1);g.push(new ci(p+u.text.slice(l.ch),d,n)),o(u,u.text.slice(0,a.ch)+c[0],r(0)),t.insert(a.line+1,g)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),r(0)),t.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],r(0)),o(h,p+h.text.slice(l.ch),d);var y=s(1,c.length-1);f>1&&t.remove(a.line+1,f-1),t.insert(a.line+1,y)}Ai(t,"change",t,e)}function vo(t,e,i){function n(t,r,o){if(t.linked)for(var s=0;s<t.linked.length;++s){var a=t.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;i&&!l||(e(a.doc,l),n(a.doc,t,l))}}}n(t,null,!0)}function xo(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,Rn(t),mo(t),bo(t),t.options.direction=e.direction,t.options.lineWrapping||li(t),t.options.mode=e.modeOption,Nn(t)}function bo(t){("rtl"==t.doc.direction?D:I)(t.display.lineDiv,"CodeMirror-rtl")}function wo(t){Lr(t,(function(){bo(t),Nn(t)}))}function To(t){this.done=[],this.undone=[],this.undoDepth=t?t.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t?t.maxGeneration:1}function So(t,e){var i={from:ce(e.from),to:co(e),text:Qt(t,e.from,e.to)};return Po(t,i,e.from.line,e.to.line+1),vo(t,(function(t){return Po(t,i,e.from.line,e.to.line+1)}),!0),i}function Co(t){for(;t.length&&Y(t).ranges;)t.pop()}function Eo(t,e){return e?(Co(t.done),Y(t.done)):t.done.length&&!Y(t.done).ranges?Y(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),Y(t.done)):void 0}function Io(t,e,i,n){var r=t.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&r.lastModTime>a-(t.cm?t.cm.options.historyEventDelay:500)||"*"==e.origin.charAt(0)))&&(o=Eo(r,r.lastOp==n)))s=Y(o.changes),0==ae(e.from,e.to)&&0==ae(e.from,s.to)?s.to=co(e):o.changes.push(So(t,e));else{var l=Y(r.done);for(l&&l.ranges||ko(t.sel,r.done),o={changes:[So(t,e)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=e.origin,s||_t(t,"historyAdded")}function Mo(t,e,i,n){var r=e.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}function Ao(t,e,i,n){var r=t.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||Mo(t,o,Y(r.done),e))?r.done[r.done.length-1]=e:ko(e,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&Co(r.undone)}function ko(t,e){var i=Y(e);i&&i.ranges&&i.equals(t)||e.push(t)}function Po(t,e,i,n){var r=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,n),(function(i){i.markedSpans&&((r||(r=e["spans_"+t.id]={}))[o]=i.markedSpans),++o}))}function Lo(t){if(!t)return null;for(var e,i=0;i<t.length;++i)t[i].marker.explicitlyCleared?e||(e=t.slice(0,i)):e&&e.push(t[i]);return e?e.length?e:null:t}function zo(t,e){var i=e["spans_"+t.id];if(!i)return null;for(var n=[],r=0;r<e.text.length;++r)n.push(Lo(i[r]));return n}function Do(t,e){var i=zo(t,e),n=je(t,e);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)t:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue t;o.push(l)}else s&&(i[r]=s)}return i}function Ro(t,e,i){for(var n=[],r=0;r<t.length;++r){var o=t[r];if(o.ranges)n.push(i?oo.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],u=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),e)for(var h in c)(u=h.match(/^spans_(\d+)$/))&&$(e,Number(u[1]))>-1&&(Y(a)[h]=c[h],delete c[h])}}}return n}function Oo(t,e,i,n){if(n){var r=t.anchor;if(i){var o=ae(e,r)<0;o!=ae(i,r)<0?(r=e,e=i):o!=ae(e,i)<0&&(e=i)}return new so(r,e)}return new so(i||e,e)}function Fo(t,e,i,n,r){null==r&&(r=t.cm&&(t.cm.display.shift||t.extend)),Vo(t,new oo([Oo(t.sel.primary(),e,i,r)],0),n)}function No(t,e,i){for(var n=[],r=t.cm&&(t.cm.display.shift||t.extend),o=0;o<t.sel.ranges.length;o++)n[o]=Oo(t.sel.ranges[o],e[o],null,r);Vo(t,ao(t.cm,n,t.sel.primIndex),i)}function Bo(t,e,i,n){var r=t.sel.ranges.slice(0);r[e]=i,Vo(t,ao(t.cm,r,t.sel.primIndex),n)}function jo(t,e,i,n){Vo(t,lo(e,i),n)}function $o(t,e,i){var n={ranges:e.ranges,update:function(e){this.ranges=[];for(var i=0;i<e.length;i++)this.ranges[i]=new so(de(t,e[i].anchor),de(t,e[i].head))},origin:i&&i.origin};return _t(t,"beforeSelectionChange",t,n),t.cm&&_t(t.cm,"beforeSelectionChange",t.cm,n),n.ranges!=e.ranges?ao(t.cm,n.ranges,n.ranges.length-1):e}function Uo(t,e,i){var n=t.history.done,r=Y(n);r&&r.ranges?(n[n.length-1]=e,Go(t,e,i)):Vo(t,e,i)}function Vo(t,e,i){Go(t,e,i),Ao(t,t.sel,t.cm?t.cm.curOp.id:NaN,i)}function Go(t,e,i){(bt(t,"beforeSelectionChange")||t.cm&&bt(t.cm,"beforeSelectionChange"))&&(e=$o(t,e,i));var n=i&&i.bias||(ae(e.primary().head,t.sel.primary().head)<0?-1:1);qo(t,Wo(t,e,n,!0)),i&&!1===i.scroll||!t.cm||"nocursor"==t.cm.getOption("readOnly")||lr(t.cm)}function qo(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,xt(t.cm)),Ai(t,"cursorActivity",t))}function Zo(t){qo(t,Wo(t,t.sel,null,!1))}function Wo(t,e,i,n){for(var r,o=0;o<e.ranges.length;o++){var s=e.ranges[o],a=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[o],l=Xo(t,s.anchor,a&&a.anchor,i,n),c=Xo(t,s.head,a&&a.head,i,n);(r||l!=s.anchor||c!=s.head)&&(r||(r=e.ranges.slice(0,o)),r[o]=new so(l,c))}return r?ao(t.cm,r,e.primIndex):e}function Ho(t,e,i,n,r){var o=Jt(t,e.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=e.ch:a.from<e.ch))&&(null==a.to||(u?a.to>=e.ch:a.to>e.ch))){if(r&&(_t(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var h=l.find(n<0?1:-1),p=void 0;if((n<0?u:c)&&(h=Yo(t,h,-n,h&&h.line==e.line?o:null)),h&&h.line==e.line&&(p=ae(h,i))&&(n<0?p<0:p>0))return Ho(t,h,e,n,r)}var d=l.find(n<0?-1:1);return(n<0?c:u)&&(d=Yo(t,d,n,d.line==e.line?o:null)),d?Ho(t,d,e,n,r):null}}return e}function Xo(t,e,i,n,r){var o=n||1,s=Ho(t,e,i,o,r)||!r&&Ho(t,e,i,o,!0)||Ho(t,e,i,-o,r)||!r&&Ho(t,e,i,-o,!0);return s||(t.cantEdit=!0,se(t.first,0))}function Yo(t,e,i,n){return i<0&&0==e.ch?e.line>t.first?de(t,se(e.line-1)):null:i>0&&e.ch==(n||Jt(t,e.line)).text.length?e.line<t.first+t.size-1?se(e.line+1,0):null:new se(e.line,e.ch+i)}function Ko(t){t.setSelection(se(t.firstLine(),0),se(t.lastLine()),G)}function Jo(t,e,i){var n={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return n.canceled=!0}};return i&&(n.update=function(e,i,r,o){e&&(n.from=de(t,e)),i&&(n.to=de(t,i)),r&&(n.text=r),void 0!==o&&(n.origin=o)}),_t(t,"beforeChange",t,n),t.cm&&_t(t.cm,"beforeChange",t.cm,n),n.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Qo(t,e,i){if(t.cm){if(!t.cm.curOp)return zr(t.cm,Qo)(t,e,i);if(t.cm.state.suppressEdits)return}if(!(bt(t,"beforeChange")||t.cm&&bt(t.cm,"beforeChange"))||(e=Jo(t,e,!0))){var n=ke&&!i&&Ue(t,e.from,e.to);if(n)for(var r=n.length-1;r>=0;--r)ts(t,{from:n[r].from,to:n[r].to,text:r?[""]:e.text,origin:e.origin});else ts(t,e)}}function ts(t,e){if(1!=e.text.length||""!=e.text[0]||0!=ae(e.from,e.to)){var i=ho(t,e);Io(t,e,i,t.cm?t.cm.curOp.id:NaN),ns(t,e,i,je(t,e));var n=[];vo(t,(function(t,i){i||-1!=$(n,t.history)||(ls(t.history,e),n.push(t.history)),ns(t,e,null,je(t,e))}))}}function es(t,e,i){var n=t.cm&&t.cm.state.suppressEdits;if(!n||i){for(var r,o=t.history,s=t.sel,a="undo"==e?o.done:o.undone,l="undo"==e?o.undone:o.done,c=0;c<a.length&&(r=a[c],i?!r.ranges||r.equals(t.sel):r.ranges);c++);if(c!=a.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(r=a.pop()).ranges){if(n)return void a.push(r);break}if(ko(r,l),i&&!r.equals(t.sel))return void Vo(t,r,{clearRedo:!1});s=r}var u=[];ko(s,l),l.push({changes:u,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;for(var h=bt(t,"beforeChange")||t.cm&&bt(t.cm,"beforeChange"),p=function(i){var n=r.changes[i];if(n.origin=e,h&&!Jo(t,n,!1))return a.length=0,{};u.push(So(t,n));var o=i?ho(t,n):Y(a);ns(t,n,o,Do(t,n)),!i&&t.cm&&t.cm.scrollIntoView({from:n.from,to:co(n)});var s=[];vo(t,(function(t,e){e||-1!=$(s,t.history)||(ls(t.history,n),s.push(t.history)),ns(t,n,null,Do(t,n))}))},d=r.changes.length-1;d>=0;--d){var f=p(d);if(f)return f.v}}}}function is(t,e){if(0!=e&&(t.first+=e,t.sel=new oo(K(t.sel.ranges,(function(t){return new so(se(t.anchor.line+e,t.anchor.ch),se(t.head.line+e,t.head.ch))})),t.sel.primIndex),t.cm)){Nn(t.cm,t.first,t.first-e,e);for(var i=t.cm.display,n=i.viewFrom;n<i.viewTo;n++)Bn(t.cm,n,"gutter")}}function ns(t,e,i,n){if(t.cm&&!t.cm.curOp)return zr(t.cm,ns)(t,e,i,n);if(e.to.line<t.first)is(t,e.text.length-1-(e.to.line-e.from.line));else if(!(e.from.line>t.lastLine())){if(e.from.line<t.first){var r=e.text.length-1-(t.first-e.from.line);is(t,r),e={from:se(t.first,0),to:se(e.to.line+r,e.to.ch),text:[Y(e.text)],origin:e.origin}}var o=t.lastLine();e.to.line>o&&(e={from:e.from,to:se(o,Jt(t,o).text.length),text:[e.text[0]],origin:e.origin}),e.removed=Qt(t,e.from,e.to),i||(i=ho(t,e)),t.cm?rs(t.cm,e,n):_o(t,e,n),Go(t,i,G),t.cantEdit&&Xo(t,se(t.firstLine(),0))&&(t.cantEdit=!1)}}function rs(t,e,i){var n=t.doc,r=t.display,o=e.from,s=e.to,a=!1,l=o.line;t.options.lineWrapping||(l=ie(Qe(Jt(n,o.line))),n.iter(l,s.line+1,(function(t){if(t==r.maxLine)return a=!0,!0}))),n.sel.contains(e.from,e.to)>-1&&xt(t),_o(n,e,i,Dn(t)),t.options.lineWrapping||(n.iter(l,o.line+e.text.length,(function(t){var e=ai(t);e>r.maxLineLength&&(r.maxLine=t,r.maxLineLength=e,r.maxLineChanged=!0,a=!1)})),a&&(t.curOp.updateMaxLine=!0)),Ae(n,o.line),Or(t,400);var c=e.text.length-(s.line-o.line)-1;e.full?Nn(t):o.line!=s.line||1!=e.text.length||yo(t.doc,e)?Nn(t,o.line,s.line+1,c):Bn(t,o.line,"text");var u=bt(t,"changes"),h=bt(t,"change");if(h||u){var p={from:o,to:s,text:e.text,removed:e.removed,origin:e.origin};h&&Ai(t,"change",t,p),u&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(p)}t.display.selForContextMenu=null}function os(t,e,i,n,r){var o;n||(n=i),ae(n,i)<0&&(i=(o=[n,i])[0],n=o[1]),"string"==typeof e&&(e=t.splitLines(e)),Qo(t,{from:i,to:n,text:e,origin:r})}function ss(t,e,i,n){i<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function as(t,e,i,n){for(var r=0;r<t.length;++r){var o=t[r],s=!0;if(o.ranges){o.copied||((o=t[r]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)ss(o.ranges[a].anchor,e,i,n),ss(o.ranges[a].head,e,i,n)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(i<c.from.line)c.from=se(c.from.line+n,c.from.ch),c.to=se(c.to.line+n,c.to.ch);else if(e<=c.to.line){s=!1;break}}s||(t.splice(0,r+1),r=0)}}}function ls(t,e){var i=e.from.line,n=e.to.line,r=e.text.length-(n-i)-1;as(t.done,i,n,r),as(t.undone,i,n,r)}function cs(t,e,i,n){var r=e,o=e;return"number"==typeof e?o=Jt(t,pe(t,e)):r=ie(e),null==r?null:(n(o,r)&&t.cm&&Bn(t.cm,r,i),o)}function us(t){this.lines=t,this.parent=null;for(var e=0,i=0;i<t.length;++i)t[i].parent=this,e+=t[i].height;this.height=e}function hs(t){this.children=t;for(var e=0,i=0,n=0;n<t.length;++n){var r=t[n];e+=r.chunkSize(),i+=r.height,r.parent=this}this.size=e,this.height=i,this.parent=null}so.prototype.from=function(){return he(this.anchor,this.head)},so.prototype.to=function(){return ue(this.anchor,this.head)},so.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},us.prototype={chunkSize:function(){return this.lines.length},removeInner:function(t,e){for(var i=t,n=t+e;i<n;++i){var r=this.lines[i];this.height-=r.height,hi(r),Ai(r,"delete")}this.lines.splice(t,e)},collapse:function(t){t.push.apply(t,this.lines)},insertInner:function(t,e,i){this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(var n=0;n<e.length;++n)e[n].parent=this},iterN:function(t,e,i){for(var n=t+e;t<n;++t)if(i(this.lines[t]))return!0}},hs.prototype={chunkSize:function(){return this.size},removeInner:function(t,e){this.size-=e;for(var i=0;i<this.children.length;++i){var n=this.children[i],r=n.chunkSize();if(t<r){var o=Math.min(e,r-t),s=n.height;if(n.removeInner(t,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(e-=o))break;t=0}else t-=r}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof us))){var a=[];this.collapse(a),this.children=[new us(a)],this.children[0].parent=this}},collapse:function(t){for(var e=0;e<this.children.length;++e)this.children[e].collapse(t)},insertInner:function(t,e,i){this.size+=e.length,this.height+=i;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(t<=o){if(r.insertInner(t,e,i),r.lines&&r.lines.length>50){for(var s=r.lines.length%25+25,a=s;a<r.lines.length;){var l=new us(r.lines.slice(a,a+=25));r.height-=l.height,this.children.splice(++n,0,l),l.parent=this}r.lines=r.lines.slice(0,s),this.maybeSpill()}break}t-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var t=this;do{var e=new hs(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=e.size,t.height-=e.height;var i=$(t.parent.children,t);t.parent.children.splice(i+1,0,e)}else{var n=new hs(t.children);n.parent=t,t.children=[n,e],t=n}e.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()}},iterN:function(t,e,i){for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(t<o){var s=Math.min(e,o-t);if(r.iterN(t,s,i))return!0;if(0==(e-=s))break;t=0}else t-=o}}};var ps=function(t,e,i){if(i)for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this.doc=t,this.node=e};function ds(t,e,i){si(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&ar(t,i)}function fs(t,e,i,n){var r=new ps(t,i,n),o=t.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),cs(t,e,"widget",(function(e){var i=e.widgets||(e.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length,Math.max(0,r.insertAt)),0,r),r.line=e,o&&!ri(t,e)){var n=si(e)<t.scrollTop;ee(e,e.height+Vi(r)),n&&ar(o,r.height),o.curOp.forceUpdate=!0}return!0})),o&&Ai(o,"lineWidgetAdded",o,r,"number"==typeof e?e:ie(e)),r}ps.prototype.clear=function(){var t=this.doc.cm,e=this.line.widgets,i=this.line,n=ie(i);if(null!=n&&e){for(var r=0;r<e.length;++r)e[r]==this&&e.splice(r--,1);e.length||(i.widgets=null);var o=Vi(this);ee(i,Math.max(0,i.height-o)),t&&(Lr(t,(function(){ds(t,i,-o),Bn(t,n,"widget")})),Ai(t,"lineWidgetCleared",t,this,n))}},ps.prototype.changed=function(){var t=this,e=this.height,i=this.doc.cm,n=this.line;this.height=null;var r=Vi(this)-e;r&&(ri(this.doc,n)||ee(n,n.height+r),i&&Lr(i,(function(){i.curOp.forceUpdate=!0,ds(i,n,r),Ai(i,"lineWidgetChanged",i,t,ie(n))})))},wt(ps);var ms=0,gs=function(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++ms};function ys(t,e,i,n,r){if(n&&n.shared)return vs(t,e,i,n,r);if(t.cm&&!t.cm.curOp)return zr(t.cm,ys)(t,e,i,n,r);var o=new gs(t,r),s=ae(e,i);if(n&&N(n,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=P("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Je(t,e.line,e,i,o)||e.line!=i.line&&Je(t,i.line,e,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");ze()}o.addToHistory&&Io(t,{from:e,to:i,origin:"markText"},t.sel,NaN);var a,l=e.line,c=t.cm;if(t.iter(l,i.line+1,(function(n){c&&o.collapsed&&!c.options.lineWrapping&&Qe(n)==c.display.maxLine&&(a=!0),o.collapsed&&l!=e.line&&ee(n,0),Fe(n,new De(o,l==e.line?e.ch:null,l==i.line?i.ch:null),t.cm&&t.cm.curOp),++l})),o.collapsed&&t.iter(e.line,i.line+1,(function(e){ri(t,e)&&ee(e,0)})),o.clearOnEnter&&mt(o,"beforeCursorEnter",(function(){return o.clear()})),o.readOnly&&(Le(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed&&(o.id=++ms,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)Nn(c,e.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var u=e.line;u<=i.line;u++)Bn(c,u,"text");o.atomic&&Zo(c.doc),Ai(c,"markerAdded",c,o)}return o}gs.prototype.clear=function(){if(!this.explicitlyCleared){var t=this.doc.cm,e=t&&!t.curOp;if(e&&Sr(t),bt(this,"clear")){var i=this.find();i&&Ai(this,"clear",i.from,i.to)}for(var n=null,r=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Re(s.markedSpans,this);t&&!this.collapsed?Bn(t,ie(s),"text"):t&&(null!=a.to&&(r=ie(s)),null!=a.from&&(n=ie(s))),s.markedSpans=Oe(s.markedSpans,a),null==a.from&&this.collapsed&&!ri(this.doc,s)&&t&&ee(s,kn(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=Qe(this.lines[l]),u=ai(c);u>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=u,t.display.maxLineChanged=!0)}null!=n&&t&&this.collapsed&&Nn(t,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Zo(t.doc)),t&&Ai(t,"markerCleared",t,this,n,r),e&&Cr(t),this.parent&&this.parent.clear()}},gs.prototype.find=function(t,e){var i,n;null==t&&"bookmark"==this.type&&(t=1);for(var r=0;r<this.lines.length;++r){var o=this.lines[r],s=Re(o.markedSpans,this);if(null!=s.from&&(i=se(e?o:ie(o),s.from),-1==t))return i;if(null!=s.to&&(n=se(e?o:ie(o),s.to),1==t))return n}return i&&{from:i,to:n}},gs.prototype.changed=function(){var t=this,e=this.find(-1,!0),i=this,n=this.doc.cm;e&&n&&Lr(n,(function(){var r=e.line,o=ie(e.line),s=en(n,o);if(s&&(hn(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ri(i.doc,r)&&null!=i.height){var a=i.height;i.height=null;var l=Vi(i)-a;l&&ee(r,r.height+l)}Ai(n,"markerChanged",n,t)}))},gs.prototype.attachLine=function(t){if(!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=$(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)},gs.prototype.detachLine=function(t){if(this.lines.splice($(this.lines,t),1),!this.lines.length&&this.doc.cm){var e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}},wt(gs);var _s=function(t,e){this.markers=t,this.primary=e;for(var i=0;i<t.length;++i)t[i].parent=this};function vs(t,e,i,n,r){(n=N(n)).shared=!1;var o=[ys(t,e,i,n,r)],s=o[0],a=n.widgetNode;return vo(t,(function(t){a&&(n.widgetNode=a.cloneNode(!0)),o.push(ys(t,de(t,e),de(t,i),n,r));for(var l=0;l<t.linked.length;++l)if(t.linked[l].isParent)return;s=Y(o)})),new _s(o,s)}function xs(t){return t.findMarks(se(t.first,0),t.clipPos(se(t.lastLine())),(function(t){return t.parent}))}function bs(t,e){for(var i=0;i<e.length;i++){var n=e[i],r=n.find(),o=t.clipPos(r.from),s=t.clipPos(r.to);if(ae(o,s)){var a=ys(t,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function ws(t){for(var e=function(e){var i=t[e],n=[i.primary.doc];vo(i.primary.doc,(function(t){return n.push(t)}));for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==$(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}},i=0;i<t.length;i++)e(i)}_s.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)this.markers[t].clear();Ai(this,"clear")}},_s.prototype.find=function(t,e){return this.primary.find(t,e)},wt(_s);var Ts=0,Ss=function(t,e,i,n,r){if(!(this instanceof Ss))return new Ss(t,e,i,n,r);null==i&&(i=0),hs.call(this,[new us([new ci("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=se(i,0);this.sel=lo(o),this.history=new To(null),this.id=++Ts,this.modeOption=e,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),_o(this,{from:o,to:o,text:t}),Vo(this,lo(o),G)};Ss.prototype=tt(hs.prototype,{constructor:Ss,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){for(var i=0,n=0;n<e.length;++n)i+=e[n].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){var e=te(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:Rr((function(t){var e=se(this.first,0),i=this.first+this.size-1;Qo(this,{from:e,to:se(i,Jt(this,i).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&cr(this.cm,0,0),Vo(this,lo(e),G)})),replaceRange:function(t,e,i,n){os(this,t,e=de(this,e),i=i?de(this,i):e,n)},getRange:function(t,e,i){var n=Qt(this,de(this,t),de(this,e));return!1===i?n:""===i?n.join(""):n.join(i||this.lineSeparator())},getLine:function(t){var e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(re(this,t))return Jt(this,t)},getLineNumber:function(t){return ie(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=Jt(this,t)),Qe(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return de(this,t)},getCursor:function(t){var e=this.sel.primary();return null==t||"head"==t?e.head:"anchor"==t?e.anchor:"end"==t||"to"==t||!1===t?e.to():e.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Rr((function(t,e,i){jo(this,de(this,"number"==typeof t?se(t,e||0):t),null,i)})),setSelection:Rr((function(t,e,i){jo(this,de(this,t),de(this,e||t),i)})),extendSelection:Rr((function(t,e,i){Fo(this,de(this,t),e&&de(this,e),i)})),extendSelections:Rr((function(t,e){No(this,me(this,t),e)})),extendSelectionsBy:Rr((function(t,e){No(this,me(this,K(this.sel.ranges,t)),e)})),setSelections:Rr((function(t,e,i){if(t.length){for(var n=[],r=0;r<t.length;r++)n[r]=new so(de(this,t[r].anchor),de(this,t[r].head||t[r].anchor));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),Vo(this,ao(this.cm,n,e),i)}})),addSelection:Rr((function(t,e,i){var n=this.sel.ranges.slice(0);n.push(new so(de(this,t),de(this,e||t))),Vo(this,ao(this.cm,n,n.length-1),i)})),getSelection:function(t){for(var e,i=this.sel.ranges,n=0;n<i.length;n++){var r=Qt(this,i[n].from(),i[n].to());e=e?e.concat(r):r}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){for(var e=[],i=this.sel.ranges,n=0;n<i.length;n++){var r=Qt(this,i[n].from(),i[n].to());!1!==t&&(r=r.join(t||this.lineSeparator())),e[n]=r}return e},replaceSelection:function(t,e,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=t;this.replaceSelections(n,e,i||"+input")},replaceSelections:Rr((function(t,e,i){for(var n=[],r=this.sel,o=0;o<r.ranges.length;o++){var s=r.ranges[o];n[o]={from:s.from(),to:s.to(),text:this.splitLines(t[o]),origin:i}}for(var a=e&&"end"!=e&&fo(this,n,e),l=n.length-1;l>=0;l--)Qo(this,n[l]);a?Uo(this,a):this.cm&&lr(this.cm)})),undo:Rr((function(){es(this,"undo")})),redo:Rr((function(){es(this,"redo")})),undoSelection:Rr((function(){es(this,"undo",!0)})),redoSelection:Rr((function(){es(this,"redo",!0)})),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){for(var t=this.history,e=0,i=0,n=0;n<t.done.length;n++)t.done[n].ranges||++e;for(var r=0;r<t.undone.length;r++)t.undone[r].ranges||++i;return{undo:e,redo:i}},clearHistory:function(){var t=this;this.history=new To(this.history),vo(this,(function(e){return e.history=t.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:Ro(this.history.done),undone:Ro(this.history.undone)}},setHistory:function(t){var e=this.history=new To(this.history);e.done=Ro(t.done.slice(0),null,!0),e.undone=Ro(t.undone.slice(0),null,!0)},setGutterMarker:Rr((function(t,e,i){return cs(this,t,"gutter",(function(t){var n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=i,!i&&rt(n)&&(t.gutterMarkers=null),!0}))})),clearGutter:Rr((function(t){var e=this;this.iter((function(i){i.gutterMarkers&&i.gutterMarkers[t]&&cs(e,i,"gutter",(function(){return i.gutterMarkers[t]=null,rt(i.gutterMarkers)&&(i.gutterMarkers=null),!0}))}))})),lineInfo:function(t){var e;if("number"==typeof t){if(!re(this,t))return null;if(e=t,!(t=Jt(this,t)))return null}else if(null==(e=ie(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:Rr((function(t,e,i){return cs(this,t,"gutter"==e?"gutter":"class",(function(t){var n="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass";if(t[n]){if(C(i).test(t[n]))return!1;t[n]+=" "+i}else t[n]=i;return!0}))})),removeLineClass:Rr((function(t,e,i){return cs(this,t,"gutter"==e?"gutter":"class",(function(t){var n="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass",r=t[n];if(!r)return!1;if(null==i)t[n]=null;else{var o=r.match(C(i));if(!o)return!1;var s=o.index+o[0].length;t[n]=r.slice(0,o.index)+(o.index&&s!=r.length?" ":"")+r.slice(s)||null}return!0}))})),addLineWidget:Rr((function(t,e,i){return fs(this,t,e,i)})),removeLineWidget:function(t){t.clear()},markText:function(t,e,i){return ys(this,de(this,t),de(this,e),i,i&&i.type||"range")},setBookmark:function(t,e){var i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return ys(this,t=de(this,t),t,i,"bookmark")},findMarksAt:function(t){var e=[],i=Jt(this,(t=de(this,t)).line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=t.ch)&&(null==r.to||r.to>=t.ch)&&e.push(r.marker.parent||r.marker)}return e},findMarks:function(t,e,i){t=de(this,t),e=de(this,e);var n=[],r=t.line;return this.iter(t.line,e.line+1,(function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==t.line&&t.ch>=l.to||null==l.from&&r!=t.line||null!=l.from&&r==e.line&&l.from>=e.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r})),n},getAllMarks:function(){var t=[];return this.iter((function(e){var i=e.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&t.push(i[n].marker)})),t},posFromIndex:function(t){var e,i=this.first,n=this.lineSeparator().length;return this.iter((function(r){var o=r.text.length+n;if(o>t)return e=t,!0;t-=o,++i})),de(this,se(i,e))},indexFromPos:function(t){var e=(t=de(this,t)).ch;if(t.line<this.first||t.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,t.line,(function(t){e+=t.text.length+i})),e},copy:function(t){var e=new Ss(te(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});var e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);var n=new Ss(te(this,e,i),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],bs(n,xs(this)),n},unlinkDoc:function(t){if(t instanceof Na&&(t=t.doc),this.linked)for(var e=0;e<this.linked.length;++e)if(this.linked[e].doc==t){this.linked.splice(e,1),t.unlinkDoc(this),ws(xs(this));break}if(t.history==this.history){var i=[t.id];vo(t,(function(t){return i.push(t.id)}),!0),t.history=new To(null),t.history.done=Ro(this.history.done,i),t.history.undone=Ro(this.history.undone,i)}},iterLinkedDocs:function(t){vo(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):Rt(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Rr((function(t){"rtl"!=t&&(t="ltr"),t!=this.direction&&(this.direction=t,this.iter((function(t){return t.order=null})),this.cm&&wo(this.cm))}))}),Ss.prototype.eachLine=Ss.prototype.iter;var Cs=0;function Es(t){var e=this;if(As(e),!vt(e,t)&&!Gi(e.display,t)){Tt(t),s&&(Cs=+new Date);var i=On(e,t,!0),n=t.dataTransfer.files;if(i&&!e.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),a=0,l=function(){++a==r&&zr(e,(function(){var t={from:i=de(e.doc,i),to:i,text:e.doc.splitLines(o.filter((function(t){return null!=t})).join(e.doc.lineSeparator())),origin:"paste"};Qo(e.doc,t),Uo(e.doc,lo(de(e.doc,i),de(e.doc,co(t))))}))()},c=function(t,i){if(e.options.allowDropFileTypes&&-1==$(e.options.allowDropFileTypes,t.type))l();else{var n=new FileReader;n.onerror=function(){return l()},n.onload=function(){var t=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(t)||(o[i]=t),l()},n.readAsText(t)}},u=0;u<n.length;u++)c(n[u],u);else{if(e.state.draggingText&&e.doc.sel.contains(i)>-1)return e.state.draggingText(t),void setTimeout((function(){return e.display.input.focus()}),20);try{var h=t.dataTransfer.getData("Text");if(h){var p;if(e.state.draggingText&&!e.state.draggingText.copy&&(p=e.listSelections()),Go(e.doc,lo(i,i)),p)for(var d=0;d<p.length;++d)os(e.doc,"",p[d].anchor,p[d].head,"drag");e.replaceSelection(h,"around","paste"),e.display.input.focus()}}catch(t){}}}}function Is(t,e){if(s&&(!t.state.draggingText||+new Date-Cs<100))Et(e);else if(!vt(t,e)&&!Gi(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!d)){var i=k("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",p&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),p&&i.parentNode.removeChild(i)}}function Ms(t,e){var i=On(t,e);if(i){var n=document.createDocumentFragment();Zn(t,i,n),t.display.dragCursor||(t.display.dragCursor=k("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),A(t.display.dragCursor,n)}}function As(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function ks(t){if(document.getElementsByClassName){for(var e=document.getElementsByClassName("CodeMirror"),i=[],n=0;n<e.length;n++){var r=e[n].CodeMirror;r&&i.push(r)}i.length&&i[0].operation((function(){for(var e=0;e<i.length;e++)t(i[e])}))}}var Ps=!1;function Ls(){Ps||(zs(),Ps=!0)}function zs(){var t;mt(window,"resize",(function(){null==t&&(t=setTimeout((function(){t=null,ks(Ds)}),100))})),mt(window,"blur",(function(){return ks(Qn)}))}function Ds(t){var e=t.display;e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize()}for(var Rs={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Os=0;Os<10;Os++)Rs[Os+48]=Rs[Os+96]=String(Os);for(var Fs=65;Fs<=90;Fs++)Rs[Fs]=String.fromCharCode(Fs);for(var Ns=1;Ns<=12;Ns++)Rs[Ns+111]=Rs[Ns+63235]="F"+Ns;var Bs={};function js(t){var e,i,n,r,o=t.split(/-(?!$)/);t=o[o.length-1];for(var s=0;s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))r=!0;else if(/^a(lt)?$/i.test(a))e=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);n=!0}}return e&&(t="Alt-"+t),i&&(t="Ctrl-"+t),r&&(t="Cmd-"+t),n&&(t="Shift-"+t),t}function $s(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete t[i];continue}for(var r=K(i.split(" "),js),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=n):(a=r.slice(0,o+1).join(" "),s="...");var l=e[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else e[a]=s}delete t[i]}for(var c in e)t[c]=e[c];return t}function Us(t,e,i,n){var r=(e=Zs(e)).call?e.call(t,n):e[t];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return Us(t,e.fallthrough,i,n);for(var o=0;o<e.fallthrough.length;o++){var s=Us(t,e.fallthrough[o],i,n);if(s)return s}}}function Vs(t){var e="string"==typeof t?t:Rs[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function Gs(t,e,i){var n=t;return e.altKey&&"Alt"!=n&&(t="Alt-"+t),(T?e.metaKey:e.ctrlKey)&&"Ctrl"!=n&&(t="Ctrl-"+t),(T?e.ctrlKey:e.metaKey)&&"Mod"!=n&&(t="Cmd-"+t),!i&&e.shiftKey&&"Shift"!=n&&(t="Shift-"+t),t}function qs(t,e){if(p&&34==t.keyCode&&t.char)return!1;var i=Rs[t.keyCode];return null!=i&&!t.altGraphKey&&(3==t.keyCode&&t.code&&(i=t.code),Gs(i,t,e))}function Zs(t){return"string"==typeof t?Bs[t]:t}function Ws(t,e){for(var i=t.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=e(i[r]);n.length&&ae(o.from,Y(n).to)<=0;){var s=n.pop();if(ae(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}Lr(t,(function(){for(var e=n.length-1;e>=0;e--)os(t.doc,"",n[e].from,n[e].to,"+delete");lr(t)}))}function Hs(t,e,i){var n=at(t.text,e+i,i);return n<0||n>t.text.length?null:n}function Xs(t,e,i){var n=Hs(t,e.ch,i);return null==n?null:new se(e.line,n,i<0?"after":"before")}function Ys(t,e,i,n,r){if(t){"rtl"==e.doc.direction&&(r=-r);var o=dt(i,e.doc.direction);if(o){var s,a=r<0?Y(o):o[0],l=r<0==(1==a.level)?"after":"before";if(a.level>0||"rtl"==e.doc.direction){var c=nn(e,i);s=r<0?i.text.length-1:0;var u=rn(e,c,s).top;s=lt((function(t){return rn(e,c,t).top==u}),r<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=Hs(i,s,1))}else s=r<0?a.to:a.from;return new se(n,s,l)}}return new se(n,r<0?i.text.length:0,r<0?"before":"after")}function Ks(t,e,i,n){var r=dt(e,t.doc.direction);if(!r)return Xs(e,i,n);i.ch>=e.text.length?(i.ch=e.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=ht(r,i.ch,i.sticky),s=r[o];if("ltr"==t.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Xs(e,i,n);var a,l=function(t,i){return Hs(e,t instanceof se?t.ch:t,i)},c=function(i){return t.options.lineWrapping?(a=a||nn(t,e),Cn(t,e,a,i)):{begin:0,end:e.text.length}},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==t.doc.direction||1==s.level){var h=1==s.level==n<0,p=l(i,h?1:-1);if(null!=p&&(h?p<=s.to&&p<=u.end:p>=s.from&&p>=u.begin)){var d=h?"before":"after";return new se(i.line,p,d)}}var f=function(t,e,n){for(var o=function(t,e){return e?new se(i.line,l(t,1),"before"):new se(i.line,t,"after")};t>=0&&t<r.length;t+=e){var s=r[t],a=e>0==(1!=s.level),c=a?n.begin:l(n.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),n.begin<=c&&c<n.end)return o(c,a)}},m=f(o+n,n,u);if(m)return m;var g=n>0?u.end:l(u.begin,-1);return null==g||n>0&&g==e.text.length||!(m=f(n>0?0:r.length-1,n,c(g)))?null:m}Bs.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Bs.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Bs.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Bs.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Bs.default=v?Bs.macDefault:Bs.pcDefault;var Js={selectAll:Ko,singleSelection:function(t){return t.setSelection(t.getCursor("anchor"),t.getCursor("head"),G)},killLine:function(t){return Ws(t,(function(e){if(e.empty()){var i=Jt(t.doc,e.head.line).text.length;return e.head.ch==i&&e.head.line<t.lastLine()?{from:e.head,to:se(e.head.line+1,0)}:{from:e.head,to:se(e.head.line,i)}}return{from:e.from(),to:e.to()}}))},deleteLine:function(t){return Ws(t,(function(e){return{from:se(e.from().line,0),to:de(t.doc,se(e.to().line+1,0))}}))},delLineLeft:function(t){return Ws(t,(function(t){return{from:se(t.from().line,0),to:t.from()}}))},delWrappedLineLeft:function(t){return Ws(t,(function(e){var i=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:i},"div"),to:e.from()}}))},delWrappedLineRight:function(t){return Ws(t,(function(e){var i=t.charCoords(e.head,"div").top+5,n=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div");return{from:e.from(),to:n}}))},undo:function(t){return t.undo()},redo:function(t){return t.redo()},undoSelection:function(t){return t.undoSelection()},redoSelection:function(t){return t.redoSelection()},goDocStart:function(t){return t.extendSelection(se(t.firstLine(),0))},goDocEnd:function(t){return t.extendSelection(se(t.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy((function(e){return Qs(t,e.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy((function(e){return ea(t,e.head)}),{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy((function(e){return ta(t,e.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(t){return t.extendSelectionsBy((function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div")}),Z)},goLineLeft:function(t){return t.extendSelectionsBy((function(e){var i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:i},"div")}),Z)},goLineLeftSmart:function(t){return t.extendSelectionsBy((function(e){var i=t.cursorCoords(e.head,"div").top+5,n=t.coordsChar({left:0,top:i},"div");return n.ch<t.getLine(n.line).search(/\S/)?ea(t,e.head):n}),Z)},goLineUp:function(t){return t.moveV(-1,"line")},goLineDown:function(t){return t.moveV(1,"line")},goPageUp:function(t){return t.moveV(-1,"page")},goPageDown:function(t){return t.moveV(1,"page")},goCharLeft:function(t){return t.moveH(-1,"char")},goCharRight:function(t){return t.moveH(1,"char")},goColumnLeft:function(t){return t.moveH(-1,"column")},goColumnRight:function(t){return t.moveH(1,"column")},goWordLeft:function(t){return t.moveH(-1,"word")},goGroupRight:function(t){return t.moveH(1,"group")},goGroupLeft:function(t){return t.moveH(-1,"group")},goWordRight:function(t){return t.moveH(1,"word")},delCharBefore:function(t){return t.deleteH(-1,"codepoint")},delCharAfter:function(t){return t.deleteH(1,"char")},delWordBefore:function(t){return t.deleteH(-1,"word")},delWordAfter:function(t){return t.deleteH(1,"word")},delGroupBefore:function(t){return t.deleteH(-1,"group")},delGroupAfter:function(t){return t.deleteH(1,"group")},indentAuto:function(t){return t.indentSelection("smart")},indentMore:function(t){return t.indentSelection("add")},indentLess:function(t){return t.indentSelection("subtract")},insertTab:function(t){return t.replaceSelection("\t")},insertSoftTab:function(t){for(var e=[],i=t.listSelections(),n=t.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=B(t.getLine(o.line),o.ch,n);e.push(X(n-s%n))}t.replaceSelections(e)},defaultTab:function(t){t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:function(t){return Lr(t,(function(){for(var e=t.listSelections(),i=[],n=0;n<e.length;n++)if(e[n].empty()){var r=e[n].head,o=Jt(t.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new se(r.line,r.ch-1)),r.ch>0)r=new se(r.line,r.ch+1),t.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),se(r.line,r.ch-2),r,"+transpose");else if(r.line>t.doc.first){var s=Jt(t.doc,r.line-1).text;s&&(r=new se(r.line,1),t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+s.charAt(s.length-1),se(r.line-1,s.length-1),r,"+transpose"))}i.push(new so(r,r))}t.setSelections(i)}))},newlineAndIndent:function(t){return Lr(t,(function(){for(var e=t.listSelections(),i=e.length-1;i>=0;i--)t.replaceRange(t.doc.lineSeparator(),e[i].anchor,e[i].head,"+input");e=t.listSelections();for(var n=0;n<e.length;n++)t.indentLine(e[n].from().line,null,!0);lr(t)}))},openLine:function(t){return t.replaceSelection("\n","start")},toggleOverwrite:function(t){return t.toggleOverwrite()}};function Qs(t,e){var i=Jt(t.doc,e),n=Qe(i);return n!=i&&(e=ie(n)),Ys(!0,t,n,e,1)}function ta(t,e){var i=Jt(t.doc,e),n=ti(i);return n!=i&&(e=ie(n)),Ys(!0,t,i,e,-1)}function ea(t,e){var i=Qs(t,e.line),n=Jt(t.doc,i.line),r=dt(n,t.doc.direction);if(!r||0==r[0].level){var o=Math.max(i.ch,n.text.search(/\S/)),s=e.line==i.line&&e.ch<=o&&e.ch;return se(i.line,s?0:o,i.sticky)}return i}function ia(t,e,i){if("string"==typeof e&&!(e=Js[e]))return!1;t.display.input.ensurePolled();var n=t.display.shift,r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),i&&(t.display.shift=!1),r=e(t)!=V}finally{t.display.shift=n,t.state.suppressEdits=!1}return r}function na(t,e,i){for(var n=0;n<t.state.keyMaps.length;n++){var r=Us(e,t.state.keyMaps[n],i,t);if(r)return r}return t.options.extraKeys&&Us(e,t.options.extraKeys,i,t)||Us(e,t.options.keyMap,i,t)}var ra=new j;function oa(t,e,i,n){var r=t.state.keySeq;if(r){if(Vs(e))return"handled";if(/\'$/.test(e)?t.state.keySeq=null:ra.set(50,(function(){t.state.keySeq==r&&(t.state.keySeq=null,t.display.input.reset())})),sa(t,r+" "+e,i,n))return!0}return sa(t,e,i,n)}function sa(t,e,i,n){var r=na(t,e,n);return"multi"==r&&(t.state.keySeq=e),"handled"==r&&Ai(t,"keyHandled",t,e,i),"handled"!=r&&"multi"!=r||(Tt(i),Xn(t)),!!r}function aa(t,e){var i=qs(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?oa(t,"Shift-"+i,e,(function(e){return ia(t,e,!0)}))||oa(t,i,e,(function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return ia(t,e)})):oa(t,i,e,(function(e){return ia(t,e)})))}function la(t,e,i){return oa(t,"'"+i+"'",e,(function(e){return ia(t,e,!0)}))}var ca=null;function ua(t){var e=this;if(!(t.target&&t.target!=e.display.input.getField()||(e.curOp.focus=z(),vt(e,t)))){s&&a<11&&27==t.keyCode&&(t.returnValue=!1);var n=t.keyCode;e.display.shift=16==n||t.shiftKey;var r=aa(e,t);p&&(ca=r?n:null,r||88!=n||Ft||!(v?t.metaKey:t.ctrlKey)||e.replaceSelection("",null,"cut")),i&&!v&&!r&&46==n&&t.shiftKey&&!t.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=n||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||ha(e)}}function ha(t){var e=t.display.lineDiv;function i(t){18!=t.keyCode&&t.altKey||(I(e,"CodeMirror-crosshair"),yt(document,"keyup",i),yt(document,"mouseover",i))}D(e,"CodeMirror-crosshair"),mt(document,"keyup",i),mt(document,"mouseover",i)}function pa(t){16==t.keyCode&&(this.doc.sel.shift=!1),vt(this,t)}function da(t){var e=this;if(!(t.target&&t.target!=e.display.input.getField()||Gi(e.display,t)||vt(e,t)||t.ctrlKey&&!t.altKey||v&&t.metaKey)){var i=t.keyCode,n=t.charCode;if(p&&i==ca)return ca=null,void Tt(t);if(!p||t.which&&!(t.which<10)||!aa(e,t)){var r=String.fromCharCode(null==n?i:n);"\b"!=r&&(la(e,t,r)||e.display.input.onKeyPress(t))}}}var fa,ma,ga=400,ya=function(t,e,i){this.time=t,this.pos=e,this.button=i};function _a(t,e){var i=+new Date;return ma&&ma.compare(i,t,e)?(fa=ma=null,"triple"):fa&&fa.compare(i,t,e)?(ma=new ya(i,t,e),fa=null,"double"):(fa=new ya(i,t,e),ma=null,"single")}function va(t){var e=this,i=e.display;if(!(vt(e,t)||i.activeTouch&&i.input.supportsTouch()))if(i.input.ensurePolled(),i.shift=t.shiftKey,Gi(i,t))l||(i.scroller.draggable=!1,setTimeout((function(){return i.scroller.draggable=!0}),100));else if(!Ma(e,t)){var n=On(e,t),r=Mt(t),o=n?_a(n,r):"single";window.focus(),1==r&&e.state.selectingText&&e.state.selectingText(t),n&&xa(e,r,n,o,t)||(1==r?n?wa(e,n,o,t):It(t)==i.scroller&&Tt(t):2==r?(n&&Fo(e.doc,n),setTimeout((function(){return i.input.focus()}),20)):3==r&&(S?e.display.input.onContextMenu(t):Kn(e)))}}function xa(t,e,i,n,r){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),oa(t,Gs(o=(1==e?"Left":2==e?"Middle":"Right")+o,r),r,(function(e){if("string"==typeof e&&(e=Js[e]),!e)return!1;var n=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n=e(t,i)!=V}finally{t.state.suppressEdits=!1}return n}))}function ba(t,e,i){var n=t.getOption("configureMouse"),r=n?n(t,e,i):{};if(null==r.unit){var o=x?i.shiftKey&&i.metaKey:i.altKey;r.unit=o?"rectangle":"single"==e?"char":"double"==e?"word":"line"}return(null==r.extend||t.doc.extend)&&(r.extend=t.doc.extend||i.shiftKey),null==r.addNew&&(r.addNew=v?i.metaKey:i.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(v?i.altKey:i.ctrlKey)),r}function wa(t,e,i,n){s?setTimeout(F(Yn,t),0):t.curOp.focus=z();var r,o=ba(t,i,n),a=t.doc.sel;t.options.dragDrop&&Pt&&!t.isReadOnly()&&"single"==i&&(r=a.contains(e))>-1&&(ae((r=a.ranges[r]).from(),e)<0||e.xRel>0)&&(ae(r.to(),e)>0||e.xRel<0)?Ta(t,n,e,o):Ca(t,n,e,o)}function Ta(t,e,i,n){var r=t.display,o=!1,c=zr(t,(function(e){l&&(r.scroller.draggable=!1),t.state.draggingText=!1,t.state.delayingBlurEvent&&(t.hasFocus()?t.state.delayingBlurEvent=!1:Kn(t)),yt(r.wrapper.ownerDocument,"mouseup",c),yt(r.wrapper.ownerDocument,"mousemove",u),yt(r.scroller,"dragstart",h),yt(r.scroller,"drop",c),o||(Tt(e),n.addNew||Fo(t.doc,i,null,null,n.extend),l&&!d||s&&9==a?setTimeout((function(){r.wrapper.ownerDocument.body.focus({preventScroll:!0}),r.input.focus()}),20):r.input.focus())})),u=function(t){o=o||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},h=function(){return o=!0};l&&(r.scroller.draggable=!0),t.state.draggingText=c,c.copy=!n.moveOnDrag,mt(r.wrapper.ownerDocument,"mouseup",c),mt(r.wrapper.ownerDocument,"mousemove",u),mt(r.scroller,"dragstart",h),mt(r.scroller,"drop",c),t.state.delayingBlurEvent=!0,setTimeout((function(){return r.input.focus()}),20),r.scroller.dragDrop&&r.scroller.dragDrop()}function Sa(t,e,i){if("char"==i)return new so(e,e);if("word"==i)return t.findWordAt(e);if("line"==i)return new so(se(e.line,0),de(t.doc,se(e.line+1,0)));var n=i(t,e);return new so(n.from,n.to)}function Ca(t,e,i,n){s&&Kn(t);var r=t.display,o=t.doc;Tt(e);var a,l,c=o.sel,u=c.ranges;if(n.addNew&&!n.extend?(l=o.sel.contains(i),a=l>-1?u[l]:new so(i,i)):(a=o.sel.primary(),l=o.sel.primIndex),"rectangle"==n.unit)n.addNew||(a=new so(i,i)),i=On(t,e,!0,!0),l=-1;else{var h=Sa(t,i,n.unit);a=n.extend?Oo(a,h.anchor,h.head,n.extend):h}n.addNew?-1==l?(l=u.length,Vo(o,ao(t,u.concat([a]),l),{scroll:!1,origin:"*mouse"})):u.length>1&&u[l].empty()&&"char"==n.unit&&!n.extend?(Vo(o,ao(t,u.slice(0,l).concat(u.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),c=o.sel):Bo(o,l,a,q):(l=0,Vo(o,new oo([a],0),q),c=o.sel);var p=i;function d(e){if(0!=ae(p,e))if(p=e,"rectangle"==n.unit){for(var r=[],s=t.options.tabSize,u=B(Jt(o,i.line).text,i.ch,s),h=B(Jt(o,e.line).text,e.ch,s),d=Math.min(u,h),f=Math.max(u,h),m=Math.min(i.line,e.line),g=Math.min(t.lastLine(),Math.max(i.line,e.line));m<=g;m++){var y=Jt(o,m).text,_=W(y,d,s);d==f?r.push(new so(se(m,_),se(m,_))):y.length>_&&r.push(new so(se(m,_),se(m,W(y,f,s))))}r.length||r.push(new so(i,i)),Vo(o,ao(t,c.ranges.slice(0,l).concat(r),l),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{var v,x=a,b=Sa(t,e,n.unit),w=x.anchor;ae(b.anchor,w)>0?(v=b.head,w=he(x.from(),b.anchor)):(v=b.anchor,w=ue(x.to(),b.head));var T=c.ranges.slice(0);T[l]=Ea(t,new so(de(o,w),v)),Vo(o,ao(t,T,l),q)}}var f=r.wrapper.getBoundingClientRect(),m=0;function g(e){var i=++m,s=On(t,e,!0,"rectangle"==n.unit);if(s)if(0!=ae(s,p)){t.curOp.focus=z(),d(s);var a=ir(r,o);(s.line>=a.to||s.line<a.from)&&setTimeout(zr(t,(function(){m==i&&g(e)})),150)}else{var l=e.clientY<f.top?-20:e.clientY>f.bottom?20:0;l&&setTimeout(zr(t,(function(){m==i&&(r.scroller.scrollTop+=l,g(e))})),50)}}function y(e){t.state.selectingText=!1,m=1/0,e&&(Tt(e),r.input.focus()),yt(r.wrapper.ownerDocument,"mousemove",_),yt(r.wrapper.ownerDocument,"mouseup",v),o.history.lastSelOrigin=null}var _=zr(t,(function(t){0!==t.buttons&&Mt(t)?g(t):y(t)})),v=zr(t,y);t.state.selectingText=v,mt(r.wrapper.ownerDocument,"mousemove",_),mt(r.wrapper.ownerDocument,"mouseup",v)}function Ea(t,e){var i=e.anchor,n=e.head,r=Jt(t.doc,i.line);if(0==ae(i,n)&&i.sticky==n.sticky)return e;var o=dt(r);if(!o)return e;var s=ht(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return e;var l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return e;if(n.line!=i.line)l=(n.line-i.line)*("ltr"==t.doc.direction?1:-1)>0;else{var u=ht(o,n.ch,n.sticky),h=u-s||(n.ch-i.ch)*(1==a.level?-1:1);l=u==c-1||u==c?h<0:h>0}var p=o[c+(l?-1:0)],d=l==(1==p.level),f=d?p.from:p.to,m=d?"after":"before";return i.ch==f&&i.sticky==m?e:new so(new se(i.line,f,m),n)}function Ia(t,e,i,n){var r,o;if(e.touches)r=e.touches[0].clientX,o=e.touches[0].clientY;else try{r=e.clientX,o=e.clientY}catch(t){return!1}if(r>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;n&&Tt(e);var s=t.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!bt(t,i))return Ct(e);o-=a.top-s.viewOffset;for(var l=0;l<t.display.gutterSpecs.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r)return _t(t,i,t,ne(t.doc,o),t.display.gutterSpecs[l].className,e),Ct(e)}}function Ma(t,e){return Ia(t,e,"gutterClick",!0)}function Aa(t,e){Gi(t.display,e)||ka(t,e)||vt(t,e,"contextmenu")||S||t.display.input.onContextMenu(e)}function ka(t,e){return!!bt(t,"gutterContextMenu")&&Ia(t,e,"gutterContextMenu",!1)}function Pa(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),dn(t)}ya.prototype.compare=function(t,e,i){return this.time+ga>t&&0==ae(e,this.pos)&&i==this.button};var La={toString:function(){return"CodeMirror.Init"}},za={},Da={};function Ra(t){var e=t.optionHandlers;function i(i,n,r,o){t.defaults[i]=n,r&&(e[i]=o?function(t,e,i){i!=La&&r(t,e,i)}:r)}t.defineOption=i,t.Init=La,i("value","",(function(t,e){return t.setValue(e)}),!0),i("mode",null,(function(t,e){t.doc.modeOption=e,mo(t)}),!0),i("indentUnit",2,mo,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(function(t){go(t),dn(t),Nn(t)}),!0),i("lineSeparator",null,(function(t,e){if(t.doc.lineSep=e,e){var i=[],n=t.doc.first;t.doc.iter((function(t){for(var r=0;;){var o=t.text.indexOf(e,r);if(-1==o)break;r=o+e.length,i.push(se(n,o))}n++}));for(var r=i.length-1;r>=0;r--)os(t.doc,e,i[r],se(i[r].line,i[r].ch+e.length))}})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(function(t,e,i){t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),i!=La&&t.refresh()})),i("specialCharPlaceholder",gi,(function(t){return t.refresh()}),!0),i("electricChars",!0),i("inputStyle",_?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,(function(t,e){return t.getInputField().spellcheck=e}),!0),i("autocorrect",!1,(function(t,e){return t.getInputField().autocorrect=e}),!0),i("autocapitalize",!1,(function(t,e){return t.getInputField().autocapitalize=e}),!0),i("rtlMoveVisually",!b),i("wholeLineUpdateBefore",!0),i("theme","default",(function(t){Pa(t),Jr(t)}),!0),i("keyMap","default",(function(t,e,i){var n=Zs(e),r=i!=La&&Zs(i);r&&r.detach&&r.detach(t,n),n.attach&&n.attach(t,r||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,Fa,!0),i("gutters",[],(function(t,e){t.display.gutterSpecs=Yr(e,t.options.lineNumbers),Jr(t)}),!0),i("fixedGutter",!0,(function(t,e){t.display.gutters.style.left=e?zn(t.display)+"px":"0",t.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(function(t){return vr(t)}),!0),i("scrollbarStyle","native",(function(t){wr(t),vr(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)}),!0),i("lineNumbers",!1,(function(t,e){t.display.gutterSpecs=Yr(t.options.gutters,e),Jr(t)}),!0),i("firstLineNumber",1,Jr,!0),i("lineNumberFormatter",(function(t){return t}),Jr,!0),i("showCursorWhenSelecting",!1,Gn,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,(function(t,e){"nocursor"==e&&(Qn(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)})),i("screenReaderLabel",null,(function(t,e){e=""===e?null:e,t.display.input.screenReaderLabelChanged(e)})),i("disableInput",!1,(function(t,e){e||t.display.input.reset()}),!0),i("dragDrop",!0,Oa),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,Gn,!0),i("singleCursorHeightPerLine",!0,Gn,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,go,!0),i("addModeClass",!1,go,!0),i("pollInterval",100),i("undoDepth",200,(function(t,e){return t.doc.history.undoDepth=e})),i("historyEventDelay",1250),i("viewportMargin",10,(function(t){return t.refresh()}),!0),i("maxHighlightLength",1e4,go,!0),i("moveInputWithCursor",!0,(function(t,e){e||t.display.input.resetPosition()})),i("tabindex",null,(function(t,e){return t.display.input.getField().tabIndex=e||""})),i("autofocus",null),i("direction","ltr",(function(t,e){return t.doc.setDirection(e)}),!0),i("phrases",null)}function Oa(t,e,i){if(!e!=!(i&&i!=La)){var n=t.display.dragFunctions,r=e?mt:yt;r(t.display.scroller,"dragstart",n.start),r(t.display.scroller,"dragenter",n.enter),r(t.display.scroller,"dragover",n.over),r(t.display.scroller,"dragleave",n.leave),r(t.display.scroller,"drop",n.drop)}}function Fa(t){t.options.lineWrapping?(D(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(I(t.display.wrapper,"CodeMirror-wrap"),li(t)),Rn(t),Nn(t),dn(t),setTimeout((function(){return vr(t)}),100)}function Na(t,e){var i=this;if(!(this instanceof Na))return new Na(t,e);this.options=e=e?N(e):{},N(za,e,!1);var n=e.value;"string"==typeof n?n=new Ss(n,e.mode,null,e.lineSeparator,e.direction):e.mode&&(n.modeOption=e.mode),this.doc=n;var r=new Na.inputStyles[e.inputStyle](this),o=this.display=new Qr(t,n,r,e);for(var c in o.wrapper.CodeMirror=this,Pa(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),wr(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new j,keySeq:null,specialChars:null},e.autofocus&&!_&&o.input.focus(),s&&a<11&&setTimeout((function(){return i.display.input.reset(!0)}),20),Ba(this),Ls(),Sr(this),this.curOp.forceUpdate=!0,xo(this,n),e.autofocus&&!_||this.hasFocus()?setTimeout((function(){i.hasFocus()&&!i.state.focused&&Jn(i)}),20):Qn(this),Da)Da.hasOwnProperty(c)&&Da[c](this,e[c],La);Xr(this),e.finishInit&&e.finishInit(this);for(var u=0;u<ja.length;++u)ja[u](this);Cr(this),l&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Ba(t){var e=t.display;mt(e.scroller,"mousedown",zr(t,va)),mt(e.scroller,"dblclick",s&&a<11?zr(t,(function(e){if(!vt(t,e)){var i=On(t,e);if(i&&!Ma(t,e)&&!Gi(t.display,e)){Tt(e);var n=t.findWordAt(i);Fo(t.doc,n.anchor,n.head)}}})):function(e){return vt(t,e)||Tt(e)}),mt(e.scroller,"contextmenu",(function(e){return Aa(t,e)})),mt(e.input.getField(),"contextmenu",(function(i){e.scroller.contains(i.target)||Aa(t,i)}));var i,n={end:0};function r(){e.activeTouch&&(i=setTimeout((function(){return e.activeTouch=null}),1e3),(n=e.activeTouch).end=+new Date)}function o(t){if(1!=t.touches.length)return!1;var e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}function l(t,e){if(null==e.left)return!0;var i=e.left-t.left,n=e.top-t.top;return i*i+n*n>400}mt(e.scroller,"touchstart",(function(r){if(!vt(t,r)&&!o(r)&&!Ma(t,r)){e.input.ensurePolled(),clearTimeout(i);var s=+new Date;e.activeTouch={start:s,moved:!1,prev:s-n.end<=300?n:null},1==r.touches.length&&(e.activeTouch.left=r.touches[0].pageX,e.activeTouch.top=r.touches[0].pageY)}})),mt(e.scroller,"touchmove",(function(){e.activeTouch&&(e.activeTouch.moved=!0)})),mt(e.scroller,"touchend",(function(i){var n=e.activeTouch;if(n&&!Gi(e,i)&&null!=n.left&&!n.moved&&new Date-n.start<300){var o,s=t.coordsChar(e.activeTouch,"page");o=!n.prev||l(n,n.prev)?new so(s,s):!n.prev.prev||l(n,n.prev.prev)?t.findWordAt(s):new so(se(s.line,0),de(t.doc,se(s.line+1,0))),t.setSelection(o.anchor,o.head),t.focus(),Tt(i)}r()})),mt(e.scroller,"touchcancel",r),mt(e.scroller,"scroll",(function(){e.scroller.clientHeight&&(dr(t,e.scroller.scrollTop),mr(t,e.scroller.scrollLeft,!0),_t(t,"scroll",t))})),mt(e.scroller,"mousewheel",(function(e){return ro(t,e)})),mt(e.scroller,"DOMMouseScroll",(function(e){return ro(t,e)})),mt(e.wrapper,"scroll",(function(){return e.wrapper.scrollTop=e.wrapper.scrollLeft=0})),e.dragFunctions={enter:function(e){vt(t,e)||Et(e)},over:function(e){vt(t,e)||(Ms(t,e),Et(e))},start:function(e){return Is(t,e)},drop:zr(t,Es),leave:function(e){vt(t,e)||As(t)}};var c=e.input.getField();mt(c,"keyup",(function(e){return pa.call(t,e)})),mt(c,"keydown",zr(t,ua)),mt(c,"keypress",zr(t,da)),mt(c,"focus",(function(e){return Jn(t,e)})),mt(c,"blur",(function(e){return Qn(t,e)}))}Na.defaults=za,Na.optionHandlers=Da;var ja=[];function $a(t,e,i,n){var r,o=t.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=xe(t,e).state:i="prev");var s=t.options.tabSize,a=Jt(o,e),l=B(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&((c=o.mode.indent(r,a.text.slice(u.length),a.text))==V||c>150)){if(!n)return;i="prev"}}else c=0,i="not";"prev"==i?c=e>o.first?B(Jt(o,e-1).text,null,s):0:"add"==i?c=l+t.options.indentUnit:"subtract"==i?c=l-t.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",p=0;if(t.options.indentWithTabs)for(var d=Math.floor(c/s);d;--d)p+=s,h+="\t";if(p<c&&(h+=X(c-p)),h!=u)return os(o,h,se(e,0),se(e,u.length),"+input"),a.stateAfter=null,!0;for(var f=0;f<o.sel.ranges.length;f++){var m=o.sel.ranges[f];if(m.head.line==e&&m.head.ch<u.length){var g=se(e,u.length);Bo(o,f,new so(g,g));break}}}Na.defineInitHook=function(t){return ja.push(t)};var Ua=null;function Va(t){Ua=t}function Ga(t,e,i,n,r){var o=t.doc;t.display.shift=!1,n||(n=o.sel);var s=+new Date-200,a="paste"==r||t.state.pasteIncoming>s,l=Rt(e),c=null;if(a&&n.ranges.length>1)if(Ua&&Ua.text.join("\n")==e){if(n.ranges.length%Ua.text.length==0){c=[];for(var u=0;u<Ua.text.length;u++)c.push(o.splitLines(Ua.text[u]))}}else l.length==n.ranges.length&&t.options.pasteLinesPerSelection&&(c=K(l,(function(t){return[t]})));for(var h=t.curOp.updateInput,p=n.ranges.length-1;p>=0;p--){var d=n.ranges[p],f=d.from(),m=d.to();d.empty()&&(i&&i>0?f=se(f.line,f.ch-i):t.state.overwrite&&!a?m=se(m.line,Math.min(Jt(o,m.line).text.length,m.ch+Y(l).length)):a&&Ua&&Ua.lineWise&&Ua.text.join("\n")==l.join("\n")&&(f=m=se(f.line,0)));var g={from:f,to:m,text:c?c[p%c.length]:l,origin:r||(a?"paste":t.state.cutIncoming>s?"cut":"+input")};Qo(t.doc,g),Ai(t,"inputRead",t,g)}e&&!a&&Za(t,e),lr(t),t.curOp.updateInput<2&&(t.curOp.updateInput=h),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function qa(t,e){var i=t.clipboardData&&t.clipboardData.getData("Text");if(i)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||!e.hasFocus()||Lr(e,(function(){return Ga(e,i,0,null,"paste")})),!0}function Za(t,e){if(t.options.electricChars&&t.options.smartIndent)for(var i=t.doc.sel,n=i.ranges.length-1;n>=0;n--){var r=i.ranges[n];if(!(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)){var o=t.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(e.indexOf(o.electricChars.charAt(a))>-1){s=$a(t,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Jt(t.doc,r.head.line).text.slice(0,r.head.ch))&&(s=$a(t,r.head.line,"smart"));s&&Ai(t,"electricInput",t,r.head.line)}}}function Wa(t){for(var e=[],i=[],n=0;n<t.doc.sel.ranges.length;n++){var r=t.doc.sel.ranges[n].head.line,o={anchor:se(r,0),head:se(r+1,0)};i.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:i}}function Ha(t,e,i,n){t.setAttribute("autocorrect",i?"":"off"),t.setAttribute("autocapitalize",n?"":"off"),t.setAttribute("spellcheck",!!e)}function Xa(){var t=k("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),e=k("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?t.style.width="1000px":t.setAttribute("wrap","off"),g&&(t.style.border="1px solid black"),Ha(t),e}function Ya(t){var e=t.optionHandlers,i=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,i){var n=this.options,r=n[t];n[t]==i&&"mode"!=t||(n[t]=i,e.hasOwnProperty(t)&&zr(this,e[t])(this,i,r),_t(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](Zs(t))},removeKeyMap:function(t){for(var e=this.state.keyMaps,i=0;i<e.length;++i)if(e[i]==t||e[i].name==t)return e.splice(i,1),!0},addOverlay:Dr((function(e,i){var n=e.token?e:t.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");J(this.state.overlays,{mode:n,modeSpec:e,opaque:i&&i.opaque,priority:i&&i.priority||0},(function(t){return t.priority})),this.state.modeGen++,Nn(this)})),removeOverlay:Dr((function(t){for(var e=this.state.overlays,i=0;i<e.length;++i){var n=e[i].modeSpec;if(n==t||"string"==typeof t&&n.name==t)return e.splice(i,1),this.state.modeGen++,void Nn(this)}})),indentLine:Dr((function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),re(this.doc,t)&&$a(this,t,e,i)})),indentSelection:Dr((function(t){for(var e=this.doc.sel.ranges,i=-1,n=0;n<e.length;n++){var r=e[n];if(r.empty())r.head.line>i&&($a(this,r.head.line,t,!0),i=r.head.line,n==this.doc.sel.primIndex&&lr(this));else{var o=r.from(),s=r.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var l=a;l<i;++l)$a(this,l,t);var c=this.doc.sel.ranges;0==o.ch&&e.length==c.length&&c[n].from().ch>0&&Bo(this.doc,n,new so(o,c[n].to()),G)}}})),getTokenAt:function(t,e){return Ce(this,t,e)},getLineTokens:function(t,e){return Ce(this,se(t),e,!0)},getTokenTypeAt:function(t){t=de(this.doc,t);var e,i=ve(this,Jt(this.doc,t.line)),n=0,r=(i.length-1)/2,o=t.ch;if(0==o)e=i[2];else for(;;){var s=n+r>>1;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){e=i[2*s+2];break}n=s+1}}var a=e?e.indexOf("overlay "):-1;return a<0?e:0==a?null:e.slice(0,a-1)},getModeAt:function(e){var i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){var n=[];if(!i.hasOwnProperty(e))return n;var r=i[e],o=this.getModeAt(t);if("string"==typeof o[e])r[o[e]]&&n.push(r[o[e]]);else if(o[e])for(var s=0;s<o[e].length;s++){var a=r[o[e][s]];a&&n.push(a)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(var l=0;l<r._global.length;l++){var c=r._global[l];c.pred(o,this)&&-1==$(n,c.val)&&n.push(c.val)}return n},getStateAfter:function(t,e){var i=this.doc;return xe(this,(t=pe(i,null==t?i.first+i.size-1:t))+1,e).state},cursorCoords:function(t,e){var i=this.doc.sel.primary();return xn(this,null==t?i.head:"object"==typeof t?de(this.doc,t):t?i.from():i.to(),e||"page")},charCoords:function(t,e){return vn(this,de(this.doc,t),e||"page")},coordsChar:function(t,e){return Tn(this,(t=_n(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=_n(this,{top:t,left:0},e||"page").top,ne(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,i){var n,r=!1;if("number"==typeof t){var o=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>o&&(t=o,r=!0),n=Jt(this.doc,t)}else n=t;return yn(this,n,{top:0,left:0},e||"page",i||r).top+(r?this.doc.height-si(n):0)},defaultTextHeight:function(){return kn(this.display)},defaultCharWidth:function(){return Pn(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,i,n,r){var o=this.display,s=(t=xn(this,de(this.doc,t))).bottom,a=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==n)s=t.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||t.bottom+e.offsetHeight>l)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=l&&(s=t.bottom),a+e.offsetWidth>c&&(a=c-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&or(this,{left:a,top:s,right:a+e.offsetWidth,bottom:s+e.offsetHeight})},triggerOnKeyDown:Dr(ua),triggerOnKeyPress:Dr(da),triggerOnKeyUp:pa,triggerOnMouseDown:Dr(va),execCommand:function(t){if(Js.hasOwnProperty(t))return Js[t].call(null,this)},triggerElectric:Dr((function(t){Za(this,t)})),findPosH:function(t,e,i,n){var r=1;e<0&&(r=-1,e=-e);for(var o=de(this.doc,t),s=0;s<e&&!(o=Ka(this.doc,o,r,i,n)).hitSide;++s);return o},moveH:Dr((function(t,e){var i=this;this.extendSelectionsBy((function(n){return i.display.shift||i.doc.extend||n.empty()?Ka(i.doc,n.head,t,e,i.options.rtlMoveVisually):t<0?n.from():n.to()}),Z)})),deleteH:Dr((function(t,e){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):Ws(this,(function(i){var r=Ka(n,i.head,t,e,!1);return t<0?{from:r,to:i.head}:{from:i.head,to:r}}))})),findPosV:function(t,e,i,n){var r=1,o=n;e<0&&(r=-1,e=-e);for(var s=de(this.doc,t),a=0;a<e;++a){var l=xn(this,s,"div");if(null==o?o=l.left:l.left=o,(s=Ja(this,l,r,i)).hitSide)break}return s},moveV:Dr((function(t,e){var i=this,n=this.doc,r=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy((function(s){if(o)return t<0?s.from():s.to();var a=xn(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Ja(i,a,t,e);return"page"==e&&s==n.sel.primary()&&ar(i,vn(i,l,"div").top-a.top),l}),Z),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]})),findWordAt:function(t){var e=Jt(this.doc,t.line).text,i=t.ch,n=t.ch;if(e){var r=this.getHelper(t,"wordChars");"before"!=t.sticky&&n!=e.length||!i?++n:--i;for(var o=e.charAt(i),s=nt(o,r)?function(t){return nt(t,r)}:/\s/.test(o)?function(t){return/\s/.test(t)}:function(t){return!/\s/.test(t)&&!nt(t)};i>0&&s(e.charAt(i-1));)--i;for(;n<e.length&&s(e.charAt(n));)++n}return new so(se(t.line,i),se(t.line,n))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?D(this.display.cursorDiv,"CodeMirror-overwrite"):I(this.display.cursorDiv,"CodeMirror-overwrite"),_t(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==z()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Dr((function(t,e){cr(this,t,e)})),getScrollInfo:function(){var t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-Hi(this)-this.display.barHeight,width:t.scrollWidth-Hi(this)-this.display.barWidth,clientHeight:Yi(this),clientWidth:Xi(this)}},scrollIntoView:Dr((function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:se(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?ur(this,t):pr(this,t.from,t.to,t.margin)})),setSize:Dr((function(t,e){var i=this,n=function(t){return"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t};null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.options.lineWrapping&&pn(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,(function(t){if(t.widgets)for(var e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){Bn(i,r,"widget");break}++r})),this.curOp.forceUpdate=!0,_t(this,"refresh",this)})),operation:function(t){return Lr(this,t)},startOperation:function(){return Sr(this)},endOperation:function(){return Cr(this)},refresh:Dr((function(){var t=this.display.cachedTextHeight;Nn(this),this.curOp.forceUpdate=!0,dn(this),cr(this,this.doc.scrollLeft,this.doc.scrollTop),Zr(this.display),(null==t||Math.abs(t-kn(this.display))>.5||this.options.lineWrapping)&&Rn(this),_t(this,"refresh",this)})),swapDoc:Dr((function(t){var e=this.doc;return e.cm=null,this.state.selectingText&&this.state.selectingText(),xo(this,t),dn(this),this.display.input.reset(),cr(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Ai(this,"swapDoc",this,e),e})),phrase:function(t){var e=this.options.phrases;return e&&Object.prototype.hasOwnProperty.call(e,t)?e[t]:t},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},wt(t),t.registerHelper=function(e,n,r){i.hasOwnProperty(e)||(i[e]=t[e]={_global:[]}),i[e][n]=r},t.registerGlobalHelper=function(e,n,r,o){t.registerHelper(e,n,o),i[e]._global.push({pred:r,val:o})}}function Ka(t,e,i,n,r){var o=e,s=i,a=Jt(t,e.line),l=r&&"rtl"==t.direction?-i:i;function c(){var i=e.line+l;return!(i<t.first||i>=t.first+t.size)&&(e=new se(i,e.ch,e.sticky),a=Jt(t,i))}function u(o){var s;if("codepoint"==n){var u=a.text.charCodeAt(e.ch+(i>0?0:-1));if(isNaN(u))s=null;else{var h=i>0?u>=55296&&u<56320:u>=56320&&u<57343;s=new se(e.line,Math.max(0,Math.min(a.text.length,e.ch+i*(h?2:1))),-i)}}else s=r?Ks(t.cm,a,e,i):Xs(a,e,i);if(null==s){if(o||!c())return!1;e=Ys(r,t.cm,a,e.line,l)}else e=s;return!0}if("char"==n||"codepoint"==n)u();else if("column"==n)u(!0);else if("word"==n||"group"==n)for(var h=null,p="group"==n,d=t.cm&&t.cm.getHelper(e,"wordChars"),f=!0;!(i<0)||u(!f);f=!1){var m=a.text.charAt(e.ch)||"\n",g=nt(m,d)?"w":p&&"\n"==m?"n":!p||/\s/.test(m)?null:"p";if(!p||f||g||(g="s"),h&&h!=g){i<0&&(i=1,u(),e.sticky="after");break}if(g&&(h=g),i>0&&!u(!f))break}var y=Xo(t,e,o,s,!0);return le(o,y)&&(y.hitSide=!0),y}function Ja(t,e,i,n){var r,o,s=t.doc,a=e.left;if("page"==n){var l=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*kn(t.display),3);r=(i>0?e.bottom:e.top)+i*c}else"line"==n&&(r=i>0?e.bottom+3:e.top-3);for(;(o=Tn(t,a,r)).outside;){if(i<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*i}return o}var Qa=function(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new j,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function tl(t,e){var i=en(t,e.line);if(!i||i.hidden)return null;var n=Jt(t.doc,e.line),r=Ji(i,n,e.line),o=dt(n,t.doc.direction),s="left";o&&(s=ht(o,e.ch)%2?"right":"left");var a=an(r.map,e.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function el(t){for(var e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}function il(t,e){return e&&(t.bad=!0),t}function nl(t,e,i,n,r){var o="",s=!1,a=t.doc.lineSeparator(),l=!1;function c(t){return function(e){return e.id==t}}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(t){t&&(u(),o+=t)}function p(e){if(1==e.nodeType){var i=e.getAttribute("cm-text");if(i)return void h(i);var o,d=e.getAttribute("cm-marker");if(d){var f=t.findMarks(se(n,0),se(r+1,0),c(+d));return void(f.length&&(o=f[0].find(0))&&h(Qt(t.doc,o.from,o.to).join(a)))}if("false"==e.getAttribute("contenteditable"))return;var m=/^(pre|div|p|li|table|br)$/i.test(e.nodeName);if(!/^br$/i.test(e.nodeName)&&0==e.textContent.length)return;m&&u();for(var g=0;g<e.childNodes.length;g++)p(e.childNodes[g]);/^(pre|p)$/i.test(e.nodeName)&&(l=!0),m&&(s=!0)}else 3==e.nodeType&&h(e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;p(e),e!=i;)e=e.nextSibling,l=!1;return o}function rl(t,e,i){var n;if(e==t.display.lineDiv){if(!(n=t.display.lineDiv.childNodes[i]))return il(t.clipPos(se(t.display.viewTo-1)),!0);e=null,i=0}else for(n=e;;n=n.parentNode){if(!n||n==t.display.lineDiv)return null;if(n.parentNode&&n.parentNode==t.display.lineDiv)break}for(var r=0;r<t.display.view.length;r++){var o=t.display.view[r];if(o.node==n)return ol(o,e,i)}}function ol(t,e,i){var n=t.text.firstChild,r=!1;if(!e||!L(n,e))return il(se(ie(t.line),0),!0);if(e==n&&(r=!0,e=n.childNodes[i],i=0,!e)){var o=t.rest?Y(t.rest):t.line;return il(se(ie(o),o.text.length),r)}var s=3==e.nodeType?e:null,a=e;for(s||1!=e.childNodes.length||3!=e.firstChild.nodeType||(s=e.firstChild,i&&(i=s.nodeValue.length));a.parentNode!=n;)a=a.parentNode;var l=t.measure,c=l.maps;function u(e,i,n){for(var r=-1;r<(c?c.length:0);r++)for(var o=r<0?l.map:c[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==e||a==i){var u=ie(r<0?t.line:t.rest[r]),h=o[s]+n;return(n<0||a!=e)&&(h=o[s+(n?1:0)]),se(u,h)}}}var h=u(s,a,i);if(h)return il(h,r);for(var p=a.nextSibling,d=s?s.nodeValue.length-i:0;p;p=p.nextSibling){if(h=u(p,p.firstChild,0))return il(se(h.line,h.ch-d),r);d+=p.textContent.length}for(var f=a.previousSibling,m=i;f;f=f.previousSibling){if(h=u(f,f.firstChild,-1))return il(se(h.line,h.ch+m),r);m+=f.textContent.length}}Qa.prototype.init=function(t){var e=this,i=this,n=i.cm,r=i.div=t.lineDiv;function o(t){for(var e=t.target;e;e=e.parentNode){if(e==r)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(e.className))break}return!1}function s(t){if(o(t)&&!vt(n,t)){if(n.somethingSelected())Va({lineWise:!1,text:n.getSelections()}),"cut"==t.type&&n.replaceSelection("",null,"cut");else{if(!n.options.lineWiseCopyCut)return;var e=Wa(n);Va({lineWise:!0,text:e.text}),"cut"==t.type&&n.operation((function(){n.setSelections(e.ranges,0,G),n.replaceSelection("",null,"cut")}))}if(t.clipboardData){t.clipboardData.clearData();var s=Ua.text.join("\n");if(t.clipboardData.setData("Text",s),t.clipboardData.getData("Text")==s)return void t.preventDefault()}var a=Xa(),l=a.firstChild;n.display.lineSpace.insertBefore(a,n.display.lineSpace.firstChild),l.value=Ua.text.join("\n");var c=z();O(l),setTimeout((function(){n.display.lineSpace.removeChild(a),c.focus(),c==r&&i.showPrimarySelection()}),50)}}r.contentEditable=!0,Ha(r,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize),mt(r,"paste",(function(t){!o(t)||vt(n,t)||qa(t,n)||a<=11&&setTimeout(zr(n,(function(){return e.updateFromDOM()})),20)})),mt(r,"compositionstart",(function(t){e.composing={data:t.data,done:!1}})),mt(r,"compositionupdate",(function(t){e.composing||(e.composing={data:t.data,done:!1})})),mt(r,"compositionend",(function(t){e.composing&&(t.data!=e.composing.data&&e.readFromDOMSoon(),e.composing.done=!0)})),mt(r,"touchstart",(function(){return i.forceCompositionEnd()})),mt(r,"input",(function(){e.composing||e.readFromDOMSoon()})),mt(r,"copy",s),mt(r,"cut",s)},Qa.prototype.screenReaderLabelChanged=function(t){t?this.div.setAttribute("aria-label",t):this.div.removeAttribute("aria-label")},Qa.prototype.prepareSelection=function(){var t=qn(this.cm,!1);return t.focus=z()==this.div,t},Qa.prototype.showSelection=function(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))},Qa.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Qa.prototype.showPrimarySelection=function(){var t=this.getSelection(),e=this.cm,n=e.doc.sel.primary(),r=n.from(),o=n.to();if(e.display.viewTo==e.display.viewFrom||r.line>=e.display.viewTo||o.line<e.display.viewFrom)t.removeAllRanges();else{var s=rl(e,t.anchorNode,t.anchorOffset),a=rl(e,t.focusNode,t.focusOffset);if(!s||s.bad||!a||a.bad||0!=ae(he(s,a),r)||0!=ae(ue(s,a),o)){var l=e.display.view,c=r.line>=e.display.viewFrom&&tl(e,r)||{node:l[0].measure.map[2],offset:0},u=o.line<e.display.viewTo&&tl(e,o);if(!u){var h=l[l.length-1].measure,p=h.maps?h.maps[h.maps.length-1]:h.map;u={node:p[p.length-1],offset:p[p.length-2]-p[p.length-3]}}if(c&&u){var d,f=t.rangeCount&&t.getRangeAt(0);try{d=E(c.node,c.offset,u.offset,u.node)}catch(t){}d&&(!i&&e.state.focused?(t.collapse(c.node,c.offset),d.collapsed||(t.removeAllRanges(),t.addRange(d))):(t.removeAllRanges(),t.addRange(d)),f&&null==t.anchorNode?t.addRange(f):i&&this.startGracePeriod()),this.rememberSelection()}else t.removeAllRanges()}}},Qa.prototype.startGracePeriod=function(){var t=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){t.gracePeriod=!1,t.selectionChanged()&&t.cm.operation((function(){return t.cm.curOp.selectionChanged=!0}))}),20)},Qa.prototype.showMultipleSelections=function(t){A(this.cm.display.cursorDiv,t.cursors),A(this.cm.display.selectionDiv,t.selection)},Qa.prototype.rememberSelection=function(){var t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset},Qa.prototype.selectionInEditor=function(){var t=this.getSelection();if(!t.rangeCount)return!1;var e=t.getRangeAt(0).commonAncestorContainer;return L(this.div,e)},Qa.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&z()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Qa.prototype.blur=function(){this.div.blur()},Qa.prototype.getField=function(){return this.div},Qa.prototype.supportsTouch=function(){return!0},Qa.prototype.receivedFocus=function(){var t=this,e=this;function i(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,i))}this.selectionInEditor()?setTimeout((function(){return t.pollSelection()}),20):Lr(this.cm,(function(){return e.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,i)},Qa.prototype.selectionChanged=function(){var t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset},Qa.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var t=this.getSelection(),e=this.cm;if(y&&u&&this.cm.display.gutterSpecs.length&&el(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=rl(e,t.anchorNode,t.anchorOffset),n=rl(e,t.focusNode,t.focusOffset);i&&n&&Lr(e,(function(){Vo(e.doc,lo(i,n),G),(i.bad||n.bad)&&(e.curOp.selectionChanged=!0)}))}}},Qa.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var t,e,i,n=this.cm,r=n.display,o=n.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>n.firstLine()&&(s=se(s.line-1,Jt(n.doc,s.line-1).length)),a.ch==Jt(n.doc,a.line).text.length&&a.line<n.lastLine()&&(a=se(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(t=Fn(n,s.line))?(e=ie(r.view[0].line),i=r.view[0].node):(e=ie(r.view[t].line),i=r.view[t-1].node.nextSibling);var l,c,u=Fn(n,a.line);if(u==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=ie(r.view[u+1].line)-1,c=r.view[u+1].node.previousSibling),!i)return!1;for(var h=n.doc.splitLines(nl(n,i,c,e,l)),p=Qt(n.doc,se(e,0),se(l,Jt(n.doc,l).text.length));h.length>1&&p.length>1;)if(Y(h)==Y(p))h.pop(),p.pop(),l--;else{if(h[0]!=p[0])break;h.shift(),p.shift(),e++}for(var d=0,f=0,m=h[0],g=p[0],y=Math.min(m.length,g.length);d<y&&m.charCodeAt(d)==g.charCodeAt(d);)++d;for(var _=Y(h),v=Y(p),x=Math.min(_.length-(1==h.length?d:0),v.length-(1==p.length?d:0));f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==p.length&&e==s.line)for(;d&&d>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)d--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(d).replace(/\u200b+$/,"");var b=se(e,d),w=se(l,p.length?Y(p).length-f:0);return h.length>1||h[0]||ae(b,w)?(os(n.doc,h,b,w,"+input"),!0):void 0},Qa.prototype.ensurePolled=function(){this.forceCompositionEnd()},Qa.prototype.reset=function(){this.forceCompositionEnd()},Qa.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Qa.prototype.readFromDOMSoon=function(){var t=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(t.readDOMTimeout=null,t.composing){if(!t.composing.done)return;t.composing=null}t.updateFromDOM()}),80))},Qa.prototype.updateFromDOM=function(){var t=this;!this.cm.isReadOnly()&&this.pollContent()||Lr(this.cm,(function(){return Nn(t.cm)}))},Qa.prototype.setUneditable=function(t){t.contentEditable="false"},Qa.prototype.onKeyPress=function(t){0==t.charCode||this.composing||(t.preventDefault(),this.cm.isReadOnly()||zr(this.cm,Ga)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))},Qa.prototype.readOnlyChanged=function(t){this.div.contentEditable=String("nocursor"!=t)},Qa.prototype.onContextMenu=function(){},Qa.prototype.resetPosition=function(){},Qa.prototype.needsContentAttribute=!0;var sl=function(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new j,this.hasSelection=!1,this.composing=null};function al(t,e){if((e=e?N(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){var i=z();e.autofocus=i==t||null!=t.getAttribute("autofocus")&&i==document.body}function n(){t.value=a.getValue()}var r;if(t.form&&(mt(t.form,"submit",n),!e.leaveSubmitMethodAlone)){var o=t.form;r=o.submit;try{var s=o.submit=function(){n(),o.submit=r,o.submit(),o.submit=s}}catch(t){}}e.finishInit=function(i){i.save=n,i.getTextArea=function(){return t},i.toTextArea=function(){i.toTextArea=isNaN,n(),t.parentNode.removeChild(i.getWrapperElement()),t.style.display="",t.form&&(yt(t.form,"submit",n),e.leaveSubmitMethodAlone||"function"!=typeof t.form.submit||(t.form.submit=r))}},t.style.display="none";var a=Na((function(e){return t.parentNode.insertBefore(e,t.nextSibling)}),e);return a}function ll(t){t.off=yt,t.on=mt,t.wheelEventPixels=no,t.Doc=Ss,t.splitLines=Rt,t.countColumn=B,t.findColumn=W,t.isWordChar=it,t.Pass=V,t.signal=_t,t.Line=ci,t.changeEnd=co,t.scrollbarModel=br,t.Pos=se,t.cmpPos=ae,t.modes=jt,t.mimeModes=$t,t.resolveMode=Gt,t.getMode=qt,t.modeExtensions=Zt,t.extendMode=Wt,t.copyState=Ht,t.startState=Yt,t.innerMode=Xt,t.commands=Js,t.keyMap=Bs,t.keyName=qs,t.isModifierKey=Vs,t.lookupKey=Us,t.normalizeKeyMap=$s,t.StringStream=Kt,t.SharedTextMarker=_s,t.TextMarker=gs,t.LineWidget=ps,t.e_preventDefault=Tt,t.e_stopPropagation=St,t.e_stop=Et,t.addClass=D,t.contains=L,t.rmClass=I,t.keyNames=Rs}sl.prototype.init=function(t){var e=this,i=this,n=this.cm;this.createField(t);var r=this.textarea;function o(t){if(!vt(n,t)){if(n.somethingSelected())Va({lineWise:!1,text:n.getSelections()});else{if(!n.options.lineWiseCopyCut)return;var e=Wa(n);Va({lineWise:!0,text:e.text}),"cut"==t.type?n.setSelections(e.ranges,null,G):(i.prevInput="",r.value=e.text.join("\n"),O(r))}"cut"==t.type&&(n.state.cutIncoming=+new Date)}}t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),g&&(r.style.width="0px"),mt(r,"input",(function(){s&&a>=9&&e.hasSelection&&(e.hasSelection=null),i.poll()})),mt(r,"paste",(function(t){vt(n,t)||qa(t,n)||(n.state.pasteIncoming=+new Date,i.fastPoll())})),mt(r,"cut",o),mt(r,"copy",o),mt(t.scroller,"paste",(function(e){if(!Gi(t,e)&&!vt(n,e)){if(!r.dispatchEvent)return n.state.pasteIncoming=+new Date,void i.focus();var o=new Event("paste");o.clipboardData=e.clipboardData,r.dispatchEvent(o)}})),mt(t.lineSpace,"selectstart",(function(e){Gi(t,e)||Tt(e)})),mt(r,"compositionstart",(function(){var t=n.getCursor("from");i.composing&&i.composing.range.clear(),i.composing={start:t,range:n.markText(t,n.getCursor("to"),{className:"CodeMirror-composing"})}})),mt(r,"compositionend",(function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)}))},sl.prototype.createField=function(t){this.wrapper=Xa(),this.textarea=this.wrapper.firstChild},sl.prototype.screenReaderLabelChanged=function(t){t?this.textarea.setAttribute("aria-label",t):this.textarea.removeAttribute("aria-label")},sl.prototype.prepareSelection=function(){var t=this.cm,e=t.display,i=t.doc,n=qn(t);if(t.options.moveInputWithCursor){var r=xn(t,i.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),s=e.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,r.left+s.left-o.left))}return n},sl.prototype.showSelection=function(t){var e=this.cm.display;A(e.cursorDiv,t.cursors),A(e.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")},sl.prototype.reset=function(t){if(!this.contextMenuPending&&!this.composing){var e=this.cm;if(e.somethingSelected()){this.prevInput="";var i=e.getSelection();this.textarea.value=i,e.state.focused&&O(this.textarea),s&&a>=9&&(this.hasSelection=i)}else t||(this.prevInput=this.textarea.value="",s&&a>=9&&(this.hasSelection=null))}},sl.prototype.getField=function(){return this.textarea},sl.prototype.supportsTouch=function(){return!1},sl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!_||z()!=this.textarea))try{this.textarea.focus()}catch(t){}},sl.prototype.blur=function(){this.textarea.blur()},sl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},sl.prototype.receivedFocus=function(){this.slowPoll()},sl.prototype.slowPoll=function(){var t=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){t.poll(),t.cm.state.focused&&t.slowPoll()}))},sl.prototype.fastPoll=function(){var t=!1,e=this;function i(){e.poll()||t?(e.pollingFast=!1,e.slowPoll()):(t=!0,e.polling.set(60,i))}e.pollingFast=!0,e.polling.set(20,i)},sl.prototype.poll=function(){var t=this,e=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!e.state.focused||Ot(i)&&!n&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;var r=i.value;if(r==n&&!e.somethingSelected())return!1;if(s&&a>=9&&this.hasSelection===r||v&&/[\uf700-\uf7ff]/.test(r))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,c=Math.min(n.length,r.length);l<c&&n.charCodeAt(l)==r.charCodeAt(l);)++l;return Lr(e,(function(){Ga(e,r.slice(l),n.length-l,null,t.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?i.value=t.prevInput="":t.prevInput=r,t.composing&&(t.composing.range.clear(),t.composing.range=e.markText(t.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},sl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},sl.prototype.onKeyPress=function(){s&&a>=9&&(this.hasSelection=null),this.fastPoll()},sl.prototype.onContextMenu=function(t){var e=this,i=e.cm,n=i.display,r=e.textarea;e.contextMenuPending&&e.contextMenuPending();var o=On(i,t),c=n.scroller.scrollTop;if(o&&!p){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&zr(i,Vo)(i.doc,lo(o),G);var u,h=r.style.cssText,d=e.wrapper.style.cssText,f=e.wrapper.offsetParent.getBoundingClientRect();if(e.wrapper.style.cssText="position: static",r.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(t.clientY-f.top-5)+"px; left: "+(t.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(s?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(u=window.scrollY),n.input.focus(),l&&window.scrollTo(null,u),n.input.reset(),i.somethingSelected()||(r.value=e.prevInput=" "),e.contextMenuPending=y,n.selForContextMenu=i.doc.sel,clearTimeout(n.detectingSelectAll),s&&a>=9&&g(),S){Et(t);var m=function(){yt(window,"mouseup",m),setTimeout(y,20)};mt(window,"mouseup",m)}else setTimeout(y,50)}function g(){if(null!=r.selectionStart){var t=i.somethingSelected(),o="​"+(t?r.value:"");r.value="⇚",r.value=o,e.prevInput=t?"":"​",r.selectionStart=1,r.selectionEnd=o.length,n.selForContextMenu=i.doc.sel}}function y(){if(e.contextMenuPending==y&&(e.contextMenuPending=!1,e.wrapper.style.cssText=d,r.style.cssText=h,s&&a<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=c),null!=r.selectionStart)){(!s||s&&a<9)&&g();var t=0,o=function(){n.selForContextMenu==i.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&"​"==e.prevInput?zr(i,Ko)(i):t++<10?n.detectingSelectAll=setTimeout(o,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(o,200)}}},sl.prototype.readOnlyChanged=function(t){t||this.reset(),this.textarea.disabled="nocursor"==t,this.textarea.readOnly=!!t},sl.prototype.setUneditable=function(){},sl.prototype.needsContentAttribute=!1,Ra(Na),Ya(Na);var cl="iter insert remove copy getEditor constructor".split(" ");for(var ul in Ss.prototype)Ss.prototype.hasOwnProperty(ul)&&$(cl,ul)<0&&(Na.prototype[ul]=function(t){return function(){return t.apply(this.doc,arguments)}}(Ss.prototype[ul]));return wt(Ss),Na.inputStyles={textarea:sl,contenteditable:Qa},Na.defineMode=function(t){Na.defaults.mode||"null"==t||(Na.defaults.mode=t),Ut.apply(this,arguments)},Na.defineMIME=Vt,Na.defineMode("null",(function(){return{token:function(t){return t.skipToEnd()}}})),Na.defineMIME("text/plain","null"),Na.defineExtension=function(t,e){Na.prototype[t]=e},Na.defineDocExtension=function(t,e){Ss.prototype[t]=e},Na.fromTextArea=al,ll(Na),Na.version="5.65.5",Na}());let Ou=navigator.userAgent,Fu=navigator.platform,Nu=/gecko\/\d/i.test(Ou),Bu=/MSIE \d/.test(Ou),ju=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ou),$u=/Edge\/(\d+)/.exec(Ou),Uu=Bu||ju||$u,Vu=Uu&&(Bu?document.documentMode||6:+($u||ju)[1]),Gu=!$u&&/WebKit\//.test(Ou),qu=Gu&&/Qt\/\d+\.\d+/.test(Ou),Zu=!$u&&/Chrome\/(\d+)/.exec(Ou),Wu=Zu&&+Zu[1],Hu=/Opera\//.test(Ou),Xu=/Apple Computer/.test(navigator.vendor),Yu=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(Ou),Ku=/PhantomJS/.test(Ou),Ju=Xu&&(/Mobile\/\w+/.test(Ou)||navigator.maxTouchPoints>2),Qu=/Android/.test(Ou),th=Ju||Qu||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(Ou),eh=Ju||/Mac/.test(Fu),ih=/\bCrOS\b/.test(Ou),nh=/win/i.test(Fu),rh=Hu&&Ou.match(/Version\/(\d*\.\d*)/);rh&&(rh=Number(rh[1])),rh&&rh>=15&&(Hu=!1,Gu=!0);let oh=eh&&(qu||Hu&&(null==rh||rh<12.11)),sh=Nu||Uu&&Vu>=9;function ah(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}let lh,ch=function(t,e){let i=t.className,n=ah(e).exec(i);if(n){let e=i.slice(n.index+n[0].length);t.className=i.slice(0,n.index)+(e?n[1]+e:"")}};function uh(t){for(let e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function hh(t,e){return uh(t).appendChild(e)}function ph(t,e,i,n){let r=document.createElement(t);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof e)r.appendChild(document.createTextNode(e));else if(e)for(let t=0;t<e.length;++t)r.appendChild(e[t]);return r}function dh(t,e,i,n){let r=ph(t,e,i,n);return r.setAttribute("role","presentation"),r}function fh(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function mh(){let t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function gh(t,e){let i=t.className;ah(e).test(i)||(t.className+=(i?" ":"")+e)}function yh(t,e){let i=t.split(" ");for(let t=0;t<i.length;t++)i[t]&&!ah(i[t]).test(e)&&(e+=" "+i[t]);return e}lh=document.createRange?function(t,e,i,n){let r=document.createRange();return r.setEnd(n||t,i),r.setStart(t,e),r}:function(t,e,i){let n=document.body.createTextRange();try{n.moveToElementText(t.parentNode)}catch(t){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",e),n};let _h=function(t){t.select()};function vh(t){let e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function xh(t,e,i){e||(e={});for(let n in t)!t.hasOwnProperty(n)||!1===i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e}function bh(t,e,i,n,r){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(let o=n||0,s=r||0;;){let n=t.indexOf("\t",o);if(n<0||n>=e)return s+(e-o);s+=n-o,s+=i-s%i,o=n+1}}Ju?_h=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:Uu&&(_h=function(t){try{t.select()}catch(t){}});class wh{constructor(){this.id=null,this.f=null,this.time=0,this.handler=vh(this.onTimeout,this)}onTimeout(t){t.id=0,t.time<=+new Date?t.f():setTimeout(t.handler,t.time-+new Date)}set(t,e){this.f=e;const i=+new Date+t;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,t),this.time=i)}}function Th(t,e){for(let i=0;i<t.length;++i)if(t[i]==e)return i;return-1}let Sh={toString:function(){return"CodeMirror.Pass"}},Ch={scroll:!1},Eh={origin:"*mouse"},Ih={origin:"+move"};function Mh(t,e,i){for(let n=0,r=0;;){let o=t.indexOf("\t",n);-1==o&&(o=t.length);let s=o-n;if(o==t.length||r+s>=e)return n+Math.min(s,e-r);if(r+=o-n,r+=i-r%i,n=o+1,r>=e)return n}}let Ah=[""];function kh(t){for(;Ah.length<=t;)Ah.push(Ph(Ah)+" ");return Ah[t]}function Ph(t){return t[t.length-1]}function Lh(t,e){let i=[];for(let n=0;n<t.length;n++)i[n]=e(t[n],n);return i}function zh(){}function Dh(t,e){let i;return Object.create?i=Object.create(t):(zh.prototype=t,i=new zh),e&&xh(e,i),i}let Rh=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Oh(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||Rh.test(t))}function Fh(t,e){return e?!!(e.source.indexOf("\\w")>-1&&Oh(t))||e.test(t):Oh(t)}function Nh(t){for(let e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}let Bh=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function jh(t){return t.charCodeAt(0)>=768&&Bh.test(t)}function $h(t,e,i){for(;(i<0?e>0:e<t.length)&&jh(t.charAt(e));)e+=i;return e}function Uh(t,e,i){let n=e>i?-1:1;for(;;){if(e==i)return e;let r=(e+i)/2,o=n<0?Math.ceil(r):Math.floor(r);if(o==e)return t(o)?e:i;t(o)?i=o:e=o+n}}let Vh=null;function Gh(t,e,i){let n;Vh=null;for(let r=0;r<t.length;++r){let o=t[r];if(o.from<e&&o.to>e)return r;o.to==e&&(o.from!=o.to&&"before"==i?n=r:Vh=r),o.from==e&&(o.from!=o.to&&"before"!=i?n=r:Vh=r)}return null!=n?n:Vh}let qh=function(){let t=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,e=/[stwN]/,i=/[LRr]/,n=/[Lb1n]/,r=/[1n]/;function o(t,e,i){this.level=t,this.from=e,this.to=i}return function(s,a){let l="ltr"==a?"L":"R";if(0==s.length||"ltr"==a&&!t.test(s))return!1;let c=s.length,u=[];for(let t=0;t<c;++t)u.push((h=s.charCodeAt(t))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(h):1424<=h&&h<=1524?"R":1536<=h&&h<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(h-1536):1774<=h&&h<=2220?"r":8192<=h&&h<=8203?"w":8204==h?"b":"L");var h;for(let t=0,e=l;t<c;++t){let i=u[t];"m"==i?u[t]=e:e=i}for(let t=0,e=l;t<c;++t){let n=u[t];"1"==n&&"r"==e?u[t]="n":i.test(n)&&(e=n,"r"==n&&(u[t]="R"))}for(let t=1,e=u[0];t<c-1;++t){let i=u[t];"+"==i&&"1"==e&&"1"==u[t+1]?u[t]="1":","!=i||e!=u[t+1]||"1"!=e&&"n"!=e||(u[t]=e),e=i}for(let t=0;t<c;++t){let e=u[t];if(","==e)u[t]="N";else if("%"==e){let e;for(e=t+1;e<c&&"%"==u[e];++e);let i=t&&"!"==u[t-1]||e<c&&"1"==u[e]?"1":"N";for(let n=t;n<e;++n)u[n]=i;t=e-1}}for(let t=0,e=l;t<c;++t){let n=u[t];"L"==e&&"1"==n?u[t]="L":i.test(n)&&(e=n)}for(let t=0;t<c;++t)if(e.test(u[t])){let i;for(i=t+1;i<c&&e.test(u[i]);++i);let n="L"==(t?u[t-1]:l),r=n==("L"==(i<c?u[i]:l))?n?"L":"R":l;for(let e=t;e<i;++e)u[e]=r;t=i-1}let p,d=[];for(let t=0;t<c;)if(n.test(u[t])){let e=t;for(++t;t<c&&n.test(u[t]);++t);d.push(new o(0,e,t))}else{let e=t,i=d.length,n="rtl"==a?1:0;for(++t;t<c&&"L"!=u[t];++t);for(let s=e;s<t;)if(r.test(u[s])){e<s&&(d.splice(i,0,new o(1,e,s)),i+=n);let a=s;for(++s;s<t&&r.test(u[s]);++s);d.splice(i,0,new o(2,a,s)),i+=n,e=s}else++s;e<t&&d.splice(i,0,new o(1,e,t))}return"ltr"==a&&(1==d[0].level&&(p=s.match(/^\s+/))&&(d[0].from=p[0].length,d.unshift(new o(0,0,p[0].length))),1==Ph(d).level&&(p=s.match(/\s+$/))&&(Ph(d).to-=p[0].length,d.push(new o(0,c-p[0].length,c)))),"rtl"==a?d.reverse():d}}();function Zh(t,e){let i=t.order;return null==i&&(i=t.order=qh(t.text,e)),i}const Wh=[];let Hh=function(t,e,i){if(t.addEventListener)t.addEventListener(e,i,!1);else if(t.attachEvent)t.attachEvent("on"+e,i);else{let n=t._handlers||(t._handlers={});n[e]=(n[e]||Wh).concat(i)}};function Xh(t,e){return t._handlers&&t._handlers[e]||Wh}function Yh(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i,!1);else if(t.detachEvent)t.detachEvent("on"+e,i);else{let n=t._handlers,r=n&&n[e];if(r){let t=Th(r,i);t>-1&&(n[e]=r.slice(0,t).concat(r.slice(t+1)))}}}function Kh(t,e){let i=Xh(t,e);if(!i.length)return;let n=Array.prototype.slice.call(arguments,2);for(let t=0;t<i.length;++t)i[t].apply(null,n)}function Jh(t,e,i){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),Kh(t,i||e.type,t,e),rp(e)||e.codemirrorIgnore}function Qh(t){let e=t._handlers&&t._handlers.cursorActivity;if(!e)return;let i=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]);for(let t=0;t<e.length;++t)-1==Th(i,e[t])&&i.push(e[t])}function tp(t,e){return Xh(t,e).length>0}function ep(t){t.prototype.on=function(t,e){Hh(this,t,e)},t.prototype.off=function(t,e){Yh(this,t,e)}}function ip(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function np(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function rp(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function op(t){ip(t),np(t)}function sp(t){return t.target||t.srcElement}function ap(t){let e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),eh&&t.ctrlKey&&1==e&&(e=3),e}let lp,cp,up=function(){if(Uu&&Vu<9)return!1;let t=ph("div");return"draggable"in t||"dragDrop"in t}();function hp(t){if(null==lp){let e=ph("span","​");hh(t,ph("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(lp=e.offsetWidth<=1&&e.offsetHeight>2&&!(Uu&&Vu<8))}let e=lp?ph("span","​"):ph("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return e.setAttribute("cm-text",""),e}function pp(t){if(null!=cp)return cp;let e=hh(t,document.createTextNode("AخA")),i=lh(e,0,1).getBoundingClientRect(),n=lh(e,1,2).getBoundingClientRect();return uh(t),!(!i||i.left==i.right)&&(cp=n.right-i.right<3)}let dp=3!="\n\nb".split(/\n/).length?t=>{let e=0,i=[],n=t.length;for(;e<=n;){let n=t.indexOf("\n",e);-1==n&&(n=t.length);let r=t.slice(e,"\r"==t.charAt(n-1)?n-1:n),o=r.indexOf("\r");-1!=o?(i.push(r.slice(0,o)),e+=o+1):(i.push(r),e=n+1)}return i}:t=>t.split(/\r\n?|\n/),fp=window.getSelection?t=>{try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:t=>{let e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},mp=(()=>{let t=ph("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)})(),gp=null;let yp={},_p={};function vp(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),yp[t]=e}function xp(t){if("string"==typeof t&&_p.hasOwnProperty(t))t=_p[t];else if(t&&"string"==typeof t.name&&_p.hasOwnProperty(t.name)){let e=_p[t.name];"string"==typeof e&&(e={name:e}),(t=Dh(e,t)).name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return xp("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return xp("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function bp(t,e){e=xp(e);let i=yp[e.name];if(!i)return bp(t,"text/plain");let n=i(t,e);if(wp.hasOwnProperty(e.name)){let t=wp[e.name];for(let e in t)t.hasOwnProperty(e)&&(n.hasOwnProperty(e)&&(n["_"+e]=n[e]),n[e]=t[e])}if(n.name=e.name,e.helperType&&(n.helperType=e.helperType),e.modeProps)for(let t in e.modeProps)n[t]=e.modeProps[t];return n}let wp={};function Tp(t,e){xh(e,wp.hasOwnProperty(t)?wp[t]:wp[t]={})}function Sp(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);let i={};for(let t in e){let n=e[t];n instanceof Array&&(n=n.concat([])),i[t]=n}return i}function Cp(t,e){let i;for(;t.innerMode&&(i=t.innerMode(e),i&&i.mode!=t);)e=i.state,t=i.mode;return i||{mode:t,state:e}}function Ep(t,e,i){return!t.startState||t.startState(e,i)}class Ip{constructor(t,e,i){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i}eol(){return this.pos>=this.string.length}sol(){return this.pos==this.lineStart}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,i=this.string.charAt(this.pos);if(e="string"==typeof t?i==t:i&&(t.test?t.test(i):t(i)),e)return++this.pos,i}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=bh(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?bh(this.string,this.lineStart,this.tabSize):0)}indentation(){return bh(this.string,null,this.tabSize)-(this.lineStart?bh(this.string,this.lineStart,this.tabSize):0)}match(t,e,i){if("string"!=typeof t){let i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&!1!==e&&(this.pos+=i[0].length),i)}{let n=t=>i?t.toLowerCase():t;if(n(this.string.substr(this.pos,t.length))==n(t))return!1!==e&&(this.pos+=t.length),!0}}current(){return this.string.slice(this.start,this.pos)}hideFirstChars(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}}lookAhead(t){let e=this.lineOracle;return e&&e.lookAhead(t)}baseToken(){let t=this.lineOracle;return t&&t.baseToken(this.pos)}}function Mp(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");let i=t;for(;!i.lines;)for(let t=0;;++t){let n=i.children[t],r=n.chunkSize();if(e<r){i=n;break}e-=r}return i.lines[e]}function Ap(t,e,i){let n=[],r=e.line;return t.iter(e.line,i.line+1,(t=>{let o=t.text;r==i.line&&(o=o.slice(0,i.ch)),r==e.line&&(o=o.slice(e.ch)),n.push(o),++r})),n}function kp(t,e,i){let n=[];return t.iter(e,i,(t=>{n.push(t.text)})),n}function Pp(t,e){let i=e-t.height;if(i)for(let e=t;e;e=e.parent)e.height+=i}function Lp(t){if(null==t.parent)return null;let e=t.parent,i=Th(e.lines,t);for(let t=e.parent;t;e=t,t=t.parent)for(let n=0;t.children[n]!=e;++n)i+=t.children[n].chunkSize();return i+e.first}function zp(t,e){let i=t.first;t:do{for(let n=0;n<t.children.length;++n){let r=t.children[n],o=r.height;if(e<o){t=r;continue t}e-=o,i+=r.chunkSize()}return i}while(!t.lines);let n=0;for(;n<t.lines.length;++n){let i=t.lines[n].height;if(e<i)break;e-=i}return i+n}function Dp(t,e){return e>=t.first&&e<t.first+t.size}function Rp(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function Op(t,e,i=null){if(!(this instanceof Op))return new Op(t,e,i);this.line=t,this.ch=e,this.sticky=i}function Fp(t,e){return t.line-e.line||t.ch-e.ch}function Np(t,e){return t.sticky==e.sticky&&0==Fp(t,e)}function Bp(t){return Op(t.line,t.ch)}function jp(t,e){return Fp(t,e)<0?e:t}function $p(t,e){return Fp(t,e)<0?t:e}function Up(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function Vp(t,e){if(e.line<t.first)return Op(t.first,0);let i=t.first+t.size-1;return e.line>i?Op(i,Mp(t,i).text.length):function(t,e){let i=t.ch;return null==i||i>e?Op(t.line,e):i<0?Op(t.line,0):t}(e,Mp(t,e.line).text.length)}function Gp(t,e){let i=[];for(let n=0;n<e.length;n++)i[n]=Vp(t,e[n]);return i}class qp{constructor(t,e){this.state=t,this.lookAhead=e}}class Zp{constructor(t,e,i,n){this.state=e,this.doc=t,this.line=i,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1}lookAhead(t){let e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e}baseToken(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;let e=this.baseTokens[this.baseTokenPos+1];return{type:e&&e.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}}nextLine(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--}static fromSaved(t,e,i){return e instanceof qp?new Zp(t,Sp(t.mode,e.state),i,e.lookAhead):new Zp(t,Sp(t.mode,e),i)}save(t){let e=!1!==t?Sp(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new qp(e,this.maxLookAhead):e}}function Wp(t,e,i,n){let r=[t.state.modeGen],o={};id(t,e.text,t.doc.mode,i,((t,e)=>r.push(t,e)),o,n);let s=i.state;for(let n=0;n<t.state.overlays.length;++n){i.baseTokens=r;let a=t.state.overlays[n],l=1,c=0;i.state=!0,id(t,e.text,a.mode,i,((t,e)=>{let i=l;for(;c<t;){let e=r[l];e>t&&r.splice(l,1,t,r[l+1],e),l+=2,c=Math.min(t,e)}if(e)if(a.opaque)r.splice(i,l-i,t,"overlay "+e),l=i+2;else for(;i<l;i+=2){let t=r[i+1];r[i+1]=(t?t+" ":"")+"overlay "+e}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1}return{styles:r,classes:o.bgClass||o.textClass?o:null}}function Hp(t,e,i){if(!e.styles||e.styles[0]!=t.state.modeGen){let n=Xp(t,Lp(e)),r=e.text.length>t.options.maxHighlightLength&&Sp(t.doc.mode,n.state),o=Wp(t,e,n);r&&(n.state=r),e.stateAfter=n.save(!r),e.styles=o.styles,o.classes?e.styleClasses=o.classes:e.styleClasses&&(e.styleClasses=null),i===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function Xp(t,e,i){let n=t.doc,r=t.display;if(!n.mode.startState)return new Zp(n,!0,e);let o=function(t,e,i){let n,r,o=t.doc,s=i?-1:e-(t.doc.mode.innerMode?1e3:100);for(let a=e;a>s;--a){if(a<=o.first)return o.first;let e=Mp(o,a-1),s=e.stateAfter;if(s&&(!i||a+(s instanceof qp?s.lookAhead:0)<=o.modeFrontier))return a;let l=bh(e.text,null,t.options.tabSize);(null==r||n>l)&&(r=a-1,n=l)}return r}(t,e,i),s=o>n.first&&Mp(n,o-1).stateAfter,a=s?Zp.fromSaved(n,s,o):new Zp(n,Ep(n.mode),o);return n.iter(o,e,(i=>{Yp(t,i.text,a);let n=a.line;i.stateAfter=n==e-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()})),i&&(n.modeFrontier=a.line),a}function Yp(t,e,i,n){let r=t.doc.mode,o=new Ip(e,t.options.tabSize,i);for(o.start=o.pos=n||0,""==e&&Kp(r,i.state);!o.eol();)Jp(r,o,i.state),o.start=o.pos}function Kp(t,e){if(t.blankLine)return t.blankLine(e);if(!t.innerMode)return;let i=Cp(t,e);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}function Jp(t,e,i,n){for(let r=0;r<10;r++){n&&(n[0]=Cp(t,i).mode);let r=t.token(e,i);if(e.pos>e.start)return r}throw new Error("Mode "+t.name+" failed to advance stream.")}class Qp{constructor(t,e,i){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=i}}function td(t,e,i,n){let r,o,s=t.doc,a=s.mode,l=Mp(s,(e=Vp(s,e)).line),c=Xp(t,e.line,i),u=new Ip(l.text,t.options.tabSize,c);for(n&&(o=[]);(n||u.pos<e.ch)&&!u.eol();)u.start=u.pos,r=Jp(a,u,c.state),n&&o.push(new Qp(u,r,Sp(s.mode,c.state)));return n?o:new Qp(u,r,c.state)}function ed(t,e){if(t)for(;;){let i=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;t=t.slice(0,i.index)+t.slice(i.index+i[0].length);let n=i[1]?"bgClass":"textClass";null==e[n]?e[n]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(e[n])||(e[n]+=" "+i[2])}return t}function id(t,e,i,n,r,o,s){let a=i.flattenSpans;null==a&&(a=t.options.flattenSpans);let l,c=0,u=null,h=new Ip(e,t.options.tabSize,n),p=t.options.addModeClass&&[null];for(""==e&&ed(Kp(i,n.state),o);!h.eol();){if(h.pos>t.options.maxHighlightLength?(a=!1,s&&Yp(t,e,n,h.pos),h.pos=e.length,l=null):l=ed(Jp(i,h,n.state,p),o),p){let t=p[0].name;t&&(l="m-"+(l?t+" "+l:t))}if(!a||u!=l){for(;c<h.start;)c=Math.min(h.start,c+5e3),r(c,u);u=l}h.start=h.pos}for(;c<h.pos;){let t=Math.min(h.pos,c+5e3);r(t,u),c=t}}let nd=!1,rd=!1;function od(t,e,i){this.marker=t,this.from=e,this.to=i}function sd(t,e){if(t)for(let i=0;i<t.length;++i){let n=t[i];if(n.marker==e)return n}}function ad(t,e){let i;for(let n=0;n<t.length;++n)t[n]!=e&&(i||(i=[])).push(t[n]);return i}function ld(t,e){if(e.full)return null;let i=Dp(t,e.from.line)&&Mp(t,e.from.line).markedSpans,n=Dp(t,e.to.line)&&Mp(t,e.to.line).markedSpans;if(!i&&!n)return null;let r=e.from.ch,o=e.to.ch,s=0==Fp(e.from,e.to),a=function(t,e,i){let n;if(t)for(let r=0;r<t.length;++r){let o=t[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e)||o.from==e&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){let t=null==o.to||(s.inclusiveRight?o.to>=e:o.to>e);(n||(n=[])).push(new od(s,o.from,t?null:o.to))}}return n}(i,r,s),l=function(t,e,i){let n;if(t)for(let r=0;r<t.length;++r){let o=t[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=e:o.to>e)||o.from==e&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){let t=null==o.from||(s.inclusiveLeft?o.from<=e:o.from<e);(n||(n=[])).push(new od(s,t?null:o.from-e,null==o.to?null:o.to-e))}}return n}(n,o,s),c=1==e.text.length,u=Ph(e.text).length+(c?r:0);if(a)for(let t=0;t<a.length;++t){let e=a[t];if(null==e.to){let t=sd(l,e.marker);t?c&&(e.to=null==t.to?null:t.to+u):e.to=r}}if(l)for(let t=0;t<l.length;++t){let e=l[t];if(null!=e.to&&(e.to+=u),null==e.from){sd(a,e.marker)||(e.from=u,c&&(a||(a=[])).push(e))}else e.from+=u,c&&(a||(a=[])).push(e)}a&&(a=cd(a)),l&&l!=a&&(l=cd(l));let h=[a];if(!c){let t,i=e.text.length-2;if(i>0&&a)for(let e=0;e<a.length;++e)null==a[e].to&&(t||(t=[])).push(new od(a[e].marker,null,null));for(let e=0;e<i;++e)h.push(t);h.push(l)}return h}function cd(t){for(let e=0;e<t.length;++e){let i=t[e];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function ud(t){let e=t.markedSpans;if(e){for(let i=0;i<e.length;++i)e[i].marker.detachLine(t);t.markedSpans=null}}function hd(t,e){if(e){for(let i=0;i<e.length;++i)e[i].marker.attachLine(t);t.markedSpans=e}}function pd(t){return t.inclusiveLeft?-1:0}function dd(t){return t.inclusiveRight?1:0}function fd(t,e){let i=t.lines.length-e.lines.length;if(0!=i)return i;let n=t.find(),r=e.find(),o=Fp(n.from,r.from)||pd(t)-pd(e);if(o)return-o;let s=Fp(n.to,r.to)||dd(t)-dd(e);return s||e.id-t.id}function md(t,e){let i,n=rd&&t.markedSpans;if(n)for(let t,r=0;r<n.length;++r)t=n[r],t.marker.collapsed&&null==(e?t.from:t.to)&&(!i||fd(i,t.marker)<0)&&(i=t.marker);return i}function gd(t){return md(t,!0)}function yd(t){return md(t,!1)}function _d(t,e){let i,n=rd&&t.markedSpans;if(n)for(let t=0;t<n.length;++t){let r=n[t];r.marker.collapsed&&(null==r.from||r.from<e)&&(null==r.to||r.to>e)&&(!i||fd(i,r.marker)<0)&&(i=r.marker)}return i}function vd(t,e,i,n,r){let o=Mp(t,e),s=rd&&o.markedSpans;if(s)for(let t=0;t<s.length;++t){let e=s[t];if(!e.marker.collapsed)continue;let o=e.marker.find(0),a=Fp(o.from,i)||pd(e.marker)-pd(r),l=Fp(o.to,n)||dd(e.marker)-dd(r);if(!(a>=0&&l<=0||a<=0&&l>=0)&&(a<=0&&(e.marker.inclusiveRight&&r.inclusiveLeft?Fp(o.to,i)>=0:Fp(o.to,i)>0)||a>=0&&(e.marker.inclusiveRight&&r.inclusiveLeft?Fp(o.from,n)<=0:Fp(o.from,n)<0)))return!0}}function xd(t){let e;for(;e=gd(t);)t=e.find(-1,!0).line;return t}function bd(t,e){let i=Mp(t,e),n=xd(i);return i==n?e:Lp(n)}function wd(t,e){if(e>t.lastLine())return e;let i,n=Mp(t,e);if(!Td(t,n))return e;for(;i=yd(n);)n=i.find(1,!0).line;return Lp(n)+1}function Td(t,e){let i=rd&&e.markedSpans;if(i)for(let n,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&Sd(t,e,n))return!0}}function Sd(t,e,i){if(null==i.to){let e=i.marker.find(1,!0);return Sd(t,e.line,sd(e.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==e.text.length)return!0;for(let n,r=0;r<e.markedSpans.length;++r)if(n=e.markedSpans[r],n.marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&Sd(t,e,n))return!0}function Cd(t){let e=0,i=(t=xd(t)).parent;for(let n=0;n<i.lines.length;++n){let r=i.lines[n];if(r==t)break;e+=r.height}for(let t=i.parent;t;i=t,t=i.parent)for(let n=0;n<t.children.length;++n){let r=t.children[n];if(r==i)break;e+=r.height}return e}function Ed(t){if(0==t.height)return 0;let e,i=t.text.length,n=t;for(;e=gd(n);){let t=e.find(0,!0);n=t.from.line,i+=t.from.ch-t.to.ch}for(n=t;e=yd(n);){let t=e.find(0,!0);i-=n.text.length-t.from.ch,n=t.to.line,i+=n.text.length-t.to.ch}return i}function Id(t){let e=t.display,i=t.doc;e.maxLine=Mp(i,i.first),e.maxLineLength=Ed(e.maxLine),e.maxLineChanged=!0,i.iter((t=>{let i=Ed(t);i>e.maxLineLength&&(e.maxLineLength=i,e.maxLine=t)}))}class Md{constructor(t,e,i){this.text=t,hd(this,e),this.height=i?i(this):1}lineNo(){return Lp(this)}}function Ad(t){t.parent=null,ud(t)}ep(Md);let kd={},Pd={};function Ld(t,e){if(!t||/^\s*$/.test(t))return null;let i=e.addModeClass?Pd:kd;return i[t]||(i[t]=t.replace(/\S+/g,"cm-$&"))}function zd(t,e){let i=dh("span",null,null,Gu?"padding-right: .1px":null),n={pre:dh("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};e.measure={};for(let i=0;i<=(e.rest?e.rest.length:0);i++){let r,o=i?e.rest[i-1]:e.line;n.pos=0,n.addToken=Rd,pp(t.display.measure)&&(r=Zh(o,t.doc.direction))&&(n.addToken=Od(n.addToken,r)),n.map=[],Nd(o,n,Hp(t,o,e!=t.display.externalMeasured&&Lp(o))),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=yh(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=yh(o.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(hp(t.display.measure))),0==i?(e.measure.map=n.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(n.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(Gu){let t=n.content.lastChild;(/\bcm-tab\b/.test(t.className)||t.querySelector&&t.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Kh(t,"renderLine",t,e.line,n.pre),n.pre.className&&(n.textClass=yh(n.pre.className,n.textClass||"")),n}function Dd(t){let e=ph("span","•","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function Rd(t,e,i,n,r,o,s){if(!e)return;let a,l=t.splitSpaces?function(t,e){if(t.length>1&&!/  /.test(t))return t;let i=e,n="";for(let e=0;e<t.length;e++){let r=t.charAt(e);" "!=r||!i||e!=t.length-1&&32!=t.charCodeAt(e+1)||(r=" "),n+=r,i=" "==r}return n}(e,t.trailingSpace):e,c=t.cm.state.specialChars,u=!1;if(c.test(e)){a=document.createDocumentFragment();let i=0;for(;;){c.lastIndex=i;let n,r=c.exec(e),o=r?r.index-i:e.length-i;if(o){let e=document.createTextNode(l.slice(i,i+o));Uu&&Vu<9?a.appendChild(ph("span",[e])):a.appendChild(e),t.map.push(t.pos,t.pos+o,e),t.col+=o,t.pos+=o}if(!r)break;if(i+=o+1,"\t"==r[0]){let e=t.cm.options.tabSize,i=e-t.col%e;n=a.appendChild(ph("span",kh(i),"cm-tab")),n.setAttribute("role","presentation"),n.setAttribute("cm-text","\t"),t.col+=i}else"\r"==r[0]||"\n"==r[0]?(n=a.appendChild(ph("span","\r"==r[0]?"␍":"␤","cm-invalidchar")),n.setAttribute("cm-text",r[0]),t.col+=1):(n=t.cm.options.specialCharPlaceholder(r[0]),n.setAttribute("cm-text",r[0]),Uu&&Vu<9?a.appendChild(ph("span",[n])):a.appendChild(n),t.col+=1);t.map.push(t.pos,t.pos+1,n),t.pos++}}else t.col+=e.length,a=document.createTextNode(l),t.map.push(t.pos,t.pos+e.length,a),Uu&&Vu<9&&(u=!0),t.pos+=e.length;if(t.trailingSpace=32==l.charCodeAt(e.length-1),i||n||r||u||o||s){let e=i||"";n&&(e+=n),r&&(e+=r);let l=ph("span",[a],e,o);if(s)for(let t in s)s.hasOwnProperty(t)&&"style"!=t&&"class"!=t&&l.setAttribute(t,s[t]);return t.content.appendChild(l)}t.content.appendChild(a)}function Od(t,e){return(i,n,r,o,s,a,l)=>{r=r?r+" cm-force-border":"cm-force-border";let c=i.pos,u=c+n.length;for(;;){let h;for(let t=0;t<e.length&&(h=e[t],!(h.to>c&&h.from<=c));t++);if(h.to>=u)return t(i,n,r,o,s,a,l);t(i,n.slice(0,h.to-c),r,o,null,a,l),o=null,n=n.slice(h.to-c),c=h.to}}}function Fd(t,e,i,n){let r=!n&&i.widgetNode;r&&t.map.push(t.pos,t.pos+e,r),!n&&t.cm.display.input.needsContentAttribute&&(r||(r=t.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(t.cm.display.input.setUneditable(r),t.content.appendChild(r)),t.pos+=e,t.trailingSpace=!1}function Nd(t,e,i){let n=t.markedSpans,r=t.text,o=0;if(!n){for(let t=1;t<i.length;t+=2)e.addToken(e,r.slice(o,o=i[t]),Ld(i[t+1],e.cm.options));return}let s,a,l,c,u,h,p,d=r.length,f=0,m=1,g="",y=0;for(;;){if(y==f){l=c=u=a="",p=null,h=null,y=1/0;let t,i=[];for(let e=0;e<n.length;++e){let r=n[e],o=r.marker;if("bookmark"==o.type&&r.from==f&&o.widgetNode)i.push(o);else if(r.from<=f&&(null==r.to||r.to>f||o.collapsed&&r.to==f&&r.from==f)){if(null!=r.to&&r.to!=f&&y>r.to&&(y=r.to,c=""),o.className&&(l+=" "+o.className),o.css&&(a=(a?a+";":"")+o.css),o.startStyle&&r.from==f&&(u+=" "+o.startStyle),o.endStyle&&r.to==y&&(t||(t=[])).push(o.endStyle,r.to),o.title&&((p||(p={})).title=o.title),o.attributes)for(let t in o.attributes)(p||(p={}))[t]=o.attributes[t];o.collapsed&&(!h||fd(h.marker,o)<0)&&(h=r)}else r.from>f&&y>r.from&&(y=r.from)}if(t)for(let e=0;e<t.length;e+=2)t[e+1]==y&&(c+=" "+t[e]);if(!h||h.from==f)for(let t=0;t<i.length;++t)Fd(e,0,i[t]);if(h&&(h.from||0)==f){if(Fd(e,(null==h.to?d+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=d)break;let t=Math.min(d,y);for(;;){if(g){let i=f+g.length;if(!h){let n=i>t?g.slice(0,t-f):g;e.addToken(e,n,s?s+l:l,u,f+n.length==y?c:"",a,p)}if(i>=t){g=g.slice(t-f),f=t;break}f=i,u=""}g=r.slice(o,o=i[m++]),s=Ld(i[m++],e.cm.options)}}}function Bd(t,e,i){this.line=e,this.rest=function(t){let e,i;for(;e=yd(t);)t=e.find(1,!0).line,(i||(i=[])).push(t);return i}(e),this.size=this.rest?Lp(Ph(this.rest))-i+1:1,this.node=this.text=null,this.hidden=Td(t,e)}function jd(t,e,i){let n,r=[];for(let o=e;o<i;o=n){let e=new Bd(t.doc,Mp(t.doc,o),o);n=o+e.size,r.push(e)}return r}let $d=null;let Ud=null;function Vd(t,e){let i=Xh(t,e);if(!i.length)return;let n,r=Array.prototype.slice.call(arguments,2);$d?n=$d.delayedCallbacks:Ud?n=Ud:(n=Ud=[],setTimeout(Gd,0));for(let t=0;t<i.length;++t)n.push((()=>i[t].apply(null,r)))}function Gd(){let t=Ud;Ud=null;for(let e=0;e<t.length;++e)t[e]()}function qd(t,e,i,n){for(let r=0;r<e.changes.length;r++){let o=e.changes[r];"text"==o?Hd(t,e):"gutter"==o?Yd(t,e,i,n):"class"==o?Xd(t,e):"widget"==o&&Kd(t,e,n)}e.changes=null}function Zd(t){return t.node==t.text&&(t.node=ph("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),Uu&&Vu<8&&(t.node.style.zIndex=2)),t.node}function Wd(t,e){let i=t.display.externalMeasured;return i&&i.line==e.line?(t.display.externalMeasured=null,e.measure=i.measure,i.built):zd(t,e)}function Hd(t,e){let i=e.text.className,n=Wd(t,e);e.text==e.node&&(e.node=n.pre),e.text.parentNode.replaceChild(n.pre,e.text),e.text=n.pre,n.bgClass!=e.bgClass||n.textClass!=e.textClass?(e.bgClass=n.bgClass,e.textClass=n.textClass,Xd(t,e)):i&&(e.text.className=i)}function Xd(t,e){!function(t,e){let i=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),e.background)i?e.background.className=i:(e.background.parentNode.removeChild(e.background),e.background=null);else if(i){let n=Zd(e);e.background=n.insertBefore(ph("div",null,i),n.firstChild),t.display.input.setUneditable(e.background)}}(t,e),e.line.wrapClass?Zd(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");let i=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=i||""}function Yd(t,e,i,n){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){let i=Zd(e);e.gutterBackground=ph("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,`left: ${t.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth}px; width: ${n.gutterTotalWidth}px`),t.display.input.setUneditable(e.gutterBackground),i.insertBefore(e.gutterBackground,e.text)}let r=e.line.gutterMarkers;if(t.options.lineNumbers||r){let o=Zd(e),s=e.gutter=ph("div",null,"CodeMirror-gutter-wrapper",`left: ${t.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth}px`);if(s.setAttribute("aria-hidden","true"),t.display.input.setUneditable(s),o.insertBefore(s,e.text),e.line.gutterClass&&(s.className+=" "+e.line.gutterClass),!t.options.lineNumbers||r&&r["CodeMirror-linenumbers"]||(e.lineNumber=s.appendChild(ph("div",Rp(t.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt",`left: ${n.gutterLeft["CodeMirror-linenumbers"]}px; width: ${t.display.lineNumInnerWidth}px`))),r)for(let e=0;e<t.display.gutterSpecs.length;++e){let i=t.display.gutterSpecs[e].className,o=r.hasOwnProperty(i)&&r[i];o&&s.appendChild(ph("div",[o],"CodeMirror-gutter-elt",`left: ${n.gutterLeft[i]}px; width: ${n.gutterWidth[i]}px`))}}}function Kd(t,e,i){e.alignable&&(e.alignable=null);let n=ah("CodeMirror-linewidget");for(let t,i=e.node.firstChild;i;i=t)t=i.nextSibling,n.test(i.className)&&e.node.removeChild(i);Qd(t,e,i)}function Jd(t,e,i,n){let r=Wd(t,e);return e.text=e.node=r.pre,r.bgClass&&(e.bgClass=r.bgClass),r.textClass&&(e.textClass=r.textClass),Xd(t,e),Yd(t,e,i,n),Qd(t,e,n),e.node}function Qd(t,e,i){if(tf(t,e.line,e,i,!0),e.rest)for(let n=0;n<e.rest.length;n++)tf(t,e.rest[n],e,i,!1)}function tf(t,e,i,n,r){if(!e.widgets)return;let o=Zd(i);for(let s=0,a=e.widgets;s<a.length;++s){let e=a[s],l=ph("div",[e.node],"CodeMirror-linewidget"+(e.className?" "+e.className:""));e.handleMouseEvents||l.setAttribute("cm-ignore-events","true"),ef(e,l,i,n),t.display.input.setUneditable(l),r&&e.above?o.insertBefore(l,i.gutter||i.text):o.appendChild(l),Vd(e,"redraw")}}function ef(t,e,i,n){if(t.noHScroll){(i.alignable||(i.alignable=[])).push(e);let r=n.wrapperWidth;e.style.left=n.fixedPos+"px",t.coverGutter||(r-=n.gutterTotalWidth,e.style.paddingLeft=n.gutterTotalWidth+"px"),e.style.width=r+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-n.gutterTotalWidth+"px"))}function nf(t){if(null!=t.height)return t.height;let e=t.doc.cm;if(!e)return 0;if(!fh(document.body,t.node)){let i="position: relative;";t.coverGutter&&(i+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(i+="width: "+e.display.wrapper.clientWidth+"px;"),hh(e.display.measure,ph("div",[t.node],null,i))}return t.height=t.node.parentNode.offsetHeight}function rf(t,e){for(let i=sp(e);i!=t.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==t.sizer&&i!=t.mover)return!0}function of(t){return t.lineSpace.offsetTop}function sf(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function af(t){if(t.cachedPaddingH)return t.cachedPaddingH;let e=hh(t.measure,ph("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,n={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(t.cachedPaddingH=n),n}function lf(t){return 50-t.display.nativeBarWidth}function cf(t){return t.display.scroller.clientWidth-lf(t)-t.display.barWidth}function uf(t){return t.display.scroller.clientHeight-lf(t)-t.display.barHeight}function hf(t,e,i){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};if(t.rest){for(let i=0;i<t.rest.length;i++)if(t.rest[i]==e)return{map:t.measure.maps[i],cache:t.measure.caches[i]};for(let e=0;e<t.rest.length;e++)if(Lp(t.rest[e])>i)return{map:t.measure.maps[e],cache:t.measure.caches[e],before:!0}}}function pf(t,e,i,n){return mf(t,ff(t,e),i,n)}function df(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Zf(t,e)];let i=t.display.externalMeasured;return i&&e>=i.lineN&&e<i.lineN+i.size?i:void 0}function ff(t,e){let i=Lp(e),n=df(t,i);n&&!n.text?n=null:n&&n.changes&&(qd(t,n,i,$f(t)),t.curOp.forceUpdate=!0),n||(n=function(t,e){let i=Lp(e=xd(e)),n=t.display.externalMeasured=new Bd(t.doc,e,i);n.lineN=i;let r=n.built=zd(t,n);return n.text=r.pre,hh(t.display.lineMeasure,r.pre),n}(t,e));let r=hf(n,e,i);return{line:e,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function mf(t,e,i,n,r){e.before&&(i=-1);let o,s=i+(n||"");return e.cache.hasOwnProperty(s)?o=e.cache[s]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(!function(t,e,i){let n=t.options.lineWrapping,r=n&&cf(t);if(!e.measure.heights||n&&e.measure.width!=r){let t=e.measure.heights=[];if(n){e.measure.width=r;let n=e.text.firstChild.getClientRects();for(let e=0;e<n.length-1;e++){let r=n[e],o=n[e+1];Math.abs(r.bottom-o.bottom)>2&&t.push((r.bottom+o.top)/2-i.top)}}t.push(i.bottom-i.top)}}(t,e.view,e.rect),e.hasHeights=!0),o=function(t,e,i,n){let r,o=_f(e.map,i,n),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(let t=0;t<4;t++){for(;a&&jh(e.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&jh(e.line.text.charAt(o.coverStart+l));)++l;if(r=Uu&&Vu<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():vf(lh(s,a,l).getClientRects(),n),r.left||r.right||0==a)break;l=a,a-=1,c="right"}Uu&&Vu<11&&(r=function(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(t){if(null!=gp)return gp;let e=hh(t,ph("span","x")),i=e.getBoundingClientRect(),n=lh(e,0,1).getBoundingClientRect();return gp=Math.abs(i.left-n.left)>1}(t))return e;let i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*i,right:e.right*i,top:e.top*n,bottom:e.bottom*n}}(t.display.measure,r))}else{let e;a>0&&(c=n="right"),r=t.options.lineWrapping&&(e=s.getClientRects()).length>1?e["right"==n?e.length-1:0]:s.getBoundingClientRect()}if(Uu&&Vu<9&&!a&&(!r||!r.left&&!r.right)){let e=s.parentNode.getClientRects()[0];r=e?{left:e.left,right:e.left+jf(t.display),top:e.top,bottom:e.bottom}:yf}let u=r.top-e.rect.top,h=r.bottom-e.rect.top,p=(u+h)/2,d=e.view.measure.heights,f=0;for(;f<d.length-1&&!(p<d[f]);f++);let m=f?d[f-1]:0,g=d[f],y={left:("right"==c?r.right:r.left)-e.rect.left,right:("left"==c?r.left:r.right)-e.rect.left,top:m,bottom:g};r.left||r.right||(y.bogus=!0);t.options.singleCursorHeightPerLine||(y.rtop=u,y.rbottom=h);return y}(t,e,i,n),o.bogus||(e.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}let gf,yf={left:0,right:0,top:0,bottom:0};function _f(t,e,i){let n,r,o,s,a,l;for(let c=0;c<t.length;c+=3)if(a=t[c],l=t[c+1],e<a?(r=0,o=1,s="left"):e<l?(r=e-a,o=r+1):(c==t.length-3||e==l&&t[c+3]>e)&&(o=l-a,r=o-1,e>=l&&(s="right")),null!=r){if(n=t[c+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;c&&t[c-2]==t[c-3]&&t[c-1].insertLeft;)n=t[2+(c-=3)],s="left";if("right"==i&&r==l-a)for(;c<t.length-3&&t[c+3]==t[c+4]&&!t[c+5].insertLeft;)n=t[(c+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function vf(t,e){let i=yf;if("left"==e)for(let e=0;e<t.length&&(i=t[e]).left==i.right;e++);else for(let e=t.length-1;e>=0&&(i=t[e]).left==i.right;e--);return i}function xf(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(let e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function bf(t){t.display.externalMeasure=null,uh(t.display.lineMeasure);for(let e=0;e<t.display.view.length;e++)xf(t.display.view[e])}function wf(t){bf(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function Tf(){return Zu&&Qu?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Sf(){return Zu&&Qu?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Cf(t){let{widgets:e}=xd(t),i=0;if(e)for(let t=0;t<e.length;++t)e[t].above&&(i+=nf(e[t]));return i}function Ef(t,e,i,n,r){if(!r){let t=Cf(e);i.top+=t,i.bottom+=t}if("line"==n)return i;n||(n="local");let o=Cd(e);if("local"==n?o+=of(t.display):o-=t.display.viewOffset,"page"==n||"window"==n){let e=t.display.lineSpace.getBoundingClientRect();o+=e.top+("window"==n?0:Sf());let r=e.left+("window"==n?0:Tf());i.left+=r,i.right+=r}return i.top+=o,i.bottom+=o,i}function If(t,e,i){if("div"==i)return e;let n=e.left,r=e.top;if("page"==i)n-=Tf(),r-=Sf();else if("local"==i||!i){let e=t.display.sizer.getBoundingClientRect();n+=e.left,r+=e.top}let o=t.display.lineSpace.getBoundingClientRect();return{left:n-o.left,top:r-o.top}}function Mf(t,e,i,n,r){return n||(n=Mp(t.doc,e.line)),Ef(t,n,pf(t,n,e.ch,r),i)}function Af(t,e,i,n,r,o){function s(e,s){let a=mf(t,r,e,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,Ef(t,n,a,i)}n=n||Mp(t.doc,e.line),r||(r=ff(t,n));let a=Zh(n,t.doc.direction),l=e.ch,c=e.sticky;if(l>=n.text.length?(l=n.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(t,e,i){return s(i?t-1:t,1==a[e].level!=i)}let h=Gh(a,l,c),p=Vh,d=u(l,h,"before"==c);return null!=p&&(d.other=u(l,p,"before"!=c)),d}function kf(t,e){let i=0;e=Vp(t.doc,e),t.options.lineWrapping||(i=jf(t.display)*e.ch);let n=Mp(t.doc,e.line),r=Cd(n)+of(t.display);return{left:i,right:i,top:r,bottom:r+n.height}}function Pf(t,e,i,n,r){let o=Op(t,e,i);return o.xRel=r,n&&(o.outside=n),o}function Lf(t,e,i){let n=t.doc;if((i+=t.display.viewOffset)<0)return Pf(n.first,0,null,-1,-1);let r=zp(n,i),o=n.first+n.size-1;if(r>o)return Pf(n.first+n.size-1,Mp(n,o).text.length,null,1,1);e<0&&(e=0);let s=Mp(n,r);for(;;){let o=Of(t,s,r,e,i),a=_d(s,o.ch+(o.xRel>0||o.outside>0?1:0));if(!a)return o;let l=a.find(1);if(l.line==r)return l;s=Mp(n,r=l.line)}}function zf(t,e,i,n){n-=Cf(e);let r=e.text.length,o=Uh((e=>mf(t,i,e-1).bottom<=n),r,0);return r=Uh((e=>mf(t,i,e).top>n),o,r),{begin:o,end:r}}function Df(t,e,i,n){return i||(i=ff(t,e)),zf(t,e,i,Ef(t,e,mf(t,i,n),"line").top)}function Rf(t,e,i,n){return!(t.bottom<=i)&&(t.top>i||(n?t.left:t.right)>e)}function Of(t,e,i,n,r){r-=Cd(e);let o=ff(t,e),s=Cf(e),a=0,l=e.text.length,c=!0,u=Zh(e,t.doc.direction);if(u){let s=(t.options.lineWrapping?Nf:Ff)(t,e,i,o,u,n,r);c=1!=s.level,a=c?s.from:s.to-1,l=c?s.to:s.from-1}let h,p,d=null,f=null,m=Uh((e=>{let i=mf(t,o,e);return i.top+=s,i.bottom+=s,!!Rf(i,n,r,!1)&&(i.top<=r&&i.left<=n&&(d=e,f=i),!0)}),a,l),g=!1;if(f){let t=n-f.left<f.right-n,e=t==c;m=d+(e?0:1),p=e?"after":"before",h=t?f.left:f.right}else{c||m!=l&&m!=a||m++,p=0==m?"after":m==e.text.length?"before":mf(t,o,m-(c?1:0)).bottom+s<=r==c?"after":"before";let n=Af(t,Op(i,m,p),"line",e,o);h=n.left,g=r<n.top?-1:r>=n.bottom?1:0}return m=$h(e.text,m,1),Pf(i,m,p,g,n-h)}function Ff(t,e,i,n,r,o,s){let a=Uh((a=>{let l=r[a],c=1!=l.level;return Rf(Af(t,Op(i,c?l.to:l.from,c?"before":"after"),"line",e,n),o,s,!0)}),0,r.length-1),l=r[a];if(a>0){let c=1!=l.level,u=Af(t,Op(i,c?l.from:l.to,c?"after":"before"),"line",e,n);Rf(u,o,s,!0)&&u.top>s&&(l=r[a-1])}return l}function Nf(t,e,i,n,r,o,s){let{begin:a,end:l}=zf(t,e,n,s);/\s/.test(e.text.charAt(l-1))&&l--;let c=null,u=null;for(let e=0;e<r.length;e++){let i=r[e];if(i.from>=l||i.to<=a)continue;let s=mf(t,n,1!=i.level?Math.min(l,i.to)-1:Math.max(a,i.from)).right,h=s<o?o-s+1e9:s-o;(!c||u>h)&&(c=i,u=h)}return c||(c=r[r.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>l&&(c={from:c.from,to:l,level:c.level}),c}function Bf(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==gf){gf=ph("pre",null,"CodeMirror-line-like");for(let t=0;t<49;++t)gf.appendChild(document.createTextNode("x")),gf.appendChild(ph("br"));gf.appendChild(document.createTextNode("x"))}hh(t.measure,gf);let e=gf.offsetHeight/50;return e>3&&(t.cachedTextHeight=e),uh(t.measure),e||1}function jf(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;let e=ph("span","xxxxxxxxxx"),i=ph("pre",[e],"CodeMirror-line-like");hh(t.measure,i);let n=e.getBoundingClientRect(),r=(n.right-n.left)/10;return r>2&&(t.cachedCharWidth=r),r||10}function $f(t){let e=t.display,i={},n={},r=e.gutters.clientLeft;for(let o=e.gutters.firstChild,s=0;o;o=o.nextSibling,++s){let e=t.display.gutterSpecs[s].className;i[e]=o.offsetLeft+o.clientLeft+r,n[e]=o.clientWidth}return{fixedPos:Uf(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:e.wrapper.clientWidth}}function Uf(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function Vf(t){let e=Bf(t.display),i=t.options.lineWrapping,n=i&&Math.max(5,t.display.scroller.clientWidth/jf(t.display)-3);return r=>{if(Td(t.doc,r))return 0;let o=0;if(r.widgets)for(let t=0;t<r.widgets.length;t++)r.widgets[t].height&&(o+=r.widgets[t].height);return i?o+(Math.ceil(r.text.length/n)||1)*e:o+e}}function Gf(t){let e=t.doc,i=Vf(t);e.iter((t=>{let e=i(t);e!=t.height&&Pp(t,e)}))}function qf(t,e,i,n){let r=t.display;if(!i&&"true"==sp(e).getAttribute("cm-not-content"))return null;let o,s,a=r.lineSpace.getBoundingClientRect();try{o=e.clientX-a.left,s=e.clientY-a.top}catch(e){return null}let l,c=Lf(t,o,s);if(n&&c.xRel>0&&(l=Mp(t.doc,c.line).text).length==c.ch){let e=bh(l,l.length,t.options.tabSize)-l.length;c=Op(c.line,Math.max(0,Math.round((o-af(t.display).left)/jf(t.display))-e))}return c}function Zf(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;let i=t.display.view;for(let t=0;t<i.length;t++)if((e-=i[t].size)<0)return t}function Wf(t,e,i,n){null==e&&(e=t.doc.first),null==i&&(i=t.doc.first+t.doc.size),n||(n=0);let r=t.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>e)&&(r.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=r.viewTo)rd&&bd(t.doc,e)<r.viewTo&&Xf(t);else if(i<=r.viewFrom)rd&&wd(t.doc,i+n)>r.viewFrom?Xf(t):(r.viewFrom+=n,r.viewTo+=n);else if(e<=r.viewFrom&&i>=r.viewTo)Xf(t);else if(e<=r.viewFrom){let e=Yf(t,i,i+n,1);e?(r.view=r.view.slice(e.index),r.viewFrom=e.lineN,r.viewTo+=n):Xf(t)}else if(i>=r.viewTo){let i=Yf(t,e,e,-1);i?(r.view=r.view.slice(0,i.index),r.viewTo=i.lineN):Xf(t)}else{let o=Yf(t,e,e,-1),s=Yf(t,i,i+n,1);o&&s?(r.view=r.view.slice(0,o.index).concat(jd(t,o.lineN,s.lineN)).concat(r.view.slice(s.index)),r.viewTo+=n):Xf(t)}let o=r.externalMeasured;o&&(i<o.lineN?o.lineN+=n:e<o.lineN+o.size&&(r.externalMeasured=null))}function Hf(t,e,i){t.curOp.viewChanged=!0;let n=t.display,r=t.display.externalMeasured;if(r&&e>=r.lineN&&e<r.lineN+r.size&&(n.externalMeasured=null),e<n.viewFrom||e>=n.viewTo)return;let o=n.view[Zf(t,e)];if(null==o.node)return;let s=o.changes||(o.changes=[]);-1==Th(s,i)&&s.push(i)}function Xf(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function Yf(t,e,i,n){let r,o=Zf(t,e),s=t.display.view;if(!rd||i==t.doc.first+t.doc.size)return{index:o,lineN:i};let a=t.display.viewFrom;for(let t=0;t<o;t++)a+=s[t].size;if(a!=e){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-e,o++}else r=a-e;e+=r,i+=r}for(;bd(t.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function Kf(t){let e=t.display.view,i=0;for(let t=0;t<e.length;t++){let n=e[t];n.hidden||n.node&&!n.changes||++i}return i}function Jf(t){t.display.input.showSelection(t.display.input.prepareSelection())}function Qf(t,e=!0){let i=t.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=t.options.$customCursor;s&&(e=!0);for(let n=0;n<i.sel.ranges.length;n++){if(!e&&n==i.sel.primIndex)continue;let a=i.sel.ranges[n];if(a.from().line>=t.display.viewTo||a.to().line<t.display.viewFrom)continue;let l=a.empty();if(s){let e=s(t,a);e&&tm(t,e,r)}else(l||t.options.showCursorWhenSelecting)&&tm(t,a.head,r);l||im(t,a,o)}return n}function tm(t,e,i){let n=Af(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),r=i.appendChild(ph("div"," ","CodeMirror-cursor"));if(r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.height=Math.max(0,n.bottom-n.top)*t.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(t.getWrapperElement().className)){let i=Mf(t,e,"div",null,null),n=i.right-i.left;r.style.width=(n>0?n:t.defaultCharWidth())+"px"}if(n.other){let t=i.appendChild(ph("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));t.style.display="",t.style.left=n.other.left+"px",t.style.top=n.other.top+"px",t.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function em(t,e){return t.top-e.top||t.left-e.left}function im(t,e,i){let n=t.display,r=t.doc,o=document.createDocumentFragment(),s=af(t.display),a=s.left,l=Math.max(n.sizerWidth,cf(t)-n.sizer.offsetLeft)-s.right,c="ltr"==r.direction;function u(t,e,i,n){e<0&&(e=0),e=Math.round(e),n=Math.round(n),o.appendChild(ph("div",null,"CodeMirror-selected",`position: absolute; left: ${t}px;\n                             top: ${e}px; width: ${null==i?l-t:i}px;\n                             height: ${n-e}px`))}function h(e,i,n){let o,s,h=Mp(r,e),p=h.text.length;function d(i,n){return Mf(t,Op(e,i),"div",h,n)}function f(e,i,n){let r=Df(t,h,null,e),o="ltr"==i==("after"==n)?"left":"right";return d("after"==n?r.begin:r.end-(/\s/.test(h.text.charAt(r.end-1))?2:1),o)[o]}let m=Zh(h,r.direction);return function(t,e,i,n){if(!t)return n(e,i,"ltr",0);let r=!1;for(let o=0;o<t.length;++o){let s=t[o];(s.from<i&&s.to>e||e==i&&s.to==e)&&(n(Math.max(s.from,e),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),r=!0)}r||n(e,i,"ltr")}(m,i||0,null==n?p:n,((t,e,r,h)=>{let g="ltr"==r,y=d(t,g?"left":"right"),_=d(e-1,g?"right":"left"),v=null==i&&0==t,x=null==n&&e==p,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){let t=(c?x:v)&&w,e=(c?v:x)&&b?a:(g?y:_).left,i=t?l:(g?_:y).right;u(e,y.top,i-e,y.bottom)}else{let i,n,o,s;g?(i=c&&v&&b?a:y.left,n=c?l:f(t,r,"before"),o=c?a:f(e,r,"after"),s=c&&x&&w?l:_.right):(i=c?f(t,r,"before"):a,n=!c&&v&&b?l:y.right,o=!c&&x&&w?a:_.left,s=c?f(e,r,"after"):l),u(i,y.top,n-i,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(o,_.top,s-o,_.bottom)}(!o||em(y,o)<0)&&(o=y),em(_,o)<0&&(o=_),(!s||em(y,s)<0)&&(s=y),em(_,s)<0&&(s=_)})),{start:o,end:s}}let p=e.from(),d=e.to();if(p.line==d.line)h(p.line,p.ch,d.ch);else{let t=Mp(r,p.line),e=Mp(r,d.line),i=xd(t)==xd(e),n=h(p.line,p.ch,i?t.text.length+1:null).end,o=h(d.line,i?0:null,d.ch).start;i&&(n.top<o.top-2?(u(n.right,n.top,null,n.bottom),u(a,o.top,o.left,o.bottom)):u(n.right,n.top,o.left-n.right,n.bottom)),n.bottom<o.top&&u(a,n.bottom,null,o.top)}i.appendChild(o)}function nm(t){if(!t.state.focused)return;let e=t.display;clearInterval(e.blinker);let i=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval((()=>{t.hasFocus()||am(t),e.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}function rm(t){t.hasFocus()||(t.display.input.focus(),t.state.focused||sm(t))}function om(t){t.state.delayingBlurEvent=!0,setTimeout((()=>{t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,t.state.focused&&am(t))}),100)}function sm(t,e){t.state.delayingBlurEvent&&!t.state.draggingText&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(Kh(t,"focus",t,e),t.state.focused=!0,gh(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),Gu&&setTimeout((()=>t.display.input.reset(!0)),20)),t.display.input.receivedFocus()),nm(t))}function am(t,e){t.state.delayingBlurEvent||(t.state.focused&&(Kh(t,"blur",t,e),t.state.focused=!1,ch(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout((()=>{t.state.focused||(t.display.shift=!1)}),150))}function lm(t){let e=t.display,i=e.lineDiv.offsetTop,n=Math.max(0,e.scroller.getBoundingClientRect().top),r=e.lineDiv.getBoundingClientRect().top,o=0;for(let s=0;s<e.view.length;s++){let a,l=e.view[s],c=t.options.lineWrapping,u=0;if(l.hidden)continue;if(r+=l.line.height,Uu&&Vu<8){let t=l.node.offsetTop+l.node.offsetHeight;a=t-i,i=t}else{let t=l.node.getBoundingClientRect();a=t.bottom-t.top,!c&&l.text.firstChild&&(u=l.text.firstChild.getBoundingClientRect().right-t.left-1)}let h=l.line.height-a;if((h>.005||h<-.005)&&(r<n&&(o-=h),Pp(l.line,a),cm(l.line),l.rest))for(let t=0;t<l.rest.length;t++)cm(l.rest[t]);if(u>t.display.sizerWidth){let e=Math.ceil(u/jf(t.display));e>t.display.maxLineLength&&(t.display.maxLineLength=e,t.display.maxLine=l.line,t.display.maxLineChanged=!0)}}Math.abs(o)>2&&(e.scroller.scrollTop+=o)}function cm(t){if(t.widgets)for(let e=0;e<t.widgets.length;++e){let i=t.widgets[e],n=i.node.parentNode;n&&(i.height=n.offsetHeight)}}function um(t,e,i){let n=i&&null!=i.top?Math.max(0,i.top):t.scroller.scrollTop;n=Math.floor(n-of(t));let r=i&&null!=i.bottom?i.bottom:n+t.wrapper.clientHeight,o=zp(e,n),s=zp(e,r);if(i&&i.ensure){let n=i.ensure.from.line,r=i.ensure.to.line;n<o?(o=n,s=zp(e,Cd(Mp(e,n))+t.wrapper.clientHeight)):Math.min(r,e.lastLine())>=s&&(o=zp(e,Cd(Mp(e,r))-t.wrapper.clientHeight),s=r)}return{from:o,to:Math.max(s,o+1)}}function hm(t,e){let i=t.display,n=Bf(t.display);e.top<0&&(e.top=0);let r=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:i.scroller.scrollTop,o=uf(t),s={};e.bottom-e.top>o&&(e.bottom=e.top+o);let a=t.doc.height+sf(i),l=e.top<n,c=e.bottom>a-n;if(e.top<r)s.scrollTop=l?0:e.top;else if(e.bottom>r+o){let t=Math.min(e.top,(c?a:e.bottom)-o);t!=r&&(s.scrollTop=t)}let u=t.options.fixedGutter?0:i.gutters.offsetWidth,h=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:i.scroller.scrollLeft-u,p=cf(t)-i.gutters.offsetWidth,d=e.right-e.left>p;return d&&(e.right=e.left+p),e.left<10?s.scrollLeft=0:e.left<h?s.scrollLeft=Math.max(0,e.left+u-(d?0:10)):e.right>p+h-3&&(s.scrollLeft=e.right+(d?0:10)-p),s}function pm(t,e){null!=e&&(mm(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function dm(t){mm(t);let e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function fm(t,e,i){null==e&&null==i||mm(t),null!=e&&(t.curOp.scrollLeft=e),null!=i&&(t.curOp.scrollTop=i)}function mm(t){let e=t.curOp.scrollToPos;if(e){t.curOp.scrollToPos=null,gm(t,kf(t,e.from),kf(t,e.to),e.margin)}}function gm(t,e,i,n){let r=hm(t,{left:Math.min(e.left,i.left),top:Math.min(e.top,i.top)-n,right:Math.max(e.right,i.right),bottom:Math.max(e.bottom,i.bottom)+n});fm(t,r.scrollLeft,r.scrollTop)}function ym(t,e){Math.abs(t.doc.scrollTop-e)<2||(Nu||Um(t,{top:e}),_m(t,e,!0),Nu&&Um(t),Fm(t,100))}function _m(t,e,i){e=Math.max(0,Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e)),(t.display.scroller.scrollTop!=e||i)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function vm(t,e,i,n){e=Math.max(0,Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth)),(i?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!n||(t.doc.scrollLeft=e,qm(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function xm(t){let e=t.display,i=e.gutters.offsetWidth,n=Math.round(t.doc.height+sf(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+lf(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:i}}function bm(t,e){e||(e=xm(t));let i=t.display.barWidth,n=t.display.barHeight;wm(t,e);for(let e=0;e<4&&i!=t.display.barWidth||n!=t.display.barHeight;e++)i!=t.display.barWidth&&t.options.lineWrapping&&lm(t),wm(t,xm(t)),i=t.display.barWidth,n=t.display.barHeight}function wm(t,e){let i=t.display,n=i.scrollbars.update(e);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=e.gutterWidth+"px"):i.gutterFiller.style.display=""}let Tm={native:class{constructor(t,e,i){this.cm=i;let n=this.vert=ph("div",[ph("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=ph("div",[ph("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=r.tabIndex=-1,t(n),t(r),Hh(n,"scroll",(()=>{n.clientHeight&&e(n.scrollTop,"vertical")})),Hh(r,"scroll",(()=>{r.clientWidth&&e(r.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,Uu&&Vu<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}update(t){let e=t.scrollWidth>t.clientWidth+1,i=t.scrollHeight>t.clientHeight+1,n=t.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=e?n+"px":"0";let i=t.viewHeight-(e?n:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=t.barLeft+"px";let e=t.viewWidth-t.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+e)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:e?n:0}}setScrollLeft(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}setScrollTop(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}zeroWidthHack(){let t=eh&&!Yu?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new wh,this.disableVert=new wh}enableZeroWidthBar(t,e,i){t.style.pointerEvents="auto",e.set(1e3,(function n(){let r=t.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=t?t.style.pointerEvents="none":e.set(1e3,n)}))}clear(){let t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)}},null:class{update(){return{bottom:0,right:0}}setScrollLeft(){}setScrollTop(){}clear(){}}};function Sm(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&ch(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new Tm[t.options.scrollbarStyle]((e=>{t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),Hh(e,"mousedown",(()=>{t.state.focused&&setTimeout((()=>t.display.input.focus()),0)})),e.setAttribute("cm-not-content","true")}),((e,i)=>{"horizontal"==i?vm(t,e):ym(t,e)}),t),t.display.scrollbars.addClass&&gh(t.display.wrapper,t.display.scrollbars.addClass)}let Cm=0;function Em(t){var e;t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Cm,markArrays:null},e=t.curOp,$d?$d.ops.push(e):e.ownsGroup=$d={ops:[e],delayedCallbacks:[]}}function Im(t){let e=t.curOp;e&&function(t,e){let i=t.ownsGroup;if(i)try{!function(t){let e=t.delayedCallbacks,i=0;do{for(;i<e.length;i++)e[i].call(null);for(let e=0;e<t.ops.length;e++){let i=t.ops[e];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(i<e.length)}(i)}finally{$d=null,e(i)}}(e,(t=>{for(let e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;!function(t){let e=t.ops;for(let t=0;t<e.length;t++)Mm(e[t]);for(let t=0;t<e.length;t++)Am(e[t]);for(let t=0;t<e.length;t++)km(e[t]);for(let t=0;t<e.length;t++)Pm(e[t]);for(let t=0;t<e.length;t++)Lm(e[t])}(t)}))}function Mm(t){let e=t.cm,i=e.display;!function(t){let e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=lf(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=lf(t)+"px",e.scrollbarsClipped=!0)}(e),t.updateMaxLine&&Id(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<i.viewFrom||t.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new Bm(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function Am(t){t.updatedDisplay=t.mustUpdate&&jm(t.cm,t.update)}function km(t){let e=t.cm,i=e.display;t.updatedDisplay&&lm(e),t.barMeasure=xm(e),i.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=pf(e,i.maxLine,i.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+t.adjustWidthTo+lf(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+t.adjustWidthTo-cf(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=i.input.prepareSelection())}function Pm(t){let e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&vm(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);let i=t.focus&&t.focus==mh();t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,i),(t.updatedDisplay||t.startHeight!=e.doc.height)&&bm(e,t.barMeasure),t.updatedDisplay&&Gm(e,t.barMeasure),t.selectionChanged&&nm(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),i&&rm(t.cm)}function Lm(t){let e=t.cm,i=e.display,n=e.doc;if(t.updatedDisplay&&$m(e,t.update),null==i.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=t.scrollTop&&_m(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&vm(e,t.scrollLeft,!0,!0),t.scrollToPos){let i=function(t,e,i,n){let r;null==n&&(n=0),t.options.lineWrapping||e!=i||(i="before"==e.sticky?Op(e.line,e.ch+1,"before"):e,e=e.ch?Op(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e);for(let o=0;o<5;o++){let o=!1,s=Af(t,e),a=i&&i!=e?Af(t,i):s;r={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n};let l=hm(t,r),c=t.doc.scrollTop,u=t.doc.scrollLeft;if(null!=l.scrollTop&&(ym(t,l.scrollTop),Math.abs(t.doc.scrollTop-c)>1&&(o=!0)),null!=l.scrollLeft&&(vm(t,l.scrollLeft),Math.abs(t.doc.scrollLeft-u)>1&&(o=!0)),!o)break}return r}(e,Vp(n,t.scrollToPos.from),Vp(n,t.scrollToPos.to),t.scrollToPos.margin);!function(t,e){if(Jh(t,"scrollCursorIntoView"))return;let i=t.display,n=i.sizer.getBoundingClientRect(),r=null;if(e.top+n.top<0?r=!0:e.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!Ku){let n=ph("div","​",null,`position: absolute;\n                         top: ${e.top-i.viewOffset-of(t.display)}px;\n                         height: ${e.bottom-e.top+lf(t)+i.barHeight}px;\n                         left: ${e.left}px; width: ${Math.max(2,e.right-e.left)}px;`);t.display.lineSpace.appendChild(n),n.scrollIntoView(r),t.display.lineSpace.removeChild(n)}}(e,i)}let r=t.maybeHiddenMarkers,o=t.maybeUnhiddenMarkers;if(r)for(let t=0;t<r.length;++t)r[t].lines.length||Kh(r[t],"hide");if(o)for(let t=0;t<o.length;++t)o[t].lines.length&&Kh(o[t],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&Kh(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function zm(t,e){if(t.curOp)return e();Em(t);try{return e()}finally{Im(t)}}function Dm(t,e){return function(){if(t.curOp)return e.apply(t,arguments);Em(t);try{return e.apply(t,arguments)}finally{Im(t)}}}function Rm(t){return function(){if(this.curOp)return t.apply(this,arguments);Em(this);try{return t.apply(this,arguments)}finally{Im(this)}}}function Om(t){return function(){let e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);Em(e);try{return t.apply(this,arguments)}finally{Im(e)}}}function Fm(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,vh(Nm,t))}function Nm(t){let e=t.doc;if(e.highlightFrontier>=t.display.viewTo)return;let i=+new Date+t.options.workTime,n=Xp(t,e.highlightFrontier),r=[];e.iter(n.line,Math.min(e.first+e.size,t.display.viewTo+500),(o=>{if(n.line>=t.display.viewFrom){let i=o.styles,s=o.text.length>t.options.maxHighlightLength?Sp(e.mode,n.state):null,a=Wp(t,o,n,!0);s&&(n.state=s),o.styles=a.styles;let l=o.styleClasses,c=a.classes;c?o.styleClasses=c:l&&(o.styleClasses=null);let u=!i||i.length!=o.styles.length||l!=c&&(!l||!c||l.bgClass!=c.bgClass||l.textClass!=c.textClass);for(let t=0;!u&&t<i.length;++t)u=i[t]!=o.styles[t];u&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=t.options.maxHighlightLength&&Yp(t,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return Fm(t,t.options.workDelay),!0})),e.highlightFrontier=n.line,e.modeFrontier=Math.max(e.modeFrontier,n.line),r.length&&zm(t,(()=>{for(let e=0;e<r.length;e++)Hf(t,r[e],"text")}))}class Bm{constructor(t,e,i){let n=t.display;this.viewport=e,this.visible=um(n,t.doc,e),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=cf(t),this.force=i,this.dims=$f(t),this.events=[]}signal(t,e){tp(t,e)&&this.events.push(arguments)}finish(){for(let t=0;t<this.events.length;t++)Kh.apply(null,this.events[t])}}function jm(t,e){let i=t.display,n=t.doc;if(e.editorIsHidden)return Xf(t),!1;if(!e.force&&e.visible.from>=i.viewFrom&&e.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==Kf(t))return!1;Zm(t)&&(Xf(t),e.dims=$f(t));let r=n.first+n.size,o=Math.max(e.visible.from-t.options.viewportMargin,n.first),s=Math.min(r,e.visible.to+t.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(n.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(r,i.viewTo)),rd&&(o=bd(t.doc,o),s=wd(t.doc,s));let a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=e.wrapperHeight||i.lastWrapWidth!=e.wrapperWidth;!function(t,e,i){let n=t.display;0==n.view.length||e>=n.viewTo||i<=n.viewFrom?(n.view=jd(t,e,i),n.viewFrom=e):(n.viewFrom>e?n.view=jd(t,e,n.viewFrom).concat(n.view):n.viewFrom<e&&(n.view=n.view.slice(Zf(t,e))),n.viewFrom=e,n.viewTo<i?n.view=n.view.concat(jd(t,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Zf(t,i)))),n.viewTo=i}(t,o,s),i.viewOffset=Cd(Mp(t.doc,i.viewFrom)),t.display.mover.style.top=i.viewOffset+"px";let l=Kf(t);if(!a&&0==l&&!e.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;let c=function(t){if(t.hasFocus())return null;let e=mh();if(!e||!fh(t.display.lineDiv,e))return null;let i={activeElt:e};if(window.getSelection){let e=window.getSelection();e.anchorNode&&e.extend&&fh(t.display.lineDiv,e.anchorNode)&&(i.anchorNode=e.anchorNode,i.anchorOffset=e.anchorOffset,i.focusNode=e.focusNode,i.focusOffset=e.focusOffset)}return i}(t);return l>4&&(i.lineDiv.style.display="none"),function(t,e,i){let n=t.display,r=t.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function a(e){let i=e.nextSibling;return Gu&&eh&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),i}let l=n.view,c=n.viewFrom;for(let n=0;n<l.length;n++){let u=l[n];if(u.hidden);else if(u.node&&u.node.parentNode==o){for(;s!=u.node;)s=a(s);let n=r&&null!=e&&e<=c&&u.lineNumber;u.changes&&(Th(u.changes,"gutter")>-1&&(n=!1),qd(t,u,c,i)),n&&(uh(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(Rp(t.options,c)))),s=u.node.nextSibling}else{let e=Jd(t,u,c,i);o.insertBefore(e,s)}c+=u.size}for(;s;)s=a(s)}(t,i.updateLineNumbers,e.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,function(t){if(t&&t.activeElt&&t.activeElt!=mh()&&(t.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(t.activeElt.nodeName)&&t.anchorNode&&fh(document.body,t.anchorNode)&&fh(document.body,t.focusNode))){let e=window.getSelection(),i=document.createRange();i.setEnd(t.anchorNode,t.anchorOffset),i.collapse(!1),e.removeAllRanges(),e.addRange(i),e.extend(t.focusNode,t.focusOffset)}}(c),uh(i.cursorDiv),uh(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=e.wrapperHeight,i.lastWrapWidth=e.wrapperWidth,Fm(t,400)),i.updateLineNumbers=null,!0}function $m(t,e){let i=e.viewport;for(let n=!0;;n=!1){if(n&&t.options.lineWrapping&&e.oldDisplayWidth!=cf(t))n&&(e.visible=um(t.display,t.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(t.doc.height+sf(t.display)-uf(t),i.top)}),e.visible=um(t.display,t.doc,i),e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)break;if(!jm(t,e))break;lm(t);let r=xm(t);Jf(t),bm(t,r),Gm(t,r),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function Um(t,e){let i=new Bm(t,e);if(jm(t,i)){lm(t),$m(t,i);let e=xm(t);Jf(t),bm(t,e),Gm(t,e),i.finish()}}function Vm(t){let e=t.gutters.offsetWidth;t.sizer.style.marginLeft=e+"px",Vd(t,"gutterChanged",t)}function Gm(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+lf(t)+"px"}function qm(t){let e=t.display,i=e.view;if(!(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter))return;let n=Uf(e)-e.scroller.scrollLeft+t.doc.scrollLeft,r=e.gutters.offsetWidth,o=n+"px";for(let e=0;e<i.length;e++)if(!i[e].hidden){t.options.fixedGutter&&(i[e].gutter&&(i[e].gutter.style.left=o),i[e].gutterBackground&&(i[e].gutterBackground.style.left=o));let n=i[e].alignable;if(n)for(let t=0;t<n.length;t++)n[t].style.left=o}t.options.fixedGutter&&(e.gutters.style.left=n+r+"px")}function Zm(t){if(!t.options.lineNumbers)return!1;let e=t.doc,i=Rp(t.options,e.first+e.size-1),n=t.display;if(i.length!=n.lineNumChars){let e=n.measure.appendChild(ph("div",[ph("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),r=e.firstChild.offsetWidth,o=e.offsetWidth-r;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(r,n.lineGutter.offsetWidth-o)+1,n.lineNumWidth=n.lineNumInnerWidth+o,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",Vm(t.display),!0}return!1}function Wm(t,e){let i=[],n=!1;for(let r=0;r<t.length;r++){let o=t[r],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!e)continue;n=!0}i.push({className:o,style:s})}return e&&!n&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function Hm(t){let e=t.gutters,i=t.gutterSpecs;uh(e),t.lineGutter=null;for(let n=0;n<i.length;++n){let{className:r,style:o}=i[n],s=e.appendChild(ph("div",null,"CodeMirror-gutter "+r));o&&(s.style.cssText=o),"CodeMirror-linenumbers"==r&&(t.lineGutter=s,s.style.width=(t.lineNumWidth||1)+"px")}e.style.display=i.length?"":"none",Vm(t)}function Xm(t){Hm(t.display),Wf(t),qm(t)}function Ym(t,e,i,n){let r=this;this.input=i,r.scrollbarFiller=ph("div",null,"CodeMirror-scrollbar-filler"),r.scrollbarFiller.setAttribute("cm-not-content","true"),r.gutterFiller=ph("div",null,"CodeMirror-gutter-filler"),r.gutterFiller.setAttribute("cm-not-content","true"),r.lineDiv=dh("div",null,"CodeMirror-code"),r.selectionDiv=ph("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=ph("div",null,"CodeMirror-cursors"),r.measure=ph("div",null,"CodeMirror-measure"),r.lineMeasure=ph("div",null,"CodeMirror-measure"),r.lineSpace=dh("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none");let o=dh("div",[r.lineSpace],"CodeMirror-lines");r.mover=ph("div",[o],null,"position: relative"),r.sizer=ph("div",[r.mover],"CodeMirror-sizer"),r.sizerWidth=null,r.heightForcer=ph("div",null,null,"position: absolute; height: 50px; width: 1px;"),r.gutters=ph("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=ph("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=ph("div",[r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),r.wrapper.setAttribute("translate","no"),Uu&&Vu<8&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),Gu||Nu&&th||(r.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(r.wrapper):t(r.wrapper)),r.viewFrom=r.viewTo=e.first,r.reportedViewFrom=r.reportedViewTo=e.first,r.view=[],r.renderedView=null,r.externalMeasured=null,r.viewOffset=0,r.lastWrapHeight=r.lastWrapWidth=0,r.updateLineNumbers=null,r.nativeBarWidth=r.barHeight=r.barWidth=0,r.scrollbarsClipped=!1,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.alignWidgets=!1,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null,r.activeTouch=null,r.gutterSpecs=Wm(n.gutters,n.lineNumbers),Hm(r),i.init(r)}let Km=0,Jm=null;function Qm(t){let e=t.wheelDeltaX,i=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==i&&t.detail&&t.axis==t.VERTICAL_AXIS?i=t.detail:null==i&&(i=t.wheelDelta),{x:e,y:i}}function tg(t){let e=Qm(t);return e.x*=Jm,e.y*=Jm,e}function eg(t,e){Zu&&Wu>=102&&(null==t.display.chromeScrollHack?t.display.sizer.style.pointerEvents="none":clearTimeout(t.display.chromeScrollHack),t.display.chromeScrollHack=setTimeout((()=>{t.display.chromeScrollHack=null,t.display.sizer.style.pointerEvents=""}),100));let i=Qm(e),n=i.x,r=i.y,o=Jm;0===e.deltaMode&&(n=e.deltaX,r=e.deltaY,o=1);let s=t.display,a=s.scroller,l=a.scrollWidth>a.clientWidth,c=a.scrollHeight>a.clientHeight;if(n&&l||r&&c){if(r&&eh&&Gu)t:for(let i=e.target,n=s.view;i!=a;i=i.parentNode)for(let e=0;e<n.length;e++)if(n[e].node==i){t.display.currentWheelTarget=i;break t}if(n&&!Nu&&!Hu&&null!=o)return r&&c&&ym(t,Math.max(0,a.scrollTop+r*o)),vm(t,Math.max(0,a.scrollLeft+n*o)),(!r||r&&c)&&ip(e),void(s.wheelStartX=null);if(r&&null!=o){let e=r*o,i=t.doc.scrollTop,n=i+s.wrapper.clientHeight;e<0?i=Math.max(0,i+e-50):n=Math.min(t.doc.height,n+e+50),Um(t,{top:i,bottom:n})}Km<20&&0!==e.deltaMode&&(null==s.wheelStartX?(s.wheelStartX=a.scrollLeft,s.wheelStartY=a.scrollTop,s.wheelDX=n,s.wheelDY=r,setTimeout((()=>{if(null==s.wheelStartX)return;let t=a.scrollLeft-s.wheelStartX,e=a.scrollTop-s.wheelStartY,i=e&&s.wheelDY&&e/s.wheelDY||t&&s.wheelDX&&t/s.wheelDX;s.wheelStartX=s.wheelStartY=null,i&&(Jm=(Jm*Km+i)/(Km+1),++Km)}),200)):(s.wheelDX+=n,s.wheelDY+=r))}}Uu?Jm=-.53:Nu?Jm=15:Zu?Jm=-.7:Xu&&(Jm=-1/3);class ig{constructor(t,e){this.ranges=t,this.primIndex=e}primary(){return this.ranges[this.primIndex]}equals(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(let e=0;e<this.ranges.length;e++){let i=this.ranges[e],n=t.ranges[e];if(!Np(i.anchor,n.anchor)||!Np(i.head,n.head))return!1}return!0}deepCopy(){let t=[];for(let e=0;e<this.ranges.length;e++)t[e]=new ng(Bp(this.ranges[e].anchor),Bp(this.ranges[e].head));return new ig(t,this.primIndex)}somethingSelected(){for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1}contains(t,e){e||(e=t);for(let i=0;i<this.ranges.length;i++){let n=this.ranges[i];if(Fp(e,n.from())>=0&&Fp(t,n.to())<=0)return i}return-1}}class ng{constructor(t,e){this.anchor=t,this.head=e}from(){return $p(this.anchor,this.head)}to(){return jp(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}}function rg(t,e,i){let n=t&&t.options.selectionsMayTouch,r=e[i];e.sort(((t,e)=>Fp(t.from(),e.from()))),i=Th(e,r);for(let t=1;t<e.length;t++){let r=e[t],o=e[t-1],s=Fp(o.to(),r.from());if(n&&!r.empty()?s>0:s>=0){let n=$p(o.from(),r.from()),s=jp(o.to(),r.to()),a=o.empty()?r.from()==r.head:o.from()==o.head;t<=i&&--i,e.splice(--t,2,new ng(a?s:n,a?n:s))}}return new ig(e,i)}function og(t,e){return new ig([new ng(t,e||t)],0)}function sg(t){return t.text?Op(t.from.line+t.text.length-1,Ph(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function ag(t,e){if(Fp(t,e.from)<0)return t;if(Fp(t,e.to)<=0)return sg(e);let i=t.line+e.text.length-(e.to.line-e.from.line)-1,n=t.ch;return t.line==e.to.line&&(n+=sg(e).ch-e.to.ch),Op(i,n)}function lg(t,e){let i=[];for(let n=0;n<t.sel.ranges.length;n++){let r=t.sel.ranges[n];i.push(new ng(ag(r.anchor,e),ag(r.head,e)))}return rg(t.cm,i,t.sel.primIndex)}function cg(t,e,i){return t.line==e.line?Op(i.line,t.ch-e.ch+i.ch):Op(i.line+(t.line-e.line),t.ch)}function ug(t){t.doc.mode=bp(t.options,t.doc.modeOption),hg(t)}function hg(t){t.doc.iter((t=>{t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)})),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,Fm(t,100),t.state.modeGen++,t.curOp&&Wf(t)}function pg(t,e){return 0==e.from.ch&&0==e.to.ch&&""==Ph(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function dg(t,e,i,n){function r(t){return i?i[t]:null}function o(t,i,r){!function(t,e,i,n){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),ud(t),hd(t,i);let r=n?n(t):1;r!=t.height&&Pp(t,r)}(t,i,r,n),Vd(t,"change",t,e)}function s(t,e){let i=[];for(let o=t;o<e;++o)i.push(new Md(c[o],r(o),n));return i}let a=e.from,l=e.to,c=e.text,u=Mp(t,a.line),h=Mp(t,l.line),p=Ph(c),d=r(c.length-1),f=l.line-a.line;if(e.full)t.insert(0,s(0,c.length)),t.remove(c.length,t.size-c.length);else if(pg(t,e)){let e=s(0,c.length-1);o(h,h.text,d),f&&t.remove(a.line,f),e.length&&t.insert(a.line,e)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+p+u.text.slice(l.ch),d);else{let e=s(1,c.length-1);e.push(new Md(p+u.text.slice(l.ch),d,n)),o(u,u.text.slice(0,a.ch)+c[0],r(0)),t.insert(a.line+1,e)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),r(0)),t.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],r(0)),o(h,p+h.text.slice(l.ch),d);let e=s(1,c.length-1);f>1&&t.remove(a.line+1,f-1),t.insert(a.line+1,e)}Vd(t,"change",t,e)}function fg(t,e,i){!function t(n,r,o){if(n.linked)for(let s=0;s<n.linked.length;++s){let a=n.linked[s];if(a.doc==r)continue;let l=o&&a.sharedHist;i&&!l||(e(a.doc,l),t(a.doc,n,l))}}(t,null,!0)}function mg(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,Gf(t),ug(t),gg(t),t.options.direction=e.direction,t.options.lineWrapping||Id(t),t.options.mode=e.modeOption,Wf(t)}function gg(t){("rtl"==t.doc.direction?gh:ch)(t.display.lineDiv,"CodeMirror-rtl")}function yg(t){this.done=[],this.undone=[],this.undoDepth=t?t.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t?t.maxGeneration:1}function _g(t,e){let i={from:Bp(e.from),to:sg(e),text:Ap(t,e.from,e.to)};return Tg(t,i,e.from.line,e.to.line+1),fg(t,(t=>Tg(t,i,e.from.line,e.to.line+1)),!0),i}function vg(t){for(;t.length;){if(!Ph(t).ranges)break;t.pop()}}function xg(t,e,i,n){let r=t.history;r.undone.length=0;let o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&r.lastModTime>a-(t.cm?t.cm.options.historyEventDelay:500)||"*"==e.origin.charAt(0)))&&(o=function(t,e){return e?(vg(t.done),Ph(t.done)):t.done.length&&!Ph(t.done).ranges?Ph(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),Ph(t.done)):void 0}(r,r.lastOp==n)))s=Ph(o.changes),0==Fp(e.from,e.to)&&0==Fp(e.from,s.to)?s.to=sg(e):o.changes.push(_g(t,e));else{let i=Ph(r.done);for(i&&i.ranges||wg(t.sel,r.done),o={changes:[_g(t,e)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=e.origin,s||Kh(t,"historyAdded")}function bg(t,e,i,n){let r=t.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||function(t,e,i,n){let r=e.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}(t,o,Ph(r.done),e))?r.done[r.done.length-1]=e:wg(e,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&vg(r.undone)}function wg(t,e){let i=Ph(e);i&&i.ranges&&i.equals(t)||e.push(t)}function Tg(t,e,i,n){let r=e["spans_"+t.id],o=0;t.iter(Math.max(t.first,i),Math.min(t.first+t.size,n),(i=>{i.markedSpans&&((r||(r=e["spans_"+t.id]={}))[o]=i.markedSpans),++o}))}function Sg(t){if(!t)return null;let e;for(let i=0;i<t.length;++i)t[i].marker.explicitlyCleared?e||(e=t.slice(0,i)):e&&e.push(t[i]);return e?e.length?e:null:t}function Cg(t,e){let i=function(t,e){let i=e["spans_"+t.id];if(!i)return null;let n=[];for(let t=0;t<e.text.length;++t)n.push(Sg(i[t]));return n}(t,e),n=ld(t,e);if(!i)return n;if(!n)return i;for(let t=0;t<i.length;++t){let e=i[t],r=n[t];if(e&&r)t:for(let t=0;t<r.length;++t){let i=r[t];for(let t=0;t<e.length;++t)if(e[t].marker==i.marker)continue t;e.push(i)}else r&&(i[t]=r)}return i}function Eg(t,e,i){let n=[];for(let o=0;o<t.length;++o){let s=t[o];if(s.ranges){n.push(i?ig.prototype.deepCopy.call(s):s);continue}let a=s.changes,l=[];n.push({changes:l});for(let t=0;t<a.length;++t){let i,n=a[t];if(l.push({from:n.from,to:n.to,text:n.text}),e)for(var r in n)(i=r.match(/^spans_(\d+)$/))&&Th(e,Number(i[1]))>-1&&(Ph(l)[r]=n[r],delete n[r])}}return n}function Ig(t,e,i,n){if(n){let n=t.anchor;if(i){let t=Fp(e,n)<0;t!=Fp(i,n)<0?(n=e,e=i):t!=Fp(e,i)<0&&(e=i)}return new ng(n,e)}return new ng(i||e,e)}function Mg(t,e,i,n,r){null==r&&(r=t.cm&&(t.cm.display.shift||t.extend)),zg(t,new ig([Ig(t.sel.primary(),e,i,r)],0),n)}function Ag(t,e,i){let n=[],r=t.cm&&(t.cm.display.shift||t.extend);for(let i=0;i<t.sel.ranges.length;i++)n[i]=Ig(t.sel.ranges[i],e[i],null,r);zg(t,rg(t.cm,n,t.sel.primIndex),i)}function kg(t,e,i,n){let r=t.sel.ranges.slice(0);r[e]=i,zg(t,rg(t.cm,r,t.sel.primIndex),n)}function Pg(t,e,i,n){zg(t,og(e,i),n)}function Lg(t,e,i){let n=t.history.done,r=Ph(n);r&&r.ranges?(n[n.length-1]=e,Dg(t,e,i)):zg(t,e,i)}function zg(t,e,i){Dg(t,e,i),bg(t,t.sel,t.cm?t.cm.curOp.id:NaN,i)}function Dg(t,e,i){(tp(t,"beforeSelectionChange")||t.cm&&tp(t.cm,"beforeSelectionChange"))&&(e=function(t,e,i){let n={ranges:e.ranges,update:function(e){this.ranges=[];for(let i=0;i<e.length;i++)this.ranges[i]=new ng(Vp(t,e[i].anchor),Vp(t,e[i].head))},origin:i&&i.origin};return Kh(t,"beforeSelectionChange",t,n),t.cm&&Kh(t.cm,"beforeSelectionChange",t.cm,n),n.ranges!=e.ranges?rg(t.cm,n.ranges,n.ranges.length-1):e}(t,e,i));let n=i&&i.bias||(Fp(e.primary().head,t.sel.primary().head)<0?-1:1);Rg(t,Fg(t,e,n,!0)),i&&!1===i.scroll||!t.cm||"nocursor"==t.cm.getOption("readOnly")||dm(t.cm)}function Rg(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,Qh(t.cm)),Vd(t,"cursorActivity",t))}function Og(t){Rg(t,Fg(t,t.sel,null,!1))}function Fg(t,e,i,n){let r;for(let o=0;o<e.ranges.length;o++){let s=e.ranges[o],a=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[o],l=Bg(t,s.anchor,a&&a.anchor,i,n),c=Bg(t,s.head,a&&a.head,i,n);(r||l!=s.anchor||c!=s.head)&&(r||(r=e.ranges.slice(0,o)),r[o]=new ng(l,c))}return r?rg(t.cm,r,e.primIndex):e}function Ng(t,e,i,n,r){let o=Mp(t,e.line);if(o.markedSpans)for(let s=0;s<o.markedSpans.length;++s){let a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=e.ch:a.from<e.ch))&&(null==a.to||(u?a.to>=e.ch:a.to>e.ch))){if(r&&(Kh(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){let s,a=l.find(n<0?1:-1);if((n<0?u:c)&&(a=jg(t,a,-n,a&&a.line==e.line?o:null)),a&&a.line==e.line&&(s=Fp(a,i))&&(n<0?s<0:s>0))return Ng(t,a,e,n,r)}let a=l.find(n<0?-1:1);return(n<0?c:u)&&(a=jg(t,a,n,a.line==e.line?o:null)),a?Ng(t,a,e,n,r):null}}return e}function Bg(t,e,i,n,r){let o=n||1,s=Ng(t,e,i,o,r)||!r&&Ng(t,e,i,o,!0)||Ng(t,e,i,-o,r)||!r&&Ng(t,e,i,-o,!0);return s||(t.cantEdit=!0,Op(t.first,0))}function jg(t,e,i,n){return i<0&&0==e.ch?e.line>t.first?Vp(t,Op(e.line-1)):null:i>0&&e.ch==(n||Mp(t,e.line)).text.length?e.line<t.first+t.size-1?Op(e.line+1,0):null:new Op(e.line,e.ch+i)}function $g(t){t.setSelection(Op(t.firstLine(),0),Op(t.lastLine()),Ch)}function Ug(t,e,i){let n={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:()=>n.canceled=!0};return i&&(n.update=(e,i,r,o)=>{e&&(n.from=Vp(t,e)),i&&(n.to=Vp(t,i)),r&&(n.text=r),void 0!==o&&(n.origin=o)}),Kh(t,"beforeChange",t,n),t.cm&&Kh(t.cm,"beforeChange",t.cm,n),n.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Vg(t,e,i){if(t.cm){if(!t.cm.curOp)return Dm(t.cm,Vg)(t,e,i);if(t.cm.state.suppressEdits)return}if((tp(t,"beforeChange")||t.cm&&tp(t.cm,"beforeChange"))&&!(e=Ug(t,e,!0)))return;let n=nd&&!i&&function(t,e,i){let n=null;if(t.iter(e.line,i.line+1,(t=>{if(t.markedSpans)for(let e=0;e<t.markedSpans.length;++e){let i=t.markedSpans[e].marker;!i.readOnly||n&&-1!=Th(n,i)||(n||(n=[])).push(i)}})),!n)return null;let r=[{from:e,to:i}];for(let t=0;t<n.length;++t){let e=n[t],i=e.find(0);for(let t=0;t<r.length;++t){let n=r[t];if(Fp(n.to,i.from)<0||Fp(n.from,i.to)>0)continue;let o=[t,1],s=Fp(n.from,i.from),a=Fp(n.to,i.to);(s<0||!e.inclusiveLeft&&!s)&&o.push({from:n.from,to:i.from}),(a>0||!e.inclusiveRight&&!a)&&o.push({from:i.to,to:n.to}),r.splice.apply(r,o),t+=o.length-3}}return r}(t,e.from,e.to);if(n)for(let i=n.length-1;i>=0;--i)Gg(t,{from:n[i].from,to:n[i].to,text:i?[""]:e.text,origin:e.origin});else Gg(t,e)}function Gg(t,e){if(1==e.text.length&&""==e.text[0]&&0==Fp(e.from,e.to))return;let i=lg(t,e);xg(t,e,i,t.cm?t.cm.curOp.id:NaN),Wg(t,e,i,ld(t,e));let n=[];fg(t,((t,i)=>{i||-1!=Th(n,t.history)||(Kg(t.history,e),n.push(t.history)),Wg(t,e,null,ld(t,e))}))}function qg(t,e,i){let n=t.cm&&t.cm.state.suppressEdits;if(n&&!i)return;let r,o=t.history,s=t.sel,a="undo"==e?o.done:o.undone,l="undo"==e?o.undone:o.done,c=0;for(;c<a.length&&(r=a[c],i?!r.ranges||r.equals(t.sel):r.ranges);c++);if(c==a.length)return;for(o.lastOrigin=o.lastSelOrigin=null;;){if(r=a.pop(),!r.ranges){if(n)return void a.push(r);break}if(wg(r,l),i&&!r.equals(t.sel))return void zg(t,r,{clearRedo:!1});s=r}let u=[];wg(s,l),l.push({changes:u,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;let h=tp(t,"beforeChange")||t.cm&&tp(t.cm,"beforeChange");for(let i=r.changes.length-1;i>=0;--i){let n=r.changes[i];if(n.origin=e,h&&!Ug(t,n,!1))return void(a.length=0);u.push(_g(t,n));let o=i?lg(t,n):Ph(a);Wg(t,n,o,Cg(t,n)),!i&&t.cm&&t.cm.scrollIntoView({from:n.from,to:sg(n)});let s=[];fg(t,((t,e)=>{e||-1!=Th(s,t.history)||(Kg(t.history,n),s.push(t.history)),Wg(t,n,null,Cg(t,n))}))}}function Zg(t,e){if(0!=e&&(t.first+=e,t.sel=new ig(Lh(t.sel.ranges,(t=>new ng(Op(t.anchor.line+e,t.anchor.ch),Op(t.head.line+e,t.head.ch)))),t.sel.primIndex),t.cm)){Wf(t.cm,t.first,t.first-e,e);for(let e=t.cm.display,i=e.viewFrom;i<e.viewTo;i++)Hf(t.cm,i,"gutter")}}function Wg(t,e,i,n){if(t.cm&&!t.cm.curOp)return Dm(t.cm,Wg)(t,e,i,n);if(e.to.line<t.first)return void Zg(t,e.text.length-1-(e.to.line-e.from.line));if(e.from.line>t.lastLine())return;if(e.from.line<t.first){let i=e.text.length-1-(t.first-e.from.line);Zg(t,i),e={from:Op(t.first,0),to:Op(e.to.line+i,e.to.ch),text:[Ph(e.text)],origin:e.origin}}let r=t.lastLine();e.to.line>r&&(e={from:e.from,to:Op(r,Mp(t,r).text.length),text:[e.text[0]],origin:e.origin}),e.removed=Ap(t,e.from,e.to),i||(i=lg(t,e)),t.cm?function(t,e,i){let n=t.doc,r=t.display,o=e.from,s=e.to,a=!1,l=o.line;t.options.lineWrapping||(l=Lp(xd(Mp(n,o.line))),n.iter(l,s.line+1,(t=>{if(t==r.maxLine)return a=!0,!0})));n.sel.contains(e.from,e.to)>-1&&Qh(t);dg(n,e,i,Vf(t)),t.options.lineWrapping||(n.iter(l,o.line+e.text.length,(t=>{let e=Ed(t);e>r.maxLineLength&&(r.maxLine=t,r.maxLineLength=e,r.maxLineChanged=!0,a=!1)})),a&&(t.curOp.updateMaxLine=!0));(function(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),t.highlightFrontier<e-10)return;let i=t.first;for(let n=e-1;n>i;n--){let r=Mp(t,n).stateAfter;if(r&&(!(r instanceof qp)||n+r.lookAhead<e)){i=n+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,i)})(n,o.line),Fm(t,400);let c=e.text.length-(s.line-o.line)-1;e.full?Wf(t):o.line!=s.line||1!=e.text.length||pg(t.doc,e)?Wf(t,o.line,s.line+1,c):Hf(t,o.line,"text");let u=tp(t,"changes"),h=tp(t,"change");if(h||u){let i={from:o,to:s,text:e.text,removed:e.removed,origin:e.origin};h&&Vd(t,"change",t,i),u&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(i)}t.display.selForContextMenu=null}(t.cm,e,n):dg(t,e,n),Dg(t,i,Ch),t.cantEdit&&Bg(t,Op(t.firstLine(),0))&&(t.cantEdit=!1)}function Hg(t,e,i,n,r){n||(n=i),Fp(n,i)<0&&([i,n]=[n,i]),"string"==typeof e&&(e=t.splitLines(e)),Vg(t,{from:i,to:n,text:e,origin:r})}function Xg(t,e,i,n){i<t.line?t.line+=n:e<t.line&&(t.line=e,t.ch=0)}function Yg(t,e,i,n){for(let r=0;r<t.length;++r){let o=t[r],s=!0;if(o.ranges){o.copied||(o=t[r]=o.deepCopy(),o.copied=!0);for(let t=0;t<o.ranges.length;t++)Xg(o.ranges[t].anchor,e,i,n),Xg(o.ranges[t].head,e,i,n)}else{for(let t=0;t<o.changes.length;++t){let r=o.changes[t];if(i<r.from.line)r.from=Op(r.from.line+n,r.from.ch),r.to=Op(r.to.line+n,r.to.ch);else if(e<=r.to.line){s=!1;break}}s||(t.splice(0,r+1),r=0)}}}function Kg(t,e){let i=e.from.line,n=e.to.line,r=e.text.length-(n-i)-1;Yg(t.done,i,n,r),Yg(t.undone,i,n,r)}function Jg(t,e,i,n){let r=e,o=e;return"number"==typeof e?o=Mp(t,Up(t,e)):r=Lp(e),null==r?null:(n(o,r)&&t.cm&&Hf(t.cm,r,i),o)}function Qg(t){this.lines=t,this.parent=null;let e=0;for(let i=0;i<t.length;++i)t[i].parent=this,e+=t[i].height;this.height=e}function ty(t){this.children=t;let e=0,i=0;for(let n=0;n<t.length;++n){let r=t[n];e+=r.chunkSize(),i+=r.height,r.parent=this}this.size=e,this.height=i,this.parent=null}Qg.prototype={chunkSize(){return this.lines.length},removeInner(t,e){for(let i=t,n=t+e;i<n;++i){let t=this.lines[i];this.height-=t.height,Ad(t),Vd(t,"delete")}this.lines.splice(t,e)},collapse(t){t.push.apply(t,this.lines)},insertInner(t,e,i){this.height+=i,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(let t=0;t<e.length;++t)e[t].parent=this},iterN(t,e,i){for(let n=t+e;t<n;++t)if(i(this.lines[t]))return!0}},ty.prototype={chunkSize(){return this.size},removeInner(t,e){this.size-=e;for(let i=0;i<this.children.length;++i){let n=this.children[i],r=n.chunkSize();if(t<r){let o=Math.min(e,r-t),s=n.height;if(n.removeInner(t,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(e-=o))break;t=0}else t-=r}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof Qg))){let t=[];this.collapse(t),this.children=[new Qg(t)],this.children[0].parent=this}},collapse(t){for(let e=0;e<this.children.length;++e)this.children[e].collapse(t)},insertInner(t,e,i){this.size+=e.length,this.height+=i;for(let n=0;n<this.children.length;++n){let r=this.children[n],o=r.chunkSize();if(t<=o){if(r.insertInner(t,e,i),r.lines&&r.lines.length>50){let t=r.lines.length%25+25;for(let e=t;e<r.lines.length;){let t=new Qg(r.lines.slice(e,e+=25));r.height-=t.height,this.children.splice(++n,0,t),t.parent=this}r.lines=r.lines.slice(0,t),this.maybeSpill()}break}t-=o}},maybeSpill(){if(this.children.length<=10)return;let t=this;do{let e=new ty(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=e.size,t.height-=e.height;let i=Th(t.parent.children,t);t.parent.children.splice(i+1,0,e)}else{let i=new ty(t.children);i.parent=t,t.children=[i,e],t=i}e.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()},iterN(t,e,i){for(let n=0;n<this.children.length;++n){let r=this.children[n],o=r.chunkSize();if(t<o){let n=Math.min(e,o-t);if(r.iterN(t,n,i))return!0;if(0==(e-=n))break;t=0}else t-=o}}};class ey{constructor(t,e,i){if(i)for(let t in i)i.hasOwnProperty(t)&&(this[t]=i[t]);this.doc=t,this.node=e}clear(){let t=this.doc.cm,e=this.line.widgets,i=this.line,n=Lp(i);if(null==n||!e)return;for(let t=0;t<e.length;++t)e[t]==this&&e.splice(t--,1);e.length||(i.widgets=null);let r=nf(this);Pp(i,Math.max(0,i.height-r)),t&&(zm(t,(()=>{iy(t,i,-r),Hf(t,n,"widget")})),Vd(t,"lineWidgetCleared",t,this,n))}changed(){let t=this.height,e=this.doc.cm,i=this.line;this.height=null;let n=nf(this)-t;n&&(Td(this.doc,i)||Pp(i,i.height+n),e&&zm(e,(()=>{e.curOp.forceUpdate=!0,iy(e,i,n),Vd(e,"lineWidgetChanged",e,this,Lp(i))})))}}function iy(t,e,i){Cd(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&pm(t,i)}ep(ey);let ny=0;class ry{constructor(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++ny}clear(){if(this.explicitlyCleared)return;let t=this.doc.cm,e=t&&!t.curOp;if(e&&Em(t),tp(this,"clear")){let t=this.find();t&&Vd(this,"clear",t.from,t.to)}let i=null,n=null;for(let e=0;e<this.lines.length;++e){let r=this.lines[e],o=sd(r.markedSpans,this);t&&!this.collapsed?Hf(t,Lp(r),"text"):t&&(null!=o.to&&(n=Lp(r)),null!=o.from&&(i=Lp(r))),r.markedSpans=ad(r.markedSpans,o),null==o.from&&this.collapsed&&!Td(this.doc,r)&&t&&Pp(r,Bf(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(let e=0;e<this.lines.length;++e){let i=xd(this.lines[e]),n=Ed(i);n>t.display.maxLineLength&&(t.display.maxLine=i,t.display.maxLineLength=n,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&Wf(t,i,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Og(t.doc)),t&&Vd(t,"markerCleared",t,this,i,n),e&&Im(t),this.parent&&this.parent.clear()}find(t,e){let i,n;null==t&&"bookmark"==this.type&&(t=1);for(let r=0;r<this.lines.length;++r){let o=this.lines[r],s=sd(o.markedSpans,this);if(null!=s.from&&(i=Op(e?o:Lp(o),s.from),-1==t))return i;if(null!=s.to&&(n=Op(e?o:Lp(o),s.to),1==t))return n}return i&&{from:i,to:n}}changed(){let t=this.find(-1,!0),e=this,i=this.doc.cm;t&&i&&zm(i,(()=>{let n=t.line,r=Lp(t.line),o=df(i,r);if(o&&(xf(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!Td(e.doc,n)&&null!=e.height){let t=e.height;e.height=null;let i=nf(e)-t;i&&Pp(n,n.height+i)}Vd(i,"markerChanged",i,this)}))}attachLine(t){if(!this.lines.length&&this.doc.cm){let t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=Th(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)}detachLine(t){if(this.lines.splice(Th(this.lines,t),1),!this.lines.length&&this.doc.cm){let t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}}}function oy(t,e,i,n,r){if(n&&n.shared)return function(t,e,i,n,r){(n=xh(n)).shared=!1;let o=[oy(t,e,i,n,r)],s=o[0],a=n.widgetNode;return fg(t,(t=>{a&&(n.widgetNode=a.cloneNode(!0)),o.push(oy(t,Vp(t,e),Vp(t,i),n,r));for(let e=0;e<t.linked.length;++e)if(t.linked[e].isParent)return;s=Ph(o)})),new sy(o,s)}(t,e,i,n,r);if(t.cm&&!t.cm.curOp)return Dm(t.cm,oy)(t,e,i,n,r);let o=new ry(t,r),s=Fp(e,i);if(n&&xh(n,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=dh("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(vd(t,e.line,e,i,o)||e.line!=i.line&&vd(t,i.line,e,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");rd=!0}o.addToHistory&&xg(t,{from:e,to:i,origin:"markText"},t.sel,NaN);let a,l=e.line,c=t.cm;if(t.iter(l,i.line+1,(n=>{c&&o.collapsed&&!c.options.lineWrapping&&xd(n)==c.display.maxLine&&(a=!0),o.collapsed&&l!=e.line&&Pp(n,0),function(t,e,i){let n=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));n&&t.markedSpans&&n.has(t.markedSpans)?t.markedSpans.push(e):(t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],n&&n.add(t.markedSpans)),e.marker.attachLine(t)}(n,new od(o,l==e.line?e.ch:null,l==i.line?i.ch:null),t.cm&&t.cm.curOp),++l})),o.collapsed&&t.iter(e.line,i.line+1,(e=>{Td(t,e)&&Pp(e,0)})),o.clearOnEnter&&Hh(o,"beforeCursorEnter",(()=>o.clear())),o.readOnly&&(nd=!0,(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed&&(o.id=++ny,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)Wf(c,e.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(let t=e.line;t<=i.line;t++)Hf(c,t,"text");o.atomic&&Og(c.doc),Vd(c,"markerAdded",c,o)}return o}ep(ry);class sy{constructor(t,e){this.markers=t,this.primary=e;for(let e=0;e<t.length;++e)t[e].parent=this}clear(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(let t=0;t<this.markers.length;++t)this.markers[t].clear();Vd(this,"clear")}}find(t,e){return this.primary.find(t,e)}}function ay(t){return t.findMarks(Op(t.first,0),t.clipPos(Op(t.lastLine())),(t=>t.parent))}function ly(t){for(let e=0;e<t.length;e++){let i=t[e],n=[i.primary.doc];fg(i.primary.doc,(t=>n.push(t)));for(let t=0;t<i.markers.length;t++){let e=i.markers[t];-1==Th(n,e.doc)&&(e.parent=null,i.markers.splice(t--,1))}}}ep(sy);let cy=0,uy=function(t,e,i,n,r){if(!(this instanceof uy))return new uy(t,e,i,n,r);null==i&&(i=0),ty.call(this,[new Qg([new Md("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;let o=Op(i,0);this.sel=og(o),this.history=new yg(null),this.id=++cy,this.modeOption=e,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),dg(this,{from:o,to:o,text:t}),zg(this,og(o),Ch)};uy.prototype=Dh(ty.prototype,{constructor:uy,iter:function(t,e,i){i?this.iterN(t-this.first,e-t,i):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){let i=0;for(let t=0;t<e.length;++t)i+=e[t].height;this.insertInner(t-this.first,e,i)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){let e=kp(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:Om((function(t){let e=Op(this.first,0),i=this.first+this.size-1;Vg(this,{from:e,to:Op(i,Mp(this,i).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&fm(this.cm,0,0),zg(this,og(e),Ch)})),replaceRange:function(t,e,i,n){Hg(this,t,e=Vp(this,e),i=i?Vp(this,i):e,n)},getRange:function(t,e,i){let n=Ap(this,Vp(this,t),Vp(this,e));return!1===i?n:""===i?n.join(""):n.join(i||this.lineSeparator())},getLine:function(t){let e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(Dp(this,t))return Mp(this,t)},getLineNumber:function(t){return Lp(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=Mp(this,t)),xd(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return Vp(this,t)},getCursor:function(t){let e,i=this.sel.primary();return e=null==t||"head"==t?i.head:"anchor"==t?i.anchor:"end"==t||"to"==t||!1===t?i.to():i.from(),e},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Om((function(t,e,i){Pg(this,Vp(this,"number"==typeof t?Op(t,e||0):t),null,i)})),setSelection:Om((function(t,e,i){Pg(this,Vp(this,t),Vp(this,e||t),i)})),extendSelection:Om((function(t,e,i){Mg(this,Vp(this,t),e&&Vp(this,e),i)})),extendSelections:Om((function(t,e){Ag(this,Gp(this,t),e)})),extendSelectionsBy:Om((function(t,e){Ag(this,Gp(this,Lh(this.sel.ranges,t)),e)})),setSelections:Om((function(t,e,i){if(!t.length)return;let n=[];for(let e=0;e<t.length;e++)n[e]=new ng(Vp(this,t[e].anchor),Vp(this,t[e].head||t[e].anchor));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),zg(this,rg(this.cm,n,e),i)})),addSelection:Om((function(t,e,i){let n=this.sel.ranges.slice(0);n.push(new ng(Vp(this,t),Vp(this,e||t))),zg(this,rg(this.cm,n,n.length-1),i)})),getSelection:function(t){let e,i=this.sel.ranges;for(let t=0;t<i.length;t++){let n=Ap(this,i[t].from(),i[t].to());e=e?e.concat(n):n}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){let e=[],i=this.sel.ranges;for(let n=0;n<i.length;n++){let r=Ap(this,i[n].from(),i[n].to());!1!==t&&(r=r.join(t||this.lineSeparator())),e[n]=r}return e},replaceSelection:function(t,e,i){let n=[];for(let e=0;e<this.sel.ranges.length;e++)n[e]=t;this.replaceSelections(n,e,i||"+input")},replaceSelections:Om((function(t,e,i){let n=[],r=this.sel;for(let e=0;e<r.ranges.length;e++){let o=r.ranges[e];n[e]={from:o.from(),to:o.to(),text:this.splitLines(t[e]),origin:i}}let o=e&&"end"!=e&&function(t,e,i){let n=[],r=Op(t.first,0),o=r;for(let s=0;s<e.length;s++){let a=e[s],l=cg(a.from,r,o),c=cg(sg(a),r,o);if(r=a.to,o=c,"around"==i){let e=t.sel.ranges[s],i=Fp(e.head,e.anchor)<0;n[s]=new ng(i?c:l,i?l:c)}else n[s]=new ng(l,l)}return new ig(n,t.sel.primIndex)}(this,n,e);for(let t=n.length-1;t>=0;t--)Vg(this,n[t]);o?Lg(this,o):this.cm&&dm(this.cm)})),undo:Om((function(){qg(this,"undo")})),redo:Om((function(){qg(this,"redo")})),undoSelection:Om((function(){qg(this,"undo",!0)})),redoSelection:Om((function(){qg(this,"redo",!0)})),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){let t=this.history,e=0,i=0;for(let i=0;i<t.done.length;i++)t.done[i].ranges||++e;for(let e=0;e<t.undone.length;e++)t.undone[e].ranges||++i;return{undo:e,redo:i}},clearHistory:function(){this.history=new yg(this.history),fg(this,(t=>t.history=this.history),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:Eg(this.history.done),undone:Eg(this.history.undone)}},setHistory:function(t){let e=this.history=new yg(this.history);e.done=Eg(t.done.slice(0),null,!0),e.undone=Eg(t.undone.slice(0),null,!0)},setGutterMarker:Om((function(t,e,i){return Jg(this,t,"gutter",(t=>{let n=t.gutterMarkers||(t.gutterMarkers={});return n[e]=i,!i&&Nh(n)&&(t.gutterMarkers=null),!0}))})),clearGutter:Om((function(t){this.iter((e=>{e.gutterMarkers&&e.gutterMarkers[t]&&Jg(this,e,"gutter",(()=>(e.gutterMarkers[t]=null,Nh(e.gutterMarkers)&&(e.gutterMarkers=null),!0)))}))})),lineInfo:function(t){let e;if("number"==typeof t){if(!Dp(this,t))return null;if(e=t,!(t=Mp(this,t)))return null}else if(e=Lp(t),null==e)return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:Om((function(t,e,i){return Jg(this,t,"gutter"==e?"gutter":"class",(t=>{let n="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass";if(t[n]){if(ah(i).test(t[n]))return!1;t[n]+=" "+i}else t[n]=i;return!0}))})),removeLineClass:Om((function(t,e,i){return Jg(this,t,"gutter"==e?"gutter":"class",(t=>{let n="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass",r=t[n];if(!r)return!1;if(null==i)t[n]=null;else{let e=r.match(ah(i));if(!e)return!1;let o=e.index+e[0].length;t[n]=r.slice(0,e.index)+(e.index&&o!=r.length?" ":"")+r.slice(o)||null}return!0}))})),addLineWidget:Om((function(t,e,i){return function(t,e,i,n){let r=new ey(t,i,n),o=t.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),Jg(t,e,"widget",(e=>{let i=e.widgets||(e.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length,Math.max(0,r.insertAt)),0,r),r.line=e,o&&!Td(t,e)){let i=Cd(e)<t.scrollTop;Pp(e,e.height+nf(r)),i&&pm(o,r.height),o.curOp.forceUpdate=!0}return!0})),o&&Vd(o,"lineWidgetAdded",o,r,"number"==typeof e?e:Lp(e)),r}(this,t,e,i)})),removeLineWidget:function(t){t.clear()},markText:function(t,e,i){return oy(this,Vp(this,t),Vp(this,e),i,i&&i.type||"range")},setBookmark:function(t,e){let i={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return oy(this,t=Vp(this,t),t,i,"bookmark")},findMarksAt:function(t){let e=[],i=Mp(this,(t=Vp(this,t)).line).markedSpans;if(i)for(let n=0;n<i.length;++n){let r=i[n];(null==r.from||r.from<=t.ch)&&(null==r.to||r.to>=t.ch)&&e.push(r.marker.parent||r.marker)}return e},findMarks:function(t,e,i){t=Vp(this,t),e=Vp(this,e);let n=[],r=t.line;return this.iter(t.line,e.line+1,(o=>{let s=o.markedSpans;if(s)for(let o=0;o<s.length;o++){let a=s[o];null!=a.to&&r==t.line&&t.ch>=a.to||null==a.from&&r!=t.line||null!=a.from&&r==e.line&&a.from>=e.ch||i&&!i(a.marker)||n.push(a.marker.parent||a.marker)}++r})),n},getAllMarks:function(){let t=[];return this.iter((e=>{let i=e.markedSpans;if(i)for(let e=0;e<i.length;++e)null!=i[e].from&&t.push(i[e].marker)})),t},posFromIndex:function(t){let e,i=this.first,n=this.lineSeparator().length;return this.iter((r=>{let o=r.text.length+n;if(o>t)return e=t,!0;t-=o,++i})),Vp(this,Op(i,e))},indexFromPos:function(t){let e=(t=Vp(this,t)).ch;if(t.line<this.first||t.ch<0)return 0;let i=this.lineSeparator().length;return this.iter(this.first,t.line,(t=>{e+=t.text.length+i})),e},copy:function(t){let e=new uy(kp(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});let e=this.first,i=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<i&&(i=t.to);let n=new uy(kp(this,e,i),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:t.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],function(t,e){for(let i=0;i<e.length;i++){let n=e[i],r=n.find(),o=t.clipPos(r.from),s=t.clipPos(r.to);if(Fp(o,s)){let e=oy(t,o,s,n.primary,n.primary.type);n.markers.push(e),e.parent=n}}}(n,ay(this)),n},unlinkDoc:function(t){if(t instanceof n_&&(t=t.doc),this.linked)for(let e=0;e<this.linked.length;++e){if(this.linked[e].doc==t){this.linked.splice(e,1),t.unlinkDoc(this),ly(ay(this));break}}if(t.history==this.history){let e=[t.id];fg(t,(t=>e.push(t.id)),!0),t.history=new yg(null),t.history.done=Eg(this.history.done,e),t.history.undone=Eg(this.history.undone,e)}},iterLinkedDocs:function(t){fg(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):dp(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Om((function(t){var e;("rtl"!=t&&(t="ltr"),t!=this.direction)&&(this.direction=t,this.iter((t=>t.order=null)),this.cm&&zm(e=this.cm,(()=>{gg(e),Wf(e)})))}))}),uy.prototype.eachLine=uy.prototype.iter;let hy=0;function py(t){let e=this;if(dy(e),Jh(e,t)||rf(e.display,t))return;ip(t),Uu&&(hy=+new Date);let i=qf(e,t,!0),n=t.dataTransfer.files;if(i&&!e.isReadOnly())if(n&&n.length&&window.FileReader&&window.File){let t=n.length,r=Array(t),o=0;const s=()=>{++o==t&&Dm(e,(()=>{i=Vp(e.doc,i);let t={from:i,to:i,text:e.doc.splitLines(r.filter((t=>null!=t)).join(e.doc.lineSeparator())),origin:"paste"};Vg(e.doc,t),Lg(e.doc,og(Vp(e.doc,i),Vp(e.doc,sg(t))))}))()},a=(t,i)=>{if(e.options.allowDropFileTypes&&-1==Th(e.options.allowDropFileTypes,t.type))return void s();let n=new FileReader;n.onerror=()=>s(),n.onload=()=>{let t=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(t)||(r[i]=t),s()},n.readAsText(t)};for(let t=0;t<n.length;t++)a(n[t],t)}else{if(e.state.draggingText&&e.doc.sel.contains(i)>-1)return e.state.draggingText(t),void setTimeout((()=>e.display.input.focus()),20);try{let n=t.dataTransfer.getData("Text");if(n){let t;if(e.state.draggingText&&!e.state.draggingText.copy&&(t=e.listSelections()),Dg(e.doc,og(i,i)),t)for(let i=0;i<t.length;++i)Hg(e.doc,"",t[i].anchor,t[i].head,"drag");e.replaceSelection(n,"around","paste"),e.display.input.focus()}}catch(t){}}}function dy(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function fy(t){if(!document.getElementsByClassName)return;let e=document.getElementsByClassName("CodeMirror"),i=[];for(let t=0;t<e.length;t++){let n=e[t].CodeMirror;n&&i.push(n)}i.length&&i[0].operation((()=>{for(let e=0;e<i.length;e++)t(i[e])}))}let my=!1;function gy(){my||(!function(){let t;Hh(window,"resize",(()=>{null==t&&(t=setTimeout((()=>{t=null,fy(yy)}),100))})),Hh(window,"blur",(()=>fy(am)))}(),my=!0)}function yy(t){let e=t.display;e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize()}let _y={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(let t=0;t<10;t++)_y[t+48]=_y[t+96]=String(t);for(let t=65;t<=90;t++)_y[t]=String.fromCharCode(t);for(let t=1;t<=12;t++)_y[t+111]=_y[t+63235]="F"+t;let vy={};function xy(t){let e,i,n,r,o=t.split(/-(?!$)/);t=o[o.length-1];for(let t=0;t<o.length-1;t++){let s=o[t];if(/^(cmd|meta|m)$/i.test(s))r=!0;else if(/^a(lt)?$/i.test(s))e=!0;else if(/^(c|ctrl|control)$/i.test(s))i=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);n=!0}}return e&&(t="Alt-"+t),i&&(t="Ctrl-"+t),r&&(t="Cmd-"+t),n&&(t="Shift-"+t),t}function by(t){let e={};for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete t[i];continue}let r=Lh(i.split(" "),xy);for(let t=0;t<r.length;t++){let i,o;t==r.length-1?(o=r.join(" "),i=n):(o=r.slice(0,t+1).join(" "),i="...");let s=e[o];if(s){if(s!=i)throw new Error("Inconsistent bindings for "+o)}else e[o]=i}delete t[i]}for(let i in e)t[i]=e[i];return t}function wy(t,e,i,n){let r=(e=Ey(e)).call?e.call(t,n):e[t];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return wy(t,e.fallthrough,i,n);for(let r=0;r<e.fallthrough.length;r++){let o=wy(t,e.fallthrough[r],i,n);if(o)return o}}}function Ty(t){let e="string"==typeof t?t:_y[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function Sy(t,e,i){let n=t;return e.altKey&&"Alt"!=n&&(t="Alt-"+t),(oh?e.metaKey:e.ctrlKey)&&"Ctrl"!=n&&(t="Ctrl-"+t),(oh?e.ctrlKey:e.metaKey)&&"Mod"!=n&&(t="Cmd-"+t),!i&&e.shiftKey&&"Shift"!=n&&(t="Shift-"+t),t}function Cy(t,e){if(Hu&&34==t.keyCode&&t.char)return!1;let i=_y[t.keyCode];return null!=i&&!t.altGraphKey&&(3==t.keyCode&&t.code&&(i=t.code),Sy(i,t,e))}function Ey(t){return"string"==typeof t?vy[t]:t}function Iy(t,e){let i=t.doc.sel.ranges,n=[];for(let t=0;t<i.length;t++){let r=e(i[t]);for(;n.length&&Fp(r.from,Ph(n).to)<=0;){let t=n.pop();if(Fp(t.from,r.from)<0){r.from=t.from;break}}n.push(r)}zm(t,(()=>{for(let e=n.length-1;e>=0;e--)Hg(t.doc,"",n[e].from,n[e].to,"+delete");dm(t)}))}function My(t,e,i){let n=$h(t.text,e+i,i);return n<0||n>t.text.length?null:n}function Ay(t,e,i){let n=My(t,e.ch,i);return null==n?null:new Op(e.line,n,i<0?"after":"before")}function ky(t,e,i,n,r){if(t){"rtl"==e.doc.direction&&(r=-r);let t=Zh(i,e.doc.direction);if(t){let o,s=r<0?Ph(t):t[0],a=r<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==e.doc.direction){let t=ff(e,i);o=r<0?i.text.length-1:0;let n=mf(e,t,o).top;o=Uh((i=>mf(e,t,i).top==n),r<0==(1==s.level)?s.from:s.to-1,o),"before"==a&&(o=My(i,o,1))}else o=r<0?s.to:s.from;return new Op(n,o,a)}}return new Op(n,r<0?i.text.length:0,r<0?"before":"after")}vy.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},vy.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},vy.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},vy.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},vy.default=eh?vy.macDefault:vy.pcDefault;let Py={selectAll:$g,singleSelection:t=>t.setSelection(t.getCursor("anchor"),t.getCursor("head"),Ch),killLine:t=>Iy(t,(e=>{if(e.empty()){let i=Mp(t.doc,e.head.line).text.length;return e.head.ch==i&&e.head.line<t.lastLine()?{from:e.head,to:Op(e.head.line+1,0)}:{from:e.head,to:Op(e.head.line,i)}}return{from:e.from(),to:e.to()}})),deleteLine:t=>Iy(t,(e=>({from:Op(e.from().line,0),to:Vp(t.doc,Op(e.to().line+1,0))}))),delLineLeft:t=>Iy(t,(t=>({from:Op(t.from().line,0),to:t.from()}))),delWrappedLineLeft:t=>Iy(t,(e=>{let i=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:i},"div"),to:e.from()}})),delWrappedLineRight:t=>Iy(t,(e=>{let i=t.charCoords(e.head,"div").top+5,n=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div");return{from:e.from(),to:n}})),undo:t=>t.undo(),redo:t=>t.redo(),undoSelection:t=>t.undoSelection(),redoSelection:t=>t.redoSelection(),goDocStart:t=>t.extendSelection(Op(t.firstLine(),0)),goDocEnd:t=>t.extendSelection(Op(t.lastLine())),goLineStart:t=>t.extendSelectionsBy((e=>Ly(t,e.head.line)),{origin:"+move",bias:1}),goLineStartSmart:t=>t.extendSelectionsBy((e=>zy(t,e.head)),{origin:"+move",bias:1}),goLineEnd:t=>t.extendSelectionsBy((e=>function(t,e){let i=Mp(t.doc,e),n=function(t){let e;for(;e=yd(t);)t=e.find(1,!0).line;return t}(i);n!=i&&(e=Lp(n));return ky(!0,t,i,e,-1)}(t,e.head.line)),{origin:"+move",bias:-1}),goLineRight:t=>t.extendSelectionsBy((e=>{let i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:i},"div")}),Ih),goLineLeft:t=>t.extendSelectionsBy((e=>{let i=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:i},"div")}),Ih),goLineLeftSmart:t=>t.extendSelectionsBy((e=>{let i=t.cursorCoords(e.head,"div").top+5,n=t.coordsChar({left:0,top:i},"div");return n.ch<t.getLine(n.line).search(/\S/)?zy(t,e.head):n}),Ih),goLineUp:t=>t.moveV(-1,"line"),goLineDown:t=>t.moveV(1,"line"),goPageUp:t=>t.moveV(-1,"page"),goPageDown:t=>t.moveV(1,"page"),goCharLeft:t=>t.moveH(-1,"char"),goCharRight:t=>t.moveH(1,"char"),goColumnLeft:t=>t.moveH(-1,"column"),goColumnRight:t=>t.moveH(1,"column"),goWordLeft:t=>t.moveH(-1,"word"),goGroupRight:t=>t.moveH(1,"group"),goGroupLeft:t=>t.moveH(-1,"group"),goWordRight:t=>t.moveH(1,"word"),delCharBefore:t=>t.deleteH(-1,"codepoint"),delCharAfter:t=>t.deleteH(1,"char"),delWordBefore:t=>t.deleteH(-1,"word"),delWordAfter:t=>t.deleteH(1,"word"),delGroupBefore:t=>t.deleteH(-1,"group"),delGroupAfter:t=>t.deleteH(1,"group"),indentAuto:t=>t.indentSelection("smart"),indentMore:t=>t.indentSelection("add"),indentLess:t=>t.indentSelection("subtract"),insertTab:t=>t.replaceSelection("\t"),insertSoftTab:t=>{let e=[],i=t.listSelections(),n=t.options.tabSize;for(let r=0;r<i.length;r++){let o=i[r].from(),s=bh(t.getLine(o.line),o.ch,n);e.push(kh(n-s%n))}t.replaceSelections(e)},defaultTab:t=>{t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:t=>zm(t,(()=>{let e=t.listSelections(),i=[];for(let n=0;n<e.length;n++){if(!e[n].empty())continue;let r=e[n].head,o=Mp(t.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new Op(r.line,r.ch-1)),r.ch>0)r=new Op(r.line,r.ch+1),t.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),Op(r.line,r.ch-2),r,"+transpose");else if(r.line>t.doc.first){let e=Mp(t.doc,r.line-1).text;e&&(r=new Op(r.line,1),t.replaceRange(o.charAt(0)+t.doc.lineSeparator()+e.charAt(e.length-1),Op(r.line-1,e.length-1),r,"+transpose"))}i.push(new ng(r,r))}t.setSelections(i)})),newlineAndIndent:t=>zm(t,(()=>{let e=t.listSelections();for(let i=e.length-1;i>=0;i--)t.replaceRange(t.doc.lineSeparator(),e[i].anchor,e[i].head,"+input");e=t.listSelections();for(let i=0;i<e.length;i++)t.indentLine(e[i].from().line,null,!0);dm(t)})),openLine:t=>t.replaceSelection("\n","start"),toggleOverwrite:t=>t.toggleOverwrite()};function Ly(t,e){let i=Mp(t.doc,e),n=xd(i);return n!=i&&(e=Lp(n)),ky(!0,t,n,e,1)}function zy(t,e){let i=Ly(t,e.line),n=Mp(t.doc,i.line),r=Zh(n,t.doc.direction);if(!r||0==r[0].level){let t=Math.max(i.ch,n.text.search(/\S/)),r=e.line==i.line&&e.ch<=t&&e.ch;return Op(i.line,r?0:t,i.sticky)}return i}function Dy(t,e,i){if("string"==typeof e&&!(e=Py[e]))return!1;t.display.input.ensurePolled();let n=t.display.shift,r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),i&&(t.display.shift=!1),r=e(t)!=Sh}finally{t.display.shift=n,t.state.suppressEdits=!1}return r}let Ry=new wh;function Oy(t,e,i,n){let r=t.state.keySeq;if(r){if(Ty(e))return"handled";if(/\'$/.test(e)?t.state.keySeq=null:Ry.set(50,(()=>{t.state.keySeq==r&&(t.state.keySeq=null,t.display.input.reset())})),Fy(t,r+" "+e,i,n))return!0}return Fy(t,e,i,n)}function Fy(t,e,i,n){let r=function(t,e,i){for(let n=0;n<t.state.keyMaps.length;n++){let r=wy(e,t.state.keyMaps[n],i,t);if(r)return r}return t.options.extraKeys&&wy(e,t.options.extraKeys,i,t)||wy(e,t.options.keyMap,i,t)}(t,e,n);return"multi"==r&&(t.state.keySeq=e),"handled"==r&&Vd(t,"keyHandled",t,e,i),"handled"!=r&&"multi"!=r||(ip(i),nm(t)),!!r}function Ny(t,e){let i=Cy(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?Oy(t,"Shift-"+i,e,(e=>Dy(t,e,!0)))||Oy(t,i,e,(e=>{if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return Dy(t,e)})):Oy(t,i,e,(e=>Dy(t,e))))}let By=null;function jy(t){let e=this;if(t.target&&t.target!=e.display.input.getField())return;if(e.curOp.focus=mh(),Jh(e,t))return;Uu&&Vu<11&&27==t.keyCode&&(t.returnValue=!1);let i=t.keyCode;e.display.shift=16==i||t.shiftKey;let n=Ny(e,t);Hu&&(By=n?i:null,n||88!=i||mp||!(eh?t.metaKey:t.ctrlKey)||e.replaceSelection("",null,"cut")),Nu&&!eh&&!n&&46==i&&t.shiftKey&&!t.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=i||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||function(t){let e=t.display.lineDiv;function i(t){18!=t.keyCode&&t.altKey||(ch(e,"CodeMirror-crosshair"),Yh(document,"keyup",i),Yh(document,"mouseover",i))}gh(e,"CodeMirror-crosshair"),Hh(document,"keyup",i),Hh(document,"mouseover",i)}(e)}function $y(t){16==t.keyCode&&(this.doc.sel.shift=!1),Jh(this,t)}function Uy(t){let e=this;if(t.target&&t.target!=e.display.input.getField())return;if(rf(e.display,t)||Jh(e,t)||t.ctrlKey&&!t.altKey||eh&&t.metaKey)return;let i=t.keyCode,n=t.charCode;if(Hu&&i==By)return By=null,void ip(t);if(Hu&&(!t.which||t.which<10)&&Ny(e,t))return;let r=String.fromCharCode(null==n?i:n);"\b"!=r&&(function(t,e,i){return Oy(t,"'"+i+"'",e,(e=>Dy(t,e,!0)))}(e,t,r)||e.display.input.onKeyPress(t))}class Vy{constructor(t,e,i){this.time=t,this.pos=e,this.button=i}compare(t,e,i){return this.time+400>t&&0==Fp(e,this.pos)&&i==this.button}}let Gy,qy;function Zy(t){let e=this,i=e.display;if(Jh(e,t)||i.activeTouch&&i.input.supportsTouch())return;if(i.input.ensurePolled(),i.shift=t.shiftKey,rf(i,t))return void(Gu||(i.scroller.draggable=!1,setTimeout((()=>i.scroller.draggable=!0),100)));if(Xy(e,t))return;let n=qf(e,t),r=ap(t),o=n?function(t,e){let i=+new Date;return qy&&qy.compare(i,t,e)?(Gy=qy=null,"triple"):Gy&&Gy.compare(i,t,e)?(qy=new Vy(i,t,e),Gy=null,"double"):(Gy=new Vy(i,t,e),qy=null,"single")}(n,r):"single";window.focus(),1==r&&e.state.selectingText&&e.state.selectingText(t),n&&function(t,e,i,n,r){let o="Click";"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o);return o=(1==e?"Left":2==e?"Middle":"Right")+o,Oy(t,Sy(o,r),r,(e=>{if("string"==typeof e&&(e=Py[e]),!e)return!1;let n=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n=e(t,i)!=Sh}finally{t.state.suppressEdits=!1}return n}))}(e,r,n,o,t)||(1==r?n?function(t,e,i,n){Uu?setTimeout(vh(rm,t),0):t.curOp.focus=mh();let r,o=function(t,e,i){let n=t.getOption("configureMouse"),r=n?n(t,e,i):{};if(null==r.unit){let t=ih?i.shiftKey&&i.metaKey:i.altKey;r.unit=t?"rectangle":"single"==e?"char":"double"==e?"word":"line"}(null==r.extend||t.doc.extend)&&(r.extend=t.doc.extend||i.shiftKey);null==r.addNew&&(r.addNew=eh?i.metaKey:i.ctrlKey);null==r.moveOnDrag&&(r.moveOnDrag=!(eh?i.altKey:i.ctrlKey));return r}(t,i,n),s=t.doc.sel;t.options.dragDrop&&up&&!t.isReadOnly()&&"single"==i&&(r=s.contains(e))>-1&&(Fp((r=s.ranges[r]).from(),e)<0||e.xRel>0)&&(Fp(r.to(),e)>0||e.xRel<0)?function(t,e,i,n){let r=t.display,o=!1,s=Dm(t,(e=>{Gu&&(r.scroller.draggable=!1),t.state.draggingText=!1,t.state.delayingBlurEvent&&(t.hasFocus()?t.state.delayingBlurEvent=!1:om(t)),Yh(r.wrapper.ownerDocument,"mouseup",s),Yh(r.wrapper.ownerDocument,"mousemove",a),Yh(r.scroller,"dragstart",l),Yh(r.scroller,"drop",s),o||(ip(e),n.addNew||Mg(t.doc,i,null,null,n.extend),Gu&&!Xu||Uu&&9==Vu?setTimeout((()=>{r.wrapper.ownerDocument.body.focus({preventScroll:!0}),r.input.focus()}),20):r.input.focus())})),a=function(t){o=o||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},l=()=>o=!0;Gu&&(r.scroller.draggable=!0);t.state.draggingText=s,s.copy=!n.moveOnDrag,Hh(r.wrapper.ownerDocument,"mouseup",s),Hh(r.wrapper.ownerDocument,"mousemove",a),Hh(r.scroller,"dragstart",l),Hh(r.scroller,"drop",s),t.state.delayingBlurEvent=!0,setTimeout((()=>r.input.focus()),20),r.scroller.dragDrop&&r.scroller.dragDrop()}(t,n,e,o):function(t,e,i,n){Uu&&om(t);let r=t.display,o=t.doc;ip(e);let s,a,l=o.sel,c=l.ranges;n.addNew&&!n.extend?(a=o.sel.contains(i),s=a>-1?c[a]:new ng(i,i)):(s=o.sel.primary(),a=o.sel.primIndex);if("rectangle"==n.unit)n.addNew||(s=new ng(i,i)),i=qf(t,e,!0,!0),a=-1;else{let e=Wy(t,i,n.unit);s=n.extend?Ig(s,e.anchor,e.head,n.extend):e}n.addNew?-1==a?(a=c.length,zg(o,rg(t,c.concat([s]),a),{scroll:!1,origin:"*mouse"})):c.length>1&&c[a].empty()&&"char"==n.unit&&!n.extend?(zg(o,rg(t,c.slice(0,a).concat(c.slice(a+1)),0),{scroll:!1,origin:"*mouse"}),l=o.sel):kg(o,a,s,Eh):(a=0,zg(o,new ig([s],0),Eh),l=o.sel);let u=i;function h(e){if(0!=Fp(u,e))if(u=e,"rectangle"==n.unit){let n=[],r=t.options.tabSize,s=bh(Mp(o,i.line).text,i.ch,r),c=bh(Mp(o,e.line).text,e.ch,r),u=Math.min(s,c),h=Math.max(s,c);for(let s=Math.min(i.line,e.line),a=Math.min(t.lastLine(),Math.max(i.line,e.line));s<=a;s++){let t=Mp(o,s).text,e=Mh(t,u,r);u==h?n.push(new ng(Op(s,e),Op(s,e))):t.length>e&&n.push(new ng(Op(s,e),Op(s,Mh(t,h,r))))}n.length||n.push(new ng(i,i)),zg(o,rg(t,l.ranges.slice(0,a).concat(n),a),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{let i,r=s,c=Wy(t,e,n.unit),u=r.anchor;Fp(c.anchor,u)>0?(i=c.head,u=$p(r.from(),c.anchor)):(i=c.anchor,u=jp(r.to(),c.head));let h=l.ranges.slice(0);h[a]=function(t,e){let{anchor:i,head:n}=e,r=Mp(t.doc,i.line);if(0==Fp(i,n)&&i.sticky==n.sticky)return e;let o=Zh(r);if(!o)return e;let s=Gh(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return e;let l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return e;if(n.line!=i.line)l=(n.line-i.line)*("ltr"==t.doc.direction?1:-1)>0;else{let t=Gh(o,n.ch,n.sticky),e=t-s||(n.ch-i.ch)*(1==a.level?-1:1);l=t==c-1||t==c?e<0:e>0}let u=o[c+(l?-1:0)],h=l==(1==u.level),p=h?u.from:u.to,d=h?"after":"before";return i.ch==p&&i.sticky==d?e:new ng(new Op(i.line,p,d),n)}(t,new ng(Vp(o,u),i)),zg(o,rg(t,h,a),Eh)}}let p=r.wrapper.getBoundingClientRect(),d=0;function f(e){let i=++d,s=qf(t,e,!0,"rectangle"==n.unit);if(s)if(0!=Fp(s,u)){t.curOp.focus=mh(),h(s);let n=um(r,o);(s.line>=n.to||s.line<n.from)&&setTimeout(Dm(t,(()=>{d==i&&f(e)})),150)}else{let n=e.clientY<p.top?-20:e.clientY>p.bottom?20:0;n&&setTimeout(Dm(t,(()=>{d==i&&(r.scroller.scrollTop+=n,f(e))})),50)}}function m(e){t.state.selectingText=!1,d=1/0,e&&(ip(e),r.input.focus()),Yh(r.wrapper.ownerDocument,"mousemove",g),Yh(r.wrapper.ownerDocument,"mouseup",y),o.history.lastSelOrigin=null}let g=Dm(t,(t=>{0!==t.buttons&&ap(t)?f(t):m(t)})),y=Dm(t,m);t.state.selectingText=y,Hh(r.wrapper.ownerDocument,"mousemove",g),Hh(r.wrapper.ownerDocument,"mouseup",y)}(t,n,e,o)}(e,n,o,t):sp(t)==i.scroller&&ip(t):2==r?(n&&Mg(e.doc,n),setTimeout((()=>i.input.focus()),20)):3==r&&(sh?e.display.input.onContextMenu(t):om(e)))}function Wy(t,e,i){if("char"==i)return new ng(e,e);if("word"==i)return t.findWordAt(e);if("line"==i)return new ng(Op(e.line,0),Vp(t.doc,Op(e.line+1,0)));let n=i(t,e);return new ng(n.from,n.to)}function Hy(t,e,i,n){let r,o;if(e.touches)r=e.touches[0].clientX,o=e.touches[0].clientY;else try{r=e.clientX,o=e.clientY}catch(e){return!1}if(r>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;n&&ip(e);let s=t.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!tp(t,i))return rp(e);o-=a.top-s.viewOffset;for(let n=0;n<t.display.gutterSpecs.length;++n){let a=s.gutters.childNodes[n];if(a&&a.getBoundingClientRect().right>=r){return Kh(t,i,t,zp(t.doc,o),t.display.gutterSpecs[n].className,e),rp(e)}}}function Xy(t,e){return Hy(t,e,"gutterClick",!0)}function Yy(t,e){rf(t.display,e)||function(t,e){return!!tp(t,"gutterContextMenu")&&Hy(t,e,"gutterContextMenu",!1)}(t,e)||Jh(t,e,"contextmenu")||sh||t.display.input.onContextMenu(e)}function Ky(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),wf(t)}let Jy={toString:function(){return"CodeMirror.Init"}},Qy={},t_={};function e_(t,e,i){if(!e!=!(i&&i!=Jy)){let i=t.display.dragFunctions,n=e?Hh:Yh;n(t.display.scroller,"dragstart",i.start),n(t.display.scroller,"dragenter",i.enter),n(t.display.scroller,"dragover",i.over),n(t.display.scroller,"dragleave",i.leave),n(t.display.scroller,"drop",i.drop)}}function i_(t){t.options.lineWrapping?(gh(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(ch(t.display.wrapper,"CodeMirror-wrap"),Id(t)),Gf(t),Wf(t),wf(t),setTimeout((()=>bm(t)),100)}function n_(t,e){if(!(this instanceof n_))return new n_(t,e);this.options=e=e?xh(e):{},xh(Qy,e,!1);let i=e.value;"string"==typeof i?i=new uy(i,e.mode,null,e.lineSeparator,e.direction):e.mode&&(i.modeOption=e.mode),this.doc=i;let n=new n_.inputStyles[e.inputStyle](this),r=this.display=new Ym(t,i,n,e);r.wrapper.CodeMirror=this,Ky(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Sm(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new wh,keySeq:null,specialChars:null},e.autofocus&&!th&&r.input.focus(),Uu&&Vu<11&&setTimeout((()=>this.display.input.reset(!0)),20),function(t){let e=t.display;Hh(e.scroller,"mousedown",Dm(t,Zy)),Hh(e.scroller,"dblclick",Uu&&Vu<11?Dm(t,(e=>{if(Jh(t,e))return;let i=qf(t,e);if(!i||Xy(t,e)||rf(t.display,e))return;ip(e);let n=t.findWordAt(i);Mg(t.doc,n.anchor,n.head)})):e=>Jh(t,e)||ip(e));Hh(e.scroller,"contextmenu",(e=>Yy(t,e))),Hh(e.input.getField(),"contextmenu",(i=>{e.scroller.contains(i.target)||Yy(t,i)}));let i,n={end:0};function r(){e.activeTouch&&(i=setTimeout((()=>e.activeTouch=null),1e3),n=e.activeTouch,n.end=+new Date)}function o(t){if(1!=t.touches.length)return!1;let e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}function s(t,e){if(null==e.left)return!0;let i=e.left-t.left,n=e.top-t.top;return i*i+n*n>400}Hh(e.scroller,"touchstart",(r=>{if(!Jh(t,r)&&!o(r)&&!Xy(t,r)){e.input.ensurePolled(),clearTimeout(i);let t=+new Date;e.activeTouch={start:t,moved:!1,prev:t-n.end<=300?n:null},1==r.touches.length&&(e.activeTouch.left=r.touches[0].pageX,e.activeTouch.top=r.touches[0].pageY)}})),Hh(e.scroller,"touchmove",(()=>{e.activeTouch&&(e.activeTouch.moved=!0)})),Hh(e.scroller,"touchend",(i=>{let n=e.activeTouch;if(n&&!rf(e,i)&&null!=n.left&&!n.moved&&new Date-n.start<300){let r,o=t.coordsChar(e.activeTouch,"page");r=!n.prev||s(n,n.prev)?new ng(o,o):!n.prev.prev||s(n,n.prev.prev)?t.findWordAt(o):new ng(Op(o.line,0),Vp(t.doc,Op(o.line+1,0))),t.setSelection(r.anchor,r.head),t.focus(),ip(i)}r()})),Hh(e.scroller,"touchcancel",r),Hh(e.scroller,"scroll",(()=>{e.scroller.clientHeight&&(ym(t,e.scroller.scrollTop),vm(t,e.scroller.scrollLeft,!0),Kh(t,"scroll",t))})),Hh(e.scroller,"mousewheel",(e=>eg(t,e))),Hh(e.scroller,"DOMMouseScroll",(e=>eg(t,e))),Hh(e.wrapper,"scroll",(()=>e.wrapper.scrollTop=e.wrapper.scrollLeft=0)),e.dragFunctions={enter:e=>{Jh(t,e)||op(e)},over:e=>{Jh(t,e)||(!function(t,e){let i=qf(t,e);if(!i)return;let n=document.createDocumentFragment();tm(t,i,n),t.display.dragCursor||(t.display.dragCursor=ph("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),hh(t.display.dragCursor,n)}(t,e),op(e))},start:e=>function(t,e){if(Uu&&(!t.state.draggingText||+new Date-hy<100))op(e);else if(!Jh(t,e)&&!rf(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!Xu)){let i=ph("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Hu&&(i.width=i.height=1,t.display.wrapper.appendChild(i),i._top=i.offsetTop),e.dataTransfer.setDragImage(i,0,0),Hu&&i.parentNode.removeChild(i)}}(t,e),drop:Dm(t,py),leave:e=>{Jh(t,e)||dy(t)}};let a=e.input.getField();Hh(a,"keyup",(e=>$y.call(t,e))),Hh(a,"keydown",Dm(t,jy)),Hh(a,"keypress",Dm(t,Uy)),Hh(a,"focus",(e=>sm(t,e))),Hh(a,"blur",(e=>am(t,e)))}(this),gy(),Em(this),this.curOp.forceUpdate=!0,mg(this,i),e.autofocus&&!th||this.hasFocus()?setTimeout((()=>{this.hasFocus()&&!this.state.focused&&sm(this)}),20):am(this);for(let t in t_)t_.hasOwnProperty(t)&&t_[t](this,e[t],Jy);Zm(this),e.finishInit&&e.finishInit(this);for(let t=0;t<r_.length;++t)r_[t](this);Im(this),Gu&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(r.lineDiv).textRendering&&(r.lineDiv.style.textRendering="auto")}n_.defaults=Qy,n_.optionHandlers=t_;let r_=[];function o_(t,e,i,n){let r,o=t.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=Xp(t,e).state:i="prev");let s=t.options.tabSize,a=Mp(o,e),l=bh(a.text,null,s);a.stateAfter&&(a.stateAfter=null);let c,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&(c=o.mode.indent(r,a.text.slice(u.length),a.text),c==Sh||c>150)){if(!n)return;i="prev"}}else c=0,i="not";"prev"==i?c=e>o.first?bh(Mp(o,e-1).text,null,s):0:"add"==i?c=l+t.options.indentUnit:"subtract"==i?c=l-t.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);let h="",p=0;if(t.options.indentWithTabs)for(let t=Math.floor(c/s);t;--t)p+=s,h+="\t";if(p<c&&(h+=kh(c-p)),h!=u)return Hg(o,h,Op(e,0),Op(e,u.length),"+input"),a.stateAfter=null,!0;for(let t=0;t<o.sel.ranges.length;t++){let i=o.sel.ranges[t];if(i.head.line==e&&i.head.ch<u.length){let i=Op(e,u.length);kg(o,t,new ng(i,i));break}}}n_.defineInitHook=t=>r_.push(t);let s_=null;function a_(t){s_=t}function l_(t,e,i,n,r){let o=t.doc;t.display.shift=!1,n||(n=o.sel);let s=+new Date-200,a="paste"==r||t.state.pasteIncoming>s,l=dp(e),c=null;if(a&&n.ranges.length>1)if(s_&&s_.text.join("\n")==e){if(n.ranges.length%s_.text.length==0){c=[];for(let t=0;t<s_.text.length;t++)c.push(o.splitLines(s_.text[t]))}}else l.length==n.ranges.length&&t.options.pasteLinesPerSelection&&(c=Lh(l,(t=>[t])));let u=t.curOp.updateInput;for(let e=n.ranges.length-1;e>=0;e--){let u=n.ranges[e],h=u.from(),p=u.to();u.empty()&&(i&&i>0?h=Op(h.line,h.ch-i):t.state.overwrite&&!a?p=Op(p.line,Math.min(Mp(o,p.line).text.length,p.ch+Ph(l).length)):a&&s_&&s_.lineWise&&s_.text.join("\n")==l.join("\n")&&(h=p=Op(h.line,0)));let d={from:h,to:p,text:c?c[e%c.length]:l,origin:r||(a?"paste":t.state.cutIncoming>s?"cut":"+input")};Vg(t.doc,d),Vd(t,"inputRead",t,d)}e&&!a&&u_(t,e),dm(t),t.curOp.updateInput<2&&(t.curOp.updateInput=u),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function c_(t,e){let i=t.clipboardData&&t.clipboardData.getData("Text");if(i)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||!e.hasFocus()||zm(e,(()=>l_(e,i,0,null,"paste"))),!0}function u_(t,e){if(!t.options.electricChars||!t.options.smartIndent)return;let i=t.doc.sel;for(let n=i.ranges.length-1;n>=0;n--){let r=i.ranges[n];if(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)continue;let o=t.getModeAt(r.head),s=!1;if(o.electricChars){for(let i=0;i<o.electricChars.length;i++)if(e.indexOf(o.electricChars.charAt(i))>-1){s=o_(t,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Mp(t.doc,r.head.line).text.slice(0,r.head.ch))&&(s=o_(t,r.head.line,"smart"));s&&Vd(t,"electricInput",t,r.head.line)}}function h_(t){let e=[],i=[];for(let n=0;n<t.doc.sel.ranges.length;n++){let r=t.doc.sel.ranges[n].head.line,o={anchor:Op(r,0),head:Op(r+1,0)};i.push(o),e.push(t.getRange(o.anchor,o.head))}return{text:e,ranges:i}}function p_(t,e,i,n){t.setAttribute("autocorrect",i?"":"off"),t.setAttribute("autocapitalize",n?"":"off"),t.setAttribute("spellcheck",!!e)}function d_(){let t=ph("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),e=ph("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return Gu?t.style.width="1000px":t.setAttribute("wrap","off"),Ju&&(t.style.border="1px solid black"),p_(t),e}function f_(t,e,i,n,r){let o=e,s=i,a=Mp(t,e.line),l=r&&"rtl"==t.direction?-i:i;function c(o){let s;if("codepoint"==n){let t=a.text.charCodeAt(e.ch+(i>0?0:-1));if(isNaN(t))s=null;else{let n=i>0?t>=55296&&t<56320:t>=56320&&t<57343;s=new Op(e.line,Math.max(0,Math.min(a.text.length,e.ch+i*(n?2:1))),-i)}}else s=r?function(t,e,i,n){let r=Zh(e,t.doc.direction);if(!r)return Ay(e,i,n);i.ch>=e.text.length?(i.ch=e.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");let o=Gh(r,i.ch,i.sticky),s=r[o];if("ltr"==t.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Ay(e,i,n);let a,l=(t,i)=>My(e,t instanceof Op?t.ch:t,i),c=i=>t.options.lineWrapping?(a=a||ff(t,e),Df(t,e,a,i)):{begin:0,end:e.text.length},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==t.doc.direction||1==s.level){let t=1==s.level==n<0,e=l(i,t?1:-1);if(null!=e&&(t?e<=s.to&&e<=u.end:e>=s.from&&e>=u.begin)){let n=t?"before":"after";return new Op(i.line,e,n)}}let h=(t,e,n)=>{let o=(t,e)=>e?new Op(i.line,l(t,1),"before"):new Op(i.line,t,"after");for(;t>=0&&t<r.length;t+=e){let i=r[t],s=e>0==(1!=i.level),a=s?n.begin:l(n.end,-1);if(i.from<=a&&a<i.to)return o(a,s);if(a=s?i.from:l(i.to,-1),n.begin<=a&&a<n.end)return o(a,s)}},p=h(o+n,n,u);if(p)return p;let d=n>0?u.end:l(u.begin,-1);return null==d||n>0&&d==e.text.length||(p=h(n>0?0:r.length-1,n,c(d)),!p)?null:p}(t.cm,a,e,i):Ay(a,e,i);if(null==s){if(o||!function(){let i=e.line+l;return!(i<t.first||i>=t.first+t.size)&&(e=new Op(i,e.ch,e.sticky),a=Mp(t,i))}())return!1;e=ky(r,t.cm,a,e.line,l)}else e=s;return!0}if("char"==n||"codepoint"==n)c();else if("column"==n)c(!0);else if("word"==n||"group"==n){let r=null,o="group"==n,s=t.cm&&t.cm.getHelper(e,"wordChars");for(let t=!0;!(i<0)||c(!t);t=!1){let n=a.text.charAt(e.ch)||"\n",l=Fh(n,s)?"w":o&&"\n"==n?"n":!o||/\s/.test(n)?null:"p";if(!o||t||l||(l="s"),r&&r!=l){i<0&&(i=1,c(),e.sticky="after");break}if(l&&(r=l),i>0&&!c(!t))break}}let u=Bg(t,e,o,s,!0);return Np(o,u)&&(u.hitSide=!0),u}function m_(t,e,i,n){let r,o,s=t.doc,a=e.left;if("page"==n){let n=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),o=Math.max(n-.5*Bf(t.display),3);r=(i>0?e.bottom:e.top)+i*o}else"line"==n&&(r=i>0?e.bottom+3:e.top-3);for(;o=Lf(t,a,r),o.outside;){if(i<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*i}return o}class g_{constructor(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new wh,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null}init(t){let e=this,i=e.cm,n=e.div=t.lineDiv;function r(t){for(let e=t.target;e;e=e.parentNode){if(e==n)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(e.className))break}return!1}function o(t){if(!r(t)||Jh(i,t))return;if(i.somethingSelected())a_({lineWise:!1,text:i.getSelections()}),"cut"==t.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;{let e=h_(i);a_({lineWise:!0,text:e.text}),"cut"==t.type&&i.operation((()=>{i.setSelections(e.ranges,0,Ch),i.replaceSelection("",null,"cut")}))}}if(t.clipboardData){t.clipboardData.clearData();let e=s_.text.join("\n");if(t.clipboardData.setData("Text",e),t.clipboardData.getData("Text")==e)return void t.preventDefault()}let o=d_(),s=o.firstChild;i.display.lineSpace.insertBefore(o,i.display.lineSpace.firstChild),s.value=s_.text.join("\n");let a=mh();_h(s),setTimeout((()=>{i.display.lineSpace.removeChild(o),a.focus(),a==n&&e.showPrimarySelection()}),50)}n.contentEditable=!0,p_(n,i.options.spellcheck,i.options.autocorrect,i.options.autocapitalize),Hh(n,"paste",(t=>{!r(t)||Jh(i,t)||c_(t,i)||Vu<=11&&setTimeout(Dm(i,(()=>this.updateFromDOM())),20)})),Hh(n,"compositionstart",(t=>{this.composing={data:t.data,done:!1}})),Hh(n,"compositionupdate",(t=>{this.composing||(this.composing={data:t.data,done:!1})})),Hh(n,"compositionend",(t=>{this.composing&&(t.data!=this.composing.data&&this.readFromDOMSoon(),this.composing.done=!0)})),Hh(n,"touchstart",(()=>e.forceCompositionEnd())),Hh(n,"input",(()=>{this.composing||this.readFromDOMSoon()})),Hh(n,"copy",o),Hh(n,"cut",o)}screenReaderLabelChanged(t){t?this.div.setAttribute("aria-label",t):this.div.removeAttribute("aria-label")}prepareSelection(){let t=Qf(this.cm,!1);return t.focus=mh()==this.div,t}showSelection(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))}getSelection(){return this.cm.display.wrapper.ownerDocument.getSelection()}showPrimarySelection(){let t=this.getSelection(),e=this.cm,i=e.doc.sel.primary(),n=i.from(),r=i.to();if(e.display.viewTo==e.display.viewFrom||n.line>=e.display.viewTo||r.line<e.display.viewFrom)return void t.removeAllRanges();let o=v_(e,t.anchorNode,t.anchorOffset),s=v_(e,t.focusNode,t.focusOffset);if(o&&!o.bad&&s&&!s.bad&&0==Fp($p(o,s),n)&&0==Fp(jp(o,s),r))return;let a=e.display.view,l=n.line>=e.display.viewFrom&&y_(e,n)||{node:a[0].measure.map[2],offset:0},c=r.line<e.display.viewTo&&y_(e,r);if(!c){let t=a[a.length-1].measure,e=t.maps?t.maps[t.maps.length-1]:t.map;c={node:e[e.length-1],offset:e[e.length-2]-e[e.length-3]}}if(!l||!c)return void t.removeAllRanges();let u,h=t.rangeCount&&t.getRangeAt(0);try{u=lh(l.node,l.offset,c.offset,c.node)}catch(t){}u&&(!Nu&&e.state.focused?(t.collapse(l.node,l.offset),u.collapsed||(t.removeAllRanges(),t.addRange(u))):(t.removeAllRanges(),t.addRange(u)),h&&null==t.anchorNode?t.addRange(h):Nu&&this.startGracePeriod()),this.rememberSelection()}startGracePeriod(){clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((()=>{this.gracePeriod=!1,this.selectionChanged()&&this.cm.operation((()=>this.cm.curOp.selectionChanged=!0))}),20)}showMultipleSelections(t){hh(this.cm.display.cursorDiv,t.cursors),hh(this.cm.display.selectionDiv,t.selection)}rememberSelection(){let t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset}selectionInEditor(){let t=this.getSelection();if(!t.rangeCount)return!1;let e=t.getRangeAt(0).commonAncestorContainer;return fh(this.div,e)}focus(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&mh()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())}blur(){this.div.blur()}getField(){return this.div}supportsTouch(){return!0}receivedFocus(){let t=this;this.selectionInEditor()?setTimeout((()=>this.pollSelection()),20):zm(this.cm,(()=>t.cm.curOp.selectionChanged=!0)),this.polling.set(this.cm.options.pollInterval,(function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}))}selectionChanged(){let t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset}pollSelection(){if(null!=this.readDOMTimeout||this.gracePeriod||!this.selectionChanged())return;let t=this.getSelection(),e=this.cm;if(Qu&&Zu&&this.cm.display.gutterSpecs.length&&function(t){for(let e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(this.composing)return;this.rememberSelection();let i=v_(e,t.anchorNode,t.anchorOffset),n=v_(e,t.focusNode,t.focusOffset);i&&n&&zm(e,(()=>{zg(e.doc,og(i,n),Ch),(i.bad||n.bad)&&(e.curOp.selectionChanged=!0)}))}pollContent(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);let t,e,i,n=this.cm,r=n.display,o=n.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>n.firstLine()&&(s=Op(s.line-1,Mp(n.doc,s.line-1).length)),a.ch==Mp(n.doc,a.line).text.length&&a.line<n.lastLine()&&(a=Op(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(t=Zf(n,s.line))?(e=Lp(r.view[0].line),i=r.view[0].node):(e=Lp(r.view[t].line),i=r.view[t-1].node.nextSibling);let l,c,u=Zf(n,a.line);if(u==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=Lp(r.view[u+1].line)-1,c=r.view[u+1].node.previousSibling),!i)return!1;let h=n.doc.splitLines(function(t,e,i,n,r){let o="",s=!1,a=t.doc.lineSeparator(),l=!1;function c(t){return e=>e.id==t}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(t){t&&(u(),o+=t)}function p(e){if(1==e.nodeType){let i=e.getAttribute("cm-text");if(i)return void h(i);let o,d=e.getAttribute("cm-marker");if(d){let e=t.findMarks(Op(n,0),Op(r+1,0),c(+d));return void(e.length&&(o=e[0].find(0))&&h(Ap(t.doc,o.from,o.to).join(a)))}if("false"==e.getAttribute("contenteditable"))return;let f=/^(pre|div|p|li|table|br)$/i.test(e.nodeName);if(!/^br$/i.test(e.nodeName)&&0==e.textContent.length)return;f&&u();for(let t=0;t<e.childNodes.length;t++)p(e.childNodes[t]);/^(pre|p)$/i.test(e.nodeName)&&(l=!0),f&&(s=!0)}else 3==e.nodeType&&h(e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;p(e),e!=i;)e=e.nextSibling,l=!1;return o}(n,i,c,e,l)),p=Ap(n.doc,Op(e,0),Op(l,Mp(n.doc,l).text.length));for(;h.length>1&&p.length>1;)if(Ph(h)==Ph(p))h.pop(),p.pop(),l--;else{if(h[0]!=p[0])break;h.shift(),p.shift(),e++}let d=0,f=0,m=h[0],g=p[0],y=Math.min(m.length,g.length);for(;d<y&&m.charCodeAt(d)==g.charCodeAt(d);)++d;let _=Ph(h),v=Ph(p),x=Math.min(_.length-(1==h.length?d:0),v.length-(1==p.length?d:0));for(;f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==p.length&&e==s.line)for(;d&&d>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)d--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(d).replace(/\u200b+$/,"");let b=Op(e,d),w=Op(l,p.length?Ph(p).length-f:0);return h.length>1||h[0]||Fp(b,w)?(Hg(n.doc,h,b,w,"+input"),!0):void 0}ensurePolled(){this.forceCompositionEnd()}reset(){this.forceCompositionEnd()}forceCompositionEnd(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())}readFromDOMSoon(){null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((()=>{if(this.readDOMTimeout=null,this.composing){if(!this.composing.done)return;this.composing=null}this.updateFromDOM()}),80))}updateFromDOM(){!this.cm.isReadOnly()&&this.pollContent()||zm(this.cm,(()=>Wf(this.cm)))}setUneditable(t){t.contentEditable="false"}onKeyPress(t){0==t.charCode||this.composing||(t.preventDefault(),this.cm.isReadOnly()||Dm(this.cm,l_)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))}readOnlyChanged(t){this.div.contentEditable=String("nocursor"!=t)}onContextMenu(){}resetPosition(){}}function y_(t,e){let i=df(t,e.line);if(!i||i.hidden)return null;let n=Mp(t.doc,e.line),r=hf(i,n,e.line),o=Zh(n,t.doc.direction),s="left";if(o){s=Gh(o,e.ch)%2?"right":"left"}let a=_f(r.map,e.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function __(t,e){return e&&(t.bad=!0),t}function v_(t,e,i){let n;if(e==t.display.lineDiv){if(n=t.display.lineDiv.childNodes[i],!n)return __(t.clipPos(Op(t.display.viewTo-1)),!0);e=null,i=0}else for(n=e;;n=n.parentNode){if(!n||n==t.display.lineDiv)return null;if(n.parentNode&&n.parentNode==t.display.lineDiv)break}for(let r=0;r<t.display.view.length;r++){let o=t.display.view[r];if(o.node==n)return x_(o,e,i)}}function x_(t,e,i){let n=t.text.firstChild,r=!1;if(!e||!fh(n,e))return __(Op(Lp(t.line),0),!0);if(e==n&&(r=!0,e=n.childNodes[i],i=0,!e)){let e=t.rest?Ph(t.rest):t.line;return __(Op(Lp(e),e.text.length),r)}let o=3==e.nodeType?e:null,s=e;for(o||1!=e.childNodes.length||3!=e.firstChild.nodeType||(o=e.firstChild,i&&(i=o.nodeValue.length));s.parentNode!=n;)s=s.parentNode;let a=t.measure,l=a.maps;function c(e,i,n){for(let r=-1;r<(l?l.length:0);r++){let o=r<0?a.map:l[r];for(let s=0;s<o.length;s+=3){let a=o[s+2];if(a==e||a==i){let i=Lp(r<0?t.line:t.rest[r]),l=o[s]+n;return(n<0||a!=e)&&(l=o[s+(n?1:0)]),Op(i,l)}}}}let u=c(o,s,i);if(u)return __(u,r);for(let t=s.nextSibling,e=o?o.nodeValue.length-i:0;t;t=t.nextSibling){if(u=c(t,t.firstChild,0),u)return __(Op(u.line,u.ch-e),r);e+=t.textContent.length}for(let t=s.previousSibling,e=i;t;t=t.previousSibling){if(u=c(t,t.firstChild,-1),u)return __(Op(u.line,u.ch+e),r);e+=t.textContent.length}}g_.prototype.needsContentAttribute=!0;class b_{constructor(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new wh,this.hasSelection=!1,this.composing=null}init(t){let e=this,i=this.cm;this.createField(t);const n=this.textarea;function r(t){if(!Jh(i,t)){if(i.somethingSelected())a_({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;{let r=h_(i);a_({lineWise:!0,text:r.text}),"cut"==t.type?i.setSelections(r.ranges,null,Ch):(e.prevInput="",n.value=r.text.join("\n"),_h(n))}}"cut"==t.type&&(i.state.cutIncoming=+new Date)}}t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),Ju&&(n.style.width="0px"),Hh(n,"input",(()=>{Uu&&Vu>=9&&this.hasSelection&&(this.hasSelection=null),e.poll()})),Hh(n,"paste",(t=>{Jh(i,t)||c_(t,i)||(i.state.pasteIncoming=+new Date,e.fastPoll())})),Hh(n,"cut",r),Hh(n,"copy",r),Hh(t.scroller,"paste",(r=>{if(rf(t,r)||Jh(i,r))return;if(!n.dispatchEvent)return i.state.pasteIncoming=+new Date,void e.focus();const o=new Event("paste");o.clipboardData=r.clipboardData,n.dispatchEvent(o)})),Hh(t.lineSpace,"selectstart",(e=>{rf(t,e)||ip(e)})),Hh(n,"compositionstart",(()=>{let t=i.getCursor("from");e.composing&&e.composing.range.clear(),e.composing={start:t,range:i.markText(t,i.getCursor("to"),{className:"CodeMirror-composing"})}})),Hh(n,"compositionend",(()=>{e.composing&&(e.poll(),e.composing.range.clear(),e.composing=null)}))}createField(t){this.wrapper=d_(),this.textarea=this.wrapper.firstChild}screenReaderLabelChanged(t){t?this.textarea.setAttribute("aria-label",t):this.textarea.removeAttribute("aria-label")}prepareSelection(){let t=this.cm,e=t.display,i=t.doc,n=Qf(t);if(t.options.moveInputWithCursor){let r=Af(t,i.sel.primary().head,"div"),o=e.wrapper.getBoundingClientRect(),s=e.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,r.left+s.left-o.left))}return n}showSelection(t){let e=this.cm.display;hh(e.cursorDiv,t.cursors),hh(e.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")}reset(t){if(this.contextMenuPending||this.composing)return;let e=this.cm;if(e.somethingSelected()){this.prevInput="";let t=e.getSelection();this.textarea.value=t,e.state.focused&&_h(this.textarea),Uu&&Vu>=9&&(this.hasSelection=t)}else t||(this.prevInput=this.textarea.value="",Uu&&Vu>=9&&(this.hasSelection=null))}getField(){return this.textarea}supportsTouch(){return!1}focus(){if("nocursor"!=this.cm.options.readOnly&&(!th||mh()!=this.textarea))try{this.textarea.focus()}catch(t){}}blur(){this.textarea.blur()}resetPosition(){this.wrapper.style.top=this.wrapper.style.left=0}receivedFocus(){this.slowPoll()}slowPoll(){this.pollingFast||this.polling.set(this.cm.options.pollInterval,(()=>{this.poll(),this.cm.state.focused&&this.slowPoll()}))}fastPoll(){let t=!1,e=this;e.pollingFast=!0,e.polling.set(20,(function i(){e.poll()||t?(e.pollingFast=!1,e.slowPoll()):(t=!0,e.polling.set(60,i))}))}poll(){let t=this.cm,e=this.textarea,i=this.prevInput;if(this.contextMenuPending||!t.state.focused||fp(e)&&!i&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;let n=e.value;if(n==i&&!t.somethingSelected())return!1;if(Uu&&Vu>=9&&this.hasSelection===n||eh&&/[\uf700-\uf7ff]/.test(n))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){let t=n.charCodeAt(0);if(8203!=t||i||(i="​"),8666==t)return this.reset(),this.cm.execCommand("undo")}let r=0,o=Math.min(i.length,n.length);for(;r<o&&i.charCodeAt(r)==n.charCodeAt(r);)++r;return zm(t,(()=>{l_(t,n.slice(r),i.length-r,null,this.composing?"*compose":null),n.length>1e3||n.indexOf("\n")>-1?e.value=this.prevInput="":this.prevInput=n,this.composing&&(this.composing.range.clear(),this.composing.range=t.markText(this.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))})),!0}ensurePolled(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)}onKeyPress(){Uu&&Vu>=9&&(this.hasSelection=null),this.fastPoll()}onContextMenu(t){let e=this,i=e.cm,n=i.display,r=e.textarea;e.contextMenuPending&&e.contextMenuPending();let o=qf(i,t),s=n.scroller.scrollTop;if(!o||Hu)return;i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&Dm(i,zg)(i.doc,og(o),Ch);let a,l=r.style.cssText,c=e.wrapper.style.cssText,u=e.wrapper.offsetParent.getBoundingClientRect();function h(){if(null!=r.selectionStart){let t=i.somethingSelected(),o="​"+(t?r.value:"");r.value="⇚",r.value=o,e.prevInput=t?"":"​",r.selectionStart=1,r.selectionEnd=o.length,n.selForContextMenu=i.doc.sel}}function p(){if(e.contextMenuPending==p&&(e.contextMenuPending=!1,e.wrapper.style.cssText=c,r.style.cssText=l,Uu&&Vu<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=s),null!=r.selectionStart)){(!Uu||Uu&&Vu<9)&&h();let t=0,o=()=>{n.selForContextMenu==i.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&"​"==e.prevInput?Dm(i,$g)(i):t++<10?n.detectingSelectAll=setTimeout(o,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(o,200)}}if(e.wrapper.style.cssText="position: static",r.style.cssText=`position: absolute; width: 30px; height: 30px;\n      top: ${t.clientY-u.top-5}px; left: ${t.clientX-u.left-5}px;\n      z-index: 1000; background: ${Uu?"rgba(255, 255, 255, .05)":"transparent"};\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`,Gu&&(a=window.scrollY),n.input.focus(),Gu&&window.scrollTo(null,a),n.input.reset(),i.somethingSelected()||(r.value=e.prevInput=" "),e.contextMenuPending=p,n.selForContextMenu=i.doc.sel,clearTimeout(n.detectingSelectAll),Uu&&Vu>=9&&h(),sh){op(t);let e=()=>{Yh(window,"mouseup",e),setTimeout(p,20)};Hh(window,"mouseup",e)}else setTimeout(p,50)}readOnlyChanged(t){t||this.reset(),this.textarea.disabled="nocursor"==t,this.textarea.readOnly=!!t}setUneditable(){}}b_.prototype.needsContentAttribute=!1,function(t){let e=t.optionHandlers;function i(i,n,r,o){t.defaults[i]=n,r&&(e[i]=o?(t,e,i)=>{i!=Jy&&r(t,e,i)}:r)}t.defineOption=i,t.Init=Jy,i("value","",((t,e)=>t.setValue(e)),!0),i("mode",null,((t,e)=>{t.doc.modeOption=e,ug(t)}),!0),i("indentUnit",2,ug,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(t=>{hg(t),wf(t),Wf(t)}),!0),i("lineSeparator",null,((t,e)=>{if(t.doc.lineSep=e,!e)return;let i=[],n=t.doc.first;t.doc.iter((t=>{for(let r=0;;){let o=t.text.indexOf(e,r);if(-1==o)break;r=o+e.length,i.push(Op(n,o))}n++}));for(let n=i.length-1;n>=0;n--)Hg(t.doc,e,i[n],Op(i[n].line,i[n].ch+e.length))})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,((t,e,i)=>{t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),i!=Jy&&t.refresh()})),i("specialCharPlaceholder",Dd,(t=>t.refresh()),!0),i("electricChars",!0),i("inputStyle",th?"contenteditable":"textarea",(()=>{throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,((t,e)=>t.getInputField().spellcheck=e),!0),i("autocorrect",!1,((t,e)=>t.getInputField().autocorrect=e),!0),i("autocapitalize",!1,((t,e)=>t.getInputField().autocapitalize=e),!0),i("rtlMoveVisually",!nh),i("wholeLineUpdateBefore",!0),i("theme","default",(t=>{Ky(t),Xm(t)}),!0),i("keyMap","default",((t,e,i)=>{let n=Ey(e),r=i!=Jy&&Ey(i);r&&r.detach&&r.detach(t,n),n.attach&&n.attach(t,r||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,i_,!0),i("gutters",[],((t,e)=>{t.display.gutterSpecs=Wm(e,t.options.lineNumbers),Xm(t)}),!0),i("fixedGutter",!0,((t,e)=>{t.display.gutters.style.left=e?Uf(t.display)+"px":"0",t.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(t=>bm(t)),!0),i("scrollbarStyle","native",(t=>{Sm(t),bm(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)}),!0),i("lineNumbers",!1,((t,e)=>{t.display.gutterSpecs=Wm(t.options.gutters,e),Xm(t)}),!0),i("firstLineNumber",1,Xm,!0),i("lineNumberFormatter",(t=>t),Xm,!0),i("showCursorWhenSelecting",!1,Jf,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,((t,e)=>{"nocursor"==e&&(am(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)})),i("screenReaderLabel",null,((t,e)=>{e=""===e?null:e,t.display.input.screenReaderLabelChanged(e)})),i("disableInput",!1,((t,e)=>{e||t.display.input.reset()}),!0),i("dragDrop",!0,e_),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,Jf,!0),i("singleCursorHeightPerLine",!0,Jf,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,hg,!0),i("addModeClass",!1,hg,!0),i("pollInterval",100),i("undoDepth",200,((t,e)=>t.doc.history.undoDepth=e)),i("historyEventDelay",1250),i("viewportMargin",10,(t=>t.refresh()),!0),i("maxHighlightLength",1e4,hg,!0),i("moveInputWithCursor",!0,((t,e)=>{e||t.display.input.resetPosition()})),i("tabindex",null,((t,e)=>t.display.input.getField().tabIndex=e||"")),i("autofocus",null),i("direction","ltr",((t,e)=>t.doc.setDirection(e)),!0),i("phrases",null)}(n_),function(t){let e=t.optionHandlers,i=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,i){let n=this.options,r=n[t];n[t]==i&&"mode"!=t||(n[t]=i,e.hasOwnProperty(t)&&Dm(this,e[t])(this,i,r),Kh(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](Ey(t))},removeKeyMap:function(t){let e=this.state.keyMaps;for(let i=0;i<e.length;++i)if(e[i]==t||e[i].name==t)return e.splice(i,1),!0},addOverlay:Rm((function(e,i){let n=e.token?e:t.getMode(this.options,e);if(n.startState)throw new Error("Overlays may not be stateful.");!function(t,e,i){let n=0,r=i(e);for(;n<t.length&&i(t[n])<=r;)n++;t.splice(n,0,e)}(this.state.overlays,{mode:n,modeSpec:e,opaque:i&&i.opaque,priority:i&&i.priority||0},(t=>t.priority)),this.state.modeGen++,Wf(this)})),removeOverlay:Rm((function(t){let e=this.state.overlays;for(let i=0;i<e.length;++i){let n=e[i].modeSpec;if(n==t||"string"==typeof t&&n.name==t)return e.splice(i,1),this.state.modeGen++,void Wf(this)}})),indentLine:Rm((function(t,e,i){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Dp(this.doc,t)&&o_(this,t,e,i)})),indentSelection:Rm((function(t){let e=this.doc.sel.ranges,i=-1;for(let n=0;n<e.length;n++){let r=e[n];if(r.empty())r.head.line>i&&(o_(this,r.head.line,t,!0),i=r.head.line,n==this.doc.sel.primIndex&&dm(this));else{let o=r.from(),s=r.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(let e=a;e<i;++e)o_(this,e,t);let l=this.doc.sel.ranges;0==o.ch&&e.length==l.length&&l[n].from().ch>0&&kg(this.doc,n,new ng(o,l[n].to()),Ch)}}})),getTokenAt:function(t,e){return td(this,t,e)},getLineTokens:function(t,e){return td(this,Op(t),e,!0)},getTokenTypeAt:function(t){t=Vp(this.doc,t);let e,i=Hp(this,Mp(this.doc,t.line)),n=0,r=(i.length-1)/2,o=t.ch;if(0==o)e=i[2];else for(;;){let t=n+r>>1;if((t?i[2*t-1]:0)>=o)r=t;else{if(!(i[2*t+1]<o)){e=i[2*t+2];break}n=t+1}}let s=e?e.indexOf("overlay "):-1;return s<0?e:0==s?null:e.slice(0,s-1)},getModeAt:function(e){let i=this.doc.mode;return i.innerMode?t.innerMode(i,this.getTokenAt(e).state).mode:i},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){let n=[];if(!i.hasOwnProperty(e))return n;let r=i[e],o=this.getModeAt(t);if("string"==typeof o[e])r[o[e]]&&n.push(r[o[e]]);else if(o[e])for(let t=0;t<o[e].length;t++){let i=r[o[e][t]];i&&n.push(i)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(let t=0;t<r._global.length;t++){let e=r._global[t];e.pred(o,this)&&-1==Th(n,e.val)&&n.push(e.val)}return n},getStateAfter:function(t,e){let i=this.doc;return Xp(this,(t=Up(i,null==t?i.first+i.size-1:t))+1,e).state},cursorCoords:function(t,e){let i,n=this.doc.sel.primary();return i=null==t?n.head:"object"==typeof t?Vp(this.doc,t):t?n.from():n.to(),Af(this,i,e||"page")},charCoords:function(t,e){return Mf(this,Vp(this.doc,t),e||"page")},coordsChar:function(t,e){return Lf(this,(t=If(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=If(this,{top:t,left:0},e||"page").top,zp(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,i){let n,r=!1;if("number"==typeof t){let e=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>e&&(t=e,r=!0),n=Mp(this.doc,t)}else n=t;return Ef(this,n,{top:0,left:0},e||"page",i||r).top+(r?this.doc.height-Cd(n):0)},defaultTextHeight:function(){return Bf(this.display)},defaultCharWidth:function(){return jf(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,i,n,r){let o=this.display,s=(t=Af(this,Vp(this.doc,t))).bottom,a=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),o.sizer.appendChild(e),"over"==n)s=t.top;else if("above"==n||"near"==n){let i=Math.max(o.wrapper.clientHeight,this.doc.height),r=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||t.bottom+e.offsetHeight>i)&&t.top>e.offsetHeight?s=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=i&&(s=t.bottom),a+e.offsetWidth>r&&(a=r-e.offsetWidth)}e.style.top=s+"px",e.style.left=e.style.right="","right"==r?(a=o.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-e.offsetWidth)/2),e.style.left=a+"px"),i&&function(t,e){let i=hm(t,e);null!=i.scrollTop&&ym(t,i.scrollTop),null!=i.scrollLeft&&vm(t,i.scrollLeft)}(this,{left:a,top:s,right:a+e.offsetWidth,bottom:s+e.offsetHeight})},triggerOnKeyDown:Rm(jy),triggerOnKeyPress:Rm(Uy),triggerOnKeyUp:$y,triggerOnMouseDown:Rm(Zy),execCommand:function(t){if(Py.hasOwnProperty(t))return Py[t].call(null,this)},triggerElectric:Rm((function(t){u_(this,t)})),findPosH:function(t,e,i,n){let r=1;e<0&&(r=-1,e=-e);let o=Vp(this.doc,t);for(let t=0;t<e&&(o=f_(this.doc,o,r,i,n),!o.hitSide);++t);return o},moveH:Rm((function(t,e){this.extendSelectionsBy((i=>this.display.shift||this.doc.extend||i.empty()?f_(this.doc,i.head,t,e,this.options.rtlMoveVisually):t<0?i.from():i.to()),Ih)})),deleteH:Rm((function(t,e){let i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):Iy(this,(i=>{let r=f_(n,i.head,t,e,!1);return t<0?{from:r,to:i.head}:{from:i.head,to:r}}))})),findPosV:function(t,e,i,n){let r=1,o=n;e<0&&(r=-1,e=-e);let s=Vp(this.doc,t);for(let t=0;t<e;++t){let t=Af(this,s,"div");if(null==o?o=t.left:t.left=o,s=m_(this,t,r,i),s.hitSide)break}return s},moveV:Rm((function(t,e){let i=this.doc,n=[],r=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy((o=>{if(r)return t<0?o.from():o.to();let s=Af(this,o.head,"div");null!=o.goalColumn&&(s.left=o.goalColumn),n.push(s.left);let a=m_(this,s,t,e);return"page"==e&&o==i.sel.primary()&&pm(this,Mf(this,a,"div").top-s.top),a}),Ih),n.length)for(let t=0;t<i.sel.ranges.length;t++)i.sel.ranges[t].goalColumn=n[t]})),findWordAt:function(t){let e=Mp(this.doc,t.line).text,i=t.ch,n=t.ch;if(e){let r=this.getHelper(t,"wordChars");"before"!=t.sticky&&n!=e.length||!i?++n:--i;let o=e.charAt(i),s=Fh(o,r)?t=>Fh(t,r):/\s/.test(o)?t=>/\s/.test(t):t=>!/\s/.test(t)&&!Fh(t);for(;i>0&&s(e.charAt(i-1));)--i;for(;n<e.length&&s(e.charAt(n));)++n}return new ng(Op(t.line,i),Op(t.line,n))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?gh(this.display.cursorDiv,"CodeMirror-overwrite"):ch(this.display.cursorDiv,"CodeMirror-overwrite"),Kh(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==mh()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Rm((function(t,e){fm(this,t,e)})),getScrollInfo:function(){let t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-lf(this)-this.display.barHeight,width:t.scrollWidth-lf(this)-this.display.barWidth,clientHeight:uf(this),clientWidth:cf(this)}},scrollIntoView:Rm((function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:Op(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?function(t,e){mm(t),t.curOp.scrollToPos=e}(this,t):gm(this,t.from,t.to,t.margin)})),setSize:Rm((function(t,e){let i=t=>"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t;null!=t&&(this.display.wrapper.style.width=i(t)),null!=e&&(this.display.wrapper.style.height=i(e)),this.options.lineWrapping&&bf(this);let n=this.display.viewFrom;this.doc.iter(n,this.display.viewTo,(t=>{if(t.widgets)for(let e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){Hf(this,n,"widget");break}++n})),this.curOp.forceUpdate=!0,Kh(this,"refresh",this)})),operation:function(t){return zm(this,t)},startOperation:function(){return Em(this)},endOperation:function(){return Im(this)},refresh:Rm((function(){let t=this.display.cachedTextHeight;Wf(this),this.curOp.forceUpdate=!0,wf(this),fm(this,this.doc.scrollLeft,this.doc.scrollTop),Vm(this.display),(null==t||Math.abs(t-Bf(this.display))>.5||this.options.lineWrapping)&&Gf(this),Kh(this,"refresh",this)})),swapDoc:Rm((function(t){let e=this.doc;return e.cm=null,this.state.selectingText&&this.state.selectingText(),mg(this,t),wf(this),this.display.input.reset(),fm(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Vd(this,"swapDoc",this,e),e})),phrase:function(t){let e=this.options.phrases;return e&&Object.prototype.hasOwnProperty.call(e,t)?e[t]:t},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},ep(t),t.registerHelper=function(e,n,r){i.hasOwnProperty(e)||(i[e]=t[e]={_global:[]}),i[e][n]=r},t.registerGlobalHelper=function(e,n,r,o){t.registerHelper(e,n,o),i[e]._global.push({pred:r,val:o})}}(n_);let w_="iter insert remove copy getEditor constructor".split(" ");for(let t in uy.prototype)uy.prototype.hasOwnProperty(t)&&Th(w_,t)<0&&(n_.prototype[t]=function(t){return function(){return t.apply(this.doc,arguments)}}(uy.prototype[t]));function T_(t){let e;return{c(){e=w("div"),A(e,"class",t[0])},m(i,n){v(i,e,n),t[5](e)},p(t,[i]){1&i&&A(e,"class",t[0])},i:i,o:i,d(i){i&&x(e),t[5](null)}}}function S_(t,e,i){let n,{class:r=""}=e,{editor:o=null}=e,{options:s={}}=e,{value:a}=e;function l(t){window&&n&&(o&&i(1,n.innerHTML="",n),i(2,o=n_(n,{...t,value:a})),o.on("change",(()=>{i(3,a=o.getValue())})))}return B((()=>l(s))),t.$$set=t=>{"class"in t&&i(0,r=t.class),"editor"in t&&i(2,o=t.editor),"options"in t&&i(4,s=t.options),"value"in t&&i(3,a=t.value)},t.$$.update=()=>{if(18&t.$$.dirty&&n&&l(s),12&t.$$.dirty&&o){const t=o.getCursor();o.setValue(a),o.setCursor(t)}20&t.$$.dirty&&o&&Object.entries(s).forEach((([t,e])=>{o.setOption(t,e)}))},[r,n,o,a,s,function(t){G[t?"unshift":"push"]((()=>{n=t,i(1,n)}))}]}ep(uy),n_.inputStyles={textarea:b_,contenteditable:g_},n_.defineMode=function(t){n_.defaults.mode||"null"==t||(n_.defaults.mode=t),vp.apply(this,arguments)},n_.defineMIME=function(t,e){_p[t]=e},n_.defineMode("null",(()=>({token:t=>t.skipToEnd()}))),n_.defineMIME("text/plain","null"),n_.defineExtension=(t,e)=>{n_.prototype[t]=e},n_.defineDocExtension=(t,e)=>{uy.prototype[t]=e},n_.fromTextArea=function(t,e){if((e=e?xh(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){let i=mh();e.autofocus=i==t||null!=t.getAttribute("autofocus")&&i==document.body}function i(){t.value=r.getValue()}let n;if(t.form&&(Hh(t.form,"submit",i),!e.leaveSubmitMethodAlone)){let e=t.form;n=e.submit;try{let t=e.submit=()=>{i(),e.submit=n,e.submit(),e.submit=t}}catch(t){}}e.finishInit=r=>{r.save=i,r.getTextArea=()=>t,r.toTextArea=()=>{r.toTextArea=isNaN,i(),t.parentNode.removeChild(r.getWrapperElement()),t.style.display="",t.form&&(Yh(t.form,"submit",i),e.leaveSubmitMethodAlone||"function"!=typeof t.form.submit||(t.form.submit=n))}},t.style.display="none";let r=n_((e=>t.parentNode.insertBefore(e,t.nextSibling)),e);return r},function(t){t.off=Yh,t.on=Hh,t.wheelEventPixels=tg,t.Doc=uy,t.splitLines=dp,t.countColumn=bh,t.findColumn=Mh,t.isWordChar=Oh,t.Pass=Sh,t.signal=Kh,t.Line=Md,t.changeEnd=sg,t.scrollbarModel=Tm,t.Pos=Op,t.cmpPos=Fp,t.modes=yp,t.mimeModes=_p,t.resolveMode=xp,t.getMode=bp,t.modeExtensions=wp,t.extendMode=Tp,t.copyState=Sp,t.startState=Ep,t.innerMode=Cp,t.commands=Py,t.keyMap=vy,t.keyName=Cy,t.isModifierKey=Ty,t.lookupKey=wy,t.normalizeKeyMap=by,t.StringStream=Ip,t.SharedTextMarker=sy,t.TextMarker=ry,t.LineWidget=ey,t.e_preventDefault=ip,t.e_stopPropagation=np,t.e_stop=op,t.addClass=gh,t.contains=fh,t.rmClass=ch,t.keyNames=_y}(n_),n_.version="5.65.5";class C_ extends vt{constructor(t){super(),_t(this,t,S_,T_,l,{class:0,editor:2,options:4,value:3})}}function E_(t,e,i){const n=t.slice();return n[13]=e[i],n}function I_(t){let e,n,r,o,s;return n=new eu({props:{icon:Zc}}),{c(){e=w("button"),mt(n.$$.fragment),A(e,"class","trash svelte-1b4qqgs")},m(i,a){v(i,e,a),gt(n,e,null),r=!0,o||(s=I(e,"click",t[5]),o=!0)},p:i,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(e),yt(n),o=!1,s()}}}function M_(t){let e,i,n=t[13]+"";return{c(){e=w("div"),i=S(n),A(e,"class","error svelte-1b4qqgs")},m(t,n){v(t,e,n),_(e,i)},p(t,e){8&e&&n!==(n=t[13]+"")&&L(i,n)},d(t){t&&x(e)}}}function A_(t){let e,i,n,r,o,s,a,l,c,u,h,p;function d(e){t[8](e)}function f(e){t[9](e)}let m={options:t[4],class:"editor"};void 0!==t[2]&&(m.editor=t[2]),void 0!==t[1]&&(m.value=t[1]),n=new C_({props:m}),G.push((()=>ft(n,"editor",d))),G.push((()=>ft(n,"value",f))),l=new eu({props:{size:"2x",icon:t[3].length?Wc:Vc,color:t[3].length?"red":"green"}});let g=0!==t[0]&&I_(t),y=t[3],T=[];for(let e=0;e<y.length;e+=1)T[e]=M_(E_(t,y,e));return{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),s=C(),a=w("div"),mt(l.$$.fragment),u=C(),g&&g.c(),h=C();for(let t=0;t<T.length;t+=1)T[t].c();A(a,"class","icon svelte-1b4qqgs"),A(a,"title",c=t[3].length?"Layer is invalid":"Valid layer"),A(i,"class","container svelte-1b4qqgs")},m(t,r){v(t,e,r),_(e,i),gt(n,i,null),_(i,s),_(i,a),gt(l,a,null),_(i,u),g&&g.m(i,null),_(e,h);for(let t=0;t<T.length;t+=1)T[t].m(e,null);p=!0},p(t,[s]){const u={};!r&&4&s&&(r=!0,u.editor=t[2],J((()=>r=!1))),!o&&2&s&&(o=!0,u.value=t[1],J((()=>o=!1))),n.$set(u);const h={};if(8&s&&(h.icon=t[3].length?Wc:Vc),8&s&&(h.color=t[3].length?"red":"green"),l.$set(h),(!p||8&s&&c!==(c=t[3].length?"Layer is invalid":"Valid layer"))&&A(a,"title",c),0!==t[0]?g?(g.p(t,s),1&s&&at(g,1)):(g=I_(t),g.c(),at(g,1),g.m(i,null)):g&&(ot(),lt(g,1,1,(()=>{g=null})),st()),8&s){let i;for(y=t[3],i=0;i<y.length;i+=1){const n=E_(t,y,i);T[i]?T[i].p(n,s):(T[i]=M_(n),T[i].c(),T[i].m(e,null))}for(;i<T.length;i+=1)T[i].d(1);T.length=y.length}},i(t){p||(at(n.$$.fragment,t),at(l.$$.fragment,t),at(g),p=!0)},o(t){lt(n.$$.fragment,t),lt(l.$$.fragment,t),lt(g),p=!1},d(t){t&&x(e),yt(n),yt(l),g&&g.d(),b(T,t)}}}function k_(t,e,i){const n=j();let r,o,s,{routeLineLayer:a}=e,{index:l}=e,c=[];const u=t=>{const e={layout:t.layout||{},paint:t.paint||{}};i(1,r=JSON.stringify(e,null,2))};Xt.subscribe((t=>i(7,s=t)));return t.$$set=t=>{"routeLineLayer"in t&&i(6,a=t.routeLineLayer),"index"in t&&i(0,l=t.index)},t.$$.update=()=>{if(64&t.$$.dirty&&a&&u(a),66&t.$$.dirty){let t=r;try{t={...a,...JSON.parse(r)};const e=(t=>{const e={version:8,sources:{[t.source]:{data:{type:"FeatureCollection",features:[]},type:"geojson"}},layers:[t]};return pr(JSON.stringify(e))})(t);i(3,c=(t=>t.map((t=>{let e=t.message,[i,n]=e.split(":");return i=i.split(".").slice(1).join("."),`${i}: ${n}`})))(e))}catch(t){i(3,c=["JSON is invalid"])}}if(203&t.$$.dirty&&!c.length&&s&&r!==JSON.stringify({layout:a.layout||{},paint:a.paint||{}},null,2)){const t={...a,...JSON.parse(r)};n("setRouteLine",{index:l,layer:t})}76&t.$$.dirty&&o&&o.on("blur",(()=>{c.length&&u(a)}))},[l,r,o,c,{mode:"javascript",lineNumbers:!1,smartIndent:!0},()=>{n("deleteLayer",{index:l})},a,s,function(t){o=t,i(2,o)},function(t){r=t,i(1,r)}]}class P_ extends vt{constructor(t){super(),_t(this,t,k_,A_,l,{routeLineLayer:6,index:0})}}function L_(t){let e,n,r,o,s,a=t[4].find(t[8])?.text.toLowerCase()+"";return{c(){e=w("button"),n=S("Add a "),r=S(a),A(e,"class","primary-button svelte-1f3nuer")},m(i,a){v(i,e,a),_(e,n),_(e,r),o||(s=I(e,"click",t[6]),o=!0)},p(t,e){1&e&&a!==(a=t[4].find(t[8])?.text.toLowerCase()+"")&&L(r,a)},i:i,o:i,d(t){t&&x(e),o=!1,s()}}}function z_(t){let e,i;return e=new P_({props:{routeLineLayer:t[1],index:Number(t[0])}}),e.$on("setRouteLine",t[2]),e.$on("deleteLayer",t[3]),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};2&i&&(n.routeLineLayer=t[1]),1&i&&(n.index=Number(t[0])),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function D_(t){let e,i,n,r,o,s,a;n=new yl({props:{titleText:"Route line layers",selectedId:t[0],items:t[4]}}),n.$on("select",t[5]);const l=[z_,L_],c=[];function u(t,e){return t[1]?0:1}return o=u(t),s=c[o]=l[o](t),{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),r=C(),s.c(),A(i,"class","dropdown-container svelte-1f3nuer")},m(t,s){v(t,e,s),_(e,i),gt(n,i,null),_(e,r),c[o].m(e,null),a=!0},p(t,[i]){const r={};1&i&&(r.selectedId=t[0]),n.$set(r);let a=o;o=u(t),o===a?c[o].p(t,i):(ot(),lt(c[a],1,1,(()=>{c[a]=null})),st(),s=c[o],s?s.p(t,i):(s=c[o]=l[o](t),s.c()),at(s,1),s.m(e,null))},i(t){a||(at(n.$$.fragment,t),at(s),a=!0)},o(t){lt(n.$$.fragment,t),lt(s),a=!1},d(t){t&&x(e),yt(n),c[o].d()}}}function R_(t,e,i){let n,r,o,s="0";Jt.subscribe((t=>{i(7,r=t)})),Xt.subscribe((t=>o=t));return t.$$.update=()=>{129&t.$$.dirty&&s&&i(1,n=r[Number(s)])},[s,n,t=>{const{index:e,layer:i}=t.detail;Jt.update((t=>(t.splice(e,1,i),t)))},t=>{const{index:e}=t.detail;Jt.update((t=>(t.splice(e,1),t)))},[{id:"0",text:"Route line"},{id:"1",text:"Route line casing"}],t=>{i(0,s=t.detail.selectedId)},()=>{Jt.update((t=>{let e=t[t.length-1];return e={...e,id:`route-line-internal-mock-layer_${s}`},t.splice(Number(s),0,e),t})),ms(o)},r,t=>t.id===s]}class O_ extends vt{constructor(t){super(),_t(this,t,R_,D_,l,{})}}function F_(t,e,i){const n=t.slice();return n[23]=e[i],n[25]=i,n}function N_(t){let e,i,n,r,o,s,a,l,c;e=new lc({props:{size:"sm",label:"Padding (meters)",value:t[1],min:0,step:1}}),e.$on("input",t[17]),e.$on("focus",t[9]),e.$on("blur",t[10]),n=new yl({props:{titleText:"Include/exclude",selectedId:t[3],items:[{id:"include",text:"Include"},{id:"exclude",text:"Exclude"}]}}),n.$on("select",t[18]);let u=t[2],h=[];for(let e=0;e<u.length;e+=1)h[e]=B_(F_(t,u,e));const p=t=>lt(h[t],1,1,(()=>{h[t]=null}));return{c(){mt(e.$$.fragment),i=C(),mt(n.$$.fragment),r=C();for(let t=0;t<h.length;t+=1)h[t].c();o=C(),s=w("button"),s.textContent="Add another layer id",A(s,"class","primary-button svelte-1bj0dpp")},m(u,p){gt(e,u,p),v(u,i,p),gt(n,u,p),v(u,r,p);for(let t=0;t<h.length;t+=1)h[t].m(u,p);v(u,o,p),v(u,s,p),a=!0,l||(c=I(s,"click",t[5]),l=!0)},p(t,i){const r={};2&i&&(r.value=t[1]),e.$set(r);const s={};if(8&i&&(s.selectedId=t[3]),n.$set(s),196&i){let e;for(u=t[2],e=0;e<u.length;e+=1){const n=F_(t,u,e);h[e]?(h[e].p(n,i),at(h[e],1)):(h[e]=B_(n),h[e].c(),at(h[e],1),h[e].m(o.parentNode,o))}for(ot(),e=u.length;e<h.length;e+=1)p(e);st()}},i(t){if(!a){at(e.$$.fragment,t),at(n.$$.fragment,t);for(let t=0;t<u.length;t+=1)at(h[t]);a=!0}},o(t){lt(e.$$.fragment,t),lt(n.$$.fragment,t),h=h.filter(Boolean);for(let t=0;t<h.length;t+=1)lt(h[t]);a=!1},d(t){yt(e,t),t&&x(i),yt(n,t),t&&x(r),b(h,t),t&&x(o),t&&x(s),l=!1,c()}}}function B_(t){let e,i,n,r,o,s,a,l;function c(){return t[20](t[25])}return i=new zc({props:{labelText:0===t[25]?"Layer ID's":null,value:t[23]}}),i.$on("input",(function(...e){return t[19](t[25],...e)})),o=new eu({props:{icon:Zc}}),{c(){e=w("div"),mt(i.$$.fragment),n=C(),r=w("button"),mt(o.$$.fragment),A(r,"class","action-button svelte-1bj0dpp"),A(e,"class","text-input-container svelte-1bj0dpp")},m(t,u){v(t,e,u),gt(i,e,null),_(e,n),_(e,r),gt(o,r,null),s=!0,a||(l=I(r,"click",c),a=!0)},p(e,n){t=e;const r={};4&n&&(r.value=t[23]),i.$set(r)},i(t){s||(at(i.$$.fragment,t),at(o.$$.fragment,t),s=!0)},o(t){lt(i.$$.fragment,t),lt(o.$$.fragment,t),s=!1},d(t){t&&x(e),yt(i),yt(o),a=!1,l()}}}function j_(t){let e,i;return{c(){e=w("div"),i=C(),A(e,"class","unsaved svelte-1bj0dpp")},m(t,n){v(t,e,n),v(t,i,n)},d(t){t&&x(e),t&&x(i)}}}function $_(t){let e,i,n,r,o,s,a,l,c,u,h;function p(e){t[16](e)}let d={labelText:"Add a buffer to the route line"};void 0!==t[0]&&(d.checked=t[0]),n=new Ta({props:d}),G.push((()=>ft(n,"checked",p)));let f=t[0]&&N_(t),m=t[4]&&j_();return{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),o=C(),f&&f.c(),s=C(),a=w("button"),m&&m.c(),l=S("Submit"),A(a,"class","primary-button svelte-1bj0dpp"),A(i,"class","container svelte-1bj0dpp")},m(r,p){v(r,e,p),_(e,i),gt(n,i,null),_(i,o),f&&f.m(i,null),_(i,s),_(i,a),m&&m.m(a,null),_(a,l),c=!0,u||(h=I(a,"click",t[8]),u=!0)},p(t,[e]){const o={};!r&&1&e&&(r=!0,o.checked=t[0],J((()=>r=!1))),n.$set(o),t[0]?f?(f.p(t,e),1&e&&at(f,1)):(f=N_(t),f.c(),at(f,1),f.m(i,s)):f&&(ot(),lt(f,1,1,(()=>{f=null})),st()),t[4]?m||(m=j_(),m.c(),m.m(a,l)):m&&(m.d(1),m=null)},i(t){c||(at(n.$$.fragment,t),at(f),c=!0)},o(t){lt(n.$$.fragment,t),lt(f),c=!1},d(t){t&&x(e),yt(n),f&&f.d(),m&&m.d(),u=!1,h()}}}function U_(t,e,i){let n,r,o,s,a,l,{routeLineBuffer:c}=e,{directionsApiResponse:u}=e,{index:h}=e,p="include",d=!1;Xt.subscribe((t=>r=t));const f=t=>{i(2,a=a.filter(((e,i)=>i!==t)))},m=(t,e)=>{i(2,a[e]=t,a)};return t.$$set=t=>{"routeLineBuffer"in t&&i(11,c=t.routeLineBuffer),"directionsApiResponse"in t&&i(12,u=t.directionsApiResponse),"index"in t&&i(13,h=t.index)},t.$$.update=()=>{if(2048&t.$$.dirty&&c&&(i(0,o=c?.state),i(1,s=c?.padding),i(2,a=c?.layers)),7&t.$$.dirty&&o&&!a&&void 0===s&&(i(2,a=[""]),i(1,s=10)),2063&t.$$.dirty&&i(4,n=c?!Object.entries(c).every((([t,e])=>{let i=!1;return"type"===t&&(i=e===p),"state"===t&&(i=e===o),"padding"===t&&(i=e===s),"layers"===t&&(i=e.every((t=>a.includes(t)))&&a.every((t=>e.includes(t)))),i})):!!o),4099&t.$$.dirty&&o&&void 0!==s&&u){const{coordinates:t}=u;i(15,l=ns({type:"Feature",geometry:{type:"LineString",coordinates:t}},s,{units:"meters"}))}49152&t.$$.dirty&&d&&l&&r.getSource("BUFFER_VISUALIZER")&&r.getSource("BUFFER_VISUALIZER").setData(l)},[o,s,a,p,n,()=>i(2,a=a.concat([""])),f,m,()=>{i(2,a=a.filter((t=>{let e=""!==t;const i=r.getLayer(t);return e=e&&!!i&&"symbol"===i.type,e}))),Kt.update((t=>{const e={...t};return e.routeLineBuffer=e.routeLineBuffer.map(((t,e)=>e===h?{state:o,padding:s,layers:a,type:p}:t)),e}))},()=>{l&&(i(14,d=!0),r.addSource("BUFFER_VISUALIZER",{type:"geojson",data:l}),r.addLayer({id:"BUFFER_VISUALIZER_FILL",type:"fill",source:"BUFFER_VISUALIZER",layout:{},paint:{"fill-color":"cyan","fill-opacity":.3}}),r.addLayer({id:"BUFFER_VISUALIZER_OUTLINE",type:"line",source:"BUFFER_VISUALIZER",layout:{},paint:{"line-color":"cyan","line-width":2}}))},()=>{i(14,d=!1),r.removeLayer("BUFFER_VISUALIZER_FILL"),r.removeLayer("BUFFER_VISUALIZER_OUTLINE"),r.removeSource("BUFFER_VISUALIZER")},c,u,h,d,l,function(t){o=t,i(0,o),i(11,c)},t=>i(1,s=t.detail),t=>i(3,p=t.detail.selectedId),(t,e)=>m(e.detail,t),t=>f(t)]}class V_ extends vt{constructor(t){super(),_t(this,t,U_,$_,l,{routeLineBuffer:11,directionsApiResponse:12,index:13})}}function G_(t,e,i){const n=t.slice();return n[3]=e[i],n[5]=i,n}function q_(t){let e,i,n=t[0],r=[];for(let e=0;e<n.length;e+=1)r[e]=Z_(G_(t,n,e));const o=t=>lt(r[t],1,1,(()=>{r[t]=null}));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=E()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);v(t,e,n),i=!0},p(t,i){if(3&i){let s;for(n=t[0],s=0;s<n.length;s+=1){const o=G_(t,n,s);r[s]?(r[s].p(o,i),at(r[s],1)):(r[s]=Z_(o),r[s].c(),at(r[s],1),r[s].m(e.parentNode,e))}for(ot(),s=n.length;s<r.length;s+=1)o(s);st()}},i(t){if(!i){for(let t=0;t<n.length;t+=1)at(r[t]);i=!0}},o(t){r=r.filter(Boolean);for(let t=0;t<r.length;t+=1)lt(r[t]);i=!1},d(t){b(r,t),t&&x(e)}}}function Z_(t){let e,i;return e=new V_({props:{routeLineBuffer:t[3],directionsApiResponse:t[1],index:t[5]}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};1&i&&(n.routeLineBuffer=t[3]),2&i&&(n.directionsApiResponse=t[1]),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function W_(t){let e,i,n=t[0]&&q_(t);return{c(){e=w("div"),n&&n.c(),A(e,"class","RouteLineBufferWrapper")},m(t,r){v(t,e,r),n&&n.m(e,null),i=!0},p(t,[i]){t[0]?n?(n.p(t,i),1&i&&at(n,1)):(n=q_(t),n.c(),at(n,1),n.m(e,null)):n&&(ot(),lt(n,1,1,(()=>{n=null})),st())},i(t){i||(at(n),i=!0)},o(t){lt(n),i=!1},d(t){t&&x(e),n&&n.d()}}}function H_(t,e,i){let n,r,o=[];return Zt.subscribe((t=>i(1,({response:r}=t),r))),Kt.subscribe((t=>{n=t,i(0,o=n?.routeLineBuffer)})),[o,r]}class X_ extends vt{constructor(t){super(),_t(this,t,H_,W_,l,{})}}function Y_(t,e,i){const n=t.slice();return n[26]=e[i],n}function K_(t){let e,i,n,r;i=new yl({props:{titleText:"Maneuvers",items:t[5],label:"Select a maneuver",selectedId:t[4]}}),i.$on("select",t[17]);let o=t[3]&&t[4]&&J_(t);return{c(){e=w("div"),mt(i.$$.fragment),n=C(),o&&o.c(),A(e,"class","option add-maneuver svelte-spkgz3")},m(t,s){v(t,e,s),gt(i,e,null),_(e,n),o&&o.m(e,null),r=!0},p(t,n){const r={};32&n&&(r.items=t[5]),16&n&&(r.selectedId=t[4]),i.$set(r),t[3]&&t[4]?o?(o.p(t,n),24&n&&at(o,1)):(o=J_(t),o.c(),at(o,1),o.m(e,null)):o&&(ot(),lt(o,1,1,(()=>{o=null})),st())},i(t){r||(at(i.$$.fragment,t),at(o),r=!0)},o(t){lt(i.$$.fragment,t),lt(o),r=!1},d(t){t&&x(e),yt(i),o&&o.d()}}}function J_(t){let e,i,n,r,o,a,l,c,u,h,p,d,f,m;return i=new lc({props:{size:"sm",label:"pitch",value:t[2].pitch,step:Ut.pitch,min:0,max:85}}),i.$on("change",t[18]),o=new lc({props:{size:"sm",label:"zoom",value:t[2].zoom,step:Ut.zoom,min:0,max:24}}),o.$on("change",t[19]),{c(){e=w("div"),mt(i.$$.fragment),n=C(),r=w("div"),mt(o.$$.fragment),a=C(),l=w("div"),c=w("button"),u=S("Submit"),p=w("button"),p.textContent="Cancel",A(e,"class","number-input-container svelte-spkgz3"),A(r,"class","number-input-container svelte-spkgz3"),A(c,"class","button svelte-spkgz3"),c.disabled=t[7],A(c,"title",h=t[7]?"Settings must be different from the default":""),A(p,"class","button svelte-spkgz3"),A(l,"class","button-container svelte-spkgz3")},m(s,h){v(s,e,h),gt(i,e,null),v(s,n,h),v(s,r,h),gt(o,r,null),v(s,a,h),v(s,l,h),_(l,c),_(c,u),_(l,p),d=!0,f||(m=[I(c,"click",t[11]),I(p,"click",t[9])],f=!0)},p(t,e){const n={};4&e&&(n.value=t[2].pitch),i.$set(n);const r={};4&e&&(r.value=t[2].zoom),o.$set(r),(!d||128&e)&&(c.disabled=t[7]),(!d||128&e&&h!==(h=t[7]?"Settings must be different from the default":""))&&A(c,"title",h)},i(t){d||(at(i.$$.fragment,t),at(o.$$.fragment,t),d=!0)},o(t){lt(i.$$.fragment,t),lt(o.$$.fragment,t),d=!1},d(t){t&&x(e),yt(i),t&&x(n),t&&x(r),yt(o),t&&x(a),t&&x(l),f=!1,s(m)}}}function Q_(t){let e;return{c(){e=w("div"),e.innerHTML='<div class="message svelte-spkgz3">Configured maneuvers will appear here</div>',A(e,"class","message-container svelte-spkgz3")},m(t,i){v(t,e,i)},d(t){t&&x(e)}}}function tv(t){let e,i,n,r,o,a,l,c,u,h,p,d,f,m,g,y,b,T,E,M,k,P,z,D,O,F,N=t[26].name+"",B=(t[26].options.pitch??t[1])+"",j=(t[26].options.zoom??t[0])+"";function $(){return t[20](t[26])}function U(){return t[21](t[26])}return r=new eu({props:{icon:Gc}}),c=new eu({props:{icon:Zc}}),{c(){e=w("div"),i=w("div"),n=w("button"),mt(r.$$.fragment),a=C(),l=w("button"),mt(c.$$.fragment),h=C(),p=w("div"),d=S(N),f=C(),m=w("div"),g=S("Pitch: "),y=w("span"),b=S(B),T=C(),E=w("div"),M=S("Zoom: "),k=w("span"),P=S(j),z=C(),A(n,"class","action-button svelte-spkgz3"),n.disabled=o=t[14](t[6],t[26]),A(l,"class","action-button svelte-spkgz3"),l.disabled=u=t[14](t[6],t[26]),A(i,"class","maneuver-actions svelte-spkgz3"),A(p,"class","bold svelte-spkgz3"),A(y,"class","code svelte-spkgz3"),A(k,"class","code svelte-spkgz3"),A(e,"class","set-maneuver svelte-spkgz3"),R(e,"disabled",t[14](t[6],t[26]))},m(t,o){v(t,e,o),_(e,i),_(i,n),gt(r,n,null),_(i,a),_(i,l),gt(c,l,null),_(e,h),_(e,p),_(p,d),_(e,f),_(e,m),_(m,g),_(m,y),_(y,b),_(e,T),_(e,E),_(E,M),_(E,k),_(k,P),_(e,z),D=!0,O||(F=[I(n,"click",$),I(l,"click",U)],O=!0)},p(i,r){t=i,(!D||64&r&&o!==(o=t[14](t[6],t[26])))&&(n.disabled=o),(!D||64&r&&u!==(u=t[14](t[6],t[26])))&&(l.disabled=u),(!D||64&r)&&N!==(N=t[26].name+"")&&L(d,N),(!D||66&r)&&B!==(B=(t[26].options.pitch??t[1])+"")&&L(b,B),(!D||65&r)&&j!==(j=(t[26].options.zoom??t[0])+"")&&L(P,j),16448&r&&R(e,"disabled",t[14](t[6],t[26]))},i(t){D||(at(r.$$.fragment,t),at(c.$$.fragment,t),D=!0)},o(t){lt(r.$$.fragment,t),lt(c.$$.fragment,t),D=!1},d(t){t&&x(e),yt(r),yt(c),O=!1,s(F)}}}function ev(t){let e,i,n,r,o,s,a,l,c,u,h,p,d,f,m;s=new eu({props:{icon:qc}});let g=t[3]&&K_(t),y=!t[6].length&&Q_(),T=t[6],E=[];for(let e=0;e<T.length;e+=1)E[e]=tv(Y_(t,T,e));const M=t=>lt(E[t],1,1,(()=>{E[t]=null}));return{c(){e=w("div"),i=w("div"),n=S("Maneuver options: "),r=w("div"),o=w("button"),mt(s.$$.fragment),a=S(" Add a maneuver config"),l=C(),g&&g.c(),c=S("\n  Configured maneuvers:\n  "),u=w("div"),h=w("div"),y&&y.c(),p=C();for(let t=0;t<E.length;t+=1)E[t].c();A(o,"class","button svelte-spkgz3"),o.disabled=t[3],A(i,"class","option svelte-spkgz3"),A(h,"class","scroll-window svelte-spkgz3"),A(u,"class","maneuver-list svelte-spkgz3"),A(e,"class","options svelte-spkgz3")},m(x,b){v(x,e,b),_(e,i),_(i,n),_(i,r),_(r,o),gt(s,o,null),_(o,a),_(e,l),g&&g.m(e,null),_(e,c),_(e,u),_(u,h),y&&y.m(h,null),_(h,p);for(let t=0;t<E.length;t+=1)E[t].m(h,null);d=!0,f||(m=I(o,"click",t[16]),f=!0)},p(t,[i]){if((!d||8&i)&&(o.disabled=t[3]),t[3]?g?(g.p(t,i),8&i&&at(g,1)):(g=K_(t),g.c(),at(g,1),g.m(e,c)):g&&(ot(),lt(g,1,1,(()=>{g=null})),st()),t[6].length?y&&(y.d(1),y=null):y||(y=Q_(),y.c(),y.m(h,p)),28739&i){let e;for(T=t[6],e=0;e<T.length;e+=1){const n=Y_(t,T,e);E[e]?(E[e].p(n,i),at(E[e],1)):(E[e]=tv(n),E[e].c(),at(E[e],1),E[e].m(h,null))}for(ot(),e=T.length;e<E.length;e+=1)M(e);st()}},i(t){if(!d){at(s.$$.fragment,t),at(g);for(let t=0;t<T.length;t+=1)at(E[t]);d=!0}},o(t){lt(s.$$.fragment,t),lt(g),E=E.filter(Boolean);for(let t=0;t<E.length;t+=1)lt(E[t]);d=!1},d(t){t&&x(e),yt(s),g&&g.d(),y&&y.d(),b(E,t),f=!1,m()}}}function iv(t,e,i){const n=j();let r,{maneuverOptions:o}=e,{defaultZoom:s}=e,{defaultPitch:a}=e,l=!1;const c={zoom:s,pitch:a};let u=c,h=[{id:"*",text:"all maneuvers"}];h=h.concat($t.map((t=>({id:t,text:t}))));const p=()=>Object.keys(o).filter((t=>"*"===t||$t.includes(t))).sort((t=>"*"===t?-1:1)).map((t=>({id:t,name:h.find((e=>e.id===t)).text,options:o[t]})));let d=p();const f=()=>Object.entries(u).every((t=>{const[e,i]=t;return c[e]===i}));let m=f();const g=t=>{i(4,r=t),i(2,u={...u,...o[r]??{}})},y=()=>{i(2,u=c),i(3,l=!1),i(4,r=void 0)},_=(t,e)=>{const n=`${Ut[t]??.1}`.split(".")[1]?.length??0;i(2,u[t]=Number(e.toFixed(n)),u)},v=t=>{i(3,l=!0),g(t)},x=t=>{const e=o;delete e[t],n("setManeuverOptions",e)};return t.$$set=t=>{"maneuverOptions"in t&&i(15,o=t.maneuverOptions),"defaultZoom"in t&&i(0,s=t.defaultZoom),"defaultPitch"in t&&i(1,a=t.defaultPitch)},t.$$.update=()=>{32768&t.$$.dirty&&o&&i(6,d=p()),4&t.$$.dirty&&u&&i(7,m=f())},[s,a,u,l,r,h,d,m,g,y,_,()=>{if(!m){const t={...o,[r]:u};n("setManeuverOptions",t)}y()},v,x,(t,e)=>t.some((t=>"*"===t.id))&&"*"!==e.id,o,()=>i(3,l=!0),t=>g(t.detail.selectedId),t=>_("pitch",t.detail),t=>_("zoom",t.detail),t=>v(t.id),t=>x(t.id)]}class nv extends vt{constructor(t){super(),_t(this,t,iv,ev,l,{maneuverOptions:15,defaultZoom:0,defaultPitch:1})}}function rv(t,e,i){const n=t.slice();return n[7]=e[i],n}function ov(t){let e,i,n,r;return i=new lc({props:{size:"sm",label:t[3]?.[t[7]]?.label??t[7].charAt(0).toUpperCase()+t[7].slice(1),value:t[1]?.[t[7]],min:t[3]?.[t[7]]?.min??0,max:t[3]?.[t[7]]?.max??1e3,step:Ut?.[t[7]]??1,disabled:t[0]}}),i.$on("change",(function(...e){return t[5](t[7],...e)})),{c(){e=w("div"),mt(i.$$.fragment),n=C(),A(e,"class","number-input-container svelte-10niw6b")},m(t,o){v(t,e,o),gt(i,e,null),_(e,n),r=!0},p(e,n){t=e;const r={};2&n&&(r.value=t[1]?.[t[7]]),1&n&&(r.disabled=t[0]),i.$set(r)},i(t){r||(at(i.$$.fragment,t),r=!0)},o(t){lt(i.$$.fragment,t),r=!1},d(t){t&&x(e),yt(i)}}}function sv(t){let e,i,n=void 0!==t[1][t[7]]&&ov(t);return{c(){n&&n.c(),e=E()},m(t,r){n&&n.m(t,r),v(t,e,r),i=!0},p(t,i){void 0!==t[1][t[7]]?n?(n.p(t,i),2&i&&at(n,1)):(n=ov(t),n.c(),at(n,1),n.m(e.parentNode,e)):n&&(ot(),lt(n,1,1,(()=>{n=null})),st())},i(t){i||(at(n),i=!0)},o(t){lt(n),i=!1},d(t){n&&n.d(t),t&&x(e)}}}function av(t){let e,i,n,r,o=Object.keys(t[3]),s=[];for(let e=0;e<o.length;e+=1)s[e]=sv(rv(t,o,e));const a=t=>lt(s[t],1,1,(()=>{s[t]=null}));return{c(){e=w("div"),i=S(t[2]),n=S(":\n  ");for(let t=0;t<s.length;t+=1)s[t].c();A(e,"class","option svelte-10niw6b")},m(t,o){v(t,e,o),_(e,i),_(e,n);for(let t=0;t<s.length;t+=1)s[t].m(e,null);r=!0},p(t,[n]){if((!r||4&n)&&L(i,t[2]),27&n){let i;for(o=Object.keys(t[3]),i=0;i<o.length;i+=1){const r=rv(t,o,i);s[i]?(s[i].p(r,n),at(s[i],1)):(s[i]=sv(r),s[i].c(),at(s[i],1),s[i].m(e,null))}for(ot(),i=o.length;i<s.length;i+=1)a(i);st()}},i(t){if(!r){for(let t=0;t<o.length;t+=1)at(s[t]);r=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)lt(s[t]);r=!1},d(t){t&&x(e),b(s,t)}}}function lv(t,e,i){let{disabled:n}=e;const r=j(),o={leadDistance:{label:"Maneuver lead distance",min:0,max:1e3},speed:{label:"Threshold (meters/second)",min:0,max:30},pitch:{min:0,max:85},zoom:{min:0,max:24}};let{routingOptions:s}=e,{title:a}=e;const l=(t,e)=>{r("setProperty",{property:t,value:e})};return t.$$set=t=>{"disabled"in t&&i(0,n=t.disabled),"routingOptions"in t&&i(1,s=t.routingOptions),"title"in t&&i(2,a=t.title)},[n,s,a,o,l,(t,e)=>l(t,e.detail)]}class cv extends vt{constructor(t){super(),_t(this,t,lv,av,l,{disabled:0,routingOptions:1,title:2})}}function uv(t,e,i){const n=t.slice();return n[21]=e[i],n}function hv(t,e,i){const n=t.slice();return n[24]=e[i],n}function pv(t,e,i){const n=t.slice();return n[21]=e[i],n}function dv(t,e,i){const n=t.slice();return n[21]=e[i],n}function fv(t){let e,i,n,r,o,s,a=t[21]+"",l=t[3][t[21]]+"";return{c(){e=w("div"),i=S(a),n=S(": "),r=w("span"),o=S(l),s=C(),A(r,"class","code svelte-14zv50t"),A(e,"class","indent-1 svelte-14zv50t")},m(t,a){v(t,e,a),_(e,i),_(e,n),_(e,r),_(r,o),_(e,s)},p(t,e){8&e[0]&&a!==(a=t[21]+"")&&L(i,a),8&e[0]&&l!==(l=t[3][t[21]]+"")&&L(o,l)},d(t){t&&x(e)}}}function mv(t){let e,i,n,r=Object.keys(t[4]),o=[];for(let e=0;e<r.length;e+=1)o[e]=gv(pv(t,r,e));return{c(){e=w("div"),i=w("span"),i.textContent="Speed options:",n=C();for(let t=0;t<o.length;t+=1)o[t].c();A(i,"class","bold svelte-14zv50t"),A(e,"class","section svelte-14zv50t")},m(t,r){v(t,e,r),_(e,i),_(e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,i){if(16&i[0]){let n;for(r=Object.keys(t[4]),n=0;n<r.length;n+=1){const s=pv(t,r,n);o[n]?o[n].p(s,i):(o[n]=gv(s),o[n].c(),o[n].m(e,null))}for(;n<o.length;n+=1)o[n].d(1);o.length=r.length}},d(t){t&&x(e),b(o,t)}}}function gv(t){let e,i,n,r,o,s,a=t[21]+"",l=t[4][t[21]]+"";return{c(){e=w("div"),i=S(a),n=S(": "),r=w("span"),o=S(l),s=C(),A(r,"class","code svelte-14zv50t"),A(e,"class","indent-1 svelte-14zv50t")},m(t,a){v(t,e,a),_(e,i),_(e,n),_(e,r),_(r,o),_(e,s)},p(t,e){16&e[0]&&a!==(a=t[21]+"")&&L(i,a),16&e[0]&&l!==(l=t[4][t[21]]+"")&&L(o,l)},d(t){t&&x(e)}}}function yv(t){let e,i,n,r=Object.keys(t[1]),o=[];for(let e=0;e<r.length;e+=1)o[e]=vv(uv(t,r,e));return{c(){e=w("div"),i=w("span"),i.textContent="Maneuver options:",n=C();for(let t=0;t<o.length;t+=1)o[t].c();A(i,"class","bold svelte-14zv50t"),A(e,"class","section svelte-14zv50t")},m(t,r){v(t,e,r),_(e,i),_(e,n);for(let t=0;t<o.length;t+=1)o[t].m(e,null)},p(t,i){if(2&i[0]){let n;for(r=Object.keys(t[1]),n=0;n<r.length;n+=1){const s=uv(t,r,n);o[n]?o[n].p(s,i):(o[n]=vv(s),o[n].c(),o[n].m(e,null))}for(;n<o.length;n+=1)o[n].d(1);o.length=r.length}},d(t){t&&x(e),b(o,t)}}}function _v(t){let e,i,n,r,o,s=t[24]+"",a=t[1][t[21]][t[24]]+"";return{c(){e=w("div"),i=S(s),n=S(":\n                  "),r=w("span"),o=S(a),A(r,"class","code svelte-14zv50t"),A(e,"class","indent-2 svelte-14zv50t")},m(t,s){v(t,e,s),_(e,i),_(e,n),_(e,r),_(r,o)},p(t,e){2&e[0]&&s!==(s=t[24]+"")&&L(i,s),2&e[0]&&a!==(a=t[1][t[21]][t[24]]+"")&&L(o,a)},d(t){t&&x(e)}}}function vv(t){let e,i,n,r,o=t[21]+"",s=Object.keys(t[1][t[21]]),a=[];for(let e=0;e<s.length;e+=1)a[e]=_v(hv(t,s,e));return{c(){e=w("div"),i=S(o),n=S(": ");for(let t=0;t<a.length;t+=1)a[t].c();r=C(),A(e,"class","indent-1 svelte-14zv50t")},m(t,o){v(t,e,o),_(e,i),_(e,n);for(let t=0;t<a.length;t+=1)a[t].m(e,null);_(e,r)},p(t,n){if(2&n[0]&&o!==(o=t[21]+"")&&L(i,o),2&n[0]){let i;for(s=Object.keys(t[1][t[21]]),i=0;i<s.length;i+=1){const o=hv(t,s,i);a[i]?a[i].p(o,n):(a[i]=_v(o),a[i].c(),a[i].m(e,r))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(t){t&&x(e),b(a,t)}}}function xv(t){let e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,b;return o=new dc({props:{min:1,max:1e3,value:t[2],labelText:"Duration multiplier"}}),o.$on("change",t[15]),l=new cv({props:{title:"Routing options",routingOptions:t[3]}}),l.$on("setProperty",t[16]),h=new cv({props:{title:"Speed options",routingOptions:{...t[3],...t[4]},disabled:!t[6]}}),h.$on("setProperty",t[17]),f=new Uc({props:{labelA:"",labelB:"",size:"sm",toggled:t[6]}}),f.$on("toggle",t[18]),y=new nv({props:{maneuverOptions:t[0]||{},defaultPitch:t[3].pitch,defaultZoom:t[3].zoom}}),y.$on("setManeuverOptions",t[13]),{c(){e=w("div"),i=w("div"),n=w("div"),r=w("div"),mt(o.$$.fragment),s=C(),a=w("div"),mt(l.$$.fragment),c=C(),u=w("div"),mt(h.$$.fragment),p=C(),d=w("div"),mt(f.$$.fragment),m=C(),g=w("div"),mt(y.$$.fragment),A(r,"class","number-input-container svelte-14zv50t"),A(n,"class","option svelte-14zv50t"),A(a,"class","option svelte-14zv50t"),A(d,"class","toggle-container svelte-14zv50t"),A(u,"class","option svelte-14zv50t"),A(i,"class","options svelte-14zv50t"),A(g,"class","options svelte-14zv50t"),A(e,"class","modal-container svelte-14zv50t")},m(t,x){v(t,e,x),_(e,i),_(i,n),_(n,r),gt(o,r,null),_(i,s),_(i,a),gt(l,a,null),_(i,c),_(i,u),gt(h,u,null),_(u,p),_(u,d),gt(f,d,null),_(e,m),_(e,g),gt(y,g,null),b=!0},p(t,e){const i={};4&e[0]&&(i.value=t[2]),o.$set(i);const n={};8&e[0]&&(n.routingOptions=t[3]),l.$set(n);const r={};24&e[0]&&(r.routingOptions={...t[3],...t[4]}),64&e[0]&&(r.disabled=!t[6]),h.$set(r);const s={};64&e[0]&&(s.toggled=t[6]),f.$set(s);const a={};1&e[0]&&(a.maneuverOptions=t[0]||{}),8&e[0]&&(a.defaultPitch=t[3].pitch),8&e[0]&&(a.defaultZoom=t[3].zoom),y.$set(a)},i(t){b||(at(o.$$.fragment,t),at(l.$$.fragment,t),at(h.$$.fragment,t),at(f.$$.fragment,t),at(y.$$.fragment,t),b=!0)},o(t){lt(o.$$.fragment,t),lt(l.$$.fragment,t),lt(h.$$.fragment,t),lt(f.$$.fragment,t),lt(y.$$.fragment,t),b=!1},d(t){t&&x(e),yt(o),yt(l),yt(h),yt(f),yt(y)}}}function bv(t){let e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,T,E,M,k,P,z=t[4]&&!t[9](t[4]),D=t[1]&&!t[7](t[1]),R=Object.keys(t[3]),O=[];for(let e=0;e<R.length;e+=1)O[e]=fv(dv(t,R,e));let F=z&&mv(t),N=D&&yv(t);function B(e){t[19](e)}let j={modalHeading:"Camera behavior",passiveModal:!0,$$slots:{default:[xv]},$$scope:{ctx:t}};return void 0!==t[5]&&(j.open=t[5]),T=new Ol({props:j}),G.push((()=>ft(T,"open",B))),{c(){e=w("div"),i=w("div"),n=w("div"),r=w("div"),o=w("span"),o.textContent="Duration multiplier:",s=C(),a=w("span"),l=S(t[2]),c=C(),u=w("div"),h=w("span"),h.textContent="Routing options:",p=C();for(let t=0;t<O.length;t+=1)O[t].c();d=C(),F&&F.c(),f=C(),N&&N.c(),m=C(),g=w("button"),g.textContent="Adjust camera behavior",y=C(),mt(T.$$.fragment),A(o,"class","bold svelte-14zv50t"),A(a,"class","code svelte-14zv50t"),A(r,"class","section svelte-14zv50t"),A(h,"class","bold svelte-14zv50t"),A(u,"class","section svelte-14zv50t"),A(n,"class","window svelte-14zv50t"),A(i,"class","container svelte-14zv50t"),A(g,"class","primary-button svelte-14zv50t")},m(x,b){v(x,e,b),_(e,i),_(i,n),_(n,r),_(r,o),_(r,s),_(r,a),_(a,l),_(n,c),_(n,u),_(u,h),_(u,p);for(let t=0;t<O.length;t+=1)O[t].m(u,null);_(n,d),F&&F.m(n,null),_(n,f),N&&N.m(n,null),_(e,m),_(e,g),v(x,y,b),gt(T,x,b),M=!0,k||(P=I(g,"click",t[14]),k=!0)},p(t,e){if((!M||4&e[0])&&L(l,t[2]),8&e[0]){let i;for(R=Object.keys(t[3]),i=0;i<R.length;i+=1){const n=dv(t,R,i);O[i]?O[i].p(n,e):(O[i]=fv(n),O[i].c(),O[i].m(u,null))}for(;i<O.length;i+=1)O[i].d(1);O.length=R.length}16&e[0]&&(z=t[4]&&!t[9](t[4])),z?F?F.p(t,e):(F=mv(t),F.c(),F.m(n,f)):F&&(F.d(1),F=null),2&e[0]&&(D=t[1]&&!t[7](t[1])),D?N?N.p(t,e):(N=yv(t),N.c(),N.m(n,null)):N&&(N.d(1),N=null);const i={};93&e[0]|1&e[1]&&(i.$$scope={dirty:e,ctx:t}),!E&&32&e[0]&&(E=!0,i.open=t[5],J((()=>E=!1))),T.$set(i)},i(t){M||(at(T.$$.fragment,t),M=!0)},o(t){lt(T.$$.fragment,t),M=!1},d(t){t&&x(e),b(O,t),F&&F.d(),N&&N.d(),t&&x(y),yt(T,t),k=!1,P()}}}function wv(t,e,i){let n=1,r={},o={},s={},a={};const l=t=>Et.isObject(t)&&!Object.keys(t).length,c=t=>({speed:17,...t});ie.subscribe((t=>{t.durationMultiplier&&i(2,n=t.durationMultiplier),t.routingOptions&&i(3,r=t.routingOptions),i(4,o=l(t?.speedOptions)?c(r):t?.speedOptions),i(0,s=t?.maneuverOptions)}));let u=!1,h=void 0!==o;const p=({property:t,value:e})=>{const i=`${Ut[t]??.1}`.split(".")[1]?.length??0,n={...r,[t]:Number(e.toFixed(i))};Object.entries(n).every((t=>{const[e,i]=t;return r?.[e]===i}))||ie.update((t=>({...t,routingOptions:n})))},d=t=>Object.entries(t).every((t=>{const[e,i]=t;return c(r)?.[e]===i})),f=({property:t,value:e})=>{const i=`${Ut[t]??.1}`.split(".")[1]?.length??0,n={...o,[t]:Number(e.toFixed(i))},r=Object.entries(n).every((t=>{const[e,i]=t;return o?.[e]===i})),s=d(n);r||ie.update((t=>s?{...t,speedOptions:{}}:{...t,speedOptions:n}))},m=t=>{ie.update((e=>({...e,durationMultiplier:t})))},g=t=>{i(6,h=t),h||(i(4,o=c(r)),ie.update((t=>({...t,speedOptions:{}}))))};return t.$$.update=()=>{3&t.$$.dirty[0]&&(i(1,a=JSON.parse(JSON.stringify(s))),Object.keys(a).includes("*")&&i(1,a={"all maneuvers":a["*"]}))},[s,a,n,r,o,u,h,l,p,d,f,m,g,t=>{let e=t.detail??{};ie.update((t=>({...t,maneuverOptions:e})))},()=>i(5,u=!0),t=>m(t.detail),t=>p(t.detail),t=>f(t.detail),t=>g(t.detail.toggled),function(t){u=t,i(5,u)}]}class Tv extends vt{constructor(t){super(),_t(this,t,wv,bv,l,{},null,[-1,-1])}}function Sv(t){let e,i,n,r,o,s,a,l,c,u,h,p,d,f,m,g,y,b,T,E,M,k,P,L,z,D,R,O;return s=new Uc({props:{labelA:"",labelB:"",size:"sm",toggled:t[5]}}),s.$on("toggle",t[10]),h=new zc({props:{labelText:"Personal access token:",value:t[1],disabled:t[5]}}),h.$on("input",t[11]),f=new zc({props:{labelText:"File key:",value:t[0],disabled:t[5]}}),f.$on("input",t[12]),y=new zc({props:{labelText:"puck frame:",helperText:"Icon within frame must be named `puck`",value:t[2],disabled:t[5]}}),y.$on("input",t[13]),E=new zc({props:{labelText:"destination-pin frame:",helperText:"Icon within frame must be named `destination-pin`",value:t[3],disabled:t[5]}}),E.$on("input",t[14]),{c(){e=w("div"),i=w("div"),n=S("Use default map assets\n      "),r=w("div"),o=w("div"),mt(s.$$.fragment),a=C(),l=w("div"),l.textContent="Note: Figma link set via modal is not persisted via url. To persist on\n      refresh, it must be set in the config to protect your private keys.",c=C(),u=w("div"),mt(h.$$.fragment),p=C(),d=w("div"),mt(f.$$.fragment),m=C(),g=w("div"),mt(y.$$.fragment),b=C(),T=w("div"),mt(E.$$.fragment),M=C(),k=w("div"),P=w("button"),L=S("Submit"),A(o,"class","toggle-container svelte-e37ji8"),A(r,"class","default-toggle mb12 svelte-e37ji8"),A(i,"class","default-toggle-container svelte-e37ji8"),A(l,"class","mb12 svelte-e37ji8"),A(u,"class","mb12 svelte-e37ji8"),A(d,"class","mb12 svelte-e37ji8"),A(g,"class","mb12 svelte-e37ji8"),A(T,"class","mb12 svelte-e37ji8"),A(P,"class","primary-button svelte-e37ji8"),P.disabled=z=t[5]||t[6],A(k,"class","submit-button-container svelte-e37ji8"),A(e,"class","modal-container svelte-e37ji8")},m(x,w){v(x,e,w),_(e,i),_(i,n),_(i,r),_(r,o),gt(s,o,null),_(e,a),_(e,l),_(e,c),_(e,u),gt(h,u,null),_(e,p),_(e,d),gt(f,d,null),_(e,m),_(e,g),gt(y,g,null),_(e,b),_(e,T),gt(E,T,null),_(e,M),_(e,k),_(k,P),_(P,L),D=!0,R||(O=I(P,"click",t[15]),R=!0)},p(t,e){const i={};32&e&&(i.toggled=t[5]),s.$set(i);const n={};2&e&&(n.value=t[1]),32&e&&(n.disabled=t[5]),h.$set(n);const r={};1&e&&(r.value=t[0]),32&e&&(r.disabled=t[5]),f.$set(r);const o={};4&e&&(o.value=t[2]),32&e&&(o.disabled=t[5]),y.$set(o);const a={};8&e&&(a.value=t[3]),32&e&&(a.disabled=t[5]),E.$set(a),(!D||96&e&&z!==(z=t[5]||t[6]))&&(P.disabled=z)},i(t){D||(at(s.$$.fragment,t),at(h.$$.fragment,t),at(f.$$.fragment,t),at(y.$$.fragment,t),at(E.$$.fragment,t),D=!0)},o(t){lt(s.$$.fragment,t),lt(h.$$.fragment,t),lt(f.$$.fragment,t),lt(y.$$.fragment,t),lt(E.$$.fragment,t),D=!1},d(t){t&&x(e),yt(s),yt(h),yt(f),yt(y),yt(E),R=!1,O()}}}function Cv(t){let e,i,n,r,o,s,a,l;function c(e){t[16](e)}let u={modalHeading:"Figma link",size:"sm",passiveModal:!0,$$slots:{default:[Sv]},$$scope:{ctx:t}};return void 0!==t[4]&&(u.open=t[4]),r=new Ol({props:u}),G.push((()=>ft(r,"open",c))),{c(){e=w("div"),i=w("button"),i.textContent="Figma link",n=C(),mt(r.$$.fragment),A(i,"class","primary-button svelte-e37ji8")},m(o,c){v(o,e,c),_(e,i),v(o,n,c),gt(r,o,c),s=!0,a||(l=I(i,"click",t[9]),a=!0)},p(t,[e]){const i={};33554559&e&&(i.$$scope={dirty:e,ctx:t}),!o&&16&e&&(o=!0,i.open=t[4],J((()=>o=!1))),r.$set(i)},i(t){s||(at(r.$$.fragment,t),s=!0)},o(t){lt(r.$$.fragment,t),s=!1},d(t){t&&x(e),t&&x(n),yt(r,t),a=!1,l()}}}function Ev(t,e,i){let n,r;Gt.subscribe((t=>({figmaLink:n}=t))),Xt.subscribe((t=>r=t));let o=!1,s=!1,a=n?.fileKey??null,l=n?.personalAccessToken??null,c=n?.puck??null,u=n?.["destination-pin"]??null,h=!1;const p=async t=>{const e=i=>{r.hasImage(t)?(r.removeImage(t),setTimeout((()=>e(i)),150)):i()};return new Promise((t=>e(t)))},d=()=>!!(a&&l&&c&&u),f=async t=>{if(i(5,s=t),s)(async()=>{const t=[{name:"puck",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA4CAYAAABZjWCTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAp9SURBVHgB5Vp7TFTZGf/mDczIQ6QsqIRawYKWKAJKuqvgK6atiXSF2uI7rs1Wk+1WGtFkVeKjWuu2UdvgglLFF9HEbaJ1/7CtxBRfa8362i5oQn3CqsibYV709x3uHYcRhnlcWHb3l5zcO3fu3Lm/8z3P9x2ibzA0NDBQyWPz5s3qqKgo9fjx49V3795VuXxHbucD8hJKPoePapejOiYmRmWz2dTPnj0TN4Ao4bwLpzwcLkNcY6hUqi5SAFryH+6ENC5DKw1NU1OTGu+rlu6h1tZWfnE7vSJlkz6LY1pamvydnQKEz5LjiRU/BPjl4+PjNbW1tbrQ0FBdc3OzISgoSId79J2dnXp8r8vMzAwfO3ZsaEpKyhsOh0PV0NDQXFdX13Ls2LHHVgD3WPEbq9lstgwbNqyzpaXFwkQnT55svX79ujwB4q/JR/hKTrYRIaHhw4fr8X56vFAwPgfrdLrgrVu3Tpk0aVJ2eHj4OKPRmKDVak19Pay9vb0GE1J969atSpC9UlVV9QxE2zUajbmtrc2MWwRR6pairLLkLXwhJ9QPUtBC1XSwGwM+h2AYlyxZMnbBggXz8V0eXmwY+YknT56cu3Llyt8KCwv/DZKtkGY7LnfguZZ79+4xQUHS2+d5S06Vm5urPnnypA7nhhAAsz4MpBJXrFjxLpzGj0hBYPJuVFRU7AZu4GMLRisGS9IG72vHcHjznH7JsSvHYDVkYqx+rGZh+PPlEyZMWOlJ7QIFbPPsoUOH/nzw4MFqk8nUAmfEkpRVVfa4fcJjnGMVLygo0MIR6GEDRlwKX7p0aXJJSckeOJIctVqtpwEECCWmp6fPDA4O/ryysrKBXoUP+ehROH1+ycTglrXwWDr8iQmzFrZ27doMkPuDwWB4gwYZd+7c+XDhwoWlFoulCR9bkpOTO3HN6ikmqjxcV48aNUr/6NEjI8hErFmzJgP2VTyQatgfqqurS+fNm/chThup2xY7IQRbXwTVvVwTzgNHHYgFw2uF5uTkJH3VxBiJiYkrT5069Q5OQ6FMIXBkOhBj0+pVSL3ZHOeAnF0E8UMWLVqUvG7duo8QwyJpCCA6Ojpz5MiRd86dO/cIpmKFdnUhVsp22APu5IQ64gEGiNuEAB2xb9++3yH7GE9DCGPGjEm7efPmJw8fPmwHMfaerpmME+5qyeS09fX1BsQx4+HDh3OR6L5FQwzs0LZt21ao1+vZTIIhPRbSaybmvMDeMSsrSz1ixAh27yGwsYSJEyeuoiEKThy2bNnCEx8C9TQgF+2bXFFRkerChQsaKeENgRP5qdIu/+rVq6QkZsyY8UscjI2NjYYXL15oOOEgF+fitDkQ4y/0yA1NSKuS5s6d+1slvePp06dp9erVNGXKFIJDICWAyY8ZPXr0Z+fPn38AghZwkJdLAk7JSWLVdXR0BE2fPj1TSak9fvyY9u7dS+nz3yMkxQQnQEpBkh6nhZzI93CQghyLE5mIBrGDVTI4KSnpJ6QgmNh3s1bSzFV/ImNcOsFRkVJADp84bdq0KJzq4fy0UowWEExllURqY1q2bFnirFmz1pJCYHUsP3mG3v7gY/E59vtT6cC2X1H29LcIzosCBee3CF0P8T+34eE7EKOdqimzVEdERGh5FY18UrGYJqvjL3b8y3ktLDqefpi/ieDKSSnExcWlwYy4GsDJh0quFgjvAnujly9fanBRi4VhGikEWR2ZkCvS5/+a6swhhOUMKQFUBFLh5XVYvWixWlFLJRBBrgv2Jgo4uEGLGxNIAfCL/7PqBr2Zv7nX73/8fhmVlJUL6QYKyfnpEO+4nuMMBUJyYCtXsFg1YyhA8Asjbeuhju5gaabM+43wnkogPz+f44tcfXNKjiS2QnpKhIDFixdT+sKi19TRHUqqZ2xsLNduVFwXleF0m3CpilR/2c40kQnixb3BzHf+KKQcqHrCnERhSnYmDCc5uFHCsoYCAb8gu322J28R/b2JiqgnQoI4Pn/+nJc+r9QSWTUfHHAyDpS+W8lPsDqyA+lPHd3xJkLDF//7kpBGkb8AObGeQ8xzFo6Et8SKW1xAEO+y2+1+kWN1HJ40m34wayn5A5b2+vXr/U7Nbt++/YSkEjwyLkFOtjPWx1CMKFR9iyMjI6f58Fyhjjk/XyG8o69Sc8U/PnqfksNe0oYNG8hXjBs3bhIOdRhcQOrEcAjJSUM0I1DCe+rDM8VM+6uO7mD1/PiTSp+XRlzExcJVLrs7uOzO14XNIdmUuyqWmpqaT314rvB0gaijKwzGcKGevq4ckF1Vw19wuUGU2+VqmCCHMrksOeuRI0e8njZ2ADzTPONKIS4li2LTc8WkeYv79+9/iuyqE+GApedczwmXKZXMebnDi9PvXLt2rRxJaKqnB7KdsTq+aGwjgymclEZTfS2Vl5dTRkaGx/vYu6Nryz6iHqWHxqdPn3JPQRB0bSBq0XbiJTtXvBbMnj37954eymqD1hUNJNCvI0yyx3tA5u9z5swpQGb1Jd6nFeZmkdVS7qx2Sd0Tbgaa0eSoys7ObvVUZuA/7e+PBwPFxcX7EcLaMUSJz7X67MxQQIwPrLOdFy9erEe+eZyGOLifd+LEifs47SCpveX6vWtpT/aYHCPad+7c+VdMhk9hYbBRWlr6Fxxa4EjMWJPaNm3a1KMw6yQnre/kxns7Yk3d2bNni2iIgpsiR48erUHdpwPmYcGa1K5y6ym7FzJZX5mcBS3blo0bN1588OBBBQ0xsEah27MXpy3o3XVgPWqTAnePfkFvXR4HKs9snGbuhUGP93FjnoYImNiOHTu4Es5Rvg29eSvXK3trY73W5eEJWL58eReae128kwIZiwUp2X8yMzOzA2nmKwGOaWVlZe/t37//M+rOITmmsYfvtUf+muQkte1CYLRDn9m5NCNr+XzXrl2rvkoHw8QOHDjw7u7du6/xOyFgs4fskxjD08pbLj1wJZcrumHo1SWhV1eCJDXgOosv4EnFBBfAg3Pey11Vbvx77KoyPJYVWEXxYw70ohKNYcJqPeLMmTOFMOKf0SCAM/49e/Z8AHL/JcnOqFti8p4U/8gxujftqEQfgbq7rZy1hCLvy+MW10BJkdUQC9BS5K9lWGU3wXvzIppVsc9mozu83mRDUukPAdPQ0NAgS9GEQPp2amrqSqVIMilk+RXbt28/cvnyZV5dt6Ia3mY0Gi2oGDAxeZuGVy/tFSQJcnVag4DJaiqrqhEkjTD2HG6g9Lea6AscbvDylUzq0qVL9dRtVzzkPWByD0Dx7VE97pe2SnEYkUkGSSMYTid+6tSpyQkJCZO5es1FXnepsoNgCfGmNjQNv8CzLhw/frwWmb0ZyzKzRKhTIsUB2i57cfIBftUp5dpgXl6eTJLtkTfj6FFg4h4fE9ZK1/koKtuQsEp6QQdiqA1krCDDGZFVImJBUdWKwGxDImFDcHZuMiU/oMROWWGPCPoaqJYaq4kem0phKxokAaIQhVRJBeIOXOvCNaFmsCcbygR2lBftUEvXnXle2dVgQuyYxazL4YNjpFBXDN4Uw1sYeQShm8RNeiFZqLmYDNdq8dcBrhu2hWq6NOUVKd9/a/F/5g6+kqbMKG8AAAAASUVORK5CYII="},{name:"destination-pin",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAA1CAYAAAAklDnhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANMSURBVHgBtVnBVRsxEB0JHphTnA7sCxgucQcsFSRUgNOBU4GdCkIqYFMBUAGbCuJceHCyqCDcbC7ezMiys+uspJFk//dg7dVI+/U1o5mVBQRg2um04eAgAyEyAXCO1zbe7qwNynKC915LgJ/4reg+PRXcsQXHaNrrdfAhQyHlFV7bwIdCUl+RUO4zdBIhBeTR0ahEEpAGLyErkenZWV8sFrdQlT4deTmff+kq9QocIi+93lUpxHXgMvCAfoRjX6I6ClxEjBK/YJcgMm9vF1VlZI0EOqVZjt1CiL5otb5Vb9WIoDw3EOITGKr4v6j8hWAwPTkZVp69BKoxMEQ4yDEKfjTtE2acEXAmRHvObNalJVoTUb3elNFZlVJedh8fJx47IjQ2hJwwYT2WplPGIgFwwSFBoMHR/rPPTgjxka7SfPvk66BJbIQcg0yOofrdPXDZpyDRRERZfgA38lASa8xmY+PULmQrRfouK1pHiAQ5IqYIryrSfLDvoEJMotX4h8LViH7yTurM6gCq8QKpmM+dDo5+9F76Zov+8wcS0ZTkNp+x2lmVzYjYQiJ0QeUAqa6JoDP9thnpSiwVrZYzGMgPl4pIWViN0JHNhpeCgbN1NitWUXPnsuNs1TbojA5w5TApyIc0EeOwymGcTY+PvbuvBWNXI7rFPV3XZQBlU1cHsbd3Q0UTBAArvZFHDfKPuxoR8NUT6CsYZg/VGsIGihJ1enpbetSA5SuH0nyqd7EUeMBLBn7oqhydfLLKxjpEMTpwZucY8kNOvUvZeVXZ79cahLjHWWfgR0cXUYsFkd8cnNQDJorVh1qpiGGUMzLltlDL6DUirEy5JWxmdNlgk8PuUWzmuP+IGIMCdoimrUJaDKMLIQZU0ztwIxHzmlDADmCbpAztkAhlOxGwEtmFKq7JydiOEVCu8xEnkW2q4puUkwhnACaU7/jKS2QbqnAm4yXCHcgBrxpsIimqcCfBIhIy4AZYagQRiVElhDybSOjAEKBGMJEQVUKXMohIwAOC1IgiQqr4Xj04R1bJRAzGjragXyWSiFAVZzsbi1EjmohG89lY9FlbNJGmij8lFcQrQpjPryuqxJ88phKpqpJaLuxDKlCV8vCw3X1+VpCAvyZEloGR0vYXAAAAAElFTkSuQmCC"}];for(const e of t)await p(e.name),r.loadImage(e.path,((t,i)=>{t?console.error(t):(r.addImage(e.name,i),Yt.update((t=>({...t,[e.name]:{name:e.name,url:e.path,width:i.width,height:i.height}}))))}))})();else{for(const t of Ot)await p(t);d&&g()}},m=()=>({"destination-pin":u,puck:c,fileKey:a,personalAccessToken:l,scale:1}),g=()=>{if(!d())return;const t=m();Gt.update((e=>({...e,figmaLink:t}))),Y(),te.set({loading:!0,helperText:"Loading assets"}),fe(r).then((t=>{Yt.update((e=>Object.keys(e).reduce(((e,i)=>(e[i]=t.find((t=>t.name===i))??null,e)),{}))),te.set({loading:!1})})).catch((t=>{te.set({loading:!1}),console.error(t)}))};return t.$$.update=()=>{15&t.$$.dirty&&a&&l&&c&&u&&i(6,h=!(()=>{const t=m();return Object.entries(t).some((t=>{const[e,i]=t;return n?.[e]!==i}))})())},[a,l,c,u,o,s,h,f,g,()=>i(4,o=!0),t=>f(t.detail.toggled),t=>i(1,l=t.detail),t=>i(0,a=t.detail),t=>i(2,c=t.detail),t=>i(3,u=t.detail),()=>{g(),i(4,o=!1)},function(t){o=t,i(4,o)}]}class Iv extends vt{constructor(t){super(),_t(this,t,Ev,Cv,l,{})}}function Mv(t){let e,i,n,r,o,s;return i=new Su({props:{setRouteFlag:t[1],routeFlag:t[0]}}),o=new Du({props:{setRouteFlag:t[1],routeFlag:t[0]}}),{c(){e=w("div"),mt(i.$$.fragment),n=C(),r=w("div"),mt(o.$$.fragment),A(e,"class","control svelte-z0209z"),A(r,"class","control mt24 svelte-z0209z")},m(t,a){v(t,e,a),gt(i,e,null),v(t,n,a),v(t,r,a),gt(o,r,null),s=!0},p(t,e){const n={};2&e&&(n.setRouteFlag=t[1]),1&e&&(n.routeFlag=t[0]),i.$set(n);const r={};2&e&&(r.setRouteFlag=t[1]),1&e&&(r.routeFlag=t[0]),o.$set(r)},i(t){s||(at(i.$$.fragment,t),at(o.$$.fragment,t),s=!0)},o(t){lt(i.$$.fragment,t),lt(o.$$.fragment,t),s=!1},d(t){t&&x(e),yt(i),t&&x(n),t&&x(r),yt(o)}}}function Av(t){let e,n,r;return n=new O_({}),{c(){e=w("div"),mt(n.$$.fragment),A(e,"class","control svelte-z0209z")},m(t,i){v(t,e,i),gt(n,e,null),r=!0},p:i,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(e),yt(n)}}}function kv(t){let e,n,r;return n=new X_({}),{c(){e=w("div"),mt(n.$$.fragment),A(e,"class","control svelte-z0209z")},m(t,i){v(t,e,i),gt(n,e,null),r=!0},p:i,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(e),yt(n)}}}function Pv(t){let e,n,r;return n=new Tv({}),{c(){e=w("div"),mt(n.$$.fragment),A(e,"class","control svelte-z0209z")},m(t,i){v(t,e,i),gt(n,e,null),r=!0},p:i,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(e),yt(n)}}}function Lv(t){let e,n,r;return n=new Iv({}),{c(){e=w("div"),mt(n.$$.fragment),A(e,"class","control svelte-z0209z")},m(t,i){v(t,e,i),gt(n,e,null),r=!0},p:i,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&x(e),yt(n)}}}function zv(t){let e,i,n,r,o,s,a,l,c,u;return e=new Ks({props:{title:"Route:",open:!0,$$slots:{default:[Mv]},$$scope:{ctx:t}}}),n=new Ks({props:{title:"Route-line:",open:!0,$$slots:{default:[Av]},$$scope:{ctx:t}}}),o=new Ks({props:{title:"Route-line buffer:",open:!0,$$slots:{default:[kv]},$$scope:{ctx:t}}}),a=new Ks({props:{title:"Camera behavior:",open:!0,$$slots:{default:[Pv]},$$scope:{ctx:t}}}),c=new Ks({props:{title:"Map assets:",open:!0,$$slots:{default:[Lv]},$$scope:{ctx:t}}}),{c(){mt(e.$$.fragment),i=C(),mt(n.$$.fragment),r=C(),mt(o.$$.fragment),s=C(),mt(a.$$.fragment),l=C(),mt(c.$$.fragment)},m(t,h){gt(e,t,h),v(t,i,h),gt(n,t,h),v(t,r,h),gt(o,t,h),v(t,s,h),gt(a,t,h),v(t,l,h),gt(c,t,h),u=!0},p(t,i){const r={};7&i&&(r.$$scope={dirty:i,ctx:t}),e.$set(r);const s={};4&i&&(s.$$scope={dirty:i,ctx:t}),n.$set(s);const l={};4&i&&(l.$$scope={dirty:i,ctx:t}),o.$set(l);const u={};4&i&&(u.$$scope={dirty:i,ctx:t}),a.$set(u);const h={};4&i&&(h.$$scope={dirty:i,ctx:t}),c.$set(h)},i(t){u||(at(e.$$.fragment,t),at(n.$$.fragment,t),at(o.$$.fragment,t),at(a.$$.fragment,t),at(c.$$.fragment,t),u=!0)},o(t){lt(e.$$.fragment,t),lt(n.$$.fragment,t),lt(o.$$.fragment,t),lt(a.$$.fragment,t),lt(c.$$.fragment,t),u=!1},d(t){yt(e,t),t&&x(i),yt(n,t),t&&x(r),yt(o,t),t&&x(s),yt(a,t),t&&x(l),yt(c,t)}}}function Dv(t){let e,i,n;return i=new Zs({props:{$$slots:{default:[zv]},$$scope:{ctx:t}}}),{c(){e=w("div"),mt(i.$$.fragment),A(e,"class","panel svelte-z0209z")},m(t,r){v(t,e,r),gt(i,e,null),n=!0},p(t,[e]){const n={};7&e&&(n.$$scope={dirty:e,ctx:t}),i.$set(n)},i(t){n||(at(i.$$.fragment,t),n=!0)},o(t){lt(i.$$.fragment,t),n=!1},d(t){t&&x(e),yt(i)}}}function Rv(t,e,i){let{routeFlag:n}=e,{setRouteFlag:r}=e;return t.$$set=t=>{"routeFlag"in t&&i(0,n=t.routeFlag),"setRouteFlag"in t&&i(1,r=t.setRouteFlag)},[n,r]}class Ov extends vt{constructor(t){super(),_t(this,t,Rv,Dv,l,{routeFlag:0,setRouteFlag:1})}}let Fv;Gt.subscribe((t=>({mapboxGlAccessToken:Fv}=t)));const Nv=t=>{if("string"!=typeof t)return!1;return t.startsWith("mapbox://styles/")&&5===t.split("/").length};function Bv(t){let e,i,n,r,o,s,a,l,c,u,h;return i=new zc({props:{placeholder:"Enter height...",value:t[4]??""}}),i.$on("input",t[18]),r=new zc({props:{placeholder:"Enter width...",value:t[3]??""}}),r.$on("input",t[19]),{c(){e=w("div"),mt(i.$$.fragment),n=C(),mt(r.$$.fragment),o=C(),s=w("button"),a=S("Submit"),A(s,"class","submit-button svelte-k7mtpz"),s.disabled=l=!t[3]||!t[4],A(e,"class","custom-url-container svelte-k7mtpz")},m(l,p){v(l,e,p),gt(i,e,null),_(e,n),gt(r,e,null),_(e,o),_(e,s),_(s,a),c=!0,u||(h=I(s,"click",t[15]),u=!0)},p(t,e){const n={};16&e&&(n.value=t[4]??""),i.$set(n);const o={};8&e&&(o.value=t[3]??""),r.$set(o),(!c||24&e&&l!==(l=!t[3]||!t[4]))&&(s.disabled=l)},i(t){c||(at(i.$$.fragment,t),at(r.$$.fragment,t),c=!0)},o(t){lt(i.$$.fragment,t),lt(r.$$.fragment,t),c=!1},d(t){t&&x(e),yt(i),yt(r),u=!1,h()}}}function jv(t){let e,i,n,r,o,s,a,l,c,u;n=new zc({props:{placeholder:"Enter map style url...",disabled:t[0],value:t[5]}}),n.$on("input",t[20]),n.$on("focus",t[21]);let h=t[6]&&$v();return{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),r=C(),o=w("button"),o.textContent="Submit",s=C(),h&&h.c(),a=E(),A(o,"class","submit-button svelte-k7mtpz"),A(e,"class","custom-url-container svelte-k7mtpz")},m(p,d){v(p,e,d),_(e,i),gt(n,i,null),_(e,r),_(e,o),v(p,s,d),h&&h.m(p,d),v(p,a,d),l=!0,c||(u=I(o,"click",t[11]),c=!0)},p(t,e){const i={};1&e&&(i.disabled=t[0]),32&e&&(i.value=t[5]),n.$set(i),t[6]?h||(h=$v(),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i(t){l||(at(n.$$.fragment,t),l=!0)},o(t){lt(n.$$.fragment,t),l=!1},d(t){t&&x(e),yt(n),t&&x(s),h&&h.d(t),t&&x(a),c=!1,u()}}}function $v(t){let e;return{c(){e=w("div"),e.textContent="Style not found",A(e,"class","error svelte-k7mtpz")},m(t,i){v(t,e,i)},d(t){t&&x(e)}}}function Uv(t){let e,i,n,r,o,s,a,l,c,u,h,p,d;r=new yl({props:{titleText:"Devices",selectedId:t[1],items:t[9],disabled:t[0]}}),r.$on("select",t[13]);let f="custom"===t[1]&&Bv(t);l=new yl({props:{titleText:"Map styles",selectedId:t[8],items:t[10],disabled:t[0]}}),l.$on("select",t[12]);let m="custom"===t[8]&&jv(t);return p=new yl({props:{titleText:"Renderers",selectedId:t[2],items:t[7],disabled:t[0]}}),p.$on("select",t[14]),{c(){e=w("div"),i=w("div"),n=w("div"),mt(r.$$.fragment),o=C(),f&&f.c(),s=C(),a=w("div"),mt(l.$$.fragment),c=C(),m&&m.c(),u=C(),h=w("div"),mt(p.$$.fragment),A(n,"class","dropdown svelte-k7mtpz"),A(a,"class","dropdown svelte-k7mtpz"),A(h,"class","dropdown svelte-k7mtpz"),A(i,"class","dropdown-container svelte-k7mtpz"),A(e,"class","panel svelte-k7mtpz")},m(t,g){v(t,e,g),_(e,i),_(i,n),gt(r,n,null),_(i,o),f&&f.m(i,null),_(i,s),_(i,a),gt(l,a,null),_(i,c),m&&m.m(i,null),_(i,u),_(i,h),gt(p,h,null),d=!0},p(t,[e]){const n={};2&e&&(n.selectedId=t[1]),1&e&&(n.disabled=t[0]),r.$set(n),"custom"===t[1]?f?(f.p(t,e),2&e&&at(f,1)):(f=Bv(t),f.c(),at(f,1),f.m(i,s)):f&&(ot(),lt(f,1,1,(()=>{f=null})),st());const o={};256&e&&(o.selectedId=t[8]),1&e&&(o.disabled=t[0]),l.$set(o),"custom"===t[8]?m?(m.p(t,e),256&e&&at(m,1)):(m=jv(t),m.c(),at(m,1),m.m(i,u)):m&&(ot(),lt(m,1,1,(()=>{m=null})),st());const a={};4&e&&(a.selectedId=t[2]),128&e&&(a.items=t[7]),1&e&&(a.disabled=t[0]),p.$set(a)},i(t){d||(at(r.$$.fragment,t),at(f),at(l.$$.fragment,t),at(m),at(p.$$.fragment,t),d=!0)},o(t){lt(r.$$.fragment,t),lt(f),lt(l.$$.fragment,t),lt(m),lt(p.$$.fragment,t),d=!1},d(t){t&&x(e),yt(r),f&&f.d(),yt(l),m&&m.d(),yt(p)}}}function Vv(t,e,i){let n,r,{routeFlag:o}=e;Gt.subscribe((t=>{({devices:n}=t),({styles:r}=t)}));let s,a=n[0].width,l=n[0].height,c=n[0]?.id??"custom",u=null,h=null;Qt.subscribe((t=>{t&&(a=t.width,l=t.height,i(1,c=t.id),"custom"===c&&(i(3,u=a),i(4,h=l)))}));let p,d="",f="";const m=n.map((t=>({id:t.id,text:t.name}))).concat([{id:"custom",text:"Responsive"}]),g=r.map((t=>({id:t.id,text:t.name}))).concat([{id:"custom",text:"Custom URL"}]);let y,_=[{id:"mapbox-gl",text:"Mapbox GL"},{id:"maplibre-gl",text:"Maplibre GL"}],v=g?.[0]?.id;const x=async t=>{if(!t)return;let e=t;if(t.includes("localhost")){const[t,i]=e.split("localhost");t||(e=`http://localhost${i}`)}try{const t=await(async t=>{const e=Nv(t);let i=t;if(e){const[,,,t,e]=i.split("/");i=`https://api.mapbox.com/styles/v1/${t}/${e}?title=true&access_token=${Fv}`}const n=await fetch(i),r=await n.json();if(e&&r.message)throw new Error(r.message);return r})(e);if(t&&"object"==typeof t)return i(17,y.url=t,y),i(16,f=e),T(e),{status:"200",url:e}}catch(t){return i(6,p=new Error("Style was not found.")),{status:"404",url:e}}},b=t=>{Nv(t)?(i(7,_=[{id:"mapbox-gl",text:"Mapbox GL"}]),i(2,s="mapbox-gl")):i(7,_=[{id:"mapbox-gl",text:"Mapbox GL"},{id:"maplibre-gl",text:"Maplibre GL"}])},w=async()=>{const t=await x(d),{status:e,url:n}=t;if("200"===e){b(n);i(17,y={id:"custom",name:"Custom",type:"mapbox-gl",url:n})}};Kt.subscribe((t=>{if(y)return;i(17,y=t||r[0]),i(2,s=y?.renderer??y?.type);const e=y?.id??"custom";i(8,v=e),"custom"===e&&(i(5,d=t?.url),w())}));const T=t=>{const e=t=>t&&t.includes("localhost")&&f===t;e(t)&&setTimeout((()=>e(t)&&x(t)),3e3)};return t.$$set=t=>{"routeFlag"in t&&i(0,o=t.routeFlag)},t.$$.update=()=>{if(196608&t.$$.dirty&&y){const t="string"==typeof y?.url?y.url:f;i(2,s=y?.renderer??y?.type),Kt.set({...y,url:t})}},[o,c,s,u,h,d,p,_,v,m,g,w,t=>{const{selectedId:e}=t.detail;if(i(8,v=e),"custom"===e)return i(5,d=y.url),void i(6,p="");i(5,d=""),i(16,f=""),i(6,p="");const n=r.find((t=>t.id===e));i(17,y=n),b(y?.url)},t=>{const{selectedId:e}=t.detail;if(i(1,c=e),"custom"===e)return i(3,u=a),void i(4,h=l);i(3,u=null),i(4,h=null);const r=n.find((t=>t.id===e));a=r.width,l=r.height,Qt.set(r)},t=>{const{selectedId:e}=t.detail;i(17,y={...y,renderer:e})},()=>{const t={id:"custom",width:Number(u),height:Number(h)};a=t.width,l=t.height,Qt.set(t)},f,y,t=>i(4,h=t.detail),t=>i(3,u=t.detail),t=>i(5,d=t.detail),()=>i(6,p="")]}class Gv extends vt{constructor(t){super(),_t(this,t,Vv,Uv,l,{routeFlag:0})}}function qv(t){let e;return{c(){e=w("div"),A(e,"class","circle svelte-14upwad"),D(e,"--size",t[3]+t[1]),D(e,"--color",t[0]),D(e,"--duration",t[2])},m(t,i){v(t,e,i)},p(t,[i]){10&i&&D(e,"--size",t[3]+t[1]),1&i&&D(e,"--color",t[0]),4&i&&D(e,"--duration",t[2])},i:i,o:i,d(t){t&&x(e)}}}function Zv(t,e,i){let{color:n="#FF3E00"}=e,{unit:r="px"}=e,{duration:o="0.75s"}=e,{size:s="60"}=e;return t.$$set=t=>{"color"in t&&i(0,n=t.color),"unit"in t&&i(1,r=t.unit),"duration"in t&&i(2,o=t.duration),"size"in t&&i(3,s=t.size)},[n,r,o,s]}class Wv extends vt{constructor(t){super(),_t(this,t,Zv,qv,l,{color:0,unit:1,duration:2,size:3})}}function Hv(t){let e,i,n,r,o,s,a;return n=new Wv({props:{size:"100",color:"white",unit:"px"}}),{c(){e=w("div"),i=w("div"),mt(n.$$.fragment),r=C(),o=w("div"),s=S(t[0]),A(o,"class","text svelte-17kqyn2"),A(i,"class","container svelte-17kqyn2"),A(e,"class","loader svelte-17kqyn2")},m(t,l){v(t,e,l),_(e,i),gt(n,i,null),_(i,r),_(i,o),_(o,s),a=!0},p(t,[e]){(!a||1&e)&&L(s,t[0])},i(t){a||(at(n.$$.fragment,t),a=!0)},o(t){lt(n.$$.fragment,t),a=!1},d(t){t&&x(e),yt(n)}}}function Xv(t,e,i){let{helperText:n}=e;return t.$$set=t=>{"helperText"in t&&i(0,n=t.helperText)},[n]}class Yv extends vt{constructor(t){super(),_t(this,t,Xv,Hv,l,{helperText:0})}}function Kv(t){let e,i;return e=new Yv({props:{helperText:t[0].helperText||null}}),{c(){mt(e.$$.fragment)},m(t,n){gt(e,t,n),i=!0},p(t,i){const n={};1&i&&(n.helperText=t[0].helperText||null),e.$set(n)},i(t){i||(at(e.$$.fragment,t),i=!0)},o(t){lt(e.$$.fragment,t),i=!1},d(t){yt(e,t)}}}function Jv(t){let e,i,n,r,o,s,a,l,c,u;r=new Ov({props:{setRouteFlag:t[2],routeFlag:t[1]}}),s=new Ts({props:{routeFlag:t[1]}}),l=new Gv({props:{routeFlag:t[1]}});let h=t[0].loading&&Kv(t);return{c(){e=w("base"),i=C(),n=w("main"),mt(r.$$.fragment),o=C(),mt(s.$$.fragment),a=C(),mt(l.$$.fragment),c=C(),h&&h.c(),A(e,"href","/"),A(n,"class","svelte-2y1l8u")},m(t,p){_(document.head,e),v(t,i,p),v(t,n,p),gt(r,n,null),_(n,o),gt(s,n,null),_(n,a),gt(l,n,null),_(n,c),h&&h.m(n,null),u=!0},p(t,[e]){const i={};2&e&&(i.routeFlag=t[1]),r.$set(i);const o={};2&e&&(o.routeFlag=t[1]),s.$set(o);const a={};2&e&&(a.routeFlag=t[1]),l.$set(a),t[0].loading?h?(h.p(t,e),1&e&&at(h,1)):(h=Kv(t),h.c(),at(h,1),h.m(n,null)):h&&(ot(),lt(h,1,1,(()=>{h=null})),st())},i(t){u||(at(r.$$.fragment,t),at(s.$$.fragment,t),at(l.$$.fragment,t),at(h),u=!0)},o(t){lt(r.$$.fragment,t),lt(s.$$.fragment,t),lt(l.$$.fragment,t),lt(h),u=!1},d(t){x(e),t&&x(i),t&&x(n),yt(r),yt(s),yt(l),h&&h.d()}}}function Qv(t,e,i){let{localConfig:n}=e;const r=(t=>{const e={leadDistance:125,pitch:60,zoom:16,...t?.routingOptions||{}};let i=JSON.parse(JSON.stringify(t));return i?.routingOptions&&delete i.routingOptions,t.directionsApiCall&&(i={...i,directionsApiCall:t.directionsApiCall}),{devices:[{id:"google-pixel",name:"Google Pixel",height:732,width:412},{id:"iphone-13",name:"iPhone 13",height:844,width:390}],styles:[{id:"mapbox-streets",name:"Mapbox Streets",type:"mapbox-gl",url:"mapbox://styles/mapbox/streets-v11"},{id:"mapbox-outdoors",name:"Mapbox Outdoors",type:"mapbox-gl",url:"mapbox://styles/mapbox/outdoors-v11"},{id:"mapbox-light",name:"Mapbox Light",type:"mapbox-gl",url:"mapbox://styles/mapbox/light-v10"},{id:"mapbox-dark",name:"Mapbox Dark",type:"mapbox-gl",url:"mapbox://styles/mapbox/dark-v10"}],mapState:{bearing:0,center:{lng:-73.92169,lat:40.83962},pitch:0,zoom:13.25},durationMultiplier:50,routingOptions:e,...i}})(n);Gt.set(r);let o,s=null,a=null,l=null,c=null,u=!0;ie.subscribe((t=>{if(i(4,s=null),i(5,a=null),i(6,l=null),i(7,c=null),u){u=!1;const e=Et.cloneDeep({durationMultiplier:r.durationMultiplier??{},routingOptions:r.routingOptions??{},speedOptions:r.speedOptions??{},maneuverOptions:r.maneuverOptions??{}});let i=Et.assign(e,t);ie.set(i)}else{const e=t=>Et.isObject(t)&&!Object.keys(t).length;if(t.durationMultiplier!==r.durationMultiplier&&i(4,s=t.durationMultiplier??null),Et.isEqual(t?.routingOptions,r.routingOptions)||i(5,a=t.routingOptions),!Et.isEqual(t?.speedOptions,r.speedOptions)){const n=e(t.speedOptions)&&!r.speedOptions;i(6,l=n?null:t.speedOptions)}if(!Et.isEqual(t?.maneuverOptions,r.maneuverOptions)){const n=e(t.maneuverOptions)&&!r.maneuverOptions;i(7,c=n?null:t.maneuverOptions)}}})),Ht.subscribe((t=>{t&&Object.keys(t).length?i(8,o=t):Ht.set(r.mapState)}));let h=null;Zt.subscribe((t=>{const{locations:e}=t;i(9,h=e&&e.every((t=>null!==t.center))?e:null)}));let p=null;Jt.subscribe((t=>{const e=t.map((t=>({layout:t.layout,paint:t.paint}))),n=t.map((()=>jt));JSON.stringify(n)!==JSON.stringify(e)?i(10,p=e):i(10,p=null)}));let d=null;Kt.subscribe((t=>{i(11,d=t||null)}));let f=null;Qt.subscribe((t=>{i(12,f=t??null)}));let m,g={loading:!1};te.subscribe((t=>i(0,g=t))),Xt.subscribe((t=>m=t));let y=!1;return t.$$set=t=>{"localConfig"in t&&i(3,n=t.localConfig)},t.$$.update=()=>{8176&t.$$.dirty&&(o||h||p||d||f||s||a||l||c)&&Lt({locations:h,routeLines:p,styleUrl:d,deviceSize:f,durationMultiplier:s,routingOptions:a,speedOptions:l,maneuverOptions:c,...o})},[g,y,t=>{i(1,y=t),m&&!y&&m.once("move",(()=>{m.getLayer("destination-pin")&&fs(m,"destination-pin"),m.getLayer(Rt)&&fs(m,Rt)}))},n,s,a,l,c,o,h,p,d,f]}class tx extends vt{constructor(t){super(),_t(this,t,Qv,Jv,l,{localConfig:3})}}const ex=(t,e)=>new tx({target:t,props:e});var ix=Object.freeze({__proto__:null}),nx=Object.freeze({__proto__:null});export{ex as startApp};
//# sourceMappingURL=bundle.js.map
