import e from"https://unpkg.com/mp4-h264@1.0.7/build/mp4-encoder.js";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}function i(){}function n(e,t){for(const i in t)e[i]=t[i];return e}function r(e){return e()}function o(){return Object.create(null)}function s(e){e.forEach(r)}function a(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t,i,n){if(e){const r=u(e,t,i,n);return e[0](r)}}function u(e,t,i,r){return e[1]&&r?n(i.ctx.slice(),e[1](r(t))):i.ctx}function h(e,t,i,n){if(e[2]&&n){const r=e[2](n(i));if(void 0===t.dirty)return r;if("object"==typeof r){const e=[],i=Math.max(t.dirty.length,r.length);for(let n=0;n<i;n+=1)e[n]=t.dirty[n]|r[n];return e}return t.dirty|r}return t.dirty}function d(e,t,i,n,r,o){if(r){const s=u(t,i,n,o);e.p(s,r)}}function p(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let e=0;e<i;e++)t[e]=-1;return t}return-1}function f(e){const t={};for(const i in e)"$"!==i[0]&&(t[i]=e[i]);return t}function m(e,t){const i={};t=new Set(t);for(const n in e)t.has(n)||"$"===n[0]||(i[n]=e[n]);return i}function g(e){const t={};for(const i in e)t[i]=!0;return t}function y(e){return null==e?"":e}function _(e,t){e.appendChild(t)}function v(e,t,i){e.insertBefore(t,i||null)}function x(e){e.parentNode.removeChild(e)}function b(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function w(e){return document.createElement(e)}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function k(e){return document.createTextNode(e)}function S(){return k(" ")}function C(){return k("")}function E(e,t,i,n){return e.addEventListener(t,i,n),()=>e.removeEventListener(t,i,n)}function M(e){return function(t){return t.preventDefault(),e.call(this,t)}}function A(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function z(e,t){const i=Object.getOwnPropertyDescriptors(e.__proto__);for(const n in t)null==t[n]?e.removeAttribute(n):"style"===n?e.style.cssText=t[n]:"__value"===n?e.value=e[n]=t[n]:i[n]&&i[n].set?e[n]=t[n]:A(e,n,t[n])}function I(e,t){for(const i in t)A(e,i,t[i])}function L(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function D(e,t){e.value=null==t?"":t}function P(e,t,i,n){null===i?e.style.removeProperty(t):e.style.setProperty(t,i,n?"important":"")}function O(e,t,i){e.classList[i?"add":"remove"](t)}let R;function B(e){R=e}function F(){if(!R)throw new Error("Function called outside component initialization");return R}function $(e){F().$$.on_mount.push(e)}function j(){const e=F();return(t,i,{cancelable:n=!1}={})=>{const r=e.$$.callbacks[t];if(r){const o=function(e,t,{bubbles:i=!1,cancelable:n=!1}){const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,i,n,t),r}(t,i,{cancelable:n});return r.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}function N(e){return F().$$.context.get(e)}function U(e,t){const i=e.$$.callbacks[t.type];i&&i.slice().forEach((e=>e.call(this,t)))}const V=[],G=[],q=[],W=[],H=Promise.resolve();let Z=!1;function X(){Z||(Z=!0,H.then(te))}function K(){return X(),H}function Y(e){q.push(e)}function J(e){W.push(e)}const Q=new Set;let ee=0;function te(){const e=R;do{for(;ee<V.length;){const e=V[ee];ee++,B(e),ie(e.$$)}for(B(null),V.length=0,ee=0;G.length;)G.pop()();for(let e=0;e<q.length;e+=1){const t=q[e];Q.has(t)||(Q.add(t),t())}q.length=0}while(V.length);for(;W.length;)W.pop()();Z=!1,Q.clear(),B(e)}function ie(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}const ne=new Set;let re;function oe(){re={r:0,c:[],p:re}}function se(){re.r||s(re.c),re=re.p}function ae(e,t){e&&e.i&&(ne.delete(e),e.i(t))}function le(e,t,i,n){if(e&&e.o){if(ne.has(e))return;ne.add(e),re.c.push((()=>{ne.delete(e),n&&(i&&e.d(1),n())})),e.o(t)}}const ce="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ue(e,t){le(e,1,1,(()=>{t.delete(e.key)}))}function he(e,t,i,n,r,o,s,a,l,c,u,h){let d=e.length,p=o.length,f=d;const m={};for(;f--;)m[e[f].key]=f;const g=[],y=new Map,_=new Map;for(f=p;f--;){const e=h(r,o,f),a=i(e);let l=s.get(a);l?n&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,g[f]=l),a in m&&_.set(a,Math.abs(f-m[a]))}const v=new Set,x=new Set;function b(e){ae(e,1),e.m(a,u),s.set(e.key,e),u=e.first,p--}for(;d&&p;){const t=g[p-1],i=e[d-1],n=t.key,r=i.key;t===i?(u=t.first,d--,p--):y.has(r)?!s.has(n)||v.has(n)?b(t):x.has(r)?d--:_.get(n)>_.get(r)?(x.add(n),b(t)):(v.add(r),d--):(l(i,s),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,s)}for(;p;)b(g[p-1]);return g}function de(e,t){const i={},n={},r={$$scope:1};let o=e.length;for(;o--;){const s=e[o],a=t[o];if(a){for(const e in s)e in a||(n[e]=1);for(const e in a)r[e]||(i[e]=a[e],r[e]=1);e[o]=a}else for(const e in s)r[e]=1}for(const e in n)e in i||(i[e]=void 0);return i}function pe(e){return"object"==typeof e&&null!==e?e:{}}function fe(e,t,i){const n=e.$$.props[t];void 0!==n&&(e.$$.bound[n]=i,i(e.$$.ctx[n]))}function me(e){e&&e.c()}function ge(e,t,i,n){const{fragment:o,on_mount:l,on_destroy:c,after_update:u}=e.$$;o&&o.m(t,i),n||Y((()=>{const t=l.map(r).filter(a);c?c.push(...t):s(t),e.$$.on_mount=[]})),u.forEach(Y)}function ye(e,t){const i=e.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function _e(e,t,n,r,a,l,c,u=[-1]){const h=R;B(e);const d=e.$$={fragment:null,ctx:null,props:l,update:i,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:o(),dirty:u,skip_bound:!1,root:t.target||h.$$.root};c&&c(d.root);let p=!1;if(d.ctx=n?n(e,t.props||{},((t,i,...n)=>{const r=n.length?n[0]:i;return d.ctx&&a(d.ctx[t],d.ctx[t]=r)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](r),p&&function(e,t){-1===e.$$.dirty[0]&&(V.push(e),X(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),i})):[],d.update(),p=!0,s(d.before_update),d.fragment=!!r&&r(d.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);d.fragment&&d.fragment.l(e),e.forEach(x)}else d.fragment&&d.fragment.c();t.intro&&ae(e.$$.fragment),ge(e,t.target,t.anchor,t.customElement),te()}B(h)}class ve{$destroy(){ye(this,1),this.$destroy=i}$on(e,t){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function be(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var we,Te,ke={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */we=ke,Te=ke.exports,function(){var e,t="Expected a function",i="__lodash_hash_undefined__",n="__lodash_placeholder__",r=16,o=32,s=64,a=128,l=256,c=1/0,u=9007199254740991,h=NaN,d=4294967295,p=[["ary",a],["bind",1],["bindKey",2],["curry",8],["curryRight",r],["flip",512],["partial",o],["partialRight",s],["rearg",l]],f="[object Arguments]",m="[object Array]",g="[object Boolean]",y="[object Date]",_="[object Error]",v="[object Function]",x="[object GeneratorFunction]",b="[object Map]",w="[object Number]",T="[object Object]",k="[object Promise]",S="[object RegExp]",C="[object Set]",E="[object String]",M="[object Symbol]",A="[object WeakMap]",z="[object ArrayBuffer]",I="[object DataView]",L="[object Float32Array]",D="[object Float64Array]",P="[object Int8Array]",O="[object Int16Array]",R="[object Int32Array]",B="[object Uint8Array]",F="[object Uint8ClampedArray]",$="[object Uint16Array]",j="[object Uint32Array]",N=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,W=RegExp(G.source),H=RegExp(q.source),Z=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ee=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ee.source),ie=/^\s+/,ne=/\s/,re=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,se=/,? & /,ae=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,le=/[()=,{}\[\]\/\s]/,ce=/\\(\\)?/g,ue=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,de=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,fe=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_e=/($^)/,ve=/['\n\r\u2028\u2029\\]/g,be="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ke="\\u2700-\\u27bf",Se="a-z\\xdf-\\xf6\\xf8-\\xff",Ce="A-Z\\xc0-\\xd6\\xd8-\\xde",Ee="\\ufe0e\\ufe0f",Me="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ae="['’]",ze="[\\ud800-\\udfff]",Ie="["+Me+"]",Le="["+be+"]",De="\\d+",Pe="[\\u2700-\\u27bf]",Oe="["+Se+"]",Re="[^\\ud800-\\udfff"+Me+De+ke+Se+Ce+"]",Be="\\ud83c[\\udffb-\\udfff]",Fe="[^\\ud800-\\udfff]",$e="(?:\\ud83c[\\udde6-\\uddff]){2}",je="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="["+Ce+"]",Ue="(?:"+Oe+"|"+Re+")",Ve="(?:"+Ne+"|"+Re+")",Ge="(?:['’](?:d|ll|m|re|s|t|ve))?",qe="(?:['’](?:D|LL|M|RE|S|T|VE))?",We="(?:"+Le+"|"+Be+")?",He="[\\ufe0e\\ufe0f]?",Ze=He+We+"(?:\\u200d(?:"+[Fe,$e,je].join("|")+")"+He+We+")*",Xe="(?:"+[Pe,$e,je].join("|")+")"+Ze,Ke="(?:"+[Fe+Le+"?",Le,$e,je,ze].join("|")+")",Ye=RegExp(Ae,"g"),Je=RegExp(Le,"g"),Qe=RegExp(Be+"(?="+Be+")|"+Ke+Ze,"g"),et=RegExp([Ne+"?"+Oe+"+"+Ge+"(?="+[Ie,Ne,"$"].join("|")+")",Ve+"+"+qe+"(?="+[Ie,Ne+Ue,"$"].join("|")+")",Ne+"?"+Ue+"+"+Ge,Ne+"+"+qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",De,Xe].join("|"),"g"),tt=RegExp("[\\u200d\\ud800-\\udfff"+be+Ee+"]"),it=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],rt=-1,ot={};ot[L]=ot[D]=ot[P]=ot[O]=ot[R]=ot[B]=ot[F]=ot[$]=ot[j]=!0,ot[f]=ot[m]=ot[z]=ot[g]=ot[I]=ot[y]=ot[_]=ot[v]=ot[b]=ot[w]=ot[T]=ot[S]=ot[C]=ot[E]=ot[A]=!1;var st={};st[f]=st[m]=st[z]=st[I]=st[g]=st[y]=st[L]=st[D]=st[P]=st[O]=st[R]=st[b]=st[w]=st[T]=st[S]=st[C]=st[E]=st[M]=st[B]=st[F]=st[$]=st[j]=!0,st[_]=st[v]=st[A]=!1;var at={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},lt=parseFloat,ct=parseInt,ut="object"==typeof xe&&xe&&xe.Object===Object&&xe,ht="object"==typeof self&&self&&self.Object===Object&&self,dt=ut||ht||Function("return this")(),pt=Te&&!Te.nodeType&&Te,ft=pt&&we&&!we.nodeType&&we,mt=ft&&ft.exports===pt,gt=mt&&ut.process,yt=function(){try{var e=ft&&ft.require&&ft.require("util").types;return e||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),_t=yt&&yt.isArrayBuffer,vt=yt&&yt.isDate,xt=yt&&yt.isMap,bt=yt&&yt.isRegExp,wt=yt&&yt.isSet,Tt=yt&&yt.isTypedArray;function kt(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function St(e,t,i,n){for(var r=-1,o=null==e?0:e.length;++r<o;){var s=e[r];t(n,s,i(s),e)}return n}function Ct(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e}function Et(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}function Mt(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(!t(e[i],i,e))return!1;return!0}function At(e,t){for(var i=-1,n=null==e?0:e.length,r=0,o=[];++i<n;){var s=e[i];t(s,i,e)&&(o[r++]=s)}return o}function zt(e,t){return!(null==e||!e.length)&&jt(e,t,0)>-1}function It(e,t,i){for(var n=-1,r=null==e?0:e.length;++n<r;)if(i(t,e[n]))return!0;return!1}function Lt(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r}function Dt(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}function Pt(e,t,i,n){var r=-1,o=null==e?0:e.length;for(n&&o&&(i=e[++r]);++r<o;)i=t(i,e[r],r,e);return i}function Ot(e,t,i,n){var r=null==e?0:e.length;for(n&&r&&(i=e[--r]);r--;)i=t(i,e[r],r,e);return i}function Rt(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1}var Bt=Gt("length");function Ft(e,t,i){var n;return i(e,(function(e,i,r){if(t(e,i,r))return n=i,!1})),n}function $t(e,t,i,n){for(var r=e.length,o=i+(n?1:-1);n?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function jt(e,t,i){return t==t?function(e,t,i){for(var n=i-1,r=e.length;++n<r;)if(e[n]===t)return n;return-1}(e,t,i):$t(e,Ut,i)}function Nt(e,t,i,n){for(var r=i-1,o=e.length;++r<o;)if(n(e[r],t))return r;return-1}function Ut(e){return e!=e}function Vt(e,t){var i=null==e?0:e.length;return i?Ht(e,t)/i:h}function Gt(t){return function(i){return null==i?e:i[t]}}function qt(t){return function(i){return null==t?e:t[i]}}function Wt(e,t,i,n,r){return r(e,(function(e,r,o){i=n?(n=!1,e):t(i,e,r,o)})),i}function Ht(t,i){for(var n,r=-1,o=t.length;++r<o;){var s=i(t[r]);s!==e&&(n=n===e?s:n+s)}return n}function Zt(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}function Xt(e){return e?e.slice(0,pi(e)+1).replace(ie,""):e}function Kt(e){return function(t){return e(t)}}function Yt(e,t){return Lt(t,(function(t){return e[t]}))}function Jt(e,t){return e.has(t)}function Qt(e,t){for(var i=-1,n=e.length;++i<n&&jt(t,e[i],0)>-1;);return i}function ei(e,t){for(var i=e.length;i--&&jt(t,e[i],0)>-1;);return i}function ti(e,t){for(var i=e.length,n=0;i--;)e[i]===t&&++n;return n}var ii=qt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),ni=qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ri(e){return"\\"+at[e]}function oi(e){return tt.test(e)}function si(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i}function ai(e,t){return function(i){return e(t(i))}}function li(e,t){for(var i=-1,r=e.length,o=0,s=[];++i<r;){var a=e[i];a!==t&&a!==n||(e[i]=n,s[o++]=i)}return s}function ci(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}function ui(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=[e,e]})),i}function hi(e){return oi(e)?function(e){for(var t=Qe.lastIndex=0;Qe.test(e);)++t;return t}(e):Bt(e)}function di(e){return oi(e)?function(e){return e.match(Qe)||[]}(e):function(e){return e.split("")}(e)}function pi(e){for(var t=e.length;t--&&ne.test(e.charAt(t)););return t}var fi=qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),mi=function ne(xe){var be,we=(xe=null==xe?dt:mi.defaults(dt.Object(),xe,mi.pick(dt,nt))).Array,Te=xe.Date,ke=xe.Error,Se=xe.Function,Ce=xe.Math,Ee=xe.Object,Me=xe.RegExp,Ae=xe.String,ze=xe.TypeError,Ie=we.prototype,Le=Se.prototype,De=Ee.prototype,Pe=xe["__core-js_shared__"],Oe=Le.toString,Re=De.hasOwnProperty,Be=0,Fe=(be=/[^.]+$/.exec(Pe&&Pe.keys&&Pe.keys.IE_PROTO||""))?"Symbol(src)_1."+be:"",$e=De.toString,je=Oe.call(Ee),Ne=dt._,Ue=Me("^"+Oe.call(Re).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=mt?xe.Buffer:e,Ge=xe.Symbol,qe=xe.Uint8Array,We=Ve?Ve.allocUnsafe:e,He=ai(Ee.getPrototypeOf,Ee),Ze=Ee.create,Xe=De.propertyIsEnumerable,Ke=Ie.splice,Qe=Ge?Ge.isConcatSpreadable:e,tt=Ge?Ge.iterator:e,at=Ge?Ge.toStringTag:e,ut=function(){try{var e=fo(Ee,"defineProperty");return e({},"",{}),e}catch(e){}}(),ht=xe.clearTimeout!==dt.clearTimeout&&xe.clearTimeout,pt=Te&&Te.now!==dt.Date.now&&Te.now,ft=xe.setTimeout!==dt.setTimeout&&xe.setTimeout,gt=Ce.ceil,yt=Ce.floor,Bt=Ee.getOwnPropertySymbols,qt=Ve?Ve.isBuffer:e,gi=xe.isFinite,yi=Ie.join,_i=ai(Ee.keys,Ee),vi=Ce.max,xi=Ce.min,bi=Te.now,wi=xe.parseInt,Ti=Ce.random,ki=Ie.reverse,Si=fo(xe,"DataView"),Ci=fo(xe,"Map"),Ei=fo(xe,"Promise"),Mi=fo(xe,"Set"),Ai=fo(xe,"WeakMap"),zi=fo(Ee,"create"),Ii=Ai&&new Ai,Li={},Di=No(Si),Pi=No(Ci),Oi=No(Ei),Ri=No(Mi),Bi=No(Ai),Fi=Ge?Ge.prototype:e,$i=Fi?Fi.valueOf:e,ji=Fi?Fi.toString:e;function Ni(e){if(ra(e)&&!Hs(e)&&!(e instanceof qi)){if(e instanceof Gi)return e;if(Re.call(e,"__wrapped__"))return Uo(e)}return new Gi(e)}var Ui=function(){function t(){}return function(i){if(!na(i))return{};if(Ze)return Ze(i);t.prototype=i;var n=new t;return t.prototype=e,n}}();function Vi(){}function Gi(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=e}function qi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Wi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Hi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Zi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Xi(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Zi;++t<i;)this.add(e[t])}function Ki(e){var t=this.__data__=new Hi(e);this.size=t.size}function Yi(e,t){var i=Hs(e),n=!i&&Ws(e),r=!i&&!n&&Ys(e),o=!i&&!n&&!r&&da(e),s=i||n||r||o,a=s?Zt(e.length,Ae):[],l=a.length;for(var c in e)!t&&!Re.call(e,c)||s&&("length"==c||r&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||bo(c,l))||a.push(c);return a}function Ji(t){var i=t.length;return i?t[Kn(0,i-1)]:e}function Qi(e,t){return Fo(Ir(e),cn(t,0,e.length))}function en(e){return Fo(Ir(e))}function tn(t,i,n){(n!==e&&!Vs(t[i],n)||n===e&&!(i in t))&&an(t,i,n)}function nn(t,i,n){var r=t[i];Re.call(t,i)&&Vs(r,n)&&(n!==e||i in t)||an(t,i,n)}function rn(e,t){for(var i=e.length;i--;)if(Vs(e[i][0],t))return i;return-1}function on(e,t,i,n){return fn(e,(function(e,r,o){t(n,e,i(e),o)})),n}function sn(e,t){return e&&Lr(t,Pa(t),e)}function an(e,t,i){"__proto__"==t&&ut?ut(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function ln(t,i){for(var n=-1,r=i.length,o=we(r),s=null==t;++n<r;)o[n]=s?e:Aa(t,i[n]);return o}function cn(t,i,n){return t==t&&(n!==e&&(t=t<=n?t:n),i!==e&&(t=t>=i?t:i)),t}function un(t,i,n,r,o,s){var a,l=1&i,c=2&i,u=4&i;if(n&&(a=o?n(t,r,o,s):n(t)),a!==e)return a;if(!na(t))return t;var h=Hs(t);if(h){if(a=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Re.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(t),!l)return Ir(t,a)}else{var d=yo(t),p=d==v||d==x;if(Ys(t))return Sr(t,l);if(d==T||d==f||p&&!o){if(a=c||p?{}:vo(t),!l)return c?function(e,t){return Lr(e,go(e),t)}(t,function(e,t){return e&&Lr(t,Oa(t),e)}(a,t)):function(e,t){return Lr(e,mo(e),t)}(t,sn(a,t))}else{if(!st[d])return o?t:{};a=function(e,t,i){var n,r=e.constructor;switch(t){case z:return Cr(e);case g:case y:return new r(+e);case I:return function(e,t){var i=t?Cr(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case L:case D:case P:case O:case R:case B:case F:case $:case j:return Er(e,i);case b:return new r;case w:case E:return new r(e);case S:return function(e){var t=new e.constructor(e.source,he.exec(e));return t.lastIndex=e.lastIndex,t}(e);case C:return new r;case M:return n=e,$i?Ee($i.call(n)):{}}}(t,d,l)}}s||(s=new Ki);var m=s.get(t);if(m)return m;s.set(t,a),ca(t)?t.forEach((function(e){a.add(un(e,i,n,e,t,s))})):oa(t)&&t.forEach((function(e,r){a.set(r,un(e,i,n,r,t,s))}));var _=h?e:(u?c?so:oo:c?Oa:Pa)(t);return Ct(_||t,(function(e,r){_&&(e=t[r=e]),nn(a,r,un(e,i,n,r,t,s))})),a}function hn(t,i,n){var r=n.length;if(null==t)return!r;for(t=Ee(t);r--;){var o=n[r],s=i[o],a=t[o];if(a===e&&!(o in t)||!s(a))return!1}return!0}function dn(i,n,r){if("function"!=typeof i)throw new ze(t);return Po((function(){i.apply(e,r)}),n)}function pn(e,t,i,n){var r=-1,o=zt,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;i&&(t=Lt(t,Kt(i))),n?(o=It,s=!1):t.length>=200&&(o=Jt,s=!1,t=new Xi(t));e:for(;++r<a;){var u=e[r],h=null==i?u:i(u);if(u=n||0!==u?u:0,s&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else o(t,h,n)||l.push(u)}return l}Ni.templateSettings={escape:Z,evaluate:X,interpolate:K,variable:"",imports:{_:Ni}},Ni.prototype=Vi.prototype,Ni.prototype.constructor=Ni,Gi.prototype=Ui(Vi.prototype),Gi.prototype.constructor=Gi,qi.prototype=Ui(Vi.prototype),qi.prototype.constructor=qi,Wi.prototype.clear=function(){this.__data__=zi?zi(null):{},this.size=0},Wi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Wi.prototype.get=function(t){var n=this.__data__;if(zi){var r=n[t];return r===i?e:r}return Re.call(n,t)?n[t]:e},Wi.prototype.has=function(t){var i=this.__data__;return zi?i[t]!==e:Re.call(i,t)},Wi.prototype.set=function(t,n){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=zi&&n===e?i:n,this},Hi.prototype.clear=function(){this.__data__=[],this.size=0},Hi.prototype.delete=function(e){var t=this.__data__,i=rn(t,e);return!(i<0||(i==t.length-1?t.pop():Ke.call(t,i,1),--this.size,0))},Hi.prototype.get=function(t){var i=this.__data__,n=rn(i,t);return n<0?e:i[n][1]},Hi.prototype.has=function(e){return rn(this.__data__,e)>-1},Hi.prototype.set=function(e,t){var i=this.__data__,n=rn(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this},Zi.prototype.clear=function(){this.size=0,this.__data__={hash:new Wi,map:new(Ci||Hi),string:new Wi}},Zi.prototype.delete=function(e){var t=ho(this,e).delete(e);return this.size-=t?1:0,t},Zi.prototype.get=function(e){return ho(this,e).get(e)},Zi.prototype.has=function(e){return ho(this,e).has(e)},Zi.prototype.set=function(e,t){var i=ho(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this},Xi.prototype.add=Xi.prototype.push=function(e){return this.__data__.set(e,i),this},Xi.prototype.has=function(e){return this.__data__.has(e)},Ki.prototype.clear=function(){this.__data__=new Hi,this.size=0},Ki.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Ki.prototype.get=function(e){return this.__data__.get(e)},Ki.prototype.has=function(e){return this.__data__.has(e)},Ki.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Hi){var n=i.__data__;if(!Ci||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Zi(n)}return i.set(e,t),this.size=i.size,this};var fn=Or(wn),mn=Or(Tn,!0);function gn(e,t){var i=!0;return fn(e,(function(e,n,r){return i=!!t(e,n,r)})),i}function yn(t,i,n){for(var r=-1,o=t.length;++r<o;){var s=t[r],a=i(s);if(null!=a&&(l===e?a==a&&!ha(a):n(a,l)))var l=a,c=s}return c}function _n(e,t){var i=[];return fn(e,(function(e,n,r){t(e,n,r)&&i.push(e)})),i}function vn(e,t,i,n,r){var o=-1,s=e.length;for(i||(i=xo),r||(r=[]);++o<s;){var a=e[o];t>0&&i(a)?t>1?vn(a,t-1,i,n,r):Dt(r,a):n||(r[r.length]=a)}return r}var xn=Rr(),bn=Rr(!0);function wn(e,t){return e&&xn(e,t,Pa)}function Tn(e,t){return e&&bn(e,t,Pa)}function kn(e,t){return At(t,(function(t){return ea(e[t])}))}function Sn(t,i){for(var n=0,r=(i=br(i,t)).length;null!=t&&n<r;)t=t[jo(i[n++])];return n&&n==r?t:e}function Cn(e,t,i){var n=t(e);return Hs(e)?n:Dt(n,i(e))}function En(t){return null==t?t===e?"[object Undefined]":"[object Null]":at&&at in Ee(t)?function(t){var i=Re.call(t,at),n=t[at];try{t[at]=e;var r=!0}catch(e){}var o=$e.call(t);return r&&(i?t[at]=n:delete t[at]),o}(t):function(e){return $e.call(e)}(t)}function Mn(e,t){return e>t}function An(e,t){return null!=e&&Re.call(e,t)}function zn(e,t){return null!=e&&t in Ee(e)}function In(t,i,n){for(var r=n?It:zt,o=t[0].length,s=t.length,a=s,l=we(s),c=1/0,u=[];a--;){var h=t[a];a&&i&&(h=Lt(h,Kt(i))),c=xi(h.length,c),l[a]=!n&&(i||o>=120&&h.length>=120)?new Xi(a&&h):e}h=t[0];var d=-1,p=l[0];e:for(;++d<o&&u.length<c;){var f=h[d],m=i?i(f):f;if(f=n||0!==f?f:0,!(p?Jt(p,m):r(u,m,n))){for(a=s;--a;){var g=l[a];if(!(g?Jt(g,m):r(t[a],m,n)))continue e}p&&p.push(m),u.push(f)}}return u}function Ln(t,i,n){var r=null==(t=zo(t,i=br(i,t)))?t:t[jo(Qo(i))];return null==r?e:kt(r,t,n)}function Dn(e){return ra(e)&&En(e)==f}function Pn(t,i,n,r,o){return t===i||(null==t||null==i||!ra(t)&&!ra(i)?t!=t&&i!=i:function(t,i,n,r,o,s){var a=Hs(t),l=Hs(i),c=a?m:yo(t),u=l?m:yo(i),h=(c=c==f?T:c)==T,d=(u=u==f?T:u)==T,p=c==u;if(p&&Ys(t)){if(!Ys(i))return!1;a=!0,h=!1}if(p&&!h)return s||(s=new Ki),a||da(t)?no(t,i,n,r,o,s):function(e,t,i,n,r,o,s){switch(i){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case z:return!(e.byteLength!=t.byteLength||!o(new qe(e),new qe(t)));case g:case y:case w:return Vs(+e,+t);case _:return e.name==t.name&&e.message==t.message;case S:case E:return e==t+"";case b:var a=si;case C:var l=1&n;if(a||(a=ci),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var u=no(a(e),a(t),n,r,o,s);return s.delete(e),u;case M:if($i)return $i.call(e)==$i.call(t)}return!1}(t,i,c,n,r,o,s);if(!(1&n)){var v=h&&Re.call(t,"__wrapped__"),x=d&&Re.call(i,"__wrapped__");if(v||x){var k=v?t.value():t,A=x?i.value():i;return s||(s=new Ki),o(k,A,n,r,s)}}return!!p&&(s||(s=new Ki),function(t,i,n,r,o,s){var a=1&n,l=oo(t),c=l.length,u=oo(i).length;if(c!=u&&!a)return!1;for(var h=c;h--;){var d=l[h];if(!(a?d in i:Re.call(i,d)))return!1}var p=s.get(t),f=s.get(i);if(p&&f)return p==i&&f==t;var m=!0;s.set(t,i),s.set(i,t);for(var g=a;++h<c;){var y=t[d=l[h]],_=i[d];if(r)var v=a?r(_,y,d,i,t,s):r(y,_,d,t,i,s);if(!(v===e?y===_||o(y,_,n,r,s):v)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,b=i.constructor;x==b||!("constructor"in t)||!("constructor"in i)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(m=!1)}return s.delete(t),s.delete(i),m}(t,i,n,r,o,s))}(t,i,n,r,Pn,o))}function On(t,i,n,r){var o=n.length,s=o,a=!r;if(null==t)return!s;for(t=Ee(t);o--;){var l=n[o];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++o<s;){var c=(l=n[o])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===e&&!(c in t))return!1}else{var d=new Ki;if(r)var p=r(u,h,c,t,i,d);if(!(p===e?Pn(h,u,3,r,d):p))return!1}}return!0}function Rn(e){return!(!na(e)||function(e){return!!Fe&&Fe in e}(e))&&(ea(e)?Ue:fe).test(No(e))}function Bn(e){return"function"==typeof e?e:null==e?sl:"object"==typeof e?Hs(e)?Vn(e[0],e[1]):Un(e):ml(e)}function Fn(e){if(!Co(e))return _i(e);var t=[];for(var i in Ee(e))Re.call(e,i)&&"constructor"!=i&&t.push(i);return t}function $n(e){if(!na(e))return function(e){var t=[];if(null!=e)for(var i in Ee(e))t.push(i);return t}(e);var t=Co(e),i=[];for(var n in e)("constructor"!=n||!t&&Re.call(e,n))&&i.push(n);return i}function jn(e,t){return e<t}function Nn(e,t){var i=-1,n=Xs(e)?we(e.length):[];return fn(e,(function(e,r,o){n[++i]=t(e,r,o)})),n}function Un(e){var t=po(e);return 1==t.length&&t[0][2]?Mo(t[0][0],t[0][1]):function(i){return i===e||On(i,e,t)}}function Vn(t,i){return To(t)&&Eo(i)?Mo(jo(t),i):function(n){var r=Aa(n,t);return r===e&&r===i?za(n,t):Pn(i,r,3)}}function Gn(t,i,n,r,o){t!==i&&xn(i,(function(s,a){if(o||(o=new Ki),na(s))!function(t,i,n,r,o,s,a){var l=Lo(t,n),c=Lo(i,n),u=a.get(c);if(u)tn(t,n,u);else{var h=s?s(l,c,n+"",t,i,a):e,d=h===e;if(d){var p=Hs(c),f=!p&&Ys(c),m=!p&&!f&&da(c);h=c,p||f||m?Hs(l)?h=l:Ks(l)?h=Ir(l):f?(d=!1,h=Sr(c,!0)):m?(d=!1,h=Er(c,!0)):h=[]:aa(c)||Ws(c)?(h=l,Ws(l)?h=xa(l):na(l)&&!ea(l)||(h=vo(c))):d=!1}d&&(a.set(c,h),o(h,c,r,s,a),a.delete(c)),tn(t,n,h)}}(t,i,a,n,Gn,r,o);else{var l=r?r(Lo(t,a),s,a+"",t,i,o):e;l===e&&(l=s),tn(t,a,l)}}),Oa)}function qn(t,i){var n=t.length;if(n)return bo(i+=i<0?n:0,n)?t[i]:e}function Wn(e,t,i){t=t.length?Lt(t,(function(e){return Hs(e)?function(t){return Sn(t,1===e.length?e[0]:e)}:e})):[sl];var n=-1;t=Lt(t,Kt(uo()));var r=Nn(e,(function(e,i,r){var o=Lt(t,(function(t){return t(e)}));return{criteria:o,index:++n,value:e}}));return function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(r,(function(e,t){return function(e,t,i){for(var n=-1,r=e.criteria,o=t.criteria,s=r.length,a=i.length;++n<s;){var l=Mr(r[n],o[n]);if(l)return n>=a?l:l*("desc"==i[n]?-1:1)}return e.index-t.index}(e,t,i)}))}function Hn(e,t,i){for(var n=-1,r=t.length,o={};++n<r;){var s=t[n],a=Sn(e,s);i(a,s)&&tr(o,br(s,e),a)}return o}function Zn(e,t,i,n){var r=n?Nt:jt,o=-1,s=t.length,a=e;for(e===t&&(t=Ir(t)),i&&(a=Lt(e,Kt(i)));++o<s;)for(var l=0,c=t[o],u=i?i(c):c;(l=r(a,u,l,n))>-1;)a!==e&&Ke.call(a,l,1),Ke.call(e,l,1);return e}function Xn(e,t){for(var i=e?t.length:0,n=i-1;i--;){var r=t[i];if(i==n||r!==o){var o=r;bo(r)?Ke.call(e,r,1):pr(e,r)}}return e}function Kn(e,t){return e+yt(Ti()*(t-e+1))}function Yn(e,t){var i="";if(!e||t<1||t>u)return i;do{t%2&&(i+=e),(t=yt(t/2))&&(e+=e)}while(t);return i}function Jn(e,t){return Oo(Ao(e,t,sl),e+"")}function Qn(e){return Ji(Va(e))}function er(e,t){var i=Va(e);return Fo(i,cn(t,0,i.length))}function tr(t,i,n,r){if(!na(t))return t;for(var o=-1,s=(i=br(i,t)).length,a=s-1,l=t;null!=l&&++o<s;){var c=jo(i[o]),u=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(o!=a){var h=l[c];(u=r?r(h,c,l):e)===e&&(u=na(h)?h:bo(i[o+1])?[]:{})}nn(l,c,u),l=l[c]}return t}var ir=Ii?function(e,t){return Ii.set(e,t),e}:sl,nr=ut?function(e,t){return ut(e,"toString",{configurable:!0,enumerable:!1,value:nl(t),writable:!0})}:sl;function rr(e){return Fo(Va(e))}function or(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var o=we(r);++n<r;)o[n]=e[n+t];return o}function sr(e,t){var i;return fn(e,(function(e,n,r){return!(i=t(e,n,r))})),!!i}function ar(e,t,i){var n=0,r=null==e?n:e.length;if("number"==typeof t&&t==t&&r<=2147483647){for(;n<r;){var o=n+r>>>1,s=e[o];null!==s&&!ha(s)&&(i?s<=t:s<t)?n=o+1:r=o}return r}return lr(e,t,sl,i)}function lr(t,i,n,r){var o=0,s=null==t?0:t.length;if(0===s)return 0;for(var a=(i=n(i))!=i,l=null===i,c=ha(i),u=i===e;o<s;){var h=yt((o+s)/2),d=n(t[h]),p=d!==e,f=null===d,m=d==d,g=ha(d);if(a)var y=r||m;else y=u?m&&(r||p):l?m&&p&&(r||!f):c?m&&p&&!f&&(r||!g):!f&&!g&&(r?d<=i:d<i);y?o=h+1:s=h}return xi(s,4294967294)}function cr(e,t){for(var i=-1,n=e.length,r=0,o=[];++i<n;){var s=e[i],a=t?t(s):s;if(!i||!Vs(a,l)){var l=a;o[r++]=0===s?0:s}}return o}function ur(e){return"number"==typeof e?e:ha(e)?h:+e}function hr(e){if("string"==typeof e)return e;if(Hs(e))return Lt(e,hr)+"";if(ha(e))return ji?ji.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function dr(e,t,i){var n=-1,r=zt,o=e.length,s=!0,a=[],l=a;if(i)s=!1,r=It;else if(o>=200){var c=t?null:Yr(e);if(c)return ci(c);s=!1,r=Jt,l=new Xi}else l=t?[]:a;e:for(;++n<o;){var u=e[n],h=t?t(u):u;if(u=i||0!==u?u:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),a.push(u)}else r(l,h,i)||(l!==a&&l.push(h),a.push(u))}return a}function pr(e,t){return null==(e=zo(e,t=br(t,e)))||delete e[jo(Qo(t))]}function fr(e,t,i,n){return tr(e,t,i(Sn(e,t)),n)}function mr(e,t,i,n){for(var r=e.length,o=n?r:-1;(n?o--:++o<r)&&t(e[o],o,e););return i?or(e,n?0:o,n?o+1:r):or(e,n?o+1:0,n?r:o)}function gr(e,t){var i=e;return i instanceof qi&&(i=i.value()),Pt(t,(function(e,t){return t.func.apply(t.thisArg,Dt([e],t.args))}),i)}function yr(e,t,i){var n=e.length;if(n<2)return n?dr(e[0]):[];for(var r=-1,o=we(n);++r<n;)for(var s=e[r],a=-1;++a<n;)a!=r&&(o[r]=pn(o[r]||s,e[a],t,i));return dr(vn(o,1),t,i)}function _r(t,i,n){for(var r=-1,o=t.length,s=i.length,a={};++r<o;){var l=r<s?i[r]:e;n(a,t[r],l)}return a}function vr(e){return Ks(e)?e:[]}function xr(e){return"function"==typeof e?e:sl}function br(e,t){return Hs(e)?e:To(e,t)?[e]:$o(ba(e))}var wr=Jn;function Tr(t,i,n){var r=t.length;return n=n===e?r:n,!i&&n>=r?t:or(t,i,n)}var kr=ht||function(e){return dt.clearTimeout(e)};function Sr(e,t){if(t)return e.slice();var i=e.length,n=We?We(i):new e.constructor(i);return e.copy(n),n}function Cr(e){var t=new e.constructor(e.byteLength);return new qe(t).set(new qe(e)),t}function Er(e,t){var i=t?Cr(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function Mr(t,i){if(t!==i){var n=t!==e,r=null===t,o=t==t,s=ha(t),a=i!==e,l=null===i,c=i==i,u=ha(i);if(!l&&!u&&!s&&t>i||s&&a&&c&&!l&&!u||r&&a&&c||!n&&c||!o)return 1;if(!r&&!s&&!u&&t<i||u&&n&&o&&!r&&!s||l&&n&&o||!a&&o||!c)return-1}return 0}function Ar(e,t,i,n){for(var r=-1,o=e.length,s=i.length,a=-1,l=t.length,c=vi(o-s,0),u=we(l+c),h=!n;++a<l;)u[a]=t[a];for(;++r<s;)(h||r<o)&&(u[i[r]]=e[r]);for(;c--;)u[a++]=e[r++];return u}function zr(e,t,i,n){for(var r=-1,o=e.length,s=-1,a=i.length,l=-1,c=t.length,u=vi(o-a,0),h=we(u+c),d=!n;++r<u;)h[r]=e[r];for(var p=r;++l<c;)h[p+l]=t[l];for(;++s<a;)(d||r<o)&&(h[p+i[s]]=e[r++]);return h}function Ir(e,t){var i=-1,n=e.length;for(t||(t=we(n));++i<n;)t[i]=e[i];return t}function Lr(t,i,n,r){var o=!n;n||(n={});for(var s=-1,a=i.length;++s<a;){var l=i[s],c=r?r(n[l],t[l],l,n,t):e;c===e&&(c=t[l]),o?an(n,l,c):nn(n,l,c)}return n}function Dr(e,t){return function(i,n){var r=Hs(i)?St:on,o=t?t():{};return r(i,e,uo(n,2),o)}}function Pr(t){return Jn((function(i,n){var r=-1,o=n.length,s=o>1?n[o-1]:e,a=o>2?n[2]:e;for(s=t.length>3&&"function"==typeof s?(o--,s):e,a&&wo(n[0],n[1],a)&&(s=o<3?e:s,o=1),i=Ee(i);++r<o;){var l=n[r];l&&t(i,l,r,s)}return i}))}function Or(e,t){return function(i,n){if(null==i)return i;if(!Xs(i))return e(i,n);for(var r=i.length,o=t?r:-1,s=Ee(i);(t?o--:++o<r)&&!1!==n(s[o],o,s););return i}}function Rr(e){return function(t,i,n){for(var r=-1,o=Ee(t),s=n(t),a=s.length;a--;){var l=s[e?a:++r];if(!1===i(o[l],l,o))break}return t}}function Br(t){return function(i){var n=oi(i=ba(i))?di(i):e,r=n?n[0]:i.charAt(0),o=n?Tr(n,1).join(""):i.slice(1);return r[t]()+o}}function Fr(e){return function(t){return Pt(el(Wa(t).replace(Ye,"")),e,"")}}function $r(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Ui(e.prototype),n=e.apply(i,t);return na(n)?n:i}}function jr(t){return function(i,n,r){var o=Ee(i);if(!Xs(i)){var s=uo(n,3);i=Pa(i),n=function(e){return s(o[e],e,o)}}var a=t(i,n,r);return a>-1?o[s?i[a]:a]:e}}function Nr(i){return ro((function(n){var r=n.length,o=r,s=Gi.prototype.thru;for(i&&n.reverse();o--;){var a=n[o];if("function"!=typeof a)throw new ze(t);if(s&&!l&&"wrapper"==lo(a))var l=new Gi([],!0)}for(o=l?o:r;++o<r;){var c=lo(a=n[o]),u="wrapper"==c?ao(a):e;l=u&&ko(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[lo(u[0])].apply(l,u[3]):1==a.length&&ko(a)?l[c]():l.thru(a)}return function(){var e=arguments,t=e[0];if(l&&1==e.length&&Hs(t))return l.plant(t).value();for(var i=0,o=r?n[i].apply(this,e):t;++i<r;)o=n[i].call(this,o);return o}}))}function Ur(t,i,n,r,o,s,l,c,u,h){var d=i&a,p=1&i,f=2&i,m=24&i,g=512&i,y=f?e:$r(t);return function e(){for(var a=arguments.length,_=we(a),v=a;v--;)_[v]=arguments[v];if(m)var x=co(e),b=ti(_,x);if(r&&(_=Ar(_,r,o,m)),s&&(_=zr(_,s,l,m)),a-=b,m&&a<h){var w=li(_,x);return Xr(t,i,Ur,e.placeholder,n,_,w,c,u,h-a)}var T=p?n:this,k=f?T[t]:t;return a=_.length,c?_=Io(_,c):g&&a>1&&_.reverse(),d&&u<a&&(_.length=u),this&&this!==dt&&this instanceof e&&(k=y||$r(k)),k.apply(T,_)}}function Vr(e,t){return function(i,n){return function(e,t,i,n){return wn(e,(function(e,r,o){t(n,i(e),r,o)})),n}(i,e,t(n),{})}}function Gr(t,i){return function(n,r){var o;if(n===e&&r===e)return i;if(n!==e&&(o=n),r!==e){if(o===e)return r;"string"==typeof n||"string"==typeof r?(n=hr(n),r=hr(r)):(n=ur(n),r=ur(r)),o=t(n,r)}return o}}function qr(e){return ro((function(t){return t=Lt(t,Kt(uo())),Jn((function(i){var n=this;return e(t,(function(e){return kt(e,n,i)}))}))}))}function Wr(t,i){var n=(i=i===e?" ":hr(i)).length;if(n<2)return n?Yn(i,t):i;var r=Yn(i,gt(t/hi(i)));return oi(i)?Tr(di(r),0,t).join(""):r.slice(0,t)}function Hr(t){return function(i,n,r){return r&&"number"!=typeof r&&wo(i,n,r)&&(n=r=e),i=ga(i),n===e?(n=i,i=0):n=ga(n),function(e,t,i,n){for(var r=-1,o=vi(gt((t-e)/(i||1)),0),s=we(o);o--;)s[n?o:++r]=e,e+=i;return s}(i,n,r=r===e?i<n?1:-1:ga(r),t)}}function Zr(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=va(t),i=va(i)),e(t,i)}}function Xr(t,i,n,r,a,l,c,u,h,d){var p=8&i;i|=p?o:s,4&(i&=~(p?s:o))||(i&=-4);var f=[t,i,a,p?l:e,p?c:e,p?e:l,p?e:c,u,h,d],m=n.apply(e,f);return ko(t)&&Do(m,f),m.placeholder=r,Ro(m,t,i)}function Kr(e){var t=Ce[e];return function(e,i){if(e=va(e),(i=null==i?0:xi(ya(i),292))&&gi(e)){var n=(ba(e)+"e").split("e");return+((n=(ba(t(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(+n[1]-i))}return t(e)}}var Yr=Mi&&1/ci(new Mi([,-0]))[1]==c?function(e){return new Mi(e)}:hl;function Jr(e){return function(t){var i=yo(t);return i==b?si(t):i==C?ui(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Qr(i,c,u,h,d,p,f,m){var g=2&c;if(!g&&"function"!=typeof i)throw new ze(t);var y=h?h.length:0;if(y||(c&=-97,h=d=e),f=f===e?f:vi(ya(f),0),m=m===e?m:ya(m),y-=d?d.length:0,c&s){var _=h,v=d;h=d=e}var x=g?e:ao(i),b=[i,c,u,h,d,_,v,p,f,m];if(x&&function(e,t){var i=e[1],r=t[1],o=i|r,s=o<131,c=r==a&&8==i||r==a&&i==l&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==i;if(!s&&!c)return e;1&r&&(e[2]=t[2],o|=1&i?0:4);var u=t[3];if(u){var h=e[3];e[3]=h?Ar(h,u,t[4]):u,e[4]=h?li(e[3],n):t[4]}(u=t[5])&&(h=e[5],e[5]=h?zr(h,u,t[6]):u,e[6]=h?li(e[5],n):t[6]),(u=t[7])&&(e[7]=u),r&a&&(e[8]=null==e[8]?t[8]:xi(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(b,x),i=b[0],c=b[1],u=b[2],h=b[3],d=b[4],!(m=b[9]=b[9]===e?g?0:i.length:vi(b[9]-y,0))&&24&c&&(c&=-25),c&&1!=c)w=8==c||c==r?function(t,i,n){var r=$r(t);return function o(){for(var s=arguments.length,a=we(s),l=s,c=co(o);l--;)a[l]=arguments[l];var u=s<3&&a[0]!==c&&a[s-1]!==c?[]:li(a,c);return(s-=u.length)<n?Xr(t,i,Ur,o.placeholder,e,a,u,e,e,n-s):kt(this&&this!==dt&&this instanceof o?r:t,this,a)}}(i,c,m):c!=o&&33!=c||d.length?Ur.apply(e,b):function(e,t,i,n){var r=1&t,o=$r(e);return function t(){for(var s=-1,a=arguments.length,l=-1,c=n.length,u=we(c+a),h=this&&this!==dt&&this instanceof t?o:e;++l<c;)u[l]=n[l];for(;a--;)u[l++]=arguments[++s];return kt(h,r?i:this,u)}}(i,c,u,h);else var w=function(e,t,i){var n=1&t,r=$r(e);return function t(){return(this&&this!==dt&&this instanceof t?r:e).apply(n?i:this,arguments)}}(i,c,u);return Ro((x?ir:Do)(w,b),i,c)}function eo(t,i,n,r){return t===e||Vs(t,De[n])&&!Re.call(r,n)?i:t}function to(t,i,n,r,o,s){return na(t)&&na(i)&&(s.set(i,t),Gn(t,i,e,to,s),s.delete(i)),t}function io(t){return aa(t)?e:t}function no(t,i,n,r,o,s){var a=1&n,l=t.length,c=i.length;if(l!=c&&!(a&&c>l))return!1;var u=s.get(t),h=s.get(i);if(u&&h)return u==i&&h==t;var d=-1,p=!0,f=2&n?new Xi:e;for(s.set(t,i),s.set(i,t);++d<l;){var m=t[d],g=i[d];if(r)var y=a?r(g,m,d,i,t,s):r(m,g,d,t,i,s);if(y!==e){if(y)continue;p=!1;break}if(f){if(!Rt(i,(function(e,t){if(!Jt(f,t)&&(m===e||o(m,e,n,r,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!o(m,g,n,r,s)){p=!1;break}}return s.delete(t),s.delete(i),p}function ro(t){return Oo(Ao(t,e,Zo),t+"")}function oo(e){return Cn(e,Pa,mo)}function so(e){return Cn(e,Oa,go)}var ao=Ii?function(e){return Ii.get(e)}:hl;function lo(e){for(var t=e.name+"",i=Li[t],n=Re.call(Li,t)?i.length:0;n--;){var r=i[n],o=r.func;if(null==o||o==e)return r.name}return t}function co(e){return(Re.call(Ni,"placeholder")?Ni:e).placeholder}function uo(){var e=Ni.iteratee||al;return e=e===al?Bn:e,arguments.length?e(arguments[0],arguments[1]):e}function ho(e,t){var i,n,r=e.__data__;return("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function po(e){for(var t=Pa(e),i=t.length;i--;){var n=t[i],r=e[n];t[i]=[n,r,Eo(r)]}return t}function fo(t,i){var n=function(t,i){return null==t?e:t[i]}(t,i);return Rn(n)?n:e}var mo=Bt?function(e){return null==e?[]:(e=Ee(e),At(Bt(e),(function(t){return Xe.call(e,t)})))}:_l,go=Bt?function(e){for(var t=[];e;)Dt(t,mo(e)),e=He(e);return t}:_l,yo=En;function _o(e,t,i){for(var n=-1,r=(t=br(t,e)).length,o=!1;++n<r;){var s=jo(t[n]);if(!(o=null!=e&&i(e,s)))break;e=e[s]}return o||++n!=r?o:!!(r=null==e?0:e.length)&&ia(r)&&bo(s,r)&&(Hs(e)||Ws(e))}function vo(e){return"function"!=typeof e.constructor||Co(e)?{}:Ui(He(e))}function xo(e){return Hs(e)||Ws(e)||!!(Qe&&e&&e[Qe])}function bo(e,t){var i=typeof e;return!!(t=null==t?u:t)&&("number"==i||"symbol"!=i&&ge.test(e))&&e>-1&&e%1==0&&e<t}function wo(e,t,i){if(!na(i))return!1;var n=typeof t;return!!("number"==n?Xs(i)&&bo(t,i.length):"string"==n&&t in i)&&Vs(i[t],e)}function To(e,t){if(Hs(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!ha(e))||J.test(e)||!Y.test(e)||null!=t&&e in Ee(t)}function ko(e){var t=lo(e),i=Ni[t];if("function"!=typeof i||!(t in qi.prototype))return!1;if(e===i)return!0;var n=ao(i);return!!n&&e===n[0]}(Si&&yo(new Si(new ArrayBuffer(1)))!=I||Ci&&yo(new Ci)!=b||Ei&&yo(Ei.resolve())!=k||Mi&&yo(new Mi)!=C||Ai&&yo(new Ai)!=A)&&(yo=function(t){var i=En(t),n=i==T?t.constructor:e,r=n?No(n):"";if(r)switch(r){case Di:return I;case Pi:return b;case Oi:return k;case Ri:return C;case Bi:return A}return i});var So=Pe?ea:vl;function Co(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||De)}function Eo(e){return e==e&&!na(e)}function Mo(t,i){return function(n){return null!=n&&n[t]===i&&(i!==e||t in Ee(n))}}function Ao(t,i,n){return i=vi(i===e?t.length-1:i,0),function(){for(var e=arguments,r=-1,o=vi(e.length-i,0),s=we(o);++r<o;)s[r]=e[i+r];r=-1;for(var a=we(i+1);++r<i;)a[r]=e[r];return a[i]=n(s),kt(t,this,a)}}function zo(e,t){return t.length<2?e:Sn(e,or(t,0,-1))}function Io(t,i){for(var n=t.length,r=xi(i.length,n),o=Ir(t);r--;){var s=i[r];t[r]=bo(s,n)?o[s]:e}return t}function Lo(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Do=Bo(ir),Po=ft||function(e,t){return dt.setTimeout(e,t)},Oo=Bo(nr);function Ro(e,t,i){var n=t+"";return Oo(e,function(e,t){var i=t.length;if(!i)return e;var n=i-1;return t[n]=(i>1?"& ":"")+t[n],t=t.join(i>2?", ":" "),e.replace(re,"{\n/* [wrapped with "+t+"] */\n")}(n,function(e,t){return Ct(p,(function(i){var n="_."+i[0];t&i[1]&&!zt(e,n)&&e.push(n)})),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(se):[]}(n),i)))}function Bo(t){var i=0,n=0;return function(){var r=bi(),o=16-(r-n);if(n=r,o>0){if(++i>=800)return arguments[0]}else i=0;return t.apply(e,arguments)}}function Fo(t,i){var n=-1,r=t.length,o=r-1;for(i=i===e?r:i;++n<i;){var s=Kn(n,o),a=t[s];t[s]=t[n],t[n]=a}return t.length=i,t}var $o=function(e){var t=Bs(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Q,(function(e,i,n,r){t.push(n?r.replace(ce,"$1"):i||e)})),t}));function jo(e){if("string"==typeof e||ha(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function No(e){if(null!=e){try{return Oe.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Uo(e){if(e instanceof qi)return e.clone();var t=new Gi(e.__wrapped__,e.__chain__);return t.__actions__=Ir(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Vo=Jn((function(e,t){return Ks(e)?pn(e,vn(t,1,Ks,!0)):[]})),Go=Jn((function(t,i){var n=Qo(i);return Ks(n)&&(n=e),Ks(t)?pn(t,vn(i,1,Ks,!0),uo(n,2)):[]})),qo=Jn((function(t,i){var n=Qo(i);return Ks(n)&&(n=e),Ks(t)?pn(t,vn(i,1,Ks,!0),e,n):[]}));function Wo(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var r=null==i?0:ya(i);return r<0&&(r=vi(n+r,0)),$t(e,uo(t,3),r)}function Ho(t,i,n){var r=null==t?0:t.length;if(!r)return-1;var o=r-1;return n!==e&&(o=ya(n),o=n<0?vi(r+o,0):xi(o,r-1)),$t(t,uo(i,3),o,!0)}function Zo(e){return null!=e&&e.length?vn(e,1):[]}function Xo(t){return t&&t.length?t[0]:e}var Ko=Jn((function(e){var t=Lt(e,vr);return t.length&&t[0]===e[0]?In(t):[]})),Yo=Jn((function(t){var i=Qo(t),n=Lt(t,vr);return i===Qo(n)?i=e:n.pop(),n.length&&n[0]===t[0]?In(n,uo(i,2)):[]})),Jo=Jn((function(t){var i=Qo(t),n=Lt(t,vr);return(i="function"==typeof i?i:e)&&n.pop(),n.length&&n[0]===t[0]?In(n,e,i):[]}));function Qo(t){var i=null==t?0:t.length;return i?t[i-1]:e}var es=Jn(ts);function ts(e,t){return e&&e.length&&t&&t.length?Zn(e,t):e}var is=ro((function(e,t){var i=null==e?0:e.length,n=ln(e,t);return Xn(e,Lt(t,(function(e){return bo(e,i)?+e:e})).sort(Mr)),n}));function ns(e){return null==e?e:ki.call(e)}var rs=Jn((function(e){return dr(vn(e,1,Ks,!0))})),os=Jn((function(t){var i=Qo(t);return Ks(i)&&(i=e),dr(vn(t,1,Ks,!0),uo(i,2))})),ss=Jn((function(t){var i=Qo(t);return i="function"==typeof i?i:e,dr(vn(t,1,Ks,!0),e,i)}));function as(e){if(!e||!e.length)return[];var t=0;return e=At(e,(function(e){if(Ks(e))return t=vi(e.length,t),!0})),Zt(t,(function(t){return Lt(e,Gt(t))}))}function ls(t,i){if(!t||!t.length)return[];var n=as(t);return null==i?n:Lt(n,(function(t){return kt(i,e,t)}))}var cs=Jn((function(e,t){return Ks(e)?pn(e,t):[]})),us=Jn((function(e){return yr(At(e,Ks))})),hs=Jn((function(t){var i=Qo(t);return Ks(i)&&(i=e),yr(At(t,Ks),uo(i,2))})),ds=Jn((function(t){var i=Qo(t);return i="function"==typeof i?i:e,yr(At(t,Ks),e,i)})),ps=Jn(as),fs=Jn((function(t){var i=t.length,n=i>1?t[i-1]:e;return n="function"==typeof n?(t.pop(),n):e,ls(t,n)}));function ms(e){var t=Ni(e);return t.__chain__=!0,t}function gs(e,t){return t(e)}var ys=ro((function(t){var i=t.length,n=i?t[0]:0,r=this.__wrapped__,o=function(e){return ln(e,t)};return!(i>1||this.__actions__.length)&&r instanceof qi&&bo(n)?((r=r.slice(n,+n+(i?1:0))).__actions__.push({func:gs,args:[o],thisArg:e}),new Gi(r,this.__chain__).thru((function(t){return i&&!t.length&&t.push(e),t}))):this.thru(o)})),_s=Dr((function(e,t,i){Re.call(e,i)?++e[i]:an(e,i,1)})),vs=jr(Wo),xs=jr(Ho);function bs(e,t){return(Hs(e)?Ct:fn)(e,uo(t,3))}function ws(e,t){return(Hs(e)?Et:mn)(e,uo(t,3))}var Ts=Dr((function(e,t,i){Re.call(e,i)?e[i].push(t):an(e,i,[t])})),ks=Jn((function(e,t,i){var n=-1,r="function"==typeof t,o=Xs(e)?we(e.length):[];return fn(e,(function(e){o[++n]=r?kt(t,e,i):Ln(e,t,i)})),o})),Ss=Dr((function(e,t,i){an(e,i,t)}));function Cs(e,t){return(Hs(e)?Lt:Nn)(e,uo(t,3))}var Es=Dr((function(e,t,i){e[i?0:1].push(t)}),(function(){return[[],[]]})),Ms=Jn((function(e,t){if(null==e)return[];var i=t.length;return i>1&&wo(e,t[0],t[1])?t=[]:i>2&&wo(t[0],t[1],t[2])&&(t=[t[0]]),Wn(e,vn(t,1),[])})),As=pt||function(){return dt.Date.now()};function zs(t,i,n){return i=n?e:i,i=t&&null==i?t.length:i,Qr(t,a,e,e,e,e,i)}function Is(i,n){var r;if("function"!=typeof n)throw new ze(t);return i=ya(i),function(){return--i>0&&(r=n.apply(this,arguments)),i<=1&&(n=e),r}}var Ls=Jn((function(e,t,i){var n=1;if(i.length){var r=li(i,co(Ls));n|=o}return Qr(e,n,t,i,r)})),Ds=Jn((function(e,t,i){var n=3;if(i.length){var r=li(i,co(Ds));n|=o}return Qr(t,n,e,i,r)}));function Ps(i,n,r){var o,s,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof i)throw new ze(t);function m(t){var n=o,r=s;return o=s=e,h=t,l=i.apply(r,n)}function g(e){return h=e,c=Po(_,n),d?m(e):l}function y(t){var i=t-u;return u===e||i>=n||i<0||p&&t-h>=a}function _(){var e=As();if(y(e))return v(e);c=Po(_,function(e){var t=n-(e-u);return p?xi(t,a-(e-h)):t}(e))}function v(t){return c=e,f&&o?m(t):(o=s=e,l)}function x(){var t=As(),i=y(t);if(o=arguments,s=this,u=t,i){if(c===e)return g(u);if(p)return kr(c),c=Po(_,n),m(u)}return c===e&&(c=Po(_,n)),l}return n=va(n)||0,na(r)&&(d=!!r.leading,a=(p="maxWait"in r)?vi(va(r.maxWait)||0,n):a,f="trailing"in r?!!r.trailing:f),x.cancel=function(){c!==e&&kr(c),h=0,o=u=s=c=e},x.flush=function(){return c===e?l:v(As())},x}var Os=Jn((function(e,t){return dn(e,1,t)})),Rs=Jn((function(e,t,i){return dn(e,va(t)||0,i)}));function Bs(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new ze(t);var n=function(){var t=arguments,r=i?i.apply(this,t):t[0],o=n.cache;if(o.has(r))return o.get(r);var s=e.apply(this,t);return n.cache=o.set(r,s)||o,s};return n.cache=new(Bs.Cache||Zi),n}function Fs(e){if("function"!=typeof e)throw new ze(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Bs.Cache=Zi;var $s=wr((function(e,t){var i=(t=1==t.length&&Hs(t[0])?Lt(t[0],Kt(uo())):Lt(vn(t,1),Kt(uo()))).length;return Jn((function(n){for(var r=-1,o=xi(n.length,i);++r<o;)n[r]=t[r].call(this,n[r]);return kt(e,this,n)}))})),js=Jn((function(t,i){var n=li(i,co(js));return Qr(t,o,e,i,n)})),Ns=Jn((function(t,i){var n=li(i,co(Ns));return Qr(t,s,e,i,n)})),Us=ro((function(t,i){return Qr(t,l,e,e,e,i)}));function Vs(e,t){return e===t||e!=e&&t!=t}var Gs=Zr(Mn),qs=Zr((function(e,t){return e>=t})),Ws=Dn(function(){return arguments}())?Dn:function(e){return ra(e)&&Re.call(e,"callee")&&!Xe.call(e,"callee")},Hs=we.isArray,Zs=_t?Kt(_t):function(e){return ra(e)&&En(e)==z};function Xs(e){return null!=e&&ia(e.length)&&!ea(e)}function Ks(e){return ra(e)&&Xs(e)}var Ys=qt||vl,Js=vt?Kt(vt):function(e){return ra(e)&&En(e)==y};function Qs(e){if(!ra(e))return!1;var t=En(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!aa(e)}function ea(e){if(!na(e))return!1;var t=En(e);return t==v||t==x||"[object AsyncFunction]"==t||"[object Proxy]"==t}function ta(e){return"number"==typeof e&&e==ya(e)}function ia(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function na(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ra(e){return null!=e&&"object"==typeof e}var oa=xt?Kt(xt):function(e){return ra(e)&&yo(e)==b};function sa(e){return"number"==typeof e||ra(e)&&En(e)==w}function aa(e){if(!ra(e)||En(e)!=T)return!1;var t=He(e);if(null===t)return!0;var i=Re.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Oe.call(i)==je}var la=bt?Kt(bt):function(e){return ra(e)&&En(e)==S},ca=wt?Kt(wt):function(e){return ra(e)&&yo(e)==C};function ua(e){return"string"==typeof e||!Hs(e)&&ra(e)&&En(e)==E}function ha(e){return"symbol"==typeof e||ra(e)&&En(e)==M}var da=Tt?Kt(Tt):function(e){return ra(e)&&ia(e.length)&&!!ot[En(e)]},pa=Zr(jn),fa=Zr((function(e,t){return e<=t}));function ma(e){if(!e)return[];if(Xs(e))return ua(e)?di(e):Ir(e);if(tt&&e[tt])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[tt]());var t=yo(e);return(t==b?si:t==C?ci:Va)(e)}function ga(e){return e?(e=va(e))===c||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ya(e){var t=ga(e),i=t%1;return t==t?i?t-i:t:0}function _a(e){return e?cn(ya(e),0,d):0}function va(e){if("number"==typeof e)return e;if(ha(e))return h;if(na(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=na(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Xt(e);var i=pe.test(e);return i||me.test(e)?ct(e.slice(2),i?2:8):de.test(e)?h:+e}function xa(e){return Lr(e,Oa(e))}function ba(e){return null==e?"":hr(e)}var wa=Pr((function(e,t){if(Co(t)||Xs(t))Lr(t,Pa(t),e);else for(var i in t)Re.call(t,i)&&nn(e,i,t[i])})),Ta=Pr((function(e,t){Lr(t,Oa(t),e)})),ka=Pr((function(e,t,i,n){Lr(t,Oa(t),e,n)})),Sa=Pr((function(e,t,i,n){Lr(t,Pa(t),e,n)})),Ca=ro(ln),Ea=Jn((function(t,i){t=Ee(t);var n=-1,r=i.length,o=r>2?i[2]:e;for(o&&wo(i[0],i[1],o)&&(r=1);++n<r;)for(var s=i[n],a=Oa(s),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===e||Vs(h,De[u])&&!Re.call(t,u))&&(t[u]=s[u])}return t})),Ma=Jn((function(t){return t.push(e,to),kt(Ba,e,t)}));function Aa(t,i,n){var r=null==t?e:Sn(t,i);return r===e?n:r}function za(e,t){return null!=e&&_o(e,t,zn)}var Ia=Vr((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=$e.call(t)),e[t]=i}),nl(sl)),La=Vr((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=$e.call(t)),Re.call(e,t)?e[t].push(i):e[t]=[i]}),uo),Da=Jn(Ln);function Pa(e){return Xs(e)?Yi(e):Fn(e)}function Oa(e){return Xs(e)?Yi(e,!0):$n(e)}var Ra=Pr((function(e,t,i){Gn(e,t,i)})),Ba=Pr((function(e,t,i,n){Gn(e,t,i,n)})),Fa=ro((function(e,t){var i={};if(null==e)return i;var n=!1;t=Lt(t,(function(t){return t=br(t,e),n||(n=t.length>1),t})),Lr(e,so(e),i),n&&(i=un(i,7,io));for(var r=t.length;r--;)pr(i,t[r]);return i})),$a=ro((function(e,t){return null==e?{}:function(e,t){return Hn(e,t,(function(t,i){return za(e,i)}))}(e,t)}));function ja(e,t){if(null==e)return{};var i=Lt(so(e),(function(e){return[e]}));return t=uo(t),Hn(e,i,(function(e,i){return t(e,i[0])}))}var Na=Jr(Pa),Ua=Jr(Oa);function Va(e){return null==e?[]:Yt(e,Pa(e))}var Ga=Fr((function(e,t,i){return t=t.toLowerCase(),e+(i?qa(t):t)}));function qa(e){return Qa(ba(e).toLowerCase())}function Wa(e){return(e=ba(e))&&e.replace(ye,ii).replace(Je,"")}var Ha=Fr((function(e,t,i){return e+(i?"-":"")+t.toLowerCase()})),Za=Fr((function(e,t,i){return e+(i?" ":"")+t.toLowerCase()})),Xa=Br("toLowerCase"),Ka=Fr((function(e,t,i){return e+(i?"_":"")+t.toLowerCase()})),Ya=Fr((function(e,t,i){return e+(i?" ":"")+Qa(t)})),Ja=Fr((function(e,t,i){return e+(i?" ":"")+t.toUpperCase()})),Qa=Br("toUpperCase");function el(t,i,n){return t=ba(t),(i=n?e:i)===e?function(e){return it.test(e)}(t)?function(e){return e.match(et)||[]}(t):function(e){return e.match(ae)||[]}(t):t.match(i)||[]}var tl=Jn((function(t,i){try{return kt(t,e,i)}catch(e){return Qs(e)?e:new ke(e)}})),il=ro((function(e,t){return Ct(t,(function(t){t=jo(t),an(e,t,Ls(e[t],e))})),e}));function nl(e){return function(){return e}}var rl=Nr(),ol=Nr(!0);function sl(e){return e}function al(e){return Bn("function"==typeof e?e:un(e,1))}var ll=Jn((function(e,t){return function(i){return Ln(i,e,t)}})),cl=Jn((function(e,t){return function(i){return Ln(e,i,t)}}));function ul(e,t,i){var n=Pa(t),r=kn(t,n);null!=i||na(t)&&(r.length||!n.length)||(i=t,t=e,e=this,r=kn(t,Pa(t)));var o=!(na(i)&&"chain"in i&&!i.chain),s=ea(e);return Ct(r,(function(i){var n=t[i];e[i]=n,s&&(e.prototype[i]=function(){var t=this.__chain__;if(o||t){var i=e(this.__wrapped__),r=i.__actions__=Ir(this.__actions__);return r.push({func:n,args:arguments,thisArg:e}),i.__chain__=t,i}return n.apply(e,Dt([this.value()],arguments))})})),e}function hl(){}var dl=qr(Lt),pl=qr(Mt),fl=qr(Rt);function ml(e){return To(e)?Gt(jo(e)):function(e){return function(t){return Sn(t,e)}}(e)}var gl=Hr(),yl=Hr(!0);function _l(){return[]}function vl(){return!1}var xl=Gr((function(e,t){return e+t}),0),bl=Kr("ceil"),wl=Gr((function(e,t){return e/t}),1),Tl=Kr("floor"),kl=Gr((function(e,t){return e*t}),1),Sl=Kr("round"),Cl=Gr((function(e,t){return e-t}),0);return Ni.after=function(e,i){if("function"!=typeof i)throw new ze(t);return e=ya(e),function(){if(--e<1)return i.apply(this,arguments)}},Ni.ary=zs,Ni.assign=wa,Ni.assignIn=Ta,Ni.assignInWith=ka,Ni.assignWith=Sa,Ni.at=Ca,Ni.before=Is,Ni.bind=Ls,Ni.bindAll=il,Ni.bindKey=Ds,Ni.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Hs(e)?e:[e]},Ni.chain=ms,Ni.chunk=function(t,i,n){i=(n?wo(t,i,n):i===e)?1:vi(ya(i),0);var r=null==t?0:t.length;if(!r||i<1)return[];for(var o=0,s=0,a=we(gt(r/i));o<r;)a[s++]=or(t,o,o+=i);return a},Ni.compact=function(e){for(var t=-1,i=null==e?0:e.length,n=0,r=[];++t<i;){var o=e[t];o&&(r[n++]=o)}return r},Ni.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),i=arguments[0],n=e;n--;)t[n-1]=arguments[n];return Dt(Hs(i)?Ir(i):[i],vn(t,1))},Ni.cond=function(e){var i=null==e?0:e.length,n=uo();return e=i?Lt(e,(function(e){if("function"!=typeof e[1])throw new ze(t);return[n(e[0]),e[1]]})):[],Jn((function(t){for(var n=-1;++n<i;){var r=e[n];if(kt(r[0],this,t))return kt(r[1],this,t)}}))},Ni.conforms=function(e){return function(e){var t=Pa(e);return function(i){return hn(i,e,t)}}(un(e,1))},Ni.constant=nl,Ni.countBy=_s,Ni.create=function(e,t){var i=Ui(e);return null==t?i:sn(i,t)},Ni.curry=function t(i,n,r){var o=Qr(i,8,e,e,e,e,e,n=r?e:n);return o.placeholder=t.placeholder,o},Ni.curryRight=function t(i,n,o){var s=Qr(i,r,e,e,e,e,e,n=o?e:n);return s.placeholder=t.placeholder,s},Ni.debounce=Ps,Ni.defaults=Ea,Ni.defaultsDeep=Ma,Ni.defer=Os,Ni.delay=Rs,Ni.difference=Vo,Ni.differenceBy=Go,Ni.differenceWith=qo,Ni.drop=function(t,i,n){var r=null==t?0:t.length;return r?or(t,(i=n||i===e?1:ya(i))<0?0:i,r):[]},Ni.dropRight=function(t,i,n){var r=null==t?0:t.length;return r?or(t,0,(i=r-(i=n||i===e?1:ya(i)))<0?0:i):[]},Ni.dropRightWhile=function(e,t){return e&&e.length?mr(e,uo(t,3),!0,!0):[]},Ni.dropWhile=function(e,t){return e&&e.length?mr(e,uo(t,3),!0):[]},Ni.fill=function(t,i,n,r){var o=null==t?0:t.length;return o?(n&&"number"!=typeof n&&wo(t,i,n)&&(n=0,r=o),function(t,i,n,r){var o=t.length;for((n=ya(n))<0&&(n=-n>o?0:o+n),(r=r===e||r>o?o:ya(r))<0&&(r+=o),r=n>r?0:_a(r);n<r;)t[n++]=i;return t}(t,i,n,r)):[]},Ni.filter=function(e,t){return(Hs(e)?At:_n)(e,uo(t,3))},Ni.flatMap=function(e,t){return vn(Cs(e,t),1)},Ni.flatMapDeep=function(e,t){return vn(Cs(e,t),c)},Ni.flatMapDepth=function(t,i,n){return n=n===e?1:ya(n),vn(Cs(t,i),n)},Ni.flatten=Zo,Ni.flattenDeep=function(e){return null!=e&&e.length?vn(e,c):[]},Ni.flattenDepth=function(t,i){return null!=t&&t.length?vn(t,i=i===e?1:ya(i)):[]},Ni.flip=function(e){return Qr(e,512)},Ni.flow=rl,Ni.flowRight=ol,Ni.fromPairs=function(e){for(var t=-1,i=null==e?0:e.length,n={};++t<i;){var r=e[t];n[r[0]]=r[1]}return n},Ni.functions=function(e){return null==e?[]:kn(e,Pa(e))},Ni.functionsIn=function(e){return null==e?[]:kn(e,Oa(e))},Ni.groupBy=Ts,Ni.initial=function(e){return null!=e&&e.length?or(e,0,-1):[]},Ni.intersection=Ko,Ni.intersectionBy=Yo,Ni.intersectionWith=Jo,Ni.invert=Ia,Ni.invertBy=La,Ni.invokeMap=ks,Ni.iteratee=al,Ni.keyBy=Ss,Ni.keys=Pa,Ni.keysIn=Oa,Ni.map=Cs,Ni.mapKeys=function(e,t){var i={};return t=uo(t,3),wn(e,(function(e,n,r){an(i,t(e,n,r),e)})),i},Ni.mapValues=function(e,t){var i={};return t=uo(t,3),wn(e,(function(e,n,r){an(i,n,t(e,n,r))})),i},Ni.matches=function(e){return Un(un(e,1))},Ni.matchesProperty=function(e,t){return Vn(e,un(t,1))},Ni.memoize=Bs,Ni.merge=Ra,Ni.mergeWith=Ba,Ni.method=ll,Ni.methodOf=cl,Ni.mixin=ul,Ni.negate=Fs,Ni.nthArg=function(e){return e=ya(e),Jn((function(t){return qn(t,e)}))},Ni.omit=Fa,Ni.omitBy=function(e,t){return ja(e,Fs(uo(t)))},Ni.once=function(e){return Is(2,e)},Ni.orderBy=function(t,i,n,r){return null==t?[]:(Hs(i)||(i=null==i?[]:[i]),Hs(n=r?e:n)||(n=null==n?[]:[n]),Wn(t,i,n))},Ni.over=dl,Ni.overArgs=$s,Ni.overEvery=pl,Ni.overSome=fl,Ni.partial=js,Ni.partialRight=Ns,Ni.partition=Es,Ni.pick=$a,Ni.pickBy=ja,Ni.property=ml,Ni.propertyOf=function(t){return function(i){return null==t?e:Sn(t,i)}},Ni.pull=es,Ni.pullAll=ts,Ni.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?Zn(e,t,uo(i,2)):e},Ni.pullAllWith=function(t,i,n){return t&&t.length&&i&&i.length?Zn(t,i,e,n):t},Ni.pullAt=is,Ni.range=gl,Ni.rangeRight=yl,Ni.rearg=Us,Ni.reject=function(e,t){return(Hs(e)?At:_n)(e,Fs(uo(t,3)))},Ni.remove=function(e,t){var i=[];if(!e||!e.length)return i;var n=-1,r=[],o=e.length;for(t=uo(t,3);++n<o;){var s=e[n];t(s,n,e)&&(i.push(s),r.push(n))}return Xn(e,r),i},Ni.rest=function(i,n){if("function"!=typeof i)throw new ze(t);return Jn(i,n=n===e?n:ya(n))},Ni.reverse=ns,Ni.sampleSize=function(t,i,n){return i=(n?wo(t,i,n):i===e)?1:ya(i),(Hs(t)?Qi:er)(t,i)},Ni.set=function(e,t,i){return null==e?e:tr(e,t,i)},Ni.setWith=function(t,i,n,r){return r="function"==typeof r?r:e,null==t?t:tr(t,i,n,r)},Ni.shuffle=function(e){return(Hs(e)?en:rr)(e)},Ni.slice=function(t,i,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&wo(t,i,n)?(i=0,n=r):(i=null==i?0:ya(i),n=n===e?r:ya(n)),or(t,i,n)):[]},Ni.sortBy=Ms,Ni.sortedUniq=function(e){return e&&e.length?cr(e):[]},Ni.sortedUniqBy=function(e,t){return e&&e.length?cr(e,uo(t,2)):[]},Ni.split=function(t,i,n){return n&&"number"!=typeof n&&wo(t,i,n)&&(i=n=e),(n=n===e?d:n>>>0)?(t=ba(t))&&("string"==typeof i||null!=i&&!la(i))&&!(i=hr(i))&&oi(t)?Tr(di(t),0,n):t.split(i,n):[]},Ni.spread=function(e,i){if("function"!=typeof e)throw new ze(t);return i=null==i?0:vi(ya(i),0),Jn((function(t){var n=t[i],r=Tr(t,0,i);return n&&Dt(r,n),kt(e,this,r)}))},Ni.tail=function(e){var t=null==e?0:e.length;return t?or(e,1,t):[]},Ni.take=function(t,i,n){return t&&t.length?or(t,0,(i=n||i===e?1:ya(i))<0?0:i):[]},Ni.takeRight=function(t,i,n){var r=null==t?0:t.length;return r?or(t,(i=r-(i=n||i===e?1:ya(i)))<0?0:i,r):[]},Ni.takeRightWhile=function(e,t){return e&&e.length?mr(e,uo(t,3),!1,!0):[]},Ni.takeWhile=function(e,t){return e&&e.length?mr(e,uo(t,3)):[]},Ni.tap=function(e,t){return t(e),e},Ni.throttle=function(e,i,n){var r=!0,o=!0;if("function"!=typeof e)throw new ze(t);return na(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Ps(e,i,{leading:r,maxWait:i,trailing:o})},Ni.thru=gs,Ni.toArray=ma,Ni.toPairs=Na,Ni.toPairsIn=Ua,Ni.toPath=function(e){return Hs(e)?Lt(e,jo):ha(e)?[e]:Ir($o(ba(e)))},Ni.toPlainObject=xa,Ni.transform=function(e,t,i){var n=Hs(e),r=n||Ys(e)||da(e);if(t=uo(t,4),null==i){var o=e&&e.constructor;i=r?n?new o:[]:na(e)&&ea(o)?Ui(He(e)):{}}return(r?Ct:wn)(e,(function(e,n,r){return t(i,e,n,r)})),i},Ni.unary=function(e){return zs(e,1)},Ni.union=rs,Ni.unionBy=os,Ni.unionWith=ss,Ni.uniq=function(e){return e&&e.length?dr(e):[]},Ni.uniqBy=function(e,t){return e&&e.length?dr(e,uo(t,2)):[]},Ni.uniqWith=function(t,i){return i="function"==typeof i?i:e,t&&t.length?dr(t,e,i):[]},Ni.unset=function(e,t){return null==e||pr(e,t)},Ni.unzip=as,Ni.unzipWith=ls,Ni.update=function(e,t,i){return null==e?e:fr(e,t,xr(i))},Ni.updateWith=function(t,i,n,r){return r="function"==typeof r?r:e,null==t?t:fr(t,i,xr(n),r)},Ni.values=Va,Ni.valuesIn=function(e){return null==e?[]:Yt(e,Oa(e))},Ni.without=cs,Ni.words=el,Ni.wrap=function(e,t){return js(xr(t),e)},Ni.xor=us,Ni.xorBy=hs,Ni.xorWith=ds,Ni.zip=ps,Ni.zipObject=function(e,t){return _r(e||[],t||[],nn)},Ni.zipObjectDeep=function(e,t){return _r(e||[],t||[],tr)},Ni.zipWith=fs,Ni.entries=Na,Ni.entriesIn=Ua,Ni.extend=Ta,Ni.extendWith=ka,ul(Ni,Ni),Ni.add=xl,Ni.attempt=tl,Ni.camelCase=Ga,Ni.capitalize=qa,Ni.ceil=bl,Ni.clamp=function(t,i,n){return n===e&&(n=i,i=e),n!==e&&(n=(n=va(n))==n?n:0),i!==e&&(i=(i=va(i))==i?i:0),cn(va(t),i,n)},Ni.clone=function(e){return un(e,4)},Ni.cloneDeep=function(e){return un(e,5)},Ni.cloneDeepWith=function(t,i){return un(t,5,i="function"==typeof i?i:e)},Ni.cloneWith=function(t,i){return un(t,4,i="function"==typeof i?i:e)},Ni.conformsTo=function(e,t){return null==t||hn(e,t,Pa(t))},Ni.deburr=Wa,Ni.defaultTo=function(e,t){return null==e||e!=e?t:e},Ni.divide=wl,Ni.endsWith=function(t,i,n){t=ba(t),i=hr(i);var r=t.length,o=n=n===e?r:cn(ya(n),0,r);return(n-=i.length)>=0&&t.slice(n,o)==i},Ni.eq=Vs,Ni.escape=function(e){return(e=ba(e))&&H.test(e)?e.replace(q,ni):e},Ni.escapeRegExp=function(e){return(e=ba(e))&&te.test(e)?e.replace(ee,"\\$&"):e},Ni.every=function(t,i,n){var r=Hs(t)?Mt:gn;return n&&wo(t,i,n)&&(i=e),r(t,uo(i,3))},Ni.find=vs,Ni.findIndex=Wo,Ni.findKey=function(e,t){return Ft(e,uo(t,3),wn)},Ni.findLast=xs,Ni.findLastIndex=Ho,Ni.findLastKey=function(e,t){return Ft(e,uo(t,3),Tn)},Ni.floor=Tl,Ni.forEach=bs,Ni.forEachRight=ws,Ni.forIn=function(e,t){return null==e?e:xn(e,uo(t,3),Oa)},Ni.forInRight=function(e,t){return null==e?e:bn(e,uo(t,3),Oa)},Ni.forOwn=function(e,t){return e&&wn(e,uo(t,3))},Ni.forOwnRight=function(e,t){return e&&Tn(e,uo(t,3))},Ni.get=Aa,Ni.gt=Gs,Ni.gte=qs,Ni.has=function(e,t){return null!=e&&_o(e,t,An)},Ni.hasIn=za,Ni.head=Xo,Ni.identity=sl,Ni.includes=function(e,t,i,n){e=Xs(e)?e:Va(e),i=i&&!n?ya(i):0;var r=e.length;return i<0&&(i=vi(r+i,0)),ua(e)?i<=r&&e.indexOf(t,i)>-1:!!r&&jt(e,t,i)>-1},Ni.indexOf=function(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var r=null==i?0:ya(i);return r<0&&(r=vi(n+r,0)),jt(e,t,r)},Ni.inRange=function(t,i,n){return i=ga(i),n===e?(n=i,i=0):n=ga(n),function(e,t,i){return e>=xi(t,i)&&e<vi(t,i)}(t=va(t),i,n)},Ni.invoke=Da,Ni.isArguments=Ws,Ni.isArray=Hs,Ni.isArrayBuffer=Zs,Ni.isArrayLike=Xs,Ni.isArrayLikeObject=Ks,Ni.isBoolean=function(e){return!0===e||!1===e||ra(e)&&En(e)==g},Ni.isBuffer=Ys,Ni.isDate=Js,Ni.isElement=function(e){return ra(e)&&1===e.nodeType&&!aa(e)},Ni.isEmpty=function(e){if(null==e)return!0;if(Xs(e)&&(Hs(e)||"string"==typeof e||"function"==typeof e.splice||Ys(e)||da(e)||Ws(e)))return!e.length;var t=yo(e);if(t==b||t==C)return!e.size;if(Co(e))return!Fn(e).length;for(var i in e)if(Re.call(e,i))return!1;return!0},Ni.isEqual=function(e,t){return Pn(e,t)},Ni.isEqualWith=function(t,i,n){var r=(n="function"==typeof n?n:e)?n(t,i):e;return r===e?Pn(t,i,e,n):!!r},Ni.isError=Qs,Ni.isFinite=function(e){return"number"==typeof e&&gi(e)},Ni.isFunction=ea,Ni.isInteger=ta,Ni.isLength=ia,Ni.isMap=oa,Ni.isMatch=function(e,t){return e===t||On(e,t,po(t))},Ni.isMatchWith=function(t,i,n){return n="function"==typeof n?n:e,On(t,i,po(i),n)},Ni.isNaN=function(e){return sa(e)&&e!=+e},Ni.isNative=function(e){if(So(e))throw new ke("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Rn(e)},Ni.isNil=function(e){return null==e},Ni.isNull=function(e){return null===e},Ni.isNumber=sa,Ni.isObject=na,Ni.isObjectLike=ra,Ni.isPlainObject=aa,Ni.isRegExp=la,Ni.isSafeInteger=function(e){return ta(e)&&e>=-9007199254740991&&e<=u},Ni.isSet=ca,Ni.isString=ua,Ni.isSymbol=ha,Ni.isTypedArray=da,Ni.isUndefined=function(t){return t===e},Ni.isWeakMap=function(e){return ra(e)&&yo(e)==A},Ni.isWeakSet=function(e){return ra(e)&&"[object WeakSet]"==En(e)},Ni.join=function(e,t){return null==e?"":yi.call(e,t)},Ni.kebabCase=Ha,Ni.last=Qo,Ni.lastIndexOf=function(t,i,n){var r=null==t?0:t.length;if(!r)return-1;var o=r;return n!==e&&(o=(o=ya(n))<0?vi(r+o,0):xi(o,r-1)),i==i?function(e,t,i){for(var n=i+1;n--;)if(e[n]===t)return n;return n}(t,i,o):$t(t,Ut,o,!0)},Ni.lowerCase=Za,Ni.lowerFirst=Xa,Ni.lt=pa,Ni.lte=fa,Ni.max=function(t){return t&&t.length?yn(t,sl,Mn):e},Ni.maxBy=function(t,i){return t&&t.length?yn(t,uo(i,2),Mn):e},Ni.mean=function(e){return Vt(e,sl)},Ni.meanBy=function(e,t){return Vt(e,uo(t,2))},Ni.min=function(t){return t&&t.length?yn(t,sl,jn):e},Ni.minBy=function(t,i){return t&&t.length?yn(t,uo(i,2),jn):e},Ni.stubArray=_l,Ni.stubFalse=vl,Ni.stubObject=function(){return{}},Ni.stubString=function(){return""},Ni.stubTrue=function(){return!0},Ni.multiply=kl,Ni.nth=function(t,i){return t&&t.length?qn(t,ya(i)):e},Ni.noConflict=function(){return dt._===this&&(dt._=Ne),this},Ni.noop=hl,Ni.now=As,Ni.pad=function(e,t,i){e=ba(e);var n=(t=ya(t))?hi(e):0;if(!t||n>=t)return e;var r=(t-n)/2;return Wr(yt(r),i)+e+Wr(gt(r),i)},Ni.padEnd=function(e,t,i){e=ba(e);var n=(t=ya(t))?hi(e):0;return t&&n<t?e+Wr(t-n,i):e},Ni.padStart=function(e,t,i){e=ba(e);var n=(t=ya(t))?hi(e):0;return t&&n<t?Wr(t-n,i)+e:e},Ni.parseInt=function(e,t,i){return i||null==t?t=0:t&&(t=+t),wi(ba(e).replace(ie,""),t||0)},Ni.random=function(t,i,n){if(n&&"boolean"!=typeof n&&wo(t,i,n)&&(i=n=e),n===e&&("boolean"==typeof i?(n=i,i=e):"boolean"==typeof t&&(n=t,t=e)),t===e&&i===e?(t=0,i=1):(t=ga(t),i===e?(i=t,t=0):i=ga(i)),t>i){var r=t;t=i,i=r}if(n||t%1||i%1){var o=Ti();return xi(t+o*(i-t+lt("1e-"+((o+"").length-1))),i)}return Kn(t,i)},Ni.reduce=function(e,t,i){var n=Hs(e)?Pt:Wt,r=arguments.length<3;return n(e,uo(t,4),i,r,fn)},Ni.reduceRight=function(e,t,i){var n=Hs(e)?Ot:Wt,r=arguments.length<3;return n(e,uo(t,4),i,r,mn)},Ni.repeat=function(t,i,n){return i=(n?wo(t,i,n):i===e)?1:ya(i),Yn(ba(t),i)},Ni.replace=function(){var e=arguments,t=ba(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Ni.result=function(t,i,n){var r=-1,o=(i=br(i,t)).length;for(o||(o=1,t=e);++r<o;){var s=null==t?e:t[jo(i[r])];s===e&&(r=o,s=n),t=ea(s)?s.call(t):s}return t},Ni.round=Sl,Ni.runInContext=ne,Ni.sample=function(e){return(Hs(e)?Ji:Qn)(e)},Ni.size=function(e){if(null==e)return 0;if(Xs(e))return ua(e)?hi(e):e.length;var t=yo(e);return t==b||t==C?e.size:Fn(e).length},Ni.snakeCase=Ka,Ni.some=function(t,i,n){var r=Hs(t)?Rt:sr;return n&&wo(t,i,n)&&(i=e),r(t,uo(i,3))},Ni.sortedIndex=function(e,t){return ar(e,t)},Ni.sortedIndexBy=function(e,t,i){return lr(e,t,uo(i,2))},Ni.sortedIndexOf=function(e,t){var i=null==e?0:e.length;if(i){var n=ar(e,t);if(n<i&&Vs(e[n],t))return n}return-1},Ni.sortedLastIndex=function(e,t){return ar(e,t,!0)},Ni.sortedLastIndexBy=function(e,t,i){return lr(e,t,uo(i,2),!0)},Ni.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var i=ar(e,t,!0)-1;if(Vs(e[i],t))return i}return-1},Ni.startCase=Ya,Ni.startsWith=function(e,t,i){return e=ba(e),i=null==i?0:cn(ya(i),0,e.length),t=hr(t),e.slice(i,i+t.length)==t},Ni.subtract=Cl,Ni.sum=function(e){return e&&e.length?Ht(e,sl):0},Ni.sumBy=function(e,t){return e&&e.length?Ht(e,uo(t,2)):0},Ni.template=function(t,i,n){var r=Ni.templateSettings;n&&wo(t,i,n)&&(i=e),t=ba(t),i=ka({},i,r,eo);var o,s,a=ka({},i.imports,r.imports,eo),l=Pa(a),c=Yt(a,l),u=0,h=i.interpolate||_e,d="__p += '",p=Me((i.escape||_e).source+"|"+h.source+"|"+(h===K?ue:_e).source+"|"+(i.evaluate||_e).source+"|$","g"),f="//# sourceURL="+(Re.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++rt+"]")+"\n";t.replace(p,(function(e,i,n,r,a,l){return n||(n=r),d+=t.slice(u,l).replace(ve,ri),i&&(o=!0,d+="' +\n__e("+i+") +\n'"),a&&(s=!0,d+="';\n"+a+";\n__p += '"),n&&(d+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=Re.call(i,"variable")&&i.variable;if(m){if(le.test(m))throw new ke("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(N,""):d).replace(U,"$1").replace(V,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=tl((function(){return Se(l,f+"return "+d).apply(e,c)}));if(g.source=d,Qs(g))throw g;return g},Ni.times=function(e,t){if((e=ya(e))<1||e>u)return[];var i=d,n=xi(e,d);t=uo(t),e-=d;for(var r=Zt(n,t);++i<e;)t(i);return r},Ni.toFinite=ga,Ni.toInteger=ya,Ni.toLength=_a,Ni.toLower=function(e){return ba(e).toLowerCase()},Ni.toNumber=va,Ni.toSafeInteger=function(e){return e?cn(ya(e),-9007199254740991,u):0===e?e:0},Ni.toString=ba,Ni.toUpper=function(e){return ba(e).toUpperCase()},Ni.trim=function(t,i,n){if((t=ba(t))&&(n||i===e))return Xt(t);if(!t||!(i=hr(i)))return t;var r=di(t),o=di(i);return Tr(r,Qt(r,o),ei(r,o)+1).join("")},Ni.trimEnd=function(t,i,n){if((t=ba(t))&&(n||i===e))return t.slice(0,pi(t)+1);if(!t||!(i=hr(i)))return t;var r=di(t);return Tr(r,0,ei(r,di(i))+1).join("")},Ni.trimStart=function(t,i,n){if((t=ba(t))&&(n||i===e))return t.replace(ie,"");if(!t||!(i=hr(i)))return t;var r=di(t);return Tr(r,Qt(r,di(i))).join("")},Ni.truncate=function(t,i){var n=30,r="...";if(na(i)){var o="separator"in i?i.separator:o;n="length"in i?ya(i.length):n,r="omission"in i?hr(i.omission):r}var s=(t=ba(t)).length;if(oi(t)){var a=di(t);s=a.length}if(n>=s)return t;var l=n-hi(r);if(l<1)return r;var c=a?Tr(a,0,l).join(""):t.slice(0,l);if(o===e)return c+r;if(a&&(l+=c.length-l),la(o)){if(t.slice(l).search(o)){var u,h=c;for(o.global||(o=Me(o.source,ba(he.exec(o))+"g")),o.lastIndex=0;u=o.exec(h);)var d=u.index;c=c.slice(0,d===e?l:d)}}else if(t.indexOf(hr(o),l)!=l){var p=c.lastIndexOf(o);p>-1&&(c=c.slice(0,p))}return c+r},Ni.unescape=function(e){return(e=ba(e))&&W.test(e)?e.replace(G,fi):e},Ni.uniqueId=function(e){var t=++Be;return ba(e)+t},Ni.upperCase=Ja,Ni.upperFirst=Qa,Ni.each=bs,Ni.eachRight=ws,Ni.first=Xo,ul(Ni,function(){var e={};return wn(Ni,(function(t,i){Re.call(Ni.prototype,i)||(e[i]=t)})),e}(),{chain:!1}),Ni.VERSION="4.17.21",Ct(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Ni[e].placeholder=Ni})),Ct(["drop","take"],(function(t,i){qi.prototype[t]=function(n){n=n===e?1:vi(ya(n),0);var r=this.__filtered__&&!i?new qi(this):this.clone();return r.__filtered__?r.__takeCount__=xi(n,r.__takeCount__):r.__views__.push({size:xi(n,d),type:t+(r.__dir__<0?"Right":"")}),r},qi.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Ct(["filter","map","takeWhile"],(function(e,t){var i=t+1,n=1==i||3==i;qi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:uo(e,3),type:i}),t.__filtered__=t.__filtered__||n,t}})),Ct(["head","last"],(function(e,t){var i="take"+(t?"Right":"");qi.prototype[e]=function(){return this[i](1).value()[0]}})),Ct(["initial","tail"],(function(e,t){var i="drop"+(t?"":"Right");qi.prototype[e]=function(){return this.__filtered__?new qi(this):this[i](1)}})),qi.prototype.compact=function(){return this.filter(sl)},qi.prototype.find=function(e){return this.filter(e).head()},qi.prototype.findLast=function(e){return this.reverse().find(e)},qi.prototype.invokeMap=Jn((function(e,t){return"function"==typeof e?new qi(this):this.map((function(i){return Ln(i,e,t)}))})),qi.prototype.reject=function(e){return this.filter(Fs(uo(e)))},qi.prototype.slice=function(t,i){t=ya(t);var n=this;return n.__filtered__&&(t>0||i<0)?new qi(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),i!==e&&(n=(i=ya(i))<0?n.dropRight(-i):n.take(i-t)),n)},qi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qi.prototype.toArray=function(){return this.take(d)},wn(qi.prototype,(function(t,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),r=/^(?:head|last)$/.test(i),o=Ni[r?"take"+("last"==i?"Right":""):i],s=r||/^find/.test(i);o&&(Ni.prototype[i]=function(){var i=this.__wrapped__,a=r?[1]:arguments,l=i instanceof qi,c=a[0],u=l||Hs(i),h=function(e){var t=o.apply(Ni,Dt([e],a));return r&&d?t[0]:t};u&&n&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&u){i=m?i:new qi(this);var g=t.apply(i,a);return g.__actions__.push({func:gs,args:[h],thisArg:e}),new Gi(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?r?g.value()[0]:g.value():g)})})),Ct(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);Ni.prototype[e]=function(){var e=arguments;if(n&&!this.__chain__){var r=this.value();return t.apply(Hs(r)?r:[],e)}return this[i]((function(i){return t.apply(Hs(i)?i:[],e)}))}})),wn(qi.prototype,(function(e,t){var i=Ni[t];if(i){var n=i.name+"";Re.call(Li,n)||(Li[n]=[]),Li[n].push({name:t,func:i})}})),Li[Ur(e,2).name]=[{name:"wrapper",func:e}],qi.prototype.clone=function(){var e=new qi(this.__wrapped__);return e.__actions__=Ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ir(this.__views__),e},qi.prototype.reverse=function(){if(this.__filtered__){var e=new qi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=Hs(e),n=t<0,r=i?e.length:0,o=function(e,t,i){for(var n=-1,r=i.length;++n<r;){var o=i[n],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=xi(t,e+s);break;case"takeRight":e=vi(e,t-s)}}return{start:e,end:t}}(0,r,this.__views__),s=o.start,a=o.end,l=a-s,c=n?a:s-1,u=this.__iteratees__,h=u.length,d=0,p=xi(l,this.__takeCount__);if(!i||!n&&r==l&&p==l)return gr(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[c+=t];++m<h;){var y=u[m],_=y.iteratee,v=y.type,x=_(g);if(2==v)g=x;else if(!x){if(1==v)continue e;break e}}f[d++]=g}return f},Ni.prototype.at=ys,Ni.prototype.chain=function(){return ms(this)},Ni.prototype.commit=function(){return new Gi(this.value(),this.__chain__)},Ni.prototype.next=function(){this.__values__===e&&(this.__values__=ma(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Ni.prototype.plant=function(t){for(var i,n=this;n instanceof Vi;){var r=Uo(n);r.__index__=0,r.__values__=e,i?o.__wrapped__=r:i=r;var o=r;n=n.__wrapped__}return o.__wrapped__=t,i},Ni.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof qi){var i=t;return this.__actions__.length&&(i=new qi(this)),(i=i.reverse()).__actions__.push({func:gs,args:[ns],thisArg:e}),new Gi(i,this.__chain__)}return this.thru(ns)},Ni.prototype.toJSON=Ni.prototype.valueOf=Ni.prototype.value=function(){return gr(this.__wrapped__,this.__actions__)},Ni.prototype.first=Ni.prototype.head,tt&&(Ni.prototype[tt]=function(){return this}),Ni}();ft?((ft.exports=mi)._=mi,pt._=mi):dt._=mi}.call(xe);var Se=ke.exports;const Ce=(e,t)=>Math.round(e*10**t)/10**t,Ee=["locations","routeLines","deviceSize","routingOptions","speedOptions","maneuverOptions","styleUrl"],Me=[],Ae=["bearing","center","pitch","zoom"],ze=["bearing","lat","lng","pitch","zoom","durationMultiplier"];function Ie(e){let t=Object.fromEntries(Object.entries(e).filter((([e,t])=>!Ae.includes(e))).map((([e,t])=>[e,Ee.includes(e)&&null!==t?JSON.stringify(t):t])));var i;i=t,t=Object.keys(i).reduce(((e,t)=>{const n=i[t];return null!==n&&(e[t]=n),e}),{}),window.location.hash=function(e){let t=e.map?`map=${e.map}`:"";const i=["map","stylePresets"];return Object.entries(e).forEach((([e,n],r)=>{if(i.includes(e))return;let o=encodeURIComponent(n);t=`${t}${""!==t?"&":""}${e}=${o}`})),t}({map:[Ce(e.zoom,2),Ce(e.center.lat,4),Ce(e.center.lng,4),Ce(e.pitch,1),Ce(e.bearing,1)].join("/"),...t})}const Le=[];function De(e,t=i){let n;const r=new Set;function o(t){if(l(e,t)&&(e=t,n)){const t=!Le.length;for(const t of r)t[1](),Le.push(t,e);if(t){for(let e=0;e<Le.length;e+=2)Le[e][0](Le[e+1]);Le.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(s,a=i){const l=[s,a];return r.add(l),1===r.size&&(n=t(o)||i),s(e),()=>{r.delete(l),0===r.size&&(n(),n=null)}}}}const Pe="puck",Oe=["destination-pin",Pe],Re=[{id:"a",center:null,locationText:""},{id:"b",center:null,locationText:""}],Be="route-line-internal-mock-source",Fe={type:"geojson",data:{type:"FeatureCollection",features:[]}},$e={layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"cyan","line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},je=["turn","new name","depart","arrive","merge","on ramp","off ramp","fork","end of road","continue","roundabout","rotary","roundabout turn","notification","exit roundabout","exit rotary"],Ne={speed:.1,pitch:1,zoom:.1},Ue=function(e){let t=Object.fromEntries(Object.entries(function(e){const t=e.split("#")[1];if(!t)return{};let i=Object.fromEntries(t.split("&").map((e=>e.split("=").map(decodeURIComponent))));if(i.map){const[e,t,n,r,o]=i.map.split("/");i={...i,bearing:o,lat:t,lng:n,pitch:r,zoom:e}}return i}(e)).filter((([e,t])=>!!t)).map((([e,t])=>Ee.includes(e)?[e,JSON.parse(t)]:Me.includes(e)?[e,"true"===t]:ze.includes(e)?[e,+t||0]:[e,t])));if(t.lat&&t.lng){const{lat:e,lng:i}=t;t.center={lat:e,lng:i},delete t.lat,delete t.lng}return t.map&&delete t.map,t}(window.location.hash),Ve=De({}),Ge=["locations"],qe=De(Object.keys(Ue).reduce(((e,t)=>(Ge.includes(t)&&(e[t]=Ue[t]),e)),{})),We=["bearing","center","pitch","zoom"],He=De(Object.keys(Ue).reduce(((e,t)=>(We.includes(t)&&(e[t]=Ue[t]),e)),{})),Ze=De(null),Xe=De({puck:null,"destination-pin":null}),Ke=De(Ue.styleUrl||""),Ye=De(Ue?.routeLines?Ue?.routeLines.map(((e,t)=>({id:`route-line-internal-mock-layer_${t}`,type:"line",source:Be,...{layout:e?.layout,paint:e?.paint}}))):[{id:"route-line-internal-mock-layer_0",type:"line",source:Be,...$e}]),Je=De(Ue.deviceSize||null),Qe=De({loading:!1}),et=["durationMultiplier","routingOptions","speedOptions","maneuverOptions"];const tt=De(Object.keys(Ue).reduce(((e,t)=>(et.includes(t)&&(e[t]=Ue[t]),e)),{}));function it(e){let t,i,r,o,s,a,l;const c=[e[3]];var u=e[2];function h(e){let t={};for(let e=0;e<c.length;e+=1)t=n(t,c[e]);return{props:t}}return u&&(s=new u(h())),{c(){t=w("div"),i=w("div"),o=S(),s&&me(s.$$.fragment),A(i,"class","outline svelte-ni5cvj"),A(i,"style",r=`height:${e[0]+40}px; width:${e[1]+40}px`),A(t,"class","layout svelte-ni5cvj"),A(t,"style",a=`height:${e[0]}px; width:${e[1]}px`)},m(e,n){v(e,t,n),_(t,i),_(t,o),s&&ge(s,t,null),l=!0},p(e,[n]){(!l||3&n&&r!==(r=`height:${e[0]+40}px; width:${e[1]+40}px`))&&A(i,"style",r);const o=8&n?de(c,[pe(e[3])]):{};if(u!==(u=e[2])){if(s){oe();const e=s;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}u?(s=new u(h()),me(s.$$.fragment),ae(s.$$.fragment,1),ge(s,t,null)):s=null}else u&&s.$set(o);(!l||3&n&&a!==(a=`height:${e[0]}px; width:${e[1]}px`))&&A(t,"style",a)},i(e){l||(s&&ae(s.$$.fragment,e),l=!0)},o(e){s&&le(s.$$.fragment,e),l=!1},d(e){e&&x(t),s&&ye(s)}}}function nt(e,t,i){let{height:n}=t,{width:r}=t,{children:o}=t,{childProps:s}=t;return e.$$set=e=>{"height"in e&&i(0,n=e.height),"width"in e&&i(1,r=e.width),"children"in e&&i(2,o=e.children),"childProps"in e&&i(3,s=e.childProps)},[n,r,o,s]}class rt extends ve{constructor(e){super(),_e(this,e,nt,it,l,{height:0,width:1,children:2,childProps:3})}}function ot({personalAccessToken:e,fetchFunc:t}){this._personalAccessToken=e,this._fetchFunc=t}ot.prototype.get=async function(e,t){const i=t?"?"+new URLSearchParams(t).toString():"",n=await this._fetchFunc(`https://api.figma.com/v1/${e}${i}`,{headers:{"X-Figma-Token":this._personalAccessToken}});if(n.status>=400){let e="";try{e+=(await n.json()).err}finally{throw new Error(`HTTP error ${n.status} accessing Figma. ${e}`)}}return n.json()};const st=function({file:e,nodeIds:t}){function i(e,t){return e===t.id?t:t.children?t.children.map((t=>i(e,t))).find(Boolean):null}return t.map((t=>i(t,e.document)))},at=function({file:e,names:t}){function i(e,t){return e===t.name&&"FRAME"===t.type?t.id:t.children?t.children.map((t=>i(e,t))).find(Boolean):null}return t.map((t=>i(t,e.document)))};async function lt({api:e,fileKey:t,assetList:i,scales:n=[1],format:r="png"}){const o={},s=await Promise.all(n.map((n=>async function(n){return e.get(`images/${t}`,{ids:Object.values(i),format:r,scale:n})}(n))));return n.forEach(((e,t)=>{for(const n of Object.keys(i)){const r=i[n];o[n]=o[n]||{id:r},o[n][`@${e}x`]=s[t].images[r]}})),o}async function ct({frameIds:e=[],frameNames:t=[],fileKey:i,personalAccessToken:n,scales:r=[1],format:o="png",fetchFunc:s=((...e)=>window.fetch(...e))}){const a=new ot({personalAccessToken:n,fetchFunc:s}),l=await a.get(`files/${i}`);t.length&&(e=[...e,...at({file:l,names:t})]);const c=st({file:l,nodeIds:e}).filter(Boolean);if(!c.length)throw new Error(`No matching frames for ${e}, ${t}`);const u=function(e){const t={};for(const i of e.filter(Boolean))for(const e of i.children)t[e.name]=e.id;return t}(c);return await lt({api:a,fileKey:i,assetList:u,scales:r,format:o})}function ut(e,t){for(const i of Object.keys(t)){const n=Math.max(...Object.keys(t[i]).filter((e=>"@"===e[0])).map((e=>+e.replace(/[^0-9.]/g,""))));e.loadImage(t[i][`@${n}x`],((t,r)=>{e.addImage(i,r,{pixelRatio:n})}))}}var ht={getFigmaIconsByFrames:ct,getFigmassets:ct,addAssetsToMap:ut,loadFigmassets:async function({map:e,...t}){e&&!t.scales&&(t.scales=[2]);const i=await ct(t);return e&&ut(e,i),i},loadStoredFigmassets:async function({map:e,path:t}){t&&(t=t.replace(/([^/])$/,"$1/"));const i=await fetch(`${t}assets.json`).then((e=>e.json()));for(const n of i)e.loadImage(`${t}${n.fileName}`,((t,i)=>{e.addImage(n.id,i,{pixelRatio:n.scale})}))}};let dt;Ve.subscribe((e=>({figmaLink:dt}=e)));const pt=async e=>{if(!dt)return new Promise([]);let t={...dt,frameNames:[...new Set(Oe.map((e=>dt[e])).filter(Boolean))],scales:[dt.scale]};delete t.destinationPin,delete t.puck,delete t.scale;const i=ht.loadFigmassets(t),n=await i;if(!Oe.some((e=>Object.keys(n).includes(e))))throw new Error(`Icons in frames need to be named ${Oe.join(", ")}. Found ${Object.keys(n).join(", ")}. Please check icon names in your Figma file.`);const r=Promise.all(Oe.filter((e=>!!n[e]||(console.warn(`${e} was not found in your Figma file.`),!1))).map((t=>new Promise(((i,r)=>{const o=n[t];if(!o)return;const s=o[Object.keys(o).find((e=>e.includes("@")))];e.loadImage(s,((n,o)=>{n&&r(n),e.addImage(t,o),i({name:t,url:s,width:o.width,height:o.height})}))})))));return r};var ft={exports:{}},mt=ft.exports=function(){var e,t,i;function n(n,r){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),i=r(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=r;else e=r}return n(["exports"],(function(e){var t="undefined"!=typeof self?self:{},i=n;function n(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}n.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},n.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},n.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},n.prototype.solveCurveX=function(e,t){var i,n,r,o,s;for(void 0===t&&(t=1e-6),r=e,s=0;s<8;s++){if(o=this.sampleCurveX(r)-e,Math.abs(o)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=e)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-e)<t)return r;e>o?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var r=o;function o(e,t){this.x=e,this.y=t}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),n=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),n=Math.sin(e),r=t.y+n*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-n*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e};const s=Math.PI/180,a=180/Math.PI;function l(e){return e*s}function c(e){return e*a}const u=[[0,0],[1,0],[1,1],[0,1]];function h(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function d(e,t,n,r){const o=new i(e,t,n,r);return function(e){return o.solve(e)}}const p=d(.25,.1,.25,1);function f(e,t,i){return Math.min(i,Math.max(t,e))}function m(e,t,i){return(i=f((i-e)/(t-e),0,1))*i*(3-2*i)}function g(e,t,i){const n=i-t,r=((e-t)%n+n)%n+t;return r===t?i:r}function y(e,t,i){if(!e.length)return i(null,[]);let n=e.length;const r=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),r[s]=t,0==--n&&i(o,r)}))}))}function _(e){const t=[];for(const i in e)t.push(e[i]);return t}function v(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let x=1;function b(){return x++}function w(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function T(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function k(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function S(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function C(e,t){return-1!==e.indexOf(t,e.length-t.length)}function E(e,t,i){const n={};for(const r in e)n[r]=t.call(i||this,e[r],r,e);return n}function M(e,t,i){const n={};for(const r in e)t.call(i||this,e[r],r,e)&&(n[r]=e[r]);return n}function A(e){return Array.isArray(e)?e.map(A):"object"==typeof e&&e?E(e,A):e}const z={};function I(e){z[e]||("undefined"!=typeof console&&console.warn(e),z[e]=!0)}function L(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function D(e){let t=0;for(let i,n,r=0,o=e.length,s=o-1;r<o;s=r++)i=e[r],n=e[s],t+=(n.x-i.x)*(i.y+n.y);return t}function P(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function O(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,n,r)=>{const o=n||r;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let R=null;function B(e){if(null==R){const t=e.navigator?e.navigator.userAgent:null;R=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return R}function F(e){try{const i=t[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function $(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const j=t.performance;function N(e){const t=e?e.url.toString():void 0;return j.getEntriesByName(t)}var U="2.9.1";let V,G,q,W;const H={now:()=>void 0!==q?q:t.performance.now(),setNow(e){q=e},restoreNow(){q=void 0},frame(e){const i=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(i)}},getImageData(e,i=0){const{width:n,height:r}=e;W||(W=t.document.createElement("canvas"));const o=W.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return(n>W.width||r>W.height)&&(W.width=n,W.height=r),o.clearRect(-i,-i,n+2*i,r+2*i),o.drawImage(e,0,0,n,r),o.getImageData(-i,-i,n+2*i,r+2*i)},resolveURL:e=>(V||(V=t.document.createElement("a")),V.href=e,V.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==G&&(G=t.matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}};let Z;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Z){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Z=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){Z=e}}return Z},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},K={supported:!1,testSupport:function(e){!Q&&J&&(ee?te(e):Y=e)}};let Y,J,Q=!1,ee=!1;function te(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,J),e.isContextLost())return;K.supported=!0}catch(e){}e.deleteTexture(t),Q=!0}t.document&&(J=t.document.createElement("img"),J.onload=function(){Y&&te(Y),Y=null,ee=!0},J.onerror=function(){Q=!0,Y=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ie="01",ne="NO_ACCESS_TOKEN";function re(e){return 0===e.indexOf("mapbox:")}function oe(e){return X.API_URL_REGEX.test(e)}const se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ae(e){const t=e.match(se);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function le(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function ce(e){if(!e)return null;const i=e.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(i[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ue{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ce(X.ACCESS_TOKEN);let n="";return n=i&&i.u?t.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):X.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=F("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const r=t.localStorage.getItem(n);r&&(this.anonId=r)}catch(e){I("Unable to read from LocalStorage")}}saveEventData(){const e=F("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(e){I("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,n){if(!X.EVENTS_URL)return;const r=ae(X.EVENTS_URL);r.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:ie,userId:this.anonId},s=t?v(o,t):o,a={url:le(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=Le(a,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const he=new class extends ue{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>re(e)||oe(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ce(X.ACCESS_TOKEN),i=t?t.u:X.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;k(this.anonId)||(this.anonId=w(),n=!0);const r=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(r),i=(r-this.eventData.lastSuccess)/864e5;n=n||i>=1||i<-1||e.getDate()!==t.getDate()}else n=!0;n?this.postEvent(r,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=r,this.eventData.tokenU=i)}),e):this.processRequests()}},de=he.postTurnstileEvent.bind(he),pe=new class extends ue{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,X.EVENTS_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ne)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),k(this.anonId)||(this.anonId=w()),this.postEvent(i,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},fe=pe.postMapLoadEvent.bind(pe),me=new class extends ue{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!X.API_URL||!X.SESSION_PATH)return;const r=ae(X.API_URL+X.SESSION_PATH);r.params.push(`sku=${t||""}`),r.params.push(`access_token=${n||X.ACCESS_TOKEN||""}`);const o={url:le(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=De(o,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,X.SESSION_PATH&&X.API_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(ne)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},ge=me.getSessionAPI.bind(me),ye=new Set;let _e,ve=500,xe=50,be={};function we(e){const t=ke(e);let i,n;t&&t.forEach((e=>{const t=e.split("=");"language"===t[0]?i=t[1]:"worldview"===t[0]&&(n=t[1])}));let r="mapbox-tiles";return i&&(r+=`-${i}`),n&&(r+=`-${n}`),r}function Te(e){t.caches&&!be[e]&&(be[e]=t.caches.open(e))}function ke(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}function Se(e){const t=e.indexOf("?");if(t<0)return e;const i=ke(e).filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return i.length?`${e.slice(0,t)}?${i.join("&")}`:e.slice(0,t)}let Ce=1/0;const Ee={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ee);class Me extends Error{constructor(e,t,i){401===t&&oe(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ae=P()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,ze=function(e,i){if(!(/^file:/.test(n=e.url)||/^file:/.test(Ae())&&!/^\w+:/.test(n))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,i){const n=new t.AbortController,r=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ae(),signal:n.signal});let o=!1,s=!1;const a=(l=r.url).indexOf("sku=")>0&&oe(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(n,o,l)=>{if(s)return;if(n&&"SecurityError"!==n.message&&I(n),o&&l)return u(o);const c=Date.now();t.fetch(r).then((t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return i(new Me(t.statusText,t.status,e.url))})).catch((e=>{20!==e.code&&i(new Error(e.message))}))},u=(n,a,l)=>{("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((e=>{s||(a&&l&&function(e,i,n){const r=we(e.url);if(Te(r),!be[r])return;const o={status:i.status,statusText:i.statusText,headers:new t.Headers};i.headers.forEach(((e,t)=>o.headers.set(t,e)));const s=O(i.headers.get("Cache-Control")||"");if(s["no-store"])return;s["max-age"]&&o.headers.set("Expires",new Date(n+1e3*s["max-age"]).toUTCString());const a=o.headers.get("Expires");a&&(new Date(a).getTime()-n<42e4||function(e,t){if(void 0===_e)try{new Response(new ReadableStream),_e=!0}catch(e){_e=!1}_e?t(e.body):e.blob().then(t)}(i,(i=>{const n=new t.Response(i,o);Te(r),be[r]&&be[r].then((t=>t.put(Se(e.url),n))).catch((e=>I(e.message)))})))}(r,a,l),o=!0,i(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((e=>{s||i(new Error(e.message))}))};return a?function(e,t){const i=we(e.url);if(Te(i),!be[i])return t(null);const n=Se(e.url);be[i].then((e=>{e.match(n).then((i=>{const r=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=O(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(i);e.delete(n),r&&e.put(n,i.clone()),t(null,i,r)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{s=!0,o||n.abort()}}}(e,i);if(P()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,i,void 0,!0)}var n;return function(e,i){const n=new t.XMLHttpRequest;n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer");for(const t in e.headers)n.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=()=>{i(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let t=n.response;if("json"===e.type)try{t=JSON.parse(n.response)}catch(e){return i(e)}i(null,t,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else i(new Me(n.statusText,n.status,e.url))},n.send(e.body),{cancel:()=>n.abort()}}(e,i)},Ie=function(e,t){return ze(v(e,{type:"arrayBuffer"}),t)},Le=function(e,t){return ze(v(e,{method:"POST"}),t)},De=function(e,t){return ze(v(e,{method:"GET"}),t)};function Pe(e){const i=t.document.createElement("a");return i.href=e,i.protocol===t.document.location.protocol&&i.host===t.document.location.host}const Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Re,Be;Re=[],Be=0;const Fe=function(e,i){if(K.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Be>=X.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Re.push(t),t}Be++;let n=!1;const r=()=>{if(!n)for(n=!0,Be--;Re.length&&Be<X.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Re.shift(),{requestParameters:t,callback:i,cancelled:n}=e;n||(e.cancel=Fe(t,i).cancel)}},o=Ie(e,((e,n,o,s)=>{r(),e?i(e):n&&(t.createImageBitmap?function(e,i){const n=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(n).then((e=>{i(null,e)})).catch((e=>{i(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(n,((e,t)=>i(e,t,o,s))):function(e,i){const n=new t.Image,r=t.URL;n.onload=()=>{i(null,n),r.revokeObjectURL(n.src),n.onload=null,t.requestAnimationFrame((()=>{n.src=Oe}))},n.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(o):Oe}(n,((e,t)=>i(e,t,o,s))))}));return{cancel:()=>{o.cancel(),r()}}};function $e(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function je(e,t,i){if(i&&i[e]){const n=i[e].indexOf(t);-1!==n&&i[e].splice(n,1)}}class Ne{constructor(e,t={}){v(this,t),this.type=e}}class Ue extends Ne{constructor(e,t={}){super("error",v({error:e},t))}}class Ve{on(e,t){return this._listeners=this._listeners||{},$e(e,t,this._listeners),this}off(e,t){return je(e,t,this._listeners),je(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},$e(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ne(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const n=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of n)je(i,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(v(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof Ue&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qe(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function We(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function He(e){if(Array.isArray(e))return e.map(He);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=He(e[i]);return t}return We(e)}class Ze extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Xe=Ze;class Ke{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Ke(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ye=Ke;const Je={kind:"null"},Qe={kind:"number"},et={kind:"string"},tt={kind:"boolean"},it={kind:"color"},nt={kind:"object"},rt={kind:"value"},ot={kind:"collator"},st={kind:"formatted"},at={kind:"resolvedImage"};function lt(e,t){return{kind:"array",itemType:e,N:t}}function ct(e){if("array"===e.kind){const t=ct(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const ut=[Je,Qe,et,tt,it,st,nt,lt(rt),at];function ht(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ht(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of ut)if(!ht(e,t))return null}return`Expected ${ct(e)} but found ${ct(t)} instead.`}function dt(e,t){return t.some((t=>t.kind===e.kind))}function pt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function ft(e){var t={exports:{}};return e(t,t.exports),t.exports}var mt=ft((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return n("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function o(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function s(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,a=e.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(t=parseInt(a.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===a.length&&(t=parseInt(a.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[n(255*s(y,g,p+1/3)),n(255*s(y,g,p)),n(255*s(y,g,p-1/3)),d];default:return null}}return null}}catch(e){}}));class gt{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof gt)return e;if("string"!=typeof e)return;const t=mt.parseCSSColor(e);return t?new gt(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}toArray01(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,i/n,n]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:n}=this;return[e,t,i,n]}}gt.black=new gt(0,0,0,1),gt.white=new gt(1,1,1,1),gt.transparent=new gt(0,0,0,0),gt.red=new gt(1,0,0,1),gt.blue=new gt(0,0,1,1);var yt=gt;class _t{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vt{constructor(e,t,i,n,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=n,this.textColor=r}}class xt{constructor(e){this.sections=e}static fromString(e){return new xt([new vt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof xt?e:xt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new bt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function wt(e,t,i,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof yt)return!0;if(e instanceof _t)return!0;if(e instanceof xt)return!0;if(e instanceof bt)return!0;if(Array.isArray(e)){for(const t of e)if(!Tt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Tt(e[t]))return!1;return!0}return!1}function kt(e){if(null===e)return Je;if("string"==typeof e)return et;if("boolean"==typeof e)return tt;if("number"==typeof e)return Qe;if(e instanceof yt)return it;if(e instanceof _t)return ot;if(e instanceof xt)return st;if(e instanceof bt)return at;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=kt(t);if(i){if(i===e)continue;i=rt;break}i=e}return lt(i||rt,t)}return nt}function St(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof yt||e instanceof xt||e instanceof bt?e.toString():JSON.stringify(e)}class Ct{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tt(e[1]))return t.error("invalid value");const i=e[1];let n=kt(i);const r=t.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Ct(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof yt?["rgba"].concat(this.value.toArray()):this.value instanceof xt?this.value.serialize():this.value}}var Et=Ct,Mt=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const At={string:et,number:Qe,boolean:tt,object:nt};class zt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,n=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in At)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=At[i],n++}else r=rt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}i=lt(r,o)}else i=At[r];const o=[];for(;n<e.length;n++){const i=t.parse(e[n],n,rt);if(!i)return null;o.push(i)}return new zt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!ht(this.type,kt(i)))return i;if(t===this.args.length-1)throw new Mt(`Expected value to be of type ${ct(this.type)}, but found ${ct(kt(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}var It=zt;class Lt{constructor(e){this.type=st,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Qe),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,lt(et)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,it),!s))return null;const a=n[n.length-1];a.scale=e,a.font=i,a.textColor=s}else{const o=t.parse(e[i],1,rt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new Lt(n)}evaluate(e){return new xt(this.sections.map((t=>{const i=t.content.evaluate(e);return kt(i)===at?new vt("",i,null,null,null):new vt(St(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Dt{constructor(e){this.type=at,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,et);return i?new Dt(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=bt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Pt={"to-boolean":tt,"to-color":it,"to-number":Qe,"to-string":et};class Ot{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const n=Pt[i],r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,rt);if(!n)return null;r.push(n)}return new Ot(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const n of this.args){if(t=n.evaluate(e),i=null,t instanceof yt)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:wt(t[0],t[1],t[2],t[3]),!i))return new yt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Mt(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Mt(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?xt.fromString(St(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?bt.fromString(St(this.args[0].evaluate(e))):St(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Lt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Dt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Rt=Ot;const Bt=["Unknown","Point","LineString","Polygon"];var Ft=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Bt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=yt.parse(e)),t}};class $t{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=$t.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,o]of s){a=new di(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],r=Array.isArray(n)?n[t-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(n)?n[e]:n.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new $t(i,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(ct).join(", ")})`:`(${ct(t.type)}...)`;var t})).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(ct(r.type))}t.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){$t.definitions=t;for(const i in t)e[i]=$t}}var jt=$t;class Nt{constructor(e,t,i){this.type=ot,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,tt);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,tt);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,et),!o)?null:new Nt(n,r,o)}evaluate(e){return new _t(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ut=8192;function Vt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Gt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function qt(e,t){const i=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(i*r*Ut),Math.round(n*r*Ut)]}function Wt(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function Ht(e,t){let i=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(Wt(e,a[t],a[t+1]))return!1;(r=a[t])[1]>(n=e)[1]!=(o=a[t+1])[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function Zt(e,t){for(let i=0;i<t.length;i++)if(Ht(e,t[i]))return!0;return!1}function Xt(e,t,i,n){const r=n[0]-i[0],o=n[1]-i[1],s=(e[0]-i[0])*o-r*(e[1]-i[1]),a=(t[0]-i[0])*o-r*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Kt(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(r=t)[0]-(n=e)[0],r[1]-n[1]])[1]-a[1]*l[0]&&Xt(n,r,o,s)&&Xt(o,s,n,r))return!0;var n,r,o,s,a,l;return!1}function Yt(e,t){for(let i=0;i<e.length;++i)if(!Ht(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Kt(e[i],e[i+1],t))return!1;return!0}function Jt(e,t){for(let i=0;i<t.length;i++)if(Yt(e,t[i]))return!0;return!1}function Qt(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const s=qt(e[r][n],i);Vt(t,s),o.push(s)}n.push(o)}return n}function ei(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=Qt(e[r],t,i);n.push(o)}return n}function ti(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r}Vt(t,e)}function ii(e,t,i,n){const r=Math.pow(2,n.z)*Ut,o=[n.x*Ut,n.y*Ut],s=[];if(!e)return s;for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];ti(n,t,i,r),s.push(n)}return s}function ni(e,t,i,n){const r=Math.pow(2,n.z)*Ut,o=[n.x*Ut,n.y*Ut],s=[];if(!e)return s;for(const i of e){const e=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];Vt(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const n of e)ti(n,t,i,r)}var a;return s}class ri{constructor(e,t){this.type=tt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ri(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ri(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ri(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Qt(t.coordinates,n,r),s=ii(e.geometry(),i,n,r);if(!Gt(i,n))return!1;for(const e of s)if(!Ht(e,o))return!1}if("MultiPolygon"===t.type){const o=ei(t.coordinates,n,r),s=ii(e.geometry(),i,n,r);if(!Gt(i,n))return!1;for(const e of s)if(!Zt(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=Qt(t.coordinates,n,r),s=ni(e.geometry(),i,n,r);if(!Gt(i,n))return!1;for(const e of s)if(!Yt(e,o))return!1}if("MultiPolygon"===t.type){const o=ei(t.coordinates,n,r),s=ni(e.geometry(),i,n,r);if(!Gt(i,n))return!1;for(const e of s)if(!Jt(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var oi=ri;function si(e){if(e instanceof jt){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof oi)return!1;let t=!0;return e.eachChild((e=>{t&&!si(e)&&(t=!1)})),t}function ai(e){if(e instanceof jt&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!ai(e)&&(t=!1)})),t}function li(e,t){if(e instanceof jt&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!li(e,t)&&(i=!1)})),i}class ci{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new ci(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ui=ci;class hi{constructor(e,t=[],i,n=new Ye,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(e,t,i,n,r={}){return t?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return"assert"===i?new It(t,[e]):"coerce"===i?new Rt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Et)&&"resolvedImage"!==n.type.kind&&pi(n)){const t=new Ft;try{n=new Et(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new hi(this.registry,n,t||null,r,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Xe(i,e))}checkSubtype(e,t){const i=ht(e,t);return i&&this.error(i),i}}var di=hi;function pi(e){if(e instanceof ui)return pi(e.boundExpression);if(e instanceof jt&&"error"===e.name)return!1;if(e instanceof Nt)return!1;if(e instanceof oi)return!1;const t=e instanceof Rt||e instanceof It;let i=!0;return e.eachChild((e=>{i=t?i&&pi(e):i&&e instanceof Et})),!!i&&si(e)&&li(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function fi(e,t){const i=e.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=e[a],r=e[a+1],n<=t){if(a===i||t<r)return a;o=a+1}else{if(!(n>t))throw new Mt("Input is not a number.");s=a-1}return 0}class mi{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Qe);if(!i)return null;const n=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new mi(r,i,n)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;return n>=t[r-1]?i[r-1].evaluate(e):i[fi(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var gi=mi;function yi(e,t,i){return e*(1-i)+t*i}var _i=Object.freeze({__proto__:null,number:yi,color:function(e,t,i){return new yt(yi(e.r,t.r,i),yi(e.g,t.g,i),yi(e.b,t.b,i),yi(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,n)=>yi(e,t[n],i)))}});const vi=.95047,xi=1.08883,bi=4/29,wi=6/29,Ti=3*wi*wi,ki=Math.PI/180,Si=180/Math.PI;function Ci(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ti+bi}function Ei(e){return e>wi?e*e*e:Ti*(e-bi)}function Mi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ai(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function zi(e){const t=Ai(e.r),i=Ai(e.g),n=Ai(e.b),r=Ci((.4124564*t+.3575761*i+.1804375*n)/vi),o=Ci((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Ci((.0193339*t+.119192*i+.9503041*n)/xi)),alpha:e.a}}function Ii(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Ei(t),i=vi*Ei(i),n=xi*Ei(n),new yt(Mi(3.2404542*i-1.5371385*t-.4985314*n),Mi(-.969266*i+1.8760108*t+.041556*n),Mi(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Li(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Di={forward:zi,reverse:Ii,interpolate:function(e,t,i){return{l:yi(e.l,t.l,i),a:yi(e.a,t.a,i),b:yi(e.b,t.b,i),alpha:yi(e.alpha,t.alpha,i)}}},Pi={forward:function(e){const{l:t,a:i,b:n}=zi(e),r=Math.atan2(n,i)*Si;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ki,i=e.c;return Ii({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Li(e.h,t.h,i),c:yi(e.c,t.c,i),l:yi(e.l,t.l,i),alpha:yi(e.alpha,t.alpha,i)}}};var Oi=Object.freeze({__proto__:null,lab:Di,hcl:Pi});class Ri{constructor(e,t,i,n,r){this.type=e,this.operator=t,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,n,r){let o=0;if("exponential"===e.name)o=Bi(t,e.base,n,r);else if("linear"===e.name)o=Bi(t,1,n,r);else if("cubic-bezier"===e.name){const s=e.controlPoints;o=new i(s[0],s[1],s[2],s[3]).solve(Bi(t,1,n,r))}return o}static parse(e,t){let[i,n,r,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,Qe),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=it:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],n=o[e+1],r=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Ri(a,i,n,r,s):t.error(`Type ${ct(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=fi(t,n),s=Ri.interpolationFactor(this.interpolation,n,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?_i[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Pi.reverse(Pi.interpolate(Pi.forward(a),Pi.forward(l),s)):Di.reverse(Di.interpolate(Di.forward(a),Di.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Bi(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}var Fi=Ri;class $i{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,r.push(e)}const o=n&&r.some((e=>ht(n,e.type)));return new $i(o?rt:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(e),i&&i instanceof bt&&!i.available&&(t||(t=i),i=null,n===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var ji=$i;class Ni{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return n?new Ni(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Ui=Ni;class Vi{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Qe),n=t.parse(e[2],2,lt(t.expectedType||rt));return i&&n?new Vi(n.type.itemType,i,n):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Mt(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Mt(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Mt(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gi=Vi;class qi{constructor(e,t){this.type=tt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,rt),n=t.parse(e[2],2,rt);return i&&n?dt(i.type,[tt,et,Qe,Je,rt])?new qi(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ct(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!pt(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${ct(kt(t))} instead.`);if(!pt(i,["string","array"]))throw new Mt(`Expected second argument to be of type array or string, but found ${ct(kt(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Wi=qi;class Hi{constructor(e,t,i){this.type=Qe,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,rt),n=t.parse(e[2],2,rt);if(!i||!n)return null;if(!dt(i.type,[tt,et,Qe,Je,rt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ct(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Qe);return r?new Hi(i,n,r):null}return new Hi(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!pt(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${ct(kt(t))} instead.`);if(!pt(i,["string","array"]))throw new Mt(`Expected second argument to be of type array or string, but found ${ct(kt(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Zi=Hi;class Xi{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,kt(e)))return null}else i=kt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=t.parse(e[1],1,rt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new Xi(i,n,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(kt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i)e.push(1===n.length?r(n[0]):n.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var Ki=Xi;class Yi{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,tt);if(!o)return null;const s=t.parse(e[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new Yi(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ji=Yi;class Qi{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,rt),n=t.parse(e[2],2,Qe);if(!i||!n)return null;if(!dt(i.type,[lt(rt),et,rt]))return t.error(`Expected first argument to be of type array or string, but found ${ct(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Qe);return r?new Qi(i.type,i,n,r):null}return new Qi(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!pt(t,["string","array"]))throw new Mt(`Expected first argument to be of type array or string, but found ${ct(kt(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var en=Qi;function tn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function nn(e,t,i,n){return 0===n.compare(t,i)}function rn(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=tt,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,rt);if(!o)return null;if(!tn(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${ct(o.type)}'.`);let s=t.parse(e[2],2,rt);if(!s)return null;if(!tn(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${ct(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${ct(o.type)}' and '${ct(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new It(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new It(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,ot),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=kt(o),i=kt(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Mt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=kt(o),i=kt(s);if("string"!==e.kind||"string"!==i.kind)return t(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const on=rn("==",(function(e,t,i){return t===i}),nn),sn=rn("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return!nn(0,t,i,n)})),an=rn("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),ln=rn(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),cn=rn("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),un=rn(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class hn{constructor(e,t,i,n,r){this.type=et,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Qe);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,et),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,et),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parse(n["min-fraction-digits"],1,Qe),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=t.parse(n["max-fraction-digits"],1,Qe),!a)?null:new hn(i,r,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class dn{constructor(e){this.type=Qe,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${ct(i.type)} instead.`):new dn(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Mt(`Expected value to be of type string or array, but found ${ct(kt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const pn={"==":on,"!=":sn,">":ln,"<":an,">=":un,"<=":cn,array:It,at:Gi,boolean:It,case:Ji,coalesce:ji,collator:Nt,format:Lt,image:Dt,in:Wi,"index-of":Zi,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:dn,let:Ui,literal:Et,match:Ki,number:It,"number-format":hn,object:It,slice:en,step:gi,string:It,"to-boolean":Rt,"to-color":Rt,"to-number":Rt,"to-string":Rt,var:ui,within:oi};function fn(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,s=wt(t,i,n,o);if(s)throw new Mt(s);return new yt(t/255*o,i/255*o,n/255*o,o)}function mn(e,t){return e in t}function gn(e,t){const i=t[e];return void 0===i?null:i}function yn(e){return{type:e}}jt.register(pn,{error:[{kind:"error"},[et],(e,[t])=>{throw new Mt(t.evaluate(e))}],typeof:[et,[rt],(e,[t])=>ct(kt(t.evaluate(e)))],"to-rgba":[lt(Qe,4),[it],(e,[t])=>t.evaluate(e).toArray()],rgb:[it,[Qe,Qe,Qe],fn],rgba:[it,[Qe,Qe,Qe,Qe],fn],has:{type:tt,overloads:[[[et],(e,[t])=>mn(t.evaluate(e),e.properties())],[[et,nt],(e,[t,i])=>mn(t.evaluate(e),i.evaluate(e))]]},get:{type:rt,overloads:[[[et],(e,[t])=>gn(t.evaluate(e),e.properties())],[[et,nt],(e,[t,i])=>gn(t.evaluate(e),i.evaluate(e))]]},"feature-state":[rt,[et],(e,[t])=>gn(t.evaluate(e),e.featureState||{})],properties:[nt,[],e=>e.properties()],"geometry-type":[et,[],e=>e.geometryType()],id:[rt,[],e=>e.id()],zoom:[Qe,[],e=>e.globals.zoom],pitch:[Qe,[],e=>e.globals.pitch||0],"distance-from-center":[Qe,[],e=>e.distanceFromCenter()],"heatmap-density":[Qe,[],e=>e.globals.heatmapDensity||0],"line-progress":[Qe,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Qe,[],e=>e.globals.skyRadialProgress||0],accumulated:[rt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Qe,yn(Qe),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[Qe,yn(Qe),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:Qe,overloads:[[[Qe,Qe],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Qe],(e,[t])=>-t.evaluate(e)]]},"/":[Qe,[Qe,Qe],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Qe,[Qe,Qe],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Qe,[Qe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))],log2:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Qe,[Qe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Qe,[Qe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Qe,[Qe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Qe,[Qe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Qe,[Qe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Qe,[Qe],(e,[t])=>Math.atan(t.evaluate(e))],min:[Qe,yn(Qe),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Qe,yn(Qe),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Qe,[Qe],(e,[t])=>Math.abs(t.evaluate(e))],round:[Qe,[Qe],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qe,[Qe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Qe,[Qe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[tt,[et,rt],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[tt,[rt],(e,[t])=>e.id()===t.value],"filter-type-==":[tt,[et],(e,[t])=>e.geometryType()===t.value],"filter-<":[tt,[et,rt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[tt,[rt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[tt,[et,rt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[tt,[rt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[tt,[et,rt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[tt,[rt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[tt,[et,rt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[tt,[rt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[tt,[rt],(e,[t])=>t.value in e.properties()],"filter-has-id":[tt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[tt,[lt(et)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[tt,[lt(rt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[tt,[et,lt(rt)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[tt,[et,lt(rt)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return!0;t[r]>e?n=r-1:i=r+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:tt,overloads:[[[tt,tt],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[yn(tt),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:tt,overloads:[[[tt,tt],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[yn(tt),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[tt,[tt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[tt,[et],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[et,[et],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[et,[et],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[et,yn(rt),(e,t)=>t.map((t=>St(t.evaluate(e)))).join("")],"resolved-locale":[et,[ot],(e,[t])=>t.evaluate(e).resolvedLocale()]});var _n=pn;function vn(e){return{result:"success",value:e}}function xn(e){return{result:"error",value:e}}function bn(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function wn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Tn(e){return!!e.expression&&e.expression.interpolated}function kn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Sn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Cn(e){return e}function En(e,t){const i="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],r=n||!(n||void 0!==e.property),o=e.type||(Tn(t)?"exponential":"interval");if(i&&((e=qe({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],yt.parse(e[1])]))),e.default=yt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Oi[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=In;else if("interval"===o)s=zn;else if("categorical"===o){s=An,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=Ln}if(n){const i={},n=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),i[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of n)r.push([i[e].zoom,En(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Fi.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:i},n)=>In({stops:r,base:e.base},t,i).evaluate(i,n)}}if(r){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Fi.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>s(e,t,i,a,l)}}return{kind:"source",evaluate(i,n){const r=n&&n.properties?n.properties[e.property]:void 0;return void 0===r?Mn(e.default,t.default):s(e,t,r,a,l)}}}function Mn(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function An(e,t,i,n,r){return Mn(typeof i===r?n[i]:void 0,e.default,t.default)}function zn(e,t,i){if("number"!==kn(i))return Mn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const r=fi(e.stops.map((e=>e[0])),i);return e.stops[r][1]}function In(e,t,i){const n=void 0!==e.base?e.base:1;if("number"!==kn(i))return Mn(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const o=fi(e.stops.map((e=>e[0])),i),s=function(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(i,n,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=_i[t.type]||Cn;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Oi[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,s)}}:c(a,l,s)}function Ln(e,t,i){return"color"===t.type?i=yt.parse(i):"formatted"===t.type?i=xt.fromString(i.toString()):"resolvedImage"===t.type?i=bt.fromString(i.toString()):kn(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Mn(i,e.default,t.default)}class Dn{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ft,this._defaultValue=t?function(e){return"color"===e.type&&(Sn(e.default)||Array.isArray(e.default))?new yt(0,0,0,0):"color"===e.type?yt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,n,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Mt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Pn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in _n}function On(e,t){const i=new di(_n,[],t?function(e){const t={color:it,string:et,number:Qe,enum:et,boolean:tt,formatted:st,resolvedImage:at};return"array"===e.type?lt(t[e.value]||rt,e.length):t[e.type]}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?vn(new Dn(n,t)):xn(i.errors)}class Rn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!ai(t.expression)}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Bn{constructor(e,t,i,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!ai(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,e,t,i):0}}function Fn(e,t){if("error"===(e=On(e,t)).result)return e;const i=e.value.expression,n=si(i);if(!n&&!bn(t))return xn([new Xe("","data expressions not supported")]);const r=li(i,["zoom","pitch","distance-from-center"]);if(!r&&!wn(t))return xn([new Xe("","zoom expressions not supported")]);const o=jn(i);return o||r?o instanceof Xe?xn([o]):o instanceof Fi&&!Tn(t)?xn([new Xe("",'"interpolate" expressions cannot be used with this property')]):vn(o?new Bn(n?"camera":"composite",e.value,o.labels,o instanceof Fi?o.interpolation:void 0):new Rn(n?"constant":"source",e.value)):xn([new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $n{constructor(e,t){this._parameters=e,this._specification=t,qe(this,En(this._parameters,this._specification))}static deserialize(e){return new $n(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jn(e){let t=null;if(e instanceof Ui)t=jn(e.result);else if(e instanceof ji){for(const i of e.args)if(t=jn(i),t)break}else(e instanceof gi||e instanceof Fi)&&e.input instanceof jt&&"zoom"===e.input.name&&(t=e);return t instanceof Xe||e.eachChild((e=>{const i=jn(e);i instanceof Xe?t=i:!t&&i?t=new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Xe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}class Nn{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Un(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=kn(i);if("object"!==l)return[new Nn(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=n[l]||n["*"];let u;r[l]?u=r[l]:n[l]?u=br:r["*"]?u=r["*"]:n["*"]&&(u=br),u?a=a.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:e},i)):a.push(new Nn(t,i[e],`unknown property "${e}"`))}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&a.push(new Nn(t,i,`missing required property "${e}"`));return a}function Vn(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||br;if("array"!==kn(t))return[new Nn(o,t,`array expected, ${kn(t)} found`)];if(i.length&&t.length!==i.length)return[new Nn(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Nn(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(a.function=i.function),"object"===kn(i.value)&&(a=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function Gn(e){const t=e.key,i=e.value,n=e.valueSpec;let r=kn(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new Nn(t,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===kn(n.minimum)&&(r=n.minimum[e.arrayIndex]),i<r)return[new Nn(t,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===kn(n.maximum)&&(r=n.maximum[e.arrayIndex]),i>r)return[new Nn(t,i,`${i} is greater than the maximum value ${r}`)]}return[]}function qn(e){const t=e.valueSpec,i=We(e.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===kn(e.value.stops)&&"array"===kn(e.value.stops[0])&&"object"===kn(e.value.stops[0][0]),u=Un({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Nn(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(Vn({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===kn(n)&&0===n.length&&t.push(new Nn(e.key,n,"array must have at least one stop")),t},default:function(e){return br({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Nn(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Nn(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!Tn(e.valueSpec)&&u.push(new Nn(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!bn(e.valueSpec)?u.push(new Nn(e.key,e.value,"property functions not supported")):a&&!wn(e.valueSpec)&&u.push(new Nn(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Nn(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const n=e.value,a=e.key;if("array"!==kn(n))return[new Nn(a,n,`array expected, ${kn(n)} found`)];if(2!==n.length)return[new Nn(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==kn(n[0]))return[new Nn(a,n,`object expected, ${kn(n[0])} found`)];if(void 0===n[0].zoom)return[new Nn(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Nn(a,n,"object stop key must have value")];const t=We(n[0].zoom);if("number"!=typeof t)return[new Nn(a,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Nn(a,n[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,s={}),i=i.concat(Un({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Gn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return Pn(He(n[1]))?i.concat([new Nn(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(br({key:`${a}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=kn(e.value),l=We(e.value),c=null!==e.value?e.value:o;if(n){if(a!==n)return[new Nn(e.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Nn(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return bn(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nn(e.key,c,n)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new Nn(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new Nn(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Nn(e.key,c,`integer expected, found ${String(l)}`)]}}function Wn(e){const t=("property"===e.expressionContext?Fn:On)(He(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Nn(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Nn(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ai(i))return[new Nn(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Hn(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!li(i,["zoom","feature-state"]))return[new Nn(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!si(i))return[new Nn(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hn(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return e instanceof jt&&i.has(e.name)?[new Nn(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...Hn(e,t))})),n)}function Zn(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(We(i))&&r.push(new Nn(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(We(i))&&r.push(new Nn(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Xn(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Xn(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Kn(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Xn(e)||(e=nr(e));const i=e;let n=!0;try{n=function(e){if(!Qn(e))return e;let t=He(e);return Jn(t),t=Yn(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const r=Ge[`filter_${t}`],o=On(n,r);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,i)=>o.value.evaluate(e,t,{},i);let a=null,l=null;if(n!==i){const e=On(i,r);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,i,n,r,o)=>e.value.evaluate(t,i,{},n,void 0,void 0,r,o),l=!si(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:ir(n),needFeature:!!l}}function Yn(e){if(!Array.isArray(e))return e;const t=function(e){if(er.has(e[0]))for(let t=1;t<e.length;t++)if(Qn(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Yn(e)))}function Jn(e){let t=!1;const i=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||Qn(e[n]),i.push(e[n+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||Qn(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||Qn(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)Jn(e[t])}function Qn(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(Qn(e[t]))return!0;return!1}const er=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function tr(e,t){return e<t?-1:e>t?1:0}function ir(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(ir(e[t]))return!0;return!1}function nr(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?rr(e[1],e[2],"=="):"!="===t?ar(rr(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?rr(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(nr))):"all"===t?["all"].concat(e.slice(1).map(nr)):"none"===t?["all"].concat(e.slice(1).map(nr).map(ar)):"in"===t?or(e[1],e.slice(2)):"!in"===t?ar(or(e[1],e.slice(2))):"has"===t?sr(e[1]):"!has"===t?ar(sr(e[1])):"within"!==t||e;var i}function rr(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function or(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(tr)]]:["filter-in-small",e,["literal",t]]}}function sr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function ar(e){return["!",e]}function lr(e){return Xn(He(e.value))?Wn(qe({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):cr(e)}function cr(e){const t=e.value,i=e.key;if("array"!==kn(t))return[new Nn(i,t,`array expected, ${kn(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return[new Nn(i,t,"filter array must have at least 1 element")];switch(o=o.concat(Zn({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),We(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===We(t[1])&&o.push(new Nn(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Nn(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=kn(t[1]),"string"!==r&&o.push(new Nn(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=kn(t[s]),"$type"===We(t[1])?o=o.concat(Zn({key:`${i}[${s}]`,value:t[s],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Nn(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(cr({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=kn(t[1]),2!==t.length?o.push(new Nn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Nn(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=kn(t[1]),2!==t.length?o.push(new Nn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Nn(`${i}[1]`,t[1],`object expected, ${r} found`))}return o}function ur(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,s=e.objectKey,a=r[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return br({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=e.valueSpec||a[s];if(!c)return[new Nn(i,o,`unknown property "${s}"`)];let u;if("string"===kn(o)&&bn(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Nn(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new Nn(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Sn(He(o))&&"identity"===We(o.type)&&h.push(new Nn(i,o,'"text-font" does not support identity functions'))),h.concat(br({key:e.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:s}))}function hr(e){return ur(e,"paint")}function dr(e){return ur(e,"layout")}function pr(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Nn(n,i,'either "type" or "ref" is required'));let s=We(i.type);const a=We(i.ref);if(i.id){const o=We(i.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];We(e.id)===o&&t.push(new Nn(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Nn(n,i[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{We(t.id)===a&&(e=t)})),e?e.ref?t.push(new Nn(n,i.ref,"ref cannot reference another ref layer")):s=We(e.type):"string"==typeof a&&t.push(new Nn(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&We(e.type);e?"vector"===o&&"raster"===s?t.push(new Nn(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new Nn(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Nn(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new Nn(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Nn(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Nn(n,i.source,`source "${i.source}" not found`))}else t.push(new Nn(n,i,'missing required property "source"'));return t=t.concat(Un({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>br({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>lr(qe({layerType:s},e)),layout:e=>Un({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>dr(qe({layerType:s},e))}}),paint:e=>Un({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>hr(qe({layerType:s},e))}})}})),t}function fr(e){const t=e.value,i=e.key,n=kn(t);return"string"!==n?[new Nn(i,t,`string expected, ${n} found`)]:[]}const mr={promoteId:function({key:e,value:t}){if("string"===kn(t))return fr({key:e,value:t});{const i=[];for(const n in t)i.push(...fr({key:`${e}.${n}`,value:t[n]}));return i}}};function gr(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return[new Nn(i,t,'"type" is required')];const o=We(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Un({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:mr}),s;case"geojson":if(s=Un({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:mr}),t.cluster)for(const e in t.clusterProperties){const[n,r]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;s.push(...Wn({key:`${i}.${e}.map`,value:r,expressionContext:"cluster-map"})),s.push(...Wn({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Un({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Un({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new Nn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zn({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}}function yr(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const s=kn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Nn("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?br({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i}):n[e]?br({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}):[new Nn(e,t[e],`unknown property "${e}"`)])}return o}function _r(e){const t=e.value,i=e.key,n=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=kn(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Nn("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const i=e.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?br({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r}):o[e]?br({key:e,value:t[e],valueSpec:o[e],style:n,styleSpec:r}):[new Nn(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],r=e&&We(e.type);e?"raster-dem"!==r&&s.push(new Nn(i,t.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):s.push(new Nn(i,t.source,`source "${t.source}" not found`))}else s.push(new Nn(i,t,'terrain is missing required property "source"'));return s}function vr(e){const t=e.value,i=e.style,n=e.styleSpec,r=n.fog;let o=[];const s=kn(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Nn("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?br({key:e,value:t[e],valueSpec:n.transition,style:i,styleSpec:n}):r[e]?br({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n}):[new Nn(e,t[e],`unknown property "${e}"`)])}return o}const xr={"*":()=>[],array:Vn,boolean:function(e){const t=e.value,i=e.key,n=kn(t);return"boolean"!==n?[new Nn(i,t,`boolean expected, ${n} found`)]:[]},number:Gn,color:function(e){const t=e.key,i=e.value,n=kn(i);return"string"!==n?[new Nn(t,i,`color expected, ${n} found`)]:null===mt.parseCSSColor(i)?[new Nn(t,i,`color expected, "${i}" found`)]:[]},enum:Zn,filter:lr,function:qn,layer:pr,object:Un,source:gr,light:yr,terrain:_r,fog:vr,string:fr,formatted:function(e){return 0===fr(e).length?[]:Wn(e)},resolvedImage:function(e){return 0===fr(e).length?[]:Wn(e)},projection:function(e){const t=e.value,i=e.styleSpec,n=i.projection,r=e.style;let o=[];const s=kn(t);if("object"===s)for(const e in t)o=o.concat(br({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}));else"string"!==s&&(o=o.concat([new Nn("projection",t,`object or string expected, ${s} found`)]));return o}};function br(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;return i.expression&&Sn(We(t))?qn(e):i.expression&&Pn(He(t))?Wn(e):i.type&&xr[i.type]?xr[i.type](e):Un(qe({},e,{valueSpec:i.type?n[i.type]:i}))}function wr(e){const t=e.value,i=e.key,n=fr(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Nn(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Nn(i,t,'"glyphs" url must include a "{range}" token'))),n}function Tr(e,t=Ge){return Cr(br({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wr,"*":()=>[]}}))}const kr=e=>Cr(hr(e)),Sr=e=>Cr(dr(e));function Cr(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function Er(e,t){let i=!1;if(t&&t.length)for(const n of t)e.fire(new Ue(new Error(n.message))),i=!0;return i}var Mr=Ar;function Ar(e,t,i){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(i=r[2]);for(var o=0;o<this.d*this.d;o++){var s=r[3+o],a=r[3+o+1];n.push(s===a?null:r.subarray(s,a))}var l=r[3+n.length+1];this.keys=r.subarray(r[3+n.length],l),this.bboxes=r.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}Ar.prototype.insert=function(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},Ar.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ar.prototype._insertCell=function(e,t,i,n,r,o){this.cells[r].push(o)},Ar.prototype.query=function(e,t,i,n,r){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=n&&!r)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,n,this._queryCell,a,{},r),a},Ar.prototype._queryCell=function(e,t,i,n,r,o,s,a){var l=this.cells[r];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&n>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},Ar.prototype._forEachCell=function(e,t,i,n,r,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(n),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&r.call(this,e,t,i,n,f,o,s,a))return}},Ar.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Ar.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Ar.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];r[3+s]=o,r.set(a,o),o+=a.length}return r[3+e.length]=o,r.set(this.keys,o),r[3+e.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};const zr={};function Ir(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),zr[t]={klass:e,omit:i.omit||[]}}Ir(Object,"Object"),Mr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Mr.deserialize=function(e){return new Mr(e.buffer)},Object.defineProperty(Mr,"name",{value:"Grid"}),Ir(Mr,"Grid"),Ir(yt,"Color"),Ir(Error,"Error"),Ir(Me,"AJAXError"),Ir(bt,"ResolvedImage"),Ir($n,"StylePropertyFunction"),Ir(Dn,"StyleExpression",{omit:["_evaluator"]}),Ir(Bn,"ZoomDependentExpression"),Ir(Rn,"ZoomConstantExpression"),Ir(jt,"CompoundExpression",{omit:["_evaluate"]});for(const e in _n)zr[_n[e]._classRegistryKey]||Ir(_n[e],`Expression${e}`);function Lr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Dr(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Pr(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Lr(e)||Dr(e))return i&&i.push(e),e;if(ArrayBuffer.isView(e)){const t=e;return i&&i.push(t.buffer),t}if(e instanceof t.ImageData)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const n of e)t.push(Pr(n,i));return t}if("object"==typeof e){const t=e.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const r=t.serialize?t.serialize(e,i):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(zr[n].omit.indexOf(t)>=0||(r[t]=Pr(e[t],i)));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(r.$name=n),r}throw new Error("can't serialize object of type "+typeof e)}function Or(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Lr(e)||Dr(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Or);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=zr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const n=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(n[t]=Or(e[t]));return n}throw new Error("can't deserialize object of type "+typeof e)}class Rr{constructor(){this.first=!0}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const Br=e=>e>=1536&&e<=1791,Fr=e=>e>=1872&&e<=1919,$r=e=>e>=2208&&e<=2303,jr=e=>e>=11904&&e<=12031,Nr=e=>e>=12032&&e<=12255,Ur=e=>e>=12272&&e<=12287,Vr=e=>e>=12288&&e<=12351,Gr=e=>e>=12352&&e<=12447,qr=e=>e>=12448&&e<=12543,Wr=e=>e>=12544&&e<=12591,Hr=e=>e>=12704&&e<=12735,Zr=e=>e>=12736&&e<=12783,Xr=e=>e>=12784&&e<=12799,Kr=e=>e>=12800&&e<=13055,Yr=e=>e>=13056&&e<=13311,Jr=e=>e>=13312&&e<=19903,Qr=e=>e>=19968&&e<=40959,eo=e=>e>=40960&&e<=42127,to=e=>e>=42128&&e<=42191,io=e=>e>=44032&&e<=55215,no=e=>e>=63744&&e<=64255,ro=e=>e>=64336&&e<=65023,oo=e=>e>=65040&&e<=65055,so=e=>e>=65072&&e<=65103,ao=e=>e>=65104&&e<=65135,lo=e=>e>=65136&&e<=65279,co=e=>e>=65280&&e<=65519;function uo(e){for(const t of e)if(fo(t.charCodeAt(0)))return!0;return!1}function ho(e){for(const t of e)if(!po(t.charCodeAt(0)))return!1;return!0}function po(e){return!(Br(e)||Fr(e)||$r(e)||ro(e)||lo(e))}function fo(e){return!(746!==e&&747!==e&&(e<4352||!(Hr(e)||Wr(e)||so(e)&&!(e>=65097&&e<=65103)||no(e)||Yr(e)||jr(e)||Zr(e)||!(!Vr(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Jr(e)||Qr(e)||Kr(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||io(e)||Gr(e)||Ur(e)||(e=>e>=12688&&e<=12703)(e)||Nr(e)||Xr(e)||qr(e)&&12540!==e||!(!co(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ao(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||oo(e)||(e=>e>=19904&&e<=19967)(e)||eo(e)||to(e))))}function mo(e){return!(fo(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Vr(e)||qr(e)||(e=>e>=57344&&e<=63743)(e)||so(e)||ao(e)||co(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function go(e){return e>=1424&&e<=2303||ro(e)||lo(e)}function yo(e,t){return!(!t&&go(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function _o(e){for(const t of e)if(go(t.charCodeAt(0)))return!0;return!1}const vo="deferred",xo="loading",bo="loaded";let wo=null,To="unavailable",ko=null;const So=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(To="error"),wo&&wo(e)};function Co(){Eo.fire(new Ne("pluginStateChange",{pluginStatus:To,pluginURL:ko}))}const Eo=new Ve,Mo=function(){return To},Ao=function(){if(To!==vo||!ko)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=xo,Co(),ko&&Ie({url:ko},(e=>{e?So(e):(To=bo,Co())}))},zo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===bo||null!=zo.applyArabicShaping,isLoading:()=>To===xo,setState(e){To=e.pluginStatus,ko=e.pluginURL},isParsed:()=>null!=zo.applyArabicShaping&&null!=zo.processBidirectionalText&&null!=zo.processStyledBidirectionalText,getPluginURL:()=>ko};class Io{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rr,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!yo(i.charCodeAt(0),t))return!1;return!0}(e,zo.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class Lo{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Sn(e))return new $n(e,t);if(Pn(e)){const i=Fn(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=yt.parse(e)),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Do{constructor(e){this.property=e,this.value=new Lo(e,void 0)}transitioned(e,t){return new Oo(this.property,this.value,t,v({},e.transition,this.transition),e.now)}untransitioned(){return new Oo(this.property,this.value,null,{},0)}}class Po{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return A(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Do(this._values[e].property)),this._values[e].value=new Lo(this._values[e].property,null===t?void 0:A(t))}getTransition(e){return A(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Do(this._values[e].property)),this._values[e].transition=A(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const n=this.getTransition(t);void 0!==n&&(e[`${t}-transition`]=n)}return e}transitioned(e,t){const i=new Ro(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(e,t._values[n]);return i}untransitioned(){const e=new Ro(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Oo{constructor(e,t,i,n,r){const o=n.delay||0,s=n.duration||0;r=r||0,this.property=e,this.value=t,this.begin=r+o,this.end=this.begin+s,e.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const n=e.now||0,r=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(n>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(n<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),r,h(s))}}return r}}class Ro{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const n=new $o(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return A(this._values[e].value)}setValue(e,t){this._values[e]=new Lo(this._values[e].property,null===t?void 0:A(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const n=new $o(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].possiblyEvaluate(e,t,i);return n}}class Fo{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,n){return this.property.evaluate(this.value,this.parameters,e,t,i,n)}}class $o{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class jo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const n=_i[this.specification.type];return n?n(e,t,i):e}}class No{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,n){return new Fo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,n)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Fo(this,{kind:"constant",value:void 0},e.parameters);const n=_i[this.specification.type];return n?new Fo(this,{kind:"constant",value:n(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,n,r,o){return"constant"===e.kind?e.value:e.evaluate(t,i,n,r,o)}}class Uo extends No{possiblyEvaluate(e,t,i,n){if(void 0===e.value)return new Fo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,t);return new Fo(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Fo(this,{kind:"constant",value:i},t)}return new Fo(this,e.expression,t)}evaluate(e,t,i,n,r,o){if("source"===e.kind){const s=e.evaluate(t,i,n,r,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,n),e.evaluate({zoom:Math.floor(t.zoom)},i,n),e.evaluate({zoom:Math.floor(t.zoom)+1},i,n),t):e.value}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t,other:i}:{from:i,to:t,other:e}}interpolate(e){return e}}class Vo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,n){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},i,n);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new Io(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Io(Math.floor(t.zoom),t)),e.expression.evaluate(new Io(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Go{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,n){return!!e.expression.evaluate(t,null,{},i,n)}interpolate(){return!1}}class qo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Io(0,{});for(const i in e){const n=e[i];n.specification.overridable&&this.overridableProperties.push(i);const r=this.defaultPropertyValues[i]=new Lo(n,void 0),o=this.defaultTransitionablePropertyValues[i]=new Do(n);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=r.possiblyEvaluate(t)}}}function Wo(e,t){return 256*(e=f(Math.floor(e),0,255))+f(Math.floor(t),0,255)}Ir(No,"DataDrivenProperty"),Ir(jo,"DataConstantProperty"),Ir(Uo,"CrossFadedDataDrivenProperty"),Ir(Vo,"CrossFadedProperty"),Ir(Go,"ColorRampProperty");const Ho={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zo{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ko(e,t=1){let i=0,n=0;return{members:e.map((e=>{const r=Ho[e.type].BYTES_PER_ELEMENT,o=i=Yo(i,Math.max(t,r)),s=e.components||1;return n=Math.max(n,r),i+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:Yo(i,Math.max(n,t)),alignment:t}}function Yo(e,t){return Math.ceil(e/t)*t}class Jo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=i,e}}Jo.prototype.bytesPerElement=4,Ir(Jo,"StructArrayLayout2i4");class Qo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=i,this.int16[r+2]=n,e}}Qo.prototype.bytesPerElement=6,Ir(Qo,"StructArrayLayout3i6");class es extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=r,e}}es.prototype.bytesPerElement=8,Ir(es,"StructArrayLayout4i8");class ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o,s)}emplace(e,t,i,n,r,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=r,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}ts.prototype.bytesPerElement=12,Ir(ts,"StructArrayLayout2i4ub1f12");class is extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=r,e}}is.prototype.bytesPerElement=16,Ir(is,"StructArrayLayout4f16");class ns extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,i,n,r,o,s,a,l,c)}emplace(e,t,i,n,r,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}ns.prototype.bytesPerElement=20,Ir(ns,"StructArrayLayout10ui20");class rs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,i,n,r,o,s,a)}emplace(e,t,i,n,r,o,s,a,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=i,this.uint16[c+2]=n,this.uint16[c+3]=r,this.uint16[c+4]=o,this.uint16[c+5]=s,this.uint16[c+6]=a,this.uint16[c+7]=l,e}}rs.prototype.bytesPerElement=16,Ir(rs,"StructArrayLayout8ui16");class os extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}os.prototype.bytesPerElement=12,Ir(os,"StructArrayLayout6i12");class ss extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,n,r,o,s,a,l,c,u,h)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ss.prototype.bytesPerElement=24,Ir(ss,"StructArrayLayout4i4ui4i24");class as extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,n,r,o)}emplace(e,t,i,n,r,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[l+2]=r,this.float32[l+3]=o,this.float32[l+4]=s,e}}as.prototype.bytesPerElement=20,Ir(as,"StructArrayLayout3i3f20");class ls extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ls.prototype.bytesPerElement=4,Ir(ls,"StructArrayLayout1ul4");class cs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,n,r,o,s,a,l,c,u,h,d)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=n,this.int16[f+3]=r,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}cs.prototype.bytesPerElement=40,Ir(cs,"StructArrayLayout5i4f1i1ul2ui40");class us extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o,s)}emplace(e,t,i,n,r,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=n,this.int16[l+4]=r,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}us.prototype.bytesPerElement=16,Ir(us,"StructArrayLayout3i2i2i16");class hs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.int16[a+6]=r,this.int16[a+7]=o,e}}hs.prototype.bytesPerElement=16,Ir(hs,"StructArrayLayout2f1f2i16");class ds extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=i,this.float32[s+1]=n,this.float32[s+2]=r,e}}ds.prototype.bytesPerElement=12,Ir(ds,"StructArrayLayout2ub2f12");class ps extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=i,this.float32[r+2]=n,e}}ps.prototype.bytesPerElement=12,Ir(ps,"StructArrayLayout3f12");class fs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i)}emplace(e,t,i,n){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,this.uint16[r+2]=n,e}}fs.prototype.bytesPerElement=6,Ir(fs,"StructArrayLayout3ui6");class ms extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b){const w=30*e,T=15*e,k=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=n,this.float32[T+2]=r,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[k+48]=g,this.uint8[k+49]=y,this.uint8[k+50]=_,this.uint32[T+13]=v,this.int16[w+28]=x,this.uint8[k+58]=b,e}}ms.prototype.bytesPerElement=60,Ir(ms,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class gs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,k,S,C,E,M,A){const z=this.length;return this.resize(z+1),this.emplace(z,e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,k,S,C,E,M,A)}emplace(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,k,S,C,E,M,A,z){const I=38*e,L=19*e;return this.int16[I+0]=t,this.int16[I+1]=i,this.int16[I+2]=n,this.float32[L+2]=r,this.float32[L+3]=o,this.int16[I+8]=s,this.int16[I+9]=a,this.int16[I+10]=l,this.int16[I+11]=c,this.int16[I+12]=u,this.int16[I+13]=h,this.uint16[I+14]=d,this.uint16[I+15]=p,this.uint16[I+16]=f,this.uint16[I+17]=m,this.uint16[I+18]=g,this.uint16[I+19]=y,this.uint16[I+20]=_,this.uint16[I+21]=v,this.uint16[I+22]=x,this.uint16[I+23]=b,this.uint16[I+24]=w,this.uint16[I+25]=T,this.uint16[I+26]=k,this.uint16[I+27]=S,this.uint16[I+28]=C,this.uint32[L+15]=E,this.float32[L+16]=M,this.float32[L+17]=A,this.float32[L+18]=z,e}}gs.prototype.bytesPerElement=76,Ir(gs,"StructArrayLayout3i2f6i15ui1ul3f76");class ys extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ys.prototype.bytesPerElement=4,Ir(ys,"StructArrayLayout1f4");class _s extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,n,r,o,s)}emplace(e,t,i,n,r,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=n,this.float32[l+3]=r,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}_s.prototype.bytesPerElement=28,Ir(_s,"StructArrayLayout7f28");class vs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,n,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,n,r)}emplace(e,t,i,n,r,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=n,this.float32[s+3]=r,this.float32[s+4]=o,e}}vs.prototype.bytesPerElement=20,Ir(vs,"StructArrayLayout5f20");class xs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,n){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i,n)}emplace(e,t,i,n,r){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=i,this.uint16[o+3]=n,this.uint16[o+4]=r,e}}xs.prototype.bytesPerElement=12,Ir(xs,"StructArrayLayout1ul3ui12");class bs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,e}}bs.prototype.bytesPerElement=4,Ir(bs,"StructArrayLayout2ui4");class ws extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ws.prototype.bytesPerElement=2,Ir(ws,"StructArrayLayout1ui2");class Ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=i,e}}Ts.prototype.bytesPerElement=8,Ir(Ts,"StructArrayLayout2f8");class ks extends Zo{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ks.prototype.size=12;class Ss extends os{get(e){return new ks(this,e)}}Ir(Ss,"FillExtrusionExtArray");class Cs extends Zo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cs.prototype.size=40;class Es extends cs{get(e){return new Cs(this,e)}}Ir(Es,"CollisionBoxArray");class Ms extends Zo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ms.prototype.size=60;class As extends ms{get(e){return new Ms(this,e)}}Ir(As,"PlacedSymbolArray");class zs extends Zo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}zs.prototype.size=76;class Is extends gs{get(e){return new zs(this,e)}}Ir(Is,"SymbolInstanceArray");class Ls extends ys{getoffsetX(e){return this.float32[1*e+0]}}Ir(Ls,"GlyphOffsetArray");class Ds extends Qo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ir(Ds,"SymbolLineVertexArray");class Ps extends Zo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ps.prototype.size=12;class Os extends xs{get(e){return new Ps(this,e)}}Ir(Os,"FeatureIndexArray");class Rs extends Zo{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Rs.prototype.size=4;class Bs extends bs{get(e){return new Rs(this,e)}}Ir(Bs,"FillExtrusionCentroidArray");class Fs extends Zo{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Fs.prototype.size=12;class $s extends os{get(e){return new Fs(this,e)}}Ir($s,"CircleGlobeExtArray");const js=Ko([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ns=Ko([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Us=ft((function(e){e.exports=function(e,t){var i,n,r,o,s,a,l,c;for(n=e.length-(i=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}})),Vs=ft((function(e){e.exports=function(e,t){for(var i,n=e.length,r=t^n,o=0;n>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}})),Gs=Us,qs=Vs;Gs.murmur3=Us,Gs.murmur2=qs;class Ws{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,n){this.ids.push(Hs(e)),this.positions.push(t,i,n)}getPositions(e){const t=Hs(e);let i=0,n=this.ids.length-1;for(;i<n;){const e=i+n>>1;this.ids[e]>=t?n=e:i=e+1}const r=[];for(;this.ids[i]===t;)r.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return r}static serialize(e,t){const i=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Zs(i,n,0,i.length-1),t&&t.push(i.buffer,n.buffer),{ids:i,positions:n}}static deserialize(e){const t=new Ws;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Hs(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Gs(String(e))}function Zs(e,t,i,n){for(;i<n;){const r=e[i+n>>1];let o=i-1,s=n+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;Xs(e,o,s),Xs(t,3*o,3*s),Xs(t,3*o+1,3*s+1),Xs(t,3*o+2,3*s+2)}s-i<n-s?(Zs(e,t,i,s),i=s+1):(Zs(e,t,s+1,n),n=s)}}function Xs(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}Ir(Ws,"FeaturePositionMap");class Ks{constructor(e,t){this.gl=e.gl,this.location=t}}class Ys extends Ks{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Js extends Ks{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qs extends Ks{constructor(e,t){super(e,t),this.current=yt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ea=new Float32Array(16),ta=new Float32Array(9),ia=new Float32Array(4);function na(e){return[Wo(255*e.r,255*e.g),Wo(255*e.b,255*e.a)]}class ra{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i){e.set(i.constantOr(this.value))}getBinding(e,t,i){return"color"===this.type?new Qs(e,t):new Ys(e,t)}}class oa{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,i,n){const r="u_pattern_to"===n||"u_dash_to"===n?this.patternTo:"u_pattern_from"===n||"u_dash_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;r&&e.set(r)}getBinding(e,t,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new Js(e,t):new Ys(e,t)}}class sa{constructor(e,t,i,n){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(e,t,i,n,r,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new Io(0),t,{},r,n,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,a)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:0},i,n,void 0,r);this._setPaintValue(e,t,o)}_setPaintValue(e,t,i){if("color"===this.type){const n=na(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(e,t,i,n,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=n,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,n,r,o){const s=this.expression.evaluate(new Io(this.zoom),t,{},r,n,o),a=this.expression.evaluate(new Io(this.zoom+1),t,{},r,n,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,s,a)}updatePaintArray(e,t,i,n,r){const o=this.expression.evaluate({zoom:this.zoom},i,n,void 0,r),s=this.expression.evaluate({zoom:this.zoom+1},i,n,void 0,r);this._setPaintValue(e,t,o,s)}_setPaintValue(e,t,i,n){if("color"===this.type){const r=na(i),o=na(n);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,n=f(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(n)}getBinding(e,t,i){return new Ys(e,t)}}class la{constructor(e,t,i,n,r,o,s){this.expression=e,this.type=i,this.useIntegerZoom=n,this.zoom=r,this.layerId=s,this.paintVertexAttributes=("array"===i?Ns:js).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(e,t,i){const n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,n,r,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(e,t,i,n){if(!n||!i)return;const{min:r,mid:o,max:s}=i,a=n[r],l=n[o],c=n[s];if(a&&l&&c)for(let i=e;i<t;i++)this._setPaintValue(this.zoomInPaintVertexArray,i,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,i,l,c)}_setPaintValue(e,t,i,n){e.emplace(t,i.tl[0],i.tl[1],i.br[0],i.br[1],n.tl[0],n.tl[1],n.br[0],n.br[1],i.pixelRatio,n.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ca{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const n=[];for(const r in e.paint._values){if(!i(r))continue;const o=e.paint.get(r);if(!(o instanceof Fo&&bn(o.property.specification)))continue;const s=da(r,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(r)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const i=ma(r,l,"source");this.binders[r]=h?new la(a,s,l,c,t,i,e.id):new sa(a,s,l,i),n.push(`/a_${r}`)}else{const e=ma(r,l,"composite");this.binders[r]=new aa(a,s,l,c,t,e),n.push(`/z_${r}`)}else this.binders[r]=h?new oa(a.value,s):new ra(a.value,s,l),n.push(`/u_${r}`)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof sa||t instanceof aa?t.maxValue:0}populatePaintArrays(e,t,i,n,r,o){for(const s in this.binders){const a=this.binders[s];(a instanceof sa||a instanceof aa||a instanceof la)&&a.populatePaintArray(e,t,i,n,r,o)}}setConstantPatternPositions(e,t){for(const i in this.binders){const n=this.binders[i];n instanceof oa&&n.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,i,n,r,o){let s=!1;for(const a in e){const l=t.getPositions(a);for(const t of l){const l=i.feature(t.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof sa||c instanceof aa||c instanceof la)&&!0===c.expression.isStateDependent){const u=n.paint.get(i);c.expression=u.value,c.updatePaintArray(t.start,t.end,l,e[a],r,o),s=!0}}}}return s}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof ra||i instanceof oa)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof sa||i instanceof aa||i instanceof la)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof ra||i instanceof oa||i instanceof aa)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof ra||r instanceof oa||r instanceof aa)for(const o of r.uniformNames)if(t[o]){const s=r.getBinding(e,t[o],o);i.push({name:o,property:n,binding:s})}}return i}setUniforms(e,t,i,n){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,n,i.get(r),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const i=this.binders[t];if(e&&i instanceof la){const t=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(i instanceof sa||i instanceof aa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof sa||i instanceof aa||i instanceof la)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof sa||t instanceof aa||t instanceof la)&&t.destroy()}}}class ua{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new ca(n,t,i);this.needsUpload=!1,this._featureMap=new Ws,this._bufferOffset=0}populatePaintArrays(e,t,i,n,r,o,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,n,r,o,s);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,n,r){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ha={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function da(e,t){return ha[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const pa={"line-pattern":{source:ns,composite:ns},"fill-pattern":{source:ns,composite:ns},"fill-extrusion-pattern":{source:ns,composite:ns},"line-dasharray":{source:rs,composite:rs}},fa={color:{source:Ts,composite:is},number:{source:ys,composite:Ts}};function ma(e,t,i){const n=pa[e];return n&&n[i]||fa[t][i]}Ir(ra,"ConstantBinder"),Ir(oa,"CrossFadedConstantBinder"),Ir(sa,"SourceExpressionBinder"),Ir(la,"CrossFadedCompositeBinder"),Ir(aa,"CompositeExpressionBinder"),Ir(ca,"ProgramConfiguration",{omit:["_buffers"]}),Ir(ua,"ProgramConfigurationSet");const ga="-transition";class ya extends Ve{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Bo(t.layout)),t.paint)){this._transitionablePaint=new Po(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $o(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Sr,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return C(e,ga)?this._transitionablePaint.getTransition(e.slice(0,-ga.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(kr,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(C(e,ga))return this._transitionablePaint.setTransition(e.slice(0,-ga.length),t||void 0),!1;{const i=this._transitionablePaint._values[e],n="cross-faded-data-driven"===i.property.specification["property-type"],r=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||r||n||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),M(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,n,r={}){return(!r||!1!==r.validate)&&Er(this,e.call(Tr,{key:t,layerType:this.type,objectKey:i,value:n,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Fo&&bn(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Kn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _a=Ko([{name:"a_pos",components:2,type:"Int16"}],4),va=Ko([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xa{constructor(e=[]){this.segments=e}prepareSegment(e,t,i,n){let r=this.segments[this.segments.length-1];return e>xa.MAX_VERTEX_ARRAY_LENGTH&&I(`Max vertices per segment is ${xa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>xa.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==n)&&(r={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==n&&(r.sortKey=n),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,n){return new xa([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}xa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ir(xa,"SegmentVector");var ba=8192;class wa{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ka?new ka(e.lng,e.lat):ka.convert(e),this}setSouthWest(e){return this._sw=e instanceof ka?new ka(e.lng,e.lat):ka.convert(e),this}extend(e){const t=this._sw,i=this._ne;let n,r;if(e instanceof ka)n=e,r=e;else{if(!(e instanceof wa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(wa.convert(e)):this.extend(ka.convert(e)):this;if(n=e._sw,r=e._ne,!n||!r)return this}return t||i?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new ka(n.lng,n.lat),this._ne=new ka(r.lng,r.lat)),this}getCenter(){return new ka((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ka(this.getWest(),this.getNorth())}getSouthEast(){return new ka(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=ka.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(e){return!e||e instanceof wa?e:new wa(e)}}const Ta=6371008.8;class ka{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ka(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,n=e.lat*t,r=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Ta*Math.acos(Math.min(r,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new wa(new ka(this.lng-i,this.lat-t),new ka(this.lng+i,this.lat+t))}static convert(e){if(e instanceof ka)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ka(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ka(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Sa=2*Math.PI*Ta;function Ca(e){return Sa*Math.cos(e*Math.PI/180)}function Ea(e){return(180+e)/360}function Ma(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Aa(e,t){return e/Ca(t)}function za(e){return 360*e-180}function Ia(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function La(e,t){return e*Ca(Ia(t))}const Da=85.051129;class Pa{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=ka.convert(e);return new Pa(Ea(i.lng),Ma(i.lat),Aa(t,i.lat))}toLngLat(){return new ka(za(this.x),Ia(this.y))}toAltitude(){return La(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Sa*(e=Ia(this.y),1/Math.cos(e*Math.PI/180));var e}}function Oa(e,t,i,n,o,s,a,l,c){const u=(t+n)/2,h=(i+o)/2,d=new r(u,h);l(d),function(e,t,i,n,r,o){const s=i-r,a=n-o;return Math.abs((n-t)*s-(i-e)*a)/Math.hypot(s,a)}(d.x,d.y,s.x,s.y,a.x,a.y)>=c?(Oa(e,t,i,u,h,s,d,l,c),Oa(e,u,h,n,o,d,a,l,c)):e.push(a)}function Ra(e,t,i){let n=e[0],r=n.x,o=n.y;t(n);const s=[n];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),Oa(s,r,o,c,u,n,l,t,i),r=c,o=u,n=l}return s}function Ba(e,t,i,n,r){if(r(t,i)){const o=t.add(i).mult(.5);n(o),Ba(e,t,o,n,r),Ba(e,o,i,n,r)}else e.push(i)}function Fa(e,t,i){let n=e[0];t(n);const r=[n];for(let o=1;o<e.length;o++){const s=e[o];t(s),Ba(r,n,s,t,i),n=s}return r}const $a=Math.pow(2,14)-1,ja=-$a-1;function Na(e,t){const i=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=f(i,ja,$a),e.y=f(n,ja,$a),(i<e.x||i>e.x+1||n<e.y||n>e.y+1)&&I("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ua(e,t,i){const n=e.loadGeometry(),r=e.extent,o=ba/r;if(t&&i&&i.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=i,u=e=>{const i=za((t.x+e.x/r)/o),n=Ia((t.y+e.y/r)/o),u=c.project(i,n);e.x=(u.x*s-a)*r,e.y=(u.y*s-l)*r};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=Ra(n[t],u,1);else{const e=[];for(const i of n[t])i.x<0||i.x>=r||i.y<0||i.y>=r||(u(i),e.push(i));n[t]=e}}for(const e of n)for(const t of e)Na(t,o);return n}function Va(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ua(e):[]}}function Ga(e,t,i,n,r){e.emplaceBack(2*t+(n+1)/2,2*i+(r+1)/2)}function qa(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class Wa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Jo,this.indexArray=new fs,this.segments=new xa,this.programConfigurations=new ua(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){const r=this.layers[0],o=[];let s=null;"circle"===r.type&&(s=r.layout.get("circle-sort-key"));for(const{feature:t,id:r,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Va(t,e);if(!this.layers[0]._featureFilter.filter(new Io(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ua(t,i,n),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new $s,a=n.projection);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n,l=e[o].feature;this.addFeature(n,r,o,t.availableImages,i,a),t.featureIndex.insert(l,r,o,s,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_a.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,va.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,n,r,o){for(const i of t)for(const t of i){const i=t.x,n=t.y;if(i<0||i>=ba||n<0||n>=ba)continue;if(o){const e=o.projectTilePoint(i,n,r),t=o.upVector(r,i,n),s=this.globeExtVertexArray;qa(s,e,t),qa(s,e,t),qa(s,e,t),qa(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;Ga(this.layoutVertexArray,i,n,-1,-1),Ga(this.layoutVertexArray,i,n,1,-1),Ga(this.layoutVertexArray,i,n,1,1),Ga(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},n,r)}}function Ha(e,t){for(let i=0;i<e.length;i++)if(il(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(il(e,t[i]))return!0;return!!Ya(e,t)}function Za(e,t,i){return!!il(e,t)||!!Qa(t,e,i)}function Xa(e,t){if(1===e.length)return tl(t,e[0]);for(let i=0;i<t.length;i++){const n=t[i];for(let t=0;t<n.length;t++)if(il(e,n[t]))return!0}for(let i=0;i<e.length;i++)if(tl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Ya(e,t[i]))return!0;return!1}function Ka(e,t,i){if(e.length>1){if(Ya(e,t))return!0;for(let n=0;n<t.length;n++)if(Qa(t[n],e,i))return!0}for(let n=0;n<e.length;n++)if(Qa(e[n],t,i))return!0;return!1}function Ya(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)if(Ja(n,r,t[e],t[e+1]))return!0}return!1}function Ja(e,t,i,n){return L(e,i,n)!==L(t,i,n)&&L(e,t,i)!==L(e,t,n)}function Qa(e,t,i){const n=i*i;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(el(e,t[i-1],t[i])<n)return!0;return!1}function el(e,t,i){const n=t.distSqr(i);if(0===n)return e.distSqr(t);const r=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;return e.distSqr(r<0?t:r>1?i:i.sub(t)._mult(r)._add(t))}function tl(e,t){let i,n,r,o=!1;for(let s=0;s<e.length;s++){i=e[s];for(let e=0,s=i.length-1;e<i.length;s=e++)n=i[e],r=i[s],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(o=!o)}return o}function il(e,t){let i=!1;for(let n=0,r=e.length-1;n<e.length;r=n++){const o=e[n],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function nl(e,t,i,n,o){for(const r of e)if(t<=r.x&&i<=r.y&&n>=r.x&&o>=r.y)return!0;const s=[new r(t,i),new r(t,o),new r(n,o),new r(n,i)];if(e.length>2)for(const t of s)if(il(e,t))return!0;for(let t=0;t<e.length-1;t++)if(rl(e[t],e[t+1],s))return!0;return!1}function rl(e,t,i){const n=i[0],r=i[2];if(e.x<n.x&&t.x<n.x||e.x>r.x&&t.x>r.x||e.y<n.y&&t.y<n.y||e.y>r.y&&t.y>r.y)return!1;const o=L(e,t,i[0]);return o!==L(e,t,i[1])||o!==L(e,t,i[2])||o!==L(e,t,i[3])}function ol(e,t,i){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:i.programConfigurations.get(t.id).getMaxValue(e)}function sl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function al(e,t,i,n,o){if(!t[0]&&!t[1])return e;const s=r.convert(t)._mult(o);"viewport"===i&&s._rotate(-n);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(s));return a}function ll(e,t,i,n){const o=r.convert(e)._mult(n);return"viewport"===t&&o._rotate(-i),o}Ir(Wa,"CircleBucket",{omit:["layers"]});const cl=new qo({"circle-sort-key":new No(Ge.layout_circle["circle-sort-key"])});var ul={paint:new qo({"circle-radius":new No(Ge.paint_circle["circle-radius"]),"circle-color":new No(Ge.paint_circle["circle-color"]),"circle-blur":new No(Ge.paint_circle["circle-blur"]),"circle-opacity":new No(Ge.paint_circle["circle-opacity"]),"circle-translate":new jo(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new jo(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jo(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jo(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new No(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new No(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new No(Ge.paint_circle["circle-stroke-opacity"])}),layout:cl},hl=1e-6,dl="undefined"!=typeof Float32Array?Float32Array:Array;function pl(){var e=new dl(9);return dl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function fl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ml(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*n+x*a+b*h+w*m,e[1]=v*r+x*l+b*d+w*g,e[2]=v*o+x*c+b*p+w*y,e[3]=v*s+x*u+b*f+w*_,e[4]=(v=i[4])*n+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,e[5]=v*r+x*l+b*d+w*g,e[6]=v*o+x*c+b*p+w*y,e[7]=v*s+x*u+b*f+w*_,e[8]=(v=i[8])*n+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,e[9]=v*r+x*l+b*d+w*g,e[10]=v*o+x*c+b*p+w*y,e[11]=v*s+x*u+b*f+w*_,e[12]=(v=i[12])*n+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,e[13]=v*r+x*l+b*d+w*g,e[14]=v*o+x*c+b*p+w*y,e[15]=v*s+x*u+b*f+w*_,e}function gl(e,t,i){var n,r,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],y=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=n=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=n*m+a*g+h*y+t[12],e[13]=r*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e}function yl(e,t,i){var n=i[0],r=i[1],o=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _l(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*n,e[5]=s*r+u*n,e[6]=a*r+h*n,e[7]=l*r+d*n,e[8]=c*r-o*n,e[9]=u*r-s*n,e[10]=h*r-a*n,e[11]=d*r-l*n,e}function vl(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*n,e[1]=s*r-u*n,e[2]=a*r-h*n,e[3]=l*r-d*n,e[8]=o*n+c*r,e[9]=s*n+u*r,e[10]=a*n+h*r,e[11]=l*n+d*r,e}function xl(e,t,i){var n,r,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<hl?null:(s*=c=1/c,a*=c,l*=c,n=Math.sin(t),r=Math.cos(t),e[0]=s*s*(o=1-r)+r,e[1]=a*s*o+l*n,e[2]=l*s*o-a*n,e[3]=0,e[4]=s*a*o-l*n,e[5]=a*a*o+r,e[6]=l*a*o+s*n,e[7]=0,e[8]=s*l*o+a*n,e[9]=a*l*o-s*n,e[10]=l*l*o+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var bl=ml;function wl(){var e=new dl(3);return dl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Tl(e){var t=new dl(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function kl(e){return Math.hypot(e[0],e[1],e[2])}function Sl(e,t,i){var n=new dl(3);return n[0]=e,n[1]=t,n[2]=i,n}function Cl(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function El(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Ml(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Al(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function zl(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function Il(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Ll(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e[2]=t[2]+i[2]*n,e}function Dl(e,t){var i=t[0],n=t[1],r=t[2],o=i*i+n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Pl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ol(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=r*l-o*a,e[1]=o*s-n*l,e[2]=n*a-r*s,e}function Rl(e,t,i){var n=t[0],r=t[1],o=t[2],s=i[3]*n+i[7]*r+i[11]*o+i[15];return e[0]=(i[0]*n+i[4]*r+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*n+i[5]*r+i[9]*o+i[13])/s,e[2]=(i[2]*n+i[6]*r+i[10]*o+i[14])/s,e}function Bl(e,t,i){var n=i[0],r=i[1],o=i[2],s=t[0],a=t[1],l=t[2],c=r*l-o*a,u=o*s-n*l,h=n*a-r*s,d=r*h-o*u,p=o*c-n*h,f=n*u-r*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e}var Fl,$l=El,jl=Ml,Nl=kl;function Ul(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Vl(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*o+i[12]*s,e[1]=i[1]*n+i[5]*r+i[9]*o+i[13]*s,e[2]=i[2]*n+i[6]*r+i[10]*o+i[14]*s,e[3]=i[3]*n+i[7]*r+i[11]*o+i[15]*s,e}function Gl(){var e=new dl(4);return dl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ql(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Wl(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+s*a,e[1]=r*l+o*a,e[2]=o*l-r*a,e[3]=s*l-n*a,e}function Hl(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l-o*a,e[1]=r*l+s*a,e[2]=o*l+n*a,e[3]=s*l-r*a,e}wl(),Fl=new dl(4),dl!=Float32Array&&(Fl[0]=0,Fl[1]=0,Fl[2]=0,Fl[3]=0),wl(),Sl(1,0,0),Sl(0,1,0),Gl(),Gl(),pl();class Zl{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const n=Pl(t,this.dir);if(Math.abs(n)<1e-6)return!1;const r=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return i[0]=this.pos[0]+this.dir[0]*r,i[1]=this.pos[1]+this.dir[1]*r,i[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,t,i){if(function(e,t){var i=e[0],n=e[1],r=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(i-o)<=hl*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=hl*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=hl*Math.max(1,Math.abs(r),Math.abs(a))}(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[n,r,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=n*n+r*r+o*o,u=2*(s*n+a*r+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+n*e,h=a+r*e,d=l+o*e,p=Math.hypot(c,h,d);return i[0]=c*t/p,i[1]=h*t/p,i[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return i[0]=s*t/e,i[1]=a*t/e,i[2]=l*t/e,!1}return i[0]=s+n*e,i[1]=a+r*e,i[2]=l+o*e,!0}}}class Xl{constructor(e,t,i,n,r){this.TL=e,this.TR=t,this.BR=i,this.BL=n,this.horizon=r}static fromInvProjectionMatrix(e,t,i){const n=[-1,1,1],r=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Rl(n,n,e),l=Rl(r,r,e),c=Rl(o,o,e),u=Rl(s,s,e);return new Xl(a,l,c,u,t/i)}}class Kl{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,i,n){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=Vl([],i,e),s=1/o[3]/t*r;return function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}(o,o,[s,s,n?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Dl([],Ol([],$l([],o[e[0]],o[e[1]]),$l([],o[e[2]],o[e[1]]))),i=-Pl(t,o[e[1]]);return t.concat(i)}));return new Kl(o,s)}}class Yl{constructor(e,t){this.min=e,this.max=t,this.center=Il([],Cl([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=Tl(this.min),n=Tl(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],n[e]=t[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new Yl(i,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let i=!0;for(let n=0;n<e.planes.length;n++){const r=e.planes[n];let o=0;for(let e=0;e<t.length;e++)o+=Pl(r,t[e])+r[3]>=0;if(0===o)return 0;o!==t.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const o=e.points[r][t]-this.min[t];i=Math.min(i,o),n=Math.max(n,o)}if(n<0||i>this.max[t]-this.min[t])return 0}return 1}}function Jl(e,t,i,n,r,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=r&&i.elevation?i.elevation.exaggeration()*r.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=i.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Ql(p.x,p.y,p.z,n),m=o?e.tilespaceRays.map((e=>ic(e,d))):e.queryGeometry.screenGeometry,g=Vl([],[p.x,p.y,p.z,1],n);if(!s&&o?l*=g[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const e=Ia((t.y/ba+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(e,1)/Aa(1,e)}if(Za(m,f,l))return!0}return!1}function Ql(e,t,i,n){const o=Vl([],[e,t,i,1],n);return new r(o[0]/o[3],o[1]/o[3])}const ec=Sl(0,0,0),tc=Sl(0,0,1);function ic(e,t){const i=wl();return ec[2]=t,e.intersectsPlane(ec,tc,i),new r(i[0],i[1])}class nc extends Wa{}function rc(e,{width:t,height:i},n,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*i*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(t*i*n);return e.width=t,e.height=i,e.data=r,e}function oc(e,t,i){const{width:n,height:r}=t;n===e.width&&r===e.height||(sc(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,r)},i),e.width=n,e.height=r,e.data=t.data)}function sc(e,t,i,n,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<r.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((n.y+l)*t.width+n.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}Ir(nc,"HeatmapBucket",{omit:["layers"]});class ac{constructor(e,t){rc(this,e,1,t)}resize(e){oc(this,new ac(e),1)}clone(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){sc(e,t,i,n,r,1)}}class lc{constructor(e,t){rc(this,e,4,t)}resize(e){oc(this,new lc(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,n,r){sc(e,t,i,n,r,4)}}Ir(ac,"AlphaImage"),Ir(lc,"RGBAImage");var cc={paint:new qo({"heatmap-radius":new No(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new No(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jo(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Go(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jo(Ge.paint_heatmap["heatmap-opacity"])})};function uc(e){const t={},i=e.resolution||256,n=e.clips?e.clips.length:1,r=e.image||new lc({width:i,height:n}),o=(i,n,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);r.data[i+n+0]=Math.floor(255*s.r/s.a),r.data[i+n+1]=Math.floor(255*s.g/s.a),r.data[i+n+2]=Math.floor(255*s.b/s.a),r.data[i+n+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,r=0;t<n;++t,r+=4*i)for(let n=0,s=0;n<i;n++,s+=4){const a=n/(i-1),{start:l,end:c}=e.clips[t];o(r,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return r}var hc={paint:new qo({"hillshade-illumination-direction":new jo(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jo(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jo(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jo(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jo(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jo(Ge.paint_hillshade["hillshade-accent-color"])})};const dc=Ko([{name:"a_pos",components:2,type:"Int16"}],4),{members:pc}=dc;var fc=gc,mc=gc;function gc(e,t,i){i=i||2;var n,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=yc(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,n){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=yc(e,t[r]*n,r<o-1?t[r+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),a.push(Mc(s));for(a.sort(kc),r=0;r<a.length;r++)i=_c(i=Sc(a[r],i),i.next);return i}(e,t,d,i)),e.length>80*i){n=o=e[0],r=s=e[1];for(var f=i;f<h;f+=i)(a=e[f])<n&&(n=a),(l=e[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-n,s-r))?1/c:0}return vc(d,p,i,n,r,c),p}function yc(e,t,i,n,r){var o,s;if(r===Nc(e,t,i,n)>0)for(o=t;o<i;o+=n)s=Fc(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=Fc(o,e[o],e[o+1],s);return s&&Lc(s,s.next)&&($c(s),s=s.next),s}function _c(e,t){if(!e)return e;t||(t=e);var i,n=e;do{if(i=!1,n.steiner||!Lc(n,n.next)&&0!==Ic(n.prev,n,n.next))n=n.next;else{if($c(n),(n=t=n.prev)===n.next)break;i=!0}}while(i||n!==t);return t}function vc(e,t,i,n,r,o,s){if(e){!s&&o&&function(e,t,i,n){var r=e;do{null===r.z&&(r.z=Ec(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,n,r,o,s,a,l,c=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,c*=2}while(s>1)}(r)}(e,n,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?bc(e,n,r,o):xc(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),$c(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?vc(e=wc(_c(e),t,i),t,i,n,r,o,2):2===s&&Tc(e,t,i,n,r,o):vc(_c(e),t,i,n,r,o,1);break}}}function xc(e){var t=e.prev,i=e,n=e.next;if(Ic(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(Ac(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Ic(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function bc(e,t,i,n){var r=e.prev,o=e,s=e.next;if(Ic(r,o,s)>=0)return!1;for(var a=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,l=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,c=Ec(r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,t,i,n),u=Ec(a,l,t,i,n),h=e.prevZ,d=e.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==e.prev&&h!==e.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Ic(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Ic(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Ic(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==e.prev&&d!==e.next&&Ac(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Ic(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function wc(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!Lc(r,o)&&Dc(r,n,n.next,o)&&Rc(r,o)&&Rc(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),$c(n),$c(n.next),n=e=o),n=n.next}while(n!==e);return _c(n)}function Tc(e,t,i,n,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&zc(s,a)){var l=Bc(s,a);return s=_c(s,s.next),l=_c(l,l.next),vc(s,t,i,n,r,o),void vc(l,t,i,n,r,o)}a=a.next}s=s.next}while(s!==e)}function kc(e,t){return e.x-t.x}function Sc(e,t){var i=function(e,t){var i,n=t,r=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s){if(s=a,a===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===s)return i;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{r>=n.x&&n.x>=u&&r!==n.x&&Ac(o<h?r:s,o,u,h,o<h?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Rc(n,e)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&Cc(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(e,t);if(!i)return t;var n=Bc(i,e),r=_c(i,i.next);return _c(n,n.next),t===i?r:t}function Cc(e,t){return Ic(e.prev,e,t.prev)<0&&Ic(t.next,e,e.next)<0}function Ec(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Mc(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Ac(e,t,i,n,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function zc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Dc(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Rc(e,t)&&Rc(t,e)&&function(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Ic(e.prev,e,t.prev)||Ic(e,t.prev,t))||Lc(e,t)&&Ic(e.prev,e,e.next)>0&&Ic(t.prev,t,t.next)>0)}function Ic(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Lc(e,t){return e.x===t.x&&e.y===t.y}function Dc(e,t,i,n){var r=Oc(Ic(e,t,i)),o=Oc(Ic(e,t,n)),s=Oc(Ic(i,n,e)),a=Oc(Ic(i,n,t));return r!==o&&s!==a||!(0!==r||!Pc(e,i,t))||!(0!==o||!Pc(e,n,t))||!(0!==s||!Pc(i,e,n))||!(0!==a||!Pc(i,t,n))}function Pc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Oc(e){return e>0?1:e<0?-1:0}function Rc(e,t){return Ic(e.prev,e,e.next)<0?Ic(e,t,e.next)>=0&&Ic(e,e.prev,t)>=0:Ic(e,t,e.prev)<0||Ic(e,e.next,t)<0}function Bc(e,t){var i=new jc(e.i,e.x,e.y),n=new jc(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function Fc(e,t,i,n){var r=new jc(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function $c(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jc(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nc(e,t,i,n){for(var r=0,o=t,s=i-n;o<i;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}function Uc(e,t,i,n,r){Vc(e,t,i||0,n||e.length-1,r||qc)}function Vc(e,t,i,n,r){for(;n>i;){if(n-i>600){var o=n-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Vc(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(n,Math.floor(t+(o-s)*l/o+c)),r)}var u=e[t],h=i,d=n;for(Gc(e,i,t),r(e[n],u)>0&&Gc(e,i,n);h<d;){for(Gc(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[i],u)?Gc(e,i,d):Gc(e,++d,n),d<=t&&(i=d+1),t<=d&&(n=d-1)}}function Gc(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function qc(e,t){return e<t?-1:e>t?1:0}function Wc(e,t){const i=e.length;if(i<=1)return[e];const n=[];let r,o;for(let t=0;t<i;t++){const i=D(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(r&&n.push(r),r=[e[t]]):r.push(e[t]))}if(r&&n.push(r),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(Uc(n[e],t,1,n[e].length-1,Hc),n[e]=n[e].slice(0,t));return n}function Hc(e,t){return t.area-e.area}function Zc(e,t,i){const n=i.patternDependencies;let r=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,n[o.to]=!0,n[o.from]=!0)}return r}function Xc(e,t,i,n,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n-1},i,{},r.availableImages),a=t.evaluate({zoom:n},i,{},r.availableImages),l=t.evaluate({zoom:n+1},i,{},r.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:e,mid:a,max:l}}}return i}gc.deviation=function(e,t,i,n){var r=t&&t.length,o=Math.abs(Nc(e,0,r?t[0]*i:e.length,i));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Nc(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var l=0;for(s=0;s<n.length;s+=3){var c=n[s]*i,u=n[s+1]*i,h=n[s+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},gc.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[r][o][s]);r>0&&i.holes.push(n+=e[r-1].length)}return i},fc.default=mc;class Kc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jo,this.indexArray=new fs,this.indexArray2=new bs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.segments2=new xa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,n){this.hasPattern=Zc("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Va(s,e);if(!this.layers[0]._featureFilter.filter(new Io(this.zoom),u,i))continue;const h=r?r.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ua(s,i,n),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const n of o){const{geometry:r,index:o,sourceLayerIndex:s}=n;if(this.hasPattern){const e=Xc("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,{},t.availableImages);t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,n,r,o=[]){for(const e of Wc(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=i.vertexLength,r=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(r.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(n+t.length-1,n),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(n+e-1,n+e),r.push(t[e].x),r.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const s=fc(r,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(n+s[e],n+s[e+1],n+s[e+2]);i.vertexLength+=t,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}}Ir(Kc,"FillBucket",{omit:["layers","patternFeatures"]});const Yc=new qo({"fill-sort-key":new No(Ge.layout_fill["fill-sort-key"])});var Jc={paint:new qo({"fill-antialias":new jo(Ge.paint_fill["fill-antialias"]),"fill-opacity":new No(Ge.paint_fill["fill-opacity"]),"fill-color":new No(Ge.paint_fill["fill-color"]),"fill-outline-color":new No(Ge.paint_fill["fill-outline-color"]),"fill-translate":new jo(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new jo(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uo(Ge.paint_fill["fill-pattern"])}),layout:Yc};const Qc=Ko([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),eu=Ko([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tu=Ko([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iu}=Qc;var nu=ru;function ru(e,t,i,n,r){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=r,e.readFields(ou,this,t)}function ou(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var n=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[n]=r}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function su(e){for(var t,i,n=0,r=0,o=e.length,s=o-1;r<o;s=r++)n+=((i=e[s]).x-(t=e[r]).x)*(t.y+i.y);return n}ru.types=["Unknown","Point","LineString","Polygon"],ru.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,n=1,o=0,s=0,a=0,l=[];e.pos<i;){if(o<=0){var c=e.readVarint();n=7&c,o=c>>3}if(o--,1===n||2===n)s+=e.readSVarint(),a+=e.readSVarint(),1===n&&(t&&l.push(t),t=[]),t.push(new r(s,a));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&l.push(t),l},ru.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,n=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(n<=0){var u=e.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},ru.prototype.toGeoJSON=function(e,t,i){var n,r,o=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=ru.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];u(l=h);break;case 2:for(n=0;n<l.length;n++)u(l[n]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,r=[],o=0;o<t;o++){var s=su(e[o]);0!==s&&(void 0===n&&(n=s<0),n===s<0?(i&&r.push(i),i=[e[o]]):i.push(e[o]))}return i&&r.push(i),r}(l),n=0;n<l.length;n++)for(r=0;r<l[n].length;r++)u(l[n][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var au=lu;function lu(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cu,this,t),this.length=this._features.length}function cu(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(i))}function uu(e,t,i){if(3===e){var n=new au(i,i.readVarint()+i.pos);n.length&&(t[n.name]=n)}}lu.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new nu(this._pbf,t,this.extent,this._keys,this._values)};var hu={VectorTile:function(e,t){this.layers=e.readFields(uu,{},t)},VectorTileFeature:nu,VectorTileLayer:au};function du(e,t,i,n){const o=[],s=0===n?(e,t,i,n,o,s)=>{e.push(new r(s,i+(s-t)/(n-t)*(o-i)))}:(e,t,i,n,o,s)=>{e.push(new r(t+(s-i)/(o-i)*(n-t),s))};for(const r of e){const e=[];for(const o of r){if(o.length<=2)continue;const r=[];for(let e=0;e<o.length-1;e++){const a=o[e].x,l=o[e].y,c=o[e+1].x,u=o[e+1].y,h=0===n?a:l,d=0===n?c:u;h<t?d>t&&s(r,a,l,c,u,t):h>i?d<i&&s(r,a,l,c,u,i):r.push(o[e]),d<t&&h>=t&&s(r,a,l,c,u,t),d>i&&h<=i&&s(r,a,l,c,u,i)}let a=o[o.length-1];const l=0===n?a.x:a.y;l>=t&&l<=i&&r.push(a),r.length&&(a=r[r.length-1],r[0].x===a.x&&r[0].y===a.y||r.push(r[0]),e.push(r))}e.length&&o.push(e)}return o}const pu=hu.VectorTileFeature.types,fu=Math.pow(2,13);function mu(e,t,i,n,r,o,s,a){e.emplaceBack((t<<1)+s,(i<<1)+o,(Math.floor(n*fu)<<1)+r,Math.round(a))}function gu(e,t,i){const n=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*n,i[1]*n,i[2]*n)}class yu{constructor(){this.acc=new r(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(e.x,e.y),this.max=new r(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const i=this.min,n=this.max;e.x<i.x?i.x=e.x:e.x>n.x&&(n.x=e.x),e.y<i.y?i.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===ba)&&e.x===t.x)!=((0===e.y||e.y===ba)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,yi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ba!=e.x>ba&&this.addBorderIntersection(1,yi(t.y,e.y,(ba-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,yi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ba!=e.y>ba&&this.addBorderIntersection(3,yi(t.x,e.x,(ba-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new r(0,0)}span(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class _u{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new es,this.centroidVertexArray=new Bs,this.indexArray=new fs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,i,n){this.features=[],this.hasPattern=Zc("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/ba/(1<<e.z)}(i);for(const{feature:r,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Va(r,e);if(!this.layers[0]._featureFilter.filter(new Io(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Ua(r,i,n),properties:r.properties,type:r.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Xc("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,i,{},t.availableImages,n),t.featureIndex.insert(r,c.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(e,t,i,n,r){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,i,n,r)}this.sortBorders()}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tu.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,eu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,n,o,s,a){const l=[new r(0,0),new r(ba,ba)],c=a.projection,u="globe"===c.name,h=this.enableTerrain&&!u?new yu:null;u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ss);const d=Wc(t,500);for(let e=d.length-1;e>=0;e--){const t=d[e];(0===t.length||(p=t[0]).every((e=>e.x<=0))||p.every((e=>e.x>=ba))||p.every((e=>e.y<=0))||p.every((e=>e.y>=ba)))&&d.splice(e,1)}var p;let f;if(u)f=bu(d,l,n);else{f=[];for(const e of d)f.push({polygon:e,bounds:l})}for(const t of f){const i=t.polygon;let r=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e=0;e<i.length;e++){const s=i[e];if(0===s.length)continue;r+=s.length;let a=0;h&&h.startRing(s[0]);for(let e=0;e<s.length;e++){const i=s[e];if(e>=1){const r=s[e-1];if(!vu(i,r,t.bounds)){h&&h.append(i,r),o.vertexLength+4>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=i.sub(r)._perp(),t=e.x/(Math.abs(e.x)+Math.abs(e.y)),s=e.y>0?1:0,l=r.dist(i);a+l>32768&&(a=0),mu(this.layoutVertexArray,i.x,i.y,t,s,0,0,a),mu(this.layoutVertexArray,i.x,i.y,t,s,0,1,a),a+=l,mu(this.layoutVertexArray,r.x,r.y,t,s,0,0,a),mu(this.layoutVertexArray,r.x,r.y,t,s,0,1,a);const d=o.vertexLength;if(this.indexArray.emplaceBack(d,d+2,d+1),this.indexArray.emplaceBack(d+1,d+2,d+3),o.vertexLength+=4,o.primitiveLength+=2,u){const e=this.layoutVertexExtArray,t=c.projectTilePoint(i.x,i.y,n),o=c.projectTilePoint(r.x,r.y,n),s=c.upVector(n,i.x,i.y),a=c.upVector(n,r.x,r.y);gu(e,t,s),gu(e,t,s),gu(e,o,a),gu(e,o,a)}}}}}if(o.vertexLength+r>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(r,this.layoutVertexArray,this.indexArray)),"Polygon"!==pu[e.type])continue;const s=[],a=[],l=o.vertexLength;for(let e=0;e<i.length;e++){const t=i[e];if(0!==t.length){t!==i[0]&&a.push(s.length/2);for(let e=0;e<t.length;e++){const i=t[e];mu(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),s.push(i.x),s.push(i.y),h&&h.currentPolyCount.top++,u&&gu(this.layoutVertexExtArray,c.projectTilePoint(i.x,i.y,n),c.upVector(n,i.x,i.y))}}}const d=fc(s,a);for(let e=0;e<d.length;e+=3)this.indexArray.emplaceBack(l+d[e],l+d[e+2],l+d[e+1]);o.primitiveLength+=d.length/3,o.vertexLength+=r}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;const e=h.borders,t=this.featuresOnBorder.push(h)-1;for(let i=0;i<4;i++)e[i][0]!==Number.MAX_VALUE&&this.borders[i].push(t)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,s,n)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,t,i=!0){let n,r;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else n=Math.ceil(7*(e.x+450)),r=0;else n=0,r=+i;let o=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,r),this.centroidVertexArray.emplace(o++,n,r);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,n,r)}}}function vu(e,t,i){return e.x===t.x&&(e.x<i[0].x||e.x>i[1].x)||e.y===t.y&&(e.y<i[0].y||e.y>i[1].y)}function xu(){const e=Math.PI/32,t=Math.tan(e),i=Ta;return i*Math.sqrt(1+2*t*t)-i}function bu(e,t,i){const n=1<<i.z,o=za(i.x/n),s=za((i.x+1)/n),a=Ia(i.y/n),l=Ia((i.y+1)/n);return function(e,t,i,n,o,s){const a=[];if(!e.length||!i||!n)return a;const l=(e,t)=>{for(const i of e)a.push({polygon:i,bounds:t})},c=Math.ceil(Math.log2(i)),u=Math.ceil(Math.log2(n)),h=c-u,d=[];for(let e=0;e<Math.abs(h);e++)d.push(h>0?0:1);for(let e=0;e<Math.min(c,u);e++)d.push(0),d.push(1);let p=e;if(p=du(p,t[0].y-o,t[1].y+o,1),p=du(p,t[0].x-o,t[1].x+o,0),!p.length)return a;const f=[];for(d.length?f.push({polygons:p,bounds:t,depth:0}):l(p,t);f.length;){const e=f.pop(),t=e.depth,i=d[t],n=e.bounds[0],a=e.bounds[1],c=0===i?n.x:n.y,u=0===i?a.x:a.y,h=s?s(i,c,u):.5*(c+u),p=du(e.polygons,c-o,h+o,i),m=du(e.polygons,h-o,u+o,i);if(p.length){const e=[n,new r(0===i?h:a.x,1===i?h:a.y)];d.length>t+1?f.push({polygons:p,bounds:e,depth:t+1}):l(p,e)}if(m.length){const e=[new r(0===i?h:n.x,1===i?h:n.y),a];d.length>t+1?f.push({polygons:m,bounds:e,depth:t+1}):l(m,e)}}return a}(e,t,Math.ceil((s-o)/11.25),Math.ceil((a-l)/11.25),1,((e,t,r)=>{if(0===e)return.5*(t+r);{const e=Ia((i.y+t/ba)/n);return(Ma(.5*(Ia((i.y+r/ba)/n)+e))*n-i.y)*ba}}))}Ir(_u,"FillExtrusionBucket",{omit:["layers","features"]}),Ir(yu,"PartMetadata");var wu={paint:new qo({"fill-extrusion-opacity":new jo(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new No(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jo(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jo(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uo(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new No(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new No(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jo(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tu(e,t,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}class ku{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=Eu(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=function(e,t,i){var n=Tu(256*e,256*(t=Math.pow(2,i)-t-1),i),r=Tu(256*(e+1),256*(t+1),i);return n[0]+","+n[1]+","+r[0]+","+r[1]}(this.x,this.y,this.z),n=function(e,t,i){let n,r="";for(let o=e;o>0;o--)n=1<<o-1,r+=(t&n?1:0)+(i&n?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Su{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Eu(e,t.z,t.z,t.x,t.y)}}class Cu{constructor(e,t,i,n,r){this.overscaledZ=e,this.wrap=t,this.canonical=new ku(i,+n,+r),this.key=0===t&&e===i?this.canonical.key:Eu(t,e,i,n,r)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Cu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Eu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return Eu(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Cu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Cu(t,this.wrap,t,i,n),new Cu(t,this.wrap,t,i+1,n),new Cu(t,this.wrap,t,i,n+1),new Cu(t,this.wrap,t,i+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Cu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Cu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Su(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Eu(e,t,i,n,r){const o=1<<Math.min(i,22);let s=o*(r%o)+n%o;return e&&i<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*s+i)+(t-i)}function Mu(e,t){return e.x*t.x+e.y*t.y}function Au(e,t){if(1===e.length){let i=0;const n=t[i++];let r;for(;!r||n.equals(r);)if(r=t[i++],!r)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=r.sub(n),l=o.sub(n),c=s.sub(n),u=Mu(a,a),h=Mu(a,l),d=Mu(l,l),p=Mu(c,a),f=Mu(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=n.z*(1-g-y)+r.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function zu(e){const t=new r(e[0],e[1]);return t.z=e[2],t}function Iu(e,t,i,n,r,o,s,a){const l=s*r.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,i){const n=Math.floor(t[0]/8),r=Math.floor(t[1]/8),o=10*(t[0]-8*n),s=10*(t[1]-8*r),a=e.getElevationAt(n,r,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(n,r),d=2*c+1,p=2*u+1,f=function(e,t,i,n,r){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+r,i,!0),e.getElevationAtPixel(t,i+r,!0),e.getElevationAtPixel(t+n,i+r,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*y/p);return a+Math.max(_*o,v*s)}(r,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+n,l+i+2):l+n}}Ir(ku,"CanonicalTileID"),Ir(Cu,"OverscaledTileID",{omit:["projMatrix"]});const Lu=Ko([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Du}=Lu,Pu=Ko([{name:"a_packed",components:4,type:"Float32"}]),{members:Ou}=Pu,Ru=hu.VectorTileFeature.types,Bu=Math.cos(Math.PI/180*37.5);class Fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new ts,this.layoutVertexArray2=new is,this.indexArray=new fs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,n){this.hasPattern=Zc("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Va(t,e);if(!this.layers[0]._featureFilter.filter(new Io(this.zoom),c,i))continue;const u=r?r.evaluate(c,{},i):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ua(t,i,n),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const n of o){const{geometry:r,index:o,sourceLayerIndex:c}=n;if(l&&this.addFeatureDashes(n,s),this.hasPattern){const e=Xc("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,r,o,i,s.positions,t.availableImages);a.insert(e[o].feature,r,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,r=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==r.kind)t=!0;else{const t=r.value,i=n.value;if(!i)continue;e.addDash(i.from,t),e.addDash(i.to,t),i.other&&e.addDash(i.other,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===r.kind&&"constant"===o.kind)continue;let s,a,l,c,u,h;if("constant"===r.kind){const e=r.value;if(!e)continue;s=e.other||e.to,a=e.to,l=e.from}else s=r.evaluate({zoom:i-1},e),a=r.evaluate({zoom:i},e),l=r.evaluate({zoom:i+1},e);"constant"===o.kind?c=u=h=o.value:(c=o.evaluate({zoom:i-1},e),u=o.evaluate({zoom:i},e),h=o.evaluate({zoom:i+1},e)),t.addDash(s,c),t.addDash(a,u),t.addDash(l,h);const d=t.getKey(s,c),p=t.getKey(a,u),f=t.getKey(l,h);e.patterns[n.id]={min:d,mid:p,max:f}}}update(e,t,i,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,n)}addFeatures(e,t,i,n,r){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ou)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Du),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,n,r,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,a,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,r,o,n)}addLine(e,t,i,n,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ru[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(r=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?s?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,_=g.x*m.x+g.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Bu&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const T=d&&p;let k=T?i:s?"butt":n;if(T&&"round"===k&&(v<o?k="miter":v<=2&&(k="fakeround")),"miter"===k&&v>r&&(k="bevel"),"bevel"===k&&(v>2&&(k="flipbevel"),v<r&&(k="miter")),d&&this.updateDistance(d,h),"miter"===k)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===k){if(v>100)g=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===k||"fakeround"===k){const e=-Math.sqrt(v*v-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===k){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const n=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,n.x,n.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-i,u)}else if("butt"===k)this.addCurrentVertex(h,g,0,0,u);else if("square"===k){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===k&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,i,n,r,o=!1){const s=t.y*n-t.x,a=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,r),this.addHalfVertex(e,s,a,o,!0,-n,r)}addHalfVertex({x:e,y:t},i,n,r,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}Ir(Fu,"LineBucket",{omit:["layers","patternFeatures"]});const $u=new qo({"line-cap":new No(Ge.layout_line["line-cap"]),"line-join":new No(Ge.layout_line["line-join"]),"line-miter-limit":new jo(Ge.layout_line["line-miter-limit"]),"line-round-limit":new jo(Ge.layout_line["line-round-limit"]),"line-sort-key":new No(Ge.layout_line["line-sort-key"])});var ju={paint:new qo({"line-opacity":new No(Ge.paint_line["line-opacity"]),"line-color":new No(Ge.paint_line["line-color"]),"line-translate":new jo(Ge.paint_line["line-translate"]),"line-translate-anchor":new jo(Ge.paint_line["line-translate-anchor"]),"line-width":new No(Ge.paint_line["line-width"]),"line-gap-width":new No(Ge.paint_line["line-gap-width"]),"line-offset":new No(Ge.paint_line["line-offset"]),"line-blur":new No(Ge.paint_line["line-blur"]),"line-dasharray":new Uo(Ge.paint_line["line-dasharray"]),"line-pattern":new Uo(Ge.paint_line["line-pattern"]),"line-gradient":new Go(Ge.paint_line["line-gradient"]),"line-trim-offset":new jo(Ge.paint_line["line-trim-offset"])}),layout:$u};const Nu=new class extends No{possiblyEvaluate(e,t){return t=new Io(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,n){return t=v({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,n)}}(ju.paint.properties["line-width"].specification);function Uu(e,t){return t>0?t+2*e:e}Nu.useIntegerZoom=!0;const Vu=Ko([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gu=Ko([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qu=Ko([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ko([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wu=Ko([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Hu=Ko([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Zu=Ko([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xu=Ko([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ko([{name:"triangle",components:3,type:"Uint16"}]),Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ko([{type:"Float32",name:"offsetX"}]),Ko([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ku=24;const Yu=128;function Ju(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Io(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:n}=i;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Io(s)),maxSize:i.evaluate(new Io(a)),interpolationType:n}}}function Qu(e,{uSize:t,uSizeT:i},{lowerSize:n,upperSize:r}){return"source"===e.kind?n/Yu:"composite"===e.kind?yi(n/Yu,r/Yu,i):t}function eh(e,t){let i=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?f(Fi.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?n=yi(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var th=Object.freeze({__proto__:null,getSizeData:Ju,evaluateSizeForFeature:Qu,evaluateSizeForZoom:eh,SIZE_PACK_FACTOR:Yu});function ih(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const n=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),zo.applyArabicShaping&&(e=zo.applyArabicShaping(e)),e}(e.text,t,i)})),e}const nh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function rh(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function oh(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var sh=function(e,t,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=n;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},ah=function(e,t,i,n,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[i+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*m},lh=ch;function ch(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ch.Varint=0,ch.Fixed64=1,ch.Bytes=2,ch.Fixed32=5;var uh=4294967296,hh=1/uh,dh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ph(e){return e.type===ch.Bytes?e.readVarint()+e.pos:e.pos+1}function fh(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function mh(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=e;r--)i.buf[r+n]=i.buf[r]}function gh(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function yh(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function _h(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function vh(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function xh(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function bh(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function wh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Th(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function kh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Sh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Ch(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Eh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Mh(e,t,i){t.glyphs=[],1===e&&i.readMessage(Ah,t)}function Ah(e,t,i){if(3===e){const{id:e,bitmap:n,width:r,height:o,left:s,top:a,advance:l}=i.readMessage(zh,{});t.glyphs.push({id:e,bitmap:new ac({width:r+6,height:o+6},n),metrics:{width:r,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function zh(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function Ih(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let r=0,o=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}ch.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,o=this.pos;this.type=7&n,e(r,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Sh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Eh(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Sh(this.buf,this.pos)+Sh(this.buf,this.pos+4)*uh;return this.pos+=8,e},readSFixed64:function(){var e=Sh(this.buf,this.pos)+Eh(this.buf,this.pos+4)*uh;return this.pos+=8,e},readFloat:function(){var e=sh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=sh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,r,o=i.buf;if(n=(112&(r=o[i.pos++]))>>4,r<128)return fh(e,n,t);if(n|=(127&(r=o[i.pos++]))<<3,r<128)return fh(e,n,t);if(n|=(127&(r=o[i.pos++]))<<10,r<128)return fh(e,n,t);if(n|=(127&(r=o[i.pos++]))<<17,r<128)return fh(e,n,t);if(n|=(127&(r=o[i.pos++]))<<24,r<128)return fh(e,n,t);if(n|=(1&(r=o[i.pos++]))<<31,r<128)return fh(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&dh?function(e,t,i){return dh.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var n="",r=t;r<i;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),r+=u}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ch.Bytes)return e.push(this.readVarint(t));var i=ph(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ch.Bytes)return e.push(this.readSVarint());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ch.Bytes)return e.push(this.readBoolean());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ch.Bytes)return e.push(this.readFloat());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ch.Bytes)return e.push(this.readDouble());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ch.Bytes)return e.push(this.readFixed32());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ch.Bytes)return e.push(this.readSFixed32());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ch.Bytes)return e.push(this.readFixed64());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ch.Bytes)return e.push(this.readSFixed64());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ch.Varint)for(;this.buf[this.pos++]>127;);else if(t===ch.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ch.Fixed32)this.pos+=4;else{if(t!==ch.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ch(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ch(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ch(this.buf,-1&e,this.pos),Ch(this.buf,Math.floor(e*hh),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ch(this.buf,-1&e,this.pos),Ch(this.buf,Math.floor(e*hh),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;if(e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,r,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!r){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):r=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,r=n;continue}n=r-55296<<10|n-56320|65536,r=null}else r&&(e[i++]=239,e[i++]=191,e[i++]=189,r=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&mh(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),ah(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ah(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&mh(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,ch.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,gh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,yh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,xh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,_h,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,vh,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,bh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,wh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Th,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,kh,t)},writeBytesField:function(e,t){this.writeTag(e,ch.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ch.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ch.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ch.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ch.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ch.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ch.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ch.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ch.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ch.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Lh{constructor(e,{pixelRatio:t,version:i,stretchX:n,stretchY:r,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=r,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Dh{constructor(e,t){const i={},n={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,i,r),this.addImages(t,n,r);const{w:o,h:s}=Ih(r),a=new lc({width:o||1,height:s||1});for(const t in e){const n=e[t],r=i[t].paddedRect;lc.copy(n.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},n.data)}for(const e in t){const i=t[e],r=n[e].paddedRect,o=r.x+1,s=r.y+1,l=i.data.width,c=i.data.height;lc.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),lc.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),lc.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),lc.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),lc.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=n}addImages(e,t,i){for(const n in e){const r=e[n],o={x:0,y:0,w:r.data.width+2,h:r.data.height+2};i.push(o),t[n]=new Lh(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[n,r]=e.tl;i.update(t.data,void 0,{x:n,y:r})}}Ir(Lh,"ImagePosition"),Ir(Dh,"ImageAtlas");const Ph={horizontal:1,vertical:2,horizontalOnly:3};class Oh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new Oh;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Oh;return t.imageName=e,t}}class Rh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Rh;for(let n=0;n<e.sections.length;n++){const r=e.sections[n];r.image?i.addImageSection(r):i.addTextSection(r,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n+1)||null,o=e.charCodeAt(n-1)||null;i+=!t&&(r&&mo(r)&&!nh[e[n+1]]||o&&mo(o)&&!nh[e[n-1]])||!nh[e[n]]?e[n]:nh[e[n]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Fh[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Fh[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Rh;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Oh.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void I("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Oh.forImage(t)),this.sectionIndex.push(this.sections.length-1)):I("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bh(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=Rh.fromFeature(e,r);let y;h===Ph.vertical&&g.verticalizePunctuation(d);const{processBidirectionalText:_,processStyledBidirectionalText:v}=zo;if(_&&1===g.sections.length){y=[];const e=_(g.toString(),qh(g,c,o,t,n,p,f));for(const t of e){const e=new Rh;e.text=t,e.sections=g.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);y.push(e)}}else if(v){y=[];const e=v(g.text,g.sectionIndex,qh(g,c,o,t,n,p,f));for(const t of e){const e=new Rh;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,y.push(e)}}else y=function(e,t){const i=[],n=e.text;let r=0;for(const n of t)i.push(e.substring(r,n)),r=n;return r<n.length&&i.push(e.substring(r,n.length)),i}(g,qh(g,c,o,t,n,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,n,r,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of r){const i=e.getSections();for(const e of i){if(e.imageName)continue;const i=t[e.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let y=0;for(const s of r){s.trim();const r=s.getMaxScale(),a=(r-1)*Ku,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=v;const x=v.positionedGlyphs;let b=0;if(!s.length()){p+=o,++y;continue}let w=0,T=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o);let y=a.scale,v=null,k=null,S=null,C=Ku,E=0;const M=!(l===Ph.horizontal||!u&&!fo(m)||u&&(Fh[m]||(_=m,Br(_)||Fr(_)||$r(_)||ro(_)||lo(_))));if(a.imageName){const t=n[a.imageName];if(!t)continue;S=a.imageName,e.iconsInText=e.iconsInText||!0,k=t.paddedRect;const i=t.displaySize;y=y*Ku/h,v={width:i[0],height:i[1],left:1,top:-3,advance:M?i[1]:i[0],localGlyph:!1},E=g?-v.height*y:r*Ku-17-i[1]*y,C=v.advance;const o=(M?i[0]:i[1])*y-Ku*r;o>0&&o>b&&(b=o)}else{const e=i[a.fontStack];if(!e)continue;e[m]&&(k=e[m]);const n=t[a.fontStack];if(!n)continue;const o=n.glyphs[m];if(!o)continue;if(v=o.metrics,C=8203!==m?Ku:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,i=(e+t)*y;w<i&&(w=i,T=(e-t)/2*y),E=-e*y}else E=(r-y)*Ku-17}M?(e.verticalizable=!0,x.push({glyph:m,imageName:S,x:d,y:p+E,vertical:M,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:k}),d+=C*y+c):(x.push({glyph:m,imageName:S,x:d,y:p+E,vertical:M,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:k}),d+=v.advance*y+c)}0!==x.length&&(f=Math.max(d-c,f),g?Hh(x,m,b,T,o*r/2):Hh(x,m,b,0,o/2)),d=0;const k=o*r+b;v.lineOffset=Math.max(b,a),p+=k,++y}var _;const v=p,{horizontalAlign:x,verticalAlign:b}=Wh(s);(function(e,t,i,n,r,o){const s=(t-i)*r,a=-o*n;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,n,y,s,a,l,h,c,d,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Fh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$h={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jh(e,t,i,n,r,o){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*Ku/o+r:0}{const n=i[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+r:0}}function Nh(e,t,i,n){const r=Math.pow(e-t,2);return n?e<t?r/2:2*r:r+Math.abs(i)*i}function Uh(e,t,i){let n=0;return 10===e&&(n-=1e4),i&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Vh(e,t,i,n,r,o){let s=null,a=Nh(t,i,r,o);for(const e of n){const n=Nh(t-e.x,i,r,o)+e.badness;n<=a&&(s=e,a=n)}return{index:e,x:t,priorBreak:s,badness:a}}function Gh(e){return e?Gh(e.priorBreak).concat(e.index):[]}function qh(e,t,i,n,r,o,s){if("point"!==o)return[];if(!e)return[];const a=[],l=function(e,t,i,n,r,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=jh(e.getCharCode(i),a,n,r,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,n,r,s),c=e.text.indexOf("​")>=0;let u=0;for(let i=0;i<e.length();i++){const o=e.getSection(i),d=e.getCharCode(i);if(Fh[d]||(u+=jh(d,o,n,r,t,s)),i<e.length()-1){const t=!((h=d)<11904||!(Hr(h)||Wr(h)||so(h)||no(h)||Yr(h)||jr(h)||Zr(h)||Vr(h)||Jr(h)||Qr(h)||Kr(h)||co(h)||Gr(h)||Ur(h)||Nr(h)||Xr(h)||qr(h)||oo(h)||to(h)||eo(h)));($h[d]||t||o.imageName)&&a.push(Vh(i+1,u,l,a,Uh(d,e.getCharCode(i+1),t&&c),!1))}}var h;return Gh(Vh(e.length(),u,l,a,0,!0))}function Wh(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Hh(e,t,i,n,r){if(!(t||i||n||r))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=i+n+r}function Zh(e,t,i){const{horizontalAlign:n,verticalAlign:r}=Wh(i),o=t[0]-e.displaySize[0]*n,s=t[1]-e.displaySize[1]*r;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Xh(e,t,i,n,r,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=r[0]+l-n[3],h=r[0]+c+n[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===i||"both"===i?(u=r[1]+f-n[0],d=r[1]+m+n[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class Kh extends r{constructor(e,t,i,n,r){super(e,t),this.angle=n,this.z=i,void 0!==r&&(this.segment=r)}clone(){return new Kh(this.x,this.y,this.z,this.angle,this.segment)}}function Yh(e,t,i,n,r){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(i)}return!0}function Jh(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Qh(e,t,i){return e?.6*t*i:0}function ed(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function td(e,t,i,n,r,o){const s=Qh(i,r,o),a=ed(i,n)*o;let l=0;const c=Jh(e)/2;for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1],o=n.dist(r);if(l+o>c){const u=(c-l)/o,h=yi(n.x,r.x,u),d=yi(n.y,r.y,u),p=new Kh(h,d,0,r.angleTo(n),i);return!s||Yh(e,p,a,s,t)?p:void 0}l+=o}}function id(e,t,i,n,r,o,s,a,l){const c=Qh(n,o,s),u=ed(n,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),nd(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function nd(e,t,i,n,r,o,s,a,l){const c=o/2,u=Jh(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,y=yi(s.x,a.x,g),_=yi(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Kh(y,_,0,m,t);i._round(),n&&!Yh(e,i,o,n,r)||p.push(i)}}h+=f}return a||p.length||s||(p=nd(e,h/2,i,n,r,o,s,!0,l)),p}function rd(e,t,i,n,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;for(let e=0;e<l.length-1;e++){let a=l[e],u=l[e+1];a.x<t&&u.x<t||(a.x<t?a=new r(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<t&&(u=new r(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new r(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=n&&u.x>=n||(a.x>=n?a=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=n&&(u=new r(n,a.y+(n-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new r(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}Ir(Kh,"Anchor");const od=1e20;function sd(e,t,i,n,r,o,s,a,l){for(let c=t;c<t+n;c++)ad(e,i*o+c,o,r,s,a,l);for(let c=i;c<i+r;c++)ad(e,c*o+t,1,n,s,a,l)}function ad(e,t,i,n,r,o,s){o[0]=0,s[0]=-od,s[1]=od,r[0]=e[t];for(let a=1,l=0,c=0;a<n;a++){r[a]=e[t+a*i];const n=a*a;do{const e=o[l];c=(r[a]-r[e]+n-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=od}for(let a=0,l=0;a<n;a++){for(;s[l+1]<a;)l++;const n=o[l],c=a-n;e[t+a*i]=r[n]+c*c}}const ld={none:0,ideographs:1,all:2};class cd{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const i=[];for(const t in e)for(const n of e[t])i.push({stack:t,id:n});y(i,(({stack:e,id:t},i)=>{let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let r=n.glyphs[t];if(void 0!==r)return void i(null,{stack:e,id:t,glyph:r});if(r=this._tinySDF(n,e,t),r)return n.glyphs[t]=r,void i(null,{stack:e,id:t,glyph:r});const o=Math.floor(t/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:e,id:t,glyph:r});let s=n.requests[o];s||(s=n.requests[o]=[],cd.loadGlyphRange(e,o,this.url,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[o]=!0}for(const i of s)i(e,t);delete n.requests[o]}))),s.push(((n,r)=>{n?i(n):r&&i(null,{stack:e,id:t,glyph:r.glyphs[t]||null})}))}),((e,i)=>{if(e)t(e);else if(i){const e={};for(const{stack:t,id:n,glyph:r}of i)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ld.none&&(this.localGlyphMode===ld.all?!!this.localFontFamily:!!this.localFontFamily&&(Qr(e)||io(e)||Gr(e)||qr(e)||Vr(e)))}_tinySDF(e,t,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let r=e.tinySDF;if(!r){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),r=e.tinySDF=new cd.TinySDF({fontFamily:n,fontWeight:i,fontSize:48,buffer:6,radius:16}),r.fontWeight=i}if(this.localGlyphs[r.fontWeight][i])return this.localGlyphs[r.fontWeight][i];const o=String.fromCharCode(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=r.draw(o);return this.localGlyphs[r.fontWeight][i]={id:i,bitmap:new ac({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function ud(e,t,i,n){const o=[],s=e.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,d=s.stretchX||[[0,l]],p=s.stretchY||[[0,c]],f=(e,t)=>e+t[1]-t[0],m=d.reduce(f,0),g=p.reduce(f,0),y=l-m,_=c-g;let v=0,x=m,b=0,w=g,T=0,k=y,S=0,C=_;if(s.content&&n){const e=s.content;v=hd(d,0,e[0]),b=hd(p,0,e[1]),x=hd(d,e[0],e[2]),w=hd(p,e[1],e[3]),T=e[0]-v,S=e[1]-b,k=e[2]-e[0]-x,C=e[3]-e[1]-w}const E=(n,o,l,c)=>{const d=pd(n.stretch-v,x,u,e.left),p=fd(n.fixed-T,k,n.stretch,m),f=pd(o.stretch-b,w,h,e.top),y=fd(o.fixed-S,C,o.stretch,g),_=pd(l.stretch-v,x,u,e.left),E=fd(l.fixed-T,k,l.stretch,m),M=pd(c.stretch-b,w,h,e.top),A=fd(c.fixed-S,C,c.stretch,g),z=new r(d,f),I=new r(_,f),L=new r(_,M),D=new r(d,M),P=new r(p/a,y/a),O=new r(E/a,A/a),R=t*Math.PI/180;if(R){const e=Math.sin(R),t=Math.cos(R),i=[t,-e,e,t];z._matMult(i),I._matMult(i),D._matMult(i),L._matMult(i)}const B=n.stretch+n.fixed,F=o.stretch+o.fixed;return{tl:z,tr:I,bl:D,br:L,tex:{x:s.paddedRect.x+1+B,y:s.paddedRect.y+1+F,w:l.stretch+l.fixed-B,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:P,pixelOffsetBR:O,minFontScaleX:k/a/u,minFontScaleY:C/a/h,isSDF:i}};if(n&&(s.stretchX||s.stretchY)){const e=dd(d,y,m),t=dd(p,_,g);for(let i=0;i<e.length-1;i++){const n=e[i],r=e[i+1];for(let e=0;e<t.length-1;e++)o.push(E(n,t[e],r,t[e+1]))}}else o.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function hd(e,t,i){let n=0;for(const r of e)n+=Math.max(t,Math.min(i,r[1]))-Math.max(t,Math.min(i,r[0]));return n}function dd(e,t,i){const n=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return n.push({fixed:t+1,stretch:i}),n}function pd(e,t,i,n){return e/t*i+n}function fd(e,t,i,n){return e-t*i/n}function md(e,t,i,n){const r=t+e.positionedLines[n].lineOffset;return 0===n?i+r/2:i+(r+(t+e.positionedLines[n-1].lineOffset))/2}cd.loadGlyphRange=function(e,t,i,n,r){const o=256*t,s=o+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),Ee.Glyphs);Ie(a,((e,t)=>{if(e)r(e);else if(t){const e={},i=function(e){return new lh(e).readFields(Mh,{})}(t);for(const t of i.glyphs)e[t.id]=t;r(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},cd.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.min(this.size-this.buffer,Math.ceil(o-r)),l=Math.min(this.size-this.buffer,s+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(od,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=_.data[4*(e*a+t)+3]/255;if(0===i)continue;const n=(e+m)*c+t+m;if(1===i)y[n]=0,g[n]=od;else{const e=.5-i;y[n]=e>0?e*e:0,g[n]=e<0?e*e:0}}sd(y,0,0,c,u,c,this.f,this.v,this.z),sd(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(y[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class gd{constructor(e,t){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,n=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(i(n,o)>=0)break;t[e]=o,e=r}t[e]=n}_down(e){const{data:t,compare:i}=this,n=this.length>>1,r=t[e];for(;e<n;){let n=1+(e<<1),o=t[n];const s=n+1;if(s<this.length&&i(t[s],o)<0&&(n=s,o=t[s]),i(o,r)>=0)break;t[e]=o,e=n}t[e]=r}}function yd(e,t,i=!1){let n=1/0,o=1/0,s=-1/0,a=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<o)&&(o=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>a)&&(a=t.y)}const c=Math.min(s-n,a-o);let u=c/2;const h=new gd([],_d);if(0===c)return new r(n,o);for(let t=n;t<s;t+=c)for(let i=o;i<a;i+=c)h.push(new vd(t+u,i+u,u,e));let d=function(e){let t=0,i=0,n=0;const r=e[0];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,n+=(o.y+a.y)*l,t+=3*l}return new vd(i/t,n/t,0,e)}(e),p=h.length;for(;h.length;){const n=h.pop();(n.d>d.d||!d.d)&&(d=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-d.d<=t||(u=n.h/2,h.push(new vd(n.p.x-u,n.p.y-u,u,e)),h.push(new vd(n.p.x+u,n.p.y-u,u,e)),h.push(new vd(n.p.x-u,n.p.y+u,u,e)),h.push(new vd(n.p.x+u,n.p.y+u,u,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function _d(e,t){return t.max-e.max}function vd(e,t,i,n){this.p=new r(e,t),this.h=i,this.d=function(e,t){let i=!1,n=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(i=!i),n=Math.min(n,el(e,r,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const xd=Number.POSITIVE_INFINITY,bd=Math.sqrt(2);function wd(e,t){return t[1]!==xd?function(e,t,i){let n=0,r=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":r=i-7;break;case"bottom-right":case"bottom-left":case"bottom":r=7-i}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}return[n,r]}(e,t[0],t[1]):function(e,t){let i=0,n=0;t<0&&(t=0);const r=t/bd;switch(e){case"top-right":case"top-left":n=r-7;break;case"bottom-right":case"bottom-left":n=7-r;break;case"bottom":n=7-t;break;case"top":n=t-7}switch(e){case"top-right":case"bottom-right":i=-r;break;case"top-left":case"bottom-left":i=r;break;case"left":i=t;break;case"right":i=-t}return[i,n]}(e,t[0])}function Td(e,t,i,n,r,o,s,a,l,c){e.createArrays(),e.tilePixelRatio=ba/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,d={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Io(t),a),h["text-size"].possiblyEvaluate(new Io(i),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Io(t),a),h["icon-size"].possiblyEvaluate(new Io(i),a)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new Io(l+1),a),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new Io(l+1),a),d.textMaxSize=h["text-size"].possiblyEvaluate(new Io(18),a);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of e.features){const l=u.get("text-font").evaluate(o,{},a).join(","),h=f.evaluate(o,{},a),m=d.layoutTextSize.evaluate(o,{},a),g=(d.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),y=o.text;let _,v=[0,0];if(y){const n=y.toString(),s=u.get("text-letter-spacing").evaluate(o,{},a)*Ku,c=u.get("text-line-height").evaluate(o,{},a)*Ku,d=ho(n)?s:0,f=u.get("text-anchor").evaluate(o,{},a),_=u.get("text-variable-anchor");if(!_){const e=u.get("text-radial-offset").evaluate(o,{},a);v=e?wd(f,[e*Ku,xd]):u.get("text-offset").evaluate(o,{},a).map((e=>e*Ku))}let x=p?"center":u.get("text-justify").evaluate(o,{},a);const b=u.get("symbol-placement"),w="point"===b,T="point"===b?u.get("text-max-width").evaluate(o,{},a)*Ku:0,k=o=>{e.allowVerticalPlacement&&uo(n)&&(g.vertical=Bh(y,t,i,r,l,T,c,f,o,d,v,Ph.vertical,!0,b,m,h))};if(!p&&_){const e="auto"===x?_.map((e=>kd(e))):[x];let n=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!g.horizontal[s])if(n)g.horizontal[s]=g.horizontal[0];else{const e=Bh(y,t,i,r,l,T,c,"center",s,d,v,Ph.horizontal,!1,b,m,h);e&&(g.horizontal[s]=e,n=1===e.positionedLines.length)}}k("left")}else{if("auto"===x&&(x=kd(f)),w||u.get("text-writing-mode").indexOf("horizontal")>=0||!uo(n)){const e=Bh(y,t,i,r,l,T,c,f,x,d,v,Ph.horizontal,!1,b,m,h);e&&(g.horizontal[x]=e)}k("point"===b?"left":x)}}let x=!1;if(o.icon&&o.icon.name){const t=n[o.icon.name];t&&(_=Zh(r[o.icon.name],u.get("icon-offset").evaluate(o,{},a),u.get("icon-anchor").evaluate(o,{},a)),x=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&I("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=Md(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!b&&b.iconsInText),(b||_)&&Sd(e,o,g,_,n,d,m,0,v,x,s,a,c)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function kd(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sd(e,t,i,n,r,o,s,a,c,u,h,d,p){let f=o.textMaxSize.evaluate(t,{},d);void 0===f&&(f=s);const m=e.layers[0].layout,g=m.get("icon-offset").evaluate(t,{},d),y=Md(i.horizontal)||i.vertical,_="globe"===p.name,v=s/24,x=e.tilePixelRatio*f/24,b=(A=e.overscaling,e.zoom>18&&A>2&&(A>>=1),Math.max(ba/(512*A),1)*m.get("symbol-spacing")),w=m.get("text-padding")*e.tilePixelRatio,T=m.get("icon-padding")*e.tilePixelRatio,k=l(m.get("text-max-angle")),S="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),C="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),E=m.get("symbol-placement"),M=b/2;var A;const z=m.get("icon-text-fit");let L;n&&"none"!==z&&(e.allowVerticalPlacement&&i.vertical&&(L=Xh(n,i.vertical,z,m.get("icon-text-fit-padding"),g,v)),y&&(n=Xh(n,y,z,m.get("icon-text-fit-padding"),g,v)));const D=(s,a,l)=>{if(a.x<0||a.x>=ba||a.y<0||a.y>=ba)return;let f=null;if(_){const{x:e,y:t,z:i}=p.projectTilePoint(a.x,a.y,l);f={anchor:new Kh(e,t,i,0,void 0),up:p.upVector(l,a.x,a.y)}}!function(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,k){const S=e.addToLineVertexArray(t,n);let C,E,M,A,z,L,D,P=0,O=0,R=0,B=0,F=-1,$=-1;const j={};let N=Gs("");const U=i?i.anchor:t;let V=0,G=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,G]=l.layout.get("text-offset").evaluate(x,{},k).map((e=>e*Ku)):(V=l.layout.get("text-radial-offset").evaluate(x,{},k)*Ku,G=xd),e.allowVerticalPlacement&&r.vertical){const e=r.vertical;if(f)L=zd(e),a&&(D=zd(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},k)+90;M=Ad(c,U,t,u,h,d,e,p,i,m),a&&(A=Ad(c,U,t,u,h,d,a,y,i))}}if(o){const n=l.layout.get("icon-rotate").evaluate(x,{},k),r="none"!==l.layout.get("icon-text-fit"),s=ud(o,n,w,r),p=a?ud(a,n,w,r):void 0;E=Ad(c,U,t,u,h,d,o,y,n),P=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Yu*l.layout.get("icon-size").evaluate(x,{},k)],m[0]>Cd&&I(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Yu*b.compositeIconSizes[0].evaluate(x,{},k),Yu*b.compositeIconSizes[1].evaluate(x,{},k)],(m[0]>Cd||m[1]>Cd)&&I(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,v,_,x,!1,i,t,S.lineStartIndex,S.lineLength,-1,T,k),F=e.icon.placedSymbolArray.length-1,p&&(O=4*p.length,e.addSymbols(e.icon,p,m,v,_,x,Ph.vertical,i,t,S.lineStartIndex,S.lineLength,-1,T,k),$=e.icon.placedSymbolArray.length-1)}for(const n in r.horizontal){const o=r.horizontal[n];C||(N=Gs(o.text),f?z=zd(o):C=Ad(c,U,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(x,{},k),m));const a=1===o.positionedLines.length;if(R+=Ed(e,i,t,o,s,l,f,x,m,S,r.vertical?Ph.horizontal:Ph.horizontalOnly,a?Object.keys(r.horizontal):[n],j,F,b,T,k),a)break}r.vertical&&(B+=Ed(e,i,t,r.vertical,s,l,f,x,m,S,Ph.vertical,["vertical"],j,$,b,T,k));let q=-1;const W=(e,t)=>e?Math.max(e,t):t;q=W(z,q),q=W(L,q),q=W(D,q);const H=q>-1?1:0;e.glyphOffsetArray.length>=Bp.MAX_GLYPHS&&I("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(U.x,U.y,U.z,t.x,t.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,F,$,N,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==E?E:e.collisionBoxArray.length,void 0!==E?E+1:e.collisionBoxArray.length,A||e.collisionBoxArray.length,A?A+1:e.collisionBoxArray.length,u,R,B,P,O,H,0,V,G,q)}(e,a,f,s,i,n,r,L,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,w,S,c,0,T,C,g,t,o,u,h,d)};if("line"===E)for(const r of rd(t.geometry,0,0,ba,ba)){const t=id(r,b,k,i.vertical||y,n,24,x,e.overscaling,ba);for(const i of t){const t=y;t&&Id(e,t.text,M,i)||D(r,i,d)}}else if("line-center"===E){for(const e of t.geometry)if(e.length>1){const t=td(e,k,i.vertical||y,n,24,x);t&&D(e,t,d)}}else if("Polygon"===t.type)for(const e of Wc(t.geometry,0)){const t=yd(e,16);D(e[0],new Kh(t.x,t.y,0,0,void 0),d)}else if("LineString"===t.type)for(const e of t.geometry)D(e,new Kh(e[0].x,e[0].y,0,0,void 0),d);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)D([t],new Kh(t.x,t.y,0,0,void 0),d)}const Cd=32640;function Ed(e,t,i,n,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=function(e,t,i,n,o,s,a,l){const c=[];if(0===t.positionedLines.length)return c;const u=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(e){const t=e[0],i=e[1],n=t*i;return n>0?[t,-i]:n<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let d=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)d-=e.lineOffset;const p=t.positionedLines.length,f=d/p;let m=t.top-i[1];for(let e=0;e<p;++e){const n=t.positionedLines[e];m=md(t,f,m,e);for(const e of n.positionedGlyphs){if(!e.rect)continue;const n=e.rect||{};let s=4,d=!0,p=1,f=0;if(e.imageName){const t=a[e.imageName];if(!t)continue;if(t.sdf){I("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,p=t.pixelRatio,s=1/p}const g=(o||l)&&e.vertical,y=e.metrics.advance*e.scale/2,_=e.metrics,v=e.rect;if(null===v)continue;l&&t.verticalizable&&(f=e.imageName?y-e.metrics.width*e.scale/2:0);const x=o?[e.x+y,e.y]:[0,0];let b=[0,0],w=[0,0],T=!1;o||(g?(w=[e.x+y+h[0],e.y+h[1]-f],T=!0):b=[e.x+y+i[0],e.y+i[1]-f]);const k=v.w*e.scale/(p*(e.localGlyph?2:1)),S=v.h*e.scale/(p*(e.localGlyph?2:1));let C,E,M,A;if(g){const t=e.y-m,i=new r(-y,y-t),n=-Math.PI/2,o=new r(...w);C=new r(-y+b[0],b[1]),C._rotateAround(n,i)._add(o),C.x+=-t+y,C.y-=(_.left-s)*e.scale;const a=e.imageName?_.advance*e.scale:Ku*e.scale,l=String.fromCharCode(e.glyph);rh(l)?C.x+=(1-s)*e.scale:oh(l)?C.x+=a-_.height*e.scale+(-s-1)*e.scale:C.x+=e.imageName||_.width+2*s===v.w&&_.height+2*s===v.h?(a-S)/2:(a-(_.height+2*s)*e.scale)/2,E=new r(C.x,C.y-k),M=new r(C.x+S,C.y),A=new r(C.x+S,C.y-k)}else{const t=(_.left-s)*e.scale-y+b[0],i=(-_.top-s)*e.scale+b[1],n=t+k,o=i+S;C=new r(t,i),E=new r(n,i),M=new r(t,o),A=new r(n,o)}if(u){let e;e=o?new r(0,0):T?new r(h[0],h[1]):new r(i[0],i[1]),C._rotateAround(u,e),E._rotateAround(u,e),M._rotateAround(u,e),A._rotateAround(u,e)}const z=new r(0,0),L=new r(0,0);c.push({tl:C,tr:E,bl:M,br:A,tex:n,writingMode:t.writingMode,glyphOffset:x,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:z,pixelOffsetBR:L,minFontScaleX:0,minFontScaleY:0})}}return c}(0,n,c,s,a,l,o,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Yu*s.layout.get("text-size").evaluate(l,{},y)],x[0]>Cd&&I(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Yu*m.compositeTextSizes[0].evaluate(l,{},y),Yu*m.compositeTextSizes[1].evaluate(l,{},y)],(x[0]>Cd||x[1]>Cd)&&I(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,_,x,c,a,l,h,t,i,u.lineStartIndex,u.lineLength,f,g,y);for(const t of d)p[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function Md(e){for(const t in e)return e[t];return null}function Ad(e,t,i,n,o,s,a,c,u,h){let d=a.top,p=a.bottom,f=a.left,m=a.right;const g=a.collisionPadding;if(g&&(f-=g[0],d-=g[1],m+=g[2],p+=g[3]),u){const e=new r(f,d),t=new r(m,d),i=new r(f,p),n=new r(m,p),o=l(u);let s=new r(0,0);h&&(s=new r(h[0],h[1])),e._rotateAround(o,s),t._rotateAround(o,s),i._rotateAround(o,s),n._rotateAround(o,s),f=Math.min(e.x,t.x,i.x,n.x),m=Math.max(e.x,t.x,i.x,n.x),d=Math.min(e.y,t.y,i.y,n.y),p=Math.max(e.y,t.y,i.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,f,d,m,p,c,n,o,s),e.length-1}function zd(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Id(e,t,i,n){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<i)return!0}else r[t]=[];return r[t].push(n),!1}const Ld=Ko([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:Dd}=Ld,Pd=Ko([{name:"a_pos_3",components:3,type:"Int16"}]);var Od=Ko([{name:"a_pos",type:"Int16",components:2}]);const Rd=ba/Math.PI/2,Bd=2*Aa(1,0)*Rd*Math.PI,Fd=[64,32,16],$d=-Rd,jd=Rd,Nd=[new Yl([$d,$d,$d],[jd,jd,jd]),new Yl([$d,$d,$d],[0,0,jd]),new Yl([0,$d,$d],[jd,0,jd]),new Yl([$d,0,$d],[0,jd,jd]),new Yl([0,0,$d],[jd,jd,jd])];function Ud(e,t,i,n){const r=Il([],e._camera.position,e.worldSize),o=[t,i,1,1];Vl(o,o,e.pixelMatrixInverse),Ul(o,o,1/o[3]);const s=Dl([],$l([],o,r)),a=e.globeMatrix,l=[a[12],a[13],a[14]],u=$l([],l,r),h=kl(u),d=Dl([],u),p=e.worldSize/(2*Math.PI),m=Pl(d,s),g=Math.asin(p/h);if(g<Math.acos(m)){if(!n)return null;const e=[],t=[];Il(e,s,h/m),Dl(t,$l(t,e,u)),Dl(s,Cl(s,u,Il(s,t,Math.tan(g)*h)))}const y=[];new Zl(r,s).closestPointOnSphere(l,p,y);const _=Dl([],$(a,0)),v=Dl([],$(a,1)),x=Dl([],$(a,2)),b=Pl(_,y),w=Pl(v,y),T=Pl(x,y),k=c(Math.asin(-w/p));let S=c(Math.atan2(b,T));S=e.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(e.center.lng,S);const C=Ea(S),E=f(Ma(k),0,1);return new Pa(C,E)}class Vd{constructor(e,t,i){this.a=$l([],e,i),this.b=$l([],t,i),this.center=i;const n=Dl([],this.a),r=Dl([],this.b);this.angle=Math.acos(Pl(n,r))}}function Gd(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,n){const r=Math.sin(i);return e*(Math.sin((1-n)*i)/r)+t*(Math.sin(n*i)/r)}(e.a[t],e.b[t],e.angle,f(i,0,1))+e.center[t]}function qd(e){if(e.z<=1)return Nd[e.z+2*e.y+e.x];const[t,i]=Hd(e),n=[Xd(t[0],t[1]),Xd(t[0],i[1]),Xd(i[0],t[1]),Xd(i[0],i[1])],r=[jd,jd,jd],o=[$d,$d,$d];for(const e of n)r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.min(r[2],e[2]),o[0]=Math.max(o[0],e[0]),o[1]=Math.max(o[1],e[1]),o[2]=Math.max(o[2],e[2]);return new Yl(r,o)}function Wd(e,t,i){const n=t/e.worldSize,r=Number.MAX_VALUE,o=[-r,-r,-r],s=[r,r,r],a=fl(new Float64Array(16));if(yl(a,a,[n,n,n]),ml(a,a,e.globeMatrix),i.z<=1){const e=qd(i).getCorners();for(let t=0;t<e.length;t++)Rl(e[t],e[t],a),Al(s,s,e[t]),zl(o,o,e[t]);return new Yl(s,o)}const[c,u]=Hd(i),h=new wa;h.setSouthWest([c[1],u[0]]),h.setNorthEast([u[1],c[0]]);const d=[Xd(h.getSouth(),h.getWest()),Xd(h.getSouth(),h.getEast()),Xd(h.getNorth(),h.getEast()),Xd(h.getNorth(),h.getWest())];for(let e=0;e<d.length;e++)Rl(d[e],d[e],a),Al(s,s,d[e]),zl(o,o,d[e]);if(h.contains(e.center)){o[2]=0;const t=e.point,i=[t.x*n,t.y*n,0];return Al(s,s,i),zl(o,o,i),new Yl(s,o)}const p=[a[12],a[13],a[14]],m=e.center.lng,g=f(e.center.lat,-85.051129,Da),y=[Ea(m),Ma(g)],_=h.getCenter().lng,v=f(h.getCenter().lat,-85.051129,Da),x=[Ea(_),Ma(v)];let b=new Array(3),w=0,T=y[0]-x[0];const k=y[1]-x[1];if(T>.5?T-=1:T<-.5&&(T+=1),Math.abs(T)>Math.abs(k))w=T>=0?1:3,b=p;else{w=k>=0?0:2;const e=[a[4],a[5],a[6]];let t;t=k>=0?-Math.sin(l(h.getSouth()))*Rd:-Math.sin(l(h.getNorth()))*Rd,b=Ll(b,p,e,t)}const S=d[w],C=d[(w+1)%4],E=new Vd(S,C,b),M=[Gd(E,0)||S[0],Gd(E,1)||S[1],Gd(E,2)||S[2]];return s[2]=Math.min(S[2],C[2]),Al(s,s,M),zl(o,o,M),new Yl(s,o)}function Hd(e){const t=1<<e.z,i=e.x/t,n=(e.x+1)/t,r=(e.y+1)/t;return[[Ia(e.y/t),za(i)],[Ia(r),za(n)]]}function Zd(e,t,i,n=Rd){return i=l(i),[e*Math.sin(i)*n,-t*n,e*Math.cos(i)*n]}function Xd(e,t,i){return Zd(Math.cos(l(e)),Math.sin(l(e)),t,i)}function Kd(e,t,i){const n=Math.pow(2,i.z),r=(e/ba+i.x)/n;return Xd(Ia((t/ba+i.y)/n),za(r))}function Yd(e){return 16383/Math.max(...$l([],e.max,e.min))}function Jd(e){const t=fl(new Float64Array(16)),i=Yd(e);var n,r;return yl(t,t,[i,i,i]),gl(t,t,((n=[])[0]=-(r=e.min)[0],n[1]=-r[1],n[2]=-r[2],n)),t}function Qd(e){const t=fl(new Float64Array(16)),i=1/Yd(e);return gl(t,t,e.min),yl(t,t,[i,i,i]),t}function ep(e,t,i,n,r){const o=function(e){const t=ba/(2*Math.PI);return e/(2*Math.PI)/t}(i),s=[e,t,-i/(2*Math.PI)],a=fl(new Float64Array(16));return gl(a,a,s),yl(a,a,[o,o,o]),_l(a,a,l(-r)),vl(a,a,l(-n)),a}function tp(e){return m(5,6,e)}function ip(e,t){const i=Xd(t.lat,t.lng);return o=(n=El([],function(e){const t=Xd(e._center.lat,e._center.lng);let i=Ol([],Sl(0,1,0),t);const n=xl([],-e.angle,t);i=Rl(i,i,n),xl(n,-e._pitch,i);const r=Dl([],t);return Il(r,r,e.cameraToCenterDistance/e.pixelsPerMeter*Bd),Rl(r,r,n),Cl([],t,r)}(e),i))[0],s=n[1],a=n[2],l=(r=i)[0],c=r[1],u=r[2],d=(h=Math.sqrt(o*o+s*s+a*a)*Math.sqrt(l*l+c*c+u*u))&&Pl(n,r)/h,Math.acos(Math.min(Math.max(d,-1),1));var n,r,o,s,a,l,c,u,h,d}const np=l(85),rp=Math.cos(np),op=Math.sin(np);function sp(e,t){const i=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,r=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),o=Math.sin(i)*r/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),s=Math.sin(e._pitch)*o+r;return Math.min(1.01*s,r*(1/e._horizonShift))}function ap(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),n=e.x*i,r=(e.x+1)*i,o=e.y*i,s=(e.y+1)*i,a=za(n),l=za(r),c=Ia(o),u=Ia(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),y=Math.max(h.x,d.x,p.x,f.x),_=Math.max(h.y,d.y,p.y,f.y);const v=i/16;function x(e,i,n,r,o,s){const a=(n+o)/2,l=(r+s)/2,c=t.project(za(a),Ia(l)),u=Math.max(0,m-c.x,g-c.y,c.x-y,c.y-_);m=Math.min(m,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),_=Math.max(_,c.y),u>v&&(x(e,c,n,r,a,l),x(c,i,a,l,o,s))}x(h,d,n,o,r,o),x(d,p,r,o,r,s),x(p,f,r,s,n,s),x(f,h,n,s,n,o),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:t}}const lp=fl(new Float32Array(16));class cp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ka(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return Aa(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return sp(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,n){const o=e.horizonLineFromTop(!1),s=new r(t,Math.max(o,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(s,n))}pointCoordinate3D(e,t,i){const n=new r(t,i);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return lp}createTileMatrix(e,t,i){let n,r,o;const s=i.canonical,a=fl(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=ap(s,this);n=1,r=l.x+i.wrap*l.scale,o=l.y,yl(a,a,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(s.z),r=(s.x+Math.pow(2,s.z)*i.wrap)*n,o=s.y*n;return gl(a,a,[r,o,0]),yl(a,a,[n/ba,n/ba,1]),a}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class up extends cp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(l(t));this.n=(n+Math.sin(l(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:n,r0:r}=this,o=l(e-this.center[0]),s=l(t),a=Math.sqrt(n-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-r,z:0}}unproject(e,t){const{n:i,c:n,r0:r}=this,o=r+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=l(this.center[0])*i;s=g(s,-Math.PI-a,Math.PI-a);const u=c(s/i)+this.center[0],h=Math.asin(f((n-(e*e+o*o)*i*i)/(2*i),-1,1)),d=f(c(h),-85.051129,Da);return new ka(u,d)}}const hp=1.340264,dp=-.081106,pp=893e-6,fp=.003796,mp=Math.sqrt(3)/2;class gp extends cp{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(mp*Math.sin(t)),n=i*i,r=n*n*n;return{x:.5*(e*Math.cos(i)/(mp*(hp+3*dp*n+r*(7*pp+9*fp*n)))/Math.PI+.5),y:1-.5*(i*(hp+dp*n+r*(pp+fp*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=i*i,r=n*n*n;for(let e,o,s,a=0;a<12&&(o=i*(hp+dp*n+r*(pp+fp*n))-t,s=hp+3*dp*n+r*(7*pp+9*fp*n),e=o/s,i=f(i-e,-Math.PI/3,Math.PI/3),n=i*i,r=n*n*n,!(Math.abs(e)<1e-12));++a);const o=mp*e*(hp+3*dp*n+r*(7*pp+9*fp*n))/Math.cos(i),s=Math.asin(Math.sin(i)/mp),a=f(180*o/Math.PI,-180,180),l=f(180*s/Math.PI,-85.051129,Da);return new ka(a,l)}}class yp extends cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),n=f(360*(.5-t),-85.051129,Da);return new ka(i,n)}}const _p=Math.PI/2;function vp(e){return Math.tan((_p+e)/2)}class xp extends cp{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30],n=l(t),r=l(i),o=Math.cos(n);this.n=n===r?Math.sin(n):Math.log(o/Math.cos(r))/Math.log(vp(r)/vp(n)),this.f=o*Math.pow(vp(n),this.n)/this.n}project(e,t){t=l(t),e=l(e-this.center[0]);const i=1e-6,{n:n,f:r}=this;r>0?t<-_p+i&&(t=-_p+i):t>_p-i&&(t=_p-i);const o=r/Math.pow(vp(t),n),s=o*Math.sin(n*e),a=r-o*Math.cos(n*e);return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:i,f:n}=this,r=n-t,o=Math.sign(r),s=Math.sign(i)*Math.sqrt(e*e+r*r);let a=Math.atan2(e,Math.abs(r))*o;r*i<0&&(a-=Math.PI*Math.sign(e)*o);const l=f(c(a/i)+this.center[0],-180,180),u=f(c(2*Math.atan(Math.pow(n/s,1/i))-_p),-85.051129,Da);return new ka(l,u)}}class bp extends cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:Ea(e),y:Ma(t),z:0}}unproject(e,t){const i=za(e),n=Ia(t);return new ka(i,n)}}const wp=l(Da);class Tp extends cp{project(e,t){const i=(t=l(t))*t,n=i*i;return{x:.5*((e=l(e))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,n=25,r=0,o=i*i;do{o=i*i;const e=o*o;r=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=f(i-r,-wp,wp)}while(Math.abs(r)>1e-6&&--n>0);o=i*i;const s=f(c(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=c(i);return new ka(s,a)}}const kp=l(Da);class Sp extends cp{project(e,t){t=l(t),e=l(e);const i=Math.cos(t),n=2/Math.PI,r=Math.acos(i*Math.cos(e/2)),o=Math.sin(r)/r,s=.5*(e*n+2*i*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,r=25;const o=1e-6;let s=0,a=0;do{const r=Math.cos(n),o=Math.sin(n),l=2*o*r,c=o*o,u=r*r,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,m=d*d,g=1-u*h*h,y=g?1/g:0,_=g?Math.acos(r*h)*Math.sqrt(1/g):0,v=.5*(2*_*r*d+2*i/Math.PI)-e,x=.5*(_*o+n)-t,b=.5*y*(u*m+_*r*h*c)+1/Math.PI,w=y*(p*l/4-_*o*d),T=.125*y*(l*d-_*o*u*p),k=.5*y*(c*h+_*m*r)+.5,S=w*T-k*b;s=(x*w-v*k)/S,a=(v*T-x*b)/S,i=f(i-s,-Math.PI,Math.PI),n=f(n-a,-kp,kp)}while((Math.abs(s)>o||Math.abs(a)>o)&&--r>0);return new ka(c(i),c(n))}}class Cp extends cp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(l(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:n}=this;return{x:l(e)*n*i+.5,y:-Math.sin(l(t))/n*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:n}=this,r=-(t-.5)/i,o=f(c((e-.5)/i)/n,-180,180),s=Math.asin(f(r*n,-1,1)),a=f(c(s),-85.051129,Da);return new ka(o,a)}}class Ep extends bp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,i){const n=Math.pow(2,i.z),r=(e/ba+i.x)/n,o=Xd(Ia((t/ba+i.y)/n),za(r));return Rl(o,o,Jd(qd(i))),{x:o[0],y:o[1],z:o[2]}}locationPoint(e,t){const i=Xd(t.lat,t.lng),n=Dl([],i),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Ll(i,i,n,Aa(1,0)*ba*o);const s=fl(new Float64Array(16));return ml(s,e.pixelMatrix,e.globeMatrix),Rl(i,i,s),new r(i[0],i[1])}pixelsPerMeter(e,t){return Aa(1,0)*t}pixelSpaceConversion(e,t,i){const n=yi(Aa(1,45)*t,Aa(1,e)*t,i);return this.pixelsPerMeter(e,t)/n}createTileMatrix(e,t,i){const n=Qd(qd(i.canonical));return ml(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:i}=e,n=fl(new Float64Array(16));return ml(n,n,Jd(qd(t))),vl(n,n,l(i.lng)),_l(n,n,l(i.lat)),yl(n,n,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(n)}pointCoordinate(e,t,i,n){return Ud(e,t,i,!0)||new Pa(0,0)}pointCoordinate3D(e,t,i){const n=this.pointCoordinate(e,t,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Ud(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const i=e.cameraToCenterDistance,n=e._centerAltitude*t,r=e._camera,o=e._camera.forward(),s=Cl([],Il([],o,-i),[0,0,n]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=Il([],r.up(),u),d=Il([],r.right(),u*c),p=Dl([],Cl([],Cl([],o,h),d)),f=[];let m;if(new Zl(s,p).closestPointOnSphere(l,a,f)){const t=Cl([],f,l),i=$l([],t,s);m=Math.cos(e.fovAboveCenter)*kl(i)}else{const e=$l([],s,l),t=$l([],l,s);Dl(t,t);const i=kl(e)-a;m=Math.sqrt(i*(i+2*a));const n=Math.acos(m/(a+i))-Math.acos(Pl(o,t));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=tp(e.zoom);if(i>0){const n=sp(e,Aa(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return yi(t,n+r*(1-Math.cos(o)),Math.pow(i,10))}return t}upVector(e,t,i){const n=1<<e.z,r=(t/ba+e.x)/n;return Xd(Ia((i/ba+e.y)/n),za(r),1)}upVectorScale(e){return{metersToTile:Bd*Yd(qd(e))}}}function Mp(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new bp(e);case"equirectangular":return new yp(e);case"naturalEarth":return new Tp(e);case"equalEarth":return new gp(e);case"winkelTripel":return new Sp(e);case"albers":return i?new Cp(e):new up(e);case"lambertConformalConic":return i?new Cp(e):new xp(e);case"globe":return new Ep(e)}throw new Error(`Invalid projection name: ${e.name}`)}const Ap=hu.VectorTileFeature.types,zp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ip(e,t,i,n,r,o,s,a,l,c,u,h,d){const p=a?Math.min(Cd,Math.round(a[0])):0,f=a?Math.min(Cd,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*n),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Lp(e,t,i,n,r,o,s){e.emplaceBack(t,i,n,r,o,s)}function Dp(e,t,i,n,r){e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r),e.emplaceBack(t,i,n,r)}function Pp(e){for(const t of e.sections)if(_o(t.text))return!0;return!1}class Op{constructor(e){this.layoutVertexArray=new ss,this.indexArray=new fs,this.programConfigurations=e,this.segments=new xa,this.dynamicLayoutVertexArray=new is,this.opacityVertexArray=new ls,this.placedSymbolArray=new As,this.globeExtVertexArray=new as}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qu.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,zp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gu.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ir(Op,"SymbolBuffers");class Rp{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new xa,this.collisionVertexArray=new ds,this.collisionVertexArrayExt=new ps}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wu.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ir(Rp,"CollisionBuffers");class Bp{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fl([]),this.placementViewportMatrix=fl([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ju(this.zoom,t["text-size"]),this.iconSizeData=Ju(this.zoom,t["icon-size"]);const i=this.layers[0].layout,n=i.get("symbol-sort-key"),r=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Ph[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Op(new ua(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Op(new ua(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ls,this.lineVertexArray=new Ds,this.symbolInstances=new Is}calculateGlyphDependencies(e,t,i,n,r){for(let i=0;i<e.length;i++)if(t[e.charCodeAt(i)]=!0,n&&r){const n=nh[e.charAt(i)];n&&(t[n.charCodeAt(0)]=!0)}}populate(e,t,i,n){const r=this.layers[0],o=r.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof xt&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new Io(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:y}of e){const e=r._featureFilter.needGeometry,_=Va(t,e);if(!r._featureFilter.filter(g,_,i))continue;if(e||(_.geometry=Ua(t,i,n)),s&&1!==t.type&&i.z<=5){const e=_.geometry,t=1<<i.z,n=i.x,r=i.y,o=.98078528056;for(let i=0;i<e.length;i++)e[i]=Fa(e[i],(e=>e),((e,i)=>Pl(Xd(Ia((e.y/ba+r)/t),za((e.x/ba+n)/t),1),Xd(Ia((i.y/ba+r)/t),za((i.x/ba+n)/t),1))<o))}let v,x;if(u){const e=r.getValueAndResolveTokens("text-field",_,i,m),t=xt.factory(e);Pp(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mo()||this.hasRTLText&&zo.isParsed())&&(v=ih(t,r,_))}if(h){const e=r.getValueAndResolveTokens("icon-image",_,i,m);x=e instanceof bt?e:bt.fromString(e)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?d.evaluate(_,{},i):void 0;if(this.features.push({id:l,text:v,icon:x,index:c,sourceLayerIndex:y,geometry:_.geometry,properties:t.properties,type:Ap[t.type],sortKey:b}),x&&(p[x.name]=!0),v){const e=a.evaluate(_,{},i).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ph.vertical)>=0;for(const i of v.sections)if(i.image)p[i.image.name]=!0;else{const n=uo(v.toString()),r=i.fontStack||e,o=f[r]=f[r]||{};this.calculateGlyphDependencies(i.text,o,t,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},n=[];let r=0;function o(t){n.push(e[t]),r++}function s(e,t,r){const o=i[e];return delete i[e],i[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(r[0]),o}function a(e,i,r){const o=t[i];return delete t[i],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=r[0].concat(n[o].geometry[0]),o}function l(e,t,i){const n=i?t[0][t[0].length-1]:t[0][0];return`${e}:${n.x}:${n.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),r=s(p,f,n[e].geometry);delete t[p],delete i[f],i[l(d,n[r].geometry,!0)]=r,n[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,i[f]=r-1)}return n.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Mp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length,n=e.segment;if(void 0!==n){let i=e.dist(t[n+1]),r=e.dist(t[n]);const o={};for(let e=n+1;e<t.length;e++)o[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:i},e<t.length-1&&(i+=t[e+1].dist(t[e]));for(let e=n||0;e>=0;e--)o[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:r},e>0&&(r+=t[e-1].dist(t[e]));for(let e=0;e<t.length;e++){const t=o[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,n,r,o,s,a,l,c,u,h,d,p){const f=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,y=e.segments.prepareSegment(4*t.length,m,f,this.canOverlap?o.sortKey:void 0),_=this.glyphOffsetArray.length,v=y.vertexLength,x=this.allowVerticalPlacement&&s===Ph.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let n=0;n<t.length;n++){const{tl:r,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:_,pixelOffsetBR:v,minFontScaleX:w,minFontScaleY:T,glyphOffset:k,isSDF:S,sectionIndex:C}=t[n],E=y.vertexLength,M=k[1];if(Ip(m,l.x,l.y,r.x,M+r.y,h.x,h.y,i,S,_.x,_.y,w,T),Ip(m,l.x,l.y,s.x,M+s.y,h.x+h.w,h.y,i,S,v.x,_.y,w,T),Ip(m,l.x,l.y,c.x,M+c.y,h.x,h.y+h.h,i,S,_.x,v.y,w,T),Ip(m,l.x,l.y,u.x,M+u.y,h.x+h.w,h.y+h.h,i,S,v.x,v.y,w,T),a){const t=a.anchor,i=a.up;Lp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Lp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Lp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Lp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Dp(e.dynamicLayoutVertexArray,t.x,t.y,t.z,x)}else Dp(e.dynamicLayoutVertexArray,l.x,l.y,l.z,x);f.emplaceBack(E,E+1,E+2),f.emplaceBack(E+1,E+2,E+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),n!==t.length-1&&C===t[n+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,o,o.index,{},d,p,b&&b[C])}const w=a?a.anchor:l;e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,_,this.glyphOffsetArray.length-_,v,c,u,l.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,n,r,o,s){e.emplaceBack(t,i,n,r,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,i,n,o,s,a){const l=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),c=l.vertexLength,u=a.tileAnchorX,h=a.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,o,s,u,h,new r(e.x1,e.y2)),l.vertexLength+=4;const d=i.indexArray;d.emplaceBack(c,c+1),d.emplaceBack(c+1,c+2),d.emplaceBack(c+2,c+3),d.emplaceBack(c+3,c),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(n,r,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceIconSize(e,t,s);this._addCollisionDebugVertices(n,r,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rp(us,Zu.members,bs),this.iconCollisionBox=new Rp(us,Zu.members,bs);const i=eh(this.iconSizeData,e),n=eh(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,n){const r=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),o=Qu(this.textSizeData,e,r)/Ku;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,i){const n=this.icon.placedSymbolArray.get(i),r=Qu(this.iconSizeData,e,n);return this.tilePixelRatio*r}_commitDebugCollisionVertexUpdate(e,t,i){e.emplaceBack(t,-i,-i),e.emplaceBack(t,i,-i),e.emplaceBack(t,i,i),e.emplaceBack(t,-i,i)}_updateTextDebugCollisionBoxes(e,t,i,n,r,o){for(let s=n;s<r;s++){const n=i.get(s),r=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,r,n.padding)}}_updateIconDebugCollisionBoxes(e,t,i,n,r){for(let o=n;o<r;o++){const n=i.get(o),r=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,r,n.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=eh(this.iconSizeData,e),n=eh(this.textSizeData,e);for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this._updateTextDebugCollisionBoxes(n,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(n,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,n,r,o,s,a,l){const c={};for(let n=t;n<i;n++){const t=e.get(n);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,projectedAnchorX:t.projectedAnchorX,projectedAnchorY:t.projectedAnchorY,projectedAnchorZ:t.projectedAnchorZ,tileAnchorX:t.tileAnchorX,tileAnchorY:t.tileAnchorY},c.textFeatureIndex=t.featureIndex;break}for(let t=n;t<r;t++){const i=e.get(t);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let t=o;t<s;t++){const i=e.get(t);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.iconFeatureIndex=i.featureIndex;break}for(let t=a;t<l;t++){const i=e.get(t);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),n=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<n;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),n=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);n.push(0|Math.round(t*s.tileAnchorX+i*s.tileAnchorY)),r.push(s.featureIndex)}return o.sort(((e,t)=>n[e]-n[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,i)=>{e>=0&&i.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ir(Bp,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bp.MAX_GLYPHS=65535,Bp.addDynamicAttributes=Dp;const Fp=new qo({"symbol-placement":new jo(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new jo(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jo(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new No(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jo(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new jo(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jo(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new jo(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jo(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new No(Ge.layout_symbol["icon-size"]),"icon-text-fit":new jo(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new jo(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new No(Ge.layout_symbol["icon-image"]),"icon-rotate":new No(Ge.layout_symbol["icon-rotate"]),"icon-padding":new jo(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new jo(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new No(Ge.layout_symbol["icon-offset"]),"icon-anchor":new No(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jo(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jo(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jo(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new No(Ge.layout_symbol["text-field"]),"text-font":new No(Ge.layout_symbol["text-font"]),"text-size":new No(Ge.layout_symbol["text-size"]),"text-max-width":new No(Ge.layout_symbol["text-max-width"]),"text-line-height":new No(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new No(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new No(Ge.layout_symbol["text-justify"]),"text-radial-offset":new No(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jo(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new No(Ge.layout_symbol["text-anchor"]),"text-max-angle":new jo(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new jo(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new No(Ge.layout_symbol["text-rotate"]),"text-padding":new jo(Ge.layout_symbol["text-padding"]),"text-keep-upright":new jo(Ge.layout_symbol["text-keep-upright"]),"text-transform":new No(Ge.layout_symbol["text-transform"]),"text-offset":new No(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new jo(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jo(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new jo(Ge.layout_symbol["text-optional"])});var $p={paint:new qo({"icon-opacity":new No(Ge.paint_symbol["icon-opacity"]),"icon-color":new No(Ge.paint_symbol["icon-color"]),"icon-halo-color":new No(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new No(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new No(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new jo(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new jo(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new No(Ge.paint_symbol["text-opacity"]),"text-color":new No(Ge.paint_symbol["text-color"],{runtimeType:it,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new No(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new No(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new No(Ge.paint_symbol["text-halo-blur"]),"text-translate":new jo(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new jo(Ge.paint_symbol["text-translate-anchor"])}),layout:Fp};class jp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Je,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ir(jp,"FormatSectionOverride",{omit:["defaultValue"]});class Np extends ya{constructor(e){super(e,$p)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,n){const r=this.layout.get(e).evaluate(t,{},i,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Pn(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,r)}createBucket(e){return new Bp(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of $p.paint.overridableProperties){if(!Np.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new jp(t),n=new Dn(i,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new Rn("source",n):new Bn("composite",n,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Fo(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&Np.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),n=$p.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(r=!0)};if("constant"===i.value.kind&&i.value.value instanceof xt)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{r||(t instanceof Et&&kt(t.value)===st?o(t.value.sections):t instanceof Lt?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return r}getProgramConfiguration(e){return new ca(this,e)}}var Up={paint:new qo({"background-color":new jo(Ge.paint_background["background-color"]),"background-pattern":new Vo(Ge.paint_background["background-pattern"]),"background-opacity":new jo(Ge.paint_background["background-opacity"])})},Vp={paint:new qo({"raster-opacity":new jo(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new jo(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jo(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jo(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new jo(Ge.paint_raster["raster-saturation"]),"raster-contrast":new jo(Ge.paint_raster["raster-contrast"]),"raster-resampling":new jo(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new jo(Ge.paint_raster["raster-fade-duration"])})};class Gp extends ya{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var qp={paint:new qo({"sky-type":new jo(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new jo(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jo(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jo(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jo(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Go(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jo(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jo(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jo(Ge.paint_sky["sky-opacity"])})};function Wp(e,t,i){const n=[0,0,1],r=ql([]);return Hl(r,r,i?-l(e)+Math.PI:l(e)),Wl(r,r,-l(t)),Bl(n,n,r),Dl(n,n)}const Hp={circle:class extends ya{constructor(e){super(e,ul)}createBucket(e){return new Wa(e)}queryRadius(e){const t=e;return ol("circle-radius",this,t)+ol("circle-stroke-width",this,t)+sl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,n,r,o,s,a){const l=ll(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Jl(e,n,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new ca(this,e)}},heatmap:class extends ya{createBucket(e){return new nc(e)}constructor(e){super(e,cc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return ol("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,n,o,s,a,l){const c=this.paint.get("heatmap-radius").evaluate(t,i);return Jl(e,n,s,a,l,!0,!0,new r(0,0),c)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new ca(this,e)}},hillshade:class extends ya{constructor(e){super(e,hc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ya{constructor(e){super(e,Jc)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new ca(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Kc(e)}queryRadius(){return sl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,n,r,o){return!e.queryGeometry.isAboveHorizon&&Xa(al(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends ya{constructor(e){super(e,wu)}createBucket(e){return new _u(e)}queryRadius(){return sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new ca(this,e)}queryIntersectsFeature(e,t,i,n,o,s,a,l,c){const u=ll(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,i),d=this.paint.get("fill-extrusion-base").evaluate(t,i),p=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=e.tile.getBucket(this);if(f&&g instanceof _u){const e=g.centroidVertexArray,t=c+1;if(t<e.length){const i=e.get(t);p[0]=i.a_centroid_pos0,p[1]=i.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;"globe"===s.projection.name&&(n=bu([n],[new r(0,0),new r(ba,ba)],e.tileID.canonical).map((e=>e.polygon)).flat());const y=function(e,t,i,n,o,s,a,l,c,u,h){return"globe"===e.projection.name?function(e,t,i,n,r,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,i,n)=>{e[0]=t,e[1]=i,e[2]=n,e[3]=1},y=xu();i>0&&(i+=y),n+=y;for(const y of t){const t=[],_=[];for(const h of y){const d=h.x+r.x,y=h.y+r.y,v=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=i,w=n;if(s){const e=Iu(d,y,i,n,s,a,l,c);b+=e.base,w+=e.top}0!==i?g(f,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),Rl(f,f,o),Rl(m,m,o),t.push(zu(f)),_.push(zu(m))}h.push(t),d.push(_)}return[h,d]}(e,t,i,n,o,s,a,l,c,u,h):a?function(e,t,i,n,r,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+n.x,d=c.y+n.y,f=Iu(u,d,t,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Vl(h,h,r),h[3]=Math.max(h[3],1e-5);const m=zu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Vl(h,h,r),h[3]=Math.max(h[3],1e-5);const g=zu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,i,n,o,s,a,l,c,u):function(e,t,i,n,o){const s=[],a=[],l=o[8]*t,c=o[9]*t,u=o[10]*t,h=o[11]*t,d=o[8]*i,p=o[9]*i,f=o[10]*i,m=o[11]*i;for(const t of e){const e=[],i=[];for(const s of t){const t=s.x+n.x,a=s.y+n.y,g=o[0]*t+o[4]*a+o[12],y=o[1]*t+o[5]*a+o[13],_=o[2]*t+o[6]*a+o[14],v=o[3]*t+o[7]*a+o[15],x=g+l,b=y+c,w=_+u,T=Math.max(v+h,1e-5),k=g+d,S=y+p,C=_+f,E=Math.max(v+m,1e-5),M=new r(x/T,b/T);M.z=w/T,e.push(M);const A=new r(k/E,S/E);A.z=C/E,i.push(A)}s.push(e),a.push(i)}return[s,a]}(t,i,n,o,s)}(s,n,d,h,u,a,f?l:null,p,m,s.center.lat,e.tileID.canonical),_=e.queryGeometry;return function(e,t,i){let n=1/0;Xa(i,t)&&(n=Au(i,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Ha(i,r)&&(n=Math.min(n,Au(i,r)))}}return n!==1/0&&n}(y[0],y[1],_.isPointQuery()?_.screenBounds:_.screenGeometry)}},line:class extends ya{constructor(e){super(e,ju),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Nu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Fu(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new ca(this,e)}queryRadius(e){const t=e,i=Uu(ol("line-width",this,t),ol("line-gap-width",this,t)),n=ol("line-offset",this,t);return i/2+Math.abs(n)+sl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,n,o,s){if(e.queryGeometry.isAboveHorizon)return!1;const a=al(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*Uu(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(n=function(e,t){const i=[],n=new r(0,0);for(let r=0;r<e.length;r++){const o=e[r],s=[];for(let e=0;e<o.length;e++){const i=o[e-1],r=o[e],a=o[e+1],l=0===e?n:r.sub(i)._unit()._perp(),c=e===o.length-1?n:a.sub(r)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),s.push(u._mult(t)._add(r))}i.push(s)}return i}(n,c*e.pixelToTileUnitsFactor)),function(e,t,i){for(let n=0;n<t.length;n++){const r=t[n];if(e.length>=3)for(let t=0;t<r.length;t++)if(il(e,r[t]))return!0;if(Ka(e,r,i))return!0}return!1}(a,n,l)}isTileClipped(){return!0}},symbol:Np,background:class extends ya{constructor(e){super(e,Up)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ya{constructor(e){super(e,Vp)}getProgramIds(){return["raster"]}},sky:class extends ya{constructor(e){super(e,qp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,r=e.style.light,o=r.properties.get("position");return n&&"viewport"===r.properties.get("anchor")&&I("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Wp(o.azimuthal,90-o.polar,t):Wp(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return Wp(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class Zp{constructor(e,t,i,n){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,i,n){const{width:r,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||!1!==i.premultiply)),n||this.size&&this.size[0]===r&&this.size[1]===o){const{x:t,y:i}=n||{x:0,y:0};e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texSubImage2D(a.TEXTURE_2D,0,t,i,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,i,r,o,a.RGBA,a.UNSIGNED_BYTE,e.data)}else this.size=[r,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,r,o,0,this.format,a.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Xp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new ac({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=T(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const n=[];let r=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;n.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];r=a*i,a+=l,o=a*i,n.push({left:r,right:o,isDash:s,zeroLength:0===l})}return n}addRoundDash(e,t,i){const n=t/2;for(let t=-i;t<=i;t++){const r=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(n+1);if(s.isDash){const e=n-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=n-Math.sqrt(u*u+d*d);this.image.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],n=e[t+1];i.zeroLength?e.splice(t,1):n&&n.isDash===i.isDash&&(n.left=i.left,e.splice(t,1))}const i=e[0],n=e[e.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const r=this.width*this.nextRow;let o=0,s=e[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=e[++o]);const n=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(n,a);this.image.data[r+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const n="round"===t,r=n?7:0,o=2*r+1;if(this.nextRow+o>this.height)return I("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(I("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const i=this.width/s,o=this.getDashRanges(e,this.width,i);n?this.addRoundDash(o,i,r):this.addRegularDash(o,"square"===t?.5*i:0)}const a=this.nextRow+r;this.nextRow+=o;const l={tl:[a,r],br:[s,0]};return this.positions[i]=l,l}}Ir(Xp,"LineAtlas");class Kp{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Yp{constructor(){this.tasks={},this.taskQueue=[],S(["process"],this),this.invoker=new Kp(this.process),this.nextId=0}add(e,t){const i=this.nextId++,n=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===n){P();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:t,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){P();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<t&&(t=n.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Jp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Qp=["tile","layer","source","sourceLayer","state"];class ef{constructor(e,t,i,n,r){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=n,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Qp)void 0!==this[t]&&(e[t]=this[t]);return e}}const tf=32,nf=33,rf=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,n=0,r=0,o=0,s=0,a=0;for(1&t?r=o=s=tf:i=n=a=tf;(t>>=1)>1;){const e=i+r>>1,l=n+o>>1;1&t?(r=i,o=n,i=s,n=a):(i=r,n=o,r=s,o=a),s=e,a=l}const l=4*e;rf[l+0]=i,rf[l+1]=n,rf[l+2]=r,rf[l+3]=o}const of=new Uint16Array(2178),sf=new Uint8Array(1089),af=new Uint16Array(1089);function lf(e){return 0===e?-.03125:32===e?.03125:0}var cf=Ko([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const uf={type:2,extent:ba,loadGeometry:()=>[[new r(0,0),new r(8193,0),new r(8193,8193),new r(0,8193),new r(0,0)]]};class hf{constructor(e,t,i,n,r){this.tileID=e,this.uid=b(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=r,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<H.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ap(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const n of e){const e=n.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=n}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Bp){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Bp&&t.hasRTLText){this.hasRTLText=!0,zo.isLoading()||zo.isLoaded()||"deferred"!==Mo()||Ao();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(i))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Es}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Zp(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zp(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Zp(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,n,r,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:s,transform:o,params:r,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),r=t?t.sourceLayer:"",o=n._geojsonTileLayer||n[r];if(!o)return;const s=Kn(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let t=0;t<o.length;t++){const n=o.feature(t);if(s.needGeometry){const e=Va(n,!0);if(!s.filter(new Io(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new Io(this.tileID.overscaledZ),n))continue;const h=i.getId(n,r),d=new ef(n,a,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=O(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const n=this.expirationTime-t;n?this.expirationTime=e+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const i=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const o=this.buckets[r],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=i[s],l=e[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Fu||o instanceof Kc){const e=t.style._getSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(r);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<H.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=H.now()+e}setTexture(e,t){const i=t.context,n=i.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Zp(i,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),i.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0],n=new Jo,r=new ws;for(let e=0;e<i.length;e++){const{x:t,y:o}=i[e];n.emplaceBack(t,o),r.emplaceBack(e)}r.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(n,Od.members),this._tileDebugSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0];let n,r;if(this.isRaster){const e=function(e,t){const i=ap(e,t),n=Math.pow(2,e.z);for(let r=0;r<nf;r++)for(let o=0;o<nf;o++){const s=za((e.x+(o+lf(o))/tf)/n),a=Ia((e.y+(r+lf(r))/tf)/n),l=t.project(s,a),c=r*nf+o;of[2*c+0]=Math.round((l.x*i.scale-i.x)*ba),of[2*c+1]=Math.round((l.y*i.scale-i.y)*ba)}sf.fill(0),af.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=rf[t+0],n=rf[t+1],r=rf[t+2],o=rf[t+3],s=i+r>>1,a=n+o>>1,l=s+a-n,c=a+i-s,u=n*nf+i,h=o*nf+r,d=a*nf+s,p=Math.hypot((of[2*u+0]+of[2*h+0])/2-of[2*d+0],(of[2*u+1]+of[2*h+1])/2-of[2*d+1])>=16;if(sf[d]=sf[d]||(p?1:0),e<1022){const e=(n+c>>1)*nf+(i+l>>1),t=(o+c>>1)*nf+(r+l>>1);sf[d]=sf[d]||sf[e]||sf[t]}}const r=new es,o=new fs;let s=0;function a(e,t){const i=t*nf+e;return 0===af[i]&&(r.emplaceBack(of[2*i+0],of[2*i+1],e*ba/tf,t*ba/tf),af[i]=++s),af[i]-1}function l(e,t,i,n,r,s){const c=e+i>>1,u=t+n>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&sf[u*nf+c])l(r,s,e,t,c,u),l(i,n,r,s,c,u);else{const l=a(e,t),c=a(i,n),u=a(r,s);o.emplaceBack(l,c,u)}}return l(0,0,tf,tf,tf,0),l(tf,tf,0,0,0,tf),{vertices:r,indices:o}}(this.tileID.canonical,t);n=e.vertices,r=e.indices}else{n=new es,r=new fs;for(const{x:e,y:t}of i)n.emplaceBack(e,t,0,0);const e=fc(n.int16,void 0,4);for(let t=0;t<e.length;t+=3)r.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(n,cf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(r),this._tileBoundsSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugBuffers(e,t){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!t||"globe"!==t.name)return;const i=this.tileID.canonical,n=Jd(qd(i));this._makeGlobeTileDebugBorderBuffer(e,i,n),this._makeGlobeTileDebugTextBuffer(e,i,n)}_makeGlobeTileDebugBorderBuffer(e,t,i){const n=new Jo,r=new ws,o=new Qo,s=(e,s,a,l,c)=>{const u=(a-e)/(c-1),h=(l-s)/(c-1),d=n.length;for(let a=0;a<c;a++){const l=e+a*u,c=s+a*h;n.emplaceBack(l,c);const p=Kd(l,c,t),f=Rl(p,p,i);o.emplaceBack(f[0],f[1],f[2]),r.emplaceBack(d+a)}},a=ba;s(0,0,a,0,16),s(a,0,a,a,16),s(a,a,0,a,16),s(0,a,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(r),this._tileDebugBuffer=e.createVertexBuffer(n,Od.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(o,Pd.members),this._tileDebugSegments=xa.simpleSegment(0,0,n.length,r.length)}_makeGlobeTileDebugTextBuffer(e,t,i){const n=new Jo,r=new fs,o=new Qo,s=25;r.reserve(32),n.reserve(s),o.reserve(s);const a=(e,t)=>s*e+t;for(let e=0;e<s;e++){const r=2048*e;for(let e=0;e<s;e++){const s=2048*e;n.emplaceBack(s,r);const a=Kd(s,r,t),l=Rl(a,a,i);o.emplaceBack(l[0],l[1],l[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=a(e,t),n=a(e,t+1),o=a(e+1,t),s=a(e+1,t+1);r.emplaceBack(i,n,o),r.emplaceBack(o,n,s)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(r),this._tileDebugTextBuffer=e.createVertexBuffer(n,Od.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(o,Pd.members),this._tileDebugTextSegments=xa.simpleSegment(0,0,s,32)}}class df{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},v(this.stateChanges[e][n],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])i[t]||(this.deletedStates[e][n][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(i in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][i]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),n=v({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),v(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const i in this.state[e])t[i]={},this.state[e][i]={};else for(const i in this.deletedStates[e]){if(null===this.deletedStates[e][i])this.state[e][i]={};else for(const t of Object.keys(this.deletedStates[e][i]))delete this.state[e][i][t];t[i]=this.state[e][i]}i[e]=i[e]||{},v(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in e)e[n].setFeatureState(i,t)}}class pf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function ff(e,t,i,n){let r=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(n[s])<1e-15){if(i[s]<e[s]||i[s]>t[s])return null}else{const a=1/n[s];let l=(e[s]-i[s])*a,c=(t[s]-i[s])*a;if(l>c){const e=l;l=c,c=e}if(l>r&&(r=l),c<o&&(o=c),r>o)return null}return r}function mf(e,t,i,n,r,o,s,a,l,c,u){const h=n-e,d=r-t,p=o-i,f=s-e,m=a-t,g=l-i,y=u[1]*g-u[2]*m,_=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*y+d*_+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,T=c[1]-t,k=c[2]-i,S=(w*y+T*_+k*v)*b;if(S<0||S>1)return null;const C=T*p-k*d,E=k*h-w*p,M=w*d-T*h,A=(u[0]*C+u[1]*E+u[2]*M)*b;return A<0||S+A>1?null:(f*C+m*E+g*M)*b}function gf(e,t,i){return(e-t)/(i-t)}function yf(e,t,i,n,r,o,s,a,l){const c=1<<i,u=o-n,h=s-r,d=(e+1)/c*u+n,p=(t+0)/c*h+r,f=(t+1)/c*h+r;a[0]=(e+0)/c*u+n,a[1]=p,l[0]=d,l[1]=f}class _f{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let n=Math.ceil(Math.pow(2,t));const r=1/n,o=(e,t,i,n,r)=>{const o=n?1:0,s=(e+1)*i-o,a=t*i,l=(t+1)*i-o;r[0]=e*i,r[1]=a,r[2]=s,r[3]=l};let s=new pf(n);const a=[];for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),r,!1,a);const i=xf(a[0],a[1],e),l=xf(a[2],a[1],e),c=xf(a[2],a[3],e),u=xf(a[0],a[3],e);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),n/=2;n>=1;n/=2){const e=i[i.length-1];s=new pf(n);for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),2,!0,a);const i=e.getElevation(a[0],a[1]),r=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(i.min,r.min,l.min,c.min),m=Math.max(i.max,r.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=t.length-1,n=t[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,n,r,o,s=1){return ff([e,t,-100],[i,n,this.maximums[0]*s],r,o)}raycast(e,t,i,n,r,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,i,n,r,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){yf(f,m,g,e,t,i,n,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,y=(m+1)/a,_=xf(l,d,this.dem)*s,v=xf(c,d,this.dem)*s,x=xf(c,y,this.dem)*s,b=xf(l,y,this.dem)*s,w=mf(u[0],u[1],_,h[0],u[1],v,h[0],h[1],x,r,o),T=mf(h[0],h[1],x,u[0],h[1],b,u[0],u[1],_,r,o),k=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(k!==Number.MAX_VALUE)return k;{const e=Ll([],r,o,p);if(vf(_,v,b,x,gf(e[0],u[0],h[0]),gf(e[1],u[1],h[1]))>=e[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){yf((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,i,n,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=ff(u,h,r,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<y&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[y]=d),y++}}for(let e=0;e<y;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,n,r){if(1===e[n].isLeaf(t,i))return;this.childOffsets[r]||(this.childOffsets[r]=this.nodeCount);const o=n-1,s=e[o];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const n=2*t+this._siblingOffset[e][0],r=2*i+this._siblingOffset[e][1],o=s.getElevation(n,r),c=s.isLeaf(n,r),u=this._addNode(o.min,o.max,c);c&&(a|=1<<e),l||(l=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(e,2*t+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],o,l+n)}}function vf(e,t,i,n,r,o){return yi(yi(e,i,o),yi(t,n,o),r)}function xf(e,t,i){const n=i.dim,r=f(e*n-.5,0,n-1),o=f(t*n-.5,0,n-1),s=Math.floor(r),a=Math.floor(o),l=Math.min(s+1,n-1),c=Math.min(a+1,n-1);return vf(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),r-s,o-a)}const bf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,n=!1,r=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return I(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=i||"mapbox",this.borderReady=n,!n){for(let e=0;e<o;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(o,e)]=s[this._idx(o-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,o)]=s[this._idx(e,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],r&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new _f(this)}get(e,t,i=!1){i&&(e=f(e,-1,this.dim),t=f(t,-1,this.dim));const n=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}static getUnpackVector(e){return bf[e]}get unpackVector(){return bf[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,i){return(256*e*256+256*t+i)/10-1e4}_unpackTerrarium(e,t,i){return 256*e+t+i/256-32768}static pack(e,t){const i=[0,0,0,0],n=wf.getUnpackVector(t);let r=Math.floor((e+n[3])/n[2]);return i[2]=r%256,r=Math.floor(r/256),i[1]=r%256,r=Math.floor(r/256),i[0]=r,i}getPixels(){return new lc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,r=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:n=r-1;break;case 1:r=n+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=n;i<r;i++){const n=4*this._idx(i,t),r=4*this._idx(i+a,t+l);this.pixels[n+0]=e.pixels[r+0],this.pixels[n+1]=e.pixels[r+1],this.pixels[n+2]=e.pixels[r+2],this.pixels[n+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ir(wf,"DEMData"),Ir(_f,"DemMinMaxQuadTree",{omit:["dem"]});class Tf{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),i)),this.data[n].push(r),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,n=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][n];return this.data[i].splice(n,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const n of this.data[i])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class kf{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}kf.ReadOnly=!1,kf.ReadWrite=!0,kf.disabled=new kf(519,kf.ReadOnly,[0,1]);const Sf=7680;class Cf{constructor(e,t,i,n,r,o){this.test=e,this.ref=t,this.mask=i,this.fail=n,this.depthFail=r,this.pass=o}}Cf.disabled=new Cf({func:519,mask:0},0,0,Sf,Sf,Sf);class Ef{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}Ef.Replace=[1,0],Ef.disabled=new Ef(Ef.Replace,yt.transparent,[!1,!1,!1,!1]),Ef.unblended=new Ef(Ef.Replace,yt.transparent,[!0,!0,!0,!0]),Ef.alphaBlended=new Ef([1,771],yt.transparent,[!0,!0,!0,!0]);const Mf=1029,Af=2305;class zf{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}zf.disabled=new zf(!1,Mf,Af),zf.backCCW=new zf(!0,Mf,Af),zf.backCW=new zf(!0,Mf,2304),zf.frontCW=new zf(!0,1028,2304),zf.frontCCW=new zf(!0,1028,Af);class If extends Ve{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Tf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new df,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const i=this._tiles[t];this._source.prepareTile(i)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,i.tileID),i.upload(e),i.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return _(this._tiles).map((e=>e.tileID)).sort(Lf).map((e=>e.key))}getRenderableIds(e){const t=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&t.push(this._tiles[i]);return e?t.sort(((e,t)=>{const i=e.tileID,n=t.tileID,o=new r(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new r(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(Lf).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new Ue(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=H.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ne("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,n),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,n){for(const r in this._tiles){let o=this._tiles[r];if(n[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){n[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,r=Math.floor(i*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let n;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Cu(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(n=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(n=n.filter((e=>this._source.hasTile(e))))):n=[];const r=this._updateRetainedTiles(n);if(Df(this._source.type)&&0!==n.length){const e={},t={},i=Object.keys(r);for(const n of i){const i=r[n],o=this._tiles[n];if(!o||o.fadeEndTime&&o.fadeEndTime<=H.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-If.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[n]=i}const o=n[n.length-1].overscaledZ;for(const e in this._tiles){const i=this._tiles[e];if(r[e]||!i.hasData())continue;let n=i.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&t[n.key]){r[e]=i.tileID;break}}}for(const t in e)r[t]||(this._coveredTiles[t]=!0,r[t]=e[t])}for(const e in r)this._tiles[e].clearFadeHold();const o=function(e,t){const i=[];for(const n in e)n in t||i.push(n);return i}(this._tiles,r);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},n=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,o=Math.max(r-If.maxOverzooming,this._source.minzoom),s=Math.max(r+If.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,s,t);for(const n of e){let e=this._tiles[n.key];if(e.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const e=n.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=n.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let s=n.overscaledZ-1;s>=o;--s){const o=n.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,e=this.getTile(o),!e&&r&&(e=this._addTile(o)),e&&(t[o.key]=o,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;n=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);if(!i){const i=this.map?this.map.painter:null;t=new hf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Ne("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,i){const n=[],r=this.transform;if(!r)return n;const o="globe"===r.projection.name,s=Ea(r.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(f(s,...Pf(e,-1))-s),Math.abs(f(s,...Pf(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(f(s,...Pf(e,-1))-s),Math.abs(f(s,...Pf(e,0))-s),Math.abs(f(s,...Pf(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const i of c){const o=e.containsTile(l,r,t,i);o&&n.push(o)}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Df(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=H.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const n=this._tiles[e];n&&n.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(e,t){const i=new Map,n=Array.isArray(e)?e:[e],r=this.map.painter.terrain,o=this.usedForTerrain&&r?r.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}y(Array.from(i.values()),((e,t)=>{const i=new hf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),t)}}function Lf(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Df(e){return"raster"===e||"image"===e||"video"===e}function Pf(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}If.maxOverzooming=10,If.maxUnderzooming=3;class Of{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const n=i||e.findDEMTileFor(t);if(!n||!n.dem)return;const r=n.dem,o=n.tileID,s=1<<t.canonical.z-o.canonical.z;return new Of(n,n.tileSize/ba/s,[(t.canonical.x/s-o.canonical.x)*r.dim,(t.canonical.y/s-o.canonical.y)*r.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),o=Math.floor(i);return new r(n,o)}getElevationAt(e,t,i,n){const r=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(r),a=Math.floor(o),l=this._dem;return n=!!n,i?yi(yi(l.get(s,a,n),l.get(s,a+1,n),o-a),yi(l.get(s+1,a,n),l.get(s+1,a+1,n),o-a),r-s):l.get(s,a,n)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Aa(1,e)*this._dem.stride}}class Rf{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Mr(ba,16,0),this.featureIndexArray=new Os,this.promoteId=t}insert(e,t,i,n,r,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,r,o);const a=this.grid;for(let e=0;e<t.length;e++){const i=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<ba&&n[1]<ba&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hu.VectorTile(new lh(this.rawTileData)).layers,this.sourceLayerCoder=new Jp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,n){this.loadVTLayers();const r=e.params||{},o=Kn(r.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,n)=>nl(s.bufferedTilespaceGeometry,e,t,i,n)));c.sort(Ff);let u=null;a.elevation&&c.length>0&&(u=Of.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,r.layers,r.availableImages,t,i,n,((t,i,n,r=0)=>(f||(f=Ua(t,this.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(s,t,n,f,this.z,e.transform,e.pixelPosMatrix,u,r))))}return h}loadMatchingFeature(e,t,i,n,r,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(n&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(n,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=Va(m,!0);if(!i.filter(new Io(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Io(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const i=p[t];if(n&&n.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=v({},s[i]);f.paint=Bf(f.paint,u.paint,m,h,r),f.layout=Bf(f.layout,u.layout,m,h,r);const y=!l||l(m,u,h,d);if(!y)continue;const _=new ef(m,this.z,this.x,this.y,g);_.layer=f;let x=e[i];void 0===x&&(x=e[i]=[]),x.push({featureIndex:c,feature:_,intersectionZ:y})}}lookupSymbolFeatures(e,t,i,n,r,o,s,a){const l={};this.loadVTLayers();const c=Kn(r);for(const r of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:n,featureIndex:r,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),r=this.vtFeatures[n];if(r[t])return r[t];const o=this.vtLayers[n].feature(t);return r[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i))),i}}function Bf(e,t,i,n,r){return E(e,((e,o)=>{const s=t instanceof $o?t.get(o):null;return s&&s.evaluate?s.evaluate(i,n,r):s}))}function Ff(e,t){return t-e}Ir(Rf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $f{constructor(e){const t={},i=[];for(const n in e){const r=e[n],o=t[n]={};for(const e in r.glyphs){const t=r.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n=t.metrics.localGlyph?2:1,s={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};i.push(s),o[e]=s}}const{w:n,h:r}=Ih(i),o=new ac({width:n||1,height:r||1});for(const i in e){const n=e[i];for(const e in n.glyphs){const r=n.glyphs[+e];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const s=t[i][e],a=r.metrics.localGlyph?2:1;ac.copy(r.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},r.bitmap)}}this.image=o,this.positions=t}}Ir($f,"GlyphAtlas");class jf{constructor(e){this.tileID=new Cu(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ap(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,i,n,r){this.status="parsing",this.data=e,this.collisionBoxArray=new Es;const o=new Jp(Object.keys(e.layers).sort()),s=new Rf(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Xp(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=t.familiesBySource[this.source];for(const t in u){const n=e.layers[t];if(!n)continue;let r=!1,l=!1;for(const e of u[t])"symbol"===e[0].type?r=!0:l=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!l)continue;1===n.version&&I(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(t),d=[];for(let e=0;e<n.length;e++){const i=n.feature(e),r=s.getId(i,t);d.push({feature:i,id:r,index:e,sourceLayerIndex:h})}for(const e of u[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Nf(e,this.zoom,i),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=E(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(g).length?n.send("getGlyphs",{uid:this.uid,stacks:g},((e,t)=>{h||(h=e,d=t,x.call(this))}),void 0,!1,m):d={};const y=Object.keys(c.iconDependencies);y.length?n.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,x.call(this))}),void 0,!1,m):p={};const v=Object.keys(c.patternDependencies);function x(){if(h)return r(h);if(d&&p&&f){const e=new $f(d),t=new Dh(p,f);for(const n in a){const r=a[n];r instanceof Bp?(Nf(r.layers,this.zoom,i),Td(r,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):r.hasPattern&&(r instanceof Fu||r instanceof Kc||r instanceof _u)&&(Nf(r.layers,this.zoom,i),r.addFeatures(c,this.tileID.canonical,t.patternPositions,i,this.tileTransform))}this.status="done",r(null,{buckets:_(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?n.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,x.call(this))}),void 0,!1,m):f={},x.call(this)}}function Nf(e,t,i){const n=new Io(t);for(const t of e)t.recalculate(n,i)}class Uf{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,n){const r=this.entries[e]=this.entries[e]||{callbacks:[]};if(r.result){const[e,i]=r.result;return this.scheduler?this.scheduler.add((()=>{n(e,i)}),t):n(e,i),()=>{}}return r.callbacks.push(n),r.cancel||(r.cancel=i(((i,n)=>{r.result=[i,n];for(const e of r.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,n)}),t):e(i,n);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{r.result||(r.callbacks=r.callbacks.filter((e=>e!==n)),r.callbacks.length||(r.cancel(),delete this.entries[e]))}}}function Vf(e,t,i){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const n=Ie(e.request,((e,n,r,o)=>{e?t(e):n&&t(null,{vectorTile:i?void 0:new hu.VectorTile(new lh(n)),rawData:n,cacheControl:r,expires:o})}));return()=>{n.cancel(),t()}}),t)}e.ARRAY_TYPE=dl,e.AUTH_ERR_MSG=ne,e.Aabb=Yl,e.Actor=class{constructor(e,i,n){this.target=e,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},S(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=P()?e:t,this.scheduler=new Yp}send(e,t,i,n,r=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=B(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!i,targetMapId:n,mustQueue:r,sourceMapId:this.mapId,data:Pr(t,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||P()){const e=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(Or(t.error)):i(null,Or(t.data)))}else{const i=B(this.globalScope)?void 0:[],n=t.hasCallback?(t,n)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Pr(t):null,data:Pr(n,i)},i)}:e=>{},r=Or(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,r,n);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],r.source)[e[1]](r,n)}else n(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=ku,e.Color=yt,e.ColorMode=Ef,e.CullFaceMode=zf,e.DEMData=wf,e.DataConstantProperty=jo,e.DedupedRequest=Uf,e.DepthMode=kf,e.EXTENT=ba,e.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,n=1<<i,r=Math.floor(e.x),o=Math.floor((e.x-r)*n),s=Math.floor(e.y*n),a=this.findDEMTileFor(new Cu(i,r,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const r=n.getSource().maxzoom,o=1<<r,s=Math.floor(e.x),a=e.x-s,l=new Cu(r,s,r,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*yi(yi(u.get(f,m),u.get(f,m+1),p-m),yi(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const n=1<<e.canonical.z;return this.getAtPointOrZero(new Pa(e.wrap+(e.canonical.x+t/ba)/n,(e.canonical.y+i/ba)/n))}getAtTileOffsetFunc(e,t,i,n){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),s=n.upVector(e.canonical,r.x,r.y);return Il(s,s,o*n.upVectorScale(e.canonical,t,i).metersToTile),s}}getForTilePoints(e,t,i,n){const r=Of.create(this,e,n);return!!r&&(t.forEach((e=>{e[2]=this.exaggeration()*r.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,n=t.tileID,r=1<<e.canonical.z-n.canonical.z;let o=e.canonical.x/r-n.canonical.x,s=e.canonical.y/r-n.canonical.y,a=0;for(let t=0;t<e.canonical.z-n.canonical.z&&!i.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=Ue,e.EvaluationParameters=Io,e.Event=Ne,e.Evented=Ve,e.FillExtrusionBucket=_u,e.Frustum=Kl,e.FrustumCorners=Xl,e.GLOBE_METERS_TO_ECEF=Bd,e.GLOBE_RADIUS=Rd,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=6,e.GLOBE_ZOOM_THRESHOLD_MIN=5,e.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_createGrid(e){const t=new Jo,i=new fs,n=65;for(let e=0;e<n;e++)for(let i=0;i<n;i++)t.emplaceBack(i,e);this._gridSegments=[];for(let e=0,t=0;e<Fd.length;e++){const r=Fd[e];for(let e=0;e<r;e++)for(let t=0;t<64;t++){const r=e*n+t;i.emplaceBack(r+1,r,r+n),i.emplaceBack(r+n,r+n+1,r+1)}const o=64*r*2;this._gridSegments.push(xa.simpleSegment(0,t,(r+1)*n,o)),t+=o}this._gridBuffer=e.createVertexBuffer(t,Od.members),this._gridIndexBuffer=e.createIndexBuffer(i,!0)}_createPoles(e){const t=new fs;for(let e=0;e<=64;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new _s,n=new _s;this._poleSegments=[];for(let e=0,t=0;e<5;e++){const r=1<<e,o=512*r/Math.PI/2,s=360/r;i.emplaceBack(0,-o,0,0,0,.5,0),n.emplaceBack(0,-o,0,0,0,.5,1);for(let e=0;e<=64;e++){const t=e/64,r=yi(0,s,t),[a,l,c]=Zd(rp,op,r,o);i.emplaceBack(a,l,c,0,0,t,0),n.emplaceBack(a,l,c,0,0,t,1)}this._poleSegments.push(xa.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Dd,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Dd,!1)}getGridBuffers(e){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[e]]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const t=new bs,i=64,n=i+1;this._wireframeSegments=[];for(let e=0,r=0;e<Fd.length;e++){const o=Fd[e];for(let e=0;e<o;e++)for(let r=0;r<i;r++){const i=e*n+r;t.emplaceBack(i,i+1),t.emplaceBack(i,i+n),t.emplaceBack(i,i+n+1)}const s=o*i*3;this._wireframeSegments.push(xa.simpleSegment(0,r,(o+1)*n,s)),r+=s}this._wireframeIndexBuffer=e.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},e.GlyphManager=cd,e.ImagePosition=Lh,e.LineAtlas=Xp,e.LngLat=ka,e.LngLatBounds=wa,e.LocalGlyphMode=ld,e.MAX_MERCATOR_LATITUDE=Da,e.MercatorCoordinate=Pa,e.ONE_EM=Ku,e.OverscaledTileID=Cu,e.Properties=qo,e.RGBAImage=lc,e.Ray=Zl,e.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ie,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!re(e))return e;const i=ae(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!re(e))return e;const i=ae(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,n){if(!re(e))return e;const r=ae(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),i&&r.params.push(`language=${i}`),n&&r.params.push(`worldview=${n}`),this._makeAPIURL(r,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,n){const r=ae(e);return re(e)?(r.path=`/styles/v1${r.path}/sprite${t}${i}`,this._makeAPIURL(r,this._customAccessToken||n)):(r.path+=`${t}${i}`,le(r))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!re(e))return e;const n=ae(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==n.authority&&512===i?"@2x":""}${K.supported?".webp":"$1"}`),"raster"===n.authority?n.path=`/${X.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${X.TILE_URL_VERSION}${n.path}`);const r=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,r)}canonicalizeTileURL(e,t){const i=ae(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let r=i.params;return t&&(r=r.filter((e=>!e.match(/^access_token=/)))),r.length&&(n+=`?${r.join("&")}`),n}canonicalizeTileset(e,t){const i=!!t&&re(t),n=[];for(const t of e.tiles||[])oe(t)?n.push(this.canonicalizeTileURL(t,i)):n.push(t);return n}_makeAPIURL(e,t){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=ae(X.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=`${n.path}${e.path}`),!X.REQUIRE_ACCESS_TOKEN)return le(e);if(t=t||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),le(e)}},e.ResourceType=Ee,e.SegmentVector=xa,e.SourceCache=If,e.StencilMode=Cf,e.StructArrayLayout1ui2=ws,e.StructArrayLayout2f1f2i16=hs,e.StructArrayLayout2i4=Jo,e.StructArrayLayout2ui4=bs,e.StructArrayLayout3f12=ps,e.StructArrayLayout3ui6=fs,e.StructArrayLayout4i8=es,e.StructArrayLayout5f20=vs,e.Texture=Zp,e.Tile=hf,e.Transitionable=Po,e.Uniform1f=Ys,e.Uniform1i=class extends Ks{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends Ks{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends Ks{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=Js,e.UniformColor=Qs,e.UniformMatrix2f=class extends Ks{constructor(e,t){super(e,t),this.current=ia}set(e){for(let t=0;t<4;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix2fv(this.location,!1,e);break}}},e.UniformMatrix3f=class extends Ks{constructor(e,t){super(e,t),this.current=ta}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends Ks{constructor(e,t){super(e,t),this.current=ea}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Su,e.ValidationError=Nn,e.VectorTileWorkerSource=class extends Ve{constructor(e,t,i,n,r){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=r||Vf,this.loading={},this.loaded={},this.deduped=new Uf(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,n=e&&e.request,r=n&&n.collectResourceTiming,o=this.loading[i]=new jf(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new hu.VectorTile(new lh(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return t(e);const o={};if(r){const e=N(n);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,v({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(e,t){const i=this.loaded,n=e.uid,r=this;if(i&&i[n]){const o=i[n];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=ap(e.tileID.canonical,e.projection);const s=(e,i)=>{const n=o.reloadCallback;n&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,n)),t(e,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const i=e.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,n=e.uid;i&&i[n]&&delete i[n],t()}},e.WritingMode=Ph,e.ZoomHistory=Rr,e.add=Cl,e.addDynamicAttributes=Dp,e.adjoint=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=r*c-n*u,e[2]=n*a-r*s,e[3]=a*l-o*u,e[4]=i*u-r*l,e[5]=r*o-i*a,e[6]=o*c-s*l,e[7]=n*l-i*c,e[8]=i*s-n*o,e},e.asyncAll=y,e.bezier=d,e.bindAll=S,e.boundsAttributes=cf,e.bufferConvexPolygon=function(e,t){const i=[];for(let n=0;n<e.length;n++){const r=g(n-1,-1,e.length-1),o=g(n+1,-1,e.length-1),s=e[n],a=e[o],l=e[r].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(s.add(h))}return i},e.cacheEntryPossiblyAdded=function(e){Ce++,Ce>xe&&(e.getActor().send("enforceCacheSizeLimit",ve),Ce=0)},e.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:n}=e.point,r=ep(i,n,e.worldSize/e._projectionScaler,0,0);return ml(r,r,Qd(qd(t)))},e.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:n,lat:r}=e._center;return ep(t,i,e.worldSize,n,r)},e.calculateGlobeMercatorMatrix=function(e){const t=e.worldSize,i=e.point,n=Aa(1,e.center.lat)*t,r=e.pixelsPerMeter,o=t/(n/e.pixelsPerMeter),s=fl(new Float64Array(16));return gl(s,s,[i.x,i.y,0]),yl(s,s,[o,o,r]),Float32Array.from(s)},e.circumferenceAtLatitude=Ca,e.clamp=f,e.clearTileCache=function(e){const i=[];for(const e in be)i.push(t.caches.delete(e)),delete be[e];e&&Promise.all(i).catch(e).then((()=>e()))},e.clipLine=rd,e.clone=function(e){var t=new dl(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=A,e.collisionCircleLayout=Xu,e.config=X,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new dl(16);return dl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=pl,e.createExpression=On,e.createLayout=Ko,e.createStyleLayer=function(e){return"custom"===e.type?new Gp(e):new Hp[e.type](e)},e.cross=Ol,e.degToRad=l,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},e.dot=Pl,e.ease=p,e.easeCubicInOut=h,e.emitValidationErrors=Er,e.endsWith=C,e.enforceCacheSizeLimit=function(e){for(const t in be)Te(t),be[t].then((t=>{t.keys().then((i=>{for(let n=0;n<i.length-e;n++)t.delete(i[n])}))}))},e.evaluateSizeForFeature=Qu,e.evaluateSizeForZoom=eh,e.evaluateVariableOffset=wd,e.evented=Eo,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=H,e.exported$1=K,e.extend=v,e.extend$1=qe,e.fillExtrusionHeightLift=xu,e.filterObject=M,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i+i,a=n+n,l=r+r,c=i*s,u=n*s,h=n*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return u[t]},e.getAABBPointSquareDist=function(e,t,i){let n=0;for(let r=0;r<2;++r){const o=i?i[r]:0;e[r]>o&&(n+=(e[r]-o)*(e[r]-o)),t[r]<o&&(n+=(o-t[r])*(o-t[r]))}return n},e.getAnchorAlignment=Wh,e.getAnchorJustification=kd,e.getBounds=function(e){let t=1/0,i=1/0,n=-1/0,o=-1/0;for(const r of e)t=Math.min(t,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),o=Math.max(o,r.y);return{min:new r(t,i),max:new r(n,o)}},e.getColumn=$,e.getGridMatrix=function(e,t,i){const[n,r]=t,o=.015625;return[0,(r[1]-n[1])*o,1<<e.z,(r[0]-n[0])/Fd[i],0,e.y,n[0],n[1],o]},e.getImage=Fe,e.getJSON=function(e,t){return ze(v(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){const t=80.051129;e=f(e,-80.051129,t)/t*90;const i=Math.pow(Math.abs(Math.sin(l(e))),3);return Math.round(i*(Fd.length-1))},e.getMapSessionAPI=ge,e.getPerformanceMeasurement=N,e.getProjection=Mp,e.getRTLTextPluginStatus=Mo,e.getReferrer=Ae,e.getTilePoint=function(e,{x:t,y:i},n=0){return new r(((t-n)*e.scale-e.x)*ba,(i*e.scale-e.y)*ba)},e.getTileVec3=function(e,t,i=0){return Sl(((t.x-i)*e.scale-e.x)*ba,(t.y*e.scale-e.y)*ba,La(t.z,t.y))},e.getVideo=function(e,i){const n=t.document.createElement("video");n.muted=!0,n.onloadstart=function(){i(null,n)};for(let i=0;i<e.length;i++){const r=t.document.createElement("source");Pe(e[i])||(n.crossOrigin="Anonymous"),r.src=e[i],n.appendChild(r)}return{cancel:()=>{}}},e.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=fl(new Float64Array(16));return ml(i,e.pixelMatrix,e.globeMatrix),Rl(t,t,i),new r(t[0],t[1])},e.globeECEFOrigin=function(e,t){const i=[0,0,0];return Rl(i,i,Jd(qd(t.canonical))),Rl(i,i,e),i},e.globeNormalizeECEF=Jd,e.globePixelsToTileUnits=function(e,t){return ba/(512*Math.pow(2,e))*Yd(qd(t))},e.globePoleMatrixForTile=function(e,t,i){const n=fl(new Float64Array(16)),r=1<<e,o=360*(t/r-.5),s=i.point,a=i.worldSize/(i.tileSize*r);return gl(n,n,[s.x,s.y,-i.worldSize/Math.PI/2]),yl(n,n,[a,a,a]),_l(n,n,l(-i._center.lat)),vl(n,n,l(-i._center.lng+o)),Float32Array.from(n)},e.globeTileBounds=qd,e.globeTileLatLngCorners=Hd,e.globeTiltAtLngLat=ip,e.globeToMercatorTransition=tp,e.globeUseCustomAntiAliasing=function(e,t,i){const n=tp(i.zoom),r=e.style.map._antialias,o=!!t.extStandardDerivatives,s=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!r&&!s&&o},e.identity=fl,e.identity$1=ql,e.invert=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-n*s,v=i*l-r*s,x=i*c-o*s,b=n*l-r*a,w=n*c-o*a,T=r*c-o*l,k=u*m-h*f,S=u*g-d*f,C=u*y-p*f,E=h*g-d*m,M=h*y-p*m,A=d*y-p*g,z=_*A-v*M+x*E+b*C-w*S+T*k;return z?(e[0]=(a*A-l*M+c*E)*(z=1/z),e[1]=(r*M-n*A-o*E)*z,e[2]=(m*T-g*w+y*b)*z,e[3]=(d*w-h*T-p*b)*z,e[4]=(l*C-s*A-c*S)*z,e[5]=(i*A-r*C+o*S)*z,e[6]=(g*x-f*T-y*v)*z,e[7]=(u*T-d*x+p*v)*z,e[8]=(s*M-a*C+c*k)*z,e[9]=(n*C-i*M-o*k)*z,e[10]=(f*w-m*x+y*_)*z,e[11]=(h*x-u*w-p*_)*z,e[12]=(a*S-s*E-l*k)*z,e[13]=(i*E-n*S+r*k)*z,e[14]=(m*v-f*b-g*_)*z,e[15]=(u*b-h*v+d*_)*z,e):null},e.isLngLatBehindGlobe=function(e,t){return ip(e,t)>Math.PI/2*1.01},e.isMapAuthenticated=function(e){return ye.has(e)},e.isMapboxURL=re,e.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!B(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=Ia,e.len=Nl,e.length=kl,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Vf,e.makeRequest=ze,e.mapValue=function(e,t,i,n,r){return f((e-t)/(i-t)*(r-n)+n,n,r)},e.mercatorXfromLng=Ea,e.mercatorYfromLat=Ma,e.mercatorZfromAltitude=Aa,e.mul=bl,e.mul$1=jl,e.multiply=ml,e.multiply$1=function(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],x=i[8];return e[0]=d*n+p*s+f*c,e[1]=d*r+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*n+g*s+y*c,e[4]=m*r+g*a+y*u,e[5]=m*o+g*l+y*h,e[6]=_*n+v*s+x*c,e[7]=_*r+v*a+x*u,e[8]=_*o+v*l+x*h,e},e.multiply$2=Ml,e.nextPowerOfTwo=T,e.normalize=Dl,e.normalize$1=function(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i*i+n*n+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=n*s,e[2]=r*s,e[3]=o*s,e},e.number=yi,e.ortho=function(e,t,i,n,r,o,s){var a=1/(t-i),l=1/(n-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(r+n)*l,e[14]=(s+o)*c,e[15]=1,e},e.pbf=lh,e.perspective=function(e,t,i,n,r){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+n)*(o=1/(n-r)),e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n),e},e.pick=function(e,t){const i={};for(let n=0;n<t.length;n++){const r=t[n];r in e&&(i[r]=e[r])}return i},e.plugin=zo,e.pointGeometry=r,e.polygonContainsPoint=il,e.polygonIntersectsBox=nl,e.polygonIntersectsPolygon=Ha,e.polygonizeBounds=function(e,t,i=0,n=!0){const o=new r(i,i),s=e.sub(o),a=t.add(o),l=[s,new r(a.x,s.y),a,new r(s.x,a.y)];return n&&l.push(s.clone()),l},e.posAttributes=Od,e.postMapLoadEvent=fe,e.postTurnstileEvent=de,e.potpack=Ih,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=c,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:To,pluginURL:ko}),Eo.on("pluginStateChange",e),e},e.removeAuthState=function(e){ye.delete(e)},e.renderColorRamp=uc,e.resample=Ra,e.rotateX=_l,e.rotateX$1=Wl,e.rotateY=vl,e.rotateY$1=Hl,e.rotateZ=function(e,t,i){var n=Math.sin(i),r=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*n,e[1]=s*r+u*n,e[2]=a*r+h*n,e[3]=l*r+d*n,e[4]=c*r-o*n,e[5]=u*r-s*n,e[6]=h*r-a*n,e[7]=d*r-l*n,e},e.rotateZ$1=function(e,t,i){i*=.5;var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=n*l+r*a,e[1]=r*l-n*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.scale=yl,e.scale$1=Ul,e.scale$2=Il,e.scaleAndAdd=Ll,e.setCacheLimits=function(e,t){ve=e,xe=t},e.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.setRTLTextPlugin=function(e,t,i=!1){if(To===vo||To===xo||To===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");ko=H.resolveURL(e),To=vo,wo=t,Co(),i||Ao()},e.smoothstep=m,e.spec=Ge,e.storeAuthState=function(e,t){t?ye.add(e):ye.delete(e)},e.sub=$l,e.subtract=El,e.symbolSize=th,e.tileAABB=function(e,t,i,n,r,o,s,a,l){if("globe"===l.name)return Wd(e,t,new ku(i,n,r));const c=ap({z:i,x:n,y:r},l);return new Yl([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.tileTransform=ap,e.transformMat3=function(e,t,i){var n=t[0],r=t[1],o=t[2];return e[0]=n*i[0]+r*i[3]+o*i[6],e[1]=n*i[1]+r*i[4]+o*i[7],e[2]=n*i[2]+r*i[5]+o*i[8],e},e.transformMat4=Rl,e.transformMat4$1=Vl,e.transformQuat=Bl,e.translate=gl,e.transpose=function(e,t){if(e===t){var i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=So,e.uniqueId=b,e.updateGlobeVertexNormal=function(e,t,i,n,r){const o=5*t+2;e.float32[o+0]=i,e.float32[o+1]=n,e.float32[o+2]=r},e.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFilter=e=>Cr(lr(e)),e.validateFog=e=>Cr(vr(e)),e.validateLayer=e=>Cr(pr(e)),e.validateLight=e=>Cr(yr(e)),e.validateSource=e=>Cr(gr(e)),e.validateStyle=Tr,e.validateTerrain=e=>Cr(_r(e)),e.values=_,e.vectorTile=hu,e.version=U,e.warnOnce=I,e.window=t,e.wrap=g})),n(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(const n of e)i+=`${t(n)},`;return`${i}]`}let i="{";for(const n of Object.keys(e).sort())i+=`${n}:${t(e[n])},`;return`${i}}`}function i(i){let n="";for(const r of e.refProperties)n+=`/${t(i[r])}`;return n}class n{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const n={};for(let r=0;r<e.length;r++){const o=t&&t[e[r].id]||i(e[r]);t&&(t[e[r].id]=o);let s=n[o];s||(s=n[o]=[]),s.push(e[r])}const r=[];for(const e in n)r.push(n[e]);return r}(e.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const n=i.source||"";let r=this.familiesBySource[n];r||(r=this.familiesBySource[n]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class r{loadTile(t,i){const{uid:n,encoding:r,rawImageData:o,padding:s,buildQuadTree:a}=t,l=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap?this.getImageData(o,s):o;i(null,new e.DEMData(n,l,r,s<1,a))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}var o=function e(t,i){var n,r=t&&t.type;if("FeatureCollection"===r)for(n=0;n<t.features.length;n++)e(t.features[n],i);else if("GeometryCollection"===r)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],i);else if("Feature"===r)e(t.geometry,i);else if("Polygon"===r)s(t.coordinates,i);else if("MultiPolygon"===r)for(n=0;n<t.coordinates.length;n++)s(t.coordinates[n],i);return t};function s(e,t){if(0!==e.length){a(e[0],t);for(var i=1;i<e.length;i++)a(e[i],!t)}}function a(e,t){for(var i=0,n=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=i+a;n+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+n>=0!=!!t&&e.reverse()}const l=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.pointGeometry(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const n=[];for(const t of i)n.push(new e.pointGeometry(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,i){return l.call(this,e,t,i)}}class u{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new c(this._features[e])}}var h=e.vectorTile.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var n=t[i],r=[],o=0;o<n.length;o++)r.push(new e.pointGeometry(n[o][0],n[o][1]));this.geometry.push(r)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,n=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[t,n,i,r]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=y,g=d;function y(t){var i=new e.pbf;return function(e,t){for(var i in e.layers)t.writeMessage(3,_,e.layers[i])}(t,i),i.finish()}function _(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)n.feature=e.feature(i),t.writeMessage(2,v,n);var r=n.keys;for(i=0;i<r.length;i++)t.writeStringField(3,r[i]);var o=n.values;for(i=0;i<o.length;i++)t.writeMessage(4,k,o[i])}function v(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,x,e),t.writeVarintField(3,i.type),t.writeMessage(4,T,i)}function x(e,t){var i=e.feature,n=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(n.push(a),o[a]=c=n.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function T(e,t){for(var i=e.loadGeometry(),n=e.type,r=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===n&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===n?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==n&&t.writeVarint(b(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),r+=d,o+=p}3===n&&t.writeVarint(b(7,1))}}function k(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function S(e,t,i,n,r,o){if(r-n<=i)return;const s=n+r>>1;C(e,t,s,n,r,o%2),S(e,t,i,n,s-1,o+1),S(e,t,i,s+1,r,o+1)}function C(e,t,i,n,r,o){for(;r>n;){if(r-n>600){const s=r-n+1,a=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);C(e,t,i,Math.max(n,Math.floor(i-a*c/s+u)),Math.min(r,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=n,l=r;for(E(e,t,n,i),t[2*r+o]>s&&E(e,t,n,r);a<l;){for(E(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*n+o]===s?E(e,t,n,l):(l++,E(e,t,l,r)),l<=i&&(n=l+1),i<=l&&(r=l-1)}}function E(e,t,i,n){M(e,i,n),M(t,2*i,2*n),M(t,2*i+1,2*n+1)}function M(e,t,i){const n=e[t];e[t]=e[i],e[i]=n}function A(e,t,i,n){const r=e-i,o=t-n;return r*r+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var n in e)i[n]=new d(e[n].features,t),i[n].name=n,i[n].version=t.version,i[n].extent=t.extent;return y({layers:i})},m.GeoJSONWrapper=g;class z{constructor(e,t,i,n=64,r){this.nodeSize=n,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(e.length),a=this.coords=new r(2*e.length);for(let n=0;n<e.length;n++)s[n]=n,a[2*n]=t(e[n]),a[2*n+1]=i(e[n]);S(s,a,n,0,s.length-1,0)}range(e,t,i,n){return function(e,t,i,n,r,o,s){const a=[0,e.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=s){for(let s=p;s<=d;s++)c=t[2*s],u=t[2*s+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(e[s]);continue}const f=Math.floor((p+d)/2);c=t[2*f],u=t[2*f+1],c>=i&&c<=r&&u>=n&&u<=o&&l.push(e[f]);const m=(h+1)%2;(0===h?i<=c:n<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?r>=c:o>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,e,t,i,n,this.nodeSize)}within(e,t,i){return function(e,t,i,n,r,o){const s=[0,e.length-1,0],a=[],l=r*r;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let r=h;r<=u;r++)A(t[2*r],t[2*r+1],i,n)<=l&&a.push(e[r]);continue}const d=Math.floor((h+u)/2),p=t[2*d],f=t[2*d+1];A(p,f,i,n)<=l&&a.push(e[d]);const m=(c+1)%2;(0===c?i-r<=p:n-r<=f)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?i+r>=p:n+r>=f)&&(s.push(d+1),s.push(u),s.push(m))}return a}(this.ids,this.coords,e,t,i,this.nodeSize)}}const I={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},L=Math.fround||(D=new Float32Array(1),e=>(D[0]=+e,D[0]));var D;class P{constructor(e){this.options=U(Object.create(I),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:i,maxZoom:n,nodeSize:r}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;let s=[];for(let t=0;t<e.length;t++)e[t].geometry&&s.push(R(e[t],t));this.trees[n+1]=new z(s,V,G,r,Float32Array),t&&console.timeEnd(o);for(let e=n;e>=i;e--){const i=+Date.now();s=this._cluster(s,e),this.trees[e]=new z(s,V,G,r,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,s.length,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,r=180;else if(i>r){const e=this.getClusters([i,n,180,o],t),s=this.getClusters([-180,n,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range($(i),j(o),$(r),j(n)),l=[];for(const e of a){const t=s.points[e];l.push(t.numPoints?B(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),n="No cluster with the specified id.",r=this.trees[i];if(!r)throw new Error(n);const o=r.points[t];if(!o)throw new Error(n);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=r.within(o.x,o.y,s),l=[];for(const t of a){const i=r.points[t];i.parentId===e&&l.push(i.numPoints?B(i):this.points[i.index])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,i){const n=[];return this._appendLeaves(n,e,t=t||10,i=i||0,0),n}getTile(e,t,i){const n=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/r,c=(i+1+a)/r,u={features:[]};return this._addTileFeatures(n.range((t-a)/r,l,(t+1+a)/r,c),n.points,t,i,r,u),0===t&&this._addTileFeatures(n.range(1-a/r,l,1,c),n.points,r,i,r,u),t===r-1&&this._addTileFeatures(n.range(0,l,a/r,c),n.points,-1,i,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,n,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=n?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,i,n,r):r<n?r++:e.push(t),e.length===i)break}return r}_addTileFeatures(e,t,i,n,r,o){for(const s of e){const e=t[s],a=e.numPoints;let l,c,u;if(a)l=F(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=$(t.geometry.coordinates[0]),u=j(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-i)),Math.round(this.options.extent*(u*r-n))]],tags:l};let d;a?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const i=[],{radius:n,extent:r,reduce:o,minPoints:s}=this.options,a=n/(r*Math.pow(2,t));for(let n=0;n<e.length;n++){const r=e[n];if(r.zoom<=t)continue;r.zoom=t;const l=this.trees[t+1],c=l.within(r.x,r.y,a),u=r.numPoints||1;let h=u;for(const e of c){const i=l.points[e];i.zoom>t&&(h+=i.numPoints||1)}if(h>u&&h>=s){let e=r.x*u,s=r.y*u,a=o&&u>1?this._map(r,!0):null;const d=(n<<5)+(t+1)+this.points.length;for(const i of c){const n=l.points[i];if(n.zoom<=t)continue;n.zoom=t;const c=n.numPoints||1;e+=n.x*c,s+=n.y*c,n.parentId=d,o&&(a||(a=this._map(r,!0)),o(a,this._map(n)))}r.parentId=d,i.push(O(e/h,s/h,d,h,a))}else if(i.push(r),h>1)for(const e of c){const n=l.points[e];n.zoom<=t||(n.zoom=t,i.push(n))}}return i}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?U({},e.properties):e.properties;const i=this.points[e.index].properties,n=this.options.map(i);return t&&n===i?U({},n):n}}function O(e,t,i,n,r){return{x:L(e),y:L(t),zoom:1/0,id:i,parentId:-1,numPoints:n,properties:r}}function R(e,t){const[i,n]=e.geometry.coordinates;return{x:L($(i)),y:L(j(n)),zoom:1/0,index:t,parentId:-1}}function B(e){return{type:"Feature",id:e.id,properties:F(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),N(e.y)]}};var t}function F(e){const t=e.numPoints,i=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return U(U({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function $(e){return e/360+.5}function j(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function N(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function U(e,t){for(const i in t)e[i]=t[i];return e}function V(e){return e.x}function G(e){return e.y}function q(e,t,i,n){for(var r,o=n,s=i-t>>1,a=i-t,l=e[t],c=e[t+1],u=e[i],h=e[i+1],d=t+3;d<i;d+=3){var p=W(e[d],e[d+1],l,c,u,h);if(p>o)r=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(r=d,a=f)}}o>n&&(r-t>3&&q(e,t,r,n),e[r+2]=o,i-r>3&&q(e,r,i,n))}function W(e,t,i,n,r,o){var s=r-i,a=o-n;if(0!==s||0!==a){var l=((e-i)*s+(t-n)*a)/(s*s+a*a);l>1?(i=r,n=o):l>0&&(i+=s*l,n+=a*l)}return(s=e-i)*s+(a=t-n)*a}function H(e,t,i,n){var r={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)Z(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)Z(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)Z(e,t[n][r])}(r),r}function Z(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function X(e,t,i,n){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=n||0),"Point"===o)K(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)K(r[c],a);else if("LineString"===o)Y(r,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<r.length;c++)Y(r[c],a=[],s,!1),e.push(H(l,"LineString",a,t.properties));return}J(r,a,s,!1)}else if("Polygon"===o)J(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)X(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];J(r[c],u,s,!0),a.push(u)}}e.push(H(l,o,a,t.properties))}}function K(e,t){t.push(Q(e[0])),t.push(ee(e[1])),t.push(0)}function Y(e,t,i,n){for(var r,o,s=0,a=0;a<e.length;a++){var l=Q(e[a][0]),c=ee(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=n?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=t.length-3;t[2]=1,q(t,0,u,i),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function J(e,t,i,n){for(var r=0;r<e.length;r++){var o=[];Y(e[r],o,i,n),t.push(o)}}function Q(e){return e/360+.5}function ee(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function te(e,t,i,n,r,o,s,a){if(n/=t,o>=(i/=t)&&s<n)return e;if(s<i||o>=n)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=i&&f<n)l.push(u);else if(!(f<i||p>=n)){var m=[];if("Point"===d||"MultiPoint"===d)ie(h,m,i,n,r);else if("LineString"===d)ne(h,m,i,n,r,!1,a.lineMetrics);else if("MultiLineString"===d)oe(h,m,i,n,r,!1);else if("Polygon"===d)oe(h,m,i,n,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];oe(h[g],y,i,n,r,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(H(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(H(u.id,d,m,u.tags))}}}return l.length?l:null}function ie(e,t,i,n,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=i&&s<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function ne(e,t,i,n,r,o,s){for(var a,l,c=re(e),u=0===r?ae:le,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],y=e[d+4],_=0===r?p:f,v=0===r?g:y,x=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<i?v>i&&(l=u(c,p,f,g,y,i),s&&(c.start=h+a*l)):_>n?v<n&&(l=u(c,p,f,g,y,n),s&&(c.start=h+a*l)):se(c,p,f,m),v<i&&_>=i&&(l=u(c,p,f,g,y,i),x=!0),v>n&&_<=n&&(l=u(c,p,f,g,y,n),x=!0),!o&&x&&(s&&(c.end=h+a*l),t.push(c),c=re(e)),s&&(h+=a)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(_=0===r?p:f)>=i&&_<=n&&se(c,p,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&se(c,c[0],c[1],c[2]),c.length&&t.push(c)}function re(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function oe(e,t,i,n,r,o){for(var s=0;s<e.length;s++)ne(e[s],t,i,n,r,o,!1)}function se(e,t,i,n){e.push(t),e.push(i),e.push(n)}function ae(e,t,i,n,r,o){var s=(o-t)/(n-t);return e.push(o),e.push(i+(r-i)*s),e.push(1),s}function le(e,t,i,n,r,o){var s=(o-i)/(r-i);return e.push(t+(n-t)*s),e.push(o),e.push(1),s}function ce(e,t){for(var i=[],n=0;n<e.length;n++){var r,o=e[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=ue(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(ue(o.geometry[a],t))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(ue(o.geometry[a][c],t));r.push(l)}i.push(H(o.id,s,r,o.tags))}return i}function ue(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var n=0;n<e.length;n+=3)i.push(e[n]+t,e[n+1],e[n+2]);return i}function he(e,t){if(e.transformed)return e;var i,n,r,o=1<<e.z,s=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(n=0;n<c.length;n+=2)l.geometry.push(de(c[n],c[n+1],t,o,s,a));else for(n=0;n<c.length;n++){var h=[];for(r=0;r<c[n].length;r+=2)h.push(de(c[n][r],c[n][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function de(e,t,i,n,r,o){return[Math.round(i*(e*n-r)),Math.round(i*(t*n-o))]}function pe(e,t,i,n,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,fe(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function fe(e,t,i,n){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)me(s,r,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)me(s,r[a],e,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)me(s,c[a],e,i,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function me(e,t,i,n,r,o){var s=n*n;if(n>0&&t.size<(r?s:n))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>s)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;r&&function(e,t){for(var i=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)i+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(i>0===t)for(n=0,r=e.length;n<r/2;n+=2){var s=e[n],a=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=s,e[r-1-n]=a}}(a,o),e.push(a)}}function ge(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)X(i,e.features[n],t,n);else X(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var i=t.buffer/t.extent,n=e,r=te(e,1,-1-i,i,0,-1,2,t),o=te(e,1,1-i,2+i,0,-1,2,t);return(r||o)&&(n=te(e,1,-i,1+i,0,-1,2,t)||[],r&&(n=ce(r,1).concat(n)),o&&(n=n.concat(ce(o,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(e,t,i){return 32*((1<<e)*i+t)+e}function _e(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return t(null,null);const r=new u(n.features);let o=m(r);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:r,rawData:o.buffer})}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(e,t,i,n,r,o,s){for(var a=[e,t,i,n],l=this.options,c=l.debug;a.length;){n=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=ye(t,i,n),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=pe(e,t,i,n,l),this.tileCoords.push({z:t,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(i!==Math.floor(o/f)||n!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,T=.5+b,k=1+b;m=g=y=_=null,v=te(e,u,i-b,i+T,0,d.minX,d.maxX,l),x=te(e,u,i+w,i+k,0,d.minX,d.maxX,l),e=null,v&&(m=te(v,u,n-b,n+T,1,d.minY,d.maxY,l),g=te(v,u,n+w,n+k,1,d.minY,d.maxY,l),v=null),x&&(y=te(x,u,n-b,n+T,1,d.minY,d.maxY,l),_=te(x,u,n+w,n+k,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*i,2*n),a.push(g||[],t+1,2*i,2*n+1),a.push(y||[],t+1,2*i+1,2*n),a.push(_||[],t+1,2*i+1,2*n+1)}}},ge.prototype.getTile=function(e,t,i){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var s=1<<e,a=ye(e,t=(t%s+s)%s,i);if(this.tiles[a])return he(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ye(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?he(this.tiles[a],r):null):null};class ve extends e.VectorTileWorkerSource{constructor(e,t,i,n,r){super(e,t,i,n,_e),r&&(this.loadGeoJSON=r)}loadData(t,i){const n=t&&t.request,r=n&&n.collectResourceTiming;this.loadGeoJSON(t,((s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(t.filter){const i=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=a.features.filter((e=>i.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:n}}this._geoJSONIndex=t.cluster?new P(void 0).load(a.features):function(e,t){return new ge(e,t)}(a,t.geojsonVtOptions)}catch(s){return i(s)}this.loaded={};const l={};if(r){const i=e.getPerformanceMeasurement(n);i&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class xe{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:ve},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){this.isSpriteLoaded[t]=i;for(const n in this.workerSources[t]){const r=this.workerSources[t][n];for(const t in r)r[t]instanceof e.VectorTileWorkerSource&&(r[t].isSpriteLoaded=i,r[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,i){this.availableImages[e]=t;for(const i in this.workerSources[e]){const n=this.workerSources[e][i];for(const e in n)n[e].availableImages=t}i()}enableTerrain(e,t,i){this.terrain=t,i()}setProjection(t,i){this.projections[t]=e.getProjection(i)}setLayers(e,t,i){this.getLayerIndex(e).replace(t),i()}updateLayers(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()}loadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).loadTile(r,n)}loadDEMTile(t,i,n){const r=this.enableTerrain?e.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(t,i.source).loadTile(r,n)}reloadTile(t,i,n){const r=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;r.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).reloadTile(r,n)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)}removeSource(e,t,i){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,n){try{e.plugin.setState(i);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const i=e.plugin.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){n(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new n),t}getWorkerSource(e,t,i){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][i]||(this.workerSources[e][t][i]=new this.workerSourceTypes[t]({send:(t,i,n,r,o,s)=>{this.actor.send(t,i,n,e,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])),this.workerSources[e][t][i]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new r),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,i){e.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xe(self)),xe})),n(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let n=0;n<e.length;n++)if(!t(e[n],i[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const n in e)if(!t(e[n],i[n]))return!1;return!0}return e===i}var i=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===r[t=e&&e.failIfMajorPerformanceCaveat]&&(r[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),r[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var r={};function o(t,i,n){const r=e.window.document.createElement(t);return void 0!==i&&(r.className=i),n&&n.appendChild(r),r}function s(t,i,n){const r=e.window.document.createElementNS("http://www.w3.org/2000/svg",t);for(const e of Object.keys(i))r.setAttributeNS(null,e,i[e]);return n&&n.appendChild(r),r}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=e.window.document&&e.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",d,!0)}function p(){e.window.addEventListener("click",d,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return y(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),n=[];for(let r=0;r<t.length;r++)n.push(y(e,i,t[r]));return n}function g(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function y(t,i,n){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry((n.clientX-i.left)*r,(n.clientY-i.top)*r)}function _(e,t){var i=t[0],n=t[1],r=t[2],o=t[3],s=i*o-r*n;return s?(e[0]=o*(s=1/s),e[1]=-n*s,e[2]=-r*s,e[3]=i*s,e):null}function v(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class x extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let i=0;for(const n of e){if(n[0]<i||n[1]<n[0]||t<n[1])return!1;i=n[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const n={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?n[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,n)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],n=this.getImage(t);if(!n)return null;if(i&&i.position.version===n.version)return i.position;if(i)i.position.version=n.version;else{const i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},r=new e.ImagePosition(i,n);this.patterns[t]={bin:i,position:r}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:n}=e.potpack(t),r=this.atlasImage;r.resize({width:i||1,height:n||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],n=i.x+1,o=i.y+1,s=this.images[t].data,a=s.width,l=s.height;e.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o},{width:a,height:l}),e.RGBAImage.copy(s,r,{x:0,y:l-1},{x:n,y:o-1},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:n,y:o+l},{width:a,height:1}),e.RGBAImage.copy(s,r,{x:a-1,y:0},{x:n-1,y:o},{width:1,height:l}),e.RGBAImage.copy(s,r,{x:0,y:0},{x:n+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];v(e)&&this.updateImage(t,e)}}}const b=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,i){return function([t,i,n]){const r=e.degToRad(i+90),o=e.degToRad(n);return{x:t*Math.cos(r)*Math.sin(o),y:t*Math.sin(r)*Math.sin(o),z:t*Math.cos(o),azimuthal:i,polar:n}}(t.expression.evaluate(i))}interpolate(t,i,n){return{x:e.number(t.x,i.x,n),y:e.number(t.y,i.y,n),z:e.number(t.z,i.z,n),azimuthal:e.number(t.azimuthal,i.azimuthal,n),polar:e.number(t.polar,i.polar,n)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),w="-transition";class T extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const n=t[i];e.endsWith(i,w)?this._transitionable.setTransition(i.slice(0,-w.length),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const k=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),S="-transition";class C extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(k),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t){for(const i in t){const n=t[i];e.endsWith(i,S)?this._transitionable.setTransition(i.slice(0,-S.length),n):this._transitionable.setValue(i,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function E(t,i,n,r){const o=e.smoothstep(45,65,n),[s,a]=M(t,r),l=e.length(i);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*t.alpha}function M(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}const A=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])}),z="-transition";class I extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(A),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i="globe"===t.projection.name,n=e.globeToMercatorTransition(t.zoom),r=this.properties.get("range"),o=[.5,3];return{range:i?[e.number(o[0],r[0],n),e.number(o[1],r[1],n)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(!this._validate(e.validateFog,t,i)){for(const i of Object.keys(e.spec.fog))t&&void 0===t[i]&&(t[i]=e.spec.fog[i].default);for(const i in t){const n=t[i];e.endsWith(i,z)?this._transitionable.setTransition(i.slice(0,-z.length),n):this._transitionable.setValue(i,n)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,n){const r=e.MercatorCoordinate.fromLngLat(i),o=n.elevation?n.elevation.getAtPointOrZero(r):0,s=[r.x,r.y,o];return e.transformMat4(s,s,n.mercatorFogMatrix),E(t,s,n.pitch,n._fov)}(this.state,t,i):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?M(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,n){return(!n||!1!==n.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class L{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const n=this.workerPool.acquire(this.id);for(let e=0;e<n.length;e++){const t=new L.Actor(n[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,n){e.asyncAll(this.actors,((e,n)=>{e.send(t,i,n)}),n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function D(t,i,n){return i*(e.EXTENT/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}L.Actor=e.Actor;class P{constructor(e,t,i,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(t,i){let n,r;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const o=e.pointGeometry.convert(t);n=[e.pointGeometry.convert(t)],r=i.isPointAboveHorizon(o)}else{const o=e.pointGeometry.convert(t[0]),s=e.pointGeometry.convert(t[1]);n=[o,s],r=e.polygonizeBounds(o,s).every((e=>i.isPointAboveHorizon(e)))}return new P(n,i.getCameraPoint(),r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),e.bufferConvexPolygon(r,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],r=e.polygonizeBounds(i,n,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>n.y))+((o.x>i.x)+(o.x>n.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(t,i,n,r=0){const o=t.queryPadding/i._projectionScaler+1,s=n?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=t.tileID.wrap+(s.unwrapped?r:0);const l=s.polygon.map((i=>e.getTilePoint(t.tileTransform,i,a)));if(!e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>e.getTileVec3(t.tileTransform,i,a))),u=c.map((t=>new e.pointGeometry(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),d=e.getTileVec3(t.tileTransform,h,a),p=c.map((t=>{const i=e.sub(t,t,d);return e.normalize(i,i),new e.Ray(d,i)})),f=D(t,1,i.zoom)*i._projectionScaler;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.getBounds(l),m.min.x=e.clamp(m.min.x,0,e.EXTENT),m.min.y=e.clamp(m.min.y,0,e.EXTENT),m.max.x=e.clamp(m.max.x,0,e.EXTENT),m.max.y=e.clamp(m.max.y,0,e.EXTENT),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=B(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(e,t){const i=B(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(t,i){const n=function(t,i){const n=e.multiply([],i.pixelMatrix,i.globeMatrix),r=[0,-e.GLOBE_RADIUS,0,1],o=[0,e.GLOBE_RADIUS,0,1],s=[0,0,0,1];e.transformMat4$1(r,r,n),e.transformMat4$1(o,o,n),e.transformMat4$1(s,s,n);const a=new e.pointGeometry(r[0]/r[3],r[1]/r[3]),l=new e.pointGeometry(o[0]/o[3],o[1]/o[3]),c=e.polygonContainsPoint(t,a)&&r[3]<s[3],u=e.polygonContainsPoint(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,i){for(let n=1;n<e.length;n++){const r=R(t.pointCoordinate3D(e[n-1]).x),o=R(t.pointCoordinate3D(e[n]).x);if(i<0){if(r<o)return{idx:n,t:-r/(o-1-r)}}else if(o<r)return{idx:n,t:(1-r)/(o+1-r)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?O(t.slice(0,d),i):[],m=d<t.length?O(t.slice(d),i):[];f=f.map((t=>new e.pointGeometry(R(t.x),t.y))),m=m.map((t=>new e.pointGeometry(R(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const y=e.number(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let _;return _=c?[new e.pointGeometry(0,y),new e.pointGeometry(0,0),new e.pointGeometry(1,0),new e.pointGeometry(1,y)]:[new e.pointGeometry(1,y),new e.pointGeometry(1,1),new e.pointGeometry(0,1),new e.pointGeometry(0,y)],g.push(..._),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:!1}}(t,i);if(n)return n;const r=function(t,i){let n=!1,r=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),r=t[i],s=t[i+1];Math.abs(r.x-s.x)>.5&&(r.x<s.x?(r.x+=1,0===i&&(t[t.length-1].x+=1)):(s.x+=1,i+1===t.length-1&&(t[0].x+=1)),n=!0)}const s=e.mercatorXfromLng(i.center.lng);return n&&s<Math.abs(s-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:n}}(O(t,i).map((t=>new e.pointGeometry(R(t.x),t.y))),i);return{polygon:r.polygon.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:r.unwrapped}}}function O(t,i){return e.resample(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function R(e){return e<0?1+e%1:e%1}function B(e){return 100*e|0}function F(t,i,n,r,o){const s=function(n,r){if(n)return o(n);if(r){const n=e.pick(e.extend(r,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);r.vector_layers&&(n.vectorLayers=r.vector_layers,n.vectorLayerIds=n.vectorLayers.map((e=>e.id))),r.language_options&&(n.languageOptions=r.language_options),r.language&&r.language[r.id]&&(n.language=r.language[r.id]),r.worldview_options&&(n.worldviewOptions=r.worldview_options),r.worldview?n.worldview=r.worldview[r.id]:r.worldview_default&&(n.worldview=r.worldview_default),n.tiles=i.canonicalizeTileset(n,t.url),o(null,n)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url,null,n,r),e.ResourceType.Source),s):e.exported.frame((()=>s(null,t)))}class ${constructor(t,i,n){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),n=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),r=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),s=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=n&&t.x<o&&t.y>=r&&t.y<s}}class j{constructor(e,t,i){this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const N={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class U{constructor(e,t,i,n){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const n=t.attributes[this.attributes[i].name];void 0!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,i){for(let n=0;n<this.attributes.length;n++){const r=this.attributes[n],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[N[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class V{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class G extends V{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class q extends V{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class W extends V{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class H extends V{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Z extends V{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class X extends V{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class K extends V{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Y extends V{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class J extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Q extends V{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ee extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class te extends V{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ie extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class ne extends V{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class re extends V{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class oe extends V{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class se extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ae extends V{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class le extends V{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ce extends V{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ue extends V{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class he extends V{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class de extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class pe extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fe extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class me extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ge extends V{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ye extends V{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class _e extends V{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ve extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class xe extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class be extends V{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class we extends be{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Te extends be{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ke extends Te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Se{constructor(e,t,i,n){this.context=e,this.width=t,this.height=i;const r=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new we(e,r),n&&(this.depthAttachment=new Te(e,r))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Ce{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new q(this),this.clearStencil=new W(this),this.colorMask=new H(this),this.depthMask=new Z(this),this.stencilMask=new X(this),this.stencilFunc=new K(this),this.stencilOp=new Y(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ie(this),this.blendFunc=new ne(this),this.blendColor=new re(this),this.blendEquation=new oe(this),this.cullFace=new se(this),this.cullFaceSide=new ae(this),this.frontFace=new le(this),this.program=new ce(this),this.activeTexture=new ue(this),this.viewport=new he(this),this.bindFramebuffer=new de(this),this.bindRenderbuffer=new pe(this),this.bindTexture=new fe(this),this.bindVertexBuffer=new me(this),this.bindElementBuffer=new ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ye(this),this.pixelStoreUnpack=new _e(this),this.pixelStoreUnpackPremultiplyAlpha=new ve(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new j(this,e,t)}createVertexBuffer(e,t,i){return new U(this,e,t,i)}createRenderbuffer(e,t,i){const n=this.gl,r=n.createRenderbuffer();return this.bindRenderbuffer.set(r),n.renderbufferStorage(n.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,i){return new Se(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const n=this.gl;let r=0;e&&(r|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(r|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),n.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t(i.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ee extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.dispatcher=n,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=F(this._options,this.map._requestManager,null,null,((t,i)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new $(i.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(i.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const n=e.exported.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),((n,r,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):n?(t.state="errored",i(n)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(r,this.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(e,t,i){e.setTexture(t,i)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let Me;function Ae(t,i,n,r,o,s,a,l){const c=[t,n,o,i,r,s,1,1,1],u=[a,l,1],h=e.adjoint([],c),[d,p,f]=e.transformMat3(u,u,e.transpose(h,h));return e.multiply$1(c,[d,0,0,0,p,0,0,0,f],c)}class ze extends e.Evented{constructor(e,t,i,n){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=t}load(t,i){this._loaded=i||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,n)=>{if(this._loaded=!0,i)this.fire(new e.ErrorEvent(i));else if(n){const{HTMLImageElement:i}=e.window;this.image=n instanceof i?e.exported.getImageData(n):n,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const i=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){let i=1/0,n=1/0,r=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),n=Math.min(n,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y);const s=Math.max(r-i,o-n),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.CanonicalTileID(a,Math.floor((i+r)/2*l),Math.floor((n+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const i=e.tileTransform(this.tileID,this.map.transform.projection),[n,r,o,s]=this.coordinates.map((t=>{const n=i.projection.project(t[0],t[1]);return e.getTilePoint(i,n)._round()}));this.perspectiveTransform=function(t,i,n,r,o,s,a,l,c,u){const h=Ae(0,0,t,0,0,i,t,i),d=Ae(n,r,o,s,a,l,c,u);return e.multiply$1(d,e.adjoint(h,h),d),[d[6]/d[8]*t/e.EXTENT,d[7]/d[8]*i/e.EXTENT]}(this.width,this.height,n.x,n.y,r.x,r.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new e.StructArrayLayout4i8;a.emplaceBack(n.x,n.y,0,0),a.emplaceBack(r.x,r.y,e.EXTENT,0),a.emplaceBack(s.x,s.y,0,e.EXTENT),a.emplaceBack(o.x,o.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(a,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ie={vector:class extends e.Evented{constructor(t,i,n,r){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,n=this.worldview||this.map._worldview;this._tileJSONRequest=F(this._options,this.map._requestManager,i,n,((r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new e.ErrorEvent(r))):o&&(e.extend(this,o),o.bounds&&(this.tileBounds=new $(o.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load((()=>{const e=this.map.style._getSourceCaches(this.id);for(const t of e)t.clearTiles()}))}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}_setLanguage(e){return e===this.language||this.setSourceProperty((()=>{this.language=e})),this}_setWorldview(e){return e===this.worldview?this:this.worldviewOptions&&e&&!this.worldviewOptions[e]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${e}".`),this):(this.setSourceProperty((()=>{this.worldview=e})),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(r.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",r,o.bind(this));else if(t.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",r,o.bind(this),void 0,!0);else{const i=e.loadVectorTile.call({deduped:this._deduped},r,((e,i)=>{e||!i?o.call(this,e):(r.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",r,o.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function o(n,r){return delete t.request,t.aborted?i(null):n&&404!==n.status?i(n):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Ee,"raster-dem":class extends Ee{constructor(t,i,n,r){super(t,i,n,r),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,n){e&&(t.state="errored",i(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),function(n,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(n)t.state="errored",i(n);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const i=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==Me&&(Me=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),Me),n=1-(o.width-e.prevPowerOfTwo(o.width))/2;n<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.exported.getImageData(o,n),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:n};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,r.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,n=Math.pow(2,i.z),r=(i.x-1+n)%n,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+n)%n,a=i.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<n&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,r,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},n),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(n,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,r)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ze{constructor(e,t,i,n){super(e,t,i,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ze,canvas:class extends ze{constructor(t,i,n,r){super(t,i,n,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.Evented{constructor(t,i,n,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new $(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.extend(this,e.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const{x:n,y:r,z:o}=t.tileID.canonical,s=new e.window.AbortController,a=this._implementation.loadTile({x:n,y:r,z:o},{signal:s.signal});if(!a)return this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null);a.cancel=()=>s.abort(),t.request=a.then(function(n){return delete t.request,t.aborted?(t.state="unloaded",i(null)):n?function(t){return t instanceof e.window.ImageData||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLCanvasElement}(n)?(this.loadTileData(t,n),t.state="loaded",void i(null)):(t.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null))}.bind(this)).catch((e=>{20!==e.code&&(t.state="errored",i(e))}))}loadTileData(e,t){Ee.loadTileData(e,t,this._map.painter)}unloadTileData(e){Ee.unloadTileData(e,this._map.painter)}prepareTile(e){if(!this._implementation.prepareTile)return null;const{x:t,y:i,z:n}=e.tileID.canonical,r=this._implementation.prepareTile({x:t,y:i,z:n});return r?(this.loadTileData(e,r),e.state="loaded",r):null}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_update(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Le=function(t,i,n,r){const o=new Ie[i.type](t,i,n,r);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function De(t,i){const n=e.identity([]);return e.scale(n,n,[.5*t.width,.5*-t.height,1]),e.translate(n,n,[1,-1,0]),e.multiply(n,n,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function Pe(e,t,i,n,r,o,s,a=!1){const l=e.tilesIn(n,s,a);l.sort(Re);const c=[];for(const n of l)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(t,i,e._state,n,r,o,De(e.transform,n.tile.tileID),a)});const u=function(e){const t={},i={};for(const n of e){const e=n.queryResults,r=n.wrappedTileID,o=i[r]=i[r]||{};for(const i in e){const n=e[i],r=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of n)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const i=t.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(n["source-layer"],i.id):{})}));return u}function Oe(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),n=[],r={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(n,t))}return n}function Re(e,t){const i=e.tileID,n=t.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}function Be(){return null!=uo.workerClass?new uo.workerClass:new e.window.Worker(uo.workerUrl)}const Fe="mapboxgl_preloaded_worker_pool";class $e{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<$e.workerCount;)this.workers.push(new Be);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Fe]}numActive(){return Object.keys(this.active).length}}let je;function Ne(){return je||(je=new $e),je}function Ue(t,i){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(n[e]=i[e])})),n}function Ve(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Ue(e[i],t[e[i].ref]));return e}$e.workerCount=2;const Ge={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qe(e,t,i){i.push({command:Ge.addSource,args:[e,t[e]]})}function We(e,t,i){t.push({command:Ge.removeSource,args:[e]}),i[e]=!0}function He(e,t,i,n){We(e,i,n),qe(e,t,i)}function Ze(e,i,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;for(r in i[n])if(i[n].hasOwnProperty(r)&&"data"!==r&&!t(e[n][r],i[n][r]))return!1;return!0}function Xe(e,i,n,r,o,s){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],i[a])||n.push({command:s,args:[r,a,i[a],o]}))}function Ke(e){return e.id}function Ye(e,t){return e[t.id]=t,e}class Je{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,n=this._distances[i];const r=t*this.paddedLength+this.padding;for(;n<r&&i<this._distances.length;)n=this._distances[++i];const o=i-1,s=this._distances[o],a=n-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Qe{constructor(e,t,i){const n=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,n,r){this._forEachCell(t,i,n,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)}insertCircle(e,t,i,n){this._forEachCell(t-n,i-n,t+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(n)}_insertBoxCell(e,t,i,n,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,i,n,r,o){this.circleCells[r].push(o)}_query(e,t,i,n,r,o){if(i<0||e>this.width||n<0||t>this.height)return!r&&[];const s=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=n){if(r)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],n=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-n,y1:i-n,x2:t+n,y2:i+n})}return o?s.filter(o):s}return this._forEachCell(e,t,i,n,this._queryCell,s,{hitTest:r,seenUids:{box:{},circle:{}}},o),r?s.length>0:s}_queryCircle(e,t,i,n,r){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),n?c.length>0:c}query(e,t,i,n,r){return this._query(e,t,i,n,!1,r)}hitTest(e,t,i,n,r){return this._query(e,t,i,n,!0,r)}hitTestCircle(e,t,i,n){return this._queryCircle(e,t,i,!0,n)}_queryCell(e,t,i,n,r,o,s,a){const l=s.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=r[c+2]&&t<=r[c+3]&&i>=r[c+0]&&n>=r[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]})}}}const u=this.circleCells[r];if(null!==u){const r=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(r[u],r[u+1],r[u+2],e,t,i,n)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=r[u],t=r[u+1],i=r[u+2];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,n,r,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[r];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[r];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,n,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(n);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,i,n,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,n,r,o){const s=n-e,a=r-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,n,r,o,s){const a=(o-n)/2,l=Math.abs(e-(n+a));if(l>a+i)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const et=Math.tan(85*Math.PI/180);function tt(t,i,n,r,o,s,a){const l=e.create();if(n)if("globe"===s.name){const t=e.calculateGlobeLabelMatrix(o,i);e.multiply(l,l,t)}else{const t=_([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.rotateZ(l,l,o.angle)}else e.multiply(l,o.labelPlaneMatrix,t);return l}function it(e,t,i,n,r,o,s){const a=tt(e,t,i,n,r,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function nt(t,i,n,r,o,s,a){if(n){if("globe"===s.name){const l=tt(t,i,n,r,o,s,a);return e.invert(l,l),e.multiply(l,t,l),l}{const i=e.clone(t),n=e.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],e.multiply(i,i,n),r||e.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function rt(t,i,n=0){const r=[t.x,t.y,n,1];n?e.transformMat4$1(r,r,i):yt(r,r,i);const o=r[3];return{point:[r[0]/o,r[1]/o,r[2]/o],signedDistanceFromCamera:o}}function ot(t,i){const n=[t[0],t[1],t[2],1];e.transformMat4$1(n,n,i);const r=n[3];return{point:[n[0]/r,n[1]/r,n[2]/r],signedDistanceFromCamera:r}}function st(e,t){return Math.min(.5+e/t*.5,1.5)}function at(e,t){const i=e[0]/e[3],n=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&n>=-t[1]&&n<=t[1]}function lt(t,i,n,r,o,s,a,l,c,u){const h=n.transform,d=r?t.textSizeData:t.iconSizeData,p=e.evaluateSizeForZoom(d,n.transform.zoom),f="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let y=null;f&&(y=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,v=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let b=!1;for(let r=0;r<v.length;r++){const f=v.get(r);if(f.writingMode!==e.WritingMode.vertical||b||0!==r&&v.get(r-1).writingMode===e.WritingMode.horizontal||(b=!0),(f.hidden||f.writingMode===e.WritingMode.vertical)&&!b){gt(f.numGlyphs,g);continue}b=!1;const w=new e.pointGeometry(f.tileAnchorX,f.tileAnchorY),T=c?c(w):[0,0,0],k=h.projection.projectTilePoint(w.x,w.y,u.canonical),S=[k.x+T[0],k.y+T[1],k.z+T[2]],C=[...S,1];if(e.transformMat4$1(C,C,i),!at(C,m)){gt(f.numGlyphs,g);continue}const E=st(n.transform.cameraToCenterDistance,C[3]),M=e.evaluateSizeForFeature(d,p,f),A=a?M/E:M*E,z=rt(new e.pointGeometry(S[0],S[1]),o,S[2]);if(z.signedDistanceFromCamera<=0){gt(f.numGlyphs,g);continue}let I={};const L=a?null:c,D=ht(f,A,!1,l,i,o,s,t.glyphOffsetArray,_,g,y,z.point,w,I,x,L,h.projection,u,a);b=D.useVertical,L&&D.needsFlipping&&(I={}),(D.notEnoughRoom||b||D.needsFlipping&&ht(f,A,!0,l,i,o,s,t.glyphOffsetArray,_,g,y,z.point,w,I,x,L,h.projection,u,a).notEnoughRoom)&&gt(f.numGlyphs,g)}r?(t.text.dynamicLayoutVertexBuffer.updateData(g),y&&t.text.globeExtVertexBuffer.updateData(y)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),y&&t.icon.globeExtVertexBuffer.updateData(y))}function ct(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=a.glyphStartIndex+a.numGlyphs,y=a.lineStartIndex,_=a.lineStartIndex+a.lineLength,v=t.getoffsetX(a.glyphStartIndex),x=t.getoffsetX(g-1),b=ft(e*v,i,n,r,o,s,a.segment,y,_,l,c,u,h,d,!0,p,f,m);if(!b)return null;const w=ft(e*x,i,n,r,o,s,a.segment,y,_,l,c,u,h,d,!0,p,f,m);return w?{first:b,last:w}:null}function ut(t,i,n,r){return t.writingMode===e.WritingMode.horizontal&&Math.abs(n.y-i.y)>Math.abs(n.x-i.x)*r?{useVertical:!0}:t.writingMode===e.WritingMode.vertical?i.y<n.y?{needsFlipping:!0}:null:0!==t.flipState&&function(e,t,i){const n=(t.x-e.x)*i;return 0===n||Math.abs((t.y-e.y)/n)>et}(i,n,r)?1===t.flipState?{needsFlipping:!0}:null:i.x>n.x?{needsFlipping:!0}:null}function ht(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v){const x=i/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x;let T;if(t.numGlyphs>1){const i=t.glyphStartIndex+t.numGlyphs,o=t.lineStartIndex,u=t.lineStartIndex+t.lineLength,h=ct(x,l,b,w,n,d,p,t,c,s,f,g,!1,y,_,v);if(!h)return{notEnoughRoom:!0};const k=ot(h.first.point,a).point,S=ot(h.last.point,a).point,C=new e.pointGeometry(k[0],k[1]),E=new e.pointGeometry(S[0],S[1]);if(r&&!n){const e=ut(t,C,E,m);if(t.flipState=e&&e.needsFlipping?1:2,e)return e}T=[h.first];for(let e=t.glyphStartIndex+1;e<i-1;e++)T.push(ft(x*l.getoffsetX(e),b,w,n,d,p,t.segment,o,u,c,s,f,g,!1,!1,y,_,v));T.push(h.last)}else{if(r&&!n){const i=rt(p,o).point,n=t.lineStartIndex+t.segment+1,r=new e.pointGeometry(c.getx(n),c.gety(n)),s=rt(r,o),a=s.signedDistanceFromCamera>0?s.point:pt(p,r,i,1,o,void 0,y,_.canonical),l=ut(t,new e.pointGeometry(i[0],i[1]),new e.pointGeometry(a[0],a[1]),m);if(t.flipState=l&&l.needsFlipping?1:2,l)return l}const i=ft(x*l.getoffsetX(t.glyphStartIndex),b,w,n,d,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,s,f,g,!1,!1,y,_,v);if(!i)return{notEnoughRoom:!0};T=[i]}if(h)for(const t of T)e.updateGlobeVertexNormal(h,u.length+0,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+1,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+2,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+3,t.up[0],t.up[1],t.up[2]),e.addDynamicAttributes(u,t.point[0],t.point[1],t.point[2],t.angle);else for(const t of T)e.addDynamicAttributes(u,t.point[0],t.point[1],t.point[2],t.angle);return{}}function dt(t,i,n,r,o){const s=r.projectTilePoint(t.x,t.y,i);if(!o)return rt(s,n,s.z);const a=o(t);return rt(new e.pointGeometry(s.x+a[0],s.y+a[1]),n,s.z+a[2])}function pt(t,i,n,r,o,s,a,l){const c=dt(t.add(t.sub(i)._unit()),l,o,a,s).point,u=e.sub([],n,c);return e.scaleAndAdd([],n,u,r/e.length(u))}function ft(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=r?t-i:t+i;let x=v>0?1:-1,b=0;r&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=x>0?l+a:l+a+1,T=o,k=o,S=0,C=0;const E=Math.abs(v),M=[],A=[];let z=s;const I=()=>{const t=w-x;return 0===S?s:new e.pointGeometry(u.getx(t),u.gety(t))},L=()=>pt(I(),z,k,E-S+1,h,p,g,y.canonical);for(;S+C<=E;){if(w+=x,w<l||w>=c)return null;if(k=T,M.push(T),f&&A.push(z||I()),T=d[w],void 0===T){z=new e.pointGeometry(u.getx(w),u.gety(w));const t=dt(z,y.canonical,h,g,p);T=t.signedDistanceFromCamera>0?d[w]=t.point:L()}else z=null;S+=C,C=e.distance(k,T)}z=z||new e.pointGeometry(u.getx(w),u.gety(w));const D=I();m&&p&&(d[w]=T=void 0===d[w]?T:L(),C=e.distance(k,T));const P=(E-S)/C,O=z.sub(D).mult(P)._add(D),R=e.sub([],T,k),B=e.scaleAndAdd([],k,R,P);let F=[0,0,1],$=R[0],j=R[1];if(_&&(F=g.upVector(y.canonical,O.x,O.y),0!==F[0]||0!==F[1]||1!==F[2])){const t=[1,0,0],i=[0,1,0];t[0]=F[2],t[1]=0,t[2]=-F[0],e.cross(i,F,t),e.normalize(t,t),e.normalize(i,i),$=e.dot(R,t),j=e.dot(R,i)}if(n){const t=e.cross([],F,R);e.normalize(t,t),e.scaleAndAdd(B,B,t,n*x)}const N=b+Math.atan2(j,$);return M.push(B),f&&A.push(O),{point:B,angle:N,path:M,tilePath:A,up:F}}const mt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gt(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(mt,4*e)}}function yt(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e[3]=i[3]*n+i[7]*r+i[15],e}const _t=100;class vt{constructor(e,t,i=new Qe(e.width+200,e.height+200,25),n=new Qe(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_t,this.screenBottomBoundary=e.height+_t,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,n,r,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID;if(h&&d){const t=e.getProjection().upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=e.getProjection().upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t[0]*h*n,c+=t[1]*h*n,u+=t[2]*h*n}const p=this.projectAndGetPerspectiveRatio(s,[l,c,u],i.tileID,"globe"===e.projection.name||!!h||this.transform.pitch>0,e.getProjection()),f=o*p.perspectiveRatio,m=(i.x1*t+n.x-i.padding)*f+p.point.x,g=(i.y1*t+n.y-i.padding)*f+p.point.y,y=(i.x2*t+n.x+i.padding)*f+p.point.x,_=(i.y2*t+n.y+i.padding)*f+p.point.y,v=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(m,g,y,_)||!r&&this.grid.hitTest(m,g,y,_,a)||v?{box:[],offscreen:!1,occluded:p.occluded}:{box:[m,g,y,_],offscreen:this.isOffscreen(m,g,y,_),occluded:!1}}placeCollisionCircles(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m){const g=[],y=this.transform.elevation,_=y?y.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,t.getProjection()):e=>[0,0,0],v=new e.pointGeometry(n.tileAnchorX,n.tileAnchorY),x=t.getProjection().projectTilePoint(n.tileAnchorX,n.tileAnchorY,m.canonical),b=_(v),w=[x.x+b[0],x.y+b[1],x.z+b[2]],T="globe"===t.projection.name,k=this.projectAndGetPerspectiveRatio(a,[w[0],w[1],w[2]],m,T||!!y||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:S}=k,C=(h?s/S:s*S)/e.ONE_EM,E=rt(new e.pointGeometry(w[0],w[1]),l,w[2]).point,M=k.signedDistanceFromCamera>0?ct(C,o,n.lineOffsetX*C,n.lineOffsetY*C,!1,E,v,n,r,l,{},y&&!h?_:null,h&&!!y,t.getProjection(),m,h):null;let A=!1,z=!1,I=!0;if(M&&!k.occluded){const t=.5*p*S+f,n=new e.pointGeometry(-100,-100),r=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Je,s=M.first,a=M.last;let l=[];for(let e=s.path.length-1;e>=1;e--)l.push(s.path[e]);for(let e=1;e<a.path.length;e++)l.push(a.path[e]);const h=2.5*t;if(c){const e=l.map(y&&!T?(e,t)=>{const i=_(t<s.path.length-1?s.tilePath[s.path.length-1-t]:a.tilePath[t-s.path.length+2]);return e[2]=i[2],ot(e,c)}:e=>ot(e,c));l=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let m=[];if(l.length>0){const t=l.map((t=>new e.pointGeometry(t[0],t[1])));let i=1/0,o=-1/0,s=1/0,a=-1/0;for(let e=0;e<t.length;e++)i=Math.min(i,t[e].x),s=Math.min(s,t[e].y),o=Math.max(o,t[e].x),a=Math.max(a,t[e].y);m=i>=n.x&&o<=r.x&&s>=n.y&&a<=r.y?[t]:o<n.x||i>r.x||a<n.y||s>r.y?[]:e.clipLine([t],n.x,n.y,r.x,r.y)}for(const e of m){o.reset(e,.25*t);let n=0;n=o.length<=.5*t?1:Math.ceil(o.paddedLength/h)+1;for(let e=0;e<n;e++){const r=e/Math.max(n-1,1),s=o.lerp(r),a=s.x+_t,l=s.y+_t;g.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(I=I&&this.isOffscreen(c,h,p,f),z=z||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,t,d)&&(A=!0,!u))return{circles:[],offscreen:!1,collisionDetected:A,occluded:!1}}}}return{circles:!u&&A||!z?[]:g,offscreen:I,collisionDetected:A,occluded:k.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.pointGeometry(a.x+_t,a.y+_t);n=Math.min(n,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(n,r,o,s).concat(this.ignoredGrid.query(n,r,o,s)),l={},c={};for(const t of a){const n=t.key;if(void 0===l[n.bucketInstanceId]&&(l[n.bucketInstanceId]={}),l[n.bucketInstanceId][n.featureIndex])continue;const r=[new e.pointGeometry(t.x1,t.y1),new e.pointGeometry(t.x2,t.y1),new e.pointGeometry(t.x2,t.y2),new e.pointGeometry(t.x1,t.y2)];e.polygonIntersectsPolygon(i,r)&&(l[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(e,t,i,n,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,n,r){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:n,collisionGroupID:r};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,n,r,o){const s=[i[0],i[1],i[2],1];let a=!1;if(i[2]||this.transform.pitch>0){e.transformMat4$1(s,s,t);const r="globe"===o.name;this.fogState&&n&&!r&&(a=function(t,i,n,r,o,s){const a=s.calculateFogTileMatrix(o),l=[i,n,r];return e.transformMat4(l,l,a),E(t,l,s.pitch,s._fov)}(this.fogState,i[0],i[1],i[2],n.toUnwrapped(),this.transform)>.9)}else yt(s,s,t);return{point:new e.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+_t,(-s[1]/s[3]+1)/2*this.transform.height+_t),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/s[3]*.5,1.5),signedDistanceFromCamera:s[3],occluded:r&&s[2]>s[3]||a}}isOffscreen(e,t,i,n){return i<_t||e>=this.screenRightBoundary||n<_t||t>this.screenBottomBoundary}isInsideGrid(e,t,i,n){return i>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}function xt(t,i,n){const r=i.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,r)}function bt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const n=i.clone();return n.setProjection(t.projection),xt(n,t.getProjection(),e)}function wt(e,t,i){return t.name===i.projection.name?e.projMatrix:xt(i,t,e)}class Tt{constructor(e,t,i,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class kt{constructor(e,t,i,n,r,o=!1){this.text=new Tt(e?e.text:null,t,i,r),this.icon=new Tt(e?e.icon:null,t,n,r),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class St{constructor(e,t,i,n=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=n}}class Ct{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class Et{constructor(e,t,i,n,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=r}}class Mt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function At(t,i,n,r,o){const{horizontalAlign:s,verticalAlign:a}=e.getAnchorAlignment(t),l=-(s-.5)*i,c=-(a-.5)*n,u=e.evaluateVariableOffset(t,r);return new e.pointGeometry(l+u[0]*o,c+u[1]*o)}function zt(t,i,n,r,o){const s=new e.pointGeometry(t,i);return n&&s._rotate(r?o:-o),s}class It{constructor(e,t,i,n,r){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new vt(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Mt(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,n,r){const o=n.getBucket(i),s=n.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/e.EXTENT,h=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=n.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):xt(m,f,p));var p,f,m;const g="map"===a.get("text-pitch-alignment"),y="map"===a.get("text-rotation-alignment");i.compileFilter();const _=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(n),b=it(d,n.tileID.canonical,g,y,this.transform,o.getProjection(),x);let w=null;if(g){const t=nt(d,n.tileID.canonical,g,y,this.transform,o.getProjection(),x);w=e.multiply([],this.transform.labelPlaneMatrix,t)}let T=null;_&&n.latestFeatureIndex&&(T={unwrappedTileID:h,dynamicFilter:_,dynamicFilterNeedsFeature:v,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new Et(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,n.tileID);const k={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:T,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:r,parameters:k})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:k})}attemptAnchorPlacement(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=[h.textOffset0,h.textOffset1],v=At(e,i,n,_,r),x=this.collisionIndex.placeCollisionBox(p,r,t,zt(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p,p.getSymbolInstanceIconSize(y,this.transform.zoom,d),m,zt(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)&&x.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(t=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:i,height:n,anchor:e,textScale:r,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(t,i,n,r){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,y=s.get("text-optional"),_=s.get("icon-optional"),v=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),T="none"!==s.get("icon-text-fit"),k="viewport-y"===s.get("symbol-z-order");this.transform.setProjection(o.projection);let S=v&&(x||!o.hasIconData()||_),C=x&&(v||!o.hasTextData()||y);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),n&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const E=(t,r,p)=>{if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let r=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];r=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,r,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.pointGeometry(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[t.crossTileID]=new St(!1,!1,!1,!0),void(i[t.crossTileID]=!0)}if(i[t.crossTileID])return;if(d)return void(this.placements[t.crossTileID]=new St(!1,!1,!1));let k=!1,E=!1,M=!0,A=!1,z=!1,I=null,L={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},P=null,O=null,R=null,B=0,F=0,$=0;p.textFeatureIndex?B=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(B=t.featureIndex),p.verticalTextFeatureIndex&&(F=p.verticalTextFeatureIndex);const j=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,e.tileAnchorX,e.tileAnchorY):0)},N=p.textBox;if(N){j(N);const i=i=>{let n=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,n=e,this.markUsedOrientation(o,n,t))}return n},n=(i,n)=>{if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&p.verticalTextBox){for(const t of o.writingModes)if(t===e.WritingMode.vertical?(L=n(),D=L):L=i(),L&&L.box&&L.box.length)break}else L=i()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,n)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),c=(e.x2-e.x1)*s+2*e.padding,u=(e.y2-e.y1)*s+2*e.padding,d=T&&!x?i:null;d&&j(d);let p={box:[],offscreen:!1,occluded:!1};const y=v?2*l.length:l.length;for(let i=0;i<y;++i){const y=this.attemptAnchorPlacement(l[i%l.length],e,c,u,s,b,w,h,a,g,i>=l.length,t,r,o,n,d,f,m);if(y&&(p=y.placedGlyphBoxes,p&&p.box&&p.box.length)){k=!0,I=y.shift;break}}return p};n((()=>c(N,p.iconBox,e.WritingMode.horizontal)),(()=>{const i=p.verticalTextBox;return i&&j(i),o.allowVerticalPlacement&&!(L&&L.box&&L.box.length)&&t.numVerticalGlyphVertices>0&&i?c(i,p.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),L&&(k=L.box,M=L.offscreen,A=L.occluded);const u=i(L&&L.box);if(!k&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const s=(i,n)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,r),l=this.collisionIndex.placeCollisionBox(o,s,i,new e.pointGeometry(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,n,t),this.placedOrientations[t.crossTileID]=n),l};n((()=>s(N,e.WritingMode.horizontal)),(()=>{const i=p.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?(j(i),s(i,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(L&&L.box&&L.box.length)}}if(P=L,k=P&&P.box&&P.box.length>0,M=P&&P.offscreen,A=P&&P.occluded,t.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.evaluateSizeForFeature(o.textSizeData,f,i),u=s.get("text-padding");O=this.collisionIndex.placeCollisionCircles(o,v,i,o.lineVertexArray,o.glyphOffsetArray,r,a,l,c,n,w,g.predicate,t.collisionCircleDiameter*r/e.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),k=v||O.circles.length>0&&!O.collisionDetected,M=M&&O.offscreen,A=O.occluded}if(p.iconFeatureIndex&&($=p.iconFeatureIndex),p.iconBox){const t=t=>{j(t);const i=T&&I?zt(I.x,I.y,b,w,this.transform.angle):new e.pointGeometry(0,0),n=o.getSymbolInstanceIconSize(m,this.transform.zoom,r);return this.collisionIndex.placeCollisionBox(o,n,t,i,x,h,a,g.predicate)};D&&D.box&&D.box.length&&p.verticalIconBox?(R=t(p.verticalIconBox),E=R.box.length>0):(R=t(p.iconBox),E=R.box.length>0),M=M&&R.offscreen,z=R.occluded}const U=y||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,V=_||0===t.numIconVertices;if(U||V?V?U||(E=E&&k):k=E&&k:E=k=E&&k,k&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,s.get("text-ignore-placement"),o.bucketInstanceId,D&&D.box&&F?F:B,g.ID),E&&R&&this.collisionIndex.insertCollisionBox(R.box,s.get("icon-ignore-placement"),o.bucketInstanceId,$,g.ID),O&&(k&&this.collisionIndex.insertCollisionCircles(O.circles,s.get("text-ignore-placement"),o.bucketInstanceId,B,g.ID),n)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Ct);for(let e=0;e<O.circles.length;e+=4)t.circles.push(O.circles[e+0]),t.circles.push(O.circles[e+1]),t.circles.push(O.circles[e+2]),t.circles.push(O.collisionDetected?1:0)}const G="globe"!==o.projection.name;S=S&&(G||!A),C=C&&(G||!z),this.placements[t.crossTileID]=new St(k||S,E||C,M||o.justReloaded),i[t.crossTileID]=!0};if(k){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];E(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)E(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,i,n,r){let o;o=r===e.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(i)];const s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:n.crossTileID)}markUsedOrientation(t,i,n){const r=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,o=i===e.WritingMode.vertical?i:0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=r;n.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new kt(o,n,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new kt(null,n,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new kt(t,n,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,n.collisionBoxArray)}}updateBucketOpacities(t,i,n){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const r=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),s=new kt(null,0,!1,!1,!0),a=r.get("text-allow-overlap"),l=r.get("icon-allow-overlap"),c=r.get("text-variable-anchor"),u="map"===r.get("text-rotation-alignment"),h="map"===r.get("text-pitch-alignment"),d="none"!==r.get("icon-text-fit"),p=new kt(null,0,a&&(l||!t.hasIconData()||r.get("icon-optional")),l&&(a||!t.hasTextData()||r.get("text-optional")),!0);!t.collisionArrays&&n&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(n);const f=(e,t,i)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(i)};let m=0;for(let n=0;n<t.symbolInstances.length;n++){const r=t.symbolInstances.get(n),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:g}=r;let y=this.opacities[g];i[g]?y=s:y||(y=p,this.opacities[g]=y),i[g]=!0;const _=a>0||l>0,v=r.numIconVertices>0,x=this.placedOrientations[r.crossTileID],b=x===e.WritingMode.vertical,w=x===e.WritingMode.horizontal||x===e.WritingMode.horizontalOnly;if(!_&&!v||y.isHidden()||m++,_){const e=jt(y.text);f(t.text,a,b?Nt:e),f(t.text,l,w?Nt:e);const i=y.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||b?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=i||w?1:0);const n=this.variableOffsets[r.crossTileID];n&&this.markUsedJustification(t,n.anchor,r,x);const o=this.placedOrientations[r.crossTileID];o&&(this.markUsedJustification(t,"left",r,o),this.markUsedOrientation(t,o,r))}if(v){const e=jt(y.icon);r.placedIconSymbolIndex>=0&&(f(t.icon,r.numIconVertices,b?Nt:e),t.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=y.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,r.numVerticalIconVertices,w?Nt:e),t.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[n];if(i){let n=new e.pointGeometry(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[g];e?(n=At(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&n._rotate(h?this.transform.angle:-this.transform.angle)):r=!1}o&&(r=!y.clipped),i.textBox&&Lt(t.textCollisionBox.collisionVertexArray,y.text.placed,!r||b,n.x,n.y),i.verticalTextBox&&Lt(t.textCollisionBox.collisionVertexArray,y.text.placed,!r||w,n.x,n.y)}const s=r&&Boolean(!w&&i.verticalIconBox);i.iconBox&&Lt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,s,d?n.x:0,d?n.y:0),i.verticalIconBox&&Lt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,d?n.x:0,d?n.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Lt(e,t,i,n,r){e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0),e.emplaceBack(t?1:0,i?1:0,n||0,r||0)}const Dt=Math.pow(2,25),Pt=Math.pow(2,24),Ot=Math.pow(2,17),Rt=Math.pow(2,16),Bt=Math.pow(2,9),Ft=Math.pow(2,8),$t=Math.pow(2,1);function jt(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Dt+t*Pt+i*Ot+t*Rt+i*Bt+t*Ft+i*$t+t}const Nt=0;class Ut{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,n,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,r())return!0}return!1}}class Vt{constructor(e,t,i,n,r,o,s,a){this.placement=new It(e,r,o,s,a),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,i,n){const r=e.exported.now(),o=()=>{const t=e.exported.now()-r;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],r=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=r)&&(!e.maxzoom||e.maxzoom>r)){if(this._inProgressLayer||(this._inProgressLayer=new Ut(e)),this._inProgressLayer.continuePlacement(n[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Gt=512/e.EXTENT/2;class qt{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<t.length;i++){const n=t.get(i),r=n.key;this.indexedSymbolInstances[r]||(this.indexedSymbolInstances[r]=[]),this.indexedSymbolInstances[r].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,e)})}}getScaledCoordinates(t,i){const n=Gt/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.tileAnchorX)*n),y:Math.floor((i.canonical.y*e.EXTENT+t.tileAnchorY)*n)}}findMatches(e,t,i){const n=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const o=e.get(r);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);for(const e of s)if(Math.abs(e.coord.x-a.x)<=n&&Math.abs(e.coord.y-a.y)<=n&&!i[e.crossTileID]){i[e.crossTileID]=!0,o.crossTileID=e.crossTileID;break}}}}class Wt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ht{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],n={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),n[r.tileID.key]=r}this.indexes[e]=n}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,n)}else{const o=r[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=i.generate(),n[r.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new qt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const n of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][n.crossTileID]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const n=this.indexes[i];for(const r in n)e[n[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[r]),delete n[r],t=!0)}return t}}class Zt{constructor(){this.layerIndexes={},this.crossTileIDs=new Wt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,n){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new Ht);let o=!1;const s={};"globe"!==n.name&&r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Xt=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Kt=e.pick(Ge,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yt=e.pick(Ge,["setCenter","setZoom","setBearing","setPitch"]),Jt={version:8,layers:[],sources:{}},Qt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ei extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new L(Ne(),this),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,i.localFontFamily?e.LocalGlyphMode.all:i.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.lineAtlas=new e.LineAtlas(256,512),this.crossTileSymbolIndex=new Zt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const n=this;this._rtlTextPluginCallback=ei.registerForPluginStateChange((t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in n._sourceCaches){const t=n._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const r=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,n)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Jt,!1)}_updateLayerCount(e,t){const i=t?1:-1;e.is3D()&&(this._num3DLayers+=i),"circle"===e.type&&(this._numCircleLayers+=i),"symbol"===e.type&&(this._numSymbolLayers+=i)}_load(t,i){if(i&&Xt(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection();for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const n=Ve(this.stylesheet.layers);this._order=n.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of n)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new T(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(t,i,n){let r,o,s;const a=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,s||(s=e,r=t,u())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)n(s);else if(r&&o){const t=e.exported.getImageData(o),i={};for(const n in r){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=r[n],f=new e.RGBAImage({width:o,height:s});e.RGBAImage.copy(t,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[n]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}n(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const n=t.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Qt[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const n={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];n[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const n=this.map.painter;if(n){const e=i.getProgramIds();if(!e)continue;const r=i.getProgramConfiguration(t.zoom);for(const t of e)n.useProgram(t,r)}}for(const t in n){const i=this._sourceCaches[t];n[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Xt(this,e.validateStyle(i)))return!1;(i=e.clone$1(i)).layers=Ve(i.layers);const n=function(e,i){if(!e)return[{command:Ge.setStyle,args:[i]}];let n=[];try{if(!t(e.version,i.version))return[{command:Ge.setStyle,args:[i]}];t(e.center,i.center)||n.push({command:Ge.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||n.push({command:Ge.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||n.push({command:Ge.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||n.push({command:Ge.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||n.push({command:Ge.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||n.push({command:Ge.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||n.push({command:Ge.setTransition,args:[i.transition]}),t(e.light,i.light)||n.push({command:Ge.setLight,args:[i.light]}),t(e.fog,i.fog)||n.push({command:Ge.setFog,args:[i.fog]}),t(e.projection,i.projection)||n.push({command:Ge.setProjection,args:[i.projection]});const r={},o=[];!function(e,i,n,r){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||We(o,n,r));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&Ze(e,i,o)?n.push({command:Ge.setGeoJSONSourceData,args:[o,i[o].data]}):He(o,i,n,r)):qe(o,i,n))}(e.sources,i.sources,o,r);const s=[];e.layers&&e.layers.forEach((e=>{e.source&&r[e.source]?n.push({command:Ge.removeLayer,args:[e.id]}):s.push(e)}));let a=e.terrain;a&&r[a.source]&&(n.push({command:Ge.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),t(a,i.terrain)||n.push({command:Ge.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const r=(e=e||[]).map(Ke),o=i.map(Ke),s=e.reduce(Ye,{}),a=i.reduce(Ye,{}),l=r.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(n.push({command:Ge.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:Ge.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],n.push({command:Ge.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in Xe(p.layout,f.layout,n,d,null,Ge.setLayoutProperty),Xe(p.paint,f.paint,n,d,null,Ge.setPaintProperty),t(p.filter,f.filter)||n.push({command:Ge.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||n.push({command:Ge.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],n,d,g.slice(6),Ge.setPaintProperty):t(p[g],f[g])||n.push({command:Ge.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],n,d,g.slice(6),Ge.setPaintProperty):t(p[g],f[g])||n.push({command:Ge.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:Ge.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],n.push({command:Ge.addLayer,args:[f,m]})}(s,i.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:Ge.setStyle,args:[i]}]}return n}(this.serialize(),i).filter((e=>!(e.command in Yt)));if(0===n.length)return!1;const r=n.filter((e=>!(e.command in Kt)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);return n.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,i,n={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateSource,`sources.${t}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=Le(t,i,this.dispatcher,this);r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:r.serialize(),sourceId:t})));const o=i=>{const n=(i?"symbol:":"other:")+t,o=this._sourceCaches[n]=new e.SourceCache(n,r,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),r.onAdd&&r.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const n=this._getSourceCaches(t);for(const t of n)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,i,n={}){this._checkLoaded();const r=t.id;if(this.getLayer(r))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${r}" already exists on this map`)));let o;if("custom"===t.type){if(Xt(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.clone$1(t),t=e.extend(t,{source:r})),this._validate(e.validateLayer,`layers.${r}`,t,{arrayIndex:-1},n))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[r]&&o.source&&a&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);const r=i?this._order.indexOf(i):this._order.length;i&&-1===r?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(r,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const n=this._order.indexOf(t);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,i,n){this._checkLoaded();const r=this.getLayer(t);r?r.minzoom===i&&r.maxzoom===n||(null!=i&&(r.minzoom=i),null!=n&&(r.maxzoom=n),this._updateLayer(r)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,n,r={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!t(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateFilter,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=e.clone$1(n),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const i=this.getLayer(t);return i&&e.clone$1(i.filter)}setLayoutProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getLayoutProperty(n),r)||(s.setLayoutProperty(n,r,o),this._updateLayer(s)):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const n=this.getLayer(t);if(n)return n.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(i,n,r,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getPaintProperty(n),r)||(s.setPaintProperty(n,r,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){const i=this.getLayer(e);return i&&i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const n=t.source,r=t.sourceLayer,o=this.getSource(n);if(!o)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&r)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!r)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(n);for(const e of a)e.setFeatureState(r,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const n=t.source,r=this.getSource(n);if(!r)return void this.fire(new e.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)));const o=r.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(n);for(const e of a)e.removeFeatureState(s,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,n=t.sourceLayer,r=this.getSource(i);if(r){if("vector"!==r.type||n)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(n,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},n=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){i[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(i[t.layer.id]<o)break;r.push(t),n.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(t,i,n){i&&i.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const r={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];r[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=P.createFromScreenPoints(t,n);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!r[t]||o.push(Pe(this._sourceCaches[e],this._layers,this._serializedLayers,a,i,n,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,i,n,r,o,s){const a={},l=o.queryRenderedSymbols(n),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(Re);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in n){const t=a[e]=a[e]||[],r=n[e];r.sort(((e,t)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(e.featureIndex);return n.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in a)a[t].forEach((n=>{const r=n.feature,o=i(e[t]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const n=this._getSourceCaches(t);let r=[];for(const e of n)r=r.concat(Oe(e,i));return r}addSourceType(e,t,i){return ei.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(ei.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const n=this.light.getLight();let r=!1;for(const i in e)if(!t(e[i],n[i])){r=!0;break}if(!r)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,n=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===n){if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.clone$1(i),i=e.extend(i,{source:t})}if(this._validate(e.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode)this._createTerrain(i,n);else{const n=this.terrain,r=n.get();for(const t of Object.keys(e.spec.terrain))!i.hasOwnProperty(t)&&e.spec.terrain[t].default&&(i[t]=e.spec.terrain[t].default);for(const e in i)if(!t(i[e],r[e])){n.set(i),this.stylesheet.terrain=i;const e=this._setTransitionParameters({duration:0});n.updateTransitions(e);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new I(e,this.map.transform);this.stylesheet.fog=e;const i=this._setTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,n=i.get();0===Object.keys(e).length&&i.set(e);for(const r in e)if(!t(e[r],n[r])){i.set(e),this.stylesheet.fog=e;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new C(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const n=this._setTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,n,r,o={}){return(!o||!1!==o.validate)&&Xt(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:n,styleSpec:e.spec},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,n,r,o=!1){let s=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const n=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng,t.projection);s=s||n}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===n,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Vt(t,this._order,o,i,n,r,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const n=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};n(this._otherSourceCaches[t.source]),n(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,n){return e.makeRequest(i,n)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this._getSourceCaches(t);return 0===i.length?(this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ei.getSourceType=function(e){return Ie[e]},ei.setSourceType=function(e,t){Ie[e]=t},ei.registerForPluginStateChange=e.registerForPluginStateChange;var ti="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ii="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ni={},ri={};ni=ci("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ri=ci("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const oi=ci("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),si=ti,ai="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var li={background:ci("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ci("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ci("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ci("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ci("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ci("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ci("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ci("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ci("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ci("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ci("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ci("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ci("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ci("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxGradient:ci("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxCapture:ci("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ci("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ci(e,t,i){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=e.match(r),a=t.match(r),l=ti.match(r);let c=a?a.concat(s):s;i||(ni.staticUniforms&&(c=ni.staticUniforms.concat(c)),ri.staticUniforms&&(c=ri.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:e=e.replace(n,((e,t,i,n,r)=>(u[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = u_${r};\n#endif\n`))),vertexSource:t=t.replace(n,((e,t,i,n,r)=>{const o="float"===n?"vec2":"vec4",s=r.match(/color/)?"color":o;return u[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\nvarying ${i} ${n} ${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${i} ${o} a_${r};\n#else\nuniform ${i} ${n} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = a_${r};\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${n} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${i} ${n} ${r} = u_${r};\n#endif\n`})),staticAttributes:o,staticUniforms:c}}class ui{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,n,r,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!c&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(c=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!c&&this.boundIndexBuffer===r&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a&&this.boundDynamicVertexBuffer3===l?(e.bindVertexArrayOES.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind()):this.freshBind(t,i,n,r,o,s,a,l)}freshBind(e,t,i,n,r,o,s,a){let l;const c=e.numAttributes,u=this.context,h=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),l=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a;else{l=u.currentNumAttributes||0;for(let e=c;e<l;e++)h.disableVertexAttribArray(e)}t.enableAttributes(h,e);for(const t of i)t.enableAttributes(h,e);o&&o.enableAttributes(h,e),s&&s.enableAttributes(h,e),a&&a.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,r);for(const t of i)t.bind(),t.setVertexAttribPointers(h,e,r);o&&(o.bind(),o.setVertexAttribPointers(h,e,r)),n&&n.bind(),s&&(s.bind(),s.setVertexAttribPointers(h,e,r)),a&&(a.bind(),a.setVertexAttribPointers(h,e,r)),u.currentNumAttributes=c}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function hi(t,i){const n=Math.pow(2,i.canonical.z),r=i.canonical.y;return[new e.MercatorCoordinate(0,r/n).toLngLat().lat,new e.MercatorCoordinate(0,(r+1)/n).toLngLat().lat]}function di(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=n.fbo;if(!u)return;t.prepareDrawTile();const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,i,n)=>{const r=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=e.transform.angle);const l=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:hi(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(t,n,r,t.terrain?i.projMatrix:null);t.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(n);h.draw(l,c.TRIANGLES,o,s,a,e.CullFaceMode.disabled,d,r.id,p,f,m)}function pi(t,i,n){if(!i.needsDEMTextureUpload)return;const r=t.context,o=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(n.stride);const s=n.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new e.Texture(r,s,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function fi(t,i,n,r,o,s){const a=t.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),pi(t,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const t=new e.Texture(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,e.CullFaceMode.disabled,((t,i)=>{const n=i.stride,r=e.create();return e.ortho(r,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(r,r,[0,-e.EXTENT,0]),{u_matrix:r,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),n.id,d,p,f),i.needsHillshadePrepare=!1}const mi=(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image0:new e.Uniform1i(t,i.u_image0),u_skirt_height:new e.Uniform1f(t,i.u_skirt_height)}),gi=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),yi=(e,t,i,n,r,o,s,a,l,c,u,h,d,p)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9)});function _i(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const vi=new class{constructor(){this.operations={}}newMorphing(e,t,i,n,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:n,phase:0,duration:r,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},xi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bi(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const wi=e=>({u_matrix:e});function Ti(t,i,n,r,o){if(o>0){const s=e.exported.now(),a=(s-t.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=n.getSource(),u=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class ki extends e.SourceCache{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new L(Ne(),null),n=Le("mock-dem",t,i,e.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Si extends e.SourceCache{constructor(e){const t=Le("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new L(Ne(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,n){if(t.freezeTileCoverage)return;this.transform=t;const r=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new e.Tile(n,this._source.tileSize*n.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i}),{});for(const e in this._tiles)e in r||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ci extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class Ei extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,r,o]=function(t){const i=new e.StructArrayLayout4i8,n=new e.StructArrayLayout3ui6,r=131;i.reserve(17161),n.reserve(33800);const o=e.EXTENT/128,s=e.EXTENT+o/2,a=s+o;for(let t=-o;t<a;t+=o)for(let n=-o;n<a;n+=o){const r=n<0||n>s||t<0||t>s?24575:0,o=e.clamp(Math.round(n),0,e.EXTENT),a=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+r,a,o,a)}const l=(e,t)=>{const i=t*r+e;n.emplaceBack(i+1,i,i+r),n.emplaceBack(i+r,i+r+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,n,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(n,e.boundsAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(r),this.gridSegments=e.SegmentVector.simpleSegment(0,0,n.length,r.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Si(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new e.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ki(i.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(t,i,n){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const r=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(r.get("source")),this._exaggeration=r.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new e.pointGeometry(n.x,n.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const n=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=r.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(n)-s.distSqr(o)}))}(r,this.painter),this._previousZoom=n.zoom;const o=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const e in s){const i=s[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const n=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=r.map((e=>new Ci(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],r=n.dem;!r||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),pi(this.painter,n,r))}}_prepareDemTileUniforms(e,t,i,n){if(!t||null==t.demTexture)return!1;const r=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-r.z),s=n||"";return i[`u_dem_tl${s}`]=[r.x*o%1,r.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const n=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const n=i.dem.tree.minimums[0];return n>0&&e++,t+n}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),r=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(n,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,r,i.RGBA,{premultiply:!1}),o}setupElevationDraw(t,i,n){const r=this.painter.context,o=r.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();const l=this.painter.transform,c=l.projection,u=t.tileID.canonical;s.u_tile_tl_up=c.upVector(u,0,0),s.u_tile_tr_up=c.upVector(u,e.EXTENT,0),s.u_tile_br_up=c.upVector(u,e.EXTENT,e.EXTENT),s.u_tile_bl_up=c.upVector(u,0,e.EXTENT),s.u_tile_up_scale=n&&n.useDenormalizedUpVectorScale?e.GLOBE_METERS_TO_ECEF:c.upVectorScale(u,l.center.lat,l.worldSize).metersToTile;let h=null,d=null,p=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,i=n.morphing.dstDemTile;p=n.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(d=e),this._prepareDemTileUniforms(t,i,s)&&(h=i))}if(d&&h?(r.activeTexture.set(o.TEXTURE2),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),r.activeTexture.set(o.TEXTURE4),d.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=p):(h=this.terrainTileForTile[t.tileID.key],r.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,h,s)?h.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),r.activeTexture.set(o.TEXTURE3),n&&n.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),n&&n.useMeterToDem&&h){const t=(1<<h.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}n&&n.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(r,s)}renderToBackBuffer(t){const i=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,n,r,o){if("globe"===t.transform.projection.name)!function(t,i,n,r,o){const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=t.transform,d=e.globeUseCustomAntiAliasing(t,s,h),p=(e,i)=>{if(c===e)return;const n=[xi[e],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING"),i&&n.push(xi[u]),l=t.useProgram("globeRaster",null,n),c=e},f=t.colorModeForRenderPass(),m=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);vi.update(o);const g=e.calculateGlobeMercatorMatrix(h),y=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],_=t.globeSharedBuffers,v=[h.width*e.exported.devicePixelRatio,h.height*e.exported.devicePixelRatio];if((u?[!1,!0]:[!1]).forEach((u=>{c=-1;const d=u?a.LINES:a.TRIANGLES;for(const c of r){const r=n.getTile(c),x=e.StencilMode.disabled,b=i.prevTerrainTileForTile[c.key],w=i.terrainTileForTile[c.key];_i(b,w)&&vi.newMorphing(c.key,b,w,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=vi.getMorphValuesForProxy(c.key),k=T?1:0,S={useDenormalizedUpVectorScale:!0};T&&e.extend$1(S,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.easeCubicInOut(T.phase)}});const C=Float32Array.from(h.globeMatrix),E=e.globeTileLatLngCorners(c.canonical),M=e.getLatitudinalLod((E[0][0]+E[1][0])/2),A=e.getGridMatrix(c.canonical,E,M),z=e.globeNormalizeECEF(e.globeTileBounds(c.canonical)),I=yi(h.projMatrix,C,g,z,e.globeToMercatorTransition(h.zoom),y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,A);if(p(k,u),i.setupElevationDraw(r,l,S),t.prepareDrawProgram(s,l,c.toUnwrapped()),_){const[i,n,r]=u?_.getWirefameBuffers(t.context,M):_.getGridBuffers(M);l.draw(s,d,m,x,f,e.CullFaceMode.backCCW,I,"globe_raster",i,n,r)}}})),_){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=t.useProgram("globeRaster",null,o);for(const o of r){const{x:r,y:c,z:u}=o.canonical,d=0===c,p=c===(1<<u)-1,[g,x,b,w]=_.getPoleBuffers(u);if(w&&(d||p)){const c=n.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=e.globePoleMatrixForTile(u,r,h);const T=e.globeNormalizeECEF(e.globeTileBounds(o.canonical)),k=(t,i)=>t.draw(s,a.TRIANGLES,m,e.StencilMode.disabled,f,e.CullFaceMode.disabled,yi(h.projMatrix,_,_,T,0,y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v),"globe_pole_raster",i,b,w);i.setupElevationDraw(c,l,{}),t.prepareDrawProgram(s,l,o.toUnwrapped()),d&&k(l,g),p&&(_=e.scale(e.create(),_,[1,-1,1]),k(l,x))}}}}(t,i,n,r,o);else{const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,i)=>{if(c===e)return;const n=[xi[e]];i&&n.push(xi[u]),l=t.useProgram("terrainRaster",null,n),c=e},d=t.colorModeForRenderPass(),p=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);vi.update(o);const f=t.transform,m=6*Math.pow(1.5,22-f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[y,_]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=n.getTile(c),v=e.StencilMode.disabled,x=i.prevTerrainTileForTile[c.key],b=i.terrainTileForTile[c.key];_i(x,b)&&vi.newMorphing(c.key,x,b,o,250),s.activeTexture.set(a.TEXTURE0),r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=vi.getMorphValuesForProxy(c.key),T=w?1:0;let k;w&&(k={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.easeCubicInOut(w.phase)}});const S=gi(c.projMatrix,bi(c.canonical,f.renderWorldCopies)?m/10:m);h(T,u),i.setupElevationDraw(r,l,k),t.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,g,p,v,d,e.CullFaceMode.backCCW,S,"terrain_raster",i.gridBuffer,y,_)}}))}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],s=this._drapedRenderBatches.shift(),a=[],l=i.style.order;let c=0;for(const u of o){const o=r.getTileByID(u.proxyTileKey),h=r.proxyCachedFBO[u.key]?r.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?r.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;n.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(n.clear({color:e.Color.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=i.style._layers[l[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style._getLayerSourceCache(t),o=r?this.proxyToSource[u.key][r.id]:[u];if(!o)continue;const s=o;n.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(r?r.id:null)&&(this._setupStencil(d,o,t,r),f=r?r.id:null),i.renderLayer(i,r,t,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let i,n=0,r=0,o=!1;for(let s=0;s<t;++s){const t=e._layers[e.order[s]];this._style.isLayerDraped(t)?(o&&++n,++r):o||(o=!0,i=t.id)}return 0===r?{efficiency:100}:{efficiency:100*(1-n/r),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((e=>e.dem)).map((n=>{const r=n.tileID,o=Math.pow(2,r.overscaledZ),{x:s,y:a}=r.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:n.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:n}}));n.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of n){if(null==r.t)return null;const n=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,i);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,i=t.gl,n=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const r=new e.Texture(t,{width:n[0],height:n[1],data:null},i.RGBA);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(n[0],n[1],!1);return o.colorAttachment.set(r.texture),o.depthAttachment=new ke(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],i=t.isHidden(this.painter.transform.zoom),n=t.getCrossfadeParameters(),r=!!n&&1!==n.t,o=t.hasTransition();return"custom"!==t.type&&!i&&(r||o)}))}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof Ee){e=!0;break}if(e)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],i=t.isHidden(this.painter.transform.zoom),n=this._style._getLayerSourceCache(t);if("raster"!==t.type||i||!n)continue;const r=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t){const t=Ti(n.getTile(e),n.findLoadedParent(e,0),n,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(n.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const i=[];let n,r=0,o=this._style._layers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<t;)o=this._style._layers[e[r]];for(;r<t;++r){const t=this._style._layers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===n&&(n=r):void 0!==n&&(i.push({start:n,end:r-1}),n=void 0))}void 0!==n&&i.push({start:n,end:r-1}),this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const n=Object.values(e[i]);t.renderCachePool.push(...n)}}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const o=i[r];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],r=this.proxyToSource[o.key];let s=0;for(const e in r){const t=r[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||n[e]&&n[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(i).length}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const n of i){if(t.proxyCachedFBO[n.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[n.key]={},t.proxyCachedFBO[n.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,o=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const n=this.painter,r=this.painter.context,o=r.gl;n._tileClippingMaskIDs={},r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=n.useProgram("clippingMask");for(const a of t){const t=n._tileClippingMaskIDs[a.key]=--i;s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,wi(a.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const n=[t.x,t.y,1,1];e.transformMat4$1(n,n,i.pixelMatrixInverse),e.scale$1(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const r=i._camera.position,o=e.mercatorZfromAltitude(1,i.center.lat),s=[r[0],r[1],r[2]/o,0],a=e.subtract([],n.slice(0,3),s);e.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,i=t.context,n=this.proxySourceCache,r=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,n=i.createFramebuffer(r,o,!0);i.activeTexture.set(t.TEXTURE0);const s=new e.Texture(i,{width:r,height:o,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),n.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,r,o);n.depthAttachment.set(a),this._depthFBO=n,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,r,o]),function(t,i,n,r){if("globe"===t.transform.projection.name)return;const o=t.context,s=o.gl;o.clear({depth:1});const a=t.useProgram("terrainDepth"),l=new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of r){const r=n.getTile(t),c=gi(t.projMatrix,0);i.setupElevationDraw(r,a),a.draw(o,s.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,n,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof ze)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const n=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const o=r[t],s=this._findTileCoveringTileID(o,e);if(s){const t=this._createProxiedId(o,s,i[o.key]&&i[o.key][e.id]);n.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let r=0;r<t.length;r++){const s=e.getTile(t[r]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],r=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][e.id]);t?t.splice(t.length-1,0,r):this.proxyToSource[a.tileID.key][e.id]=[r],n.push(r),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,i,n){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=new e.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,i)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+o<s+l.min.x||n>s+l.max.x||r+o<a+l.min.y||r>a+l.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,n[s.key]&&n[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],r.push(a)}}}_createProxiedId(t,i,n){let r=this.orthoMatrix;if(n){const e=n.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const n=t.canonical.z-i.tileID.canonical.z;let o,s,a;r=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(o=e.EXTENT>>n,s=o*((i.tileID.canonical.x<<n)-t.canonical.x+l),a=o*((i.tileID.canonical.y<<n)-t.canonical.y)):(o=e.EXTENT<<-n,s=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-n)),a=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-n))),e.ortho(r,0,o,0,o,0,1),e.translate(r,r,[s,a,0])}return new Ci(i.tileID,t.key,r)}_findTileCoveringTileID(t,i){let n=i.getTile(t);if(n&&n.hasData())return n;const r=this._findCoveringTileCache[i.id],o=r[t.key];if(n=o?i.getTileByID(o):null,n&&n.hasData()||null===o)return n;let s=n?n.tileID:t,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const r=i.getSource().maxzoom;if(t.canonical.z>=r){const n=t.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(a=r,s=new e.OverscaledTileID(a,t.wrap,r,t.canonical.x>>n,t.canonical.y>>n))}s.key!==t.key&&(c.push(s.key),n=i.getTile(s))}const u=e=>{c.forEach((t=>{r[t]=e})),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const e=s.calculateScaledKey(a);if(n=i.getTileByID(e),n&&n.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):n=i.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let i=0;const n=new e.StructArrayLayout2ui4,r=131;for(let e=1;e<129;e++){for(let t=1;t<129;t++)i=e*r+t,n.emplaceBack(i,i+1),n.emplaceBack(i,i+r),n.emplaceBack(i+1,i+r),128===e&&n.emplaceBack(i+r,i+r+1);n.emplaceBack(i+1,i+1+r)}return n}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Mi(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const n=e[i].split(" ");t.push(n.pop())}return t}class Ai{static cacheKey(e,t,i){let n=`${e}${i?i.cacheKey:""}`;for(const e of t)n+=`/${e}`;return n}constructor(t,i,n,r,o,s){const a=t.gl;this.program=a.createProgram();const l=Mi(n.staticAttributes),c=r?r.getBinderAttributes():[],u=l.concat(c),h=n.staticUniforms?Mi(n.staticUniforms):[],d=r?r.getBinderUniforms():[],p=h.concat(d),f=[];for(const e of p)f.indexOf(e)<0&&f.push(e);let m=r?r.defines():[];m=m.concat(s.map((e=>`#define ${e}`)));const g=m.concat(t.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(ai):ai,ai,si,oi.fragmentSource,ri.fragmentSource,n.fragmentSource).join("\n"),y=m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",si,oi.vertexSource,ri.vertexSource,ni.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,y),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(_);for(let e=0;e<f.length;e++){const t=f[e];if(t&&!x[t]){const e=a.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=o(t,x),this.binderUniforms=r?r.getUniforms(t,x):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((t,i)=>({u_dem:new e.Uniform1i(t,i.u_dem),u_dem_prev:new e.Uniform1i(t,i.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,i.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,i.u_dem_tl),u_dem_scale:new e.Uniform1f(t,i.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,i.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,i.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,i.u_dem_size),u_dem_lerp:new e.Uniform1f(t,i.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,i.u_exaggeration),u_depth:new e.Uniform1i(t,i.u_depth),u_depth_size_inv:new e.Uniform2f(t,i.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,i.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,i.u_label_plane_matrix_inv),u_tile_tl_up:new e.Uniform3f(t,i.u_tile_tl_up),u_tile_tr_up:new e.Uniform3f(t,i.u_tile_tr_up),u_tile_br_up:new e.Uniform3f(t,i.u_tile_br_up),u_tile_bl_up:new e.Uniform3f(t,i.u_tile_bl_up),u_tile_up_scale:new e.Uniform1f(t,i.u_tile_up_scale)}))(t,x)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((t,i)=>({u_fog_matrix:new e.UniformMatrix4f(t,i.u_fog_matrix),u_fog_range:new e.Uniform2f(t,i.u_fog_range),u_fog_color:new e.Uniform4f(t,i.u_fog_color),u_fog_horizon_blend:new e.Uniform1f(t,i.u_fog_horizon_blend),u_fog_temporal_offset:new e.Uniform1f(t,i.u_fog_temporal_offset),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_globe_transition:new e.Uniform1f(t,i.u_globe_transition),u_is_globe:new e.Uniform1i(t,i.u_is_globe),u_viewport:new e.Uniform2f(t,i.u_viewport)}))(t,x))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].location&&i[e].set(t[e])}}draw(e,t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g){const y=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(n),e.setColorMode(r),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(s[e]);p&&p.setUniforms(e,this.binderUniforms,h,{zoom:d});const _={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t];for(const i of u.get()){const n=i.vaos||(i.vaos={});(n[a]||(n[a]=new ui)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f,m,g),y.drawElements(t,i.primitiveLength*_,y.UNSIGNED_SHORT,i.primitiveOffset*_*2)}}}function zi(e,t,i){const n=1/D(i,1,t.transform.tileZoom),r=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,t.transform.tileZoom)/r,s=o*(i.tileID.canonical.x+i.tileID.wrap*r),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[n,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const Ii=e.create(),Li=(t,i,n,r,o,s,a,l,c)=>{const u=i.style.light,h=u.properties.get("position"),d=[h.x,h.y,h.z],p=e.create$1();"viewport"===u.properties.get("anchor")&&(e.fromRotation(p,-i.transform.angle),e.transformMat3(d,d,p));const f=u.properties.get("color"),m=i.transform,g={u_matrix:t,u_lightpos:d,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[f.r,f.g,f.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ii,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===m.projection.name&&(g.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],g.u_zoom_transition=a,g.u_inv_rot_matrix=c,g.u_merc_center=l,g.u_up_dir=m.projection.upVector(new e.CanonicalTileID(0,0,0),l[0]*e.EXTENT,l[1]*e.EXTENT),g.u_height_lift=s),g},Di=(t,i,n,r,o,s,a,l,c,u,h)=>{const d=Li(t,i,n,r,o,l,c,u,h),p={u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8};return e.extend(d,zi(s,i,a),p)},Pi=e=>({u_matrix:e}),Oi=(t,i,n,r)=>e.extend(Pi(t),zi(n,i,r)),Ri=(e,t)=>({u_matrix:e,u_world:t}),Bi=(t,i,n,r,o)=>e.extend(Oi(t,i,n,r),{u_world:o}),Fi=e.create(),$i=(t,i,n,r,o,s)=>{const a=t.transform,l="globe"===a.projection.name;let c;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const t=e.globePixelsToTileUnits(a.zoom,i.canonical)*a._projectionScaler;c=Float32Array.from([t,0,0,t])}else c=a.calculatePixelsToTileUnitsMatrix(n);else c=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.projMatrix,n,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Fi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=r,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.globeToMercatorTransition(a.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;u.u_up_dir=a.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return u},ji=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Ni=(t,i,n,r)=>{const o=e.EXTENT/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(r),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Ui=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Vi=e.create(),Gi=(t,i,n,r,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.globePixelsToTileUnits(l.zoom,i.canonical)*l._projectionScaler:D(n,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Vi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=r,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.globeToMercatorTransition(l.zoom);const t=o[0]*e.EXTENT,n=o[1]*e.EXTENT;h.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),t,n)}return h},qi=(e,t,i,n,r,o,s,a)=>{const l=e.transform,c=l.calculatePixelsToTileUnitsMatrix(t),u={u_matrix:Zi(e,t,i,r),u_pixels_to_tile_units:c,u_device_pixel_ratio:s,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:a};if(Xi(i)){const i=Hi(t,e.transform);u.u_texsize=t.lineAtlasTexture.size,u.u_scale=[i,n.fromScale,n.toScale],u.u_mix=n.t}return u},Wi=(e,t,i,n,r,o)=>{const s=e.transform,a=Hi(t,s);return{u_matrix:Zi(e,t,i,r),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:o,u_image:0,u_scale:[a,n.fromScale,n.toScale],u_fade:n.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hi(e,t){return 1/D(e,1,t.tileZoom)}function Zi(e,t,i,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Xi(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ki=(e,t,i,n,r,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_fade_t:n.mix,u_opacity:n.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(a=r.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=r.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Yi(r.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Yi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Ji=e.create(),Qi=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>{const y=o.transform,_={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:y.cameraToCenterDistance,u_rotate_symbol:+n,u_aspect_ratio:y.width/y.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+r,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ji,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ji,u_up_vector:[0,-1,0]};return"globe"===g.name&&(_.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],_.u_zoom_transition=d,_.u_inv_rot_matrix=f,_.u_merc_center=p,_.u_camera_forward=y._camera.forward(),_.u_ecef_origin=e.globeECEFOrigin(y.globeMatrix,h.toUnwrapped()),_.u_tile_matrix=Float32Array.from(y.globeMatrix),_.u_up_vector=m),_},en=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y)=>e.extend(Qi(t,i,n,r,o,s,a,l,c,u,d,p,f,m,g,y),{u_gamma_scale:r?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h}),tn=(t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g)=>e.extend(en(t,i,n,r,o,s,a,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),nn=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),rn=(t,i,n,r,o,s)=>e.extend(function(e,t,i,n){const r=i.imageManager.getPattern(e.from.toString()),o=i.imageManager.getPattern(e.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(n.tileID.canonical.x+n.tileID.wrap*l),h=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:t.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/D(n,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,n,o),{u_matrix:t,u_opacity:i}),on={fillExtrusion:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_opacity:new e.Uniform1f(t,i.u_opacity),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,i.u_height_factor),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_opacity:new e.Uniform1f(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.UniformMatrix2f(t,i.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),collisionBox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,i.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.UniformColor(t,i.u_color),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_overlay:new e.Uniform1i(t,i.u_overlay),u_overlay_scale:new e.Uniform1f(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.Uniform1f(t,i.u_extrude_scale),u_intensity:new e.Uniform1f(t,i.u_intensity),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),heatmapTexture:(t,i)=>({u_image:new e.Uniform1i(t,i.u_image),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_opacity:new e.Uniform1f(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_latrange:new e.Uniform2f(t,i.u_latrange),u_light:new e.Uniform2f(t,i.u_light),u_shadow:new e.UniformColor(t,i.u_shadow),u_highlight:new e.UniformColor(t,i.u_highlight),u_accent:new e.UniformColor(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_dimension:new e.Uniform2f(t,i.u_dimension),u_zoom:new e.Uniform1f(t,i.u_zoom),u_unpack:new e.Uniform4f(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_dash_image:new e.Uniform1i(t,i.u_dash_image),u_gradient_image:new e.Uniform1i(t,i.u_gradient_image),u_image_height:new e.Uniform1f(t,i.u_image_height),u_texsize:new e.Uniform2f(t,i.u_texsize),u_scale:new e.Uniform3f(t,i.u_scale),u_mix:new e.Uniform1f(t,i.u_mix),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold),u_trim_offset:new e.Uniform2f(t,i.u_trim_offset)}),linePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_image:new e.Uniform1i(t,i.u_image),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold)}),raster:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_tl_parent:new e.Uniform2f(t,i.u_tl_parent),u_scale_parent:new e.Uniform1f(t,i.u_scale_parent),u_fade_t:new e.Uniform1f(t,i.u_fade_t),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image0:new e.Uniform1i(t,i.u_image0),u_image1:new e.Uniform1i(t,i.u_image1),u_brightness_low:new e.Uniform1f(t,i.u_brightness_low),u_brightness_high:new e.Uniform1f(t,i.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,i.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,i.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,i.u_spin_weights),u_perspective_transform:new e.Uniform2f(t,i.u_perspective_transform)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_texture:new e.Uniform1i(t,i.u_texture)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texsize_icon:new e.Uniform2f(t,i.u_texsize_icon),u_texture:new e.Uniform1i(t,i.u_texture),u_texture_icon:new e.Uniform1i(t,i.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),background:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_color:new e.UniformColor(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image:new e.Uniform1i(t,i.u_image),u_pattern_tl_a:new e.Uniform2f(t,i.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,i.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,i.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,i.u_pattern_br_b),u_texsize:new e.Uniform2f(t,i.u_texsize),u_mix:new e.Uniform1f(t,i.u_mix),u_pattern_size_a:new e.Uniform2f(t,i.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,i.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,i.u_scale_a),u_scale_b:new e.Uniform1f(t,i.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,i.u_tile_units_to_pixels)}),terrainRaster:mi,terrainDepth:mi,skybox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_cubemap:new e.Uniform1i(t,i.u_cubemap),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxGradient:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_center_direction:new e.Uniform3f(t,i.u_center_direction),u_radius:new e.Uniform1f(t,i.u_radius),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxCapture:(t,i)=>({u_matrix_3f:new e.UniformMatrix3f(t,i.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,i.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,i.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,i.u_color_tint_m),u_luminance:new e.Uniform1f(t,i.u_luminance)}),globeRaster:(t,i)=>({u_proj_matrix:new e.UniformMatrix4f(t,i.u_proj_matrix),u_globe_matrix:new e.UniformMatrix4f(t,i.u_globe_matrix),u_normalize_matrix:new e.UniformMatrix4f(t,i.u_normalize_matrix),u_merc_matrix:new e.UniformMatrix4f(t,i.u_merc_matrix),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_image0:new e.Uniform1i(t,i.u_image0),u_grid_matrix:new e.UniformMatrix3f(t,i.u_grid_matrix),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_viewport:new e.Uniform2f(t,i.u_viewport)}),globeAtmosphere:(t,i)=>({u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_horizon:new e.Uniform1f(t,i.u_horizon),u_transition:new e.Uniform1f(t,i.u_transition),u_fadeout_range:new e.Uniform1f(t,i.u_fadeout_range),u_color:new e.Uniform4f(t,i.u_color),u_high_color:new e.Uniform4f(t,i.u_high_color),u_space_color:new e.Uniform4f(t,i.u_space_color),u_star_intensity:new e.Uniform1f(t,i.u_star_intensity),u_star_density:new e.Uniform1f(t,i.u_star_density),u_star_size:new e.Uniform1f(t,i.u_star_size),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset),u_horizon_angle:new e.Uniform1f(t,i.u_horizon_angle),u_rotation_matrix:new e.UniformMatrix4f(t,i.u_rotation_matrix)})};let sn;function an(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=t.useProgram("collisionBox"),d=[];let p=0,f=0;for(let m=0;m<r.length;m++){const g=r[m],y=i.getTile(g),_=y.getBucket(n);if(!_)continue;const v=bt(g,_,u);let x=v;0===o[0]&&0===o[1]||(x=t.translatePosMatrix(v,y,o,s));const b=a?_.textCollisionBox:_.iconCollisionBox,w=_.collisionCircleArray;if(w.length>0){const t=e.create(),i=x;e.mul(t,_.placementInvProjMatrix,u.glCoordMatrix),e.mul(t,t,_.placementViewportMatrix),d.push({circleArray:w,circleOffset:f,transform:i,invTransform:t,projection:_.getProjection()}),p+=w.length/4,f=p}b&&(t.terrain&&t.terrain.setupElevationDraw(y,h),h.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,Ni(x,u,y,_.getProjection()),n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,u.zoom,null,b.collisionVertexBuffer,b.collisionVertexBufferExt))}if(!a||!d.length)return;const m=t.useProgram("collisionCircle"),g=new e.StructArrayLayout2f1f2i16;g.resize(4*p),g._trim();let y=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,n=e.circleArray[i+0],r=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];g.emplace(y++,n,r,o,s,0),g.emplace(y++,n,r,o,s,1),g.emplace(y++,n,r,o,s,2),g.emplace(y++,n,r,o,s,3)}(!sn||sn.length<2*p)&&(sn=function(t){const i=2*t,n=new e.StructArrayLayout3ui6;n.resize(i),n._trim();for(let e=0;e<i;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(p));const _=l.createIndexBuffer(sn,!0),v=l.createVertexBuffer(g,e.collisionCircleLayout.members,!0);for(const i of d){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};m.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,r,n.id,v,_,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var x;v.destroy(),_.destroy()}const ln=e.create();function cn(t,i,n,r,o,s){const{horizontalAlign:a,verticalAlign:l}=e.getAnchorAlignment(t),c=-(a-.5)*i,u=-(l-.5)*n,h=e.evaluateVariableOffset(t,r);return new e.pointGeometry((c/o+h[0])*s,(u/o+h[1])*s)}function un(t,i,n,r,o,s,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=wt(l,t.getProjection(),s),y=s.elevation,_=t.getProjection().upVectorScale(l.canonical,s.center.lat,s.worldSize);p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),x=t.allowVerticalPlacement&&!v.placedOrientation,b=v.hidden||!v.crossTileID||x?null:r[v.crossTileID];if(b){const r=new e.pointGeometry(v.tileAnchorX,v.tileAnchorY),d=t.getProjection().upVector(l.canonical,r.x,r.y),f=y?y.getAtTileOffset(l,r.x,r.y):0,x=ot([v.projectedAnchorX+f*d[0]*_.metersToTile,v.projectedAnchorY+f*d[1]*_.metersToTile,v.projectedAnchorZ+f*d[2]*_.metersToTile],n?g:a),w=st(s.getCameraToCenterDistance(t.getProjection()),x.signedDistanceFromCamera);let T=o.evaluateSizeForFeature(t.textSizeData,u,v)*w/e.ONE_EM;n&&(T*=t.tilePixelRatio/c);const{width:k,height:S,anchor:C,textOffset:E,textScale:M}=b,A=cn(C,k,S,E,M,T);let z;if(n){const e=r.add(A),{x:i,y:n,z:o}=t.getProjection().projectTilePoint(e.x,e.y,l.canonical);z=ot([i+f*d[0]*_.metersToTile,n+f*d[1]*_.metersToTile,o+f*d[2]*_.metersToTile],a).point}else{const e=i?A.rotate(-s.angle):A;z=[x.point[0]+e.x,x.point[1]+e.y,0]}const I=t.allowVerticalPlacement&&v.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<v.numGlyphs;t++)e.addDynamicAttributes(p,z[0],z[1],z[2],I);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={shiftedAnchor:z,angle:I})}else gt(v.numGlyphs,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const n=i.get(t);if(n.hidden)gt(n.numGlyphs,f);else{const i=m[t];if(i)for(let t=0;t<n.numGlyphs;t++)e.addDynamicAttributes(f,i.shiftedAnchor[0],i.shiftedAnchor[1],i.shiftedAnchor[2],i.angle);else gt(n.numGlyphs,f)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function hn(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function dn(t,i,n,r,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,y="map"===c,_=g&&"point"!==n.layout.get("symbol-placement"),v=g&&!y&&!_,x=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),T=[e.mercatorXfromLng(m.center.lng),e.mercatorYfromLat(m.center.lat)],k=n.layout.get("text-variable-anchor"),S="globe"===m.projection.name,C=[],E=[0,-1,0];let M=E;!S&&!m.mercatorFromTransition||g||(M=function(t){const i=t._camera.getWorldToCamera(t.worldSize,1),n=e.multiply([],i,t.globeMatrix);e.invert(n,n);const r=[0,0,0],o=[0,1,0,0];return e.transformMat4$1(o,o,n),r[0]=o[0],r[1]=o[1],r[2]=o[2],e.normalize(r,r),r}(m));for(const l of r){const r=i.getTile(l),c=r.getBucket(n);if(!c)continue;if("mercator"===c.projection.name&&S)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(n.id),p=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,A=y||0!==m.pitch,z=e.evaluateSizeForZoom(w,m.zoom);let I,L,D,P,O=[0,0],R=null;if(o){if(L=r.glyphAtlasTexture,D=f.LINEAR,I=r.glyphAtlasTexture.size,c.iconsInText){O=r.imageAtlasTexture.size,R=r.imageAtlasTexture;const e="composite"===w.kind||"camera"===w.kind;P=A||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==n.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;L=r.imageAtlasTexture,D=p||t.options.rotating||t.options.zooming||e||A?f.LINEAR:f.NEAREST,I=r.imageAtlasTexture.size}const B="globe"===c.projection.name,F=B?M:E,$=B?e.globeToMercatorTransition(m.zoom):0,j=wt(l,c.getProjection(),m),N=m.calculatePixelsToTileUnitsMatrix(r),U=tt(j,r.tileID.canonical,y,g,m,c.getProjection(),N),V=t.terrain&&y&&_?e.invert(e.create(),U):ln,G=nt(j,r.tileID.canonical,y,g,m,c.getProjection(),N),q=k&&c.hasTextData(),W="none"!==n.layout.get("icon-text-fit")&&q&&c.hasIconData();if(_){const e=m.elevation,i=e?e.getAtTileOffsetFunc(l,m.center.lat,m.worldSize,c.getProjection()):e=>[0,0,0],n=it(j,r.tileID.canonical,y,g,m,c.getProjection(),N);lt(c,j,t,o,n,G,y,u,i,l)}const H=_||o&&k||W,Z=t.translatePosMatrix(j,r,s,a),X=H?ln:U,K=t.translatePosMatrix(G,r,s,a,!0),Y=c.getProjection().createInversionMatrix(m,l.canonical),J=[];t.terrain&&y&&J.push("PITCH_WITH_MAP_TERRAIN"),B&&J.push("PROJECTION_GLOBE_VIEW"),H&&J.push("PROJECTED_POS_ON_VIEWPORT");const Q=p&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=p?c.iconsInText?tn(w.kind,z,v,y,t,Z,X,K,I,O,l,$,T,Y,F,c.getProjection()):en(w.kind,z,v,y,t,Z,X,K,o,I,!0,l,$,T,Y,F,c.getProjection()):Qi(w.kind,z,v,y,t,Z,X,K,o,I,l,$,T,Y,F,c.getProjection());const te={program:t.useProgram(hn(p,o,c),d,J),buffers:h,uniformValues:ee,atlasTexture:L,atlasTextureIcon:R,atlasInterpolation:D,atlasInterpolationIcon:P,isSDF:p,hasHalo:Q,tile:r,labelPlaneMatrixInv:V};if(x&&c.canOverlap){b=!0;const t=h.segments.get();for(const i of t)C.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:te})}else C.push({segments:h.segments,sortKey:0,state:te})}b&&C.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of C){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!S,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,pn(i.buffers,e.segments,n,t,i.program,w,h,d,r)),r.u_is_halo=0}pn(i.buffers,e.segments,n,t,i.program,w,h,d,i.uniformValues)}}function pn(t,i,n,r,o,s,a,l,c){const u=r.context;o.draw(u,u.gl.TRIANGLES,s,a,l,e.CullFaceMode.disabled,c,n.id,t.layoutVertexBuffer,t.indexBuffer,i,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer)}function fn(t,i,n,r,o,s,a){const l=t.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=n.getCrossfadeParameters();let d,p,f,m,g;a?(p=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=u?"fillPattern":"fill",d=l.TRIANGLES);for(const y of r){const r=i.getTile(y);if(u&&!r.patternsLoaded())continue;const _=r.getBucket(n);if(!_)continue;t.prepareDrawTile();const v=_.programConfigurations.get(n.id),x=t.useProgram(p,v);u&&(t.context.activeTexture.set(l.TEXTURE0),r.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[b.to.toString()],i=e.patternPositions[b.from.toString()];t&&i&&v.setConstantPatternPositions(t,i)}const w=t.translatePosMatrix(y.projMatrix,r,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){m=_.indexBuffer2,g=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Bi(w,t,h,r,e):Ri(w,e)}else m=_.indexBuffer,g=_.segments,f=u?Oi(w,t,h,r):Pi(w);t.prepareDrawProgram(t.context,x,y.toUnwrapped()),x.draw(t.context,d,o,t.stencilModeForClipping(y),s,e.CullFaceMode.disabled,f,n.id,_.layoutVertexBuffer,m,g,n.paint,t.transform.zoom,v)}}function mn(t,i,n,r,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=n.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity"),m="globe"===u.projection.name?e.fillExtrusionHeightLift():0,g="globe"===u.projection.name,y=g?e.globeToMercatorTransition(u.zoom):0,_=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],v=[];g&&v.push("PROJECTION_GLOBE_VIEW");for(const x of r){const r=i.getTile(x),b=r.getBucket(n);if(!b||b.projection.name!==u.projection.name)continue;const w=b.programConfigurations.get(n.id),T=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",w,v);if(t.terrain){const e=t.terrain;if(t.style.terrainSetForDrapingOnly())e.setupElevationDraw(r,T,{useMeterToDem:!0});else{if(!b.enableTerrain)continue;if(e.setupElevationDraw(r,T,{useMeterToDem:!0}),gn(l,i,x,b,n,e),!b.centroidVertexBuffer){const e=T.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}}d&&(t.context.activeTexture.set(c.TEXTURE0),r.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.updatePaintBuffers(p));const k=h.constantOr(null);if(k&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[k.to.toString()],i=e.patternPositions[k.from.toString()];t&&i&&w.setConstantPatternPositions(t,i)}const S=t.translatePosMatrix(x.projMatrix,r,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),C=u.projection.createInversionMatrix(u,x.canonical),E=n.paint.get("fill-extrusion-vertical-gradient"),M=d?Di(S,t,E,f,x,p,r,m,y,_,C):Li(S,t,E,f,x,m,y,_,C);t.prepareDrawProgram(l,T,x.toUnwrapped()),T.draw(l,l.gl.TRIANGLES,o,s,a,e.CullFaceMode.backCCW,M,n.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,n.paint,t.transform.zoom,w,t.terrain?b.centroidVertexBuffer:null,g?b.layoutVertexExtBuffer:null)}}function gn(t,i,n,r,o,s){const a=[t=>{let i=t.canonical.x-1,n=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,n--),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,n=t.wrap;return i===1<<t.canonical.z&&(i=0,n++),new e.OverscaledTileID(t.overscaledZ,n,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().minzoom,n=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},r=[0,-1,1];for(const i of r){if(e.overscaledZ+i<t)continue;const r=n(e.calculateScaledKey(e.overscaledZ+i));if(r)return r}},c=[0,0,0],u=(t,i)=>(c[0]=Math.min(t.min.y,i.min.y),c[1]=Math.max(t.max.y,i.max.y),c[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,c),h=(t,i)=>(c[0]=Math.min(t.min.x,i.min.x),c[1]=Math.max(t.max.x,i.max.x),c[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=new e.pointGeometry(0,0);let f,m,g;const y=(t,i,r,o,a)=>{const l=[[o?r:t,o?t:r,0],[o?r:i,o?i:r,0]],c=a<0?e.EXTENT+a:a,u=[o?c:(t+i)/2,o?(t+i)/2:c,0];return 0===r&&a<0||0!==r&&a>0?s.getForTilePoints(g,[u],!0,m):l.push(u),s.getForTilePoints(n,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let t=0;t<4;t++){const i=(t<2?1:5)-t,o=r.borders[t];if(0===o.length)continue;const c=g=a[t](n),u=l(c);if(!(u&&u instanceof e.FillExtrusionBucket&&u.enableTerrain))continue;if(r.borderDoneWithNeighborZ[t]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===r.canonical.z)continue;if(m=s.findDEMTileFor(c),!m||!m.dem)continue;if(!f){const e=s.findDEMTileFor(n);if(!e||!e.dem)return;f=e}const h=u.borders[i];let _=0;const v=u.borderDoneWithNeighborZ[i]!==r.canonical.z;if(r.canonical.z===u.canonical.z){for(let n=0;n<o.length;n++){const s=r.featuresOnBorder[o[n]],a=s.borders[t];let l;for(;_<h.length&&(l=u.featuresOnBorder[h[_]],!(l.borders[i][1]>a[0]+3));)v&&u.encodeCentroid(void 0,l,!1),_++;if(l&&_<h.length){const n=_;let o=0;for(;!(l.borders[i][0]>a[1]-3)&&(o++,++_!==h.length);)l=u.featuresOnBorder[h[_]];if(l=u.featuresOnBorder[h[n]],s.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(_=n),r.encodeCentroid(void 0,s,!1),v&&u.encodeCentroid(void 0,l,!1);continue}const c=d[t](s,l),f=t%2?e.EXTENT-1:0;p.x=y(c[0],Math.min(e.EXTENT-1,c[1]),f,t<2,c[2]),p.y=0,r.encodeCentroid(p,s,!1),v&&u.encodeCentroid(p,l,!1)}else r.encodeCentroid(void 0,s,!1)}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0,v&&(u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0)}else{for(const e of o)r.encodeCentroid(void 0,r.featuresOnBorder[e],!1);if(v){for(const e of h)u.encodeCentroid(void 0,u.featuresOnBorder[e],!1);u.borderDoneWithNeighborZ[i]=r.canonical.z,u.needsCentroidUpdate=!0}r.borderDoneWithNeighborZ[t]=u.canonical.z,r.needsCentroidUpdate=!0}}(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t)}const yn=new e.Color(1,0,0,1),_n=new e.Color(0,1,0,1),vn=new e.Color(0,0,1,1),xn=new e.Color(1,0,1,1),bn=new e.Color(0,1,1,1);function wn(e,t,i,n){kn(e,0,t+i/2,e.transform.width,i,n)}function Tn(e,t,i,n){kn(e,t-i/2,0,i,e.transform.height,n)}function kn(t,i,n,r,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.exported.devicePixelRatio,n*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function Sn(t,i,n){const r=t.context,o=r.gl,s="globe"===t.transform.projection.name,a=n.projMatrix,l=t.useProgram("debug",null,s?["PROJECTION_GLOBE_VIEW"]:null),c=i.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(c,l);const u=e.DepthMode.disabled,h=e.StencilMode.disabled,d=t.colorModeForRenderPass(),p="$debug";r.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?c._makeGlobeTileDebugBuffers(t.context,t.transform.projection):c._makeDebugTileBoundsBuffers(t.context,t.transform.projection);const f=c._tileDebugBuffer||t.debugBuffer,m=c._tileDebugIndexBuffer||t.debugIndexBuffer,g=c._tileDebugSegments||t.debugSegments;l.draw(r,o.LINE_STRIP,u,h,d,e.CullFaceMode.disabled,Ui(a,e.Color.red),p,f,m,g,null,null,null,c._globeTileDebugBorderBuffer);const y=c.latestRawTileData,_=Math.floor((y&&y.byteLength||0)/1024),v=i.getTile(n).tileSize,x=512/Math.min(v,512)*(n.overscaledZ/t.transform.zoom)*.5;let b=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(b+=` => ${n.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,n=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,`${b} ${_}kb`);const w=c._tileDebugTextBuffer||t.debugBuffer,T=c._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,k=c._tileDebugTextSegments||t.debugSegments;l.draw(r,o.TRIANGLES,u,h,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,Ui(a,e.Color.transparent,x),p,w,T,k,null,null,null,c._globeTileDebugTextBuffer)}const Cn=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:En}=Cn;function Mn(e,t,i,n){e.emplaceBack(t,i,n)}class An{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,Mn(this.vertexArray,-1,-1,1),Mn(this.vertexArray,1,-1,1),Mn(this.vertexArray,-1,1,1),Mn(this.vertexArray,1,1,1),Mn(this.vertexArray,-1,-1,-1),Mn(this.vertexArray,1,-1,-1),Mn(this.vertexArray,-1,1,-1),Mn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,En),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function zn(t,i,n,r,o,s){const a=t.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,n,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.fromMat4(e.create$1(),r),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),n.draw(t,a.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const In=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ln{constructor(t){const i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new e.StructArrayLayout3ui6;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,In.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Dn={symbol:function(t,i,n,r,o){if("translucent"!==t.renderPass)return;const s=e.StencilMode.disabled,a=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(t,i,n,r,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of t){const t=r.getTile(i),o=t.getBucket(n);if(!o||!o.text||!o.text.segments.get().length)continue;const s=e.evaluateSizeForZoom(o.textSizeData,l.zoom),h=wt(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=tt(h,t.tileID.canonical,u,c,l,o.getProjection(),d),f="none"!==n.layout.get("icon-text-fit")&&o.hasIconData();if(s){const n=Math.pow(2,l.zoom-t.tileID.overscaledZ);un(o,c,u,a,e.symbolSize,l,p,i,n,s,f)}}}(r,t,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&dn(t,i,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),s,a),0!==n.paint.get("text-opacity").constantOr(1)&&dn(t,i,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(an(t,i,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),an(t,i,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.transform,d=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="globe"===h.projection.name,g=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],y=[];for(let o=0;o<r.length;o++){const s=r[o],a=i.getTile(s),c=a.getBucket(n);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(n.id),d=ji(n);m&&d.push("PROJECTION_GLOBE_VIEW");const p=t.useProgram("circle",u,d),f=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,v=c.indexBuffer,x=h.projection.createInversionMatrix(h,s.canonical),b={programConfiguration:u,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:_,indexBuffer:v,uniformValues:$i(t,s,a,x,g,n),tile:a};if(l){const t=c.segments.get();for(const i of t)y.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:b})}else y.push({segments:c.segments,sortKey:0,state:b})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const _={useDepthForOcclusion:!m};for(const i of y){const{programConfiguration:r,program:o,layoutVertexBuffer:s,globeExtVertexBuffer:a,indexBuffer:l,uniformValues:g,tile:y}=i.state,v=i.segments;t.terrain&&t.terrain.setupElevationDraw(y,o,_),t.prepareDrawProgram(c,o,y.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,d,p,f,e.CullFaceMode.disabled,g,n.id,s,l,v,n.paint,h.zoom,r,m?a:null)}},heatmap:function(t,i,n,r){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=e.StencilMode.disabled,l=new e.ColorMode([s.ONE,s.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i,n){const r=e.gl,o=t.width*n,s=t.height*n;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=e.createFramebuffer(o,s,!1),function(e,t,i,n,r,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,s.RGBA,r,o,0,s.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(e,0,t,a,o,s)}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,n,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.Color.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=u?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,p=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)];for(let f=0;f<r.length;f++){const m=r[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),y=g.getBucket(n);if(!y||y.projection.name!==c.projection.name)continue;const _=y.programConfigurations.get(n.id),v=t.useProgram("heatmap",_,h),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(g,v),t.prepareDrawProgram(o,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(o,s.TRIANGLES,e.DepthMode.disabled,a,l,d,Gi(t,m,g,b,p,x,n.paint.get("heatmap-intensity")),n.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,n.paint,t.transform.zoom,_,u?y.globeExtVertexBuffer:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const n=t.context,r=n.gl,o=i.heatmapFbo;if(!o)return;n.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(r.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new e.Texture(n,i.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(n,r.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,n))},line:function(t,i,n,r){if("translucent"!==t.renderPass)return;const o=n.paint.get("line-opacity"),s=n.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,u=n.paint.get("line-dasharray"),h=u.constantOr(1),d=n.layout.get("line-cap"),p=n.paint.get("line-pattern"),f=p.constantOr(1),m=n.paint.get("line-gradient"),g=n.getCrossfadeParameters(),y=f?"linePattern":"line",_=t.context,v=_.gl,x=(e=>{const t=[];Xi(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET");const n=e.paint.get("line-pattern").constantOr(1),r=1!==e.paint.get("line-opacity").constantOr(1);return!n&&r&&t.push("RENDER_LINE_ALPHA_DISCARD"),t})(n);let b=x.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(b=!1);for(const o of r){const r=i.getTile(o);if(f&&!r.patternsLoaded())continue;const s=r.getBucket(n);if(!s)continue;t.prepareDrawTile();const w=s.programConfigurations.get(n.id),T=t.useProgram(y,w,x),k=p.constantOr(null);if(k&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[k.to.toString()],i=e.patternPositions[k.from.toString()];t&&i&&w.setConstantPatternPositions(t,i)}const S=u.constantOr(null),C=d.constantOr(null);if(!f&&S&&C&&r.lineAtlas){const e=r.lineAtlas,t=e.getDash(S.to,C),i=e.getDash(S.from,C);t&&i&&w.setConstantPatternPositions(t,i)}let[E,M]=n.paint.get("line-trim-offset");if("round"===C||"square"===C){const e=1;E!==M&&(0===E&&(E-=e),1===M&&(M+=e))}const A=t.terrain?o.projMatrix:null,z=f?Wi(t,r,n,g,A,c):qi(t,r,n,g,A,s.lineClipsArray.length,c,[E,M]);if(m){const r=s.gradients[n.id];let a=r.texture;if(n.gradientVersion!==r.version){let l=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,r=o.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(s.maxLineLength/e.EXTENT*1024*r),256,_.maxTextureSize)}r.gradient=e.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.Texture(_,r.gradient,v.RGBA),r.version=n.gradientVersion,a=r.texture}_.activeTexture.set(v.TEXTURE1),a.bind(n.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}h&&(_.activeTexture.set(v.TEXTURE0),r.lineAtlasTexture.bind(v.LINEAR,v.REPEAT),w.updatePaintBuffers(g)),f&&(_.activeTexture.set(v.TEXTURE0),r.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),w.updatePaintBuffers(g)),t.prepareDrawProgram(_,T,o.toUnwrapped());const I=i=>{T.draw(_,v.TRIANGLES,a,i,l,e.CullFaceMode.disabled,z,n.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,n.paint,t.transform.zoom,w,s.layoutVertexBuffer2)};if(b){const i=t.stencilModeForClipping(o).ref;0===i&&t.terrain&&_.clear({stencil:0});const n={func:v.EQUAL,mask:255};z.u_alpha_discard_threshold=.8,I(new e.StencilMode(n,i,255,v.KEEP,v.KEEP,v.INVERT)),z.u_alpha_discard_threshold=0,I(new e.StencilMode(n,i,255,v.KEEP,v.KEEP,v.KEEP))}else I(t.stencilModeForClipping(o))}b&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))},fill:function(t,i,n,r){const o=n.paint.get("fill-color"),s=n.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=n.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);fn(t,i,n,r,o,a,!1)}if("translucent"===t.renderPass&&n.paint.get("fill-antialias")){const o=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);fn(t,i,n,r,o,a,!0)}},"fill-extrusion":function(t,i,n,r){const o=n.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const s=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||n.paint.get("fill-extrusion-pattern").constantOr(1))mn(t,i,n,r,s,e.StencilMode.disabled,e.ColorMode.disabled),mn(t,i,n,r,s,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{const o=t.colorModeForRenderPass();mn(t,i,n,r,s,e.StencilMode.disabled,o)}}},hillshade:function(t,i,n,r){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),a=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},r]:t.stencilConfigForOverlap(r);for(const r of u){const o=i.getTile(r);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)fi(t,o,n,s,e.StencilMode.disabled,a);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(r):c[r.overscaledZ];di(t,r,o,n,s,e,a)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,n,r,o,s){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!r.length)return;const a=t.context,l=a.gl,c=i.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof ze||d?[{},r]:t.stencilConfigForOverlap(r),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const r of f){const o=d?e.DepthMode.disabled:t.depthModeForSublayer(r.overscaledZ-m,1===n.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=r.toUnwrapped(),y=i.getTile(r);if(d&&(!y||!y.hasData()))continue;const _=d?r.projMatrix:t.transform.calculateProjMatrix(f,g),v=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(r):p[r.overscaledZ],x=s?0:n.paint.get("raster-fade-duration");y.registerFadeDuration(x);const b=i.findLoadedParent(r,0),w=Ti(y,b,i,t.transform,x);let T,k;t.terrain&&t.terrain.prepareDrawTile();const S="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),y.texture.bind(S,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(S,l.CLAMP_TO_EDGE),T=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),k=[y.tileID.canonical.x*T%1,y.tileID.canonical.y*T%1]):y.texture.bind(S,l.CLAMP_TO_EDGE);const C=Ki(_,k||[0,0],T||1,w,n,c instanceof ze?c.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(a,u,f),c instanceof ze)c.boundsBuffer&&c.boundsSegments&&u.draw(a,l.TRIANGLES,o,e.StencilMode.disabled,h,e.CullFaceMode.disabled,C,n.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:r,tileBoundsSegments:s}=t.getTileBoundsBuffers(y);u.draw(a,l.TRIANGLES,o,v,h,e.CullFaceMode.disabled,C,n.id,i,r,s)}}t.resetStencilClippingMasks()},background:function(t,i,n,r){const o=n.paint.get("background-color"),s=n.paint.get("background-opacity");if(0===s)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=n.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(h?"backgroundPattern":"background");let y,_=r;_||(y=t.getBackgroundTiles(),_=Object.values(y).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const v=n.getCrossfadeParameters();for(const d of _){const _=d.toUnwrapped(),x=r?d.projMatrix:t.transform.calculateProjMatrix(_);t.prepareDrawTile();const b=i?i.getTile(d):y?y[d.key]:new e.Tile(d,u,c.zoom,t),w=h?rn(x,s,t,h,{tileID:d,tileSize:u},v):nn(x,s,o);t.prepareDrawProgram(a,g,_);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:k,tileBoundsSegments:S}=t.getTileBoundsBuffers(b);g.draw(a,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,w,n.id,T,k,S)}},sky:function(t,i,n){const r=t.transform,o="mercator"===r.projection.name||"globe"===r.projection.name?1:e.smoothstep(7,8,r.zoom),s=n.paint.get("sky-opacity")*o;if(0===s)return;const a=t.context,l=n.paint.get("sky-type"),c=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),u=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,i,n,r){const o=t.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new An(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),zn(o,i,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),zn(o,i,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),zn(o,i,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),zn(o,i,c,u,l,3),e.identity(u),zn(o,i,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),zn(o,i,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,n,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((e,t,i,n,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:r}))(l.skyboxMatrix,i.getCenter(t,!1),0,r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,s,u):"gradient"===l&&"sky"===t.renderPass&&function(t,i,n,r,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new An(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.Texture(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,i,n,r,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(n),u_opacity:r,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),r,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,n,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,n,c,s,u)},debug:function(e,t,i){for(let n=0;n<i.length;n++)Sn(e,t,i[n])},custom:function(t,i,n){const r=t.context,o=n.implementation;if(t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes("custom"))e.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),e.call(o,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(e.StencilMode.disabled);const i="3d"===o.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);r.setDepthMode(i),o.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}};class Pn{constructor(t,i){this.context=new Ce(t),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zt,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ei(this,e));const n=this._terrain;this.transform.elevation=i?n:null,n.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=t.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const r=i+.78*(n-i);this.transform.fogCullDistSq=r*r}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const r=new e.StructArrayLayout2i4;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.StructArrayLayout1ui2;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new Ln(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,wi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,n){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of n)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const r=this.context,o=r.gl;this.nextStencilID+n.length>256&&this.clearStencil(),r.setColorMode(e.ColorMode.disabled),r.setDepthMode(e.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of n){const n=i.getTile(t),a=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(n);s.draw(r,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},a,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,wi(t.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,n=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=n[n.length-1].overscaledZ,o=n[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let n=0;n<o;n++)t[n+r]=new e.StencilMode({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[t,n]}return[{[r]:e.StencilMode.disabled},n]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,n){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const n=this.style.order,r=this.style._sourceCaches;for(const e in r){const t=r[e];t.used&&t.prepare(this.context)}const o={},s={},a={};for(const e in r){const t=r[e];o[e]=t.getVisibleCoordinates(),s[e]=o[e].slice().reverse(),a[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<n.length;e++)if(this.style._layers[n[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),e.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const e of n){const i=this.style._layers[e],n=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const r=n?s[n.id]:void 0;("custom"===i.type||i.isSky()||r&&r.length)&&this.renderLayer(this,n,i,r)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky())continue;const r=i?s[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,i){const n=t.context,r=n.gl,o=t.transform,s=new e.DepthMode(r.LEQUAL,e.DepthMode.ReadOnly,[0,1]),a=t.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),d=e.identity$1([]);e.rotateY$1(d,d,-e.degToRad(o._center.lng)),e.rotateX$1(d,d,e.degToRad(o._center.lat)),e.rotateZ$1(d,d,o.angle),e.rotateX$1(d,d,-o._pitch);const p=e.fromQuat(new Float32Array(16),d),f=e.mapValue(i.properties.get("star-intensity"),0,1,0,.25),m=5e-4,g=e.mapValue(i.properties.get("horizon-blend"),0,1,m,.25),y=e.globeUseCustomAntiAliasing(t,n,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=t.frameCounter/1e3%1,v=e.length(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(y,2)),b=Math.acos(x/v),w=((t,i,n,r,o,s,a,l,c,u,h,d,p,f)=>({u_frustum_tl:t,u_frustum_tr:i,u_frustum_br:n,u_frustum_bl:r,u_horizon:o,u_transition:s,u_fadeout_range:a,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:d,u_horizon_angle:p,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,g,c,u,h,f,_,b,p);t.prepareDrawProgram(n,a);const T=t.atmosphereBuffer;T&&a.draw(n,r.TRIANGLES,s,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,w,"skybox",T.vertexBuffer,T.indexBuffer,T.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?s[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;){const e=this.style._layers[n[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const r=i?("symbol"===e.type?a:s)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?o[i.id]:void 0),this.renderLayer(this,i,e,r),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;e.values(this.style._layers).forEach((e=>{const n=t._getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&Dn.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;wn(e,e.transform.height-(t.top||0),3,yn),wn(e,t.bottom||0,3,_n),Tn(e,t.left||0,3,vn),Tn(e,e.transform.width-(t.right||0),3,xn);const i=e.transform.centerPoint;!function(e,t,i,n){kn(e,t-1,i-10,2,20,n),kn(e,t-10,i-1,20,2,n)}(e,i.x,e.transform.height-i.y,bn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)||Dn[i.type](e,t,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const n=e[i],r=this.context.extTimerQuery,o=r.getQueryObjectEXT(n.query,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery;let i=0;for(const n of e)i+=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(n);return i}translatePosMatrix(t,i,n,r,o){if(!n[0]&&!n[1])return t;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const a=[o?n[0]:D(i,n[0],this.transform.zoom),o?n[1]:D(i,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,a),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&i.push("FOG"),e&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(e,t,i){this.cache=this.cache||{};const n=i||[],r=this.currentGlobalDefines().concat(n),o=Ai.cacheKey(e,r,t);return this.cache[o]||(this.cache[o]=new Ai(this.context,e,li[e],t,on[e],r)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,i,n){if(this.terrain&&this.terrain.renderingToTexture)return;const r=this.style.fog;if(r){const o=r.getOpacity(this.transform.pitch),s=((t,i,n,r,o,s,a,l,c,u,h)=>{const d=t.transform,p=i.properties.get("color").toArray01();p[3]=r;const f=t.frameCounter/1e3%1;return{u_fog_matrix:n?d.calculateFogTileMatrix(n):t.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,r,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);i.setFogUniformValues(t,s)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const r of n)i[r.key]=t[r.key]||new e.Tile(r,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class On{constructor(e=0,t=0,i=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=n}interpolate(t,i,n){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,n)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,n)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,n)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,n)),this}getCenter(t,i){const n=e.clamp((this.left+t-this.right)/2,0,t),r=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.pointGeometry(n,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new On(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rn(t,i){const n=e.getColumn(t,3);e.fromQuat(t,i),e.setColumn(t,3,n)}function Bn(t,i){const n=e.identity$1([]);return e.rotateZ$1(n,n,-i),e.rotateX$1(n,n,-t),n}function Fn(t,i){const n=[t[0],t[1],0],r=[i[0],i[1],0];if(e.length(n)>=1e-15){const t=e.normalize([],n);e.scale$2(r,t,e.dot(r,t)),i[0]=r[0],i[1]=r[1]}const o=e.cross([],i,t);if(e.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Bn(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class $n{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const n=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,r=this.position,o=e.MercatorCoordinate.fromLngLat(t,n),s=[o.x-r.x,o.y-r.y,o.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Fn(s,i)}setPitchBearing(t,i){this.orientation=Bn(e.degToRad(t),e.degToRad(-i))}}class jn{constructor(t,i){this._transform=e.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.setColumn(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.identity$1([]),t&&Rn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Bn(e,t),Rn(this._transform,this._orientation)}forward(){const t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const n=new Float64Array(16);return e.invert(n,this.getWorldToCamera(t,i)),n}getWorldToCameraPosition(t,i,n){const r=this.position;e.scale$2(r,r,-t);const o=new Float64Array(16);return e.fromScaling(o,[n,n,n]),e.translate(o,o,r),o[10]*=i,o}getWorldToCamera(t,i){const n=new Float64Array(16),r=new Float64Array(4),o=this.position;return e.conjugate(r,this._orientation),e.scale$2(o,o,-t),e.fromQuat(n,r),e.translate(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(t,i,n,r){const o=new Float64Array(16);return e.perspective(o,t,i,n,r),o}getDistanceToElevation(t){const i=0===t?0:e.mercatorZfromAltitude(t,this.position[1]),n=this.forward();return(i-this.position[2])/n[2]}clone(){return new jn([...this.position],[...this.orientation])}}function Nn(t,i){const n=Vn(t.projection,t.zoom,t.width,t.height),r=function(t,i,n,r,o){const s=new e.LngLat(n.lng-180*Gn,n.lat),a=new e.LngLat(n.lng+180*Gn,n.lat),l=t.project(s.lng,s.lat),c=t.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=e.MercatorCoordinate.fromLngLat(n);h.y=e.clamp(h.y,-.999975,.999975);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=e.MercatorCoordinate.fromLngLat(d);f.x+=Gn;const m=f.toLngLat(),g=t.project(m.lng,m.lat),y=Wn(g.x-p.x,g.y-p.y,u),_=e.MercatorCoordinate.fromLngLat(d);_.y+=Gn;const v=_.toLngLat(),x=t.project(v.lng,v.lat),b=Wn(x.x-p.x,x.y-p.y,u),w=Math.abs(y.x)/Math.abs(b.y),T=e.identity([]);e.rotateZ(T,T,-u*(1-(o?0:r)));const k=e.identity([]);return e.scale(k,k,[1,1-(1-w)*r,1]),k[4]=-b.x/b.y*r,e.rotateZ(k,k,u),e.multiply(k,T,k),k}(t.projection,0,t.center,n,i),o=Un(t);return e.scale(r,r,[o,o,1]),r}function Un(t){const i=t.projection,n=Vn(t.projection,t.zoom,t.width,t.height),r=qn(i,t.center),o=qn(i,e.LngLat.convert(i.center));return Math.pow(2,r*n+(1-n)*o)}function Vn(t,i,n,r,o=1/0){const s=t.range;if(!s)return 0;const a=Math.min(o,Math.max(n,r)),l=Math.log(a/1024)/Math.LN2;return e.smoothstep(s[0]+l,s[1]+l,i)}const Gn=1/4e4;function qn(t,i){const n=e.clamp(i.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=new e.LngLat(i.lng-180*Gn,n),o=new e.LngLat(i.lng+180*Gn,n),s=t.project(r.lng,n),a=t.project(o.lng,n),l=e.MercatorCoordinate.fromLngLat(r),c=e.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,d=c.x-l.x,p=c.y-l.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function Wn(e,t,i){const n=Math.cos(i),r=Math.sin(i);return{x:e*n-t*r,y:e*r+t*n}}class Hn{constructor(t,i,n,r,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==n?0:n,this._maxPitch=null==r?60:r,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new On,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const e=new Hn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e){const t=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||t)&&this._updateCameraOnTerrain(),(e||t)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return e.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);const r=!t(n,this.getProjection());return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return e.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;var n;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(n=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n),function(e,t,i){var n=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=n*l+o*a,e[1]=r*l+s*a,e[2]=n*-a+o*l,e[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let r=0,o=0;for(let s=0;s<i.length;s++){const a=new e.pointGeometry(i[s][0]*this.width,n+i[s][1]*(this.height-n)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,o+=c}return 0===o?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-i,r);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const r=e.length(e.sub([],this._camera.position,n));return e.clamp(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new $n;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),n=e.transformQuat([],[0,-1,0],t);if(n[2]<0)return!1;const r=Fn(i,n);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.clamp(t[2],r/n,r/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.pointGeometry(0,0)),r=this.pointCoordinate(new e.pointGeometry(this.width,0)),o=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new e.pointGeometry(0,this.height)),a=Math.floor(Math.min(n.x,r.x,o.x,s.x)),l=Math.floor(Math.max(n.x,r.x,o.x,s.x)),c=1;for(let n=a-c;n<=l+c;n++)0!==n&&i.push(new e.UnwrappedTileID(n,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const n=i,r=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<i,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*e.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,v=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=t.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?Un(this):1,w=t=>{const i=1/4e4,n=new e.MercatorCoordinate(t.x+i,t.y,t.z),r=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),s=n.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*b/i},T=t=>{const i=v,n=x;return{aabb:e.tileAABB(this,l,0,0,0,t,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:t,fullyVisible:!1}},k=[];let S=[];const C=i,E=t.reparseOverscaled?n:i,M=e=>e*e,A=M((m-this._centerAltitude)*f),z=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=I(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},I=t=>{if(t.zoom<_)return!0;if(t.zoom===C)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),o=t.aabb.distanceY(g);let s=A,l=1;if(u){s=M(t.aabb.distanceZ(g));const i=Math.pow(2,t.zoom),n=e.latFromMercatorY((t.y+1)/i),r=e.latFromMercatorY(t.y/i),o=Math.min(Math.max(a,n),r),c=e.circumferenceAtLatitude(o)/e.circumferenceAtLatitude(a);if(l=o===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===C-1&&c>=.9)return!0}else if(r&&(s=M(t.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,t.zoom),n=w(new e.MercatorCoordinate((t.x+.5)/i,(t.y+.5)/i));l=n>.85?1:n}const c=i*i+o*o+s;return c<M((1<<C-t.zoom)*y*l*((e,t)=>{if(t*M(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,A),c))};if(this.renderWorldCopies)for(let e=1;e<=3;e++)k.push(T(-e)),k.push(T(e));for(k.push(T(0));k.length>0;){const n=k.pop(),s=n.x,a=n.y;let h=n.fullyVisible;if(!h){const e=n.aabb.intersects(d);if(0===e)continue;h=2===e}if(n.zoom!==C&&I(n))for(let t=0;t<4;t++){const i=(s<<1)+t%2,c=(a<<1)+(t>>1),d={aabb:o?n.aabb.quadrant(t):e.tileAABB(this,l,n.zoom+1,i,c,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:c,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!u&&(d.tileID=new e.OverscaledTileID(n.zoom+1===C?E:n.zoom+1,n.wrap,n.zoom+1,i,c),z(d)),k.push(d)}else{const r=n.zoom===C?E:n.zoom;if(t.minzoom&&t.minzoom>r)continue;const o=c[0]-(.5+s+(n.wrap<<n.zoom))*(1<<i-n.zoom),l=c[1]-.5-a,u=n.tileID?n.tileID:new e.OverscaledTileID(r,n.wrap,n.zoom,s,a);S.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();S=S.filter((r=>{const o=[0,0,0,1],s=[e.EXTENT,e.EXTENT,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.transformMat4$1(o,o,a),e.transformMat4$1(s,s,a);const l=e.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==n){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=u.getMinMaxForTile(r.tileID)),o||(o={min:x,max:v});const s=e.furthestTileCorner(this.rotation),a=[s[0]*e.EXTENT,s[1]*e.EXTENT,o.max];e.transformMat4(a,a,i),c=(1-a[1])*this.height*.5<n}return l<i||c}))}return S.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),n=this.projection.project(t.lng,i);return new e.pointGeometry(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,i){let n,r;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(i.x-o.x)/e,r=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);n=e.x-t.x,r=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(s.x-n,s.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const n=i?e.mercatorZfromAltitude(i,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(r.x,r.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const n=null!=i?i:this._centerAltitude,r=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4$1(r,r,this.pixelMatrixInverse),e.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];e.scale$1(r,r,1/r[3]),e.scale$1(o,o,1/s);const a=r[2],l=o[2];return{p0:r,p1:o,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.transformMat4$1(i,i,this.pixelMatrixInverse),e.transformMat4$1(n,n,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(n,n,1/n[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(n,n,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],n,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:n,t:r}=t,o=e.mercatorZfromAltitude(i[2],this._center.lat),s=e.mercatorZfromAltitude(n[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],n[0],r)/this.worldSize,e.number(i[1],n[1],r)/this.worldSize,e.number(o,s,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let n=0,r=this.horizonLineFromTop();if(t.y>r)return this.pointCoordinate(t);const o=.02*r,s=t.clone();for(let t=0;t<10&&r-n>o;t++){s.y=e.number(n,r,.66);const t=this.projection.pointCoordinate3D(this,s.x,s.y);t?(r=s.y,i=t):n=s.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}_coordinatePoint(t,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.transformMat4$1(r,r,this.pixelMatrix),r[3]>0?new e.pointGeometry(r[0]/r[3],r[1]/r[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,i){const n=new e.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),r=new e.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new e.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new e.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(n,t),l=this.pointCoordinate(r,t);const c=this.pointCoordinate(o,i),u=this.pointCoordinate(s,i),h=(e,t)=>(t.y-e.y)/(t.x-e.x);return a.y>1&&l.y>=0?a=new e.MercatorCoordinate((1-u.y)/h(u,a)+u.x,1):a.y<0&&l.y<=1&&(a=new e.MercatorCoordinate(-u.y/h(u,a)+u.x,0)),l.y>1&&a.y>=0?l=new e.MercatorCoordinate((1-c.y)/h(c,l)+c.x,1):l.y<0&&a.y<=1&&(l=new e.MercatorCoordinate(-c.y/h(c,l)+c.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(c))}_getBounds3D(){const e=this.elevation;if(!e.visibleDemTiles.length)return this._getBounds(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBounds(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,n=this._distanceTileDataCache;if(n[i])return n[i];const r=t.canonical,o=1/this.height,s=this.cameraWorldSize/this.zoomScale(r.z),a=(r.x+Math.pow(2,r.z)*t.wrap)*s,l=r.y*s,c=this.point,u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return n[i]={bearing:[h,d],center:[(c.x-a)*o,(c.y-l)*o],scale:s/e.EXTENT*o},n[i]}calculateFogTileMatrix(t){const i=t.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return e.multiply(r,this.worldToFogMatrix,r),n[i]=new Float32Array(r),n[i]}calculateProjMatrix(t,i=!1){const n=t.key,r=i?this._alignedProjMatrixCache:this._projMatrixCache;if(r[n])return r[n];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),r[n]=new Float32Array(o),r[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const r=function(t,i){const{scale:n}=t.tileTransform,r=n*e.EXTENT/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o=new Float32Array(4),l=(s=i.inverseAdjustmentMatrix)[1],c=s[2],u=s[3],d=(a=[r,r])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=c*d,o[3]=u*d,o;var o,s,a,l,c,u,h,d}(t,this);return n[i]=r,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=this._camera.forward(),o=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,r[2]/=o,e.normalize(r,r);const s=t.raycast(n,r,t.exaggeration());if(s){const t=e.scaleAndAdd([],n,r,s),i=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),a=(i.z+e.length([i.x-n[0],i.y-n[1],i.z-n[2]*o]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),r=t.getAtPointOrZero(new e.MercatorCoordinate(...n)),o=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),s=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*r;if(s<o){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[t.x-n[0],t.y-n[1],t.z-n[2]],r=e.length(i);i[2]-=(o-s)/this._projectionScaler;const a=e.length(i);if(0===a)return;e.scale$2(i,i,r/a*this._projectionScaler),this._camera.position=[t.x-i[0],t.y-i[1],t.z*this._projectionScaler-i[2]],this._camera.orientation=Fn(i,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const t=this.center;return t.lat=e.clamp(t.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(t.lng=e.clamp(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:i,y:n}=this.point;let r=0,o=i,s=n;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(n-l<c&&(s=c+l),n+l>u&&(s=u-l),u-c<this.height&&(r=Math.max(r,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,n=this.worldSize/2-(e+t)/2;o=(i+n+this.worldSize)%this.worldSize-n,o-a<e&&(o=e+a),o+a>t&&(o=t-a),t-e<this.width&&(r=Math.max(r,this.width/(t-e)),o=(t+e)/2)}o===i&&s===n||(this.center=this.unproject(new e.pointGeometry(o,s))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.pixelsPerMeter;if("globe"===this.projection.name){const t=e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,i=e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=t/i}const n=Vn(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?i:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-t.x/this.width,o[9]=2*t.y/this.height;let s=e.mul([],o,r);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.identity([]);e.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.multiply(i,i,Nn(this)),e.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.multiply(s,s,i),this.inverseAdjustmentMatrix=function(e){const t=Nn(e,!0);return _([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=s,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const a=e.invert([],o);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(a,this.horizonLineFromTop(),this.height);const l=new Float32Array(16);e.identity(l),e.scale(l,l,[1,-1,1]),e.rotateX(l,l,this._pitch),e.rotateZ(l,l,this.angle);const c=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),u=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;c[8]=2*-t.x/this.width,c[9]=2*(t.y+u)/this.height,this.skyboxMatrix=e.multiply(l,c,l);const h=this.point,d=h.x,p=h.y,f=this.width%2/2,m=this.height%2/2,g=Math.cos(this.angle),y=Math.sin(this.angle),v=d-Math.round(d)+g*f+y*m,x=p-Math.round(p)+g*m+y*f,b=new Float64Array(s);if(e.translate(b,b,[v>.5?v-1:v,x>.5?x-1:x,0]),this.alignedProjMatrix=b,s=e.create(),e.scale(s,s,[this.width/2,-this.height/2,1]),e.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=e.create(),e.scale(s,s,[1,-1,1]),e.translate(s,s,[-1,-1,0]),e.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=e.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=s,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(t,t,r),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=s;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,i=this.cameraPixelsPerMeter,n=this._camera.position,r=1/this.height/this._projectionScaler,o=[t,t,i];e.scale$2(o,o,r),e.scale$2(n,n,-1),e.multiply$2(n,n,o);const s=e.create();e.translate(s,s,n),e.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,r)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*r,n.y/this.worldSize-i[1]*r,e/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=t[2];let r=1;n>0&&(r=Math.min((i-this._camera.position[2])/n,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,r),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:r}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(n),s),l=this._zoomFromMercatorZ(a);e.scaleAndAdd(t,t,i,a),this._pitch=e.clamp(n,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(r,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const n=Math.min(t.x,i.x),r=Math.max(t.x,i.x),o=Math.min(t.y,i.y),s=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.pointGeometry(n,o),new e.pointGeometry(r,s),new e.pointGeometry(n,s),new e.pointGeometry(r,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,i){const n=e.length(e.sub([],this._camera.position,t)),r=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,i){const n=[t[0],t[1],t[2],1];e.transformMat4$1(n,n,i);const r=Math.max(n[3],1e-6);return[n[0]/r,n[1]/r,n[2]/r,r]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}getCameraToCenterDistance(e){const t=Vn(e,this.zoom,this.width,this.height,1024),i=e.pixelSpaceConversion(this.center.lat,this.worldSize,t);return.5/Math.tan(.5*this._fov)*this.height*i}}function Zn(e,t){let i=!1,n=null;const r=()=>{n=null,i&&(e(),n=setTimeout(r,t),i=!1)};return()=>(i=!0,n||r(),n)}class Xn{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zn(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const i=this._map;if(!i)return"";const n=i.getCenter(),r=Math.round(100*i.getZoom())/100,o=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,o),a=Math.round(n.lng*s)/s,l=Math.round(n.lat*s)/s,c=i.getBearing(),u=i.getPitch();let h="";if(h+=t?`/${a}/${l}/${r}`:`${r}/${l}/${a}`,(c||u)&&(h+="/"+Math.round(10*c)/10),u&&(h+=`/${Math.round(u)}`),this._hashName){const t=this._hashName;let i=!1;const n=e.window.location.hash.slice(1).split("&").map((e=>{const n=e.split("=")[0];return n===t?(i=!0,`${n}=${h}`):e})).filter((e=>e));return i||n.push(`${t}=${h}`),`#${n.join("&")}`}return`#${h}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const Kn={linearity:.3,easing:e.bezier(0,0,.3,1)},Yn=e.extend({deceleration:2500,maxSpeed:1400},Kn),Jn=e.extend({deceleration:20,maxSpeed:1400},Kn),Qn=e.extend({deceleration:1e3,maxSpeed:360},Kn),er=e.extend({deceleration:1e3,maxSpeed:90},Kn);class tr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const o=nr(i.pan.mag(),n,e.extend({},Yn,t||{}));r.offset=i.pan.mult(o.amount/i.pan.mag()),r.center=this._map.transform.center,ir(r,o)}if(i.zoom){const e=nr(i.zoom,n,Jn);r.zoom=this._map.transform.zoom+e.amount,ir(r,e)}if(i.bearing){const t=nr(i.bearing,n,Qn);r.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),ir(r,t)}if(i.pitch){const e=nr(i.pitch,n,er);r.pitch=this._map.transform.pitch+e.amount,ir(r,e)}if(r.zoom||r.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function ir(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function nr(t,i,n){const{maxSpeed:r,linearity:o,deceleration:s}=n,a=e.clamp(t*o/(i/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class rr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n,r={}){const o=f(i.getCanvasContainer(),n),s=i.unproject(o);super(t,e.extend({point:o,lngLat:s,originalEvent:n},r)),this._defaultPrevented=!1,this.target=i}}class or extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,n){const r="touchend"===t?n.changedTouches:n.touches,o=m(i.getCanvasContainer(),r),s=o.map((e=>i.unproject(e))),a=o.reduce(((e,t,i,n)=>e.add(t.div(n.length))),new e.pointGeometry(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class sr extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class ar{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new sr(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new rr(e.type,this._map,e))}mouseup(e){this._map.fire(new rr(e.type,this._map,e))}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new rr(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new rr(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new rr(e.type,this._map,e))}mouseover(e){this._map.fire(new rr(e.type,this._map,e))}mouseout(e){this._map.fire(new rr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new or(e.type,this._map,e))}touchmove(e){this._map.fire(new or(e.type,this._map,e))}touchend(e){this._map.fire(new or(e.type,this._map,e))}touchcancel(e){this._map.fire(new or(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new rr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new rr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cr{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(n.x,i.x),s=Math.max(n.x,i.x),a=Math.min(n.y,i.y),l=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${r}px,${a}px)`,this._box.style.width=s-r+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const n=this._startPos,r=i;if(this.reset(),p(),n.x!==r.x||n.y!==r.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function ur(e,t){const i={};for(let n=0;n<e.length;n++)i[e[n].identifier]=t[n];return i}class hr{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const i=new e.pointGeometry(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=ur(n,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const n=ur(i,t);for(const e in this.touches){const t=this.touches[e],i=n[e];(!i||i.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class dr{constructor(e){this.singleTap=new hr(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const n=this.singleTap.touchend(e,t,i);if(n){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class pr{constructor(){this._zoomIn=new dr({numTouches:1,numTaps:2}),this._zoomOut=new dr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const n=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fr={0:1,2:2};class mr{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=fr[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gr extends mr{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class yr extends mr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class _r extends mr{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class vr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.preventDefault(),this._calculateTransform(e,t,i)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,n){n.length>0&&(this._active=!0);const r=ur(n,i),o=new e.pointGeometry(0,0),s=new e.pointGeometry(0,0);let a=0;for(const e in r){const t=r[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,r[e]=t)}if(this._touches=r,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")}),500)}}class xr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[r,o]=n,s=br(i,t,r),a=br(i,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[n,r]=this._firstTwoTouches,o=br(i,t,n),s=br(i,t,r);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function br(e,t,i){for(let n=0;n<e.length;n++)if(e[n].identifier===i)return t[n]}function wr(e,t){return Math.log(e/t)/Math.LN2}class Tr extends xr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(wr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wr(this._distance,i),pinchAround:t}}}function kr(e,t){return 180*e.angleWith(t)/Math.PI}class Sr extends xr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:kr(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=kr(e,this._startVector);return Math.abs(i)<t}}function Cr(e){return Math.abs(e.y)>Math.abs(e.x)}class Er extends xr{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Cr(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){const n=this._lastPoints;if(!n)return;const r=e[0].sub(n[0]),o=e[1].sub(n[1]);return this._map._cooperativeGestures&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(r,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,r=t.mag()>=2;if(!n&&!r)return;if(!n||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Cr(e)&&Cr(t)&&o}}const Mr={panStep:100,bearingStep:15,pitchStep:10};class Ar{constructor(){const e=Mr;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,n=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:zr,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+n*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zr(e){return e*(2-e)}const Ir=4.000244140625;class Lr{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.exported.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%Ir==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Ir?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const r=i(),o=Math.pow(2,r),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*n))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&r&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=o(t);s=e.number(r,n,i),t<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,n=(e.exported.now()-t.start)/t.duration,r=t.easing(n+.01)-t.easing(n),o=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=e.bezier(o,s,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!e.window.document.fullscreenElement||!!e.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")}),200)}}class Dr{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Or{constructor(){this._tap=new dr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=t[0],r=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rr{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Br{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fr{constructor(e,t,i,n){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $r=e=>e.zoom||e.drag||e.pitch||e.rotate;class jr extends e.Event{}class Nr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const n=e.sub([],i,t);this.radius=e.length(n[2]<0?e.div([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),n=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),r=e.add([],i,e.scale$2([],e.sub([],e.add([],n,t),i),2));i[0]=r[0],i[1]=r[1]}return i}}function Ur(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Vr{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tr(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,n]of this._listeners)t.addEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[t,i,n]of this._listeners)t.removeEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new ar(t,e));const n=t.boxZoom=new cr(t,e);this._add("boxZoom",n);const r=new pr,o=new Pr;t.doubleClickZoom=new Dr(o,r),this._add("tapZoom",r),this._add("clickZoom",o);const s=new Or;this._add("tapDragZoom",s);const a=t.touchPitch=new Er(t);this._add("touchPitch",a);const l=new yr(e),c=new _r(e);t.dragRotate=new Br(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new gr(e),h=new vr(t,e);t.dragPan=new Rr(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Sr,p=new Tr;t.touchZoomRotate=new Fr(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lr(t));const f=t.scrollZoom=new Lr(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new Ar;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$r(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,i){for(const n in e)if(n!==i&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,n=i?void 0:e,r={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(r,o,h,i,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const e in this._previousActiveHandlers)s[e]||(c[e]=n);this._previousActiveHandlers=s,(Object.keys(c).length||Ur(r))&&(this._changes.push([r,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Ur(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=r;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,n,r,o){if(!n)return;e.extend(t,n);const s={handlerName:r,originalEvent:n.originalEvent||o};void 0!==n.zoomDelta&&(i.zoom=s),void 0!==n.panDelta&&(i.drag=s),void 0!==n.pitchDelta&&(i.pitch=s),void 0!==n.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},n={};for(const[r,o,s]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.extend(i,o),e.extend(n,s);this._updateMapTransform(t,i,n),this._changes=[]}_updateMapTransform(t,i,n){const r=this._map,o=r.transform,s=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Ur(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(!Ur(t))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;void 0!==p&&(h=p),(e=>i.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),h=h||r.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a){const t=o.pointCoordinate(h);if("globe"===o.projection.name){const i=e.latFromMercatorY(t.y),n=o.center.lat,r=Math.min(e.mercatorZfromAltitude(1,i)/e.mercatorZfromAltitude(1,n),2);a=a.rotate(-o.angle),f[0]=-a.x/o.worldSize*r,f[1]=-a.y/o.worldSize*r}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),i={dir:e.normalize([],e.sub([],t,o._camera.position))};if(i.dir[2]<0){const n=o.zoomDeltaToMovement(t,l);e.scale$2(g,i.dir,n)}}const y=e.add(f,f,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,n,!0)}_fireEvents(t,i,n){const r=$r(this._eventsInProgress),o=$r(t),s={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||n,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=$r(this._eventsInProgress);if(n&&(r||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new jr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Gr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qr extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,n){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),n)}panTo(t,i,n){return this.easeTo(e.extend({center:t},i),n)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,n){return this.easeTo(e.extend({zoom:t},i),n)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,n){return this.easeTo(e.extend({bearing:t},i),n)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=e.LngLatBounds.convert(t);const n=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),n,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_cameraForBoxAndBearing(t,i,n,r){const o=this._extendCameraOptions(r),s=this.transform,a=s.padding,l=s.project(e.LngLat.convert(t)),c=s.project(e.LngLat.convert(i)),u=new e.pointGeometry(l.x,c.y),h=new e.pointGeometry(c.x,l.y),d=-e.degToRad(n),p=l.rotate(d),f=c.rotate(d),m=u.rotate(d),g=h.rotate(d),y=new e.pointGeometry(Math.max(p.x,f.x,m.x,g.x),Math.max(p.y,f.y,m.y,g.y)),_=new e.pointGeometry(Math.min(p.x,f.x,m.x,g.x),Math.min(p.y,f.y,m.y,g.y)),v=y.sub(_),x=(s.width-((a.left||0)+(a.right||0)+o.padding.left+o.padding.right))/v.x,b=(s.height-((a.top||0)+(a.bottom||0)+o.padding.top+o.padding.bottom))/v.y;if(b<0||x<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const w=Math.min(s.scaleZoom(s.scale*Math.min(x,b)),o.maxZoom),T="number"==typeof o.offset.x&&"number"==typeof o.offset.y?new e.pointGeometry(o.offset.x,o.offset.y):e.pointGeometry.convert(o.offset),k=new e.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(n*Math.PI/180),S=T.add(k).mult(s.scale/s.zoomScale(w));return{center:s.unproject(l.add(c).div(2).sub(S)),zoom:w,bearing:n}}_cameraForBox(t,i,n,r,o){const s=this._extendCameraOptions(o);n=n||0,r=r||0,t=e.LngLat.convert(t),i=e.LngLat.convert(i);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),c=new e.LngLat(.5*(t.lng+i.lng),.5*(t.lat+i.lat)),u=.5*(n+r);if(a._camera.position[2]<e.mercatorZfromAltitude(u,c.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=e.MercatorCoordinate.fromLngLat(t),d=e.MercatorCoordinate.fromLngLat(i),p=a.pointRayIntersection(a.centerPoint,u),f=[(m=a.rayIntersectionCoordinate(p)).x,m.y,m.z];var m;const g=a.screenPointToMercatorRay(a.centerPoint),y="globe"!==a.projection.name;let _,v=0;do{const i=Math.floor(a.zoom),o=1<<i,s=Math.min(o*h.x,o*d.x),l=Math.min(o*h.y,o*d.y),c=Math.max(o*h.x,o*d.x),u=Math.max(o*h.y,o*d.y),p=new e.Aabb([s,l,n],[c,u,r]),m=e.Frustum.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,i,y);if(2!==p.intersects(m)){_&&(a._camera.position=e.scaleAndAdd([],a._camera.position,g.dir,-_),a._updateStateFromCamera());break}const v=e.sub([],a._camera.position,f);_=.5*e.length(v),a._camera.position=e.scaleAndAdd([],a._camera.position,g.dir,_);try{a._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,i,n){return"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,i),i,n)}_raycastElevationBox(t,i){const n=this.transform.elevation;if(!n)return;const r=new e.pointGeometry(t.x,i.y),o=new e.pointGeometry(i.x,t.y),s=n.pointCoordinate(t);if(!s)return;const a=n.pointCoordinate(i);if(!a)return;const l=n.pointCoordinate(r);if(!l)return;const c=n.pointCoordinate(o);if(!c)return;const u=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new e.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new e.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),y=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),_=Math.min(s[3],Math.min(a[3],Math.min(l[3],c[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new e.LngLat(f,m),maxLngLat:new e.LngLat(g,y),minAltitude:_,maxAltitude:v}}fitScreenCoordinates(t,i,n,r,o){let s,a,l,c;"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const u=e.pointGeometry.convert(t),h=e.pointGeometry.convert(i),d=this._raycastElevationBox(u,h);if(d)s=d.minLngLat,a=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.anyCornerOffEdge(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)),this.transform.pointLocation(e.pointGeometry.convert(i)),n,r):this._cameraForBox(s,a,l,c,r),r,o)}_fitInternal(t,i,n){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,n):this.flyTo(i,n)):this}jumpTo(t,i){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let r=!1,o=!1,s=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.LngLat.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(s=!0,n.pitch=+t.pitch),null==t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),r&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),o&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),s&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.warnOnce(Gr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.warnOnce(Gr),this;this.stop();const r=n.zoom,o=n.pitch,s=n.bearing;n.setFreeCameraOptions(t);const a=r!==n.zoom,l=o!==n.pitch,c=s!==n.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),a&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),c&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,d=e.pointGeometry.convert(t.offset);let p,f,m;if("globe"===n.projection.name){const i=e.MercatorCoordinate.fromLngLat(n.center),r=d.rotate(-n.angle);i.x+=r.x/n.worldSize,i.y+=r.y/n.worldSize;const o=i.toLngLat(),s=e.LngLat.convert(t.center||o);this._normalizeCenter(s),p=n.centerPoint.add(r),f=new e.pointGeometry(i.x,i.y).mult(n.worldSize),m=new e.pointGeometry(e.mercatorXfromLng(s.lng),e.mercatorYfromLat(s.lat)).mult(n.worldSize).sub(f)}else{p=n.centerPoint.add(d);const i=n.pointLocation(p),r=e.LngLat.convert(t.center||i);this._normalizeCenter(r),f=n.project(i),m=n.project(r).sub(f)}const g=n.zoomScale(l-r);let y,_;t.around&&(y=e.LngLat.convert(t.around),_=n.locationPoint(y));const v=this._zooming||l!==r,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!n.isPaddingEqual(h),T=n=>T=>{if(v&&(n.zoom=e.number(r,l,T)),x&&(n.bearing=e.number(o,c,T)),b&&(n.pitch=e.number(s,u,T)),w&&(n.interpolatePadding(a,h,T),p=n.centerPoint.add(d)),y)n.setLocationAtPoint(y,_);else{const e=n.zoomScale(n.zoom-r),t=l>r?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-T),o=n.unproject(f.add(m.mult(T*i)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(T,t.duration,n);return this._preloadTiles(e),this}const k={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,k),this._ease(T(n),(e=>{n.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||n.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.Event("zoomend",t)),r&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(!t.essential&&e.exported.prefersReducedMotion){const n=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(n,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const n=this.transform,r=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,n.minZoom,n.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,d=n.zoomScale(l-r),p=e.pointGeometry.convert(t.offset);let f=n.centerPoint.add(p);const m=n.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const y=n.project(m),_=n.project(g).sub(y);let v=t.curve;const x=Math.max(n.width,n.height),b=x/d,w=_.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,r,l),n.minZoom,n.maxZoom),o=x/n.zoomScale(i-r);v=Math.sqrt(o/w*2)}const T=v*v;function k(e){const t=(b*b-x*x+(e?-1:1)*T*T*w*w)/(2*(e?b:x)*T*w);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return(Math.exp(e)-Math.exp(-e))/2}function C(e){return(Math.exp(e)+Math.exp(-e))/2}const E=k(0);let M=function(e){return C(E)/C(E+v*e)},A=function(e){return x*((C(E)*(S(t=E+v*e)/C(t))-S(E))/T)/w;var t},z=(k(1)-E)/v;if(Math.abs(w)<1e-6||!isFinite(z)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;z=Math.abs(Math.log(b/x))/v,A=function(){return 0},M=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*z/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const I=o!==c,L=u!==s,D=!n.isPaddingEqual(h),P=n=>d=>{const m=d*z,v=1/M(m);n.zoom=1===d?l:r+n.scaleZoom(v),I&&(n.bearing=e.number(o,c,d)),L&&(n.pitch=e.number(s,u,d)),D&&(n.interpolatePadding(a,h,d),f=n.centerPoint.add(p));const x=1===d?g:n.unproject(y.add(_.mult(A(m))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?x.wrap():x,f),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),n};if(t.preloadOnly){const e=this._emulate(P,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=I,this._pitching=L,this._padding=D,this._prepareEase(i,!1),this._ease(P(n),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,n){!1===n.animate||0===n.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const n=Math.abs(t-i);return Math.abs(t-360-i)<n&&(t-=360),Math.abs(t+360-i)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_emulate(e,t,i){const n=Math.ceil(15*t/1e3),r=[],o=e(i.clone());for(let e=0;e<=n;e++){const t=o(e/n);r.push(t.clone())}return r}}class Wr{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const n=i.reduce(((e,t,n)=>(t.value&&(e+=`${t.key}=${t.value}${n<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${n}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const n=t[i];if(n.used){const t=n.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let n=i+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hr{constructor(){e.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Zr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xr(t,i,n){if(t=new e.LngLat(t.lng,t.lat),i){const r=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),a=n.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(r).distSqr(i)<a&&(l||Math.abs(r.lng-n.center.lng)<s)?t=r:n.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-n.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const Kr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yr extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,n=27,r=s("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},r));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const n=this._element.classList;for(const e in Kr)n.remove(`mapboxgl-marker-anchor-${e}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-i+n)],"bottom-right":[-n,-1*(t-i+n)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map;if(!e)return!1;const t=e.unproject(this._pos),i=e.getFreeCameraOptions();if(!i.position)return!1;const n=i.position.toLngLat();return n.distanceTo(t)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(i);let r;t._usingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=.2)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._calculateXYTransform()+this._calculateZTransform(),i=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px) ${Kr[this._anchor]}\n            ${t}\n            translate(${i.x}px,${i.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map;if("map"!==this.getPitchAlignment()||!i||!t)return"";if(!i._usingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const n=e.radToDeg(e.globeTiltAtLngLat(i.transform,this._lngLat)),r=t.sub(e.globeCenterToScreenPoint(i.transform)),o=n/(Math.abs(r.x)+Math.abs(r.y)),s=r.x*o,a=-r.y*o;return a||s?`rotateX(${a}deg) rotateY(${s}deg)`:""}_calculateZTransform(){const e=this._calculateRotation();return e?`rotateZ(${e}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const i=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),n=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(i);return this._rotation+e.radToDeg(Math.atan2(n.y,n.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){e.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Xr(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._usingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){const i=this._map;if(i){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map;t&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Jr{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const Qr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},eo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function to(e){e.parentNode&&e.parentNode.removeChild(e)}const io={showCompass:!0,showZoom:!0,visualizePitch:!1};class no{constructor(t,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new yr({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new _r({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const i=this.map,n=this.mouseRotate.mousemoveWindow(e,t),r=n&&n.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),r=n&&n.pitchDelta;r&&i.setPitch(i.getPitch()+r)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ro={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},oo={maxWidth:100,unit:"metric"};function so(e,t,i,n,r,o){const s=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(i),a=s/i;o._requestDomTask((()=>{e.style.width=t*a+"px",e.innerHTML="nautical-mile"!==r?new Intl.NumberFormat(n,{style:"unit",unitDisplay:"narrow",unit:r}).format(s):`${s}&nbsp;nm`}))}const ao={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(t=new e.pointGeometry(0,0),i="bottom"){if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.pointGeometry(0,t);case"top-left":return new e.pointGeometry(n,n);case"top-right":return new e.pointGeometry(-n,n);case"bottom":return new e.pointGeometry(0,-t);case"bottom-left":return new e.pointGeometry(n,-n);case"bottom-right":return new e.pointGeometry(-n,-n);case"left":return new e.pointGeometry(t,0);case"right":return new e.pointGeometry(-t,0)}return new e.pointGeometry(0,0)}return t instanceof e.pointGeometry||Array.isArray(t)?e.pointGeometry.convert(t):e.pointGeometry.convert(t[i]||[0,0])}const uo={version:e.version,supported:i,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends qr{constructor(t){if(null!=(t=e.extend({},eo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Hn(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._language="auto"===t.language?e.window.navigator.language:t.language,this._worldview=t.worldview,this._renderTaskQueue=new Zr,this._domRenderTaskQueue=new Zr,this._controls=[],this._markers=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Qr,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jr(0),this._explicitProjection=null,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Vr(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this._hash=t.hash&&new Xn("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.attributionControl&&this.addControl(new Wr({customAttribution:t.customAttribution})),this._logoControl=new Hr,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return-1!==i.indexOf("bottom")?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getLanguage(){return this._language}setLanguage(t){if(this._language="auto"===t?e.window.navigator.language:t,this.style)for(const e in this.style._sourceCaches){const t=this.style._sourceCaches[e]._source;t._setLanguage&&t._setLanguage(this._language)}for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){if(this._worldview=e,this.style)for(const t in this.style._sourceCaches){const i=this.style._sourceCaches[t]._source;i._setWorldview&&i._setWorldview(e)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._updateProjection(e)}_updateProjection(t){const i=this.getProjection();null===t&&(this._explicitProjection=null);const n=t||this.getProjection();let r;if(n&&"globe"===n.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(r=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(r=this.transform.setProjection(n),this.transform.mercatorFromTransition=!1),t&&(this._explicitProjection="globe"===t.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),r){if("globe"===i.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const e in this.style._sourceCaches)this.style._sourceCaches[e].clearTiles()}this._update(!0)}return this}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];s.length?n||(n=!0,i.call(this,new rr(e,this,r.originalEvent,{features:s}))):n=!1},o=()=>{n=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let n=!1;const r=r=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(r.point,{layers:o}):[]).length?n=!0:n&&(n=!1,i.call(this,new rr(e,this,r.originalEvent)))},o=t=>{n&&(n=!1,i.call(this,new rr(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:r,mouseout:o}}}{const n=e=>{const n=t.filter((e=>this.getLayer(e))),r=n.length?this.queryRenderedFeatures(e.point,{layers:n}):[];r.length&&(e.features=r,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:n}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const n=this._createDelegatedListener(e,t,i);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const n=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[e]:void 0;return r&&(e=>{for(let r=0;r<e.length;r++){const o=e[r];if(o.listener===i&&n(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(r,1),this}}})(r),this}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}queryTerrainElevation(t,i){const n=this.transform.elevation;return n?(i=e.extend({},{exaggerated:!0},i),n.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,i.exaggerated)):null}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new ei(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ei(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const n=this._requestManager.normalizeStyleURL(t),r=this._requestManager.transformRequest(n,e.ResourceType.Style);e.getJSON(r,((t,n)=>{t?this.fire(new e.ErrorEvent(t)):n&&this._updateDiff(n,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(n){e.warnOnce(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:n=1,sdf:r=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap){const{width:l,height:c,data:u}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:o,stretchY:s,content:a,sdf:r,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,i){const n=this.style.getImage(t);if(!n)return void this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?e.exported.getImageData(i):i,{width:o,height:s}=r;void 0!==o&&void 0!==s?o===n.data.width&&s===n.data.height?(n.data.replace(r.data,!(i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new e.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,n)=>{i(t,n instanceof e.window.HTMLImageElement?e.exported.getImageData(n):n)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,n={}){return this.style.setPaintProperty(e,t,i,n),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,n={}){return this.style.setLayoutProperty(e,t,i,n),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let n,r,o,s=this._container;for(;s&&(!r||!o);){const t=e.window.getComputedStyle(s).transform;t&&"none"!==t&&(n=t.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&"0"!==n[0]&&"1"!==n[0]&&(r=n[0]),n[3]&&"0"!==n[3]&&"1"!==n[3]&&(o=n[3])),s=s.parentElement}this._containerWidth=r?Math.abs(t/r):t,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{n[e]=o("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const n=e.exported.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const t=e.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);n?(e.storeAuthState(n,!0),this.painter=new Pn(n,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(n)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;const n=this.painter.context.extTimerQuery,r=e.exported.now();if(this.listens("gpu-timing-frame")&&(i=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let o=!1;const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,n=e.exported.now();this.style.zoomHistory.update(t,n);const r=new e.EvaluationParameters(t,{now:n,fadeDuration:s,pitch:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=r.crossFadingFactor();1===a&&a===this._crossFadingFactor||(o=!0,this._crossFadingFactor=a),this.style.update(r)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(r),this.style._updateSources(this.transform),this._forceMarkerUpdate()):a=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.exported.now()-r;n.endQueryEXT(n.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=n.getQueryObjectEXT(i,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:o})),e.window.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(r,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const e of this._markers)e._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation(),r=!1;this.transform.elevation&&(r=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-n);if(o>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof Hr&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function r(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,i){let n=i[1]-i[0];const r=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);n+=(i[o+2]-i[o+1])*(1-a/r)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),to(this._canvasContainer),to(this._controlContainer),to(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},io,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new no(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=o("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({geolocation:e.window.navigator.geolocation},ro,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zn(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{this._supportsGeolocation="denied"!==e.state,t(this._supportsGeolocation)})):(this._supportsGeolocation=!!this.geolocation,t(this._supportsGeolocation))}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,r=this._map.getBearing(),o=e.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wr,ScaleControl:class{constructor(t){this.options=e.extend({},oo,t),e.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(e,t,i,n){const r=n&&n.maxWidth||100,o=e._containerHeight/2,s=e._containerWidth/2-r/2,a=e.unproject([s,o]),l=e.unproject([s+r,o]),c=a.distanceTo(l);if(n&&"imperial"===n.unit){const n=3.2808*c;n>5280?so(t,r,n/5280,i,"mile",e):so(t,r,n,i,"foot",e)}else n&&"nautical"===n.unit?so(t,r,c/1852,i,"nautical-mile",e):c>=1e3?so(t,r,c/1e3,i,"kilometer",e):so(t,r,c,i,"meter",e)}(this._map,this._container,this._language,this.options)}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(ao),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),n=e.window.document.createElement("body");let r;for(n.innerHTML=t;r=n.firstChild,r;)i.appendChild(r);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,n=this._pos;if(!t||!i||!n)return"bottom";const r=i.offsetWidth,o=i.offsetHeight,s=n.x<r/2,a=n.x>t.transform.width-r/2;if(n.y+e<o)return s?"top-left":a?"top-right":"top";if(n.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xr(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),n=co(this.options.offset),r=this._anchor=this._getAnchor(n.y),o=co(this.options.offset,r),s=e.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${Kr[r]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._usingGlobe()){const t=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(lo);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Yr,Style:ei,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:$n,Evented:e.Evented,config:e.config,prewarm:function(){Ne().acquire(Fe)},clearPrewarmedResources:function(){const e=je;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Fe),je=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return $e.workerCount},set workerCount(e){$e.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return uo})),i}(),gt=t({__proto__:null,default:mt},[ft.exports]),yt={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carrée projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0° is directly above, at zenith, and 90° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0° is directly above, at zenith, and 90° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},_t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function vt(e){var t={exports:{}};return e(t,t.exports),t.exports}function xt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*! https://mths.be/punycode v1.3.2 by @mathias */
vt((function(e,t){!function(i){var n=t&&!t.nodeType&&t,r=e&&!e.nodeType&&e,o="object"==typeof _t&&_t;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var s,a,l=2147483647,c=36,u=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(p[e])}function y(e,t){for(var i=e.length,n=[];i--;)n[i]=t(e[i]);return n}function _(e,t){var i=e.split("@"),n="";return i.length>1&&(n=i[0]+"@",e=i[1]),n+y((e=e.replace(d,".")).split("."),t).join(".")}function v(e){for(var t,i,n=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(i=e.charCodeAt(r++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),r--):n.push(t);return n}function x(e){return y(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,i){var n=0;for(e=i?f(e/700):e>>1,e+=f(e/t);e>455;n+=c)e=f(e/35);return f(n+36*e/(e+38))}function T(e){var t,i,n,r,o,s,a,u,h,d,p,m=[],y=e.length,_=0,v=128,b=72;for((i=e.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)e.charCodeAt(n)>=128&&g("not-basic"),m.push(e.charCodeAt(n));for(r=i>0?i+1:0;r<y;){for(o=_,s=1,a=c;r>=y&&g("invalid-input"),((u=(p=e.charCodeAt(r++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:c)>=c||u>f((l-_)/s))&&g("overflow"),_+=u*s,!(u<(h=a<=b?1:a>=b+26?26:a-b));a+=c)s>f(l/(d=c-h))&&g("overflow"),s*=d;b=w(_-o,t=m.length+1,0==o),f(_/t)>l-v&&g("overflow"),v+=f(_/t),_%=t,m.splice(_++,0,v)}return x(m)}function k(e){var t,i,n,r,o,s,a,u,h,d,p,y,_,x,T,k=[];for(y=(e=v(e)).length,t=128,i=0,o=72,s=0;s<y;++s)(p=e[s])<128&&k.push(m(p));for(n=r=k.length,r&&k.push("-");n<y;){for(a=l,s=0;s<y;++s)(p=e[s])>=t&&p<a&&(a=p);for(a-t>f((l-i)/(_=n+1))&&g("overflow"),i+=(a-t)*_,t=a,s=0;s<y;++s)if((p=e[s])<t&&++i>l&&g("overflow"),p==t){for(u=i,h=c;!(u<(d=h<=o?1:h>=o+26?26:h-o));h+=c)T=u-d,x=c-d,k.push(m(b(d+T%x,0))),u=f(T/x);k.push(m(b(u,0))),o=w(i,_,n==r),i=0,++n}++i,++t}return k.join("")}if(s={version:"1.3.2",ucs2:{decode:v,encode:x},decode:T,encode:k,toASCII:function(e){return _(e,(function(e){return h.test(e)?"xn--"+k(e):e}))},toUnicode:function(e){return _(e,(function(e){return u.test(e)?T(e.slice(4).toLowerCase()):e}))}},n&&r)if(e.exports==n)r.exports=s;else for(a in s)s.hasOwnProperty(a)&&(n[a]=s[a]);else i.punycode=s}(_t)}));var bt=function(e,t,i,n){t=t||"&",i=i||"=";var r={};if("string"!=typeof e||0===e.length)return r;var o=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var c,u,h,d,p=e[l].replace(o,"%20"),f=p.indexOf(i);f>=0?(c=p.substr(0,f),u=p.substr(f+1)):(c=p,u=""),h=decodeURIComponent(c),d=decodeURIComponent(u),xt(r,h)?Array.isArray(r[h])?r[h].push(d):r[h]=[r[h],d]:r[h]=d}return r},wt=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},Tt=function(e,t,i,n){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var r=encodeURIComponent(wt(n))+i;return Array.isArray(e[n])?e[n].map((function(e){return r+encodeURIComponent(wt(e))})).join(t):r+encodeURIComponent(wt(e[n]))})).join(t):n?encodeURIComponent(wt(n))+i+encodeURIComponent(wt(e)):""};function kt(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}vt((function(e,t){t.decode=t.parse=bt,t.encode=t.stringify=Tt}));class St extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Ct{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Ct(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Et={kind:"null"},Mt={kind:"number"},At={kind:"string"},zt={kind:"boolean"},It={kind:"color"},Lt={kind:"object"},Dt={kind:"value"},Pt={kind:"collator"},Ot={kind:"formatted"},Rt={kind:"resolvedImage"};function Bt(e,t){return{kind:"array",itemType:e,N:t}}function Ft(e){if("array"===e.kind){const t=Ft(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const $t=[Et,Mt,At,zt,It,Ot,Lt,Bt(Dt),Rt];function jt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!jt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of $t)if(!jt(e,t))return null}return`Expected ${Ft(e)} but found ${Ft(t)} instead.`}function Nt(e,t){return t.some((t=>t.kind===e.kind))}function Ut(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Vt=vt((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return e<0?0:e>1?1:e}function o(e){return"%"===e[e.length-1]?n(parseFloat(e)/100*255):n(parseInt(e))}function s(e){return"%"===e[e.length-1]?r(parseFloat(e)/100):r(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in i)return i[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=r.indexOf("("),c=r.indexOf(")");if(-1!==l&&c+1===r.length){var u=r.substr(0,l),h=r.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case"hsla":if(4!==h.length)return null;d=s(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[n(255*a(y,g,p+1/3)),n(255*a(y,g,p)),n(255*a(y,g,p-1/3)),d];default:return null}}return null}}catch(e){}}));class Gt{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof Gt)return e;if("string"!=typeof e)return;const t=Vt.parseCSSColor(e);return t?new Gt(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${n})`}toArray(){const{r:e,g:t,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*i/n,n]}}Gt.black=new Gt(0,0,0,1),Gt.white=new Gt(1,1,1,1),Gt.transparent=new Gt(0,0,0,0),Gt.red=new Gt(1,0,0,1),Gt.blue=new Gt(0,0,1,1);class qt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wt{constructor(e,t,i,n,r){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=n,this.textColor=r}}class Ht{constructor(e){this.sections=e}static fromString(e){return new Ht([new Wt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Ht?e:Ht.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class Zt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Zt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Xt(e,t,i,n){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255)){return`Invalid rgba value [${("number"==typeof n?[e,t,i,n]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,i,n].join(", ")}]: 'a' must be between 0 and 1.`}function Kt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Gt)return!0;if(e instanceof qt)return!0;if(e instanceof Ht)return!0;if(e instanceof Zt)return!0;if(Array.isArray(e)){for(const t of e)if(!Kt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Kt(e[t]))return!1;return!0}return!1}function Yt(e){if(null===e)return Et;if("string"==typeof e)return At;if("boolean"==typeof e)return zt;if("number"==typeof e)return Mt;if(e instanceof Gt)return It;if(e instanceof qt)return Pt;if(e instanceof Ht)return Ot;if(e instanceof Zt)return Rt;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=Yt(t);if(i){if(i===e)continue;i=Dt;break}i=e}return Bt(i||Dt,t)}return Lt}function Jt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Gt||e instanceof Ht||e instanceof Zt?e.toString():JSON.stringify(e)}class Qt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Kt(e[1]))return t.error("invalid value");const i=e[1];let n=Yt(i);const r=t.expectedType;return"array"!==n.kind||0!==n.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(n=r),new Qt(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Gt?["rgba"].concat(this.value.toArray()):this.value instanceof Ht?this.value.serialize():this.value}}class ei{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ti={string:At,number:Mt,boolean:zt,object:Lt};class ii{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,n=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in ti)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=ti[i],n++}else r=Dt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}i=Bt(r,o)}else i=ti[r];const o=[];for(;n<e.length;n++){const i=t.parse(e[n],n,Dt);if(!i)return null;o.push(i)}return new ii(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!jt(this.type,Yt(i)))return i;if(t===this.args.length-1)throw new ei(`Expected value to be of type ${Ft(this.type)}, but found ${Ft(Yt(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((e=>e.serialize())))}}class ni{constructor(e){this.type=Ot,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const n=[];let r=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Mt),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,Bt(At)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,It),!s))return null;const a=n[n.length-1];a.scale=e,a.font=i,a.textColor=s}else{const o=t.parse(e[i],1,Dt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,n.push({content:o,scale:null,font:null,textColor:null})}}return new ni(n)}evaluate(e){return new Ht(this.sections.map((t=>{const i=t.content.evaluate(e);return Yt(i)===Rt?new Wt("",i,null,null,null):new Wt(Jt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class ri{constructor(e){this.type=Rt,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,At);return i?new ri(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Zt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const oi={"to-boolean":zt,"to-color":It,"to-number":Mt,"to-string":At};class si{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const n=oi[i],r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,Dt);if(!n)return null;r.push(n)}return new si(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const n of this.args){if(t=n.evaluate(e),i=null,t instanceof Gt)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Xt(t[0],t[1],t[2],t[3]),!i))return new Gt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ei(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new ei(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Ht.fromString(Jt(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Zt.fromString(Jt(this.args[0].evaluate(e))):Jt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new ni([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ri(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const ai=["Unknown","Point","LineString","Polygon"];class li{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ai[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord,r=i*t-e[0],o=n*t-e[1];return this.featureDistanceData.bearing[0]*r+this.featureDistanceData.bearing[1]*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Gt.parse(e)),t}}class ci{constructor(e,t,i,n){this.name=e,this.type=t,this._evaluate=i,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],n=ci.definitions[i];if(!n)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,o]of s){a=new Li(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],r=Array.isArray(n)?n[t-1]:n.type,o=a.parse(i,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(n)?n[e]:n.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new ci(i,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ft).join(", ")})`:`(${Ft(t.type)}...)`;var t})).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(Ft(r.type))}t.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){ci.definitions=t;for(const i in t)e[i]=ci}}class ui{constructor(e,t,i){this.type=Pt,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,zt);if(!n)return null;const r=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,zt);if(!r)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,At),!o)?null:new ui(n,r,o)}evaluate(e){return new qt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function hi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function di(e,t){return!(e[0]<=t[0])&&(!(e[2]>=t[2])&&(!(e[1]<=t[1])&&!(e[3]>=t[3])))}function pi(e,t){const i=(180+e[0])/360;const n=(r=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360);var r;const o=Math.pow(2,t.z);return[Math.round(i*o*8192),Math.round(n*o*8192)]}function fi(e,t,i){const n=e[0]-t[0],r=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return n*s-o*r==0&&n*o<=0&&r*s<=0}function mi(e,t){let i=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(fi(e,a[t],a[t+1]))return!1;n=e,r=a[t],o=a[t+1],r[1]>n[1]!=o[1]>n[1]&&n[0]<(o[0]-r[0])*(n[1]-r[1])/(o[1]-r[1])+r[0]&&(i=!i)}}var n,r,o;return i}function gi(e,t){for(let i=0;i<t.length;i++)if(mi(e,t[i]))return!0;return!1}function yi(e,t,i,n){const r=e[0]-i[0],o=e[1]-i[1],s=t[0]-i[0],a=t[1]-i[1],l=n[0]-i[0],c=n[1]-i[1],u=r*c-l*o,h=s*c-l*a;return u>0&&h<0||u<0&&h>0}function _i(e,t,i,n){const r=[t[0]-e[0],t[1]-e[1]],o=[n[0]-i[0],n[1]-i[1]];return 0!=(s=o)[0]*(a=r)[1]-s[1]*a[0]&&!(!yi(e,t,i,n)||!yi(i,n,e,t));var s,a}function vi(e,t,i){for(const n of i)for(let i=0;i<n.length-1;++i)if(_i(e,t,n[i],n[i+1]))return!0;return!1}function xi(e,t){for(let i=0;i<e.length;++i)if(!mi(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(vi(e[i],e[i+1],t))return!1;return!0}function bi(e,t){for(let i=0;i<t.length;i++)if(xi(e,t[i]))return!0;return!1}function wi(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=[];for(let n=0;n<e[r].length;n++){const s=pi(e[r][n],i);hi(t,s),o.push(s)}n.push(o)}return n}function Ti(e,t,i){const n=[];for(let r=0;r<e.length;r++){const o=wi(e[r],t,i);n.push(o)}return n}function ki(e,t,i,n){if(e[0]<i[0]||e[0]>i[2]){const t=.5*n;let r=e[0]-i[0]>t?-n:i[0]-e[0]>t?n:0;0===r&&(r=e[0]-i[2]>t?-n:i[2]-e[0]>t?n:0),e[0]+=r}hi(t,e)}function Si(e,t,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];ki(n,t,i,r),s.push(n)}return s}function Ci(e,t,i,n){const r=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[];if(!e)return s;for(const i of e){const e=[];for(const n of i){const i=[n.x+o[0],n.y+o[1]];hi(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const n of e)ki(n,t,i,r)}var a;return s}class Ei{constructor(e,t){this.type=zt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Kt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ei(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Ei(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Ei(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=wi(t.coordinates,n,r),s=Si(e.geometry(),i,n,r);if(!di(i,n))return!1;for(const e of s)if(!mi(e,o))return!1}if("MultiPolygon"===t.type){const o=Ti(t.coordinates,n,r),s=Si(e.geometry(),i,n,r);if(!di(i,n))return!1;for(const e of s)if(!gi(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if(!r)return!1;if("Polygon"===t.type){const o=wi(t.coordinates,n,r),s=Ci(e.geometry(),i,n,r);if(!di(i,n))return!1;for(const e of s)if(!xi(e,o))return!1}if("MultiPolygon"===t.type){const o=Ti(t.coordinates,n,r),s=Ci(e.geometry(),i,n,r);if(!di(i,n))return!1;for(const e of s)if(!bi(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Mi(e){if(e instanceof ci){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Ei)return!1;let t=!0;return e.eachChild((e=>{t&&!Mi(e)&&(t=!1)})),t}function Ai(e){if(e instanceof ci&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Ai(e)&&(t=!1)})),t}function zi(e,t){if(e instanceof ci&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!zi(e,t)&&(i=!1)})),i}class Ii{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Ii(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Li{constructor(e,t=[],i,n=new Ct,r=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=r,this.expectedType=i}parse(e,t,i,n,r={}){return t?this.concat(t,i,n)._parse(e,r):this._parse(e,r)}_parse(e,t){function i(e,t,i){return"assert"===i?new ii(t,[e]):"coerce"===i?new si(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[n];if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Qt)&&"resolvedImage"!==n.type.kind&&Di(n)){const e=new li;try{n=new Qt(n.type,n.evaluate(e))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const n="number"==typeof e?this.path.concat(e):this.path,r=i?this.scope.concat(i):this.scope;return new Li(this.registry,n,t||null,r,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new St(i,e))}checkSubtype(e,t){const i=jt(e,t);return i&&this.error(i),i}}function Di(e){if(e instanceof Ii)return Di(e.boundExpression);if(e instanceof ci&&"error"===e.name)return!1;if(e instanceof ui)return!1;if(e instanceof Ei)return!1;const t=e instanceof si||e instanceof ii;let i=!0;return e.eachChild((e=>{i=t?i&&Di(e):i&&e instanceof Qt})),!!i&&(Mi(e)&&zi(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function Pi(e,t){const i=e.length-1;let n,r,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),n=e[a],r=e[a+1],n<=t){if(a===i||t<r)return a;o=a+1}else{if(!(n>t))throw new ei("Input is not a number.");s=a-1}return 0}class Oi{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Mt);if(!i)return null;const n=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,n.push([o,c])}return new Oi(r,i,n)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);return i[Pi(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Ri=Bi;function Bi(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}function Fi(e,t,i){return e*(1-i)+t*i}Bi.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Bi.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Bi.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Bi.prototype.solveCurveX=function(e,t){var i,n,r,o,s;for(void 0===t&&(t=1e-6),r=e,s=0;s<8;s++){if(o=this.sampleCurveX(r)-e,Math.abs(o)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=o/a}if((r=e)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(r),Math.abs(o-e)<t)return r;e>o?i=r:n=r,r=.5*(n-i)+i}return r},Bi.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var $i=Object.freeze({__proto__:null,number:Fi,color:function(e,t,i){return new Gt(Fi(e.r,t.r,i),Fi(e.g,t.g,i),Fi(e.b,t.b,i),Fi(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,n)=>Fi(e,t[n],i)))}});const ji=4/29,Ni=6/29,Ui=3*Ni*Ni,Vi=Math.PI/180,Gi=180/Math.PI;function qi(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ui+ji}function Wi(e){return e>Ni?e*e*e:Ui*(e-ji)}function Hi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Zi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Xi(e){const t=Zi(e.r),i=Zi(e.g),n=Zi(e.b),r=qi((.4124564*t+.3575761*i+.1804375*n)/.95047),o=qi((.2126729*t+.7151522*i+.072175*n)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-qi((.0193339*t+.119192*i+.9503041*n)/1.08883)),alpha:e.a}}function Ki(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Wi(t),i=.95047*Wi(i),n=1.08883*Wi(n),new Gt(Hi(3.2404542*i-1.5371385*t-.4985314*n),Hi(-.969266*i+1.8760108*t+.041556*n),Hi(.0556434*i-.2040259*t+1.0572252*n),e.alpha)}function Yi(e,t,i){const n=t-e;return e+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Ji={forward:Xi,reverse:Ki,interpolate:function(e,t,i){return{l:Fi(e.l,t.l,i),a:Fi(e.a,t.a,i),b:Fi(e.b,t.b,i),alpha:Fi(e.alpha,t.alpha,i)}}},Qi={forward:function(e){const{l:t,a:i,b:n}=Xi(e),r=Math.atan2(n,i)*Gi;return{h:r<0?r+360:r,c:Math.sqrt(i*i+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Vi,i=e.c;return Ki({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Yi(e.h,t.h,i),c:Fi(e.c,t.c,i),l:Fi(e.l,t.l,i),alpha:Fi(e.alpha,t.alpha,i)}}};class en{constructor(e,t,i,n,r){this.type=e,this.operator=t,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,n){let r=0;if("exponential"===e.name)r=tn(t,e.base,i,n);else if("linear"===e.name)r=tn(t,1,i,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new Ri(o[0],o[1],o[2],o[3]).solve(tn(t,1,i,n))}return r}static parse(e,t){let[i,n,r,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,Mt),!r)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=It:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],n=o[e+1],r=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new en(a,i,n,r,s):t.error(`Type ${Ft(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return i[0].evaluate(e);const r=t.length;if(n>=t[r-1])return i[r-1].evaluate(e);const o=Pi(t,n),s=t[o],a=t[o+1],l=en.interpolationFactor(this.interpolation,n,s,a),c=i[o].evaluate(e),u=i[o+1].evaluate(e);return"interpolate"===this.operator?$i[this.type.kind.toLowerCase()](c,u,l):"interpolate-hcl"===this.operator?Qi.reverse(Qi.interpolate(Qi.forward(c),Qi.forward(u),l)):Ji.reverse(Ji.interpolate(Ji.forward(c),Ji.forward(u),l))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function tn(e,t,i,n){const r=n-i,o=e-i;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}class nn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const n=t.expectedType;n&&"value"!==n.kind&&(i=n);const r=[];for(const n of e.slice(1)){const e=t.parse(n,1+r.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,r.push(e)}const o=n&&r.some((e=>jt(n,e.type)));return new nn(o?Dt:i,r)}evaluate(e){let t,i=null,n=0;for(const r of this.args){if(n++,i=r.evaluate(e),i&&i instanceof Zt&&!i.available&&(t||(t=i),i=null,n===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class rn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const o=t.parse(e[n+1],n+1);if(!o)return null;i.push([r,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return n?new rn(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class on{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Mt),n=t.parse(e[2],2,Bt(t.expectedType||Dt));if(!i||!n)return null;const r=n.type;return new on(r.itemType,i,n)}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ei(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new ei(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new ei(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class sn{constructor(e,t){this.type=zt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Dt),n=t.parse(e[2],2,Dt);return i&&n?Nt(i.type,[zt,At,Mt,Et,Dt])?new sn(i,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Ut(t,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(Yt(t))} instead.`);if(!Ut(i,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Ft(Yt(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class an{constructor(e,t,i){this.type=Mt,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Dt),n=t.parse(e[2],2,Dt);if(!i||!n)return null;if(!Nt(i.type,[zt,At,Mt,Et,Dt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Mt);return r?new an(i,n,r):null}return new an(i,n)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Ut(t,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Ft(Yt(t))} instead.`);if(!Ut(i,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Ft(Yt(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(e);return i.indexOf(t,n)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ln{constructor(e,t,i,n,r,o){this.inputType=e,this.type=t,this.input=i,this.cases=n,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,Yt(e)))return null}else i=Yt(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,n);if(!u)return null;n=n||u.type,o.push(u)}const s=t.parse(e[1],1,Dt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new ln(i,n,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(Yt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const r=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of i)1===n.length?e.push(r(n[0])):e.push(n.map(r)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class cn{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const n=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,zt);if(!o)return null;const s=t.parse(e[r+1],r+1,i);if(!s)return null;n.push([o,s]),i=i||s.type}const r=t.parse(e[e.length-1],e.length-1,i);return r?new cn(i,n,r):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class un{constructor(e,t,i,n){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Dt),n=t.parse(e[2],2,Mt);if(!i||!n)return null;if(!Nt(i.type,[Bt(Dt),At,Dt]))return t.error(`Expected first argument to be of type array or string, but found ${Ft(i.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,Mt);return r?new un(i.type,i,n,r):null}return new un(i.type,i,n)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Ut(t,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${Ft(Yt(t))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(i,n)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function hn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function dn(e,t,i,n){return 0===n.compare(t,i)}function pn(e,t,i){const n="=="!==e&&"!="!==e;return class r{constructor(e,t,i){this.type=zt,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Dt);if(!o)return null;if(!hn(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Ft(o.type)}'.`);let s=t.parse(e[2],2,Dt);if(!s)return null;if(!hn(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Ft(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Ft(o.type)}' and '${Ft(s.type)}'.`);n&&("value"===o.type.kind&&"value"!==s.type.kind?o=new ii(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new ii(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Pt),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(n&&this.hasUntypedArgument){const t=Yt(o),i=Yt(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new ei(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=Yt(o),i=Yt(s);if("string"!==e.kind||"string"!==i.kind)return t(r,o,s)}return this.collator?i(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const fn=pn("==",(function(e,t,i){return t===i}),dn),mn=pn("!=",(function(e,t,i){return t!==i}),(function(e,t,i,n){return!dn(0,t,i,n)})),gn=pn("<",(function(e,t,i){return t<i}),(function(e,t,i,n){return n.compare(t,i)<0})),yn=pn(">",(function(e,t,i){return t>i}),(function(e,t,i,n){return n.compare(t,i)>0})),_n=pn("<=",(function(e,t,i){return t<=i}),(function(e,t,i,n){return n.compare(t,i)<=0})),vn=pn(">=",(function(e,t,i){return t>=i}),(function(e,t,i,n){return n.compare(t,i)>=0}));class xn{constructor(e,t,i,n,r){this.type=At,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=n,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Mt);if(!i)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let r=null;if(n.locale&&(r=t.parse(n.locale,1,At),!r))return null;let o=null;if(n.currency&&(o=t.parse(n.currency,1,At),!o))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parse(n["min-fraction-digits"],1,Mt),!s))return null;let a=null;return n["max-fraction-digits"]&&(a=t.parse(n["max-fraction-digits"],1,Mt),!a)?null:new xn(i,r,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class bn{constructor(e){this.type=Mt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Ft(i.type)} instead.`):new bn(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new ei(`Expected value to be of type string or array, but found ${Ft(Yt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const wn={"==":fn,"!=":mn,">":yn,"<":gn,">=":vn,"<=":_n,array:ii,at:on,boolean:ii,case:cn,coalesce:nn,collator:ui,format:ni,image:ri,in:sn,"index-of":an,interpolate:en,"interpolate-hcl":en,"interpolate-lab":en,length:bn,let:rn,literal:Qt,match:ln,number:ii,"number-format":xn,object:ii,slice:un,step:Oi,string:ii,"to-boolean":si,"to-color":si,"to-number":si,"to-string":si,var:Ii,within:Ei};function Tn(e,[t,i,n,r]){t=t.evaluate(e),i=i.evaluate(e),n=n.evaluate(e);const o=r?r.evaluate(e):1,s=Xt(t,i,n,o);if(s)throw new ei(s);return new Gt(t/255*o,i/255*o,n/255*o,o)}function kn(e,t){return e in t}function Sn(e,t){const i=t[e];return void 0===i?null:i}function Cn(e){return{type:e}}function En(e){return{result:"success",value:e}}function Mn(e){return{result:"error",value:e}}function An(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function zn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function In(e){return!!e.expression&&e.expression.interpolated}function Ln(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Dn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}ci.register(wn,{error:[{kind:"error"},[At],(e,[t])=>{throw new ei(t.evaluate(e))}],typeof:[At,[Dt],(e,[t])=>Ft(Yt(t.evaluate(e)))],"to-rgba":[Bt(Mt,4),[It],(e,[t])=>t.evaluate(e).toArray()],rgb:[It,[Mt,Mt,Mt],Tn],rgba:[It,[Mt,Mt,Mt,Mt],Tn],has:{type:zt,overloads:[[[At],(e,[t])=>kn(t.evaluate(e),e.properties())],[[At,Lt],(e,[t,i])=>kn(t.evaluate(e),i.evaluate(e))]]},get:{type:Dt,overloads:[[[At],(e,[t])=>Sn(t.evaluate(e),e.properties())],[[At,Lt],(e,[t,i])=>Sn(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Dt,[At],(e,[t])=>Sn(t.evaluate(e),e.featureState||{})],properties:[Lt,[],e=>e.properties()],"geometry-type":[At,[],e=>e.geometryType()],id:[Dt,[],e=>e.id()],zoom:[Mt,[],e=>e.globals.zoom],pitch:[Mt,[],e=>e.globals.pitch||0],"distance-from-center":[Mt,[],e=>e.distanceFromCenter()],"heatmap-density":[Mt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Mt,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Mt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Dt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Mt,Cn(Mt),(e,t)=>{let i=0;for(const n of t)i+=n.evaluate(e);return i}],"*":[Mt,Cn(Mt),(e,t)=>{let i=1;for(const n of t)i*=n.evaluate(e);return i}],"-":{type:Mt,overloads:[[[Mt,Mt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Mt],(e,[t])=>-t.evaluate(e)]]},"/":[Mt,[Mt,Mt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Mt,[Mt,Mt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Mt,[Mt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Mt,[Mt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Mt,[Mt],(e,[t])=>Math.log(t.evaluate(e))],log2:[Mt,[Mt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Mt,[Mt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Mt,[Mt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Mt,[Mt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Mt,[Mt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Mt,[Mt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Mt,[Mt],(e,[t])=>Math.atan(t.evaluate(e))],min:[Mt,Cn(Mt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Mt,Cn(Mt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Mt,[Mt],(e,[t])=>Math.abs(t.evaluate(e))],round:[Mt,[Mt],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Mt,[Mt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Mt,[Mt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[zt,[At,Dt],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[zt,[Dt],(e,[t])=>e.id()===t.value],"filter-type-==":[zt,[At],(e,[t])=>e.geometryType()===t.value],"filter-<":[zt,[At,Dt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<r}],"filter-id-<":[zt,[Dt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<n}],"filter->":[zt,[At,Dt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>r}],"filter-id->":[zt,[Dt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>n}],"filter-<=":[zt,[At,Dt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n<=r}],"filter-id-<=":[zt,[Dt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i<=n}],"filter->=":[zt,[At,Dt],(e,[t,i])=>{const n=e.properties()[t.value],r=i.value;return typeof n==typeof r&&n>=r}],"filter-id->=":[zt,[Dt],(e,[t])=>{const i=e.id(),n=t.value;return typeof i==typeof n&&i>=n}],"filter-has":[zt,[Dt],(e,[t])=>t.value in e.properties()],"filter-has-id":[zt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[zt,[Bt(At)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[zt,[Bt(Dt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[zt,[At,Bt(Dt)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[zt,[At,Bt(Dt)],(e,[t,i])=>function(e,t,i,n){for(;i<=n;){const r=i+n>>1;if(t[r]===e)return!0;t[r]>e?n=r-1:i=r+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Cn(zt),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Cn(zt),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[zt,[zt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[zt,[At],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[At,[At],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[At,[At],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[At,Cn(Dt),(e,t)=>t.map((t=>Jt(t.evaluate(e)))).join("")],"resolved-locale":[At,[Pt],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Pn{constructor(e,t){var i;this.expression=e,this._warningHistory={},this._evaluator=new li,this._defaultValue=t?"color"===(i=t).type&&Dn(i.default)?new Gt(0,0,0,0):"color"===i.type?Gt.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,n,r,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,n,r,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function On(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in wn}function Rn(e,t){const i=new Li(wn,[],t?function(e){const t={color:It,string:At,number:Mt,enum:At,boolean:zt,formatted:Ot,resolvedImage:Rt};if("array"===e.type)return Bt(t[e.value]||Dt,e.length);return t[e.type]}(t):void 0),n=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?En(new Pn(n,t)):Mn(i.errors)}class Bn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Ai(t.expression)}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}}class Fn{constructor(e,t,i,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Ai(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,i,n,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,n,r,o)}evaluate(e,t,i,n,r,o){return this._styleExpression.evaluate(e,t,i,n,r,o)}interpolationFactor(e,t,i){return this.interpolationType?en.interpolationFactor(this.interpolationType,e,t,i):0}}function $n(e,t){if("error"===(e=Rn(e,t)).result)return e;const i=e.value.expression,n=Mi(i);if(!n&&!An(t))return Mn([new St("","data expressions not supported")]);const r=zi(i,["zoom","pitch","distance-from-center"]);if(!r&&!zn(t))return Mn([new St("","zoom expressions not supported")]);const o=jn(i);if(!o&&!r)return Mn([new St("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof St)return Mn([o]);if(o instanceof en&&!In(t))return Mn([new St("",'"interpolate" expressions cannot be used with this property')]);if(!o)return En(new Bn(n?"constant":"source",e.value));const s=o instanceof en?o.interpolation:void 0;return En(new Fn(n?"camera":"composite",e.value,o.labels,s))}function jn(e){let t=null;if(e instanceof rn)t=jn(e.result);else if(e instanceof nn){for(const i of e.args)if(t=jn(i),t)break}else(e instanceof Oi||e instanceof en)&&e.input instanceof ci&&"zoom"===e.input.name&&(t=e);return t instanceof St||e.eachChild((e=>{const i=jn(e);i instanceof St?t=i:!t&&i?t=new St("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new St("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Nn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Un(e){if(Array.isArray(e))return e.map(Un);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=Un(e[i]);return t}return Nn(e)}function Vn(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Vn(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}class Gn{constructor(e,t,i,n){this.message=(e?`${e}: `:"")+i,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}class qn{constructor(e){this.error=e,this.message=e.message;const t=e.message.match(/line (\d+)/);this.line=t?parseInt(t[1],10):0}}function Wn(e){const t=e.key,i=e.value,n=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Ln(i);if("object"!==l)return[new Gn(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=n[l]||n["*"];let u;r[l]?u=r[l]:n[l]?u=or:r["*"]?u=r["*"]:n["*"]&&(u=or),u?a=a.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:e},i)):a.push(new Gn(t,i[e],`unknown property "${e}"`))}for(const e in n)r[e]||n[e].required&&void 0===n[e].default&&void 0===i[e]&&a.push(new Gn(t,i,`missing required property "${e}"`));return a}function Hn(e){const t=e.value,i=e.valueSpec,n=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||or;if("array"!==Ln(t))return[new Gn(o,t,`array expected, ${Ln(t)} found`)];if(i.length&&t.length!==i.length)return[new Gn(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Gn(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};r.$version<7&&(a.function=i.function),"object"===Ln(i.value)&&(a=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:n,styleSpec:r,key:`${o}[${e}]`}));return l}function Zn(e){const t=e.key,i=e.value,n=e.valueSpec;let r=Ln(i);if("number"===r&&i!=i&&(r="NaN"),"number"!==r)return[new Gn(t,i,`number expected, ${r} found`)];if("minimum"in n){let r=n.minimum;if("array"===Ln(n.minimum)){const t=e.arrayIndex;r=n.minimum[t]}if(i<r)return[new Gn(t,i,`${i} is less than the minimum value ${r}`)]}if("maximum"in n){let r=n.maximum;if("array"===Ln(n.maximum)){const t=e.arrayIndex;r=n.maximum[t]}if(i>r)return[new Gn(t,i,`${i} is greater than the maximum value ${r}`)]}return[]}function Xn(e){const t=e.valueSpec,i=Nn(e.value.type);let n,r,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===Ln(e.value.stops)&&"array"===Ln(e.value.stops[0])&&"object"===Ln(e.value.stops[0][0]),u=Wn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Gn(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;t=t.concat(Hn({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Ln(n)&&0===n.length&&t.push(new Gn(e.key,n,"array must have at least one stop"));return t},default:function(e){return or({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Gn(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Gn(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!In(e.valueSpec)&&u.push(new Gn(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!An(e.valueSpec)?u.push(new Gn(e.key,e.value,"property functions not supported")):a&&!zn(e.valueSpec)&&u.push(new Gn(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Gn(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const n=e.value,a=e.key;if("array"!==Ln(n))return[new Gn(a,n,`array expected, ${Ln(n)} found`)];if(2!==n.length)return[new Gn(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Ln(n[0]))return[new Gn(a,n,`object expected, ${Ln(n[0])} found`)];if(void 0===n[0].zoom)return[new Gn(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Gn(a,n,"object stop key must have value")];const t=Nn(n[0].zoom);if("number"!=typeof t)return[new Gn(a,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Gn(a,n[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,r=void 0,s={}),i=i.concat(Wn({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Zn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},n));return On(Un(n[1]))?i.concat([new Gn(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):i.concat(or({key:`${a}[1]`,value:n[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Ln(e.value),l=Nn(e.value),c=null!==e.value?e.value:o;if(n){if(a!==n)return[new Gn(e.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Gn(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let n=`number expected, ${a} found`;return An(t)&&void 0===i&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gn(e.key,c,n)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof r&&void 0!==r&&l<r?[new Gn(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===i&&l in s?[new Gn(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Gn(e.key,c,`integer expected, found ${String(l)}`)]}}function Kn(e){const t=("property"===e.expressionContext?$n:Rn)(Un(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Gn(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Gn(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Ai(i))return[new Gn(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Yn(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!zi(i,["zoom","feature-state"]))return[new Gn(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Mi(i))return[new Gn(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yn(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const n=[];return e instanceof ci&&i.has(e.name)?[new Gn(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{n.push(...Yn(e,t))})),n)}function Jn(e){const t=e.key,i=e.value,n=e.valueSpec,r=[];return Array.isArray(n.values)?-1===n.values.indexOf(Nn(i))&&r.push(new Gn(t,i,`expected one of [${n.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(n.values).indexOf(Nn(i))&&r.push(new Gn(t,i,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(i)} found`)),r}function Qn(e){if(Vn(Un(e.value))){const t=e.layerType||"fill";return Kn(kt({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${t}`]}))}return er(e)}function er(e){const t=e.value,i=e.key;if("array"!==Ln(t))return[new Gn(i,t,`array expected, ${Ln(t)} found`)];const n=e.styleSpec;let r,o=[];if(t.length<1)return[new Gn(i,t,"filter array must have at least 1 element")];switch(o=o.concat(Jn({key:`${i}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),Nn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Nn(t[1])&&o.push(new Gn(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Gn(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=Ln(t[1]),"string"!==r&&o.push(new Gn(`${i}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=Ln(t[s]),"$type"===Nn(t[1])?o=o.concat(Jn({key:`${i}[${s}]`,value:t[s],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new Gn(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)o=o.concat(er({key:`${i}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=Ln(t[1]),2!==t.length?o.push(new Gn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new Gn(`${i}[1]`,t[1],`string expected, ${r} found`));break;case"within":r=Ln(t[1]),2!==t.length?o.push(new Gn(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==r&&o.push(new Gn(`${i}[1]`,t[1],`object expected, ${r} found`))}return o}function tr(e,t){const i=e.key,n=e.style,r=e.styleSpec,o=e.value,s=e.objectKey,a=r[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return or({key:i,value:o,valueSpec:r.transition,style:n,styleSpec:r});const c=e.valueSpec||a[s];if(!c)return[new Gn(i,o,`unknown property "${s}"`)];let u;if("string"===Ln(o)&&An(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Gn(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&n&&!n.glyphs&&h.push(new Gn(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Dn(Un(o))&&"identity"===Nn(o.type)&&h.push(new Gn(i,o,'"text-font" does not support identity functions'))),h.concat(or({key:e.key,value:o,valueSpec:c,style:n,styleSpec:r,expressionContext:"property",propertyType:t,propertyKey:s}))}function ir(e){const t=e.value,i=e.key,n=Ln(t);return"string"!==n?[new Gn(i,t,`string expected, ${n} found`)]:[]}const nr={promoteId:function({key:e,value:t}){if("string"===Ln(t))return ir({key:e,value:t});{const i=[];for(const n in t)i.push(...ir({key:`${e}.${n}`,value:t[n]}));return i}}};const rr={"*":()=>[],array:Hn,boolean:function(e){const t=e.value,i=e.key,n=Ln(t);return"boolean"!==n?[new Gn(i,t,`boolean expected, ${n} found`)]:[]},number:Zn,color:function(e){const t=e.key,i=e.value,n=Ln(i);return"string"!==n?[new Gn(t,i,`color expected, ${n} found`)]:null===Vt.parseCSSColor(i)?[new Gn(t,i,`color expected, "${i}" found`)]:[]},enum:Jn,filter:Qn,function:Xn,layer:function(e){let t=[];const i=e.value,n=e.key,r=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Gn(n,i,'either "type" or "ref" is required'));let s=Nn(i.type);const a=Nn(i.ref);if(i.id){const o=Nn(i.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];Nn(e.id)===o&&t.push(new Gn(n,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Gn(n,i[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{Nn(t.id)===a&&(e=t)})),e?e.ref?t.push(new Gn(n,i.ref,"ref cannot reference another ref layer")):s=Nn(e.type):"string"==typeof a&&t.push(new Gn(n,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const e=r.sources&&r.sources[i.source],o=e&&Nn(e.type);e?"vector"===o&&"raster"===s?t.push(new Gn(n,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new Gn(n,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Gn(n,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Gn(n,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Gn(n,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Gn(n,i.source,`source "${i.source}" not found`))}else t.push(new Gn(n,i,'missing required property "source"'));return t=t.concat(Wn({key:n,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>or({key:`${n}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>Qn(kt({layerType:s},e)),layout:e=>Wn({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>function(e){return tr(e,"layout")}(kt({layerType:s},e))}}),paint:e=>Wn({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>function(e){return tr(e,"paint")}(kt({layerType:s},e))}})}})),t},object:Wn,source:function(e){const t=e.value,i=e.key,n=e.styleSpec,r=e.style;if(!t.type)return[new Gn(i,t,'"type" is required')];const o=Nn(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Wn({key:i,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:nr}),s;case"geojson":if(s=Wn({key:i,value:t,valueSpec:n.source_geojson,style:r,styleSpec:n,objectElementValidators:nr}),t.cluster)for(const e in t.clusterProperties){const[n,r]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;s.push(...Kn({key:`${i}.${e}.map`,value:r,expressionContext:"cluster-map"})),s.push(...Kn({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Wn({key:i,value:t,valueSpec:n.source_video,style:r,styleSpec:n});case"image":return Wn({key:i,value:t,valueSpec:n.source_image,style:r,styleSpec:n});case"canvas":return[new Gn(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jn({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,styleSpec:n})}},light:function(e){const t=e.value,i=e.styleSpec,n=i.light,r=e.style;let o=[];const s=Ln(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Gn("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=s&&n[s[1]]&&n[s[1]].transition?o.concat(or({key:e,value:t[e],valueSpec:i.transition,style:r,styleSpec:i})):n[e]?o.concat(or({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i})):o.concat([new Gn(e,t[e],`unknown property "${e}"`)])}return o},terrain:function(e){const t=e.value,i=e.key,n=e.style,r=e.styleSpec,o=r.terrain;let s=[];const a=Ln(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Gn("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const i=e.match(/^(.*)-transition$/);s=i&&o[i[1]]&&o[i[1]].transition?s.concat(or({key:e,value:t[e],valueSpec:r.transition,style:n,styleSpec:r})):o[e]?s.concat(or({key:e,value:t[e],valueSpec:o[e],style:n,styleSpec:r})):s.concat([new Gn(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],r=e&&Nn(e.type);e?"raster-dem"!==r&&s.push(new Gn(i,t.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):s.push(new Gn(i,t.source,`source "${t.source}" not found`))}else s.push(new Gn(i,t,'terrain is missing required property "source"'));return s},fog:function(e){const t=e.value,i=e.style,n=e.styleSpec,r=n.fog;let o=[];const s=Ln(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Gn("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=s&&r[s[1]]&&r[s[1]].transition?o.concat(or({key:e,value:t[e],valueSpec:n.transition,style:i,styleSpec:n})):r[e]?o.concat(or({key:e,value:t[e],valueSpec:r[e],style:i,styleSpec:n})):o.concat([new Gn(e,t[e],`unknown property "${e}"`)])}return o},string:ir,formatted:function(e){return 0===ir(e).length?[]:Kn(e)},resolvedImage:function(e){return 0===ir(e).length?[]:Kn(e)},projection:function(e){const t=e.value,i=e.styleSpec,n=i.projection,r=e.style;let o=[];const s=Ln(t);if("object"===s)for(const e in t)o=o.concat(or({key:e,value:t[e],valueSpec:n[e],style:r,styleSpec:i}));else"string"!==s&&(o=o.concat([new Gn("projection",t,`object or string expected, ${s} found`)]));return o}};function or(e){const t=e.value,i=e.valueSpec,n=e.styleSpec;if(i.expression&&Dn(Nn(t)))return Xn(e);if(i.expression&&On(Un(t)))return Kn(e);if(i.type&&rr[i.type])return rr[i.type](e);return Wn(kt({},e,{valueSpec:i.type?n[i.type]:i}))}function sr(e){const t=e.value,i=e.key,n=ir(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Gn(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Gn(i,t,'"glyphs" url must include a "{range}" token'))),n}var ar=vt((function(e,t){var i=function(){var e=function(e,t,i,n){for(i=i||{},n=e.length;n--;i[e[n]]=t);return i},t=[1,12],i=[1,13],n=[1,9],r=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],c=[18,22],u=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,t,i,n,r,o,s){var a=o.length-1;switch(r){case 1:this.$=new String(e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(e),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a])}},table:[{3:5,4:t,5:6,6:i,7:3,8:n,9:4,10:r,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},e(l,[2,7]),e(l,[2,8]),e(l,[2,9]),e(l,[2,10]),e(l,[2,11]),e(l,[2,12]),e(l,[2,3]),e(l,[2,4]),e(l,[2,5]),e([14,18,21,22,24],[2,1]),e(l,[2,2]),{3:20,4:t,18:[1,17],19:18,20:19},{3:5,4:t,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},e(l,[2,13]),{18:[1,24],22:[1,25]},e(c,[2,16]),{21:[1,26]},e(l,[2,18]),{22:[1,28],24:[1,27]},e(u,[2,20]),e(l,[2,14]),{3:20,4:t,20:29},{3:5,4:t,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:30,15:7,16:8,17:s,23:a},e(l,[2,19]),{3:5,4:t,5:6,6:i,7:3,8:n,9:4,10:r,11:o,13:31,15:7,16:8,17:s,23:a},e(c,[2,17]),e(c,[2,15]),e(u,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,i=[0],n=[null],r=[],o=this.table,s="",a=0,l=0,c=2,u=1,h=r.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(p.yy[f]=this.yy[f]);d.setInput(e,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var m=d.yylloc;r.push(m);var g=d.options&&d.options.ranges;function y(){var e;return"number"!=typeof(e=d.lex()||u)&&(e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,v,x,b,w,T,k,S,C={};;){if(v=i[i.length-1],this.defaultActions[v]?x=this.defaultActions[v]:(null==_&&(_=y()),x=o[v]&&o[v][_]),void 0===x||!x.length||!x[0]){var E="";for(w in S=[],o[v])this.terminals_[w]&&w>c&&S.push("'"+this.terminals_[w]+"'");E=d.showPosition?"Parse error on line "+(a+1)+":\n"+d.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(a+1)+": Unexpected "+(_==u?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(E,{text:d.match,token:this.terminals_[_]||_,line:d.yylineno,loc:m,expected:S})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+_);switch(x[0]){case 1:i.push(_),n.push(d.yytext),r.push(d.yylloc),i.push(x[1]),_=null,l=d.yyleng,s=d.yytext,a=d.yylineno,m=d.yylloc;break;case 2:if(T=this.productions_[x[1]][1],C.$=n[n.length-T],C._$={first_line:r[r.length-(T||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(T||1)].first_column,last_column:r[r.length-1].last_column},g&&(C._$.range=[r[r.length-(T||1)].range[0],r[r.length-1].range[1]]),void 0!==(b=this.performAction.apply(C,[s,l,a,p.yy,x[1],n,r].concat(h))))return b;T&&(i=i.slice(0,-1*T*2),n=n.slice(0,-1*T),r=r.slice(0,-1*T)),i.push(this.productions_[x[1]][0]),n.push(C.$),r.push(C._$),k=o[i[i.length-2]][i[i.length-1]],i.push(k);break;case 3:return!0}}return!0}},d={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var i,n,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),(n=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-n[n.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],i=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var o in r)this[o]=r[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,i,n;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length;o++)if((i=this._input.match(this.rules[r[o]]))&&(!t||i[0].length>t[0].length)){if(t=i,n=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(i,r[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,r[n]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,i,n){switch(i){case 0:break;case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};function p(){this.yy={}}return h.lexer=d,p.prototype=h,h.Parser=p,new p}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)}}));function lr(e,t=yt){let i=e;try{i=function(e){if(e instanceof String||"string"==typeof e||e instanceof Buffer)try{return ar.parse(e.toString())}catch(e){throw new qn(e)}return e}(i)}catch(e){return[e]}return function(e,t=yt){return i=or({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:sr,"*":()=>[]}}),i.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0));var i}(i,t)}let cr,ur={};Xe.subscribe((e=>ur=e)),Ye.subscribe((e=>cr=e));const hr=(e,t)=>{e.once("styledata",(()=>{const i=()=>{e.isStyleLoaded()?t():setTimeout(i,150)};i()}))},dr=(e,t,i)=>{if(!ur.puck)return;const n={type:"Feature",geometry:{type:"Point",coordinates:t}};e.getSource(Pe)&&e.getSource(Pe).setData(n),e.getLayer(Pe)&&e.setLayoutProperty(Pe,"icon-rotate",i)},pr=(e,t,i,n)=>{const r=ur[i];if(!ur[i])return void console.warn(`${i} is not loaded.`);if(!e.hasImage(i)){const{url:t}=r;e.loadImage(t,((t,n)=>{if(t)throw t;e.addImage(i,n)}))}e.getSource(i)||e.addSource(i,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:t}}});e.getLayer(i)||e.addLayer({id:i,type:"symbol",source:i,layout:{"icon-image":i,"icon-allow-overlap":!0,...n}})},fr=(e,t)=>{e.removeLayer(t),e.removeSource(t)},mr=e=>{!!e.getSource(Be)||e.addSource(Be,{type:"geojson",data:{type:"FeatureCollection",features:[]}});if(!!!e.getLayer("route-line-internal-mock-layer_0")){let t=e.getStyle().layers.find((e=>"symbol"===e.type&&e?.layout?.["text-field"]))?.id;cr.forEach((i=>{!!!e.getLayer(i.id)&&e.addLayer(i,t),t=i.id}))}},gr=(e,t,i={fitToBounds:!0})=>{if(!t)return;const{fitToBounds:n}=i,{coordinates:r}=t,o={type:"Feature",geometry:{type:"LineString",coordinates:r}};if(e.getSource(Be).setData(o),n){const t=new mt.LngLatBounds(r[0],r[r.length-1]);for(const e of r)t.extend(e);e.setPitch(0),e.fitBounds(t,{padding:20})}};function yr(e){let t;return{c(){t=w("div"),A(t,"id","map-viewer"),A(t,"class","map svelte-16q73l0")},m(e,i){v(e,t,i)},p:i,i:i,o:i,d(e){e&&x(t)}}}function _r(e,t,i){let n,r,{id:o}=t,{url:s}=t;Ve.subscribe((e=>({mapboxGlAccessToken:r}=e)));let a,l,c,u;qe.subscribe((e=>i(2,({response:a}=e),a))),He.subscribe((e=>l=e)),Ye.subscribe((e=>i(3,c=e))),Xe.subscribe((e=>e));const h=Se.throttle((()=>{if(!u)return;const e=u.getBearing(),t=u.getPitch(),i=u.getZoom(),n={bearing:e,center:u.getCenter(),pitch:t,zoom:i};He.set(n)}),250);var d;return $((async()=>{await(async()=>{await Promise.resolve().then((function(){return Ky})),n=await Promise.resolve().then((function(){return gt})),n.accessToken=r})();i(4,u=new n.Map({id:o,container:"map-viewer",style:s,preserveDrawingBuffer:!0,...l})),Ze.set(u),u.once("styledata",(()=>{hr(u,(()=>{Qe.set({loading:!0,helperText:"Loading assets"}),pt(u).then((e=>{Xe.update((t=>Object.keys(t).reduce(((t,i)=>(t[i]=e.find((e=>e.name===i))??null,t)),{}))),Qe.set({loading:!1})})).catch((e=>{Qe.set({loading:!1}),console.error(e)})),mr(u),gr(u,a)}))})),u.on("move",(()=>{h()}))})),d=()=>{u&&u.remove()},F().$$.on_destroy.push(d),e.$$set=e=>{"id"in e&&i(0,o=e.id),"url"in e&&i(1,s=e.url)},e.$$.update=()=>{if(30&e.$$.dirty&&u&&s){let e,t,i,n;try{const{layers:r,sources:o}=u.getStyle();e=r.find((e=>e.id===Pe)),t=r.find((e=>"destination-pin"===e.id)),i=o.puck,n=o["destination-pin"]}catch(e){}if("string"==typeof s){u.setStyle(s);const r=()=>{mr(u),gr(u,a,{fitToBounds:!1}),t&&!u.getLayer("destination-pin")&&(u.addSource("destination-pin",n),u.addLayer(t)),e&&!u.getLayer(Pe)&&(u.addSource(Pe,i),u.addLayer(e))};hr(u,r)}else{const r=s,o=r.layers.find((e=>e.id.includes("route-line-internal-mock-layer"))),l=r.layers.findIndex((e=>"symbol"===e.type&&e?.layout?.["text-field"]))||r.layers.length;!o&&r.layers.splice(l,0,...c);const h=r.layers.find((e=>"destination-pin"===e.id)),d=r.layers.find((e=>e.id===Pe));t&&!h&&(r.sources["destination-pin"]=n,r.layers.push(t)),e&&!d&&(r.sources.puck=i,r.layers.push(e));const{coordinates:p}=a,f={type:"Feature",geometry:{type:"LineString",coordinates:p}};let m=geometries?{type:"geojson",data:f}:Fe;r.sources[Be]=m,u.setStyle(r)}}16&e.$$.dirty&&u&&u.once("render",(()=>{const e=document.getElementById("map-viewer");if(e){new ResizeObserver((()=>{u.resize({resize:!0})})).observe(e)}})),20&e.$$.dirty&&u&&u.isStyleLoaded()&&a&&gr(u,a,{fitToBounds:!0})},[o,s,a,c,u]}class vr extends ve{constructor(e){super(),_e(this,e,_r,yr,l,{id:0,url:1})}}function xr(e){let t,i,n,r;return n=new rt({props:{height:e[1],width:e[0],children:vr,childProps:e[2]}}),{c(){t=w("div"),i=w("div"),me(n.$$.fragment),A(i,"class","device-container svelte-l666nc"),A(t,"class","display-area svelte-l666nc")},m(e,o){v(e,t,o),_(t,i),ge(n,i,null),r=!0},p(e,[t]){const i={};2&t&&(i.height=e[1]),1&t&&(i.width=e[0]),4&t&&(i.childProps=e[2]),n.$set(i)},i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(t),ye(n)}}}function br(e,t,i){let n,r;Ve.subscribe((e=>{({devices:n}=e),({styles:r}=e)}));let o=n[0].width,s=n[0].height;Je.subscribe((e=>{e&&(i(0,o=e.width),i(1,s=e.height))}));let a=r[0];return Ke.subscribe((e=>{e&&i(2,a=e)})),[o,s,a]}class wr extends ve{constructor(e){super(),_e(this,e,br,xr,l,{})}}function Tr(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function kr(e){let t,r,o=e[1]&&Tr(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M22 16L12 26 10.6 24.6 19.2 16 10.6 7.4 12 6z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=Tr(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Sr(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var Cr=class extends ve{constructor(e){super(),_e(this,e,Sr,kr,l,{size:0,title:1})}};function Er(e,t,i){const n=e.slice();return n[2]=t[i].width,n}function Mr(e){let t,i,r,o,a=[e[4],{style:i="width: "+e[2]+";"+e[4].style}],l={};for(let e=0;e<a.length;e+=1)l=n(l,a[e]);return{c(){t=w("p"),z(t,l),O(t,"bx--skeleton__text",!0),O(t,"bx--skeleton__heading",e[0])},m(i,n){v(i,t,n),r||(o=[E(t,"click",e[12]),E(t,"mouseover",e[13]),E(t,"mouseenter",e[14]),E(t,"mouseleave",e[15])],r=!0)},p(e,n){z(t,l=de(a,[16&n&&e[4],20&n&&i!==(i="width: "+e[2]+";"+e[4].style)&&{style:i}])),O(t,"bx--skeleton__text",!0),O(t,"bx--skeleton__heading",e[0])},d(e){e&&x(t),r=!1,s(o)}}}function Ar(e){let t,i,r,o=e[3],a=[];for(let t=0;t<o.length;t+=1)a[t]=zr(Er(e,o,t));let l=[e[4]],c={};for(let e=0;e<l.length;e+=1)c=n(c,l[e]);return{c(){t=w("div");for(let e=0;e<a.length;e+=1)a[e].c();z(t,c)},m(n,o){v(n,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);i||(r=[E(t,"click",e[8]),E(t,"mouseover",e[9]),E(t,"mouseenter",e[10]),E(t,"mouseleave",e[11])],i=!0)},p(e,i){if(9&i){let n;for(o=e[3],n=0;n<o.length;n+=1){const r=Er(e,o,n);a[n]?a[n].p(r,i):(a[n]=zr(r),a[n].c(),a[n].m(t,null))}for(;n<a.length;n+=1)a[n].d(1);a.length=o.length}z(t,c=de(l,[16&i&&e[4]]))},d(e){e&&x(t),b(a,e),i=!1,s(r)}}}function zr(e){let t;return{c(){t=w("p"),P(t,"width",e[2]),O(t,"bx--skeleton__text",!0),O(t,"bx--skeleton__heading",e[0])},m(e,i){v(e,t,i)},p(e,i){8&i&&P(t,"width",e[2]),1&i&&O(t,"bx--skeleton__heading",e[0])},d(e){e&&x(t)}}}function Ir(e){let t;function n(e,t){return e[1]?Ar:Mr}let r=n(e),o=r(e);return{c(){o.c(),t=C()},m(e,i){o.m(e,i),v(e,t,i)},p(e,[i]){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},i:i,o:i,d(e){o.d(e),e&&x(t)}}}function Lr(e,t,i){let r,o,s;const a=["lines","heading","paragraph","width"];let l=m(t,a),{lines:c=3}=t,{heading:u=!1}=t,{paragraph:h=!1}=t,{width:d="100%"}=t;const p=[.973,.153,.567];return e.$$set=e=>{t=n(n({},t),f(e)),i(4,l=m(t,a)),"lines"in e&&i(5,c=e.lines),"heading"in e&&i(0,u=e.heading),"paragraph"in e&&i(1,h=e.paragraph),"width"in e&&i(2,d=e.width)},e.$$.update=()=>{if(4&e.$$.dirty&&i(7,o=parseInt(d,10)),4&e.$$.dirty&&i(6,s=d.includes("px")),238&e.$$.dirty&&h)for(let e=0;e<c;e++){const t=s?o-75:0,n=s?o:75,a=Math.floor(p[e%3]*(n-t+1))+t+"px";i(3,r=[...r,{width:s?a:`calc(${d} - ${a})`}])}},i(3,r=[]),[u,h,d,r,l,c,s,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var Dr=class extends ve{constructor(e){super(),_e(this,e,Lr,Ir,l,{lines:5,heading:0,paragraph:1,width:2})}};function Pr(e,t,i){const n=e.slice();return n[9]=t[i],n}function Or(e){let t,i,n,r,o,s,a,l,c,u,h,d,p;return n=new Cr({props:{class:"bx--accordion__arrow"}}),o=new Dr({props:{class:"bx--accordion__title"}}),l=new Dr({props:{width:"90%"}}),u=new Dr({props:{width:"80%"}}),d=new Dr({props:{width:"95%"}}),{c(){t=w("li"),i=w("span"),me(n.$$.fragment),r=S(),me(o.$$.fragment),s=S(),a=w("div"),me(l.$$.fragment),c=S(),me(u.$$.fragment),h=S(),me(d.$$.fragment),O(i,"bx--accordion__heading",!0),A(a,"class","bx--accordion__content"),O(t,"bx--accordion__item",!0),O(t,"bx--accordion__item--active",!0)},m(e,f){v(e,t,f),_(t,i),ge(n,i,null),_(i,r),ge(o,i,null),_(t,s),_(t,a),ge(l,a,null),_(a,c),ge(u,a,null),_(a,h),ge(d,a,null),p=!0},i(e){p||(ae(n.$$.fragment,e),ae(o.$$.fragment,e),ae(l.$$.fragment,e),ae(u.$$.fragment,e),ae(d.$$.fragment,e),p=!0)},o(e){le(n.$$.fragment,e),le(o.$$.fragment,e),le(l.$$.fragment,e),le(u.$$.fragment,e),le(d.$$.fragment,e),p=!1},d(e){e&&x(t),ye(n),ye(o),ye(l),ye(u),ye(d)}}}function Rr(e,t){let i,n,r,o,s,a,l;return r=new Cr({props:{class:"bx--accordion__arrow"}}),s=new Dr({props:{class:"bx--accordion__title"}}),{key:e,first:null,c(){i=w("li"),n=w("span"),me(r.$$.fragment),o=S(),me(s.$$.fragment),a=S(),A(n,"class","bx--accordion__heading"),A(i,"class","bx--accordion__item"),this.first=i},m(e,t){v(e,i,t),_(i,n),ge(r,n,null),_(n,o),ge(s,n,null),_(i,a),l=!0},p(e,t){e},i(e){l||(ae(r.$$.fragment,e),ae(s.$$.fragment,e),l=!0)},o(e){le(r.$$.fragment,e),le(s.$$.fragment,e),l=!1},d(e){e&&x(i),ye(r),ye(s)}}}function Br(e){let t,i,r,o,a,l=[],c=new Map,u=e[3]&&Or(),h=Array.from({length:e[3]?e[0]-1:e[0]},Fr);const d=e=>e[9];for(let t=0;t<h.length;t+=1){let i=Pr(e,h,t),n=d(i);c.set(n,l[t]=Rr(n))}let p=[e[4]],f={};for(let e=0;e<p.length;e+=1)f=n(f,p[e]);return{c(){t=w("ul"),u&&u.c(),i=S();for(let e=0;e<l.length;e+=1)l[e].c();z(t,f),O(t,"bx--skeleton",!0),O(t,"bx--accordion",!0),O(t,"bx--accordion--start","start"===e[1]),O(t,"bx--accordion--end","end"===e[1]),O(t,"bx--accordion--sm","sm"===e[2]),O(t,"bx--accordion--xl","xl"===e[2])},m(n,s){v(n,t,s),u&&u.m(t,null),_(t,i);for(let e=0;e<l.length;e+=1)l[e].m(t,null);r=!0,o||(a=[E(t,"click",e[5]),E(t,"mouseover",e[6]),E(t,"mouseenter",e[7]),E(t,"mouseleave",e[8])],o=!0)},p(e,[n]){e[3]?u?8&n&&ae(u,1):(u=Or(),u.c(),ae(u,1),u.m(t,i)):u&&(oe(),le(u,1,1,(()=>{u=null})),se()),9&n&&(h=Array.from({length:e[3]?e[0]-1:e[0]},Fr),oe(),l=he(l,n,d,1,e,h,c,t,ue,Rr,null,Pr),se()),z(t,f=de(p,[16&n&&e[4]])),O(t,"bx--skeleton",!0),O(t,"bx--accordion",!0),O(t,"bx--accordion--start","start"===e[1]),O(t,"bx--accordion--end","end"===e[1]),O(t,"bx--accordion--sm","sm"===e[2]),O(t,"bx--accordion--xl","xl"===e[2])},i(e){if(!r){ae(u);for(let e=0;e<h.length;e+=1)ae(l[e]);r=!0}},o(e){le(u);for(let e=0;e<l.length;e+=1)le(l[e]);r=!1},d(e){e&&x(t),u&&u.d();for(let e=0;e<l.length;e+=1)l[e].d();o=!1,s(a)}}}const Fr=(e,t)=>t;function $r(e,t,i){const r=["count","align","size","open"];let o=m(t,r),{count:s=4}=t,{align:a="end"}=t,{size:l}=t,{open:c=!0}=t;return e.$$set=e=>{t=n(n({},t),f(e)),i(4,o=m(t,r)),"count"in e&&i(0,s=e.count),"align"in e&&i(1,a=e.align),"size"in e&&i(2,l=e.size),"open"in e&&i(3,c=e.open)},[s,a,l,c,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var jr=class extends ve{constructor(e){super(),_e(this,e,$r,Br,l,{count:0,align:1,size:2,open:3})}};function Nr(e){let t,i,r,o;const a=e[6].default,l=c(a,e,e[5],null);let u=[e[3]],f={};for(let e=0;e<u.length;e+=1)f=n(f,u[e]);return{c(){t=w("ul"),l&&l.c(),z(t,f),O(t,"bx--accordion",!0),O(t,"bx--accordion--start","start"===e[0]),O(t,"bx--accordion--end","end"===e[0]),O(t,"bx--accordion--sm","sm"===e[1]),O(t,"bx--accordion--xl","xl"===e[1])},m(n,s){v(n,t,s),l&&l.m(t,null),i=!0,r||(o=[E(t,"click",e[7]),E(t,"mouseover",e[8]),E(t,"mouseenter",e[9]),E(t,"mouseleave",e[10])],r=!0)},p(e,n){l&&l.p&&(!i||32&n)&&d(l,a,e,e[5],i?h(a,e[5],n,null):p(e[5]),null),z(t,f=de(u,[8&n&&e[3]])),O(t,"bx--accordion",!0),O(t,"bx--accordion--start","start"===e[0]),O(t,"bx--accordion--end","end"===e[0]),O(t,"bx--accordion--sm","sm"===e[1]),O(t,"bx--accordion--xl","xl"===e[1])},i(e){i||(ae(l,e),i=!0)},o(e){le(l,e),i=!1},d(e){e&&x(t),l&&l.d(e),r=!1,s(o)}}}function Ur(e){let t,i;const r=[e[3],{align:e[0]},{size:e[1]}];let o={};for(let e=0;e<r.length;e+=1)o=n(o,r[e]);return t=new jr({props:o}),t.$on("click",e[11]),t.$on("mouseover",e[12]),t.$on("mouseenter",e[13]),t.$on("mouseleave",e[14]),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n=11&i?de(r,[8&i&&pe(e[3]),1&i&&{align:e[0]},2&i&&{size:e[1]}]):{};t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Vr(e){let t,i,n,r;const o=[Ur,Nr],s=[];function a(e,t){return e[2]?0:1}return t=a(e),i=s[t]=o[t](e),{c(){i.c(),n=C()},m(e,i){s[t].m(e,i),v(e,n,i),r=!0},p(e,[r]){let l=t;t=a(e),t===l?s[t].p(e,r):(oe(),le(s[l],1,1,(()=>{s[l]=null})),se(),i=s[t],i?i.p(e,r):(i=s[t]=o[t](e),i.c()),ae(i,1),i.m(n.parentNode,n))},i(e){r||(ae(i),r=!0)},o(e){le(i),r=!1},d(e){s[t].d(e),e&&x(n)}}}function Gr(e,t,i){const r=["align","size","disabled","skeleton"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{align:l="end"}=t,{size:c}=t,{disabled:u=!1}=t,{skeleton:h=!1}=t;const d=De(u);var p,g;return p="Accordion",g={disableItems:d},F().$$.context.set(p,g),e.$$set=e=>{t=n(n({},t),f(e)),i(3,o=m(t,r)),"align"in e&&i(0,l=e.align),"size"in e&&i(1,c=e.size),"disabled"in e&&i(4,u=e.disabled),"skeleton"in e&&i(2,h=e.skeleton),"$$scope"in e&&i(5,a=e.$$scope)},e.$$.update=()=>{16&e.$$.dirty&&d.set(u)},[l,c,h,o,u,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var qr=class extends ve{constructor(e){super(),_e(this,e,Gr,Vr,l,{align:0,size:1,disabled:4,skeleton:2})}};const Wr=e=>({}),Hr=e=>({});function Zr(e){let t,i,r,o,a,l,u,f,m,g;r=new Cr({props:{class:"bx--accordion__arrow","aria-label":e[3]}});const y=e[7].title,b=c(y,e,e[6],Hr),T=b||function(e){let t;return{c(){t=k(e[2])},m(e,i){v(e,t,i)},p(e,i){4&i&&L(t,e[2])},d(e){e&&x(t)}}}(e),C=e[7].default,M=c(C,e,e[6],null);let I=[e[5]],D={};for(let e=0;e<I.length;e+=1)D=n(D,I[e]);return{c(){t=w("li"),i=w("button"),me(r.$$.fragment),o=S(),a=w("div"),T&&T.c(),l=S(),u=w("div"),M&&M.c(),O(a,"bx--accordion__title",!0),A(i,"type","button"),A(i,"title",e[3]),A(i,"aria-expanded",e[0]),i.disabled=e[1],O(i,"bx--accordion__heading",!0),O(u,"bx--accordion__content",!0),z(t,D),O(t,"bx--accordion__item",!0),O(t,"bx--accordion__item--active",e[0]),O(t,"bx--accordion__item--disabled",e[1]),O(t,"bx--accordion__item--expanding","expanding"===e[4]),O(t,"bx--accordion__item--collapsing","collapsing"===e[4])},m(n,s){v(n,t,s),_(t,i),ge(r,i,null),_(i,o),_(i,a),T&&T.m(a,null),_(t,l),_(t,u),M&&M.m(u,null),f=!0,m||(g=[E(i,"click",e[9]),E(i,"click",e[14]),E(i,"mouseover",e[10]),E(i,"mouseenter",e[11]),E(i,"mouseleave",e[12]),E(i,"keydown",e[13]),E(i,"keydown",e[15]),E(t,"animationend",e[8]),E(t,"animationend",e[16])],m=!0)},p(e,[n]){const o={};8&n&&(o["aria-label"]=e[3]),r.$set(o),b?b.p&&(!f||64&n)&&d(b,y,e,e[6],f?h(y,e[6],n,Wr):p(e[6]),Hr):T&&T.p&&(!f||4&n)&&T.p(e,f?n:-1),(!f||8&n)&&A(i,"title",e[3]),(!f||1&n)&&A(i,"aria-expanded",e[0]),(!f||2&n)&&(i.disabled=e[1]),M&&M.p&&(!f||64&n)&&d(M,C,e,e[6],f?h(C,e[6],n,null):p(e[6]),null),z(t,D=de(I,[32&n&&e[5]])),O(t,"bx--accordion__item",!0),O(t,"bx--accordion__item--active",e[0]),O(t,"bx--accordion__item--disabled",e[1]),O(t,"bx--accordion__item--expanding","expanding"===e[4]),O(t,"bx--accordion__item--collapsing","collapsing"===e[4])},i(e){f||(ae(r.$$.fragment,e),ae(T,e),ae(M,e),f=!0)},o(e){le(r.$$.fragment,e),le(T,e),le(M,e),f=!1},d(e){e&&x(t),ye(r),T&&T.d(e),M&&M.d(e),m=!1,s(g)}}}function Xr(e,t,i){const r=["title","open","disabled","iconDescription"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{title:l="title"}=t,{open:c=!1}=t,{disabled:u=!1}=t,{iconDescription:h="Expand/Collapse"}=t,d=u;const p=N("Accordion").disableItems.subscribe((e=>{!e&&d||i(1,u=e)}));let g;$((()=>()=>{p()}));return e.$$set=e=>{t=n(n({},t),f(e)),i(5,o=m(t,r)),"title"in e&&i(2,l=e.title),"open"in e&&i(0,c=e.open),"disabled"in e&&i(1,u=e.disabled),"iconDescription"in e&&i(3,h=e.iconDescription),"$$scope"in e&&i(6,a=e.$$scope)},[c,u,l,h,g,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},()=>{i(0,c=!c),i(4,g=c?"expanding":"collapsing")},({key:e})=>{c&&"Escape"===e&&i(0,c=!1)},()=>{i(4,g=void 0)}]}var Kr=class extends ve{constructor(e){super(),_e(this,e,Xr,Zr,l,{title:2,open:0,disabled:1,iconDescription:3})}};function Yr(e){let t,i,r,o=[e[2]],a={};for(let e=0;e<o.length;e+=1)a=n(a,o[e]);return{c(){t=w("div"),z(t,a),O(t,"bx--skeleton",!0),O(t,"bx--btn",!0),O(t,"bx--btn--field","field"===e[1]),O(t,"bx--btn--sm","small"===e[1]),O(t,"bx--btn--lg","lg"===e[1]),O(t,"bx--btn--xl","xl"===e[1])},m(n,o){v(n,t,o),i||(r=[E(t,"click",e[7]),E(t,"mouseover",e[8]),E(t,"mouseenter",e[9]),E(t,"mouseleave",e[10])],i=!0)},p(e,i){z(t,a=de(o,[4&i&&e[2]])),O(t,"bx--skeleton",!0),O(t,"bx--btn",!0),O(t,"bx--btn--field","field"===e[1]),O(t,"bx--btn--sm","small"===e[1]),O(t,"bx--btn--lg","lg"===e[1]),O(t,"bx--btn--xl","xl"===e[1])},d(e){e&&x(t),i=!1,s(r)}}}function Jr(e){let t,i,r,o,a,l=[{href:e[0]},{rel:r="_blank"===e[2].target?"noopener noreferrer":void 0},{role:"button"},e[2]],c={};for(let e=0;e<l.length;e+=1)c=n(c,l[e]);return{c(){t=w("a"),i=k(""),z(t,c),O(t,"bx--skeleton",!0),O(t,"bx--btn",!0),O(t,"bx--btn--field","field"===e[1]),O(t,"bx--btn--sm","small"===e[1]),O(t,"bx--btn--lg","lg"===e[1]),O(t,"bx--btn--xl","xl"===e[1])},m(n,r){v(n,t,r),_(t,i),o||(a=[E(t,"click",e[3]),E(t,"mouseover",e[4]),E(t,"mouseenter",e[5]),E(t,"mouseleave",e[6])],o=!0)},p(e,i){z(t,c=de(l,[1&i&&{href:e[0]},4&i&&r!==(r="_blank"===e[2].target?"noopener noreferrer":void 0)&&{rel:r},{role:"button"},4&i&&e[2]])),O(t,"bx--skeleton",!0),O(t,"bx--btn",!0),O(t,"bx--btn--field","field"===e[1]),O(t,"bx--btn--sm","small"===e[1]),O(t,"bx--btn--lg","lg"===e[1]),O(t,"bx--btn--xl","xl"===e[1])},d(e){e&&x(t),o=!1,s(a)}}}function Qr(e){let t;function n(e,t){return e[0]?Jr:Yr}let r=n(e),o=r(e);return{c(){o.c(),t=C()},m(e,i){o.m(e,i),v(e,t,i)},p(e,[i]){r===(r=n(e))&&o?o.p(e,i):(o.d(1),o=r(e),o&&(o.c(),o.m(t.parentNode,t)))},i:i,o:i,d(e){o.d(e),e&&x(t)}}}function eo(e,t,i){const r=["href","size"];let o=m(t,r),{href:s}=t,{size:a="default"}=t;return e.$$set=e=>{t=n(n({},t),f(e)),i(2,o=m(t,r)),"href"in e&&i(0,s=e.href),"size"in e&&i(1,a=e.size)},[s,a,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var to=class extends ve{constructor(e){super(),_e(this,e,eo,Qr,l,{href:0,size:1})}};const io=e=>({props:512&e[0]}),no=e=>({props:e[9]});function ro(e){let t,i,r,o,a,l,u=e[8]&&lo(e);const f=e[19].default,m=c(f,e,e[18],null);var g=e[2];function y(e){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":e[3]}}}g&&(r=new g(y(e)));let b=[e[9]],T={};for(let e=0;e<b.length;e+=1)T=n(T,b[e]);return{c(){t=w("button"),u&&u.c(),i=S(),m&&m.c(),r&&me(r.$$.fragment),z(t,T)},m(n,s){v(n,t,s),u&&u.m(t,null),_(t,i),m&&m.m(t,null),r&&ge(r,t,null),t.autofocus&&t.focus(),e[33](t),o=!0,a||(l=[E(t,"click",e[24]),E(t,"mouseover",e[25]),E(t,"mouseenter",e[26]),E(t,"mouseleave",e[27])],a=!0)},p(e,n){e[8]?u?u.p(e,n):(u=lo(e),u.c(),u.m(t,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&n[0])&&d(m,f,e,e[18],o?h(f,e[18],n,null):p(e[18]),null);const s={};if(8&n[0]&&(s["aria-label"]=e[3]),g!==(g=e[2])){if(r){oe();const e=r;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}g?(r=new g(y(e)),me(r.$$.fragment),ae(r.$$.fragment,1),ge(r,t,null)):r=null}else g&&r.$set(s);z(t,T=de(b,[512&n[0]&&e[9]]))},i(e){o||(ae(m,e),r&&ae(r.$$.fragment,e),o=!0)},o(e){le(m,e),r&&le(r.$$.fragment,e),o=!1},d(i){i&&x(t),u&&u.d(),m&&m.d(i),r&&ye(r),e[33](null),a=!1,s(l)}}}function oo(e){let t,i,r,o,a,l,u=e[8]&&co(e);const f=e[19].default,m=c(f,e,e[18],null);var g=e[2];function y(e){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":e[3]}}}g&&(r=new g(y(e)));let b=[e[9]],T={};for(let e=0;e<b.length;e+=1)T=n(T,b[e]);return{c(){t=w("a"),u&&u.c(),i=S(),m&&m.c(),r&&me(r.$$.fragment),z(t,T)},m(n,s){v(n,t,s),u&&u.m(t,null),_(t,i),m&&m.m(t,null),r&&ge(r,t,null),e[32](t),o=!0,a||(l=[E(t,"click",e[20]),E(t,"mouseover",e[21]),E(t,"mouseenter",e[22]),E(t,"mouseleave",e[23])],a=!0)},p(e,n){e[8]?u?u.p(e,n):(u=co(e),u.c(),u.m(t,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&n[0])&&d(m,f,e,e[18],o?h(f,e[18],n,null):p(e[18]),null);const s={};if(8&n[0]&&(s["aria-label"]=e[3]),g!==(g=e[2])){if(r){oe();const e=r;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}g?(r=new g(y(e)),me(r.$$.fragment),ae(r.$$.fragment,1),ge(r,t,null)):r=null}else g&&r.$set(s);z(t,T=de(b,[512&n[0]&&e[9]]))},i(e){o||(ae(m,e),r&&ae(r.$$.fragment,e),o=!0)},o(e){le(m,e),r&&le(r.$$.fragment,e),o=!1},d(i){i&&x(t),u&&u.d(),m&&m.d(i),r&&ye(r),e[32](null),a=!1,s(l)}}}function so(e){let t;const i=e[19].default,n=c(i,e,e[18],no);return{c(){n&&n.c()},m(e,i){n&&n.m(e,i),t=!0},p(e,r){n&&n.p&&(!t||262656&r[0])&&d(n,i,e,e[18],t?h(i,e[18],r,io):p(e[18]),no)},i(e){t||(ae(n,e),t=!0)},o(e){le(n,e),t=!1},d(e){n&&n.d(e)}}}function ao(e){let t,i;const r=[{href:e[7]},{size:e[1]},e[10],{style:e[8]&&"width: 3rem;"}];let o={};for(let e=0;e<r.length;e+=1)o=n(o,r[e]);return t=new to({props:o}),t.$on("click",e[28]),t.$on("mouseover",e[29]),t.$on("mouseenter",e[30]),t.$on("mouseleave",e[31]),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n=1410&i[0]?de(r,[128&i[0]&&{href:e[7]},2&i[0]&&{size:e[1]},1024&i[0]&&pe(e[10]),256&i[0]&&{style:e[8]&&"width: 3rem;"}]):{};t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function lo(e){let t,i;return{c(){t=w("span"),i=k(e[3]),O(t,"bx--assistive-text",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,t){8&t[0]&&L(i,e[3])},d(e){e&&x(t)}}}function co(e){let t,i;return{c(){t=w("span"),i=k(e[3]),O(t,"bx--assistive-text",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,t){8&t[0]&&L(i,e[3])},d(e){e&&x(t)}}}function uo(e){let t,i,n,r;const o=[ao,so,oo,ro],s=[];function a(e,t){return e[5]?0:e[4]?1:e[7]&&!e[6]?2:3}return t=a(e),i=s[t]=o[t](e),{c(){i.c(),n=C()},m(e,i){s[t].m(e,i),v(e,n,i),r=!0},p(e,r){let l=t;t=a(e),t===l?s[t].p(e,r):(oe(),le(s[l],1,1,(()=>{s[l]=null})),se(),i=s[t],i?i.p(e,r):(i=s[t]=o[t](e),i.c()),ae(i,1),i.m(n.parentNode,n))},i(e){r||(ae(i),r=!0)},o(e){le(i),r=!1},d(e){s[t].d(e),e&&x(n)}}}function ho(e,t,i){let r,o;const s=["kind","size","expressive","isSelected","icon","iconDescription","tooltipAlignment","tooltipPosition","as","skeleton","disabled","href","tabindex","type","ref"];let a=m(t,s),{$$slots:l={},$$scope:c}=t;const u=g(l);let{kind:h="primary"}=t,{size:d="default"}=t,{expressive:p=!1}=t,{isSelected:y=!1}=t,{icon:_}=t,{iconDescription:v}=t,{tooltipAlignment:x="center"}=t,{tooltipPosition:b="bottom"}=t,{as:w=!1}=t,{skeleton:T=!1}=t,{disabled:k=!1}=t,{href:S}=t,{tabindex:C="0"}=t,{type:E="button"}=t,{ref:M=null}=t;const A=N("ComposedModal");return e.$$set=e=>{t=n(n({},t),f(e)),i(10,a=m(t,s)),"kind"in e&&i(11,h=e.kind),"size"in e&&i(1,d=e.size),"expressive"in e&&i(12,p=e.expressive),"isSelected"in e&&i(13,y=e.isSelected),"icon"in e&&i(2,_=e.icon),"iconDescription"in e&&i(3,v=e.iconDescription),"tooltipAlignment"in e&&i(14,x=e.tooltipAlignment),"tooltipPosition"in e&&i(15,b=e.tooltipPosition),"as"in e&&i(4,w=e.as),"skeleton"in e&&i(5,T=e.skeleton),"disabled"in e&&i(6,k=e.disabled),"href"in e&&i(7,S=e.href),"tabindex"in e&&i(16,C=e.tabindex),"type"in e&&i(17,E=e.type),"ref"in e&&i(0,M=e.ref),"$$scope"in e&&i(18,c=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty[0]&&A&&M&&A.declareRef(M),4&e.$$.dirty[0]&&i(8,r=_&&!u.default),i(9,o={type:S&&!k?void 0:E,tabindex:C,disabled:!0===k||void 0,href:S,"aria-pressed":r&&"ghost"===h&&!S?y:void 0,...a,class:["bx--btn",p&&"bx--btn--expressive",("small"===d&&!p||"sm"===d&&!p||"small"===d&&!p)&&"bx--btn--sm","field"===d&&!p||"md"===d&&!p&&"bx--btn--md","field"===d&&"bx--btn--field","small"===d&&"bx--btn--sm","lg"===d&&"bx--btn--lg","xl"===d&&"bx--btn--xl",h&&`bx--btn--${h}`,k&&"bx--btn--disabled",r&&"bx--btn--icon-only",r&&"bx--tooltip__trigger",r&&"bx--tooltip--a11y",r&&b&&`bx--btn--icon-only--${b}`,r&&x&&`bx--tooltip--align-${x}`,r&&y&&"ghost"===h&&"bx--btn--selected",a.class].filter(Boolean).join(" ")})},[M,d,_,v,w,T,k,S,r,o,a,h,p,y,x,b,C,E,c,l,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{M=e,i(0,M)}))},function(e){G[e?"unshift":"push"]((()=>{M=e,i(0,M)}))}]}var po=class extends ve{constructor(e){super(),_e(this,e,ho,uo,l,{kind:11,size:1,expressive:12,isSelected:13,icon:2,iconDescription:3,tooltipAlignment:14,tooltipPosition:15,as:4,skeleton:5,disabled:6,href:7,tabindex:16,type:17,ref:0},null,[-1,-1])}};function fo(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function mo(e){let t,r,o,s=e[1]&&fo(e),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],l={};for(let e=0;e<a.length;e+=1)l=n(l,a[e]);return{c(){t=T("svg"),s&&s.c(),r=T("path"),o=T("path"),A(r,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25\tc-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),A(o,"fill","none"),A(o,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22\tC16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),A(o,"data-icon-path","inner-path"),A(o,"opacity","0"),I(t,l)},m(e,i){v(e,t,i),s&&s.m(t,null),_(t,r),_(t,o)},p(e,[i]){e[1]?s?s.p(e,i):(s=fo(e),s.c(),s.m(t,r)):s&&(s.d(1),s=null),I(t,l=de(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),s&&s.d()}}}function go(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var yo=class extends ve{constructor(e){super(),_e(this,e,go,mo,l,{size:0,title:1})}};function _o(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function vo(e){let t,r,o,s,a=e[1]&&_o(e),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],c={};for(let e=0;e<l.length;e+=1)c=n(c,l[e]);return{c(){t=T("svg"),a&&a.c(),r=T("path"),o=T("path"),s=T("path"),A(r,"fill","none"),A(r,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),A(r,"data-icon-path","inner-path"),A(o,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),A(s,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),I(t,c)},m(e,i){v(e,t,i),a&&a.m(t,null),_(t,r),_(t,o),_(t,s)},p(e,[i]){e[1]?a?a.p(e,i):(a=_o(e),a.c(),a.m(t,r)):a&&(a.d(1),a=null),I(t,c=de(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),a&&a.d()}}}function xo(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var bo=class extends ve{constructor(e){super(),_e(this,e,xo,vo,l,{size:0,title:1})}};function wo(e){let t,i;return{c(){t=w("div"),i=k(e[6]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,t){64&t&&L(i,e[6])},d(e){e&&x(t)}}}function To(e){let t,i;return{c(){t=w("div"),i=k(e[8]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,t){256&t&&L(i,e[8])},d(e){e&&x(t)}}}function ko(e){let t,i,r,o,a,l,u,f;const m=e[11].default,g=c(m,e,e[10],null);let y=[{role:"listbox"},{tabindex:"-1"},{"data-invalid":i=e[5]||void 0},e[9]],_={};for(let e=0;e<y.length;e+=1)_=n(_,y[e]);let b=e[5]&&wo(e),T=!e[5]&&e[7]&&To(e);return{c(){t=w("div"),g&&g.c(),r=S(),b&&b.c(),o=S(),T&&T.c(),a=C(),z(t,_),O(t,"bx--list-box",!0),O(t,"bx--list-box--sm","sm"===e[0]),O(t,"bx--list-box--xl","xl"===e[0]),O(t,"bx--list-box--inline","inline"===e[1]),O(t,"bx--list-box--disabled",e[4]),O(t,"bx--list-box--expanded",e[2]),O(t,"bx--list-box--light",e[3]),O(t,"bx--list-box--warning",!e[5]&&e[7])},m(i,n){v(i,t,n),g&&g.m(t,null),v(i,r,n),b&&b.m(i,n),v(i,o,n),T&&T.m(i,n),v(i,a,n),l=!0,u||(f=[E(t,"keydown",e[12]),E(t,"keydown",So),E(t,"click",M(e[13]))],u=!0)},p(e,[n]){g&&g.p&&(!l||1024&n)&&d(g,m,e,e[10],l?h(m,e[10],n,null):p(e[10]),null),z(t,_=de(y,[{role:"listbox"},{tabindex:"-1"},(!l||32&n&&i!==(i=e[5]||void 0))&&{"data-invalid":i},512&n&&e[9]])),O(t,"bx--list-box",!0),O(t,"bx--list-box--sm","sm"===e[0]),O(t,"bx--list-box--xl","xl"===e[0]),O(t,"bx--list-box--inline","inline"===e[1]),O(t,"bx--list-box--disabled",e[4]),O(t,"bx--list-box--expanded",e[2]),O(t,"bx--list-box--light",e[3]),O(t,"bx--list-box--warning",!e[5]&&e[7]),e[5]?b?b.p(e,n):(b=wo(e),b.c(),b.m(o.parentNode,o)):b&&(b.d(1),b=null),!e[5]&&e[7]?T?T.p(e,n):(T=To(e),T.c(),T.m(a.parentNode,a)):T&&(T.d(1),T=null)},i(e){l||(ae(g,e),l=!0)},o(e){le(g,e),l=!1},d(e){e&&x(t),g&&g.d(e),e&&x(r),b&&b.d(e),e&&x(o),T&&T.d(e),e&&x(a),u=!1,s(f)}}}const So=e=>{"Escape"===e.key&&e.stopPropagation()};function Co(e,t,i){const r=["size","type","open","light","disabled","invalid","invalidText","warn","warnText"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{size:l}=t,{type:c="default"}=t,{open:u=!1}=t,{light:h=!1}=t,{disabled:d=!1}=t,{invalid:p=!1}=t,{invalidText:g=""}=t,{warn:y=!1}=t,{warnText:_=""}=t;return e.$$set=e=>{t=n(n({},t),f(e)),i(9,o=m(t,r)),"size"in e&&i(0,l=e.size),"type"in e&&i(1,c=e.type),"open"in e&&i(2,u=e.open),"light"in e&&i(3,h=e.light),"disabled"in e&&i(4,d=e.disabled),"invalid"in e&&i(5,p=e.invalid),"invalidText"in e&&i(6,g=e.invalidText),"warn"in e&&i(7,y=e.warn),"warnText"in e&&i(8,_=e.warnText),"$$scope"in e&&i(10,a=e.$$scope)},[l,c,u,h,d,p,g,y,_,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var Eo=class extends ve{constructor(e){super(),_e(this,e,Co,ko,l,{size:0,type:1,open:2,light:3,disabled:4,invalid:5,invalidText:6,warn:7,warnText:8})}};function Mo(e){let t,i,r,o,s;const a=e[4].default,l=c(a,e,e[3],null);let u=[{role:"listbox"},{id:i="menu-"+e[1]},e[2]],f={};for(let e=0;e<u.length;e+=1)f=n(f,u[e]);return{c(){t=w("div"),l&&l.c(),z(t,f),O(t,"bx--list-box__menu",!0)},m(i,n){v(i,t,n),l&&l.m(t,null),e[6](t),r=!0,o||(s=E(t,"scroll",e[5]),o=!0)},p(e,[n]){l&&l.p&&(!r||8&n)&&d(l,a,e,e[3],r?h(a,e[3],n,null):p(e[3]),null),z(t,f=de(u,[{role:"listbox"},(!r||2&n&&i!==(i="menu-"+e[1]))&&{id:i},4&n&&e[2]])),O(t,"bx--list-box__menu",!0)},i(e){r||(ae(l,e),r=!0)},o(e){le(l,e),r=!1},d(i){i&&x(t),l&&l.d(i),e[6](null),o=!1,s()}}}function Ao(e,t,i){const r=["id","ref"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{id:l="ccs-"+Math.random().toString(36)}=t,{ref:c=null}=t;return e.$$set=e=>{t=n(n({},t),f(e)),i(2,o=m(t,r)),"id"in e&&i(1,l=e.id),"ref"in e&&i(0,c=e.ref),"$$scope"in e&&i(3,a=e.$$scope)},[c,l,o,a,s,function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{c=e,i(0,c)}))}]}var zo=class extends ve{constructor(e){super(),_e(this,e,Ao,Mo,l,{id:1,ref:0})}};function Io(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function Lo(e){let t,r,o=e[1]&&Io(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M16 22L6 12 7.4 10.6 16 19.2 24.6 10.6 26 12z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=Io(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Do(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var Po=class extends ve{constructor(e){super(),_e(this,e,Do,Lo,l,{size:0,title:1})}};function Oo(e){let t,i,r,o,s;i=new Po({props:{"aria-label":e[1],title:e[1]}});let a=[e[2]],l={};for(let e=0;e<a.length;e+=1)l=n(l,a[e]);return{c(){t=w("div"),me(i.$$.fragment),z(t,l),O(t,"bx--list-box__menu-icon",!0),O(t,"bx--list-box__menu-icon--open",e[0])},m(n,a){v(n,t,a),ge(i,t,null),r=!0,o||(s=E(t,"click",M(e[6])),o=!0)},p(e,[n]){const r={};2&n&&(r["aria-label"]=e[1]),2&n&&(r.title=e[1]),i.$set(r),z(t,l=de(a,[4&n&&e[2]])),O(t,"bx--list-box__menu-icon",!0),O(t,"bx--list-box__menu-icon--open",e[0])},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(e){e&&x(t),ye(i),o=!1,s()}}}function Ro(e,t,i){let r,o;const s=["open","translationIds","translateWithId"];let a=m(t,s),{open:l=!1}=t;const c={close:"close",open:"open"};let{translateWithId:u=(e=>h[e])}=t;const h={[c.close]:"Close menu",[c.open]:"Open menu"};return e.$$set=e=>{t=n(n({},t),f(e)),i(2,a=m(t,s)),"open"in e&&i(0,l=e.open),"translateWithId"in e&&i(4,u=e.translateWithId)},e.$$.update=()=>{1&e.$$.dirty&&i(5,r=l?c.close:c.open),48&e.$$.dirty&&i(1,o=u?.(r)??h[r])},[l,o,a,c,u,r,function(t){U.call(this,e,t)}]}var Bo=class extends ve{constructor(e){super(),_e(this,e,Ro,Oo,l,{open:0,translationIds:3,translateWithId:4})}get translationIds(){return this.$$.ctx[3]}};function Fo(e){let t,i,r,o,a;const l=e[4].default,u=c(l,e,e[3],null);let f=[e[2]],m={};for(let e=0;e<f.length;e+=1)m=n(m,f[e]);return{c(){t=w("div"),i=w("div"),u&&u.c(),O(i,"bx--list-box__menu-item__option",!0),z(t,m),O(t,"bx--list-box__menu-item",!0),O(t,"bx--list-box__menu-item--active",e[0]),O(t,"bx--list-box__menu-item--highlighted",e[1])},m(n,s){v(n,t,s),_(t,i),u&&u.m(i,null),r=!0,o||(a=[E(t,"click",e[5]),E(t,"mouseenter",e[6]),E(t,"mouseleave",e[7])],o=!0)},p(e,[i]){u&&u.p&&(!r||8&i)&&d(u,l,e,e[3],r?h(l,e[3],i,null):p(e[3]),null),z(t,m=de(f,[4&i&&e[2]])),O(t,"bx--list-box__menu-item",!0),O(t,"bx--list-box__menu-item--active",e[0]),O(t,"bx--list-box__menu-item--highlighted",e[1])},i(e){r||(ae(u,e),r=!0)},o(e){le(u,e),r=!1},d(e){e&&x(t),u&&u.d(e),o=!1,s(a)}}}function $o(e,t,i){const r=["active","highlighted"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{active:l=!1}=t,{highlighted:c=!1}=t;return e.$$set=e=>{t=n(n({},t),f(e)),i(2,o=m(t,r)),"active"in e&&i(0,l=e.active),"highlighted"in e&&i(1,c=e.highlighted),"$$scope"in e&&i(3,a=e.$$scope)},[l,c,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var jo=class extends ve{constructor(e){super(),_e(this,e,$o,Fo,l,{active:0,highlighted:1})}};function No(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function Uo(e){let t,r,o=e[1]&&No(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=No(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Vo(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var Go=class extends ve{constructor(e){super(),_e(this,e,Vo,Uo,l,{size:0,title:1})}};function qo(e,t,i){const n=e.slice();return n[37]=t[i],n[39]=i,n}const Wo=e=>({item:16&e[0],index:16&e[0]}),Ho=e=>({item:e[37],index:e[39]});function Zo(e){let t,i;return{c(){t=w("label"),i=k(e[11]),A(t,"for",e[20]),O(t,"bx--label",!0),O(t,"bx--label--disabled",e[10]),O(t,"bx--visually-hidden",e[18])},m(e,n){v(e,t,n),_(t,i)},p(e,n){2048&n[0]&&L(i,e[11]),1048576&n[0]&&A(t,"for",e[20]),1024&n[0]&&O(t,"bx--label--disabled",e[10]),262144&n[0]&&O(t,"bx--visually-hidden",e[18])},d(e){e&&x(t)}}}function Xo(e){let t,i;return t=new yo({props:{class:"bx--list-box__invalid-icon"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Ko(e){let t,i;return t=new bo({props:{class:"bx--list-box__invalid-icon bx--list-box__invalid-icon--warning"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Yo(e){let t;return{c(){t=k(e[17])},m(e,i){v(e,t,i)},p(e,i){131072&i[0]&&L(t,e[17])},d(e){e&&x(t)}}}function Jo(e){let t,i=e[5](e[22])+"";return{c(){t=k(i)},m(e,i){v(e,t,i)},p(e,n){4194336&n[0]&&i!==(i=e[5](e[22])+"")&&L(t,i)},d(e){e&&x(t)}}}function Qo(e){let t,i;return t=new zo({props:{"aria-labelledby":e[20],id:e[20],$$slots:{default:[is]},$$scope:{ctx:e}}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n={};1048576&i[0]&&(n["aria-labelledby"]=e[20]),1048576&i[0]&&(n.id=e[20]),8388665&i[0]|16&i[1]&&(n.$$scope={dirty:i,ctx:e}),t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function es(e){let t,i;const n=e[27].default,r=c(n,e,e[35],Ho),o=r||function(e){let t,i=e[5](e[37])+"";return{c(){t=k(i)},m(e,i){v(e,t,i)},p(e,n){48&n[0]&&i!==(i=e[5](e[37])+"")&&L(t,i)},d(e){e&&x(t)}}}(e);return{c(){o&&o.c(),t=S()},m(e,n){o&&o.m(e,n),v(e,t,n),i=!0},p(e,t){r?r.p&&(!i||16&t[0]|16&t[1])&&d(r,n,e,e[35],i?h(n,e[35],t,Wo):p(e[35]),Ho):o&&o.p&&(!i||48&t[0])&&o.p(e,i?t:[-1,-1])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){o&&o.d(e),e&&x(t)}}}function ts(e,t){let i,n,r;return n=new jo({props:{id:t[37].id,active:t[0]===t[37].id,highlighted:t[23]===t[39]||t[0]===t[37].id,$$slots:{default:[es]},$$scope:{ctx:t}}}),n.$on("click",(function(){return t[32](t[37])})),n.$on("mouseenter",(function(){return t[33](t[39])})),{key:e,first:null,c(){i=C(),me(n.$$.fragment),this.first=i},m(e,t){v(e,i,t),ge(n,e,t),r=!0},p(e,i){t=e;const r={};16&i[0]&&(r.id=t[37].id),17&i[0]&&(r.active=t[0]===t[37].id),8388625&i[0]&&(r.highlighted=t[23]===t[39]||t[0]===t[37].id),48&i[0]|16&i[1]&&(r.$$scope={dirty:i,ctx:t}),n.$set(r)},i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(i),ye(n,e)}}}function is(e){let t,i,n=[],r=new Map,o=e[4];const s=e=>e[37].id;for(let t=0;t<o.length;t+=1){let i=qo(e,o,t),a=s(i);r.set(a,n[t]=ts(a,i))}return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=C()},m(e,r){for(let t=0;t<n.length;t+=1)n[t].m(e,r);v(e,t,r),i=!0},p(e,i){8388665&i[0]|16&i[1]&&(o=e[4],oe(),n=he(n,i,s,1,e,o,r,t.parentNode,ue,ts,t,qo),se())},i(e){if(!i){for(let e=0;e<o.length;e+=1)ae(n[e]);i=!0}},o(e){for(let e=0;e<n.length;e+=1)le(n[e]);i=!1},d(e){for(let t=0;t<n.length;t+=1)n[t].d(e);e&&x(t)}}}function ns(e){let t,i,n,r,o,s,a,l,c,u,h,d=e[12]&&Xo(),p=!e[12]&&e[14]&&Ko();function f(e,t){return e[22]?Jo:Yo}let m=f(e),g=m(e);s=new Bo({props:{translateWithId:e[19],open:e[1]}}),s.$on("click",e[29]);let y=e[1]&&Qo(e);return{c(){d&&d.c(),t=S(),p&&p.c(),i=S(),n=w("button"),r=w("span"),g.c(),o=S(),me(s.$$.fragment),a=S(),y&&y.c(),l=C(),A(r,"class","bx--list-box__label"),A(n,"type","button"),A(n,"tabindex","0"),A(n,"aria-expanded",e[1]),n.disabled=e[10],A(n,"translatewithid",e[19]),A(n,"id",e[20]),O(n,"bx--list-box__field",!0)},m(f,m){d&&d.m(f,m),v(f,t,m),p&&p.m(f,m),v(f,i,m),v(f,n,m),_(n,r),g.m(r,null),_(n,o),ge(s,n,null),e[30](n),v(f,a,m),y&&y.m(f,m),v(f,l,m),c=!0,u||(h=E(n,"keydown",e[31]),u=!0)},p(e,o){e[12]?d?4096&o[0]&&ae(d,1):(d=Xo(),d.c(),ae(d,1),d.m(t.parentNode,t)):d&&(oe(),le(d,1,1,(()=>{d=null})),se()),!e[12]&&e[14]?p?20480&o[0]&&ae(p,1):(p=Ko(),p.c(),ae(p,1),p.m(i.parentNode,i)):p&&(oe(),le(p,1,1,(()=>{p=null})),se()),m===(m=f(e))&&g?g.p(e,o):(g.d(1),g=m(e),g&&(g.c(),g.m(r,null)));const a={};524288&o[0]&&(a.translateWithId=e[19]),2&o[0]&&(a.open=e[1]),s.$set(a),(!c||2&o[0])&&A(n,"aria-expanded",e[1]),(!c||1024&o[0])&&(n.disabled=e[10]),(!c||524288&o[0])&&A(n,"translatewithid",e[19]),(!c||1048576&o[0])&&A(n,"id",e[20]),e[1]?y?(y.p(e,o),2&o[0]&&ae(y,1)):(y=Qo(e),y.c(),ae(y,1),y.m(l.parentNode,l)):y&&(oe(),le(y,1,1,(()=>{y=null})),se())},i(e){c||(ae(d),ae(p),ae(s.$$.fragment,e),ae(y),c=!0)},o(e){le(d),le(p),le(s.$$.fragment,e),le(y),c=!1},d(r){d&&d.d(r),r&&x(t),p&&p.d(r),r&&x(i),r&&x(n),g.d(),ye(s),e[30](null),r&&x(a),y&&y.d(r),r&&x(l),u=!1,h()}}}function rs(e){let t,i;return{c(){t=w("div"),i=k(e[16]),O(t,"bx--form__helper-text",!0),O(t,"bx--form__helper-text--disabled",e[10])},m(e,n){v(e,t,n),_(t,i)},p(e,n){65536&n[0]&&L(i,e[16]),1024&n[0]&&O(t,"bx--form__helper-text--disabled",e[10])},d(e){e&&x(t)}}}function os(e){let t,i,r,o,s,a,l,c=e[11]&&Zo(e);r=new Eo({props:{type:e[6],size:e[8],id:e[20],name:e[21],"aria-label":e[26]["aria-label"],class:"bx--dropdown "+("top"===e[7]&&"bx--list-box--up")+" "+(e[12]&&"bx--dropdown--invalid")+" "+(!e[12]&&e[14]&&"bx--dropdown--warning")+" "+(e[1]&&"bx--dropdown--open")+"\n      "+("sm"===e[8]&&"bx--dropdown--sm")+"\n      "+("xl"===e[8]&&"bx--dropdown--xl")+"\n      "+(e[2]&&"bx--dropdown--inline")+"\n      "+(e[10]&&"bx--dropdown--disabled")+"\n      "+(e[9]&&"bx--dropdown--light"),disabled:e[10],open:e[1],invalid:e[12],invalidText:e[13],light:e[9],warn:e[14],warnText:e[15],$$slots:{default:[ns]},$$scope:{ctx:e}}}),r.$on("click",e[34]);let u=!e[2]&&!e[12]&&!e[14]&&e[16]&&rs(e),h=[e[25]],d={};for(let e=0;e<h.length;e+=1)d=n(d,h[e]);return{c(){t=w("div"),c&&c.c(),i=S(),me(r.$$.fragment),o=S(),u&&u.c(),z(t,d),O(t,"bx--dropdown__wrapper",!0),O(t,"bx--list-box__wrapper",!0),O(t,"bx--dropdown__wrapper--inline",e[2]),O(t,"bx--list-box__wrapper--inline",e[2]),O(t,"bx--dropdown__wrapper--inline--invalid",e[2]&&e[12])},m(n,h){v(n,t,h),c&&c.m(t,null),_(t,i),ge(r,t,null),_(t,o),u&&u.m(t,null),s=!0,a||(l=E(window,"click",e[28]),a=!0)},p(e,n){e[11]?c?c.p(e,n):(c=Zo(e),c.c(),c.m(t,i)):c&&(c.d(1),c=null);const o={};64&n[0]&&(o.type=e[6]),256&n[0]&&(o.size=e[8]),1048576&n[0]&&(o.id=e[20]),2097152&n[0]&&(o.name=e[21]),67108864&n[0]&&(o["aria-label"]=e[26]["aria-label"]),22406&n[0]&&(o.class="bx--dropdown "+("top"===e[7]&&"bx--list-box--up")+" "+(e[12]&&"bx--dropdown--invalid")+" "+(!e[12]&&e[14]&&"bx--dropdown--warning")+" "+(e[1]&&"bx--dropdown--open")+"\n      "+("sm"===e[8]&&"bx--dropdown--sm")+"\n      "+("xl"===e[8]&&"bx--dropdown--xl")+"\n      "+(e[2]&&"bx--dropdown--inline")+"\n      "+(e[10]&&"bx--dropdown--disabled")+"\n      "+(e[9]&&"bx--dropdown--light")),1024&n[0]&&(o.disabled=e[10]),2&n[0]&&(o.open=e[1]),4096&n[0]&&(o.invalid=e[12]),8192&n[0]&&(o.invalidText=e[13]),512&n[0]&&(o.light=e[9]),16384&n[0]&&(o.warn=e[14]),32768&n[0]&&(o.warnText=e[15]),14308411&n[0]|16&n[1]&&(o.$$scope={dirty:n,ctx:e}),r.$set(o),e[2]||e[12]||e[14]||!e[16]?u&&(u.d(1),u=null):u?u.p(e,n):(u=rs(e),u.c(),u.m(t,null)),z(t,d=de(h,[33554432&n[0]&&e[25]])),O(t,"bx--dropdown__wrapper",!0),O(t,"bx--list-box__wrapper",!0),O(t,"bx--dropdown__wrapper--inline",e[2]),O(t,"bx--list-box__wrapper--inline",e[2]),O(t,"bx--dropdown__wrapper--inline--invalid",e[2]&&e[12])},i(e){s||(ae(r.$$.fragment,e),s=!0)},o(e){le(r.$$.fragment,e),s=!1},d(e){e&&x(t),c&&c.d(),ye(r),u&&u.d(),a=!1,l()}}}function ss(e,t,i){let r;const o=["items","itemToString","selectedId","type","direction","size","open","inline","light","disabled","titleText","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","id","name","ref"];let s=m(t,o),{$$slots:a={},$$scope:l}=t,{items:c=[]}=t,{itemToString:u=(e=>e.text||e.id)}=t,{selectedId:h}=t,{type:d="default"}=t,{direction:p="bottom"}=t,{size:g}=t,{open:y=!1}=t,{inline:_=!1}=t,{light:v=!1}=t,{disabled:x=!1}=t,{titleText:b=""}=t,{invalid:w=!1}=t,{invalidText:T=""}=t,{warn:k=!1}=t,{warnText:S=""}=t,{helperText:C=""}=t,{label:E}=t,{hideLabel:M=!1}=t,{translateWithId:A}=t,{id:z="ccs-"+Math.random().toString(36)}=t,{name:I}=t,{ref:L=null}=t;const D=j();let P=-1;function O(e){let t=P+e;t<0?t=c.length-1:t>=c.length&&(t=0),i(23,P=t)}return e.$$set=e=>{i(26,t=n(n({},t),f(e))),i(25,s=m(t,o)),"items"in e&&i(4,c=e.items),"itemToString"in e&&i(5,u=e.itemToString),"selectedId"in e&&i(0,h=e.selectedId),"type"in e&&i(6,d=e.type),"direction"in e&&i(7,p=e.direction),"size"in e&&i(8,g=e.size),"open"in e&&i(1,y=e.open),"inline"in e&&i(2,_=e.inline),"light"in e&&i(9,v=e.light),"disabled"in e&&i(10,x=e.disabled),"titleText"in e&&i(11,b=e.titleText),"invalid"in e&&i(12,w=e.invalid),"invalidText"in e&&i(13,T=e.invalidText),"warn"in e&&i(14,k=e.warn),"warnText"in e&&i(15,S=e.warnText),"helperText"in e&&i(16,C=e.helperText),"label"in e&&i(17,E=e.label),"hideLabel"in e&&i(18,M=e.hideLabel),"translateWithId"in e&&i(19,A=e.translateWithId),"id"in e&&i(20,z=e.id),"name"in e&&i(21,I=e.name),"ref"in e&&i(3,L=e.ref),"$$scope"in e&&i(35,l=e.$$scope)},e.$$.update=()=>{17&e.$$.dirty[0]&&i(22,r=c.find((e=>e.id===h))),4194305&e.$$.dirty[0]&&void 0!==h&&D("select",{selectedId:h,selectedItem:r}),64&e.$$.dirty[0]&&i(2,_="inline"===d),2&e.$$.dirty[0]&&(y||i(23,P=-1))},t=f(t),[h,y,_,L,c,u,d,p,g,v,x,b,w,T,k,S,C,E,M,A,z,I,r,P,O,s,t,a,({target:e})=>{y&&L&&!L.contains(e)&&i(1,y=!1)},e=>{e.stopPropagation(),x||i(1,y=!y)},function(e){G[e?"unshift":"push"]((()=>{L=e,i(3,L)}))},e=>{const{key:t}=e;["Enter","ArrowDown","ArrowUp"].includes(t)&&e.preventDefault(),"Enter"===t?(i(1,y=!y),P>-1&&c[P].id!==h&&(i(0,h=c[P].id),i(1,y=!1))):"Tab"===t?(i(1,y=!1),L.blur()):"ArrowDown"===t?O(1):"ArrowUp"===t&&O(-1)},e=>{i(0,h=e.id),L.focus()},e=>{i(23,P=e)},({target:e})=>{x||i(1,y=!!L.contains(e)&&!y)},l]}var as=class extends ve{constructor(e){super(),_e(this,e,ss,os,l,{items:4,itemToString:5,selectedId:0,type:6,direction:7,size:8,open:1,inline:2,light:9,disabled:10,titleText:11,invalid:12,invalidText:13,warn:14,warnText:15,helperText:16,label:17,hideLabel:18,translateWithId:19,id:20,name:21,ref:3},null,[-1,-1])}};function ls(e,t,i){const n=e.slice();return n[54]=t[i],n}const cs=e=>({}),us=e=>({}),hs=e=>({}),ds=e=>({});function ps(e){let t,i,n,r,o;return i=new Go({props:{size:20,"aria-label":e[7],class:"bx--modal-close__icon"}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"type","button"),A(t,"aria-label",e[7]),A(t,"title",e[7]),O(t,"bx--modal-close",!0)},m(s,a){v(s,t,a),ge(i,t,null),e[37](t),n=!0,r||(o=E(t,"click",e[38]),r=!0)},p(e,r){const o={};128&r[0]&&(o["aria-label"]=e[7]),i.$set(o),(!n||128&r[0])&&A(t,"aria-label",e[7]),(!n||128&r[0])&&A(t,"title",e[7])},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(n){n&&x(t),ye(i),e[37](null),r=!1,o()}}}function fs(e){let t,i;const n=e[31].label,r=c(n,e,e[50],ds),o=r||function(e){let t;return{c(){t=k(e[6])},m(e,i){v(e,t,i)},p(e,i){64&i[0]&&L(t,e[6])},d(e){e&&x(t)}}}(e);return{c(){t=w("h2"),o&&o.c(),A(t,"id",e[25]),O(t,"bx--modal-header__label",!0)},m(e,n){v(e,t,n),o&&o.m(t,null),i=!0},p(e,s){r?r.p&&(!i||524288&s[1])&&d(r,n,e,e[50],i?h(n,e[50],s,hs):p(e[50]),ds):o&&o.p&&(!i||64&s[0])&&o.p(e,i?s:[-1,-1]),(!i||33554432&s[0])&&A(t,"id",e[25])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){e&&x(t),o&&o.d(e)}}}function ms(e){let t,i,n,r,o;return i=new Go({props:{size:20,"aria-label":e[7],class:"bx--modal-close__icon"}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"type","button"),A(t,"aria-label",e[7]),A(t,"title",e[7]),O(t,"bx--modal-close",!0)},m(s,a){v(s,t,a),ge(i,t,null),e[39](t),n=!0,r||(o=E(t,"click",e[40]),r=!0)},p(e,r){const o={};128&r[0]&&(o["aria-label"]=e[7]),i.$set(o),(!n||128&r[0])&&A(t,"aria-label",e[7]),(!n||128&r[0])&&A(t,"title",e[7])},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(n){n&&x(t),ye(i),e[39](null),r=!1,o()}}}function gs(e){let t;return{c(){t=w("div"),O(t,"bx--modal-content--overflow-indicator",!0)},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function ys(e){let t,i,n,r,o,s;const a=[vs,_s],l=[];function c(e,t){return e[15].length>0?0:e[14]?1:-1}return~(i=c(e))&&(n=l[i]=a[i](e)),o=new po({props:{kind:e[3]?"danger":"primary",disabled:e[11],icon:e[12],$$slots:{default:[Ts]},$$scope:{ctx:e}}}),o.$on("click",e[43]),{c(){t=w("div"),n&&n.c(),r=S(),me(o.$$.fragment),O(t,"bx--modal-footer",!0),O(t,"bx--modal-footer--three-button",2===e[15].length)},m(e,n){v(e,t,n),~i&&l[i].m(t,null),_(t,r),ge(o,t,null),s=!0},p(e,s){let u=i;i=c(e),i===u?~i&&l[i].p(e,s):(n&&(oe(),le(l[u],1,1,(()=>{l[u]=null})),se()),~i?(n=l[i],n?n.p(e,s):(n=l[i]=a[i](e),n.c()),ae(n,1),n.m(t,r)):n=null);const h={};8&s[0]&&(h.kind=e[3]?"danger":"primary"),2048&s[0]&&(h.disabled=e[11]),4096&s[0]&&(h.icon=e[12]),1024&s[0]|524288&s[1]&&(h.$$scope={dirty:s,ctx:e}),o.$set(h),32768&s[0]&&O(t,"bx--modal-footer--three-button",2===e[15].length)},i(e){s||(ae(n),ae(o.$$.fragment,e),s=!0)},o(e){le(n),le(o.$$.fragment,e),s=!1},d(e){e&&x(t),~i&&l[i].d(),ye(o)}}}function _s(e){let t,i;return t=new po({props:{kind:"secondary",$$slots:{default:[xs]},$$scope:{ctx:e}}}),t.$on("click",e[42]),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n={};16384&i[0]|524288&i[1]&&(n.$$scope={dirty:i,ctx:e}),t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function vs(e){let t,i,n=e[15],r=[];for(let t=0;t<n.length;t+=1)r[t]=ws(ls(e,n,t));const o=e=>le(r[e],1,1,(()=>{r[e]=null}));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=C()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);v(e,t,n),i=!0},p(e,i){if(67141632&i[0]){let s;for(n=e[15],s=0;s<n.length;s+=1){const o=ls(e,n,s);r[s]?(r[s].p(o,i),ae(r[s],1)):(r[s]=ws(o),r[s].c(),ae(r[s],1),r[s].m(t.parentNode,t))}for(oe(),s=n.length;s<r.length;s+=1)o(s);se()}},i(e){if(!i){for(let e=0;e<n.length;e+=1)ae(r[e]);i=!0}},o(e){r=r.filter(Boolean);for(let e=0;e<r.length;e+=1)le(r[e]);i=!1},d(e){b(r,e),e&&x(t)}}}function xs(e){let t;return{c(){t=k(e[14])},m(e,i){v(e,t,i)},p(e,i){16384&i[0]&&L(t,e[14])},d(e){e&&x(t)}}}function bs(e){let t,i,n=e[54].text+"";return{c(){t=k(n),i=S()},m(e,n){v(e,t,n),v(e,i,n)},p(e,i){32768&i[0]&&n!==(n=e[54].text+"")&&L(t,n)},d(e){e&&x(t),e&&x(i)}}}function ws(e){let t,i;return t=new po({props:{kind:"secondary",$$slots:{default:[bs]},$$scope:{ctx:e}}}),t.$on("click",(function(){return e[41](e[54])})),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(i,n){e=i;const r={};32768&n[0]|524288&n[1]&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Ts(e){let t;return{c(){t=k(e[10])},m(e,i){v(e,t,i)},p(e,i){1024&i[0]&&L(t,e[10])},d(e){e&&x(t)}}}function ks(e){let t,i,r,o,a,l,u,f,m,g,y,b,T,C,M,I,D,P,R=e[4]&&ps(e),B=e[6]&&fs(e);const F=e[31].heading,$=c(F,e,e[50],us),j=$||function(e){let t;return{c(){t=k(e[5])},m(e,i){v(e,t,i)},p(e,i){32&i[0]&&L(t,e[5])},d(e){e&&x(t)}}}(e);let N=!e[4]&&ms(e);const U=e[31].default,V=c(U,e,e[50],null);let G=e[9]&&gs(),q=!e[4]&&ys(e),W=[{role:"dialog"},{tabindex:"-1"},e[22],{"aria-modal":"true"},{"aria-label":e[23]}],H={};for(let e=0;e<W.length;e+=1)H=n(H,W[e]);let Z=[{role:"presentation"},{id:e[17]},e[27]],X={};for(let e=0;e<Z.length;e+=1)X=n(X,Z[e]);return{c(){t=w("div"),i=w("div"),r=w("div"),R&&R.c(),o=S(),B&&B.c(),a=S(),l=w("h3"),j&&j.c(),u=S(),N&&N.c(),f=S(),m=w("div"),V&&V.c(),C=S(),G&&G.c(),M=S(),q&&q.c(),A(l,"id",e[24]),O(l,"bx--modal-header__heading",!0),O(r,"bx--modal-header",!0),A(m,"id",e[18]),A(m,"tabindex",g=e[9]?"0":void 0),A(m,"role",y=e[9]?"region":void 0),A(m,"aria-label",b=e[9]?e[23]:void 0),A(m,"aria-labelledby",T=e[6]?e[25]:e[24]),O(m,"bx--modal-content",!0),O(m,"bx--modal-content--with-form",e[8]),O(m,"bx--modal-scroll-content",e[9]),z(i,H),O(i,"bx--modal-container",!0),O(i,"bx--modal-container--xs","xs"===e[2]),O(i,"bx--modal-container--sm","sm"===e[2]),O(i,"bx--modal-container--lg","lg"===e[2]),z(t,X),O(t,"bx--modal",!0),O(t,"bx--modal-tall",!e[4]),O(t,"is-visible",e[0]),O(t,"bx--modal--danger",e[3])},m(n,s){v(n,t,s),_(t,i),_(i,r),R&&R.m(r,null),_(r,o),B&&B.m(r,null),_(r,a),_(r,l),j&&j.m(l,null),_(r,u),N&&N.m(r,null),_(i,f),_(i,m),V&&V.m(m,null),_(i,C),G&&G.m(i,null),_(i,M),q&&q.m(i,null),e[44](i),e[46](t),I=!0,D||(P=[E(i,"click",e[45]),E(t,"keydown",e[32]),E(t,"keydown",e[47]),E(t,"click",e[33]),E(t,"click",e[48]),E(t,"mouseover",e[34]),E(t,"mouseenter",e[35]),E(t,"mouseleave",e[36]),E(t,"transitionend",e[49])],D=!0)},p(e,n){e[4]?R?(R.p(e,n),16&n[0]&&ae(R,1)):(R=ps(e),R.c(),ae(R,1),R.m(r,o)):R&&(oe(),le(R,1,1,(()=>{R=null})),se()),e[6]?B?(B.p(e,n),64&n[0]&&ae(B,1)):(B=fs(e),B.c(),ae(B,1),B.m(r,a)):B&&(oe(),le(B,1,1,(()=>{B=null})),se()),$?$.p&&(!I||524288&n[1])&&d($,F,e,e[50],I?h(F,e[50],n,cs):p(e[50]),us):j&&j.p&&(!I||32&n[0])&&j.p(e,I?n:[-1,-1]),(!I||16777216&n[0])&&A(l,"id",e[24]),e[4]?N&&(oe(),le(N,1,1,(()=>{N=null})),se()):N?(N.p(e,n),16&n[0]&&ae(N,1)):(N=ms(e),N.c(),ae(N,1),N.m(r,null)),V&&V.p&&(!I||524288&n[1])&&d(V,U,e,e[50],I?h(U,e[50],n,null):p(e[50]),null),(!I||262144&n[0])&&A(m,"id",e[18]),(!I||512&n[0]&&g!==(g=e[9]?"0":void 0))&&A(m,"tabindex",g),(!I||512&n[0]&&y!==(y=e[9]?"region":void 0))&&A(m,"role",y),(!I||8389120&n[0]&&b!==(b=e[9]?e[23]:void 0))&&A(m,"aria-label",b),(!I||50331712&n[0]&&T!==(T=e[6]?e[25]:e[24]))&&A(m,"aria-labelledby",T),256&n[0]&&O(m,"bx--modal-content--with-form",e[8]),512&n[0]&&O(m,"bx--modal-scroll-content",e[9]),e[9]?G||(G=gs(),G.c(),G.m(i,M)):G&&(G.d(1),G=null),e[4]?q&&(oe(),le(q,1,1,(()=>{q=null})),se()):q?(q.p(e,n),16&n[0]&&ae(q,1)):(q=ys(e),q.c(),ae(q,1),q.m(i,null)),z(i,H=de(W,[{role:"dialog"},{tabindex:"-1"},4194304&n[0]&&e[22],{"aria-modal":"true"},(!I||8388608&n[0])&&{"aria-label":e[23]}])),O(i,"bx--modal-container",!0),O(i,"bx--modal-container--xs","xs"===e[2]),O(i,"bx--modal-container--sm","sm"===e[2]),O(i,"bx--modal-container--lg","lg"===e[2]),z(t,X=de(Z,[{role:"presentation"},(!I||131072&n[0])&&{id:e[17]},134217728&n[0]&&e[27]])),O(t,"bx--modal",!0),O(t,"bx--modal-tall",!e[4]),O(t,"is-visible",e[0]),O(t,"bx--modal--danger",e[3])},i(e){I||(ae(R),ae(B),ae(j,e),ae(N),ae(V,e),ae(q),I=!0)},o(e){le(R),le(B),le(j,e),le(N),le(V,e),le(q),I=!1},d(i){i&&x(t),R&&R.d(),B&&B.d(),j&&j.d(i),N&&N.d(),V&&V.d(i),G&&G.d(),q&&q.d(),e[44](null),e[46](null),D=!1,s(P)}}}function Ss(e,t,i){let r,o,s,a;const l=["size","open","danger","alert","passiveModal","modalHeading","modalLabel","modalAriaLabel","iconDescription","hasForm","hasScrollingContent","primaryButtonText","primaryButtonDisabled","primaryButtonIcon","shouldSubmitOnEnter","secondaryButtonText","secondaryButtons","selectorPrimaryFocus","preventCloseOnClickOutside","id","ref"];let c=m(t,l),{$$slots:u={},$$scope:h}=t,{size:d}=t,{open:p=!1}=t,{danger:g=!1}=t,{alert:y=!1}=t,{passiveModal:_=!1}=t,{modalHeading:v}=t,{modalLabel:x}=t,{modalAriaLabel:b}=t,{iconDescription:w="Close the modal"}=t,{hasForm:T=!1}=t,{hasScrollingContent:k=!1}=t,{primaryButtonText:S=""}=t,{primaryButtonDisabled:C=!1}=t,{primaryButtonIcon:E}=t,{shouldSubmitOnEnter:M=!0}=t,{secondaryButtonText:A=""}=t,{secondaryButtons:z=[]}=t,{selectorPrimaryFocus:I="[data-modal-primary-focus]"}=t,{preventCloseOnClickOutside:L=!1}=t,{id:D="ccs-"+Math.random().toString(36)}=t,{ref:P=null}=t;const O=j();let R=null,B=null,N=!1,V=!1;var q;$((()=>()=>{document.body.classList.remove("bx--body--with-modal-open")})),q=()=>{N?p||(N=!1,O("close"),document.body.classList.remove("bx--body--with-modal-open")):p&&(N=!0,function(e){((e||B).querySelector(I)||R).focus()}(),O("open"),document.body.classList.add("bx--body--with-modal-open"))},F().$$.after_update.push(q);let W={};return e.$$set=e=>{i(53,t=n(n({},t),f(e))),i(27,c=m(t,l)),"size"in e&&i(2,d=e.size),"open"in e&&i(0,p=e.open),"danger"in e&&i(3,g=e.danger),"alert"in e&&i(28,y=e.alert),"passiveModal"in e&&i(4,_=e.passiveModal),"modalHeading"in e&&i(5,v=e.modalHeading),"modalLabel"in e&&i(6,x=e.modalLabel),"modalAriaLabel"in e&&i(29,b=e.modalAriaLabel),"iconDescription"in e&&i(7,w=e.iconDescription),"hasForm"in e&&i(8,T=e.hasForm),"hasScrollingContent"in e&&i(9,k=e.hasScrollingContent),"primaryButtonText"in e&&i(10,S=e.primaryButtonText),"primaryButtonDisabled"in e&&i(11,C=e.primaryButtonDisabled),"primaryButtonIcon"in e&&i(12,E=e.primaryButtonIcon),"shouldSubmitOnEnter"in e&&i(13,M=e.shouldSubmitOnEnter),"secondaryButtonText"in e&&i(14,A=e.secondaryButtonText),"secondaryButtons"in e&&i(15,z=e.secondaryButtons),"selectorPrimaryFocus"in e&&i(30,I=e.selectorPrimaryFocus),"preventCloseOnClickOutside"in e&&i(16,L=e.preventCloseOnClickOutside),"id"in e&&i(17,D=e.id),"ref"in e&&i(1,P=e.ref),"$$scope"in e&&i(50,h=e.$$scope)},e.$$.update=()=>{131072&e.$$.dirty[0]&&i(25,r=`bx--modal-header__label--modal-${D}`),131072&e.$$.dirty[0]&&i(24,o=`bx--modal-header__heading--modal-${D}`),131072&e.$$.dirty[0]&&i(18,s=`bx--modal-body--${D}`),i(23,a=x||t["aria-label"]||b||v),268697616&e.$$.dirty[0]&&y&&(_&&i(22,W.role="alert",W),_||(i(22,W.role="alertdialog",W),i(22,W["aria-describedby"]=s,W)))},t=f(t),[p,P,d,g,_,v,x,w,T,k,S,C,E,M,A,z,L,D,s,R,B,V,W,a,o,r,O,c,y,b,I,u,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{R=e,i(19,R)}))},()=>{i(0,p=!1)},function(e){G[e?"unshift":"push"]((()=>{R=e,i(19,R)}))},()=>{i(0,p=!1)},e=>{O("click:button--secondary",{text:e.text})},()=>{O("click:button--secondary",{text:A})},()=>{O("submit"),O("click:button--primary")},function(e){G[e?"unshift":"push"]((()=>{B=e,i(20,B)}))},()=>{i(21,V=!0)},function(e){G[e?"unshift":"push"]((()=>{P=e,i(1,P)}))},e=>{if(p)if("Escape"===e.key)i(0,p=!1);else if("Tab"===e.key){const t="\n  a[href], area[href], input:not([disabled]):not([tabindex='-1']),\n  button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),\n  textarea:not([disabled]):not([tabindex='-1']),\n  iframe, object, embed, *[tabindex]:not([tabindex='-1']):not([disabled]), *[contenteditable=true]\n",i=Array.from(P.querySelectorAll(t));let n=i.indexOf(document.activeElement);-1===n&&e.shiftKey&&(n=0),n+=i.length+(e.shiftKey?-1:1),n%=i.length,i[n].focus(),e.preventDefault()}else M&&"Enter"===e.key&&(O("submit"),O("click:button--primary"))},()=>{V||L||i(0,p=!1),i(21,V=!1)},e=>{"transform"===e.propertyName&&O("transitionend",{open:p})},h]}var Cs=class extends ve{constructor(e){super(),_e(this,e,Ss,ks,l,{size:2,open:0,danger:3,alert:28,passiveModal:4,modalHeading:5,modalLabel:6,modalAriaLabel:29,iconDescription:7,hasForm:8,hasScrollingContent:9,primaryButtonText:10,primaryButtonDisabled:11,primaryButtonIcon:12,shouldSubmitOnEnter:13,secondaryButtonText:14,secondaryButtons:15,selectorPrimaryFocus:30,preventCloseOnClickOutside:16,id:17,ref:1},null,[-1,-1])}};function Es(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function Ms(e){let t,r,o=e[1]&&Es(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M17 15L17 8 15 8 15 15 8 15 8 17 15 17 15 24 17 24 17 17 24 17 24 15z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=Es(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function As(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var zs=class extends ve{constructor(e){super(),_e(this,e,As,Ms,l,{size:0,title:1})}};function Is(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function Ls(e){let t,r,o=e[1]&&Is(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M8 15H24V17H8z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=Is(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Ds(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var Ps=class extends ve{constructor(e){super(),_e(this,e,Ds,Ls,l,{size:0,title:1})}};function Os(e){let t,i;return{c(){t=T("title"),i=k(e[1])},m(e,n){v(e,t,n),_(t,i)},p(e,t){2&t&&L(i,e[1])},d(e){e&&x(t)}}}function Rs(e){let t,r,o=e[1]&&Os(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=n(a,s[e]);return{c(){t=T("svg"),o&&o.c(),r=T("path"),A(r,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),I(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,r)},p(e,[i]){e[1]?o?o.p(e,i):(o=Os(e),o.c(),o.m(t,r)):o&&(o.d(1),o=null),I(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Bs(e,t,i){let r,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=n(n({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,r=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!r||void 0,role:r?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,r]}var Fs=class extends ve{constructor(e){super(),_e(this,e,Bs,Rs,l,{size:0,title:1})}};const $s=e=>({}),js=e=>({});function Ns(e){let t,i;const n=e[34].label,r=c(n,e,e[33],js),o=r||function(e){let t;return{c(){t=k(e[16])},m(e,i){v(e,t,i)},p(e,i){65536&i[0]&&L(t,e[16])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),o&&o.c(),A(t,"for",e[18]),O(t,"bx--label",!0),O(t,"bx--label--disabled",e[8]),O(t,"bx--visually-hidden",e[17])},m(e,n){v(e,t,n),o&&o.m(t,null),i=!0},p(e,s){r?r.p&&(!i||4&s[1])&&d(r,n,e,e[33],i?h(n,e[33],s,$s):p(e[33]),js):o&&o.p&&(!i||65536&s[0])&&o.p(e,i?s:[-1,-1]),(!i||262144&s[0])&&A(t,"for",e[18]),256&s[0]&&O(t,"bx--label--disabled",e[8]),131072&s[0]&&O(t,"bx--visually-hidden",e[17])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){e&&x(t),o&&o.d(e)}}}function Us(e){let t,i;return t=new yo({props:{class:"bx--number__invalid"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Vs(e){let t,i;return t=new bo({props:{class:"bx--number__invalid bx--number__invalid--warning"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Gs(e){let t,i;return t=new Fs({props:{class:"bx--text-input__readonly-icon"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function qs(e){let t,i,n,r,o,a,l,c,u,h,d,p,f,m,g,y,b;return n=new Ps({props:{class:"down-icon"}}),h=new zs({props:{class:"up-icon"}}),{c(){t=w("div"),i=w("button"),me(n.$$.fragment),a=S(),l=w("div"),c=S(),u=w("button"),me(h.$$.fragment),f=S(),m=w("div"),A(i,"type","button"),A(i,"tabindex","-1"),A(i,"title",r=e[23]||e[10]),A(i,"aria-label",o=e[23]||e[10]),i.disabled=e[8],O(i,"bx--number__control-btn",!0),O(i,"down-icon",!0),O(l,"bx--number__rule-divider",!0),A(u,"type","button"),A(u,"tabindex","-1"),A(u,"title",d=e[24]||e[10]),A(u,"aria-label",p=e[24]||e[10]),u.disabled=e[8],O(u,"bx--number__control-btn",!0),O(u,"up-icon",!0),O(m,"bx--number__rule-divider",!0),O(t,"bx--number__controls",!0)},m(r,o){v(r,t,o),_(t,i),ge(n,i,null),_(t,a),_(t,l),_(t,c),_(t,u),ge(h,u,null),_(t,f),_(t,m),g=!0,y||(b=[E(i,"click",e[42]),E(u,"click",e[43])],y=!0)},p(e,t){(!g||8389632&t[0]&&r!==(r=e[23]||e[10]))&&A(i,"title",r),(!g||8389632&t[0]&&o!==(o=e[23]||e[10]))&&A(i,"aria-label",o),(!g||256&t[0])&&(i.disabled=e[8]),(!g||16778240&t[0]&&d!==(d=e[24]||e[10]))&&A(u,"title",d),(!g||16778240&t[0]&&p!==(p=e[24]||e[10]))&&A(u,"aria-label",p),(!g||256&t[0])&&(u.disabled=e[8])},i(e){g||(ae(n.$$.fragment,e),ae(h.$$.fragment,e),g=!0)},o(e){le(n.$$.fragment,e),le(h.$$.fragment,e),g=!1},d(e){e&&x(t),ye(n),ye(h),y=!1,s(b)}}}function Ws(e){let t,i;return{c(){t=w("div"),i=k(e[15]),O(t,"bx--form__helper-text",!0),O(t,"bx--form__helper-text--disabled",e[8])},m(e,n){v(e,t,n),_(t,i)},p(e,n){32768&n[0]&&L(i,e[15]),256&n[0]&&O(t,"bx--form__helper-text--disabled",e[8])},d(e){e&&x(t)}}}function Hs(e){let t,i;return{c(){t=w("div"),i=k(e[12]),A(t,"id",e[21]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){4096&n[0]&&L(i,e[12]),2097152&n[0]&&A(t,"id",e[21])},d(e){e&&x(t)}}}function Zs(e){let t,i;return{c(){t=w("div"),i=k(e[14]),A(t,"id",e[21]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){16384&n[0]&&L(i,e[14]),2097152&n[0]&&A(t,"id",e[21])},d(e){e&&x(t)}}}function Xs(e){let t,i,r,o,a,l,c,u,h,d,p,f,m,g,y,b,T,k,C,M,I,L=(e[28].label||e[16])&&Ns(e),D=[{type:"number"},{pattern:"[0-9]*"},{"aria-describedby":e[21]},{"data-invalid":l=e[11]||void 0},{"aria-invalid":c=e[11]||void 0},{"aria-label":u=e[16]?void 0:e[20]},{disabled:e[8]},{id:e[18]},{name:e[19]},{max:e[4]},{min:e[5]},{step:e[3]},{value:h=e[0]??""},{readOnly:e[7]},e[29]],P={};for(let e=0;e<D.length;e+=1)P=n(P,D[e]);let R=e[11]&&Us(),B=!e[11]&&e[13]&&Vs(),F=e[7]&&Gs(),$=!e[9]&&qs(e),j=!e[22]&&!e[13]&&e[15]&&Ws(e),N=e[22]&&Hs(e),U=!e[22]&&e[13]&&Zs(e);return{c(){t=w("div"),i=w("div"),L&&L.c(),r=S(),o=w("div"),a=w("input"),d=S(),R&&R.c(),p=S(),B&&B.c(),f=S(),F&&F.c(),m=S(),$&&$.c(),g=S(),j&&j.c(),y=S(),N&&N.c(),b=S(),U&&U.c(),z(a,P),O(o,"bx--number__input-wrapper",!0),O(o,"bx--number__input-wrapper--warning",!e[11]&&e[13]),A(i,"data-invalid",T=e[22]||void 0),A(i,"class",k=e[2]&&`bx--number--${e[2]}`),O(i,"bx--number",!0),O(i,"bx--number--helpertext",!0),O(i,"bx--number--readonly",e[7]),O(i,"bx--number--light",e[6]),O(i,"bx--number--nolabel",e[17]),O(i,"bx--number--nosteppers",e[9]),O(t,"bx--form-item",!0)},m(n,s){v(n,t,s),_(t,i),L&&L.m(i,null),_(i,r),_(i,o),_(o,a),a.autofocus&&a.focus(),e[41](a),_(o,d),R&&R.m(o,null),_(o,p),B&&B.m(o,null),_(o,f),F&&F.m(o,null),_(o,m),$&&$.m(o,null),_(i,g),j&&j.m(i,null),_(i,y),N&&N.m(i,null),_(i,b),U&&U.m(i,null),C=!0,M||(I=[E(a,"change",e[27]),E(a,"input",e[26]),E(a,"focus",e[39]),E(a,"blur",e[40]),E(t,"click",e[35]),E(t,"mouseover",e[36]),E(t,"mouseenter",e[37]),E(t,"mouseleave",e[38])],M=!0)},p(e,t){e[28].label||e[16]?L?(L.p(e,t),268500992&t[0]&&ae(L,1)):(L=Ns(e),L.c(),ae(L,1),L.m(i,r)):L&&(oe(),le(L,1,1,(()=>{L=null})),se()),z(a,P=de(D,[{type:"number"},{pattern:"[0-9]*"},(!C||2097152&t[0])&&{"aria-describedby":e[21]},(!C||2048&t[0]&&l!==(l=e[11]||void 0))&&{"data-invalid":l},(!C||2048&t[0]&&c!==(c=e[11]||void 0))&&{"aria-invalid":c},(!C||1114112&t[0]&&u!==(u=e[16]?void 0:e[20]))&&{"aria-label":u},(!C||256&t[0])&&{disabled:e[8]},(!C||262144&t[0])&&{id:e[18]},(!C||524288&t[0])&&{name:e[19]},(!C||16&t[0])&&{max:e[4]},(!C||32&t[0])&&{min:e[5]},(!C||8&t[0])&&{step:e[3]},(!C||1&t[0]&&h!==(h=e[0]??"")&&a.value!==h)&&{value:h},(!C||128&t[0])&&{readOnly:e[7]},536870912&t[0]&&e[29]])),e[11]?R?2048&t[0]&&ae(R,1):(R=Us(),R.c(),ae(R,1),R.m(o,p)):R&&(oe(),le(R,1,1,(()=>{R=null})),se()),!e[11]&&e[13]?B?10240&t[0]&&ae(B,1):(B=Vs(),B.c(),ae(B,1),B.m(o,f)):B&&(oe(),le(B,1,1,(()=>{B=null})),se()),e[7]?F?128&t[0]&&ae(F,1):(F=Gs(),F.c(),ae(F,1),F.m(o,m)):F&&(oe(),le(F,1,1,(()=>{F=null})),se()),e[9]?$&&(oe(),le($,1,1,(()=>{$=null})),se()):$?($.p(e,t),512&t[0]&&ae($,1)):($=qs(e),$.c(),ae($,1),$.m(o,null)),10240&t[0]&&O(o,"bx--number__input-wrapper--warning",!e[11]&&e[13]),e[22]||e[13]||!e[15]?j&&(j.d(1),j=null):j?j.p(e,t):(j=Ws(e),j.c(),j.m(i,y)),e[22]?N?N.p(e,t):(N=Hs(e),N.c(),N.m(i,b)):N&&(N.d(1),N=null),!e[22]&&e[13]?U?U.p(e,t):(U=Zs(e),U.c(),U.m(i,null)):U&&(U.d(1),U=null),(!C||4194304&t[0]&&T!==(T=e[22]||void 0))&&A(i,"data-invalid",T),(!C||4&t[0]&&k!==(k=e[2]&&`bx--number--${e[2]}`))&&A(i,"class",k),4&t[0]&&O(i,"bx--number",!0),4&t[0]&&O(i,"bx--number--helpertext",!0),132&t[0]&&O(i,"bx--number--readonly",e[7]),68&t[0]&&O(i,"bx--number--light",e[6]),131076&t[0]&&O(i,"bx--number--nolabel",e[17]),516&t[0]&&O(i,"bx--number--nosteppers",e[9])},i(e){C||(ae(L),ae(R),ae(B),ae(F),ae($),C=!0)},o(e){le(L),le(R),le(B),le(F),le($),C=!1},d(i){i&&x(t),L&&L.d(),e[41](null),R&&R.d(),B&&B.d(),F&&F.d(),$&&$.d(),j&&j.d(),N&&N.d(),U&&U.d(),M=!1,s(I)}}}function Ks(e){return""!=e?Number(e):null}function Ys(e,t,i){let r,o,s,a,l;const c=["size","value","step","max","min","light","readonly","allowEmpty","disabled","hideSteppers","iconDescription","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","translationIds","id","name","ref"];let u=m(t,c),{$$slots:h={},$$scope:d}=t;const p=g(h);let{size:y}=t,{value:_=null}=t,{step:v=1}=t,{max:x}=t,{min:b}=t,{light:w=!1}=t,{readonly:T=!1}=t,{allowEmpty:k=!1}=t,{disabled:S=!1}=t,{hideSteppers:C=!1}=t,{iconDescription:E=""}=t,{invalid:M=!1}=t,{invalidText:A=""}=t,{warn:z=!1}=t,{warnText:I=""}=t,{helperText:L=""}=t,{label:D=""}=t,{hideLabel:P=!1}=t,{translateWithId:O=(e=>N[e])}=t;const R={increment:"increment",decrement:"decrement"};let{id:B="ccs-"+Math.random().toString(36)}=t,{name:F}=t,{ref:$=null}=t;const N={[R.increment]:"Increment number",[R.decrement]:"Decrement number"},V=j();function q(e){const t=i(0,_+=e*v);i(0,_=t<b?b:t>x?x:t),V("input",_),V("change",_)}return e.$$set=e=>{i(46,t=n(n({},t),f(e))),i(29,u=m(t,c)),"size"in e&&i(2,y=e.size),"value"in e&&i(0,_=e.value),"step"in e&&i(3,v=e.step),"max"in e&&i(4,x=e.max),"min"in e&&i(5,b=e.min),"light"in e&&i(6,w=e.light),"readonly"in e&&i(7,T=e.readonly),"allowEmpty"in e&&i(30,k=e.allowEmpty),"disabled"in e&&i(8,S=e.disabled),"hideSteppers"in e&&i(9,C=e.hideSteppers),"iconDescription"in e&&i(10,E=e.iconDescription),"invalid"in e&&i(11,M=e.invalid),"invalidText"in e&&i(12,A=e.invalidText),"warn"in e&&i(13,z=e.warn),"warnText"in e&&i(14,I=e.warnText),"helperText"in e&&i(15,L=e.helperText),"label"in e&&i(16,D=e.label),"hideLabel"in e&&i(17,P=e.hideLabel),"translateWithId"in e&&i(31,O=e.translateWithId),"id"in e&&i(18,B=e.id),"name"in e&&i(19,F=e.name),"ref"in e&&i(1,$=e.ref),"$$scope"in e&&i(33,d=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty[1]&&i(24,r=O("increment")),1&e.$$.dirty[1]&&i(23,o=O("decrement")),1073743921&e.$$.dirty[0]&&i(22,s=M||!k&&null==_||_>x||_<b),262144&e.$$.dirty[0]&&i(21,a=`error-${B}`),i(20,l=t["aria-label"]||"Numeric input field with increment and decrement buttons")},t=f(t),[_,$,y,v,x,b,w,T,S,C,E,M,A,z,I,L,D,P,B,F,l,a,s,o,r,q,function({target:e}){i(0,_=Ks(e.value)),V("input",_)},function({target:e}){V("change",Ks(e.value))},p,u,k,O,R,d,h,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{$=e,i(1,$)}))},()=>{q(-1)},()=>{q(1)}]}var Js=class extends ve{constructor(e){super(),_e(this,e,Ys,Xs,l,{size:2,value:0,step:3,max:4,min:5,light:6,readonly:7,allowEmpty:30,disabled:8,hideSteppers:9,iconDescription:10,invalid:11,invalidText:12,warn:13,warnText:14,helperText:15,label:16,hideLabel:17,translateWithId:31,translationIds:32,id:18,name:19,ref:1},null,[-1,-1])}get translationIds(){return this.$$.ctx[32]}};const Qs=e=>({}),ea=e=>({});function ta(e){let t,i,r,o,a,l,u,f,m,g,y,b,T,C,M,I,D,R,B,F,$,j,N,U,V,G,q,W,H,Z,X=(e[5]||e[4])+"",K=(e[3]||e[2])+"";const Y=e[30].labelText,J=c(Y,e,e[29],ea),Q=J||function(e){let t;return{c(){t=k(e[15])},m(e,i){v(e,t,i)},p(e,i){32768&i[0]&&L(t,e[15])},d(e){e&&x(t)}}}(e);let ee=[e[25]],te={};for(let e=0;e<ee.length;e+=1)te=n(te,ee[e]);return{c(){t=w("div"),i=w("label"),Q&&Q.c(),r=S(),o=w("div"),a=w("span"),l=k(X),u=S(),f=w("div"),m=w("div"),g=S(),y=w("div"),b=S(),T=w("div"),C=S(),M=w("input"),I=S(),D=w("span"),R=k(K),B=S(),F=w("input"),A(i,"for",e[13]),A(i,"id",e[20]),O(i,"bx--label",!0),O(i,"bx--label--disabled",e[10]),O(a,"bx--slider__range-label",!0),A(m,"role","slider"),A(m,"tabindex","0"),P(m,"left",e[19]+"%"),A(m,"aria-valuemax",e[2]),A(m,"aria-valuemin",e[4]),A(m,"aria-valuenow",e[0]),A(m,"id",e[13]),O(m,"bx--slider__thumb",!0),O(y,"bx--slider__track",!0),P(T,"transform","translate(0, -50%) scaleX("+e[19]/100+")"),O(T,"bx--slider__filled-track",!0),A(M,"type","hidden"),A(M,"name",e[16]),M.value=e[0],M.required=e[8],A(M,"min",e[4]),A(M,"max",e[2]),A(M,"step",e[6]),O(M,"bx--slider__input",!0),A(f,"role","presentation"),A(f,"tabindex","-1"),O(f,"bx--slider",!0),O(f,"bx--slider--disabled",e[10]),O(D,"bx--slider__range-label",!0),A(F,"type",$=e[12]?"hidden":e[9]),A(F,"style",j=e[12]?"display: none":void 0),A(F,"id",N="input-"+e[13]),A(F,"name",e[16]),F.value=e[0],A(F,"aria-labelledby",U=e[26]["aria-label"]?void 0:e[20]),A(F,"aria-label",V=e[26]["aria-label"]||"Slider number input"),F.disabled=e[10],F.required=e[8],A(F,"min",e[4]),A(F,"max",e[2]),A(F,"step",e[6]),A(F,"data-invalid",G=e[14]||null),A(F,"aria-invalid",q=e[14]||null),O(F,"bx--text-input",!0),O(F,"bx--slider-text-input",!0),O(F,"bx--text-input--light",e[11]),O(F,"bx--text-input--invalid",e[14]),O(o,"bx--slider-container",!0),z(t,te),O(t,"bx--form-item",!0)},m(n,s){v(n,t,s),_(t,i),Q&&Q.m(i,null),_(t,r),_(t,o),_(o,a),_(a,l),_(o,u),_(o,f),_(f,m),_(f,g),_(f,y),e[35](y),_(f,b),_(f,T),_(f,C),_(f,M),e[36](f),_(o,I),_(o,D),_(D,R),_(o,B),_(o,F),W=!0,H||(Z=[E(window,"mousemove",e[24]),E(window,"touchmove",e[24]),E(window,"mouseup",e[23]),E(window,"touchend",e[23]),E(window,"touchcancel",e[23]),E(f,"mousedown",e[21]),E(f,"mousedown",e[22]),E(f,"touchstart",e[22],{passive:!0}),E(f,"keydown",e[37]),E(F,"change",e[38]),E(t,"click",e[31]),E(t,"mouseover",e[32]),E(t,"mouseenter",e[33]),E(t,"mouseleave",e[34])],H=!0)},p(e,n){J?J.p&&(!W||536870912&n[0])&&d(J,Y,e,e[29],W?h(Y,e[29],n,Qs):p(e[29]),ea):Q&&Q.p&&(!W||32768&n[0])&&Q.p(e,W?n:[-1,-1]),(!W||8192&n[0])&&A(i,"for",e[13]),(!W||1048576&n[0])&&A(i,"id",e[20]),1024&n[0]&&O(i,"bx--label--disabled",e[10]),(!W||48&n[0])&&X!==(X=(e[5]||e[4])+"")&&L(l,X),(!W||524288&n[0])&&P(m,"left",e[19]+"%"),(!W||4&n[0])&&A(m,"aria-valuemax",e[2]),(!W||16&n[0])&&A(m,"aria-valuemin",e[4]),(!W||1&n[0])&&A(m,"aria-valuenow",e[0]),(!W||8192&n[0])&&A(m,"id",e[13]),(!W||524288&n[0])&&P(T,"transform","translate(0, -50%) scaleX("+e[19]/100+")"),(!W||65536&n[0])&&A(M,"name",e[16]),(!W||1&n[0])&&(M.value=e[0]),(!W||256&n[0])&&(M.required=e[8]),(!W||16&n[0])&&A(M,"min",e[4]),(!W||4&n[0])&&A(M,"max",e[2]),(!W||64&n[0])&&A(M,"step",e[6]),1024&n[0]&&O(f,"bx--slider--disabled",e[10]),(!W||12&n[0])&&K!==(K=(e[3]||e[2])+"")&&L(R,K),(!W||4608&n[0]&&$!==($=e[12]?"hidden":e[9]))&&A(F,"type",$),(!W||4096&n[0]&&j!==(j=e[12]?"display: none":void 0))&&A(F,"style",j),(!W||8192&n[0]&&N!==(N="input-"+e[13]))&&A(F,"id",N),(!W||65536&n[0])&&A(F,"name",e[16]),(!W||1&n[0]&&F.value!==e[0])&&(F.value=e[0]),(!W||68157440&n[0]&&U!==(U=e[26]["aria-label"]?void 0:e[20]))&&A(F,"aria-labelledby",U),(!W||67108864&n[0]&&V!==(V=e[26]["aria-label"]||"Slider number input"))&&A(F,"aria-label",V),(!W||1024&n[0])&&(F.disabled=e[10]),(!W||256&n[0])&&(F.required=e[8]),(!W||16&n[0])&&A(F,"min",e[4]),(!W||4&n[0])&&A(F,"max",e[2]),(!W||64&n[0])&&A(F,"step",e[6]),(!W||16384&n[0]&&G!==(G=e[14]||null))&&A(F,"data-invalid",G),(!W||16384&n[0]&&q!==(q=e[14]||null))&&A(F,"aria-invalid",q),2048&n[0]&&O(F,"bx--text-input--light",e[11]),16384&n[0]&&O(F,"bx--text-input--invalid",e[14]),z(t,te=de(ee,[33554432&n[0]&&e[25]])),O(t,"bx--form-item",!0)},i(e){W||(ae(Q,e),W=!0)},o(e){le(Q,e),W=!1},d(i){i&&x(t),Q&&Q.d(i),e[35](null),e[36](null),H=!1,s(Z)}}}function ia(e,t,i){let r,o,s;const a=["value","max","maxLabel","min","minLabel","step","stepMultiplier","required","inputType","disabled","light","hideTextInput","id","invalid","labelText","name","ref"];let l=m(t,a),{$$slots:c={},$$scope:u}=t,{value:h=0}=t,{max:d=100}=t,{maxLabel:p=""}=t,{min:g=0}=t,{minLabel:y=""}=t,{step:_=1}=t,{stepMultiplier:v=4}=t,{required:x=!1}=t,{inputType:b="number"}=t,{disabled:w=!1}=t,{light:T=!1}=t,{hideTextInput:k=!1}=t,{id:S="ccs-"+Math.random().toString(36)}=t,{invalid:C=!1}=t,{labelText:E=""}=t,{name:M=""}=t,{ref:A=null}=t;const z=j();let I=null,L=!1,D=!1;function P(){i(27,L=!0)}return e.$$set=e=>{i(26,t=n(n({},t),f(e))),i(25,l=m(t,a)),"value"in e&&i(0,h=e.value),"max"in e&&i(2,d=e.max),"maxLabel"in e&&i(3,p=e.maxLabel),"min"in e&&i(4,g=e.min),"minLabel"in e&&i(5,y=e.minLabel),"step"in e&&i(6,_=e.step),"stepMultiplier"in e&&i(7,v=e.stepMultiplier),"required"in e&&i(8,x=e.required),"inputType"in e&&i(9,b=e.inputType),"disabled"in e&&i(10,w=e.disabled),"light"in e&&i(11,T=e.light),"hideTextInput"in e&&i(12,k=e.hideTextInput),"id"in e&&i(13,S=e.id),"invalid"in e&&i(14,C=e.invalid),"labelText"in e&&i(15,E=e.labelText),"name"in e&&i(16,M=e.name),"ref"in e&&i(1,A=e.ref),"$$scope"in e&&i(29,u=e.$$scope)},e.$$.update=()=>{8192&e.$$.dirty[0]&&i(20,r=`label-${S}`),20&e.$$.dirty[0]&&i(17,o=d-g),402654229&e.$$.dirty[0]&&(h<=g?i(0,h=g):h>=d&&i(0,h=d),L&&(!function(e){if(w)return;const t=e.touches?e.touches[0].clientX:e.clientX,{left:n,width:r}=I.getBoundingClientRect();let o=g+Math.round((t-n)/r*(d-g)/_)*_;o<=g?o=g:o>=d&&(o=d),i(0,h=o)}(event),i(27,L=!1)),D||w||z("change",h)),131089&e.$$.dirty[0]&&i(19,s=(h-g)/o*100)},t=f(t),[h,A,d,p,g,y,_,v,x,b,w,T,k,S,C,E,M,o,I,s,r,P,function(){i(28,D=!0)},function(){i(28,D=!1),i(27,L=!1)},function(){D&&P()},l,t,L,D,u,c,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{I=e,i(18,I)}))},function(e){G[e?"unshift":"push"]((()=>{A=e,i(1,A)}))},({shiftKey:e,key:t})=>{const n={ArrowDown:-1,ArrowLeft:-1,ArrowRight:1,ArrowUp:1};n[t]&&i(0,h+=_*(e?o/_/v:1)*n[t])},({target:e})=>{i(0,h=Number(e.value))}]}var na=class extends ve{constructor(e){super(),_e(this,e,ia,ta,l,{value:0,max:2,maxLabel:3,min:4,minLabel:5,step:6,stepMultiplier:7,required:8,inputType:9,disabled:10,light:11,hideTextInput:12,id:13,invalid:14,labelText:15,name:16,ref:1},null,[-1,-1])}};const ra=e=>({}),oa=e=>({}),sa=e=>({}),aa=e=>({});function la(e){let t,i,n,r=e[9]&&ca(e),o=!e[20]&&e[6]&&ua(e);return{c(){t=w("div"),r&&r.c(),i=S(),o&&o.c(),O(t,"bx--text-input__label-helper-wrapper",!0)},m(e,s){v(e,t,s),r&&r.m(t,null),_(t,i),o&&o.m(t,null),n=!0},p(e,n){e[9]?r?(r.p(e,n),512&n[0]&&ae(r,1)):(r=ca(e),r.c(),ae(r,1),r.m(t,i)):r&&(oe(),le(r,1,1,(()=>{r=null})),se()),!e[20]&&e[6]?o?o.p(e,n):(o=ua(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},i(e){n||(ae(r),n=!0)},o(e){le(r),n=!1},d(e){e&&x(t),r&&r.d(),o&&o.d()}}}function ca(e){let t,i,n;const r=e[26].labelText,o=c(r,e,e[25],aa),s=o||function(e){let t;return{c(){t=k(e[9])},m(e,i){v(e,t,i)},p(e,i){512&i[0]&&L(t,e[9])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),s&&s.c(),A(t,"for",e[7]),A(t,"class",i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`),O(t,"bx--label",!0),O(t,"bx--visually-hidden",e[10]),O(t,"bx--label--disabled",e[5]),O(t,"bx--label--inline",e[16])},m(e,i){v(e,t,i),s&&s.m(t,null),n=!0},p(e,a){o?o.p&&(!n||33554432&a[0])&&d(o,r,e,e[25],n?h(r,e[25],a,sa):p(e[25]),aa):s&&s.p&&(!n||512&a[0])&&s.p(e,n?a:[-1,-1]),(!n||128&a[0])&&A(t,"for",e[7]),(!n||65540&a[0]&&i!==(i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`))&&A(t,"class",i),65540&a[0]&&O(t,"bx--label",!0),66564&a[0]&&O(t,"bx--visually-hidden",e[10]),65572&a[0]&&O(t,"bx--label--disabled",e[5]),65540&a[0]&&O(t,"bx--label--inline",e[16])},i(e){n||(ae(s,e),n=!0)},o(e){le(s,e),n=!1},d(e){e&&x(t),s&&s.d(e)}}}function ua(e){let t,i;return{c(){t=w("div"),i=k(e[6]),O(t,"bx--form__helper-text",!0),O(t,"bx--form__helper-text--disabled",e[5]),O(t,"bx--form__helper-text--inline",e[16])},m(e,n){v(e,t,n),_(t,i)},p(e,n){64&n[0]&&L(i,e[6]),32&n[0]&&O(t,"bx--form__helper-text--disabled",e[5]),65536&n[0]&&O(t,"bx--form__helper-text--inline",e[16])},d(e){e&&x(t)}}}function ha(e){let t,i,n;const r=e[26].labelText,o=c(r,e,e[25],oa),s=o||function(e){let t;return{c(){t=k(e[9])},m(e,i){v(e,t,i)},p(e,i){512&i[0]&&L(t,e[9])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),s&&s.c(),A(t,"for",e[7]),A(t,"class",i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`),O(t,"bx--label",!0),O(t,"bx--visually-hidden",e[10]),O(t,"bx--label--disabled",e[5]),O(t,"bx--label--inline",e[16])},m(e,i){v(e,t,i),s&&s.m(t,null),n=!0},p(e,a){o?o.p&&(!n||33554432&a[0])&&d(o,r,e,e[25],n?h(r,e[25],a,ra):p(e[25]),oa):s&&s.p&&(!n||512&a[0])&&s.p(e,n?a:[-1,-1]),(!n||128&a[0])&&A(t,"for",e[7]),(!n||65540&a[0]&&i!==(i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`))&&A(t,"class",i),65540&a[0]&&O(t,"bx--label",!0),66564&a[0]&&O(t,"bx--visually-hidden",e[10]),65572&a[0]&&O(t,"bx--label--disabled",e[5]),65540&a[0]&&O(t,"bx--label--inline",e[16])},i(e){n||(ae(s,e),n=!0)},o(e){le(s,e),n=!1},d(e){e&&x(t),s&&s.d(e)}}}function da(e){let t,i;return t=new yo({props:{class:"bx--text-input__invalid-icon"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function pa(e){let t,i;return t=new bo({props:{class:"bx--text-input__invalid-icon\n            bx--text-input__invalid-icon--warning"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function fa(e){let t,i;return t=new Fs({props:{class:"bx--text-input__readonly-icon"}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function ma(e){let t;return{c(){t=w("hr"),O(t,"bx--text-input__divider",!0)},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function ga(e){let t,i;return{c(){t=w("div"),i=k(e[12]),A(t,"id",e[19]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){4096&n[0]&&L(i,e[12]),524288&n[0]&&A(t,"id",e[19])},d(e){e&&x(t)}}}function ya(e){let t,i;return{c(){t=w("div"),i=k(e[14]),A(t,"id",e[18]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){16384&n[0]&&L(i,e[14]),262144&n[0]&&A(t,"id",e[18])},d(e){e&&x(t)}}}function _a(e){let t,i;return{c(){t=w("div"),i=k(e[6]),O(t,"bx--form__helper-text",!0),O(t,"bx--form__helper-text--disabled",e[5]),O(t,"bx--form__helper-text--inline",e[16])},m(e,n){v(e,t,n),_(t,i)},p(e,n){64&n[0]&&L(i,e[6]),32&n[0]&&O(t,"bx--form__helper-text--disabled",e[5]),65536&n[0]&&O(t,"bx--form__helper-text--inline",e[16])},d(e){e&&x(t)}}}function va(e){let t,i;return{c(){t=w("div"),i=k(e[12]),A(t,"id",e[19]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){4096&n[0]&&L(i,e[12]),524288&n[0]&&A(t,"id",e[19])},d(e){e&&x(t)}}}function xa(e){let t,i;return{c(){t=w("div"),i=k(e[14]),A(t,"id",e[18]),O(t,"bx--form-requirement",!0)},m(e,n){v(e,t,n),_(t,i)},p(e,n){16384&n[0]&&L(i,e[14]),262144&n[0]&&A(t,"id",e[18])},d(e){e&&x(t)}}}function ba(e){let t,i,r,o,a,l,c,u,h,d,p,f,m,g,y,b,T,k,C,M,I,L,P,R,B,F=e[16]&&la(e),$=!e[16]&&(e[9]||e[24].labelText)&&ha(e),j=e[11]&&da(),N=!e[11]&&e[13]&&pa(),U=e[17]&&fa(),V=[{"data-invalid":d=e[11]||void 0},{"aria-invalid":p=e[11]||void 0},{"data-warn":f=e[13]||void 0},{"aria-describedby":m=e[11]?e[19]:e[13]?e[18]:void 0},{disabled:e[5]},{id:e[7]},{name:e[8]},{placeholder:e[3]},{required:e[15]},{readOnly:e[17]},e[23],{class:g=e[2]&&`bx--text-input--${e[2]}`}],G={};for(let e=0;e<V.length;e+=1)G=n(G,V[e]);let q=e[20]&&ma(),W=e[20]&&!e[16]&&e[11]&&ga(e),H=e[20]&&!e[16]&&e[13]&&ya(e),Z=!e[11]&&!e[13]&&!e[20]&&!e[16]&&e[6]&&_a(e),X=!e[20]&&e[11]&&va(e),K=!e[20]&&!e[11]&&e[13]&&xa(e);return{c(){t=w("div"),F&&F.c(),i=S(),$&&$.c(),r=S(),o=w("div"),a=w("div"),j&&j.c(),l=S(),N&&N.c(),c=S(),U&&U.c(),u=S(),h=w("input"),y=S(),q&&q.c(),b=S(),W&&W.c(),T=S(),H&&H.c(),M=S(),Z&&Z.c(),I=S(),X&&X.c(),L=S(),K&&K.c(),z(h,G),O(h,"bx--text-input",!0),O(h,"bx--text-input--light",e[4]),O(h,"bx--text-input--invalid",e[11]),O(h,"bx--text-input--warn",e[13]),A(a,"data-invalid",k=e[11]||void 0),A(a,"data-warn",C=e[13]||void 0),O(a,"bx--text-input__field-wrapper",!0),O(a,"bx--text-input__field-wrapper--warning",!e[11]&&e[13]),O(o,"bx--text-input__field-outer-wrapper",!0),O(o,"bx--text-input__field-outer-wrapper--inline",e[16]),O(t,"bx--form-item",!0),O(t,"bx--text-input-wrapper",!0),O(t,"bx--text-input-wrapper--inline",e[16]),O(t,"bx--text-input-wrapper--light",e[4]),O(t,"bx--text-input-wrapper--readonly",e[17])},m(n,s){v(n,t,s),F&&F.m(t,null),_(t,i),$&&$.m(t,null),_(t,r),_(t,o),_(o,a),j&&j.m(a,null),_(a,l),N&&N.m(a,null),_(a,c),U&&U.m(a,null),_(a,u),_(a,h),h.autofocus&&h.focus(),e[35](h),D(h,e[0]),_(a,y),q&&q.m(a,null),_(a,b),W&&W.m(a,null),_(a,T),H&&H.m(a,null),_(o,M),Z&&Z.m(o,null),_(o,I),X&&X.m(o,null),_(o,L),K&&K.m(o,null),P=!0,R||(B=[E(h,"input",e[36]),E(h,"change",e[22]),E(h,"input",e[21]),E(h,"keydown",e[31]),E(h,"keyup",e[32]),E(h,"focus",e[33]),E(h,"blur",e[34]),E(t,"click",e[27]),E(t,"mouseover",e[28]),E(t,"mouseenter",e[29]),E(t,"mouseleave",e[30])],R=!0)},p(e,n){e[16]?F?(F.p(e,n),65536&n[0]&&ae(F,1)):(F=la(e),F.c(),ae(F,1),F.m(t,i)):F&&(oe(),le(F,1,1,(()=>{F=null})),se()),e[16]||!e[9]&&!e[24].labelText?$&&(oe(),le($,1,1,(()=>{$=null})),se()):$?($.p(e,n),16843264&n[0]&&ae($,1)):($=ha(e),$.c(),ae($,1),$.m(t,r)),e[11]?j?2048&n[0]&&ae(j,1):(j=da(),j.c(),ae(j,1),j.m(a,l)):j&&(oe(),le(j,1,1,(()=>{j=null})),se()),!e[11]&&e[13]?N?10240&n[0]&&ae(N,1):(N=pa(),N.c(),ae(N,1),N.m(a,c)):N&&(oe(),le(N,1,1,(()=>{N=null})),se()),e[17]?U?131072&n[0]&&ae(U,1):(U=fa(),U.c(),ae(U,1),U.m(a,u)):U&&(oe(),le(U,1,1,(()=>{U=null})),se()),z(h,G=de(V,[(!P||2048&n[0]&&d!==(d=e[11]||void 0))&&{"data-invalid":d},(!P||2048&n[0]&&p!==(p=e[11]||void 0))&&{"aria-invalid":p},(!P||8192&n[0]&&f!==(f=e[13]||void 0))&&{"data-warn":f},(!P||796672&n[0]&&m!==(m=e[11]?e[19]:e[13]?e[18]:void 0))&&{"aria-describedby":m},(!P||32&n[0])&&{disabled:e[5]},(!P||128&n[0])&&{id:e[7]},(!P||256&n[0])&&{name:e[8]},(!P||8&n[0])&&{placeholder:e[3]},(!P||32768&n[0])&&{required:e[15]},(!P||131072&n[0])&&{readOnly:e[17]},8388608&n[0]&&e[23],(!P||4&n[0]&&g!==(g=e[2]&&`bx--text-input--${e[2]}`))&&{class:g}])),1&n[0]&&h.value!==e[0]&&D(h,e[0]),O(h,"bx--text-input",!0),O(h,"bx--text-input--light",e[4]),O(h,"bx--text-input--invalid",e[11]),O(h,"bx--text-input--warn",e[13]),e[20]?q||(q=ma(),q.c(),q.m(a,b)):q&&(q.d(1),q=null),e[20]&&!e[16]&&e[11]?W?W.p(e,n):(W=ga(e),W.c(),W.m(a,T)):W&&(W.d(1),W=null),e[20]&&!e[16]&&e[13]?H?H.p(e,n):(H=ya(e),H.c(),H.m(a,null)):H&&(H.d(1),H=null),(!P||2048&n[0]&&k!==(k=e[11]||void 0))&&A(a,"data-invalid",k),(!P||8192&n[0]&&C!==(C=e[13]||void 0))&&A(a,"data-warn",C),10240&n[0]&&O(a,"bx--text-input__field-wrapper--warning",!e[11]&&e[13]),e[11]||e[13]||e[20]||e[16]||!e[6]?Z&&(Z.d(1),Z=null):Z?Z.p(e,n):(Z=_a(e),Z.c(),Z.m(o,I)),!e[20]&&e[11]?X?X.p(e,n):(X=va(e),X.c(),X.m(o,L)):X&&(X.d(1),X=null),e[20]||e[11]||!e[13]?K&&(K.d(1),K=null):K?K.p(e,n):(K=xa(e),K.c(),K.m(o,null)),65536&n[0]&&O(o,"bx--text-input__field-outer-wrapper--inline",e[16]),65536&n[0]&&O(t,"bx--text-input-wrapper--inline",e[16]),16&n[0]&&O(t,"bx--text-input-wrapper--light",e[4]),131072&n[0]&&O(t,"bx--text-input-wrapper--readonly",e[17])},i(e){P||(ae(F),ae($),ae(j),ae(N),ae(U),P=!0)},o(e){le(F),le($),le(j),le(N),le(U),P=!1},d(i){i&&x(t),F&&F.d(),$&&$.d(),j&&j.d(),N&&N.d(),U&&U.d(),e[35](null),q&&q.d(),W&&W.d(),H&&H.d(),Z&&Z.d(),X&&X.d(),K&&K.d(),R=!1,s(B)}}}function wa(e,t,i){let r,o,s;const a=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let l=m(t,a),{$$slots:c={},$$scope:u}=t;const h=g(c);let{size:d}=t,{value:p=""}=t,{placeholder:y=""}=t,{light:_=!1}=t,{disabled:v=!1}=t,{helperText:x=""}=t,{id:b="ccs-"+Math.random().toString(36)}=t,{name:w}=t,{labelText:T=""}=t,{hideLabel:k=!1}=t,{invalid:S=!1}=t,{invalidText:C=""}=t,{warn:E=!1}=t,{warnText:M=""}=t,{ref:A=null}=t,{required:z=!1}=t,{inline:I=!1}=t,{readonly:L=!1}=t;const D=N("Form"),P=j();function O(e){return"number"!==l.type?e:""!=e?Number(e):null}return e.$$set=e=>{t=n(n({},t),f(e)),i(23,l=m(t,a)),"size"in e&&i(2,d=e.size),"value"in e&&i(0,p=e.value),"placeholder"in e&&i(3,y=e.placeholder),"light"in e&&i(4,_=e.light),"disabled"in e&&i(5,v=e.disabled),"helperText"in e&&i(6,x=e.helperText),"id"in e&&i(7,b=e.id),"name"in e&&i(8,w=e.name),"labelText"in e&&i(9,T=e.labelText),"hideLabel"in e&&i(10,k=e.hideLabel),"invalid"in e&&i(11,S=e.invalid),"invalidText"in e&&i(12,C=e.invalidText),"warn"in e&&i(13,E=e.warn),"warnText"in e&&i(14,M=e.warnText),"ref"in e&&i(1,A=e.ref),"required"in e&&i(15,z=e.required),"inline"in e&&i(16,I=e.inline),"readonly"in e&&i(17,L=e.readonly),"$$scope"in e&&i(25,u=e.$$scope)},e.$$.update=()=>{128&e.$$.dirty[0]&&i(19,o=`error-${b}`),128&e.$$.dirty[0]&&i(18,s=`warn-${b}`)},i(20,r=!!D&&D.isFluid),[p,A,d,y,_,v,x,b,w,T,k,S,C,E,M,z,I,L,s,o,r,e=>{i(0,p=O(e.target.value)),P("input",p)},e=>{P("change",O(e.target.value))},l,h,u,c,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{A=e,i(1,A)}))},function(){p=this.value,i(0,p)}]}var Ta=class extends ve{constructor(e){super(),_e(this,e,wa,ba,l,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}};const ka=e=>({}),Sa=e=>({}),Ca=e=>({}),Ea=e=>({}),Ma=e=>({}),Aa=e=>({});function za(e){let t,i,r,o,a,l,u,f,m,g,y,b,T;const C=e[11].labelText,M=c(C,e,e[10],Aa),I=M||function(e){let t;return{c(){t=k(e[5])},m(e,i){v(e,t,i)},p(e,i){32&i&&L(t,e[5])},d(e){e&&x(t)}}}(e),D=e[11].labelA,P=c(D,e,e[10],Ea),R=P||function(e){let t;return{c(){t=k(e[3])},m(e,i){v(e,t,i)},p(e,i){8&i&&L(t,e[3])},d(e){e&&x(t)}}}(e),B=e[11].labelB,F=c(B,e,e[10],Sa),$=F||function(e){let t;return{c(){t=k(e[4])},m(e,i){v(e,t,i)},p(e,i){16&i&&L(t,e[4])},d(e){e&&x(t)}}}(e);let j=[e[8]],N={};for(let e=0;e<j.length;e+=1)N=n(N,j[e]);return{c(){t=w("div"),i=w("input"),r=S(),o=w("label"),I&&I.c(),a=S(),l=w("span"),u=w("span"),R&&R.c(),f=S(),m=w("span"),$&&$.c(),A(i,"type","checkbox"),i.checked=e[0],i.disabled=e[2],A(i,"id",e[6]),A(i,"name",e[7]),O(i,"bx--toggle-input",!0),O(i,"bx--toggle-input--small","sm"===e[1]),A(u,"aria-hidden","true"),O(u,"bx--toggle__text--off",!0),A(m,"aria-hidden","true"),O(m,"bx--toggle__text--on",!0),O(l,"bx--toggle__switch",!0),A(o,"aria-label",g=e[5]?void 0:e[9]["aria-label"]||"Toggle"),A(o,"for",e[6]),O(o,"bx--toggle-input__label",!0),z(t,N),O(t,"bx--form-item",!0)},m(n,s){v(n,t,s),_(t,i),_(t,r),_(t,o),I&&I.m(o,null),_(o,a),_(o,l),_(l,u),R&&R.m(u,null),_(l,f),_(l,m),$&&$.m(m,null),y=!0,b||(T=[E(i,"change",e[16]),E(i,"change",e[20]),E(i,"keyup",e[17]),E(i,"keyup",e[21]),E(i,"focus",e[18]),E(i,"blur",e[19]),E(t,"click",e[12]),E(t,"mouseover",e[13]),E(t,"mouseenter",e[14]),E(t,"mouseleave",e[15])],b=!0)},p(e,[n]){(!y||1&n)&&(i.checked=e[0]),(!y||4&n)&&(i.disabled=e[2]),(!y||64&n)&&A(i,"id",e[6]),(!y||128&n)&&A(i,"name",e[7]),2&n&&O(i,"bx--toggle-input--small","sm"===e[1]),M?M.p&&(!y||1024&n)&&d(M,C,e,e[10],y?h(C,e[10],n,Ma):p(e[10]),Aa):I&&I.p&&(!y||32&n)&&I.p(e,y?n:-1),P?P.p&&(!y||1024&n)&&d(P,D,e,e[10],y?h(D,e[10],n,Ca):p(e[10]),Ea):R&&R.p&&(!y||8&n)&&R.p(e,y?n:-1),F?F.p&&(!y||1024&n)&&d(F,B,e,e[10],y?h(B,e[10],n,ka):p(e[10]),Sa):$&&$.p&&(!y||16&n)&&$.p(e,y?n:-1),(!y||544&n&&g!==(g=e[5]?void 0:e[9]["aria-label"]||"Toggle"))&&A(o,"aria-label",g),(!y||64&n)&&A(o,"for",e[6]),z(t,N=de(j,[256&n&&e[8]])),O(t,"bx--form-item",!0)},i(e){y||(ae(I,e),ae(R,e),ae($,e),y=!0)},o(e){le(I,e),le(R,e),le($,e),y=!1},d(e){e&&x(t),I&&I.d(e),R&&R.d(e),$&&$.d(e),b=!1,s(T)}}}function Ia(e,t,i){const r=["size","toggled","disabled","labelA","labelB","labelText","id","name"];let o=m(t,r),{$$slots:s={},$$scope:a}=t,{size:l="default"}=t,{toggled:c=!1}=t,{disabled:u=!1}=t,{labelA:h="Off"}=t,{labelB:d="On"}=t,{labelText:p=""}=t,{id:g="ccs-"+Math.random().toString(36)}=t,{name:y}=t;const _=j();return e.$$set=e=>{i(9,t=n(n({},t),f(e))),i(8,o=m(t,r)),"size"in e&&i(1,l=e.size),"toggled"in e&&i(0,c=e.toggled),"disabled"in e&&i(2,u=e.disabled),"labelA"in e&&i(3,h=e.labelA),"labelB"in e&&i(4,d=e.labelB),"labelText"in e&&i(5,p=e.labelText),"id"in e&&i(6,g=e.id),"name"in e&&i(7,y=e.name),"$$scope"in e&&i(10,a=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&_("toggle",{toggled:c})},t=f(t),[c,l,u,h,d,p,g,y,o,t,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},()=>{i(0,c=!c)},e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),i(0,c=!c))}]}var La=class extends ve{constructor(e){super(),_e(this,e,Ia,za,l,{size:1,toggled:0,disabled:2,labelA:3,labelB:4,labelText:5,id:6,name:7})}},Da={prefix:"fas",iconName:"check",icon:[448,512,[10004,10003],"f00c","M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"]},Pa={prefix:"fas",iconName:"pencil",icon:[512,512,[61504,9999,"pencil-alt"],"f303","M421.7 220.3L188.5 453.4L154.6 419.5L158.1 416H112C103.2 416 96 408.8 96 400V353.9L92.51 357.4C87.78 362.2 84.31 368 82.42 374.4L59.44 452.6L137.6 429.6C143.1 427.7 149.8 424.2 154.6 419.5L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3zM492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75z"]},Oa={prefix:"fas",iconName:"plus",icon:[448,512,[10133,61543,"add"],"2b","M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"]},Ra={prefix:"fas",iconName:"trash",icon:[448,512,[],"f1f8","M135.2 17.69C140.6 6.848 151.7 0 163.8 0H284.2C296.3 0 307.4 6.848 312.8 17.69L320 32H416C433.7 32 448 46.33 448 64C448 81.67 433.7 96 416 96H32C14.33 96 0 81.67 0 64C0 46.33 14.33 32 32 32H128L135.2 17.69zM394.8 466.1C393.2 492.3 372.3 512 346.9 512H101.1C75.75 512 54.77 492.3 53.19 466.1L31.1 128H416L394.8 466.1z"]},Ba={prefix:"fas",iconName:"xmark",icon:[320,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"]};
/*!
 * Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2022 Fonticons, Inc.
 */const Fa=parseFloat;function $a(e,t=";"){let i;if(Array.isArray(e))i=e.filter((e=>e));else{i=[];for(const t in e)e[t]&&i.push(`${t}:${e[t]}`)}return i.join(t)}function ja(e){let t,i,n,r,o,s,a;function l(e,t){return"string"==typeof e[7][4]?Ua:Na}let c=l(e),u=c(e);return{c(){t=T("svg"),i=T("g"),n=T("g"),u.c(),A(n,"transform",e[10]),A(i,"transform",r=`translate(${e[7][0]/2} ${e[7][1]/2})`),A(i,"transform-origin",o=e[7][0]/4+" 0"),A(t,"id",e[0]),A(t,"class",s=y(e[8])+" svelte-1cj2gr0"),A(t,"style",e[9]),A(t,"viewBox",a=`0 0 ${e[7][0]} ${e[7][1]}`),A(t,"aria-hidden","true"),A(t,"role","img"),A(t,"xmlns","http://www.w3.org/2000/svg")},m(e,r){v(e,t,r),_(t,i),_(i,n),u.m(n,null)},p(e,h){c===(c=l(e))&&u?u.p(e,h):(u.d(1),u=c(e),u&&(u.c(),u.m(n,null))),1024&h&&A(n,"transform",e[10]),128&h&&r!==(r=`translate(${e[7][0]/2} ${e[7][1]/2})`)&&A(i,"transform",r),128&h&&o!==(o=e[7][0]/4+" 0")&&A(i,"transform-origin",o),1&h&&A(t,"id",e[0]),256&h&&s!==(s=y(e[8])+" svelte-1cj2gr0")&&A(t,"class",s),512&h&&A(t,"style",e[9]),128&h&&a!==(a=`0 0 ${e[7][0]} ${e[7][1]}`)&&A(t,"viewBox",a)},d(e){e&&x(t),u.d()}}}function Na(e){let t,i,n,r,o,s,a,l,c,u;return{c(){t=T("path"),s=T("path"),A(t,"d",i=e[7][4][0]),A(t,"fill",n=e[3]||e[1]||"currentColor"),A(t,"fill-opacity",r=0!=e[6]?e[4]:e[5]),A(t,"transform",o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`),A(s,"d",a=e[7][4][1]),A(s,"fill",l=e[2]||e[1]||"currentColor"),A(s,"fill-opacity",c=0!=e[6]?e[5]:e[4]),A(s,"transform",u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){v(e,t,i),v(e,s,i)},p(e,h){128&h&&i!==(i=e[7][4][0])&&A(t,"d",i),10&h&&n!==(n=e[3]||e[1]||"currentColor")&&A(t,"fill",n),112&h&&r!==(r=0!=e[6]?e[4]:e[5])&&A(t,"fill-opacity",r),128&h&&o!==(o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(t,"transform",o),128&h&&a!==(a=e[7][4][1])&&A(s,"d",a),6&h&&l!==(l=e[2]||e[1]||"currentColor")&&A(s,"fill",l),112&h&&c!==(c=0!=e[6]?e[5]:e[4])&&A(s,"fill-opacity",c),128&h&&u!==(u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(s,"transform",u)},d(e){e&&x(t),e&&x(s)}}}function Ua(e){let t,i,n,r;return{c(){t=T("path"),A(t,"d",i=e[7][4]),A(t,"fill",n=e[1]||e[2]||"currentColor"),A(t,"transform",r=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){v(e,t,i)},p(e,o){128&o&&i!==(i=e[7][4])&&A(t,"d",i),6&o&&n!==(n=e[1]||e[2]||"currentColor")&&A(t,"fill",n),128&o&&r!==(r=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(t,"transform",r)},d(e){e&&x(t)}}}function Va(e){let t,n=e[7][4]&&ja(e);return{c(){n&&n.c(),t=C()},m(e,i){n&&n.m(e,i),v(e,t,i)},p(e,[i]){e[7][4]?n?n.p(e,i):(n=ja(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:i,o:i,d(e){n&&n.d(e),e&&x(t)}}}function Ga(e,t,i){let n,r,o,s,{class:a=""}=t,{id:l=""}=t,{style:c=""}=t,{icon:u}=t,{size:h=""}=t,{color:d=""}=t,{fw:p=!1}=t,{pull:f=""}=t,{scale:m=1}=t,{translateX:g=0}=t,{translateY:y=0}=t,{rotate:_=""}=t,{flip:v=!1}=t,{spin:x=!1}=t,{pulse:b=!1}=t,{primaryColor:w=""}=t,{secondaryColor:T=""}=t,{primaryOpacity:k=1}=t,{secondaryOpacity:S=.4}=t,{swapOpacity:C=!1}=t;return e.$$set=e=>{"class"in e&&i(11,a=e.class),"id"in e&&i(0,l=e.id),"style"in e&&i(12,c=e.style),"icon"in e&&i(13,u=e.icon),"size"in e&&i(14,h=e.size),"color"in e&&i(1,d=e.color),"fw"in e&&i(15,p=e.fw),"pull"in e&&i(16,f=e.pull),"scale"in e&&i(17,m=e.scale),"translateX"in e&&i(18,g=e.translateX),"translateY"in e&&i(19,y=e.translateY),"rotate"in e&&i(20,_=e.rotate),"flip"in e&&i(21,v=e.flip),"spin"in e&&i(22,x=e.spin),"pulse"in e&&i(23,b=e.pulse),"primaryColor"in e&&i(2,w=e.primaryColor),"secondaryColor"in e&&i(3,T=e.secondaryColor),"primaryOpacity"in e&&i(4,k=e.primaryOpacity),"secondaryOpacity"in e&&i(5,S=e.secondaryOpacity),"swapOpacity"in e&&i(6,C=e.swapOpacity)},e.$$.update=()=>{8192&e.$$.dirty&&i(7,n=u&&u.icon||[0,0,"",[],""]),12584960&e.$$.dirty&&i(8,r=$a([a,"svelte-fa",x&&"spin",b&&"pulse"]," ")),118784&e.$$.dirty&&i(9,o=function(e,t,i,n){let r,o,s,a,l,c="-.125em";return n&&(l="center",o="1.25em"),i&&(r=i),t&&("lg"==t?(a="1.33333em",s=".75em",c="-.225em"):a="xs"==t?".75em":"sm"==t?".875em":t.replace("x","em")),$a([$a({float:r,width:o,height:"1em","line-height":s,"font-size":a,"text-align":l,"vertical-align":c,"transform-origin":"center",overflow:"visible"}),e])}(c,h,f,p)),4063232&e.$$.dirty&&i(10,s=function(e,t,i,n,r,o,s="",a=""){let l=1,c=1;return r&&("horizontal"==r?l=-1:"vertical"==r?c=-1:l=c=-1),$a([`translate(${Fa(t)*o}${s},${Fa(i)*o}${s})`,`scale(${l*Fa(e)},${c*Fa(e)})`,n&&`rotate(${n}${a})`]," ")}(m,g,y,_,v,512))},[l,d,w,T,k,S,C,n,r,o,s,a,c,u,h,p,f,m,g,y,_,v,x,b]}var qa=class extends ve{constructor(e){super(),_e(this,e,Ga,Va,l,{class:11,id:0,style:12,icon:13,size:14,color:1,fw:15,pull:16,scale:17,translateX:18,translateY:19,rotate:20,flip:21,spin:22,pulse:23,primaryColor:2,secondaryColor:3,primaryOpacity:4,secondaryOpacity:5,swapOpacity:6})}},Wa={exports:{}},Ha=Wa.exports=function(){function e(t,i,n){function r(s,a){if(!i[s]){if(!t[s]){if(!a&&be)return be(s);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};t[s][0].call(c.exports,(function(e){return r(t[s][1][e]||e)}),c,c.exports,e,t,i,n)}return i[s].exports}for(var o=be,s=0;s<n.length;s++)r(n[s]);return r}return e}()({1:[function(e,t,i){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var o=e("nanoid").nanoid;r.prototype={select:function(e,t){var i=this.getSelectedIndex(e,t),n=this.getEventPayload("search.select",t);if(n.resultIndex=i,n.resultPlaceName=e.place_name,n.resultId=e.id,(i!==this.lastSentIndex||n.queryString!==this.lastSentInput)&&-1!=i&&(this.lastSentIndex=i,this.lastSentInput=n.queryString,n.queryString))return this.push(n)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)){var i=this.getEventPayload("search.keystroke",t);if(i.lastAction=e.key,i.queryString)return this.push(i)}},send:function(e,t){if(this.enableEventLogging){var i=this.getRequestOptions(e);this.request(i,function(e){return e?this.handleError(e,t):t?t():void 0}.bind(this))}else if(t)return t()},getRequestOptions:function(e){return Array.isArray(e)||(e=[e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},getEventPayload:function(e,t){var i;i=t.options.proximity?"object"===n(t.options.proximity)?[t.options.proximity.longitude,t.options.proximity.latitude]:"ip"===t.options.proximity?[999,999]:t.options.proximity:null;var r=t._map?t._map.getZoom():void 0,o={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:i,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:r,keyboardLocale:this.locale};return"search.select"===e?o.queryString=t.inputString:"search.select"!=e&&t._inputEl?o.queryString=t._inputEl.value:o.queryString=t.inputString,o},request:function(e,t){var i=new XMLHttpRequest;for(var n in i.onreadystatechange=function(){if(4==this.readyState)return t(204==this.status?null:this.statusText)},i.open(e.method,e.host+"/"+e.path,!0),e.headers){var r=e.headers[n];i.setRequestHeader(n,r)}i.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return o()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var i=t._typeahead.data,n=e.id;return i.map((function(e){return e.id})).indexOf(n)}},shouldEnableLogging:function(e){return!(!1===e.enableEventLogging||e.origin&&"https://api.mapbox.com"!==e.origin||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}},t.exports=r},{nanoid:32}],2:[function(e,t,i){t.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(e,t,i){function n(){}n.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){var e={enableHighAccuracy:!0};return new Promise((function(t,i){window.navigator.geolocation.getCurrentPosition(t,i,e)}))}},t.exports=n},{}],4:[function(e,t,i){function n(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function r(e){this._eventEmitter=new l,this.options=a({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new m}var o=e("suggestions"),s=e("lodash.debounce"),a=e("xtend"),l=e("events").EventEmitter,c=e("./exceptions"),u=e("@mapbox/mapbox-sdk"),h=e("@mapbox/mapbox-sdk/services/geocoding"),d=e("./events"),p=e("./localization"),f=e("subtag"),m=e("./geolocation"),g=e("./utils"),y={FORWARD:0,LOCAL:1,REVERSE:2};r.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(e,t){if(!document.body.contains(t))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var i=e.onAdd();t.appendChild(i)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else{if("string"!=typeof e)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");var i=document.querySelectorAll(e);if(0===i.length)throw new Error("Element ",e,"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,i[0])}},onAdd:function(e){if(e&&"string"!=typeof e&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new d(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(e){this.eventManager.keyevent(e,this)}.bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),t.appendChild(i),t.appendChild(this._inputEl),t.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var l=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(l),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var c=this._typeahead=new o(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),c.getItemValue=this.options.getItemValue;var p=c.list.draw,f=this._footerNode=n();return c.list.draw=function(){p.call(this),f.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),f.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(f)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();var t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;var i={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){var n=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(n),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(i).send().then(function(e){var i=e.body.features[0];if(i){var n=g.transformFeatureToGeolocationText(i,this.options.addressAccuracy);this._setInputValue(n),i.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:i})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){1===e.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=t,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){if(27===e.keyCode&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var t=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target;if(!t||!t.value)return this.fresh=!0,9!==e.keyCode&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),e.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(e.keyCode)||t.value.length>=this.options.minLength&&this._geocode(t.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&c[e.properties.short_code])t=a({},this.options.flyTo),this._map&&this._map.fitBounds(c[e.properties.short_code].bbox,t);else if(e.bbox){var i=e.bbox;t=a({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],t)}else{var n={zoom:this.options.zoom};t=a({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){return e.localGeocoderOnly?y.LOCAL:e.reverseGeocode&&g.REVERSE_GEOCODE_COORD_RGX.test(t)?y.REVERSE:y.FORWARD},_setupConfig:function(e,t){var i=/[\s,]+/,n=this,r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce((function(e,t){if(void 0===n.options[t]||null===n.options[t])return e;["countries","types","language"].indexOf(t)>-1?e[t]=n.options[t].split(i):e[t]=n.options[t];var r="number"==typeof n.options[t].longitude&&"number"==typeof n.options[t].latitude;if("proximity"===t&&r){var o=n.options[t].longitude,s=n.options[t].latitude;e[t]=[o,s]}return e}),{});switch(e){case y.REVERSE:var o=t.split(i).map((function(e){return parseFloat(e,10)}));n.options.flipCoordinates||o.reverse(),r.types&&r.types[0],r=a(r,{query:o,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach((function(e){e in r&&delete r[e]}));break;case y.FORWARD:/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(t.trim())&&(t=t.replace(/,/g," ")),r=a(r,{query:t})}return r},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});var t,i=this._requestType(this.options,e),n=this._setupConfig(i,e);switch(i){case y.LOCAL:t=Promise.resolve();break;case y.FORWARD:t=this.geocoderService.forwardGeocode(n).send();break;case y.REVERSE:t=this.geocoderService.reverseGeocode(n).send()}var r=this.options.localGeocoder&&this.options.localGeocoder(e)||[],o=[],s=null;return t.catch(function(e){s=e}.bind(this)).then(function(t){this._hideLoadingIcon();var i={};return t?"200"==t.statusCode&&((i=t.body).request=t.request,i.headers=t.headers):i={type:"FeatureCollection",features:[]},i.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),i.features=i.features?r.concat(i.features):r,this.options.externalGeocoder?(o=this.options.externalGeocoder(e,i.features)||Promise.resolve([])).then((function(e){return i.features=i.features?e.concat(i.features):e,i}),(function(){return i})):i}.bind(this)).then(function(e){if(s)throw s;this.options.filter&&e.features.length&&(e.features=e.features.filter(this.options.filter)),e.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",e),this._typeahead.update(e.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",e))}.bind(this)).catch(function(e){this._hideLoadingIcon(),this._hideAttribution(),r.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(r)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:r}),this._eventEmitter.emit("error",{error:e})}.bind(this)),t},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var i=t.features[0];this._typeahead.selected=i,this._inputEl.value=i.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=f.language(e),i=p.placeholder[t];if(i)return i}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&"function"==typeof e&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t=a({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(t),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}},t.exports=r},{"./events":1,"./exceptions":2,"./geolocation":3,"./localization":5,"./utils":6,"@mapbox/mapbox-sdk":8,"@mapbox/mapbox-sdk/services/geocoding":19,events:28,"lodash.debounce":31,subtag:35,suggestions:36,xtend:39}],5:[function(e,t,i){var n={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"};t.exports={placeholder:n}},{}],6:[function(e,t,i){function n(e,t){var i=r(e),n=["address","street","place","country"];if("function"==typeof t)return t(i);var o=n.indexOf(t);return(-1===o?n:n.slice(o)).reduce((function(e,t){return i[t]?(""!==e&&(e+=", "),e+i[t]):e}),"")}function r(e){var t=e.address||"",i=e.text||"",n=e.place_name||"",r={address:n.split(",")[0],houseNumber:t,street:i,placeName:n};return e.context.forEach((function(e){var t=e.id.split(".")[0];r[t]=e.text})),r}var o=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;t.exports={transformFeatureToGeolocationText:n,getAddressInfo:r,REVERSE_GEOCODE_COORD_RGX:o}},{}],7:[function(e,t,i){function n(e){var t=Array.isArray(e),i=function(i){return t?e[i]:e};return function(n){var o=r(m.plainArray,n);if(o)return o;if(t&&n.length!==e.length)return"an array with "+e.length+" items";for(var s=0;s<n.length;s++)if(o=r(i(s),n[s]))return[s].concat(o)}}function r(e,t){if(null!=t||e.hasOwnProperty("__required")){var i=e(t);return i?Array.isArray(i)?i:[i]:void 0}}function o(e,t){var i=e.length,n=e[i-1],r=e.slice(0,i-1);return 0===r.length&&(r=[f]),t=p(t,{path:r}),"function"==typeof n?n(t):c(t,a(n))}function s(e){return e.length<2?e[0]:2===e.length?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function a(e){return"must be "+l(e)+"."}function l(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function c(e,t){return(u(e.path)?"Item at position ":"")+e.path.join(".")+" "+t}function u(e){return"number"==typeof e[e.length-1]||"number"==typeof e[0]}function h(e){return Object.keys(e||{}).map((function(t){return{key:t,value:e[t]}}))}var d=e("is-plain-obj"),p=e("xtend"),f="value",m={assert:function(e,t){return t=t||{},function(i){var n=r(e,i);if(n){var s=o(n,t);throw t.apiName&&(s=t.apiName+": "+s),new Error(s)}}},shape:function(e){var t=h(e);return function(e){var i=r(m.plainObject,e);if(i)return i;for(var n,s=[],a=0;a<t.length;a++)n=t[a].key,(i=r(t[a].value,e[n]))&&s.push([n].concat(i));return s.length<2?s[0]:function(e){s=s.map((function(t){return"- "+t[0]+": "+o(t,e).split("\n").join("\n  ")}));var t=e.path.join(".");return"The following properties"+(t===f?"":" of "+t)+" have invalid values:\n  "+s.join("\n  ")}}},strictShape:function(e){var t=m.shape(e);return function(i){var n=t(i);if(n)return n;var r=Object.keys(i).reduce((function(t,i){return void 0===e[i]&&t.push(i),t}),[]);return 0!==r.length?function(){return"The following keys are invalid: "+r.join(", ")}:void 0}},arrayOf:function(e){return n(e)},tuple:function(){return n(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},required:function(e){function t(t){return null==t?function(e){return c(e,u(e.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return t.__required=!0,t},oneOfType:function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(t){var i=e.map((function(e){return r(e,t)})).filter(Boolean);if(i.length===e.length)return i.every((function(e){return 1===e.length&&"string"==typeof e[0]}))?s(i.map((function(e){return e[0]}))):i.reduce((function(e,t){return t.length>e.length?t:e}))}},equal:function(e){return function(t){if(t!==e)return JSON.stringify(e)}},oneOf:function(){var e=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map((function(e){return m.equal(e)}));return m.oneOfType.apply(this,e)},range:function(e){var t=e[0],i=e[1];return function(e){if(r(m.number,e)||e<t||e>i)return"number between "+t+" & "+i+" (inclusive)"}},any:function(){},boolean:function(e){if("boolean"!=typeof e)return"boolean"},number:function(e){if("number"!=typeof e)return"number"},plainArray:function(e){if(!Array.isArray(e))return"array"},plainObject:function(e){if(!d(e))return"object"},string:function(e){if("string"!=typeof e)return"string"},func:function(e){if("function"!=typeof e)return"function"}};m.validate=r,m.processMessage=o,t.exports=m},{"is-plain-obj":30,xtend:39}],8:[function(e,t,i){var n=e("./lib/client");t.exports=n},{"./lib/client":9}],9:[function(e,t,i){function n(e){s.call(this,e)}function r(e){return new n(e)}var o=e("./browser-layer"),s=e("../classes/mapi-client");n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype.sendRequest=o.browserSend,n.prototype.abortRequest=o.browserAbort,t.exports=r},{"../classes/mapi-client":11,"./browser-layer":10}],10:[function(e,t,i){function n(e){var t=p[e.id];t&&(t.abort(),delete p[e.id])}function r(e,t){return new c(e,{body:t.response,headers:d(t.getAllResponseHeaders()),statusCode:t.status})}function o(e){var t=e.total,i=e.loaded;return{total:t,transferred:i,percent:100*i/t}}function s(e,t){return new Promise((function(i,n){t.onprogress=function(t){e.emitter.emit(h.EVENT_PROGRESS_DOWNLOAD,o(t))};var r=e.file;r&&(t.upload.onprogress=function(t){e.emitter.emit(h.EVENT_PROGRESS_UPLOAD,o(t))}),t.onerror=function(e){n(e)},t.onabort=function(){var t=new u({request:e,type:h.ERROR_REQUEST_ABORTED});n(t)},t.onload=function(){if(delete p[e.id],t.status<200||t.status>=400){var r=new u({request:e,body:t.response,statusCode:t.status});n(r)}else i(t)};var s=e.body;"string"==typeof s?t.send(s):s?t.send(JSON.stringify(s)):r?t.send(r):t.send(),p[e.id]=t})).then((function(t){return r(e,t)}))}function a(e,t){var i=e.url(t),n=new window.XMLHttpRequest;return n.open(e.method,i),Object.keys(e.headers).forEach((function(t){n.setRequestHeader(t,e.headers[t])})),n}function l(e){return Promise.resolve().then((function(){var t=a(e,e.client.accessToken);return s(e,t)}))}var c=e("../classes/mapi-response"),u=e("../classes/mapi-error"),h=e("../constants"),d=e("../helpers/parse-headers"),p={};t.exports={browserAbort:n,sendRequestXhr:s,browserSend:l,createRequestXhr:a}},{"../classes/mapi-error":12,"../classes/mapi-response":14,"../constants":15,"../helpers/parse-headers":16}],11:[function(e,t,i){function n(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");r(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||s.API_ORIGIN}var r=e("@mapbox/parse-mapbox-token"),o=e("./mapi-request"),s=e("../constants");n.prototype.createRequest=function(e){return new o(this,e)},t.exports=n},{"../constants":15,"./mapi-request":13,"@mapbox/parse-mapbox-token":25}],12:[function(e,t,i){function n(e){var t,i=e.type||r.ERROR_HTTP;if(e.body)try{t=JSON.parse(e.body)}catch(i){t=e.body}else t=null;var n=e.message||null;n||("string"==typeof t?n=t:t&&"string"==typeof t.message?n=t.message:i===r.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=i,this.statusCode=e.statusCode||null,this.request=e.request,this.body=t}var r=e("../constants");t.exports=n},{"../constants":15}],13:[function(e,t,i){function n(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={};t.body&&(i["content-type"]="application/json");var n=o(i,t.headers),r=Object.keys(n).reduce((function(e,t){return e[t.toLowerCase()]=n[t],e}),{});this.id=c++,this._options=t,this.emitter=new s,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=r}var r=e("@mapbox/parse-mapbox-token"),o=e("xtend"),s=e("eventemitter3"),a=e("../helpers/url-utils"),l=e("../constants"),c=1;n.prototype.url=function(e){var t=a.prependOrigin(this.path,this.origin);t=a.appendQueryObject(t,this.query);var i=this.params,n=null==e?this.client.accessToken:e;if(n){t=a.appendQueryParam(t,"access_token",n);var s=r(n).user;i=o({ownerId:s},i)}return t=a.interpolateRouteParams(t,i)},n.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then((function(t){return e.response=t,e.emitter.emit(l.EVENT_RESPONSE,t),t}),(function(t){throw e.error=t,e.emitter.emit(l.EVENT_ERROR,t),t}))},n.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},n.prototype.eachPage=function(e){function t(t){function i(){delete r._nextPageRequest;var e=t.nextPage();e&&(r._nextPageRequest=e,n(e))}e(null,t,i)}function i(t){e(t,null,(function(){}))}function n(e){e.send().then(t,i)}var r=this;n(this)},n.prototype.clone=function(){return this._extend()},n.prototype._extend=function(e){var t=o(this._options,e);return new n(this.client,t)},t.exports=n},{"../constants":15,"../helpers/url-utils":18,"@mapbox/parse-mapbox-token":25,eventemitter3:27,xtend:39}],14:[function(e,t,i){function n(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch(e){this.body=t.body}this.links=r(this.headers.link)}var r=e("../helpers/parse-link-header");n.prototype.hasNextPage=function(){return!!this.links.next},n.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},t.exports=n},{"../helpers/parse-link-header":17}],15:[function(e,t,i){t.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],16:[function(e,t,i){function n(e){var t=e.indexOf(":");return{name:e.substring(0,t).trim().toLowerCase(),value:e.substring(t+1).trim()}}function r(e){var t={};return e?(e.trim().split(/[\r|\n]+/).forEach((function(e){var i=n(e);t[i.name]=i.value})),t):t}t.exports=r},{}],17:[function(e,t,i){function n(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function r(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var i=t[1],r=t[2].split(";"),o=null,s=r.reduce((function(e,t){var i=n(t);return i?"rel"===i.key?(o||(o=i.value),e):(e[i.key]=i.value,e):e}),{});return o?{url:i,rel:o,params:s}:null}function o(e){return e?e.split(/,\s*</).reduce((function(e,t){var i=r(t);return i?(i.rel.split(/\s+/).forEach((function(t){e[t]||(e[t]={url:i.url,params:i.params})})),e):e}),{}):{}}t.exports=o},{}],18:[function(e,t,i){function n(e){return e.map(encodeURIComponent).join(",")}function r(e){return Array.isArray(e)?n(e):encodeURIComponent(String(e))}function o(e,t,i){if(!1===i||null===i)return e;var n=/\?/.test(e)?"&":"?",o=encodeURIComponent(t);return void 0!==i&&""!==i&&!0!==i&&(o+="="+r(i)),""+e+n+o}function s(e,t){if(!t)return e;var i=e;return Object.keys(t).forEach((function(e){var n=t[e];void 0!==n&&(Array.isArray(n)&&(n=n.filter((function(e){return null!=e})).join(",")),i=o(i,e,n))})),i}function a(e,t){if(!t)return e;if("http"===e.slice(0,4))return e;var i="/"===e[0]?"":"/";return""+t.replace(/\/$/,"")+i+e}function l(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,(function(e,i){var n=t[i];if(void 0===n)throw new Error("Unspecified route parameter "+i);return"/"+r(n)})):e}t.exports={appendQueryObject:s,appendQueryParam:o,prependOrigin:a,interpolateRouteParams:l}},{}],19:[function(e,t,i){var n=e("xtend"),r=e("./service-helpers/validator"),o=e("./service-helpers/pick"),s=e("./service-helpers/stringify-booleans"),a=e("./service-helpers/create-service-factory"),l={},c=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];l.forwardGeocode=function(e){r.assertShape({query:r.required(r.string),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),proximity:r.oneOf(r.coordinates,"ip"),types:r.arrayOf(r.oneOf(c)),autocomplete:r.boolean,bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),routing:r.boolean,fuzzyMatch:r.boolean,worldview:r.string})(e),e.mode=e.mode||"mapbox.places";var t=s(n({country:e.countries},o(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},l.reverseGeocode=function(e){r.assertShape({query:r.required(r.coordinates),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),types:r.arrayOf(r.oneOf(c)),bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),reverseMode:r.oneOf("distance","score"),routing:r.boolean,worldview:r.string})(e),e.mode=e.mode||"mapbox.places";var t=s(n({country:e.countries},o(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},t.exports=a(l)},{"./service-helpers/create-service-factory":20,"./service-helpers/pick":22,"./service-helpers/stringify-booleans":23,"./service-helpers/validator":24,xtend:39}],20:[function(e,t,i){function n(e){return function(t){var i;i=r.prototype.isPrototypeOf(t)?t:o(t);var n=Object.create(e);return n.client=i,n}}var r=e("../../lib/classes/mapi-client"),o=e("../../lib/client");t.exports=n},{"../../lib/classes/mapi-client":11,"../../lib/client":9}],21:[function(e,t,i){function n(e,t){return Object.keys(e).reduce((function(i,n){return i[n]=t(n,e[n]),i}),{})}t.exports=n},{}],22:[function(e,t,i){function n(e,t){var i=function(e,i){return-1!==t.indexOf(e)&&void 0!==i};return"function"==typeof t&&(i=t),Object.keys(e).filter((function(t){return i(t,e[t])})).reduce((function(t,i){return t[i]=e[i],t}),{})}t.exports=n},{}],23:[function(e,t,i){function n(e){return r(e,(function(e,t){return"boolean"==typeof t?JSON.stringify(t):t}))}var r=e("./object-map");t.exports=n},{"./object-map":21}],24:[function(e,t,i){(function(i){(function(){function n(e){if("undefined"!=typeof window){if(e instanceof i.Blob||e instanceof i.ArrayBuffer)return;return"Blob or ArrayBuffer"}if("string"!=typeof e&&void 0===e.pipe)return"Filename or Readable stream"}function r(e,t){return l.assert(l.strictShape(e),t)}function o(e){if("boolean"==typeof e)return"date";try{var t=new Date(e);if(t.getTime&&isNaN(t.getTime()))return"date"}catch(e){return"date"}}function s(e){return l.tuple(l.number,l.number)(e)}var a=e("xtend"),l=e("@mapbox/fusspot");t.exports=a(l,{file:n,date:o,coordinates:s,assertShape:r})}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@mapbox/fusspot":7,xtend:39}],25:[function(e,t,i){function n(e){if(a[e])return a[e];var t=e.split("."),i=t[0],n=t[1];if(!n)throw new Error("Invalid token");var s=r(n),l={usage:i,user:s.u};return o(s,"a")&&(l.authorization=s.a),o(s,"exp")&&(l.expires=1e3*s.exp),o(s,"iat")&&(l.created=1e3*s.iat),o(s,"scopes")&&(l.scopes=s.scopes),o(s,"client")&&(l.client=s.client),o(s,"ll")&&(l.lastLogin=s.ll),o(s,"iu")&&(l.impersonator=s.iu),a[e]=l,l}function r(e){try{return JSON.parse(s.decode(e))}catch(e){throw new Error("Invalid token")}}function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var s=e("base-64"),a={};t.exports=n},{"base-64":26}],26:[function(e,t,i){(function(e){(function(){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r){var o="object"==(void 0===i?"undefined":n(i))&&i,s="object"==(void 0===t?"undefined":n(t))&&t&&t.exports==o&&t,a="object"==(void 0===e?"undefined":n(e))&&e;a.global!==a&&a.window!==a||(r=a);var l=function(e){this.message=e};l.prototype=new Error,l.prototype.name="InvalidCharacterError";var c=function(e){throw new l(e)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=/[\t\n\f\r ]/g,d=function(e){var t=(e=String(e).replace(h,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var i,n,r=0,o="",s=-1;++s<t;)n=u.indexOf(e.charAt(s)),i=r%4?64*i+n:n,r++%4&&(o+=String.fromCharCode(255&i>>(-2*r&6)));return o},p=function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,i=e.length%3,n="",r=-1,o=e.length-i;++r<o;)t=(e.charCodeAt(r)<<16)+(e.charCodeAt(++r)<<8)+e.charCodeAt(++r),n+=u.charAt(t>>18&63)+u.charAt(t>>12&63)+u.charAt(t>>6&63)+u.charAt(63&t);return 2==i?(t=(e.charCodeAt(r)<<8)+e.charCodeAt(++r),n+=u.charAt(t>>10)+u.charAt(t>>4&63)+u.charAt(t<<2&63)+"="):1==i&&(t=e.charCodeAt(r),n+=u.charAt(t>>2)+u.charAt(t<<4&63)+"=="),n},f={encode:p,decode:d,version:"0.1.0"};if(o&&!o.nodeType)if(s)s.exports=f;else for(var m in f)f.hasOwnProperty(m)&&(o[m]=f[m]);else r.base64=f}(void 0)}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,i){function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,n,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new r(i,n||e,o),a=c?c+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function a(){this._events=new n,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,c="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(c=!1)),a.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)l.call(e,t)&&i.push(c?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=c?c+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(e){var t=c?c+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,n,r,o){var s=c?c+e:e;if(!this._events[s])return!1;var a,l,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,r),!0;case 6:return u.fn.call(u.context,t,i,n,r,o),!0}for(l=1,a=new Array(h-1);l<h;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,n);break;default:if(!a)for(d=1,a=new Array(h-1);d<h;d++)a[d-1]=arguments[d];u[l].fn.apply(u[l].context,a)}}return!0},a.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,i,n){var r=c?c+e:e;if(!this._events[r])return this;if(!t)return s(this,r),this;var o=this._events[r];if(o.fn)o.fn!==t||n&&!o.once||i&&o.context!==i||s(this,r);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==t||n&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[r]=1===l.length?l[0]:l:s(this,r)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=c?c+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=c,a.EventEmitter=a,void 0!==t&&(t.exports=a)},{}],28:[function(e,t,i){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=w(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function o(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function s(e,t,i){if(t)e.call(i);else for(var n=e.length,r=y(e,n),o=0;o<n;++o)r[o].call(i)}function a(e,t,i,n){if(t)e.call(i,n);else for(var r=e.length,o=y(e,r),s=0;s<r;++s)o[s].call(i,n)}function l(e,t,i,n,r){if(t)e.call(i,n,r);else for(var o=e.length,s=y(e,o),a=0;a<o;++a)s[a].call(i,n,r)}function c(e,t,i,n,r,o){if(t)e.call(i,n,r,o);else for(var s=e.length,a=y(e,s),l=0;l<s;++l)a[l].call(i,n,r,o)}function u(e,t,i,n){if(t)e.apply(i,n);else for(var r=e.length,o=y(e,r),s=0;s<r;++s)o[s].apply(i,n)}function h(e,t,i,r){var s,a,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),l=a[t]):(a=e._events=w(null),e._eventsCount=0),l){if("function"==typeof l?l=a[t]=r?[i,l]:[l,i]:r?l.unshift(i):l.push(i),!l.warned&&(s=o(e))&&s>0&&l.length>s){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,"object"===("undefined"==typeof console?"undefined":n(console))&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else l=a[t]=i,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=k.call(d,n);return r.listener=i,n.wrapFn=r,r}function f(e,t,i){var n=e._events;if(!n)return[];var r=n[t];return r?"function"==typeof r?i?[r.listener||r]:[r]:i?_(r):y(r,r.length):[]}function m(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function g(e,t){for(var i=t,n=i+1,r=e.length;n<r;i+=1,n+=1)e[i]=e[n];e.pop()}function y(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function _(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}function v(e){var t=function(){};return t.prototype=e,new t}function x(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return i}function b(e){var t=this;return function(){return t.apply(e,arguments)}}var w=Object.create||v,T=Object.keys||x,k=Function.prototype.bind||b;t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var S,C=10;try{var E={};Object.defineProperty&&Object.defineProperty(E,"x",{value:0}),S=0===E.x}catch(e){S=!1}S?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return C},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');C=e}}):r.defaultMaxListeners=C,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return o(this)},r.prototype.emit=function(e){var t,i,n,r,o,h,d="error"===e;if(h=this._events)d=d&&null==h.error;else if(!d)return!1;if(d){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var p=new Error('Unhandled "error" event. ('+t+")");throw p.context=t,p}if(!(i=h[e]))return!1;var f="function"==typeof i;switch(n=arguments.length){case 1:s(i,f,this);break;case 2:a(i,f,this,arguments[1]);break;case 3:l(i,f,this,arguments[1],arguments[2]);break;case 4:c(i,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];u(i,f,this,r)}return!0},r.prototype.addListener=function(e,t){return h(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return h(this,e,t,!0)},r.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},r.prototype.removeListener=function(e,t){var i,n,r,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=w(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():g(i,r),1===i.length&&(n[e]=i[0]),n.removeListener&&this.emit("removeListener",e,s||t)}return this},r.prototype.removeAllListeners=function(e){var t,i,n;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=w(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=w(null):delete i[e]),this;if(0===arguments.length){var r,o=T(i);for(n=0;n<o.length;++n)"removeListener"!==(r=o[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=w(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},r.prototype.listeners=function(e){return f(this,e,!0)},r.prototype.rawListeners=function(e){return f(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],29:[function(e,t,i){!function(){var e=this,n={};void 0!==i?t.exports=n:e.fuzzy=n,n.simpleFilter=function(e,t){return t.filter((function(t){return n.test(e,t)}))},n.test=function(e,t){return null!==n.match(e,t)},n.match=function(e,t,i){i=i||{};var n,r=0,o=[],s=t.length,a=0,l=0,c=i.pre||"",u=i.post||"",h=i.caseSensitive&&t||t.toLowerCase();e=i.caseSensitive&&e||e.toLowerCase();for(var d=0;d<s;d++)n=t[d],h[d]===e[r]?(n=c+n+u,r+=1,l+=1+l):l=0,a+=l,o[o.length]=n;return r===e.length?(a=h===e?1/0:a,{rendered:o.join(""),score:a}):null},n.filter=function(e,t,i){return t&&0!==t.length?"string"!=typeof e?t:(i=i||{},t.reduce((function(t,r,o,s){var a=r;i.extract&&(a=i.extract(r));var l=n.match(e,a,i);return null!=l&&(t[t.length]={string:l.rendered,score:l.score,index:o,original:r}),t}),[]).sort((function(e,t){return t.score-e.score||e.index-t.index}))):[]}}()},{}],30:[function(e,t,i){var n=Object.prototype.toString;t.exports=function(e){var t;return"[object Object]"===n.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))}},{}],31:[function(e,t,i){(function(e){(function(){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t,i){function n(t){var i=m,n=g;return m=g=void 0,k=t,_=e.apply(n,i)}function o(e){return k=e,v=setTimeout(u,t),S?n(e):_}function s(e){var i=t-(e-T);return C?b(i,y-(e-k)):i}function c(e){var i=e-T;return void 0===T||i>=t||i<0||C&&e-k>=y}function u(){var e=w();if(c(e))return h(e);v=setTimeout(u,s(e))}function h(e){return v=void 0,E&&m?n(e):(m=g=void 0,_)}function d(){void 0!==v&&clearTimeout(v),k=0,m=T=g=v=void 0}function p(){return void 0===v?_:h(w())}function f(){var e=w(),i=c(e);if(m=arguments,g=this,T=e,i){if(void 0===v)return o(T);if(C)return v=setTimeout(u,t),n(T)}return void 0===v&&(v=setTimeout(u,t)),_}var m,g,y,_,v,T,k=0,S=!1,C=!1,E=!0;if("function"!=typeof e)throw new TypeError(l);return t=a(t)||0,r(i)&&(S=!!i.leading,y=(C="maxWait"in i)?x(a(i.maxWait)||0,t):y,E="trailing"in i?!!i.trailing:E),f.cancel=d,f.flush=p,f}function r(e){var t=i(e);return!!e&&("object"==t||"function"==t)}function o(e){return!!e&&"object"==i(e)}function s(e){return"symbol"==i(e)||o(e)&&v.call(e)==u}function a(e){if("number"==typeof e)return e;if(s(e))return c;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(h,"");var i=p.test(e);return i||f.test(e)?m(e.slice(2),i?2:8):d.test(e)?c:+e}var l="Expected a function",c=NaN,u="[object Symbol]",h=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,f=/^0o[0-7]+$/i,m=parseInt,g="object"==(void 0===e?"undefined":i(e))&&e&&e.Object===Object&&e,y="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,_=g||y||Function("return this")(),v=Object.prototype.toString,x=Math.max,b=Math.min,w=function(){return _.Date.now()};t.exports=n}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(e,t,i){(function(i){(function(){var n=e("./url-alphabet/index.cjs").urlAlphabet;if("production"!==i.env.NODE_ENV){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}var r=function(e){return crypto.getRandomValues(new Uint8Array(e))},o=function(e,t,i){var n=(2<<Math.log(e.length-1)/Math.LN2)-1,r=-~(1.6*n*t/e.length);return function(){for(var o="";;)for(var s=i(r),a=r;a--;)if((o+=e[s[a]&n]||"").length===t)return o}},s=function(e,t){return o(e,t,r)},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,t="",i=crypto.getRandomValues(new Uint8Array(e));e--;){var n=63&i[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t};t.exports={nanoid:a,customAlphabet:s,customRandom:o,urlAlphabet:n,random:r}}).call(this)}).call(this,e("_process"))},{"./url-alphabet/index.cjs":33,_process:34}],33:[function(e,t,i){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}},{}],34:[function(e,t,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(h===setTimeout)return setTimeout(e,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){g&&f&&(g=!1,f.length?m=f.concat(m):y=-1,m.length&&l())}function l(){if(!g){var e=o(a);g=!0;for(var t=m.length;t;){for(f=m,m=[];++y<t;)f&&f[y].run();y=-1,t=m.length}f=null,g=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var h,d,p=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(e){h=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var f,m=[],g=!1,y=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];m.push(new c(e,t)),1!==m.length||g||o(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],35:[function(e,t,i){!function(e,i,n){void 0!==t&&t.exports?t.exports=n():e.subtag=n()}(void 0,0,(function(){function e(e){return e.match(s)||[]}function t(t){return e(t).filter((function(e,t){return e&&t}))}function i(t){return{language:(t=e(t))[1]||o,extlang:t[2]||o,script:t[3]||o,region:t[4]||o}}function n(e,t,i){Object.defineProperty(e,t,{value:i,enumerable:!0})}function r(t,r,s){function a(i){return e(i)[t]||o}n(a,"pattern",r),n(i,s,a)}var o="",s=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),n(i,"split",t),i}))},{}],36:[function(e,t,i){var n=e("./src/suggestions");t.exports=n,"undefined"!=typeof window&&(window.Suggestions=n)},{"./src/suggestions":38}],37:[function(e,t,i){var n=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};n.prototype.show=function(){this.element.style.display="block"},n.prototype.hide=function(){this.element.style.display="none"},n.prototype.add=function(e){this.items.push(e)},n.prototype.clear=function(){this.items=[],this.active=0},n.prototype.isEmpty=function(){return!this.items.length},n.prototype.isVisible=function(){return"block"===this.element.style.display},n.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()}else this.hide()},n.prototype.drawItem=function(e,t){var i=document.createElement("li"),n=document.createElement("a");t&&(i.className+=" active"),n.innerHTML=e.string,i.appendChild(n),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))},n.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},n.prototype.move=function(e){this.active=e,this.draw()},n.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},n.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},n.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()},t.exports=n},{}],38:[function(e,t,i){var n=e("xtend"),r=e("fuzzy"),o=e("./list"),s=function(e,t,i){return i=i||{},this.options=n({minLength:2,limit:5,filter:!0,hideOnBlur:!0},i),this.el=e,this.data=t||[],this.list=new o(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(e){this.handleKeyUp(e.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(e){this.handleKeyDown(e)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(e){this.handlePaste(e)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};s.prototype.handleKeyUp=function(e){40!==e&&38!==e&&27!==e&&13!==e&&9!==e&&this.handleInputChange(this.el.value)},s.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},s.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},s.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout((function(){t.handleInputChange(e.target.value)}),100)}},s.prototype.handleInputChange=function(e){this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}.bind(this))},s.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},s.prototype.update=function(e){this.data=e,this.handleKeyUp()},s.prototype.clear=function(){this.data=[],this.list.clear()},s.prototype.normalize=function(e){return e.toLowerCase()},s.prototype.match=function(e,t){return e.indexOf(t)>-1},s.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")},s.prototype.getCandidates=function(e){var t,i={pre:"<strong>",post:"</strong>",extract:function(e){return this.getItemValue(e)}.bind(this)};t=this.options.filter?(t=r.filter(this.query,this.data,i)).map(function(e){return{original:e.original,string:this.render(e.original,e.string)}}.bind(this)):this.data.map(function(e){return{original:e,string:this.render(e)}}.bind(this)),e(t)},s.prototype.getItemValue=function(e){return e},s.prototype.render=function(e,t){if(t)return t;for(var i=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(i),r=n.lastIndexOf(this.query);r>-1;){var o=r+this.query.length;i=i.slice(0,r)+"<strong>"+i.slice(r,o)+"</strong>"+i.slice(o),r=n.slice(0,r).lastIndexOf(this.query)}return i},s.prototype.renderError=function(e){this.list.drawError(e)},t.exports=s},{"./list":37,fuzzy:29,xtend:39}],39:[function(e,t,i){function n(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var n in i)r.call(i,n)&&(e[n]=i[n])}return e}t.exports=n;var r=Object.prototype.hasOwnProperty},{}]},{},[4])(4);let Za;Ve.subscribe((e=>({mapboxGlAccessToken:Za}=e)));const Xa=async(...e)=>{let t;try{const i=((...e)=>`https://api.mapbox.com/directions/v5/mapbox/driving/${e.map((e=>{const{lng:t,lat:i}=e;return`${t},${i}`})).join(";")}?geometries=geojson&steps=true&access_token=${Za}`)(...e),n=await fetch(i);t=await n.json()}catch(e){console.error(e)}return(e=>{const t=e.routes[0].legs.reduce(((e,t)=>{const i=t.steps.reduce(((e,t)=>e.concat(t)),[]);return e.concat(i)}),[]);let i=t.map((e=>e.geometry));return i=i.reduce(((e,t)=>e.concat(t.coordinates)),[]),{steps:t,coordinates:i}})(t)};var Ka={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function Ya(e,t,i){void 0===i&&(i={});var n={type:"Feature"};return(0===i.id||i.id)&&(n.id=i.id),i.bbox&&(n.bbox=i.bbox),n.properties=t||{},n.geometry=e,n}function Ja(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!il(e[0])||!il(e[1]))throw new Error("coordinates must contain numbers");return Ya({type:"Point",coordinates:e},t,i)}function Qa(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Ya({type:"LineString",coordinates:e},t,i)}function el(e){return 180*(e%(2*Math.PI))/Math.PI}function tl(e){return e%360*Math.PI/180}function il(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function nl(e,t,i){if(null!==e)for(var n,r,o,s,a,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,g=f?e.features.length:1,y=0;y<g;y++){a=(u=!!(c=f?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<a;_++){var v=0,x=0;if(null!==(s=u?c.geometries[_]:c)){l=s.coordinates;var b=s.type;switch(h=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===t(l,d,y,v,x))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(!1===t(l[n],d,y,v,x))return!1;d++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(r=0;r<l[n].length-h;r++){if(!1===t(l[n][r],d,y,v,x))return!1;d++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(x=0,r=0;r<l[n].length;r++){for(o=0;o<l[n][r].length-h;o++){if(!1===t(l[n][r][o],d,y,v,x))return!1;d++}x++}v++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===nl(s.geometries[n],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function rl(e,t){!function(e,t){var i,n,r,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(a=p?e.features[i].geometry:f?e.geometry:e,c=p?e.features[i].properties:f?e.properties:{},u=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===t(o.geometries[n],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}(e,(function(e,i,n,r,o){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Ya(e,n,{bbox:r,id:o}),i,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l];if(!1===t(Ya({type:s,coordinates:c},n),i,l))return!1}}))}function ol(e,t){rl(e,(function(e,i,n){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,c=0;return!1!==nl(e,(function(o,u,h,d,p){if(void 0===s||i>a||d>l||p>c)return s=o,a=i,l=d,c=p,void(r=0);var f=Qa([s,o],e.properties);if(!1===t(f,i,n,p,r))return!1;r++,s=o}))&&void 0}}}))}function sl(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function al(e,t,i){void 0===i&&(i={});var n=sl(e),r=sl(t),o=tl(r[1]-n[1]),s=tl(r[0]-n[0]),a=tl(n[1]),l=tl(r[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return function(e,t){void 0===t&&(t="kilometers");var i=Ka[t];if(!i)throw new Error(t+" units is invalid");return e*i}(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}function ll(e,t,i,n){void 0===n&&(n={});var r=sl(e),o=tl(r[0]),s=tl(r[1]),a=tl(i),l=function(e,t){void 0===t&&(t="kilometers");var i=Ka[t];if(!i)throw new Error(t+" units is invalid");return e/i}(t,n.units),c=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a));return Ja([el(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(c))),el(c)],n.properties)}function cl(e,t,i){if(void 0===i&&(i={}),!0===i.final)return function(e,t){var i=cl(t,e);return i=(i+180)%360}(e,t);var n=sl(e),r=sl(t),o=tl(n[0]),s=tl(r[0]),a=tl(n[1]),l=tl(r[1]),c=Math.sin(s-o)*Math.cos(l),u=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return el(Math.atan2(c,u))}function ul(e,t,i){void 0===i&&(i={});for(var n,r=("Feature"===(n=e).type?n.geometry:n).coordinates,o=0,s=0;s<r.length&&!(t>=o&&s===r.length-1);s++){if(o>=t){var a=t-o;if(a){var l=cl(r[s],r[s-1])-180;return ll(r[s],a,l,i)}return Ja(r[s])}o+=al(r[s],r[s+1],i)}return Ja(r[r.length-1])}function hl(e,t){return void 0===t&&(t={}),function(e,t,i){var n=i,r=!1;return ol(e,(function(e,o,s,a,l){n=!1===r&&void 0===i?e:t(n,e,o,s,a,l),r=!0})),n}(e,(function(e,i){var n=i.geometry.coordinates;return e+al(n[0],n[1],t)}),0)}function dl(e,t,i,n){if(!(r=n=n||{})||r.constructor!==Object)throw new Error("options is invalid");var r,o,s=[];if("Feature"===e.type)o=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");o=e.coordinates}for(var a,l,c,u=o.length,h=0,d=0;d<o.length&&!(t>=h&&d===o.length-1);d++){if(h>t&&0===s.length){if(!(a=t-h))return s.push(o[d]),Qa(s);l=cl(o[d],o[d-1])-180,c=ll(o[d],a,l,n),s.push(c.geometry.coordinates)}if(h>=i)return(a=i-h)?(l=cl(o[d],o[d-1])-180,c=ll(o[d],a,l,n),s.push(c.geometry.coordinates),Qa(s)):(s.push(o[d]),Qa(s));if(h>=t&&s.push(o[d]),d===o.length-1)return Qa(s);h+=al(o[d],o[d+1],n)}if(h<t&&o.length===u)throw new Error("Start position is beyond line");var p=o[o.length-1];return Qa([p,p])}function pl(e,t,i){var n;return void 0===i&&(i={}),(n=i.final?fl(sl(t),sl(e)):fl(sl(e),sl(t)))>180?-(360-n):n}function fl(e,t){var i=tl(e[1]),n=tl(t[1]),r=tl(t[0]-e[0]);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(el(Math.atan2(r,o))+360)%360}let ml,gl,yl,_l,vl,xl={};Xe.subscribe((e=>xl=e)),tt.subscribe((e=>({routingOptions:gl,maneuverOptions:yl,speedOptions:_l,durationMultiplier:vl}=e)));const bl=(e,t,i,n,r)=>(e-t)*(r-n)/(i-t)+n,wl=(e,t,i)=>i?((e,t)=>{let i=t+(360-e);return i>360?i-360:i})(e,t):((e,t)=>{let i=e+(360-t);return i>360?i-360:i})(e,t),Tl=e=>(e>360&&(e-=360),e<0&&(e=360+e),360===e&&(e=0),e),kl=(e,t,i,n)=>{let r=wl(e,t,i);return Tl(i?e+r*n:e-r*n)},Sl=(e,t,i,n)=>{const r=1-bl(Math.min(i,n),0,n,0,1);let o=e.pitch,s=e.zoom;if(void 0!==t.pitch){const i=t.pitch>e.pitch,n=Math.min(e.pitch,t.pitch),s=Math.max(e.pitch,t.pitch);o=bl(i?r:1-r,0,1,n,s)}if(void 0!==t.zoom){const i=t.zoom>e.zoom,n=Math.min(e.zoom,t.zoom),o=Math.max(e.zoom,t.zoom);s=bl(i?r:1-r,0,1,n,o)}return{pitch:o,zoom:s}},Cl=(e,t)=>new Promise((async i=>{const{steps:n,distance:r,duration:o,coordinates:s,maneuver:a,nextManeuver:l}=t,c=r/o;let u=_l?.speed&&_l?.speed<c?{...gl,..._l}:gl;if("arrive"===a.type)return i({segmentComplete:!0});const h=e.getBearing()<0?360+e.getBearing():e.getBearing();let d=await((e,t,i)=>new Promise((n=>{let r,{bearing_after:o,location:s,modifier:a}=t,l=i;if(!a||!o)return n(l);const c=wl(i,o,!0),u=wl(i,o,!1),h=c<u,d=(h?c:u)*vl/10;window.requestAnimationFrame((function t(a){r||(r=a);const c=(a-r)/d;if(c>1)return n(l);l=kl(i,o,h,c),dr(e,s,l),e.jumpTo({center:s,bearing:l}),window.requestAnimationFrame(t)}))})))(e,a,h);const p=s,f=o*vl,m=hl(Qa(p));let g,y,_,v,x;window.requestAnimationFrame((function t(o){if(JSON.stringify(n)!==JSON.stringify(ml))return i({segmentComplete:!0});x||(x=o);const s=(o-x)/f,a=ul(Qa(p),m*s).geometry.coordinates,c=ul(Qa(p),m*Math.min(s+.025,1)).geometry.coordinates;if(s>1)return i({segmentComplete:!0});let h,b,w=Tl(pl(Ja(a),Ja(c)));d=((e,t)=>{const i=wl(e,t,!1),n=wl(e,t,!0);let r=n<i,o=r?n:i;o=Math.min(o,5);const s=bl(5-o,0,5,.05,.5);return kl(e,t,r,s)})(d,w);const T=ul(Qa(p.slice(1).concat([p[p.length-1]])),m*s).geometry.coordinates,k=pl(Ja(a),Ja(T));dr(e,a,k);const S=r-r*s,C=u?.leadDistance;if(C&&S<=C){g||(g=e.getPitch()),y||(y=e.getZoom());const t=yl?.["*"]||yl?.[l?.type],i=Sl({pitch:g,zoom:y},{pitch:void 0!==t?.pitch?t?.pitch:u.pitch,zoom:void 0!==t?.zoom?t?.zoom:u.zoom},S,Math.min(C,r));h=i.pitch,b=i.zoom}else if(C&&r*s<=C){_||(_=e.getPitch()),v||(v=e.getZoom());const t=Sl({pitch:_,zoom:v},{pitch:u.pitch,zoom:u.zoom},C-r*s,Math.min(C,r));h=t.pitch,b=t.zoom}else h=u.pitch,b=u.zoom;e.jumpTo({center:a,zoom:b,pitch:h,bearing:d}),window.requestAnimationFrame(t)}))})),El=async(e,t)=>{const{coordinates:i,steps:n}=t;if(ml=n,n)return new Promise((t=>{const r=i[0],o=i[i.length-1],s=n?.[0]?.maneuver?.bearing_after||0,a="arrive"===n[n.length-1]?.maneuver?.type;e.easeTo({center:r,speed:.2,curve:1,duration:1e3,zoom:gl.zoom,pitch:gl.pitch,bearing:s}),e.once("moveend",(()=>{xl["destination-pin"]&&a&&pr(e,o,"destination-pin",{"icon-pitch-alignment":"viewport","icon-offset":[0,-.5*xl["destination-pin"].height]}),xl.puck&&pr(e,r,Pe,{"icon-pitch-alignment":"map","icon-rotation-alignment":"map"}),(async(e,t)=>{for(let i=0;i<t.length;i++){const n=t[i],{distance:r,duration:o,geometry:s,maneuver:a}=n,l=t?.[i+1]?.maneuver;if(JSON.stringify(t)!==JSON.stringify(ml))return;await Cl(e,{steps:t,duration:o,distance:r,coordinates:s.coordinates,maneuver:a,nextManeuver:l})}return{routeComplete:!0}})(e,n).then((e=>{t(e)}))}))}))},{Boolean:Ml}=ce;function Al(e,t,i){const n=e.slice();return n[21]=t[i],n[23]=i,n}function zl(e){let t,i,n,r,o,s,a,l,c,u,h,d=e[21].id.toUpperCase()+"",p=e[23]>=2&&function(e){let t,i,n,r,o;function s(){return e[11](e[21])}return i=new qa({props:{icon:Ba}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"class","remove-stop svelte-1q8ful8"),t.disabled=e[0]},m(e,a){v(e,t,a),ge(i,t,null),n=!0,r||(o=E(t,"click",s),r=!0)},p(i,r){e=i,(!n||1&r)&&(t.disabled=e[0])},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(e){e&&x(t),ye(i),r=!1,o()}}}(e);return{c(){t=w("div"),i=w("div"),n=w("span"),r=k(d),o=k(":"),s=S(),a=w("div"),l=w("div"),u=S(),p&&p.c(),A(n,"class","label svelte-1q8ful8"),A(l,"id",c=e[21].id),A(l,"class","geocoder unfocused-input svelte-1q8ful8"),A(a,"class","geocoder-container svelte-1q8ful8"),A(i,"class","search-container svelte-1q8ful8"),A(t,"class","stop svelte-1q8ful8")},m(e,c){v(e,t,c),_(t,i),_(i,n),_(n,r),_(n,o),_(i,s),_(i,a),_(a,l),_(t,u),p&&p.m(t,null),h=!0},p(e,t){(!h||2&t)&&d!==(d=e[21].id.toUpperCase()+"")&&L(r,d),(!h||2&t&&c!==(c=e[21].id))&&A(l,"id",c),e[23]>=2&&p.p(e,t)},i(e){h||(ae(p),h=!0)},o(e){le(p),h=!1},d(e){e&&x(t),p&&p.d()}}}function Il(e){let t,i,n,r,o,l,c,u,h,d,p,f,m,g,y,T,C,M,z,I,D,P,O=e[0]?"Cancel route":"Run route",R=e[1],B=[];for(let t=0;t<R.length;t+=1)B[t]=zl(Al(e,R,t));const F=e=>le(B[e],1,1,(()=>{B[e]=null}));return{c(){t=w("div");for(let e=0;e<B.length;e+=1)B[e].c();i=S(),n=w("div"),r=w("button"),o=k("Add stop"),u=S(),h=w("button"),d=k("Clear route"),f=S(),m=w("button"),g=k("Submit"),T=S(),C=w("button"),M=k(O),A(r,"class","secondary-button svelte-1q8ful8"),r.disabled=l=e[1].length>=4||e[0],A(r,"title",c=e[1].length>=4?"maximum of 4 stops allowed":""),A(h,"class","secondary-button svelte-1q8ful8"),h.disabled=e[0],A(h,"title",p=e[1].length>=4?"maximum of 4 stops allowed":""),A(n,"class","button-margin svelte-1q8ful8"),A(m,"class","primary-button button-margin svelte-1q8ful8"),m.disabled=y=e[2]||e[0],A(C,"class","primary-button button-margin svelte-1q8ful8"),C.disabled=z=!e[3],A(t,"class","directions svelte-1q8ful8")},m(s,l){v(s,t,l);for(let e=0;e<B.length;e+=1)B[e].m(t,null);_(t,i),_(t,n),_(n,r),_(r,o),_(n,u),_(n,h),_(h,d),_(t,f),_(t,m),_(m,g),_(t,T),_(t,C),_(C,M),I=!0,D||(P=[E(r,"click",e[5]),E(h,"click",e[7]),E(m,"click",e[4]),E(C,"click",(function(){a(e[0]?e[9]:e[8])&&(e[0]?e[9]:e[8]).apply(this,arguments)}))],D=!0)},p(n,[o]){if(e=n,67&o){let n;for(R=e[1],n=0;n<R.length;n+=1){const r=Al(e,R,n);B[n]?(B[n].p(r,o),ae(B[n],1)):(B[n]=zl(r),B[n].c(),ae(B[n],1),B[n].m(t,i))}for(oe(),n=R.length;n<B.length;n+=1)F(n);se()}(!I||3&o&&l!==(l=e[1].length>=4||e[0]))&&(r.disabled=l),(!I||2&o&&c!==(c=e[1].length>=4?"maximum of 4 stops allowed":""))&&A(r,"title",c),(!I||1&o)&&(h.disabled=e[0]),(!I||2&o&&p!==(p=e[1].length>=4?"maximum of 4 stops allowed":""))&&A(h,"title",p),(!I||5&o&&y!==(y=e[2]||e[0]))&&(m.disabled=y),(!I||1&o)&&O!==(O=e[0]?"Cancel route":"Run route")&&L(M,O),(!I||8&o&&z!==(z=!e[3]))&&(C.disabled=z)},i(e){if(!I){for(let e=0;e<R.length;e+=1)ae(B[e]);I=!0}},o(e){B=B.filter(Ml);for(let e=0;e<B.length;e+=1)le(B[e]);I=!1},d(e){e&&x(t),b(B,e),D=!1,s(P)}}}function Ll(e,t,i){let n,r,{routeFlag:o}=t,{setRouteFlag:s}=t;Ve.subscribe((e=>({mapboxGlAccessToken:n,directionsApiCall:r}=e)));let a,l,c=!1,u=Re;qe.subscribe((e=>{e&&e.hasOwnProperty("locations")&&i(1,u=e.locations)})),Ze.subscribe((e=>a=e));const h=()=>u.map((e=>e.center)).filter(Boolean).length>=2,d=async()=>{const e=u.map((e=>e.center?e.center:g(e.id))).filter(Boolean),t=r?await r(...e):await Xa(...e);t&&(i(3,l=t),qe.set({locations:u,response:t}))},p=e=>{const t=new Ha({accessToken:n,mapboxgl:mt});t.addTo(`#${e}`),t.on("result",(t=>{const{center:n,placeName:r}=(e=>{const{place_name:t}=e;return{center:{lat:e.center[1],lng:e.center[0]},placeName:t}})(t.result);i(1,u=u.map((t=>t.id===e?{...t,center:n,locationText:r}:t)))})),t.on("clear",(t=>{i(1,u=u.map((t=>t.id===e?{...t,center:null,locationText:""}:t)))}))},f=e=>{const t=document.getElementById(e);t.classList.remove("focused-input"),t.classList.add("unfocused-input")},m=()=>{[...document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")].forEach(((e,t)=>{e.value=u[t].locationText,e.addEventListener("focusin",(()=>(e=>{const t=document.getElementById(e);t.classList.remove("unfocused-input"),t.classList.add("focused-input"),u.filter((t=>t.id!==e)).map((e=>e.id)).forEach((e=>{f(e)}))})(u[t].id)))}))};$((()=>{u.forEach((e=>p(e.id))),m(),h()&&d()}));const g=e=>{i(1,u=u.filter((t=>t.id!==e)))};return e.$$set=e=>{"routeFlag"in e&&i(0,o=e.routeFlag),"setRouteFlag"in e&&i(10,s=e.setRouteFlag)},e.$$.update=()=>{2&e.$$.dirty&&u&&i(2,c=!h())},[o,u,c,l,d,async()=>{const e=String.fromCharCode(u.length+1+64).toLowerCase();i(1,u=u.concat([{id:e,center:null,locationText:""}])),await K(),p(e)},g,async()=>{i(1,u=Re),await K(),m(),qe.set({locations:u,response:null}),i(3,l=void 0);a.getSource(Be).setData({type:"FeatureCollection",features:[]})},async()=>{s(!0),await El(a,l),s(!1)},async()=>{await El(a,{steps:null}),s(!1)},s,e=>g(e.id)]}class Dl extends ve{constructor(e){super(),_e(this,e,Ll,Il,l,{routeFlag:0,setRouteFlag:10})}}let Pl,Ol,Rl,Bl,Fl;const $l=()=>{const e=Pl.memory().subarray(Ol);Rl.readPixels(0,0,Bl,Fl,Rl.RGBA,Rl.UNSIGNED_BYTE,e),Pl.encodeRGBPointer()};function jl(e){let t;return{c(){t=w("div"),A(t,"class","record svelte-2yk0nq")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function Nl(e){let t,i,n,r,o,a,l,c,u,h,d,p,f,m,g,y;n=new as({props:{titleText:"Moments",selectedId:e[3],label:"Select a maneuver",items:e[2],disabled:!e[0].length}}),n.$on("select",e[10]);let b=e[1]&&jl();return{c(){t=w("div"),i=w("div"),me(n.$$.fragment),r=S(),o=w("button"),a=k("Submit"),c=S(),u=w("button"),h=k("Record"),p=S(),b&&b.c(),f=C(),A(i,"class","dropdown-container svelte-2yk0nq"),A(o,"class","primary-button svelte-2yk0nq"),o.disabled=l=!e[3]||!e[0].length,A(u,"class","primary-button svelte-2yk0nq"),u.disabled=d=!e[3]||!e[0].length,A(t,"class","container svelte-2yk0nq")},m(s,l){v(s,t,l),_(t,i),ge(n,i,null),_(t,r),_(t,o),_(o,a),_(t,c),_(t,u),_(u,h),v(s,p,l),b&&b.m(s,l),v(s,f,l),m=!0,g||(y=[E(o,"click",e[5]),E(u,"click",e[6])],g=!0)},p(e,[t]){const i={};8&t&&(i.selectedId=e[3]),4&t&&(i.items=e[2]),1&t&&(i.disabled=!e[0].length),n.$set(i),(!m||9&t&&l!==(l=!e[3]||!e[0].length))&&(o.disabled=l),(!m||9&t&&d!==(d=!e[3]||!e[0].length))&&(u.disabled=d),e[1]?b||(b=jl(),b.c(),b.m(f.parentNode,f)):b&&(b.d(1),b=null)},i(e){m||(ae(n.$$.fragment,e),m=!0)},o(e){le(n.$$.fragment,e),m=!1},d(e){e&&x(t),ye(n),e&&x(p),b&&b.d(e),e&&x(f),g=!1,s(y)}}}function Ul(t,i,n){let r,o,s,{routeFlag:a}=i,{setRouteFlag:l}=i,c=!1,u=null,h="";qe.subscribe((e=>{if(n(9,u=e&&e?.response?e?.response:null),e&&e?.locations&&e?.locations.every((e=>!!e?.center))){h=0;for(const t of e?.locations){const{center:e}=t;h=h+e.lat+e.lng}h=`${h}`.replace(".","")}})),Ze.subscribe((e=>r=e)),Ve.subscribe((e=>({routingOptions:o,speedOptions:s}=e)));let d,p=[],f=[];const m=e=>{n(3,d=e)},g=async()=>{const e=p.find((e=>e.id===d));await(async e=>{const t={coordinates:(e?.steps||[]).reduce(((e,t)=>e.concat(t?.geometry?.coordinates||[])),[]),steps:e.steps};l(!0),await El(r,t),l(!1)})(e)};return t.$$set=e=>{"routeFlag"in e&&n(7,a=e.routeFlag),"setRouteFlag"in e&&n(8,l=e.setRouteFlag)},t.$$.update=()=>{512&t.$$.dirty&&(u?(e=>{const t=e.steps;for(let e=0;e<t.length;e++){const i={units:"meters"},r=t?.[e-1],a=t[e],{distance:l,geometry:c,duration:u,maneuver:h}=a,d=r?.geometry,f=d&&hl(d,i),m=hl(c,i),g=r&&r?.distance/r?.duration,y=l/u,_=g&&g>=s?.speed?s?.leadDistance:o?.leadDistance,v=y&&y>=s?.speed?s?.leadDistance:o?.leadDistance;let x=d,b=c,w=f&&Math.min(_,f),T=Math.min(v,m);f&&(x=dl(d,Math.max(0,f-_),f,i)?.geometry),T&&(b=dl(c,0,T,i)?.geometry);let k=Math.min(_,f)/f*r?.duration??0,S=Math.min(v,m)/m*u;const C={geometry:x,distance:w,duration:k,maneuver:{bearing_after:h.bearing_before}},E={geometry:b,distance:T,duration:S,maneuver:h};n(0,p=p.concat([{maneuver:h,steps:x?[C,E]:[E],id:`${e}`}]))}})(u):n(0,p=[])),128&t.$$.dirty&&(a||n(1,c=!1)),1&t.$$.dirty&&n(2,f=p.map((e=>{const{type:t,instruction:i}=e.maneuver,n=`${t}: ${i}`;return{id:e.id,text:n}})))},[p,c,f,d,m,g,async()=>{const{id:t,maneuver:i}=p.find((e=>e.id===d));let o=i?.instruction||i?.type;o=`${h}-${t}-${o.toLowerCase().replaceAll(" ","-")}`,n(1,c=!0),await(async t=>{const i=await e();Rl=t.painter.context.gl,Bl=Rl.drawingBufferWidth,Fl=Rl.drawingBufferHeight,Pl=i.create({width:Bl,height:Fl,fps:30,kbps:8e3,rgbFlipY:!0}),Ol=Pl.getRGBPointer()})(r),r.on("render",$l),await g(),r.off("render",$l),(e=>{const t=Pl.end(),i=document.createElement("a");i.href=URL.createObjectURL(new Blob([t],{type:"video/mp4"})),i.download=e,i.click()})(o),n(1,c=!1)},a,l,u,e=>m(e.detail.selectedId)]}class Vl extends ve{constructor(e){super(),_e(this,e,Ul,Nl,l,{routeFlag:7,setRouteFlag:8})}}var Gl={exports:{}};!function(e){e.defineMode("javascript",(function(t,i){var n,r,o=t.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,c=!1!==i.trackScope,u=i.typescript,h=i.wordCharacters||/[\w$\xa1-\uffff]/,d=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),i=e("keyword b"),n=e("keyword c"),r=e("keyword d"),o=e("operator"),s={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:i,do:i,try:i,finally:i,return:r,break:r,continue:r,new:e("new"),delete:n,void:n,throw:n,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:o,typeof:o,instanceof:o,true:s,false:s,null:s,undefined:s,NaN:s,Infinity:s,this:e("this"),class:e("class"),super:e("atom"),yield:n,export:e("export"),import:e("import"),extends:n,await:n}}(),p=/[+\-*&%=<>!?|~^@]/,f=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function m(e){for(var t,i=!1,n=!1;null!=(t=e.next());){if(!i){if("/"==t&&!n)return;"["==t?n=!0:n&&"]"==t&&(n=!1)}i=!i&&"\\"==t}}function g(e,t,i){return n=e,r=i,t}function y(e,t){var i=e.next();if('"'==i||"'"==i)return t.tokenize=_(i),t.tokenize(e,t);if("."==i&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return g("number","number");if("."==i&&e.match(".."))return g("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return g(i);if("="==i&&e.eat(">"))return g("=>","operator");if("0"==i&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return g("number","number");if(/\d/.test(i))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),g("number","number");if("/"==i)return e.eat("*")?(t.tokenize=v,v(e,t)):e.eat("/")?(e.skipToEnd(),g("comment","comment")):rt(e,t,1)?(m(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),g("regexp","string-2")):(e.eat("="),g("operator","operator",e.current()));if("`"==i)return t.tokenize=x,x(e,t);if("#"==i&&"!"==e.peek())return e.skipToEnd(),g("meta","meta");if("#"==i&&e.eatWhile(h))return g("variable","property");if("<"==i&&e.match("!--")||"-"==i&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),g("comment","comment");if(p.test(i))return">"==i&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=i&&"="!=i||e.eat("="):/[<>*+\-|&?]/.test(i)&&(e.eat(i),">"==i&&e.eat(i))),"?"==i&&e.eat(".")?g("."):g("operator","operator",e.current());if(h.test(i)){e.eatWhile(h);var n=e.current();if("."!=t.lastType){if(d.propertyIsEnumerable(n)){var r=d[n];return g(r.type,r.style,n)}if("async"==n&&e.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return g("async","keyword",n)}return g("variable","variable",n)}}function _(e){return function(t,i){var n,r=!1;if(a&&"@"==t.peek()&&t.match(f))return i.tokenize=y,g("jsonld-keyword","meta");for(;null!=(n=t.next())&&(n!=e||r);)r=!r&&"\\"==n;return r||(i.tokenize=y),g("string","string")}}function v(e,t){for(var i,n=!1;i=e.next();){if("/"==i&&n){t.tokenize=y;break}n="*"==i}return g("comment","comment")}function x(e,t){for(var i,n=!1;null!=(i=e.next());){if(!n&&("`"==i||"$"==i&&e.eat("{"))){t.tokenize=y;break}n=!n&&"\\"==i}return g("quasi","string-2",e.current())}var b="([{}])";function w(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var i=e.string.indexOf("=>",e.start);if(!(i<0)){if(u){var n=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,i));n&&(i=n.index)}for(var r=0,o=!1,s=i-1;s>=0;--s){var a=e.string.charAt(s),l=b.indexOf(a);if(l>=0&&l<3){if(!r){++s;break}if(0==--r){"("==a&&(o=!0);break}}else if(l>=3&&l<6)++r;else if(h.test(a))o=!0;else if(/["'\/`]/.test(a))for(;;--s){if(0==s)return;if(e.string.charAt(s-1)==a&&"\\"!=e.string.charAt(s-2)){s--;break}}else if(o&&!r){++s;break}}o&&!r&&(t.fatArrowAt=s)}}var T={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function k(e,t,i,n,r,o){this.indented=e,this.column=t,this.type=i,this.prev=r,this.info=o,null!=n&&(this.align=n)}function S(e,t){if(!c)return!1;for(var i=e.localVars;i;i=i.next)if(i.name==t)return!0;for(var n=e.context;n;n=n.prev)for(i=n.vars;i;i=i.next)if(i.name==t)return!0}function C(e,t,i,n,r){var o=e.cc;for(E.state=e,E.stream=r,E.marked=null,E.cc=o,E.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((o.length?o.pop():l?q:V)(i,n)){for(;o.length&&o[o.length-1].lex;)o.pop()();return E.marked?E.marked:"variable"==i&&S(e,n)?"variable-2":t}}var E={state:null,column:null,marked:null,cc:null};function M(){for(var e=arguments.length-1;e>=0;e--)E.cc.push(arguments[e])}function A(){return M.apply(null,arguments),!0}function z(e,t){for(var i=t;i;i=i.next)if(i.name==e)return!0;return!1}function I(e){var t=E.state;if(E.marked="def",c){if(t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var n=L(e,t.context);if(null!=n)return void(t.context=n)}else if(!z(e,t.localVars))return void(t.localVars=new O(e,t.localVars));i.globalVars&&!z(e,t.globalVars)&&(t.globalVars=new O(e,t.globalVars))}}function L(e,t){if(t){if(t.block){var i=L(e,t.prev);return i?i==t.prev?t:new P(i,t.vars,!0):null}return z(e,t.vars)?t:new P(t.prev,new O(e,t.vars),!1)}return null}function D(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function P(e,t,i){this.prev=e,this.vars=t,this.block=i}function O(e,t){this.name=e,this.next=t}var R=new O("this",new O("arguments",null));function B(){E.state.context=new P(E.state.context,E.state.localVars,!1),E.state.localVars=R}function F(){E.state.context=new P(E.state.context,E.state.localVars,!0),E.state.localVars=null}function $(){E.state.localVars=E.state.context.vars,E.state.context=E.state.context.prev}function j(e,t){var i=function(){var i=E.state,n=i.indented;if("stat"==i.lexical.type)n=i.lexical.indented;else for(var r=i.lexical;r&&")"==r.type&&r.align;r=r.prev)n=r.indented;i.lexical=new k(n,E.stream.column(),e,null,i.lexical,t)};return i.lex=!0,i}function N(){var e=E.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function U(e){function t(i){return i==e?A():";"==e||"}"==i||")"==i||"]"==i?M():A(t)}return t}function V(e,t){return"var"==e?A(j("vardef",t),Me,U(";"),N):"keyword a"==e?A(j("form"),H,V,N):"keyword b"==e?A(j("form"),V,N):"keyword d"==e?E.stream.match(/^\s*$/,!1)?A():A(j("stat"),X,U(";"),N):"debugger"==e?A(U(";")):"{"==e?A(j("}"),F,de,N,$):";"==e?A():"if"==e?("else"==E.state.lexical.info&&E.state.cc[E.state.cc.length-1]==N&&E.state.cc.pop()(),A(j("form"),H,V,N,Pe)):"function"==e?A(Fe):"for"==e?A(j("form"),F,Oe,V,$,N):"class"==e||u&&"interface"==t?(E.marked="keyword",A(j("form","class"==e?e:t),Ve,N)):"variable"==e?u&&"declare"==t?(E.marked="keyword",A(V)):u&&("module"==t||"enum"==t||"type"==t)&&E.stream.match(/^\s*\w/,!1)?(E.marked="keyword","enum"==t?A(tt):"type"==t?A(je,U("operator"),ye,U(";")):A(j("form"),Ae,U("{"),j("}"),de,N,N)):u&&"namespace"==t?(E.marked="keyword",A(j("form"),q,V,N)):u&&"abstract"==t?(E.marked="keyword",A(V)):A(j("stat"),oe):"switch"==e?A(j("form"),H,U("{"),j("}","switch"),F,de,N,N,$):"case"==e?A(q,U(":")):"default"==e?A(U(":")):"catch"==e?A(j("form"),B,G,V,N,$):"export"==e?A(j("stat"),He,N):"import"==e?A(j("stat"),Xe,N):"async"==e?A(V):"@"==t?A(q,V):M(j("stat"),q,U(";"),N)}function G(e){if("("==e)return A(Ne,U(")"))}function q(e,t){return Z(e,t,!1)}function W(e,t){return Z(e,t,!0)}function H(e){return"("!=e?M():A(j(")"),X,U(")"),N)}function Z(e,t,i){if(E.state.fatArrowAt==E.stream.start){var n=i?te:ee;if("("==e)return A(B,j(")"),ue(Ne,")"),N,U("=>"),n,$);if("variable"==e)return M(B,Ae,U("=>"),n,$)}var r=i?Y:K;return T.hasOwnProperty(e)?A(r):"function"==e?A(Fe,r):"class"==e||u&&"interface"==t?(E.marked="keyword",A(j("form"),Ue,N)):"keyword c"==e||"async"==e?A(i?W:q):"("==e?A(j(")"),X,U(")"),N,r):"operator"==e||"spread"==e?A(i?W:q):"["==e?A(j("]"),et,N,r):"{"==e?he(ae,"}",null,r):"quasi"==e?M(J,r):"new"==e?A(ie(i)):A()}function X(e){return e.match(/[;\}\)\],]/)?M():M(q)}function K(e,t){return","==e?A(X):Y(e,t,!1)}function Y(e,t,i){var n=0==i?K:Y,r=0==i?q:W;return"=>"==e?A(B,i?te:ee,$):"operator"==e?/\+\+|--/.test(t)||u&&"!"==t?A(n):u&&"<"==t&&E.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?A(j(">"),ue(ye,">"),N,n):"?"==t?A(q,U(":"),r):A(r):"quasi"==e?M(J,n):";"!=e?"("==e?he(W,")","call",n):"."==e?A(se,n):"["==e?A(j("]"),X,U("]"),N,n):u&&"as"==t?(E.marked="keyword",A(ye,n)):"regexp"==e?(E.state.lastType=E.marked="operator",E.stream.backUp(E.stream.pos-E.stream.start-1),A(r)):void 0:void 0}function J(e,t){return"quasi"!=e?M():"${"!=t.slice(t.length-2)?A(J):A(X,Q)}function Q(e){if("}"==e)return E.marked="string-2",E.state.tokenize=x,A(J)}function ee(e){return w(E.stream,E.state),M("{"==e?V:q)}function te(e){return w(E.stream,E.state),M("{"==e?V:W)}function ie(e){return function(t){return"."==t?A(e?re:ne):"variable"==t&&u?A(Se,e?Y:K):M(e?W:q)}}function ne(e,t){if("target"==t)return E.marked="keyword",A(K)}function re(e,t){if("target"==t)return E.marked="keyword",A(Y)}function oe(e){return":"==e?A(N,V):M(K,U(";"),N)}function se(e){if("variable"==e)return E.marked="property",A()}function ae(e,t){return"async"==e?(E.marked="property",A(ae)):"variable"==e||"keyword"==E.style?(E.marked="property","get"==t||"set"==t?A(le):(u&&E.state.fatArrowAt==E.stream.start&&(i=E.stream.match(/^\s*:\s*/,!1))&&(E.state.fatArrowAt=E.stream.pos+i[0].length),A(ce))):"number"==e||"string"==e?(E.marked=a?"property":E.style+" property",A(ce)):"jsonld-keyword"==e?A(ce):u&&D(t)?(E.marked="keyword",A(ae)):"["==e?A(q,pe,U("]"),ce):"spread"==e?A(W,ce):"*"==t?(E.marked="keyword",A(ae)):":"==e?M(ce):void 0;var i}function le(e){return"variable"!=e?M(ce):(E.marked="property",A(Fe))}function ce(e){return":"==e?A(W):"("==e?M(Fe):void 0}function ue(e,t,i){function n(r,o){if(i?i.indexOf(r)>-1:","==r){var s=E.state.lexical;return"call"==s.info&&(s.pos=(s.pos||0)+1),A((function(i,n){return i==t||n==t?M():M(e)}),n)}return r==t||o==t?A():i&&i.indexOf(";")>-1?M(e):A(U(t))}return function(i,r){return i==t||r==t?A():M(e,n)}}function he(e,t,i){for(var n=3;n<arguments.length;n++)E.cc.push(arguments[n]);return A(j(t,i),ue(e,t),N)}function de(e){return"}"==e?A():M(V,de)}function pe(e,t){if(u){if(":"==e)return A(ye);if("?"==t)return A(pe)}}function fe(e,t){if(u&&(":"==e||"in"==t))return A(ye)}function me(e){if(u&&":"==e)return E.stream.match(/^\s*\w+\s+is\b/,!1)?A(q,ge,ye):A(ye)}function ge(e,t){if("is"==t)return E.marked="keyword",A()}function ye(e,t){return"keyof"==t||"typeof"==t||"infer"==t||"readonly"==t?(E.marked="keyword",A("typeof"==t?W:ye)):"variable"==e||"void"==t?(E.marked="type",A(ke)):"|"==t||"&"==t?A(ye):"string"==e||"number"==e||"atom"==e?A(ke):"["==e?A(j("]"),ue(ye,"]",","),N,ke):"{"==e?A(j("}"),ve,N,ke):"("==e?A(ue(Te,")"),_e,ke):"<"==e?A(ue(ye,">"),ye):"quasi"==e?M(be,ke):void 0}function _e(e){if("=>"==e)return A(ye)}function ve(e){return e.match(/[\}\)\]]/)?A():","==e||";"==e?A(ve):M(xe,ve)}function xe(e,t){return"variable"==e||"keyword"==E.style?(E.marked="property",A(xe)):"?"==t||"number"==e||"string"==e?A(xe):":"==e?A(ye):"["==e?A(U("variable"),fe,U("]"),xe):"("==e?M($e,xe):e.match(/[;\}\)\],]/)?void 0:A()}function be(e,t){return"quasi"!=e?M():"${"!=t.slice(t.length-2)?A(be):A(ye,we)}function we(e){if("}"==e)return E.marked="string-2",E.state.tokenize=x,A(be)}function Te(e,t){return"variable"==e&&E.stream.match(/^\s*[?:]/,!1)||"?"==t?A(Te):":"==e?A(ye):"spread"==e?A(Te):M(ye)}function ke(e,t){return"<"==t?A(j(">"),ue(ye,">"),N,ke):"|"==t||"."==e||"&"==t?A(ye):"["==e?A(ye,U("]"),ke):"extends"==t||"implements"==t?(E.marked="keyword",A(ye)):"?"==t?A(ye,U(":"),ye):void 0}function Se(e,t){if("<"==t)return A(j(">"),ue(ye,">"),N,ke)}function Ce(){return M(ye,Ee)}function Ee(e,t){if("="==t)return A(ye)}function Me(e,t){return"enum"==t?(E.marked="keyword",A(tt)):M(Ae,pe,Le,De)}function Ae(e,t){return u&&D(t)?(E.marked="keyword",A(Ae)):"variable"==e?(I(t),A()):"spread"==e?A(Ae):"["==e?he(Ie,"]"):"{"==e?he(ze,"}"):void 0}function ze(e,t){return"variable"!=e||E.stream.match(/^\s*:/,!1)?("variable"==e&&(E.marked="property"),"spread"==e?A(Ae):"}"==e?M():"["==e?A(q,U("]"),U(":"),ze):A(U(":"),Ae,Le)):(I(t),A(Le))}function Ie(){return M(Ae,Le)}function Le(e,t){if("="==t)return A(W)}function De(e){if(","==e)return A(Me)}function Pe(e,t){if("keyword b"==e&&"else"==t)return A(j("form","else"),V,N)}function Oe(e,t){return"await"==t?A(Oe):"("==e?A(j(")"),Re,N):void 0}function Re(e){return"var"==e?A(Me,Be):"variable"==e?A(Be):M(Be)}function Be(e,t){return")"==e?A():";"==e?A(Be):"in"==t||"of"==t?(E.marked="keyword",A(q,Be)):M(q,Be)}function Fe(e,t){return"*"==t?(E.marked="keyword",A(Fe)):"variable"==e?(I(t),A(Fe)):"("==e?A(B,j(")"),ue(Ne,")"),N,me,V,$):u&&"<"==t?A(j(">"),ue(Ce,">"),N,Fe):void 0}function $e(e,t){return"*"==t?(E.marked="keyword",A($e)):"variable"==e?(I(t),A($e)):"("==e?A(B,j(")"),ue(Ne,")"),N,me,$):u&&"<"==t?A(j(">"),ue(Ce,">"),N,$e):void 0}function je(e,t){return"keyword"==e||"variable"==e?(E.marked="type",A(je)):"<"==t?A(j(">"),ue(Ce,">"),N):void 0}function Ne(e,t){return"@"==t&&A(q,Ne),"spread"==e?A(Ne):u&&D(t)?(E.marked="keyword",A(Ne)):u&&"this"==e?A(pe,Le):M(Ae,pe,Le)}function Ue(e,t){return"variable"==e?Ve(e,t):Ge(e,t)}function Ve(e,t){if("variable"==e)return I(t),A(Ge)}function Ge(e,t){return"<"==t?A(j(">"),ue(Ce,">"),N,Ge):"extends"==t||"implements"==t||u&&","==e?("implements"==t&&(E.marked="keyword"),A(u?ye:q,Ge)):"{"==e?A(j("}"),qe,N):void 0}function qe(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||u&&D(t))&&E.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(E.marked="keyword",A(qe)):"variable"==e||"keyword"==E.style?(E.marked="property",A(We,qe)):"number"==e||"string"==e?A(We,qe):"["==e?A(q,pe,U("]"),We,qe):"*"==t?(E.marked="keyword",A(qe)):u&&"("==e?M($e,qe):";"==e||","==e?A(qe):"}"==e?A():"@"==t?A(q,qe):void 0}function We(e,t){if("!"==t)return A(We);if("?"==t)return A(We);if(":"==e)return A(ye,Le);if("="==t)return A(W);var i=E.state.lexical.prev;return M(i&&"interface"==i.info?$e:Fe)}function He(e,t){return"*"==t?(E.marked="keyword",A(Qe,U(";"))):"default"==t?(E.marked="keyword",A(q,U(";"))):"{"==e?A(ue(Ze,"}"),Qe,U(";")):M(V)}function Ze(e,t){return"as"==t?(E.marked="keyword",A(U("variable"))):"variable"==e?M(W,Ze):void 0}function Xe(e){return"string"==e?A():"("==e?M(q):"."==e?M(K):M(Ke,Ye,Qe)}function Ke(e,t){return"{"==e?he(Ke,"}"):("variable"==e&&I(t),"*"==t&&(E.marked="keyword"),A(Je))}function Ye(e){if(","==e)return A(Ke,Ye)}function Je(e,t){if("as"==t)return E.marked="keyword",A(Ke)}function Qe(e,t){if("from"==t)return E.marked="keyword",A(q)}function et(e){return"]"==e?A():M(ue(W,"]"))}function tt(){return M(j("form"),Ae,U("{"),j("}"),ue(it,"}"),N,N)}function it(){return M(Ae,Le)}function nt(e,t){return"operator"==e.lastType||","==e.lastType||p.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}function rt(e,t,i){return t.tokenize==y&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(i||0)))}return B.lex=F.lex=!0,$.lex=!0,N.lex=!0,{startState:function(e){var t={tokenize:y,lastType:"sof",cc:[],lexical:new k((e||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new P(null,null,!1),indented:e||0};return i.globalVars&&"object"==typeof i.globalVars&&(t.globalVars=i.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),w(e,t)),t.tokenize!=v&&e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==n?i:(t.lastType="operator"!=n||"++"!=r&&"--"!=r?n:"incdec",C(t,i,n,r,e))},indent:function(t,n){if(t.tokenize==v||t.tokenize==x)return e.Pass;if(t.tokenize!=y)return 0;var r,a=n&&n.charAt(0),l=t.lexical;if(!/^\s*else\b/.test(n))for(var c=t.cc.length-1;c>=0;--c){var u=t.cc[c];if(u==N)l=l.prev;else if(u!=Pe&&u!=$)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(r=t.cc[t.cc.length-1])&&(r==K||r==Y)&&!/^[,\.=+\-*:?[\(]/.test(n));)l=l.prev;s&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var h=l.type,d=a==h;return"vardef"==h?l.indented+("operator"==t.lastType||","==t.lastType?l.info.length+1:0):"form"==h&&"{"==a?l.indented:"form"==h?l.indented+o:"stat"==h?l.indented+(nt(t,n)?s||o:0):"switch"!=l.info||d||0==i.doubleIndentSwitch?l.align?l.column+(d?0:1):l.indented+(d?0:o):l.indented+(/^(?:case|default)\b/.test(n)?o:2*o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:rt,skipExpression:function(t){C(t,"atom","atom","true",new e.StringStream("",2,null))}}})),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/manifest+json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}(Gl.exports=function(){var e=navigator.userAgent,t=navigator.platform,i=/gecko\/\d/i.test(e),n=/MSIE \d/.test(e),r=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),o=/Edge\/(\d+)/.exec(e),s=n||r||o,a=s&&(n?document.documentMode||6:+(o||r)[1]),l=!o&&/WebKit\//.test(e),c=l&&/Qt\/\d+\.\d+/.test(e),u=!o&&/Chrome\/(\d+)/.exec(e),h=u&&+u[1],d=/Opera\//.test(e),p=/Apple Computer/.test(navigator.vendor),f=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),m=/PhantomJS/.test(e),g=p&&(/Mobile\/\w+/.test(e)||navigator.maxTouchPoints>2),y=/Android/.test(e),_=g||y||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),v=g||/Mac/.test(t),x=/\bCrOS\b/.test(e),b=/win/i.test(t),w=d&&e.match(/Version\/(\d*\.\d*)/);w&&(w=Number(w[1])),w&&w>=15&&(d=!1,l=!0);var T=v&&(c||d&&(null==w||w<12.11)),k=i||s&&a>=9;function S(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var C,E=function(e,t){var i=e.className,n=S(t).exec(i);if(n){var r=i.slice(n.index+n[0].length);e.className=i.slice(0,n.index)+(r?n[1]+r:"")}};function M(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function A(e,t){return M(e).appendChild(t)}function z(e,t,i,n){var r=document.createElement(e);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function I(e,t,i,n){var r=z(e,t,i,n);return r.setAttribute("role","presentation"),r}function L(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function D(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function P(e,t){var i=e.className;S(t).test(i)||(e.className+=(i?" ":"")+t)}function O(e,t){for(var i=e.split(" "),n=0;n<i.length;n++)i[n]&&!S(i[n]).test(t)&&(t+=" "+i[n]);return t}C=document.createRange?function(e,t,i,n){var r=document.createRange();return r.setEnd(n||e,i),r.setStart(e,t),r}:function(e,t,i){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n};var R=function(e){e.select()};function B(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function F(e,t,i){for(var n in t||(t={}),e)!e.hasOwnProperty(n)||!1===i&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function $(e,t,i,n,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,s=r||0;;){var a=e.indexOf("\t",o);if(a<0||a>=t)return s+(t-o);s+=a-o,s+=i-s%i,o=a+1}}g?R=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:s&&(R=function(e){try{e.select()}catch(e){}});var j=function(){this.id=null,this.f=null,this.time=0,this.handler=B(this.onTimeout,this)};function N(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}j.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},j.prototype.set=function(e,t){this.f=t;var i=+new Date+e;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=i)};var U=50,V={toString:function(){return"CodeMirror.Pass"}},G={scroll:!1},q={origin:"*mouse"},W={origin:"+move"};function H(e,t,i){for(var n=0,r=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var s=o-n;if(o==e.length||r+s>=t)return n+Math.min(s,t-r);if(r+=o-n,n=o+1,(r+=i-r%i)>=t)return n}}var Z=[""];function X(e){for(;Z.length<=e;)Z.push(K(Z)+" ");return Z[e]}function K(e){return e[e.length-1]}function Y(e,t){for(var i=[],n=0;n<e.length;n++)i[n]=t(e[n],n);return i}function J(e,t,i){for(var n=0,r=i(t);n<e.length&&i(e[n])<=r;)n++;e.splice(n,0,t)}function Q(){}function ee(e,t){var i;return Object.create?i=Object.create(e):(Q.prototype=e,i=new Q),t&&F(t,i),i}var te=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ie(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||te.test(e))}function ne(e,t){return t?!!(t.source.indexOf("\\w")>-1&&ie(e))||t.test(e):ie(e)}function re(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var oe=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function se(e){return e.charCodeAt(0)>=768&&oe.test(e)}function ae(e,t,i){for(;(i<0?t>0:t<e.length)&&se(e.charAt(t));)t+=i;return t}function le(e,t,i){for(var n=t>i?-1:1;;){if(t==i)return t;var r=(t+i)/2,o=n<0?Math.ceil(r):Math.floor(r);if(o==t)return e(o)?t:i;e(o)?i=o:t=o+n}}function ce(e,t,i,n){if(!e)return n(t,i,"ltr",0);for(var r=!1,o=0;o<e.length;++o){var s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),r=!0)}r||n(t,i,"ltr")}var ue=null;function he(e,t,i){var n;ue=null;for(var r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==i?n=r:ue=r),o.from==t&&(o.from!=o.to&&"before"!=i?n=r:ue=r)}return null!=n?n:ue}var de=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function i(i){return i<=247?e.charAt(i):1424<=i&&i<=1524?"R":1536<=i&&i<=1785?t.charAt(i-1536):1774<=i&&i<=2220?"r":8192<=i&&i<=8203?"w":8204==i?"b":"L"}var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;function l(e,t,i){this.level=e,this.from=t,this.to=i}return function(e,t){var c="ltr"==t?"L":"R";if(0==e.length||"ltr"==t&&!n.test(e))return!1;for(var u=e.length,h=[],d=0;d<u;++d)h.push(i(e.charCodeAt(d)));for(var p=0,f=c;p<u;++p){var m=h[p];"m"==m?h[p]=f:f=m}for(var g=0,y=c;g<u;++g){var _=h[g];"1"==_&&"r"==y?h[g]="n":o.test(_)&&(y=_,"r"==_&&(h[g]="R"))}for(var v=1,x=h[0];v<u-1;++v){var b=h[v];"+"==b&&"1"==x&&"1"==h[v+1]?h[v]="1":","!=b||x!=h[v+1]||"1"!=x&&"n"!=x||(h[v]=x),x=b}for(var w=0;w<u;++w){var T=h[w];if(","==T)h[w]="N";else if("%"==T){var k=void 0;for(k=w+1;k<u&&"%"==h[k];++k);for(var S=w&&"!"==h[w-1]||k<u&&"1"==h[k]?"1":"N",C=w;C<k;++C)h[C]=S;w=k-1}}for(var E=0,M=c;E<u;++E){var A=h[E];"L"==M&&"1"==A?h[E]="L":o.test(A)&&(M=A)}for(var z=0;z<u;++z)if(r.test(h[z])){var I=void 0;for(I=z+1;I<u&&r.test(h[I]);++I);for(var L="L"==(z?h[z-1]:c),D=L==("L"==(I<u?h[I]:c))?L?"L":"R":c,P=z;P<I;++P)h[P]=D;z=I-1}for(var O,R=[],B=0;B<u;)if(s.test(h[B])){var F=B;for(++B;B<u&&s.test(h[B]);++B);R.push(new l(0,F,B))}else{var $=B,j=R.length,N="rtl"==t?1:0;for(++B;B<u&&"L"!=h[B];++B);for(var U=$;U<B;)if(a.test(h[U])){$<U&&(R.splice(j,0,new l(1,$,U)),j+=N);var V=U;for(++U;U<B&&a.test(h[U]);++U);R.splice(j,0,new l(2,V,U)),j+=N,$=U}else++U;$<B&&R.splice(j,0,new l(1,$,B))}return"ltr"==t&&(1==R[0].level&&(O=e.match(/^\s+/))&&(R[0].from=O[0].length,R.unshift(new l(0,0,O[0].length))),1==K(R).level&&(O=e.match(/\s+$/))&&(K(R).to-=O[0].length,R.push(new l(0,u-O[0].length,u)))),"rtl"==t?R.reverse():R}}();function pe(e,t){var i=e.order;return null==i&&(i=e.order=de(e.text,t)),i}var fe=[],me=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||fe).concat(i)}};function ge(e,t){return e._handlers&&e._handlers[t]||fe}function ye(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var n=e._handlers,r=n&&n[t];if(r){var o=N(r,i);o>-1&&(n[t]=r.slice(0,o).concat(r.slice(o+1)))}}}function _e(e,t){var i=ge(e,t);if(i.length)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)}function ve(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),_e(e,i||t.type,e,t),Se(t)||t.codemirrorIgnore}function xe(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==N(i,t[n])&&i.push(t[n])}function be(e,t){return ge(e,t).length>0}function we(e){e.prototype.on=function(e,t){me(this,e,t)},e.prototype.off=function(e,t){ye(this,e,t)}}function Te(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function ke(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Se(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Ce(e){Te(e),ke(e)}function Ee(e){return e.target||e.srcElement}function Me(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),v&&e.ctrlKey&&1==t&&(t=3),t}var Ae,ze,Ie=function(){if(s&&a<9)return!1;var e=z("div");return"draggable"in e||"dragDrop"in e}();function Le(e){if(null==Ae){var t=z("span","​");A(e,z("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ae=t.offsetWidth<=1&&t.offsetHeight>2&&!(s&&a<8))}var i=Ae?z("span","​"):z("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function De(e){if(null!=ze)return ze;var t=A(e,document.createTextNode("AخA")),i=C(t,0,1).getBoundingClientRect(),n=C(t,1,2).getBoundingClientRect();return M(e),!(!i||i.left==i.right)&&(ze=n.right-i.right<3)}var Pe,Oe=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],n=e.length;t<=n;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var o=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),t+=s+1):(i.push(o),t=r+1)}return i}:function(e){return e.split(/\r\n?|\n/)},Re=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Be="oncopy"in(Pe=z("div"))||(Pe.setAttribute("oncopy","return;"),"function"==typeof Pe.oncopy),Fe=null;function $e(e){if(null!=Fe)return Fe;var t=A(e,z("span","x")),i=t.getBoundingClientRect(),n=C(t,0,1).getBoundingClientRect();return Fe=Math.abs(i.left-n.left)>1}var je={},Ne={};function Ue(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),je[e]=t}function Ve(e,t){Ne[e]=t}function Ge(e){if("string"==typeof e&&Ne.hasOwnProperty(e))e=Ne[e];else if(e&&"string"==typeof e.name&&Ne.hasOwnProperty(e.name)){var t=Ne[e.name];"string"==typeof t&&(t={name:t}),(e=ee(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function qe(e,t){t=Ge(t);var i=je[t.name];if(!i)return qe(e,"text/plain");var n=i(e,t);if(We.hasOwnProperty(t.name)){var r=We[t.name];for(var o in r)r.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=r[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)n[s]=t.modeProps[s];return n}var We={};function He(e,t){F(t,We.hasOwnProperty(e)?We[e]:We[e]={})}function Ze(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var i={};for(var n in t){var r=t[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i}function Xe(e,t){for(var i;e.innerMode&&(i=e.innerMode(t))&&i.mode!=e;)t=i.state,e=i.mode;return i||{mode:e,state:t}}function Ke(e,t,i){return!e.startState||e.startState(t,i)}var Ye=function(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};function Je(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(t<o){i=r;break}t-=o}return i.lines[t]}function Qe(e,t,i){var n=[],r=t.line;return e.iter(t.line,i.line+1,(function(e){var o=e.text;r==i.line&&(o=o.slice(0,i.ch)),r==t.line&&(o=o.slice(t.ch)),n.push(o),++r})),n}function et(e,t,i){var n=[];return e.iter(t,i,(function(e){n.push(e.text)})),n}function tt(e,t){var i=t-e.height;if(i)for(var n=e;n;n=n.parent)n.height+=i}function it(e){if(null==e.parent)return null;for(var t=e.parent,i=N(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var r=0;n.children[r]!=t;++r)i+=n.children[r].chunkSize();return i+t.first}function nt(e,t){var i=e.first;e:do{for(var n=0;n<e.children.length;++n){var r=e.children[n],o=r.height;if(t<o){e=r;continue e}t-=o,i+=r.chunkSize()}return i}while(!e.lines);for(var s=0;s<e.lines.length;++s){var a=e.lines[s].height;if(t<a)break;t-=a}return i+s}function rt(e,t){return t>=e.first&&t<e.first+e.size}function ot(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function st(e,t,i){if(void 0===i&&(i=null),!(this instanceof st))return new st(e,t,i);this.line=e,this.ch=t,this.sticky=i}function at(e,t){return e.line-t.line||e.ch-t.ch}function lt(e,t){return e.sticky==t.sticky&&0==at(e,t)}function ct(e){return st(e.line,e.ch)}function ut(e,t){return at(e,t)<0?t:e}function ht(e,t){return at(e,t)<0?e:t}function dt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function pt(e,t){if(t.line<e.first)return st(e.first,0);var i=e.first+e.size-1;return t.line>i?st(i,Je(e,i).text.length):ft(t,Je(e,t.line).text.length)}function ft(e,t){var i=e.ch;return null==i||i>t?st(e.line,t):i<0?st(e.line,0):e}function mt(e,t){for(var i=[],n=0;n<t.length;n++)i[n]=pt(e,t[n]);return i}Ye.prototype.eol=function(){return this.pos>=this.string.length},Ye.prototype.sol=function(){return this.pos==this.lineStart},Ye.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Ye.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Ye.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},Ye.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},Ye.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},Ye.prototype.skipToEnd=function(){this.pos=this.string.length},Ye.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},Ye.prototype.backUp=function(e){this.pos-=e},Ye.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=$(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?$(this.string,this.lineStart,this.tabSize):0)},Ye.prototype.indentation=function(){return $(this.string,null,this.tabSize)-(this.lineStart?$(this.string,this.lineStart,this.tabSize):0)},Ye.prototype.match=function(e,t,i){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var r=function(e){return i?e.toLowerCase():e};if(r(this.string.substr(this.pos,e.length))==r(e))return!1!==t&&(this.pos+=e.length),!0},Ye.prototype.current=function(){return this.string.slice(this.start,this.pos)},Ye.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},Ye.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},Ye.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var gt=function(e,t){this.state=e,this.lookAhead=t},yt=function(e,t,i,n){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1};function _t(e,t,i,n){var r=[e.state.modeGen],o={};Et(e,t.text,e.doc.mode,i,(function(e,t){return r.push(e,t)}),o,n);for(var s=i.state,a=function(n){i.baseTokens=r;var a=e.state.overlays[n],l=1,c=0;i.state=!0,Et(e,t.text,a.mode,i,(function(e,t){for(var i=l;c<e;){var n=r[l];n>e&&r.splice(l,1,e,r[l+1],n),l+=2,c=Math.min(e,n)}if(t)if(a.opaque)r.splice(i,l-i,e,"overlay "+t),l=i+2;else for(;i<l;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"overlay "+t}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1},l=0;l<e.state.overlays.length;++l)a(l);return{styles:r,classes:o.bgClass||o.textClass?o:null}}function vt(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=xt(e,it(t)),r=t.text.length>e.options.maxHighlightLength&&Ze(e.doc.mode,n.state),o=_t(e,t,n);r&&(n.state=r),t.stateAfter=n.save(!r),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function xt(e,t,i){var n=e.doc,r=e.display;if(!n.mode.startState)return new yt(n,!0,t);var o=Mt(e,t,i),s=o>n.first&&Je(n,o-1).stateAfter,a=s?yt.fromSaved(n,s,o):new yt(n,Ke(n.mode),o);return n.iter(o,t,(function(i){bt(e,i.text,a);var n=a.line;i.stateAfter=n==t-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()})),i&&(n.modeFrontier=a.line),a}function bt(e,t,i,n){var r=e.doc.mode,o=new Ye(t,e.options.tabSize,i);for(o.start=o.pos=n||0,""==t&&wt(r,i.state);!o.eol();)Tt(r,o,i.state),o.start=o.pos}function wt(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var i=Xe(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function Tt(e,t,i,n){for(var r=0;r<10;r++){n&&(n[0]=Xe(e,i).mode);var o=e.token(t,i);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}yt.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},yt.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},yt.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},yt.fromSaved=function(e,t,i){return t instanceof gt?new yt(e,Ze(e.mode,t.state),i,t.lookAhead):new yt(e,Ze(e.mode,t),i)},yt.prototype.save=function(e){var t=!1!==e?Ze(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new gt(t,this.maxLookAhead):t};var kt=function(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i};function St(e,t,i,n){var r,o,s=e.doc,a=s.mode,l=Je(s,(t=pt(s,t)).line),c=xt(e,t.line,i),u=new Ye(l.text,e.options.tabSize,c);for(n&&(o=[]);(n||u.pos<t.ch)&&!u.eol();)u.start=u.pos,r=Tt(a,u,c.state),n&&o.push(new kt(u,r,Ze(s.mode,c.state)));return n?o:new kt(u,r,c.state)}function Ct(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==t[n]?t[n]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(t[n])||(t[n]+=" "+i[2])}return e}function Et(e,t,i,n,r,o,s){var a=i.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,u=null,h=new Ye(t,e.options.tabSize,n),d=e.options.addModeClass&&[null];for(""==t&&Ct(wt(i,n.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(a=!1,s&&bt(e,t,n,h.pos),h.pos=t.length,l=null):l=Ct(Tt(i,h,n.state,d),o),d){var p=d[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||u!=l){for(;c<h.start;)r(c=Math.min(h.start,c+5e3),u);u=l}h.start=h.pos}for(;c<h.pos;){var f=Math.min(h.pos,c+5e3);r(f,u),c=f}}function Mt(e,t,i){for(var n,r,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=Je(o,a-1),c=l.stateAfter;if(c&&(!i||a+(c instanceof gt?c.lookAhead:0)<=o.modeFrontier))return a;var u=$(l.text,null,e.options.tabSize);(null==r||n>u)&&(r=a-1,n=u)}return r}function At(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var i=e.first,n=t-1;n>i;n--){var r=Je(e,n).stateAfter;if(r&&(!(r instanceof gt)||n+r.lookAhead<t)){i=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)}}var zt=!1,It=!1;function Lt(){zt=!0}function Dt(){It=!0}function Pt(e,t,i){this.marker=e,this.from=t,this.to=i}function Ot(e,t){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(n.marker==t)return n}}function Rt(e,t){for(var i,n=0;n<e.length;++n)e[n]!=t&&(i||(i=[])).push(e[n]);return i}function Bt(e,t,i){var n=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));n&&e.markedSpans&&n.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],n&&n.add(e.markedSpans)),t.marker.attachLine(e)}function Ft(e,t,i){var n;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Pt(s,o.from,a?null:o.to))}}return n}function $t(e,t,i){var n;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Pt(s,a?null:o.from-t,null==o.to?null:o.to-t))}}return n}function jt(e,t){if(t.full)return null;var i=rt(e,t.from.line)&&Je(e,t.from.line).markedSpans,n=rt(e,t.to.line)&&Je(e,t.to.line).markedSpans;if(!i&&!n)return null;var r=t.from.ch,o=t.to.ch,s=0==at(t.from,t.to),a=Ft(i,r,s),l=$t(n,o,s),c=1==t.text.length,u=K(t.text).length+(c?r:0);if(a)for(var h=0;h<a.length;++h){var d=a[h];if(null==d.to){var p=Ot(l,d.marker);p?c&&(d.to=null==p.to?null:p.to+u):d.to=r}}if(l)for(var f=0;f<l.length;++f){var m=l[f];null!=m.to&&(m.to+=u),null==m.from?Ot(a,m.marker)||(m.from=u,c&&(a||(a=[])).push(m)):(m.from+=u,c&&(a||(a=[])).push(m))}a&&(a=Nt(a)),l&&l!=a&&(l=Nt(l));var g=[a];if(!c){var y,_=t.text.length-2;if(_>0&&a)for(var v=0;v<a.length;++v)null==a[v].to&&(y||(y=[])).push(new Pt(a[v].marker,null,null));for(var x=0;x<_;++x)g.push(y);g.push(l)}return g}function Nt(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Ut(e,t,i){var n=null;if(e.iter(t.line,i.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||n&&-1!=N(n,i)||(n||(n=[])).push(i)}})),!n)return null;for(var r=[{from:t,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var c=r[l];if(!(at(c.to,a.from)<0||at(c.from,a.to)>0)){var u=[l,1],h=at(c.from,a.from),d=at(c.to,a.to);(h<0||!s.inclusiveLeft&&!h)&&u.push({from:c.from,to:a.from}),(d>0||!s.inclusiveRight&&!d)&&u.push({from:a.to,to:c.to}),r.splice.apply(r,u),l+=u.length-3}}return r}function Vt(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function Gt(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function qt(e){return e.inclusiveLeft?-1:0}function Wt(e){return e.inclusiveRight?1:0}function Ht(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var n=e.find(),r=t.find(),o=at(n.from,r.from)||qt(e)-qt(t);if(o)return-o;var s=at(n.to,r.to)||Wt(e)-Wt(t);return s||t.id-e.id}function Zt(e,t){var i,n=It&&e.markedSpans;if(n)for(var r=void 0,o=0;o<n.length;++o)(r=n[o]).marker.collapsed&&null==(t?r.from:r.to)&&(!i||Ht(i,r.marker)<0)&&(i=r.marker);return i}function Xt(e){return Zt(e,!0)}function Kt(e){return Zt(e,!1)}function Yt(e,t){var i,n=It&&e.markedSpans;if(n)for(var r=0;r<n.length;++r){var o=n[r];o.marker.collapsed&&(null==o.from||o.from<t)&&(null==o.to||o.to>t)&&(!i||Ht(i,o.marker)<0)&&(i=o.marker)}return i}function Jt(e,t,i,n,r){var o=Je(e,t),s=It&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),u=at(c.from,i)||qt(l.marker)-qt(r),h=at(c.to,n)||Wt(l.marker)-Wt(r);if(!(u>=0&&h<=0||u<=0&&h>=0)&&(u<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?at(c.to,i)>=0:at(c.to,i)>0)||u>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?at(c.from,n)<=0:at(c.from,n)<0)))return!0}}}function Qt(e){for(var t;t=Xt(e);)e=t.find(-1,!0).line;return e}function ei(e){for(var t;t=Kt(e);)e=t.find(1,!0).line;return e}function ti(e){for(var t,i;t=Kt(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function ii(e,t){var i=Je(e,t),n=Qt(i);return i==n?t:it(n)}function ni(e,t){if(t>e.lastLine())return t;var i,n=Je(e,t);if(!ri(e,n))return t;for(;i=Kt(n);)n=i.find(1,!0).line;return it(n)+1}function ri(e,t){var i=It&&t.markedSpans;if(i)for(var n=void 0,r=0;r<i.length;++r)if((n=i[r]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&oi(e,t,n))return!0}}function oi(e,t,i){if(null==i.to){var n=i.marker.find(1,!0);return oi(e,n.line,Ot(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var r=void 0,o=0;o<t.markedSpans.length;++o)if((r=t.markedSpans[o]).marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&oi(e,t,r))return!0}function si(e){for(var t=0,i=(e=Qt(e)).parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==e)break;t+=r.height}for(var o=i.parent;o;o=(i=o).parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;t+=a.height}return t}function ai(e){if(0==e.height)return 0;for(var t,i=e.text.length,n=e;t=Xt(n);){var r=t.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=e;t=Kt(n);){var o=t.find(0,!0);i-=n.text.length-o.from.ch,i+=(n=o.to.line).text.length-o.to.ch}return i}function li(e){var t=e.display,i=e.doc;t.maxLine=Je(i,i.first),t.maxLineLength=ai(t.maxLine),t.maxLineChanged=!0,i.iter((function(e){var i=ai(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)}))}var ci=function(e,t,i){this.text=e,Gt(this,t),this.height=i?i(this):1};function ui(e,t,i,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Vt(e),Gt(e,i);var r=n?n(e):1;r!=e.height&&tt(e,r)}function hi(e){e.parent=null,Vt(e)}ci.prototype.lineNo=function(){return it(this)},we(ci);var di={},pi={};function fi(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?pi:di;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function mi(e,t){var i=I("span",null,null,l?"padding-right: .1px":null),n={pre:I("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var r=0;r<=(t.rest?t.rest.length:0);r++){var o=r?t.rest[r-1]:t.line,s=void 0;n.pos=0,n.addToken=yi,De(e.display.measure)&&(s=pe(o,e.doc.direction))&&(n.addToken=vi(n.addToken,s)),n.map=[],bi(o,n,vt(e,o,t!=e.display.externalMeasured&&it(o))),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=O(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=O(o.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Le(e.display.measure))),0==r?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(l){var a=n.content.lastChild;(/\bcm-tab\b/.test(a.className)||a.querySelector&&a.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return _e(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=O(n.pre.className,n.textClass||"")),n}function gi(e){var t=z("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function yi(e,t,i,n,r,o,l){if(t){var c,u=e.splitSpaces?_i(t,e.trailingSpace):t,h=e.cm.state.specialChars,d=!1;if(h.test(t)){c=document.createDocumentFragment();for(var p=0;;){h.lastIndex=p;var f=h.exec(t),m=f?f.index-p:t.length-p;if(m){var g=document.createTextNode(u.slice(p,p+m));s&&a<9?c.appendChild(z("span",[g])):c.appendChild(g),e.map.push(e.pos,e.pos+m,g),e.col+=m,e.pos+=m}if(!f)break;p+=m+1;var y=void 0;if("\t"==f[0]){var _=e.cm.options.tabSize,v=_-e.col%_;(y=c.appendChild(z("span",X(v),"cm-tab"))).setAttribute("role","presentation"),y.setAttribute("cm-text","\t"),e.col+=v}else"\r"==f[0]||"\n"==f[0]?((y=c.appendChild(z("span","\r"==f[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",f[0]),e.col+=1):((y=e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text",f[0]),s&&a<9?c.appendChild(z("span",[y])):c.appendChild(y),e.col+=1);e.map.push(e.pos,e.pos+1,y),e.pos++}}else e.col+=t.length,c=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,c),s&&a<9&&(d=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),i||n||r||d||o||l){var x=i||"";n&&(x+=n),r&&(x+=r);var b=z("span",[c],x,o);if(l)for(var w in l)l.hasOwnProperty(w)&&"style"!=w&&"class"!=w&&b.setAttribute(w,l[w]);return e.content.appendChild(b)}e.content.appendChild(c)}}function _i(e,t){if(e.length>1&&!/  /.test(e))return e;for(var i=t,n="",r=0;r<e.length;r++){var o=e.charAt(r);" "!=o||!i||r!=e.length-1&&32!=e.charCodeAt(r+1)||(o=" "),n+=o,i=" "==o}return n}function vi(e,t){return function(i,n,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=i.pos,u=c+n.length;;){for(var h=void 0,d=0;d<t.length&&!((h=t[d]).to>c&&h.from<=c);d++);if(h.to>=u)return e(i,n,r,o,s,a,l);e(i,n.slice(0,h.to-c),r,o,null,a,l),o=null,n=n.slice(h.to-c),c=h.to}}}function xi(e,t,i,n){var r=!n&&i.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!n&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function bi(e,t,i){var n=e.markedSpans,r=e.text,o=0;if(n)for(var s,a,l,c,u,h,d,p=r.length,f=0,m=1,g="",y=0;;){if(y==f){l=c=u=a="",d=null,h=null,y=1/0;for(var _=[],v=void 0,x=0;x<n.length;++x){var b=n[x],w=b.marker;if("bookmark"==w.type&&b.from==f&&w.widgetNode)_.push(w);else if(b.from<=f&&(null==b.to||b.to>f||w.collapsed&&b.to==f&&b.from==f)){if(null!=b.to&&b.to!=f&&y>b.to&&(y=b.to,c=""),w.className&&(l+=" "+w.className),w.css&&(a=(a?a+";":"")+w.css),w.startStyle&&b.from==f&&(u+=" "+w.startStyle),w.endStyle&&b.to==y&&(v||(v=[])).push(w.endStyle,b.to),w.title&&((d||(d={})).title=w.title),w.attributes)for(var T in w.attributes)(d||(d={}))[T]=w.attributes[T];w.collapsed&&(!h||Ht(h.marker,w)<0)&&(h=b)}else b.from>f&&y>b.from&&(y=b.from)}if(v)for(var k=0;k<v.length;k+=2)v[k+1]==y&&(c+=" "+v[k]);if(!h||h.from==f)for(var S=0;S<_.length;++S)xi(t,0,_[S]);if(h&&(h.from||0)==f){if(xi(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=p)break;for(var C=Math.min(p,y);;){if(g){var E=f+g.length;if(!h){var M=E>C?g.slice(0,C-f):g;t.addToken(t,M,s?s+l:l,u,f+M.length==y?c:"",a,d)}if(E>=C){g=g.slice(C-f),f=C;break}f=E,u=""}g=r.slice(o,o=i[m++]),s=fi(i[m++],t.cm.options)}}else for(var A=1;A<i.length;A+=2)t.addToken(t,r.slice(o,o=i[A]),fi(i[A+1],t.cm.options))}function wi(e,t,i){this.line=t,this.rest=ti(t),this.size=this.rest?it(K(this.rest))-i+1:1,this.node=this.text=null,this.hidden=ri(e,t)}function Ti(e,t,i){for(var n,r=[],o=t;o<i;o=n){var s=new wi(e.doc,Je(e.doc,o),o);n=o+s.size,r.push(s)}return r}var ki=null;function Si(e){ki?ki.ops.push(e):e.ownsGroup=ki={ops:[e],delayedCallbacks:[]}}function Ci(e){var t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(var n=0;n<e.ops.length;n++){var r=e.ops[n];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(i<t.length)}function Ei(e,t){var i=e.ownsGroup;if(i)try{Ci(i)}finally{ki=null,t(i)}}var Mi=null;function Ai(e,t){var i=ge(e,t);if(i.length){var n,r=Array.prototype.slice.call(arguments,2);ki?n=ki.delayedCallbacks:Mi?n=Mi:(n=Mi=[],setTimeout(zi,0));for(var o=function(e){n.push((function(){return i[e].apply(null,r)}))},s=0;s<i.length;++s)o(s)}}function zi(){var e=Mi;Mi=null;for(var t=0;t<e.length;++t)e[t]()}function Ii(e,t,i,n){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];"text"==o?Oi(e,t):"gutter"==o?Bi(e,t,i,n):"class"==o?Ri(e,t):"widget"==o&&Fi(e,t,n)}t.changes=null}function Li(e){return e.node==e.text&&(e.node=z("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),s&&a<8&&(e.node.style.zIndex=2)),e.node}function Di(e,t){var i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){var n=Li(t);t.background=n.insertBefore(z("div",null,i),n.firstChild),e.display.input.setUneditable(t.background)}}function Pi(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):mi(e,t)}function Oi(e,t){var i=t.text.className,n=Pi(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Ri(e,t)):i&&(t.text.className=i)}function Ri(e,t){Di(e,t),t.line.wrapClass?Li(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function Bi(e,t,i,n){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var r=Li(t);t.gutterBackground=z("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),r.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var s=Li(t),a=t.gutter=z("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");if(a.setAttribute("aria-hidden","true"),e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(z("div",ot(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<e.display.gutterSpecs.length;++l){var c=e.display.gutterSpecs[l].className,u=o.hasOwnProperty(c)&&o[c];u&&a.appendChild(z("div",[u],"CodeMirror-gutter-elt","left: "+n.gutterLeft[c]+"px; width: "+n.gutterWidth[c]+"px"))}}}function Fi(e,t,i){t.alignable&&(t.alignable=null);for(var n=S("CodeMirror-linewidget"),r=t.node.firstChild,o=void 0;r;r=o)o=r.nextSibling,n.test(r.className)&&t.node.removeChild(r);ji(e,t,i)}function $i(e,t,i,n){var r=Pi(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),Ri(e,t),Bi(e,t,i,n),ji(e,t,n),t.node}function ji(e,t,i){if(Ni(e,t.line,t,i,!0),t.rest)for(var n=0;n<t.rest.length;n++)Ni(e,t.rest[n],t,i,!1)}function Ni(e,t,i,n,r){if(t.widgets)for(var o=Li(i),s=0,a=t.widgets;s<a.length;++s){var l=a[s],c=z("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Ui(l,c,i,n),e.display.input.setUneditable(c),r&&l.above?o.insertBefore(c,i.gutter||i.text):o.appendChild(c),Ai(l,"redraw")}}function Ui(e,t,i,n){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var r=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(r-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Vi(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!L(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),A(t.display.measure,z("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Gi(e,t){for(var i=Ee(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function qi(e){return e.lineSpace.offsetTop}function Wi(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Hi(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=A(e.measure,z("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(e.cachedPaddingH=n),n}function Zi(e){return U-e.display.nativeBarWidth}function Xi(e){return e.display.scroller.clientWidth-Zi(e)-e.display.barWidth}function Ki(e){return e.display.scroller.clientHeight-Zi(e)-e.display.barHeight}function Yi(e,t,i){var n=e.options.lineWrapping,r=n&&Xi(e);if(!t.measure.heights||n&&t.measure.width!=r){var o=t.measure.heights=[];if(n){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ji(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var r=0;r<e.rest.length;r++)if(it(e.rest[r])>i)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}}function Qi(e,t){var i=it(t=Qt(t)),n=e.display.externalMeasured=new wi(e.doc,t,i);n.lineN=i;var r=n.built=mi(e,n);return n.text=r.pre,A(e.display.lineMeasure,r.pre),n}function en(e,t,i,n){return rn(e,nn(e,t),i,n)}function tn(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Bn(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function nn(e,t){var i=it(t),n=tn(e,i);n&&!n.text?n=null:n&&n.changes&&(Ii(e,n,i,Ln(e)),e.curOp.forceUpdate=!0),n||(n=Qi(e,t));var r=Ji(n,t,i);return{line:t,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function rn(e,t,i,n,r){t.before&&(i=-1);var o,s=i+(n||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Yi(e,t.view,t.rect),t.hasHeights=!0),(o=cn(e,t,i,n)).bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}var on,sn={left:0,right:0,top:0,bottom:0};function an(e,t,i){for(var n,r,o,s,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,o=1,s="left"):t<l?o=1+(r=t-a):(c==e.length-3||t==l&&e[c+3]>t)&&(r=(o=l-a)-1,t>=l&&(s="right")),null!=r){if(n=e[c+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)n=e[2+(c-=3)],s="left";if("right"==i&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)n=e[(c+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function ln(e,t){var i=sn;if("left"==t)for(var n=0;n<e.length&&(i=e[n]).left==i.right;n++);else for(var r=e.length-1;r>=0&&(i=e[r]).left==i.right;r--);return i}function cn(e,t,i,n){var r,o=an(t.map,i,n),l=o.node,c=o.start,u=o.end,h=o.collapse;if(3==l.nodeType){for(var d=0;d<4;d++){for(;c&&se(t.line.text.charAt(o.coverStart+c));)--c;for(;o.coverStart+u<o.coverEnd&&se(t.line.text.charAt(o.coverStart+u));)++u;if((r=s&&a<9&&0==c&&u==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():ln(C(l,c,u).getClientRects(),n)).left||r.right||0==c)break;u=c,c-=1,h="right"}s&&a<11&&(r=un(e.display.measure,r))}else{var p;c>0&&(h=n="right"),r=e.options.lineWrapping&&(p=l.getClientRects()).length>1?p["right"==n?p.length-1:0]:l.getBoundingClientRect()}if(s&&a<9&&!c&&(!r||!r.left&&!r.right)){var f=l.parentNode.getClientRects()[0];r=f?{left:f.left,right:f.left+In(e.display),top:f.top,bottom:f.bottom}:sn}for(var m=r.top-t.rect.top,g=r.bottom-t.rect.top,y=(m+g)/2,_=t.view.measure.heights,v=0;v<_.length-1&&!(y<_[v]);v++);var x=v?_[v-1]:0,b=_[v],w={left:("right"==h?r.right:r.left)-t.rect.left,right:("left"==h?r.left:r.right)-t.rect.left,top:x,bottom:b};return r.left||r.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=m,w.rbottom=g),w}function un(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!$e(e))return t;var i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*n,bottom:t.bottom*n}}function hn(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function dn(e){e.display.externalMeasure=null,M(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)hn(e.display.view[t])}function pn(e){dn(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function fn(){return u&&y?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function mn(){return u&&y?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function gn(e){var t=Qt(e).widgets,i=0;if(t)for(var n=0;n<t.length;++n)t[n].above&&(i+=Vi(t[n]));return i}function yn(e,t,i,n,r){if(!r){var o=gn(t);i.top+=o,i.bottom+=o}if("line"==n)return i;n||(n="local");var s=si(t);if("local"==n?s+=qi(e.display):s-=e.display.viewOffset,"page"==n||"window"==n){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==n?0:mn());var l=a.left+("window"==n?0:fn());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function _n(e,t,i){if("div"==i)return t;var n=t.left,r=t.top;if("page"==i)n-=fn(),r-=mn();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function vn(e,t,i,n,r){return n||(n=Je(e.doc,t.line)),yn(e,n,en(e,n,t.ch,r),i)}function xn(e,t,i,n,r,o){function s(t,s){var a=rn(e,r,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,yn(e,n,a,i)}n=n||Je(e.doc,t.line),r||(r=nn(e,n));var a=pe(n,e.doc.direction),l=t.ch,c=t.sticky;if(l>=n.text.length?(l=n.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(e,t,i){return s(i?e-1:e,1==a[t].level!=i)}var h=he(a,l,c),d=ue,p=u(l,h,"before"==c);return null!=d&&(p.other=u(l,d,"before"!=c)),p}function bn(e,t){var i=0;t=pt(e.doc,t),e.options.lineWrapping||(i=In(e.display)*t.ch);var n=Je(e.doc,t.line),r=si(n)+qi(e.display);return{left:i,right:i,top:r,bottom:r+n.height}}function wn(e,t,i,n,r){var o=st(e,t,i);return o.xRel=r,n&&(o.outside=n),o}function Tn(e,t,i){var n=e.doc;if((i+=e.display.viewOffset)<0)return wn(n.first,0,null,-1,-1);var r=nt(n,i),o=n.first+n.size-1;if(r>o)return wn(n.first+n.size-1,Je(n,o).text.length,null,1,1);t<0&&(t=0);for(var s=Je(n,r);;){var a=En(e,s,r,t,i),l=Yt(s,a.ch+(a.xRel>0||a.outside>0?1:0));if(!l)return a;var c=l.find(1);if(c.line==r)return c;s=Je(n,r=c.line)}}function kn(e,t,i,n){n-=gn(t);var r=t.text.length,o=le((function(t){return rn(e,i,t-1).bottom<=n}),r,0);return{begin:o,end:r=le((function(t){return rn(e,i,t).top>n}),o,r)}}function Sn(e,t,i,n){return i||(i=nn(e,t)),kn(e,t,i,yn(e,t,rn(e,i,n),"line").top)}function Cn(e,t,i,n){return!(e.bottom<=i)&&(e.top>i||(n?e.left:e.right)>t)}function En(e,t,i,n,r){r-=si(t);var o=nn(e,t),s=gn(t),a=0,l=t.text.length,c=!0,u=pe(t,e.doc.direction);if(u){var h=(e.options.lineWrapping?An:Mn)(e,t,i,o,u,n,r);a=(c=1!=h.level)?h.from:h.to-1,l=c?h.to:h.from-1}var d,p,f=null,m=null,g=le((function(t){var i=rn(e,o,t);return i.top+=s,i.bottom+=s,!!Cn(i,n,r,!1)&&(i.top<=r&&i.left<=n&&(f=t,m=i),!0)}),a,l),y=!1;if(m){var _=n-m.left<m.right-n,v=_==c;g=f+(v?0:1),p=v?"after":"before",d=_?m.left:m.right}else{c||g!=l&&g!=a||g++,p=0==g?"after":g==t.text.length?"before":rn(e,o,g-(c?1:0)).bottom+s<=r==c?"after":"before";var x=xn(e,st(i,g,p),"line",t,o);d=x.left,y=r<x.top?-1:r>=x.bottom?1:0}return wn(i,g=ae(t.text,g,1),p,y,n-d)}function Mn(e,t,i,n,r,o,s){var a=le((function(a){var l=r[a],c=1!=l.level;return Cn(xn(e,st(i,c?l.to:l.from,c?"before":"after"),"line",t,n),o,s,!0)}),0,r.length-1),l=r[a];if(a>0){var c=1!=l.level,u=xn(e,st(i,c?l.from:l.to,c?"after":"before"),"line",t,n);Cn(u,o,s,!0)&&u.top>s&&(l=r[a-1])}return l}function An(e,t,i,n,r,o,s){var a=kn(e,t,n,s),l=a.begin,c=a.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var u=null,h=null,d=0;d<r.length;d++){var p=r[d];if(!(p.from>=c||p.to<=l)){var f=rn(e,n,1!=p.level?Math.min(c,p.to)-1:Math.max(l,p.from)).right,m=f<o?o-f+1e9:f-o;(!u||h>m)&&(u=p,h=m)}}return u||(u=r[r.length-1]),u.from<l&&(u={from:l,to:u.to,level:u.level}),u.to>c&&(u={from:u.from,to:c,level:u.level}),u}function zn(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==on){on=z("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)on.appendChild(document.createTextNode("x")),on.appendChild(z("br"));on.appendChild(document.createTextNode("x"))}A(e.measure,on);var i=on.offsetHeight/50;return i>3&&(e.cachedTextHeight=i),M(e.measure),i||1}function In(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=z("span","xxxxxxxxxx"),i=z("pre",[t],"CodeMirror-line-like");A(e.measure,i);var n=t.getBoundingClientRect(),r=(n.right-n.left)/10;return r>2&&(e.cachedCharWidth=r),r||10}function Ln(e){for(var t=e.display,i={},n={},r=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var a=e.display.gutterSpecs[s].className;i[a]=o.offsetLeft+o.clientLeft+r,n[a]=o.clientWidth}return{fixedPos:Dn(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function Dn(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Pn(e){var t=zn(e.display),i=e.options.lineWrapping,n=i&&Math.max(5,e.display.scroller.clientWidth/In(e.display)-3);return function(r){if(ri(e.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*t:o+t}}function On(e){var t=e.doc,i=Pn(e);t.iter((function(e){var t=i(e);t!=e.height&&tt(e,t)}))}function Rn(e,t,i,n){var r=e.display;if(!i&&"true"==Ee(t).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(e){return null}var l,c=Tn(e,o,s);if(n&&c.xRel>0&&(l=Je(e.doc,c.line).text).length==c.ch){var u=$(l,l.length,e.options.tabSize)-l.length;c=st(c.line,Math.max(0,Math.round((o-Hi(e.display).left)/In(e.display))-u))}return c}function Bn(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var i=e.display.view,n=0;n<i.length;n++)if((t-=i[n].size)<0)return n}function Fn(e,t,i,n){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),n||(n=0);var r=e.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)It&&ii(e.doc,t)<r.viewTo&&jn(e);else if(i<=r.viewFrom)It&&ni(e.doc,i+n)>r.viewFrom?jn(e):(r.viewFrom+=n,r.viewTo+=n);else if(t<=r.viewFrom&&i>=r.viewTo)jn(e);else if(t<=r.viewFrom){var o=Nn(e,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):jn(e)}else if(i>=r.viewTo){var s=Nn(e,t,t,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):jn(e)}else{var a=Nn(e,t,t,-1),l=Nn(e,i,i+n,1);a&&l?(r.view=r.view.slice(0,a.index).concat(Ti(e,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=n):jn(e)}var c=r.externalMeasured;c&&(i<c.lineN?c.lineN+=n:t<c.lineN+c.size&&(r.externalMeasured=null))}function $n(e,t,i){e.curOp.viewChanged=!0;var n=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Bn(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==N(s,i)&&s.push(i)}}}function jn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function Nn(e,t,i,n){var r,o=Bn(e,t),s=e.display.view;if(!It||i==e.doc.first+e.doc.size)return{index:o,lineN:i};for(var a=e.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=t){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-t,o++}else r=a-t;t+=r,i+=r}for(;ii(e.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function Un(e,t,i){var n=e.display;0==n.view.length||t>=n.viewTo||i<=n.viewFrom?(n.view=Ti(e,t,i),n.viewFrom=t):(n.viewFrom>t?n.view=Ti(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Bn(e,t))),n.viewFrom=t,n.viewTo<i?n.view=n.view.concat(Ti(e,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,Bn(e,i)))),n.viewTo=i}function Vn(e){for(var t=e.display.view,i=0,n=0;n<t.length;n++){var r=t[n];r.hidden||r.node&&!r.changes||++i}return i}function Gn(e){e.display.input.showSelection(e.display.input.prepareSelection())}function qn(e,t){void 0===t&&(t=!0);var i=e.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(var a=0;a<i.sel.ranges.length;a++)if(t||a!=i.sel.primIndex){var l=i.sel.ranges[a];if(!(l.from().line>=e.display.viewTo||l.to().line<e.display.viewFrom)){var c=l.empty();if(s){var u=s(e,l);u&&Wn(e,u,r)}else(c||e.options.showCursorWhenSelecting)&&Wn(e,l.head,r);c||Zn(e,l,o)}}return n}function Wn(e,t,i){var n=xn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),r=i.appendChild(z("div"," ","CodeMirror-cursor"));if(r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=vn(e,t,"div",null,null),s=o.right-o.left;r.style.width=(s>0?s:e.defaultCharWidth())+"px"}if(n.other){var a=i.appendChild(z("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));a.style.display="",a.style.left=n.other.left+"px",a.style.top=n.other.top+"px",a.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function Hn(e,t){return e.top-t.top||e.left-t.left}function Zn(e,t,i){var n=e.display,r=e.doc,o=document.createDocumentFragment(),s=Hi(e.display),a=s.left,l=Math.max(n.sizerWidth,Xi(e)-n.sizer.offsetLeft)-s.right,c="ltr"==r.direction;function u(e,t,i,n){t<0&&(t=0),t=Math.round(t),n=Math.round(n),o.appendChild(z("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==i?l-e:i)+"px;\n                             height: "+(n-t)+"px"))}function h(t,i,n){var o,s,h=Je(r,t),d=h.text.length;function p(i,n){return vn(e,st(t,i),"div",h,n)}function f(t,i,n){var r=Sn(e,h,null,t),o="ltr"==i==("after"==n)?"left":"right";return p("after"==n?r.begin:r.end-(/\s/.test(h.text.charAt(r.end-1))?2:1),o)[o]}var m=pe(h,r.direction);return ce(m,i||0,null==n?d:n,(function(e,t,r,h){var g="ltr"==r,y=p(e,g?"left":"right"),_=p(t-1,g?"right":"left"),v=null==i&&0==e,x=null==n&&t==d,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){var T=(c?x:v)&&w,k=(c?v:x)&&b?a:(g?y:_).left,S=T?l:(g?_:y).right;u(k,y.top,S-k,y.bottom)}else{var C,E,M,A;g?(C=c&&v&&b?a:y.left,E=c?l:f(e,r,"before"),M=c?a:f(t,r,"after"),A=c&&x&&w?l:_.right):(C=c?f(e,r,"before"):a,E=!c&&v&&b?l:y.right,M=!c&&x&&w?a:_.left,A=c?f(t,r,"after"):l),u(C,y.top,E-C,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(M,_.top,A-M,_.bottom)}(!o||Hn(y,o)<0)&&(o=y),Hn(_,o)<0&&(o=_),(!s||Hn(y,s)<0)&&(s=y),Hn(_,s)<0&&(s=_)})),{start:o,end:s}}var d=t.from(),p=t.to();if(d.line==p.line)h(d.line,d.ch,p.ch);else{var f=Je(r,d.line),m=Je(r,p.line),g=Qt(f)==Qt(m),y=h(d.line,d.ch,g?f.text.length+1:null).end,_=h(p.line,g?0:null,p.ch).start;g&&(y.top<_.top-2?(u(y.right,y.top,null,y.bottom),u(a,_.top,_.left,_.bottom)):u(y.right,y.top,_.left-y.right,y.bottom)),y.bottom<_.top&&u(a,y.bottom,null,_.top)}i.appendChild(o)}function Xn(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((function(){e.hasFocus()||Qn(e),t.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Kn(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||Jn(e))}function Yn(e){e.state.delayingBlurEvent=!0,setTimeout((function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&Qn(e))}),100)}function Jn(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(_e(e,"focus",e,t),e.state.focused=!0,P(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),l&&setTimeout((function(){return e.display.input.reset(!0)}),20)),e.display.input.receivedFocus()),Xn(e))}function Qn(e,t){e.state.delayingBlurEvent||(e.state.focused&&(_e(e,"blur",e,t),e.state.focused=!1,E(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150))}function er(e){for(var t=e.display,i=t.lineDiv.offsetTop,n=Math.max(0,t.scroller.getBoundingClientRect().top),r=t.lineDiv.getBoundingClientRect().top,o=0,l=0;l<t.view.length;l++){var c=t.view[l],u=e.options.lineWrapping,h=void 0,d=0;if(!c.hidden){if(r+=c.line.height,s&&a<8){var p=c.node.offsetTop+c.node.offsetHeight;h=p-i,i=p}else{var f=c.node.getBoundingClientRect();h=f.bottom-f.top,!u&&c.text.firstChild&&(d=c.text.firstChild.getBoundingClientRect().right-f.left-1)}var m=c.line.height-h;if((m>.005||m<-.005)&&(r<n&&(o-=m),tt(c.line,h),tr(c.line),c.rest))for(var g=0;g<c.rest.length;g++)tr(c.rest[g]);if(d>e.display.sizerWidth){var y=Math.ceil(d/In(e.display));y>e.display.maxLineLength&&(e.display.maxLineLength=y,e.display.maxLine=c.line,e.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function tr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var i=e.widgets[t],n=i.node.parentNode;n&&(i.height=n.offsetHeight)}}function ir(e,t,i){var n=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;n=Math.floor(n-qi(e));var r=i&&null!=i.bottom?i.bottom:n+e.wrapper.clientHeight,o=nt(t,n),s=nt(t,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=nt(t,si(Je(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=s&&(o=nt(t,si(Je(t,l))-e.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function nr(e,t){if(!ve(e,"scrollCursorIntoView")){var i=e.display,n=i.sizer.getBoundingClientRect(),r=null;if(t.top+n.top<0?r=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!m){var o=z("div","​",null,"position: absolute;\n                         top: "+(t.top-i.viewOffset-qi(e.display))+"px;\n                         height: "+(t.bottom-t.top+Zi(e)+i.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(r),e.display.lineSpace.removeChild(o)}}}function rr(e,t,i,n){var r;null==n&&(n=0),e.options.lineWrapping||t!=i||(i="before"==t.sticky?st(t.line,t.ch+1,"before"):t,t=t.ch?st(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t);for(var o=0;o<5;o++){var s=!1,a=xn(e,t),l=i&&i!=t?xn(e,i):a,c=sr(e,r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-n,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+n}),u=e.doc.scrollTop,h=e.doc.scrollLeft;if(null!=c.scrollTop&&(pr(e,c.scrollTop),Math.abs(e.doc.scrollTop-u)>1&&(s=!0)),null!=c.scrollLeft&&(mr(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-h)>1&&(s=!0)),!s)break}return r}function or(e,t){var i=sr(e,t);null!=i.scrollTop&&pr(e,i.scrollTop),null!=i.scrollLeft&&mr(e,i.scrollLeft)}function sr(e,t){var i=e.display,n=zn(e.display);t.top<0&&(t.top=0);var r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=Ki(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var a=e.doc.height+Wi(i),l=t.top<n,c=t.bottom>a-n;if(t.top<r)s.scrollTop=l?0:t.top;else if(t.bottom>r+o){var u=Math.min(t.top,(c?a:t.bottom)-o);u!=r&&(s.scrollTop=u)}var h=e.options.fixedGutter?0:i.gutters.offsetWidth,d=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft-h,p=Xi(e)-i.gutters.offsetWidth,f=t.right-t.left>p;return f&&(t.right=t.left+p),t.left<10?s.scrollLeft=0:t.left<d?s.scrollLeft=Math.max(0,t.left+h-(f?0:10)):t.right>p+d-3&&(s.scrollLeft=t.right+(f?0:10)-p),s}function ar(e,t){null!=t&&(hr(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function lr(e){hr(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function cr(e,t,i){null==t&&null==i||hr(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function ur(e,t){hr(e),e.curOp.scrollToPos=t}function hr(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,dr(e,bn(e,t.from),bn(e,t.to),t.margin))}function dr(e,t,i,n){var r=sr(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-n,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+n});cr(e,r.scrollLeft,r.scrollTop)}function pr(e,t){Math.abs(e.doc.scrollTop-t)<2||(i||Gr(e,{top:t}),fr(e,t,!0),i&&Gr(e),Rr(e,100))}function fr(e,t,i){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function mr(e,t,i,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,Zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function gr(e){var t=e.display,i=t.gutters.offsetWidth,n=Math.round(e.doc.height+Wi(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+Zi(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}var yr=function(e,t,i){this.cm=i;var n=this.vert=z("div",[z("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=z("div",[z("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=r.tabIndex=-1,e(n),e(r),me(n,"scroll",(function(){n.clientHeight&&t(n.scrollTop,"vertical")})),me(r,"scroll",(function(){r.clientWidth&&t(r.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,s&&a<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};yr.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var r=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+r)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:t?n:0}},yr.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},yr.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},yr.prototype.zeroWidthHack=function(){var e=v&&!f?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new j,this.disableVert=new j},yr.prototype.enableZeroWidthBar=function(e,t,i){function n(){var r=e.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},yr.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var _r=function(){};function vr(e,t){t||(t=gr(e));var i=e.display.barWidth,n=e.display.barHeight;xr(e,t);for(var r=0;r<4&&i!=e.display.barWidth||n!=e.display.barHeight;r++)i!=e.display.barWidth&&e.options.lineWrapping&&er(e),xr(e,gr(e)),i=e.display.barWidth,n=e.display.barHeight}function xr(e,t){var i=e.display,n=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}_r.prototype.update=function(){return{bottom:0,right:0}},_r.prototype.setScrollLeft=function(){},_r.prototype.setScrollTop=function(){},_r.prototype.clear=function(){};var br={native:yr,null:_r};function wr(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&E(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new br[e.options.scrollbarStyle]((function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),me(t,"mousedown",(function(){e.state.focused&&setTimeout((function(){return e.display.input.focus()}),0)})),t.setAttribute("cm-not-content","true")}),(function(t,i){"horizontal"==i?mr(e,t):pr(e,t)}),e),e.display.scrollbars.addClass&&P(e.display.wrapper,e.display.scrollbars.addClass)}var Tr=0;function kr(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Tr,markArrays:null},Si(e.curOp)}function Sr(e){var t=e.curOp;t&&Ei(t,(function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;Cr(e)}))}function Cr(e){for(var t=e.ops,i=0;i<t.length;i++)Er(t[i]);for(var n=0;n<t.length;n++)Mr(t[n]);for(var r=0;r<t.length;r++)Ar(t[r]);for(var o=0;o<t.length;o++)zr(t[o]);for(var s=0;s<t.length;s++)Ir(t[s])}function Er(e){var t=e.cm,i=t.display;$r(t),e.updateMaxLine&&li(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Fr(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Mr(e){e.updatedDisplay=e.mustUpdate&&Ur(e.cm,e.update)}function Ar(e){var t=e.cm,i=t.display;e.updatedDisplay&&er(t),e.barMeasure=gr(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=en(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+Zi(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-Xi(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection())}function zr(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&mr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var i=e.focus&&e.focus==D();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&vr(t,e.barMeasure),e.updatedDisplay&&Hr(t,e.barMeasure),e.selectionChanged&&Xn(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&Kn(e.cm)}function Ir(e){var t=e.cm,i=t.display,n=t.doc;e.updatedDisplay&&Vr(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&fr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&mr(t,e.scrollLeft,!0,!0),e.scrollToPos&&nr(t,rr(t,pt(n,e.scrollToPos.from),pt(n,e.scrollToPos.to),e.scrollToPos.margin));var r=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||_e(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&_e(o[a],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&_e(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Lr(e,t){if(e.curOp)return t();kr(e);try{return t()}finally{Sr(e)}}function Dr(e,t){return function(){if(e.curOp)return t.apply(e,arguments);kr(e);try{return t.apply(e,arguments)}finally{Sr(e)}}}function Pr(e){return function(){if(this.curOp)return e.apply(this,arguments);kr(this);try{return e.apply(this,arguments)}finally{Sr(this)}}}function Or(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);kr(t);try{return e.apply(this,arguments)}finally{Sr(t)}}}function Rr(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,B(Br,e))}function Br(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var i=+new Date+e.options.workTime,n=xt(e,t.highlightFrontier),r=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),(function(o){if(n.line>=e.display.viewFrom){var s=o.styles,a=o.text.length>e.options.maxHighlightLength?Ze(t.mode,n.state):null,l=_t(e,o,n,!0);a&&(n.state=a),o.styles=l.styles;var c=o.styleClasses,u=l.classes;u?o.styleClasses=u:c&&(o.styleClasses=null);for(var h=!s||s.length!=o.styles.length||c!=u&&(!c||!u||c.bgClass!=u.bgClass||c.textClass!=u.textClass),d=0;!h&&d<s.length;++d)h=s[d]!=o.styles[d];h&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&bt(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return Rr(e,e.options.workDelay),!0})),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),r.length&&Lr(e,(function(){for(var t=0;t<r.length;t++)$n(e,r[t],"text")}))}}var Fr=function(e,t,i){var n=e.display;this.viewport=t,this.visible=ir(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Xi(e),this.force=i,this.dims=Ln(e),this.events=[]};function $r(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Zi(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Zi(e)+"px",t.scrollbarsClipped=!0)}function jr(e){if(e.hasFocus())return null;var t=D();if(!t||!L(e.display.lineDiv,t))return null;var i={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&L(e.display.lineDiv,n.anchorNode)&&(i.anchorNode=n.anchorNode,i.anchorOffset=n.anchorOffset,i.focusNode=n.focusNode,i.focusOffset=n.focusOffset)}return i}function Nr(e){if(e&&e.activeElt&&e.activeElt!=D()&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&L(document.body,e.anchorNode)&&L(document.body,e.focusNode))){var t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}function Ur(e,t){var i=e.display,n=e.doc;if(t.editorIsHidden)return jn(e),!1;if(!t.force&&t.visible.from>=i.viewFrom&&t.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==Vn(e))return!1;Xr(e)&&(jn(e),t.dims=Ln(e));var r=n.first+n.size,o=Math.max(t.visible.from-e.options.viewportMargin,n.first),s=Math.min(r,t.visible.to+e.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(n.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(r,i.viewTo)),It&&(o=ii(e.doc,o),s=ni(e.doc,s));var a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=t.wrapperHeight||i.lastWrapWidth!=t.wrapperWidth;Un(e,o,s),i.viewOffset=si(Je(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";var l=Vn(e);if(!a&&0==l&&!t.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var c=jr(e);return l>4&&(i.lineDiv.style.display="none"),qr(e,i.updateLineNumbers,t.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,Nr(c),M(i.cursorDiv),M(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=t.wrapperHeight,i.lastWrapWidth=t.wrapperWidth,Rr(e,400)),i.updateLineNumbers=null,!0}function Vr(e,t){for(var i=t.viewport,n=!0;;n=!1){if(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Xi(e))n&&(t.visible=ir(e.display,e.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(e.doc.height+Wi(e.display)-Ki(e),i.top)}),t.visible=ir(e.display,e.doc,i),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!Ur(e,t))break;er(e);var r=gr(e);Gn(e),vr(e,r),Hr(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Gr(e,t){var i=new Fr(e,t);if(Ur(e,i)){er(e),Vr(e,i);var n=gr(e);Gn(e),vr(e,n),Hr(e,n),i.finish()}}function qr(e,t,i){var n=e.display,r=e.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function a(t){var i=t.nextSibling;return l&&v&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var c=n.view,u=n.viewFrom,h=0;h<c.length;h++){var d=c[h];if(d.hidden);else if(d.node&&d.node.parentNode==o){for(;s!=d.node;)s=a(s);var p=r&&null!=t&&t<=u&&d.lineNumber;d.changes&&(N(d.changes,"gutter")>-1&&(p=!1),Ii(e,d,u,i)),p&&(M(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(ot(e.options,u)))),s=d.node.nextSibling}else{var f=$i(e,d,u,i);o.insertBefore(f,s)}u+=d.size}for(;s;)s=a(s)}function Wr(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",Ai(e,"gutterChanged",e)}function Hr(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Zi(e)+"px"}function Zr(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=Dn(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){e.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}}function Xr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=ot(e.options,t.first+t.size-1),n=e.display;if(i.length!=n.lineNumChars){var r=n.measure.appendChild(z("div",[z("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s)+1,n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",Wr(e.display),!0}return!1}function Kr(e,t){for(var i=[],n=!1,r=0;r<e.length;r++){var o=e[r],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;n=!0}i.push({className:o,style:s})}return t&&!n&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function Yr(e){var t=e.gutters,i=e.gutterSpecs;M(t),e.lineGutter=null;for(var n=0;n<i.length;++n){var r=i[n],o=r.className,s=r.style,a=t.appendChild(z("div",null,"CodeMirror-gutter "+o));s&&(a.style.cssText=s),"CodeMirror-linenumbers"==o&&(e.lineGutter=a,a.style.width=(e.lineNumWidth||1)+"px")}t.style.display=i.length?"":"none",Wr(e)}function Jr(e){Yr(e.display),Fn(e),Zr(e)}function Qr(e,t,n,r){var o=this;this.input=n,o.scrollbarFiller=z("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=z("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=I("div",null,"CodeMirror-code"),o.selectionDiv=z("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=z("div",null,"CodeMirror-cursors"),o.measure=z("div",null,"CodeMirror-measure"),o.lineMeasure=z("div",null,"CodeMirror-measure"),o.lineSpace=I("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var c=I("div",[o.lineSpace],"CodeMirror-lines");o.mover=z("div",[c],null,"position: relative"),o.sizer=z("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=z("div",null,null,"position: absolute; height: "+U+"px; width: 1px;"),o.gutters=z("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=z("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=z("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),o.wrapper.setAttribute("translate","no"),s&&a<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),l||i&&_||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=Kr(r.gutters,r.lineNumbers),Yr(o),n.init(o)}Fr.prototype.signal=function(e,t){be(e,t)&&this.events.push(arguments)},Fr.prototype.finish=function(){for(var e=0;e<this.events.length;e++)_e.apply(null,this.events[e])};var eo=0,to=null;function io(e){var t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function no(e){var t=io(e);return t.x*=to,t.y*=to,t}function ro(e,t){u&&h>=102&&(null==e.display.chromeScrollHack?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout((function(){e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""}),100));var n=io(t),r=n.x,o=n.y,s=to;0===t.deltaMode&&(r=t.deltaX,o=t.deltaY,s=1);var a=e.display,c=a.scroller,p=c.scrollWidth>c.clientWidth,f=c.scrollHeight>c.clientHeight;if(r&&p||o&&f){if(o&&v&&l)e:for(var m=t.target,g=a.view;m!=c;m=m.parentNode)for(var y=0;y<g.length;y++)if(g[y].node==m){e.display.currentWheelTarget=m;break e}if(r&&!i&&!d&&null!=s)return o&&f&&pr(e,Math.max(0,c.scrollTop+o*s)),mr(e,Math.max(0,c.scrollLeft+r*s)),(!o||o&&f)&&Te(t),void(a.wheelStartX=null);if(o&&null!=s){var _=o*s,x=e.doc.scrollTop,b=x+a.wrapper.clientHeight;_<0?x=Math.max(0,x+_-50):b=Math.min(e.doc.height,b+_+50),Gr(e,{top:x,bottom:b})}eo<20&&0!==t.deltaMode&&(null==a.wheelStartX?(a.wheelStartX=c.scrollLeft,a.wheelStartY=c.scrollTop,a.wheelDX=r,a.wheelDY=o,setTimeout((function(){if(null!=a.wheelStartX){var e=c.scrollLeft-a.wheelStartX,t=c.scrollTop-a.wheelStartY,i=t&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX;a.wheelStartX=a.wheelStartY=null,i&&(to=(to*eo+i)/(eo+1),++eo)}}),200)):(a.wheelDX+=r,a.wheelDY+=o))}}s?to=-.53:i?to=15:u?to=-.7:p&&(to=-1/3);var oo=function(e,t){this.ranges=e,this.primIndex=t};oo.prototype.primary=function(){return this.ranges[this.primIndex]},oo.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var i=this.ranges[t],n=e.ranges[t];if(!lt(i.anchor,n.anchor)||!lt(i.head,n.head))return!1}return!0},oo.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new so(ct(this.ranges[t].anchor),ct(this.ranges[t].head));return new oo(e,this.primIndex)},oo.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},oo.prototype.contains=function(e,t){t||(t=e);for(var i=0;i<this.ranges.length;i++){var n=this.ranges[i];if(at(t,n.from())>=0&&at(e,n.to())<=0)return i}return-1};var so=function(e,t){this.anchor=e,this.head=t};function ao(e,t,i){var n=e&&e.options.selectionsMayTouch,r=t[i];t.sort((function(e,t){return at(e.from(),t.from())})),i=N(t,r);for(var o=1;o<t.length;o++){var s=t[o],a=t[o-1],l=at(a.to(),s.from());if(n&&!s.empty()?l>0:l>=0){var c=ht(a.from(),s.from()),u=ut(a.to(),s.to()),h=a.empty()?s.from()==s.head:a.from()==a.head;o<=i&&--i,t.splice(--o,2,new so(h?u:c,h?c:u))}}return new oo(t,i)}function lo(e,t){return new oo([new so(e,t||e)],0)}function co(e){return e.text?st(e.from.line+e.text.length-1,K(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function uo(e,t){if(at(e,t.from)<0)return e;if(at(e,t.to)<=0)return co(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=co(t).ch-t.to.ch),st(i,n)}function ho(e,t){for(var i=[],n=0;n<e.sel.ranges.length;n++){var r=e.sel.ranges[n];i.push(new so(uo(r.anchor,t),uo(r.head,t)))}return ao(e.cm,i,e.sel.primIndex)}function po(e,t,i){return e.line==t.line?st(i.line,e.ch-t.ch+i.ch):st(i.line+(e.line-t.line),e.ch)}function fo(e,t,i){for(var n=[],r=st(e.first,0),o=r,s=0;s<t.length;s++){var a=t[s],l=po(a.from,r,o),c=po(co(a),r,o);if(r=a.to,o=c,"around"==i){var u=e.sel.ranges[s],h=at(u.head,u.anchor)<0;n[s]=new so(h?c:l,h?l:c)}else n[s]=new so(l,l)}return new oo(n,e.sel.primIndex)}function mo(e){e.doc.mode=qe(e.options,e.doc.modeOption),go(e)}function go(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Rr(e,100),e.state.modeGen++,e.curOp&&Fn(e)}function yo(e,t){return 0==t.from.ch&&0==t.to.ch&&""==K(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _o(e,t,i,n){function r(e){return i?i[e]:null}function o(e,i,r){ui(e,i,r,n),Ai(e,"change",e,t)}function s(e,t){for(var i=[],o=e;o<t;++o)i.push(new ci(c[o],r(o),n));return i}var a=t.from,l=t.to,c=t.text,u=Je(e,a.line),h=Je(e,l.line),d=K(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(yo(e,t)){var m=s(0,c.length-1);o(h,h.text,p),f&&e.remove(a.line,f),m.length&&e.insert(a.line,m)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),p);else{var g=s(1,c.length-1);g.push(new ci(d+u.text.slice(l.ch),p,n)),o(u,u.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,g)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],r(0)),o(h,d+h.text.slice(l.ch),p);var y=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,y)}Ai(e,"change",e,t)}function vo(e,t,i){function n(e,r,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;i&&!l||(t(a.doc,l),n(a.doc,e,l))}}}n(e,null,!0)}function xo(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,On(e),mo(e),bo(e),e.options.direction=t.direction,e.options.lineWrapping||li(e),e.options.mode=t.modeOption,Fn(e)}function bo(e){("rtl"==e.doc.direction?P:E)(e.display.lineDiv,"CodeMirror-rtl")}function wo(e){Lr(e,(function(){bo(e),Fn(e)}))}function To(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function ko(e,t){var i={from:ct(t.from),to:co(t),text:Qe(e,t.from,t.to)};return Io(e,i,t.from.line,t.to.line+1),vo(e,(function(e){return Io(e,i,t.from.line,t.to.line+1)}),!0),i}function So(e){for(;e.length&&K(e).ranges;)e.pop()}function Co(e,t){return t?(So(e.done),K(e.done)):e.done.length&&!K(e.done).ranges?K(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),K(e.done)):void 0}function Eo(e,t,i,n){var r=e.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&r.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=Co(r,r.lastOp==n)))s=K(o.changes),0==at(t.from,t.to)&&0==at(t.from,s.to)?s.to=co(t):o.changes.push(ko(e,t));else{var l=K(r.done);for(l&&l.ranges||zo(e.sel,r.done),o={changes:[ko(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=t.origin,s||_e(e,"historyAdded")}function Mo(e,t,i,n){var r=t.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Ao(e,t,i,n){var r=e.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||Mo(e,o,K(r.done),t))?r.done[r.done.length-1]=t:zo(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&So(r.undone)}function zo(e,t){var i=K(t);i&&i.ranges&&i.equals(e)||t.push(e)}function Io(e,t,i,n){var r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,n),(function(i){i.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=i.markedSpans),++o}))}function Lo(e){if(!e)return null;for(var t,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function Do(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var n=[],r=0;r<t.text.length;++r)n.push(Lo(i[r]));return n}function Po(e,t){var i=Do(e,t),n=jt(e,t);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(i[r]=s)}return i}function Oo(e,t,i){for(var n=[],r=0;r<e.length;++r){var o=e[r];if(o.ranges)n.push(i?oo.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],u=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var h in c)(u=h.match(/^spans_(\d+)$/))&&N(t,Number(u[1]))>-1&&(K(a)[h]=c[h],delete c[h])}}}return n}function Ro(e,t,i,n){if(n){var r=e.anchor;if(i){var o=at(t,r)<0;o!=at(i,r)<0?(r=t,t=i):o!=at(t,i)<0&&(t=i)}return new so(r,t)}return new so(i||t,t)}function Bo(e,t,i,n,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),Vo(e,new oo([Ro(e.sel.primary(),t,i,r)],0),n)}function Fo(e,t,i){for(var n=[],r=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=Ro(e.sel.ranges[o],t[o],null,r);Vo(e,ao(e.cm,n,e.sel.primIndex),i)}function $o(e,t,i,n){var r=e.sel.ranges.slice(0);r[t]=i,Vo(e,ao(e.cm,r,e.sel.primIndex),n)}function jo(e,t,i,n){Vo(e,lo(t,i),n)}function No(e,t,i){var n={ranges:t.ranges,update:function(t){this.ranges=[];for(var i=0;i<t.length;i++)this.ranges[i]=new so(pt(e,t[i].anchor),pt(e,t[i].head))},origin:i&&i.origin};return _e(e,"beforeSelectionChange",e,n),e.cm&&_e(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?ao(e.cm,n.ranges,n.ranges.length-1):t}function Uo(e,t,i){var n=e.history.done,r=K(n);r&&r.ranges?(n[n.length-1]=t,Go(e,t,i)):Vo(e,t,i)}function Vo(e,t,i){Go(e,t,i),Ao(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function Go(e,t,i){(be(e,"beforeSelectionChange")||e.cm&&be(e.cm,"beforeSelectionChange"))&&(t=No(e,t,i));var n=i&&i.bias||(at(t.primary().head,e.sel.primary().head)<0?-1:1);qo(e,Ho(e,t,n,!0)),i&&!1===i.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||lr(e.cm)}function qo(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,xe(e.cm)),Ai(e,"cursorActivity",e))}function Wo(e){qo(e,Ho(e,e.sel,null,!1))}function Ho(e,t,i,n){for(var r,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Xo(e,s.anchor,a&&a.anchor,i,n),c=Xo(e,s.head,a&&a.head,i,n);(r||l!=s.anchor||c!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new so(l,c))}return r?ao(e.cm,r,t.primIndex):t}function Zo(e,t,i,n,r){var o=Je(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(u?a.to>=t.ch:a.to>t.ch))){if(r&&(_e(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var h=l.find(n<0?1:-1),d=void 0;if((n<0?u:c)&&(h=Ko(e,h,-n,h&&h.line==t.line?o:null)),h&&h.line==t.line&&(d=at(h,i))&&(n<0?d<0:d>0))return Zo(e,h,t,n,r)}var p=l.find(n<0?-1:1);return(n<0?c:u)&&(p=Ko(e,p,n,p.line==t.line?o:null)),p?Zo(e,p,t,n,r):null}}return t}function Xo(e,t,i,n,r){var o=n||1,s=Zo(e,t,i,o,r)||!r&&Zo(e,t,i,o,!0)||Zo(e,t,i,-o,r)||!r&&Zo(e,t,i,-o,!0);return s||(e.cantEdit=!0,st(e.first,0))}function Ko(e,t,i,n){return i<0&&0==t.ch?t.line>e.first?pt(e,st(t.line-1)):null:i>0&&t.ch==(n||Je(e,t.line)).text.length?t.line<e.first+e.size-1?st(t.line+1,0):null:new st(t.line,t.ch+i)}function Yo(e){e.setSelection(st(e.firstLine(),0),st(e.lastLine()),G)}function Jo(e,t,i){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return i&&(n.update=function(t,i,r,o){t&&(n.from=pt(e,t)),i&&(n.to=pt(e,i)),r&&(n.text=r),void 0!==o&&(n.origin=o)}),_e(e,"beforeChange",e,n),e.cm&&_e(e.cm,"beforeChange",e.cm,n),n.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Qo(e,t,i){if(e.cm){if(!e.cm.curOp)return Dr(e.cm,Qo)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(be(e,"beforeChange")||e.cm&&be(e.cm,"beforeChange"))||(t=Jo(e,t,!0))){var n=zt&&!i&&Ut(e,t.from,t.to);if(n)for(var r=n.length-1;r>=0;--r)es(e,{from:n[r].from,to:n[r].to,text:r?[""]:t.text,origin:t.origin});else es(e,t)}}function es(e,t){if(1!=t.text.length||""!=t.text[0]||0!=at(t.from,t.to)){var i=ho(e,t);Eo(e,t,i,e.cm?e.cm.curOp.id:NaN),ns(e,t,i,jt(e,t));var n=[];vo(e,(function(e,i){i||-1!=N(n,e.history)||(ls(e.history,t),n.push(e.history)),ns(e,t,null,jt(e,t))}))}}function ts(e,t,i){var n=e.cm&&e.cm.state.suppressEdits;if(!n||i){for(var r,o=e.history,s=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,c=0;c<a.length&&(r=a[c],i?!r.ranges||r.equals(e.sel):r.ranges);c++);if(c!=a.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(r=a.pop()).ranges){if(n)return void a.push(r);break}if(zo(r,l),i&&!r.equals(e.sel))return void Vo(e,r,{clearRedo:!1});s=r}var u=[];zo(s,l),l.push({changes:u,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;for(var h=be(e,"beforeChange")||e.cm&&be(e.cm,"beforeChange"),d=function(i){var n=r.changes[i];if(n.origin=t,h&&!Jo(e,n,!1))return a.length=0,{};u.push(ko(e,n));var o=i?ho(e,n):K(a);ns(e,n,o,Po(e,n)),!i&&e.cm&&e.cm.scrollIntoView({from:n.from,to:co(n)});var s=[];vo(e,(function(e,t){t||-1!=N(s,e.history)||(ls(e.history,n),s.push(e.history)),ns(e,n,null,Po(e,n))}))},p=r.changes.length-1;p>=0;--p){var f=d(p);if(f)return f.v}}}}function is(e,t){if(0!=t&&(e.first+=t,e.sel=new oo(Y(e.sel.ranges,(function(e){return new so(st(e.anchor.line+t,e.anchor.ch),st(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm)){Fn(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,n=i.viewFrom;n<i.viewTo;n++)$n(e.cm,n,"gutter")}}function ns(e,t,i,n){if(e.cm&&!e.cm.curOp)return Dr(e.cm,ns)(e,t,i,n);if(t.to.line<e.first)is(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);is(e,r),t={from:st(e.first,0),to:st(t.to.line+r,t.to.ch),text:[K(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:st(o,Je(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Qe(e,t.from,t.to),i||(i=ho(e,t)),e.cm?rs(e.cm,t,n):_o(e,t,n),Go(e,i,G),e.cantEdit&&Xo(e,st(e.firstLine(),0))&&(e.cantEdit=!1)}}function rs(e,t,i){var n=e.doc,r=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=it(Qt(Je(n,o.line))),n.iter(l,s.line+1,(function(e){if(e==r.maxLine)return a=!0,!0}))),n.sel.contains(t.from,t.to)>-1&&xe(e),_o(n,t,i,Pn(e)),e.options.lineWrapping||(n.iter(l,o.line+t.text.length,(function(e){var t=ai(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0)),At(n,o.line),Rr(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?Fn(e):o.line!=s.line||1!=t.text.length||yo(e.doc,t)?Fn(e,o.line,s.line+1,c):$n(e,o.line,"text");var u=be(e,"changes"),h=be(e,"change");if(h||u){var d={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};h&&Ai(e,"change",e,d),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(d)}e.display.selForContextMenu=null}function os(e,t,i,n,r){var o;n||(n=i),at(n,i)<0&&(i=(o=[n,i])[0],n=o[1]),"string"==typeof t&&(t=e.splitLines(t)),Qo(e,{from:i,to:n,text:t,origin:r})}function ss(e,t,i,n){i<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function as(e,t,i,n){for(var r=0;r<e.length;++r){var o=e[r],s=!0;if(o.ranges){o.copied||((o=e[r]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)ss(o.ranges[a].anchor,t,i,n),ss(o.ranges[a].head,t,i,n)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(i<c.from.line)c.from=st(c.from.line+n,c.from.ch),c.to=st(c.to.line+n,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function ls(e,t){var i=t.from.line,n=t.to.line,r=t.text.length-(n-i)-1;as(e.done,i,n,r),as(e.undone,i,n,r)}function cs(e,t,i,n){var r=t,o=t;return"number"==typeof t?o=Je(e,dt(e,t)):r=it(t),null==r?null:(n(o,r)&&e.cm&&$n(e.cm,r,i),o)}function us(e){this.lines=e,this.parent=null;for(var t=0,i=0;i<e.length;++i)e[i].parent=this,t+=e[i].height;this.height=t}function hs(e){this.children=e;for(var t=0,i=0,n=0;n<e.length;++n){var r=e[n];t+=r.chunkSize(),i+=r.height,r.parent=this}this.size=t,this.height=i,this.parent=null}so.prototype.from=function(){return ht(this.anchor,this.head)},so.prototype.to=function(){return ut(this.anchor,this.head)},so.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},us.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var i=e,n=e+t;i<n;++i){var r=this.lines[i];this.height-=r.height,hi(r),Ai(r,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,i){for(var n=e+t;e<n;++e)if(i(this.lines[e]))return!0}},hs.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var i=0;i<this.children.length;++i){var n=this.children[i],r=n.chunkSize();if(e<r){var o=Math.min(t,r-e),s=n.height;if(n.removeInner(e,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(t-=o))break;e=0}else e-=r}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof us))){var a=[];this.collapse(a),this.children=[new us(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,i){this.size+=t.length,this.height+=i;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(e<=o){if(r.insertInner(e,t,i),r.lines&&r.lines.length>50){for(var s=r.lines.length%25+25,a=s;a<r.lines.length;){var l=new us(r.lines.slice(a,a+=25));r.height-=l.height,this.children.splice(++n,0,l),l.parent=this}r.lines=r.lines.slice(0,s),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new hs(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var i=N(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{var n=new hs(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,i){for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(e<o){var s=Math.min(t,o-e);if(r.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=o}}};var ds=function(e,t,i){if(i)for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this.doc=e,this.node=t};function ps(e,t,i){si(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&ar(e,i)}function fs(e,t,i,n){var r=new ds(e,i,n),o=e.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),cs(e,t,"widget",(function(t){var i=t.widgets||(t.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length,Math.max(0,r.insertAt)),0,r),r.line=t,o&&!ri(e,t)){var n=si(t)<e.scrollTop;tt(t,t.height+Vi(r)),n&&ar(o,r.height),o.curOp.forceUpdate=!0}return!0})),o&&Ai(o,"lineWidgetAdded",o,r,"number"==typeof t?t:it(t)),r}ds.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,i=this.line,n=it(i);if(null!=n&&t){for(var r=0;r<t.length;++r)t[r]==this&&t.splice(r--,1);t.length||(i.widgets=null);var o=Vi(this);tt(i,Math.max(0,i.height-o)),e&&(Lr(e,(function(){ps(e,i,-o),$n(e,n,"widget")})),Ai(e,"lineWidgetCleared",e,this,n))}},ds.prototype.changed=function(){var e=this,t=this.height,i=this.doc.cm,n=this.line;this.height=null;var r=Vi(this)-t;r&&(ri(this.doc,n)||tt(n,n.height+r),i&&Lr(i,(function(){i.curOp.forceUpdate=!0,ps(i,n,r),Ai(i,"lineWidgetChanged",i,e,it(n))})))},we(ds);var ms=0,gs=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++ms};function ys(e,t,i,n,r){if(n&&n.shared)return vs(e,t,i,n,r);if(e.cm&&!e.cm.curOp)return Dr(e.cm,ys)(e,t,i,n,r);var o=new gs(e,r),s=at(t,i);if(n&&F(n,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=I("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Jt(e,t.line,t,i,o)||t.line!=i.line&&Jt(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Dt()}o.addToHistory&&Eo(e,{from:t,to:i,origin:"markText"},e.sel,NaN);var a,l=t.line,c=e.cm;if(e.iter(l,i.line+1,(function(n){c&&o.collapsed&&!c.options.lineWrapping&&Qt(n)==c.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&tt(n,0),Bt(n,new Pt(o,l==t.line?t.ch:null,l==i.line?i.ch:null),e.cm&&e.cm.curOp),++l})),o.collapsed&&e.iter(t.line,i.line+1,(function(t){ri(e,t)&&tt(t,0)})),o.clearOnEnter&&me(o,"beforeCursorEnter",(function(){return o.clear()})),o.readOnly&&(Lt(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++ms,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)Fn(c,t.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var u=t.line;u<=i.line;u++)$n(c,u,"text");o.atomic&&Wo(c.doc),Ai(c,"markerAdded",c,o)}return o}gs.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&kr(e),be(this,"clear")){var i=this.find();i&&Ai(this,"clear",i.from,i.to)}for(var n=null,r=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Ot(s.markedSpans,this);e&&!this.collapsed?$n(e,it(s),"text"):e&&(null!=a.to&&(r=it(s)),null!=a.from&&(n=it(s))),s.markedSpans=Rt(s.markedSpans,a),null==a.from&&this.collapsed&&!ri(this.doc,s)&&e&&tt(s,zn(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=Qt(this.lines[l]),u=ai(c);u>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=u,e.display.maxLineChanged=!0)}null!=n&&e&&this.collapsed&&Fn(e,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Wo(e.doc)),e&&Ai(e,"markerCleared",e,this,n,r),t&&Sr(e),this.parent&&this.parent.clear()}},gs.prototype.find=function(e,t){var i,n;null==e&&"bookmark"==this.type&&(e=1);for(var r=0;r<this.lines.length;++r){var o=this.lines[r],s=Ot(o.markedSpans,this);if(null!=s.from&&(i=st(t?o:it(o),s.from),-1==e))return i;if(null!=s.to&&(n=st(t?o:it(o),s.to),1==e))return n}return i&&{from:i,to:n}},gs.prototype.changed=function(){var e=this,t=this.find(-1,!0),i=this,n=this.doc.cm;t&&n&&Lr(n,(function(){var r=t.line,o=it(t.line),s=tn(n,o);if(s&&(hn(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ri(i.doc,r)&&null!=i.height){var a=i.height;i.height=null;var l=Vi(i)-a;l&&tt(r,r.height+l)}Ai(n,"markerChanged",n,e)}))},gs.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=N(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},gs.prototype.detachLine=function(e){if(this.lines.splice(N(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},we(gs);var _s=function(e,t){this.markers=e,this.primary=t;for(var i=0;i<e.length;++i)e[i].parent=this};function vs(e,t,i,n,r){(n=F(n)).shared=!1;var o=[ys(e,t,i,n,r)],s=o[0],a=n.widgetNode;return vo(e,(function(e){a&&(n.widgetNode=a.cloneNode(!0)),o.push(ys(e,pt(e,t),pt(e,i),n,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=K(o)})),new _s(o,s)}function xs(e){return e.findMarks(st(e.first,0),e.clipPos(st(e.lastLine())),(function(e){return e.parent}))}function bs(e,t){for(var i=0;i<t.length;i++){var n=t[i],r=n.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(at(o,s)){var a=ys(e,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function ws(e){for(var t=function(t){var i=e[t],n=[i.primary.doc];vo(i.primary.doc,(function(e){return n.push(e)}));for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==N(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}},i=0;i<e.length;i++)t(i)}_s.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Ai(this,"clear")}},_s.prototype.find=function(e,t){return this.primary.find(e,t)},we(_s);var Ts=0,ks=function(e,t,i,n,r){if(!(this instanceof ks))return new ks(e,t,i,n,r);null==i&&(i=0),hs.call(this,[new us([new ci("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=st(i,0);this.sel=lo(o),this.history=new To(null),this.id=++Ts,this.modeOption=t,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_o(this,{from:o,to:o,text:e}),Vo(this,lo(o),G)};ks.prototype=ee(hs.prototype,{constructor:ks,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,n=0;n<t.length;++n)i+=t[n].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=et(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Or((function(e){var t=st(this.first,0),i=this.first+this.size-1;Qo(this,{from:t,to:st(i,Je(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&cr(this.cm,0,0),Vo(this,lo(t),G)})),replaceRange:function(e,t,i,n){os(this,e,t=pt(this,t),i=i?pt(this,i):t,n)},getRange:function(e,t,i){var n=Qe(this,pt(this,e),pt(this,t));return!1===i?n:""===i?n.join(""):n.join(i||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(rt(this,e))return Je(this,e)},getLineNumber:function(e){return it(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Je(this,e)),Qt(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return pt(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Or((function(e,t,i){jo(this,pt(this,"number"==typeof e?st(e,t||0):e),null,i)})),setSelection:Or((function(e,t,i){jo(this,pt(this,e),pt(this,t||e),i)})),extendSelection:Or((function(e,t,i){Bo(this,pt(this,e),t&&pt(this,t),i)})),extendSelections:Or((function(e,t){Fo(this,mt(this,e),t)})),extendSelectionsBy:Or((function(e,t){Fo(this,mt(this,Y(this.sel.ranges,e)),t)})),setSelections:Or((function(e,t,i){if(e.length){for(var n=[],r=0;r<e.length;r++)n[r]=new so(pt(this,e[r].anchor),pt(this,e[r].head||e[r].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Vo(this,ao(this.cm,n,t),i)}})),addSelection:Or((function(e,t,i){var n=this.sel.ranges.slice(0);n.push(new so(pt(this,e),pt(this,t||e))),Vo(this,ao(this.cm,n,n.length-1),i)})),getSelection:function(e){for(var t,i=this.sel.ranges,n=0;n<i.length;n++){var r=Qe(this,i[n].from(),i[n].to());t=t?t.concat(r):r}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],i=this.sel.ranges,n=0;n<i.length;n++){var r=Qe(this,i[n].from(),i[n].to());!1!==e&&(r=r.join(e||this.lineSeparator())),t[n]=r}return t},replaceSelection:function(e,t,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=e;this.replaceSelections(n,t,i||"+input")},replaceSelections:Or((function(e,t,i){for(var n=[],r=this.sel,o=0;o<r.ranges.length;o++){var s=r.ranges[o];n[o]={from:s.from(),to:s.to(),text:this.splitLines(e[o]),origin:i}}for(var a=t&&"end"!=t&&fo(this,n,t),l=n.length-1;l>=0;l--)Qo(this,n[l]);a?Uo(this,a):this.cm&&lr(this.cm)})),undo:Or((function(){ts(this,"undo")})),redo:Or((function(){ts(this,"redo")})),undoSelection:Or((function(){ts(this,"undo",!0)})),redoSelection:Or((function(){ts(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){var e=this;this.history=new To(this.history),vo(this,(function(t){return t.history=e.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Oo(this.history.done),undone:Oo(this.history.undone)}},setHistory:function(e){var t=this.history=new To(this.history);t.done=Oo(e.done.slice(0),null,!0),t.undone=Oo(e.undone.slice(0),null,!0)},setGutterMarker:Or((function(e,t,i){return cs(this,e,"gutter",(function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=i,!i&&re(n)&&(e.gutterMarkers=null),!0}))})),clearGutter:Or((function(e){var t=this;this.iter((function(i){i.gutterMarkers&&i.gutterMarkers[e]&&cs(t,i,"gutter",(function(){return i.gutterMarkers[e]=null,re(i.gutterMarkers)&&(i.gutterMarkers=null),!0}))}))})),lineInfo:function(e){var t;if("number"==typeof e){if(!rt(this,e))return null;if(t=e,!(e=Je(this,e)))return null}else if(null==(t=it(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Or((function(e,t,i){return cs(this,e,"gutter"==t?"gutter":"class",(function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[n]){if(S(i).test(e[n]))return!1;e[n]+=" "+i}else e[n]=i;return!0}))})),removeLineClass:Or((function(e,t,i){return cs(this,e,"gutter"==t?"gutter":"class",(function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",r=e[n];if(!r)return!1;if(null==i)e[n]=null;else{var o=r.match(S(i));if(!o)return!1;var s=o.index+o[0].length;e[n]=r.slice(0,o.index)+(o.index&&s!=r.length?" ":"")+r.slice(s)||null}return!0}))})),addLineWidget:Or((function(e,t,i){return fs(this,e,t,i)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return ys(this,pt(this,e),pt(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return ys(this,e=pt(this,e),e,i,"bookmark")},findMarksAt:function(e){var t=[],i=Je(this,(e=pt(this,e)).line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,i){e=pt(this,e),t=pt(this,t);var n=[],r=e.line;return this.iter(e.line,t.line+1,(function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==e.line&&e.ch>=l.to||null==l.from&&r!=e.line||null!=l.from&&r==t.line&&l.from>=t.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r})),n},getAllMarks:function(){var e=[];return this.iter((function(t){var i=t.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&e.push(i[n].marker)})),e},posFromIndex:function(e){var t,i=this.first,n=this.lineSeparator().length;return this.iter((function(r){var o=r.text.length+n;if(o>e)return t=e,!0;e-=o,++i})),pt(this,st(i,t))},indexFromPos:function(e){var t=(e=pt(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,e.line,(function(e){t+=e.text.length+i})),t},copy:function(e){var t=new ks(et(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var n=new ks(et(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],bs(n,xs(this)),n},unlinkDoc:function(e){if(e instanceof Fa&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t)if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),ws(xs(this));break}if(e.history==this.history){var i=[e.id];vo(e,(function(e){return i.push(e.id)}),!0),e.history=new To(null),e.history.done=Oo(this.history.done,i),e.history.undone=Oo(this.history.undone,i)}},iterLinkedDocs:function(e){vo(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Oe(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Or((function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter((function(e){return e.order=null})),this.cm&&wo(this.cm))}))}),ks.prototype.eachLine=ks.prototype.iter;var Ss=0;function Cs(e){var t=this;if(As(t),!ve(t,e)&&!Gi(t.display,e)){Te(e),s&&(Ss=+new Date);var i=Rn(t,e,!0),n=e.dataTransfer.files;if(i&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),a=0,l=function(){++a==r&&Dr(t,(function(){var e={from:i=pt(t.doc,i),to:i,text:t.doc.splitLines(o.filter((function(e){return null!=e})).join(t.doc.lineSeparator())),origin:"paste"};Qo(t.doc,e),Uo(t.doc,lo(pt(t.doc,i),pt(t.doc,co(e))))}))()},c=function(e,i){if(t.options.allowDropFileTypes&&-1==N(t.options.allowDropFileTypes,e.type))l();else{var n=new FileReader;n.onerror=function(){return l()},n.onload=function(){var e=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(o[i]=e),l()},n.readAsText(e)}},u=0;u<n.length;u++)c(n[u],u);else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout((function(){return t.display.input.focus()}),20);try{var h=e.dataTransfer.getData("Text");if(h){var d;if(t.state.draggingText&&!t.state.draggingText.copy&&(d=t.listSelections()),Go(t.doc,lo(i,i)),d)for(var p=0;p<d.length;++p)os(t.doc,"",d[p].anchor,d[p].head,"drag");t.replaceSelection(h,"around","paste"),t.display.input.focus()}}catch(e){}}}}function Es(e,t){if(s&&(!e.state.draggingText||+new Date-Ss<100))Ce(t);else if(!ve(e,t)&&!Gi(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!p)){var i=z("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),d&&i.parentNode.removeChild(i)}}function Ms(e,t){var i=Rn(e,t);if(i){var n=document.createDocumentFragment();Wn(e,i,n),e.display.dragCursor||(e.display.dragCursor=z("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),A(e.display.dragCursor,n)}}function As(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function zs(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),i=[],n=0;n<t.length;n++){var r=t[n].CodeMirror;r&&i.push(r)}i.length&&i[0].operation((function(){for(var t=0;t<i.length;t++)e(i[t])}))}}var Is=!1;function Ls(){Is||(Ds(),Is=!0)}function Ds(){var e;me(window,"resize",(function(){null==e&&(e=setTimeout((function(){e=null,zs(Ps)}),100))})),me(window,"blur",(function(){return zs(Qn)}))}function Ps(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Os={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Rs=0;Rs<10;Rs++)Os[Rs+48]=Os[Rs+96]=String(Rs);for(var Bs=65;Bs<=90;Bs++)Os[Bs]=String.fromCharCode(Bs);for(var Fs=1;Fs<=12;Fs++)Os[Fs+111]=Os[Fs+63235]="F"+Fs;var $s={};function js(e){var t,i,n,r,o=e.split(/-(?!$)/);e=o[o.length-1];for(var s=0;s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))r=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);n=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),n&&(e="Shift-"+e),e}function Ns(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete e[i];continue}for(var r=Y(i.split(" "),js),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=n):(a=r.slice(0,o+1).join(" "),s="...");var l=t[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else t[a]=s}delete e[i]}for(var c in t)e[c]=t[c];return e}function Us(e,t,i,n){var r=(t=Ws(t)).call?t.call(e,n):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Us(e,t.fallthrough,i,n);for(var o=0;o<t.fallthrough.length;o++){var s=Us(e,t.fallthrough[o],i,n);if(s)return s}}}function Vs(e){var t="string"==typeof e?e:Os[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Gs(e,t,i){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(T?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(T?t.ctrlKey:t.metaKey)&&"Mod"!=n&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function qs(e,t){if(d&&34==e.keyCode&&e.char)return!1;var i=Os[e.keyCode];return null!=i&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(i=e.code),Gs(i,e,t))}function Ws(e){return"string"==typeof e?$s[e]:e}function Hs(e,t){for(var i=e.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=t(i[r]);n.length&&at(o.from,K(n).to)<=0;){var s=n.pop();if(at(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}Lr(e,(function(){for(var t=n.length-1;t>=0;t--)os(e.doc,"",n[t].from,n[t].to,"+delete");lr(e)}))}function Zs(e,t,i){var n=ae(e.text,t+i,i);return n<0||n>e.text.length?null:n}function Xs(e,t,i){var n=Zs(e,t.ch,i);return null==n?null:new st(t.line,n,i<0?"after":"before")}function Ks(e,t,i,n,r){if(e){"rtl"==t.doc.direction&&(r=-r);var o=pe(i,t.doc.direction);if(o){var s,a=r<0?K(o):o[0],l=r<0==(1==a.level)?"after":"before";if(a.level>0||"rtl"==t.doc.direction){var c=nn(t,i);s=r<0?i.text.length-1:0;var u=rn(t,c,s).top;s=le((function(e){return rn(t,c,e).top==u}),r<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=Zs(i,s,1))}else s=r<0?a.to:a.from;return new st(n,s,l)}}return new st(n,r<0?i.text.length:0,r<0?"before":"after")}function Ys(e,t,i,n){var r=pe(t,e.doc.direction);if(!r)return Xs(t,i,n);i.ch>=t.text.length?(i.ch=t.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=he(r,i.ch,i.sticky),s=r[o];if("ltr"==e.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Xs(t,i,n);var a,l=function(e,i){return Zs(t,e instanceof st?e.ch:e,i)},c=function(i){return e.options.lineWrapping?(a=a||nn(e,t),Sn(e,t,a,i)):{begin:0,end:t.text.length}},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==e.doc.direction||1==s.level){var h=1==s.level==n<0,d=l(i,h?1:-1);if(null!=d&&(h?d<=s.to&&d<=u.end:d>=s.from&&d>=u.begin)){var p=h?"before":"after";return new st(i.line,d,p)}}var f=function(e,t,n){for(var o=function(e,t){return t?new st(i.line,l(e,1),"before"):new st(i.line,e,"after")};e>=0&&e<r.length;e+=t){var s=r[e],a=t>0==(1!=s.level),c=a?n.begin:l(n.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),n.begin<=c&&c<n.end)return o(c,a)}},m=f(o+n,n,u);if(m)return m;var g=n>0?u.end:l(u.begin,-1);return null==g||n>0&&g==t.text.length||!(m=f(n>0?0:r.length-1,n,c(g)))?null:m}$s.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},$s.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},$s.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},$s.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},$s.default=v?$s.macDefault:$s.pcDefault;var Js={selectAll:Yo,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),G)},killLine:function(e){return Hs(e,(function(t){if(t.empty()){var i=Je(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:st(t.head.line+1,0)}:{from:t.head,to:st(t.head.line,i)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){return Hs(e,(function(t){return{from:st(t.from().line,0),to:pt(e.doc,st(t.to().line+1,0))}}))},delLineLeft:function(e){return Hs(e,(function(e){return{from:st(e.from().line,0),to:e.from()}}))},delWrappedLineLeft:function(e){return Hs(e,(function(t){var i=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:i},"div"),to:t.from()}}))},delWrappedLineRight:function(e){return Hs(e,(function(t){var i=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:n}}))},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(st(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(st(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy((function(t){return Qs(e,t.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy((function(t){return ta(e,t.head)}),{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy((function(t){return ea(e,t.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")}),W)},goLineLeft:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")}),W)},goLineLeftSmart:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:i},"div");return n.ch<e.getLine(n.line).search(/\S/)?ta(e,t.head):n}),W)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),n=e.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=$(e.getLine(o.line),o.ch,n);t.push(X(n-s%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return Lr(e,(function(){for(var t=e.listSelections(),i=[],n=0;n<t.length;n++)if(t[n].empty()){var r=t[n].head,o=Je(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new st(r.line,r.ch-1)),r.ch>0)r=new st(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),st(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var s=Je(e.doc,r.line-1).text;s&&(r=new st(r.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),st(r.line-1,s.length-1),r,"+transpose"))}i.push(new so(r,r))}e.setSelections(i)}))},newlineAndIndent:function(e){return Lr(e,(function(){for(var t=e.listSelections(),i=t.length-1;i>=0;i--)e.replaceRange(e.doc.lineSeparator(),t[i].anchor,t[i].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);lr(e)}))},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Qs(e,t){var i=Je(e.doc,t),n=Qt(i);return n!=i&&(t=it(n)),Ks(!0,e,n,t,1)}function ea(e,t){var i=Je(e.doc,t),n=ei(i);return n!=i&&(t=it(n)),Ks(!0,e,i,t,-1)}function ta(e,t){var i=Qs(e,t.line),n=Je(e.doc,i.line),r=pe(n,e.doc.direction);if(!r||0==r[0].level){var o=Math.max(i.ch,n.text.search(/\S/)),s=t.line==i.line&&t.ch<=o&&t.ch;return st(i.line,s?0:o,i.sticky)}return i}function ia(e,t,i){if("string"==typeof t&&!(t=Js[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),r=t(e)!=V}finally{e.display.shift=n,e.state.suppressEdits=!1}return r}function na(e,t,i){for(var n=0;n<e.state.keyMaps.length;n++){var r=Us(t,e.state.keyMaps[n],i,e);if(r)return r}return e.options.extraKeys&&Us(t,e.options.extraKeys,i,e)||Us(t,e.options.keyMap,i,e)}var ra=new j;function oa(e,t,i,n){var r=e.state.keySeq;if(r){if(Vs(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:ra.set(50,(function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())})),sa(e,r+" "+t,i,n))return!0}return sa(e,t,i,n)}function sa(e,t,i,n){var r=na(e,t,n);return"multi"==r&&(e.state.keySeq=t),"handled"==r&&Ai(e,"keyHandled",e,t,i),"handled"!=r&&"multi"!=r||(Te(i),Xn(e)),!!r}function aa(e,t){var i=qs(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?oa(e,"Shift-"+i,t,(function(t){return ia(e,t,!0)}))||oa(e,i,t,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return ia(e,t)})):oa(e,i,t,(function(t){return ia(e,t)})))}function la(e,t,i){return oa(e,"'"+i+"'",t,(function(t){return ia(e,t,!0)}))}var ca=null;function ua(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||(t.curOp.focus=D(),ve(t,e)))){s&&a<11&&27==e.keyCode&&(e.returnValue=!1);var n=e.keyCode;t.display.shift=16==n||e.shiftKey;var r=aa(t,e);d&&(ca=r?n:null,r||88!=n||Be||!(v?e.metaKey:e.ctrlKey)||t.replaceSelection("",null,"cut")),i&&!v&&!r&&46==n&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=n||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ha(t)}}function ha(e){var t=e.display.lineDiv;function i(e){18!=e.keyCode&&e.altKey||(E(t,"CodeMirror-crosshair"),ye(document,"keyup",i),ye(document,"mouseover",i))}P(t,"CodeMirror-crosshair"),me(document,"keyup",i),me(document,"mouseover",i)}function da(e){16==e.keyCode&&(this.doc.sel.shift=!1),ve(this,e)}function pa(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||Gi(t.display,e)||ve(t,e)||e.ctrlKey&&!e.altKey||v&&e.metaKey)){var i=e.keyCode,n=e.charCode;if(d&&i==ca)return ca=null,void Te(e);if(!d||e.which&&!(e.which<10)||!aa(t,e)){var r=String.fromCharCode(null==n?i:n);"\b"!=r&&(la(t,e,r)||t.display.input.onKeyPress(e))}}}var fa,ma,ga=400,ya=function(e,t,i){this.time=e,this.pos=t,this.button=i};function _a(e,t){var i=+new Date;return ma&&ma.compare(i,e,t)?(fa=ma=null,"triple"):fa&&fa.compare(i,e,t)?(ma=new ya(i,e,t),fa=null,"double"):(fa=new ya(i,e,t),ma=null,"single")}function va(e){var t=this,i=t.display;if(!(ve(t,e)||i.activeTouch&&i.input.supportsTouch()))if(i.input.ensurePolled(),i.shift=e.shiftKey,Gi(i,e))l||(i.scroller.draggable=!1,setTimeout((function(){return i.scroller.draggable=!0}),100));else if(!Ma(t,e)){var n=Rn(t,e),r=Me(e),o=n?_a(n,r):"single";window.focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),n&&xa(t,r,n,o,e)||(1==r?n?wa(t,n,o,e):Ee(e)==i.scroller&&Te(e):2==r?(n&&Bo(t.doc,n),setTimeout((function(){return i.input.focus()}),20)):3==r&&(k?t.display.input.onContextMenu(e):Yn(t)))}}function xa(e,t,i,n,r){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),oa(e,Gs(o=(1==t?"Left":2==t?"Middle":"Right")+o,r),r,(function(t){if("string"==typeof t&&(t=Js[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,i)!=V}finally{e.state.suppressEdits=!1}return n}))}function ba(e,t,i){var n=e.getOption("configureMouse"),r=n?n(e,t,i):{};if(null==r.unit){var o=x?i.shiftKey&&i.metaKey:i.altKey;r.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||i.shiftKey),null==r.addNew&&(r.addNew=v?i.metaKey:i.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(v?i.altKey:i.ctrlKey)),r}function wa(e,t,i,n){s?setTimeout(B(Kn,e),0):e.curOp.focus=D();var r,o=ba(e,i,n),a=e.doc.sel;e.options.dragDrop&&Ie&&!e.isReadOnly()&&"single"==i&&(r=a.contains(t))>-1&&(at((r=a.ranges[r]).from(),t)<0||t.xRel>0)&&(at(r.to(),t)>0||t.xRel<0)?Ta(e,n,t,o):Sa(e,n,t,o)}function Ta(e,t,i,n){var r=e.display,o=!1,c=Dr(e,(function(t){l&&(r.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:Yn(e)),ye(r.wrapper.ownerDocument,"mouseup",c),ye(r.wrapper.ownerDocument,"mousemove",u),ye(r.scroller,"dragstart",h),ye(r.scroller,"drop",c),o||(Te(t),n.addNew||Bo(e.doc,i,null,null,n.extend),l&&!p||s&&9==a?setTimeout((function(){r.wrapper.ownerDocument.body.focus({preventScroll:!0}),r.input.focus()}),20):r.input.focus())})),u=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},h=function(){return o=!0};l&&(r.scroller.draggable=!0),e.state.draggingText=c,c.copy=!n.moveOnDrag,me(r.wrapper.ownerDocument,"mouseup",c),me(r.wrapper.ownerDocument,"mousemove",u),me(r.scroller,"dragstart",h),me(r.scroller,"drop",c),e.state.delayingBlurEvent=!0,setTimeout((function(){return r.input.focus()}),20),r.scroller.dragDrop&&r.scroller.dragDrop()}function ka(e,t,i){if("char"==i)return new so(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new so(st(t.line,0),pt(e.doc,st(t.line+1,0)));var n=i(e,t);return new so(n.from,n.to)}function Sa(e,t,i,n){s&&Yn(e);var r=e.display,o=e.doc;Te(t);var a,l,c=o.sel,u=c.ranges;if(n.addNew&&!n.extend?(l=o.sel.contains(i),a=l>-1?u[l]:new so(i,i)):(a=o.sel.primary(),l=o.sel.primIndex),"rectangle"==n.unit)n.addNew||(a=new so(i,i)),i=Rn(e,t,!0,!0),l=-1;else{var h=ka(e,i,n.unit);a=n.extend?Ro(a,h.anchor,h.head,n.extend):h}n.addNew?-1==l?(l=u.length,Vo(o,ao(e,u.concat([a]),l),{scroll:!1,origin:"*mouse"})):u.length>1&&u[l].empty()&&"char"==n.unit&&!n.extend?(Vo(o,ao(e,u.slice(0,l).concat(u.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),c=o.sel):$o(o,l,a,q):(l=0,Vo(o,new oo([a],0),q),c=o.sel);var d=i;function p(t){if(0!=at(d,t))if(d=t,"rectangle"==n.unit){for(var r=[],s=e.options.tabSize,u=$(Je(o,i.line).text,i.ch,s),h=$(Je(o,t.line).text,t.ch,s),p=Math.min(u,h),f=Math.max(u,h),m=Math.min(i.line,t.line),g=Math.min(e.lastLine(),Math.max(i.line,t.line));m<=g;m++){var y=Je(o,m).text,_=H(y,p,s);p==f?r.push(new so(st(m,_),st(m,_))):y.length>_&&r.push(new so(st(m,_),st(m,H(y,f,s))))}r.length||r.push(new so(i,i)),Vo(o,ao(e,c.ranges.slice(0,l).concat(r),l),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var v,x=a,b=ka(e,t,n.unit),w=x.anchor;at(b.anchor,w)>0?(v=b.head,w=ht(x.from(),b.anchor)):(v=b.anchor,w=ut(x.to(),b.head));var T=c.ranges.slice(0);T[l]=Ca(e,new so(pt(o,w),v)),Vo(o,ao(e,T,l),q)}}var f=r.wrapper.getBoundingClientRect(),m=0;function g(t){var i=++m,s=Rn(e,t,!0,"rectangle"==n.unit);if(s)if(0!=at(s,d)){e.curOp.focus=D(),p(s);var a=ir(r,o);(s.line>=a.to||s.line<a.from)&&setTimeout(Dr(e,(function(){m==i&&g(t)})),150)}else{var l=t.clientY<f.top?-20:t.clientY>f.bottom?20:0;l&&setTimeout(Dr(e,(function(){m==i&&(r.scroller.scrollTop+=l,g(t))})),50)}}function y(t){e.state.selectingText=!1,m=1/0,t&&(Te(t),r.input.focus()),ye(r.wrapper.ownerDocument,"mousemove",_),ye(r.wrapper.ownerDocument,"mouseup",v),o.history.lastSelOrigin=null}var _=Dr(e,(function(e){0!==e.buttons&&Me(e)?g(e):y(e)})),v=Dr(e,y);e.state.selectingText=v,me(r.wrapper.ownerDocument,"mousemove",_),me(r.wrapper.ownerDocument,"mouseup",v)}function Ca(e,t){var i=t.anchor,n=t.head,r=Je(e.doc,i.line);if(0==at(i,n)&&i.sticky==n.sticky)return t;var o=pe(r);if(!o)return t;var s=he(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return t;var l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return t;if(n.line!=i.line)l=(n.line-i.line)*("ltr"==e.doc.direction?1:-1)>0;else{var u=he(o,n.ch,n.sticky),h=u-s||(n.ch-i.ch)*(1==a.level?-1:1);l=u==c-1||u==c?h<0:h>0}var d=o[c+(l?-1:0)],p=l==(1==d.level),f=p?d.from:d.to,m=p?"after":"before";return i.ch==f&&i.sticky==m?t:new so(new st(i.line,f,m),n)}function Ea(e,t,i,n){var r,o;if(t.touches)r=t.touches[0].clientX,o=t.touches[0].clientY;else try{r=t.clientX,o=t.clientY}catch(e){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&Te(t);var s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!be(e,i))return Se(t);o-=a.top-s.viewOffset;for(var l=0;l<e.display.gutterSpecs.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r)return _e(e,i,e,nt(e.doc,o),e.display.gutterSpecs[l].className,t),Se(t)}}function Ma(e,t){return Ea(e,t,"gutterClick",!0)}function Aa(e,t){Gi(e.display,t)||za(e,t)||ve(e,t,"contextmenu")||k||e.display.input.onContextMenu(t)}function za(e,t){return!!be(e,"gutterContextMenu")&&Ea(e,t,"gutterContextMenu",!1)}function Ia(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),pn(e)}ya.prototype.compare=function(e,t,i){return this.time+ga>e&&0==at(t,this.pos)&&i==this.button};var La={toString:function(){return"CodeMirror.Init"}},Da={},Pa={};function Oa(e){var t=e.optionHandlers;function i(i,n,r,o){e.defaults[i]=n,r&&(t[i]=o?function(e,t,i){i!=La&&r(e,t,i)}:r)}e.defineOption=i,e.Init=La,i("value","",(function(e,t){return e.setValue(t)}),!0),i("mode",null,(function(e,t){e.doc.modeOption=t,mo(e)}),!0),i("indentUnit",2,mo,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(function(e){go(e),pn(e),Fn(e)}),!0),i("lineSeparator",null,(function(e,t){if(e.doc.lineSep=t,t){var i=[],n=e.doc.first;e.doc.iter((function(e){for(var r=0;;){var o=e.text.indexOf(t,r);if(-1==o)break;r=o+t.length,i.push(st(n,o))}n++}));for(var r=i.length-1;r>=0;r--)os(e.doc,t,i[r],st(i[r].line,i[r].ch+t.length))}})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(function(e,t,i){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=La&&e.refresh()})),i("specialCharPlaceholder",gi,(function(e){return e.refresh()}),!0),i("electricChars",!0),i("inputStyle",_?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,(function(e,t){return e.getInputField().spellcheck=t}),!0),i("autocorrect",!1,(function(e,t){return e.getInputField().autocorrect=t}),!0),i("autocapitalize",!1,(function(e,t){return e.getInputField().autocapitalize=t}),!0),i("rtlMoveVisually",!b),i("wholeLineUpdateBefore",!0),i("theme","default",(function(e){Ia(e),Jr(e)}),!0),i("keyMap","default",(function(e,t,i){var n=Ws(t),r=i!=La&&Ws(i);r&&r.detach&&r.detach(e,n),n.attach&&n.attach(e,r||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,Ba,!0),i("gutters",[],(function(e,t){e.display.gutterSpecs=Kr(t,e.options.lineNumbers),Jr(e)}),!0),i("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?Dn(e.display)+"px":"0",e.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(function(e){return vr(e)}),!0),i("scrollbarStyle","native",(function(e){wr(e),vr(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),i("lineNumbers",!1,(function(e,t){e.display.gutterSpecs=Kr(e.options.gutters,t),Jr(e)}),!0),i("firstLineNumber",1,Jr,!0),i("lineNumberFormatter",(function(e){return e}),Jr,!0),i("showCursorWhenSelecting",!1,Gn,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,(function(e,t){"nocursor"==t&&(Qn(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),i("screenReaderLabel",null,(function(e,t){t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),i("disableInput",!1,(function(e,t){t||e.display.input.reset()}),!0),i("dragDrop",!0,Ra),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,Gn,!0),i("singleCursorHeightPerLine",!0,Gn,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,go,!0),i("addModeClass",!1,go,!0),i("pollInterval",100),i("undoDepth",200,(function(e,t){return e.doc.history.undoDepth=t})),i("historyEventDelay",1250),i("viewportMargin",10,(function(e){return e.refresh()}),!0),i("maxHighlightLength",1e4,go,!0),i("moveInputWithCursor",!0,(function(e,t){t||e.display.input.resetPosition()})),i("tabindex",null,(function(e,t){return e.display.input.getField().tabIndex=t||""})),i("autofocus",null),i("direction","ltr",(function(e,t){return e.doc.setDirection(t)}),!0),i("phrases",null)}function Ra(e,t,i){if(!t!=!(i&&i!=La)){var n=e.display.dragFunctions,r=t?me:ye;r(e.display.scroller,"dragstart",n.start),r(e.display.scroller,"dragenter",n.enter),r(e.display.scroller,"dragover",n.over),r(e.display.scroller,"dragleave",n.leave),r(e.display.scroller,"drop",n.drop)}}function Ba(e){e.options.lineWrapping?(P(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(E(e.display.wrapper,"CodeMirror-wrap"),li(e)),On(e),Fn(e),pn(e),setTimeout((function(){return vr(e)}),100)}function Fa(e,t){var i=this;if(!(this instanceof Fa))return new Fa(e,t);this.options=t=t?F(t):{},F(Da,t,!1);var n=t.value;"string"==typeof n?n=new ks(n,t.mode,null,t.lineSeparator,t.direction):t.mode&&(n.modeOption=t.mode),this.doc=n;var r=new Fa.inputStyles[t.inputStyle](this),o=this.display=new Qr(e,n,r,t);for(var c in o.wrapper.CodeMirror=this,Ia(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),wr(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new j,keySeq:null,specialChars:null},t.autofocus&&!_&&o.input.focus(),s&&a<11&&setTimeout((function(){return i.display.input.reset(!0)}),20),$a(this),Ls(),kr(this),this.curOp.forceUpdate=!0,xo(this,n),t.autofocus&&!_||this.hasFocus()?setTimeout((function(){i.hasFocus()&&!i.state.focused&&Jn(i)}),20):Qn(this),Pa)Pa.hasOwnProperty(c)&&Pa[c](this,t[c],La);Xr(this),t.finishInit&&t.finishInit(this);for(var u=0;u<ja.length;++u)ja[u](this);Sr(this),l&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function $a(e){var t=e.display;me(t.scroller,"mousedown",Dr(e,va)),me(t.scroller,"dblclick",s&&a<11?Dr(e,(function(t){if(!ve(e,t)){var i=Rn(e,t);if(i&&!Ma(e,t)&&!Gi(e.display,t)){Te(t);var n=e.findWordAt(i);Bo(e.doc,n.anchor,n.head)}}})):function(t){return ve(e,t)||Te(t)}),me(t.scroller,"contextmenu",(function(t){return Aa(e,t)})),me(t.input.getField(),"contextmenu",(function(i){t.scroller.contains(i.target)||Aa(e,i)}));var i,n={end:0};function r(){t.activeTouch&&(i=setTimeout((function(){return t.activeTouch=null}),1e3),(n=t.activeTouch).end=+new Date)}function o(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function l(e,t){if(null==t.left)return!0;var i=t.left-e.left,n=t.top-e.top;return i*i+n*n>400}me(t.scroller,"touchstart",(function(r){if(!ve(e,r)&&!o(r)&&!Ma(e,r)){t.input.ensurePolled(),clearTimeout(i);var s=+new Date;t.activeTouch={start:s,moved:!1,prev:s-n.end<=300?n:null},1==r.touches.length&&(t.activeTouch.left=r.touches[0].pageX,t.activeTouch.top=r.touches[0].pageY)}})),me(t.scroller,"touchmove",(function(){t.activeTouch&&(t.activeTouch.moved=!0)})),me(t.scroller,"touchend",(function(i){var n=t.activeTouch;if(n&&!Gi(t,i)&&null!=n.left&&!n.moved&&new Date-n.start<300){var o,s=e.coordsChar(t.activeTouch,"page");o=!n.prev||l(n,n.prev)?new so(s,s):!n.prev.prev||l(n,n.prev.prev)?e.findWordAt(s):new so(st(s.line,0),pt(e.doc,st(s.line+1,0))),e.setSelection(o.anchor,o.head),e.focus(),Te(i)}r()})),me(t.scroller,"touchcancel",r),me(t.scroller,"scroll",(function(){t.scroller.clientHeight&&(pr(e,t.scroller.scrollTop),mr(e,t.scroller.scrollLeft,!0),_e(e,"scroll",e))})),me(t.scroller,"mousewheel",(function(t){return ro(e,t)})),me(t.scroller,"DOMMouseScroll",(function(t){return ro(e,t)})),me(t.wrapper,"scroll",(function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0})),t.dragFunctions={enter:function(t){ve(e,t)||Ce(t)},over:function(t){ve(e,t)||(Ms(e,t),Ce(t))},start:function(t){return Es(e,t)},drop:Dr(e,Cs),leave:function(t){ve(e,t)||As(e)}};var c=t.input.getField();me(c,"keyup",(function(t){return da.call(e,t)})),me(c,"keydown",Dr(e,ua)),me(c,"keypress",Dr(e,pa)),me(c,"focus",(function(t){return Jn(e,t)})),me(c,"blur",(function(t){return Qn(e,t)}))}Fa.defaults=Da,Fa.optionHandlers=Pa;var ja=[];function Na(e,t,i,n){var r,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=xt(e,t).state:i="prev");var s=e.options.tabSize,a=Je(o,t),l=$(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&((c=o.mode.indent(r,a.text.slice(u.length),a.text))==V||c>150)){if(!n)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?$(Je(o,t-1).text,null,s):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",d=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/s);p;--p)d+=s,h+="\t";if(d<c&&(h+=X(c-d)),h!=u)return os(o,h,st(t,0),st(t,u.length),"+input"),a.stateAfter=null,!0;for(var f=0;f<o.sel.ranges.length;f++){var m=o.sel.ranges[f];if(m.head.line==t&&m.head.ch<u.length){var g=st(t,u.length);$o(o,f,new so(g,g));break}}}Fa.defineInitHook=function(e){return ja.push(e)};var Ua=null;function Va(e){Ua=e}function Ga(e,t,i,n,r){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var s=+new Date-200,a="paste"==r||e.state.pasteIncoming>s,l=Oe(t),c=null;if(a&&n.ranges.length>1)if(Ua&&Ua.text.join("\n")==t){if(n.ranges.length%Ua.text.length==0){c=[];for(var u=0;u<Ua.text.length;u++)c.push(o.splitLines(Ua.text[u]))}}else l.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(c=Y(l,(function(e){return[e]})));for(var h=e.curOp.updateInput,d=n.ranges.length-1;d>=0;d--){var p=n.ranges[d],f=p.from(),m=p.to();p.empty()&&(i&&i>0?f=st(f.line,f.ch-i):e.state.overwrite&&!a?m=st(m.line,Math.min(Je(o,m.line).text.length,m.ch+K(l).length)):a&&Ua&&Ua.lineWise&&Ua.text.join("\n")==l.join("\n")&&(f=m=st(f.line,0)));var g={from:f,to:m,text:c?c[d%c.length]:l,origin:r||(a?"paste":e.state.cutIncoming>s?"cut":"+input")};Qo(e.doc,g),Ai(e,"inputRead",e,g)}t&&!a&&Wa(e,t),lr(e),e.curOp.updateInput<2&&(e.curOp.updateInput=h),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function qa(e,t){var i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||!t.hasFocus()||Lr(t,(function(){return Ga(t,i,0,null,"paste")})),!0}function Wa(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var i=e.doc.sel,n=i.ranges.length-1;n>=0;n--){var r=i.ranges[n];if(!(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)){var o=e.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(t.indexOf(o.electricChars.charAt(a))>-1){s=Na(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Je(e.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Na(e,r.head.line,"smart"));s&&Ai(e,"electricInput",e,r.head.line)}}}function Ha(e){for(var t=[],i=[],n=0;n<e.doc.sel.ranges.length;n++){var r=e.doc.sel.ranges[n].head.line,o={anchor:st(r,0),head:st(r+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function Za(e,t,i,n){e.setAttribute("autocorrect",i?"":"off"),e.setAttribute("autocapitalize",n?"":"off"),e.setAttribute("spellcheck",!!t)}function Xa(){var e=z("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=z("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?e.style.width="1000px":e.setAttribute("wrap","off"),g&&(e.style.border="1px solid black"),Za(e),t}function Ka(e){var t=e.optionHandlers,i=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,i){var n=this.options,r=n[e];n[e]==i&&"mode"!=e||(n[e]=i,t.hasOwnProperty(e)&&Dr(this,t[e])(this,i,r),_e(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Ws(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:Pr((function(t,i){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");J(this.state.overlays,{mode:n,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},(function(e){return e.priority})),this.state.modeGen++,Fn(this)})),removeOverlay:Pr((function(e){for(var t=this.state.overlays,i=0;i<t.length;++i){var n=t[i].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(i,1),this.state.modeGen++,void Fn(this)}})),indentLine:Pr((function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),rt(this.doc,e)&&Na(this,e,t,i)})),indentSelection:Pr((function(e){for(var t=this.doc.sel.ranges,i=-1,n=0;n<t.length;n++){var r=t[n];if(r.empty())r.head.line>i&&(Na(this,r.head.line,e,!0),i=r.head.line,n==this.doc.sel.primIndex&&lr(this));else{var o=r.from(),s=r.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var l=a;l<i;++l)Na(this,l,e);var c=this.doc.sel.ranges;0==o.ch&&t.length==c.length&&c[n].from().ch>0&&$o(this.doc,n,new so(o,c[n].to()),G)}}})),getTokenAt:function(e,t){return St(this,e,t)},getLineTokens:function(e,t){return St(this,st(e),t,!0)},getTokenTypeAt:function(e){e=pt(this.doc,e);var t,i=vt(this,Je(this.doc,e.line)),n=0,r=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){var s=n+r>>1;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){t=i[2*s+2];break}n=s+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=[];if(!i.hasOwnProperty(t))return n;var r=i[t],o=this.getModeAt(e);if("string"==typeof o[t])r[o[t]]&&n.push(r[o[t]]);else if(o[t])for(var s=0;s<o[t].length;s++){var a=r[o[t][s]];a&&n.push(a)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(var l=0;l<r._global.length;l++){var c=r._global[l];c.pred(o,this)&&-1==N(n,c.val)&&n.push(c.val)}return n},getStateAfter:function(e,t){var i=this.doc;return xt(this,(e=dt(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){var i=this.doc.sel.primary();return xn(this,null==e?i.head:"object"==typeof e?pt(this.doc,e):e?i.from():i.to(),t||"page")},charCoords:function(e,t){return vn(this,pt(this.doc,e),t||"page")},coordsChar:function(e,t){return Tn(this,(e=_n(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=_n(this,{top:e,left:0},t||"page").top,nt(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){var n,r=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,r=!0),n=Je(this.doc,e)}else n=e;return yn(this,n,{top:0,left:0},t||"page",i||r).top+(r?this.doc.height-si(n):0)},defaultTextHeight:function(){return zn(this.display)},defaultCharWidth:function(){return In(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,n,r){var o=this.display,s=(e=xn(this,pt(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)s=e.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&or(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:Pr(ua),triggerOnKeyPress:Pr(pa),triggerOnKeyUp:da,triggerOnMouseDown:Pr(va),execCommand:function(e){if(Js.hasOwnProperty(e))return Js[e].call(null,this)},triggerElectric:Pr((function(e){Wa(this,e)})),findPosH:function(e,t,i,n){var r=1;t<0&&(r=-1,t=-t);for(var o=pt(this.doc,e),s=0;s<t&&!(o=Ya(this.doc,o,r,i,n)).hitSide;++s);return o},moveH:Pr((function(e,t){var i=this;this.extendSelectionsBy((function(n){return i.display.shift||i.doc.extend||n.empty()?Ya(i.doc,n.head,e,t,i.options.rtlMoveVisually):e<0?n.from():n.to()}),W)})),deleteH:Pr((function(e,t){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):Hs(this,(function(i){var r=Ya(n,i.head,e,t,!1);return e<0?{from:r,to:i.head}:{from:i.head,to:r}}))})),findPosV:function(e,t,i,n){var r=1,o=n;t<0&&(r=-1,t=-t);for(var s=pt(this.doc,e),a=0;a<t;++a){var l=xn(this,s,"div");if(null==o?o=l.left:l.left=o,(s=Ja(this,l,r,i)).hitSide)break}return s},moveV:Pr((function(e,t){var i=this,n=this.doc,r=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy((function(s){if(o)return e<0?s.from():s.to();var a=xn(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Ja(i,a,e,t);return"page"==t&&s==n.sel.primary()&&ar(i,vn(i,l,"div").top-a.top),l}),W),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]})),findWordAt:function(e){var t=Je(this.doc,e.line).text,i=e.ch,n=e.ch;if(t){var r=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!i?++n:--i;for(var o=t.charAt(i),s=ne(o,r)?function(e){return ne(e,r)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!ne(e)};i>0&&s(t.charAt(i-1));)--i;for(;n<t.length&&s(t.charAt(n));)++n}return new so(st(e.line,i),st(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?P(this.display.cursorDiv,"CodeMirror-overwrite"):E(this.display.cursorDiv,"CodeMirror-overwrite"),_e(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==D()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Pr((function(e,t){cr(this,e,t)})),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Zi(this)-this.display.barHeight,width:e.scrollWidth-Zi(this)-this.display.barWidth,clientHeight:Ki(this),clientWidth:Xi(this)}},scrollIntoView:Pr((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:st(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?ur(this,e):dr(this,e.from,e.to,e.margin)})),setSize:Pr((function(e,t){var i=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&dn(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,(function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){$n(i,r,"widget");break}++r})),this.curOp.forceUpdate=!0,_e(this,"refresh",this)})),operation:function(e){return Lr(this,e)},startOperation:function(){return kr(this)},endOperation:function(){return Sr(this)},refresh:Pr((function(){var e=this.display.cachedTextHeight;Fn(this),this.curOp.forceUpdate=!0,pn(this),cr(this,this.doc.scrollLeft,this.doc.scrollTop),Wr(this.display),(null==e||Math.abs(e-zn(this.display))>.5||this.options.lineWrapping)&&On(this),_e(this,"refresh",this)})),swapDoc:Pr((function(e){var t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),xo(this,e),pn(this),this.display.input.reset(),cr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,Ai(this,"swapDoc",this,t),t})),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},we(e),e.registerHelper=function(t,n,r){i.hasOwnProperty(t)||(i[t]=e[t]={_global:[]}),i[t][n]=r},e.registerGlobalHelper=function(t,n,r,o){e.registerHelper(t,n,o),i[t]._global.push({pred:r,val:o})}}function Ya(e,t,i,n,r){var o=t,s=i,a=Je(e,t.line),l=r&&"rtl"==e.direction?-i:i;function c(){var i=t.line+l;return!(i<e.first||i>=e.first+e.size)&&(t=new st(i,t.ch,t.sticky),a=Je(e,i))}function u(o){var s;if("codepoint"==n){var u=a.text.charCodeAt(t.ch+(i>0?0:-1));if(isNaN(u))s=null;else{var h=i>0?u>=55296&&u<56320:u>=56320&&u<57343;s=new st(t.line,Math.max(0,Math.min(a.text.length,t.ch+i*(h?2:1))),-i)}}else s=r?Ys(e.cm,a,t,i):Xs(a,t,i);if(null==s){if(o||!c())return!1;t=Ks(r,e.cm,a,t.line,l)}else t=s;return!0}if("char"==n||"codepoint"==n)u();else if("column"==n)u(!0);else if("word"==n||"group"==n)for(var h=null,d="group"==n,p=e.cm&&e.cm.getHelper(t,"wordChars"),f=!0;!(i<0)||u(!f);f=!1){var m=a.text.charAt(t.ch)||"\n",g=ne(m,p)?"w":d&&"\n"==m?"n":!d||/\s/.test(m)?null:"p";if(!d||f||g||(g="s"),h&&h!=g){i<0&&(i=1,u(),t.sticky="after");break}if(g&&(h=g),i>0&&!u(!f))break}var y=Xo(e,t,o,s,!0);return lt(o,y)&&(y.hitSide=!0),y}function Ja(e,t,i,n){var r,o,s=e.doc,a=t.left;if("page"==n){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*zn(e.display),3);r=(i>0?t.bottom:t.top)+i*c}else"line"==n&&(r=i>0?t.bottom+3:t.top-3);for(;(o=Tn(e,a,r)).outside;){if(i<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*i}return o}var Qa=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new j,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function el(e,t){var i=tn(e,t.line);if(!i||i.hidden)return null;var n=Je(e.doc,t.line),r=Ji(i,n,t.line),o=pe(n,e.doc.direction),s="left";o&&(s=he(o,t.ch)%2?"right":"left");var a=an(r.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function tl(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function il(e,t){return t&&(e.bad=!0),e}function nl(e,t,i,n,r){var o="",s=!1,a=e.doc.lineSeparator(),l=!1;function c(e){return function(t){return t.id==e}}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(e){e&&(u(),o+=e)}function d(t){if(1==t.nodeType){var i=t.getAttribute("cm-text");if(i)return void h(i);var o,p=t.getAttribute("cm-marker");if(p){var f=e.findMarks(st(n,0),st(r+1,0),c(+p));return void(f.length&&(o=f[0].find(0))&&h(Qe(e.doc,o.from,o.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;var m=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;m&&u();for(var g=0;g<t.childNodes.length;g++)d(t.childNodes[g]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),m&&(s=!0)}else 3==t.nodeType&&h(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;d(t),t!=i;)t=t.nextSibling,l=!1;return o}function rl(e,t,i){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[i]))return il(e.clipPos(st(e.display.viewTo-1)),!0);t=null,i=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var o=e.display.view[r];if(o.node==n)return ol(o,t,i)}}function ol(e,t,i){var n=e.text.firstChild,r=!1;if(!t||!L(n,t))return il(st(it(e.line),0),!0);if(t==n&&(r=!0,t=n.childNodes[i],i=0,!t)){var o=e.rest?K(e.rest):e.line;return il(st(it(o),o.text.length),r)}var s=3==t.nodeType?t:null,a=t;for(s||1!=t.childNodes.length||3!=t.firstChild.nodeType||(s=t.firstChild,i&&(i=s.nodeValue.length));a.parentNode!=n;)a=a.parentNode;var l=e.measure,c=l.maps;function u(t,i,n){for(var r=-1;r<(c?c.length:0);r++)for(var o=r<0?l.map:c[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==t||a==i){var u=it(r<0?e.line:e.rest[r]),h=o[s]+n;return(n<0||a!=t)&&(h=o[s+(n?1:0)]),st(u,h)}}}var h=u(s,a,i);if(h)return il(h,r);for(var d=a.nextSibling,p=s?s.nodeValue.length-i:0;d;d=d.nextSibling){if(h=u(d,d.firstChild,0))return il(st(h.line,h.ch-p),r);p+=d.textContent.length}for(var f=a.previousSibling,m=i;f;f=f.previousSibling){if(h=u(f,f.firstChild,-1))return il(st(h.line,h.ch+m),r);m+=f.textContent.length}}Qa.prototype.init=function(e){var t=this,i=this,n=i.cm,r=i.div=e.lineDiv;function o(e){for(var t=e.target;t;t=t.parentNode){if(t==r)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function s(e){if(o(e)&&!ve(n,e)){if(n.somethingSelected())Va({lineWise:!1,text:n.getSelections()}),"cut"==e.type&&n.replaceSelection("",null,"cut");else{if(!n.options.lineWiseCopyCut)return;var t=Ha(n);Va({lineWise:!0,text:t.text}),"cut"==e.type&&n.operation((function(){n.setSelections(t.ranges,0,G),n.replaceSelection("",null,"cut")}))}if(e.clipboardData){e.clipboardData.clearData();var s=Ua.text.join("\n");if(e.clipboardData.setData("Text",s),e.clipboardData.getData("Text")==s)return void e.preventDefault()}var a=Xa(),l=a.firstChild;n.display.lineSpace.insertBefore(a,n.display.lineSpace.firstChild),l.value=Ua.text.join("\n");var c=D();R(l),setTimeout((function(){n.display.lineSpace.removeChild(a),c.focus(),c==r&&i.showPrimarySelection()}),50)}}r.contentEditable=!0,Za(r,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize),me(r,"paste",(function(e){!o(e)||ve(n,e)||qa(e,n)||a<=11&&setTimeout(Dr(n,(function(){return t.updateFromDOM()})),20)})),me(r,"compositionstart",(function(e){t.composing={data:e.data,done:!1}})),me(r,"compositionupdate",(function(e){t.composing||(t.composing={data:e.data,done:!1})})),me(r,"compositionend",(function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)})),me(r,"touchstart",(function(){return i.forceCompositionEnd()})),me(r,"input",(function(){t.composing||t.readFromDOMSoon()})),me(r,"copy",s),me(r,"cut",s)},Qa.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},Qa.prototype.prepareSelection=function(){var e=qn(this.cm,!1);return e.focus=D()==this.div,e},Qa.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Qa.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Qa.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,n=t.doc.sel.primary(),r=n.from(),o=n.to();if(t.display.viewTo==t.display.viewFrom||r.line>=t.display.viewTo||o.line<t.display.viewFrom)e.removeAllRanges();else{var s=rl(t,e.anchorNode,e.anchorOffset),a=rl(t,e.focusNode,e.focusOffset);if(!s||s.bad||!a||a.bad||0!=at(ht(s,a),r)||0!=at(ut(s,a),o)){var l=t.display.view,c=r.line>=t.display.viewFrom&&el(t,r)||{node:l[0].measure.map[2],offset:0},u=o.line<t.display.viewTo&&el(t,o);if(!u){var h=l[l.length-1].measure,d=h.maps?h.maps[h.maps.length-1]:h.map;u={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}}if(c&&u){var p,f=e.rangeCount&&e.getRangeAt(0);try{p=C(c.node,c.offset,u.offset,u.node)}catch(e){}p&&(!i&&t.state.focused?(e.collapse(c.node,c.offset),p.collapsed||(e.removeAllRanges(),e.addRange(p))):(e.removeAllRanges(),e.addRange(p)),f&&null==e.anchorNode?e.addRange(f):i&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Qa.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation((function(){return e.cm.curOp.selectionChanged=!0}))}),20)},Qa.prototype.showMultipleSelections=function(e){A(this.cm.display.cursorDiv,e.cursors),A(this.cm.display.selectionDiv,e.selection)},Qa.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Qa.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return L(this.div,t)},Qa.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&D()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Qa.prototype.blur=function(){this.div.blur()},Qa.prototype.getField=function(){return this.div},Qa.prototype.supportsTouch=function(){return!0},Qa.prototype.receivedFocus=function(){var e=this,t=this;function i(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,i))}this.selectionInEditor()?setTimeout((function(){return e.pollSelection()}),20):Lr(this.cm,(function(){return t.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,i)},Qa.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Qa.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(y&&u&&this.cm.display.gutterSpecs.length&&tl(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=rl(t,e.anchorNode,e.anchorOffset),n=rl(t,e.focusNode,e.focusOffset);i&&n&&Lr(t,(function(){Vo(t.doc,lo(i,n),G),(i.bad||n.bad)&&(t.curOp.selectionChanged=!0)}))}}},Qa.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,i,n=this.cm,r=n.display,o=n.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>n.firstLine()&&(s=st(s.line-1,Je(n.doc,s.line-1).length)),a.ch==Je(n.doc,a.line).text.length&&a.line<n.lastLine()&&(a=st(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(e=Bn(n,s.line))?(t=it(r.view[0].line),i=r.view[0].node):(t=it(r.view[e].line),i=r.view[e-1].node.nextSibling);var l,c,u=Bn(n,a.line);if(u==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=it(r.view[u+1].line)-1,c=r.view[u+1].node.previousSibling),!i)return!1;for(var h=n.doc.splitLines(nl(n,i,c,t,l)),d=Qe(n.doc,st(t,0),st(l,Je(n.doc,l).text.length));h.length>1&&d.length>1;)if(K(h)==K(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),t++}for(var p=0,f=0,m=h[0],g=d[0],y=Math.min(m.length,g.length);p<y&&m.charCodeAt(p)==g.charCodeAt(p);)++p;for(var _=K(h),v=K(d),x=Math.min(_.length-(1==h.length?p:0),v.length-(1==d.length?p:0));f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==d.length&&t==s.line)for(;p&&p>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)p--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(p).replace(/\u200b+$/,"");var b=st(t,p),w=st(l,d.length?K(d).length-f:0);return h.length>1||h[0]||at(b,w)?(os(n.doc,h,b,w,"+input"),!0):void 0},Qa.prototype.ensurePolled=function(){this.forceCompositionEnd()},Qa.prototype.reset=function(){this.forceCompositionEnd()},Qa.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Qa.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()}),80))},Qa.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||Lr(this.cm,(function(){return Fn(e.cm)}))},Qa.prototype.setUneditable=function(e){e.contentEditable="false"},Qa.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Dr(this.cm,Ga)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Qa.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Qa.prototype.onContextMenu=function(){},Qa.prototype.resetPosition=function(){},Qa.prototype.needsContentAttribute=!0;var sl=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new j,this.hasSelection=!1,this.composing=null};function al(e,t){if((t=t?F(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var i=D();t.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}function n(){e.value=a.getValue()}var r;if(e.form&&(me(e.form,"submit",n),!t.leaveSubmitMethodAlone)){var o=e.form;r=o.submit;try{var s=o.submit=function(){n(),o.submit=r,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(i){i.save=n,i.getTextArea=function(){return e},i.toTextArea=function(){i.toTextArea=isNaN,n(),e.parentNode.removeChild(i.getWrapperElement()),e.style.display="",e.form&&(ye(e.form,"submit",n),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=r))}},e.style.display="none";var a=Fa((function(t){return e.parentNode.insertBefore(t,e.nextSibling)}),t);return a}function ll(e){e.off=ye,e.on=me,e.wheelEventPixels=no,e.Doc=ks,e.splitLines=Oe,e.countColumn=$,e.findColumn=H,e.isWordChar=ie,e.Pass=V,e.signal=_e,e.Line=ci,e.changeEnd=co,e.scrollbarModel=br,e.Pos=st,e.cmpPos=at,e.modes=je,e.mimeModes=Ne,e.resolveMode=Ge,e.getMode=qe,e.modeExtensions=We,e.extendMode=He,e.copyState=Ze,e.startState=Ke,e.innerMode=Xe,e.commands=Js,e.keyMap=$s,e.keyName=qs,e.isModifierKey=Vs,e.lookupKey=Us,e.normalizeKeyMap=Ns,e.StringStream=Ye,e.SharedTextMarker=_s,e.TextMarker=gs,e.LineWidget=ds,e.e_preventDefault=Te,e.e_stopPropagation=ke,e.e_stop=Ce,e.addClass=P,e.contains=L,e.rmClass=E,e.keyNames=Os}sl.prototype.init=function(e){var t=this,i=this,n=this.cm;this.createField(e);var r=this.textarea;function o(e){if(!ve(n,e)){if(n.somethingSelected())Va({lineWise:!1,text:n.getSelections()});else{if(!n.options.lineWiseCopyCut)return;var t=Ha(n);Va({lineWise:!0,text:t.text}),"cut"==e.type?n.setSelections(t.ranges,null,G):(i.prevInput="",r.value=t.text.join("\n"),R(r))}"cut"==e.type&&(n.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),g&&(r.style.width="0px"),me(r,"input",(function(){s&&a>=9&&t.hasSelection&&(t.hasSelection=null),i.poll()})),me(r,"paste",(function(e){ve(n,e)||qa(e,n)||(n.state.pasteIncoming=+new Date,i.fastPoll())})),me(r,"cut",o),me(r,"copy",o),me(e.scroller,"paste",(function(t){if(!Gi(e,t)&&!ve(n,t)){if(!r.dispatchEvent)return n.state.pasteIncoming=+new Date,void i.focus();var o=new Event("paste");o.clipboardData=t.clipboardData,r.dispatchEvent(o)}})),me(e.lineSpace,"selectstart",(function(t){Gi(e,t)||Te(t)})),me(r,"compositionstart",(function(){var e=n.getCursor("from");i.composing&&i.composing.range.clear(),i.composing={start:e,range:n.markText(e,n.getCursor("to"),{className:"CodeMirror-composing"})}})),me(r,"compositionend",(function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)}))},sl.prototype.createField=function(e){this.wrapper=Xa(),this.textarea=this.wrapper.firstChild},sl.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},sl.prototype.prepareSelection=function(){var e=this.cm,t=e.display,i=e.doc,n=qn(e);if(e.options.moveInputWithCursor){var r=xn(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-o.left))}return n},sl.prototype.showSelection=function(e){var t=this.cm.display;A(t.cursorDiv,e.cursors),A(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},sl.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var i=t.getSelection();this.textarea.value=i,t.state.focused&&R(this.textarea),s&&a>=9&&(this.hasSelection=i)}else e||(this.prevInput=this.textarea.value="",s&&a>=9&&(this.hasSelection=null))}},sl.prototype.getField=function(){return this.textarea},sl.prototype.supportsTouch=function(){return!1},sl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!_||D()!=this.textarea))try{this.textarea.focus()}catch(e){}},sl.prototype.blur=function(){this.textarea.blur()},sl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},sl.prototype.receivedFocus=function(){this.slowPoll()},sl.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){e.poll(),e.cm.state.focused&&e.slowPoll()}))},sl.prototype.fastPoll=function(){var e=!1,t=this;function i(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,i))}t.pollingFast=!0,t.polling.set(20,i)},sl.prototype.poll=function(){var e=this,t=this.cm,i=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||Re(i)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=i.value;if(r==n&&!t.somethingSelected())return!1;if(s&&a>=9&&this.hasSelection===r||v&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,c=Math.min(n.length,r.length);l<c&&n.charCodeAt(l)==r.charCodeAt(l);)++l;return Lr(t,(function(){Ga(t,r.slice(l),n.length-l,null,e.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?i.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},sl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},sl.prototype.onKeyPress=function(){s&&a>=9&&(this.hasSelection=null),this.fastPoll()},sl.prototype.onContextMenu=function(e){var t=this,i=t.cm,n=i.display,r=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=Rn(i,e),c=n.scroller.scrollTop;if(o&&!d){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&Dr(i,Vo)(i.doc,lo(o),G);var u,h=r.style.cssText,p=t.wrapper.style.cssText,f=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",r.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(s?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(u=window.scrollY),n.input.focus(),l&&window.scrollTo(null,u),n.input.reset(),i.somethingSelected()||(r.value=t.prevInput=" "),t.contextMenuPending=y,n.selForContextMenu=i.doc.sel,clearTimeout(n.detectingSelectAll),s&&a>=9&&g(),k){Ce(e);var m=function(){ye(window,"mouseup",m),setTimeout(y,20)};me(window,"mouseup",m)}else setTimeout(y,50)}function g(){if(null!=r.selectionStart){var e=i.somethingSelected(),o="​"+(e?r.value:"");r.value="⇚",r.value=o,t.prevInput=e?"":"​",r.selectionStart=1,r.selectionEnd=o.length,n.selForContextMenu=i.doc.sel}}function y(){if(t.contextMenuPending==y&&(t.contextMenuPending=!1,t.wrapper.style.cssText=p,r.style.cssText=h,s&&a<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=c),null!=r.selectionStart)){(!s||s&&a<9)&&g();var e=0,o=function(){n.selForContextMenu==i.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&"​"==t.prevInput?Dr(i,Yo)(i):e++<10?n.detectingSelectAll=setTimeout(o,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(o,200)}}},sl.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e},sl.prototype.setUneditable=function(){},sl.prototype.needsContentAttribute=!1,Oa(Fa),Ka(Fa);var cl="iter insert remove copy getEditor constructor".split(" ");for(var ul in ks.prototype)ks.prototype.hasOwnProperty(ul)&&N(cl,ul)<0&&(Fa.prototype[ul]=function(e){return function(){return e.apply(this.doc,arguments)}}(ks.prototype[ul]));return we(ks),Fa.inputStyles={textarea:sl,contenteditable:Qa},Fa.defineMode=function(e){Fa.defaults.mode||"null"==e||(Fa.defaults.mode=e),Ue.apply(this,arguments)},Fa.defineMIME=Ve,Fa.defineMode("null",(function(){return{token:function(e){return e.skipToEnd()}}})),Fa.defineMIME("text/plain","null"),Fa.defineExtension=function(e,t){Fa.prototype[e]=t},Fa.defineDocExtension=function(e,t){ks.prototype[e]=t},Fa.fromTextArea=al,ll(Fa),Fa.version="5.65.5",Fa}());let ql=navigator.userAgent,Wl=navigator.platform,Hl=/gecko\/\d/i.test(ql),Zl=/MSIE \d/.test(ql),Xl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ql),Kl=/Edge\/(\d+)/.exec(ql),Yl=Zl||Xl||Kl,Jl=Yl&&(Zl?document.documentMode||6:+(Kl||Xl)[1]),Ql=!Kl&&/WebKit\//.test(ql),ec=Ql&&/Qt\/\d+\.\d+/.test(ql),tc=!Kl&&/Chrome\/(\d+)/.exec(ql),ic=tc&&+tc[1],nc=/Opera\//.test(ql),rc=/Apple Computer/.test(navigator.vendor),oc=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ql),sc=/PhantomJS/.test(ql),ac=rc&&(/Mobile\/\w+/.test(ql)||navigator.maxTouchPoints>2),lc=/Android/.test(ql),cc=ac||lc||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ql),uc=ac||/Mac/.test(Wl),hc=/\bCrOS\b/.test(ql),dc=/win/i.test(Wl),pc=nc&&ql.match(/Version\/(\d*\.\d*)/);pc&&(pc=Number(pc[1])),pc&&pc>=15&&(nc=!1,Ql=!0);let fc=uc&&(ec||nc&&(null==pc||pc<12.11)),mc=Hl||Yl&&Jl>=9;function gc(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}let yc,_c=function(e,t){let i=e.className,n=gc(t).exec(i);if(n){let t=i.slice(n.index+n[0].length);e.className=i.slice(0,n.index)+(t?n[1]+t:"")}};function vc(e){for(let t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function xc(e,t){return vc(e).appendChild(t)}function bc(e,t,i,n){let r=document.createElement(e);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(let e=0;e<t.length;++e)r.appendChild(t[e]);return r}function wc(e,t,i,n){let r=bc(e,t,i,n);return r.setAttribute("role","presentation"),r}function Tc(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function kc(){let e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function Sc(e,t){let i=e.className;gc(t).test(i)||(e.className+=(i?" ":"")+t)}function Cc(e,t){let i=e.split(" ");for(let e=0;e<i.length;e++)i[e]&&!gc(i[e]).test(t)&&(t+=" "+i[e]);return t}yc=document.createRange?function(e,t,i,n){let r=document.createRange();return r.setEnd(n||e,i),r.setStart(e,t),r}:function(e,t,i){let n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n};let Ec=function(e){e.select()};function Mc(e){let t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function Ac(e,t,i){t||(t={});for(let n in e)!e.hasOwnProperty(n)||!1===i&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function zc(e,t,i,n,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(let o=n||0,s=r||0;;){let n=e.indexOf("\t",o);if(n<0||n>=t)return s+(t-o);s+=n-o,s+=i-s%i,o=n+1}}ac?Ec=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:Yl&&(Ec=function(e){try{e.select()}catch(e){}});class Ic{constructor(){this.id=null,this.f=null,this.time=0,this.handler=Mc(this.onTimeout,this)}onTimeout(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)}set(e,t){this.f=t;const i=+new Date+e;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=i)}}function Lc(e,t){for(let i=0;i<e.length;++i)if(e[i]==t)return i;return-1}let Dc={toString:function(){return"CodeMirror.Pass"}},Pc={scroll:!1},Oc={origin:"*mouse"},Rc={origin:"+move"};function Bc(e,t,i){for(let n=0,r=0;;){let o=e.indexOf("\t",n);-1==o&&(o=e.length);let s=o-n;if(o==e.length||r+s>=t)return n+Math.min(s,t-r);if(r+=o-n,r+=i-r%i,n=o+1,r>=t)return n}}let Fc=[""];function $c(e){for(;Fc.length<=e;)Fc.push(jc(Fc)+" ");return Fc[e]}function jc(e){return e[e.length-1]}function Nc(e,t){let i=[];for(let n=0;n<e.length;n++)i[n]=t(e[n],n);return i}function Uc(){}function Vc(e,t){let i;return Object.create?i=Object.create(e):(Uc.prototype=e,i=new Uc),t&&Ac(t,i),i}let Gc=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function qc(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Gc.test(e))}function Wc(e,t){return t?!!(t.source.indexOf("\\w")>-1&&qc(e))||t.test(e):qc(e)}function Hc(e){for(let t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}let Zc=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Xc(e){return e.charCodeAt(0)>=768&&Zc.test(e)}function Kc(e,t,i){for(;(i<0?t>0:t<e.length)&&Xc(e.charAt(t));)t+=i;return t}function Yc(e,t,i){let n=t>i?-1:1;for(;;){if(t==i)return t;let r=(t+i)/2,o=n<0?Math.ceil(r):Math.floor(r);if(o==t)return e(o)?t:i;e(o)?i=o:t=o+n}}let Jc=null;function Qc(e,t,i){let n;Jc=null;for(let r=0;r<e.length;++r){let o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==i?n=r:Jc=r),o.from==t&&(o.from!=o.to&&"before"!=i?n=r:Jc=r)}return null!=n?n:Jc}let eu=function(){let e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,t=/[stwN]/,i=/[LRr]/,n=/[Lb1n]/,r=/[1n]/;function o(e,t,i){this.level=e,this.from=t,this.to=i}return function(s,a){let l="ltr"==a?"L":"R";if(0==s.length||"ltr"==a&&!e.test(s))return!1;let c=s.length,u=[];for(let e=0;e<c;++e)u.push((h=s.charCodeAt(e))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(h):1424<=h&&h<=1524?"R":1536<=h&&h<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(h-1536):1774<=h&&h<=2220?"r":8192<=h&&h<=8203?"w":8204==h?"b":"L");var h;for(let e=0,t=l;e<c;++e){let i=u[e];"m"==i?u[e]=t:t=i}for(let e=0,t=l;e<c;++e){let n=u[e];"1"==n&&"r"==t?u[e]="n":i.test(n)&&(t=n,"r"==n&&(u[e]="R"))}for(let e=1,t=u[0];e<c-1;++e){let i=u[e];"+"==i&&"1"==t&&"1"==u[e+1]?u[e]="1":","!=i||t!=u[e+1]||"1"!=t&&"n"!=t||(u[e]=t),t=i}for(let e=0;e<c;++e){let t=u[e];if(","==t)u[e]="N";else if("%"==t){let t;for(t=e+1;t<c&&"%"==u[t];++t);let i=e&&"!"==u[e-1]||t<c&&"1"==u[t]?"1":"N";for(let n=e;n<t;++n)u[n]=i;e=t-1}}for(let e=0,t=l;e<c;++e){let n=u[e];"L"==t&&"1"==n?u[e]="L":i.test(n)&&(t=n)}for(let e=0;e<c;++e)if(t.test(u[e])){let i;for(i=e+1;i<c&&t.test(u[i]);++i);let n="L"==(e?u[e-1]:l),r=n==("L"==(i<c?u[i]:l))?n?"L":"R":l;for(let t=e;t<i;++t)u[t]=r;e=i-1}let d,p=[];for(let e=0;e<c;)if(n.test(u[e])){let t=e;for(++e;e<c&&n.test(u[e]);++e);p.push(new o(0,t,e))}else{let t=e,i=p.length,n="rtl"==a?1:0;for(++e;e<c&&"L"!=u[e];++e);for(let s=t;s<e;)if(r.test(u[s])){t<s&&(p.splice(i,0,new o(1,t,s)),i+=n);let a=s;for(++s;s<e&&r.test(u[s]);++s);p.splice(i,0,new o(2,a,s)),i+=n,t=s}else++s;t<e&&p.splice(i,0,new o(1,t,e))}return"ltr"==a&&(1==p[0].level&&(d=s.match(/^\s+/))&&(p[0].from=d[0].length,p.unshift(new o(0,0,d[0].length))),1==jc(p).level&&(d=s.match(/\s+$/))&&(jc(p).to-=d[0].length,p.push(new o(0,c-d[0].length,c)))),"rtl"==a?p.reverse():p}}();function tu(e,t){let i=e.order;return null==i&&(i=e.order=eu(e.text,t)),i}const iu=[];let nu=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{let n=e._handlers||(e._handlers={});n[t]=(n[t]||iu).concat(i)}};function ru(e,t){return e._handlers&&e._handlers[t]||iu}function ou(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{let n=e._handlers,r=n&&n[t];if(r){let e=Lc(r,i);e>-1&&(n[t]=r.slice(0,e).concat(r.slice(e+1)))}}}function su(e,t){let i=ru(e,t);if(!i.length)return;let n=Array.prototype.slice.call(arguments,2);for(let e=0;e<i.length;++e)i[e].apply(null,n)}function au(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),su(e,i||t.type,e,t),pu(t)||t.codemirrorIgnore}function lu(e){let t=e._handlers&&e._handlers.cursorActivity;if(!t)return;let i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]);for(let e=0;e<t.length;++e)-1==Lc(i,t[e])&&i.push(t[e])}function cu(e,t){return ru(e,t).length>0}function uu(e){e.prototype.on=function(e,t){nu(this,e,t)},e.prototype.off=function(e,t){ou(this,e,t)}}function hu(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function du(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function pu(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function fu(e){hu(e),du(e)}function mu(e){return e.target||e.srcElement}function gu(e){let t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),uc&&e.ctrlKey&&1==t&&(t=3),t}let yu,_u,vu=function(){if(Yl&&Jl<9)return!1;let e=bc("div");return"draggable"in e||"dragDrop"in e}();function xu(e){if(null==yu){let t=bc("span","​");xc(e,bc("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(yu=t.offsetWidth<=1&&t.offsetHeight>2&&!(Yl&&Jl<8))}let t=yu?bc("span","​"):bc("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return t.setAttribute("cm-text",""),t}function bu(e){if(null!=_u)return _u;let t=xc(e,document.createTextNode("AخA")),i=yc(t,0,1).getBoundingClientRect(),n=yc(t,1,2).getBoundingClientRect();return vc(e),!(!i||i.left==i.right)&&(_u=n.right-i.right<3)}let wu=3!="\n\nb".split(/\n/).length?e=>{let t=0,i=[],n=e.length;for(;t<=n;){let n=e.indexOf("\n",t);-1==n&&(n=e.length);let r=e.slice(t,"\r"==e.charAt(n-1)?n-1:n),o=r.indexOf("\r");-1!=o?(i.push(r.slice(0,o)),t+=o+1):(i.push(r),t=n+1)}return i}:e=>e.split(/\r\n?|\n/),Tu=window.getSelection?e=>{try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:e=>{let t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},ku=(()=>{let e=bc("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)})(),Su=null;let Cu={},Eu={};function Mu(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Cu[e]=t}function Au(e){if("string"==typeof e&&Eu.hasOwnProperty(e))e=Eu[e];else if(e&&"string"==typeof e.name&&Eu.hasOwnProperty(e.name)){let t=Eu[e.name];"string"==typeof t&&(t={name:t}),(e=Vc(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Au("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Au("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function zu(e,t){t=Au(t);let i=Cu[t.name];if(!i)return zu(e,"text/plain");let n=i(e,t);if(Iu.hasOwnProperty(t.name)){let e=Iu[t.name];for(let t in e)e.hasOwnProperty(t)&&(n.hasOwnProperty(t)&&(n["_"+t]=n[t]),n[t]=e[t])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(let e in t.modeProps)n[e]=t.modeProps[e];return n}let Iu={};function Lu(e,t){Ac(t,Iu.hasOwnProperty(e)?Iu[e]:Iu[e]={})}function Du(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);let i={};for(let e in t){let n=t[e];n instanceof Array&&(n=n.concat([])),i[e]=n}return i}function Pu(e,t){let i;for(;e.innerMode&&(i=e.innerMode(t),i&&i.mode!=e);)t=i.state,e=i.mode;return i||{mode:e,state:t}}function Ou(e,t,i){return!e.startState||e.startState(t,i)}class Ru{constructor(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i}eol(){return this.pos>=this.string.length}sol(){return this.pos==this.lineStart}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t,i=this.string.charAt(this.pos);if(t="string"==typeof e?i==e:i&&(e.test?e.test(i):e(i)),t)return++this.pos,i}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=zc(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?zc(this.string,this.lineStart,this.tabSize):0)}indentation(){return zc(this.string,null,this.tabSize)-(this.lineStart?zc(this.string,this.lineStart,this.tabSize):0)}match(e,t,i){if("string"!=typeof e){let i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}{let n=e=>i?e.toLowerCase():e;if(n(this.string.substr(this.pos,e.length))==n(e))return!1!==t&&(this.pos+=e.length),!0}}current(){return this.string.slice(this.start,this.pos)}hideFirstChars(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}lookAhead(e){let t=this.lineOracle;return t&&t.lookAhead(e)}baseToken(){let e=this.lineOracle;return e&&e.baseToken(this.pos)}}function Bu(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");let i=e;for(;!i.lines;)for(let e=0;;++e){let n=i.children[e],r=n.chunkSize();if(t<r){i=n;break}t-=r}return i.lines[t]}function Fu(e,t,i){let n=[],r=t.line;return e.iter(t.line,i.line+1,(e=>{let o=e.text;r==i.line&&(o=o.slice(0,i.ch)),r==t.line&&(o=o.slice(t.ch)),n.push(o),++r})),n}function $u(e,t,i){let n=[];return e.iter(t,i,(e=>{n.push(e.text)})),n}function ju(e,t){let i=t-e.height;if(i)for(let t=e;t;t=t.parent)t.height+=i}function Nu(e){if(null==e.parent)return null;let t=e.parent,i=Lc(t.lines,e);for(let e=t.parent;e;t=e,e=e.parent)for(let n=0;e.children[n]!=t;++n)i+=e.children[n].chunkSize();return i+t.first}function Uu(e,t){let i=e.first;e:do{for(let n=0;n<e.children.length;++n){let r=e.children[n],o=r.height;if(t<o){e=r;continue e}t-=o,i+=r.chunkSize()}return i}while(!e.lines);let n=0;for(;n<e.lines.length;++n){let i=e.lines[n].height;if(t<i)break;t-=i}return i+n}function Vu(e,t){return t>=e.first&&t<e.first+e.size}function Gu(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function qu(e,t,i=null){if(!(this instanceof qu))return new qu(e,t,i);this.line=e,this.ch=t,this.sticky=i}function Wu(e,t){return e.line-t.line||e.ch-t.ch}function Hu(e,t){return e.sticky==t.sticky&&0==Wu(e,t)}function Zu(e){return qu(e.line,e.ch)}function Xu(e,t){return Wu(e,t)<0?t:e}function Ku(e,t){return Wu(e,t)<0?e:t}function Yu(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function Ju(e,t){if(t.line<e.first)return qu(e.first,0);let i=e.first+e.size-1;return t.line>i?qu(i,Bu(e,i).text.length):function(e,t){let i=e.ch;return null==i||i>t?qu(e.line,t):i<0?qu(e.line,0):e}(t,Bu(e,t.line).text.length)}function Qu(e,t){let i=[];for(let n=0;n<t.length;n++)i[n]=Ju(e,t[n]);return i}class eh{constructor(e,t){this.state=e,this.lookAhead=t}}class th{constructor(e,t,i,n){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1}lookAhead(e){let t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t}baseToken(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;let t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}}nextLine(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--}static fromSaved(e,t,i){return t instanceof eh?new th(e,Du(e.mode,t.state),i,t.lookAhead):new th(e,Du(e.mode,t),i)}save(e){let t=!1!==e?Du(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new eh(t,this.maxLookAhead):t}}function ih(e,t,i,n){let r=[e.state.modeGen],o={};hh(e,t.text,e.doc.mode,i,((e,t)=>r.push(e,t)),o,n);let s=i.state;for(let n=0;n<e.state.overlays.length;++n){i.baseTokens=r;let a=e.state.overlays[n],l=1,c=0;i.state=!0,hh(e,t.text,a.mode,i,((e,t)=>{let i=l;for(;c<e;){let t=r[l];t>e&&r.splice(l,1,e,r[l+1],t),l+=2,c=Math.min(e,t)}if(t)if(a.opaque)r.splice(i,l-i,e,"overlay "+t),l=i+2;else for(;i<l;i+=2){let e=r[i+1];r[i+1]=(e?e+" ":"")+"overlay "+t}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1}return{styles:r,classes:o.bgClass||o.textClass?o:null}}function nh(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){let n=rh(e,Nu(t)),r=t.text.length>e.options.maxHighlightLength&&Du(e.doc.mode,n.state),o=ih(e,t,n);r&&(n.state=r),t.stateAfter=n.save(!r),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function rh(e,t,i){let n=e.doc,r=e.display;if(!n.mode.startState)return new th(n,!0,t);let o=function(e,t,i){let n,r,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100);for(let a=t;a>s;--a){if(a<=o.first)return o.first;let t=Bu(o,a-1),s=t.stateAfter;if(s&&(!i||a+(s instanceof eh?s.lookAhead:0)<=o.modeFrontier))return a;let l=zc(t.text,null,e.options.tabSize);(null==r||n>l)&&(r=a-1,n=l)}return r}(e,t,i),s=o>n.first&&Bu(n,o-1).stateAfter,a=s?th.fromSaved(n,s,o):new th(n,Ou(n.mode),o);return n.iter(o,t,(i=>{oh(e,i.text,a);let n=a.line;i.stateAfter=n==t-1||n%5==0||n>=r.viewFrom&&n<r.viewTo?a.save():null,a.nextLine()})),i&&(n.modeFrontier=a.line),a}function oh(e,t,i,n){let r=e.doc.mode,o=new Ru(t,e.options.tabSize,i);for(o.start=o.pos=n||0,""==t&&sh(r,i.state);!o.eol();)ah(r,o,i.state),o.start=o.pos}function sh(e,t){if(e.blankLine)return e.blankLine(t);if(!e.innerMode)return;let i=Pu(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}function ah(e,t,i,n){for(let r=0;r<10;r++){n&&(n[0]=Pu(e,i).mode);let r=e.token(t,i);if(t.pos>t.start)return r}throw new Error("Mode "+e.name+" failed to advance stream.")}class lh{constructor(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i}}function ch(e,t,i,n){let r,o,s=e.doc,a=s.mode,l=Bu(s,(t=Ju(s,t)).line),c=rh(e,t.line,i),u=new Ru(l.text,e.options.tabSize,c);for(n&&(o=[]);(n||u.pos<t.ch)&&!u.eol();)u.start=u.pos,r=ah(a,u,c.state),n&&o.push(new lh(u,r,Du(s.mode,c.state)));return n?o:new lh(u,r,c.state)}function uh(e,t){if(e)for(;;){let i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);let n=i[1]?"bgClass":"textClass";null==t[n]?t[n]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(t[n])||(t[n]+=" "+i[2])}return e}function hh(e,t,i,n,r,o,s){let a=i.flattenSpans;null==a&&(a=e.options.flattenSpans);let l,c=0,u=null,h=new Ru(t,e.options.tabSize,n),d=e.options.addModeClass&&[null];for(""==t&&uh(sh(i,n.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(a=!1,s&&oh(e,t,n,h.pos),h.pos=t.length,l=null):l=uh(ah(i,h,n.state,d),o),d){let e=d[0].name;e&&(l="m-"+(l?e+" "+l:e))}if(!a||u!=l){for(;c<h.start;)c=Math.min(h.start,c+5e3),r(c,u);u=l}h.start=h.pos}for(;c<h.pos;){let e=Math.min(h.pos,c+5e3);r(e,u),c=e}}let dh=!1,ph=!1;function fh(e,t,i){this.marker=e,this.from=t,this.to=i}function mh(e,t){if(e)for(let i=0;i<e.length;++i){let n=e[i];if(n.marker==t)return n}}function gh(e,t){let i;for(let n=0;n<e.length;++n)e[n]!=t&&(i||(i=[])).push(e[n]);return i}function yh(e,t){if(t.full)return null;let i=Vu(e,t.from.line)&&Bu(e,t.from.line).markedSpans,n=Vu(e,t.to.line)&&Bu(e,t.to.line).markedSpans;if(!i&&!n)return null;let r=t.from.ch,o=t.to.ch,s=0==Wu(t.from,t.to),a=function(e,t,i){let n;if(e)for(let r=0;r<e.length;++r){let o=e[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){let e=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new fh(s,o.from,e?null:o.to))}}return n}(i,r,s),l=function(e,t,i){let n;if(e)for(let r=0;r<e.length;++r){let o=e[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){let e=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new fh(s,e?null:o.from-t,null==o.to?null:o.to-t))}}return n}(n,o,s),c=1==t.text.length,u=jc(t.text).length+(c?r:0);if(a)for(let e=0;e<a.length;++e){let t=a[e];if(null==t.to){let e=mh(l,t.marker);e?c&&(t.to=null==e.to?null:e.to+u):t.to=r}}if(l)for(let e=0;e<l.length;++e){let t=l[e];if(null!=t.to&&(t.to+=u),null==t.from){mh(a,t.marker)||(t.from=u,c&&(a||(a=[])).push(t))}else t.from+=u,c&&(a||(a=[])).push(t)}a&&(a=_h(a)),l&&l!=a&&(l=_h(l));let h=[a];if(!c){let e,i=t.text.length-2;if(i>0&&a)for(let t=0;t<a.length;++t)null==a[t].to&&(e||(e=[])).push(new fh(a[t].marker,null,null));for(let t=0;t<i;++t)h.push(e);h.push(l)}return h}function _h(e){for(let t=0;t<e.length;++t){let i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function vh(e){let t=e.markedSpans;if(t){for(let i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function xh(e,t){if(t){for(let i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function bh(e){return e.inclusiveLeft?-1:0}function wh(e){return e.inclusiveRight?1:0}function Th(e,t){let i=e.lines.length-t.lines.length;if(0!=i)return i;let n=e.find(),r=t.find(),o=Wu(n.from,r.from)||bh(e)-bh(t);if(o)return-o;let s=Wu(n.to,r.to)||wh(e)-wh(t);return s||t.id-e.id}function kh(e,t){let i,n=ph&&e.markedSpans;if(n)for(let e,r=0;r<n.length;++r)e=n[r],e.marker.collapsed&&null==(t?e.from:e.to)&&(!i||Th(i,e.marker)<0)&&(i=e.marker);return i}function Sh(e){return kh(e,!0)}function Ch(e){return kh(e,!1)}function Eh(e,t){let i,n=ph&&e.markedSpans;if(n)for(let e=0;e<n.length;++e){let r=n[e];r.marker.collapsed&&(null==r.from||r.from<t)&&(null==r.to||r.to>t)&&(!i||Th(i,r.marker)<0)&&(i=r.marker)}return i}function Mh(e,t,i,n,r){let o=Bu(e,t),s=ph&&o.markedSpans;if(s)for(let e=0;e<s.length;++e){let t=s[e];if(!t.marker.collapsed)continue;let o=t.marker.find(0),a=Wu(o.from,i)||bh(t.marker)-bh(r),l=Wu(o.to,n)||wh(t.marker)-wh(r);if(!(a>=0&&l<=0||a<=0&&l>=0)&&(a<=0&&(t.marker.inclusiveRight&&r.inclusiveLeft?Wu(o.to,i)>=0:Wu(o.to,i)>0)||a>=0&&(t.marker.inclusiveRight&&r.inclusiveLeft?Wu(o.from,n)<=0:Wu(o.from,n)<0)))return!0}}function Ah(e){let t;for(;t=Sh(e);)e=t.find(-1,!0).line;return e}function zh(e,t){let i=Bu(e,t),n=Ah(i);return i==n?t:Nu(n)}function Ih(e,t){if(t>e.lastLine())return t;let i,n=Bu(e,t);if(!Lh(e,n))return t;for(;i=Ch(n);)n=i.find(1,!0).line;return Nu(n)+1}function Lh(e,t){let i=ph&&t.markedSpans;if(i)for(let n,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&Dh(e,t,n))return!0}}function Dh(e,t,i){if(null==i.to){let t=i.marker.find(1,!0);return Dh(e,t.line,mh(t.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(let n,r=0;r<t.markedSpans.length;++r)if(n=t.markedSpans[r],n.marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&Dh(e,t,n))return!0}function Ph(e){let t=0,i=(e=Ah(e)).parent;for(let n=0;n<i.lines.length;++n){let r=i.lines[n];if(r==e)break;t+=r.height}for(let e=i.parent;e;i=e,e=i.parent)for(let n=0;n<e.children.length;++n){let r=e.children[n];if(r==i)break;t+=r.height}return t}function Oh(e){if(0==e.height)return 0;let t,i=e.text.length,n=e;for(;t=Sh(n);){let e=t.find(0,!0);n=e.from.line,i+=e.from.ch-e.to.ch}for(n=e;t=Ch(n);){let e=t.find(0,!0);i-=n.text.length-e.from.ch,n=e.to.line,i+=n.text.length-e.to.ch}return i}function Rh(e){let t=e.display,i=e.doc;t.maxLine=Bu(i,i.first),t.maxLineLength=Oh(t.maxLine),t.maxLineChanged=!0,i.iter((e=>{let i=Oh(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)}))}class Bh{constructor(e,t,i){this.text=e,xh(this,t),this.height=i?i(this):1}lineNo(){return Nu(this)}}function Fh(e){e.parent=null,vh(e)}uu(Bh);let $h={},jh={};function Nh(e,t){if(!e||/^\s*$/.test(e))return null;let i=t.addModeClass?jh:$h;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function Uh(e,t){let i=wc("span",null,null,Ql?"padding-right: .1px":null),n={pre:wc("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(let i=0;i<=(t.rest?t.rest.length:0);i++){let r,o=i?t.rest[i-1]:t.line;n.pos=0,n.addToken=Gh,bu(e.display.measure)&&(r=tu(o,e.doc.direction))&&(n.addToken=qh(n.addToken,r)),n.map=[],Hh(o,n,nh(e,o,t!=e.display.externalMeasured&&Nu(o))),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=Cc(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=Cc(o.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(xu(e.display.measure))),0==i?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(Ql){let e=n.content.lastChild;(/\bcm-tab\b/.test(e.className)||e.querySelector&&e.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return su(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=Cc(n.pre.className,n.textClass||"")),n}function Vh(e){let t=bc("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function Gh(e,t,i,n,r,o,s){if(!t)return;let a,l=e.splitSpaces?function(e,t){if(e.length>1&&!/  /.test(e))return e;let i=t,n="";for(let t=0;t<e.length;t++){let r=e.charAt(t);" "!=r||!i||t!=e.length-1&&32!=e.charCodeAt(t+1)||(r=" "),n+=r,i=" "==r}return n}(t,e.trailingSpace):t,c=e.cm.state.specialChars,u=!1;if(c.test(t)){a=document.createDocumentFragment();let i=0;for(;;){c.lastIndex=i;let n,r=c.exec(t),o=r?r.index-i:t.length-i;if(o){let t=document.createTextNode(l.slice(i,i+o));Yl&&Jl<9?a.appendChild(bc("span",[t])):a.appendChild(t),e.map.push(e.pos,e.pos+o,t),e.col+=o,e.pos+=o}if(!r)break;if(i+=o+1,"\t"==r[0]){let t=e.cm.options.tabSize,i=t-e.col%t;n=a.appendChild(bc("span",$c(i),"cm-tab")),n.setAttribute("role","presentation"),n.setAttribute("cm-text","\t"),e.col+=i}else"\r"==r[0]||"\n"==r[0]?(n=a.appendChild(bc("span","\r"==r[0]?"␍":"␤","cm-invalidchar")),n.setAttribute("cm-text",r[0]),e.col+=1):(n=e.cm.options.specialCharPlaceholder(r[0]),n.setAttribute("cm-text",r[0]),Yl&&Jl<9?a.appendChild(bc("span",[n])):a.appendChild(n),e.col+=1);e.map.push(e.pos,e.pos+1,n),e.pos++}}else e.col+=t.length,a=document.createTextNode(l),e.map.push(e.pos,e.pos+t.length,a),Yl&&Jl<9&&(u=!0),e.pos+=t.length;if(e.trailingSpace=32==l.charCodeAt(t.length-1),i||n||r||u||o||s){let t=i||"";n&&(t+=n),r&&(t+=r);let l=bc("span",[a],t,o);if(s)for(let e in s)s.hasOwnProperty(e)&&"style"!=e&&"class"!=e&&l.setAttribute(e,s[e]);return e.content.appendChild(l)}e.content.appendChild(a)}function qh(e,t){return(i,n,r,o,s,a,l)=>{r=r?r+" cm-force-border":"cm-force-border";let c=i.pos,u=c+n.length;for(;;){let h;for(let e=0;e<t.length&&(h=t[e],!(h.to>c&&h.from<=c));e++);if(h.to>=u)return e(i,n,r,o,s,a,l);e(i,n.slice(0,h.to-c),r,o,null,a,l),o=null,n=n.slice(h.to-c),c=h.to}}}function Wh(e,t,i,n){let r=!n&&i.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!n&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",i.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function Hh(e,t,i){let n=e.markedSpans,r=e.text,o=0;if(!n){for(let e=1;e<i.length;e+=2)t.addToken(t,r.slice(o,o=i[e]),Nh(i[e+1],t.cm.options));return}let s,a,l,c,u,h,d,p=r.length,f=0,m=1,g="",y=0;for(;;){if(y==f){l=c=u=a="",d=null,h=null,y=1/0;let e,i=[];for(let t=0;t<n.length;++t){let r=n[t],o=r.marker;if("bookmark"==o.type&&r.from==f&&o.widgetNode)i.push(o);else if(r.from<=f&&(null==r.to||r.to>f||o.collapsed&&r.to==f&&r.from==f)){if(null!=r.to&&r.to!=f&&y>r.to&&(y=r.to,c=""),o.className&&(l+=" "+o.className),o.css&&(a=(a?a+";":"")+o.css),o.startStyle&&r.from==f&&(u+=" "+o.startStyle),o.endStyle&&r.to==y&&(e||(e=[])).push(o.endStyle,r.to),o.title&&((d||(d={})).title=o.title),o.attributes)for(let e in o.attributes)(d||(d={}))[e]=o.attributes[e];o.collapsed&&(!h||Th(h.marker,o)<0)&&(h=r)}else r.from>f&&y>r.from&&(y=r.from)}if(e)for(let t=0;t<e.length;t+=2)e[t+1]==y&&(c+=" "+e[t]);if(!h||h.from==f)for(let e=0;e<i.length;++e)Wh(t,0,i[e]);if(h&&(h.from||0)==f){if(Wh(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=p)break;let e=Math.min(p,y);for(;;){if(g){let i=f+g.length;if(!h){let n=i>e?g.slice(0,e-f):g;t.addToken(t,n,s?s+l:l,u,f+n.length==y?c:"",a,d)}if(i>=e){g=g.slice(e-f),f=e;break}f=i,u=""}g=r.slice(o,o=i[m++]),s=Nh(i[m++],t.cm.options)}}}function Zh(e,t,i){this.line=t,this.rest=function(e){let t,i;for(;t=Ch(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}(t),this.size=this.rest?Nu(jc(this.rest))-i+1:1,this.node=this.text=null,this.hidden=Lh(e,t)}function Xh(e,t,i){let n,r=[];for(let o=t;o<i;o=n){let t=new Zh(e.doc,Bu(e.doc,o),o);n=o+t.size,r.push(t)}return r}let Kh=null;let Yh=null;function Jh(e,t){let i=ru(e,t);if(!i.length)return;let n,r=Array.prototype.slice.call(arguments,2);Kh?n=Kh.delayedCallbacks:Yh?n=Yh:(n=Yh=[],setTimeout(Qh,0));for(let e=0;e<i.length;++e)n.push((()=>i[e].apply(null,r)))}function Qh(){let e=Yh;Yh=null;for(let t=0;t<e.length;++t)e[t]()}function ed(e,t,i,n){for(let r=0;r<t.changes.length;r++){let o=t.changes[r];"text"==o?nd(e,t):"gutter"==o?od(e,t,i,n):"class"==o?rd(e,t):"widget"==o&&sd(e,t,n)}t.changes=null}function td(e){return e.node==e.text&&(e.node=bc("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),Yl&&Jl<8&&(e.node.style.zIndex=2)),e.node}function id(e,t){let i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):Uh(e,t)}function nd(e,t){let i=t.text.className,n=id(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,rd(e,t)):i&&(t.text.className=i)}function rd(e,t){!function(e,t){let i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){let n=td(t);t.background=n.insertBefore(bc("div",null,i),n.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?td(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");let i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function od(e,t,i,n){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){let i=td(t);t.gutterBackground=bc("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,`left: ${e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth}px; width: ${n.gutterTotalWidth}px`),e.display.input.setUneditable(t.gutterBackground),i.insertBefore(t.gutterBackground,t.text)}let r=t.line.gutterMarkers;if(e.options.lineNumbers||r){let o=td(t),s=t.gutter=bc("div",null,"CodeMirror-gutter-wrapper",`left: ${e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth}px`);if(s.setAttribute("aria-hidden","true"),e.display.input.setUneditable(s),o.insertBefore(s,t.text),t.line.gutterClass&&(s.className+=" "+t.line.gutterClass),!e.options.lineNumbers||r&&r["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(bc("div",Gu(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt",`left: ${n.gutterLeft["CodeMirror-linenumbers"]}px; width: ${e.display.lineNumInnerWidth}px`))),r)for(let t=0;t<e.display.gutterSpecs.length;++t){let i=e.display.gutterSpecs[t].className,o=r.hasOwnProperty(i)&&r[i];o&&s.appendChild(bc("div",[o],"CodeMirror-gutter-elt",`left: ${n.gutterLeft[i]}px; width: ${n.gutterWidth[i]}px`))}}}function sd(e,t,i){t.alignable&&(t.alignable=null);let n=gc("CodeMirror-linewidget");for(let e,i=t.node.firstChild;i;i=e)e=i.nextSibling,n.test(i.className)&&t.node.removeChild(i);ld(e,t,i)}function ad(e,t,i,n){let r=id(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),rd(e,t),od(e,t,i,n),ld(e,t,n),t.node}function ld(e,t,i){if(cd(e,t.line,t,i,!0),t.rest)for(let n=0;n<t.rest.length;n++)cd(e,t.rest[n],t,i,!1)}function cd(e,t,i,n,r){if(!t.widgets)return;let o=td(i);for(let s=0,a=t.widgets;s<a.length;++s){let t=a[s],l=bc("div",[t.node],"CodeMirror-linewidget"+(t.className?" "+t.className:""));t.handleMouseEvents||l.setAttribute("cm-ignore-events","true"),ud(t,l,i,n),e.display.input.setUneditable(l),r&&t.above?o.insertBefore(l,i.gutter||i.text):o.appendChild(l),Jh(t,"redraw")}}function ud(e,t,i,n){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);let r=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(r-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function hd(e){if(null!=e.height)return e.height;let t=e.doc.cm;if(!t)return 0;if(!Tc(document.body,e.node)){let i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),xc(t.display.measure,bc("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function dd(e,t){for(let i=mu(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function pd(e){return e.lineSpace.offsetTop}function fd(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function md(e){if(e.cachedPaddingH)return e.cachedPaddingH;let t=xc(e.measure,bc("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(e.cachedPaddingH=n),n}function gd(e){return 50-e.display.nativeBarWidth}function yd(e){return e.display.scroller.clientWidth-gd(e)-e.display.barWidth}function _d(e){return e.display.scroller.clientHeight-gd(e)-e.display.barHeight}function vd(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(let i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(let t=0;t<e.rest.length;t++)if(Nu(e.rest[t])>i)return{map:e.measure.maps[t],cache:e.measure.caches[t],before:!0}}}function xd(e,t,i,n){return Td(e,wd(e,t),i,n)}function bd(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[ep(e,t)];let i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function wd(e,t){let i=Nu(t),n=bd(e,i);n&&!n.text?n=null:n&&n.changes&&(ed(e,n,i,Xd(e)),e.curOp.forceUpdate=!0),n||(n=function(e,t){let i=Nu(t=Ah(t)),n=e.display.externalMeasured=new Zh(e.doc,t,i);n.lineN=i;let r=n.built=Uh(e,n);return n.text=r.pre,xc(e.display.lineMeasure,r.pre),n}(e,t));let r=vd(n,t,i);return{line:t,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Td(e,t,i,n,r){t.before&&(i=-1);let o,s=i+(n||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(!function(e,t,i){let n=e.options.lineWrapping,r=n&&yd(e);if(!t.measure.heights||n&&t.measure.width!=r){let e=t.measure.heights=[];if(n){t.measure.width=r;let n=t.text.firstChild.getClientRects();for(let t=0;t<n.length-1;t++){let r=n[t],o=n[t+1];Math.abs(r.bottom-o.bottom)>2&&e.push((r.bottom+o.top)/2-i.top)}}e.push(i.bottom-i.top)}}(e,t.view,t.rect),t.hasHeights=!0),o=function(e,t,i,n){let r,o=Cd(t.map,i,n),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(let e=0;e<4;e++){for(;a&&Xc(t.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&Xc(t.line.text.charAt(o.coverStart+l));)++l;if(r=Yl&&Jl<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():Ed(yc(s,a,l).getClientRects(),n),r.left||r.right||0==a)break;l=a,a-=1,c="right"}Yl&&Jl<11&&(r=function(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(e){if(null!=Su)return Su;let t=xc(e,bc("span","x")),i=t.getBoundingClientRect(),n=yc(t,0,1).getBoundingClientRect();return Su=Math.abs(i.left-n.left)>1}(e))return t;let i=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*n,bottom:t.bottom*n}}(e.display.measure,r))}else{let t;a>0&&(c=n="right"),r=e.options.lineWrapping&&(t=s.getClientRects()).length>1?t["right"==n?t.length-1:0]:s.getBoundingClientRect()}if(Yl&&Jl<9&&!a&&(!r||!r.left&&!r.right)){let t=s.parentNode.getClientRects()[0];r=t?{left:t.left,right:t.left+Zd(e.display),top:t.top,bottom:t.bottom}:Sd}let u=r.top-t.rect.top,h=r.bottom-t.rect.top,d=(u+h)/2,p=t.view.measure.heights,f=0;for(;f<p.length-1&&!(d<p[f]);f++);let m=f?p[f-1]:0,g=p[f],y={left:("right"==c?r.right:r.left)-t.rect.left,right:("left"==c?r.left:r.right)-t.rect.left,top:m,bottom:g};r.left||r.right||(y.bogus=!0);e.options.singleCursorHeightPerLine||(y.rtop=u,y.rbottom=h);return y}(e,t,i,n),o.bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}let kd,Sd={left:0,right:0,top:0,bottom:0};function Cd(e,t,i){let n,r,o,s,a,l;for(let c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,o=1,s="left"):t<l?(r=t-a,o=r+1):(c==e.length-3||t==l&&e[c+3]>t)&&(o=l-a,r=o-1,t>=l&&(s="right")),null!=r){if(n=e[c+2],a==l&&i==(n.insertLeft?"left":"right")&&(s=i),"left"==i&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)n=e[2+(c-=3)],s="left";if("right"==i&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)n=e[(c+=3)+2],s="right";break}return{node:n,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function Ed(e,t){let i=Sd;if("left"==t)for(let t=0;t<e.length&&(i=e[t]).left==i.right;t++);else for(let t=e.length-1;t>=0&&(i=e[t]).left==i.right;t--);return i}function Md(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(let t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Ad(e){e.display.externalMeasure=null,vc(e.display.lineMeasure);for(let t=0;t<e.display.view.length;t++)Md(e.display.view[t])}function zd(e){Ad(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Id(){return tc&&lc?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ld(){return tc&&lc?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Dd(e){let{widgets:t}=Ah(e),i=0;if(t)for(let e=0;e<t.length;++e)t[e].above&&(i+=hd(t[e]));return i}function Pd(e,t,i,n,r){if(!r){let e=Dd(t);i.top+=e,i.bottom+=e}if("line"==n)return i;n||(n="local");let o=Ph(t);if("local"==n?o+=pd(e.display):o-=e.display.viewOffset,"page"==n||"window"==n){let t=e.display.lineSpace.getBoundingClientRect();o+=t.top+("window"==n?0:Ld());let r=t.left+("window"==n?0:Id());i.left+=r,i.right+=r}return i.top+=o,i.bottom+=o,i}function Od(e,t,i){if("div"==i)return t;let n=t.left,r=t.top;if("page"==i)n-=Id(),r-=Ld();else if("local"==i||!i){let t=e.display.sizer.getBoundingClientRect();n+=t.left,r+=t.top}let o=e.display.lineSpace.getBoundingClientRect();return{left:n-o.left,top:r-o.top}}function Rd(e,t,i,n,r){return n||(n=Bu(e.doc,t.line)),Pd(e,n,xd(e,n,t.ch,r),i)}function Bd(e,t,i,n,r,o){function s(t,s){let a=Td(e,r,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,Pd(e,n,a,i)}n=n||Bu(e.doc,t.line),r||(r=wd(e,n));let a=tu(n,e.doc.direction),l=t.ch,c=t.sticky;if(l>=n.text.length?(l=n.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(e,t,i){return s(i?e-1:e,1==a[t].level!=i)}let h=Qc(a,l,c),d=Jc,p=u(l,h,"before"==c);return null!=d&&(p.other=u(l,d,"before"!=c)),p}function Fd(e,t){let i=0;t=Ju(e.doc,t),e.options.lineWrapping||(i=Zd(e.display)*t.ch);let n=Bu(e.doc,t.line),r=Ph(n)+pd(e.display);return{left:i,right:i,top:r,bottom:r+n.height}}function $d(e,t,i,n,r){let o=qu(e,t,i);return o.xRel=r,n&&(o.outside=n),o}function jd(e,t,i){let n=e.doc;if((i+=e.display.viewOffset)<0)return $d(n.first,0,null,-1,-1);let r=Uu(n,i),o=n.first+n.size-1;if(r>o)return $d(n.first+n.size-1,Bu(n,o).text.length,null,1,1);t<0&&(t=0);let s=Bu(n,r);for(;;){let o=Gd(e,s,r,t,i),a=Eh(s,o.ch+(o.xRel>0||o.outside>0?1:0));if(!a)return o;let l=a.find(1);if(l.line==r)return l;s=Bu(n,r=l.line)}}function Nd(e,t,i,n){n-=Dd(t);let r=t.text.length,o=Yc((t=>Td(e,i,t-1).bottom<=n),r,0);return r=Yc((t=>Td(e,i,t).top>n),o,r),{begin:o,end:r}}function Ud(e,t,i,n){return i||(i=wd(e,t)),Nd(e,t,i,Pd(e,t,Td(e,i,n),"line").top)}function Vd(e,t,i,n){return!(e.bottom<=i)&&(e.top>i||(n?e.left:e.right)>t)}function Gd(e,t,i,n,r){r-=Ph(t);let o=wd(e,t),s=Dd(t),a=0,l=t.text.length,c=!0,u=tu(t,e.doc.direction);if(u){let s=(e.options.lineWrapping?Wd:qd)(e,t,i,o,u,n,r);c=1!=s.level,a=c?s.from:s.to-1,l=c?s.to:s.from-1}let h,d,p=null,f=null,m=Yc((t=>{let i=Td(e,o,t);return i.top+=s,i.bottom+=s,!!Vd(i,n,r,!1)&&(i.top<=r&&i.left<=n&&(p=t,f=i),!0)}),a,l),g=!1;if(f){let e=n-f.left<f.right-n,t=e==c;m=p+(t?0:1),d=t?"after":"before",h=e?f.left:f.right}else{c||m!=l&&m!=a||m++,d=0==m?"after":m==t.text.length?"before":Td(e,o,m-(c?1:0)).bottom+s<=r==c?"after":"before";let n=Bd(e,qu(i,m,d),"line",t,o);h=n.left,g=r<n.top?-1:r>=n.bottom?1:0}return m=Kc(t.text,m,1),$d(i,m,d,g,n-h)}function qd(e,t,i,n,r,o,s){let a=Yc((a=>{let l=r[a],c=1!=l.level;return Vd(Bd(e,qu(i,c?l.to:l.from,c?"before":"after"),"line",t,n),o,s,!0)}),0,r.length-1),l=r[a];if(a>0){let c=1!=l.level,u=Bd(e,qu(i,c?l.from:l.to,c?"after":"before"),"line",t,n);Vd(u,o,s,!0)&&u.top>s&&(l=r[a-1])}return l}function Wd(e,t,i,n,r,o,s){let{begin:a,end:l}=Nd(e,t,n,s);/\s/.test(t.text.charAt(l-1))&&l--;let c=null,u=null;for(let t=0;t<r.length;t++){let i=r[t];if(i.from>=l||i.to<=a)continue;let s=Td(e,n,1!=i.level?Math.min(l,i.to)-1:Math.max(a,i.from)).right,h=s<o?o-s+1e9:s-o;(!c||u>h)&&(c=i,u=h)}return c||(c=r[r.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>l&&(c={from:c.from,to:l,level:c.level}),c}function Hd(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==kd){kd=bc("pre",null,"CodeMirror-line-like");for(let e=0;e<49;++e)kd.appendChild(document.createTextNode("x")),kd.appendChild(bc("br"));kd.appendChild(document.createTextNode("x"))}xc(e.measure,kd);let t=kd.offsetHeight/50;return t>3&&(e.cachedTextHeight=t),vc(e.measure),t||1}function Zd(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;let t=bc("span","xxxxxxxxxx"),i=bc("pre",[t],"CodeMirror-line-like");xc(e.measure,i);let n=t.getBoundingClientRect(),r=(n.right-n.left)/10;return r>2&&(e.cachedCharWidth=r),r||10}function Xd(e){let t=e.display,i={},n={},r=t.gutters.clientLeft;for(let o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){let t=e.display.gutterSpecs[s].className;i[t]=o.offsetLeft+o.clientLeft+r,n[t]=o.clientWidth}return{fixedPos:Kd(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function Kd(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Yd(e){let t=Hd(e.display),i=e.options.lineWrapping,n=i&&Math.max(5,e.display.scroller.clientWidth/Zd(e.display)-3);return r=>{if(Lh(e.doc,r))return 0;let o=0;if(r.widgets)for(let e=0;e<r.widgets.length;e++)r.widgets[e].height&&(o+=r.widgets[e].height);return i?o+(Math.ceil(r.text.length/n)||1)*t:o+t}}function Jd(e){let t=e.doc,i=Yd(e);t.iter((e=>{let t=i(e);t!=e.height&&ju(e,t)}))}function Qd(e,t,i,n){let r=e.display;if(!i&&"true"==mu(t).getAttribute("cm-not-content"))return null;let o,s,a=r.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(t){return null}let l,c=jd(e,o,s);if(n&&c.xRel>0&&(l=Bu(e.doc,c.line).text).length==c.ch){let t=zc(l,l.length,e.options.tabSize)-l.length;c=qu(c.line,Math.max(0,Math.round((o-md(e.display).left)/Zd(e.display))-t))}return c}function ep(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;let i=e.display.view;for(let e=0;e<i.length;e++)if((t-=i[e].size)<0)return e}function tp(e,t,i,n){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),n||(n=0);let r=e.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)ph&&zh(e.doc,t)<r.viewTo&&np(e);else if(i<=r.viewFrom)ph&&Ih(e.doc,i+n)>r.viewFrom?np(e):(r.viewFrom+=n,r.viewTo+=n);else if(t<=r.viewFrom&&i>=r.viewTo)np(e);else if(t<=r.viewFrom){let t=rp(e,i,i+n,1);t?(r.view=r.view.slice(t.index),r.viewFrom=t.lineN,r.viewTo+=n):np(e)}else if(i>=r.viewTo){let i=rp(e,t,t,-1);i?(r.view=r.view.slice(0,i.index),r.viewTo=i.lineN):np(e)}else{let o=rp(e,t,t,-1),s=rp(e,i,i+n,1);o&&s?(r.view=r.view.slice(0,o.index).concat(Xh(e,o.lineN,s.lineN)).concat(r.view.slice(s.index)),r.viewTo+=n):np(e)}let o=r.externalMeasured;o&&(i<o.lineN?o.lineN+=n:t<o.lineN+o.size&&(r.externalMeasured=null))}function ip(e,t,i){e.curOp.viewChanged=!0;let n=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(n.externalMeasured=null),t<n.viewFrom||t>=n.viewTo)return;let o=n.view[ep(e,t)];if(null==o.node)return;let s=o.changes||(o.changes=[]);-1==Lc(s,i)&&s.push(i)}function np(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function rp(e,t,i,n){let r,o=ep(e,t),s=e.display.view;if(!ph||i==e.doc.first+e.doc.size)return{index:o,lineN:i};let a=e.display.viewFrom;for(let e=0;e<o;e++)a+=s[e].size;if(a!=t){if(n>0){if(o==s.length-1)return null;r=a+s[o].size-t,o++}else r=a-t;t+=r,i+=r}for(;zh(e.doc,i)!=i;){if(o==(n<0?0:s.length-1))return null;i+=n*s[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:i}}function op(e){let t=e.display.view,i=0;for(let e=0;e<t.length;e++){let n=t[e];n.hidden||n.node&&!n.changes||++i}return i}function sp(e){e.display.input.showSelection(e.display.input.prepareSelection())}function ap(e,t=!0){let i=e.doc,n={},r=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(let n=0;n<i.sel.ranges.length;n++){if(!t&&n==i.sel.primIndex)continue;let a=i.sel.ranges[n];if(a.from().line>=e.display.viewTo||a.to().line<e.display.viewFrom)continue;let l=a.empty();if(s){let t=s(e,a);t&&lp(e,t,r)}else(l||e.options.showCursorWhenSelecting)&&lp(e,a.head,r);l||up(e,a,o)}return n}function lp(e,t,i){let n=Bd(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),r=i.appendChild(bc("div"," ","CodeMirror-cursor"));if(r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){let i=Rd(e,t,"div",null,null),n=i.right-i.left;r.style.width=(n>0?n:e.defaultCharWidth())+"px"}if(n.other){let e=i.appendChild(bc("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));e.style.display="",e.style.left=n.other.left+"px",e.style.top=n.other.top+"px",e.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function cp(e,t){return e.top-t.top||e.left-t.left}function up(e,t,i){let n=e.display,r=e.doc,o=document.createDocumentFragment(),s=md(e.display),a=s.left,l=Math.max(n.sizerWidth,yd(e)-n.sizer.offsetLeft)-s.right,c="ltr"==r.direction;function u(e,t,i,n){t<0&&(t=0),t=Math.round(t),n=Math.round(n),o.appendChild(bc("div",null,"CodeMirror-selected",`position: absolute; left: ${e}px;\n                             top: ${t}px; width: ${null==i?l-e:i}px;\n                             height: ${n-t}px`))}function h(t,i,n){let o,s,h=Bu(r,t),d=h.text.length;function p(i,n){return Rd(e,qu(t,i),"div",h,n)}function f(t,i,n){let r=Ud(e,h,null,t),o="ltr"==i==("after"==n)?"left":"right";return p("after"==n?r.begin:r.end-(/\s/.test(h.text.charAt(r.end-1))?2:1),o)[o]}let m=tu(h,r.direction);return function(e,t,i,n){if(!e)return n(t,i,"ltr",0);let r=!1;for(let o=0;o<e.length;++o){let s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),r=!0)}r||n(t,i,"ltr")}(m,i||0,null==n?d:n,((e,t,r,h)=>{let g="ltr"==r,y=p(e,g?"left":"right"),_=p(t-1,g?"right":"left"),v=null==i&&0==e,x=null==n&&t==d,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){let e=(c?x:v)&&w,t=(c?v:x)&&b?a:(g?y:_).left,i=e?l:(g?_:y).right;u(t,y.top,i-t,y.bottom)}else{let i,n,o,s;g?(i=c&&v&&b?a:y.left,n=c?l:f(e,r,"before"),o=c?a:f(t,r,"after"),s=c&&x&&w?l:_.right):(i=c?f(e,r,"before"):a,n=!c&&v&&b?l:y.right,o=!c&&x&&w?a:_.left,s=c?f(t,r,"after"):l),u(i,y.top,n-i,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(o,_.top,s-o,_.bottom)}(!o||cp(y,o)<0)&&(o=y),cp(_,o)<0&&(o=_),(!s||cp(y,s)<0)&&(s=y),cp(_,s)<0&&(s=_)})),{start:o,end:s}}let d=t.from(),p=t.to();if(d.line==p.line)h(d.line,d.ch,p.ch);else{let e=Bu(r,d.line),t=Bu(r,p.line),i=Ah(e)==Ah(t),n=h(d.line,d.ch,i?e.text.length+1:null).end,o=h(p.line,i?0:null,p.ch).start;i&&(n.top<o.top-2?(u(n.right,n.top,null,n.bottom),u(a,o.top,o.left,o.bottom)):u(n.right,n.top,o.left-n.right,n.bottom)),n.bottom<o.top&&u(a,n.bottom,null,o.top)}i.appendChild(o)}function hp(e){if(!e.state.focused)return;let t=e.display;clearInterval(t.blinker);let i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((()=>{e.hasFocus()||mp(e),t.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}function dp(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||fp(e))}function pp(e){e.state.delayingBlurEvent=!0,setTimeout((()=>{e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&mp(e))}),100)}function fp(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(su(e,"focus",e,t),e.state.focused=!0,Sc(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),Ql&&setTimeout((()=>e.display.input.reset(!0)),20)),e.display.input.receivedFocus()),hp(e))}function mp(e,t){e.state.delayingBlurEvent||(e.state.focused&&(su(e,"blur",e,t),e.state.focused=!1,_c(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((()=>{e.state.focused||(e.display.shift=!1)}),150))}function gp(e){let t=e.display,i=t.lineDiv.offsetTop,n=Math.max(0,t.scroller.getBoundingClientRect().top),r=t.lineDiv.getBoundingClientRect().top,o=0;for(let s=0;s<t.view.length;s++){let a,l=t.view[s],c=e.options.lineWrapping,u=0;if(l.hidden)continue;if(r+=l.line.height,Yl&&Jl<8){let e=l.node.offsetTop+l.node.offsetHeight;a=e-i,i=e}else{let e=l.node.getBoundingClientRect();a=e.bottom-e.top,!c&&l.text.firstChild&&(u=l.text.firstChild.getBoundingClientRect().right-e.left-1)}let h=l.line.height-a;if((h>.005||h<-.005)&&(r<n&&(o-=h),ju(l.line,a),yp(l.line),l.rest))for(let e=0;e<l.rest.length;e++)yp(l.rest[e]);if(u>e.display.sizerWidth){let t=Math.ceil(u/Zd(e.display));t>e.display.maxLineLength&&(e.display.maxLineLength=t,e.display.maxLine=l.line,e.display.maxLineChanged=!0)}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function yp(e){if(e.widgets)for(let t=0;t<e.widgets.length;++t){let i=e.widgets[t],n=i.node.parentNode;n&&(i.height=n.offsetHeight)}}function _p(e,t,i){let n=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;n=Math.floor(n-pd(e));let r=i&&null!=i.bottom?i.bottom:n+e.wrapper.clientHeight,o=Uu(t,n),s=Uu(t,r);if(i&&i.ensure){let n=i.ensure.from.line,r=i.ensure.to.line;n<o?(o=n,s=Uu(t,Ph(Bu(t,n))+e.wrapper.clientHeight)):Math.min(r,t.lastLine())>=s&&(o=Uu(t,Ph(Bu(t,r))-e.wrapper.clientHeight),s=r)}return{from:o,to:Math.max(s,o+1)}}function vp(e,t){let i=e.display,n=Hd(e.display);t.top<0&&(t.top=0);let r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=_d(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);let a=e.doc.height+fd(i),l=t.top<n,c=t.bottom>a-n;if(t.top<r)s.scrollTop=l?0:t.top;else if(t.bottom>r+o){let e=Math.min(t.top,(c?a:t.bottom)-o);e!=r&&(s.scrollTop=e)}let u=e.options.fixedGutter?0:i.gutters.offsetWidth,h=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft-u,d=yd(e)-i.gutters.offsetWidth,p=t.right-t.left>d;return p&&(t.right=t.left+d),t.left<10?s.scrollLeft=0:t.left<h?s.scrollLeft=Math.max(0,t.left+u-(p?0:10)):t.right>d+h-3&&(s.scrollLeft=t.right+(p?0:10)-d),s}function xp(e,t){null!=t&&(Tp(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function bp(e){Tp(e);let t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function wp(e,t,i){null==t&&null==i||Tp(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function Tp(e){let t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null,kp(e,Fd(e,t.from),Fd(e,t.to),t.margin)}}function kp(e,t,i,n){let r=vp(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-n,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+n});wp(e,r.scrollLeft,r.scrollTop)}function Sp(e,t){Math.abs(e.doc.scrollTop-t)<2||(Hl||Kp(e,{top:t}),Cp(e,t,!0),Hl&&Kp(e),qp(e,100))}function Cp(e,t,i){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Ep(e,t,i,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,Qp(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Mp(e){let t=e.display,i=t.gutters.offsetWidth,n=Math.round(e.doc.height+fd(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:n,scrollHeight:n+gd(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}function Ap(e,t){t||(t=Mp(e));let i=e.display.barWidth,n=e.display.barHeight;zp(e,t);for(let t=0;t<4&&i!=e.display.barWidth||n!=e.display.barHeight;t++)i!=e.display.barWidth&&e.options.lineWrapping&&gp(e),zp(e,Mp(e)),i=e.display.barWidth,n=e.display.barHeight}function zp(e,t){let i=e.display,n=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=n.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=n.bottom)+"px",i.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=n.bottom+"px",i.scrollbarFiller.style.width=n.right+"px"):i.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=n.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}let Ip={native:class{constructor(e,t,i){this.cm=i;let n=this.vert=bc("div",[bc("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),r=this.horiz=bc("div",[bc("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=r.tabIndex=-1,e(n),e(r),nu(n,"scroll",(()=>{n.clientHeight&&t(n.scrollTop,"vertical")})),nu(r,"scroll",(()=>{r.clientWidth&&t(r.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,Yl&&Jl<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}update(e){let t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";let i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?n+"px":"0",this.horiz.style.left=e.barLeft+"px";let t=e.viewWidth-e.barLeft-(i?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+t)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?n:0,bottom:t?n:0}}setScrollLeft(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}setScrollTop(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}zeroWidthHack(){let e=uc&&!oc?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Ic,this.disableVert=new Ic}enableZeroWidthBar(e,t,i){e.style.pointerEvents="auto",t.set(1e3,(function n(){let r=e.getBoundingClientRect();("vert"==i?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}))}clear(){let e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)}},null:class{update(){return{bottom:0,right:0}}setScrollLeft(){}setScrollTop(){}clear(){}}};function Lp(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&_c(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Ip[e.options.scrollbarStyle]((t=>{e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),nu(t,"mousedown",(()=>{e.state.focused&&setTimeout((()=>e.display.input.focus()),0)})),t.setAttribute("cm-not-content","true")}),((t,i)=>{"horizontal"==i?Ep(e,t):Sp(e,t)}),e),e.display.scrollbars.addClass&&Sc(e.display.wrapper,e.display.scrollbars.addClass)}let Dp=0;function Pp(e){var t;e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Dp,markArrays:null},t=e.curOp,Kh?Kh.ops.push(t):t.ownsGroup=Kh={ops:[t],delayedCallbacks:[]}}function Op(e){let t=e.curOp;t&&function(e,t){let i=e.ownsGroup;if(i)try{!function(e){let t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(let t=0;t<e.ops.length;t++){let i=e.ops[t];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(i<t.length)}(i)}finally{Kh=null,t(i)}}(t,(e=>{for(let t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;!function(e){let t=e.ops;for(let e=0;e<t.length;e++)Rp(t[e]);for(let e=0;e<t.length;e++)Bp(t[e]);for(let e=0;e<t.length;e++)Fp(t[e]);for(let e=0;e<t.length;e++)$p(t[e]);for(let e=0;e<t.length;e++)jp(t[e])}(e)}))}function Rp(e){let t=e.cm,i=t.display;!function(e){let t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=gd(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=gd(e)+"px",t.scrollbarsClipped=!0)}(t),e.updateMaxLine&&Rh(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Hp(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Bp(e){e.updatedDisplay=e.mustUpdate&&Zp(e.cm,e.update)}function Fp(e){let t=e.cm,i=t.display;e.updatedDisplay&&gp(t),e.barMeasure=Mp(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=xd(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+gd(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-yd(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection())}function $p(e){let t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Ep(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);let i=e.focus&&e.focus==kc();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&Ap(t,e.barMeasure),e.updatedDisplay&&Jp(t,e.barMeasure),e.selectionChanged&&hp(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&dp(e.cm)}function jp(e){let t=e.cm,i=t.display,n=t.doc;if(e.updatedDisplay&&Xp(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&Cp(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Ep(t,e.scrollLeft,!0,!0),e.scrollToPos){let i=function(e,t,i,n){let r;null==n&&(n=0),e.options.lineWrapping||t!=i||(i="before"==t.sticky?qu(t.line,t.ch+1,"before"):t,t=t.ch?qu(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t);for(let o=0;o<5;o++){let o=!1,s=Bd(e,t),a=i&&i!=t?Bd(e,i):s;r={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n};let l=vp(e,r),c=e.doc.scrollTop,u=e.doc.scrollLeft;if(null!=l.scrollTop&&(Sp(e,l.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(o=!0)),null!=l.scrollLeft&&(Ep(e,l.scrollLeft),Math.abs(e.doc.scrollLeft-u)>1&&(o=!0)),!o)break}return r}(t,Ju(n,e.scrollToPos.from),Ju(n,e.scrollToPos.to),e.scrollToPos.margin);!function(e,t){if(au(e,"scrollCursorIntoView"))return;let i=e.display,n=i.sizer.getBoundingClientRect(),r=null;if(t.top+n.top<0?r=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!sc){let n=bc("div","​",null,`position: absolute;\n                         top: ${t.top-i.viewOffset-pd(e.display)}px;\n                         height: ${t.bottom-t.top+gd(e)+i.barHeight}px;\n                         left: ${t.left}px; width: ${Math.max(2,t.right-t.left)}px;`);e.display.lineSpace.appendChild(n),n.scrollIntoView(r),e.display.lineSpace.removeChild(n)}}(t,i)}let r=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(r)for(let e=0;e<r.length;++e)r[e].lines.length||su(r[e],"hide");if(o)for(let e=0;e<o.length;++e)o[e].lines.length&&su(o[e],"unhide");i.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&su(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Np(e,t){if(e.curOp)return t();Pp(e);try{return t()}finally{Op(e)}}function Up(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Pp(e);try{return t.apply(e,arguments)}finally{Op(e)}}}function Vp(e){return function(){if(this.curOp)return e.apply(this,arguments);Pp(this);try{return e.apply(this,arguments)}finally{Op(this)}}}function Gp(e){return function(){let t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Pp(t);try{return e.apply(this,arguments)}finally{Op(t)}}}function qp(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,Mc(Wp,e))}function Wp(e){let t=e.doc;if(t.highlightFrontier>=e.display.viewTo)return;let i=+new Date+e.options.workTime,n=rh(e,t.highlightFrontier),r=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),(o=>{if(n.line>=e.display.viewFrom){let i=o.styles,s=o.text.length>e.options.maxHighlightLength?Du(t.mode,n.state):null,a=ih(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;let l=o.styleClasses,c=a.classes;c?o.styleClasses=c:l&&(o.styleClasses=null);let u=!i||i.length!=o.styles.length||l!=c&&(!l||!c||l.bgClass!=c.bgClass||l.textClass!=c.textClass);for(let e=0;!u&&e<i.length;++e)u=i[e]!=o.styles[e];u&&r.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&oh(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>i)return qp(e,e.options.workDelay),!0})),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),r.length&&Np(e,(()=>{for(let t=0;t<r.length;t++)ip(e,r[t],"text")}))}class Hp{constructor(e,t,i){let n=e.display;this.viewport=t,this.visible=_p(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=yd(e),this.force=i,this.dims=Xd(e),this.events=[]}signal(e,t){cu(e,t)&&this.events.push(arguments)}finish(){for(let e=0;e<this.events.length;e++)su.apply(null,this.events[e])}}function Zp(e,t){let i=e.display,n=e.doc;if(t.editorIsHidden)return np(e),!1;if(!t.force&&t.visible.from>=i.viewFrom&&t.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==op(e))return!1;ef(e)&&(np(e),t.dims=Xd(e));let r=n.first+n.size,o=Math.max(t.visible.from-e.options.viewportMargin,n.first),s=Math.min(r,t.visible.to+e.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(n.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(r,i.viewTo)),ph&&(o=zh(e.doc,o),s=Ih(e.doc,s));let a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=t.wrapperHeight||i.lastWrapWidth!=t.wrapperWidth;!function(e,t,i){let n=e.display;0==n.view.length||t>=n.viewTo||i<=n.viewFrom?(n.view=Xh(e,t,i),n.viewFrom=t):(n.viewFrom>t?n.view=Xh(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(ep(e,t))),n.viewFrom=t,n.viewTo<i?n.view=n.view.concat(Xh(e,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,ep(e,i)))),n.viewTo=i}(e,o,s),i.viewOffset=Ph(Bu(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";let l=op(e);if(!a&&0==l&&!t.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;let c=function(e){if(e.hasFocus())return null;let t=kc();if(!t||!Tc(e.display.lineDiv,t))return null;let i={activeElt:t};if(window.getSelection){let t=window.getSelection();t.anchorNode&&t.extend&&Tc(e.display.lineDiv,t.anchorNode)&&(i.anchorNode=t.anchorNode,i.anchorOffset=t.anchorOffset,i.focusNode=t.focusNode,i.focusOffset=t.focusOffset)}return i}(e);return l>4&&(i.lineDiv.style.display="none"),function(e,t,i){let n=e.display,r=e.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function a(t){let i=t.nextSibling;return Ql&&uc&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}let l=n.view,c=n.viewFrom;for(let n=0;n<l.length;n++){let u=l[n];if(u.hidden);else if(u.node&&u.node.parentNode==o){for(;s!=u.node;)s=a(s);let n=r&&null!=t&&t<=c&&u.lineNumber;u.changes&&(Lc(u.changes,"gutter")>-1&&(n=!1),ed(e,u,c,i)),n&&(vc(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(Gu(e.options,c)))),s=u.node.nextSibling}else{let t=ad(e,u,c,i);o.insertBefore(t,s)}c+=u.size}for(;s;)s=a(s)}(e,i.updateLineNumbers,t.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,function(e){if(e&&e.activeElt&&e.activeElt!=kc()&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&Tc(document.body,e.anchorNode)&&Tc(document.body,e.focusNode))){let t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}(c),vc(i.cursorDiv),vc(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=t.wrapperHeight,i.lastWrapWidth=t.wrapperWidth,qp(e,400)),i.updateLineNumbers=null,!0}function Xp(e,t){let i=t.viewport;for(let n=!0;;n=!1){if(n&&e.options.lineWrapping&&t.oldDisplayWidth!=yd(e))n&&(t.visible=_p(e.display,e.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(e.doc.height+fd(e.display)-_d(e),i.top)}),t.visible=_p(e.display,e.doc,i),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!Zp(e,t))break;gp(e);let r=Mp(e);sp(e),Ap(e,r),Jp(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Kp(e,t){let i=new Hp(e,t);if(Zp(e,i)){gp(e),Xp(e,i);let t=Mp(e);sp(e),Ap(e,t),Jp(e,t),i.finish()}}function Yp(e){let t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",Jh(e,"gutterChanged",e)}function Jp(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+gd(e)+"px"}function Qp(e){let t=e.display,i=t.view;if(!(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter))return;let n=Kd(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=n+"px";for(let t=0;t<i.length;t++)if(!i[t].hidden){e.options.fixedGutter&&(i[t].gutter&&(i[t].gutter.style.left=o),i[t].gutterBackground&&(i[t].gutterBackground.style.left=o));let n=i[t].alignable;if(n)for(let e=0;e<n.length;e++)n[e].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}function ef(e){if(!e.options.lineNumbers)return!1;let t=e.doc,i=Gu(e.options,t.first+t.size-1),n=e.display;if(i.length!=n.lineNumChars){let t=n.measure.appendChild(bc("div",[bc("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),r=t.firstChild.offsetWidth,o=t.offsetWidth-r;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(r,n.lineGutter.offsetWidth-o)+1,n.lineNumWidth=n.lineNumInnerWidth+o,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",Yp(e.display),!0}return!1}function tf(e,t){let i=[],n=!1;for(let r=0;r<e.length;r++){let o=e[r],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;n=!0}i.push({className:o,style:s})}return t&&!n&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function nf(e){let t=e.gutters,i=e.gutterSpecs;vc(t),e.lineGutter=null;for(let n=0;n<i.length;++n){let{className:r,style:o}=i[n],s=t.appendChild(bc("div",null,"CodeMirror-gutter "+r));o&&(s.style.cssText=o),"CodeMirror-linenumbers"==r&&(e.lineGutter=s,s.style.width=(e.lineNumWidth||1)+"px")}t.style.display=i.length?"":"none",Yp(e)}function rf(e){nf(e.display),tp(e),Qp(e)}function of(e,t,i,n){let r=this;this.input=i,r.scrollbarFiller=bc("div",null,"CodeMirror-scrollbar-filler"),r.scrollbarFiller.setAttribute("cm-not-content","true"),r.gutterFiller=bc("div",null,"CodeMirror-gutter-filler"),r.gutterFiller.setAttribute("cm-not-content","true"),r.lineDiv=wc("div",null,"CodeMirror-code"),r.selectionDiv=bc("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=bc("div",null,"CodeMirror-cursors"),r.measure=bc("div",null,"CodeMirror-measure"),r.lineMeasure=bc("div",null,"CodeMirror-measure"),r.lineSpace=wc("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none");let o=wc("div",[r.lineSpace],"CodeMirror-lines");r.mover=bc("div",[o],null,"position: relative"),r.sizer=bc("div",[r.mover],"CodeMirror-sizer"),r.sizerWidth=null,r.heightForcer=bc("div",null,null,"position: absolute; height: 50px; width: 1px;"),r.gutters=bc("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=bc("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=bc("div",[r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),r.wrapper.setAttribute("translate","no"),Yl&&Jl<8&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),Ql||Hl&&cc||(r.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(r.wrapper):e(r.wrapper)),r.viewFrom=r.viewTo=t.first,r.reportedViewFrom=r.reportedViewTo=t.first,r.view=[],r.renderedView=null,r.externalMeasured=null,r.viewOffset=0,r.lastWrapHeight=r.lastWrapWidth=0,r.updateLineNumbers=null,r.nativeBarWidth=r.barHeight=r.barWidth=0,r.scrollbarsClipped=!1,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.alignWidgets=!1,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null,r.activeTouch=null,r.gutterSpecs=tf(n.gutters,n.lineNumbers),nf(r),i.init(r)}let sf=0,af=null;function lf(e){let t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function cf(e){let t=lf(e);return t.x*=af,t.y*=af,t}function uf(e,t){tc&&ic>=102&&(null==e.display.chromeScrollHack?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout((()=>{e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""}),100));let i=lf(t),n=i.x,r=i.y,o=af;0===t.deltaMode&&(n=t.deltaX,r=t.deltaY,o=1);let s=e.display,a=s.scroller,l=a.scrollWidth>a.clientWidth,c=a.scrollHeight>a.clientHeight;if(n&&l||r&&c){if(r&&uc&&Ql)e:for(let i=t.target,n=s.view;i!=a;i=i.parentNode)for(let t=0;t<n.length;t++)if(n[t].node==i){e.display.currentWheelTarget=i;break e}if(n&&!Hl&&!nc&&null!=o)return r&&c&&Sp(e,Math.max(0,a.scrollTop+r*o)),Ep(e,Math.max(0,a.scrollLeft+n*o)),(!r||r&&c)&&hu(t),void(s.wheelStartX=null);if(r&&null!=o){let t=r*o,i=e.doc.scrollTop,n=i+s.wrapper.clientHeight;t<0?i=Math.max(0,i+t-50):n=Math.min(e.doc.height,n+t+50),Kp(e,{top:i,bottom:n})}sf<20&&0!==t.deltaMode&&(null==s.wheelStartX?(s.wheelStartX=a.scrollLeft,s.wheelStartY=a.scrollTop,s.wheelDX=n,s.wheelDY=r,setTimeout((()=>{if(null==s.wheelStartX)return;let e=a.scrollLeft-s.wheelStartX,t=a.scrollTop-s.wheelStartY,i=t&&s.wheelDY&&t/s.wheelDY||e&&s.wheelDX&&e/s.wheelDX;s.wheelStartX=s.wheelStartY=null,i&&(af=(af*sf+i)/(sf+1),++sf)}),200)):(s.wheelDX+=n,s.wheelDY+=r))}}Yl?af=-.53:Hl?af=15:tc?af=-.7:rc&&(af=-1/3);class hf{constructor(e,t){this.ranges=e,this.primIndex=t}primary(){return this.ranges[this.primIndex]}equals(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(let t=0;t<this.ranges.length;t++){let i=this.ranges[t],n=e.ranges[t];if(!Hu(i.anchor,n.anchor)||!Hu(i.head,n.head))return!1}return!0}deepCopy(){let e=[];for(let t=0;t<this.ranges.length;t++)e[t]=new df(Zu(this.ranges[t].anchor),Zu(this.ranges[t].head));return new hf(e,this.primIndex)}somethingSelected(){for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1}contains(e,t){t||(t=e);for(let i=0;i<this.ranges.length;i++){let n=this.ranges[i];if(Wu(t,n.from())>=0&&Wu(e,n.to())<=0)return i}return-1}}class df{constructor(e,t){this.anchor=e,this.head=t}from(){return Ku(this.anchor,this.head)}to(){return Xu(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}}function pf(e,t,i){let n=e&&e.options.selectionsMayTouch,r=t[i];t.sort(((e,t)=>Wu(e.from(),t.from()))),i=Lc(t,r);for(let e=1;e<t.length;e++){let r=t[e],o=t[e-1],s=Wu(o.to(),r.from());if(n&&!r.empty()?s>0:s>=0){let n=Ku(o.from(),r.from()),s=Xu(o.to(),r.to()),a=o.empty()?r.from()==r.head:o.from()==o.head;e<=i&&--i,t.splice(--e,2,new df(a?s:n,a?n:s))}}return new hf(t,i)}function ff(e,t){return new hf([new df(e,t||e)],0)}function mf(e){return e.text?qu(e.from.line+e.text.length-1,jc(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function gf(e,t){if(Wu(e,t.from)<0)return e;if(Wu(e,t.to)<=0)return mf(t);let i=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=mf(t).ch-t.to.ch),qu(i,n)}function yf(e,t){let i=[];for(let n=0;n<e.sel.ranges.length;n++){let r=e.sel.ranges[n];i.push(new df(gf(r.anchor,t),gf(r.head,t)))}return pf(e.cm,i,e.sel.primIndex)}function _f(e,t,i){return e.line==t.line?qu(i.line,e.ch-t.ch+i.ch):qu(i.line+(e.line-t.line),e.ch)}function vf(e){e.doc.mode=zu(e.options,e.doc.modeOption),xf(e)}function xf(e){e.doc.iter((e=>{e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,qp(e,100),e.state.modeGen++,e.curOp&&tp(e)}function bf(e,t){return 0==t.from.ch&&0==t.to.ch&&""==jc(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function wf(e,t,i,n){function r(e){return i?i[e]:null}function o(e,i,r){!function(e,t,i,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),vh(e),xh(e,i);let r=n?n(e):1;r!=e.height&&ju(e,r)}(e,i,r,n),Jh(e,"change",e,t)}function s(e,t){let i=[];for(let o=e;o<t;++o)i.push(new Bh(c[o],r(o),n));return i}let a=t.from,l=t.to,c=t.text,u=Bu(e,a.line),h=Bu(e,l.line),d=jc(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(bf(e,t)){let t=s(0,c.length-1);o(h,h.text,p),f&&e.remove(a.line,f),t.length&&e.insert(a.line,t)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),p);else{let t=s(1,c.length-1);t.push(new Bh(d+u.text.slice(l.ch),p,n)),o(u,u.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,t)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],r(0)),o(h,d+h.text.slice(l.ch),p);let t=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,t)}Jh(e,"change",e,t)}function Tf(e,t,i){!function e(n,r,o){if(n.linked)for(let s=0;s<n.linked.length;++s){let a=n.linked[s];if(a.doc==r)continue;let l=o&&a.sharedHist;i&&!l||(t(a.doc,l),e(a.doc,n,l))}}(e,null,!0)}function kf(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Jd(e),vf(e),Sf(e),e.options.direction=t.direction,e.options.lineWrapping||Rh(e),e.options.mode=t.modeOption,tp(e)}function Sf(e){("rtl"==e.doc.direction?Sc:_c)(e.display.lineDiv,"CodeMirror-rtl")}function Cf(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function Ef(e,t){let i={from:Zu(t.from),to:mf(t),text:Fu(e,t.from,t.to)};return Lf(e,i,t.from.line,t.to.line+1),Tf(e,(e=>Lf(e,i,t.from.line,t.to.line+1)),!0),i}function Mf(e){for(;e.length;){if(!jc(e).ranges)break;e.pop()}}function Af(e,t,i,n){let r=e.history;r.undone.length=0;let o,s,a=+new Date;if((r.lastOp==n||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&r.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=function(e,t){return t?(Mf(e.done),jc(e.done)):e.done.length&&!jc(e.done).ranges?jc(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),jc(e.done)):void 0}(r,r.lastOp==n)))s=jc(o.changes),0==Wu(t.from,t.to)&&0==Wu(t.from,s.to)?s.to=mf(t):o.changes.push(Ef(e,t));else{let i=jc(r.done);for(i&&i.ranges||If(e.sel,r.done),o={changes:[Ef(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=n,r.lastOrigin=r.lastSelOrigin=t.origin,s||su(e,"historyAdded")}function zf(e,t,i,n){let r=e.history,o=n&&n.origin;i==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||function(e,t,i,n){let r=t.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,o,jc(r.done),t))?r.done[r.done.length-1]=t:If(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=i,n&&!1!==n.clearRedo&&Mf(r.undone)}function If(e,t){let i=jc(t);i&&i.ranges&&i.equals(e)||t.push(e)}function Lf(e,t,i,n){let r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,n),(i=>{i.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=i.markedSpans),++o}))}function Df(e){if(!e)return null;let t;for(let i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function Pf(e,t){let i=function(e,t){let i=t["spans_"+e.id];if(!i)return null;let n=[];for(let e=0;e<t.text.length;++e)n.push(Df(i[e]));return n}(e,t),n=yh(e,t);if(!i)return n;if(!n)return i;for(let e=0;e<i.length;++e){let t=i[e],r=n[e];if(t&&r)e:for(let e=0;e<r.length;++e){let i=r[e];for(let e=0;e<t.length;++e)if(t[e].marker==i.marker)continue e;t.push(i)}else r&&(i[e]=r)}return i}function Of(e,t,i){let n=[];for(let o=0;o<e.length;++o){let s=e[o];if(s.ranges){n.push(i?hf.prototype.deepCopy.call(s):s);continue}let a=s.changes,l=[];n.push({changes:l});for(let e=0;e<a.length;++e){let i,n=a[e];if(l.push({from:n.from,to:n.to,text:n.text}),t)for(var r in n)(i=r.match(/^spans_(\d+)$/))&&Lc(t,Number(i[1]))>-1&&(jc(l)[r]=n[r],delete n[r])}}return n}function Rf(e,t,i,n){if(n){let n=e.anchor;if(i){let e=Wu(t,n)<0;e!=Wu(i,n)<0?(n=t,t=i):e!=Wu(t,i)<0&&(t=i)}return new df(n,t)}return new df(i||t,t)}function Bf(e,t,i,n,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),Uf(e,new hf([Rf(e.sel.primary(),t,i,r)],0),n)}function Ff(e,t,i){let n=[],r=e.cm&&(e.cm.display.shift||e.extend);for(let i=0;i<e.sel.ranges.length;i++)n[i]=Rf(e.sel.ranges[i],t[i],null,r);Uf(e,pf(e.cm,n,e.sel.primIndex),i)}function $f(e,t,i,n){let r=e.sel.ranges.slice(0);r[t]=i,Uf(e,pf(e.cm,r,e.sel.primIndex),n)}function jf(e,t,i,n){Uf(e,ff(t,i),n)}function Nf(e,t,i){let n=e.history.done,r=jc(n);r&&r.ranges?(n[n.length-1]=t,Vf(e,t,i)):Uf(e,t,i)}function Uf(e,t,i){Vf(e,t,i),zf(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function Vf(e,t,i){(cu(e,"beforeSelectionChange")||e.cm&&cu(e.cm,"beforeSelectionChange"))&&(t=function(e,t,i){let n={ranges:t.ranges,update:function(t){this.ranges=[];for(let i=0;i<t.length;i++)this.ranges[i]=new df(Ju(e,t[i].anchor),Ju(e,t[i].head))},origin:i&&i.origin};return su(e,"beforeSelectionChange",e,n),e.cm&&su(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?pf(e.cm,n.ranges,n.ranges.length-1):t}(e,t,i));let n=i&&i.bias||(Wu(t.primary().head,e.sel.primary().head)<0?-1:1);Gf(e,Wf(e,t,n,!0)),i&&!1===i.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||bp(e.cm)}function Gf(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,lu(e.cm)),Jh(e,"cursorActivity",e))}function qf(e){Gf(e,Wf(e,e.sel,null,!1))}function Wf(e,t,i,n){let r;for(let o=0;o<t.ranges.length;o++){let s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Zf(e,s.anchor,a&&a.anchor,i,n),c=Zf(e,s.head,a&&a.head,i,n);(r||l!=s.anchor||c!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new df(l,c))}return r?pf(e.cm,r,t.primIndex):t}function Hf(e,t,i,n,r){let o=Bu(e,t.line);if(o.markedSpans)for(let s=0;s<o.markedSpans.length;++s){let a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(u?a.to>=t.ch:a.to>t.ch))){if(r&&(su(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){let s,a=l.find(n<0?1:-1);if((n<0?u:c)&&(a=Xf(e,a,-n,a&&a.line==t.line?o:null)),a&&a.line==t.line&&(s=Wu(a,i))&&(n<0?s<0:s>0))return Hf(e,a,t,n,r)}let a=l.find(n<0?-1:1);return(n<0?c:u)&&(a=Xf(e,a,n,a.line==t.line?o:null)),a?Hf(e,a,t,n,r):null}}return t}function Zf(e,t,i,n,r){let o=n||1,s=Hf(e,t,i,o,r)||!r&&Hf(e,t,i,o,!0)||Hf(e,t,i,-o,r)||!r&&Hf(e,t,i,-o,!0);return s||(e.cantEdit=!0,qu(e.first,0))}function Xf(e,t,i,n){return i<0&&0==t.ch?t.line>e.first?Ju(e,qu(t.line-1)):null:i>0&&t.ch==(n||Bu(e,t.line)).text.length?t.line<e.first+e.size-1?qu(t.line+1,0):null:new qu(t.line,t.ch+i)}function Kf(e){e.setSelection(qu(e.firstLine(),0),qu(e.lastLine()),Pc)}function Yf(e,t,i){let n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:()=>n.canceled=!0};return i&&(n.update=(t,i,r,o)=>{t&&(n.from=Ju(e,t)),i&&(n.to=Ju(e,i)),r&&(n.text=r),void 0!==o&&(n.origin=o)}),su(e,"beforeChange",e,n),e.cm&&su(e.cm,"beforeChange",e.cm,n),n.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Jf(e,t,i){if(e.cm){if(!e.cm.curOp)return Up(e.cm,Jf)(e,t,i);if(e.cm.state.suppressEdits)return}if((cu(e,"beforeChange")||e.cm&&cu(e.cm,"beforeChange"))&&!(t=Yf(e,t,!0)))return;let n=dh&&!i&&function(e,t,i){let n=null;if(e.iter(t.line,i.line+1,(e=>{if(e.markedSpans)for(let t=0;t<e.markedSpans.length;++t){let i=e.markedSpans[t].marker;!i.readOnly||n&&-1!=Lc(n,i)||(n||(n=[])).push(i)}})),!n)return null;let r=[{from:t,to:i}];for(let e=0;e<n.length;++e){let t=n[e],i=t.find(0);for(let e=0;e<r.length;++e){let n=r[e];if(Wu(n.to,i.from)<0||Wu(n.from,i.to)>0)continue;let o=[e,1],s=Wu(n.from,i.from),a=Wu(n.to,i.to);(s<0||!t.inclusiveLeft&&!s)&&o.push({from:n.from,to:i.from}),(a>0||!t.inclusiveRight&&!a)&&o.push({from:i.to,to:n.to}),r.splice.apply(r,o),e+=o.length-3}}return r}(e,t.from,t.to);if(n)for(let i=n.length-1;i>=0;--i)Qf(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Qf(e,t)}function Qf(e,t){if(1==t.text.length&&""==t.text[0]&&0==Wu(t.from,t.to))return;let i=yf(e,t);Af(e,t,i,e.cm?e.cm.curOp.id:NaN),im(e,t,i,yh(e,t));let n=[];Tf(e,((e,i)=>{i||-1!=Lc(n,e.history)||(sm(e.history,t),n.push(e.history)),im(e,t,null,yh(e,t))}))}function em(e,t,i){let n=e.cm&&e.cm.state.suppressEdits;if(n&&!i)return;let r,o=e.history,s=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,c=0;for(;c<a.length&&(r=a[c],i?!r.ranges||r.equals(e.sel):r.ranges);c++);if(c==a.length)return;for(o.lastOrigin=o.lastSelOrigin=null;;){if(r=a.pop(),!r.ranges){if(n)return void a.push(r);break}if(If(r,l),i&&!r.equals(e.sel))return void Uf(e,r,{clearRedo:!1});s=r}let u=[];If(s,l),l.push({changes:u,generation:o.generation}),o.generation=r.generation||++o.maxGeneration;let h=cu(e,"beforeChange")||e.cm&&cu(e.cm,"beforeChange");for(let i=r.changes.length-1;i>=0;--i){let n=r.changes[i];if(n.origin=t,h&&!Yf(e,n,!1))return void(a.length=0);u.push(Ef(e,n));let o=i?yf(e,n):jc(a);im(e,n,o,Pf(e,n)),!i&&e.cm&&e.cm.scrollIntoView({from:n.from,to:mf(n)});let s=[];Tf(e,((e,t)=>{t||-1!=Lc(s,e.history)||(sm(e.history,n),s.push(e.history)),im(e,n,null,Pf(e,n))}))}}function tm(e,t){if(0!=t&&(e.first+=t,e.sel=new hf(Nc(e.sel.ranges,(e=>new df(qu(e.anchor.line+t,e.anchor.ch),qu(e.head.line+t,e.head.ch)))),e.sel.primIndex),e.cm)){tp(e.cm,e.first,e.first-t,t);for(let t=e.cm.display,i=t.viewFrom;i<t.viewTo;i++)ip(e.cm,i,"gutter")}}function im(e,t,i,n){if(e.cm&&!e.cm.curOp)return Up(e.cm,im)(e,t,i,n);if(t.to.line<e.first)return void tm(e,t.text.length-1-(t.to.line-t.from.line));if(t.from.line>e.lastLine())return;if(t.from.line<e.first){let i=t.text.length-1-(e.first-t.from.line);tm(e,i),t={from:qu(e.first,0),to:qu(t.to.line+i,t.to.ch),text:[jc(t.text)],origin:t.origin}}let r=e.lastLine();t.to.line>r&&(t={from:t.from,to:qu(r,Bu(e,r).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Fu(e,t.from,t.to),i||(i=yf(e,t)),e.cm?function(e,t,i){let n=e.doc,r=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=Nu(Ah(Bu(n,o.line))),n.iter(l,s.line+1,(e=>{if(e==r.maxLine)return a=!0,!0})));n.sel.contains(t.from,t.to)>-1&&lu(e);wf(n,t,i,Yd(e)),e.options.lineWrapping||(n.iter(l,o.line+t.text.length,(e=>{let t=Oh(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0));(function(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),e.highlightFrontier<t-10)return;let i=e.first;for(let n=t-1;n>i;n--){let r=Bu(e,n).stateAfter;if(r&&(!(r instanceof eh)||n+r.lookAhead<t)){i=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)})(n,o.line),qp(e,400);let c=t.text.length-(s.line-o.line)-1;t.full?tp(e):o.line!=s.line||1!=t.text.length||bf(e.doc,t)?tp(e,o.line,s.line+1,c):ip(e,o.line,"text");let u=cu(e,"changes"),h=cu(e,"change");if(h||u){let i={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};h&&Jh(e,"change",e,i),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(i)}e.display.selForContextMenu=null}(e.cm,t,n):wf(e,t,n),Vf(e,i,Pc),e.cantEdit&&Zf(e,qu(e.firstLine(),0))&&(e.cantEdit=!1)}function nm(e,t,i,n,r){n||(n=i),Wu(n,i)<0&&([i,n]=[n,i]),"string"==typeof t&&(t=e.splitLines(t)),Jf(e,{from:i,to:n,text:t,origin:r})}function rm(e,t,i,n){i<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function om(e,t,i,n){for(let r=0;r<e.length;++r){let o=e[r],s=!0;if(o.ranges){o.copied||(o=e[r]=o.deepCopy(),o.copied=!0);for(let e=0;e<o.ranges.length;e++)rm(o.ranges[e].anchor,t,i,n),rm(o.ranges[e].head,t,i,n)}else{for(let e=0;e<o.changes.length;++e){let r=o.changes[e];if(i<r.from.line)r.from=qu(r.from.line+n,r.from.ch),r.to=qu(r.to.line+n,r.to.ch);else if(t<=r.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function sm(e,t){let i=t.from.line,n=t.to.line,r=t.text.length-(n-i)-1;om(e.done,i,n,r),om(e.undone,i,n,r)}function am(e,t,i,n){let r=t,o=t;return"number"==typeof t?o=Bu(e,Yu(e,t)):r=Nu(t),null==r?null:(n(o,r)&&e.cm&&ip(e.cm,r,i),o)}function lm(e){this.lines=e,this.parent=null;let t=0;for(let i=0;i<e.length;++i)e[i].parent=this,t+=e[i].height;this.height=t}function cm(e){this.children=e;let t=0,i=0;for(let n=0;n<e.length;++n){let r=e[n];t+=r.chunkSize(),i+=r.height,r.parent=this}this.size=t,this.height=i,this.parent=null}lm.prototype={chunkSize(){return this.lines.length},removeInner(e,t){for(let i=e,n=e+t;i<n;++i){let e=this.lines[i];this.height-=e.height,Fh(e),Jh(e,"delete")}this.lines.splice(e,t)},collapse(e){e.push.apply(e,this.lines)},insertInner(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(let e=0;e<t.length;++e)t[e].parent=this},iterN(e,t,i){for(let n=e+t;e<n;++e)if(i(this.lines[e]))return!0}},cm.prototype={chunkSize(){return this.size},removeInner(e,t){this.size-=t;for(let i=0;i<this.children.length;++i){let n=this.children[i],r=n.chunkSize();if(e<r){let o=Math.min(t,r-e),s=n.height;if(n.removeInner(e,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(t-=o))break;e=0}else e-=r}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof lm))){let e=[];this.collapse(e),this.children=[new lm(e)],this.children[0].parent=this}},collapse(e){for(let t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner(e,t,i){this.size+=t.length,this.height+=i;for(let n=0;n<this.children.length;++n){let r=this.children[n],o=r.chunkSize();if(e<=o){if(r.insertInner(e,t,i),r.lines&&r.lines.length>50){let e=r.lines.length%25+25;for(let t=e;t<r.lines.length;){let e=new lm(r.lines.slice(t,t+=25));r.height-=e.height,this.children.splice(++n,0,e),e.parent=this}r.lines=r.lines.slice(0,e),this.maybeSpill()}break}e-=o}},maybeSpill(){if(this.children.length<=10)return;let e=this;do{let t=new cm(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;let i=Lc(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{let i=new cm(e.children);i.parent=e,e.children=[i,t],e=i}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iterN(e,t,i){for(let n=0;n<this.children.length;++n){let r=this.children[n],o=r.chunkSize();if(e<o){let n=Math.min(t,o-e);if(r.iterN(e,n,i))return!0;if(0==(t-=n))break;e=0}else e-=o}}};class um{constructor(e,t,i){if(i)for(let e in i)i.hasOwnProperty(e)&&(this[e]=i[e]);this.doc=e,this.node=t}clear(){let e=this.doc.cm,t=this.line.widgets,i=this.line,n=Nu(i);if(null==n||!t)return;for(let e=0;e<t.length;++e)t[e]==this&&t.splice(e--,1);t.length||(i.widgets=null);let r=hd(this);ju(i,Math.max(0,i.height-r)),e&&(Np(e,(()=>{hm(e,i,-r),ip(e,n,"widget")})),Jh(e,"lineWidgetCleared",e,this,n))}changed(){let e=this.height,t=this.doc.cm,i=this.line;this.height=null;let n=hd(this)-e;n&&(Lh(this.doc,i)||ju(i,i.height+n),t&&Np(t,(()=>{t.curOp.forceUpdate=!0,hm(t,i,n),Jh(t,"lineWidgetChanged",t,this,Nu(i))})))}}function hm(e,t,i){Ph(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&xp(e,i)}uu(um);let dm=0;class pm{constructor(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++dm}clear(){if(this.explicitlyCleared)return;let e=this.doc.cm,t=e&&!e.curOp;if(t&&Pp(e),cu(this,"clear")){let e=this.find();e&&Jh(this,"clear",e.from,e.to)}let i=null,n=null;for(let t=0;t<this.lines.length;++t){let r=this.lines[t],o=mh(r.markedSpans,this);e&&!this.collapsed?ip(e,Nu(r),"text"):e&&(null!=o.to&&(n=Nu(r)),null!=o.from&&(i=Nu(r))),r.markedSpans=gh(r.markedSpans,o),null==o.from&&this.collapsed&&!Lh(this.doc,r)&&e&&ju(r,Hd(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(let t=0;t<this.lines.length;++t){let i=Ah(this.lines[t]),n=Oh(i);n>e.display.maxLineLength&&(e.display.maxLine=i,e.display.maxLineLength=n,e.display.maxLineChanged=!0)}null!=i&&e&&this.collapsed&&tp(e,i,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&qf(e.doc)),e&&Jh(e,"markerCleared",e,this,i,n),t&&Op(e),this.parent&&this.parent.clear()}find(e,t){let i,n;null==e&&"bookmark"==this.type&&(e=1);for(let r=0;r<this.lines.length;++r){let o=this.lines[r],s=mh(o.markedSpans,this);if(null!=s.from&&(i=qu(t?o:Nu(o),s.from),-1==e))return i;if(null!=s.to&&(n=qu(t?o:Nu(o),s.to),1==e))return n}return i&&{from:i,to:n}}changed(){let e=this.find(-1,!0),t=this,i=this.doc.cm;e&&i&&Np(i,(()=>{let n=e.line,r=Nu(e.line),o=bd(i,r);if(o&&(Md(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!Lh(t.doc,n)&&null!=t.height){let e=t.height;t.height=null;let i=hd(t)-e;i&&ju(n,n.height+i)}Jh(i,"markerChanged",i,this)}))}attachLine(e){if(!this.lines.length&&this.doc.cm){let e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=Lc(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)}detachLine(e){if(this.lines.splice(Lc(this.lines,e),1),!this.lines.length&&this.doc.cm){let e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}}}function fm(e,t,i,n,r){if(n&&n.shared)return function(e,t,i,n,r){(n=Ac(n)).shared=!1;let o=[fm(e,t,i,n,r)],s=o[0],a=n.widgetNode;return Tf(e,(e=>{a&&(n.widgetNode=a.cloneNode(!0)),o.push(fm(e,Ju(e,t),Ju(e,i),n,r));for(let t=0;t<e.linked.length;++t)if(e.linked[t].isParent)return;s=jc(o)})),new mm(o,s)}(e,t,i,n,r);if(e.cm&&!e.cm.curOp)return Up(e.cm,fm)(e,t,i,n,r);let o=new pm(e,r),s=Wu(t,i);if(n&&Ac(n,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=wc("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Mh(e,t.line,t,i,o)||t.line!=i.line&&Mh(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");ph=!0}o.addToHistory&&Af(e,{from:t,to:i,origin:"markText"},e.sel,NaN);let a,l=t.line,c=e.cm;if(e.iter(l,i.line+1,(n=>{c&&o.collapsed&&!c.options.lineWrapping&&Ah(n)==c.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&ju(n,0),function(e,t,i){let n=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));n&&e.markedSpans&&n.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],n&&n.add(e.markedSpans)),t.marker.attachLine(e)}(n,new fh(o,l==t.line?t.ch:null,l==i.line?i.ch:null),e.cm&&e.cm.curOp),++l})),o.collapsed&&e.iter(t.line,i.line+1,(t=>{Lh(e,t)&&ju(t,0)})),o.clearOnEnter&&nu(o,"beforeCursorEnter",(()=>o.clear())),o.readOnly&&(dh=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++dm,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)tp(c,t.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(let e=t.line;e<=i.line;e++)ip(c,e,"text");o.atomic&&qf(c.doc),Jh(c,"markerAdded",c,o)}return o}uu(pm);class mm{constructor(e,t){this.markers=e,this.primary=t;for(let t=0;t<e.length;++t)e[t].parent=this}clear(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(let e=0;e<this.markers.length;++e)this.markers[e].clear();Jh(this,"clear")}}find(e,t){return this.primary.find(e,t)}}function gm(e){return e.findMarks(qu(e.first,0),e.clipPos(qu(e.lastLine())),(e=>e.parent))}function ym(e){for(let t=0;t<e.length;t++){let i=e[t],n=[i.primary.doc];Tf(i.primary.doc,(e=>n.push(e)));for(let e=0;e<i.markers.length;e++){let t=i.markers[e];-1==Lc(n,t.doc)&&(t.parent=null,i.markers.splice(e--,1))}}}uu(mm);let _m=0,vm=function(e,t,i,n,r){if(!(this instanceof vm))return new vm(e,t,i,n,r);null==i&&(i=0),cm.call(this,[new lm([new Bh("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;let o=qu(i,0);this.sel=ff(o),this.history=new Cf(null),this.id=++_m,this.modeOption=t,this.lineSep=n,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),wf(this,{from:o,to:o,text:e}),Uf(this,ff(o),Pc)};vm.prototype=Vc(cm.prototype,{constructor:vm,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){let i=0;for(let e=0;e<t.length;++e)i+=t[e].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){let t=$u(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Gp((function(e){let t=qu(this.first,0),i=this.first+this.size-1;Jf(this,{from:t,to:qu(i,Bu(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&wp(this.cm,0,0),Uf(this,ff(t),Pc)})),replaceRange:function(e,t,i,n){nm(this,e,t=Ju(this,t),i=i?Ju(this,i):t,n)},getRange:function(e,t,i){let n=Fu(this,Ju(this,e),Ju(this,t));return!1===i?n:""===i?n.join(""):n.join(i||this.lineSeparator())},getLine:function(e){let t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(Vu(this,e))return Bu(this,e)},getLineNumber:function(e){return Nu(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Bu(this,e)),Ah(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Ju(this,e)},getCursor:function(e){let t,i=this.sel.primary();return t=null==e||"head"==e?i.head:"anchor"==e?i.anchor:"end"==e||"to"==e||!1===e?i.to():i.from(),t},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Gp((function(e,t,i){jf(this,Ju(this,"number"==typeof e?qu(e,t||0):e),null,i)})),setSelection:Gp((function(e,t,i){jf(this,Ju(this,e),Ju(this,t||e),i)})),extendSelection:Gp((function(e,t,i){Bf(this,Ju(this,e),t&&Ju(this,t),i)})),extendSelections:Gp((function(e,t){Ff(this,Qu(this,e),t)})),extendSelectionsBy:Gp((function(e,t){Ff(this,Qu(this,Nc(this.sel.ranges,e)),t)})),setSelections:Gp((function(e,t,i){if(!e.length)return;let n=[];for(let t=0;t<e.length;t++)n[t]=new df(Ju(this,e[t].anchor),Ju(this,e[t].head||e[t].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Uf(this,pf(this.cm,n,t),i)})),addSelection:Gp((function(e,t,i){let n=this.sel.ranges.slice(0);n.push(new df(Ju(this,e),Ju(this,t||e))),Uf(this,pf(this.cm,n,n.length-1),i)})),getSelection:function(e){let t,i=this.sel.ranges;for(let e=0;e<i.length;e++){let n=Fu(this,i[e].from(),i[e].to());t=t?t.concat(n):n}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){let t=[],i=this.sel.ranges;for(let n=0;n<i.length;n++){let r=Fu(this,i[n].from(),i[n].to());!1!==e&&(r=r.join(e||this.lineSeparator())),t[n]=r}return t},replaceSelection:function(e,t,i){let n=[];for(let t=0;t<this.sel.ranges.length;t++)n[t]=e;this.replaceSelections(n,t,i||"+input")},replaceSelections:Gp((function(e,t,i){let n=[],r=this.sel;for(let t=0;t<r.ranges.length;t++){let o=r.ranges[t];n[t]={from:o.from(),to:o.to(),text:this.splitLines(e[t]),origin:i}}let o=t&&"end"!=t&&function(e,t,i){let n=[],r=qu(e.first,0),o=r;for(let s=0;s<t.length;s++){let a=t[s],l=_f(a.from,r,o),c=_f(mf(a),r,o);if(r=a.to,o=c,"around"==i){let t=e.sel.ranges[s],i=Wu(t.head,t.anchor)<0;n[s]=new df(i?c:l,i?l:c)}else n[s]=new df(l,l)}return new hf(n,e.sel.primIndex)}(this,n,t);for(let e=n.length-1;e>=0;e--)Jf(this,n[e]);o?Nf(this,o):this.cm&&bp(this.cm)})),undo:Gp((function(){em(this,"undo")})),redo:Gp((function(){em(this,"redo")})),undoSelection:Gp((function(){em(this,"undo",!0)})),redoSelection:Gp((function(){em(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){let e=this.history,t=0,i=0;for(let i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(let t=0;t<e.undone.length;t++)e.undone[t].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new Cf(this.history),Tf(this,(e=>e.history=this.history),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Of(this.history.done),undone:Of(this.history.undone)}},setHistory:function(e){let t=this.history=new Cf(this.history);t.done=Of(e.done.slice(0),null,!0),t.undone=Of(e.undone.slice(0),null,!0)},setGutterMarker:Gp((function(e,t,i){return am(this,e,"gutter",(e=>{let n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=i,!i&&Hc(n)&&(e.gutterMarkers=null),!0}))})),clearGutter:Gp((function(e){this.iter((t=>{t.gutterMarkers&&t.gutterMarkers[e]&&am(this,t,"gutter",(()=>(t.gutterMarkers[e]=null,Hc(t.gutterMarkers)&&(t.gutterMarkers=null),!0)))}))})),lineInfo:function(e){let t;if("number"==typeof e){if(!Vu(this,e))return null;if(t=e,!(e=Bu(this,e)))return null}else if(t=Nu(e),null==t)return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Gp((function(e,t,i){return am(this,e,"gutter"==t?"gutter":"class",(e=>{let n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[n]){if(gc(i).test(e[n]))return!1;e[n]+=" "+i}else e[n]=i;return!0}))})),removeLineClass:Gp((function(e,t,i){return am(this,e,"gutter"==t?"gutter":"class",(e=>{let n="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",r=e[n];if(!r)return!1;if(null==i)e[n]=null;else{let t=r.match(gc(i));if(!t)return!1;let o=t.index+t[0].length;e[n]=r.slice(0,t.index)+(t.index&&o!=r.length?" ":"")+r.slice(o)||null}return!0}))})),addLineWidget:Gp((function(e,t,i){return function(e,t,i,n){let r=new um(e,i,n),o=e.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),am(e,t,"widget",(t=>{let i=t.widgets||(t.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length,Math.max(0,r.insertAt)),0,r),r.line=t,o&&!Lh(e,t)){let i=Ph(t)<e.scrollTop;ju(t,t.height+hd(r)),i&&xp(o,r.height),o.curOp.forceUpdate=!0}return!0})),o&&Jh(o,"lineWidgetAdded",o,r,"number"==typeof t?t:Nu(t)),r}(this,e,t,i)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return fm(this,Ju(this,e),Ju(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){let i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return fm(this,e=Ju(this,e),e,i,"bookmark")},findMarksAt:function(e){let t=[],i=Bu(this,(e=Ju(this,e)).line).markedSpans;if(i)for(let n=0;n<i.length;++n){let r=i[n];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,i){e=Ju(this,e),t=Ju(this,t);let n=[],r=e.line;return this.iter(e.line,t.line+1,(o=>{let s=o.markedSpans;if(s)for(let o=0;o<s.length;o++){let a=s[o];null!=a.to&&r==e.line&&e.ch>=a.to||null==a.from&&r!=e.line||null!=a.from&&r==t.line&&a.from>=t.ch||i&&!i(a.marker)||n.push(a.marker.parent||a.marker)}++r})),n},getAllMarks:function(){let e=[];return this.iter((t=>{let i=t.markedSpans;if(i)for(let t=0;t<i.length;++t)null!=i[t].from&&e.push(i[t].marker)})),e},posFromIndex:function(e){let t,i=this.first,n=this.lineSeparator().length;return this.iter((r=>{let o=r.text.length+n;if(o>e)return t=e,!0;e-=o,++i})),Ju(this,qu(i,t))},indexFromPos:function(e){let t=(e=Ju(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;let i=this.lineSeparator().length;return this.iter(this.first,e.line,(e=>{t+=e.text.length+i})),t},copy:function(e){let t=new vm($u(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});let t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);let n=new vm($u(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],function(e,t){for(let i=0;i<t.length;i++){let n=t[i],r=n.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(Wu(o,s)){let t=fm(e,o,s,n.primary,n.primary.type);n.markers.push(t),t.parent=n}}}(n,gm(this)),n},unlinkDoc:function(e){if(e instanceof dg&&(e=e.doc),this.linked)for(let t=0;t<this.linked.length;++t){if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),ym(gm(this));break}}if(e.history==this.history){let t=[e.id];Tf(e,(e=>t.push(e.id)),!0),e.history=new Cf(null),e.history.done=Of(this.history.done,t),e.history.undone=Of(this.history.undone,t)}},iterLinkedDocs:function(e){Tf(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):wu(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Gp((function(e){var t;("rtl"!=e&&(e="ltr"),e!=this.direction)&&(this.direction=e,this.iter((e=>e.order=null)),this.cm&&Np(t=this.cm,(()=>{Sf(t),tp(t)})))}))}),vm.prototype.eachLine=vm.prototype.iter;let xm=0;function bm(e){let t=this;if(wm(t),au(t,e)||dd(t.display,e))return;hu(e),Yl&&(xm=+new Date);let i=Qd(t,e,!0),n=e.dataTransfer.files;if(i&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File){let e=n.length,r=Array(e),o=0;const s=()=>{++o==e&&Up(t,(()=>{i=Ju(t.doc,i);let e={from:i,to:i,text:t.doc.splitLines(r.filter((e=>null!=e)).join(t.doc.lineSeparator())),origin:"paste"};Jf(t.doc,e),Nf(t.doc,ff(Ju(t.doc,i),Ju(t.doc,mf(e))))}))()},a=(e,i)=>{if(t.options.allowDropFileTypes&&-1==Lc(t.options.allowDropFileTypes,e.type))return void s();let n=new FileReader;n.onerror=()=>s(),n.onload=()=>{let e=n.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(r[i]=e),s()},n.readAsText(e)};for(let e=0;e<n.length;e++)a(n[e],e)}else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout((()=>t.display.input.focus()),20);try{let n=e.dataTransfer.getData("Text");if(n){let e;if(t.state.draggingText&&!t.state.draggingText.copy&&(e=t.listSelections()),Vf(t.doc,ff(i,i)),e)for(let i=0;i<e.length;++i)nm(t.doc,"",e[i].anchor,e[i].head,"drag");t.replaceSelection(n,"around","paste"),t.display.input.focus()}}catch(e){}}}function wm(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Tm(e){if(!document.getElementsByClassName)return;let t=document.getElementsByClassName("CodeMirror"),i=[];for(let e=0;e<t.length;e++){let n=t[e].CodeMirror;n&&i.push(n)}i.length&&i[0].operation((()=>{for(let t=0;t<i.length;t++)e(i[t])}))}let km=!1;function Sm(){km||(!function(){let e;nu(window,"resize",(()=>{null==e&&(e=setTimeout((()=>{e=null,Tm(Cm)}),100))})),nu(window,"blur",(()=>Tm(mp)))}(),km=!0)}function Cm(e){let t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}let Em={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(let e=0;e<10;e++)Em[e+48]=Em[e+96]=String(e);for(let e=65;e<=90;e++)Em[e]=String.fromCharCode(e);for(let e=1;e<=12;e++)Em[e+111]=Em[e+63235]="F"+e;let Mm={};function Am(e){let t,i,n,r,o=e.split(/-(?!$)/);e=o[o.length-1];for(let e=0;e<o.length-1;e++){let s=o[e];if(/^(cmd|meta|m)$/i.test(s))r=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))i=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);n=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),r&&(e="Cmd-"+e),n&&(e="Shift-"+e),e}function zm(e){let t={};for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==n){delete e[i];continue}let r=Nc(i.split(" "),Am);for(let e=0;e<r.length;e++){let i,o;e==r.length-1?(o=r.join(" "),i=n):(o=r.slice(0,e+1).join(" "),i="...");let s=t[o];if(s){if(s!=i)throw new Error("Inconsistent bindings for "+o)}else t[o]=i}delete e[i]}for(let i in t)e[i]=t[i];return e}function Im(e,t,i,n){let r=(t=Om(t)).call?t.call(e,n):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&i(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Im(e,t.fallthrough,i,n);for(let r=0;r<t.fallthrough.length;r++){let o=Im(e,t.fallthrough[r],i,n);if(o)return o}}}function Lm(e){let t="string"==typeof e?e:Em[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Dm(e,t,i){let n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(fc?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(fc?t.ctrlKey:t.metaKey)&&"Mod"!=n&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function Pm(e,t){if(nc&&34==e.keyCode&&e.char)return!1;let i=Em[e.keyCode];return null!=i&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(i=e.code),Dm(i,e,t))}function Om(e){return"string"==typeof e?Mm[e]:e}function Rm(e,t){let i=e.doc.sel.ranges,n=[];for(let e=0;e<i.length;e++){let r=t(i[e]);for(;n.length&&Wu(r.from,jc(n).to)<=0;){let e=n.pop();if(Wu(e.from,r.from)<0){r.from=e.from;break}}n.push(r)}Np(e,(()=>{for(let t=n.length-1;t>=0;t--)nm(e.doc,"",n[t].from,n[t].to,"+delete");bp(e)}))}function Bm(e,t,i){let n=Kc(e.text,t+i,i);return n<0||n>e.text.length?null:n}function Fm(e,t,i){let n=Bm(e,t.ch,i);return null==n?null:new qu(t.line,n,i<0?"after":"before")}function $m(e,t,i,n,r){if(e){"rtl"==t.doc.direction&&(r=-r);let e=tu(i,t.doc.direction);if(e){let o,s=r<0?jc(e):e[0],a=r<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==t.doc.direction){let e=wd(t,i);o=r<0?i.text.length-1:0;let n=Td(t,e,o).top;o=Yc((i=>Td(t,e,i).top==n),r<0==(1==s.level)?s.from:s.to-1,o),"before"==a&&(o=Bm(i,o,1))}else o=r<0?s.to:s.from;return new qu(n,o,a)}}return new qu(n,r<0?i.text.length:0,r<0?"before":"after")}Mm.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Mm.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Mm.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Mm.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Mm.default=uc?Mm.macDefault:Mm.pcDefault;let jm={selectAll:Kf,singleSelection:e=>e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Pc),killLine:e=>Rm(e,(t=>{if(t.empty()){let i=Bu(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:qu(t.head.line+1,0)}:{from:t.head,to:qu(t.head.line,i)}}return{from:t.from(),to:t.to()}})),deleteLine:e=>Rm(e,(t=>({from:qu(t.from().line,0),to:Ju(e.doc,qu(t.to().line+1,0))}))),delLineLeft:e=>Rm(e,(e=>({from:qu(e.from().line,0),to:e.from()}))),delWrappedLineLeft:e=>Rm(e,(t=>{let i=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:i},"div"),to:t.from()}})),delWrappedLineRight:e=>Rm(e,(t=>{let i=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:n}})),undo:e=>e.undo(),redo:e=>e.redo(),undoSelection:e=>e.undoSelection(),redoSelection:e=>e.redoSelection(),goDocStart:e=>e.extendSelection(qu(e.firstLine(),0)),goDocEnd:e=>e.extendSelection(qu(e.lastLine())),goLineStart:e=>e.extendSelectionsBy((t=>Nm(e,t.head.line)),{origin:"+move",bias:1}),goLineStartSmart:e=>e.extendSelectionsBy((t=>Um(e,t.head)),{origin:"+move",bias:1}),goLineEnd:e=>e.extendSelectionsBy((t=>function(e,t){let i=Bu(e.doc,t),n=function(e){let t;for(;t=Ch(e);)e=t.find(1,!0).line;return e}(i);n!=i&&(t=Nu(n));return $m(!0,e,i,t,-1)}(e,t.head.line)),{origin:"+move",bias:-1}),goLineRight:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")}),Rc),goLineLeft:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")}),Rc),goLineLeftSmart:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:i},"div");return n.ch<e.getLine(n.line).search(/\S/)?Um(e,t.head):n}),Rc),goLineUp:e=>e.moveV(-1,"line"),goLineDown:e=>e.moveV(1,"line"),goPageUp:e=>e.moveV(-1,"page"),goPageDown:e=>e.moveV(1,"page"),goCharLeft:e=>e.moveH(-1,"char"),goCharRight:e=>e.moveH(1,"char"),goColumnLeft:e=>e.moveH(-1,"column"),goColumnRight:e=>e.moveH(1,"column"),goWordLeft:e=>e.moveH(-1,"word"),goGroupRight:e=>e.moveH(1,"group"),goGroupLeft:e=>e.moveH(-1,"group"),goWordRight:e=>e.moveH(1,"word"),delCharBefore:e=>e.deleteH(-1,"codepoint"),delCharAfter:e=>e.deleteH(1,"char"),delWordBefore:e=>e.deleteH(-1,"word"),delWordAfter:e=>e.deleteH(1,"word"),delGroupBefore:e=>e.deleteH(-1,"group"),delGroupAfter:e=>e.deleteH(1,"group"),indentAuto:e=>e.indentSelection("smart"),indentMore:e=>e.indentSelection("add"),indentLess:e=>e.indentSelection("subtract"),insertTab:e=>e.replaceSelection("\t"),insertSoftTab:e=>{let t=[],i=e.listSelections(),n=e.options.tabSize;for(let r=0;r<i.length;r++){let o=i[r].from(),s=zc(e.getLine(o.line),o.ch,n);t.push($c(n-s%n))}e.replaceSelections(t)},defaultTab:e=>{e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:e=>Np(e,(()=>{let t=e.listSelections(),i=[];for(let n=0;n<t.length;n++){if(!t[n].empty())continue;let r=t[n].head,o=Bu(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new qu(r.line,r.ch-1)),r.ch>0)r=new qu(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),qu(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){let t=Bu(e.doc,r.line-1).text;t&&(r=new qu(r.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+t.charAt(t.length-1),qu(r.line-1,t.length-1),r,"+transpose"))}i.push(new df(r,r))}e.setSelections(i)})),newlineAndIndent:e=>Np(e,(()=>{let t=e.listSelections();for(let i=t.length-1;i>=0;i--)e.replaceRange(e.doc.lineSeparator(),t[i].anchor,t[i].head,"+input");t=e.listSelections();for(let i=0;i<t.length;i++)e.indentLine(t[i].from().line,null,!0);bp(e)})),openLine:e=>e.replaceSelection("\n","start"),toggleOverwrite:e=>e.toggleOverwrite()};function Nm(e,t){let i=Bu(e.doc,t),n=Ah(i);return n!=i&&(t=Nu(n)),$m(!0,e,n,t,1)}function Um(e,t){let i=Nm(e,t.line),n=Bu(e.doc,i.line),r=tu(n,e.doc.direction);if(!r||0==r[0].level){let e=Math.max(i.ch,n.text.search(/\S/)),r=t.line==i.line&&t.ch<=e&&t.ch;return qu(i.line,r?0:e,i.sticky)}return i}function Vm(e,t,i){if("string"==typeof t&&!(t=jm[t]))return!1;e.display.input.ensurePolled();let n=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),r=t(e)!=Dc}finally{e.display.shift=n,e.state.suppressEdits=!1}return r}let Gm=new Ic;function qm(e,t,i,n){let r=e.state.keySeq;if(r){if(Lm(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:Gm.set(50,(()=>{e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())})),Wm(e,r+" "+t,i,n))return!0}return Wm(e,t,i,n)}function Wm(e,t,i,n){let r=function(e,t,i){for(let n=0;n<e.state.keyMaps.length;n++){let r=Im(t,e.state.keyMaps[n],i,e);if(r)return r}return e.options.extraKeys&&Im(t,e.options.extraKeys,i,e)||Im(t,e.options.keyMap,i,e)}(e,t,n);return"multi"==r&&(e.state.keySeq=t),"handled"==r&&Jh(e,"keyHandled",e,t,i),"handled"!=r&&"multi"!=r||(hu(i),hp(e)),!!r}function Hm(e,t){let i=Pm(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?qm(e,"Shift-"+i,t,(t=>Vm(e,t,!0)))||qm(e,i,t,(t=>{if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return Vm(e,t)})):qm(e,i,t,(t=>Vm(e,t))))}let Zm=null;function Xm(e){let t=this;if(e.target&&e.target!=t.display.input.getField())return;if(t.curOp.focus=kc(),au(t,e))return;Yl&&Jl<11&&27==e.keyCode&&(e.returnValue=!1);let i=e.keyCode;t.display.shift=16==i||e.shiftKey;let n=Hm(t,e);nc&&(Zm=n?i:null,n||88!=i||ku||!(uc?e.metaKey:e.ctrlKey)||t.replaceSelection("",null,"cut")),Hl&&!uc&&!n&&46==i&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function(e){let t=e.display.lineDiv;function i(e){18!=e.keyCode&&e.altKey||(_c(t,"CodeMirror-crosshair"),ou(document,"keyup",i),ou(document,"mouseover",i))}Sc(t,"CodeMirror-crosshair"),nu(document,"keyup",i),nu(document,"mouseover",i)}(t)}function Km(e){16==e.keyCode&&(this.doc.sel.shift=!1),au(this,e)}function Ym(e){let t=this;if(e.target&&e.target!=t.display.input.getField())return;if(dd(t.display,e)||au(t,e)||e.ctrlKey&&!e.altKey||uc&&e.metaKey)return;let i=e.keyCode,n=e.charCode;if(nc&&i==Zm)return Zm=null,void hu(e);if(nc&&(!e.which||e.which<10)&&Hm(t,e))return;let r=String.fromCharCode(null==n?i:n);"\b"!=r&&(function(e,t,i){return qm(e,"'"+i+"'",t,(t=>Vm(e,t,!0)))}(t,e,r)||t.display.input.onKeyPress(e))}class Jm{constructor(e,t,i){this.time=e,this.pos=t,this.button=i}compare(e,t,i){return this.time+400>e&&0==Wu(t,this.pos)&&i==this.button}}let Qm,eg;function tg(e){let t=this,i=t.display;if(au(t,e)||i.activeTouch&&i.input.supportsTouch())return;if(i.input.ensurePolled(),i.shift=e.shiftKey,dd(i,e))return void(Ql||(i.scroller.draggable=!1,setTimeout((()=>i.scroller.draggable=!0),100)));if(rg(t,e))return;let n=Qd(t,e),r=gu(e),o=n?function(e,t){let i=+new Date;return eg&&eg.compare(i,e,t)?(Qm=eg=null,"triple"):Qm&&Qm.compare(i,e,t)?(eg=new Jm(i,e,t),Qm=null,"double"):(Qm=new Jm(i,e,t),eg=null,"single")}(n,r):"single";window.focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),n&&function(e,t,i,n,r){let o="Click";"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o);return o=(1==t?"Left":2==t?"Middle":"Right")+o,qm(e,Dm(o,r),r,(t=>{if("string"==typeof t&&(t=jm[t]),!t)return!1;let n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,i)!=Dc}finally{e.state.suppressEdits=!1}return n}))}(t,r,n,o,e)||(1==r?n?function(e,t,i,n){Yl?setTimeout(Mc(dp,e),0):e.curOp.focus=kc();let r,o=function(e,t,i){let n=e.getOption("configureMouse"),r=n?n(e,t,i):{};if(null==r.unit){let e=hc?i.shiftKey&&i.metaKey:i.altKey;r.unit=e?"rectangle":"single"==t?"char":"double"==t?"word":"line"}(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||i.shiftKey);null==r.addNew&&(r.addNew=uc?i.metaKey:i.ctrlKey);null==r.moveOnDrag&&(r.moveOnDrag=!(uc?i.altKey:i.ctrlKey));return r}(e,i,n),s=e.doc.sel;e.options.dragDrop&&vu&&!e.isReadOnly()&&"single"==i&&(r=s.contains(t))>-1&&(Wu((r=s.ranges[r]).from(),t)<0||t.xRel>0)&&(Wu(r.to(),t)>0||t.xRel<0)?function(e,t,i,n){let r=e.display,o=!1,s=Up(e,(t=>{Ql&&(r.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:pp(e)),ou(r.wrapper.ownerDocument,"mouseup",s),ou(r.wrapper.ownerDocument,"mousemove",a),ou(r.scroller,"dragstart",l),ou(r.scroller,"drop",s),o||(hu(t),n.addNew||Bf(e.doc,i,null,null,n.extend),Ql&&!rc||Yl&&9==Jl?setTimeout((()=>{r.wrapper.ownerDocument.body.focus({preventScroll:!0}),r.input.focus()}),20):r.input.focus())})),a=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},l=()=>o=!0;Ql&&(r.scroller.draggable=!0);e.state.draggingText=s,s.copy=!n.moveOnDrag,nu(r.wrapper.ownerDocument,"mouseup",s),nu(r.wrapper.ownerDocument,"mousemove",a),nu(r.scroller,"dragstart",l),nu(r.scroller,"drop",s),e.state.delayingBlurEvent=!0,setTimeout((()=>r.input.focus()),20),r.scroller.dragDrop&&r.scroller.dragDrop()}(e,n,t,o):function(e,t,i,n){Yl&&pp(e);let r=e.display,o=e.doc;hu(t);let s,a,l=o.sel,c=l.ranges;n.addNew&&!n.extend?(a=o.sel.contains(i),s=a>-1?c[a]:new df(i,i)):(s=o.sel.primary(),a=o.sel.primIndex);if("rectangle"==n.unit)n.addNew||(s=new df(i,i)),i=Qd(e,t,!0,!0),a=-1;else{let t=ig(e,i,n.unit);s=n.extend?Rf(s,t.anchor,t.head,n.extend):t}n.addNew?-1==a?(a=c.length,Uf(o,pf(e,c.concat([s]),a),{scroll:!1,origin:"*mouse"})):c.length>1&&c[a].empty()&&"char"==n.unit&&!n.extend?(Uf(o,pf(e,c.slice(0,a).concat(c.slice(a+1)),0),{scroll:!1,origin:"*mouse"}),l=o.sel):$f(o,a,s,Oc):(a=0,Uf(o,new hf([s],0),Oc),l=o.sel);let u=i;function h(t){if(0!=Wu(u,t))if(u=t,"rectangle"==n.unit){let n=[],r=e.options.tabSize,s=zc(Bu(o,i.line).text,i.ch,r),c=zc(Bu(o,t.line).text,t.ch,r),u=Math.min(s,c),h=Math.max(s,c);for(let s=Math.min(i.line,t.line),a=Math.min(e.lastLine(),Math.max(i.line,t.line));s<=a;s++){let e=Bu(o,s).text,t=Bc(e,u,r);u==h?n.push(new df(qu(s,t),qu(s,t))):e.length>t&&n.push(new df(qu(s,t),qu(s,Bc(e,h,r))))}n.length||n.push(new df(i,i)),Uf(o,pf(e,l.ranges.slice(0,a).concat(n),a),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{let i,r=s,c=ig(e,t,n.unit),u=r.anchor;Wu(c.anchor,u)>0?(i=c.head,u=Ku(r.from(),c.anchor)):(i=c.anchor,u=Xu(r.to(),c.head));let h=l.ranges.slice(0);h[a]=function(e,t){let{anchor:i,head:n}=t,r=Bu(e.doc,i.line);if(0==Wu(i,n)&&i.sticky==n.sticky)return t;let o=tu(r);if(!o)return t;let s=Qc(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return t;let l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return t;if(n.line!=i.line)l=(n.line-i.line)*("ltr"==e.doc.direction?1:-1)>0;else{let e=Qc(o,n.ch,n.sticky),t=e-s||(n.ch-i.ch)*(1==a.level?-1:1);l=e==c-1||e==c?t<0:t>0}let u=o[c+(l?-1:0)],h=l==(1==u.level),d=h?u.from:u.to,p=h?"after":"before";return i.ch==d&&i.sticky==p?t:new df(new qu(i.line,d,p),n)}(e,new df(Ju(o,u),i)),Uf(o,pf(e,h,a),Oc)}}let d=r.wrapper.getBoundingClientRect(),p=0;function f(t){let i=++p,s=Qd(e,t,!0,"rectangle"==n.unit);if(s)if(0!=Wu(s,u)){e.curOp.focus=kc(),h(s);let n=_p(r,o);(s.line>=n.to||s.line<n.from)&&setTimeout(Up(e,(()=>{p==i&&f(t)})),150)}else{let n=t.clientY<d.top?-20:t.clientY>d.bottom?20:0;n&&setTimeout(Up(e,(()=>{p==i&&(r.scroller.scrollTop+=n,f(t))})),50)}}function m(t){e.state.selectingText=!1,p=1/0,t&&(hu(t),r.input.focus()),ou(r.wrapper.ownerDocument,"mousemove",g),ou(r.wrapper.ownerDocument,"mouseup",y),o.history.lastSelOrigin=null}let g=Up(e,(e=>{0!==e.buttons&&gu(e)?f(e):m(e)})),y=Up(e,m);e.state.selectingText=y,nu(r.wrapper.ownerDocument,"mousemove",g),nu(r.wrapper.ownerDocument,"mouseup",y)}(e,n,t,o)}(t,n,o,e):mu(e)==i.scroller&&hu(e):2==r?(n&&Bf(t.doc,n),setTimeout((()=>i.input.focus()),20)):3==r&&(mc?t.display.input.onContextMenu(e):pp(t)))}function ig(e,t,i){if("char"==i)return new df(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new df(qu(t.line,0),Ju(e.doc,qu(t.line+1,0)));let n=i(e,t);return new df(n.from,n.to)}function ng(e,t,i,n){let r,o;if(t.touches)r=t.touches[0].clientX,o=t.touches[0].clientY;else try{r=t.clientX,o=t.clientY}catch(t){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&hu(t);let s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!cu(e,i))return pu(t);o-=a.top-s.viewOffset;for(let n=0;n<e.display.gutterSpecs.length;++n){let a=s.gutters.childNodes[n];if(a&&a.getBoundingClientRect().right>=r){return su(e,i,e,Uu(e.doc,o),e.display.gutterSpecs[n].className,t),pu(t)}}}function rg(e,t){return ng(e,t,"gutterClick",!0)}function og(e,t){dd(e.display,t)||function(e,t){return!!cu(e,"gutterContextMenu")&&ng(e,t,"gutterContextMenu",!1)}(e,t)||au(e,t,"contextmenu")||mc||e.display.input.onContextMenu(t)}function sg(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),zd(e)}let ag={toString:function(){return"CodeMirror.Init"}},lg={},cg={};function ug(e,t,i){if(!t!=!(i&&i!=ag)){let i=e.display.dragFunctions,n=t?nu:ou;n(e.display.scroller,"dragstart",i.start),n(e.display.scroller,"dragenter",i.enter),n(e.display.scroller,"dragover",i.over),n(e.display.scroller,"dragleave",i.leave),n(e.display.scroller,"drop",i.drop)}}function hg(e){e.options.lineWrapping?(Sc(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(_c(e.display.wrapper,"CodeMirror-wrap"),Rh(e)),Jd(e),tp(e),zd(e),setTimeout((()=>Ap(e)),100)}function dg(e,t){if(!(this instanceof dg))return new dg(e,t);this.options=t=t?Ac(t):{},Ac(lg,t,!1);let i=t.value;"string"==typeof i?i=new vm(i,t.mode,null,t.lineSeparator,t.direction):t.mode&&(i.modeOption=t.mode),this.doc=i;let n=new dg.inputStyles[t.inputStyle](this),r=this.display=new of(e,i,n,t);r.wrapper.CodeMirror=this,sg(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Lp(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Ic,keySeq:null,specialChars:null},t.autofocus&&!cc&&r.input.focus(),Yl&&Jl<11&&setTimeout((()=>this.display.input.reset(!0)),20),function(e){let t=e.display;nu(t.scroller,"mousedown",Up(e,tg)),nu(t.scroller,"dblclick",Yl&&Jl<11?Up(e,(t=>{if(au(e,t))return;let i=Qd(e,t);if(!i||rg(e,t)||dd(e.display,t))return;hu(t);let n=e.findWordAt(i);Bf(e.doc,n.anchor,n.head)})):t=>au(e,t)||hu(t));nu(t.scroller,"contextmenu",(t=>og(e,t))),nu(t.input.getField(),"contextmenu",(i=>{t.scroller.contains(i.target)||og(e,i)}));let i,n={end:0};function r(){t.activeTouch&&(i=setTimeout((()=>t.activeTouch=null),1e3),n=t.activeTouch,n.end=+new Date)}function o(e){if(1!=e.touches.length)return!1;let t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function s(e,t){if(null==t.left)return!0;let i=t.left-e.left,n=t.top-e.top;return i*i+n*n>400}nu(t.scroller,"touchstart",(r=>{if(!au(e,r)&&!o(r)&&!rg(e,r)){t.input.ensurePolled(),clearTimeout(i);let e=+new Date;t.activeTouch={start:e,moved:!1,prev:e-n.end<=300?n:null},1==r.touches.length&&(t.activeTouch.left=r.touches[0].pageX,t.activeTouch.top=r.touches[0].pageY)}})),nu(t.scroller,"touchmove",(()=>{t.activeTouch&&(t.activeTouch.moved=!0)})),nu(t.scroller,"touchend",(i=>{let n=t.activeTouch;if(n&&!dd(t,i)&&null!=n.left&&!n.moved&&new Date-n.start<300){let r,o=e.coordsChar(t.activeTouch,"page");r=!n.prev||s(n,n.prev)?new df(o,o):!n.prev.prev||s(n,n.prev.prev)?e.findWordAt(o):new df(qu(o.line,0),Ju(e.doc,qu(o.line+1,0))),e.setSelection(r.anchor,r.head),e.focus(),hu(i)}r()})),nu(t.scroller,"touchcancel",r),nu(t.scroller,"scroll",(()=>{t.scroller.clientHeight&&(Sp(e,t.scroller.scrollTop),Ep(e,t.scroller.scrollLeft,!0),su(e,"scroll",e))})),nu(t.scroller,"mousewheel",(t=>uf(e,t))),nu(t.scroller,"DOMMouseScroll",(t=>uf(e,t))),nu(t.wrapper,"scroll",(()=>t.wrapper.scrollTop=t.wrapper.scrollLeft=0)),t.dragFunctions={enter:t=>{au(e,t)||fu(t)},over:t=>{au(e,t)||(!function(e,t){let i=Qd(e,t);if(!i)return;let n=document.createDocumentFragment();lp(e,i,n),e.display.dragCursor||(e.display.dragCursor=bc("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),xc(e.display.dragCursor,n)}(e,t),fu(t))},start:t=>function(e,t){if(Yl&&(!e.state.draggingText||+new Date-xm<100))fu(t);else if(!au(e,t)&&!dd(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!rc)){let i=bc("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",nc&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),nc&&i.parentNode.removeChild(i)}}(e,t),drop:Up(e,bm),leave:t=>{au(e,t)||wm(e)}};let a=t.input.getField();nu(a,"keyup",(t=>Km.call(e,t))),nu(a,"keydown",Up(e,Xm)),nu(a,"keypress",Up(e,Ym)),nu(a,"focus",(t=>fp(e,t))),nu(a,"blur",(t=>mp(e,t)))}(this),Sm(),Pp(this),this.curOp.forceUpdate=!0,kf(this,i),t.autofocus&&!cc||this.hasFocus()?setTimeout((()=>{this.hasFocus()&&!this.state.focused&&fp(this)}),20):mp(this);for(let e in cg)cg.hasOwnProperty(e)&&cg[e](this,t[e],ag);ef(this),t.finishInit&&t.finishInit(this);for(let e=0;e<pg.length;++e)pg[e](this);Op(this),Ql&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(r.lineDiv).textRendering&&(r.lineDiv.style.textRendering="auto")}dg.defaults=lg,dg.optionHandlers=cg;let pg=[];function fg(e,t,i,n){let r,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?r=rh(e,t).state:i="prev");let s=e.options.tabSize,a=Bu(o,t),l=zc(a.text,null,s);a.stateAfter&&(a.stateAfter=null);let c,u=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&(c=o.mode.indent(r,a.text.slice(u.length),a.text),c==Dc||c>150)){if(!n)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?zc(Bu(o,t-1).text,null,s):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);let h="",d=0;if(e.options.indentWithTabs)for(let e=Math.floor(c/s);e;--e)d+=s,h+="\t";if(d<c&&(h+=$c(c-d)),h!=u)return nm(o,h,qu(t,0),qu(t,u.length),"+input"),a.stateAfter=null,!0;for(let e=0;e<o.sel.ranges.length;e++){let i=o.sel.ranges[e];if(i.head.line==t&&i.head.ch<u.length){let i=qu(t,u.length);$f(o,e,new df(i,i));break}}}dg.defineInitHook=e=>pg.push(e);let mg=null;function gg(e){mg=e}function yg(e,t,i,n,r){let o=e.doc;e.display.shift=!1,n||(n=o.sel);let s=+new Date-200,a="paste"==r||e.state.pasteIncoming>s,l=wu(t),c=null;if(a&&n.ranges.length>1)if(mg&&mg.text.join("\n")==t){if(n.ranges.length%mg.text.length==0){c=[];for(let e=0;e<mg.text.length;e++)c.push(o.splitLines(mg.text[e]))}}else l.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(c=Nc(l,(e=>[e])));let u=e.curOp.updateInput;for(let t=n.ranges.length-1;t>=0;t--){let u=n.ranges[t],h=u.from(),d=u.to();u.empty()&&(i&&i>0?h=qu(h.line,h.ch-i):e.state.overwrite&&!a?d=qu(d.line,Math.min(Bu(o,d.line).text.length,d.ch+jc(l).length)):a&&mg&&mg.lineWise&&mg.text.join("\n")==l.join("\n")&&(h=d=qu(h.line,0)));let p={from:h,to:d,text:c?c[t%c.length]:l,origin:r||(a?"paste":e.state.cutIncoming>s?"cut":"+input")};Jf(e.doc,p),Jh(e,"inputRead",e,p)}t&&!a&&vg(e,t),bp(e),e.curOp.updateInput<2&&(e.curOp.updateInput=u),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function _g(e,t){let i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||!t.hasFocus()||Np(t,(()=>yg(t,i,0,null,"paste"))),!0}function vg(e,t){if(!e.options.electricChars||!e.options.smartIndent)return;let i=e.doc.sel;for(let n=i.ranges.length-1;n>=0;n--){let r=i.ranges[n];if(r.head.ch>100||n&&i.ranges[n-1].head.line==r.head.line)continue;let o=e.getModeAt(r.head),s=!1;if(o.electricChars){for(let i=0;i<o.electricChars.length;i++)if(t.indexOf(o.electricChars.charAt(i))>-1){s=fg(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Bu(e.doc,r.head.line).text.slice(0,r.head.ch))&&(s=fg(e,r.head.line,"smart"));s&&Jh(e,"electricInput",e,r.head.line)}}function xg(e){let t=[],i=[];for(let n=0;n<e.doc.sel.ranges.length;n++){let r=e.doc.sel.ranges[n].head.line,o={anchor:qu(r,0),head:qu(r+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function bg(e,t,i,n){e.setAttribute("autocorrect",i?"":"off"),e.setAttribute("autocapitalize",n?"":"off"),e.setAttribute("spellcheck",!!t)}function wg(){let e=bc("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=bc("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return Ql?e.style.width="1000px":e.setAttribute("wrap","off"),ac&&(e.style.border="1px solid black"),bg(e),t}function Tg(e,t,i,n,r){let o=t,s=i,a=Bu(e,t.line),l=r&&"rtl"==e.direction?-i:i;function c(o){let s;if("codepoint"==n){let e=a.text.charCodeAt(t.ch+(i>0?0:-1));if(isNaN(e))s=null;else{let n=i>0?e>=55296&&e<56320:e>=56320&&e<57343;s=new qu(t.line,Math.max(0,Math.min(a.text.length,t.ch+i*(n?2:1))),-i)}}else s=r?function(e,t,i,n){let r=tu(t,e.doc.direction);if(!r)return Fm(t,i,n);i.ch>=t.text.length?(i.ch=t.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");let o=Qc(r,i.ch,i.sticky),s=r[o];if("ltr"==e.doc.direction&&s.level%2==0&&(n>0?s.to>i.ch:s.from<i.ch))return Fm(t,i,n);let a,l=(e,i)=>Bm(t,e instanceof qu?e.ch:e,i),c=i=>e.options.lineWrapping?(a=a||wd(e,t),Ud(e,t,a,i)):{begin:0,end:t.text.length},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==e.doc.direction||1==s.level){let e=1==s.level==n<0,t=l(i,e?1:-1);if(null!=t&&(e?t<=s.to&&t<=u.end:t>=s.from&&t>=u.begin)){let n=e?"before":"after";return new qu(i.line,t,n)}}let h=(e,t,n)=>{let o=(e,t)=>t?new qu(i.line,l(e,1),"before"):new qu(i.line,e,"after");for(;e>=0&&e<r.length;e+=t){let i=r[e],s=t>0==(1!=i.level),a=s?n.begin:l(n.end,-1);if(i.from<=a&&a<i.to)return o(a,s);if(a=s?i.from:l(i.to,-1),n.begin<=a&&a<n.end)return o(a,s)}},d=h(o+n,n,u);if(d)return d;let p=n>0?u.end:l(u.begin,-1);return null==p||n>0&&p==t.text.length||(d=h(n>0?0:r.length-1,n,c(p)),!d)?null:d}(e.cm,a,t,i):Fm(a,t,i);if(null==s){if(o||!function(){let i=t.line+l;return!(i<e.first||i>=e.first+e.size)&&(t=new qu(i,t.ch,t.sticky),a=Bu(e,i))}())return!1;t=$m(r,e.cm,a,t.line,l)}else t=s;return!0}if("char"==n||"codepoint"==n)c();else if("column"==n)c(!0);else if("word"==n||"group"==n){let r=null,o="group"==n,s=e.cm&&e.cm.getHelper(t,"wordChars");for(let e=!0;!(i<0)||c(!e);e=!1){let n=a.text.charAt(t.ch)||"\n",l=Wc(n,s)?"w":o&&"\n"==n?"n":!o||/\s/.test(n)?null:"p";if(!o||e||l||(l="s"),r&&r!=l){i<0&&(i=1,c(),t.sticky="after");break}if(l&&(r=l),i>0&&!c(!e))break}}let u=Zf(e,t,o,s,!0);return Hu(o,u)&&(u.hitSide=!0),u}function kg(e,t,i,n){let r,o,s=e.doc,a=t.left;if("page"==n){let n=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),o=Math.max(n-.5*Hd(e.display),3);r=(i>0?t.bottom:t.top)+i*o}else"line"==n&&(r=i>0?t.bottom+3:t.top-3);for(;o=jd(e,a,r),o.outside;){if(i<0?r<=0:r>=s.height){o.hitSide=!0;break}r+=5*i}return o}class Sg{constructor(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Ic,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null}init(e){let t=this,i=t.cm,n=t.div=e.lineDiv;function r(e){for(let t=e.target;t;t=t.parentNode){if(t==n)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function o(e){if(!r(e)||au(i,e))return;if(i.somethingSelected())gg({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;{let t=xg(i);gg({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation((()=>{i.setSelections(t.ranges,0,Pc),i.replaceSelection("",null,"cut")}))}}if(e.clipboardData){e.clipboardData.clearData();let t=mg.text.join("\n");if(e.clipboardData.setData("Text",t),e.clipboardData.getData("Text")==t)return void e.preventDefault()}let o=wg(),s=o.firstChild;i.display.lineSpace.insertBefore(o,i.display.lineSpace.firstChild),s.value=mg.text.join("\n");let a=kc();Ec(s),setTimeout((()=>{i.display.lineSpace.removeChild(o),a.focus(),a==n&&t.showPrimarySelection()}),50)}n.contentEditable=!0,bg(n,i.options.spellcheck,i.options.autocorrect,i.options.autocapitalize),nu(n,"paste",(e=>{!r(e)||au(i,e)||_g(e,i)||Jl<=11&&setTimeout(Up(i,(()=>this.updateFromDOM())),20)})),nu(n,"compositionstart",(e=>{this.composing={data:e.data,done:!1}})),nu(n,"compositionupdate",(e=>{this.composing||(this.composing={data:e.data,done:!1})})),nu(n,"compositionend",(e=>{this.composing&&(e.data!=this.composing.data&&this.readFromDOMSoon(),this.composing.done=!0)})),nu(n,"touchstart",(()=>t.forceCompositionEnd())),nu(n,"input",(()=>{this.composing||this.readFromDOMSoon()})),nu(n,"copy",o),nu(n,"cut",o)}screenReaderLabelChanged(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")}prepareSelection(){let e=ap(this.cm,!1);return e.focus=kc()==this.div,e}showSelection(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))}getSelection(){return this.cm.display.wrapper.ownerDocument.getSelection()}showPrimarySelection(){let e=this.getSelection(),t=this.cm,i=t.doc.sel.primary(),n=i.from(),r=i.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||r.line<t.display.viewFrom)return void e.removeAllRanges();let o=Mg(t,e.anchorNode,e.anchorOffset),s=Mg(t,e.focusNode,e.focusOffset);if(o&&!o.bad&&s&&!s.bad&&0==Wu(Ku(o,s),n)&&0==Wu(Xu(o,s),r))return;let a=t.display.view,l=n.line>=t.display.viewFrom&&Cg(t,n)||{node:a[0].measure.map[2],offset:0},c=r.line<t.display.viewTo&&Cg(t,r);if(!c){let e=a[a.length-1].measure,t=e.maps?e.maps[e.maps.length-1]:e.map;c={node:t[t.length-1],offset:t[t.length-2]-t[t.length-3]}}if(!l||!c)return void e.removeAllRanges();let u,h=e.rangeCount&&e.getRangeAt(0);try{u=yc(l.node,l.offset,c.offset,c.node)}catch(e){}u&&(!Hl&&t.state.focused?(e.collapse(l.node,l.offset),u.collapsed||(e.removeAllRanges(),e.addRange(u))):(e.removeAllRanges(),e.addRange(u)),h&&null==e.anchorNode?e.addRange(h):Hl&&this.startGracePeriod()),this.rememberSelection()}startGracePeriod(){clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((()=>{this.gracePeriod=!1,this.selectionChanged()&&this.cm.operation((()=>this.cm.curOp.selectionChanged=!0))}),20)}showMultipleSelections(e){xc(this.cm.display.cursorDiv,e.cursors),xc(this.cm.display.selectionDiv,e.selection)}rememberSelection(){let e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset}selectionInEditor(){let e=this.getSelection();if(!e.rangeCount)return!1;let t=e.getRangeAt(0).commonAncestorContainer;return Tc(this.div,t)}focus(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&kc()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())}blur(){this.div.blur()}getField(){return this.div}supportsTouch(){return!0}receivedFocus(){let e=this;this.selectionInEditor()?setTimeout((()=>this.pollSelection()),20):Np(this.cm,(()=>e.cm.curOp.selectionChanged=!0)),this.polling.set(this.cm.options.pollInterval,(function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))}))}selectionChanged(){let e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset}pollSelection(){if(null!=this.readDOMTimeout||this.gracePeriod||!this.selectionChanged())return;let e=this.getSelection(),t=this.cm;if(lc&&tc&&this.cm.display.gutterSpecs.length&&function(e){for(let t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(this.composing)return;this.rememberSelection();let i=Mg(t,e.anchorNode,e.anchorOffset),n=Mg(t,e.focusNode,e.focusOffset);i&&n&&Np(t,(()=>{Uf(t.doc,ff(i,n),Pc),(i.bad||n.bad)&&(t.curOp.selectionChanged=!0)}))}pollContent(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);let e,t,i,n=this.cm,r=n.display,o=n.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>n.firstLine()&&(s=qu(s.line-1,Bu(n.doc,s.line-1).length)),a.ch==Bu(n.doc,a.line).text.length&&a.line<n.lastLine()&&(a=qu(a.line+1,0)),s.line<r.viewFrom||a.line>r.viewTo-1)return!1;s.line==r.viewFrom||0==(e=ep(n,s.line))?(t=Nu(r.view[0].line),i=r.view[0].node):(t=Nu(r.view[e].line),i=r.view[e-1].node.nextSibling);let l,c,u=ep(n,a.line);if(u==r.view.length-1?(l=r.viewTo-1,c=r.lineDiv.lastChild):(l=Nu(r.view[u+1].line)-1,c=r.view[u+1].node.previousSibling),!i)return!1;let h=n.doc.splitLines(function(e,t,i,n,r){let o="",s=!1,a=e.doc.lineSeparator(),l=!1;function c(e){return t=>t.id==e}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(e){e&&(u(),o+=e)}function d(t){if(1==t.nodeType){let i=t.getAttribute("cm-text");if(i)return void h(i);let o,p=t.getAttribute("cm-marker");if(p){let t=e.findMarks(qu(n,0),qu(r+1,0),c(+p));return void(t.length&&(o=t[0].find(0))&&h(Fu(e.doc,o.from,o.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;let f=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;f&&u();for(let e=0;e<t.childNodes.length;e++)d(t.childNodes[e]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),f&&(s=!0)}else 3==t.nodeType&&h(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;d(t),t!=i;)t=t.nextSibling,l=!1;return o}(n,i,c,t,l)),d=Fu(n.doc,qu(t,0),qu(l,Bu(n.doc,l).text.length));for(;h.length>1&&d.length>1;)if(jc(h)==jc(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),t++}let p=0,f=0,m=h[0],g=d[0],y=Math.min(m.length,g.length);for(;p<y&&m.charCodeAt(p)==g.charCodeAt(p);)++p;let _=jc(h),v=jc(d),x=Math.min(_.length-(1==h.length?p:0),v.length-(1==d.length?p:0));for(;f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==d.length&&t==s.line)for(;p&&p>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)p--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(p).replace(/\u200b+$/,"");let b=qu(t,p),w=qu(l,d.length?jc(d).length-f:0);return h.length>1||h[0]||Wu(b,w)?(nm(n.doc,h,b,w,"+input"),!0):void 0}ensurePolled(){this.forceCompositionEnd()}reset(){this.forceCompositionEnd()}forceCompositionEnd(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())}readFromDOMSoon(){null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((()=>{if(this.readDOMTimeout=null,this.composing){if(!this.composing.done)return;this.composing=null}this.updateFromDOM()}),80))}updateFromDOM(){!this.cm.isReadOnly()&&this.pollContent()||Np(this.cm,(()=>tp(this.cm)))}setUneditable(e){e.contentEditable="false"}onKeyPress(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Up(this.cm,yg)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))}readOnlyChanged(e){this.div.contentEditable=String("nocursor"!=e)}onContextMenu(){}resetPosition(){}}function Cg(e,t){let i=bd(e,t.line);if(!i||i.hidden)return null;let n=Bu(e.doc,t.line),r=vd(i,n,t.line),o=tu(n,e.doc.direction),s="left";if(o){s=Qc(o,t.ch)%2?"right":"left"}let a=Cd(r.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function Eg(e,t){return t&&(e.bad=!0),e}function Mg(e,t,i){let n;if(t==e.display.lineDiv){if(n=e.display.lineDiv.childNodes[i],!n)return Eg(e.clipPos(qu(e.display.viewTo-1)),!0);t=null,i=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(let r=0;r<e.display.view.length;r++){let o=e.display.view[r];if(o.node==n)return Ag(o,t,i)}}function Ag(e,t,i){let n=e.text.firstChild,r=!1;if(!t||!Tc(n,t))return Eg(qu(Nu(e.line),0),!0);if(t==n&&(r=!0,t=n.childNodes[i],i=0,!t)){let t=e.rest?jc(e.rest):e.line;return Eg(qu(Nu(t),t.text.length),r)}let o=3==t.nodeType?t:null,s=t;for(o||1!=t.childNodes.length||3!=t.firstChild.nodeType||(o=t.firstChild,i&&(i=o.nodeValue.length));s.parentNode!=n;)s=s.parentNode;let a=e.measure,l=a.maps;function c(t,i,n){for(let r=-1;r<(l?l.length:0);r++){let o=r<0?a.map:l[r];for(let s=0;s<o.length;s+=3){let a=o[s+2];if(a==t||a==i){let i=Nu(r<0?e.line:e.rest[r]),l=o[s]+n;return(n<0||a!=t)&&(l=o[s+(n?1:0)]),qu(i,l)}}}}let u=c(o,s,i);if(u)return Eg(u,r);for(let e=s.nextSibling,t=o?o.nodeValue.length-i:0;e;e=e.nextSibling){if(u=c(e,e.firstChild,0),u)return Eg(qu(u.line,u.ch-t),r);t+=e.textContent.length}for(let e=s.previousSibling,t=i;e;e=e.previousSibling){if(u=c(e,e.firstChild,-1),u)return Eg(qu(u.line,u.ch+t),r);t+=e.textContent.length}}Sg.prototype.needsContentAttribute=!0;class zg{constructor(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Ic,this.hasSelection=!1,this.composing=null}init(e){let t=this,i=this.cm;this.createField(e);const n=this.textarea;function r(e){if(!au(i,e)){if(i.somethingSelected())gg({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;{let r=xg(i);gg({lineWise:!0,text:r.text}),"cut"==e.type?i.setSelections(r.ranges,null,Pc):(t.prevInput="",n.value=r.text.join("\n"),Ec(n))}}"cut"==e.type&&(i.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),ac&&(n.style.width="0px"),nu(n,"input",(()=>{Yl&&Jl>=9&&this.hasSelection&&(this.hasSelection=null),t.poll()})),nu(n,"paste",(e=>{au(i,e)||_g(e,i)||(i.state.pasteIncoming=+new Date,t.fastPoll())})),nu(n,"cut",r),nu(n,"copy",r),nu(e.scroller,"paste",(r=>{if(dd(e,r)||au(i,r))return;if(!n.dispatchEvent)return i.state.pasteIncoming=+new Date,void t.focus();const o=new Event("paste");o.clipboardData=r.clipboardData,n.dispatchEvent(o)})),nu(e.lineSpace,"selectstart",(t=>{dd(e,t)||hu(t)})),nu(n,"compositionstart",(()=>{let e=i.getCursor("from");t.composing&&t.composing.range.clear(),t.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}})),nu(n,"compositionend",(()=>{t.composing&&(t.poll(),t.composing.range.clear(),t.composing=null)}))}createField(e){this.wrapper=wg(),this.textarea=this.wrapper.firstChild}screenReaderLabelChanged(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")}prepareSelection(){let e=this.cm,t=e.display,i=e.doc,n=ap(e);if(e.options.moveInputWithCursor){let r=Bd(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-o.left))}return n}showSelection(e){let t=this.cm.display;xc(t.cursorDiv,e.cursors),xc(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")}reset(e){if(this.contextMenuPending||this.composing)return;let t=this.cm;if(t.somethingSelected()){this.prevInput="";let e=t.getSelection();this.textarea.value=e,t.state.focused&&Ec(this.textarea),Yl&&Jl>=9&&(this.hasSelection=e)}else e||(this.prevInput=this.textarea.value="",Yl&&Jl>=9&&(this.hasSelection=null))}getField(){return this.textarea}supportsTouch(){return!1}focus(){if("nocursor"!=this.cm.options.readOnly&&(!cc||kc()!=this.textarea))try{this.textarea.focus()}catch(e){}}blur(){this.textarea.blur()}resetPosition(){this.wrapper.style.top=this.wrapper.style.left=0}receivedFocus(){this.slowPoll()}slowPoll(){this.pollingFast||this.polling.set(this.cm.options.pollInterval,(()=>{this.poll(),this.cm.state.focused&&this.slowPoll()}))}fastPoll(){let e=!1,t=this;t.pollingFast=!0,t.polling.set(20,(function i(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,i))}))}poll(){let e=this.cm,t=this.textarea,i=this.prevInput;if(this.contextMenuPending||!e.state.focused||Tu(t)&&!i&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;let n=t.value;if(n==i&&!e.somethingSelected())return!1;if(Yl&&Jl>=9&&this.hasSelection===n||uc&&/[\uf700-\uf7ff]/.test(n))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){let e=n.charCodeAt(0);if(8203!=e||i||(i="​"),8666==e)return this.reset(),this.cm.execCommand("undo")}let r=0,o=Math.min(i.length,n.length);for(;r<o&&i.charCodeAt(r)==n.charCodeAt(r);)++r;return Np(e,(()=>{yg(e,n.slice(r),i.length-r,null,this.composing?"*compose":null),n.length>1e3||n.indexOf("\n")>-1?t.value=this.prevInput="":this.prevInput=n,this.composing&&(this.composing.range.clear(),this.composing.range=e.markText(this.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))})),!0}ensurePolled(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)}onKeyPress(){Yl&&Jl>=9&&(this.hasSelection=null),this.fastPoll()}onContextMenu(e){let t=this,i=t.cm,n=i.display,r=t.textarea;t.contextMenuPending&&t.contextMenuPending();let o=Qd(i,e),s=n.scroller.scrollTop;if(!o||nc)return;i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&Up(i,Uf)(i.doc,ff(o),Pc);let a,l=r.style.cssText,c=t.wrapper.style.cssText,u=t.wrapper.offsetParent.getBoundingClientRect();function h(){if(null!=r.selectionStart){let e=i.somethingSelected(),o="​"+(e?r.value:"");r.value="⇚",r.value=o,t.prevInput=e?"":"​",r.selectionStart=1,r.selectionEnd=o.length,n.selForContextMenu=i.doc.sel}}function d(){if(t.contextMenuPending==d&&(t.contextMenuPending=!1,t.wrapper.style.cssText=c,r.style.cssText=l,Yl&&Jl<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=s),null!=r.selectionStart)){(!Yl||Yl&&Jl<9)&&h();let e=0,o=()=>{n.selForContextMenu==i.doc.sel&&0==r.selectionStart&&r.selectionEnd>0&&"​"==t.prevInput?Up(i,Kf)(i):e++<10?n.detectingSelectAll=setTimeout(o,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(o,200)}}if(t.wrapper.style.cssText="position: static",r.style.cssText=`position: absolute; width: 30px; height: 30px;\n      top: ${e.clientY-u.top-5}px; left: ${e.clientX-u.left-5}px;\n      z-index: 1000; background: ${Yl?"rgba(255, 255, 255, .05)":"transparent"};\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`,Ql&&(a=window.scrollY),n.input.focus(),Ql&&window.scrollTo(null,a),n.input.reset(),i.somethingSelected()||(r.value=t.prevInput=" "),t.contextMenuPending=d,n.selForContextMenu=i.doc.sel,clearTimeout(n.detectingSelectAll),Yl&&Jl>=9&&h(),mc){fu(e);let t=()=>{ou(window,"mouseup",t),setTimeout(d,20)};nu(window,"mouseup",t)}else setTimeout(d,50)}readOnlyChanged(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e}setUneditable(){}}zg.prototype.needsContentAttribute=!1,function(e){let t=e.optionHandlers;function i(i,n,r,o){e.defaults[i]=n,r&&(t[i]=o?(e,t,i)=>{i!=ag&&r(e,t,i)}:r)}e.defineOption=i,e.Init=ag,i("value","",((e,t)=>e.setValue(t)),!0),i("mode",null,((e,t)=>{e.doc.modeOption=t,vf(e)}),!0),i("indentUnit",2,vf,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(e=>{xf(e),zd(e),tp(e)}),!0),i("lineSeparator",null,((e,t)=>{if(e.doc.lineSep=t,!t)return;let i=[],n=e.doc.first;e.doc.iter((e=>{for(let r=0;;){let o=e.text.indexOf(t,r);if(-1==o)break;r=o+t.length,i.push(qu(n,o))}n++}));for(let n=i.length-1;n>=0;n--)nm(e.doc,t,i[n],qu(i[n].line,i[n].ch+t.length))})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,((e,t,i)=>{e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=ag&&e.refresh()})),i("specialCharPlaceholder",Vh,(e=>e.refresh()),!0),i("electricChars",!0),i("inputStyle",cc?"contenteditable":"textarea",(()=>{throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,((e,t)=>e.getInputField().spellcheck=t),!0),i("autocorrect",!1,((e,t)=>e.getInputField().autocorrect=t),!0),i("autocapitalize",!1,((e,t)=>e.getInputField().autocapitalize=t),!0),i("rtlMoveVisually",!dc),i("wholeLineUpdateBefore",!0),i("theme","default",(e=>{sg(e),rf(e)}),!0),i("keyMap","default",((e,t,i)=>{let n=Om(t),r=i!=ag&&Om(i);r&&r.detach&&r.detach(e,n),n.attach&&n.attach(e,r||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,hg,!0),i("gutters",[],((e,t)=>{e.display.gutterSpecs=tf(t,e.options.lineNumbers),rf(e)}),!0),i("fixedGutter",!0,((e,t)=>{e.display.gutters.style.left=t?Kd(e.display)+"px":"0",e.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(e=>Ap(e)),!0),i("scrollbarStyle","native",(e=>{Lp(e),Ap(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),i("lineNumbers",!1,((e,t)=>{e.display.gutterSpecs=tf(e.options.gutters,t),rf(e)}),!0),i("firstLineNumber",1,rf,!0),i("lineNumberFormatter",(e=>e),rf,!0),i("showCursorWhenSelecting",!1,sp,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,((e,t)=>{"nocursor"==t&&(mp(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),i("screenReaderLabel",null,((e,t)=>{t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),i("disableInput",!1,((e,t)=>{t||e.display.input.reset()}),!0),i("dragDrop",!0,ug),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,sp,!0),i("singleCursorHeightPerLine",!0,sp,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,xf,!0),i("addModeClass",!1,xf,!0),i("pollInterval",100),i("undoDepth",200,((e,t)=>e.doc.history.undoDepth=t)),i("historyEventDelay",1250),i("viewportMargin",10,(e=>e.refresh()),!0),i("maxHighlightLength",1e4,xf,!0),i("moveInputWithCursor",!0,((e,t)=>{t||e.display.input.resetPosition()})),i("tabindex",null,((e,t)=>e.display.input.getField().tabIndex=t||"")),i("autofocus",null),i("direction","ltr",((e,t)=>e.doc.setDirection(t)),!0),i("phrases",null)}(dg),function(e){let t=e.optionHandlers,i=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,i){let n=this.options,r=n[e];n[e]==i&&"mode"!=e||(n[e]=i,t.hasOwnProperty(e)&&Up(this,t[e])(this,i,r),su(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Om(e))},removeKeyMap:function(e){let t=this.state.keyMaps;for(let i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:Vp((function(t,i){let n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");!function(e,t,i){let n=0,r=i(t);for(;n<e.length&&i(e[n])<=r;)n++;e.splice(n,0,t)}(this.state.overlays,{mode:n,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},(e=>e.priority)),this.state.modeGen++,tp(this)})),removeOverlay:Vp((function(e){let t=this.state.overlays;for(let i=0;i<t.length;++i){let n=t[i].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(i,1),this.state.modeGen++,void tp(this)}})),indentLine:Vp((function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Vu(this.doc,e)&&fg(this,e,t,i)})),indentSelection:Vp((function(e){let t=this.doc.sel.ranges,i=-1;for(let n=0;n<t.length;n++){let r=t[n];if(r.empty())r.head.line>i&&(fg(this,r.head.line,e,!0),i=r.head.line,n==this.doc.sel.primIndex&&bp(this));else{let o=r.from(),s=r.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(let t=a;t<i;++t)fg(this,t,e);let l=this.doc.sel.ranges;0==o.ch&&t.length==l.length&&l[n].from().ch>0&&$f(this.doc,n,new df(o,l[n].to()),Pc)}}})),getTokenAt:function(e,t){return ch(this,e,t)},getLineTokens:function(e,t){return ch(this,qu(e),t,!0)},getTokenTypeAt:function(e){e=Ju(this.doc,e);let t,i=nh(this,Bu(this.doc,e.line)),n=0,r=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){let e=n+r>>1;if((e?i[2*e-1]:0)>=o)r=e;else{if(!(i[2*e+1]<o)){t=i[2*e+2];break}n=e+1}}let s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){let i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){let n=[];if(!i.hasOwnProperty(t))return n;let r=i[t],o=this.getModeAt(e);if("string"==typeof o[t])r[o[t]]&&n.push(r[o[t]]);else if(o[t])for(let e=0;e<o[t].length;e++){let i=r[o[t][e]];i&&n.push(i)}else o.helperType&&r[o.helperType]?n.push(r[o.helperType]):r[o.name]&&n.push(r[o.name]);for(let e=0;e<r._global.length;e++){let t=r._global[e];t.pred(o,this)&&-1==Lc(n,t.val)&&n.push(t.val)}return n},getStateAfter:function(e,t){let i=this.doc;return rh(this,(e=Yu(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){let i,n=this.doc.sel.primary();return i=null==e?n.head:"object"==typeof e?Ju(this.doc,e):e?n.from():n.to(),Bd(this,i,t||"page")},charCoords:function(e,t){return Rd(this,Ju(this.doc,e),t||"page")},coordsChar:function(e,t){return jd(this,(e=Od(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=Od(this,{top:e,left:0},t||"page").top,Uu(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){let n,r=!1;if("number"==typeof e){let t=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>t&&(e=t,r=!0),n=Bu(this.doc,e)}else n=e;return Pd(this,n,{top:0,left:0},t||"page",i||r).top+(r?this.doc.height-Ph(n):0)},defaultTextHeight:function(){return Hd(this.display)},defaultCharWidth:function(){return Zd(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,n,r){let o=this.display,s=(e=Bd(this,Ju(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)s=e.top;else if("above"==n||"near"==n){let i=Math.max(o.wrapper.clientHeight,this.doc.height),r=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>i)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=i&&(s=e.bottom),a+t.offsetWidth>r&&(a=r-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&function(e,t){let i=vp(e,t);null!=i.scrollTop&&Sp(e,i.scrollTop),null!=i.scrollLeft&&Ep(e,i.scrollLeft)}(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:Vp(Xm),triggerOnKeyPress:Vp(Ym),triggerOnKeyUp:Km,triggerOnMouseDown:Vp(tg),execCommand:function(e){if(jm.hasOwnProperty(e))return jm[e].call(null,this)},triggerElectric:Vp((function(e){vg(this,e)})),findPosH:function(e,t,i,n){let r=1;t<0&&(r=-1,t=-t);let o=Ju(this.doc,e);for(let e=0;e<t&&(o=Tg(this.doc,o,r,i,n),!o.hitSide);++e);return o},moveH:Vp((function(e,t){this.extendSelectionsBy((i=>this.display.shift||this.doc.extend||i.empty()?Tg(this.doc,i.head,e,t,this.options.rtlMoveVisually):e<0?i.from():i.to()),Rc)})),deleteH:Vp((function(e,t){let i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):Rm(this,(i=>{let r=Tg(n,i.head,e,t,!1);return e<0?{from:r,to:i.head}:{from:i.head,to:r}}))})),findPosV:function(e,t,i,n){let r=1,o=n;t<0&&(r=-1,t=-t);let s=Ju(this.doc,e);for(let e=0;e<t;++e){let e=Bd(this,s,"div");if(null==o?o=e.left:e.left=o,s=kg(this,e,r,i),s.hitSide)break}return s},moveV:Vp((function(e,t){let i=this.doc,n=[],r=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy((o=>{if(r)return e<0?o.from():o.to();let s=Bd(this,o.head,"div");null!=o.goalColumn&&(s.left=o.goalColumn),n.push(s.left);let a=kg(this,s,e,t);return"page"==t&&o==i.sel.primary()&&xp(this,Rd(this,a,"div").top-s.top),a}),Rc),n.length)for(let e=0;e<i.sel.ranges.length;e++)i.sel.ranges[e].goalColumn=n[e]})),findWordAt:function(e){let t=Bu(this.doc,e.line).text,i=e.ch,n=e.ch;if(t){let r=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!i?++n:--i;let o=t.charAt(i),s=Wc(o,r)?e=>Wc(e,r):/\s/.test(o)?e=>/\s/.test(e):e=>!/\s/.test(e)&&!Wc(e);for(;i>0&&s(t.charAt(i-1));)--i;for(;n<t.length&&s(t.charAt(n));)++n}return new df(qu(e.line,i),qu(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Sc(this.display.cursorDiv,"CodeMirror-overwrite"):_c(this.display.cursorDiv,"CodeMirror-overwrite"),su(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==kc()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Vp((function(e,t){wp(this,e,t)})),getScrollInfo:function(){let e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-gd(this)-this.display.barHeight,width:e.scrollWidth-gd(this)-this.display.barWidth,clientHeight:_d(this),clientWidth:yd(this)}},scrollIntoView:Vp((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:qu(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?function(e,t){Tp(e),e.curOp.scrollToPos=t}(this,e):kp(this,e.from,e.to,e.margin)})),setSize:Vp((function(e,t){let i=e=>"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e;null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&Ad(this);let n=this.display.viewFrom;this.doc.iter(n,this.display.viewTo,(e=>{if(e.widgets)for(let t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){ip(this,n,"widget");break}++n})),this.curOp.forceUpdate=!0,su(this,"refresh",this)})),operation:function(e){return Np(this,e)},startOperation:function(){return Pp(this)},endOperation:function(){return Op(this)},refresh:Vp((function(){let e=this.display.cachedTextHeight;tp(this),this.curOp.forceUpdate=!0,zd(this),wp(this,this.doc.scrollLeft,this.doc.scrollTop),Yp(this.display),(null==e||Math.abs(e-Hd(this.display))>.5||this.options.lineWrapping)&&Jd(this),su(this,"refresh",this)})),swapDoc:Vp((function(e){let t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),kf(this,e),zd(this),this.display.input.reset(),wp(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,Jh(this,"swapDoc",this,t),t})),phrase:function(e){let t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},uu(e),e.registerHelper=function(t,n,r){i.hasOwnProperty(t)||(i[t]=e[t]={_global:[]}),i[t][n]=r},e.registerGlobalHelper=function(t,n,r,o){e.registerHelper(t,n,o),i[t]._global.push({pred:r,val:o})}}(dg);let Ig="iter insert remove copy getEditor constructor".split(" ");for(let e in vm.prototype)vm.prototype.hasOwnProperty(e)&&Lc(Ig,e)<0&&(dg.prototype[e]=function(e){return function(){return e.apply(this.doc,arguments)}}(vm.prototype[e]));function Lg(e){let t;return{c(){t=w("div"),A(t,"class",e[0])},m(i,n){v(i,t,n),e[5](t)},p(e,[i]){1&i&&A(t,"class",e[0])},i:i,o:i,d(i){i&&x(t),e[5](null)}}}function Dg(e,t,i){let n,{class:r=""}=t,{editor:o=null}=t,{options:s={}}=t,{value:a}=t;function l(e){window&&n&&(o&&i(1,n.innerHTML="",n),i(2,o=dg(n,{...e,value:a})),o.on("change",(()=>{i(3,a=o.getValue())})))}return $((()=>l(s))),e.$$set=e=>{"class"in e&&i(0,r=e.class),"editor"in e&&i(2,o=e.editor),"options"in e&&i(4,s=e.options),"value"in e&&i(3,a=e.value)},e.$$.update=()=>{if(18&e.$$.dirty&&n&&l(s),12&e.$$.dirty&&o){const e=o.getCursor();o.setValue(a),o.setCursor(e)}20&e.$$.dirty&&o&&Object.entries(s).forEach((([e,t])=>{o.setOption(e,t)}))},[r,n,o,a,s,function(e){G[e?"unshift":"push"]((()=>{n=e,i(1,n)}))}]}uu(vm),dg.inputStyles={textarea:zg,contenteditable:Sg},dg.defineMode=function(e){dg.defaults.mode||"null"==e||(dg.defaults.mode=e),Mu.apply(this,arguments)},dg.defineMIME=function(e,t){Eu[e]=t},dg.defineMode("null",(()=>({token:e=>e.skipToEnd()}))),dg.defineMIME("text/plain","null"),dg.defineExtension=(e,t)=>{dg.prototype[e]=t},dg.defineDocExtension=(e,t)=>{vm.prototype[e]=t},dg.fromTextArea=function(e,t){if((t=t?Ac(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){let i=kc();t.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}function i(){e.value=r.getValue()}let n;if(e.form&&(nu(e.form,"submit",i),!t.leaveSubmitMethodAlone)){let t=e.form;n=t.submit;try{let e=t.submit=()=>{i(),t.submit=n,t.submit(),t.submit=e}}catch(e){}}t.finishInit=r=>{r.save=i,r.getTextArea=()=>e,r.toTextArea=()=>{r.toTextArea=isNaN,i(),e.parentNode.removeChild(r.getWrapperElement()),e.style.display="",e.form&&(ou(e.form,"submit",i),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=n))}},e.style.display="none";let r=dg((t=>e.parentNode.insertBefore(t,e.nextSibling)),t);return r},function(e){e.off=ou,e.on=nu,e.wheelEventPixels=cf,e.Doc=vm,e.splitLines=wu,e.countColumn=zc,e.findColumn=Bc,e.isWordChar=qc,e.Pass=Dc,e.signal=su,e.Line=Bh,e.changeEnd=mf,e.scrollbarModel=Ip,e.Pos=qu,e.cmpPos=Wu,e.modes=Cu,e.mimeModes=Eu,e.resolveMode=Au,e.getMode=zu,e.modeExtensions=Iu,e.extendMode=Lu,e.copyState=Du,e.startState=Ou,e.innerMode=Pu,e.commands=jm,e.keyMap=Mm,e.keyName=Pm,e.isModifierKey=Lm,e.lookupKey=Im,e.normalizeKeyMap=zm,e.StringStream=Ru,e.SharedTextMarker=mm,e.TextMarker=pm,e.LineWidget=um,e.e_preventDefault=hu,e.e_stopPropagation=du,e.e_stop=fu,e.addClass=Sc,e.contains=Tc,e.rmClass=_c,e.keyNames=Em}(dg),dg.version="5.65.5";class Pg extends ve{constructor(e){super(),_e(this,e,Dg,Lg,l,{class:0,editor:2,options:4,value:3})}}function Og(e,t,i){const n=e.slice();return n[13]=t[i],n}function Rg(e){let t,n,r,o,s;return n=new qa({props:{icon:Ra}}),{c(){t=w("button"),me(n.$$.fragment),A(t,"class","trash svelte-1b4qqgs")},m(i,a){v(i,t,a),ge(n,t,null),r=!0,o||(s=E(t,"click",e[5]),o=!0)},p:i,i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(t),ye(n),o=!1,s()}}}function Bg(e){let t,i,n=e[13]+"";return{c(){t=w("div"),i=k(n),A(t,"class","error svelte-1b4qqgs")},m(e,n){v(e,t,n),_(t,i)},p(e,t){8&t&&n!==(n=e[13]+"")&&L(i,n)},d(e){e&&x(t)}}}function Fg(e){let t,i,n,r,o,s,a,l,c,u,h,d;function p(t){e[8](t)}function f(t){e[9](t)}let m={options:e[4],class:"editor"};void 0!==e[2]&&(m.editor=e[2]),void 0!==e[1]&&(m.value=e[1]),n=new Pg({props:m}),G.push((()=>fe(n,"editor",p))),G.push((()=>fe(n,"value",f))),l=new qa({props:{size:"2x",icon:e[3].length?Ba:Da,color:e[3].length?"red":"green"}});let g=0!==e[0]&&Rg(e),y=e[3],T=[];for(let t=0;t<y.length;t+=1)T[t]=Bg(Og(e,y,t));return{c(){t=w("div"),i=w("div"),me(n.$$.fragment),s=S(),a=w("div"),me(l.$$.fragment),u=S(),g&&g.c(),h=S();for(let e=0;e<T.length;e+=1)T[e].c();A(a,"class","icon svelte-1b4qqgs"),A(a,"title",c=e[3].length?"Layer is invalid":"Valid layer"),A(i,"class","container svelte-1b4qqgs")},m(e,r){v(e,t,r),_(t,i),ge(n,i,null),_(i,s),_(i,a),ge(l,a,null),_(i,u),g&&g.m(i,null),_(t,h);for(let e=0;e<T.length;e+=1)T[e].m(t,null);d=!0},p(e,[s]){const u={};!r&&4&s&&(r=!0,u.editor=e[2],J((()=>r=!1))),!o&&2&s&&(o=!0,u.value=e[1],J((()=>o=!1))),n.$set(u);const h={};if(8&s&&(h.icon=e[3].length?Ba:Da),8&s&&(h.color=e[3].length?"red":"green"),l.$set(h),(!d||8&s&&c!==(c=e[3].length?"Layer is invalid":"Valid layer"))&&A(a,"title",c),0!==e[0]?g?(g.p(e,s),1&s&&ae(g,1)):(g=Rg(e),g.c(),ae(g,1),g.m(i,null)):g&&(oe(),le(g,1,1,(()=>{g=null})),se()),8&s){let i;for(y=e[3],i=0;i<y.length;i+=1){const n=Og(e,y,i);T[i]?T[i].p(n,s):(T[i]=Bg(n),T[i].c(),T[i].m(t,null))}for(;i<T.length;i+=1)T[i].d(1);T.length=y.length}},i(e){d||(ae(n.$$.fragment,e),ae(l.$$.fragment,e),ae(g),d=!0)},o(e){le(n.$$.fragment,e),le(l.$$.fragment,e),le(g),d=!1},d(e){e&&x(t),ye(n),ye(l),g&&g.d(),b(T,e)}}}function $g(e,t,i){const n=j();let r,o,s,{routeLineLayer:a}=t,{index:l}=t,c=[];const u=e=>{const t={layout:e.layout||{},paint:e.paint||{}};i(1,r=JSON.stringify(t,null,2))};Ze.subscribe((e=>i(7,s=e)));return e.$$set=e=>{"routeLineLayer"in e&&i(6,a=e.routeLineLayer),"index"in e&&i(0,l=e.index)},e.$$.update=()=>{if(64&e.$$.dirty&&a&&u(a),66&e.$$.dirty){let e=r;try{e={...a,...JSON.parse(r)};const t=(e=>{const t={version:8,sources:{[e.source]:{data:{type:"FeatureCollection",features:[]},type:"geojson"}},layers:[e]};return lr(JSON.stringify(t))})(e);i(3,c=(e=>e.map((e=>{let t=e.message,[i,n]=t.split(":");return i=i.split(".").slice(1).join("."),`${i}: ${n}`})))(t))}catch(e){i(3,c=["JSON is invalid"])}}if(203&e.$$.dirty&&!c.length&&s&&r!==JSON.stringify({layout:a.layout||{},paint:a.paint||{}},null,2)){const e={...a,...JSON.parse(r)};n("setRouteLine",{index:l,layer:e})}76&e.$$.dirty&&o&&o.on("blur",(()=>{c.length&&u(a)}))},[l,r,o,c,{mode:"javascript",lineNumbers:!1,smartIndent:!0},()=>{n("deleteLayer",{index:l})},a,s,function(e){o=e,i(2,o)},function(e){r=e,i(1,r)}]}class jg extends ve{constructor(e){super(),_e(this,e,$g,Fg,l,{routeLineLayer:6,index:0})}}function Ng(e){let t,n,r,o,s,a=e[4].find(e[8])?.text.toLowerCase()+"";return{c(){t=w("button"),n=k("Add a "),r=k(a),A(t,"class","primary-button svelte-1f3nuer")},m(i,a){v(i,t,a),_(t,n),_(t,r),o||(s=E(t,"click",e[6]),o=!0)},p(e,t){1&t&&a!==(a=e[4].find(e[8])?.text.toLowerCase()+"")&&L(r,a)},i:i,o:i,d(e){e&&x(t),o=!1,s()}}}function Ug(e){let t,i;return t=new jg({props:{routeLineLayer:e[1],index:Number(e[0])}}),t.$on("setRouteLine",e[2]),t.$on("deleteLayer",e[3]),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n={};2&i&&(n.routeLineLayer=e[1]),1&i&&(n.index=Number(e[0])),t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Vg(e){let t,i,n,r,o,s,a;n=new as({props:{titleText:"Route line layers",selectedId:e[0],items:e[4]}}),n.$on("select",e[5]);const l=[Ug,Ng],c=[];function u(e,t){return e[1]?0:1}return o=u(e),s=c[o]=l[o](e),{c(){t=w("div"),i=w("div"),me(n.$$.fragment),r=S(),s.c(),A(i,"class","dropdown-container svelte-1f3nuer")},m(e,s){v(e,t,s),_(t,i),ge(n,i,null),_(t,r),c[o].m(t,null),a=!0},p(e,[i]){const r={};1&i&&(r.selectedId=e[0]),n.$set(r);let a=o;o=u(e),o===a?c[o].p(e,i):(oe(),le(c[a],1,1,(()=>{c[a]=null})),se(),s=c[o],s?s.p(e,i):(s=c[o]=l[o](e),s.c()),ae(s,1),s.m(t,null))},i(e){a||(ae(n.$$.fragment,e),ae(s),a=!0)},o(e){le(n.$$.fragment,e),le(s),a=!1},d(e){e&&x(t),ye(n),c[o].d()}}}function Gg(e,t,i){let n,r,o,s="0";Ye.subscribe((e=>{i(7,r=e)})),Ze.subscribe((e=>o=e));return e.$$.update=()=>{129&e.$$.dirty&&s&&i(1,n=r[Number(s)])},[s,n,e=>{const{index:t,layer:i}=e.detail;Ye.update((e=>(e.splice(t,1,i),e)))},e=>{const{index:t}=e.detail;Ye.update((e=>(e.splice(t,1),e)))},[{id:"0",text:"Route line"},{id:"1",text:"Route line casing"}],e=>{i(0,s=e.detail.selectedId)},()=>{Ye.update((e=>{let t=e[e.length-1];return t={...t,id:`route-line-internal-mock-layer_${s}`},e.splice(Number(s),0,t),e})),mr(o)},r,e=>e.id===s]}class qg extends ve{constructor(e){super(),_e(this,e,Gg,Vg,l,{})}}function Wg(e,t,i){const n=e.slice();return n[26]=t[i],n}function Hg(e){let t,i,n,r;i=new as({props:{titleText:"Maneuvers",items:e[5],label:"Select a maneuver",selectedId:e[4]}}),i.$on("select",e[17]);let o=e[3]&&e[4]&&Zg(e);return{c(){t=w("div"),me(i.$$.fragment),n=S(),o&&o.c(),A(t,"class","option add-maneuver svelte-spkgz3")},m(e,s){v(e,t,s),ge(i,t,null),_(t,n),o&&o.m(t,null),r=!0},p(e,n){const r={};32&n&&(r.items=e[5]),16&n&&(r.selectedId=e[4]),i.$set(r),e[3]&&e[4]?o?(o.p(e,n),24&n&&ae(o,1)):(o=Zg(e),o.c(),ae(o,1),o.m(t,null)):o&&(oe(),le(o,1,1,(()=>{o=null})),se())},i(e){r||(ae(i.$$.fragment,e),ae(o),r=!0)},o(e){le(i.$$.fragment,e),le(o),r=!1},d(e){e&&x(t),ye(i),o&&o.d()}}}function Zg(e){let t,i,n,r,o,a,l,c,u,h,d,p,f,m;return i=new Js({props:{size:"sm",label:"pitch",value:e[2].pitch,step:Ne.pitch,min:0,max:85}}),i.$on("change",e[18]),o=new Js({props:{size:"sm",label:"zoom",value:e[2].zoom,step:Ne.zoom,min:0,max:24}}),o.$on("change",e[19]),{c(){t=w("div"),me(i.$$.fragment),n=S(),r=w("div"),me(o.$$.fragment),a=S(),l=w("div"),c=w("button"),u=k("Submit"),d=w("button"),d.textContent="Cancel",A(t,"class","number-input-container svelte-spkgz3"),A(r,"class","number-input-container svelte-spkgz3"),A(c,"class","button svelte-spkgz3"),c.disabled=e[7],A(c,"title",h=e[7]?"Settings must be different from the default":""),A(d,"class","button svelte-spkgz3"),A(l,"class","button-container svelte-spkgz3")},m(s,h){v(s,t,h),ge(i,t,null),v(s,n,h),v(s,r,h),ge(o,r,null),v(s,a,h),v(s,l,h),_(l,c),_(c,u),_(l,d),p=!0,f||(m=[E(c,"click",e[11]),E(d,"click",e[9])],f=!0)},p(e,t){const n={};4&t&&(n.value=e[2].pitch),i.$set(n);const r={};4&t&&(r.value=e[2].zoom),o.$set(r),(!p||128&t)&&(c.disabled=e[7]),(!p||128&t&&h!==(h=e[7]?"Settings must be different from the default":""))&&A(c,"title",h)},i(e){p||(ae(i.$$.fragment,e),ae(o.$$.fragment,e),p=!0)},o(e){le(i.$$.fragment,e),le(o.$$.fragment,e),p=!1},d(e){e&&x(t),ye(i),e&&x(n),e&&x(r),ye(o),e&&x(a),e&&x(l),f=!1,s(m)}}}function Xg(e){let t;return{c(){t=w("div"),t.innerHTML='<div class="message svelte-spkgz3">Configured maneuvers will appear here</div>',A(t,"class","message-container svelte-spkgz3")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function Kg(e){let t,i,n,r,o,a,l,c,u,h,d,p,f,m,g,y,b,T,C,M,z,I,D,P,R,B,F=e[26].name+"",$=(e[26].options.pitch??e[1])+"",j=(e[26].options.zoom??e[0])+"";function N(){return e[20](e[26])}function U(){return e[21](e[26])}return r=new qa({props:{icon:Pa}}),c=new qa({props:{icon:Ra}}),{c(){t=w("div"),i=w("div"),n=w("button"),me(r.$$.fragment),a=S(),l=w("button"),me(c.$$.fragment),h=S(),d=w("div"),p=k(F),f=S(),m=w("div"),g=k("Pitch: "),y=w("span"),b=k($),T=S(),C=w("div"),M=k("Zoom: "),z=w("span"),I=k(j),D=S(),A(n,"class","action-button svelte-spkgz3"),n.disabled=o=e[14](e[6],e[26]),A(l,"class","action-button svelte-spkgz3"),l.disabled=u=e[14](e[6],e[26]),A(i,"class","maneuver-actions svelte-spkgz3"),A(d,"class","bold svelte-spkgz3"),A(y,"class","code svelte-spkgz3"),A(z,"class","code svelte-spkgz3"),A(t,"class","set-maneuver svelte-spkgz3"),O(t,"disabled",e[14](e[6],e[26]))},m(e,o){v(e,t,o),_(t,i),_(i,n),ge(r,n,null),_(i,a),_(i,l),ge(c,l,null),_(t,h),_(t,d),_(d,p),_(t,f),_(t,m),_(m,g),_(m,y),_(y,b),_(t,T),_(t,C),_(C,M),_(C,z),_(z,I),_(t,D),P=!0,R||(B=[E(n,"click",N),E(l,"click",U)],R=!0)},p(i,r){e=i,(!P||64&r&&o!==(o=e[14](e[6],e[26])))&&(n.disabled=o),(!P||64&r&&u!==(u=e[14](e[6],e[26])))&&(l.disabled=u),(!P||64&r)&&F!==(F=e[26].name+"")&&L(p,F),(!P||66&r)&&$!==($=(e[26].options.pitch??e[1])+"")&&L(b,$),(!P||65&r)&&j!==(j=(e[26].options.zoom??e[0])+"")&&L(I,j),16448&r&&O(t,"disabled",e[14](e[6],e[26]))},i(e){P||(ae(r.$$.fragment,e),ae(c.$$.fragment,e),P=!0)},o(e){le(r.$$.fragment,e),le(c.$$.fragment,e),P=!1},d(e){e&&x(t),ye(r),ye(c),R=!1,s(B)}}}function Yg(e){let t,i,n,r,o,s,a,l,c,u,h,d,p,f,m;s=new qa({props:{icon:Oa}});let g=e[3]&&Hg(e),y=!e[6].length&&Xg(),T=e[6],C=[];for(let t=0;t<T.length;t+=1)C[t]=Kg(Wg(e,T,t));const M=e=>le(C[e],1,1,(()=>{C[e]=null}));return{c(){t=w("div"),i=w("div"),n=k("Maneuver options: "),r=w("div"),o=w("button"),me(s.$$.fragment),a=k(" Add a maneuver config"),l=S(),g&&g.c(),c=k("\n  Configured maneuvers:\n  "),u=w("div"),h=w("div"),y&&y.c(),d=S();for(let e=0;e<C.length;e+=1)C[e].c();A(o,"class","button svelte-spkgz3"),o.disabled=e[3],A(i,"class","option svelte-spkgz3"),A(h,"class","scroll-window svelte-spkgz3"),A(u,"class","maneuver-list svelte-spkgz3"),A(t,"class","options svelte-spkgz3")},m(x,b){v(x,t,b),_(t,i),_(i,n),_(i,r),_(r,o),ge(s,o,null),_(o,a),_(t,l),g&&g.m(t,null),_(t,c),_(t,u),_(u,h),y&&y.m(h,null),_(h,d);for(let e=0;e<C.length;e+=1)C[e].m(h,null);p=!0,f||(m=E(o,"click",e[16]),f=!0)},p(e,[i]){if((!p||8&i)&&(o.disabled=e[3]),e[3]?g?(g.p(e,i),8&i&&ae(g,1)):(g=Hg(e),g.c(),ae(g,1),g.m(t,c)):g&&(oe(),le(g,1,1,(()=>{g=null})),se()),e[6].length?y&&(y.d(1),y=null):y||(y=Xg(),y.c(),y.m(h,d)),28739&i){let t;for(T=e[6],t=0;t<T.length;t+=1){const n=Wg(e,T,t);C[t]?(C[t].p(n,i),ae(C[t],1)):(C[t]=Kg(n),C[t].c(),ae(C[t],1),C[t].m(h,null))}for(oe(),t=T.length;t<C.length;t+=1)M(t);se()}},i(e){if(!p){ae(s.$$.fragment,e),ae(g);for(let e=0;e<T.length;e+=1)ae(C[e]);p=!0}},o(e){le(s.$$.fragment,e),le(g),C=C.filter(Boolean);for(let e=0;e<C.length;e+=1)le(C[e]);p=!1},d(e){e&&x(t),ye(s),g&&g.d(),y&&y.d(),b(C,e),f=!1,m()}}}function Jg(e,t,i){const n=j();let r,{maneuverOptions:o}=t,{defaultZoom:s}=t,{defaultPitch:a}=t,l=!1;const c={zoom:s,pitch:a};let u=c,h=[{id:"*",text:"all maneuvers"}];h=h.concat(je.map((e=>({id:e,text:e}))));const d=()=>Object.keys(o).filter((e=>"*"===e||je.includes(e))).sort((e=>"*"===e?-1:1)).map((e=>({id:e,name:h.find((t=>t.id===e)).text,options:o[e]})));let p=d();const f=()=>Object.entries(u).every((e=>{const[t,i]=e;return c[t]===i}));let m=f();const g=e=>{i(4,r=e),i(2,u={...u,...o[r]??{}})},y=()=>{i(2,u=c),i(3,l=!1),i(4,r=void 0)},_=(e,t)=>{const n=`${Ne[e]??.1}`.split(".")[1]?.length??0;i(2,u[e]=Number(t.toFixed(n)),u)},v=e=>{i(3,l=!0),g(e)},x=e=>{const t=o;delete t[e],n("setManeuverOptions",t)};return e.$$set=e=>{"maneuverOptions"in e&&i(15,o=e.maneuverOptions),"defaultZoom"in e&&i(0,s=e.defaultZoom),"defaultPitch"in e&&i(1,a=e.defaultPitch)},e.$$.update=()=>{32768&e.$$.dirty&&o&&i(6,p=d()),4&e.$$.dirty&&u&&i(7,m=f())},[s,a,u,l,r,h,p,m,g,y,_,()=>{if(!m){const e={...o,[r]:u};n("setManeuverOptions",e)}y()},v,x,(e,t)=>e.some((e=>"*"===e.id))&&"*"!==t.id,o,()=>i(3,l=!0),e=>g(e.detail.selectedId),e=>_("pitch",e.detail),e=>_("zoom",e.detail),e=>v(e.id),e=>x(e.id)]}class Qg extends ve{constructor(e){super(),_e(this,e,Jg,Yg,l,{maneuverOptions:15,defaultZoom:0,defaultPitch:1})}}function ey(e,t,i){const n=e.slice();return n[7]=t[i],n}function ty(e){let t,i,n,r;return i=new Js({props:{size:"sm",label:e[3]?.[e[7]]?.label??e[7].charAt(0).toUpperCase()+e[7].slice(1),value:e[1]?.[e[7]],min:e[3]?.[e[7]]?.min??0,max:e[3]?.[e[7]]?.max??1e3,step:Ne?.[e[7]]??1,disabled:e[0]}}),i.$on("change",(function(...t){return e[5](e[7],...t)})),{c(){t=w("div"),me(i.$$.fragment),n=S(),A(t,"class","number-input-container svelte-10niw6b")},m(e,o){v(e,t,o),ge(i,t,null),_(t,n),r=!0},p(t,n){e=t;const r={};2&n&&(r.value=e[1]?.[e[7]]),1&n&&(r.disabled=e[0]),i.$set(r)},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(e){e&&x(t),ye(i)}}}function iy(e){let t,i,n=void 0!==e[1][e[7]]&&ty(e);return{c(){n&&n.c(),t=C()},m(e,r){n&&n.m(e,r),v(e,t,r),i=!0},p(e,i){void 0!==e[1][e[7]]?n?(n.p(e,i),2&i&&ae(n,1)):(n=ty(e),n.c(),ae(n,1),n.m(t.parentNode,t)):n&&(oe(),le(n,1,1,(()=>{n=null})),se())},i(e){i||(ae(n),i=!0)},o(e){le(n),i=!1},d(e){n&&n.d(e),e&&x(t)}}}function ny(e){let t,i,n,r,o=Object.keys(e[3]),s=[];for(let t=0;t<o.length;t+=1)s[t]=iy(ey(e,o,t));const a=e=>le(s[e],1,1,(()=>{s[e]=null}));return{c(){t=w("div"),i=k(e[2]),n=k(":\n  ");for(let e=0;e<s.length;e+=1)s[e].c();A(t,"class","option svelte-10niw6b")},m(e,o){v(e,t,o),_(t,i),_(t,n);for(let e=0;e<s.length;e+=1)s[e].m(t,null);r=!0},p(e,[n]){if((!r||4&n)&&L(i,e[2]),27&n){let i;for(o=Object.keys(e[3]),i=0;i<o.length;i+=1){const r=ey(e,o,i);s[i]?(s[i].p(r,n),ae(s[i],1)):(s[i]=iy(r),s[i].c(),ae(s[i],1),s[i].m(t,null))}for(oe(),i=o.length;i<s.length;i+=1)a(i);se()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)ae(s[e]);r=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)le(s[e]);r=!1},d(e){e&&x(t),b(s,e)}}}function ry(e,t,i){let{disabled:n}=t;const r=j(),o={leadDistance:{label:"Maneuver lead distance",min:0,max:1e3},speed:{label:"Threshold (meters/second)",min:0,max:30},pitch:{min:0,max:85},zoom:{min:0,max:24}};let{routingOptions:s}=t,{title:a}=t;const l=(e,t)=>{r("setProperty",{property:e,value:t})};return e.$$set=e=>{"disabled"in e&&i(0,n=e.disabled),"routingOptions"in e&&i(1,s=e.routingOptions),"title"in e&&i(2,a=e.title)},[n,s,a,o,l,(e,t)=>l(e,t.detail)]}class oy extends ve{constructor(e){super(),_e(this,e,ry,ny,l,{disabled:0,routingOptions:1,title:2})}}function sy(e,t,i){const n=e.slice();return n[21]=t[i],n}function ay(e,t,i){const n=e.slice();return n[24]=t[i],n}function ly(e,t,i){const n=e.slice();return n[21]=t[i],n}function cy(e,t,i){const n=e.slice();return n[21]=t[i],n}function uy(e){let t,i,n,r,o,s,a=e[21]+"",l=e[3][e[21]]+"";return{c(){t=w("div"),i=k(a),n=k(": "),r=w("span"),o=k(l),s=S(),A(r,"class","code svelte-14zv50t"),A(t,"class","indent-1 svelte-14zv50t")},m(e,a){v(e,t,a),_(t,i),_(t,n),_(t,r),_(r,o),_(t,s)},p(e,t){8&t[0]&&a!==(a=e[21]+"")&&L(i,a),8&t[0]&&l!==(l=e[3][e[21]]+"")&&L(o,l)},d(e){e&&x(t)}}}function hy(e){let t,i,n,r=Object.keys(e[4]),o=[];for(let t=0;t<r.length;t+=1)o[t]=dy(ly(e,r,t));return{c(){t=w("div"),i=w("span"),i.textContent="Speed options:",n=S();for(let e=0;e<o.length;e+=1)o[e].c();A(i,"class","bold svelte-14zv50t"),A(t,"class","section svelte-14zv50t")},m(e,r){v(e,t,r),_(t,i),_(t,n);for(let e=0;e<o.length;e+=1)o[e].m(t,null)},p(e,i){if(16&i[0]){let n;for(r=Object.keys(e[4]),n=0;n<r.length;n+=1){const s=ly(e,r,n);o[n]?o[n].p(s,i):(o[n]=dy(s),o[n].c(),o[n].m(t,null))}for(;n<o.length;n+=1)o[n].d(1);o.length=r.length}},d(e){e&&x(t),b(o,e)}}}function dy(e){let t,i,n,r,o,s,a=e[21]+"",l=e[4][e[21]]+"";return{c(){t=w("div"),i=k(a),n=k(": "),r=w("span"),o=k(l),s=S(),A(r,"class","code svelte-14zv50t"),A(t,"class","indent-1 svelte-14zv50t")},m(e,a){v(e,t,a),_(t,i),_(t,n),_(t,r),_(r,o),_(t,s)},p(e,t){16&t[0]&&a!==(a=e[21]+"")&&L(i,a),16&t[0]&&l!==(l=e[4][e[21]]+"")&&L(o,l)},d(e){e&&x(t)}}}function py(e){let t,i,n,r=Object.keys(e[1]),o=[];for(let t=0;t<r.length;t+=1)o[t]=my(sy(e,r,t));return{c(){t=w("div"),i=w("span"),i.textContent="Maneuver options:",n=S();for(let e=0;e<o.length;e+=1)o[e].c();A(i,"class","bold svelte-14zv50t"),A(t,"class","section svelte-14zv50t")},m(e,r){v(e,t,r),_(t,i),_(t,n);for(let e=0;e<o.length;e+=1)o[e].m(t,null)},p(e,i){if(2&i[0]){let n;for(r=Object.keys(e[1]),n=0;n<r.length;n+=1){const s=sy(e,r,n);o[n]?o[n].p(s,i):(o[n]=my(s),o[n].c(),o[n].m(t,null))}for(;n<o.length;n+=1)o[n].d(1);o.length=r.length}},d(e){e&&x(t),b(o,e)}}}function fy(e){let t,i,n,r,o,s=e[24]+"",a=e[1][e[21]][e[24]]+"";return{c(){t=w("div"),i=k(s),n=k(":\n                  "),r=w("span"),o=k(a),A(r,"class","code svelte-14zv50t"),A(t,"class","indent-2 svelte-14zv50t")},m(e,s){v(e,t,s),_(t,i),_(t,n),_(t,r),_(r,o)},p(e,t){2&t[0]&&s!==(s=e[24]+"")&&L(i,s),2&t[0]&&a!==(a=e[1][e[21]][e[24]]+"")&&L(o,a)},d(e){e&&x(t)}}}function my(e){let t,i,n,r,o=e[21]+"",s=Object.keys(e[1][e[21]]),a=[];for(let t=0;t<s.length;t+=1)a[t]=fy(ay(e,s,t));return{c(){t=w("div"),i=k(o),n=k(": ");for(let e=0;e<a.length;e+=1)a[e].c();r=S(),A(t,"class","indent-1 svelte-14zv50t")},m(e,o){v(e,t,o),_(t,i),_(t,n);for(let e=0;e<a.length;e+=1)a[e].m(t,null);_(t,r)},p(e,n){if(2&n[0]&&o!==(o=e[21]+"")&&L(i,o),2&n[0]){let i;for(s=Object.keys(e[1][e[21]]),i=0;i<s.length;i+=1){const o=ay(e,s,i);a[i]?a[i].p(o,n):(a[i]=fy(o),a[i].c(),a[i].m(t,r))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(e){e&&x(t),b(a,e)}}}function gy(e){let t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,b;return o=new na({props:{min:1,max:1e3,value:e[2],labelText:"Duration multiplier"}}),o.$on("change",e[15]),l=new oy({props:{title:"Routing options",routingOptions:e[3]}}),l.$on("setProperty",e[16]),h=new oy({props:{title:"Speed options",routingOptions:{...e[3],...e[4]},disabled:!e[6]}}),h.$on("setProperty",e[17]),f=new La({props:{labelA:"",labelB:"",size:"sm",toggled:e[6]}}),f.$on("toggle",e[18]),y=new Qg({props:{maneuverOptions:e[0]||{},defaultPitch:e[3].pitch,defaultZoom:e[3].zoom}}),y.$on("setManeuverOptions",e[13]),{c(){t=w("div"),i=w("div"),n=w("div"),r=w("div"),me(o.$$.fragment),s=S(),a=w("div"),me(l.$$.fragment),c=S(),u=w("div"),me(h.$$.fragment),d=S(),p=w("div"),me(f.$$.fragment),m=S(),g=w("div"),me(y.$$.fragment),A(r,"class","number-input-container svelte-14zv50t"),A(n,"class","option svelte-14zv50t"),A(a,"class","option svelte-14zv50t"),A(p,"class","toggle-container svelte-14zv50t"),A(u,"class","option svelte-14zv50t"),A(i,"class","options svelte-14zv50t"),A(g,"class","options svelte-14zv50t"),A(t,"class","modal-container svelte-14zv50t")},m(e,x){v(e,t,x),_(t,i),_(i,n),_(n,r),ge(o,r,null),_(i,s),_(i,a),ge(l,a,null),_(i,c),_(i,u),ge(h,u,null),_(u,d),_(u,p),ge(f,p,null),_(t,m),_(t,g),ge(y,g,null),b=!0},p(e,t){const i={};4&t[0]&&(i.value=e[2]),o.$set(i);const n={};8&t[0]&&(n.routingOptions=e[3]),l.$set(n);const r={};24&t[0]&&(r.routingOptions={...e[3],...e[4]}),64&t[0]&&(r.disabled=!e[6]),h.$set(r);const s={};64&t[0]&&(s.toggled=e[6]),f.$set(s);const a={};1&t[0]&&(a.maneuverOptions=e[0]||{}),8&t[0]&&(a.defaultPitch=e[3].pitch),8&t[0]&&(a.defaultZoom=e[3].zoom),y.$set(a)},i(e){b||(ae(o.$$.fragment,e),ae(l.$$.fragment,e),ae(h.$$.fragment,e),ae(f.$$.fragment,e),ae(y.$$.fragment,e),b=!0)},o(e){le(o.$$.fragment,e),le(l.$$.fragment,e),le(h.$$.fragment,e),le(f.$$.fragment,e),le(y.$$.fragment,e),b=!1},d(e){e&&x(t),ye(o),ye(l),ye(h),ye(f),ye(y)}}}function yy(e){let t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,T,C,M,z,I,D=e[4]&&!e[9](e[4]),P=e[1]&&!e[7](e[1]),O=Object.keys(e[3]),R=[];for(let t=0;t<O.length;t+=1)R[t]=uy(cy(e,O,t));let B=D&&hy(e),F=P&&py(e);function $(t){e[19](t)}let j={modalHeading:"Camera behavior",passiveModal:!0,$$slots:{default:[gy]},$$scope:{ctx:e}};return void 0!==e[5]&&(j.open=e[5]),T=new Cs({props:j}),G.push((()=>fe(T,"open",$))),{c(){t=w("div"),i=w("div"),n=w("div"),r=w("div"),o=w("span"),o.textContent="Duration multiplier:",s=S(),a=w("span"),l=k(e[2]),c=S(),u=w("div"),h=w("span"),h.textContent="Routing options:",d=S();for(let e=0;e<R.length;e+=1)R[e].c();p=S(),B&&B.c(),f=S(),F&&F.c(),m=S(),g=w("button"),g.textContent="Adjust camera behavior",y=S(),me(T.$$.fragment),A(o,"class","bold svelte-14zv50t"),A(a,"class","code svelte-14zv50t"),A(r,"class","section svelte-14zv50t"),A(h,"class","bold svelte-14zv50t"),A(u,"class","section svelte-14zv50t"),A(n,"class","window svelte-14zv50t"),A(i,"class","container svelte-14zv50t"),A(g,"class","primary-button svelte-14zv50t")},m(x,b){v(x,t,b),_(t,i),_(i,n),_(n,r),_(r,o),_(r,s),_(r,a),_(a,l),_(n,c),_(n,u),_(u,h),_(u,d);for(let e=0;e<R.length;e+=1)R[e].m(u,null);_(n,p),B&&B.m(n,null),_(n,f),F&&F.m(n,null),_(t,m),_(t,g),v(x,y,b),ge(T,x,b),M=!0,z||(I=E(g,"click",e[14]),z=!0)},p(e,t){if((!M||4&t[0])&&L(l,e[2]),8&t[0]){let i;for(O=Object.keys(e[3]),i=0;i<O.length;i+=1){const n=cy(e,O,i);R[i]?R[i].p(n,t):(R[i]=uy(n),R[i].c(),R[i].m(u,null))}for(;i<R.length;i+=1)R[i].d(1);R.length=O.length}16&t[0]&&(D=e[4]&&!e[9](e[4])),D?B?B.p(e,t):(B=hy(e),B.c(),B.m(n,f)):B&&(B.d(1),B=null),2&t[0]&&(P=e[1]&&!e[7](e[1])),P?F?F.p(e,t):(F=py(e),F.c(),F.m(n,null)):F&&(F.d(1),F=null);const i={};93&t[0]|1&t[1]&&(i.$$scope={dirty:t,ctx:e}),!C&&32&t[0]&&(C=!0,i.open=e[5],J((()=>C=!1))),T.$set(i)},i(e){M||(ae(T.$$.fragment,e),M=!0)},o(e){le(T.$$.fragment,e),M=!1},d(e){e&&x(t),b(R,e),B&&B.d(),F&&F.d(),e&&x(y),ye(T,e),z=!1,I()}}}function _y(e,t,i){let n=1,r={},o={},s={},a={};const l=e=>Se.isObject(e)&&!Object.keys(e).length,c=e=>({speed:17,...e});tt.subscribe((e=>{e.durationMultiplier&&i(2,n=e.durationMultiplier),e.routingOptions&&i(3,r=e.routingOptions),i(4,o=l(e?.speedOptions)?c(r):e?.speedOptions),i(0,s=e?.maneuverOptions)}));let u=!1,h=void 0!==o;const d=({property:e,value:t})=>{const i=`${Ne[e]??.1}`.split(".")[1]?.length??0,n={...r,[e]:Number(t.toFixed(i))};Object.entries(n).every((e=>{const[t,i]=e;return r?.[t]===i}))||tt.update((e=>({...e,routingOptions:n})))},p=e=>Object.entries(e).every((e=>{const[t,i]=e;return c(r)?.[t]===i})),f=({property:e,value:t})=>{const i=`${Ne[e]??.1}`.split(".")[1]?.length??0,n={...o,[e]:Number(t.toFixed(i))},r=Object.entries(n).every((e=>{const[t,i]=e;return o?.[t]===i})),s=p(n);r||tt.update((e=>s?{...e,speedOptions:{}}:{...e,speedOptions:n}))},m=e=>{tt.update((t=>({...t,durationMultiplier:e})))},g=e=>{i(6,h=e),h||(i(4,o=c(r)),tt.update((e=>({...e,speedOptions:{}}))))};return e.$$.update=()=>{3&e.$$.dirty[0]&&(i(1,a=JSON.parse(JSON.stringify(s))),Object.keys(a).includes("*")&&i(1,a={"all maneuvers":a["*"]}))},[s,a,n,r,o,u,h,l,d,p,f,m,g,e=>{let t=e.detail??{};tt.update((e=>({...e,maneuverOptions:t})))},()=>i(5,u=!0),e=>m(e.detail),e=>d(e.detail),e=>f(e.detail),e=>g(e.detail.toggled),function(e){u=e,i(5,u)}]}class vy extends ve{constructor(e){super(),_e(this,e,_y,yy,l,{},null,[-1,-1])}}function xy(e){let t,i,n,r,o,s,a,l,c,u,h,d,p,f,m,g,y,b,T,C,M,z,I,L,D,P,O,R;return s=new La({props:{labelA:"",labelB:"",size:"sm",toggled:e[5]}}),s.$on("toggle",e[10]),h=new Ta({props:{labelText:"Personal access token:",value:e[1],disabled:e[5]}}),h.$on("input",e[11]),f=new Ta({props:{labelText:"File key:",value:e[0],disabled:e[5]}}),f.$on("input",e[12]),y=new Ta({props:{labelText:"puck frame:",helperText:"Icon within frame must be named `puck`",value:e[2],disabled:e[5]}}),y.$on("input",e[13]),C=new Ta({props:{labelText:"destination-pin frame:",helperText:"Icon within frame must be named `destination-pin`",value:e[3],disabled:e[5]}}),C.$on("input",e[14]),{c(){t=w("div"),i=w("div"),n=k("Use default map assets\n      "),r=w("div"),o=w("div"),me(s.$$.fragment),a=S(),l=w("div"),l.textContent="Note: Figma link set via modal is not persisted via url. To persist on\n      refresh, it must be set in the config to protect your private keys.",c=S(),u=w("div"),me(h.$$.fragment),d=S(),p=w("div"),me(f.$$.fragment),m=S(),g=w("div"),me(y.$$.fragment),b=S(),T=w("div"),me(C.$$.fragment),M=S(),z=w("div"),I=w("button"),L=k("Submit"),A(o,"class","toggle-container svelte-e37ji8"),A(r,"class","default-toggle mb12 svelte-e37ji8"),A(i,"class","default-toggle-container svelte-e37ji8"),A(l,"class","mb12 svelte-e37ji8"),A(u,"class","mb12 svelte-e37ji8"),A(p,"class","mb12 svelte-e37ji8"),A(g,"class","mb12 svelte-e37ji8"),A(T,"class","mb12 svelte-e37ji8"),A(I,"class","primary-button svelte-e37ji8"),I.disabled=D=e[5]||e[6],A(z,"class","submit-button-container svelte-e37ji8"),A(t,"class","modal-container svelte-e37ji8")},m(x,w){v(x,t,w),_(t,i),_(i,n),_(i,r),_(r,o),ge(s,o,null),_(t,a),_(t,l),_(t,c),_(t,u),ge(h,u,null),_(t,d),_(t,p),ge(f,p,null),_(t,m),_(t,g),ge(y,g,null),_(t,b),_(t,T),ge(C,T,null),_(t,M),_(t,z),_(z,I),_(I,L),P=!0,O||(R=E(I,"click",e[15]),O=!0)},p(e,t){const i={};32&t&&(i.toggled=e[5]),s.$set(i);const n={};2&t&&(n.value=e[1]),32&t&&(n.disabled=e[5]),h.$set(n);const r={};1&t&&(r.value=e[0]),32&t&&(r.disabled=e[5]),f.$set(r);const o={};4&t&&(o.value=e[2]),32&t&&(o.disabled=e[5]),y.$set(o);const a={};8&t&&(a.value=e[3]),32&t&&(a.disabled=e[5]),C.$set(a),(!P||96&t&&D!==(D=e[5]||e[6]))&&(I.disabled=D)},i(e){P||(ae(s.$$.fragment,e),ae(h.$$.fragment,e),ae(f.$$.fragment,e),ae(y.$$.fragment,e),ae(C.$$.fragment,e),P=!0)},o(e){le(s.$$.fragment,e),le(h.$$.fragment,e),le(f.$$.fragment,e),le(y.$$.fragment,e),le(C.$$.fragment,e),P=!1},d(e){e&&x(t),ye(s),ye(h),ye(f),ye(y),ye(C),O=!1,R()}}}function by(e){let t,i,n,r,o,s,a,l;function c(t){e[16](t)}let u={modalHeading:"Figma link",size:"sm",passiveModal:!0,$$slots:{default:[xy]},$$scope:{ctx:e}};return void 0!==e[4]&&(u.open=e[4]),r=new Cs({props:u}),G.push((()=>fe(r,"open",c))),{c(){t=w("div"),i=w("button"),i.textContent="Figma link",n=S(),me(r.$$.fragment),A(i,"class","primary-button svelte-e37ji8")},m(o,c){v(o,t,c),_(t,i),v(o,n,c),ge(r,o,c),s=!0,a||(l=E(i,"click",e[9]),a=!0)},p(e,[t]){const i={};33554559&t&&(i.$$scope={dirty:t,ctx:e}),!o&&16&t&&(o=!0,i.open=e[4],J((()=>o=!1))),r.$set(i)},i(e){s||(ae(r.$$.fragment,e),s=!0)},o(e){le(r.$$.fragment,e),s=!1},d(e){e&&x(t),e&&x(n),ye(r,e),a=!1,l()}}}function wy(e,t,i){let n,r;Ve.subscribe((e=>({figmaLink:n}=e))),Ze.subscribe((e=>r=e));let o=!1,s=!1,a=n?.fileKey??null,l=n?.personalAccessToken??null,c=n?.puck??null,u=n?.["destination-pin"]??null,h=!1;const d=async e=>{const t=i=>{r.hasImage(e)?(r.removeImage(e),setTimeout((()=>t(i)),150)):i()};return new Promise((e=>t(e)))},p=()=>!!(a&&l&&c&&u),f=async e=>{if(i(5,s=e),s)(async()=>{const e=[{name:"puck",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA4CAYAAABZjWCTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAp9SURBVHgB5Vp7TFTZGf/mDczIQ6QsqIRawYKWKAJKuqvgK6atiXSF2uI7rs1Wk+1WGtFkVeKjWuu2UdvgglLFF9HEbaJ1/7CtxBRfa8362i5oQn3CqsibYV709x3uHYcRhnlcWHb3l5zcO3fu3Lm/8z3P9x2ibzA0NDBQyWPz5s3qqKgo9fjx49V3795VuXxHbucD8hJKPoePapejOiYmRmWz2dTPnj0TN4Ao4bwLpzwcLkNcY6hUqi5SAFryH+6ENC5DKw1NU1OTGu+rlu6h1tZWfnE7vSJlkz6LY1pamvydnQKEz5LjiRU/BPjl4+PjNbW1tbrQ0FBdc3OzISgoSId79J2dnXp8r8vMzAwfO3ZsaEpKyhsOh0PV0NDQXFdX13Ls2LHHVgD3WPEbq9lstgwbNqyzpaXFwkQnT55svX79ujwB4q/JR/hKTrYRIaHhw4fr8X56vFAwPgfrdLrgrVu3Tpk0aVJ2eHj4OKPRmKDVak19Pay9vb0GE1J969atSpC9UlVV9QxE2zUajbmtrc2MWwRR6pairLLkLXwhJ9QPUtBC1XSwGwM+h2AYlyxZMnbBggXz8V0eXmwY+YknT56cu3Llyt8KCwv/DZKtkGY7LnfguZZ79+4xQUHS2+d5S06Vm5urPnnypA7nhhAAsz4MpBJXrFjxLpzGj0hBYPJuVFRU7AZu4GMLRisGS9IG72vHcHjznH7JsSvHYDVkYqx+rGZh+PPlEyZMWOlJ7QIFbPPsoUOH/nzw4MFqk8nUAmfEkpRVVfa4fcJjnGMVLygo0MIR6GEDRlwKX7p0aXJJSckeOJIctVqtpwEECCWmp6fPDA4O/ryysrKBXoUP+ehROH1+ycTglrXwWDr8iQmzFrZ27doMkPuDwWB4gwYZd+7c+XDhwoWlFoulCR9bkpOTO3HN6ikmqjxcV48aNUr/6NEjI8hErFmzJgP2VTyQatgfqqurS+fNm/chThup2xY7IQRbXwTVvVwTzgNHHYgFw2uF5uTkJH3VxBiJiYkrT5069Q5OQ6FMIXBkOhBj0+pVSL3ZHOeAnF0E8UMWLVqUvG7duo8QwyJpCCA6Ojpz5MiRd86dO/cIpmKFdnUhVsp22APu5IQ64gEGiNuEAB2xb9++3yH7GE9DCGPGjEm7efPmJw8fPmwHMfaerpmME+5qyeS09fX1BsQx4+HDh3OR6L5FQwzs0LZt21ao1+vZTIIhPRbSaybmvMDeMSsrSz1ixAh27yGwsYSJEyeuoiEKThy2bNnCEx8C9TQgF+2bXFFRkerChQsaKeENgRP5qdIu/+rVq6QkZsyY8UscjI2NjYYXL15oOOEgF+fitDkQ4y/0yA1NSKuS5s6d+1slvePp06dp9erVNGXKFIJDICWAyY8ZPXr0Z+fPn38AghZwkJdLAk7JSWLVdXR0BE2fPj1TSak9fvyY9u7dS+nz3yMkxQQnQEpBkh6nhZzI93CQghyLE5mIBrGDVTI4KSnpJ6QgmNh3s1bSzFV/ImNcOsFRkVJADp84bdq0KJzq4fy0UowWEExllURqY1q2bFnirFmz1pJCYHUsP3mG3v7gY/E59vtT6cC2X1H29LcIzosCBee3CF0P8T+34eE7EKOdqimzVEdERGh5FY18UrGYJqvjL3b8y3ktLDqefpi/ieDKSSnExcWlwYy4GsDJh0quFgjvAnujly9fanBRi4VhGikEWR2ZkCvS5/+a6swhhOUMKQFUBFLh5XVYvWixWlFLJRBBrgv2Jgo4uEGLGxNIAfCL/7PqBr2Zv7nX73/8fhmVlJUL6QYKyfnpEO+4nuMMBUJyYCtXsFg1YyhA8Asjbeuhju5gaabM+43wnkogPz+f44tcfXNKjiS2QnpKhIDFixdT+sKi19TRHUqqZ2xsLNduVFwXleF0m3CpilR/2c40kQnixb3BzHf+KKQcqHrCnERhSnYmDCc5uFHCsoYCAb8gu322J28R/b2JiqgnQoI4Pn/+nJc+r9QSWTUfHHAyDpS+W8lPsDqyA+lPHd3xJkLDF//7kpBGkb8AObGeQ8xzFo6Et8SKW1xAEO+y2+1+kWN1HJ40m34wayn5A5b2+vXr/U7Nbt++/YSkEjwyLkFOtjPWx1CMKFR9iyMjI6f58Fyhjjk/XyG8o69Sc8U/PnqfksNe0oYNG8hXjBs3bhIOdRhcQOrEcAjJSUM0I1DCe+rDM8VM+6uO7mD1/PiTSp+XRlzExcJVLrs7uOzO14XNIdmUuyqWmpqaT314rvB0gaijKwzGcKGevq4ckF1Vw19wuUGU2+VqmCCHMrksOeuRI0e8njZ2ADzTPONKIS4li2LTc8WkeYv79+9/iuyqE+GApedczwmXKZXMebnDi9PvXLt2rRxJaKqnB7KdsTq+aGwjgymclEZTfS2Vl5dTRkaGx/vYu6Nryz6iHqWHxqdPn3JPQRB0bSBq0XbiJTtXvBbMnj37954eymqD1hUNJNCvI0yyx3tA5u9z5swpQGb1Jd6nFeZmkdVS7qx2Sd0Tbgaa0eSoys7ObvVUZuA/7e+PBwPFxcX7EcLaMUSJz7X67MxQQIwPrLOdFy9erEe+eZyGOLifd+LEifs47SCpveX6vWtpT/aYHCPad+7c+VdMhk9hYbBRWlr6Fxxa4EjMWJPaNm3a1KMw6yQnre/kxns7Yk3d2bNni2iIgpsiR48erUHdpwPmYcGa1K5y6ym7FzJZX5mcBS3blo0bN1588OBBBQ0xsEah27MXpy3o3XVgPWqTAnePfkFvXR4HKs9snGbuhUGP93FjnoYImNiOHTu4Es5Rvg29eSvXK3trY73W5eEJWL58eReae128kwIZiwUp2X8yMzOzA2nmKwGOaWVlZe/t37//M+rOITmmsYfvtUf+muQkte1CYLRDn9m5NCNr+XzXrl2rvkoHw8QOHDjw7u7du6/xOyFgs4fskxjD08pbLj1wJZcrumHo1SWhV1eCJDXgOosv4EnFBBfAg3Pey11Vbvx77KoyPJYVWEXxYw70ohKNYcJqPeLMmTOFMOKf0SCAM/49e/Z8AHL/JcnOqFti8p4U/8gxujftqEQfgbq7rZy1hCLvy+MW10BJkdUQC9BS5K9lWGU3wXvzIppVsc9mozu83mRDUukPAdPQ0NAgS9GEQPp2amrqSqVIMilk+RXbt28/cvnyZV5dt6Ia3mY0Gi2oGDAxeZuGVy/tFSQJcnVag4DJaiqrqhEkjTD2HG6g9Lea6AscbvDylUzq0qVL9dRtVzzkPWByD0Dx7VE97pe2SnEYkUkGSSMYTid+6tSpyQkJCZO5es1FXnepsoNgCfGmNjQNv8CzLhw/frwWmb0ZyzKzRKhTIsUB2i57cfIBftUp5dpgXl6eTJLtkTfj6FFg4h4fE9ZK1/koKtuQsEp6QQdiqA1krCDDGZFVImJBUdWKwGxDImFDcHZuMiU/oMROWWGPCPoaqJYaq4kem0phKxokAaIQhVRJBeIOXOvCNaFmsCcbygR2lBftUEvXnXle2dVgQuyYxazL4YNjpFBXDN4Uw1sYeQShm8RNeiFZqLmYDNdq8dcBrhu2hWq6NOUVKd9/a/F/5g6+kqbMKG8AAAAASUVORK5CYII="},{name:"destination-pin",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAA1CAYAAAAklDnhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANMSURBVHgBtVnBVRsxEB0JHphTnA7sCxgucQcsFSRUgNOBU4GdCkIqYFMBUAGbCuJceHCyqCDcbC7ezMiys+uspJFk//dg7dVI+/U1o5mVBQRg2um04eAgAyEyAXCO1zbe7qwNynKC915LgJ/4reg+PRXcsQXHaNrrdfAhQyHlFV7bwIdCUl+RUO4zdBIhBeTR0ahEEpAGLyErkenZWV8sFrdQlT4deTmff+kq9QocIi+93lUpxHXgMvCAfoRjX6I6ClxEjBK/YJcgMm9vF1VlZI0EOqVZjt1CiL5otb5Vb9WIoDw3EOITGKr4v6j8hWAwPTkZVp69BKoxMEQ4yDEKfjTtE2acEXAmRHvObNalJVoTUb3elNFZlVJedh8fJx47IjQ2hJwwYT2WplPGIgFwwSFBoMHR/rPPTgjxka7SfPvk66BJbIQcg0yOofrdPXDZpyDRRERZfgA38lASa8xmY+PULmQrRfouK1pHiAQ5IqYIryrSfLDvoEJMotX4h8LViH7yTurM6gCq8QKpmM+dDo5+9F76Zov+8wcS0ZTkNp+x2lmVzYjYQiJ0QeUAqa6JoDP9thnpSiwVrZYzGMgPl4pIWViN0JHNhpeCgbN1NitWUXPnsuNs1TbojA5w5TApyIc0EeOwymGcTY+PvbuvBWNXI7rFPV3XZQBlU1cHsbd3Q0UTBAArvZFHDfKPuxoR8NUT6CsYZg/VGsIGihJ1enpbetSA5SuH0nyqd7EUeMBLBn7oqhydfLLKxjpEMTpwZucY8kNOvUvZeVXZ79cahLjHWWfgR0cXUYsFkd8cnNQDJorVh1qpiGGUMzLltlDL6DUirEy5JWxmdNlgk8PuUWzmuP+IGIMCdoimrUJaDKMLIQZU0ztwIxHzmlDADmCbpAztkAhlOxGwEtmFKq7JydiOEVCu8xEnkW2q4puUkwhnACaU7/jKS2QbqnAm4yXCHcgBrxpsIimqcCfBIhIy4AZYagQRiVElhDybSOjAEKBGMJEQVUKXMohIwAOC1IgiQqr4Xj04R1bJRAzGjragXyWSiFAVZzsbi1EjmohG89lY9FlbNJGmij8lFcQrQpjPryuqxJ88phKpqpJaLuxDKlCV8vCw3X1+VpCAvyZEloGR0vYXAAAAAElFTkSuQmCC"}];for(const t of e)await d(t.name),r.loadImage(t.path,((e,i)=>{e?console.error(e):(r.addImage(t.name,i),Xe.update((e=>({...e,[t.name]:{name:t.name,url:t.path,width:i.width,height:i.height}}))))}))})();else{for(const e of Oe)await d(e);p&&g()}},m=()=>({"destination-pin":u,puck:c,fileKey:a,personalAccessToken:l,scale:1}),g=()=>{if(!p())return;const e=m();Ve.update((t=>({...t,figmaLink:e}))),K(),Qe.set({loading:!0,helperText:"Loading assets"}),pt(r).then((e=>{Xe.update((t=>Object.keys(t).reduce(((t,i)=>(t[i]=e.find((e=>e.name===i))??null,t)),{}))),Qe.set({loading:!1})})).catch((e=>{Qe.set({loading:!1}),console.error(e)}))};return e.$$.update=()=>{15&e.$$.dirty&&a&&l&&c&&u&&i(6,h=!(()=>{const e=m();return Object.entries(e).some((e=>{const[t,i]=e;return n?.[t]!==i}))})())},[a,l,c,u,o,s,h,f,g,()=>i(4,o=!0),e=>f(e.detail.toggled),e=>i(1,l=e.detail),e=>i(0,a=e.detail),e=>i(2,c=e.detail),e=>i(3,u=e.detail),()=>{g(),i(4,o=!1)},function(e){o=e,i(4,o)}]}class Ty extends ve{constructor(e){super(),_e(this,e,wy,by,l,{})}}function ky(e){let t,i,n,r,o,s;return i=new Dl({props:{setRouteFlag:e[1],routeFlag:e[0]}}),o=new Vl({props:{setRouteFlag:e[1],routeFlag:e[0]}}),{c(){t=w("div"),me(i.$$.fragment),n=S(),r=w("div"),me(o.$$.fragment),A(t,"class","control svelte-z0209z"),A(r,"class","control mt24 svelte-z0209z")},m(e,a){v(e,t,a),ge(i,t,null),v(e,n,a),v(e,r,a),ge(o,r,null),s=!0},p(e,t){const n={};2&t&&(n.setRouteFlag=e[1]),1&t&&(n.routeFlag=e[0]),i.$set(n);const r={};2&t&&(r.setRouteFlag=e[1]),1&t&&(r.routeFlag=e[0]),o.$set(r)},i(e){s||(ae(i.$$.fragment,e),ae(o.$$.fragment,e),s=!0)},o(e){le(i.$$.fragment,e),le(o.$$.fragment,e),s=!1},d(e){e&&x(t),ye(i),e&&x(n),e&&x(r),ye(o)}}}function Sy(e){let t,n,r;return n=new qg({}),{c(){t=w("div"),me(n.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(n,t,null),r=!0},p:i,i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(t),ye(n)}}}function Cy(e){let t,n,r;return n=new vy({}),{c(){t=w("div"),me(n.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(n,t,null),r=!0},p:i,i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(t),ye(n)}}}function Ey(e){let t,n,r;return n=new Ty({}),{c(){t=w("div"),me(n.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(n,t,null),r=!0},p:i,i(e){r||(ae(n.$$.fragment,e),r=!0)},o(e){le(n.$$.fragment,e),r=!1},d(e){e&&x(t),ye(n)}}}function My(e){let t,i,n,r,o,s,a,l;return t=new Kr({props:{title:"Route:",open:!0,$$slots:{default:[ky]},$$scope:{ctx:e}}}),n=new Kr({props:{title:"Route-line:",open:!0,$$slots:{default:[Sy]},$$scope:{ctx:e}}}),o=new Kr({props:{title:"Camera behavior:",open:!0,$$slots:{default:[Cy]},$$scope:{ctx:e}}}),a=new Kr({props:{title:"Map assets:",open:!0,$$slots:{default:[Ey]},$$scope:{ctx:e}}}),{c(){me(t.$$.fragment),i=S(),me(n.$$.fragment),r=S(),me(o.$$.fragment),s=S(),me(a.$$.fragment)},m(e,c){ge(t,e,c),v(e,i,c),ge(n,e,c),v(e,r,c),ge(o,e,c),v(e,s,c),ge(a,e,c),l=!0},p(e,i){const r={};7&i&&(r.$$scope={dirty:i,ctx:e}),t.$set(r);const s={};4&i&&(s.$$scope={dirty:i,ctx:e}),n.$set(s);const l={};4&i&&(l.$$scope={dirty:i,ctx:e}),o.$set(l);const c={};4&i&&(c.$$scope={dirty:i,ctx:e}),a.$set(c)},i(e){l||(ae(t.$$.fragment,e),ae(n.$$.fragment,e),ae(o.$$.fragment,e),ae(a.$$.fragment,e),l=!0)},o(e){le(t.$$.fragment,e),le(n.$$.fragment,e),le(o.$$.fragment,e),le(a.$$.fragment,e),l=!1},d(e){ye(t,e),e&&x(i),ye(n,e),e&&x(r),ye(o,e),e&&x(s),ye(a,e)}}}function Ay(e){let t,i,n;return i=new qr({props:{$$slots:{default:[My]},$$scope:{ctx:e}}}),{c(){t=w("div"),me(i.$$.fragment),A(t,"class","panel svelte-z0209z")},m(e,r){v(e,t,r),ge(i,t,null),n=!0},p(e,[t]){const n={};7&t&&(n.$$scope={dirty:t,ctx:e}),i.$set(n)},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(e){e&&x(t),ye(i)}}}function zy(e,t,i){let{routeFlag:n}=t,{setRouteFlag:r}=t;return e.$$set=e=>{"routeFlag"in e&&i(0,n=e.routeFlag),"setRouteFlag"in e&&i(1,r=e.setRouteFlag)},[n,r]}class Iy extends ve{constructor(e){super(),_e(this,e,zy,Ay,l,{routeFlag:0,setRouteFlag:1})}}let Ly;Ve.subscribe((e=>({mapboxGlAccessToken:Ly}=e)));function Dy(e){let t,i,n,r,o,s,a,l,c,u,h;return i=new Ta({props:{placeholder:"Enter height...",value:e[3]??""}}),i.$on("input",e[15]),r=new Ta({props:{placeholder:"Enter width...",value:e[2]??""}}),r.$on("input",e[16]),{c(){t=w("div"),me(i.$$.fragment),n=S(),me(r.$$.fragment),o=S(),s=w("button"),a=k("Submit"),A(s,"class","submit-button svelte-k7mtpz"),s.disabled=l=!e[2]||!e[3],A(t,"class","custom-url-container svelte-k7mtpz")},m(l,d){v(l,t,d),ge(i,t,null),_(t,n),ge(r,t,null),_(t,o),_(t,s),_(s,a),c=!0,u||(h=E(s,"click",e[12]),u=!0)},p(e,t){const n={};8&t&&(n.value=e[3]??""),i.$set(n);const o={};4&t&&(o.value=e[2]??""),r.$set(o),(!c||12&t&&l!==(l=!e[2]||!e[3]))&&(s.disabled=l)},i(e){c||(ae(i.$$.fragment,e),ae(r.$$.fragment,e),c=!0)},o(e){le(i.$$.fragment,e),le(r.$$.fragment,e),c=!1},d(e){e&&x(t),ye(i),ye(r),u=!1,h()}}}function Py(e){let t,i,n,r,o,s,a,l,c,u;n=new Ta({props:{placeholder:"Enter map style url...",disabled:e[0],value:e[4]}}),n.$on("input",e[17]),n.$on("focus",e[18]);let h=e[5]&&Oy();return{c(){t=w("div"),i=w("div"),me(n.$$.fragment),r=S(),o=w("button"),o.textContent="Submit",s=S(),h&&h.c(),a=C(),A(o,"class","submit-button svelte-k7mtpz"),A(t,"class","custom-url-container svelte-k7mtpz")},m(d,p){v(d,t,p),_(t,i),ge(n,i,null),_(t,r),_(t,o),v(d,s,p),h&&h.m(d,p),v(d,a,p),l=!0,c||(u=E(o,"click",e[9]),c=!0)},p(e,t){const i={};1&t&&(i.disabled=e[0]),16&t&&(i.value=e[4]),n.$set(i),e[5]?h||(h=Oy(),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i(e){l||(ae(n.$$.fragment,e),l=!0)},o(e){le(n.$$.fragment,e),l=!1},d(e){e&&x(t),ye(n),e&&x(s),h&&h.d(e),e&&x(a),c=!1,u()}}}function Oy(e){let t;return{c(){t=w("div"),t.textContent="Style not found",A(t,"class","error svelte-k7mtpz")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function Ry(e){let t,i,n,r,o,s,a,l,c,u;r=new as({props:{titleText:"Devices",selectedId:e[1],items:e[7],disabled:e[0]}}),r.$on("select",e[11]);let h="custom"===e[1]&&Dy(e);l=new as({props:{titleText:"Map styles",selectedId:e[6],items:e[8],disabled:e[0]}}),l.$on("select",e[10]);let d="custom"===e[6]&&Py(e);return{c(){t=w("div"),i=w("div"),n=w("div"),me(r.$$.fragment),o=S(),h&&h.c(),s=S(),a=w("div"),me(l.$$.fragment),c=S(),d&&d.c(),A(n,"class","dropdown svelte-k7mtpz"),A(a,"class","dropdown svelte-k7mtpz"),A(i,"class","dropdown-container svelte-k7mtpz"),A(t,"class","panel svelte-k7mtpz")},m(e,p){v(e,t,p),_(t,i),_(i,n),ge(r,n,null),_(i,o),h&&h.m(i,null),_(i,s),_(i,a),ge(l,a,null),_(i,c),d&&d.m(i,null),u=!0},p(e,[t]){const n={};2&t&&(n.selectedId=e[1]),1&t&&(n.disabled=e[0]),r.$set(n),"custom"===e[1]?h?(h.p(e,t),2&t&&ae(h,1)):(h=Dy(e),h.c(),ae(h,1),h.m(i,s)):h&&(oe(),le(h,1,1,(()=>{h=null})),se());const o={};64&t&&(o.selectedId=e[6]),1&t&&(o.disabled=e[0]),l.$set(o),"custom"===e[6]?d?(d.p(e,t),64&t&&ae(d,1)):(d=Py(e),d.c(),ae(d,1),d.m(i,null)):d&&(oe(),le(d,1,1,(()=>{d=null})),se())},i(e){u||(ae(r.$$.fragment,e),ae(h),ae(l.$$.fragment,e),ae(d),u=!0)},o(e){le(r.$$.fragment,e),le(h),le(l.$$.fragment,e),le(d),u=!1},d(e){e&&x(t),ye(r),h&&h.d(),ye(l),d&&d.d()}}}function By(e,t,i){let n,r,{routeFlag:o}=t;Ve.subscribe((e=>{({devices:n}=e),({styles:r}=e)}));let s=n[0].width,a=n[0].height,l=n[0]?.id??"custom",c=null,u=null;Je.subscribe((e=>{e&&(s=e.width,a=e.height,i(1,l=e.id),"custom"===l&&(i(2,c=s),i(3,u=a)))}));let h,d="",p="";const f=n.map((e=>({id:e.id,text:e.name}))).concat([{id:"custom",text:"Responsive"}]),m=r.map((e=>({id:e.id,text:e.name}))).concat([{id:"custom",text:"Custom URL"}]);let g,y=m?.[0]?.id;const _=async e=>{if(!e)return;let t=e;if(e.includes("localhost")){const[e,i]=t.split("localhost");e||(t=`http://localhost${i}`)}try{const e=await(async e=>{const t=(e=>"string"==typeof e&&e.startsWith("mapbox://styles/")&&5===e.split("/").length)(e);let i=e;if(t){const[,,,e,t]=i.split("/");i=`https://api.mapbox.com/styles/v1/${e}/${t}?title=true&access_token=${Ly}`}const n=await fetch(i),r=await n.json();if(t&&r.message)throw new Error(r.message);return r})(t);if(e&&"object"==typeof e)return i(14,g.url=e,g),i(13,p=t),x(t),{status:"200",url:t}}catch(e){return i(5,h=new Error("Style was not found.")),{status:"404",url:t}}},v=async()=>{const e=await _(d),{status:t,url:n}=e;if("200"===t){i(14,g={id:"custom",name:"Custom",type:"mapbox-gl",url:n})}};Ke.subscribe((e=>{if(g)return;i(14,g=e||r[0]);const t=g?.id??"custom";i(6,y=t),"custom"===t&&(i(4,d=e?.url),v())}));const x=e=>{const t=e=>e&&e.includes("localhost")&&p===e;t(e)&&setTimeout((()=>t(e)&&_(e)),3e3)};return e.$$set=e=>{"routeFlag"in e&&i(0,o=e.routeFlag)},e.$$.update=()=>{if(24576&e.$$.dirty&&g?.url){const e="string"==typeof g?.url?g.url:p;Ke.set({...g,url:e})}},[o,l,c,u,d,h,y,f,m,v,e=>{const{selectedId:t}=e.detail;if(i(6,y=t),"custom"===t)return i(4,d=g.url),void i(5,h="");i(4,d=""),i(13,p=""),i(5,h="");const n=r.find((e=>e.id===t));i(14,g=n)},e=>{const{selectedId:t}=e.detail;if(i(1,l=t),"custom"===t)return i(2,c=s),void i(3,u=a);i(2,c=null),i(3,u=null);const r=n.find((e=>e.id===t));s=r.width,a=r.height,Je.set(r)},()=>{const e={id:"custom",width:Number(c),height:Number(u)};s=e.width,a=e.height,Je.set(e)},p,g,e=>i(3,u=e.detail),e=>i(2,c=e.detail),e=>i(4,d=e.detail),()=>i(5,h="")]}class Fy extends ve{constructor(e){super(),_e(this,e,By,Ry,l,{routeFlag:0})}}function $y(e){let t;return{c(){t=w("div"),A(t,"class","circle svelte-14upwad"),P(t,"--size",e[3]+e[1]),P(t,"--color",e[0]),P(t,"--duration",e[2])},m(e,i){v(e,t,i)},p(e,[i]){10&i&&P(t,"--size",e[3]+e[1]),1&i&&P(t,"--color",e[0]),4&i&&P(t,"--duration",e[2])},i:i,o:i,d(e){e&&x(t)}}}function jy(e,t,i){let{color:n="#FF3E00"}=t,{unit:r="px"}=t,{duration:o="0.75s"}=t,{size:s="60"}=t;return e.$$set=e=>{"color"in e&&i(0,n=e.color),"unit"in e&&i(1,r=e.unit),"duration"in e&&i(2,o=e.duration),"size"in e&&i(3,s=e.size)},[n,r,o,s]}class Ny extends ve{constructor(e){super(),_e(this,e,jy,$y,l,{color:0,unit:1,duration:2,size:3})}}function Uy(e){let t,i,n,r,o,s,a;return n=new Ny({props:{size:"100",color:"white",unit:"px"}}),{c(){t=w("div"),i=w("div"),me(n.$$.fragment),r=S(),o=w("div"),s=k(e[0]),A(o,"class","text svelte-17kqyn2"),A(i,"class","container svelte-17kqyn2"),A(t,"class","loader svelte-17kqyn2")},m(e,l){v(e,t,l),_(t,i),ge(n,i,null),_(i,r),_(i,o),_(o,s),a=!0},p(e,[t]){(!a||1&t)&&L(s,e[0])},i(e){a||(ae(n.$$.fragment,e),a=!0)},o(e){le(n.$$.fragment,e),a=!1},d(e){e&&x(t),ye(n)}}}function Vy(e,t,i){let{helperText:n}=t;return e.$$set=e=>{"helperText"in e&&i(0,n=e.helperText)},[n]}class Gy extends ve{constructor(e){super(),_e(this,e,Vy,Uy,l,{helperText:0})}}function qy(e){let t,i;return t=new Gy({props:{helperText:e[0].helperText||null}}),{c(){me(t.$$.fragment)},m(e,n){ge(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.helperText=e[0].helperText||null),t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Wy(e){let t,i,n,r,o,s,a,l,c,u;r=new Iy({props:{setRouteFlag:e[2],routeFlag:e[1]}}),s=new wr({props:{routeFlag:e[1]}}),l=new Fy({props:{routeFlag:e[1]}});let h=e[0].loading&&qy(e);return{c(){t=w("base"),i=S(),n=w("main"),me(r.$$.fragment),o=S(),me(s.$$.fragment),a=S(),me(l.$$.fragment),c=S(),h&&h.c(),A(t,"href","/"),A(n,"class","svelte-2y1l8u")},m(e,d){_(document.head,t),v(e,i,d),v(e,n,d),ge(r,n,null),_(n,o),ge(s,n,null),_(n,a),ge(l,n,null),_(n,c),h&&h.m(n,null),u=!0},p(e,[t]){const i={};2&t&&(i.routeFlag=e[1]),r.$set(i);const o={};2&t&&(o.routeFlag=e[1]),s.$set(o);const a={};2&t&&(a.routeFlag=e[1]),l.$set(a),e[0].loading?h?(h.p(e,t),1&t&&ae(h,1)):(h=qy(e),h.c(),ae(h,1),h.m(n,null)):h&&(oe(),le(h,1,1,(()=>{h=null})),se())},i(e){u||(ae(r.$$.fragment,e),ae(s.$$.fragment,e),ae(l.$$.fragment,e),ae(h),u=!0)},o(e){le(r.$$.fragment,e),le(s.$$.fragment,e),le(l.$$.fragment,e),le(h),u=!1},d(e){x(t),e&&x(i),e&&x(n),ye(r),ye(s),ye(l),h&&h.d()}}}function Hy(e,t,i){let{localConfig:n}=t;const r=(e=>{const t={leadDistance:125,pitch:60,zoom:16,...e?.routingOptions||{}};let i=JSON.parse(JSON.stringify(e));return i?.routingOptions&&delete i.routingOptions,e.directionsApiCall&&(i={...i,directionsApiCall:e.directionsApiCall}),{devices:[{id:"google-pixel",name:"Google Pixel",height:732,width:412},{id:"iphone-13",name:"iPhone 13",height:844,width:390}],styles:[{id:"mapbox-streets",name:"Mapbox Streets",type:"mapbox-gl",url:"mapbox://styles/mapbox/streets-v11"},{id:"mapbox-outdoors",name:"Mapbox Outdoors",type:"mapbox-gl",url:"mapbox://styles/mapbox/outdoors-v11"},{id:"mapbox-light",name:"Mapbox Light",type:"mapbox-gl",url:"mapbox://styles/mapbox/light-v10"},{id:"mapbox-dark",name:"Mapbox Dark",type:"mapbox-gl",url:"mapbox://styles/mapbox/dark-v10"}],mapState:{bearing:0,center:{lng:-73.92169,lat:40.83962},pitch:0,zoom:13.25},durationMultiplier:50,routingOptions:t,...i}})(n);Ve.set(r);let o,s=null,a=null,l=null,c=null,u=!0;tt.subscribe((e=>{if(i(4,s=null),i(5,a=null),i(6,l=null),i(7,c=null),u){u=!1;const t=Se.cloneDeep({durationMultiplier:r.durationMultiplier??{},routingOptions:r.routingOptions??{},speedOptions:r.speedOptions??{},maneuverOptions:r.maneuverOptions??{}});let i=Se.assign(t,e);tt.set(i)}else{const t=e=>Se.isObject(e)&&!Object.keys(e).length;if(e.durationMultiplier!==r.durationMultiplier&&i(4,s=e.durationMultiplier??null),Se.isEqual(e?.routingOptions,r.routingOptions)||i(5,a=e.routingOptions),!Se.isEqual(e?.speedOptions,r.speedOptions)){const n=t(e.speedOptions)&&!r.speedOptions;i(6,l=n?null:e.speedOptions)}if(!Se.isEqual(e?.maneuverOptions,r.maneuverOptions)){const n=t(e.maneuverOptions)&&!r.maneuverOptions;i(7,c=n?null:e.maneuverOptions)}}})),He.subscribe((e=>{e&&Object.keys(e).length?i(8,o=e):He.set(r.mapState)}));let h=null;qe.subscribe((e=>{const{locations:t}=e;i(9,h=t&&t.every((e=>null!==e.center))?t:null)}));let d=null;Ye.subscribe((e=>{const t=e.map((e=>({layout:e.layout,paint:e.paint}))),n=e.map((()=>$e));JSON.stringify(n)!==JSON.stringify(t)?i(10,d=t):i(10,d=null)}));let p=null;Ke.subscribe((e=>{i(11,p=e||null)}));let f=null;Je.subscribe((e=>{i(12,f=e??null)}));let m,g={loading:!1};Qe.subscribe((e=>i(0,g=e))),Ze.subscribe((e=>m=e));let y=!1;return e.$$set=e=>{"localConfig"in e&&i(3,n=e.localConfig)},e.$$.update=()=>{8176&e.$$.dirty&&(o||h||d||p||f||s||a||l||c)&&Ie({locations:h,routeLines:d,styleUrl:p,deviceSize:f,durationMultiplier:s,routingOptions:a,speedOptions:l,maneuverOptions:c,...o})},[g,y,e=>{i(1,y=e),m&&!y&&m.once("move",(()=>{m.getLayer("destination-pin")&&fr(m,"destination-pin"),m.getLayer(Pe)&&fr(m,Pe)}))},n,s,a,l,c,o,h,d,p,f]}class Zy extends ve{constructor(e){super(),_e(this,e,Hy,Wy,l,{localConfig:3})}}const Xy=(e,t)=>new Zy({target:e,props:t});var Ky=Object.freeze({__proto__:null});export{Xy as startApp};
//# sourceMappingURL=bundle.js.map
