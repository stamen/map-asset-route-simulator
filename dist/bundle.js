import e from"https://unpkg.com/mp4-h264@1.0.7/build/mp4-encoder.js";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}function i(){}function r(e,t){for(const i in t)e[i]=t[i];return e}function n(e){return e()}function o(){return Object.create(null)}function s(e){e.forEach(n)}function a(e){return"function"==typeof e}function l(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t,i,r){if(e){const n=u(e,t,i,r);return e[0](n)}}function u(e,t,i,n){return e[1]&&n?r(i.ctx.slice(),e[1](n(t))):i.ctx}function h(e,t,i,r){if(e[2]&&r){const n=e[2](r(i));if(void 0===t.dirty)return n;if("object"==typeof n){const e=[],i=Math.max(t.dirty.length,n.length);for(let r=0;r<i;r+=1)e[r]=t.dirty[r]|n[r];return e}return t.dirty|n}return t.dirty}function d(e,t,i,r,n,o){if(n){const s=u(t,i,r,o);e.p(s,n)}}function p(e){if(e.ctx.length>32){const t=[],i=e.ctx.length/32;for(let e=0;e<i;e++)t[e]=-1;return t}return-1}function f(e){const t={};for(const i in e)"$"!==i[0]&&(t[i]=e[i]);return t}function m(e,t){const i={};t=new Set(t);for(const r in e)t.has(r)||"$"===r[0]||(i[r]=e[r]);return i}function g(e){const t={};for(const i in e)t[i]=!0;return t}function y(e){return null==e?"":e}function _(e,t){e.appendChild(t)}function v(e,t,i){e.insertBefore(t,i||null)}function x(e){e.parentNode.removeChild(e)}function b(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function w(e){return document.createElement(e)}function T(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function S(e){return document.createTextNode(e)}function C(){return S(" ")}function M(){return S("")}function k(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function E(e){return function(t){return t.preventDefault(),e.call(this,t)}}function A(e,t,i){null==i?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function I(e,t){const i=Object.getOwnPropertyDescriptors(e.__proto__);for(const r in t)null==t[r]?e.removeAttribute(r):"style"===r?e.style.cssText=t[r]:"__value"===r?e.value=e[r]=t[r]:i[r]&&i[r].set?e[r]=t[r]:A(e,r,t[r])}function z(e,t){for(const i in t)A(e,i,t[i])}function P(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function L(e,t){e.value=null==t?"":t}function D(e,t,i,r){null===i?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}function R(e,t,i){e.classList[i?"add":"remove"](t)}let B;function O(e){B=e}function F(){if(!B)throw new Error("Function called outside component initialization");return B}function j(e){F().$$.on_mount.push(e)}function $(){const e=F();return(t,i,{cancelable:r=!1}={})=>{const n=e.$$.callbacks[t];if(n){const o=function(e,t,{bubbles:i=!1,cancelable:r=!1}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i,r,t),n}(t,i,{cancelable:r});return n.slice().forEach((t=>{t.call(e,o)})),!o.defaultPrevented}return!0}}function N(e){return F().$$.context.get(e)}function U(e,t){const i=e.$$.callbacks[t.type];i&&i.slice().forEach((e=>e.call(this,t)))}const V=[],G=[],q=[],Z=[],W=Promise.resolve();let H=!1;function X(){H||(H=!0,W.then(te))}function K(){return X(),W}function Y(e){q.push(e)}function J(e){Z.push(e)}const Q=new Set;let ee=0;function te(){const e=B;do{for(;ee<V.length;){const e=V[ee];ee++,O(e),ie(e.$$)}for(O(null),V.length=0,ee=0;G.length;)G.pop()();for(let e=0;e<q.length;e+=1){const t=q[e];Q.has(t)||(Q.add(t),t())}q.length=0}while(V.length);for(;Z.length;)Z.pop()();H=!1,Q.clear(),O(e)}function ie(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}const re=new Set;let ne;function oe(){ne={r:0,c:[],p:ne}}function se(){ne.r||s(ne.c),ne=ne.p}function ae(e,t){e&&e.i&&(re.delete(e),e.i(t))}function le(e,t,i,r){if(e&&e.o){if(re.has(e))return;re.add(e),ne.c.push((()=>{re.delete(e),r&&(i&&e.d(1),r())})),e.o(t)}}const ce="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ue(e,t){le(e,1,1,(()=>{t.delete(e.key)}))}function he(e,t,i,r,n,o,s,a,l,c,u,h){let d=e.length,p=o.length,f=d;const m={};for(;f--;)m[e[f].key]=f;const g=[],y=new Map,_=new Map;for(f=p;f--;){const e=h(n,o,f),a=i(e);let l=s.get(a);l?r&&l.p(e,t):(l=c(a,e),l.c()),y.set(a,g[f]=l),a in m&&_.set(a,Math.abs(f-m[a]))}const v=new Set,x=new Set;function b(e){ae(e,1),e.m(a,u),s.set(e.key,e),u=e.first,p--}for(;d&&p;){const t=g[p-1],i=e[d-1],r=t.key,n=i.key;t===i?(u=t.first,d--,p--):y.has(n)?!s.has(r)||v.has(r)?b(t):x.has(n)?d--:_.get(r)>_.get(n)?(x.add(r),b(t)):(v.add(n),d--):(l(i,s),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,s)}for(;p;)b(g[p-1]);return g}function de(e,t){const i={},r={},n={$$scope:1};let o=e.length;for(;o--;){const s=e[o],a=t[o];if(a){for(const e in s)e in a||(r[e]=1);for(const e in a)n[e]||(i[e]=a[e],n[e]=1);e[o]=a}else for(const e in s)n[e]=1}for(const e in r)e in i||(i[e]=void 0);return i}function pe(e){return"object"==typeof e&&null!==e?e:{}}function fe(e,t,i){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=i,i(e.$$.ctx[r]))}function me(e){e&&e.c()}function ge(e,t,i,r){const{fragment:o,on_mount:l,on_destroy:c,after_update:u}=e.$$;o&&o.m(t,i),r||Y((()=>{const t=l.map(n).filter(a);c?c.push(...t):s(t),e.$$.on_mount=[]})),u.forEach(Y)}function ye(e,t){const i=e.$$;null!==i.fragment&&(s(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function _e(e,t,r,n,a,l,c,u=[-1]){const h=B;O(e);const d=e.$$={fragment:null,ctx:null,props:l,update:i,not_equal:a,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:o(),dirty:u,skip_bound:!1,root:t.target||h.$$.root};c&&c(d.root);let p=!1;if(d.ctx=r?r(e,t.props||{},((t,i,...r)=>{const n=r.length?r[0]:i;return d.ctx&&a(d.ctx[t],d.ctx[t]=n)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](n),p&&function(e,t){-1===e.$$.dirty[0]&&(V.push(e),X(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,t)),i})):[],d.update(),p=!0,s(d.before_update),d.fragment=!!n&&n(d.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);d.fragment&&d.fragment.l(e),e.forEach(x)}else d.fragment&&d.fragment.c();t.intro&&ae(e.$$.fragment),ge(e,t.target,t.anchor,t.customElement),te()}O(h)}class ve{$destroy(){ye(this,1),this.$destroy=i}$on(e,t){const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function be(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function we(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Te,Se,Ce={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Te=Ce,Se=Ce.exports,function(){var e,t="Expected a function",i="__lodash_hash_undefined__",r="__lodash_placeholder__",n=16,o=32,s=64,a=128,l=256,c=1/0,u=9007199254740991,h=NaN,d=4294967295,p=[["ary",a],["bind",1],["bindKey",2],["curry",8],["curryRight",n],["flip",512],["partial",o],["partialRight",s],["rearg",l]],f="[object Arguments]",m="[object Array]",g="[object Boolean]",y="[object Date]",_="[object Error]",v="[object Function]",x="[object GeneratorFunction]",b="[object Map]",w="[object Number]",T="[object Object]",S="[object Promise]",C="[object RegExp]",M="[object Set]",k="[object String]",E="[object Symbol]",A="[object WeakMap]",I="[object ArrayBuffer]",z="[object DataView]",P="[object Float32Array]",L="[object Float64Array]",D="[object Int8Array]",R="[object Int16Array]",B="[object Int32Array]",O="[object Uint8Array]",F="[object Uint8ClampedArray]",j="[object Uint16Array]",$="[object Uint32Array]",N=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,V=/(__e\(.*?\)|\b__t\)) \+\n'';/g,G=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,Z=RegExp(G.source),W=RegExp(q.source),H=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,Y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ee=/[\\^$.*+?()[\]{}|]/g,te=RegExp(ee.source),ie=/^\s+/,re=/\s/,ne=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,se=/,? & /,ae=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,le=/[()=,{}\[\]\/\s]/,ce=/\\(\\)?/g,ue=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,he=/\w*$/,de=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,fe=/^\[object .+?Constructor\]$/,me=/^0o[0-7]+$/i,ge=/^(?:0|[1-9]\d*)$/,ye=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_e=/($^)/,ve=/['\n\r\u2028\u2029\\]/g,be="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",we="\\u2700-\\u27bf",Ce="a-z\\xdf-\\xf6\\xf8-\\xff",Me="A-Z\\xc0-\\xd6\\xd8-\\xde",ke="\\ufe0e\\ufe0f",Ee="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ae="['’]",Ie="[\\ud800-\\udfff]",ze="["+Ee+"]",Pe="["+be+"]",Le="\\d+",De="[\\u2700-\\u27bf]",Re="["+Ce+"]",Be="[^\\ud800-\\udfff"+Ee+Le+we+Ce+Me+"]",Oe="\\ud83c[\\udffb-\\udfff]",Fe="[^\\ud800-\\udfff]",je="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="["+Me+"]",Ue="(?:"+Re+"|"+Be+")",Ve="(?:"+Ne+"|"+Be+")",Ge="(?:['’](?:d|ll|m|re|s|t|ve))?",qe="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ze="(?:"+Pe+"|"+Oe+")?",We="[\\ufe0e\\ufe0f]?",He=We+Ze+"(?:\\u200d(?:"+[Fe,je,$e].join("|")+")"+We+Ze+")*",Xe="(?:"+[De,je,$e].join("|")+")"+He,Ke="(?:"+[Fe+Pe+"?",Pe,je,$e,Ie].join("|")+")",Ye=RegExp(Ae,"g"),Je=RegExp(Pe,"g"),Qe=RegExp(Oe+"(?="+Oe+")|"+Ke+He,"g"),et=RegExp([Ne+"?"+Re+"+"+Ge+"(?="+[ze,Ne,"$"].join("|")+")",Ve+"+"+qe+"(?="+[ze,Ne+Ue,"$"].join("|")+")",Ne+"?"+Ue+"+"+Ge,Ne+"+"+qe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Xe].join("|"),"g"),tt=RegExp("[\\u200d\\ud800-\\udfff"+be+ke+"]"),it=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,rt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],nt=-1,ot={};ot[P]=ot[L]=ot[D]=ot[R]=ot[B]=ot[O]=ot[F]=ot[j]=ot[$]=!0,ot[f]=ot[m]=ot[I]=ot[g]=ot[z]=ot[y]=ot[_]=ot[v]=ot[b]=ot[w]=ot[T]=ot[C]=ot[M]=ot[k]=ot[A]=!1;var st={};st[f]=st[m]=st[I]=st[z]=st[g]=st[y]=st[P]=st[L]=st[D]=st[R]=st[B]=st[b]=st[w]=st[T]=st[C]=st[M]=st[k]=st[E]=st[O]=st[F]=st[j]=st[$]=!0,st[_]=st[v]=st[A]=!1;var at={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},lt=parseFloat,ct=parseInt,ut="object"==typeof xe&&xe&&xe.Object===Object&&xe,ht="object"==typeof self&&self&&self.Object===Object&&self,dt=ut||ht||Function("return this")(),pt=Se&&!Se.nodeType&&Se,ft=pt&&Te&&!Te.nodeType&&Te,mt=ft&&ft.exports===pt,gt=mt&&ut.process,yt=function(){try{var e=ft&&ft.require&&ft.require("util").types;return e||gt&&gt.binding&&gt.binding("util")}catch(e){}}(),_t=yt&&yt.isArrayBuffer,vt=yt&&yt.isDate,xt=yt&&yt.isMap,bt=yt&&yt.isRegExp,wt=yt&&yt.isSet,Tt=yt&&yt.isTypedArray;function St(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}function Ct(e,t,i,r){for(var n=-1,o=null==e?0:e.length;++n<o;){var s=e[n];t(r,s,i(s),e)}return r}function Mt(e,t){for(var i=-1,r=null==e?0:e.length;++i<r&&!1!==t(e[i],i,e););return e}function kt(e,t){for(var i=null==e?0:e.length;i--&&!1!==t(e[i],i,e););return e}function Et(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(!t(e[i],i,e))return!1;return!0}function At(e,t){for(var i=-1,r=null==e?0:e.length,n=0,o=[];++i<r;){var s=e[i];t(s,i,e)&&(o[n++]=s)}return o}function It(e,t){return!(null==e||!e.length)&&$t(e,t,0)>-1}function zt(e,t,i){for(var r=-1,n=null==e?0:e.length;++r<n;)if(i(t,e[r]))return!0;return!1}function Pt(e,t){for(var i=-1,r=null==e?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}function Lt(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}function Dt(e,t,i,r){var n=-1,o=null==e?0:e.length;for(r&&o&&(i=e[++n]);++n<o;)i=t(i,e[n],n,e);return i}function Rt(e,t,i,r){var n=null==e?0:e.length;for(r&&n&&(i=e[--n]);n--;)i=t(i,e[n],n,e);return i}function Bt(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var Ot=Gt("length");function Ft(e,t,i){var r;return i(e,(function(e,i,n){if(t(e,i,n))return r=i,!1})),r}function jt(e,t,i,r){for(var n=e.length,o=i+(r?1:-1);r?o--:++o<n;)if(t(e[o],o,e))return o;return-1}function $t(e,t,i){return t==t?function(e,t,i){for(var r=i-1,n=e.length;++r<n;)if(e[r]===t)return r;return-1}(e,t,i):jt(e,Ut,i)}function Nt(e,t,i,r){for(var n=i-1,o=e.length;++n<o;)if(r(e[n],t))return n;return-1}function Ut(e){return e!=e}function Vt(e,t){var i=null==e?0:e.length;return i?Wt(e,t)/i:h}function Gt(t){return function(i){return null==i?e:i[t]}}function qt(t){return function(i){return null==t?e:t[i]}}function Zt(e,t,i,r,n){return n(e,(function(e,n,o){i=r?(r=!1,e):t(i,e,n,o)})),i}function Wt(t,i){for(var r,n=-1,o=t.length;++n<o;){var s=i(t[n]);s!==e&&(r=r===e?s:r+s)}return r}function Ht(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}function Xt(e){return e?e.slice(0,pi(e)+1).replace(ie,""):e}function Kt(e){return function(t){return e(t)}}function Yt(e,t){return Pt(t,(function(t){return e[t]}))}function Jt(e,t){return e.has(t)}function Qt(e,t){for(var i=-1,r=e.length;++i<r&&$t(t,e[i],0)>-1;);return i}function ei(e,t){for(var i=e.length;i--&&$t(t,e[i],0)>-1;);return i}function ti(e,t){for(var i=e.length,r=0;i--;)e[i]===t&&++r;return r}var ii=qt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),ri=qt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ni(e){return"\\"+at[e]}function oi(e){return tt.test(e)}function si(e){var t=-1,i=Array(e.size);return e.forEach((function(e,r){i[++t]=[r,e]})),i}function ai(e,t){return function(i){return e(t(i))}}function li(e,t){for(var i=-1,n=e.length,o=0,s=[];++i<n;){var a=e[i];a!==t&&a!==r||(e[i]=r,s[o++]=i)}return s}function ci(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i}function ui(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=[e,e]})),i}function hi(e){return oi(e)?function(e){for(var t=Qe.lastIndex=0;Qe.test(e);)++t;return t}(e):Ot(e)}function di(e){return oi(e)?function(e){return e.match(Qe)||[]}(e):function(e){return e.split("")}(e)}function pi(e){for(var t=e.length;t--&&re.test(e.charAt(t)););return t}var fi=qt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),mi=function re(xe){var be,we=(xe=null==xe?dt:mi.defaults(dt.Object(),xe,mi.pick(dt,rt))).Array,Te=xe.Date,Se=xe.Error,Ce=xe.Function,Me=xe.Math,ke=xe.Object,Ee=xe.RegExp,Ae=xe.String,Ie=xe.TypeError,ze=we.prototype,Pe=Ce.prototype,Le=ke.prototype,De=xe["__core-js_shared__"],Re=Pe.toString,Be=Le.hasOwnProperty,Oe=0,Fe=(be=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||""))?"Symbol(src)_1."+be:"",je=Le.toString,$e=Re.call(ke),Ne=dt._,Ue=Ee("^"+Re.call(Be).replace(ee,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ve=mt?xe.Buffer:e,Ge=xe.Symbol,qe=xe.Uint8Array,Ze=Ve?Ve.allocUnsafe:e,We=ai(ke.getPrototypeOf,ke),He=ke.create,Xe=Le.propertyIsEnumerable,Ke=ze.splice,Qe=Ge?Ge.isConcatSpreadable:e,tt=Ge?Ge.iterator:e,at=Ge?Ge.toStringTag:e,ut=function(){try{var e=fo(ke,"defineProperty");return e({},"",{}),e}catch(e){}}(),ht=xe.clearTimeout!==dt.clearTimeout&&xe.clearTimeout,pt=Te&&Te.now!==dt.Date.now&&Te.now,ft=xe.setTimeout!==dt.setTimeout&&xe.setTimeout,gt=Me.ceil,yt=Me.floor,Ot=ke.getOwnPropertySymbols,qt=Ve?Ve.isBuffer:e,gi=xe.isFinite,yi=ze.join,_i=ai(ke.keys,ke),vi=Me.max,xi=Me.min,bi=Te.now,wi=xe.parseInt,Ti=Me.random,Si=ze.reverse,Ci=fo(xe,"DataView"),Mi=fo(xe,"Map"),ki=fo(xe,"Promise"),Ei=fo(xe,"Set"),Ai=fo(xe,"WeakMap"),Ii=fo(ke,"create"),zi=Ai&&new Ai,Pi={},Li=No(Ci),Di=No(Mi),Ri=No(ki),Bi=No(Ei),Oi=No(Ai),Fi=Ge?Ge.prototype:e,ji=Fi?Fi.valueOf:e,$i=Fi?Fi.toString:e;function Ni(e){if(na(e)&&!Ws(e)&&!(e instanceof qi)){if(e instanceof Gi)return e;if(Be.call(e,"__wrapped__"))return Uo(e)}return new Gi(e)}var Ui=function(){function t(){}return function(i){if(!ra(i))return{};if(He)return He(i);t.prototype=i;var r=new t;return t.prototype=e,r}}();function Vi(){}function Gi(t,i){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=e}function qi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Zi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Wi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Hi(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Xi(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Hi;++t<i;)this.add(e[t])}function Ki(e){var t=this.__data__=new Wi(e);this.size=t.size}function Yi(e,t){var i=Ws(e),r=!i&&Zs(e),n=!i&&!r&&Ys(e),o=!i&&!r&&!n&&da(e),s=i||r||n||o,a=s?Ht(e.length,Ae):[],l=a.length;for(var c in e)!t&&!Be.call(e,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||bo(c,l))||a.push(c);return a}function Ji(t){var i=t.length;return i?t[Xr(0,i-1)]:e}function Qi(e,t){return Fo(zn(e),lr(t,0,e.length))}function er(e){return Fo(zn(e))}function tr(t,i,r){(r!==e&&!Vs(t[i],r)||r===e&&!(i in t))&&sr(t,i,r)}function ir(t,i,r){var n=t[i];Be.call(t,i)&&Vs(n,r)&&(r!==e||i in t)||sr(t,i,r)}function rr(e,t){for(var i=e.length;i--;)if(Vs(e[i][0],t))return i;return-1}function nr(e,t,i,r){return pr(e,(function(e,n,o){t(r,e,i(e),o)})),r}function or(e,t){return e&&Pn(t,Da(t),e)}function sr(e,t,i){"__proto__"==t&&ut?ut(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function ar(t,i){for(var r=-1,n=i.length,o=we(n),s=null==t;++r<n;)o[r]=s?e:Aa(t,i[r]);return o}function lr(t,i,r){return t==t&&(r!==e&&(t=t<=r?t:r),i!==e&&(t=t>=i?t:i)),t}function cr(t,i,r,n,o,s){var a,l=1&i,c=2&i,u=4&i;if(r&&(a=o?r(t,n,o,s):r(t)),a!==e)return a;if(!ra(t))return t;var h=Ws(t);if(h){if(a=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&Be.call(e,"index")&&(i.index=e.index,i.input=e.input),i}(t),!l)return zn(t,a)}else{var d=yo(t),p=d==v||d==x;if(Ys(t))return Cn(t,l);if(d==T||d==f||p&&!o){if(a=c||p?{}:vo(t),!l)return c?function(e,t){return Pn(e,go(e),t)}(t,function(e,t){return e&&Pn(t,Ra(t),e)}(a,t)):function(e,t){return Pn(e,mo(e),t)}(t,or(a,t))}else{if(!st[d])return o?t:{};a=function(e,t,i){var r,n=e.constructor;switch(t){case I:return Mn(e);case g:case y:return new n(+e);case z:return function(e,t){var i=t?Mn(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case P:case L:case D:case R:case B:case O:case F:case j:case $:return kn(e,i);case b:return new n;case w:case k:return new n(e);case C:return function(e){var t=new e.constructor(e.source,he.exec(e));return t.lastIndex=e.lastIndex,t}(e);case M:return new n;case E:return r=e,ji?ke(ji.call(r)):{}}}(t,d,l)}}s||(s=new Ki);var m=s.get(t);if(m)return m;s.set(t,a),ca(t)?t.forEach((function(e){a.add(cr(e,i,r,e,t,s))})):oa(t)&&t.forEach((function(e,n){a.set(n,cr(e,i,r,n,t,s))}));var _=h?e:(u?c?so:oo:c?Ra:Da)(t);return Mt(_||t,(function(e,n){_&&(e=t[n=e]),ir(a,n,cr(e,i,r,n,t,s))})),a}function ur(t,i,r){var n=r.length;if(null==t)return!n;for(t=ke(t);n--;){var o=r[n],s=i[o],a=t[o];if(a===e&&!(o in t)||!s(a))return!1}return!0}function hr(i,r,n){if("function"!=typeof i)throw new Ie(t);return Do((function(){i.apply(e,n)}),r)}function dr(e,t,i,r){var n=-1,o=It,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;i&&(t=Pt(t,Kt(i))),r?(o=zt,s=!1):t.length>=200&&(o=Jt,s=!1,t=new Xi(t));e:for(;++n<a;){var u=e[n],h=null==i?u:i(u);if(u=r||0!==u?u:0,s&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(u)}else o(t,h,r)||l.push(u)}return l}Ni.templateSettings={escape:H,evaluate:X,interpolate:K,variable:"",imports:{_:Ni}},Ni.prototype=Vi.prototype,Ni.prototype.constructor=Ni,Gi.prototype=Ui(Vi.prototype),Gi.prototype.constructor=Gi,qi.prototype=Ui(Vi.prototype),qi.prototype.constructor=qi,Zi.prototype.clear=function(){this.__data__=Ii?Ii(null):{},this.size=0},Zi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Zi.prototype.get=function(t){var r=this.__data__;if(Ii){var n=r[t];return n===i?e:n}return Be.call(r,t)?r[t]:e},Zi.prototype.has=function(t){var i=this.__data__;return Ii?i[t]!==e:Be.call(i,t)},Zi.prototype.set=function(t,r){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ii&&r===e?i:r,this},Wi.prototype.clear=function(){this.__data__=[],this.size=0},Wi.prototype.delete=function(e){var t=this.__data__,i=rr(t,e);return!(i<0||(i==t.length-1?t.pop():Ke.call(t,i,1),--this.size,0))},Wi.prototype.get=function(t){var i=this.__data__,r=rr(i,t);return r<0?e:i[r][1]},Wi.prototype.has=function(e){return rr(this.__data__,e)>-1},Wi.prototype.set=function(e,t){var i=this.__data__,r=rr(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},Hi.prototype.clear=function(){this.size=0,this.__data__={hash:new Zi,map:new(Mi||Wi),string:new Zi}},Hi.prototype.delete=function(e){var t=ho(this,e).delete(e);return this.size-=t?1:0,t},Hi.prototype.get=function(e){return ho(this,e).get(e)},Hi.prototype.has=function(e){return ho(this,e).has(e)},Hi.prototype.set=function(e,t){var i=ho(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},Xi.prototype.add=Xi.prototype.push=function(e){return this.__data__.set(e,i),this},Xi.prototype.has=function(e){return this.__data__.has(e)},Ki.prototype.clear=function(){this.__data__=new Wi,this.size=0},Ki.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Ki.prototype.get=function(e){return this.__data__.get(e)},Ki.prototype.has=function(e){return this.__data__.has(e)},Ki.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Wi){var r=i.__data__;if(!Mi||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new Hi(r)}return i.set(e,t),this.size=i.size,this};var pr=Rn(br),fr=Rn(wr,!0);function mr(e,t){var i=!0;return pr(e,(function(e,r,n){return i=!!t(e,r,n)})),i}function gr(t,i,r){for(var n=-1,o=t.length;++n<o;){var s=t[n],a=i(s);if(null!=a&&(l===e?a==a&&!ha(a):r(a,l)))var l=a,c=s}return c}function yr(e,t){var i=[];return pr(e,(function(e,r,n){t(e,r,n)&&i.push(e)})),i}function _r(e,t,i,r,n){var o=-1,s=e.length;for(i||(i=xo),n||(n=[]);++o<s;){var a=e[o];t>0&&i(a)?t>1?_r(a,t-1,i,r,n):Lt(n,a):r||(n[n.length]=a)}return n}var vr=Bn(),xr=Bn(!0);function br(e,t){return e&&vr(e,t,Da)}function wr(e,t){return e&&xr(e,t,Da)}function Tr(e,t){return At(t,(function(t){return ea(e[t])}))}function Sr(t,i){for(var r=0,n=(i=bn(i,t)).length;null!=t&&r<n;)t=t[$o(i[r++])];return r&&r==n?t:e}function Cr(e,t,i){var r=t(e);return Ws(e)?r:Lt(r,i(e))}function Mr(t){return null==t?t===e?"[object Undefined]":"[object Null]":at&&at in ke(t)?function(t){var i=Be.call(t,at),r=t[at];try{t[at]=e;var n=!0}catch(e){}var o=je.call(t);return n&&(i?t[at]=r:delete t[at]),o}(t):function(e){return je.call(e)}(t)}function kr(e,t){return e>t}function Er(e,t){return null!=e&&Be.call(e,t)}function Ar(e,t){return null!=e&&t in ke(e)}function Ir(t,i,r){for(var n=r?zt:It,o=t[0].length,s=t.length,a=s,l=we(s),c=1/0,u=[];a--;){var h=t[a];a&&i&&(h=Pt(h,Kt(i))),c=xi(h.length,c),l[a]=!r&&(i||o>=120&&h.length>=120)?new Xi(a&&h):e}h=t[0];var d=-1,p=l[0];e:for(;++d<o&&u.length<c;){var f=h[d],m=i?i(f):f;if(f=r||0!==f?f:0,!(p?Jt(p,m):n(u,m,r))){for(a=s;--a;){var g=l[a];if(!(g?Jt(g,m):n(t[a],m,r)))continue e}p&&p.push(m),u.push(f)}}return u}function zr(t,i,r){var n=null==(t=Io(t,i=bn(i,t)))?t:t[$o(Qo(i))];return null==n?e:St(n,t,r)}function Pr(e){return na(e)&&Mr(e)==f}function Lr(t,i,r,n,o){return t===i||(null==t||null==i||!na(t)&&!na(i)?t!=t&&i!=i:function(t,i,r,n,o,s){var a=Ws(t),l=Ws(i),c=a?m:yo(t),u=l?m:yo(i),h=(c=c==f?T:c)==T,d=(u=u==f?T:u)==T,p=c==u;if(p&&Ys(t)){if(!Ys(i))return!1;a=!0,h=!1}if(p&&!h)return s||(s=new Ki),a||da(t)?ro(t,i,r,n,o,s):function(e,t,i,r,n,o,s){switch(i){case z:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!o(new qe(e),new qe(t)));case g:case y:case w:return Vs(+e,+t);case _:return e.name==t.name&&e.message==t.message;case C:case k:return e==t+"";case b:var a=si;case M:var l=1&r;if(a||(a=ci),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;r|=2,s.set(e,t);var u=ro(a(e),a(t),r,n,o,s);return s.delete(e),u;case E:if(ji)return ji.call(e)==ji.call(t)}return!1}(t,i,c,r,n,o,s);if(!(1&r)){var v=h&&Be.call(t,"__wrapped__"),x=d&&Be.call(i,"__wrapped__");if(v||x){var S=v?t.value():t,A=x?i.value():i;return s||(s=new Ki),o(S,A,r,n,s)}}return!!p&&(s||(s=new Ki),function(t,i,r,n,o,s){var a=1&r,l=oo(t),c=l.length,u=oo(i).length;if(c!=u&&!a)return!1;for(var h=c;h--;){var d=l[h];if(!(a?d in i:Be.call(i,d)))return!1}var p=s.get(t),f=s.get(i);if(p&&f)return p==i&&f==t;var m=!0;s.set(t,i),s.set(i,t);for(var g=a;++h<c;){var y=t[d=l[h]],_=i[d];if(n)var v=a?n(_,y,d,i,t,s):n(y,_,d,t,i,s);if(!(v===e?y===_||o(y,_,r,n,s):v)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var x=t.constructor,b=i.constructor;x==b||!("constructor"in t)||!("constructor"in i)||"function"==typeof x&&x instanceof x&&"function"==typeof b&&b instanceof b||(m=!1)}return s.delete(t),s.delete(i),m}(t,i,r,n,o,s))}(t,i,r,n,Lr,o))}function Dr(t,i,r,n){var o=r.length,s=o,a=!n;if(null==t)return!s;for(t=ke(t);o--;){var l=r[o];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++o<s;){var c=(l=r[o])[0],u=t[c],h=l[1];if(a&&l[2]){if(u===e&&!(c in t))return!1}else{var d=new Ki;if(n)var p=n(u,h,c,t,i,d);if(!(p===e?Lr(h,u,3,n,d):p))return!1}}return!0}function Rr(e){return!(!ra(e)||function(e){return!!Fe&&Fe in e}(e))&&(ea(e)?Ue:fe).test(No(e))}function Br(e){return"function"==typeof e?e:null==e?sl:"object"==typeof e?Ws(e)?Ur(e[0],e[1]):Nr(e):ml(e)}function Or(e){if(!Mo(e))return _i(e);var t=[];for(var i in ke(e))Be.call(e,i)&&"constructor"!=i&&t.push(i);return t}function Fr(e){if(!ra(e))return function(e){var t=[];if(null!=e)for(var i in ke(e))t.push(i);return t}(e);var t=Mo(e),i=[];for(var r in e)("constructor"!=r||!t&&Be.call(e,r))&&i.push(r);return i}function jr(e,t){return e<t}function $r(e,t){var i=-1,r=Xs(e)?we(e.length):[];return pr(e,(function(e,n,o){r[++i]=t(e,n,o)})),r}function Nr(e){var t=po(e);return 1==t.length&&t[0][2]?Eo(t[0][0],t[0][1]):function(i){return i===e||Dr(i,e,t)}}function Ur(t,i){return To(t)&&ko(i)?Eo($o(t),i):function(r){var n=Aa(r,t);return n===e&&n===i?Ia(r,t):Lr(i,n,3)}}function Vr(t,i,r,n,o){t!==i&&vr(i,(function(s,a){if(o||(o=new Ki),ra(s))!function(t,i,r,n,o,s,a){var l=Po(t,r),c=Po(i,r),u=a.get(c);if(u)tr(t,r,u);else{var h=s?s(l,c,r+"",t,i,a):e,d=h===e;if(d){var p=Ws(c),f=!p&&Ys(c),m=!p&&!f&&da(c);h=c,p||f||m?Ws(l)?h=l:Ks(l)?h=zn(l):f?(d=!1,h=Cn(c,!0)):m?(d=!1,h=kn(c,!0)):h=[]:aa(c)||Zs(c)?(h=l,Zs(l)?h=xa(l):ra(l)&&!ea(l)||(h=vo(c))):d=!1}d&&(a.set(c,h),o(h,c,n,s,a),a.delete(c)),tr(t,r,h)}}(t,i,a,r,Vr,n,o);else{var l=n?n(Po(t,a),s,a+"",t,i,o):e;l===e&&(l=s),tr(t,a,l)}}),Ra)}function Gr(t,i){var r=t.length;if(r)return bo(i+=i<0?r:0,r)?t[i]:e}function qr(e,t,i){t=t.length?Pt(t,(function(e){return Ws(e)?function(t){return Sr(t,1===e.length?e[0]:e)}:e})):[sl];var r=-1;t=Pt(t,Kt(uo()));var n=$r(e,(function(e,i,n){var o=Pt(t,(function(t){return t(e)}));return{criteria:o,index:++r,value:e}}));return function(e,t){var i=e.length;for(e.sort(t);i--;)e[i]=e[i].value;return e}(n,(function(e,t){return function(e,t,i){for(var r=-1,n=e.criteria,o=t.criteria,s=n.length,a=i.length;++r<s;){var l=En(n[r],o[r]);if(l)return r>=a?l:l*("desc"==i[r]?-1:1)}return e.index-t.index}(e,t,i)}))}function Zr(e,t,i){for(var r=-1,n=t.length,o={};++r<n;){var s=t[r],a=Sr(e,s);i(a,s)&&en(o,bn(s,e),a)}return o}function Wr(e,t,i,r){var n=r?Nt:$t,o=-1,s=t.length,a=e;for(e===t&&(t=zn(t)),i&&(a=Pt(e,Kt(i)));++o<s;)for(var l=0,c=t[o],u=i?i(c):c;(l=n(a,u,l,r))>-1;)a!==e&&Ke.call(a,l,1),Ke.call(e,l,1);return e}function Hr(e,t){for(var i=e?t.length:0,r=i-1;i--;){var n=t[i];if(i==r||n!==o){var o=n;bo(n)?Ke.call(e,n,1):pn(e,n)}}return e}function Xr(e,t){return e+yt(Ti()*(t-e+1))}function Kr(e,t){var i="";if(!e||t<1||t>u)return i;do{t%2&&(i+=e),(t=yt(t/2))&&(e+=e)}while(t);return i}function Yr(e,t){return Ro(Ao(e,t,sl),e+"")}function Jr(e){return Ji(Va(e))}function Qr(e,t){var i=Va(e);return Fo(i,lr(t,0,i.length))}function en(t,i,r,n){if(!ra(t))return t;for(var o=-1,s=(i=bn(i,t)).length,a=s-1,l=t;null!=l&&++o<s;){var c=$o(i[o]),u=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(o!=a){var h=l[c];(u=n?n(h,c,l):e)===e&&(u=ra(h)?h:bo(i[o+1])?[]:{})}ir(l,c,u),l=l[c]}return t}var tn=zi?function(e,t){return zi.set(e,t),e}:sl,rn=ut?function(e,t){return ut(e,"toString",{configurable:!0,enumerable:!1,value:rl(t),writable:!0})}:sl;function nn(e){return Fo(Va(e))}function on(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(i=i>n?n:i)<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var o=we(n);++r<n;)o[r]=e[r+t];return o}function sn(e,t){var i;return pr(e,(function(e,r,n){return!(i=t(e,r,n))})),!!i}function an(e,t,i){var r=0,n=null==e?r:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;r<n;){var o=r+n>>>1,s=e[o];null!==s&&!ha(s)&&(i?s<=t:s<t)?r=o+1:n=o}return n}return ln(e,t,sl,i)}function ln(t,i,r,n){var o=0,s=null==t?0:t.length;if(0===s)return 0;for(var a=(i=r(i))!=i,l=null===i,c=ha(i),u=i===e;o<s;){var h=yt((o+s)/2),d=r(t[h]),p=d!==e,f=null===d,m=d==d,g=ha(d);if(a)var y=n||m;else y=u?m&&(n||p):l?m&&p&&(n||!f):c?m&&p&&!f&&(n||!g):!f&&!g&&(n?d<=i:d<i);y?o=h+1:s=h}return xi(s,4294967294)}function cn(e,t){for(var i=-1,r=e.length,n=0,o=[];++i<r;){var s=e[i],a=t?t(s):s;if(!i||!Vs(a,l)){var l=a;o[n++]=0===s?0:s}}return o}function un(e){return"number"==typeof e?e:ha(e)?h:+e}function hn(e){if("string"==typeof e)return e;if(Ws(e))return Pt(e,hn)+"";if(ha(e))return $i?$i.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function dn(e,t,i){var r=-1,n=It,o=e.length,s=!0,a=[],l=a;if(i)s=!1,n=zt;else if(o>=200){var c=t?null:Yn(e);if(c)return ci(c);s=!1,n=Jt,l=new Xi}else l=t?[]:a;e:for(;++r<o;){var u=e[r],h=t?t(u):u;if(u=i||0!==u?u:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),a.push(u)}else n(l,h,i)||(l!==a&&l.push(h),a.push(u))}return a}function pn(e,t){return null==(e=Io(e,t=bn(t,e)))||delete e[$o(Qo(t))]}function fn(e,t,i,r){return en(e,t,i(Sr(e,t)),r)}function mn(e,t,i,r){for(var n=e.length,o=r?n:-1;(r?o--:++o<n)&&t(e[o],o,e););return i?on(e,r?0:o,r?o+1:n):on(e,r?o+1:0,r?n:o)}function gn(e,t){var i=e;return i instanceof qi&&(i=i.value()),Dt(t,(function(e,t){return t.func.apply(t.thisArg,Lt([e],t.args))}),i)}function yn(e,t,i){var r=e.length;if(r<2)return r?dn(e[0]):[];for(var n=-1,o=we(r);++n<r;)for(var s=e[n],a=-1;++a<r;)a!=n&&(o[n]=dr(o[n]||s,e[a],t,i));return dn(_r(o,1),t,i)}function _n(t,i,r){for(var n=-1,o=t.length,s=i.length,a={};++n<o;){var l=n<s?i[n]:e;r(a,t[n],l)}return a}function vn(e){return Ks(e)?e:[]}function xn(e){return"function"==typeof e?e:sl}function bn(e,t){return Ws(e)?e:To(e,t)?[e]:jo(ba(e))}var wn=Yr;function Tn(t,i,r){var n=t.length;return r=r===e?n:r,!i&&r>=n?t:on(t,i,r)}var Sn=ht||function(e){return dt.clearTimeout(e)};function Cn(e,t){if(t)return e.slice();var i=e.length,r=Ze?Ze(i):new e.constructor(i);return e.copy(r),r}function Mn(e){var t=new e.constructor(e.byteLength);return new qe(t).set(new qe(e)),t}function kn(e,t){var i=t?Mn(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function En(t,i){if(t!==i){var r=t!==e,n=null===t,o=t==t,s=ha(t),a=i!==e,l=null===i,c=i==i,u=ha(i);if(!l&&!u&&!s&&t>i||s&&a&&c&&!l&&!u||n&&a&&c||!r&&c||!o)return 1;if(!n&&!s&&!u&&t<i||u&&r&&o&&!n&&!s||l&&r&&o||!a&&o||!c)return-1}return 0}function An(e,t,i,r){for(var n=-1,o=e.length,s=i.length,a=-1,l=t.length,c=vi(o-s,0),u=we(l+c),h=!r;++a<l;)u[a]=t[a];for(;++n<s;)(h||n<o)&&(u[i[n]]=e[n]);for(;c--;)u[a++]=e[n++];return u}function In(e,t,i,r){for(var n=-1,o=e.length,s=-1,a=i.length,l=-1,c=t.length,u=vi(o-a,0),h=we(u+c),d=!r;++n<u;)h[n]=e[n];for(var p=n;++l<c;)h[p+l]=t[l];for(;++s<a;)(d||n<o)&&(h[p+i[s]]=e[n++]);return h}function zn(e,t){var i=-1,r=e.length;for(t||(t=we(r));++i<r;)t[i]=e[i];return t}function Pn(t,i,r,n){var o=!r;r||(r={});for(var s=-1,a=i.length;++s<a;){var l=i[s],c=n?n(r[l],t[l],l,r,t):e;c===e&&(c=t[l]),o?sr(r,l,c):ir(r,l,c)}return r}function Ln(e,t){return function(i,r){var n=Ws(i)?Ct:nr,o=t?t():{};return n(i,e,uo(r,2),o)}}function Dn(t){return Yr((function(i,r){var n=-1,o=r.length,s=o>1?r[o-1]:e,a=o>2?r[2]:e;for(s=t.length>3&&"function"==typeof s?(o--,s):e,a&&wo(r[0],r[1],a)&&(s=o<3?e:s,o=1),i=ke(i);++n<o;){var l=r[n];l&&t(i,l,n,s)}return i}))}function Rn(e,t){return function(i,r){if(null==i)return i;if(!Xs(i))return e(i,r);for(var n=i.length,o=t?n:-1,s=ke(i);(t?o--:++o<n)&&!1!==r(s[o],o,s););return i}}function Bn(e){return function(t,i,r){for(var n=-1,o=ke(t),s=r(t),a=s.length;a--;){var l=s[e?a:++n];if(!1===i(o[l],l,o))break}return t}}function On(t){return function(i){var r=oi(i=ba(i))?di(i):e,n=r?r[0]:i.charAt(0),o=r?Tn(r,1).join(""):i.slice(1);return n[t]()+o}}function Fn(e){return function(t){return Dt(el(Za(t).replace(Ye,"")),e,"")}}function jn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var i=Ui(e.prototype),r=e.apply(i,t);return ra(r)?r:i}}function $n(t){return function(i,r,n){var o=ke(i);if(!Xs(i)){var s=uo(r,3);i=Da(i),r=function(e){return s(o[e],e,o)}}var a=t(i,r,n);return a>-1?o[s?i[a]:a]:e}}function Nn(i){return no((function(r){var n=r.length,o=n,s=Gi.prototype.thru;for(i&&r.reverse();o--;){var a=r[o];if("function"!=typeof a)throw new Ie(t);if(s&&!l&&"wrapper"==lo(a))var l=new Gi([],!0)}for(o=l?o:n;++o<n;){var c=lo(a=r[o]),u="wrapper"==c?ao(a):e;l=u&&So(u[0])&&424==u[1]&&!u[4].length&&1==u[9]?l[lo(u[0])].apply(l,u[3]):1==a.length&&So(a)?l[c]():l.thru(a)}return function(){var e=arguments,t=e[0];if(l&&1==e.length&&Ws(t))return l.plant(t).value();for(var i=0,o=n?r[i].apply(this,e):t;++i<n;)o=r[i].call(this,o);return o}}))}function Un(t,i,r,n,o,s,l,c,u,h){var d=i&a,p=1&i,f=2&i,m=24&i,g=512&i,y=f?e:jn(t);return function e(){for(var a=arguments.length,_=we(a),v=a;v--;)_[v]=arguments[v];if(m)var x=co(e),b=ti(_,x);if(n&&(_=An(_,n,o,m)),s&&(_=In(_,s,l,m)),a-=b,m&&a<h){var w=li(_,x);return Xn(t,i,Un,e.placeholder,r,_,w,c,u,h-a)}var T=p?r:this,S=f?T[t]:t;return a=_.length,c?_=zo(_,c):g&&a>1&&_.reverse(),d&&u<a&&(_.length=u),this&&this!==dt&&this instanceof e&&(S=y||jn(S)),S.apply(T,_)}}function Vn(e,t){return function(i,r){return function(e,t,i,r){return br(e,(function(e,n,o){t(r,i(e),n,o)})),r}(i,e,t(r),{})}}function Gn(t,i){return function(r,n){var o;if(r===e&&n===e)return i;if(r!==e&&(o=r),n!==e){if(o===e)return n;"string"==typeof r||"string"==typeof n?(r=hn(r),n=hn(n)):(r=un(r),n=un(n)),o=t(r,n)}return o}}function qn(e){return no((function(t){return t=Pt(t,Kt(uo())),Yr((function(i){var r=this;return e(t,(function(e){return St(e,r,i)}))}))}))}function Zn(t,i){var r=(i=i===e?" ":hn(i)).length;if(r<2)return r?Kr(i,t):i;var n=Kr(i,gt(t/hi(i)));return oi(i)?Tn(di(n),0,t).join(""):n.slice(0,t)}function Wn(t){return function(i,r,n){return n&&"number"!=typeof n&&wo(i,r,n)&&(r=n=e),i=ga(i),r===e?(r=i,i=0):r=ga(r),function(e,t,i,r){for(var n=-1,o=vi(gt((t-e)/(i||1)),0),s=we(o);o--;)s[r?o:++n]=e,e+=i;return s}(i,r,n=n===e?i<r?1:-1:ga(n),t)}}function Hn(e){return function(t,i){return"string"==typeof t&&"string"==typeof i||(t=va(t),i=va(i)),e(t,i)}}function Xn(t,i,r,n,a,l,c,u,h,d){var p=8&i;i|=p?o:s,4&(i&=~(p?s:o))||(i&=-4);var f=[t,i,a,p?l:e,p?c:e,p?e:l,p?e:c,u,h,d],m=r.apply(e,f);return So(t)&&Lo(m,f),m.placeholder=n,Bo(m,t,i)}function Kn(e){var t=Me[e];return function(e,i){if(e=va(e),(i=null==i?0:xi(ya(i),292))&&gi(e)){var r=(ba(e)+"e").split("e");return+((r=(ba(t(r[0]+"e"+(+r[1]+i)))+"e").split("e"))[0]+"e"+(+r[1]-i))}return t(e)}}var Yn=Ei&&1/ci(new Ei([,-0]))[1]==c?function(e){return new Ei(e)}:hl;function Jn(e){return function(t){var i=yo(t);return i==b?si(t):i==M?ui(t):function(e,t){return Pt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Qn(i,c,u,h,d,p,f,m){var g=2&c;if(!g&&"function"!=typeof i)throw new Ie(t);var y=h?h.length:0;if(y||(c&=-97,h=d=e),f=f===e?f:vi(ya(f),0),m=m===e?m:ya(m),y-=d?d.length:0,c&s){var _=h,v=d;h=d=e}var x=g?e:ao(i),b=[i,c,u,h,d,_,v,p,f,m];if(x&&function(e,t){var i=e[1],n=t[1],o=i|n,s=o<131,c=n==a&&8==i||n==a&&i==l&&e[7].length<=t[8]||384==n&&t[7].length<=t[8]&&8==i;if(!s&&!c)return e;1&n&&(e[2]=t[2],o|=1&i?0:4);var u=t[3];if(u){var h=e[3];e[3]=h?An(h,u,t[4]):u,e[4]=h?li(e[3],r):t[4]}(u=t[5])&&(h=e[5],e[5]=h?In(h,u,t[6]):u,e[6]=h?li(e[5],r):t[6]),(u=t[7])&&(e[7]=u),n&a&&(e[8]=null==e[8]?t[8]:xi(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(b,x),i=b[0],c=b[1],u=b[2],h=b[3],d=b[4],!(m=b[9]=b[9]===e?g?0:i.length:vi(b[9]-y,0))&&24&c&&(c&=-25),c&&1!=c)w=8==c||c==n?function(t,i,r){var n=jn(t);return function o(){for(var s=arguments.length,a=we(s),l=s,c=co(o);l--;)a[l]=arguments[l];var u=s<3&&a[0]!==c&&a[s-1]!==c?[]:li(a,c);return(s-=u.length)<r?Xn(t,i,Un,o.placeholder,e,a,u,e,e,r-s):St(this&&this!==dt&&this instanceof o?n:t,this,a)}}(i,c,m):c!=o&&33!=c||d.length?Un.apply(e,b):function(e,t,i,r){var n=1&t,o=jn(e);return function t(){for(var s=-1,a=arguments.length,l=-1,c=r.length,u=we(c+a),h=this&&this!==dt&&this instanceof t?o:e;++l<c;)u[l]=r[l];for(;a--;)u[l++]=arguments[++s];return St(h,n?i:this,u)}}(i,c,u,h);else var w=function(e,t,i){var r=1&t,n=jn(e);return function t(){return(this&&this!==dt&&this instanceof t?n:e).apply(r?i:this,arguments)}}(i,c,u);return Bo((x?tn:Lo)(w,b),i,c)}function eo(t,i,r,n){return t===e||Vs(t,Le[r])&&!Be.call(n,r)?i:t}function to(t,i,r,n,o,s){return ra(t)&&ra(i)&&(s.set(i,t),Vr(t,i,e,to,s),s.delete(i)),t}function io(t){return aa(t)?e:t}function ro(t,i,r,n,o,s){var a=1&r,l=t.length,c=i.length;if(l!=c&&!(a&&c>l))return!1;var u=s.get(t),h=s.get(i);if(u&&h)return u==i&&h==t;var d=-1,p=!0,f=2&r?new Xi:e;for(s.set(t,i),s.set(i,t);++d<l;){var m=t[d],g=i[d];if(n)var y=a?n(g,m,d,i,t,s):n(m,g,d,t,i,s);if(y!==e){if(y)continue;p=!1;break}if(f){if(!Bt(i,(function(e,t){if(!Jt(f,t)&&(m===e||o(m,e,r,n,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!o(m,g,r,n,s)){p=!1;break}}return s.delete(t),s.delete(i),p}function no(t){return Ro(Ao(t,e,Ho),t+"")}function oo(e){return Cr(e,Da,mo)}function so(e){return Cr(e,Ra,go)}var ao=zi?function(e){return zi.get(e)}:hl;function lo(e){for(var t=e.name+"",i=Pi[t],r=Be.call(Pi,t)?i.length:0;r--;){var n=i[r],o=n.func;if(null==o||o==e)return n.name}return t}function co(e){return(Be.call(Ni,"placeholder")?Ni:e).placeholder}function uo(){var e=Ni.iteratee||al;return e=e===al?Br:e,arguments.length?e(arguments[0],arguments[1]):e}function ho(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function po(e){for(var t=Da(e),i=t.length;i--;){var r=t[i],n=e[r];t[i]=[r,n,ko(n)]}return t}function fo(t,i){var r=function(t,i){return null==t?e:t[i]}(t,i);return Rr(r)?r:e}var mo=Ot?function(e){return null==e?[]:(e=ke(e),At(Ot(e),(function(t){return Xe.call(e,t)})))}:_l,go=Ot?function(e){for(var t=[];e;)Lt(t,mo(e)),e=We(e);return t}:_l,yo=Mr;function _o(e,t,i){for(var r=-1,n=(t=bn(t,e)).length,o=!1;++r<n;){var s=$o(t[r]);if(!(o=null!=e&&i(e,s)))break;e=e[s]}return o||++r!=n?o:!!(n=null==e?0:e.length)&&ia(n)&&bo(s,n)&&(Ws(e)||Zs(e))}function vo(e){return"function"!=typeof e.constructor||Mo(e)?{}:Ui(We(e))}function xo(e){return Ws(e)||Zs(e)||!!(Qe&&e&&e[Qe])}function bo(e,t){var i=typeof e;return!!(t=null==t?u:t)&&("number"==i||"symbol"!=i&&ge.test(e))&&e>-1&&e%1==0&&e<t}function wo(e,t,i){if(!ra(i))return!1;var r=typeof t;return!!("number"==r?Xs(i)&&bo(t,i.length):"string"==r&&t in i)&&Vs(i[t],e)}function To(e,t){if(Ws(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!ha(e))||J.test(e)||!Y.test(e)||null!=t&&e in ke(t)}function So(e){var t=lo(e),i=Ni[t];if("function"!=typeof i||!(t in qi.prototype))return!1;if(e===i)return!0;var r=ao(i);return!!r&&e===r[0]}(Ci&&yo(new Ci(new ArrayBuffer(1)))!=z||Mi&&yo(new Mi)!=b||ki&&yo(ki.resolve())!=S||Ei&&yo(new Ei)!=M||Ai&&yo(new Ai)!=A)&&(yo=function(t){var i=Mr(t),r=i==T?t.constructor:e,n=r?No(r):"";if(n)switch(n){case Li:return z;case Di:return b;case Ri:return S;case Bi:return M;case Oi:return A}return i});var Co=De?ea:vl;function Mo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Le)}function ko(e){return e==e&&!ra(e)}function Eo(t,i){return function(r){return null!=r&&r[t]===i&&(i!==e||t in ke(r))}}function Ao(t,i,r){return i=vi(i===e?t.length-1:i,0),function(){for(var e=arguments,n=-1,o=vi(e.length-i,0),s=we(o);++n<o;)s[n]=e[i+n];n=-1;for(var a=we(i+1);++n<i;)a[n]=e[n];return a[i]=r(s),St(t,this,a)}}function Io(e,t){return t.length<2?e:Sr(e,on(t,0,-1))}function zo(t,i){for(var r=t.length,n=xi(i.length,r),o=zn(t);n--;){var s=i[n];t[n]=bo(s,r)?o[s]:e}return t}function Po(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Lo=Oo(tn),Do=ft||function(e,t){return dt.setTimeout(e,t)},Ro=Oo(rn);function Bo(e,t,i){var r=t+"";return Ro(e,function(e,t){var i=t.length;if(!i)return e;var r=i-1;return t[r]=(i>1?"& ":"")+t[r],t=t.join(i>2?", ":" "),e.replace(ne,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Mt(p,(function(i){var r="_."+i[0];t&i[1]&&!It(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(se):[]}(r),i)))}function Oo(t){var i=0,r=0;return function(){var n=bi(),o=16-(n-r);if(r=n,o>0){if(++i>=800)return arguments[0]}else i=0;return t.apply(e,arguments)}}function Fo(t,i){var r=-1,n=t.length,o=n-1;for(i=i===e?n:i;++r<i;){var s=Xr(r,o),a=t[s];t[s]=t[r],t[r]=a}return t.length=i,t}var jo=function(e){var t=Os(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Q,(function(e,i,r,n){t.push(r?n.replace(ce,"$1"):i||e)})),t}));function $o(e){if("string"==typeof e||ha(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function No(e){if(null!=e){try{return Re.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Uo(e){if(e instanceof qi)return e.clone();var t=new Gi(e.__wrapped__,e.__chain__);return t.__actions__=zn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Vo=Yr((function(e,t){return Ks(e)?dr(e,_r(t,1,Ks,!0)):[]})),Go=Yr((function(t,i){var r=Qo(i);return Ks(r)&&(r=e),Ks(t)?dr(t,_r(i,1,Ks,!0),uo(r,2)):[]})),qo=Yr((function(t,i){var r=Qo(i);return Ks(r)&&(r=e),Ks(t)?dr(t,_r(i,1,Ks,!0),e,r):[]}));function Zo(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var n=null==i?0:ya(i);return n<0&&(n=vi(r+n,0)),jt(e,uo(t,3),n)}function Wo(t,i,r){var n=null==t?0:t.length;if(!n)return-1;var o=n-1;return r!==e&&(o=ya(r),o=r<0?vi(n+o,0):xi(o,n-1)),jt(t,uo(i,3),o,!0)}function Ho(e){return null!=e&&e.length?_r(e,1):[]}function Xo(t){return t&&t.length?t[0]:e}var Ko=Yr((function(e){var t=Pt(e,vn);return t.length&&t[0]===e[0]?Ir(t):[]})),Yo=Yr((function(t){var i=Qo(t),r=Pt(t,vn);return i===Qo(r)?i=e:r.pop(),r.length&&r[0]===t[0]?Ir(r,uo(i,2)):[]})),Jo=Yr((function(t){var i=Qo(t),r=Pt(t,vn);return(i="function"==typeof i?i:e)&&r.pop(),r.length&&r[0]===t[0]?Ir(r,e,i):[]}));function Qo(t){var i=null==t?0:t.length;return i?t[i-1]:e}var es=Yr(ts);function ts(e,t){return e&&e.length&&t&&t.length?Wr(e,t):e}var is=no((function(e,t){var i=null==e?0:e.length,r=ar(e,t);return Hr(e,Pt(t,(function(e){return bo(e,i)?+e:e})).sort(En)),r}));function rs(e){return null==e?e:Si.call(e)}var ns=Yr((function(e){return dn(_r(e,1,Ks,!0))})),os=Yr((function(t){var i=Qo(t);return Ks(i)&&(i=e),dn(_r(t,1,Ks,!0),uo(i,2))})),ss=Yr((function(t){var i=Qo(t);return i="function"==typeof i?i:e,dn(_r(t,1,Ks,!0),e,i)}));function as(e){if(!e||!e.length)return[];var t=0;return e=At(e,(function(e){if(Ks(e))return t=vi(e.length,t),!0})),Ht(t,(function(t){return Pt(e,Gt(t))}))}function ls(t,i){if(!t||!t.length)return[];var r=as(t);return null==i?r:Pt(r,(function(t){return St(i,e,t)}))}var cs=Yr((function(e,t){return Ks(e)?dr(e,t):[]})),us=Yr((function(e){return yn(At(e,Ks))})),hs=Yr((function(t){var i=Qo(t);return Ks(i)&&(i=e),yn(At(t,Ks),uo(i,2))})),ds=Yr((function(t){var i=Qo(t);return i="function"==typeof i?i:e,yn(At(t,Ks),e,i)})),ps=Yr(as),fs=Yr((function(t){var i=t.length,r=i>1?t[i-1]:e;return r="function"==typeof r?(t.pop(),r):e,ls(t,r)}));function ms(e){var t=Ni(e);return t.__chain__=!0,t}function gs(e,t){return t(e)}var ys=no((function(t){var i=t.length,r=i?t[0]:0,n=this.__wrapped__,o=function(e){return ar(e,t)};return!(i>1||this.__actions__.length)&&n instanceof qi&&bo(r)?((n=n.slice(r,+r+(i?1:0))).__actions__.push({func:gs,args:[o],thisArg:e}),new Gi(n,this.__chain__).thru((function(t){return i&&!t.length&&t.push(e),t}))):this.thru(o)})),_s=Ln((function(e,t,i){Be.call(e,i)?++e[i]:sr(e,i,1)})),vs=$n(Zo),xs=$n(Wo);function bs(e,t){return(Ws(e)?Mt:pr)(e,uo(t,3))}function ws(e,t){return(Ws(e)?kt:fr)(e,uo(t,3))}var Ts=Ln((function(e,t,i){Be.call(e,i)?e[i].push(t):sr(e,i,[t])})),Ss=Yr((function(e,t,i){var r=-1,n="function"==typeof t,o=Xs(e)?we(e.length):[];return pr(e,(function(e){o[++r]=n?St(t,e,i):zr(e,t,i)})),o})),Cs=Ln((function(e,t,i){sr(e,i,t)}));function Ms(e,t){return(Ws(e)?Pt:$r)(e,uo(t,3))}var ks=Ln((function(e,t,i){e[i?0:1].push(t)}),(function(){return[[],[]]})),Es=Yr((function(e,t){if(null==e)return[];var i=t.length;return i>1&&wo(e,t[0],t[1])?t=[]:i>2&&wo(t[0],t[1],t[2])&&(t=[t[0]]),qr(e,_r(t,1),[])})),As=pt||function(){return dt.Date.now()};function Is(t,i,r){return i=r?e:i,i=t&&null==i?t.length:i,Qn(t,a,e,e,e,e,i)}function zs(i,r){var n;if("function"!=typeof r)throw new Ie(t);return i=ya(i),function(){return--i>0&&(n=r.apply(this,arguments)),i<=1&&(r=e),n}}var Ps=Yr((function(e,t,i){var r=1;if(i.length){var n=li(i,co(Ps));r|=o}return Qn(e,r,t,i,n)})),Ls=Yr((function(e,t,i){var r=3;if(i.length){var n=li(i,co(Ls));r|=o}return Qn(t,r,e,i,n)}));function Ds(i,r,n){var o,s,a,l,c,u,h=0,d=!1,p=!1,f=!0;if("function"!=typeof i)throw new Ie(t);function m(t){var r=o,n=s;return o=s=e,h=t,l=i.apply(n,r)}function g(e){return h=e,c=Do(_,r),d?m(e):l}function y(t){var i=t-u;return u===e||i>=r||i<0||p&&t-h>=a}function _(){var e=As();if(y(e))return v(e);c=Do(_,function(e){var t=r-(e-u);return p?xi(t,a-(e-h)):t}(e))}function v(t){return c=e,f&&o?m(t):(o=s=e,l)}function x(){var t=As(),i=y(t);if(o=arguments,s=this,u=t,i){if(c===e)return g(u);if(p)return Sn(c),c=Do(_,r),m(u)}return c===e&&(c=Do(_,r)),l}return r=va(r)||0,ra(n)&&(d=!!n.leading,a=(p="maxWait"in n)?vi(va(n.maxWait)||0,r):a,f="trailing"in n?!!n.trailing:f),x.cancel=function(){c!==e&&Sn(c),h=0,o=u=s=c=e},x.flush=function(){return c===e?l:v(As())},x}var Rs=Yr((function(e,t){return hr(e,1,t)})),Bs=Yr((function(e,t,i){return hr(e,va(t)||0,i)}));function Os(e,i){if("function"!=typeof e||null!=i&&"function"!=typeof i)throw new Ie(t);var r=function(){var t=arguments,n=i?i.apply(this,t):t[0],o=r.cache;if(o.has(n))return o.get(n);var s=e.apply(this,t);return r.cache=o.set(n,s)||o,s};return r.cache=new(Os.Cache||Hi),r}function Fs(e){if("function"!=typeof e)throw new Ie(t);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Os.Cache=Hi;var js=wn((function(e,t){var i=(t=1==t.length&&Ws(t[0])?Pt(t[0],Kt(uo())):Pt(_r(t,1),Kt(uo()))).length;return Yr((function(r){for(var n=-1,o=xi(r.length,i);++n<o;)r[n]=t[n].call(this,r[n]);return St(e,this,r)}))})),$s=Yr((function(t,i){var r=li(i,co($s));return Qn(t,o,e,i,r)})),Ns=Yr((function(t,i){var r=li(i,co(Ns));return Qn(t,s,e,i,r)})),Us=no((function(t,i){return Qn(t,l,e,e,e,i)}));function Vs(e,t){return e===t||e!=e&&t!=t}var Gs=Hn(kr),qs=Hn((function(e,t){return e>=t})),Zs=Pr(function(){return arguments}())?Pr:function(e){return na(e)&&Be.call(e,"callee")&&!Xe.call(e,"callee")},Ws=we.isArray,Hs=_t?Kt(_t):function(e){return na(e)&&Mr(e)==I};function Xs(e){return null!=e&&ia(e.length)&&!ea(e)}function Ks(e){return na(e)&&Xs(e)}var Ys=qt||vl,Js=vt?Kt(vt):function(e){return na(e)&&Mr(e)==y};function Qs(e){if(!na(e))return!1;var t=Mr(e);return t==_||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!aa(e)}function ea(e){if(!ra(e))return!1;var t=Mr(e);return t==v||t==x||"[object AsyncFunction]"==t||"[object Proxy]"==t}function ta(e){return"number"==typeof e&&e==ya(e)}function ia(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=u}function ra(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function na(e){return null!=e&&"object"==typeof e}var oa=xt?Kt(xt):function(e){return na(e)&&yo(e)==b};function sa(e){return"number"==typeof e||na(e)&&Mr(e)==w}function aa(e){if(!na(e)||Mr(e)!=T)return!1;var t=We(e);if(null===t)return!0;var i=Be.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Re.call(i)==$e}var la=bt?Kt(bt):function(e){return na(e)&&Mr(e)==C},ca=wt?Kt(wt):function(e){return na(e)&&yo(e)==M};function ua(e){return"string"==typeof e||!Ws(e)&&na(e)&&Mr(e)==k}function ha(e){return"symbol"==typeof e||na(e)&&Mr(e)==E}var da=Tt?Kt(Tt):function(e){return na(e)&&ia(e.length)&&!!ot[Mr(e)]},pa=Hn(jr),fa=Hn((function(e,t){return e<=t}));function ma(e){if(!e)return[];if(Xs(e))return ua(e)?di(e):zn(e);if(tt&&e[tt])return function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i}(e[tt]());var t=yo(e);return(t==b?si:t==M?ci:Va)(e)}function ga(e){return e?(e=va(e))===c||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ya(e){var t=ga(e),i=t%1;return t==t?i?t-i:t:0}function _a(e){return e?lr(ya(e),0,d):0}function va(e){if("number"==typeof e)return e;if(ha(e))return h;if(ra(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ra(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Xt(e);var i=pe.test(e);return i||me.test(e)?ct(e.slice(2),i?2:8):de.test(e)?h:+e}function xa(e){return Pn(e,Ra(e))}function ba(e){return null==e?"":hn(e)}var wa=Dn((function(e,t){if(Mo(t)||Xs(t))Pn(t,Da(t),e);else for(var i in t)Be.call(t,i)&&ir(e,i,t[i])})),Ta=Dn((function(e,t){Pn(t,Ra(t),e)})),Sa=Dn((function(e,t,i,r){Pn(t,Ra(t),e,r)})),Ca=Dn((function(e,t,i,r){Pn(t,Da(t),e,r)})),Ma=no(ar),ka=Yr((function(t,i){t=ke(t);var r=-1,n=i.length,o=n>2?i[2]:e;for(o&&wo(i[0],i[1],o)&&(n=1);++r<n;)for(var s=i[r],a=Ra(s),l=-1,c=a.length;++l<c;){var u=a[l],h=t[u];(h===e||Vs(h,Le[u])&&!Be.call(t,u))&&(t[u]=s[u])}return t})),Ea=Yr((function(t){return t.push(e,to),St(Oa,e,t)}));function Aa(t,i,r){var n=null==t?e:Sr(t,i);return n===e?r:n}function Ia(e,t){return null!=e&&_o(e,t,Ar)}var za=Vn((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=je.call(t)),e[t]=i}),rl(sl)),Pa=Vn((function(e,t,i){null!=t&&"function"!=typeof t.toString&&(t=je.call(t)),Be.call(e,t)?e[t].push(i):e[t]=[i]}),uo),La=Yr(zr);function Da(e){return Xs(e)?Yi(e):Or(e)}function Ra(e){return Xs(e)?Yi(e,!0):Fr(e)}var Ba=Dn((function(e,t,i){Vr(e,t,i)})),Oa=Dn((function(e,t,i,r){Vr(e,t,i,r)})),Fa=no((function(e,t){var i={};if(null==e)return i;var r=!1;t=Pt(t,(function(t){return t=bn(t,e),r||(r=t.length>1),t})),Pn(e,so(e),i),r&&(i=cr(i,7,io));for(var n=t.length;n--;)pn(i,t[n]);return i})),ja=no((function(e,t){return null==e?{}:function(e,t){return Zr(e,t,(function(t,i){return Ia(e,i)}))}(e,t)}));function $a(e,t){if(null==e)return{};var i=Pt(so(e),(function(e){return[e]}));return t=uo(t),Zr(e,i,(function(e,i){return t(e,i[0])}))}var Na=Jn(Da),Ua=Jn(Ra);function Va(e){return null==e?[]:Yt(e,Da(e))}var Ga=Fn((function(e,t,i){return t=t.toLowerCase(),e+(i?qa(t):t)}));function qa(e){return Qa(ba(e).toLowerCase())}function Za(e){return(e=ba(e))&&e.replace(ye,ii).replace(Je,"")}var Wa=Fn((function(e,t,i){return e+(i?"-":"")+t.toLowerCase()})),Ha=Fn((function(e,t,i){return e+(i?" ":"")+t.toLowerCase()})),Xa=On("toLowerCase"),Ka=Fn((function(e,t,i){return e+(i?"_":"")+t.toLowerCase()})),Ya=Fn((function(e,t,i){return e+(i?" ":"")+Qa(t)})),Ja=Fn((function(e,t,i){return e+(i?" ":"")+t.toUpperCase()})),Qa=On("toUpperCase");function el(t,i,r){return t=ba(t),(i=r?e:i)===e?function(e){return it.test(e)}(t)?function(e){return e.match(et)||[]}(t):function(e){return e.match(ae)||[]}(t):t.match(i)||[]}var tl=Yr((function(t,i){try{return St(t,e,i)}catch(e){return Qs(e)?e:new Se(e)}})),il=no((function(e,t){return Mt(t,(function(t){t=$o(t),sr(e,t,Ps(e[t],e))})),e}));function rl(e){return function(){return e}}var nl=Nn(),ol=Nn(!0);function sl(e){return e}function al(e){return Br("function"==typeof e?e:cr(e,1))}var ll=Yr((function(e,t){return function(i){return zr(i,e,t)}})),cl=Yr((function(e,t){return function(i){return zr(e,i,t)}}));function ul(e,t,i){var r=Da(t),n=Tr(t,r);null!=i||ra(t)&&(n.length||!r.length)||(i=t,t=e,e=this,n=Tr(t,Da(t)));var o=!(ra(i)&&"chain"in i&&!i.chain),s=ea(e);return Mt(n,(function(i){var r=t[i];e[i]=r,s&&(e.prototype[i]=function(){var t=this.__chain__;if(o||t){var i=e(this.__wrapped__),n=i.__actions__=zn(this.__actions__);return n.push({func:r,args:arguments,thisArg:e}),i.__chain__=t,i}return r.apply(e,Lt([this.value()],arguments))})})),e}function hl(){}var dl=qn(Pt),pl=qn(Et),fl=qn(Bt);function ml(e){return To(e)?Gt($o(e)):function(e){return function(t){return Sr(t,e)}}(e)}var gl=Wn(),yl=Wn(!0);function _l(){return[]}function vl(){return!1}var xl=Gn((function(e,t){return e+t}),0),bl=Kn("ceil"),wl=Gn((function(e,t){return e/t}),1),Tl=Kn("floor"),Sl=Gn((function(e,t){return e*t}),1),Cl=Kn("round"),Ml=Gn((function(e,t){return e-t}),0);return Ni.after=function(e,i){if("function"!=typeof i)throw new Ie(t);return e=ya(e),function(){if(--e<1)return i.apply(this,arguments)}},Ni.ary=Is,Ni.assign=wa,Ni.assignIn=Ta,Ni.assignInWith=Sa,Ni.assignWith=Ca,Ni.at=Ma,Ni.before=zs,Ni.bind=Ps,Ni.bindAll=il,Ni.bindKey=Ls,Ni.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Ws(e)?e:[e]},Ni.chain=ms,Ni.chunk=function(t,i,r){i=(r?wo(t,i,r):i===e)?1:vi(ya(i),0);var n=null==t?0:t.length;if(!n||i<1)return[];for(var o=0,s=0,a=we(gt(n/i));o<n;)a[s++]=on(t,o,o+=i);return a},Ni.compact=function(e){for(var t=-1,i=null==e?0:e.length,r=0,n=[];++t<i;){var o=e[t];o&&(n[r++]=o)}return n},Ni.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),i=arguments[0],r=e;r--;)t[r-1]=arguments[r];return Lt(Ws(i)?zn(i):[i],_r(t,1))},Ni.cond=function(e){var i=null==e?0:e.length,r=uo();return e=i?Pt(e,(function(e){if("function"!=typeof e[1])throw new Ie(t);return[r(e[0]),e[1]]})):[],Yr((function(t){for(var r=-1;++r<i;){var n=e[r];if(St(n[0],this,t))return St(n[1],this,t)}}))},Ni.conforms=function(e){return function(e){var t=Da(e);return function(i){return ur(i,e,t)}}(cr(e,1))},Ni.constant=rl,Ni.countBy=_s,Ni.create=function(e,t){var i=Ui(e);return null==t?i:or(i,t)},Ni.curry=function t(i,r,n){var o=Qn(i,8,e,e,e,e,e,r=n?e:r);return o.placeholder=t.placeholder,o},Ni.curryRight=function t(i,r,o){var s=Qn(i,n,e,e,e,e,e,r=o?e:r);return s.placeholder=t.placeholder,s},Ni.debounce=Ds,Ni.defaults=ka,Ni.defaultsDeep=Ea,Ni.defer=Rs,Ni.delay=Bs,Ni.difference=Vo,Ni.differenceBy=Go,Ni.differenceWith=qo,Ni.drop=function(t,i,r){var n=null==t?0:t.length;return n?on(t,(i=r||i===e?1:ya(i))<0?0:i,n):[]},Ni.dropRight=function(t,i,r){var n=null==t?0:t.length;return n?on(t,0,(i=n-(i=r||i===e?1:ya(i)))<0?0:i):[]},Ni.dropRightWhile=function(e,t){return e&&e.length?mn(e,uo(t,3),!0,!0):[]},Ni.dropWhile=function(e,t){return e&&e.length?mn(e,uo(t,3),!0):[]},Ni.fill=function(t,i,r,n){var o=null==t?0:t.length;return o?(r&&"number"!=typeof r&&wo(t,i,r)&&(r=0,n=o),function(t,i,r,n){var o=t.length;for((r=ya(r))<0&&(r=-r>o?0:o+r),(n=n===e||n>o?o:ya(n))<0&&(n+=o),n=r>n?0:_a(n);r<n;)t[r++]=i;return t}(t,i,r,n)):[]},Ni.filter=function(e,t){return(Ws(e)?At:yr)(e,uo(t,3))},Ni.flatMap=function(e,t){return _r(Ms(e,t),1)},Ni.flatMapDeep=function(e,t){return _r(Ms(e,t),c)},Ni.flatMapDepth=function(t,i,r){return r=r===e?1:ya(r),_r(Ms(t,i),r)},Ni.flatten=Ho,Ni.flattenDeep=function(e){return null!=e&&e.length?_r(e,c):[]},Ni.flattenDepth=function(t,i){return null!=t&&t.length?_r(t,i=i===e?1:ya(i)):[]},Ni.flip=function(e){return Qn(e,512)},Ni.flow=nl,Ni.flowRight=ol,Ni.fromPairs=function(e){for(var t=-1,i=null==e?0:e.length,r={};++t<i;){var n=e[t];r[n[0]]=n[1]}return r},Ni.functions=function(e){return null==e?[]:Tr(e,Da(e))},Ni.functionsIn=function(e){return null==e?[]:Tr(e,Ra(e))},Ni.groupBy=Ts,Ni.initial=function(e){return null!=e&&e.length?on(e,0,-1):[]},Ni.intersection=Ko,Ni.intersectionBy=Yo,Ni.intersectionWith=Jo,Ni.invert=za,Ni.invertBy=Pa,Ni.invokeMap=Ss,Ni.iteratee=al,Ni.keyBy=Cs,Ni.keys=Da,Ni.keysIn=Ra,Ni.map=Ms,Ni.mapKeys=function(e,t){var i={};return t=uo(t,3),br(e,(function(e,r,n){sr(i,t(e,r,n),e)})),i},Ni.mapValues=function(e,t){var i={};return t=uo(t,3),br(e,(function(e,r,n){sr(i,r,t(e,r,n))})),i},Ni.matches=function(e){return Nr(cr(e,1))},Ni.matchesProperty=function(e,t){return Ur(e,cr(t,1))},Ni.memoize=Os,Ni.merge=Ba,Ni.mergeWith=Oa,Ni.method=ll,Ni.methodOf=cl,Ni.mixin=ul,Ni.negate=Fs,Ni.nthArg=function(e){return e=ya(e),Yr((function(t){return Gr(t,e)}))},Ni.omit=Fa,Ni.omitBy=function(e,t){return $a(e,Fs(uo(t)))},Ni.once=function(e){return zs(2,e)},Ni.orderBy=function(t,i,r,n){return null==t?[]:(Ws(i)||(i=null==i?[]:[i]),Ws(r=n?e:r)||(r=null==r?[]:[r]),qr(t,i,r))},Ni.over=dl,Ni.overArgs=js,Ni.overEvery=pl,Ni.overSome=fl,Ni.partial=$s,Ni.partialRight=Ns,Ni.partition=ks,Ni.pick=ja,Ni.pickBy=$a,Ni.property=ml,Ni.propertyOf=function(t){return function(i){return null==t?e:Sr(t,i)}},Ni.pull=es,Ni.pullAll=ts,Ni.pullAllBy=function(e,t,i){return e&&e.length&&t&&t.length?Wr(e,t,uo(i,2)):e},Ni.pullAllWith=function(t,i,r){return t&&t.length&&i&&i.length?Wr(t,i,e,r):t},Ni.pullAt=is,Ni.range=gl,Ni.rangeRight=yl,Ni.rearg=Us,Ni.reject=function(e,t){return(Ws(e)?At:yr)(e,Fs(uo(t,3)))},Ni.remove=function(e,t){var i=[];if(!e||!e.length)return i;var r=-1,n=[],o=e.length;for(t=uo(t,3);++r<o;){var s=e[r];t(s,r,e)&&(i.push(s),n.push(r))}return Hr(e,n),i},Ni.rest=function(i,r){if("function"!=typeof i)throw new Ie(t);return Yr(i,r=r===e?r:ya(r))},Ni.reverse=rs,Ni.sampleSize=function(t,i,r){return i=(r?wo(t,i,r):i===e)?1:ya(i),(Ws(t)?Qi:Qr)(t,i)},Ni.set=function(e,t,i){return null==e?e:en(e,t,i)},Ni.setWith=function(t,i,r,n){return n="function"==typeof n?n:e,null==t?t:en(t,i,r,n)},Ni.shuffle=function(e){return(Ws(e)?er:nn)(e)},Ni.slice=function(t,i,r){var n=null==t?0:t.length;return n?(r&&"number"!=typeof r&&wo(t,i,r)?(i=0,r=n):(i=null==i?0:ya(i),r=r===e?n:ya(r)),on(t,i,r)):[]},Ni.sortBy=Es,Ni.sortedUniq=function(e){return e&&e.length?cn(e):[]},Ni.sortedUniqBy=function(e,t){return e&&e.length?cn(e,uo(t,2)):[]},Ni.split=function(t,i,r){return r&&"number"!=typeof r&&wo(t,i,r)&&(i=r=e),(r=r===e?d:r>>>0)?(t=ba(t))&&("string"==typeof i||null!=i&&!la(i))&&!(i=hn(i))&&oi(t)?Tn(di(t),0,r):t.split(i,r):[]},Ni.spread=function(e,i){if("function"!=typeof e)throw new Ie(t);return i=null==i?0:vi(ya(i),0),Yr((function(t){var r=t[i],n=Tn(t,0,i);return r&&Lt(n,r),St(e,this,n)}))},Ni.tail=function(e){var t=null==e?0:e.length;return t?on(e,1,t):[]},Ni.take=function(t,i,r){return t&&t.length?on(t,0,(i=r||i===e?1:ya(i))<0?0:i):[]},Ni.takeRight=function(t,i,r){var n=null==t?0:t.length;return n?on(t,(i=n-(i=r||i===e?1:ya(i)))<0?0:i,n):[]},Ni.takeRightWhile=function(e,t){return e&&e.length?mn(e,uo(t,3),!1,!0):[]},Ni.takeWhile=function(e,t){return e&&e.length?mn(e,uo(t,3)):[]},Ni.tap=function(e,t){return t(e),e},Ni.throttle=function(e,i,r){var n=!0,o=!0;if("function"!=typeof e)throw new Ie(t);return ra(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),Ds(e,i,{leading:n,maxWait:i,trailing:o})},Ni.thru=gs,Ni.toArray=ma,Ni.toPairs=Na,Ni.toPairsIn=Ua,Ni.toPath=function(e){return Ws(e)?Pt(e,$o):ha(e)?[e]:zn(jo(ba(e)))},Ni.toPlainObject=xa,Ni.transform=function(e,t,i){var r=Ws(e),n=r||Ys(e)||da(e);if(t=uo(t,4),null==i){var o=e&&e.constructor;i=n?r?new o:[]:ra(e)&&ea(o)?Ui(We(e)):{}}return(n?Mt:br)(e,(function(e,r,n){return t(i,e,r,n)})),i},Ni.unary=function(e){return Is(e,1)},Ni.union=ns,Ni.unionBy=os,Ni.unionWith=ss,Ni.uniq=function(e){return e&&e.length?dn(e):[]},Ni.uniqBy=function(e,t){return e&&e.length?dn(e,uo(t,2)):[]},Ni.uniqWith=function(t,i){return i="function"==typeof i?i:e,t&&t.length?dn(t,e,i):[]},Ni.unset=function(e,t){return null==e||pn(e,t)},Ni.unzip=as,Ni.unzipWith=ls,Ni.update=function(e,t,i){return null==e?e:fn(e,t,xn(i))},Ni.updateWith=function(t,i,r,n){return n="function"==typeof n?n:e,null==t?t:fn(t,i,xn(r),n)},Ni.values=Va,Ni.valuesIn=function(e){return null==e?[]:Yt(e,Ra(e))},Ni.without=cs,Ni.words=el,Ni.wrap=function(e,t){return $s(xn(t),e)},Ni.xor=us,Ni.xorBy=hs,Ni.xorWith=ds,Ni.zip=ps,Ni.zipObject=function(e,t){return _n(e||[],t||[],ir)},Ni.zipObjectDeep=function(e,t){return _n(e||[],t||[],en)},Ni.zipWith=fs,Ni.entries=Na,Ni.entriesIn=Ua,Ni.extend=Ta,Ni.extendWith=Sa,ul(Ni,Ni),Ni.add=xl,Ni.attempt=tl,Ni.camelCase=Ga,Ni.capitalize=qa,Ni.ceil=bl,Ni.clamp=function(t,i,r){return r===e&&(r=i,i=e),r!==e&&(r=(r=va(r))==r?r:0),i!==e&&(i=(i=va(i))==i?i:0),lr(va(t),i,r)},Ni.clone=function(e){return cr(e,4)},Ni.cloneDeep=function(e){return cr(e,5)},Ni.cloneDeepWith=function(t,i){return cr(t,5,i="function"==typeof i?i:e)},Ni.cloneWith=function(t,i){return cr(t,4,i="function"==typeof i?i:e)},Ni.conformsTo=function(e,t){return null==t||ur(e,t,Da(t))},Ni.deburr=Za,Ni.defaultTo=function(e,t){return null==e||e!=e?t:e},Ni.divide=wl,Ni.endsWith=function(t,i,r){t=ba(t),i=hn(i);var n=t.length,o=r=r===e?n:lr(ya(r),0,n);return(r-=i.length)>=0&&t.slice(r,o)==i},Ni.eq=Vs,Ni.escape=function(e){return(e=ba(e))&&W.test(e)?e.replace(q,ri):e},Ni.escapeRegExp=function(e){return(e=ba(e))&&te.test(e)?e.replace(ee,"\\$&"):e},Ni.every=function(t,i,r){var n=Ws(t)?Et:mr;return r&&wo(t,i,r)&&(i=e),n(t,uo(i,3))},Ni.find=vs,Ni.findIndex=Zo,Ni.findKey=function(e,t){return Ft(e,uo(t,3),br)},Ni.findLast=xs,Ni.findLastIndex=Wo,Ni.findLastKey=function(e,t){return Ft(e,uo(t,3),wr)},Ni.floor=Tl,Ni.forEach=bs,Ni.forEachRight=ws,Ni.forIn=function(e,t){return null==e?e:vr(e,uo(t,3),Ra)},Ni.forInRight=function(e,t){return null==e?e:xr(e,uo(t,3),Ra)},Ni.forOwn=function(e,t){return e&&br(e,uo(t,3))},Ni.forOwnRight=function(e,t){return e&&wr(e,uo(t,3))},Ni.get=Aa,Ni.gt=Gs,Ni.gte=qs,Ni.has=function(e,t){return null!=e&&_o(e,t,Er)},Ni.hasIn=Ia,Ni.head=Xo,Ni.identity=sl,Ni.includes=function(e,t,i,r){e=Xs(e)?e:Va(e),i=i&&!r?ya(i):0;var n=e.length;return i<0&&(i=vi(n+i,0)),ua(e)?i<=n&&e.indexOf(t,i)>-1:!!n&&$t(e,t,i)>-1},Ni.indexOf=function(e,t,i){var r=null==e?0:e.length;if(!r)return-1;var n=null==i?0:ya(i);return n<0&&(n=vi(r+n,0)),$t(e,t,n)},Ni.inRange=function(t,i,r){return i=ga(i),r===e?(r=i,i=0):r=ga(r),function(e,t,i){return e>=xi(t,i)&&e<vi(t,i)}(t=va(t),i,r)},Ni.invoke=La,Ni.isArguments=Zs,Ni.isArray=Ws,Ni.isArrayBuffer=Hs,Ni.isArrayLike=Xs,Ni.isArrayLikeObject=Ks,Ni.isBoolean=function(e){return!0===e||!1===e||na(e)&&Mr(e)==g},Ni.isBuffer=Ys,Ni.isDate=Js,Ni.isElement=function(e){return na(e)&&1===e.nodeType&&!aa(e)},Ni.isEmpty=function(e){if(null==e)return!0;if(Xs(e)&&(Ws(e)||"string"==typeof e||"function"==typeof e.splice||Ys(e)||da(e)||Zs(e)))return!e.length;var t=yo(e);if(t==b||t==M)return!e.size;if(Mo(e))return!Or(e).length;for(var i in e)if(Be.call(e,i))return!1;return!0},Ni.isEqual=function(e,t){return Lr(e,t)},Ni.isEqualWith=function(t,i,r){var n=(r="function"==typeof r?r:e)?r(t,i):e;return n===e?Lr(t,i,e,r):!!n},Ni.isError=Qs,Ni.isFinite=function(e){return"number"==typeof e&&gi(e)},Ni.isFunction=ea,Ni.isInteger=ta,Ni.isLength=ia,Ni.isMap=oa,Ni.isMatch=function(e,t){return e===t||Dr(e,t,po(t))},Ni.isMatchWith=function(t,i,r){return r="function"==typeof r?r:e,Dr(t,i,po(i),r)},Ni.isNaN=function(e){return sa(e)&&e!=+e},Ni.isNative=function(e){if(Co(e))throw new Se("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Rr(e)},Ni.isNil=function(e){return null==e},Ni.isNull=function(e){return null===e},Ni.isNumber=sa,Ni.isObject=ra,Ni.isObjectLike=na,Ni.isPlainObject=aa,Ni.isRegExp=la,Ni.isSafeInteger=function(e){return ta(e)&&e>=-9007199254740991&&e<=u},Ni.isSet=ca,Ni.isString=ua,Ni.isSymbol=ha,Ni.isTypedArray=da,Ni.isUndefined=function(t){return t===e},Ni.isWeakMap=function(e){return na(e)&&yo(e)==A},Ni.isWeakSet=function(e){return na(e)&&"[object WeakSet]"==Mr(e)},Ni.join=function(e,t){return null==e?"":yi.call(e,t)},Ni.kebabCase=Wa,Ni.last=Qo,Ni.lastIndexOf=function(t,i,r){var n=null==t?0:t.length;if(!n)return-1;var o=n;return r!==e&&(o=(o=ya(r))<0?vi(n+o,0):xi(o,n-1)),i==i?function(e,t,i){for(var r=i+1;r--;)if(e[r]===t)return r;return r}(t,i,o):jt(t,Ut,o,!0)},Ni.lowerCase=Ha,Ni.lowerFirst=Xa,Ni.lt=pa,Ni.lte=fa,Ni.max=function(t){return t&&t.length?gr(t,sl,kr):e},Ni.maxBy=function(t,i){return t&&t.length?gr(t,uo(i,2),kr):e},Ni.mean=function(e){return Vt(e,sl)},Ni.meanBy=function(e,t){return Vt(e,uo(t,2))},Ni.min=function(t){return t&&t.length?gr(t,sl,jr):e},Ni.minBy=function(t,i){return t&&t.length?gr(t,uo(i,2),jr):e},Ni.stubArray=_l,Ni.stubFalse=vl,Ni.stubObject=function(){return{}},Ni.stubString=function(){return""},Ni.stubTrue=function(){return!0},Ni.multiply=Sl,Ni.nth=function(t,i){return t&&t.length?Gr(t,ya(i)):e},Ni.noConflict=function(){return dt._===this&&(dt._=Ne),this},Ni.noop=hl,Ni.now=As,Ni.pad=function(e,t,i){e=ba(e);var r=(t=ya(t))?hi(e):0;if(!t||r>=t)return e;var n=(t-r)/2;return Zn(yt(n),i)+e+Zn(gt(n),i)},Ni.padEnd=function(e,t,i){e=ba(e);var r=(t=ya(t))?hi(e):0;return t&&r<t?e+Zn(t-r,i):e},Ni.padStart=function(e,t,i){e=ba(e);var r=(t=ya(t))?hi(e):0;return t&&r<t?Zn(t-r,i)+e:e},Ni.parseInt=function(e,t,i){return i||null==t?t=0:t&&(t=+t),wi(ba(e).replace(ie,""),t||0)},Ni.random=function(t,i,r){if(r&&"boolean"!=typeof r&&wo(t,i,r)&&(i=r=e),r===e&&("boolean"==typeof i?(r=i,i=e):"boolean"==typeof t&&(r=t,t=e)),t===e&&i===e?(t=0,i=1):(t=ga(t),i===e?(i=t,t=0):i=ga(i)),t>i){var n=t;t=i,i=n}if(r||t%1||i%1){var o=Ti();return xi(t+o*(i-t+lt("1e-"+((o+"").length-1))),i)}return Xr(t,i)},Ni.reduce=function(e,t,i){var r=Ws(e)?Dt:Zt,n=arguments.length<3;return r(e,uo(t,4),i,n,pr)},Ni.reduceRight=function(e,t,i){var r=Ws(e)?Rt:Zt,n=arguments.length<3;return r(e,uo(t,4),i,n,fr)},Ni.repeat=function(t,i,r){return i=(r?wo(t,i,r):i===e)?1:ya(i),Kr(ba(t),i)},Ni.replace=function(){var e=arguments,t=ba(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Ni.result=function(t,i,r){var n=-1,o=(i=bn(i,t)).length;for(o||(o=1,t=e);++n<o;){var s=null==t?e:t[$o(i[n])];s===e&&(n=o,s=r),t=ea(s)?s.call(t):s}return t},Ni.round=Cl,Ni.runInContext=re,Ni.sample=function(e){return(Ws(e)?Ji:Jr)(e)},Ni.size=function(e){if(null==e)return 0;if(Xs(e))return ua(e)?hi(e):e.length;var t=yo(e);return t==b||t==M?e.size:Or(e).length},Ni.snakeCase=Ka,Ni.some=function(t,i,r){var n=Ws(t)?Bt:sn;return r&&wo(t,i,r)&&(i=e),n(t,uo(i,3))},Ni.sortedIndex=function(e,t){return an(e,t)},Ni.sortedIndexBy=function(e,t,i){return ln(e,t,uo(i,2))},Ni.sortedIndexOf=function(e,t){var i=null==e?0:e.length;if(i){var r=an(e,t);if(r<i&&Vs(e[r],t))return r}return-1},Ni.sortedLastIndex=function(e,t){return an(e,t,!0)},Ni.sortedLastIndexBy=function(e,t,i){return ln(e,t,uo(i,2),!0)},Ni.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var i=an(e,t,!0)-1;if(Vs(e[i],t))return i}return-1},Ni.startCase=Ya,Ni.startsWith=function(e,t,i){return e=ba(e),i=null==i?0:lr(ya(i),0,e.length),t=hn(t),e.slice(i,i+t.length)==t},Ni.subtract=Ml,Ni.sum=function(e){return e&&e.length?Wt(e,sl):0},Ni.sumBy=function(e,t){return e&&e.length?Wt(e,uo(t,2)):0},Ni.template=function(t,i,r){var n=Ni.templateSettings;r&&wo(t,i,r)&&(i=e),t=ba(t),i=Sa({},i,n,eo);var o,s,a=Sa({},i.imports,n.imports,eo),l=Da(a),c=Yt(a,l),u=0,h=i.interpolate||_e,d="__p += '",p=Ee((i.escape||_e).source+"|"+h.source+"|"+(h===K?ue:_e).source+"|"+(i.evaluate||_e).source+"|$","g"),f="//# sourceURL="+(Be.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++nt+"]")+"\n";t.replace(p,(function(e,i,r,n,a,l){return r||(r=n),d+=t.slice(u,l).replace(ve,ni),i&&(o=!0,d+="' +\n__e("+i+") +\n'"),a&&(s=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=l+e.length,e})),d+="';\n";var m=Be.call(i,"variable")&&i.variable;if(m){if(le.test(m))throw new Se("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(N,""):d).replace(U,"$1").replace(V,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=tl((function(){return Ce(l,f+"return "+d).apply(e,c)}));if(g.source=d,Qs(g))throw g;return g},Ni.times=function(e,t){if((e=ya(e))<1||e>u)return[];var i=d,r=xi(e,d);t=uo(t),e-=d;for(var n=Ht(r,t);++i<e;)t(i);return n},Ni.toFinite=ga,Ni.toInteger=ya,Ni.toLength=_a,Ni.toLower=function(e){return ba(e).toLowerCase()},Ni.toNumber=va,Ni.toSafeInteger=function(e){return e?lr(ya(e),-9007199254740991,u):0===e?e:0},Ni.toString=ba,Ni.toUpper=function(e){return ba(e).toUpperCase()},Ni.trim=function(t,i,r){if((t=ba(t))&&(r||i===e))return Xt(t);if(!t||!(i=hn(i)))return t;var n=di(t),o=di(i);return Tn(n,Qt(n,o),ei(n,o)+1).join("")},Ni.trimEnd=function(t,i,r){if((t=ba(t))&&(r||i===e))return t.slice(0,pi(t)+1);if(!t||!(i=hn(i)))return t;var n=di(t);return Tn(n,0,ei(n,di(i))+1).join("")},Ni.trimStart=function(t,i,r){if((t=ba(t))&&(r||i===e))return t.replace(ie,"");if(!t||!(i=hn(i)))return t;var n=di(t);return Tn(n,Qt(n,di(i))).join("")},Ni.truncate=function(t,i){var r=30,n="...";if(ra(i)){var o="separator"in i?i.separator:o;r="length"in i?ya(i.length):r,n="omission"in i?hn(i.omission):n}var s=(t=ba(t)).length;if(oi(t)){var a=di(t);s=a.length}if(r>=s)return t;var l=r-hi(n);if(l<1)return n;var c=a?Tn(a,0,l).join(""):t.slice(0,l);if(o===e)return c+n;if(a&&(l+=c.length-l),la(o)){if(t.slice(l).search(o)){var u,h=c;for(o.global||(o=Ee(o.source,ba(he.exec(o))+"g")),o.lastIndex=0;u=o.exec(h);)var d=u.index;c=c.slice(0,d===e?l:d)}}else if(t.indexOf(hn(o),l)!=l){var p=c.lastIndexOf(o);p>-1&&(c=c.slice(0,p))}return c+n},Ni.unescape=function(e){return(e=ba(e))&&Z.test(e)?e.replace(G,fi):e},Ni.uniqueId=function(e){var t=++Oe;return ba(e)+t},Ni.upperCase=Ja,Ni.upperFirst=Qa,Ni.each=bs,Ni.eachRight=ws,Ni.first=Xo,ul(Ni,function(){var e={};return br(Ni,(function(t,i){Be.call(Ni.prototype,i)||(e[i]=t)})),e}(),{chain:!1}),Ni.VERSION="4.17.21",Mt(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Ni[e].placeholder=Ni})),Mt(["drop","take"],(function(t,i){qi.prototype[t]=function(r){r=r===e?1:vi(ya(r),0);var n=this.__filtered__&&!i?new qi(this):this.clone();return n.__filtered__?n.__takeCount__=xi(r,n.__takeCount__):n.__views__.push({size:xi(r,d),type:t+(n.__dir__<0?"Right":"")}),n},qi.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Mt(["filter","map","takeWhile"],(function(e,t){var i=t+1,r=1==i||3==i;qi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:uo(e,3),type:i}),t.__filtered__=t.__filtered__||r,t}})),Mt(["head","last"],(function(e,t){var i="take"+(t?"Right":"");qi.prototype[e]=function(){return this[i](1).value()[0]}})),Mt(["initial","tail"],(function(e,t){var i="drop"+(t?"":"Right");qi.prototype[e]=function(){return this.__filtered__?new qi(this):this[i](1)}})),qi.prototype.compact=function(){return this.filter(sl)},qi.prototype.find=function(e){return this.filter(e).head()},qi.prototype.findLast=function(e){return this.reverse().find(e)},qi.prototype.invokeMap=Yr((function(e,t){return"function"==typeof e?new qi(this):this.map((function(i){return zr(i,e,t)}))})),qi.prototype.reject=function(e){return this.filter(Fs(uo(e)))},qi.prototype.slice=function(t,i){t=ya(t);var r=this;return r.__filtered__&&(t>0||i<0)?new qi(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),i!==e&&(r=(i=ya(i))<0?r.dropRight(-i):r.take(i-t)),r)},qi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},qi.prototype.toArray=function(){return this.take(d)},br(qi.prototype,(function(t,i){var r=/^(?:filter|find|map|reject)|While$/.test(i),n=/^(?:head|last)$/.test(i),o=Ni[n?"take"+("last"==i?"Right":""):i],s=n||/^find/.test(i);o&&(Ni.prototype[i]=function(){var i=this.__wrapped__,a=n?[1]:arguments,l=i instanceof qi,c=a[0],u=l||Ws(i),h=function(e){var t=o.apply(Ni,Lt([e],a));return n&&d?t[0]:t};u&&r&&"function"==typeof c&&1!=c.length&&(l=u=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&u){i=m?i:new qi(this);var g=t.apply(i,a);return g.__actions__.push({func:gs,args:[h],thisArg:e}),new Gi(g,d)}return f&&m?t.apply(this,a):(g=this.thru(h),f?n?g.value()[0]:g.value():g)})})),Mt(["pop","push","shift","sort","splice","unshift"],(function(e){var t=ze[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);Ni.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var n=this.value();return t.apply(Ws(n)?n:[],e)}return this[i]((function(i){return t.apply(Ws(i)?i:[],e)}))}})),br(qi.prototype,(function(e,t){var i=Ni[t];if(i){var r=i.name+"";Be.call(Pi,r)||(Pi[r]=[]),Pi[r].push({name:t,func:i})}})),Pi[Un(e,2).name]=[{name:"wrapper",func:e}],qi.prototype.clone=function(){var e=new qi(this.__wrapped__);return e.__actions__=zn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=zn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=zn(this.__views__),e},qi.prototype.reverse=function(){if(this.__filtered__){var e=new qi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},qi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,i=Ws(e),r=t<0,n=i?e.length:0,o=function(e,t,i){for(var r=-1,n=i.length;++r<n;){var o=i[r],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=xi(t,e+s);break;case"takeRight":e=vi(e,t-s)}}return{start:e,end:t}}(0,n,this.__views__),s=o.start,a=o.end,l=a-s,c=r?a:s-1,u=this.__iteratees__,h=u.length,d=0,p=xi(l,this.__takeCount__);if(!i||!r&&n==l&&p==l)return gn(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[c+=t];++m<h;){var y=u[m],_=y.iteratee,v=y.type,x=_(g);if(2==v)g=x;else if(!x){if(1==v)continue e;break e}}f[d++]=g}return f},Ni.prototype.at=ys,Ni.prototype.chain=function(){return ms(this)},Ni.prototype.commit=function(){return new Gi(this.value(),this.__chain__)},Ni.prototype.next=function(){this.__values__===e&&(this.__values__=ma(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?e:this.__values__[this.__index__++]}},Ni.prototype.plant=function(t){for(var i,r=this;r instanceof Vi;){var n=Uo(r);n.__index__=0,n.__values__=e,i?o.__wrapped__=n:i=n;var o=n;r=r.__wrapped__}return o.__wrapped__=t,i},Ni.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof qi){var i=t;return this.__actions__.length&&(i=new qi(this)),(i=i.reverse()).__actions__.push({func:gs,args:[rs],thisArg:e}),new Gi(i,this.__chain__)}return this.thru(rs)},Ni.prototype.toJSON=Ni.prototype.valueOf=Ni.prototype.value=function(){return gn(this.__wrapped__,this.__actions__)},Ni.prototype.first=Ni.prototype.head,tt&&(Ni.prototype[tt]=function(){return this}),Ni}();ft?((ft.exports=mi)._=mi,pt._=mi):dt._=mi}.call(xe);var Me=Ce.exports;const ke=(e,t)=>Math.round(e*10**t)/10**t,Ee=["locations","routeLines","deviceSize","routingOptions","speedOptions","maneuverOptions","styleUrl"],Ae=[],Ie=["bearing","center","pitch","zoom"],ze=["bearing","lat","lng","pitch","zoom","durationMultiplier"];function Pe(e){let t=Object.fromEntries(Object.entries(e).filter((([e,t])=>!Ie.includes(e))).map((([e,t])=>[e,Ee.includes(e)&&null!==t?JSON.stringify(t):t])));var i;i=t,t=Object.keys(i).reduce(((e,t)=>{const r=i[t];return null!==r&&(e[t]=r),e}),{}),window.location.hash=function(e){let t=e.map?`map=${e.map}`:"";const i=["map","stylePresets"];return Object.entries(e).forEach((([e,r],n)=>{if(i.includes(e))return;let o=encodeURIComponent(r);t=`${t}${""!==t?"&":""}${e}=${o}`})),t}({map:[ke(e.zoom,2),ke(e.center.lat,4),ke(e.center.lng,4),ke(e.pitch,1),ke(e.bearing,1)].join("/"),...t})}const Le=[];function De(e,t=i){let r;const n=new Set;function o(t){if(l(e,t)&&(e=t,r)){const t=!Le.length;for(const t of n)t[1](),Le.push(t,e);if(t){for(let e=0;e<Le.length;e+=2)Le[e][0](Le[e+1]);Le.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(s,a=i){const l=[s,a];return n.add(l),1===n.size&&(r=t(o)||i),s(e),()=>{n.delete(l),0===n.size&&(r(),r=null)}}}}const Re="puck",Be=["destination-pin",Re],Oe=[{id:"a",center:null,locationText:""},{id:"b",center:null,locationText:""}],Fe="route-line-internal-mock-source",je={type:"geojson",data:{type:"FeatureCollection",features:[]}},$e={layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"cyan","line-width":["interpolate",["exponential",1.5],["zoom"],5,.75,18,32]}},Ne=["turn","new name","depart","arrive","merge","on ramp","off ramp","fork","end of road","continue","roundabout","rotary","roundabout turn","notification","exit roundabout","exit rotary"],Ue={speed:.1,pitch:1,zoom:.1},Ve=function(e){let t=Object.fromEntries(Object.entries(function(e){const t=e.split("#")[1];if(!t)return{};let i=Object.fromEntries(t.split("&").map((e=>e.split("=").map(decodeURIComponent))));if(i.map){const[e,t,r,n,o]=i.map.split("/");i={...i,bearing:o,lat:t,lng:r,pitch:n,zoom:e}}return i}(e)).filter((([e,t])=>!!t)).map((([e,t])=>Ee.includes(e)?[e,JSON.parse(t)]:Ae.includes(e)?[e,"true"===t]:ze.includes(e)?[e,+t||0]:[e,t])));if(t.lat&&t.lng){const{lat:e,lng:i}=t;t.center={lat:e,lng:i},delete t.lat,delete t.lng}return t.map&&delete t.map,t}(window.location.hash),Ge=De({}),qe=["locations"],Ze=De(Object.keys(Ve).reduce(((e,t)=>(qe.includes(t)&&(e[t]=Ve[t]),e)),{})),We=["bearing","center","pitch","zoom"],He=De(Object.keys(Ve).reduce(((e,t)=>(We.includes(t)&&(e[t]=Ve[t]),e)),{})),Xe=De(null),Ke=De({puck:null,"destination-pin":null}),Ye=De(Ve.styleUrl||""),Je=De(Ve?.routeLines?Ve?.routeLines.map(((e,t)=>({id:`route-line-internal-mock-layer_${t}`,type:"line",source:Fe,...{layout:e?.layout,paint:e?.paint}}))):[{id:"route-line-internal-mock-layer_0",type:"line",source:Fe,...$e}]),Qe=De(Ve.deviceSize||null),et=De({loading:!1}),tt=["durationMultiplier","routingOptions","speedOptions","maneuverOptions"];const it=De(Object.keys(Ve).reduce(((e,t)=>(tt.includes(t)&&(e[t]=Ve[t]),e)),{}));function rt(e){let t,i,n,o,s,a,l;const c=[e[3]];var u=e[2];function h(e){let t={};for(let e=0;e<c.length;e+=1)t=r(t,c[e]);return{props:t}}return u&&(s=new u(h())),{c(){t=w("div"),i=w("div"),o=C(),s&&me(s.$$.fragment),A(i,"class","outline svelte-ni5cvj"),A(i,"style",n=`height:${e[0]+40}px; width:${e[1]+40}px`),A(t,"class","layout svelte-ni5cvj"),A(t,"style",a=`height:${e[0]}px; width:${e[1]}px`)},m(e,r){v(e,t,r),_(t,i),_(t,o),s&&ge(s,t,null),l=!0},p(e,[r]){(!l||3&r&&n!==(n=`height:${e[0]+40}px; width:${e[1]+40}px`))&&A(i,"style",n);const o=8&r?de(c,[pe(e[3])]):{};if(u!==(u=e[2])){if(s){oe();const e=s;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}u?(s=new u(h()),me(s.$$.fragment),ae(s.$$.fragment,1),ge(s,t,null)):s=null}else u&&s.$set(o);(!l||3&r&&a!==(a=`height:${e[0]}px; width:${e[1]}px`))&&A(t,"style",a)},i(e){l||(s&&ae(s.$$.fragment,e),l=!0)},o(e){s&&le(s.$$.fragment,e),l=!1},d(e){e&&x(t),s&&ye(s)}}}function nt(e,t,i){let{height:r}=t,{width:n}=t,{children:o}=t,{childProps:s}=t;return e.$$set=e=>{"height"in e&&i(0,r=e.height),"width"in e&&i(1,n=e.width),"children"in e&&i(2,o=e.children),"childProps"in e&&i(3,s=e.childProps)},[r,n,o,s]}class ot extends ve{constructor(e){super(),_e(this,e,nt,rt,l,{height:0,width:1,children:2,childProps:3})}}function st({personalAccessToken:e,fetchFunc:t}){this._personalAccessToken=e,this._fetchFunc=t}st.prototype.get=async function(e,t){const i=t?"?"+new URLSearchParams(t).toString():"",r=await this._fetchFunc(`https://api.figma.com/v1/${e}${i}`,{headers:{"X-Figma-Token":this._personalAccessToken}});if(r.status>=400){let e="";try{e+=(await r.json()).err}finally{throw new Error(`HTTP error ${r.status} accessing Figma. ${e}`)}}return r.json()};const at=function({file:e,nodeIds:t}){function i(e,t){return e===t.id?t:t.children?t.children.map((t=>i(e,t))).find(Boolean):null}return t.map((t=>i(t,e.document)))},lt=function({file:e,names:t}){function i(e,t){return e===t.name&&"FRAME"===t.type?t.id:t.children?t.children.map((t=>i(e,t))).find(Boolean):null}return t.map((t=>i(t,e.document)))};async function ct({api:e,fileKey:t,assetList:i,scales:r=[1],format:n="png"}){const o={},s=await Promise.all(r.map((r=>async function(r){return e.get(`images/${t}`,{ids:Object.values(i),format:n,scale:r})}(r))));return r.forEach(((e,t)=>{for(const r of Object.keys(i)){const n=i[r];o[r]=o[r]||{id:n},o[r][`@${e}x`]=s[t].images[n]}})),o}async function ut({frameIds:e=[],frameNames:t=[],fileKey:i,personalAccessToken:r,scales:n=[1],format:o="png",fetchFunc:s=((...e)=>window.fetch(...e))}){const a=new st({personalAccessToken:r,fetchFunc:s}),l=await a.get(`files/${i}`);t.length&&(e=[...e,...lt({file:l,names:t})]);const c=at({file:l,nodeIds:e}).filter(Boolean);if(!c.length)throw new Error(`No matching frames for ${e}, ${t}`);const u=function(e){const t={};for(const i of e.filter(Boolean))for(const e of i.children)t[e.name]=e.id;return t}(c);return await ct({api:a,fileKey:i,assetList:u,scales:n,format:o})}function ht(e,t){for(const i of Object.keys(t)){const r=Math.max(...Object.keys(t[i]).filter((e=>"@"===e[0])).map((e=>+e.replace(/[^0-9.]/g,""))));e.loadImage(t[i][`@${r}x`],((t,n)=>{e.addImage(i,n,{pixelRatio:r})}))}}var dt={getFigmaIconsByFrames:ut,getFigmassets:ut,addAssetsToMap:ht,loadFigmassets:async function({map:e,...t}){e&&!t.scales&&(t.scales=[2]);const i=await ut(t);return e&&ht(e,i),i},loadStoredFigmassets:async function({map:e,path:t}){t&&(t=t.replace(/([^/])$/,"$1/"));const i=await fetch(`${t}assets.json`).then((e=>e.json()));for(const r of i)e.loadImage(`${t}${r.fileName}`,((t,i)=>{e.addImage(r.id,i,{pixelRatio:r.scale})}))}};let pt;Ge.subscribe((e=>({figmaLink:pt}=e)));const ft=async e=>{if(!pt)return new Promise([]);let t={...pt,frameNames:[...new Set(Be.map((e=>pt[e])).filter(Boolean))],scales:[pt.scale]};delete t.destinationPin,delete t.puck,delete t.scale;const i=dt.loadFigmassets(t),r=await i;if(!Be.some((e=>Object.keys(r).includes(e))))throw new Error(`Icons in frames need to be named ${Be.join(", ")}. Found ${Object.keys(r).join(", ")}. Please check icon names in your Figma file.`);const n=Promise.all(Be.filter((e=>!!r[e]||(console.warn(`${e} was not found in your Figma file.`),!1))).map((t=>new Promise(((i,n)=>{const o=r[t];if(!o)return;const s=o[Object.keys(o).find((e=>e.includes("@")))];e.loadImage(s,((r,o)=>{r&&n(r),e.addImage(t,o),i({name:t,url:s,width:o.width,height:o.height})}))})))));return n};var mt={exports:{}},gt=mt.exports=function(){var e,t,i;function r(r,n){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",s={};e(s),i=n(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=n;else e=n}return r(["exports"],(function(e){var t="undefined"!=typeof self?self:{},i=r;function r(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}r.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},r.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},r.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},r.prototype.solveCurveX=function(e,t){var i,r,n,o,s;for(void 0===t&&(t=1e-6),n=e,s=0;s<8;s++){if(o=this.sampleCurveX(n)-e,Math.abs(o)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=o/a}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(o=this.sampleCurveX(n),Math.abs(o-e)<t)return n;e>o?i=n:r=n,n=.5*(r-i)+i}return n},r.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var n=o;function o(e,t){this.x=e,this.y=t}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e};const s=Math.PI/180,a=180/Math.PI;function l(e){return e*s}function c(e){return e*a}const u=[[0,0],[1,0],[1,1],[0,1]];function h(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function d(e,t,r,n){const o=new i(e,t,r,n);return function(e){return o.solve(e)}}const p=d(.25,.1,.25,1);function f(e,t,i){return Math.min(i,Math.max(t,e))}function m(e,t,i){return(i=f((i-e)/(t-e),0,1))*i*(3-2*i)}function g(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function y(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const n=new Array(e.length);let o=null;e.forEach(((e,s)=>{t(e,((e,t)=>{e&&(o=e),n[s]=t,0==--r&&i(o,n)}))}))}function _(e){const t=[];for(const i in e)t.push(e[i]);return t}function v(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let x=1;function b(){return x++}function w(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function T(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function S(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function C(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function M(e,t){return-1!==e.indexOf(t,e.length-t.length)}function k(e,t,i){const r={};for(const n in e)r[n]=t.call(i||this,e[n],n,e);return r}function E(e,t,i){const r={};for(const n in e)t.call(i||this,e[n],n,e)&&(r[n]=e[n]);return r}function A(e){return Array.isArray(e)?e.map(A):"object"==typeof e&&e?k(e,A):e}const I={};function z(e){I[e]||("undefined"!=typeof console&&console.warn(e),I[e]=!0)}function P(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function L(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}function D(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function R(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const o=r||n;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let B=null;function O(e){if(null==B){const t=e.navigator?e.navigator.userAgent:null;B=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return B}function F(e){try{const i=t[e];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function j(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const $=t.performance;function N(e){const t=e?e.url.toString():void 0;return $.getEntriesByName(t)}var U="2.9.1";let V,G,q,Z;const W={now:()=>void 0!==q?q:t.performance.now(),setNow(e){q=e},restoreNow(){q=void 0},frame(e){const i=t.requestAnimationFrame(e);return{cancel:()=>t.cancelAnimationFrame(i)}},getImageData(e,i=0){const{width:r,height:n}=e;Z||(Z=t.document.createElement("canvas"));const o=Z.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return(r>Z.width||n>Z.height)&&(Z.width=r,Z.height=n),o.clearRect(-i,-i,r+2*i,n+2*i),o.drawImage(e,0,0,r,n),o.getImageData(-i,-i,r+2*i,n+2*i)},resolveURL:e=>(V||(V=t.document.createElement("a")),V.href=e,V.href),get devicePixelRatio(){return t.devicePixelRatio},get prefersReducedMotion(){return!!t.matchMedia&&(null==G&&(G=t.matchMedia("(prefers-reduced-motion: reduce)")),G.matches)}};let H;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==H){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{H=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):e}catch(t){H=e}}return H},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},K={supported:!1,testSupport:function(e){!Q&&J&&(ee?te(e):Y=e)}};let Y,J,Q=!1,ee=!1;function te(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,J),e.isContextLost())return;K.supported=!0}catch(e){}e.deleteTexture(t),Q=!0}t.document&&(J=t.document.createElement("img"),J.onload=function(){Y&&te(Y),Y=null,ee=!0},J.onerror=function(){Q=!0,Y=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ie="01",re="NO_ACCESS_TOKEN";function ne(e){return 0===e.indexOf("mapbox:")}function oe(e){return X.API_URL_REGEX.test(e)}const se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ae(e){const t=e.match(se);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function le(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function ce(e){if(!e)return null;const i=e.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(t.atob(i[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class ue{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ce(X.ACCESS_TOKEN);let r="";return r=i&&i.u?t.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):X.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=F("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=t.localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const n=t.localStorage.getItem(r);n&&(this.anonId=n)}catch(e){z("Unable to read from LocalStorage")}}saveEventData(){const e=F("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{t.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&t.localStorage.setItem(i,JSON.stringify(this.eventData))}catch(e){z("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,r){if(!X.EVENTS_URL)return;const n=ae(X.EVENTS_URL);n.params.push(`access_token=${r||X.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:ie,userId:this.anonId},s=t?v(o,t):o,a={url:le(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=Pe(a,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const he=new class extends ue{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>ne(e)||oe(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ce(X.ACCESS_TOKEN),i=t?t.u:X.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;S(this.anonId)||(this.anonId=w(),r=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(n),i=(n-this.eventData.lastSuccess)/864e5;r=r||i>=1||i<-1||e.getDate()!==t.getDate()}else r=!0;r?this.postEvent(n,{"enabled.telemetry":!1},(e=>{e||(this.eventData.lastSuccess=n,this.eventData.tokenU=i)}),e):this.processRequests()}},de=he.postTurnstileEvent.bind(he),pe=new class extends ue{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,r){this.skuToken=t,this.errorCb=r,X.EVENTS_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),S(this.anonId)||(this.anonId=w()),this.postEvent(i,{skuToken:this.skuToken},(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e))}},fe=pe.postMapLoadEvent.bind(pe),me=new class extends ue{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,r){if(!X.API_URL||!X.SESSION_PATH)return;const n=ae(X.API_URL+X.SESSION_PATH);n.params.push(`sku=${t||""}`),n.params.push(`access_token=${r||X.ACCESS_TOKEN||""}`);const o={url:le(n),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Le(o,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(r)}))}getSessionAPI(e,t,i,r){this.skuToken=t,this.errorCb=r,X.SESSION_PATH&&X.API_URL&&(i||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(re)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}},ge=me.getSessionAPI.bind(me),ye=new Set;let _e,ve=500,xe=50,be={};function we(e){const t=Se(e);let i,r;t&&t.forEach((e=>{const t=e.split("=");"language"===t[0]?i=t[1]:"worldview"===t[0]&&(r=t[1])}));let n="mapbox-tiles";return i&&(n+=`-${i}`),r&&(n+=`-${r}`),n}function Te(e){t.caches&&!be[e]&&(be[e]=t.caches.open(e))}function Se(e){const t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}function Ce(e){const t=e.indexOf("?");if(t<0)return e;const i=Se(e).filter((e=>{const t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return i.length?`${e.slice(0,t)}?${i.join("&")}`:e.slice(0,t)}let Me=1/0;const ke={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ke);class Ee extends Error{constructor(e,t,i){401===t&&oe(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ae=D()?()=>self.worker&&self.worker.referrer:()=>("blob:"===t.location.protocol?t.parent:t).location.href,Ie=function(e,i){if(!(/^file:/.test(r=e.url)||/^file:/.test(Ae())&&!/^\w+:/.test(r))){if(t.fetch&&t.Request&&t.AbortController&&t.Request.prototype.hasOwnProperty("signal"))return function(e,i){const r=new t.AbortController,n=new t.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ae(),signal:r.signal});let o=!1,s=!1;const a=(l=n.url).indexOf("sku=")>0&&oe(l);var l;"json"===e.type&&n.headers.set("Accept","application/json");const c=(r,o,l)=>{if(s)return;if(r&&"SecurityError"!==r.message&&z(r),o&&l)return u(o);const c=Date.now();t.fetch(n).then((t=>{if(t.ok){const e=a?t.clone():null;return u(t,e,c)}return i(new Ee(t.statusText,t.status,e.url))})).catch((e=>{20!==e.code&&i(new Error(e.message))}))},u=(r,a,l)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((e=>{s||(a&&l&&function(e,i,r){const n=we(e.url);if(Te(n),!be[n])return;const o={status:i.status,statusText:i.statusText,headers:new t.Headers};i.headers.forEach(((e,t)=>o.headers.set(t,e)));const s=R(i.headers.get("Cache-Control")||"");if(s["no-store"])return;s["max-age"]&&o.headers.set("Expires",new Date(r+1e3*s["max-age"]).toUTCString());const a=o.headers.get("Expires");a&&(new Date(a).getTime()-r<42e4||function(e,t){if(void 0===_e)try{new Response(new ReadableStream),_e=!0}catch(e){_e=!1}_e?t(e.body):e.blob().then(t)}(i,(i=>{const r=new t.Response(i,o);Te(n),be[n]&&be[n].then((t=>t.put(Ce(e.url),r))).catch((e=>z(e.message)))})))}(n,a,l),o=!0,i(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((e=>{s||i(new Error(e.message))}))};return a?function(e,t){const i=we(e.url);if(Te(i),!be[i])return t(null);const r=Ce(e.url);be[i].then((e=>{e.match(r).then((i=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=R(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(i);e.delete(r),n&&e.put(r,i.clone()),t(null,i,n)})).catch(t)})).catch(t)}(n,c):c(null,null),{cancel:()=>{s=!0,o||r.abort()}}}(e,i);if(D()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,i,void 0,!0)}var r;return function(e,i){const r=new t.XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{i(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let t=r.response;if("json"===e.type)try{t=JSON.parse(r.response)}catch(e){return i(e)}i(null,t,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else i(new Ee(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,i)},ze=function(e,t){return Ie(v(e,{type:"arrayBuffer"}),t)},Pe=function(e,t){return Ie(v(e,{method:"POST"}),t)},Le=function(e,t){return Ie(v(e,{method:"GET"}),t)};function De(e){const i=t.document.createElement("a");return i.href=e,i.protocol===t.document.location.protocol&&i.host===t.document.location.host}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Be,Oe;Be=[],Oe=0;const Fe=function(e,i){if(K.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Oe>=X.MAX_PARALLEL_IMAGE_REQUESTS){const t={requestParameters:e,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Be.push(t),t}Oe++;let r=!1;const n=()=>{if(!r)for(r=!0,Oe--;Be.length&&Oe<X.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Be.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=Fe(t,i).cancel)}},o=ze(e,((e,r,o,s)=>{n(),e?i(e):r&&(t.createImageBitmap?function(e,i){const r=new t.Blob([new Uint8Array(e)],{type:"image/png"});t.createImageBitmap(r).then((e=>{i(null,e)})).catch((e=>{i(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(r,((e,t)=>i(e,t,o,s))):function(e,i){const r=new t.Image,n=t.URL;r.onload=()=>{i(null,r),n.revokeObjectURL(r.src),r.onload=null,t.requestAnimationFrame((()=>{r.src=Re}))},r.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const o=new t.Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(o):Re}(r,((e,t)=>i(e,t,o,s))))}));return{cancel:()=>{o.cancel(),n()}}};function je(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function $e(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class Ne{constructor(e,t={}){v(this,t),this.type=e}}class Ue extends Ne{constructor(e,t={}){super("error",v({error:e},t))}}class Ve{on(e,t){return this._listeners=this._listeners||{},je(e,t,this._listeners),this}off(e,t){return $e(e,t,this._listeners),$e(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},je(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Ne(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of r)$e(i,t,this._oneTimeListeners),t.call(this,e);const n=this._eventedParent;n&&(v(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof Ue&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qe(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}function Ze(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function We(e){if(Array.isArray(e))return e.map(We);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=We(e[i]);return t}return Ze(e)}class He extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Xe=He;class Ke{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Ke(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ye=Ke;const Je={kind:"null"},Qe={kind:"number"},et={kind:"string"},tt={kind:"boolean"},it={kind:"color"},rt={kind:"object"},nt={kind:"value"},ot={kind:"collator"},st={kind:"formatted"},at={kind:"resolvedImage"};function lt(e,t){return{kind:"array",itemType:e,N:t}}function ct(e){if("array"===e.kind){const t=ct(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const ut=[Je,Qe,et,tt,it,st,rt,lt(nt),at];function ht(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ht(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of ut)if(!ht(e,t))return null}return`Expected ${ct(e)} but found ${ct(t)} instead.`}function dt(e,t){return t.some((t=>t.kind===e.kind))}function pt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function ft(e){var t={exports:{}};return e(t,t.exports),t.exports}var mt=ft((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function o(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function s(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,a=e.replace(/ /g,"").toLowerCase();if(a in i)return i[a].slice();if("#"===a[0])return 4===a.length?(t=parseInt(a.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===a.length&&(t=parseInt(a.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),h=a.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[n(h[0]),n(h[1]),n(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[r(255*s(y,g,p+1/3)),r(255*s(y,g,p)),r(255*s(y,g,p-1/3)),d];default:return null}}return null}}catch(e){}}));class gt{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof gt)return e;if("string"!=typeof e)return;const t=mt.parseCSSColor(e);return t?new gt(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}toArray01(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}}gt.black=new gt(0,0,0,1),gt.white=new gt(1,1,1,1),gt.transparent=new gt(0,0,0,0),gt.red=new gt(1,0,0,1),gt.blue=new gt(0,0,1,1);var yt=gt;class _t{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vt{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class xt{constructor(e){this.sections=e}static fromString(e){return new xt([new vt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof xt?e:xt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new bt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function wt(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof yt)return!0;if(e instanceof _t)return!0;if(e instanceof xt)return!0;if(e instanceof bt)return!0;if(Array.isArray(e)){for(const t of e)if(!Tt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Tt(e[t]))return!1;return!0}return!1}function St(e){if(null===e)return Je;if("string"==typeof e)return et;if("boolean"==typeof e)return tt;if("number"==typeof e)return Qe;if(e instanceof yt)return it;if(e instanceof _t)return ot;if(e instanceof xt)return st;if(e instanceof bt)return at;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=St(t);if(i){if(i===e)continue;i=nt;break}i=e}return lt(i||nt,t)}return rt}function Ct(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof yt||e instanceof xt||e instanceof bt?e.toString():JSON.stringify(e)}class Mt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tt(e[1]))return t.error("invalid value");const i=e[1];let r=St(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Mt(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof yt?["rgba"].concat(this.value.toArray()):this.value instanceof xt?this.value.serialize():this.value}}var kt=Mt,Et=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const At={string:et,number:Qe,boolean:tt,object:rt};class It{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in At)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=At[i],r++}else n=nt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=lt(n,o)}else i=At[n];const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,nt);if(!i)return null;o.push(i)}return new It(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!ht(this.type,St(i)))return i;if(t===this.args.length-1)throw new Et(`Expected value to be of type ${ct(this.type)}, but found ${ct(St(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}var zt=It;class Pt{constructor(e){this.type=st,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Qe),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,lt(et)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,it),!s))return null;const a=r[r.length-1];a.scale=e,a.font=i,a.textColor=s}else{const o=t.parse(e[i],1,nt);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new Pt(r)}evaluate(e){return new xt(this.sections.map((t=>{const i=t.content.evaluate(e);return St(i)===at?new vt("",i,null,null,null):new vt(Ct(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Lt{constructor(e){this.type=at,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,et);return i?new Lt(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=bt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Dt={"to-boolean":tt,"to-color":it,"to-number":Qe,"to-string":et};class Rt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=Dt[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,nt);if(!r)return null;n.push(r)}return new Rt(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof yt)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:wt(t[0],t[1],t[2],t[3]),!i))return new yt(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Et(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Et(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?xt.fromString(Ct(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?bt.fromString(Ct(this.args[0].evaluate(e))):Ct(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Pt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Lt(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Bt=Rt;const Ot=["Unknown","Point","LineString","Polygon"];var Ft=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ot[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=yt.parse(e)),t}};class jt{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=jt.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new di(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new jt(i,n,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(ct).join(", ")})`:`(${ct(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(ct(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){jt.definitions=t;for(const i in t)e[i]=jt}}var $t=jt;class Nt{constructor(e,t,i){this.type=ot,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,tt);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,tt);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,et),!o)?null:new Nt(r,n,o)}evaluate(e){return new _t(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ut=8192;function Vt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Gt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function qt(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*Ut),Math.round(r*n*Ut)]}function Zt(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function Wt(e,t){let i=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(Zt(e,a[t],a[t+1]))return!1;(n=a[t])[1]>(r=e)[1]!=(o=a[t+1])[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function Ht(e,t){for(let i=0;i<t.length;i++)if(Wt(e,t[i]))return!0;return!1}function Xt(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(e[0]-i[0])*o-n*(e[1]-i[1]),a=(t[0]-i[0])*o-n*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Kt(e,t,i){for(const c of i)for(let i=0;i<c.length-1;++i)if(0!=(a=[(s=c[i+1])[0]-(o=c[i])[0],s[1]-o[1]])[0]*(l=[(n=t)[0]-(r=e)[0],n[1]-r[1]])[1]-a[1]*l[0]&&Xt(r,n,o,s)&&Xt(o,s,r,n))return!0;var r,n,o,s,a,l;return!1}function Yt(e,t){for(let i=0;i<e.length;++i)if(!Wt(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Kt(e[i],e[i+1],t))return!1;return!0}function Jt(e,t){for(let i=0;i<t.length;i++)if(Yt(e,t[i]))return!0;return!1}function Qt(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=qt(e[n][r],i);Vt(t,s),o.push(s)}r.push(o)}return r}function ei(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=Qt(e[n],t,i);r.push(o)}return r}function ti(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Vt(t,e)}function ii(e,t,i,r){const n=Math.pow(2,r.z)*Ut,o=[r.x*Ut,r.y*Ut],s=[];if(!e)return s;for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];ti(r,t,i,n),s.push(r)}return s}function ri(e,t,i,r){const n=Math.pow(2,r.z)*Ut,o=[r.x*Ut,r.y*Ut],s=[];if(!e)return s;for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Vt(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)ti(r,t,i,n)}var a;return s}class ni{constructor(e,t){this.type=tt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tt(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ni(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ni(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new ni(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Qt(t.coordinates,r,n),s=ii(e.geometry(),i,r,n);if(!Gt(i,r))return!1;for(const e of s)if(!Wt(e,o))return!1}if("MultiPolygon"===t.type){const o=ei(t.coordinates,r,n),s=ii(e.geometry(),i,r,n);if(!Gt(i,r))return!1;for(const e of s)if(!Ht(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Qt(t.coordinates,r,n),s=ri(e.geometry(),i,r,n);if(!Gt(i,r))return!1;for(const e of s)if(!Yt(e,o))return!1}if("MultiPolygon"===t.type){const o=ei(t.coordinates,r,n),s=ri(e.geometry(),i,r,n);if(!Gt(i,r))return!1;for(const e of s)if(!Jt(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var oi=ni;function si(e){if(e instanceof $t){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof oi)return!1;let t=!0;return e.eachChild((e=>{t&&!si(e)&&(t=!1)})),t}function ai(e){if(e instanceof $t&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!ai(e)&&(t=!1)})),t}function li(e,t){if(e instanceof $t&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!li(e,t)&&(i=!1)})),i}class ci{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new ci(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ui=ci;class hi{constructor(e,t=[],i,r=new Ye,n=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new zt(t,[e]):"coerce"===i?new Bt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof kt)&&"resolvedImage"!==r.type.kind&&pi(r)){const t=new Ft;try{r=new kt(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new hi(this.registry,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Xe(i,e))}checkSubtype(e,t){const i=ht(e,t);return i&&this.error(i),i}}var di=hi;function pi(e){if(e instanceof ui)return pi(e.boundExpression);if(e instanceof $t&&"error"===e.name)return!1;if(e instanceof Nt)return!1;if(e instanceof oi)return!1;const t=e instanceof Bt||e instanceof zt;let i=!0;return e.eachChild((e=>{i=t?i&&pi(e):i&&e instanceof kt})),!!i&&si(e)&&li(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function fi(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new Et("Input is not a number.");s=a-1}return 0}class mi{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Qe);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new mi(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[fi(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var gi=mi;function yi(e,t,i){return e*(1-i)+t*i}var _i=Object.freeze({__proto__:null,number:yi,color:function(e,t,i){return new yt(yi(e.r,t.r,i),yi(e.g,t.g,i),yi(e.b,t.b,i),yi(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,r)=>yi(e,t[r],i)))}});const vi=.95047,xi=1.08883,bi=4/29,wi=6/29,Ti=3*wi*wi,Si=Math.PI/180,Ci=180/Math.PI;function Mi(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ti+bi}function ki(e){return e>wi?e*e*e:Ti*(e-bi)}function Ei(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ai(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ii(e){const t=Ai(e.r),i=Ai(e.g),r=Ai(e.b),n=Mi((.4124564*t+.3575761*i+.1804375*r)/vi),o=Mi((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Mi((.0193339*t+.119192*i+.9503041*r)/xi)),alpha:e.a}}function zi(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*ki(t),i=vi*ki(i),r=xi*ki(r),new yt(Ei(3.2404542*i-1.5371385*t-.4985314*r),Ei(-.969266*i+1.8760108*t+.041556*r),Ei(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function Pi(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Li={forward:Ii,reverse:zi,interpolate:function(e,t,i){return{l:yi(e.l,t.l,i),a:yi(e.a,t.a,i),b:yi(e.b,t.b,i),alpha:yi(e.alpha,t.alpha,i)}}},Di={forward:function(e){const{l:t,a:i,b:r}=Ii(e),n=Math.atan2(r,i)*Ci;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Si,i=e.c;return zi({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Pi(e.h,t.h,i),c:yi(e.c,t.c,i),l:yi(e.l,t.l,i),alpha:yi(e.alpha,t.alpha,i)}}};var Ri=Object.freeze({__proto__:null,lab:Li,hcl:Di});class Bi{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let o=0;if("exponential"===e.name)o=Oi(t,e.base,r,n);else if("linear"===e.name)o=Oi(t,1,r,n);else if("cubic-bezier"===e.name){const s=e.controlPoints;o=new i(s[0],s[1],s[2],s[3]).solve(Oi(t,1,r,n))}return o}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Qe),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=it:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Bi(a,i,r,n,s):t.error(`Type ${ct(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=fi(t,r),s=Bi.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);return"interpolate"===this.operator?_i[this.type.kind.toLowerCase()](a,l,s):"interpolate-hcl"===this.operator?Di.reverse(Di.interpolate(Di.forward(a),Di.forward(l),s)):Li.reverse(Li.interpolate(Li.forward(a),Li.forward(l),s))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Oi(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}var Fi=Bi;class ji{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const o=r&&n.some((e=>ht(r,e.type)));return new ji(o?nt:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof bt&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var $i=ji;class Ni{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Ni(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Ui=Ni;class Vi{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Qe),r=t.parse(e[2],2,lt(t.expectedType||nt));return i&&r?new Vi(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Et(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Et(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Et(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gi=Vi;class qi{constructor(e,t){this.type=tt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,nt),r=t.parse(e[2],2,nt);return i&&r?dt(i.type,[tt,et,Qe,Je,nt])?new qi(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ct(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!pt(t,["boolean","string","number","null"]))throw new Et(`Expected first argument to be of type boolean, string, number or null, but found ${ct(St(t))} instead.`);if(!pt(i,["string","array"]))throw new Et(`Expected second argument to be of type array or string, but found ${ct(St(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Zi=qi;class Wi{constructor(e,t,i){this.type=Qe,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,nt),r=t.parse(e[2],2,nt);if(!i||!r)return null;if(!dt(i.type,[tt,et,Qe,Je,nt]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ct(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Qe);return n?new Wi(i,r,n):null}return new Wi(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!pt(t,["boolean","string","number","null"]))throw new Et(`Expected first argument to be of type boolean, string, number or null, but found ${ct(St(t))} instead.`);if(!pt(i,["string","array"]))throw new Et(`Expected second argument to be of type array or string, but found ${ct(St(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Hi=Wi;class Xi{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,St(e)))return null}else i=St(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,nt);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new Xi(i,r,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(St(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)e.push(1===r.length?n(r[0]):r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}var Ki=Xi;class Yi{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,tt);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new Yi(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}var Ji=Yi;class Qi{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,nt),r=t.parse(e[2],2,Qe);if(!i||!r)return null;if(!dt(i.type,[lt(nt),et,nt]))return t.error(`Expected first argument to be of type array or string, but found ${ct(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Qe);return n?new Qi(i.type,i,r,n):null}return new Qi(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!pt(t,["string","array"]))throw new Et(`Expected first argument to be of type array or string, but found ${ct(St(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var er=Qi;function tr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ir(e,t,i,r){return 0===r.compare(t,i)}function rr(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=tt,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,nt);if(!o)return null;if(!tr(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${ct(o.type)}'.`);let s=t.parse(e[2],2,nt);if(!s)return null;if(!tr(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${ct(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${ct(o.type)}' and '${ct(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new zt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new zt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,ot),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=St(o),i=St(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Et(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=St(o),i=St(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const nr=rr("==",(function(e,t,i){return t===i}),ir),or=rr("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!ir(0,t,i,r)})),sr=rr("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),ar=rr(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),lr=rr("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),cr=rr(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class ur{constructor(e,t,i,r,n){this.type=et,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Qe);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,et),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,et),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,Qe),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=t.parse(r["max-fraction-digits"],1,Qe),!a)?null:new ur(i,n,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hr{constructor(e){this.type=Qe,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${ct(i.type)} instead.`):new hr(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Et(`Expected value to be of type string or array, but found ${ct(St(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const dr={"==":nr,"!=":or,">":ar,"<":sr,">=":cr,"<=":lr,array:zt,at:Gi,boolean:zt,case:Ji,coalesce:$i,collator:Nt,format:Pt,image:Lt,in:Zi,"index-of":Hi,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:hr,let:Ui,literal:kt,match:Ki,number:zt,"number-format":ur,object:zt,slice:er,step:gi,string:zt,"to-boolean":Bt,"to-color":Bt,"to-number":Bt,"to-string":Bt,var:ui,within:oi};function pr(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=wt(t,i,r,o);if(s)throw new Et(s);return new yt(t/255*o,i/255*o,r/255*o,o)}function fr(e,t){return e in t}function mr(e,t){const i=t[e];return void 0===i?null:i}function gr(e){return{type:e}}$t.register(dr,{error:[{kind:"error"},[et],(e,[t])=>{throw new Et(t.evaluate(e))}],typeof:[et,[nt],(e,[t])=>ct(St(t.evaluate(e)))],"to-rgba":[lt(Qe,4),[it],(e,[t])=>t.evaluate(e).toArray()],rgb:[it,[Qe,Qe,Qe],pr],rgba:[it,[Qe,Qe,Qe,Qe],pr],has:{type:tt,overloads:[[[et],(e,[t])=>fr(t.evaluate(e),e.properties())],[[et,rt],(e,[t,i])=>fr(t.evaluate(e),i.evaluate(e))]]},get:{type:nt,overloads:[[[et],(e,[t])=>mr(t.evaluate(e),e.properties())],[[et,rt],(e,[t,i])=>mr(t.evaluate(e),i.evaluate(e))]]},"feature-state":[nt,[et],(e,[t])=>mr(t.evaluate(e),e.featureState||{})],properties:[rt,[],e=>e.properties()],"geometry-type":[et,[],e=>e.geometryType()],id:[nt,[],e=>e.id()],zoom:[Qe,[],e=>e.globals.zoom],pitch:[Qe,[],e=>e.globals.pitch||0],"distance-from-center":[Qe,[],e=>e.distanceFromCenter()],"heatmap-density":[Qe,[],e=>e.globals.heatmapDensity||0],"line-progress":[Qe,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Qe,[],e=>e.globals.skyRadialProgress||0],accumulated:[nt,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Qe,gr(Qe),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Qe,gr(Qe),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Qe,overloads:[[[Qe,Qe],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Qe],(e,[t])=>-t.evaluate(e)]]},"/":[Qe,[Qe,Qe],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Qe,[Qe,Qe],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Qe,[Qe],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))],log2:[Qe,[Qe],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Qe,[Qe],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Qe,[Qe],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Qe,[Qe],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Qe,[Qe],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Qe,[Qe],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Qe,[Qe],(e,[t])=>Math.atan(t.evaluate(e))],min:[Qe,gr(Qe),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Qe,gr(Qe),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Qe,[Qe],(e,[t])=>Math.abs(t.evaluate(e))],round:[Qe,[Qe],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qe,[Qe],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Qe,[Qe],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[tt,[et,nt],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[tt,[nt],(e,[t])=>e.id()===t.value],"filter-type-==":[tt,[et],(e,[t])=>e.geometryType()===t.value],"filter-<":[tt,[et,nt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[tt,[nt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[tt,[et,nt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[tt,[nt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[tt,[et,nt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[tt,[nt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[tt,[et,nt],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[tt,[nt],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[tt,[nt],(e,[t])=>t.value in e.properties()],"filter-has-id":[tt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[tt,[lt(et)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[tt,[lt(nt)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[tt,[et,lt(nt)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[tt,[et,lt(nt)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:tt,overloads:[[[tt,tt],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[gr(tt),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:tt,overloads:[[[tt,tt],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[gr(tt),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[tt,[tt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[tt,[et],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[et,[et],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[et,[et],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[et,gr(nt),(e,t)=>t.map((t=>Ct(t.evaluate(e)))).join("")],"resolved-locale":[et,[ot],(e,[t])=>t.evaluate(e).resolvedLocale()]});var yr=dr;function _r(e){return{result:"success",value:e}}function vr(e){return{result:"error",value:e}}function xr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function br(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function wr(e){return!!e.expression&&e.expression.interpolated}function Tr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Sr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Cr(e){return e}function Mr(e,t){const i="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||!(r||void 0!==e.property),o=e.type||(wr(t)?"exponential":"interval");if(i&&((e=qe({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],yt.parse(e[1])]))),e.default=yt.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ri[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,l;if("exponential"===o)s=Ir;else if("interval"===o)s=Ar;else if("categorical"===o){s=Er,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=zr}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,Mr(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Fi.interpolationFactor.bind(void 0,o),zoomStops:n.map((e=>e[0])),evaluate:({zoom:i},r)=>Ir({stops:n,base:e.base},t,i).evaluate(i,r)}}if(n){const i="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Fi.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>s(e,t,i,a,l)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?kr(e.default,t.default):s(e,t,n,a,l)}}}function kr(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Er(e,t,i,r,n){return kr(typeof i===n?r[i]:void 0,e.default,t.default)}function Ar(e,t,i){if("number"!==Tr(i))return kr(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=fi(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function Ir(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==Tr(i))return kr(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=fi(e.stops.map((e=>e[0])),i),s=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1];let c=_i[t.type]||Cr;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Ri[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),s))}return"function"==typeof a.evaluate?{evaluate(...e){const t=a.evaluate.apply(void 0,e),i=l.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==i)return c(t,i,s)}}:c(a,l,s)}function zr(e,t,i){return"color"===t.type?i=yt.parse(i):"formatted"===t.type?i=xt.fromString(i.toString()):"resolvedImage"===t.type?i=bt.fromString(i.toString()):Tr(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),kr(i,e.default,t.default)}class Pr{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ft,this._defaultValue=t?function(e){return"color"===e.type&&(Sr(e.default)||Array.isArray(e.default))?new yt(0,0,0,0):"color"===e.type?yt.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Et(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Lr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in yr}function Dr(e,t){const i=new di(yr,[],t?function(e){const t={color:it,string:et,number:Qe,enum:et,boolean:tt,formatted:st,resolvedImage:at};return"array"===e.type?lt(t[e.value]||nt,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?_r(new Pr(r,t)):vr(i.errors)}class Rr{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!ai(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class Br{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!ai(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,e,t,i):0}}function Or(e,t){if("error"===(e=Dr(e,t)).result)return e;const i=e.value.expression,r=si(i);if(!r&&!xr(t))return vr([new Xe("","data expressions not supported")]);const n=li(i,["zoom","pitch","distance-from-center"]);if(!n&&!br(t))return vr([new Xe("","zoom expressions not supported")]);const o=jr(i);return o||n?o instanceof Xe?vr([o]):o instanceof Fi&&!wr(t)?vr([new Xe("",'"interpolate" expressions cannot be used with this property')]):_r(o?new Br(r?"camera":"composite",e.value,o.labels,o instanceof Fi?o.interpolation:void 0):new Rr(r?"constant":"source",e.value)):vr([new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fr{constructor(e,t){this._parameters=e,this._specification=t,qe(this,Mr(this._parameters,this._specification))}static deserialize(e){return new Fr(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function jr(e){let t=null;if(e instanceof Ui)t=jr(e.result);else if(e instanceof $i){for(const i of e.args)if(t=jr(i),t)break}else(e instanceof gi||e instanceof Fi)&&e.input instanceof $t&&"zoom"===e.input.name&&(t=e);return t instanceof Xe||e.eachChild((e=>{const i=jr(e);i instanceof Xe?t=i:!t&&i?t=new Xe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new Xe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}class $r{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Nr(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Tr(i);if("object"!==l)return[new $r(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=r[l]||r["*"];let u;n[l]?u=n[l]:r[l]?u=bn:n["*"]?u=n["*"]:r["*"]&&(u=bn),u?a=a.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:e},i)):a.push(new $r(t,i[e],`unknown property "${e}"`))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&a.push(new $r(t,i,`missing required property "${e}"`));return a}function Ur(e){const t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,o=e.key,s=e.arrayElementValidator||bn;if("array"!==Tr(t))return[new $r(o,t,`array expected, ${Tr(t)} found`)];if(i.length&&t.length!==i.length)return[new $r(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new $r(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(a.function=i.function),"object"===Tr(i.value)&&(a=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:r,styleSpec:n,key:`${o}[${e}]`}));return l}function Vr(e){const t=e.key,i=e.value,r=e.valueSpec;let n=Tr(i);if("number"===n&&i!=i&&(n="NaN"),"number"!==n)return[new $r(t,i,`number expected, ${n} found`)];if("minimum"in r){let n=r.minimum;if("array"===Tr(r.minimum)&&(n=r.minimum[e.arrayIndex]),i<n)return[new $r(t,i,`${i} is less than the minimum value ${n}`)]}if("maximum"in r){let n=r.maximum;if("array"===Tr(r.maximum)&&(n=r.maximum[e.arrayIndex]),i>n)return[new $r(t,i,`${i} is greater than the maximum value ${n}`)]}return[]}function Gr(e){const t=e.valueSpec,i=Ze(e.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===Tr(e.value.stops)&&"array"===Tr(e.value.stops[0])&&"object"===Tr(e.value.stops[0][0]),u=Nr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new $r(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(Ur({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Tr(r)&&0===r.length&&t.push(new $r(e.key,r,"array must have at least one stop")),t},default:function(e){return bn({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new $r(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new $r(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!wr(e.valueSpec)&&u.push(new $r(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!xr(e.valueSpec)?u.push(new $r(e.key,e.value,"property functions not supported")):a&&!br(e.valueSpec)&&u.push(new $r(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new $r(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const r=e.value,a=e.key;if("array"!==Tr(r))return[new $r(a,r,`array expected, ${Tr(r)} found`)];if(2!==r.length)return[new $r(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Tr(r[0]))return[new $r(a,r,`object expected, ${Tr(r[0])} found`)];if(void 0===r[0].zoom)return[new $r(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new $r(a,r,"object stop key must have value")];const t=Ze(r[0].zoom);if("number"!=typeof t)return[new $r(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new $r(a,r[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,n=void 0,s={}),i=i.concat(Nr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Vr,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return Lr(We(r[1]))?i.concat([new $r(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(bn({key:`${a}[1]`,value:r[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Tr(e.value),l=Ze(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new $r(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new $r(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return xr(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $r(e.key,c,r)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof n&&void 0!==n&&l<n?[new $r(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new $r(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new $r(e.key,c,`integer expected, found ${String(l)}`)]}}function qr(e){const t=("property"===e.expressionContext?Or:Dr)(We(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new $r(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new $r(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ai(i))return[new $r(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Zr(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!li(i,["zoom","feature-state"]))return[new $r(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!si(i))return[new $r(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zr(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const r=[];return e instanceof $t&&i.has(e.name)?[new $r(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{r.push(...Zr(e,t))})),r)}function Wr(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ze(i))&&n.push(new $r(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Ze(i))&&n.push(new $r(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function Hr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Hr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Xr(e,t="fill"){if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hr(e)||(e=rn(e));const i=e;let r=!0;try{r=function(e){if(!Jr(e))return e;let t=We(e);return Yr(t),t=Kr(t),t}(i)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const n=Ge[`filter_${t}`],o=Dr(r,n);let s=null;if("error"===o.result)throw new Error(o.value.map((e=>`${e.key}: ${e.message}`)).join(", "));s=(e,t,i)=>o.value.evaluate(e,t,{},i);let a=null,l=null;if(r!==i){const e=Dr(i,n);if("error"===e.result)throw new Error(e.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a=(t,i,r,n,o)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,o),l=!si(e.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:tn(r),needFeature:!!l}}function Kr(e){if(!Array.isArray(e))return e;const t=function(e){if(Qr.has(e[0]))for(let t=1;t<e.length;t++)if(Jr(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>Kr(e)))}function Yr(e){let t=!1;const i=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||Jr(e[r]),i.push(e[r+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||Jr(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||Jr(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let t=1;t<e.length;t++)Yr(e[t])}function Jr(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let t=1;t<e.length;t++)if(Jr(e[t]))return!0;return!1}const Qr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function en(e,t){return e<t?-1:e>t?1:0}function tn(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let t=1;t<e.length;t++)if(tn(e[t]))return!0;return!1}function rn(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?nn(e[1],e[2],"=="):"!="===t?an(nn(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?nn(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(rn))):"all"===t?["all"].concat(e.slice(1).map(rn)):"none"===t?["all"].concat(e.slice(1).map(rn).map(an)):"in"===t?on(e[1],e.slice(2)):"!in"===t?an(on(e[1],e.slice(2))):"has"===t?sn(e[1]):"!has"===t?an(sn(e[1])):"within"!==t||e;var i}function nn(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function on(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(en)]]:["filter-in-small",e,["literal",t]]}}function sn(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function an(e){return["!",e]}function ln(e){return Hr(We(e.value))?qr(qe({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):cn(e)}function cn(e){const t=e.value,i=e.key;if("array"!==Tr(t))return[new $r(i,t,`array expected, ${Tr(t)} found`)];const r=e.styleSpec;let n,o=[];if(t.length<1)return[new $r(i,t,"filter array must have at least 1 element")];switch(o=o.concat(Wr({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ze(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Ze(t[1])&&o.push(new $r(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new $r(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=Tr(t[1]),"string"!==n&&o.push(new $r(`${i}[1]`,t[1],`string expected, ${n} found`)));for(let s=2;s<t.length;s++)n=Tr(t[s]),"$type"===Ze(t[1])?o=o.concat(Wr({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new $r(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(cn({key:`${i}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=Tr(t[1]),2!==t.length?o.push(new $r(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new $r(`${i}[1]`,t[1],`string expected, ${n} found`));break;case"within":n=Tr(t[1]),2!==t.length?o.push(new $r(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==n&&o.push(new $r(`${i}[1]`,t[1],`object expected, ${n} found`))}return o}function un(e,t){const i=e.key,r=e.style,n=e.styleSpec,o=e.value,s=e.objectKey,a=n[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return bn({key:i,value:o,valueSpec:n.transition,style:r,styleSpec:n});const c=e.valueSpec||a[s];if(!c)return[new $r(i,o,`unknown property "${s}"`)];let u;if("string"===Tr(o)&&xr(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new $r(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&r&&!r.glyphs&&h.push(new $r(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Sr(We(o))&&"identity"===Ze(o.type)&&h.push(new $r(i,o,'"text-font" does not support identity functions'))),h.concat(bn({key:e.key,value:o,valueSpec:c,style:r,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:s}))}function hn(e){return un(e,"paint")}function dn(e){return un(e,"layout")}function pn(e){let t=[];const i=e.value,r=e.key,n=e.style,o=e.styleSpec;i.type||i.ref||t.push(new $r(r,i,'either "type" or "ref" is required'));let s=Ze(i.type);const a=Ze(i.ref);if(i.id){const o=Ze(i.id);for(let s=0;s<e.arrayIndex;s++){const e=n.layers[s];Ze(e.id)===o&&t.push(new $r(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new $r(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{Ze(t.id)===a&&(e=t)})),e?e.ref?t.push(new $r(r,i.ref,"ref cannot reference another ref layer")):s=Ze(e.type):"string"==typeof a&&t.push(new $r(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const e=n.sources&&n.sources[i.source],o=e&&Ze(e.type);e?"vector"===o&&"raster"===s?t.push(new $r(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new $r(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new $r(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics||t.push(new $r(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new $r(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new $r(r,i.source,`source "${i.source}" not found`))}else t.push(new $r(r,i,'missing required property "source"'));return t=t.concat(Nr({key:r,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bn({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>ln(qe({layerType:s},e)),layout:e=>Nr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>dn(qe({layerType:s},e))}}),paint:e=>Nr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>hn(qe({layerType:s},e))}})}})),t}function fn(e){const t=e.value,i=e.key,r=Tr(t);return"string"!==r?[new $r(i,t,`string expected, ${r} found`)]:[]}const mn={promoteId:function({key:e,value:t}){if("string"===Tr(t))return fn({key:e,value:t});{const i=[];for(const r in t)i.push(...fn({key:`${e}.${r}`,value:t[r]}));return i}}};function gn(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style;if(!t.type)return[new $r(i,t,'"type" is required')];const o=Ze(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Nr({key:i,value:t,valueSpec:r[`source_${o.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:mn}),s;case"geojson":if(s=Nr({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:mn}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;s.push(...qr({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),s.push(...qr({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Nr({key:i,value:t,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Nr({key:i,value:t,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new $r(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wr({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:r})}}function yn(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];const s=Tr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new $r("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&r[s[1]]&&r[s[1]].transition?bn({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):r[e]?bn({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i}):[new $r(e,t[e],`unknown property "${e}"`)])}return o}function _n(e){const t=e.value,i=e.key,r=e.style,n=e.styleSpec,o=n.terrain;let s=[];const a=Tr(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new $r("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const i=e.match(/^(.*)-transition$/);s=s.concat(i&&o[i[1]]&&o[i[1]].transition?bn({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):o[e]?bn({key:e,value:t[e],valueSpec:o[e],style:r,styleSpec:n}):[new $r(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=r.sources&&r.sources[t.source],n=e&&Ze(e.type);e?"raster-dem"!==n&&s.push(new $r(i,t.source,`terrain cannot be used with a source of type ${String(n)}, it only be used with a "raster-dem" source type`)):s.push(new $r(i,t.source,`source "${t.source}" not found`))}else s.push(new $r(i,t,'terrain is missing required property "source"'));return s}function vn(e){const t=e.value,i=e.style,r=e.styleSpec,n=r.fog;let o=[];const s=Tr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new $r("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=o.concat(s&&n[s[1]]&&n[s[1]].transition?bn({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):n[e]?bn({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}):[new $r(e,t[e],`unknown property "${e}"`)])}return o}const xn={"*":()=>[],array:Ur,boolean:function(e){const t=e.value,i=e.key,r=Tr(t);return"boolean"!==r?[new $r(i,t,`boolean expected, ${r} found`)]:[]},number:Vr,color:function(e){const t=e.key,i=e.value,r=Tr(i);return"string"!==r?[new $r(t,i,`color expected, ${r} found`)]:null===mt.parseCSSColor(i)?[new $r(t,i,`color expected, "${i}" found`)]:[]},enum:Wr,filter:ln,function:Gr,layer:pn,object:Nr,source:gn,light:yn,terrain:_n,fog:vn,string:fn,formatted:function(e){return 0===fn(e).length?[]:qr(e)},resolvedImage:function(e){return 0===fn(e).length?[]:qr(e)},projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,n=e.style;let o=[];const s=Tr(t);if("object"===s)for(const e in t)o=o.concat(bn({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i}));else"string"!==s&&(o=o.concat([new $r("projection",t,`object or string expected, ${s} found`)]));return o}};function bn(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;return i.expression&&Sr(Ze(t))?Gr(e):i.expression&&Lr(We(t))?qr(e):i.type&&xn[i.type]?xn[i.type](e):Nr(qe({},e,{valueSpec:i.type?r[i.type]:i}))}function wn(e){const t=e.value,i=e.key,r=fn(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new $r(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new $r(i,t,'"glyphs" url must include a "{range}" token'))),r}function Tn(e,t=Ge){return Mn(bn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wn,"*":()=>[]}}))}const Sn=e=>Mn(hn(e)),Cn=e=>Mn(dn(e));function Mn(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function kn(e,t){let i=!1;if(t&&t.length)for(const r of t)e.fire(new Ue(new Error(r.message))),i=!0;return i}var En=An;function An(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var o=0;o<this.d*this.d;o++){var s=n[3+o],a=n[3+o+1];r.push(s===a?null:n.subarray(s,a))}var l=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var u=i/t*e;this.min=-u,this.max=e+u}An.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},An.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},An.prototype._insertCell=function(e,t,i,r,n,o){this.cells[n].push(o)},An.prototype.query=function(e,t,i,r,n){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,i,r,this._queryCell,a,{},n),a},An.prototype._queryCell=function(e,t,i,r,n,o,s,a){var l=this.cells[n];if(null!==l)for(var c=this.keys,u=this.bboxes,h=0;h<l.length;h++){var d=l[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&i>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(c[d])):s[d]=!1}}},An.prototype._forEachCell=function(e,t,i,r,n,o,s,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r),d=l;d<=u;d++)for(var p=c;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,o,s,a))return}},An.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},An.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},An.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];n[3+s]=o,n.set(a,o),o+=a.length}return n[3+e.length]=o,n.set(this.keys,o),n[3+e.length+1]=o+=this.keys.length,n.set(this.bboxes,o),o+=this.bboxes.length,n.buffer};const In={};function zn(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),In[t]={klass:e,omit:i.omit||[]}}zn(Object,"Object"),En.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},En.deserialize=function(e){return new En(e.buffer)},Object.defineProperty(En,"name",{value:"Grid"}),zn(En,"Grid"),zn(yt,"Color"),zn(Error,"Error"),zn(Ee,"AJAXError"),zn(bt,"ResolvedImage"),zn(Fr,"StylePropertyFunction"),zn(Pr,"StyleExpression",{omit:["_evaluator"]}),zn(Br,"ZoomDependentExpression"),zn(Rr,"ZoomConstantExpression"),zn($t,"CompoundExpression",{omit:["_evaluate"]});for(const e in yr)In[yr[e]._classRegistryKey]||zn(yr[e],`Expression${e}`);function Pn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ln(e){return t.ImageBitmap&&e instanceof t.ImageBitmap}function Dn(e,i){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Pn(e)||Ln(e))return i&&i.push(e),e;if(ArrayBuffer.isView(e)){const t=e;return i&&i.push(t.buffer),t}if(e instanceof t.ImageData)return i&&i.push(e.data.buffer),e;if(Array.isArray(e)){const t=[];for(const r of e)t.push(Dn(r,i));return t}if("object"==typeof e){const t=e.constructor,r=t._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const n=t.serialize?t.serialize(e,i):{};if(!t.serialize){for(const t in e)e.hasOwnProperty(t)&&(In[r].omit.indexOf(t)>=0||(n[t]=Dn(e[t],i)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof e)}function Rn(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Pn(e)||Ln(e)||ArrayBuffer.isView(e)||e instanceof t.ImageData)return e;if(Array.isArray(e))return e.map(Rn);if("object"==typeof e){const t=e.$name||"Object",{klass:i}=In[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const t of Object.keys(e))"$name"!==t&&(r[t]=Rn(e[t]));return r}throw new Error("can't deserialize object of type "+typeof e)}class Bn{constructor(){this.first=!0}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const On=e=>e>=1536&&e<=1791,Fn=e=>e>=1872&&e<=1919,jn=e=>e>=2208&&e<=2303,$n=e=>e>=11904&&e<=12031,Nn=e=>e>=12032&&e<=12255,Un=e=>e>=12272&&e<=12287,Vn=e=>e>=12288&&e<=12351,Gn=e=>e>=12352&&e<=12447,qn=e=>e>=12448&&e<=12543,Zn=e=>e>=12544&&e<=12591,Wn=e=>e>=12704&&e<=12735,Hn=e=>e>=12736&&e<=12783,Xn=e=>e>=12784&&e<=12799,Kn=e=>e>=12800&&e<=13055,Yn=e=>e>=13056&&e<=13311,Jn=e=>e>=13312&&e<=19903,Qn=e=>e>=19968&&e<=40959,eo=e=>e>=40960&&e<=42127,to=e=>e>=42128&&e<=42191,io=e=>e>=44032&&e<=55215,ro=e=>e>=63744&&e<=64255,no=e=>e>=64336&&e<=65023,oo=e=>e>=65040&&e<=65055,so=e=>e>=65072&&e<=65103,ao=e=>e>=65104&&e<=65135,lo=e=>e>=65136&&e<=65279,co=e=>e>=65280&&e<=65519;function uo(e){for(const t of e)if(fo(t.charCodeAt(0)))return!0;return!1}function ho(e){for(const t of e)if(!po(t.charCodeAt(0)))return!1;return!0}function po(e){return!(On(e)||Fn(e)||jn(e)||no(e)||lo(e))}function fo(e){return!(746!==e&&747!==e&&(e<4352||!(Wn(e)||Zn(e)||so(e)&&!(e>=65097&&e<=65103)||ro(e)||Yn(e)||$n(e)||Hn(e)||!(!Vn(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Jn(e)||Qn(e)||Kn(e)||(e=>e>=12592&&e<=12687)(e)||(e=>e>=43360&&e<=43391)(e)||(e=>e>=55216&&e<=55295)(e)||(e=>e>=4352&&e<=4607)(e)||io(e)||Gn(e)||Un(e)||(e=>e>=12688&&e<=12703)(e)||Nn(e)||Xn(e)||qn(e)&&12540!==e||!(!co(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ao(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||(e=>e>=5120&&e<=5759)(e)||(e=>e>=6320&&e<=6399)(e)||oo(e)||(e=>e>=19904&&e<=19967)(e)||eo(e)||to(e))))}function mo(e){return!(fo(e)||function(e){return!!((e=>e>=128&&e<=255)(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(e=>e>=8192&&e<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(e=>e>=8448&&e<=8527)(e)||(e=>e>=8528&&e<=8591)(e)||(e=>e>=8960&&e<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(e=>e>=9216&&e<=9279)(e)&&9251!==e||(e=>e>=9280&&e<=9311)(e)||(e=>e>=9312&&e<=9471)(e)||(e=>e>=9632&&e<=9727)(e)||(e=>e>=9728&&e<=9983)(e)&&!(e>=9754&&e<=9759)||(e=>e>=11008&&e<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Vn(e)||qn(e)||(e=>e>=57344&&e<=63743)(e)||so(e)||ao(e)||co(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function go(e){return e>=1424&&e<=2303||no(e)||lo(e)}function yo(e,t){return!(!t&&go(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||(e=>e>=6016&&e<=6143)(e))}function _o(e){for(const t of e)if(go(t.charCodeAt(0)))return!0;return!1}const vo="deferred",xo="loading",bo="loaded";let wo=null,To="unavailable",So=null;const Co=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(To="error"),wo&&wo(e)};function Mo(){ko.fire(new Ne("pluginStateChange",{pluginStatus:To,pluginURL:So}))}const ko=new Ve,Eo=function(){return To},Ao=function(){if(To!==vo||!So)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=xo,Mo(),So&&ze({url:So},(e=>{e?Co(e):(To=bo,Mo())}))},Io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===bo||null!=Io.applyArabicShaping,isLoading:()=>To===xo,setState(e){To=e.pluginStatus,So=e.pluginURL},isParsed:()=>null!=Io.applyArabicShaping&&null!=Io.processBidirectionalText&&null!=Io.processStyledBidirectionalText,getPluginURL:()=>So};class zo{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bn,this.transition={},this.pitch=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!yo(i.charCodeAt(0),t))return!1;return!0}(e,Io.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class Po{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Sr(e))return new Fr(e,t);if(Lr(e)){const i=Or(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=yt.parse(e)),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Lo{constructor(e){this.property=e,this.value=new Po(e,void 0)}transitioned(e,t){return new Ro(this.property,this.value,t,v({},e.transition,this.transition),e.now)}untransitioned(){return new Ro(this.property,this.value,null,{},0)}}class Do{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return A(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Lo(this._values[e].property)),this._values[e].value=new Po(this._values[e].property,null===t?void 0:A(t))}getTransition(e){return A(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Lo(this._values[e].property)),this._values[e].transition=A(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new Bo(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new Bo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ro{constructor(e,t,i,r,n){const o=r.delay||0,s=r.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+o,this.end=this.begin+s,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),n,h(s))}}return n}}class Bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new jo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Oo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return A(this._values[e].value)}setValue(e,t){this._values[e]=new Po(this._values[e].property,null===t?void 0:A(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new jo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class Fo{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class jo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $o{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const r=_i[this.specification.type];return r?r(e,t,i):e}}class No{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new Fo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Fo(this,{kind:"constant",value:void 0},e.parameters);const r=_i[this.specification.type];return r?new Fo(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,o){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,o)}}class Uo extends No{possiblyEvaluate(e,t,i,r){if(void 0===e.value)return new Fo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r),o="resolvedImage"===e.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,t);return new Fo(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Fo(this,{kind:"constant",value:i},t)}return new Fo(this,e.expression,t)}evaluate(e,t,i,r,n,o){if("source"===e.kind){const s=e.evaluate(t,i,r,n,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,r),e.evaluate({zoom:Math.floor(t.zoom)},i,r),e.evaluate({zoom:Math.floor(t.zoom)+1},i,r),t):e.value}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t,other:i}:{from:i,to:t,other:e}}interpolate(e){return e}}class Vo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){if(void 0!==e.value){if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r);return this._calculate(n,n,n,t)}return this._calculate(e.expression.evaluate(new zo(Math.floor(t.zoom-1),t)),e.expression.evaluate(new zo(Math.floor(t.zoom),t)),e.expression.evaluate(new zo(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Go{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class qo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new zo(0,{});for(const i in e){const r=e[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new Po(r,void 0),o=this.defaultTransitionablePropertyValues[i]=new Lo(r);this.defaultTransitioningPropertyValues[i]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(t)}}}function Zo(e,t){return 256*(e=f(Math.floor(e),0,255))+f(Math.floor(t),0,255)}zn(No,"DataDrivenProperty"),zn($o,"DataConstantProperty"),zn(Uo,"CrossFadedDataDrivenProperty"),zn(Vo,"CrossFadedProperty"),zn(Go,"ColorRampProperty");const Wo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ho{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ko(e,t=1){let i=0,r=0;return{members:e.map((e=>{const n=Wo[e.type].BYTES_PER_ELEMENT,o=i=Yo(i,Math.max(t,n)),s=e.components||1;return r=Math.max(r,n),i+=n*s,{name:e.name,type:e.type,components:s,offset:o}})),size:Yo(i,Math.max(r,t)),alignment:t}}function Yo(e,t){return Math.ceil(e/t)*t}class Jo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}Jo.prototype.bytesPerElement=4,zn(Jo,"StructArrayLayout2i4");class Qo extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Qo.prototype.bytesPerElement=6,zn(Qo,"StructArrayLayout3i6");class es extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,e}}es.prototype.bytesPerElement=8,zn(es,"StructArrayLayout4i8");class ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=o,this.uint8[c+7]=s,this.float32[u+2]=a,e}}ts.prototype.bytesPerElement=12,zn(ts,"StructArrayLayout2i4ub1f12");class is extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,e}}is.prototype.bytesPerElement=16,zn(is,"StructArrayLayout4f16");class rs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,i,r,n,o,s,a,l,c)}emplace(e,t,i,r,n,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}rs.prototype.bytesPerElement=20,zn(rs,"StructArrayLayout10ui20");class ns extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,i,r,n,o,s,a)}emplace(e,t,i,r,n,o,s,a,l){const c=8*e;return this.uint16[c+0]=t,this.uint16[c+1]=i,this.uint16[c+2]=r,this.uint16[c+3]=n,this.uint16[c+4]=o,this.uint16[c+5]=s,this.uint16[c+6]=a,this.uint16[c+7]=l,e}}ns.prototype.bytesPerElement=16,zn(ns,"StructArrayLayout8ui16");class os extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}os.prototype.bytesPerElement=12,zn(os,"StructArrayLayout6i12");class ss extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,o,s,a,l,c,u,h)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ss.prototype.bytesPerElement=24,zn(ss,"StructArrayLayout4i4ui4i24");class as extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.float32[l+2]=n,this.float32[l+3]=o,this.float32[l+4]=s,e}}as.prototype.bytesPerElement=20,zn(as,"StructArrayLayout3i3f20");class ls extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}ls.prototype.bytesPerElement=4,zn(ls,"StructArrayLayout1ul4");class cs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,o,s,a,l,c,u,h,d)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}cs.prototype.bytesPerElement=40,zn(cs,"StructArrayLayout5i4f1i1ul2ui40");class us extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=o,this.int16[l+6]=s,this.int16[l+7]=a,e}}us.prototype.bytesPerElement=16,zn(us,"StructArrayLayout3i2i2i16");class hs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,e}}hs.prototype.bytesPerElement=16,zn(hs,"StructArrayLayout2f1f2i16");class ds extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=12*e,s=3*e;return this.uint8[o+0]=t,this.uint8[o+1]=i,this.float32[s+1]=r,this.float32[s+2]=n,e}}ds.prototype.bytesPerElement=12,zn(ds,"StructArrayLayout2ub2f12");class ps extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}ps.prototype.bytesPerElement=12,zn(ps,"StructArrayLayout3f12");class fs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}fs.prototype.bytesPerElement=6,zn(fs,"StructArrayLayout3ui6");class ms extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b){const w=30*e,T=15*e,S=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=r,this.float32[T+2]=n,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=l,this.uint32[T+6]=c,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[S+48]=g,this.uint8[S+49]=y,this.uint8[S+50]=_,this.uint32[T+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,e}}ms.prototype.bytesPerElement=60,zn(ms,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class gs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k,E,A){const I=this.length;return this.resize(I+1),this.emplace(I,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k,E,A)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k,E,A,I){const z=38*e,P=19*e;return this.int16[z+0]=t,this.int16[z+1]=i,this.int16[z+2]=r,this.float32[P+2]=n,this.float32[P+3]=o,this.int16[z+8]=s,this.int16[z+9]=a,this.int16[z+10]=l,this.int16[z+11]=c,this.int16[z+12]=u,this.int16[z+13]=h,this.uint16[z+14]=d,this.uint16[z+15]=p,this.uint16[z+16]=f,this.uint16[z+17]=m,this.uint16[z+18]=g,this.uint16[z+19]=y,this.uint16[z+20]=_,this.uint16[z+21]=v,this.uint16[z+22]=x,this.uint16[z+23]=b,this.uint16[z+24]=w,this.uint16[z+25]=T,this.uint16[z+26]=S,this.uint16[z+27]=C,this.uint16[z+28]=M,this.uint32[P+15]=k,this.float32[P+16]=E,this.float32[P+17]=A,this.float32[P+18]=I,e}}gs.prototype.bytesPerElement=76,zn(gs,"StructArrayLayout3i2f6i15ui1ul3f76");class ys extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ys.prototype.bytesPerElement=4,zn(ys,"StructArrayLayout1f4");class _s extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n,o,s)}emplace(e,t,i,r,n,o,s,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=o,this.float32[l+5]=s,this.float32[l+6]=a,e}}_s.prototype.bytesPerElement=28,zn(_s,"StructArrayLayout7f28");class vs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=5*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.float32[s+3]=n,this.float32[s+4]=o,e}}vs.prototype.bytesPerElement=20,zn(vs,"StructArrayLayout5f20");class xs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=i,this.uint16[o+3]=r,this.uint16[o+4]=n,e}}xs.prototype.bytesPerElement=12,zn(xs,"StructArrayLayout1ul3ui12");class bs extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}bs.prototype.bytesPerElement=4,zn(bs,"StructArrayLayout2ui4");class ws extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ws.prototype.bytesPerElement=2,zn(ws,"StructArrayLayout1ui2");class Ts extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}Ts.prototype.bytesPerElement=8,zn(Ts,"StructArrayLayout2f8");class Ss extends Ho{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ss.prototype.size=12;class Cs extends os{get(e){return new Ss(this,e)}}zn(Cs,"FillExtrusionExtArray");class Ms extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ms.prototype.size=40;class ks extends cs{get(e){return new Ms(this,e)}}zn(ks,"CollisionBoxArray");class Es extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Es.prototype.size=60;class As extends ms{get(e){return new Es(this,e)}}zn(As,"PlacedSymbolArray");class Is extends Ho{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Is.prototype.size=76;class zs extends gs{get(e){return new Is(this,e)}}zn(zs,"SymbolInstanceArray");class Ps extends ys{getoffsetX(e){return this.float32[1*e+0]}}zn(Ps,"GlyphOffsetArray");class Ls extends Qo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}zn(Ls,"SymbolLineVertexArray");class Ds extends Ho{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ds.prototype.size=12;class Rs extends xs{get(e){return new Ds(this,e)}}zn(Rs,"FeatureIndexArray");class Bs extends Ho{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Bs.prototype.size=4;class Os extends bs{get(e){return new Bs(this,e)}}zn(Os,"FillExtrusionCentroidArray");class Fs extends Ho{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Fs.prototype.size=12;class js extends os{get(e){return new Fs(this,e)}}zn(js,"CircleGlobeExtArray");const $s=Ko([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ns=Ko([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Us=ft((function(e){e.exports=function(e,t){var i,r,n,o,s,a,l,c;for(r=e.length-(i=3&e.length),n=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}})),Vs=ft((function(e){e.exports=function(e,t){for(var i,r=e.length,n=t^r,o=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}})),Gs=Us,qs=Vs;Gs.murmur3=Us,Gs.murmur2=qs;class Zs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(Ws(e)),this.positions.push(t,i,r)}getPositions(e){const t=Ws(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=t?r=e:i=e+1}const n=[];for(;this.ids[i]===t;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return Hs(i,r,0,i.length-1),t&&t.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(e){const t=new Zs;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function Ws(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Gs(String(e))}function Hs(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(e[o]<n);do{s--}while(e[s]>n);if(o>=s)break;Xs(e,o,s),Xs(t,3*o,3*s),Xs(t,3*o+1,3*s+1),Xs(t,3*o+2,3*s+2)}s-i<r-s?(Hs(e,t,i,s),i=s+1):(Hs(e,t,s+1,r),r=s)}}function Xs(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}zn(Zs,"FeaturePositionMap");class Ks{constructor(e,t){this.gl=e.gl,this.location=t}}class Ys extends Ks{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Js extends Ks{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qs extends Ks{constructor(e,t){super(e,t),this.current=yt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ea=new Float32Array(16),ta=new Float32Array(9),ia=new Float32Array(4);function ra(e){return[Zo(255*e.r,255*e.g),Zo(255*e.b,255*e.a)]}class na{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i){e.set(i.constantOr(this.value))}getBinding(e,t,i){return"color"===this.type?new Qs(e,t):new Ys(e,t)}}class oa{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=t.tl.concat(t.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,t,i,r){const n="u_pattern_to"===r||"u_dash_to"===r?this.patternTo:"u_pattern_from"===r||"u_dash_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&e.set(n)}getBinding(e,t,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new Js(e,t):new Ys(e,t)}}class sa{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new zo(0),t,{},n,r,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,a)}updatePaintArray(e,t,i,r,n){const o=this.expression.evaluate({zoom:0},i,r,void 0,n);this._setPaintValue(e,t,o)}_setPaintValue(e,t,i){if("color"===this.type){const r=ra(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(e,t,i,r,n,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,r,n,o){const s=this.expression.evaluate(new zo(this.zoom),t,{},n,r,o),a=this.expression.evaluate(new zo(this.zoom+1),t,{},n,r,o),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,s,a)}updatePaintArray(e,t,i,r,n){const o=this.expression.evaluate({zoom:this.zoom},i,r,void 0,n),s=this.expression.evaluate({zoom:this.zoom+1},i,r,void 0,n);this._setPaintValue(e,t,o,s)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=ra(i),o=ra(r);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=f(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,i){return new Ys(e,t)}}class la{constructor(e,t,i,r,n,o,s){this.expression=e,this.type=i,this.useIntegerZoom=r,this.zoom=n,this.layerId=s,this.paintVertexAttributes=("array"===i?Ns:$s).members;for(let e=0;e<t.length;++e);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(e,t,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],o)}_setPaintValues(e,t,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=e;i<t;i++)this._setPaintValue(this.zoomInPaintVertexArray,i,l,a),this._setPaintValue(this.zoomOutPaintVertexArray,i,l,c)}_setPaintValue(e,t,i,r){e.emplace(t,i.tl[0],i.tl[1],i.br[0],i.br[1],r.tl[0],r.tl[1],r.br[0],r.br[1],i.pixelRatio,r.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ca{constructor(e,t,i=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const n in e.paint._values){if(!i(n))continue;const o=e.paint.get(n);if(!(o instanceof Fo&&xr(o.property.specification)))continue;const s=da(n,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(n)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const i=ma(n,l,"source");this.binders[n]=h?new la(a,s,l,c,t,i,e.id):new sa(a,s,l,i),r.push(`/a_${n}`)}else{const e=ma(n,l,"composite");this.binders[n]=new aa(a,s,l,c,t,e),r.push(`/z_${n}`)}else this.binders[n]=h?new oa(a.value,s):new na(a.value,s,l),r.push(`/u_${n}`)}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof sa||t instanceof aa?t.maxValue:0}populatePaintArrays(e,t,i,r,n,o){for(const s in this.binders){const a=this.binders[s];(a instanceof sa||a instanceof aa||a instanceof la)&&a.populatePaintArray(e,t,i,r,n,o)}}setConstantPatternPositions(e,t){for(const i in this.binders){const r=this.binders[i];r instanceof oa&&r.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,i,r,n,o){let s=!1;for(const a in e){const l=t.getPositions(a);for(const t of l){const l=i.feature(t.index);for(const i in this.binders){const c=this.binders[i];if((c instanceof sa||c instanceof aa||c instanceof la)&&!0===c.expression.isStateDependent){const u=r.paint.get(i);c.expression=u.value,c.updatePaintArray(t.start,t.end,l,e[a],n,o),s=!0}}}}return s}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof na||i instanceof oa)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof sa||i instanceof aa||i instanceof la)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof na||i instanceof oa||i instanceof aa)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof na||n instanceof oa||n instanceof aa)for(const o of n.uniformNames)if(t[o]){const s=n.getBinding(e,t[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(e,t,i,r){for(const{name:e,property:n,binding:o}of t)this.binders[n].setUniform(o,r,i.get(n),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const i=this.binders[t];if(e&&i instanceof la){const t=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(i instanceof sa||i instanceof aa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof sa||i instanceof aa||i instanceof la)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof sa||t instanceof aa||t instanceof la)&&t.destroy()}}}class ua{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new ca(r,t,i);this.needsUpload=!1,this._featureMap=new Zs,this._bufferOffset=0}populatePaintArrays(e,t,i,r,n,o,s){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,o,s);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r,n){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,r,n)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ha={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function da(e,t){return ha[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const pa={"line-pattern":{source:rs,composite:rs},"fill-pattern":{source:rs,composite:rs},"fill-extrusion-pattern":{source:rs,composite:rs},"line-dasharray":{source:ns,composite:ns}},fa={color:{source:Ts,composite:is},number:{source:ys,composite:Ts}};function ma(e,t,i){const r=pa[e];return r&&r[i]||fa[t][i]}zn(na,"ConstantBinder"),zn(oa,"CrossFadedConstantBinder"),zn(sa,"SourceExpressionBinder"),zn(la,"CrossFadedCompositeBinder"),zn(aa,"CompositeExpressionBinder"),zn(ca,"ProgramConfiguration",{omit:["_buffers"]}),zn(ua,"ProgramConfigurationSet");const ga="-transition";class ya extends Ve{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Oo(t.layout)),t.paint)){this._transitionablePaint=new Do(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jo(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(Cn,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return M(e,ga)?this._transitionablePaint.getTransition(e.slice(0,-ga.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(Sn,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(M(e,ga))return this._transitionablePaint.setTransition(e.slice(0,-ga.length),t||void 0),!1;{const i=this._transitionablePaint._values[e],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),E(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,r,n={}){return(!n||!1!==n.validate)&&kn(this,e.call(Tn,{key:t,layerType:this.type,objectKey:i,value:r,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Fo&&xr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Xr(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _a=Ko([{name:"a_pos",components:2,type:"Int16"}],4),va=Ko([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xa{constructor(e=[]){this.segments=e}prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>xa.MAX_VERTEX_ARRAY_LENGTH&&z(`Max vertices per segment is ${xa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!n||n.vertexLength+e>xa.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new xa([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}xa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zn(xa,"SegmentVector");var ba=8192;class wa{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Sa?new Sa(e.lng,e.lat):Sa.convert(e),this}setSouthWest(e){return this._sw=e instanceof Sa?new Sa(e.lng,e.lat):Sa.convert(e),this}extend(e){const t=this._sw,i=this._ne;let r,n;if(e instanceof Sa)r=e,n=e;else{if(!(e instanceof wa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(wa.convert(e)):this.extend(Sa.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Sa(r.lng,r.lat),this._ne=new Sa(n.lng,n.lat)),this}getCenter(){return new Sa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sa(this.getWest(),this.getNorth())}getSouthEast(){return new Sa(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=Sa.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return!e||e instanceof wa?e:new wa(e)}}const Ta=6371008.8;class Sa{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sa(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return Ta*Math.acos(Math.min(n,1))}toBounds(e=0){const t=360*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return new wa(new Sa(this.lng-i,this.lat-t),new Sa(this.lng+i,this.lat+t))}static convert(e){if(e instanceof Sa)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Sa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Sa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ca=2*Math.PI*Ta;function Ma(e){return Ca*Math.cos(e*Math.PI/180)}function ka(e){return(180+e)/360}function Ea(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Aa(e,t){return e/Ma(t)}function Ia(e){return 360*e-180}function za(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Pa(e,t){return e*Ma(za(t))}const La=85.051129;class Da{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=Sa.convert(e);return new Da(ka(i.lng),Ea(i.lat),Aa(t,i.lat))}toLngLat(){return new Sa(Ia(this.x),za(this.y))}toAltitude(){return Pa(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ca*(e=za(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ra(e,t,i,r,o,s,a,l,c){const u=(t+r)/2,h=(i+o)/2,d=new n(u,h);l(d),function(e,t,i,r,n,o){const s=i-n,a=r-o;return Math.abs((r-t)*s-(i-e)*a)/Math.hypot(s,a)}(d.x,d.y,s.x,s.y,a.x,a.y)>=c?(Ra(e,t,i,u,h,s,d,l,c),Ra(e,u,h,r,o,d,a,l,c)):e.push(a)}function Ba(e,t,i){let r=e[0],n=r.x,o=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),Ra(s,n,o,c,u,r,l,t,i),n=c,o=u,r=l}return s}function Oa(e,t,i,r,n){if(n(t,i)){const o=t.add(i).mult(.5);r(o),Oa(e,t,o,r,n),Oa(e,o,i,r,n)}else e.push(i)}function Fa(e,t,i){let r=e[0];t(r);const n=[r];for(let o=1;o<e.length;o++){const s=e[o];t(s),Oa(n,r,s,t,i),r=s}return n}const ja=Math.pow(2,14)-1,$a=-ja-1;function Na(e,t){const i=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=f(i,$a,ja),e.y=f(r,$a,ja),(i<e.x||i>e.x+1||r<e.y||r>e.y+1)&&z("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Ua(e,t,i){const r=e.loadGeometry(),n=e.extent,o=ba/n;if(t&&i&&i.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:s,x:a,y:l,projection:c}=i,u=e=>{const i=Ia((t.x+e.x/n)/o),r=za((t.y+e.y/n)/o),u=c.project(i,r);e.x=(u.x*s-a)*n,e.y=(u.y*s-l)*n};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=Ba(r[t],u,1);else{const e=[];for(const i of r[t])i.x<0||i.x>=n||i.y<0||i.y>=n||(u(i),e.push(i));r[t]=e}}for(const e of r)for(const t of e)Na(t,o);return r}function Va(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ua(e):[]}}function Ga(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}function qa(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class Za{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Jo,this.indexArray=new fs,this.segments=new xa,this.programConfigurations=new ua(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,r){const n=this.layers[0],o=[];let s=null;"circle"===n.type&&(s=n.layout.get("circle-sort-key"));for(const{feature:t,id:n,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Va(t,e);if(!this.layers[0]._featureFilter.filter(new zo(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,h={id:n,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ua(t,i,r),patterns:{},sortKey:u};o.push(h)}s&&o.sort(((e,t)=>e.sortKey-t.sortKey));let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new js,a=r.projection);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r,l=e[o].feature;this.addFeature(r,n,o,t.availableImages,i,a),t.featureIndex.insert(l,n,o,s,this.index)}}update(e,t,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_a.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,va.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,r,n,o){for(const i of t)for(const t of i){const i=t.x,r=t.y;if(i<0||i>=ba||r<0||r>=ba)continue;if(o){const e=o.projectTilePoint(i,r,n),t=o.upVector(n,i,r),s=this.globeExtVertexArray;qa(s,e,t),qa(s,e,t),qa(s,e,t),qa(s,e,t)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=s.vertexLength;Ga(this.layoutVertexArray,i,r,-1,-1),Ga(this.layoutVertexArray,i,r,1,-1),Ga(this.layoutVertexArray,i,r,1,1),Ga(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,n)}}function Wa(e,t){for(let i=0;i<e.length;i++)if(il(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(il(e,t[i]))return!0;return!!Ya(e,t)}function Ha(e,t,i){return!!il(e,t)||!!Qa(t,e,i)}function Xa(e,t){if(1===e.length)return tl(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(il(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(tl(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Ya(e,t[i]))return!0;return!1}function Ka(e,t,i){if(e.length>1){if(Ya(e,t))return!0;for(let r=0;r<t.length;r++)if(Qa(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Qa(e[r],t,i))return!0;return!1}function Ya(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(Ja(r,n,t[e],t[e+1]))return!0}return!1}function Ja(e,t,i,r){return P(e,i,r)!==P(t,i,r)&&P(e,t,i)!==P(e,t,r)}function Qa(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(el(e,t[i-1],t[i])<r)return!0;return!1}function el(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function tl(e,t){let i,r,n,o=!1;for(let s=0;s<e.length;s++){i=e[s];for(let e=0,s=i.length-1;e<i.length;s=e++)r=i[e],n=i[s],r.y>t.y!=n.y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(o=!o)}return o}function il(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const o=e[r],s=e[n];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function rl(e,t,i,r,o){for(const n of e)if(t<=n.x&&i<=n.y&&r>=n.x&&o>=n.y)return!0;const s=[new n(t,i),new n(t,o),new n(r,o),new n(r,i)];if(e.length>2)for(const t of s)if(il(e,t))return!0;for(let t=0;t<e.length-1;t++)if(nl(e[t],e[t+1],s))return!0;return!1}function nl(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const o=P(e,t,i[0]);return o!==P(e,t,i[1])||o!==P(e,t,i[2])||o!==P(e,t,i[3])}function ol(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function sl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function al(e,t,i,r,o){if(!t[0]&&!t[1])return e;const s=n.convert(t)._mult(o);"viewport"===i&&s._rotate(-r);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(s));return a}function ll(e,t,i,r){const o=n.convert(e)._mult(r);return"viewport"===t&&o._rotate(-i),o}zn(Za,"CircleBucket",{omit:["layers"]});const cl=new qo({"circle-sort-key":new No(Ge.layout_circle["circle-sort-key"])});var ul={paint:new qo({"circle-radius":new No(Ge.paint_circle["circle-radius"]),"circle-color":new No(Ge.paint_circle["circle-color"]),"circle-blur":new No(Ge.paint_circle["circle-blur"]),"circle-opacity":new No(Ge.paint_circle["circle-opacity"]),"circle-translate":new $o(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new $o(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $o(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $o(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new No(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new No(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new No(Ge.paint_circle["circle-stroke-opacity"])}),layout:cl},hl=1e-6,dl="undefined"!=typeof Float32Array?Float32Array:Array;function pl(){var e=new dl(9);return dl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function fl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ml(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*r+x*a+b*h+w*m,e[1]=v*n+x*l+b*d+w*g,e[2]=v*o+x*c+b*p+w*y,e[3]=v*s+x*u+b*f+w*_,e[4]=(v=i[4])*r+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,e[5]=v*n+x*l+b*d+w*g,e[6]=v*o+x*c+b*p+w*y,e[7]=v*s+x*u+b*f+w*_,e[8]=(v=i[8])*r+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,e[9]=v*n+x*l+b*d+w*g,e[10]=v*o+x*c+b*p+w*y,e[11]=v*s+x*u+b*f+w*_,e[12]=(v=i[12])*r+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,e[13]=v*n+x*l+b*d+w*g,e[14]=v*o+x*c+b*p+w*y,e[15]=v*s+x*u+b*f+w*_,e}function gl(e,t,i){var r,n,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],y=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+a*g+h*y+t[12],e[13]=n*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e}function yl(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _l(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*r,e[5]=s*n+u*r,e[6]=a*n+h*r,e[7]=l*n+d*r,e[8]=c*n-o*r,e[9]=u*n-s*r,e[10]=h*n-a*r,e[11]=d*n-l*r,e}function vl(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*r,e[1]=s*n-u*r,e[2]=a*n-h*r,e[3]=l*n-d*r,e[8]=o*r+c*n,e[9]=s*r+u*n,e[10]=a*r+h*n,e[11]=l*r+d*n,e}function xl(e,t,i){var r,n,o,s=i[0],a=i[1],l=i[2],c=Math.hypot(s,a,l);return c<hl?null:(s*=c=1/c,a*=c,l*=c,r=Math.sin(t),n=Math.cos(t),e[0]=s*s*(o=1-n)+n,e[1]=a*s*o+l*r,e[2]=l*s*o-a*r,e[3]=0,e[4]=s*a*o-l*r,e[5]=a*a*o+n,e[6]=l*a*o+s*r,e[7]=0,e[8]=s*l*o+a*r,e[9]=a*l*o-s*r,e[10]=l*l*o+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var bl=ml;function wl(){var e=new dl(3);return dl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Tl(e){var t=new dl(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Sl(e){return Math.hypot(e[0],e[1],e[2])}function Cl(e,t,i){var r=new dl(3);return r[0]=e,r[1]=t,r[2]=i,r}function Ml(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function kl(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function El(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Al(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function Il(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function zl(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Pl(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Ll(e,t){var i=t[0],r=t[1],n=t[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function Dl(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Rl(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=n*l-o*a,e[1]=o*s-r*l,e[2]=r*a-n*s,e}function Bl(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,e}function Ol(e,t,i){var r=i[0],n=i[1],o=i[2],s=t[0],a=t[1],l=t[2],c=n*l-o*a,u=o*s-r*l,h=r*a-n*s,d=n*h-o*u,p=o*c-r*h,f=r*u-n*c,m=2*i[3];return u*=m,h*=m,p*=2,f*=2,e[0]=s+(c*=m)+(d*=2),e[1]=a+u+p,e[2]=l+h+f,e}var Fl,jl=kl,$l=El,Nl=Sl;function Ul(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Vl(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,e}function Gl(){var e=new dl(4);return dl!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ql(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Zl(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=n*l+o*a,e[2]=o*l-n*a,e[3]=s*l-r*a,e}function Wl(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-o*a,e[1]=n*l+s*a,e[2]=o*l+r*a,e[3]=s*l-n*a,e}wl(),Fl=new dl(4),dl!=Float32Array&&(Fl[0]=0,Fl[1]=0,Fl[2]=0,Fl[3]=0),wl(),Cl(1,0,0),Cl(0,1,0),Gl(),Gl(),pl();class Hl{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,i){const r=Dl(t,this.dir);if(Math.abs(r)<1e-6)return!1;const n=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/r;return i[0]=this.pos[0]+this.dir[0]*n,i[1]=this.pos[1]+this.dir[1]*n,i[2]=this.pos[2]+this.dir[2]*n,!0}closestPointOnSphere(e,t,i){if(function(e,t){var i=e[0],r=e[1],n=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(i-o)<=hl*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=hl*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=hl*Math.max(1,Math.abs(n),Math.abs(a))}(this.pos,e)||0===t)return i[0]=i[1]=i[2]=0,!1;const[r,n,o]=this.dir,s=this.pos[0]-e[0],a=this.pos[1]-e[1],l=this.pos[2]-e[2],c=r*r+n*n+o*o,u=2*(s*r+a*n+l*o),h=u*u-4*c*(s*s+a*a+l*l-t*t);if(h<0){const e=Math.max(-u/2,0),c=s+r*e,h=a+n*e,d=l+o*e,p=Math.hypot(c,h,d);return i[0]=c*t/p,i[1]=h*t/p,i[2]=d*t/p,!1}{const e=(-u-Math.sqrt(h))/(2*c);if(e<0){const e=Math.hypot(s,a,l);return i[0]=s*t/e,i[1]=a*t/e,i[2]=l*t/e,!1}return i[0]=s+r*e,i[1]=a+n*e,i[2]=l+o*e,!0}}}class Xl{constructor(e,t,i,r,n){this.TL=e,this.TR=t,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(e,t,i){const r=[-1,1,1],n=[1,1,1],o=[1,-1,1],s=[-1,-1,1],a=Bl(r,r,e),l=Bl(n,n,e),c=Bl(o,o,e),u=Bl(s,s,e);return new Xl(a,l,c,u,t/i)}}class Kl{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,t,i,r){const n=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=Vl([],i,e),s=1/o[3]/t*n;return function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}(o,o,[s,s,r?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=Ll([],Rl([],jl([],o[e[0]],o[e[1]]),jl([],o[e[2]],o[e[1]]))),i=-Dl(t,o[e[1]]);return t.concat(i)}));return new Kl(o,s)}}class Yl{constructor(e,t){this.min=e,this.max=t,this.center=zl([],Ml([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],i=Tl(this.min),r=Tl(this.max);for(let e=0;e<t.length;e++)i[e]=t[e]?this.min[e]:this.center[e],r[e]=t[e]?this.center[e]:this.max[e];return r[2]=this.max[2],new Yl(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let i=!0;for(let r=0;r<e.planes.length;r++){const n=e.planes[r];let o=0;for(let e=0;e<t.length;e++)o+=Dl(n,t[e])+n[3]>=0;if(0===o)return 0;o!==t.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let i=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<e.points.length;n++){const o=e.points[n][t]-this.min[t];i=Math.min(i,o),r=Math.max(r,o)}if(r<0||i>this.max[t]-this.min[t])return 0}return 1}}function Jl(e,t,i,r,n,o,s,a,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=i.projection.upVectorScale(c,i.center.lat,i.worldSize).metersToTile;for(const h of t)for(const t of h){const h=t.add(a),d=n&&i.elevation?i.elevation.exaggeration()*n.getElevationAt(h.x,h.y,!0):0,p=i.projection.projectTilePoint(h.x,h.y,c);if(d>0){const e=i.projection.upVector(c,h.x,h.y);p.x+=e[0]*u*d,p.y+=e[1]*u*d,p.z+=e[2]*u*d}const f=o?h:Ql(p.x,p.y,p.z,r),m=o?e.tilespaceRays.map((e=>ic(e,d))):e.queryGeometry.screenGeometry,g=Vl([],[p.x,p.y,p.z,1],r);if(!s&&o?l*=g[3]/i.cameraToCenterDistance:s&&!o&&(l*=i.cameraToCenterDistance/g[3]),o){const e=za((t.y/ba+c.y)/(1<<c.z));l/=i.projection.pixelsPerMeter(e,1)/Aa(1,e)}if(Ha(m,f,l))return!0}return!1}function Ql(e,t,i,r){const o=Vl([],[e,t,i,1],r);return new n(o[0]/o[3],o[1]/o[3])}const ec=Cl(0,0,0),tc=Cl(0,0,1);function ic(e,t){const i=wl();return ec[2]=t,e.intersectsPlane(ec,tc,i),new n(i[0],i[1])}class rc extends Za{}function nc(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function oc(e,t,i){const{width:r,height:n}=t;r===e.width&&n===e.height||(sc(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i),e.width=r,e.height=n,e.data=t.data)}function sc(e,t,i,r,n,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let l=0;l<n.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((r.y+l)*t.width+r.x)*o;for(let e=0;e<n.width*o;e++)a[u+e]=s[c+e]}return t}zn(rc,"HeatmapBucket",{omit:["layers"]});class ac{constructor(e,t){nc(this,e,1,t)}resize(e){oc(this,new ac(e),1)}clone(){return new ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){sc(e,t,i,r,n,1)}}class lc{constructor(e,t){nc(this,e,4,t)}resize(e){oc(this,new lc(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){sc(e,t,i,r,n,4)}}zn(ac,"AlphaImage"),zn(lc,"RGBAImage");var cc={paint:new qo({"heatmap-radius":new No(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new No(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $o(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Go(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $o(Ge.paint_heatmap["heatmap-opacity"])})};function uc(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new lc({width:i,height:r}),o=(i,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,n=0;t<r;++t,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=e.clips[t];o(n,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return n}var hc={paint:new qo({"hillshade-illumination-direction":new $o(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $o(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $o(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $o(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $o(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $o(Ge.paint_hillshade["hillshade-accent-color"])})};const dc=Ko([{name:"a_pos",components:2,type:"Int16"}],4),{members:pc}=dc;var fc=gc,mc=gc;function gc(e,t,i){i=i||2;var r,n,o,s,a,l,c,u=t&&t.length,h=u?t[0]*i:e.length,d=yc(e,0,h,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=yc(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(Ec(s));for(a.sort(Sc),n=0;n<a.length;n++)i=_c(i=Cc(a[n],i),i.next);return i}(e,t,d,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var f=i;f<h;f+=i)(a=e[f])<r&&(r=a),(l=e[f+1])<n&&(n=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-r,s-n))?1/c:0}return vc(d,p,i,r,n,c),p}function yc(e,t,i,r,n){var o,s;if(n===Nc(e,t,i,r)>0)for(o=t;o<i;o+=r)s=Fc(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=Fc(o,e[o],e[o+1],s);return s&&Pc(s,s.next)&&(jc(s),s=s.next),s}function _c(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!Pc(r,r.next)&&0!==zc(r.prev,r,r.next))r=r.next;else{if(jc(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function vc(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=kc(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,l,c=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,c*=2}while(s>1)}(n)}(e,r,n,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?bc(e,r,n,o):xc(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),jc(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?vc(e=wc(_c(e),t,i),t,i,r,n,o,2):2===s&&Tc(e,t,i,r,n,o):vc(_c(e),t,i,r,n,o,1);break}}}function xc(e){var t=e.prev,i=e,r=e.next;if(zc(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(Ac(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&zc(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function bc(e,t,i,r){var n=e.prev,o=e,s=e.next;if(zc(n,o,s)>=0)return!1;for(var a=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,l=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,c=kc(n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,t,i,r),u=kc(a,l,t,i,r),h=e.prevZ,d=e.nextZ;h&&h.z>=c&&d&&d.z<=u;){if(h!==e.prev&&h!==e.next&&Ac(n.x,n.y,o.x,o.y,s.x,s.y,h.x,h.y)&&zc(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&Ac(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&zc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=c;){if(h!==e.prev&&h!==e.next&&Ac(n.x,n.y,o.x,o.y,s.x,s.y,h.x,h.y)&&zc(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==e.prev&&d!==e.next&&Ac(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&zc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function wc(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!Pc(n,o)&&Lc(n,r,r.next,o)&&Bc(n,o)&&Bc(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),jc(r),jc(r.next),r=e=o),r=r.next}while(r!==e);return _c(r)}function Tc(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Ic(s,a)){var l=Oc(s,a);return s=_c(s,s.next),l=_c(l,l.next),vc(s,t,i,r,n,o),void vc(l,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function Sc(e,t){return e.x-t.x}function Cc(e,t){var i=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var l,c=i,u=i.x,h=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&Ac(o<h?n:s,o,u,h,o<h?s:n,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(n-r.x),Bc(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&Mc(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var r=Oc(i,e),n=_c(i,i.next);return _c(r,r.next),t===i?n:t}function Mc(e,t){return zc(e.prev,e,t.prev)<0&&zc(t.next,e,e.next)<0}function kc(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ec(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Ac(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function Ic(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Lc(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Bc(e,t)&&Bc(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(zc(e.prev,e,t.prev)||zc(e,t.prev,t))||Pc(e,t)&&zc(e.prev,e,e.next)>0&&zc(t.prev,t,t.next)>0)}function zc(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Pc(e,t){return e.x===t.x&&e.y===t.y}function Lc(e,t,i,r){var n=Rc(zc(e,t,i)),o=Rc(zc(e,t,r)),s=Rc(zc(i,r,e)),a=Rc(zc(i,r,t));return n!==o&&s!==a||!(0!==n||!Dc(e,i,t))||!(0!==o||!Dc(e,r,t))||!(0!==s||!Dc(i,e,r))||!(0!==a||!Dc(i,t,r))}function Dc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Rc(e){return e>0?1:e<0?-1:0}function Bc(e,t){return zc(e.prev,e,e.next)<0?zc(e,t,e.next)>=0&&zc(e,e.prev,t)>=0:zc(e,t,e.prev)<0||zc(e,e.next,t)<0}function Oc(e,t){var i=new $c(e.i,e.x,e.y),r=new $c(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Fc(e,t,i,r){var n=new $c(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function jc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function $c(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nc(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}function Uc(e,t,i,r,n){Vc(e,t,i||0,r||e.length-1,n||qc)}function Vc(e,t,i,r,n){for(;r>i;){if(r-i>600){var o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Vc(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),n)}var u=e[t],h=i,d=r;for(Gc(e,i,t),n(e[r],u)>0&&Gc(e,i,r);h<d;){for(Gc(e,h,d),h++,d--;n(e[h],u)<0;)h++;for(;n(e[d],u)>0;)d--}0===n(e[i],u)?Gc(e,i,d):Gc(e,++d,r),d<=t&&(i=d+1),t<=d&&(r=d-1)}}function Gc(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function qc(e,t){return e<t?-1:e>t?1:0}function Zc(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,o;for(let t=0;t<i;t++){const i=L(e[t]);0!==i&&(e[t].area=Math.abs(i),void 0===o&&(o=i<0),o===i<0?(n&&r.push(n),n=[e[t]]):n.push(e[t]))}if(n&&r.push(n),t>1)for(let e=0;e<r.length;e++)r[e].length<=t||(Uc(r[e],t,1,r[e].length-1,Wc),r[e]=r[e].slice(0,t));return r}function Wc(e,t){return t.area-e.area}function Hc(e,t,i){const r=i.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const o=t.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function Xc(e,t,i,r,n){const o=n.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r-1},i,{},n.availableImages),a=t.evaluate({zoom:r},i,{},n.availableImages),l=t.evaluate({zoom:r+1},i,{},n.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:e,mid:a,max:l}}}return i}gc.deviation=function(e,t,i,r){var n=t&&t.length,o=Math.abs(Nc(e,0,n?t[0]*i:e.length,i));if(n)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(Nc(e,t[s]*i,s<a-1?t[s+1]*i:e.length,i));var l=0;for(s=0;s<r.length;s+=3){var c=r[s]*i,u=r[s+1]*i,h=r[s+2]*i;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},gc.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&i.holes.push(r+=e[n-1].length)}return i},fc.default=mc;class Kc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jo,this.indexArray=new fs,this.indexArray2=new bs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.segments2=new xa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,r){this.hasPattern=Hc("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Va(s,e);if(!this.layers[0]._featureFilter.filter(new zo(this.zoom),u,i))continue;const h=n?n.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ua(s,i,r),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=Xc("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.availableImages);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,r)}addFeatures(e,t,i,r,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n,o=[]){for(const e of Zc(t,500)){let t=0;for(const i of e)t+=i.length;const i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),r=i.vertexLength,n=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(n.length/2);const i=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),r=i.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(r+t.length-1,r),n.push(t[0].x),n.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(r+e-1,r+e),n.push(t[e].x),n.push(t[e].y);i.vertexLength+=t.length,i.primitiveLength+=t.length}const s=fc(n,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(r+s[e],r+s[e+1],r+s[e+2]);i.vertexLength+=t,i.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,o,r)}}zn(Kc,"FillBucket",{omit:["layers","patternFeatures"]});const Yc=new qo({"fill-sort-key":new No(Ge.layout_fill["fill-sort-key"])});var Jc={paint:new qo({"fill-antialias":new $o(Ge.paint_fill["fill-antialias"]),"fill-opacity":new No(Ge.paint_fill["fill-opacity"]),"fill-color":new No(Ge.paint_fill["fill-color"]),"fill-outline-color":new No(Ge.paint_fill["fill-outline-color"]),"fill-translate":new $o(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new $o(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Uo(Ge.paint_fill["fill-pattern"])}),layout:Yc};const Qc=Ko([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),eu=Ko([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tu=Ko([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iu}=Qc;var ru=nu;function nu(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(ou,this,t)}function ou(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function su(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)r+=((i=e[s]).x-(t=e[n]).x)*(t.y+i.y);return r}nu.types=["Unknown","Point","LineString","Polygon"],nu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,o=0,s=0,a=0,l=[];e.pos<i;){if(o<=0){var c=e.readVarint();r=7&c,o=c>>3}if(o--,1===r||2===r)s+=e.readSVarint(),a+=e.readSVarint(),1===r&&(t&&l.push(t),t=[]),t.push(new n(s,a));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&l.push(t),l},nu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},nu.prototype.toGeoJSON=function(e,t,i){var r,n,o=this.extent*Math.pow(2,i),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=nu.types[this.type];function u(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];u(l=h);break;case 2:for(r=0;r<l.length;r++)u(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],o=0;o<t;o++){var s=su(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)u(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var au=lu;function lu(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(cu,this,t),this.length=this._features.length}function cu(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}function uu(e,t,i){if(3===e){var r=new au(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}lu.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new ru(this._pbf,t,this.extent,this._keys,this._values)};var hu={VectorTile:function(e,t){this.layers=e.readFields(uu,{},t)},VectorTileFeature:ru,VectorTileLayer:au};function du(e,t,i,r){const o=[],s=0===r?(e,t,i,r,o,s)=>{e.push(new n(s,i+(s-t)/(r-t)*(o-i)))}:(e,t,i,r,o,s)=>{e.push(new n(t+(s-i)/(o-i)*(r-t),s))};for(const n of e){const e=[];for(const o of n){if(o.length<=2)continue;const n=[];for(let e=0;e<o.length-1;e++){const a=o[e].x,l=o[e].y,c=o[e+1].x,u=o[e+1].y,h=0===r?a:l,d=0===r?c:u;h<t?d>t&&s(n,a,l,c,u,t):h>i?d<i&&s(n,a,l,c,u,i):n.push(o[e]),d<t&&h>=t&&s(n,a,l,c,u,t),d>i&&h<=i&&s(n,a,l,c,u,i)}let a=o[o.length-1];const l=0===r?a.x:a.y;l>=t&&l<=i&&n.push(a),n.length&&(a=n[n.length-1],n[0].x===a.x&&n[0].y===a.y||n.push(n[0]),e.push(n))}e.length&&o.push(e)}return o}const pu=hu.VectorTileFeature.types,fu=Math.pow(2,13);function mu(e,t,i,r,n,o,s,a){e.emplaceBack((t<<1)+s,(i<<1)+o,(Math.floor(r*fu)<<1)+n,Math.round(a))}function gu(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class yu{constructor(){this.acc=new n(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new n(e.x,e.y),this.max=new n(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const i=this.min,r=this.max;e.x<i.x?i.x=e.x:e.x>r.x&&(r.x=e.x),e.y<i.y?i.y=e.y:e.y>r.y&&(r.y=e.y),((0===e.x||e.x===ba)&&e.x===t.x)!=((0===e.y||e.y===ba)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,yi(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>ba!=e.x>ba&&this.addBorderIntersection(1,yi(t.y,e.y,(ba-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,yi(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>ba!=e.y>ba&&this.addBorderIntersection(3,yi(t.x,e.x,(ba-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){const e=this.polyCount.reduce(((e,t)=>e+t.edges),0);return 0!==e?this.acc.div(e)._round():new n(0,0)}span(){return new n(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0)}}class _u{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new es,this.centroidVertexArray=new Os,this.indexArray=new fs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.enableTerrain=e.enableTerrain}populate(e,t,i,r){this.features=[],this.hasPattern=Hc("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){const t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/ba/(1<<e.z)}(i);for(const{feature:n,id:o,index:s,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Va(n,e);if(!this.layers[0]._featureFilter.filter(new zo(this.zoom),l,i))continue;const c={id:o,sourceLayerIndex:a,index:s,geometry:e?l.geometry:Ua(n,i,r),properties:n.properties,type:n.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(Xc("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,s,i,{},t.availableImages,r),t.featureIndex.insert(n,c.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(e,t,i,r,n){for(const e of this.features){const{geometry:o}=e;this.addFeature(e,o,e.index,t,i,r,n)}this.sortBorders()}update(e,t,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tu.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,eu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,o,s,a){const l=[new n(0,0),new n(ba,ba)],c=a.projection,u="globe"===c.name,h=this.enableTerrain&&!u?new yu:null;u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Cs);const d=Zc(t,500);for(let e=d.length-1;e>=0;e--){const t=d[e];(0===t.length||(p=t[0]).every((e=>e.x<=0))||p.every((e=>e.x>=ba))||p.every((e=>e.y<=0))||p.every((e=>e.y>=ba)))&&d.splice(e,1)}var p;let f;if(u)f=bu(d,l,r);else{f=[];for(const e of d)f.push({polygon:e,bounds:l})}for(const t of f){const i=t.polygon;let n=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let e=0;e<i.length;e++){const s=i[e];if(0===s.length)continue;n+=s.length;let a=0;h&&h.startRing(s[0]);for(let e=0;e<s.length;e++){const i=s[e];if(e>=1){const n=s[e-1];if(!vu(i,n,t.bounds)){h&&h.append(i,n),o.vertexLength+4>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=i.sub(n)._perp(),t=e.x/(Math.abs(e.x)+Math.abs(e.y)),s=e.y>0?1:0,l=n.dist(i);a+l>32768&&(a=0),mu(this.layoutVertexArray,i.x,i.y,t,s,0,0,a),mu(this.layoutVertexArray,i.x,i.y,t,s,0,1,a),a+=l,mu(this.layoutVertexArray,n.x,n.y,t,s,0,0,a),mu(this.layoutVertexArray,n.x,n.y,t,s,0,1,a);const d=o.vertexLength;if(this.indexArray.emplaceBack(d,d+2,d+1),this.indexArray.emplaceBack(d+1,d+2,d+3),o.vertexLength+=4,o.primitiveLength+=2,u){const e=this.layoutVertexExtArray,t=c.projectTilePoint(i.x,i.y,r),o=c.projectTilePoint(n.x,n.y,r),s=c.upVector(r,i.x,i.y),a=c.upVector(r,n.x,n.y);gu(e,t,s),gu(e,t,s),gu(e,o,a),gu(e,o,a)}}}}}if(o.vertexLength+n>xa.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(n,this.layoutVertexArray,this.indexArray)),"Polygon"!==pu[e.type])continue;const s=[],a=[],l=o.vertexLength;for(let e=0;e<i.length;e++){const t=i[e];if(0!==t.length){t!==i[0]&&a.push(s.length/2);for(let e=0;e<t.length;e++){const i=t[e];mu(this.layoutVertexArray,i.x,i.y,0,0,1,1,0),s.push(i.x),s.push(i.y),h&&h.currentPolyCount.top++,u&&gu(this.layoutVertexExtArray,c.projectTilePoint(i.x,i.y,r),c.upVector(r,i.x,i.y))}}}const d=fc(s,a);for(let e=0;e<d.length;e+=3)this.indexArray.emplaceBack(l+d[e],l+d[e+2],l+d[e+1]);o.primitiveLength+=d.length/3,o.vertexLength+=n}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;const e=h.borders,t=this.featuresOnBorder.push(h)-1;for(let i=0;i<4;i++)e[i][0]!==Number.MAX_VALUE&&this.borders[i].push(t)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,s,r)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}encodeCentroid(e,t,i=!0){let r,n;if(e)if(0!==e.y){const i=t.span()._mult(this.tileToMeter);r=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(i.x/10)),n=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(i.y/10))}else r=Math.ceil(7*(e.x+450)),n=0;else r=0,n=+i;let o=i?this.centroidVertexArray.length:t.vertexArrayOffset;for(const e of t.polyCount){i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*e.edges+e.top);for(let t=0;t<2*e.edges;t++)this.centroidVertexArray.emplace(o++,0,n),this.centroidVertexArray.emplace(o++,r,n);for(let t=0;t<e.top;t++)this.centroidVertexArray.emplace(o++,r,n)}}}function vu(e,t,i){return e.x===t.x&&(e.x<i[0].x||e.x>i[1].x)||e.y===t.y&&(e.y<i[0].y||e.y>i[1].y)}function xu(){const e=Math.PI/32,t=Math.tan(e),i=Ta;return i*Math.sqrt(1+2*t*t)-i}function bu(e,t,i){const r=1<<i.z,o=Ia(i.x/r),s=Ia((i.x+1)/r),a=za(i.y/r),l=za((i.y+1)/r);return function(e,t,i,r,o,s){const a=[];if(!e.length||!i||!r)return a;const l=(e,t)=>{for(const i of e)a.push({polygon:i,bounds:t})},c=Math.ceil(Math.log2(i)),u=Math.ceil(Math.log2(r)),h=c-u,d=[];for(let e=0;e<Math.abs(h);e++)d.push(h>0?0:1);for(let e=0;e<Math.min(c,u);e++)d.push(0),d.push(1);let p=e;if(p=du(p,t[0].y-o,t[1].y+o,1),p=du(p,t[0].x-o,t[1].x+o,0),!p.length)return a;const f=[];for(d.length?f.push({polygons:p,bounds:t,depth:0}):l(p,t);f.length;){const e=f.pop(),t=e.depth,i=d[t],r=e.bounds[0],a=e.bounds[1],c=0===i?r.x:r.y,u=0===i?a.x:a.y,h=s?s(i,c,u):.5*(c+u),p=du(e.polygons,c-o,h+o,i),m=du(e.polygons,h-o,u+o,i);if(p.length){const e=[r,new n(0===i?h:a.x,1===i?h:a.y)];d.length>t+1?f.push({polygons:p,bounds:e,depth:t+1}):l(p,e)}if(m.length){const e=[new n(0===i?h:r.x,1===i?h:r.y),a];d.length>t+1?f.push({polygons:m,bounds:e,depth:t+1}):l(m,e)}}return a}(e,t,Math.ceil((s-o)/11.25),Math.ceil((a-l)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=za((i.y+t/ba)/r);return(Ea(.5*(za((i.y+n/ba)/r)+e))*r-i.y)*ba}}))}zn(_u,"FillExtrusionBucket",{omit:["layers","features"]}),zn(yu,"PartMetadata");var wu={paint:new qo({"fill-extrusion-opacity":new $o(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new No(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $o(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $o(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Uo(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new No(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new No(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $o(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tu(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class Su{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=ku(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=function(e,t,i){var r=Tu(256*e,256*(t=Math.pow(2,i)-t-1),i),n=Tu(256*(e+1),256*(t+1),i);return r[0]+","+r[1]+","+n[0]+","+n[1]}(this.x,this.y,this.z),r=function(e,t,i){let r,n="";for(let o=e;o>0;o--)r=1<<o-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=ku(e,t.z,t.z,t.x,t.y)}}class Mu{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new Su(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:ku(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Mu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return ku(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return ku(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Mu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Mu(t,this.wrap,t,i,r),new Mu(t,this.wrap,t,i+1,r),new Mu(t,this.wrap,t,i,r+1),new Mu(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Mu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Mu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ku(e,t,i,r,n){const o=1<<Math.min(i,22);let s=o*(n%o)+r%o;return e&&i<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*s+i)+(t-i)}function Eu(e,t){return e.x*t.x+e.y*t.y}function Au(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=Eu(a,a),h=Eu(a,l),d=Eu(l,l),p=Eu(c,a),f=Eu(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=r.z*(1-g-y)+n.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function Iu(e){const t=new n(e[0],e[1]);return t.z=e[2],t}function zu(e,t,i,r,n,o,s,a){const l=s*n.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?s*(o[0]/7-450):s*function(e,t,i){const r=Math.floor(t[0]/8),n=Math.floor(t[1]/8),o=10*(t[0]-8*r),s=10*(t[1]-8*n),a=e.getElevationAt(r,n,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(s*l-1)),h=e.tileCoordToPixel(r,n),d=2*c+1,p=2*u+1,f=function(e,t,i,r,n){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+n,i,!0),e.getElevationAtPixel(t,i+n,!0),e.getElevationAtPixel(t+r,i+n,!0)]}(e,h.x-c,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),y=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),_=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*y/p);return a+Math.max(_*o,v*s)}(n,o,a):l;return{base:l+(0===i)?-1:i,top:c?Math.max(u+r,l+i+2):l+r}}zn(Su,"CanonicalTileID"),zn(Mu,"OverscaledTileID",{omit:["projMatrix"]});const Pu=Ko([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lu}=Pu,Du=Ko([{name:"a_packed",components:4,type:"Float32"}]),{members:Ru}=Du,Bu=hu.VectorTileFeature.types,Ou=Math.cos(Math.PI/180*37.5);class Fu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new ts,this.layoutVertexArray2=new is,this.indexArray=new fs,this.programConfigurations=new ua(e.layers,e.zoom),this.segments=new xa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,r){this.hasPattern=Hc("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Va(t,e);if(!this.layers[0]._featureFilter.filter(new zo(this.zoom),c,i))continue;const u=n?n.evaluate(c,{},i):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ua(t,i,r),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:s,featureIndex:a}=t,l=this.addConstantDashes(s);for(const r of o){const{geometry:n,index:o,sourceLayerIndex:c}=r;if(l&&this.addFeatureDashes(r,s),this.hasPattern){const e=Xc("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,s.positions,t.availableImages);a.insert(e[o].feature,n,o,c,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)t=!0;else{const t=n.value,i=r.value;if(!i)continue;e.addDash(i.from,t),e.addDash(i.to,t),i.other&&e.addDash(i.other,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===o.kind)continue;let s,a,l,c,u,h;if("constant"===n.kind){const e=n.value;if(!e)continue;s=e.other||e.to,a=e.to,l=e.from}else s=n.evaluate({zoom:i-1},e),a=n.evaluate({zoom:i},e),l=n.evaluate({zoom:i+1},e);"constant"===o.kind?c=u=h=o.value:(c=o.evaluate({zoom:i-1},e),u=o.evaluate({zoom:i},e),h=o.evaluate({zoom:i+1},e)),t.addDash(s,c),t.addDash(a,u),t.addDash(l,h);const d=t.getKey(s,c),p=t.getKey(a,u),f=t.getKey(l,h);e.patterns[r.id]={min:d,mid:p,max:f}}}update(e,t,i,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i,r)}addFeatures(e,t,i,r,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,i,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Ru)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap").evaluate(e,{}),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,a,l,c,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,o,r)}addLine(e,t,i,r,n,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Bu[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===i&&(n=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?s?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const y=f.x*m.x+f.y*m.y,_=g.x*m.x+g.y*m.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Ou&&d&&p,w=f.x*m.y-f.y*m.x>0;if(b&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const T=d&&p;let S=T?i:s?"butt":r;if(T&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>n&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<n&&(S="miter")),d&&this.updateDistance(d,h),"miter"===S)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(v>100)g=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const e=-Math.sqrt(v*v-1),t=w?e:0,i=w?0:e;if(d&&this.addCurrentVertex(h,f,t,i,u),"fakeround"===S){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+y*(y*(3.55645-1.43519*y)-3.2452))*e*e+(.848013+y*(.215638*y-1.06021)))}const r=m.sub(f)._mult(i)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,r.x,r.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-i,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const e=d?1:-1;d||this.addCurrentVertex(h,g,e,e,u),this.addCurrentVertex(h,g,0,0,u),d&&this.addCurrentVertex(h,g,e,e,u)}else"round"===S&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(b&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,i,r,n,o=!1){const s=t.y*r-t.x,a=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,n),this.addHalfVertex(e,s,a,o,!0,-r,n)}addHalfVertex({x:e,y:t},i,r,n,o,s,a){this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const l=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),a.primitiveLength++),o?this.e2=l:this.e1=l}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}zn(Fu,"LineBucket",{omit:["layers","patternFeatures"]});const ju=new qo({"line-cap":new No(Ge.layout_line["line-cap"]),"line-join":new No(Ge.layout_line["line-join"]),"line-miter-limit":new $o(Ge.layout_line["line-miter-limit"]),"line-round-limit":new $o(Ge.layout_line["line-round-limit"]),"line-sort-key":new No(Ge.layout_line["line-sort-key"])});var $u={paint:new qo({"line-opacity":new No(Ge.paint_line["line-opacity"]),"line-color":new No(Ge.paint_line["line-color"]),"line-translate":new $o(Ge.paint_line["line-translate"]),"line-translate-anchor":new $o(Ge.paint_line["line-translate-anchor"]),"line-width":new No(Ge.paint_line["line-width"]),"line-gap-width":new No(Ge.paint_line["line-gap-width"]),"line-offset":new No(Ge.paint_line["line-offset"]),"line-blur":new No(Ge.paint_line["line-blur"]),"line-dasharray":new Uo(Ge.paint_line["line-dasharray"]),"line-pattern":new Uo(Ge.paint_line["line-pattern"]),"line-gradient":new Go(Ge.paint_line["line-gradient"]),"line-trim-offset":new $o(Ge.paint_line["line-trim-offset"])}),layout:ju};const Nu=new class extends No{possiblyEvaluate(e,t){return t=new zo(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=v({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}($u.paint.properties["line-width"].specification);function Uu(e,t){return t>0?t+2*e:e}Nu.useIntegerZoom=!0;const Vu=Ko([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gu=Ko([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),qu=Ko([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ko([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zu=Ko([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Wu=Ko([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hu=Ko([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xu=Ko([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ko([{name:"triangle",components:3,type:"Uint16"}]),Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ko([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ko([{type:"Float32",name:"offsetX"}]),Ko([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ku=24;const Yu=128;function Ju(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new zo(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let o=n;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[n],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new zo(s)),maxSize:i.evaluate(new zo(a)),interpolationType:r}}}function Qu(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/Yu:"composite"===e.kind?yi(r/Yu,n/Yu,i):t}function eh(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=e,a=n?f(Fi.interpolationFactor(n,t,o,s),0,1):0;"camera"===e.kind?r=yi(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:r}}var th=Object.freeze({__proto__:null,getSizeData:Ju,evaluateSizeForFeature:Qu,evaluateSizeForZoom:eh,SIZE_PACK_FACTOR:Yu});function ih(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Io.applyArabicShaping&&(e=Io.applyArabicShaping(e)),e}(e.text,t,i)})),e}const rh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function nh(e){return"︶"===e||"﹈"===e||"︸"===e||"﹄"===e||"﹂"===e||"︾"===e||"︼"===e||"︺"===e||"︘"===e||"﹀"===e||"︐"===e||"︓"===e||"︔"===e||"｀"===e||"￣"===e||"︑"===e||"︒"===e}function oh(e){return"︵"===e||"﹇"===e||"︷"===e||"﹃"===e||"﹁"===e||"︽"===e||"︻"===e||"︹"===e||"︗"===e||"︿"===e}var sh=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},ah=function(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*m},lh=ch;function ch(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ch.Varint=0,ch.Fixed64=1,ch.Bytes=2,ch.Fixed32=5;var uh=4294967296,hh=1/uh,dh="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ph(e){return e.type===ch.Bytes?e.readVarint()+e.pos:e.pos+1}function fh(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function mh(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function gh(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function yh(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function _h(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function vh(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function xh(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function bh(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function wh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Th(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Sh(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Ch(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Mh(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function kh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Eh(e,t,i){t.glyphs=[],1===e&&i.readMessage(Ah,t)}function Ah(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(Ih,{});t.glyphs.push({id:e,bitmap:new ac({width:n+6,height:o+6},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Ih(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}function zh(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,o=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}ch.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ch(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=kh(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ch(this.buf,this.pos)+Ch(this.buf,this.pos+4)*uh;return this.pos+=8,e},readSFixed64:function(){var e=Ch(this.buf,this.pos)+kh(this.buf,this.pos+4)*uh;return this.pos+=8,e},readFloat:function(){var e=sh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=sh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return fh(e,r,t);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return fh(e,r,t);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return fh(e,r,t);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return fh(e,r,t);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return fh(e,r,t);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return fh(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&dh?function(e,t,i){return dh.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[n+2],128==(192&(o=e[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[n+2],a=e[n+3],128==(192&(o=e[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ch.Bytes)return e.push(this.readVarint(t));var i=ph(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ch.Bytes)return e.push(this.readSVarint());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ch.Bytes)return e.push(this.readBoolean());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ch.Bytes)return e.push(this.readFloat());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ch.Bytes)return e.push(this.readDouble());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ch.Bytes)return e.push(this.readFixed32());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ch.Bytes)return e.push(this.readSFixed32());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ch.Bytes)return e.push(this.readFixed64());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ch.Bytes)return e.push(this.readSFixed64());var t=ph(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ch.Varint)for(;this.buf[this.pos++]>127;);else if(t===ch.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ch.Fixed32)this.pos+=4;else{if(t!==ch.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Mh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*hh),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Mh(this.buf,-1&e,this.pos),Mh(this.buf,Math.floor(e*hh),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&mh(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),ah(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ah(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&mh(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,ch.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,gh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,yh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,xh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,_h,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,vh,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,bh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,wh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Th,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Sh,t)},writeBytesField:function(e,t){this.writeTag(e,ch.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ch.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ch.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ch.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ch.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ch.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ch.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ch.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ch.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ch.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class Ph{constructor(e,{pixelRatio:t,version:i,stretchX:r,stretchY:n,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lh{constructor(e,t){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,i,n),this.addImages(t,r,n);const{w:o,h:s}=zh(n),a=new lc({width:o||1,height:s||1});for(const t in e){const r=e[t],n=i[t].paddedRect;lc.copy(r.data,a,{x:0,y:0},{x:n.x+1,y:n.y+1},r.data)}for(const e in t){const i=t[e],n=r[e].paddedRect,o=n.x+1,s=n.y+1,l=i.data.width,c=i.data.height;lc.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),lc.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),lc.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),lc.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),lc.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const r in e){const n=e[r],o={x:0,y:0,w:n.data.width+2,h:n.data.height+2};i.push(o),t[r]=new Ph(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t))),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl;i.update(t.data,void 0,{x:r,y:n})}}zn(Ph,"ImagePosition"),zn(Lh,"ImageAtlas");const Dh={horizontal:1,vertical:2,horizontalOnly:3};class Rh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new Rh;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Rh;return t.imageName=e,t}}class Bh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Bh;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r+1)||null,o=e.charCodeAt(r-1)||null;i+=!t&&(n&&mo(n)&&!rh[e[r+1]]||o&&mo(o)&&!rh[e[r-1]])||!rh[e[r]]?e[r]:rh[e[r]]}return i}(this.text,e)}trim(){let e=0;for(let t=0;t<this.text.length&&Fh[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Fh[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Bh;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Rh.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void z("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(Rh.forImage(t)),this.sectionIndex.push(this.sections.length-1)):z("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Oh(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=Bh.fromFeature(e,n);let y;h===Dh.vertical&&g.verticalizePunctuation(d);const{processBidirectionalText:_,processStyledBidirectionalText:v}=Io;if(_&&1===g.sections.length){y=[];const e=_(g.toString(),qh(g,c,o,t,r,p,f));for(const t of e){const e=new Bh;e.text=t,e.sections=g.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);y.push(e)}}else if(v){y=[];const e=v(g.text,g.sectionIndex,qh(g,c,o,t,r,p,f));for(const t of e){const e=new Bh;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,y.push(e)}}else y=function(e,t){const i=[],r=e.text;let n=0;for(const r of t)i.push(e.substring(n,r)),n=r;return n<r.length&&i.push(e.substring(n,r.length)),i}(g,qh(g,c,o,t,r,p,f));const x=[],b={positionedLines:x,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const e of n){const i=e.getSections();for(const e of i){if(e.imageName)continue;const i=t[e.fontStack];if(i&&(g=void 0!==i.ascender&&void 0!==i.descender,!g))break}if(!g)break}let y=0;for(const s of n){s.trim();const n=s.getMaxScale(),a=(n-1)*Ku,v={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=v;const x=v.positionedGlyphs;let b=0;if(!s.length()){p+=o,++y;continue}let w=0,T=0;for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o);let y=a.scale,v=null,S=null,C=null,M=Ku,k=0;const E=!(l===Dh.horizontal||!u&&!fo(m)||u&&(Fh[m]||(_=m,On(_)||Fn(_)||jn(_)||no(_)||lo(_))));if(a.imageName){const t=r[a.imageName];if(!t)continue;C=a.imageName,e.iconsInText=e.iconsInText||!0,S=t.paddedRect;const i=t.displaySize;y=y*Ku/h,v={width:i[0],height:i[1],left:1,top:-3,advance:E?i[1]:i[0],localGlyph:!1},k=g?-v.height*y:n*Ku-17-i[1]*y,M=v.advance;const o=(E?i[0]:i[1])*y-Ku*n;o>0&&o>b&&(b=o)}else{const e=i[a.fontStack];if(!e)continue;e[m]&&(S=e[m]);const r=t[a.fontStack];if(!r)continue;const o=r.glyphs[m];if(!o)continue;if(v=o.metrics,M=8203!==m?Ku:0,g){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,i=(e+t)*y;w<i&&(w=i,T=(e-t)/2*y),k=-e*y}else k=(n-y)*Ku-17}E?(e.verticalizable=!0,x.push({glyph:m,imageName:C,x:d,y:p+k,vertical:E,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),d+=M*y+c):(x.push({glyph:m,imageName:C,x:d,y:p+k,vertical:E,scale:y,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:S}),d+=v.advance*y+c)}0!==x.length&&(f=Math.max(d-c,f),g?Wh(x,m,b,T,o*n/2):Wh(x,m,b,0,o/2)),d=0;const S=o*n+b;v.lineOffset=Math.max(b,a),p+=S,++y}var _;const v=p,{horizontalAlign:x,verticalAlign:b}=Zh(s);(function(e,t,i,r,n,o){const s=(t-i)*n,a=-o*r;for(const t of e)for(const e of t.positionedGlyphs)e.x+=s,e.y+=a})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,r,y,s,a,l,h,c,d,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Fh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $h(e,t,i,r,n,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*Ku/o+n:0}{const r=i[t.fontStack],o=r&&r.glyphs[e];return o?o.metrics.advance*t.scale+n:0}}function Nh(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Uh(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Vh(e,t,i,r,n,o){let s=null,a=Nh(t,i,n,o);for(const e of r){const r=Nh(t-e.x,i,n,o)+e.badness;r<=a&&(s=e,a=r)}return{index:e,x:t,priorBreak:s,badness:a}}function Gh(e){return e?Gh(e.priorBreak).concat(e.index):[]}function qh(e,t,i,r,n,o,s){if("point"!==o)return[];if(!e)return[];const a=[],l=function(e,t,i,r,n,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=$h(e.getCharCode(i),a,r,n,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,r,n,s),c=e.text.indexOf("​")>=0;let u=0;for(let i=0;i<e.length();i++){const o=e.getSection(i),d=e.getCharCode(i);if(Fh[d]||(u+=$h(d,o,r,n,t,s)),i<e.length()-1){const t=!((h=d)<11904||!(Wn(h)||Zn(h)||so(h)||ro(h)||Yn(h)||$n(h)||Hn(h)||Vn(h)||Jn(h)||Qn(h)||Kn(h)||co(h)||Gn(h)||Un(h)||Nn(h)||Xn(h)||qn(h)||oo(h)||to(h)||eo(h)));(jh[d]||t||o.imageName)&&a.push(Vh(i+1,u,l,a,Uh(d,e.getCharCode(i+1),t&&c),!1))}}var h;return Gh(Vh(e.length(),u,l,a,0,!0))}function Zh(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Wh(e,t,i,r,n){if(!(t||i||r||n))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let t=0;t<=o;t++)e[t].x-=a,e[t].y+=i+r+n}function Hh(e,t,i){const{horizontalAlign:r,verticalAlign:n}=Zh(i),o=t[0]-e.displaySize[0]*r,s=t[1]-e.displaySize[1]*n;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Xh(e,t,i,r,n,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+m+r[2]):(u=n[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class Kh extends n{constructor(e,t,i,r,n){super(e,t),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new Kh(this.x,this.y,this.z,this.angle,this.segment)}}function Yh(e,t,i,r,n){if(void 0===t.segment)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=t.dist(i)}return!0}function Jh(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Qh(e,t,i){return e?.6*t*i:0}function ed(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function td(e,t,i,r,n,o){const s=Qh(i,n,o),a=ed(i,r)*o;let l=0;const c=Jh(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=yi(r.x,n.x,u),d=yi(r.y,n.y,u),p=new Kh(h,d,0,n.angleTo(r),i);return!s||Yh(e,p,a,s,t)?p:void 0}l+=o}}function id(e,t,i,r,n,o,s,a,l){const c=Qh(r,o,s),u=ed(r,n),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),rd(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function rd(e,t,i,r,n,o,s,a,l){const c=o/2,u=Jh(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,y=yi(s.x,a.x,g),_=yi(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Kh(y,_,0,m,t);i._round(),r&&!Yh(e,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=rd(e,h/2,i,r,n,o,s,!0,l)),p}function nd(e,t,i,r,o){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;for(let e=0;e<l.length-1;e++){let a=l[e],u=l[e+1];a.x<t&&u.x<t||(a.x<t?a=new n(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<t&&(u=new n(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<i&&u.y<i||(a.y<i?a=new n(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round():u.y<i&&(u=new n(a.x+(i-a.y)/(u.y-a.y)*(u.x-a.x),i)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new n(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new n(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new n(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new n(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}zn(Kh,"Anchor");const od=1e20;function sd(e,t,i,r,n,o,s,a,l){for(let c=t;c<t+r;c++)ad(e,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)ad(e,c*o+t,1,r,s,a,l)}function ad(e,t,i,r,n,o,s){o[0]=0,s[0]=-od,s[1]=od,n[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){n[a]=e[t+a*i];const r=a*a;do{const e=o[l];c=(n[a]-n[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=od}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*i]=n[r]+c*c}}const ld={none:0,ideographs:1,all:2};class cd{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const i=[];for(const t in e)for(const r of e[t])i.push({stack:t,id:r});y(i,(({stack:e,id:t},i)=>{let r=this.entries[e];r||(r=this.entries[e]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let n=r.glyphs[t];if(void 0!==n)return void i(null,{stack:e,id:t,glyph:n});if(n=this._tinySDF(r,e,t),n)return r.glyphs[t]=n,void i(null,{stack:e,id:t,glyph:n});const o=Math.floor(t/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void i(null,{stack:e,id:t,glyph:n});let s=r.requests[o];s||(s=r.requests[o]=[],cd.loadGlyphRange(e,o,this.url,this.requestManager,((e,t)=>{if(t){r.ascender=t.ascender,r.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(r.glyphs[+e]=t.glyphs[+e]);r.ranges[o]=!0}for(const i of s)i(e,t);delete r.requests[o]}))),s.push(((r,n)=>{r?i(r):n&&i(null,{stack:e,id:t,glyph:n.glyphs[t]||null})}))}),((e,i)=>{if(e)t(e);else if(i){const e={};for(const{stack:t,id:r,glyph:n}of i)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ld.none&&(this.localGlyphMode===ld.all?!!this.localFontFamily:!!this.localFontFamily&&(Qn(e)||io(e)||Gn(e)||qn(e)||Vn(e)))}_tinySDF(e,t,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=e.tinySDF;if(!n){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),n=e.tinySDF=new cd.TinySDF({fontFamily:r,fontWeight:i,fontSize:48,buffer:6,radius:16}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const o=String.fromCharCode(i),{data:s,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=n.draw(o);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new ac({width:a,height:l},s),metrics:{width:c/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function ud(e,t,i,r){const o=[],s=e.image,a=s.pixelRatio,l=s.paddedRect.w-2,c=s.paddedRect.h-2,u=e.right-e.left,h=e.bottom-e.top,d=s.stretchX||[[0,l]],p=s.stretchY||[[0,c]],f=(e,t)=>e+t[1]-t[0],m=d.reduce(f,0),g=p.reduce(f,0),y=l-m,_=c-g;let v=0,x=m,b=0,w=g,T=0,S=y,C=0,M=_;if(s.content&&r){const e=s.content;v=hd(d,0,e[0]),b=hd(p,0,e[1]),x=hd(d,e[0],e[2]),w=hd(p,e[1],e[3]),T=e[0]-v,C=e[1]-b,S=e[2]-e[0]-x,M=e[3]-e[1]-w}const k=(r,o,l,c)=>{const d=pd(r.stretch-v,x,u,e.left),p=fd(r.fixed-T,S,r.stretch,m),f=pd(o.stretch-b,w,h,e.top),y=fd(o.fixed-C,M,o.stretch,g),_=pd(l.stretch-v,x,u,e.left),k=fd(l.fixed-T,S,l.stretch,m),E=pd(c.stretch-b,w,h,e.top),A=fd(c.fixed-C,M,c.stretch,g),I=new n(d,f),z=new n(_,f),P=new n(_,E),L=new n(d,E),D=new n(p/a,y/a),R=new n(k/a,A/a),B=t*Math.PI/180;if(B){const e=Math.sin(B),t=Math.cos(B),i=[t,-e,e,t];I._matMult(i),z._matMult(i),L._matMult(i),P._matMult(i)}const O=r.stretch+r.fixed,F=o.stretch+o.fixed;return{tl:I,tr:z,bl:L,br:P,tex:{x:s.paddedRect.x+1+O,y:s.paddedRect.y+1+F,w:l.stretch+l.fixed-O,h:c.stretch+c.fixed-F},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:S/a/u,minFontScaleY:M/a/h,isSDF:i}};if(r&&(s.stretchX||s.stretchY)){const e=dd(d,y,m),t=dd(p,_,g);for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)o.push(k(r,t[e],n,t[e+1]))}}else o.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function hd(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function dd(e,t,i){const r=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+1,stretch:i}),r}function pd(e,t,i,r){return e/t*i+r}function fd(e,t,i,r){return e-t*i/r}function md(e,t,i,r){const n=t+e.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(t+e.positionedLines[r-1].lineOffset))/2}cd.loadGlyphRange=function(e,t,i,r,n){const o=256*t,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),ke.Glyphs);ze(a,((e,t)=>{if(e)n(e);else if(t){const e={},i=function(e){return new lh(e).readFields(Eh,{})}(t);for(const t of i.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},cd.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.min(this.size-this.buffer,Math.ceil(o-n)),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(od,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=_.data[4*(e*a+t)+3]/255;if(0===i)continue;const r=(e+m)*c+t+m;if(1===i)y[r]=0,g[r]=od;else{const e=.5-i;y[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}sd(y,0,0,c,u,c,this.f,this.v,this.z),sd(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(y[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class gd{constructor(e,t){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1),o=t[r];const s=r+1;if(s<this.length&&i(t[s],o)<0&&(r=s,o=t[s]),i(o,n)>=0)break;t[e]=o,e=r}t[e]=n}}function yd(e,t,i=!1){let r=1/0,o=1/0,s=-1/0,a=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<o)&&(o=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>a)&&(a=t.y)}const c=Math.min(s-r,a-o);let u=c/2;const h=new gd([],_d);if(0===c)return new n(r,o);for(let t=r;t<s;t+=c)for(let i=o;i<a;i+=c)h.push(new vd(t+u,i+u,u,e));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,s=o-1;e<o;s=e++){const o=n[e],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,t+=3*l}return new vd(i/t,r/t,0,e)}(e),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=t||(u=r.h/2,h.push(new vd(r.p.x-u,r.p.y-u,u,e)),h.push(new vd(r.p.x+u,r.p.y-u,u,e)),h.push(new vd(r.p.x-u,r.p.y+u,u,e)),h.push(new vd(r.p.x+u,r.p.y+u,u,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function _d(e,t){return t.max-e.max}function vd(e,t,i,r){this.p=new n(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,s=n-1;t<n;s=t++){const n=o[t],a=o[s];n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,el(e,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const xd=Number.POSITIVE_INFINITY,bd=Math.sqrt(2);function wd(e,t){return t[1]!==xd?function(e,t,i){let r=0,n=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-7;break;case"bottom-right":case"bottom-left":case"bottom":n=7-i}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,n]}(e,t[0],t[1]):function(e,t){let i=0,r=0;t<0&&(t=0);const n=t/bd;switch(e){case"top-right":case"top-left":r=n-7;break;case"bottom-right":case"bottom-left":r=7-n;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=t;break;case"right":i=-t}return[i,r]}(e,t[0])}function Td(e,t,i,r,n,o,s,a,l,c){e.createArrays(),e.tilePixelRatio=ba/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,d={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new zo(t),a),h["text-size"].possiblyEvaluate(new zo(i),a)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new zo(t),a),h["icon-size"].possiblyEvaluate(new zo(i),a)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new zo(l+1),a),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new zo(l+1),a),d.textMaxSize=h["text-size"].possiblyEvaluate(new zo(18),a);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const o of e.features){const l=u.get("text-font").evaluate(o,{},a).join(","),h=f.evaluate(o,{},a),m=d.layoutTextSize.evaluate(o,{},a),g=(d.layoutIconSize.evaluate(o,{},a),{horizontal:{},vertical:void 0}),y=o.text;let _,v=[0,0];if(y){const r=y.toString(),s=u.get("text-letter-spacing").evaluate(o,{},a)*Ku,c=u.get("text-line-height").evaluate(o,{},a)*Ku,d=ho(r)?s:0,f=u.get("text-anchor").evaluate(o,{},a),_=u.get("text-variable-anchor");if(!_){const e=u.get("text-radial-offset").evaluate(o,{},a);v=e?wd(f,[e*Ku,xd]):u.get("text-offset").evaluate(o,{},a).map((e=>e*Ku))}let x=p?"center":u.get("text-justify").evaluate(o,{},a);const b=u.get("symbol-placement"),w="point"===b,T="point"===b?u.get("text-max-width").evaluate(o,{},a)*Ku:0,S=o=>{e.allowVerticalPlacement&&uo(r)&&(g.vertical=Oh(y,t,i,n,l,T,c,f,o,d,v,Dh.vertical,!0,b,m,h))};if(!p&&_){const e="auto"===x?_.map((e=>Sd(e))):[x];let r=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!g.horizontal[s])if(r)g.horizontal[s]=g.horizontal[0];else{const e=Oh(y,t,i,n,l,T,c,"center",s,d,v,Dh.horizontal,!1,b,m,h);e&&(g.horizontal[s]=e,r=1===e.positionedLines.length)}}S("left")}else{if("auto"===x&&(x=Sd(f)),w||u.get("text-writing-mode").indexOf("horizontal")>=0||!uo(r)){const e=Oh(y,t,i,n,l,T,c,f,x,d,v,Dh.horizontal,!1,b,m,h);e&&(g.horizontal[x]=e)}S("point"===b?"left":x)}}let x=!1;if(o.icon&&o.icon.name){const t=r[o.icon.name];t&&(_=Hh(n[o.icon.name],u.get("icon-offset").evaluate(o,{},a),u.get("icon-anchor").evaluate(o,{},a)),x=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&z("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const b=Ed(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!b&&b.iconsInText),(b||_)&&Cd(e,o,g,_,r,d,m,0,v,x,s,a,c)}o&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Sd(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cd(e,t,i,r,n,o,s,a,c,u,h,d,p){let f=o.textMaxSize.evaluate(t,{},d);void 0===f&&(f=s);const m=e.layers[0].layout,g=m.get("icon-offset").evaluate(t,{},d),y=Ed(i.horizontal)||i.vertical,_="globe"===p.name,v=s/24,x=e.tilePixelRatio*f/24,b=(A=e.overscaling,e.zoom>18&&A>2&&(A>>=1),Math.max(ba/(512*A),1)*m.get("symbol-spacing")),w=m.get("text-padding")*e.tilePixelRatio,T=m.get("icon-padding")*e.tilePixelRatio,S=l(m.get("text-max-angle")),C="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),M="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),k=m.get("symbol-placement"),E=b/2;var A;const I=m.get("icon-text-fit");let P;r&&"none"!==I&&(e.allowVerticalPlacement&&i.vertical&&(P=Xh(r,i.vertical,I,m.get("icon-text-fit-padding"),g,v)),y&&(r=Xh(r,y,I,m.get("icon-text-fit-padding"),g,v)));const L=(s,a,l)=>{if(a.x<0||a.x>=ba||a.y<0||a.y>=ba)return;let f=null;if(_){const{x:e,y:t,z:i}=p.projectTilePoint(a.x,a.y,l);f={anchor:new Kh(e,t,i,0,void 0),up:p.upVector(l,a.x,a.y)}}!function(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S){const C=e.addToLineVertexArray(t,r);let M,k,E,A,I,P,L,D=0,R=0,B=0,O=0,F=-1,j=-1;const $={};let N=Gs("");const U=i?i.anchor:t;let V=0,G=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[V,G]=l.layout.get("text-offset").evaluate(x,{},S).map((e=>e*Ku)):(V=l.layout.get("text-radial-offset").evaluate(x,{},S)*Ku,G=xd),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(f)P=Id(e),a&&(L=Id(a));else{const i=l.layout.get("text-rotate").evaluate(x,{},S)+90;E=Ad(c,U,t,u,h,d,e,p,i,m),a&&(A=Ad(c,U,t,u,h,d,a,y,i))}}if(o){const r=l.layout.get("icon-rotate").evaluate(x,{},S),n="none"!==l.layout.get("icon-text-fit"),s=ud(o,r,w,n),p=a?ud(a,r,w,n):void 0;k=Ad(c,U,t,u,h,d,o,y,r),D=4*s.length;const f=e.iconSizeData;let m=null;"source"===f.kind?(m=[Yu*l.layout.get("icon-size").evaluate(x,{},S)],m[0]>Md&&z(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Yu*b.compositeIconSizes[0].evaluate(x,{},S),Yu*b.compositeIconSizes[1].evaluate(x,{},S)],(m[0]>Md||m[1]>Md)&&z(`${e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),e.addSymbols(e.icon,s,m,v,_,x,!1,i,t,C.lineStartIndex,C.lineLength,-1,T,S),F=e.icon.placedSymbolArray.length-1,p&&(R=4*p.length,e.addSymbols(e.icon,p,m,v,_,x,Dh.vertical,i,t,C.lineStartIndex,C.lineLength,-1,T,S),j=e.icon.placedSymbolArray.length-1)}for(const r in n.horizontal){const o=n.horizontal[r];M||(N=Gs(o.text),f?I=Id(o):M=Ad(c,U,t,u,h,d,o,p,l.layout.get("text-rotate").evaluate(x,{},S),m));const a=1===o.positionedLines.length;if(B+=kd(e,i,t,o,s,l,f,x,m,C,n.vertical?Dh.horizontal:Dh.horizontalOnly,a?Object.keys(n.horizontal):[r],$,F,b,T,S),a)break}n.vertical&&(O+=kd(e,i,t,n.vertical,s,l,f,x,m,C,Dh.vertical,["vertical"],$,j,b,T,S));let q=-1;const Z=(e,t)=>e?Math.max(e,t):t;q=Z(I,q),q=Z(P,q),q=Z(L,q);const W=q>-1?1:0;e.glyphOffsetArray.length>=Op.MAX_GLYPHS&&z("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(U.x,U.y,U.z,t.x,t.y,$.right>=0?$.right:-1,$.center>=0?$.center:-1,$.left>=0?$.left:-1,$.vertical>=0?$.vertical:-1,F,j,N,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==E?E:e.collisionBoxArray.length,void 0!==E?E+1:e.collisionBoxArray.length,void 0!==k?k:e.collisionBoxArray.length,void 0!==k?k+1:e.collisionBoxArray.length,A||e.collisionBoxArray.length,A?A+1:e.collisionBoxArray.length,u,B,O,D,R,W,0,V,G,q)}(e,a,f,s,i,r,n,P,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,w,C,c,0,T,M,g,t,o,u,h,d)};if("line"===k)for(const n of nd(t.geometry,0,0,ba,ba)){const t=id(n,b,S,i.vertical||y,r,24,x,e.overscaling,ba);for(const i of t){const t=y;t&&zd(e,t.text,E,i)||L(n,i,d)}}else if("line-center"===k){for(const e of t.geometry)if(e.length>1){const t=td(e,S,i.vertical||y,r,24,x);t&&L(e,t,d)}}else if("Polygon"===t.type)for(const e of Zc(t.geometry,0)){const t=yd(e,16);L(e[0],new Kh(t.x,t.y,0,0,void 0),d)}else if("LineString"===t.type)for(const e of t.geometry)L(e,new Kh(e[0].x,e[0].y,0,0,void 0),d);else if("Point"===t.type)for(const e of t.geometry)for(const t of e)L([t],new Kh(t.x,t.y,0,0,void 0),d)}const Md=32640;function kd(e,t,i,r,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=function(e,t,i,r,o,s,a,l){const c=[];if(0===t.positionedLines.length)return c;const u=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(e){const t=e[0],i=e[1],r=t*i;return r>0?[t,-i]:r<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let d=Math.abs(t.top-t.bottom);for(const e of t.positionedLines)d-=e.lineOffset;const p=t.positionedLines.length,f=d/p;let m=t.top-i[1];for(let e=0;e<p;++e){const r=t.positionedLines[e];m=md(t,f,m,e);for(const e of r.positionedGlyphs){if(!e.rect)continue;const r=e.rect||{};let s=4,d=!0,p=1,f=0;if(e.imageName){const t=a[e.imageName];if(!t)continue;if(t.sdf){z("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,p=t.pixelRatio,s=1/p}const g=(o||l)&&e.vertical,y=e.metrics.advance*e.scale/2,_=e.metrics,v=e.rect;if(null===v)continue;l&&t.verticalizable&&(f=e.imageName?y-e.metrics.width*e.scale/2:0);const x=o?[e.x+y,e.y]:[0,0];let b=[0,0],w=[0,0],T=!1;o||(g?(w=[e.x+y+h[0],e.y+h[1]-f],T=!0):b=[e.x+y+i[0],e.y+i[1]-f]);const S=v.w*e.scale/(p*(e.localGlyph?2:1)),C=v.h*e.scale/(p*(e.localGlyph?2:1));let M,k,E,A;if(g){const t=e.y-m,i=new n(-y,y-t),r=-Math.PI/2,o=new n(...w);M=new n(-y+b[0],b[1]),M._rotateAround(r,i)._add(o),M.x+=-t+y,M.y-=(_.left-s)*e.scale;const a=e.imageName?_.advance*e.scale:Ku*e.scale,l=String.fromCharCode(e.glyph);nh(l)?M.x+=(1-s)*e.scale:oh(l)?M.x+=a-_.height*e.scale+(-s-1)*e.scale:M.x+=e.imageName||_.width+2*s===v.w&&_.height+2*s===v.h?(a-C)/2:(a-(_.height+2*s)*e.scale)/2,k=new n(M.x,M.y-S),E=new n(M.x+C,M.y),A=new n(M.x+C,M.y-S)}else{const t=(_.left-s)*e.scale-y+b[0],i=(-_.top-s)*e.scale+b[1],r=t+S,o=i+C;M=new n(t,i),k=new n(r,i),E=new n(t,o),A=new n(r,o)}if(u){let e;e=o?new n(0,0):T?new n(h[0],h[1]):new n(i[0],i[1]),M._rotateAround(u,e),k._rotateAround(u,e),E._rotateAround(u,e),A._rotateAround(u,e)}const I=new n(0,0),P=new n(0,0);c.push({tl:M,tr:k,bl:E,br:A,tex:r,writingMode:t.writingMode,glyphOffset:x,sectionIndex:e.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:P,minFontScaleX:0,minFontScaleY:0})}}return c}(0,r,c,s,a,l,o,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Yu*s.layout.get("text-size").evaluate(l,{},y)],x[0]>Md&&z(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(x=[Yu*m.compositeTextSizes[0].evaluate(l,{},y),Yu*m.compositeTextSizes[1].evaluate(l,{},y)],(x[0]>Md||x[1]>Md)&&z(`${e.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),e.addSymbols(e.text,_,x,c,a,l,h,t,i,u.lineStartIndex,u.lineLength,f,g,y);for(const t of d)p[t]=e.text.placedSymbolArray.length-1;return 4*_.length}function Ed(e){for(const t in e)return e[t];return null}function Ad(e,t,i,r,o,s,a,c,u,h){let d=a.top,p=a.bottom,f=a.left,m=a.right;const g=a.collisionPadding;if(g&&(f-=g[0],d-=g[1],m+=g[2],p+=g[3]),u){const e=new n(f,d),t=new n(m,d),i=new n(f,p),r=new n(m,p),o=l(u);let s=new n(0,0);h&&(s=new n(h[0],h[1])),e._rotateAround(o,s),t._rotateAround(o,s),i._rotateAround(o,s),r._rotateAround(o,s),f=Math.min(e.x,t.x,i.x,r.x),m=Math.max(e.x,t.x,i.x,r.x),d=Math.min(e.y,t.y,i.y,r.y),p=Math.max(e.y,t.y,i.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,f,d,m,p,c,r,o,s),e.length-1}function Id(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function zd(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}const Pd=Ko([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:Ld}=Pd,Dd=Ko([{name:"a_pos_3",components:3,type:"Int16"}]);var Rd=Ko([{name:"a_pos",type:"Int16",components:2}]);const Bd=ba/Math.PI/2,Od=2*Aa(1,0)*Bd*Math.PI,Fd=[64,32,16],jd=-Bd,$d=Bd,Nd=[new Yl([jd,jd,jd],[$d,$d,$d]),new Yl([jd,jd,jd],[0,0,$d]),new Yl([0,jd,jd],[$d,0,$d]),new Yl([jd,0,jd],[0,$d,$d]),new Yl([0,0,jd],[$d,$d,$d])];function Ud(e,t,i,r){const n=zl([],e._camera.position,e.worldSize),o=[t,i,1,1];Vl(o,o,e.pixelMatrixInverse),Ul(o,o,1/o[3]);const s=Ll([],jl([],o,n)),a=e.globeMatrix,l=[a[12],a[13],a[14]],u=jl([],l,n),h=Sl(u),d=Ll([],u),p=e.worldSize/(2*Math.PI),m=Dl(d,s),g=Math.asin(p/h);if(g<Math.acos(m)){if(!r)return null;const e=[],t=[];zl(e,s,h/m),Ll(t,jl(t,e,u)),Ll(s,Ml(s,u,zl(s,t,Math.tan(g)*h)))}const y=[];new Hl(n,s).closestPointOnSphere(l,p,y);const _=Ll([],j(a,0)),v=Ll([],j(a,1)),x=Ll([],j(a,2)),b=Dl(_,y),w=Dl(v,y),T=Dl(x,y),S=c(Math.asin(-w/p));let C=c(Math.atan2(b,T));C=e.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(e.center.lng,C);const M=ka(C),k=f(Ea(S),0,1);return new Da(M,k)}class Vd{constructor(e,t,i){this.a=jl([],e,i),this.b=jl([],t,i),this.center=i;const r=Ll([],this.a),n=Ll([],this.b);this.angle=Math.acos(Dl(r,n))}}function Gd(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,r){const n=Math.sin(i);return e*(Math.sin((1-r)*i)/n)+t*(Math.sin(r*i)/n)}(e.a[t],e.b[t],e.angle,f(i,0,1))+e.center[t]}function qd(e){if(e.z<=1)return Nd[e.z+2*e.y+e.x];const[t,i]=Wd(e),r=[Xd(t[0],t[1]),Xd(t[0],i[1]),Xd(i[0],t[1]),Xd(i[0],i[1])],n=[$d,$d,$d],o=[jd,jd,jd];for(const e of r)n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.min(n[2],e[2]),o[0]=Math.max(o[0],e[0]),o[1]=Math.max(o[1],e[1]),o[2]=Math.max(o[2],e[2]);return new Yl(n,o)}function Zd(e,t,i){const r=t/e.worldSize,n=Number.MAX_VALUE,o=[-n,-n,-n],s=[n,n,n],a=fl(new Float64Array(16));if(yl(a,a,[r,r,r]),ml(a,a,e.globeMatrix),i.z<=1){const e=qd(i).getCorners();for(let t=0;t<e.length;t++)Bl(e[t],e[t],a),Al(s,s,e[t]),Il(o,o,e[t]);return new Yl(s,o)}const[c,u]=Wd(i),h=new wa;h.setSouthWest([c[1],u[0]]),h.setNorthEast([u[1],c[0]]);const d=[Xd(h.getSouth(),h.getWest()),Xd(h.getSouth(),h.getEast()),Xd(h.getNorth(),h.getEast()),Xd(h.getNorth(),h.getWest())];for(let e=0;e<d.length;e++)Bl(d[e],d[e],a),Al(s,s,d[e]),Il(o,o,d[e]);if(h.contains(e.center)){o[2]=0;const t=e.point,i=[t.x*r,t.y*r,0];return Al(s,s,i),Il(o,o,i),new Yl(s,o)}const p=[a[12],a[13],a[14]],m=e.center.lng,g=f(e.center.lat,-85.051129,La),y=[ka(m),Ea(g)],_=h.getCenter().lng,v=f(h.getCenter().lat,-85.051129,La),x=[ka(_),Ea(v)];let b=new Array(3),w=0,T=y[0]-x[0];const S=y[1]-x[1];if(T>.5?T-=1:T<-.5&&(T+=1),Math.abs(T)>Math.abs(S))w=T>=0?1:3,b=p;else{w=S>=0?0:2;const e=[a[4],a[5],a[6]];let t;t=S>=0?-Math.sin(l(h.getSouth()))*Bd:-Math.sin(l(h.getNorth()))*Bd,b=Pl(b,p,e,t)}const C=d[w],M=d[(w+1)%4],k=new Vd(C,M,b),E=[Gd(k,0)||C[0],Gd(k,1)||C[1],Gd(k,2)||C[2]];return s[2]=Math.min(C[2],M[2]),Al(s,s,E),Il(o,o,E),new Yl(s,o)}function Wd(e){const t=1<<e.z,i=e.x/t,r=(e.x+1)/t,n=(e.y+1)/t;return[[za(e.y/t),Ia(i)],[za(n),Ia(r)]]}function Hd(e,t,i,r=Bd){return i=l(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function Xd(e,t,i){return Hd(Math.cos(l(e)),Math.sin(l(e)),t,i)}function Kd(e,t,i){const r=Math.pow(2,i.z),n=(e/ba+i.x)/r;return Xd(za((t/ba+i.y)/r),Ia(n))}function Yd(e){return 16383/Math.max(...jl([],e.max,e.min))}function Jd(e){const t=fl(new Float64Array(16)),i=Yd(e);var r,n;return yl(t,t,[i,i,i]),gl(t,t,((r=[])[0]=-(n=e.min)[0],r[1]=-n[1],r[2]=-n[2],r)),t}function Qd(e){const t=fl(new Float64Array(16)),i=1/Yd(e);return gl(t,t,e.min),yl(t,t,[i,i,i]),t}function ep(e,t,i,r,n){const o=function(e){const t=ba/(2*Math.PI);return e/(2*Math.PI)/t}(i),s=[e,t,-i/(2*Math.PI)],a=fl(new Float64Array(16));return gl(a,a,s),yl(a,a,[o,o,o]),_l(a,a,l(-n)),vl(a,a,l(-r)),a}function tp(e){return m(5,6,e)}function ip(e,t){const i=Xd(t.lat,t.lng);return o=(r=kl([],function(e){const t=Xd(e._center.lat,e._center.lng);let i=Rl([],Cl(0,1,0),t);const r=xl([],-e.angle,t);i=Bl(i,i,r),xl(r,-e._pitch,i);const n=Ll([],t);return zl(n,n,e.cameraToCenterDistance/e.pixelsPerMeter*Od),Bl(n,n,r),Ml([],t,n)}(e),i))[0],s=r[1],a=r[2],l=(n=i)[0],c=n[1],u=n[2],d=(h=Math.sqrt(o*o+s*s+a*a)*Math.sqrt(l*l+c*c+u*u))&&Dl(r,n)/h,Math.acos(Math.min(Math.max(d,-1),1));var r,n,o,s,a,l,c,u,h,d}const rp=l(85),np=Math.cos(rp),op=Math.sin(rp);function sp(e,t){const i=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),o=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),s=Math.sin(e._pitch)*o+n;return Math.min(1.01*s,n*(1/e._horizonShift))}function ap(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),r=e.x*i,n=(e.x+1)*i,o=e.y*i,s=(e.y+1)*i,a=Ia(r),l=Ia(n),c=za(o),u=za(s),h=t.project(a,c),d=t.project(l,c),p=t.project(l,u),f=t.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),y=Math.max(h.x,d.x,p.x,f.x),_=Math.max(h.y,d.y,p.y,f.y);const v=i/16;function x(e,i,r,n,o,s){const a=(r+o)/2,l=(n+s)/2,c=t.project(Ia(a),za(l)),u=Math.max(0,m-c.x,g-c.y,c.x-y,c.y-_);m=Math.min(m,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),_=Math.max(_,c.y),u>v&&(x(e,c,r,n,a,l),x(c,i,a,l,o,s))}x(h,d,r,o,n,o),x(d,p,n,o,n,s),x(p,f,n,s,r,s),x(f,h,r,s,r,o),m-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-m,_-g);return{scale:b,x:m*b,y:g*b,x2:y*b,y2:_*b,projection:t}}const lp=fl(new Float32Array(16));class cp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new Sa(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t,i=!0){return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return Aa(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return sp(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,r){const o=e.horizonLineFromTop(!1),s=new n(t,Math.max(o,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(s,r))}pointCoordinate3D(e,t,i){const r=new n(t,i);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return lp}createTileMatrix(e,t,i){let r,n,o;const s=i.canonical,a=fl(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=ap(s,this);r=1,n=l.x+i.wrap*l.scale,o=l.y,yl(a,a,[r/l.scale,r/l.scale,e.pixelsPerMeter/t])}else r=t/e.zoomScale(s.z),n=(s.x+Math.pow(2,s.z)*i.wrap)*r,o=s.y*r;return gl(a,a,[n,o,0]),yl(a,a,[r/ba,r/ba,1]),a}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class up extends cp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(l(t));this.n=(r+Math.sin(l(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:r,r0:n}=this,o=l(e-this.center[0]),s=l(t),a=Math.sqrt(r-2*i*Math.sin(s))/i;return{x:a*Math.sin(o*i),y:a*Math.cos(o*i)-n,z:0}}unproject(e,t){const{n:i,c:r,r0:n}=this,o=n+t;let s=Math.atan2(e,Math.abs(o))*Math.sign(o);o*i<0&&(s-=Math.PI*Math.sign(e)*Math.sign(o));const a=l(this.center[0])*i;s=g(s,-Math.PI-a,Math.PI-a);const u=c(s/i)+this.center[0],h=Math.asin(f((r-(e*e+o*o)*i*i)/(2*i),-1,1)),d=f(c(h),-85.051129,La);return new Sa(u,d)}}const hp=1.340264,dp=-.081106,pp=893e-6,fp=.003796,mp=Math.sqrt(3)/2;class gp extends cp{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(mp*Math.sin(t)),r=i*i,n=r*r*r;return{x:.5*(e*Math.cos(i)/(mp*(hp+3*dp*r+n*(7*pp+9*fp*r)))/Math.PI+.5),y:1-.5*(i*(hp+dp*r+n*(pp+fp*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=i*i,n=r*r*r;for(let e,o,s,a=0;a<12&&(o=i*(hp+dp*r+n*(pp+fp*r))-t,s=hp+3*dp*r+n*(7*pp+9*fp*r),e=o/s,i=f(i-e,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(e)<1e-12));++a);const o=mp*e*(hp+3*dp*r+n*(7*pp+9*fp*r))/Math.cos(i),s=Math.asin(Math.sin(i)/mp),a=f(180*o/Math.PI,-180,180),l=f(180*s/Math.PI,-85.051129,La);return new Sa(a,l)}}class yp extends cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),r=f(360*(.5-t),-85.051129,La);return new Sa(i,r)}}const _p=Math.PI/2;function vp(e){return Math.tan((_p+e)/2)}class xp extends cp{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30],r=l(t),n=l(i),o=Math.cos(r);this.n=r===n?Math.sin(r):Math.log(o/Math.cos(n))/Math.log(vp(n)/vp(r)),this.f=o*Math.pow(vp(r),this.n)/this.n}project(e,t){t=l(t),e=l(e-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?t<-_p+i&&(t=-_p+i):t>_p-i&&(t=_p-i);const o=n/Math.pow(vp(t),r),s=o*Math.sin(r*e),a=n-o*Math.cos(r*e);return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+.5),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,t=(2*(1-t)-.5)*Math.PI;const{n:i,f:r}=this,n=r-t,o=Math.sign(n),s=Math.sign(i)*Math.sqrt(e*e+n*n);let a=Math.atan2(e,Math.abs(n))*o;n*i<0&&(a-=Math.PI*Math.sign(e)*o);const l=f(c(a/i)+this.center[0],-180,180),u=f(c(2*Math.atan(Math.pow(r/s,1/i))-_p),-85.051129,La);return new Sa(l,u)}}class bp extends cp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:ka(e),y:Ea(t),z:0}}unproject(e,t){const i=Ia(e),r=za(t);return new Sa(i,r)}}const wp=l(La);class Tp extends cp{project(e,t){const i=(t=l(t))*t,r=i*i;return{x:.5*((e=l(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=25,n=0,o=i*i;do{o=i*i;const e=o*o;n=(i*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),i=f(i-n,-wp,wp)}while(Math.abs(n)>1e-6&&--r>0);o=i*i;const s=f(c(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=c(i);return new Sa(s,a)}}const Sp=l(La);class Cp extends cp{project(e,t){t=l(t),e=l(e);const i=Math.cos(t),r=2/Math.PI,n=Math.acos(i*Math.cos(e/2)),o=Math.sin(n)/n,s=.5*(e*r+2*i*Math.sin(e/2)/o)||0,a=.5*(t+Math.sin(t)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,n=25;const o=1e-6;let s=0,a=0;do{const n=Math.cos(r),o=Math.sin(r),l=2*o*n,c=o*o,u=n*n,h=Math.cos(i/2),d=Math.sin(i/2),p=2*h*d,m=d*d,g=1-u*h*h,y=g?1/g:0,_=g?Math.acos(n*h)*Math.sqrt(1/g):0,v=.5*(2*_*n*d+2*i/Math.PI)-e,x=.5*(_*o+r)-t,b=.5*y*(u*m+_*n*h*c)+1/Math.PI,w=y*(p*l/4-_*o*d),T=.125*y*(l*d-_*o*u*p),S=.5*y*(c*h+_*m*n)+.5,C=w*T-S*b;s=(x*w-v*S)/C,a=(v*T-x*b)/C,i=f(i-s,-Math.PI,Math.PI),r=f(r-a,-Sp,Sp)}while((Math.abs(s)>o||Math.abs(a)>o)&&--n>0);return new Sa(c(i),c(r))}}class Mp extends cp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(l(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:r}=this;return{x:l(e)*r*i+.5,y:-Math.sin(l(t))/r*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:r}=this,n=-(t-.5)/i,o=f(c((e-.5)/i)/r,-180,180),s=Math.asin(f(n*r,-1,1)),a=f(c(s),-85.051129,La);return new Sa(o,a)}}class kp extends bp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,t,i){const r=Math.pow(2,i.z),n=(e/ba+i.x)/r,o=Xd(za((t/ba+i.y)/r),Ia(n));return Bl(o,o,Jd(qd(i))),{x:o[0],y:o[1],z:o[2]}}locationPoint(e,t){const i=Xd(t.lat,t.lng),r=Ll([],i),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;Pl(i,i,r,Aa(1,0)*ba*o);const s=fl(new Float64Array(16));return ml(s,e.pixelMatrix,e.globeMatrix),Bl(i,i,s),new n(i[0],i[1])}pixelsPerMeter(e,t){return Aa(1,0)*t}pixelSpaceConversion(e,t,i){const r=yi(Aa(1,45)*t,Aa(1,e)*t,i);return this.pixelsPerMeter(e,t)/r}createTileMatrix(e,t,i){const r=Qd(qd(i.canonical));return ml(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,t){const{center:i}=e,r=fl(new Float64Array(16));return ml(r,r,Jd(qd(t))),vl(r,r,l(i.lng)),_l(r,r,l(i.lat)),yl(r,r,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(r)}pointCoordinate(e,t,i,r){return Ud(e,t,i,!0)||new Da(0,0)}pointCoordinate3D(e,t,i){const r=this.pointCoordinate(e,t,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!Ud(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const i=e.cameraToCenterDistance,r=e._centerAltitude*t,n=e._camera,o=e._camera.forward(),s=Ml([],zl([],o,-i),[0,0,r]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),h=zl([],n.up(),u),d=zl([],n.right(),u*c),p=Ll([],Ml([],Ml([],o,h),d)),f=[];let m;if(new Hl(s,p).closestPointOnSphere(l,a,f)){const t=Ml([],f,l),i=jl([],t,s);m=Math.cos(e.fovAboveCenter)*Sl(i)}else{const e=jl([],s,l),t=jl([],l,s);Ll(t,t);const i=Sl(e)-a;m=Math.sqrt(i*(i+2*a));const r=Math.acos(m/(a+i))-Math.acos(Dl(o,t));m*=Math.cos(r)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=tp(e.zoom);if(i>0){const r=sp(e,Aa(1,e.center.lat)*e.worldSize),n=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return yi(t,r+n*(1-Math.cos(o)),Math.pow(i,10))}return t}upVector(e,t,i){const r=1<<e.z,n=(t/ba+e.x)/r;return Xd(za((i/ba+e.y)/r),Ia(n),1)}upVectorScale(e){return{metersToTile:Od*Yd(qd(e))}}}function Ep(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new bp(e);case"equirectangular":return new yp(e);case"naturalEarth":return new Tp(e);case"equalEarth":return new gp(e);case"winkelTripel":return new Cp(e);case"albers":return i?new Mp(e):new up(e);case"lambertConformalConic":return i?new Mp(e):new xp(e);case"globe":return new kp(e)}throw new Error(`Invalid projection name: ${e.name}`)}const Ap=hu.VectorTileFeature.types,Ip=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zp(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(Md,Math.round(a[0])):0,f=a?Math.min(Md,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Pp(e,t,i,r,n,o,s){e.emplaceBack(t,i,r,n,o,s)}function Lp(e,t,i,r,n){e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n)}function Dp(e){for(const t of e.sections)if(_o(t.text))return!0;return!1}class Rp{constructor(e){this.layoutVertexArray=new ss,this.indexArray=new fs,this.programConfigurations=e,this.segments=new xa,this.dynamicLayoutVertexArray=new is,this.opacityVertexArray=new ls,this.placedSymbolArray=new As,this.globeExtVertexArray=new as}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,qu.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ip,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gu.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}zn(Rp,"SymbolBuffers");class Bp{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new xa,this.collisionVertexArray=new ds,this.collisionVertexArrayExt=new ps}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Zu.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Wu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}zn(Bp,"CollisionBuffers");class Op{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fl([]),this.placementViewportMatrix=fl([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ju(this.zoom,t["text-size"]),this.iconSizeData=Ju(this.zoom,t["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),n=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map((e=>Dh[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Rp(new ua(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Rp(new ua(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ps,this.lineVertexArray=new Ls,this.symbolInstances=new zs}calculateGlyphDependencies(e,t,i,r,n){for(let i=0;i<e.length;i++)if(t[e.charCodeAt(i)]=!0,r&&n){const r=rh[e.charAt(i)];r&&(t[r.charCodeAt(0)]=!0)}}populate(e,t,i,r){const n=this.layers[0],o=n.layout,s="globe"===this.projection.name,a=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),u=("constant"!==l.value.kind||l.value.value instanceof xt&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!u&&!h)return;const p=t.iconDependencies,f=t.glyphDependencies,m=t.availableImages,g=new zo(this.zoom);for(const{feature:t,id:l,index:c,sourceLayerIndex:y}of e){const e=n._featureFilter.needGeometry,_=Va(t,e);if(!n._featureFilter.filter(g,_,i))continue;if(e||(_.geometry=Ua(t,i,r)),s&&1!==t.type&&i.z<=5){const e=_.geometry,t=1<<i.z,r=i.x,n=i.y,o=.98078528056;for(let i=0;i<e.length;i++)e[i]=Fa(e[i],(e=>e),((e,i)=>Dl(Xd(za((e.y/ba+n)/t),Ia((e.x/ba+r)/t),1),Xd(za((i.y/ba+n)/t),Ia((i.x/ba+r)/t),1))<o))}let v,x;if(u){const e=n.getValueAndResolveTokens("text-field",_,i,m),t=xt.factory(e);Dp(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Eo()||this.hasRTLText&&Io.isParsed())&&(v=ih(t,n,_))}if(h){const e=n.getValueAndResolveTokens("icon-image",_,i,m);x=e instanceof bt?e:bt.fromString(e)}if(!v&&!x)continue;const b=this.sortFeaturesByKey?d.evaluate(_,{},i):void 0;if(this.features.push({id:l,text:v,icon:x,index:c,sourceLayerIndex:y,geometry:_.geometry,properties:t.properties,type:Ap[t.type],sortKey:b}),x&&(p[x.name]=!0),v){const e=a.evaluate(_,{},i).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dh.vertical)>=0;for(const i of v.sections)if(i.image)p[i.image.name]=!0;else{const r=uo(v.toString()),n=i.fontStack||e,o=f[n]=f[n]||{};this.calculateGlyphDependencies(i.text,o,t,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function o(t){r.push(e[t]),n++}function s(e,t,n){const o=i[e];return delete i[e],i[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(e,i,n){const o=t[i];return delete t[i],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),n=s(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ep(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length,r=e.segment;if(void 0!==r){let i=e.dist(t[r+1]),n=e.dist(t[r]);const o={};for(let e=r+1;e<t.length;e++)o[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:i},e<t.length-1&&(i+=t[e+1].dist(t[e]));for(let e=r||0;e>=0;e--)o[e]={x:t[e].x,y:t[e].y,tileUnitDistanceFromAnchor:n},e>0&&(n+=t[e-1].dist(t[e]));for(let e=0;e<t.length;e++){const t=o[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,r,n,o,s,a,l,c,u,h,d,p){const f=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,y=e.segments.prepareSegment(4*t.length,m,f,this.canOverlap?o.sortKey:void 0),_=this.glyphOffsetArray.length,v=y.vertexLength,x=this.allowVerticalPlacement&&s===Dh.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let r=0;r<t.length;r++){const{tl:n,tr:s,bl:c,br:u,tex:h,pixelOffsetTL:_,pixelOffsetBR:v,minFontScaleX:w,minFontScaleY:T,glyphOffset:S,isSDF:C,sectionIndex:M}=t[r],k=y.vertexLength,E=S[1];if(zp(m,l.x,l.y,n.x,E+n.y,h.x,h.y,i,C,_.x,_.y,w,T),zp(m,l.x,l.y,s.x,E+s.y,h.x+h.w,h.y,i,C,v.x,_.y,w,T),zp(m,l.x,l.y,c.x,E+c.y,h.x,h.y+h.h,i,C,_.x,v.y,w,T),zp(m,l.x,l.y,u.x,E+u.y,h.x+h.w,h.y+h.h,i,C,v.x,v.y,w,T),a){const t=a.anchor,i=a.up;Pp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Pp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Pp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Pp(g,t.x,t.y,t.z,i[0],i[1],i[2]),Lp(e.dynamicLayoutVertexArray,t.x,t.y,t.z,x)}else Lp(e.dynamicLayoutVertexArray,l.x,l.y,l.z,x);f.emplaceBack(k,k+1,k+2),f.emplaceBack(k+1,k+2,k+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(S[0]),r!==t.length-1&&M===t[r+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,o,o.index,{},d,p,b&&b[M])}const w=a?a.anchor:l;e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,l.x,l.y,_,this.glyphOffsetArray.length-_,v,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(e,t,i,r,n,o,s){e.emplaceBack(t,i,r,n,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(e,t,i,r,o,s,a){const l=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),c=l.vertexLength,u=a.tileAnchorX,h=a.tileAnchorY;for(let e=0;e<4;e++)i.collisionVertexArray.emplaceBack(0,0,0,0);i.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),i.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),i.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(i.layoutVertexArray,r,o,s,u,h,new n(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,o,s,u,h,new n(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,o,s,u,h,new n(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,o,s,u,h,new n(e.x1,e.y2)),l.vertexLength+=4;const d=i.indexArray;d.emplaceBack(c,c+1),d.emplaceBack(c+1,c+2),d.emplaceBack(c+2,c+3),d.emplaceBack(c+3,c),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceIconSize(e,t,s);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bp(us,Hu.members,bs),this.iconCollisionBox=new Bp(us,Hu.members,bs);const i=eh(this.iconSizeData,e),r=eh(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,i,r){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),o=Qu(this.textSizeData,e,n)/Ku;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,i){const r=this.icon.placedSymbolArray.get(i),n=Qu(this.iconSizeData,e,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,i){e.emplaceBack(t,-i,-i),e.emplaceBack(t,i,-i),e.emplaceBack(t,i,i),e.emplaceBack(t,-i,i)}_updateTextDebugCollisionBoxes(e,t,i,r,n,o){for(let s=r;s<n;s++){const r=i.get(s),n=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding)}}_updateIconDebugCollisionBoxes(e,t,i,r,n){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=eh(this.iconSizeData,e),r=eh(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,e,t,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,e,t,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(i,e,t,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(i,e,t,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,o,s,a,l){const c={};for(let r=t;r<i;r++){const t=e.get(r);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,padding:t.padding,projectedAnchorX:t.projectedAnchorX,projectedAnchorY:t.projectedAnchorY,projectedAnchorZ:t.projectedAnchorZ,tileAnchorX:t.tileAnchorX,tileAnchorY:t.tileAnchorY},c.textFeatureIndex=t.featureIndex;break}for(let t=r;t<n;t++){const i=e.get(t);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let t=o;t<s;t++){const i=e.get(t);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.iconFeatureIndex=i.featureIndex;break}for(let t=a;t<l;t++){const i=e.get(t);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,padding:i.padding,projectedAnchorX:i.projectedAnchorX,projectedAnchorY:i.projectedAnchorY,projectedAnchorZ:i.projectedAnchorZ,tileAnchorX:i.tileAnchorX,tileAnchorY:i.tileAnchorY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);r.push(0|Math.round(t*s.tileAnchorX+i*s.tileAnchorY)),n.push(s.featureIndex)}return o.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,i)=>{e>=0&&i.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}zn(Op,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Op.MAX_GLYPHS=65535,Op.addDynamicAttributes=Lp;const Fp=new qo({"symbol-placement":new $o(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new $o(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $o(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new No(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $o(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $o(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $o(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new $o(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $o(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new No(Ge.layout_symbol["icon-size"]),"icon-text-fit":new $o(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $o(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new No(Ge.layout_symbol["icon-image"]),"icon-rotate":new No(Ge.layout_symbol["icon-rotate"]),"icon-padding":new $o(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new $o(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new No(Ge.layout_symbol["icon-offset"]),"icon-anchor":new No(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $o(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $o(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $o(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new No(Ge.layout_symbol["text-field"]),"text-font":new No(Ge.layout_symbol["text-font"]),"text-size":new No(Ge.layout_symbol["text-size"]),"text-max-width":new No(Ge.layout_symbol["text-max-width"]),"text-line-height":new No(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new No(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new No(Ge.layout_symbol["text-justify"]),"text-radial-offset":new No(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $o(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new No(Ge.layout_symbol["text-anchor"]),"text-max-angle":new $o(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new $o(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new No(Ge.layout_symbol["text-rotate"]),"text-padding":new $o(Ge.layout_symbol["text-padding"]),"text-keep-upright":new $o(Ge.layout_symbol["text-keep-upright"]),"text-transform":new No(Ge.layout_symbol["text-transform"]),"text-offset":new No(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new $o(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $o(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new $o(Ge.layout_symbol["text-optional"])});var jp={paint:new qo({"icon-opacity":new No(Ge.paint_symbol["icon-opacity"]),"icon-color":new No(Ge.paint_symbol["icon-color"]),"icon-halo-color":new No(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new No(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new No(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new $o(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new $o(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new No(Ge.paint_symbol["text-opacity"]),"text-color":new No(Ge.paint_symbol["text-color"],{runtimeType:it,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new No(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new No(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new No(Ge.paint_symbol["text-halo-blur"]),"text-translate":new $o(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new $o(Ge.paint_symbol["text-translate-anchor"])}),layout:Fp};class $p{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Je,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zn($p,"FormatSectionOverride",{omit:["defaultValue"]});class Np extends ya{constructor(e){super(e,jp)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Lr(o.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new Op(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of jp.paint.overridableProperties){if(!Np.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new $p(t),r=new Pr(i,t.property.specification);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new Rr("source",r):new Br("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Fo(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&Np.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=jp.paint.properties[t];let n=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof xt)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof kt&&St(t.value)===st?o(t.value.sections):t instanceof Pt?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramConfiguration(e){return new ca(this,e)}}var Up={paint:new qo({"background-color":new $o(Ge.paint_background["background-color"]),"background-pattern":new Vo(Ge.paint_background["background-pattern"]),"background-opacity":new $o(Ge.paint_background["background-opacity"])})},Vp={paint:new qo({"raster-opacity":new $o(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new $o(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $o(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $o(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new $o(Ge.paint_raster["raster-saturation"]),"raster-contrast":new $o(Ge.paint_raster["raster-contrast"]),"raster-resampling":new $o(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new $o(Ge.paint_raster["raster-fade-duration"])})};class Gp extends ya{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var qp={paint:new qo({"sky-type":new $o(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new $o(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $o(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $o(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $o(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Go(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $o(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $o(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $o(Ge.paint_sky["sky-opacity"])})};function Zp(e,t,i){const r=[0,0,1],n=ql([]);return Wl(n,n,i?-l(e)+Math.PI:l(e)),Zl(n,n,-l(t)),Ol(r,r,n),Ll(r,r)}const Wp={circle:class extends ya{constructor(e){super(e,ul)}createBucket(e){return new Za(e)}queryRadius(e){const t=e;return ol("circle-radius",this,t)+ol("circle-stroke-width",this,t)+sl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,o,s,a){const l=ll(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Jl(e,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new ca(this,e)}},heatmap:class extends ya{createBucket(e){return new rc(e)}constructor(e){super(e,cc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return ol("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,o,s,a,l){const c=this.paint.get("heatmap-radius").evaluate(t,i);return Jl(e,r,s,a,l,!0,!0,new n(0,0),c)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new ca(this,e)}},hillshade:class extends ya{constructor(e){super(e,hc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ya{constructor(e){super(e,Jc)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new ca(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Kc(e)}queryRadius(){return sl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,o){return!e.queryGeometry.isAboveHorizon&&Xa(al(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends ya{constructor(e){super(e,wu)}createBucket(e){return new _u(e)}queryRadius(){return sl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new ca(this,e)}queryIntersectsFeature(e,t,i,r,o,s,a,l,c){const u=ll(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,i),d=this.paint.get("fill-extrusion-base").evaluate(t,i),p=[0,0],f=l&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=e.tile.getBucket(this);if(f&&g instanceof _u){const e=g.centroidVertexArray,t=c+1;if(t<e.length){const i=e.get(t);p[0]=i.a_centroid_pos0,p[1]=i.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;"globe"===s.projection.name&&(r=bu([r],[new n(0,0),new n(ba,ba)],e.tileID.canonical).map((e=>e.polygon)).flat());const y=function(e,t,i,r,o,s,a,l,c,u,h){return"globe"===e.projection.name?function(e,t,i,r,n,o,s,a,l,c,u){const h=[],d=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],g=(e,t,i,r)=>{e[0]=t,e[1]=i,e[2]=r,e[3]=1},y=xu();i>0&&(i+=y),r+=y;for(const y of t){const t=[],_=[];for(const h of y){const d=h.x+n.x,y=h.y+n.y,v=e.projection.projectTilePoint(d,y,u),x=e.projection.upVector(u,h.x,h.y);let b=i,w=r;if(s){const e=zu(d,y,i,r,s,a,l,c);b+=e.base,w+=e.top}0!==i?g(f,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):g(f,v.x,v.y,v.z),g(m,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),Bl(f,f,o),Bl(m,m,o),t.push(Iu(f)),_.push(Iu(m))}h.push(t),d.push(_)}return[h,d]}(e,t,i,r,o,s,a,l,c,u,h):a?function(e,t,i,r,n,o,s,a,l){const c=[],u=[],h=[0,0,0,1];for(const d of e){const e=[],p=[];for(const c of d){const u=c.x+r.x,d=c.y+r.y,f=zu(u,d,t,i,o,s,a,l);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,Vl(h,h,n),h[3]=Math.max(h[3],1e-5);const m=Iu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,Vl(h,h,n),h[3]=Math.max(h[3],1e-5);const g=Iu([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);e.push(m),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,i,r,o,s,a,l,c,u):function(e,t,i,r,o){const s=[],a=[],l=o[8]*t,c=o[9]*t,u=o[10]*t,h=o[11]*t,d=o[8]*i,p=o[9]*i,f=o[10]*i,m=o[11]*i;for(const t of e){const e=[],i=[];for(const s of t){const t=s.x+r.x,a=s.y+r.y,g=o[0]*t+o[4]*a+o[12],y=o[1]*t+o[5]*a+o[13],_=o[2]*t+o[6]*a+o[14],v=o[3]*t+o[7]*a+o[15],x=g+l,b=y+c,w=_+u,T=Math.max(v+h,1e-5),S=g+d,C=y+p,M=_+f,k=Math.max(v+m,1e-5),E=new n(x/T,b/T);E.z=w/T,e.push(E);const A=new n(S/k,C/k);A.z=M/k,i.push(A)}s.push(e),a.push(i)}return[s,a]}(t,i,r,o,s)}(s,r,d,h,u,a,f?l:null,p,m,s.center.lat,e.tileID.canonical),_=e.queryGeometry;return function(e,t,i){let r=1/0;Xa(i,t)&&(r=Au(i,t[0]));for(let n=0;n<t.length;n++){const o=t[n],s=e[n];for(let e=0;e<o.length-1;e++){const t=o[e],n=[t,o[e+1],s[e+1],s[e],t];Wa(i,n)&&(r=Math.min(r,Au(i,n)))}}return r!==1/0&&r}(y[0],y[1],_.isPointQuery()?_.screenBounds:_.screenGeometry)}},line:class extends ya{constructor(e){super(e,$u),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Nu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Fu(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new ca(this,e)}queryRadius(e){const t=e,i=Uu(ol("line-width",this,t),ol("line-gap-width",this,t)),r=ol("line-offset",this,t);return i/2+Math.abs(r)+sl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,o,s){if(e.queryGeometry.isAboveHorizon)return!1;const a=al(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*Uu(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(r=function(e,t){const i=[],r=new n(0,0);for(let n=0;n<e.length;n++){const o=e[n],s=[];for(let e=0;e<o.length;e++){const i=o[e-1],n=o[e],a=o[e+1],l=0===e?r:n.sub(i)._unit()._perp(),c=e===o.length-1?r:a.sub(n)._unit()._perp(),u=l._add(c)._unit();u._mult(1/(u.x*c.x+u.y*c.y)),s.push(u._mult(t)._add(n))}i.push(s)}return i}(r,c*e.pixelToTileUnitsFactor)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(il(e,n[t]))return!0;if(Ka(e,n,i))return!0}return!1}(a,r,l)}isTileClipped(){return!0}},symbol:Np,background:class extends ya{constructor(e){super(e,Up)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ya{constructor(e){super(e,Vp)}getProgramIds(){return["raster"]}},sky:class extends ya{constructor(e){super(e,qp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=uc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,o=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&z("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?Zp(o.azimuthal,90-o.polar,t):Zp(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return Zp(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class Hp{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,i,r){const{width:n,height:o}=e,{context:s}=this,{gl:a}=s,{HTMLImageElement:l,HTMLCanvasElement:c,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=t;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===o){const{x:t,y:i}=r||{x:0,y:0};e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texSubImage2D(a.TEXTURE_2D,0,t,i,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,t,i,n,o,a.RGBA,a.UNSIGNED_BYTE,e.data)}else this.size=[n,o],e instanceof l||e instanceof c||e instanceof u||e instanceof h||d&&e instanceof d?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,n,o,0,this.format,a.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Xp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new ac({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=T(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const n=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.image.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e,t){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}const i=e[0],r=e[e.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let o=0,s=e[o];for(let i=0;i<this.width;i++){i/s.right>1&&(s=e[++o]);const r=Math.abs(i-s.left),a=Math.abs(i-s.right),l=Math.min(r,a);this.image.data[n+i]=Math.max(0,Math.min(255,(s.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const r="round"===t,n=r?7:0,o=2*n+1;if(this.nextRow+o>this.height)return z("LineAtlas out of space"),null;0===e.length&&e.push(1);let s=0;for(let t=0;t<e.length;t++)e[t]<0&&(z("Negative value is found in line dasharray, replacing values with 0"),e[t]=0),s+=e[t];if(0!==s){const i=this.width/s,o=this.getDashRanges(e,this.width,i);r?this.addRoundDash(o,i,n):this.addRegularDash(o,"square"===t?.5*i:0)}const a=this.nextRow+n;this.nextRow+=o;const l={tl:[a,n],br:[s,0]};return this.positions[i]=l,l}}zn(Xp,"LineAtlas");class Kp{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Yp{constructor(){this.tasks={},this.taskQueue=[],C(["process"],this),this.invoker=new Kp(this.process),this.nextId=0}add(e,t){const i=this.nextId++,r=function({type:e,isSymbolTile:t,zoom:i}){return i=i||0,"message"===e?0:"maybePrepare"!==e||t?"parseTile"!==e||t?"parseTile"===e&&t?300-i:"maybePrepare"===e&&t?400-i:500:200-i:100-i}(t);if(0===r){D();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){D();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const r=this.tasks[this.taskQueue[i]];r.priority<t&&(t=r.priority,e=i)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class Jp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Qp=["tile","layer","source","sourceLayer","state"];class ef{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Qp)void 0!==this[t]&&(e[t]=this[t]);return e}}const tf=32,rf=33,nf=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,r=0,n=0,o=0,s=0,a=0;for(1&t?n=o=s=tf:i=r=a=tf;(t>>=1)>1;){const e=i+n>>1,l=r+o>>1;1&t?(n=i,o=r,i=s,r=a):(i=n,r=o,n=s,o=a),s=e,a=l}const l=4*e;nf[l+0]=i,nf[l+1]=r,nf[l+2]=n,nf[l+3]=o}const of=new Uint16Array(2178),sf=new Uint8Array(1089),af=new Uint16Array(1089);function lf(e){return 0===e?-.03125:32===e?.03125:0}var cf=Ko([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const uf={type:2,extent:ba,loadGeometry:()=>[[new n(0,0),new n(8193,0),new n(8193,8193),new n(0,8193),new n(0,0)]]};class hf{constructor(e,t,i,r,n){this.tileID=e,this.uid=b(),this.uses=0,this.tileSize=t,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=n,this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<W.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ap(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=r}}return i}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Op){if(this.hasSymbolBuckets=!0,!i)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Op&&t.hasRTLText){this.hasRTLText=!0,Io.isLoading()||Io.isLoaded()||"deferred"!==Eo()||Ao();break}}this.queryPadding=0;for(const e in this.buckets){const i=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(i))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ks}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hp(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hp(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hp(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,r,n,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:n,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(e,t){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),n=t?t.sourceLayer:"",o=r._geojsonTileLayer||r[n];if(!o)return;const s=Xr(t&&t.filter),{z:a,x:l,y:c}=this.tileID.canonical,u={z:a,x:l,y:c};for(let t=0;t<o.length;t++){const r=o.feature(t);if(s.needGeometry){const e=Va(r,!0);if(!s.filter(new zo(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!s.filter(new zo(this.tileID.overscaledZ),r))continue;const h=i.getId(r,n),d=new ef(r,a,l,c,h);d.tile=u,e.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const t=R(e.cacheControl);t["max-age"]&&(this.expirationTime=Date.now()+1e3*t["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let i=!1;if(this.expirationTime>e)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const r=this.expirationTime-t;r?this.expirationTime=e+Math.max(r,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const i=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages();for(const n in this.buckets){if(!t.style.hasLayer(n))continue;const o=this.buckets[n],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=i[s],l=e[s];if(!a||!l||0===Object.keys(l).length)continue;if(o.update(l,a,r,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Fu||o instanceof Kc){const e=t.style._getSourceCache(o.layers[0].source);t._terrain&&t._terrain.enabled&&e&&o.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(n);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=W.now()+e}setTexture(e,t){const i=t.context,r=i.gl;this.texture=t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Hp(i,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),i.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax))}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0],r=new Jo,n=new ws;for(let e=0;e<i.length;e++){const{x:t,y:o}=i[e];r.emplaceBack(t,o),n.emplaceBack(e)}n.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(n),this._tileDebugBuffer=e.createVertexBuffer(r,Rd.members),this._tileDebugSegments=xa.simpleSegment(0,0,r.length,n.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const i=Ua(uf,this.tileID.canonical,this.tileTransform)[0];let r,n;if(this.isRaster){const e=function(e,t){const i=ap(e,t),r=Math.pow(2,e.z);for(let n=0;n<rf;n++)for(let o=0;o<rf;o++){const s=Ia((e.x+(o+lf(o))/tf)/r),a=za((e.y+(n+lf(n))/tf)/r),l=t.project(s,a),c=n*rf+o;of[2*c+0]=Math.round((l.x*i.scale-i.x)*ba),of[2*c+1]=Math.round((l.y*i.scale-i.y)*ba)}sf.fill(0),af.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=nf[t+0],r=nf[t+1],n=nf[t+2],o=nf[t+3],s=i+n>>1,a=r+o>>1,l=s+a-r,c=a+i-s,u=r*rf+i,h=o*rf+n,d=a*rf+s,p=Math.hypot((of[2*u+0]+of[2*h+0])/2-of[2*d+0],(of[2*u+1]+of[2*h+1])/2-of[2*d+1])>=16;if(sf[d]=sf[d]||(p?1:0),e<1022){const e=(r+c>>1)*rf+(i+l>>1),t=(o+c>>1)*rf+(n+l>>1);sf[d]=sf[d]||sf[e]||sf[t]}}const n=new es,o=new fs;let s=0;function a(e,t){const i=t*rf+e;return 0===af[i]&&(n.emplaceBack(of[2*i+0],of[2*i+1],e*ba/tf,t*ba/tf),af[i]=++s),af[i]-1}function l(e,t,i,r,n,s){const c=e+i>>1,u=t+r>>1;if(Math.abs(e-n)+Math.abs(t-s)>1&&sf[u*rf+c])l(n,s,e,t,c,u),l(i,r,n,s,c,u);else{const l=a(e,t),c=a(i,r),u=a(n,s);o.emplaceBack(l,c,u)}}return l(0,0,tf,tf,tf,0),l(tf,tf,0,0,0,tf),{vertices:n,indices:o}}(this.tileID.canonical,t);r=e.vertices,n=e.indices}else{r=new es,n=new fs;for(const{x:e,y:t}of i)r.emplaceBack(e,t,0,0);const e=fc(r.int16,void 0,4);for(let t=0;t<e.length;t+=3)n.emplaceBack(e[t],e[t+1],e[t+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,cf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(n),this._tileBoundsSegments=xa.simpleSegment(0,0,r.length,n.length)}_makeGlobeTileDebugBuffers(e,t){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!t||"globe"!==t.name)return;const i=this.tileID.canonical,r=Jd(qd(i));this._makeGlobeTileDebugBorderBuffer(e,i,r),this._makeGlobeTileDebugTextBuffer(e,i,r)}_makeGlobeTileDebugBorderBuffer(e,t,i){const r=new Jo,n=new ws,o=new Qo,s=(e,s,a,l,c)=>{const u=(a-e)/(c-1),h=(l-s)/(c-1),d=r.length;for(let a=0;a<c;a++){const l=e+a*u,c=s+a*h;r.emplaceBack(l,c);const p=Kd(l,c,t),f=Bl(p,p,i);o.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(d+a)}},a=ba;s(0,0,a,0,16),s(a,0,a,a,16),s(a,a,0,a,16),s(0,a,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(n),this._tileDebugBuffer=e.createVertexBuffer(r,Rd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(o,Dd.members),this._tileDebugSegments=xa.simpleSegment(0,0,r.length,n.length)}_makeGlobeTileDebugTextBuffer(e,t,i){const r=new Jo,n=new fs,o=new Qo,s=25;n.reserve(32),r.reserve(s),o.reserve(s);const a=(e,t)=>s*e+t;for(let e=0;e<s;e++){const n=2048*e;for(let e=0;e<s;e++){const s=2048*e;r.emplaceBack(s,n);const a=Kd(s,n,t),l=Bl(a,a,i);o.emplaceBack(l[0],l[1],l[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=a(e,t),r=a(e,t+1),o=a(e+1,t),s=a(e+1,t+1);n.emplaceBack(i,r,o),n.emplaceBack(o,r,s)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(n),this._tileDebugTextBuffer=e.createVertexBuffer(r,Rd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(o,Dd.members),this._tileDebugTextSegments=xa.simpleSegment(0,0,s,32)}}class df{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,i){const r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},v(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,t){const i=String(t),r=v({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const i=this.deletedStates[e][t];if(null===i)return{};for(const e in i)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),v(this.state[e][i],this.stateChanges[e][i]),t[i]=this.state[e][i];i[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const i in this.state[e])t[i]={},this.state[e][i]={};else for(const i in this.deletedStates[e]){if(null===this.deletedStates[e][i])this.state[e][i]={};else for(const t of Object.keys(this.deletedStates[e][i]))delete this.state[e][i][t];t[i]=this.state[e][i]}i[e]=i[e]||{},v(i[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const r in e)e[r].setFeatureState(i,t)}}class pf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function ff(e,t,i,r){let n=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(i[s]<e[s]||i[s]>t[s])return null}else{const a=1/r[s];let l=(e[s]-i[s])*a,c=(t[s]-i[s])*a;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<o&&(o=c),n>o)return null}return n}function mf(e,t,i,r,n,o,s,a,l,c,u){const h=r-e,d=n-t,p=o-i,f=s-e,m=a-t,g=l-i,y=u[1]*g-u[2]*m,_=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,x=h*y+d*_+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,T=c[1]-t,S=c[2]-i,C=(w*y+T*_+S*v)*b;if(C<0||C>1)return null;const M=T*p-S*d,k=S*h-w*p,E=w*d-T*h,A=(u[0]*M+u[1]*k+u[2]*E)*b;return A<0||C+A>1?null:(f*M+m*k+g*E)*b}function gf(e,t,i){return(e-t)/(i-t)}function yf(e,t,i,r,n,o,s,a,l){const c=1<<i,u=o-r,h=s-n,d=(e+1)/c*u+r,p=(t+0)/c*h+n,f=(t+1)/c*h+n;a[0]=(e+0)/c*u+r,a[1]=p,l[0]=d,l[1]=f}class _f{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let r=Math.ceil(Math.pow(2,t));const n=1/r,o=(e,t,i,r,n)=>{const o=r?1:0,s=(e+1)*i-o,a=t*i,l=(t+1)*i-o;n[0]=e*i,n[1]=a,n[2]=s,n[3]=l};let s=new pf(r);const a=[];for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),n,!1,a);const i=xf(a[0],a[1],e),l=xf(a[2],a[1],e),c=xf(a[2],a[3],e),u=xf(a[0],a[3],e);s.minimums.push(Math.min(i,l,c,u)),s.maximums.push(Math.max(i,l,c,u)),s.leaves.push(1)}for(i.push(s),r/=2;r>=1;r/=2){const e=i[i.length-1];s=new pf(r);for(let t=0;t<r*r;t++){o(t%r,Math.floor(t/r),2,!0,a);const i=e.getElevation(a[0],a[1]),n=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),h=e.isLeaf(a[2],a[1]),d=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}i.push(s)}return i}(this.dem),i=t.length-1,r=t[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,r,n,o,s=1){return ff([e,t,-100],[i,r,this.maximums[0]*s],n,o)}raycast(e,t,i,r,n,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,i,r,n,o,s);if(null==a)return null;const l=[],c=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){yf(f,m,g,e,t,i,r,u,h);const a=1<<g,l=(f+0)/a,c=(f+1)/a,d=(m+0)/a,y=(m+1)/a,_=xf(l,d,this.dem)*s,v=xf(c,d,this.dem)*s,x=xf(c,y,this.dem)*s,b=xf(l,y,this.dem)*s,w=mf(u[0],u[1],_,h[0],u[1],v,h[0],h[1],x,n,o),T=mf(h[0],h[1],x,u[0],h[1],b,u[0],u[1],_,n,o),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const e=Pl([],n,o,p);if(vf(_,v,b,x,gf(e[0],u[0],h[0]),gf(e[1],u[1],h[1]))>=e[2])return p}continue}let y=0;for(let d=0;d<this._siblingOffset.length;d++){yf((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,e,t,i,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=ff(u,h,n,o);if(null!=p){const e=p;l[d]=e;let t=!1;for(let i=0;i<y&&!t;i++)e>=l[c[i]]&&(c.splice(i,0,d),t=!0);t||(c[y]=d),y++}}for(let e=0;e<y;e++){const t=c[e];d.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(m<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,r,n){if(1===e[r].isLeaf(t,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const o=r-1,s=e[o];let a=0,l=0;for(let e=0;e<this._siblingOffset.length;e++){const r=2*t+this._siblingOffset[e][0],n=2*i+this._siblingOffset[e][1],o=s.getElevation(r,n),c=s.isLeaf(r,n),u=this._addNode(o.min,o.max,c);c&&(a|=1<<e),l||(l=u)}for(let r=0;r<this._siblingOffset.length;r++)a&1<<r||this._construct(e,2*t+this._siblingOffset[r][0],2*i+this._siblingOffset[r][1],o,l+r)}}function vf(e,t,i,r,n,o){return yi(yi(e,i,o),yi(t,r,o),n)}function xf(e,t,i){const r=i.dim,n=f(e*r-.5,0,r-1),o=f(t*r-.5,0,r-1),s=Math.floor(n),a=Math.floor(o),l=Math.min(s+1,r-1),c=Math.min(a+1,r-1);return vf(i.get(s,a),i.get(l,a),i.get(s,c),i.get(l,c),n-s,o-a)}const bf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class wf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i,r=!1,n=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return z(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const o=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=i||"mapbox",this.borderReady=r,!r){for(let e=0;e<o;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(o,e)]=s[this._idx(o-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,o)]=s[this._idx(e,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],n&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new _f(this)}get(e,t,i=!1){i&&(e=f(e,-1,this.dim),t=f(t,-1,this.dim));const r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[r],this.pixels[r+1],this.pixels[r+2])}static getUnpackVector(e){return bf[e]}get unpackVector(){return bf[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,i){return(256*e*256+256*t+i)/10-1e4}_unpackTerrarium(e,t,i){return 256*e+t+i/256-32768}static pack(e,t){const i=[0,0,0,0],r=wf.getUnpackVector(t);let n=Math.floor((e+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new lc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=r;i<n;i++){const r=4*this._idx(i,t),n=4*this._idx(i+a,t+l);this.pixels[r+0]=e.pixels[n+0],this.pixels[r+1]=e.pixels[n+1],this.pixels[r+2]=e.pixels[n+2],this.pixels[r+3]=e.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}zn(wf,"DEMData"),zn(_f,"DemMinMaxQuadTree",{omit:["dem"]});class Tf{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class Sf{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Sf.ReadOnly=!1,Sf.ReadWrite=!0,Sf.disabled=new Sf(519,Sf.ReadOnly,[0,1]);const Cf=7680;class Mf{constructor(e,t,i,r,n,o){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Mf.disabled=new Mf({func:519,mask:0},0,0,Cf,Cf,Cf);class kf{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}kf.Replace=[1,0],kf.disabled=new kf(kf.Replace,yt.transparent,[!1,!1,!1,!1]),kf.unblended=new kf(kf.Replace,yt.transparent,[!0,!0,!0,!0]),kf.alphaBlended=new kf([1,771],yt.transparent,[!0,!0,!0,!0]);const Ef=1029,Af=2305;class If{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}If.disabled=new If(!1,Ef,Af),If.backCCW=new If(!0,Ef,Af),If.backCW=new If(!0,Ef,2304),If.frontCW=new If(!0,1028,2304),If.frontCCW=new If(!0,1028,Af);class zf extends Ve{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Tf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new df,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const t in this._tiles){const i=this._tiles[t];this._source.prepareTile(i)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,i.tileID),i.upload(e),i.prepare(this.map.style.imageManager)}else for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return _(this._tiles).map((e=>e.tileID)).sort(Pf).map((e=>e.key))}getRenderableIds(e){const t=[];for(const i in this._tiles)this._isIdRenderable(+i,e)&&t.push(this._tiles[i]);return e?t.sort(((e,t)=>{const i=e.tileID,r=t.tileID,o=new n(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new n(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):t.map((e=>e.tileID)).sort(Pf).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(e,t,i,r){if(r)if(e.state="errored",404!==r.status)this._source.fire(new Ue(r,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=W.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ne("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,n=Math.floor(i*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(e,t,i){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;let r;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new Mu(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[];const n=this._updateRetainedTiles(r);if(Lf(this._source.type)&&0!==r.length){const e={},t={},i=Object.keys(n);for(const r of i){const i=n[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=W.now())continue;const s=this.findLoadedParent(i,Math.max(i.overscaledZ-zf.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),e[s.tileID.key]=s.tileID),t[r]=i}const o=r[r.length-1].overscaledZ;for(const e in this._tiles){const i=this._tiles[e];if(n[e]||!i.hasData())continue;let r=i.tileID;for(;r.overscaledZ>o;){r=r.scaledTo(r.overscaledZ-1);const o=this._tiles[r.key];if(o&&o.hasData()&&t[r.key]){n[e]=i.tileID;break}}}for(const t in e)n[t]||(this._coveredTiles[t]=!0,n[t]=e[t])}for(const e in n)this._tiles[e].clearFadeHold();const o=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i}(this._tiles,n);for(const e of o){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,o=Math.max(n-zf.maxOverzooming,this._source.minzoom),s=Math.max(n+zf.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||r<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,r,s,t);for(const r of e){let e=this._tiles[r.key];if(e.hasData())continue;if(r.canonical.z>=this._source.maxzoom){const e=r.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=r.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let n=e.wasRequested();for(let s=r.overscaledZ-1;s>=o;--s){const o=r.scaledTo(s);if(i[o.key])break;if(i[o.key]=!0,e=this.getTile(o),!e&&n&&(e=this._addTile(o)),e&&(t[o.key]=o,n=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(e){let t=this._tiles[e.key];if(t)return this._source.prepareTile&&this._source.prepareTile(t),t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const i=Boolean(t);if(!i){const i=this.map?this.map.painter:null;t=new hf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._source.prepareTile&&this._source.prepareTile(t)||this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Ne("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,i){const r=[],n=this.transform;if(!n)return r;const o="globe"===n.projection.name,s=ka(n.center.lng);for(const a in this._tiles){const l=this._tiles[a];if(i&&l.clearQueryDebugViz(),l.holdingForFade())continue;let c;if(o){const e=l.tileID.canonical;if(0===e.z){const t=[Math.abs(f(s,...Df(e,-1))-s),Math.abs(f(s,...Df(e,1))-s)];c=[0,2*t.indexOf(Math.min(...t))-1]}else{const t=[Math.abs(f(s,...Df(e,-1))-s),Math.abs(f(s,...Df(e,0))-s),Math.abs(f(s,...Df(e,1))-s)];c=[t.indexOf(Math.min(...t))-1]}}else c=[0];for(const i of c){const o=e.containsTile(l,n,t,i);o&&r.push(o)}}return r}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(Lf(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=W.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(e,t){const i=new Map,r=Array.isArray(e)?e:[e],n=this.map.painter.terrain,o=this.usedForTerrain&&n?n.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)i.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}y(Array.from(i.values()),((e,t)=>{const i=new hf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),t)}}function Pf(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Lf(e){return"raster"===e||"image"===e||"video"===e}function Df(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}zf.maxOverzooming=10,zf.maxUnderzooming=3;class Rf{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const r=i||e.findDEMTileFor(t);if(!r||!r.dem)return;const n=r.dem,o=r.tileID,s=1<<t.canonical.z-o.canonical.z;return new Rf(r,r.tileSize/ba/s,[(t.canonical.x/s-o.canonical.x)*n.dim,(t.canonical.y/s-o.canonical.y)*n.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),o=Math.floor(i);return new n(r,o)}getElevationAt(e,t,i,r){const n=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],s=Math.floor(n),a=Math.floor(o),l=this._dem;return r=!!r,i?yi(yi(l.get(s,a,r),l.get(s,a+1,r),o-a),yi(l.get(s+1,a,r),l.get(s+1,a+1,r),o-a),n-s):l.get(s,a,r)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Aa(1,e)*this._dem.stride}}class Bf{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new En(ba,16,0),this.featureIndexArray=new Rs,this.promoteId=t}insert(e,t,i,r,n,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,o);const a=this.grid;for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<ba&&r[1]<ba&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new hu.VectorTile(new lh(this.rawTileData)).layers,this.sourceLayerCoder=new Jp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,r){this.loadVTLayers();const n=e.params||{},o=Xr(n.filter),s=e.tileResult,a=e.transform,l=s.bufferedTilespaceBounds,c=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((e,t,i,r)=>rl(s.bufferedTilespaceGeometry,e,t,i,r)));c.sort(Ff);let u=null;a.elevation&&c.length>0&&(u=Rf.create(a.elevation,this.tileID));const h={};let d;for(let a=0;a<c.length;a++){const l=c[a];if(l===d)continue;d=l;const p=this.featureIndexArray.get(l);let f=null;this.loadMatchingFeature(h,p,o,n.layers,n.availableImages,t,i,r,((t,i,r,n=0)=>(f||(f=Ua(t,this.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(s,t,r,f,this.z,e.transform,e.pixelPosMatrix,u,n))))}return h}loadMatchingFeature(e,t,i,r,n,o,s,a,l){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[u];if(r&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=Va(m,!0);if(!i.filter(new zo(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new zo(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let t=0;t<p.length;t++){const i=p[t];if(r&&r.indexOf(i)<0)continue;const u=o[i];if(!u)continue;let h={};void 0!==g&&a&&(h=a.getState(u.sourceLayer||"_geojsonTileLayer",g));const f=v({},s[i]);f.paint=Of(f.paint,u.paint,m,h,n),f.layout=Of(f.layout,u.layout,m,h,n);const y=!l||l(m,u,h,d);if(!y)continue;const _=new ef(m,this.z,this.x,this.y,g);_.layer=f;let x=e[i];void 0===x&&(x=e[i]=[]),x.push({featureIndex:c,feature:_,intersectionZ:y})}}lookupSymbolFeatures(e,t,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=Xr(n);for(const n of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:n,layoutVertexArrayOffset:0},c,o,s,a,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[t])return n[t];const o=this.vtLayers[r].feature(t);return n[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;return this.promoteId&&(i=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof i&&(i=Number(i))),i}}function Of(e,t,i,r,n){return k(e,((e,o)=>{const s=t instanceof jo?t.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function Ff(e,t){return t-e}zn(Bf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class jf{constructor(e){const t={},i=[];for(const r in e){const n=e[r],o=t[r]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?2:1,s={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};i.push(s),o[e]=s}}const{w:r,h:n}=zh(i),o=new ac({width:r||1,height:n||1});for(const i in e){const r=e[i];for(const e in r.glyphs){const n=r.glyphs[+e];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const s=t[i][e],a=n.metrics.localGlyph?2:1;ac.copy(n.bitmap,o,{x:0,y:0},{x:s.x+a,y:s.y+a},n.bitmap)}}this.image=o,this.positions=t}}zn(jf,"GlyphAtlas");class $f{constructor(e){this.tileID=new Mu(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ap(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,i,r,n){this.status="parsing",this.data=e,this.collisionBoxArray=new ks;const o=new Jp(Object.keys(e.layers).sort()),s=new Bf(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},l=new Xp(256,256),c={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:i},u=t.familiesBySource[this.source];for(const t in u){const r=e.layers[t];if(!r)continue;let n=!1,l=!1;for(const e of u[t])"symbol"===e[0].type?n=!0:l=!0;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!l)continue;1===r.version&&z(`Vector tile source "${this.source}" layer "${t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const h=o.encode(t),d=[];for(let e=0;e<r.length;e++){const i=r.feature(e),n=s.getId(i,t);d.push({feature:i,id:n,index:e,sourceLayerIndex:h})}for(const e of u[t]){const t=e[0];void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(Nf(e,this.zoom,i),(a[t.id]=t.createBucket({index:s.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:h,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(d,c,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(e.map((e=>e.id))))}}let h,d,p,f;l.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=k(c.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(g).length?r.send("getGlyphs",{uid:this.uid,stacks:g},((e,t)=>{h||(h=e,d=t,x.call(this))}),void 0,!1,m):d={};const y=Object.keys(c.iconDependencies);y.length?r.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"icons"},((e,t)=>{h||(h=e,p=t,x.call(this))}),void 0,!1,m):p={};const v=Object.keys(c.patternDependencies);function x(){if(h)return n(h);if(d&&p&&f){const e=new jf(d),t=new Lh(p,f);for(const r in a){const n=a[r];n instanceof Op?(Nf(n.layers,this.zoom,i),Td(n,d,e.positions,p,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):n.hasPattern&&(n instanceof Fu||n instanceof Kc||n instanceof _u)&&(Nf(n.layers,this.zoom,i),n.addFeatures(c,this.tileID.canonical,t.patternPositions,i,this.tileTransform))}this.status="done",n(null,{buckets:_(a).filter((e=>!e.isEmpty())),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:t,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}v.length?r.send("getImages",{icons:v,source:this.source,tileID:this.tileID,type:"patterns"},((e,t)=>{h||(h=e,f=t,x.call(this))}),void 0,!1,m):f={},x.call(this)}}function Nf(e,t,i){const r=new zo(t);for(const t of e)t.recalculate(r,i)}class Uf{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,r){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(e,i)}),t):r(e,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,r)}),t):e(i,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==r)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}}function Vf(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=ze(e.request,((e,r,n,o)=>{e?t(e):r&&t(null,{vectorTile:i?void 0:new hu.VectorTile(new lh(r)),rawData:r,cacheControl:n,expires:o})}));return()=>{r.cancel(),t()}}),t)}e.ARRAY_TYPE=dl,e.AUTH_ERR_MSG=re,e.Aabb=Yl,e.Actor=class{constructor(e,i,r){this.target=e,this.parent=i,this.mapId=r,this.callbacks={},this.cancelCallbacks={},C(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=D()?e:t,this.scheduler=new Yp}send(e,t,i,r,n=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=o,this.callbacks[s]=i);const a=O(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:Dn(t,a)},a),{cancel:()=>{i&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||D()){const e=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if("<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(Rn(t.error)):i(null,Rn(t.data)))}else{const i=O(this.globalScope)?void 0:[],r=t.hasCallback?(t,r)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?Dn(t):null,data:Dn(r,i)},i)}:e=>{},n=Rn(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source)[e[1]](n,r)}else r(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},e.CanonicalTileID=Su,e.Color=yt,e.ColorMode=kf,e.CullFaceMode=If,e.DEMData=wf,e.DataConstantProperty=$o,e.DedupedRequest=Uf,e.DepthMode=Sf,e.EXTENT=ba,e.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,r=1<<i,n=Math.floor(e.x),o=Math.floor((e.x-n)*r),s=Math.floor(e.y*r),a=this.findDEMTileFor(new Mu(i,n,i,o,s));return!(!a||!a.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const n=r.getSource().maxzoom,o=1<<n,s=Math.floor(e.x),a=e.x-s,l=new Mu(n,s,n,Math.floor(a*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,h=1<<c.tileID.canonical.z,d=(a*h-c.tileID.canonical.x)*u.dim,p=(e.y*h-c.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*yi(yi(u.get(f,m),u.get(f,m+1),p-m),yi(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const r=1<<e.canonical.z;return this.getAtPointOrZero(new Da(e.wrap+(e.canonical.x+t/ba)/r,(e.canonical.y+i/ba)/r))}getAtTileOffsetFunc(e,t,i,r){return n=>{const o=this.getAtTileOffset(e,n.x,n.y),s=r.upVector(e.canonical,n.x,n.y);return zl(s,s,o*r.upVectorScale(e.canonical,t,i).metersToTile),s}}getForTilePoints(e,t,i,r){const n=Rf.create(this,e,r);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,r=t.tileID,n=1<<e.canonical.z-r.canonical.z;let o=e.canonical.x/n-r.canonical.x,s=e.canonical.y/n-r.canonical.y,a=0;for(let t=0;t<e.canonical.z-r.canonical.z&&!i.leaves[a];t++){o*=2,s*=2;const e=2*Math.floor(s)+Math.floor(o);a=i.childOffsets[a]+e,o%=1,s%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},e.ErrorEvent=Ue,e.EvaluationParameters=zo,e.Event=Ne,e.Evented=Ve,e.FillExtrusionBucket=_u,e.Frustum=Kl,e.FrustumCorners=Xl,e.GLOBE_METERS_TO_ECEF=Od,e.GLOBE_RADIUS=Bd,e.GLOBE_SCALE_MATCH_LATITUDE=45,e.GLOBE_ZOOM_THRESHOLD_MAX=6,e.GLOBE_ZOOM_THRESHOLD_MIN=5,e.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_createGrid(e){const t=new Jo,i=new fs,r=65;for(let e=0;e<r;e++)for(let i=0;i<r;i++)t.emplaceBack(i,e);this._gridSegments=[];for(let e=0,t=0;e<Fd.length;e++){const n=Fd[e];for(let e=0;e<n;e++)for(let t=0;t<64;t++){const n=e*r+t;i.emplaceBack(n+1,n,n+r),i.emplaceBack(n+r,n+r+1,n+1)}const o=64*n*2;this._gridSegments.push(xa.simpleSegment(0,t,(n+1)*r,o)),t+=o}this._gridBuffer=e.createVertexBuffer(t,Rd.members),this._gridIndexBuffer=e.createIndexBuffer(i,!0)}_createPoles(e){const t=new fs;for(let e=0;e<=64;e++)t.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new _s,r=new _s;this._poleSegments=[];for(let e=0,t=0;e<5;e++){const n=1<<e,o=512*n/Math.PI/2,s=360/n;i.emplaceBack(0,-o,0,0,0,.5,0),r.emplaceBack(0,-o,0,0,0,.5,1);for(let e=0;e<=64;e++){const t=e/64,n=yi(0,s,t),[a,l,c]=Hd(np,op,n,o);i.emplaceBack(a,l,c,0,0,t,0),r.emplaceBack(a,l,c,0,0,t,1)}this._poleSegments.push(xa.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Ld,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,Ld,!1)}getGridBuffers(e){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[e]]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const t=new bs,i=64,r=i+1;this._wireframeSegments=[];for(let e=0,n=0;e<Fd.length;e++){const o=Fd[e];for(let e=0;e<o;e++)for(let n=0;n<i;n++){const i=e*r+n;t.emplaceBack(i,i+1),t.emplaceBack(i,i+r),t.emplaceBack(i,i+r+1)}const s=o*i*3;this._wireframeSegments.push(xa.simpleSegment(0,n,(o+1)*r,s)),n+=s}this._wireframeIndexBuffer=e.createIndexBuffer(t)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},e.GlyphManager=cd,e.ImagePosition=Ph,e.LineAtlas=Xp,e.LngLat=Sa,e.LngLatBounds=wa,e.LocalGlyphMode=ld,e.MAX_MERCATOR_LATITUDE=La,e.MercatorCoordinate=Da,e.ONE_EM=Ku,e.OverscaledTileID=Mu,e.Properties=qo,e.RGBAImage=lc,e.Ray=Hl,e.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ie,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!ne(e))return e;const i=ae(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!ne(e))return e;const i=ae(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,r){if(!ne(e))return e;const n=ae(e);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),i&&n.params.push(`language=${i}`),r&&n.params.push(`worldview=${r}`),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,r){const n=ae(e);return ne(e)?(n.path=`/styles/v1${n.path}/sprite${t}${i}`,this._makeAPIURL(n,this._customAccessToken||r)):(n.path+=`${t}${i}`,le(n))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ne(e))return e;const r=ae(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&"raster"!==r.authority&&512===i?"@2x":""}${K.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${X.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${X.TILE_URL_VERSION}${r.path}`);const n=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,n)}canonicalizeTileURL(e,t){const i=ae(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let n=i.params;return t&&(n=n.filter((e=>!e.match(/^access_token=/)))),n.length&&(r+=`?${n.join("&")}`),r}canonicalizeTileset(e,t){const i=!!t&&ne(t),r=[];for(const t of e.tiles||[])oe(t)?r.push(this.canonicalizeTileURL(t,i)):r.push(t);return r}_makeAPIURL(e,t){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=ae(X.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=`${r.path}${e.path}`),!X.REQUIRE_ACCESS_TOKEN)return le(e);if(t=t||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===t[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t||""}`),le(e)}},e.ResourceType=ke,e.SegmentVector=xa,e.SourceCache=zf,e.StencilMode=Mf,e.StructArrayLayout1ui2=ws,e.StructArrayLayout2f1f2i16=hs,e.StructArrayLayout2i4=Jo,e.StructArrayLayout2ui4=bs,e.StructArrayLayout3f12=ps,e.StructArrayLayout3ui6=fs,e.StructArrayLayout4i8=es,e.StructArrayLayout5f20=vs,e.Texture=Hp,e.Tile=hf,e.Transitionable=Do,e.Uniform1f=Ys,e.Uniform1i=class extends Ks{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.Uniform2f=class extends Ks{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.Uniform3f=class extends Ks{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.Uniform4f=Js,e.UniformColor=Qs,e.UniformMatrix2f=class extends Ks{constructor(e,t){super(e,t),this.current=ia}set(e){for(let t=0;t<4;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix2fv(this.location,!1,e);break}}},e.UniformMatrix3f=class extends Ks{constructor(e,t){super(e,t),this.current=ta}set(e){for(let t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}},e.UniformMatrix4f=class extends Ks{constructor(e,t){super(e,t),this.current=ea}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.UnwrappedTileID=Cu,e.ValidationError=$r,e.VectorTileWorkerSource=class extends Ve{constructor(e,t,i,r,n){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=n||Vf,this.loading={},this.loaded={},this.deduped=new Uf(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,r=e&&e.request,n=r&&r.collectResourceTiming,o=this.loading[i]=new $f(e);o.abort=this.loadVectorData(e,((s,a)=>{const l=!this.loading[i];if(delete this.loading[i],l||s||!a)return o.status="done",l||(this.loaded[i]=o),t(s);const c=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new hu.VectorTile(new lh(c));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,((e,i)=>{if(e||!i)return t(e);const o={};if(n){const e=N(r);e.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(e)))}t(null,v({rawTileData:c.slice(0)},i,u,o))}))};this.isSpriteLoaded?h():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()})),this.loaded=this.loaded||{},this.loaded[i]=o}))}reloadTile(e,t){const i=this.loaded,r=e.uid,n=this;if(i&&i[r]){const o=i[r];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=ap(e.tileID.canonical,e.projection);const s=(e,i)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,this.availableImages,n.actor,r)),t(e,i)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}},e.WritingMode=Dh,e.ZoomHistory=Bn,e.add=Ml,e.addDynamicAttributes=Lp,e.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=s*u-a*c,e[1]=n*c-r*u,e[2]=r*a-n*s,e[3]=a*l-o*u,e[4]=i*u-n*l,e[5]=n*o-i*a,e[6]=o*c-s*l,e[7]=r*l-i*c,e[8]=i*s-r*o,e},e.asyncAll=y,e.bezier=d,e.bindAll=C,e.boundsAttributes=cf,e.bufferConvexPolygon=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=g(r-1,-1,e.length-1),o=g(r+1,-1,e.length-1),s=e[r],a=e[o],l=e[n].sub(s).unit(),c=a.sub(s).unit(),u=c.angleWithSep(l.x,l.y),h=l.add(c).unit().mult(-1*t/Math.sin(u/2));i.push(s.add(h))}return i},e.cacheEntryPossiblyAdded=function(e){Me++,Me>xe&&(e.getActor().send("enforceCacheSizeLimit",ve),Me=0)},e.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:r}=e.point,n=ep(i,r,e.worldSize/e._projectionScaler,0,0);return ml(n,n,Qd(qd(t)))},e.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:r,lat:n}=e._center;return ep(t,i,e.worldSize,r,n)},e.calculateGlobeMercatorMatrix=function(e){const t=e.worldSize,i=e.point,r=Aa(1,e.center.lat)*t,n=e.pixelsPerMeter,o=t/(r/e.pixelsPerMeter),s=fl(new Float64Array(16));return gl(s,s,[i.x,i.y,0]),yl(s,s,[o,o,n]),Float32Array.from(s)},e.circumferenceAtLatitude=Ma,e.clamp=f,e.clearTileCache=function(e){const i=[];for(const e in be)i.push(t.caches.delete(e)),delete be[e];e&&Promise.all(i).catch(e).then((()=>e()))},e.clipLine=nd,e.clone=function(e){var t=new dl(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=A,e.collisionCircleLayout=Xu,e.config=X,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new dl(16);return dl!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=pl,e.createExpression=Dr,e.createLayout=Ko,e.createStyleLayer=function(e){return"custom"===e.type?new Gp(e):new Wp[e.type](e)},e.cross=Rl,e.degToRad=l,e.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},e.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},e.dot=Dl,e.ease=p,e.easeCubicInOut=h,e.emitValidationErrors=kn,e.endsWith=M,e.enforceCacheSizeLimit=function(e){for(const t in be)Te(t),be[t].then((t=>{t.keys().then((i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.evaluateSizeForFeature=Qu,e.evaluateSizeForZoom=eh,e.evaluateVariableOffset=wd,e.evented=ko,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.exported=W,e.exported$1=K,e.extend=v,e.extend$1=qe,e.fillExtrusionHeightLift=xu,e.filterObject=E,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i+i,a=r+r,l=n+n,c=i*s,u=r*s,h=r*a,d=n*s,p=n*a,f=n*l,m=o*s,g=o*a,y=o*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return u[t]},e.getAABBPointSquareDist=function(e,t,i){let r=0;for(let n=0;n<2;++n){const o=i?i[n]:0;e[n]>o&&(r+=(e[n]-o)*(e[n]-o)),t[n]<o&&(r+=(o-t[n])*(o-t[n]))}return r},e.getAnchorAlignment=Zh,e.getAnchorJustification=Sd,e.getBounds=function(e){let t=1/0,i=1/0,r=-1/0,o=-1/0;for(const n of e)t=Math.min(t,n.x),i=Math.min(i,n.y),r=Math.max(r,n.x),o=Math.max(o,n.y);return{min:new n(t,i),max:new n(r,o)}},e.getColumn=j,e.getGridMatrix=function(e,t,i){const[r,n]=t,o=.015625;return[0,(n[1]-r[1])*o,1<<e.z,(n[0]-r[0])/Fd[i],0,e.y,r[0],r[1],o]},e.getImage=Fe,e.getJSON=function(e,t){return Ie(v(e,{type:"json"}),t)},e.getLatitudinalLod=function(e){const t=80.051129;e=f(e,-80.051129,t)/t*90;const i=Math.pow(Math.abs(Math.sin(l(e))),3);return Math.round(i*(Fd.length-1))},e.getMapSessionAPI=ge,e.getPerformanceMeasurement=N,e.getProjection=Ep,e.getRTLTextPluginStatus=Eo,e.getReferrer=Ae,e.getTilePoint=function(e,{x:t,y:i},r=0){return new n(((t-r)*e.scale-e.x)*ba,(i*e.scale-e.y)*ba)},e.getTileVec3=function(e,t,i=0){return Cl(((t.x-i)*e.scale-e.x)*ba,(t.y*e.scale-e.y)*ba,Pa(t.z,t.y))},e.getVideo=function(e,i){const r=t.document.createElement("video");r.muted=!0,r.onloadstart=function(){i(null,r)};for(let i=0;i<e.length;i++){const n=t.document.createElement("source");De(e[i])||(r.crossOrigin="Anonymous"),n.src=e[i],r.appendChild(n)}return{cancel:()=>{}}},e.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=fl(new Float64Array(16));return ml(i,e.pixelMatrix,e.globeMatrix),Bl(t,t,i),new n(t[0],t[1])},e.globeECEFOrigin=function(e,t){const i=[0,0,0];return Bl(i,i,Jd(qd(t.canonical))),Bl(i,i,e),i},e.globeNormalizeECEF=Jd,e.globePixelsToTileUnits=function(e,t){return ba/(512*Math.pow(2,e))*Yd(qd(t))},e.globePoleMatrixForTile=function(e,t,i){const r=fl(new Float64Array(16)),n=1<<e,o=360*(t/n-.5),s=i.point,a=i.worldSize/(i.tileSize*n);return gl(r,r,[s.x,s.y,-i.worldSize/Math.PI/2]),yl(r,r,[a,a,a]),_l(r,r,l(-i._center.lat)),vl(r,r,l(-i._center.lng+o)),Float32Array.from(r)},e.globeTileBounds=qd,e.globeTileLatLngCorners=Wd,e.globeTiltAtLngLat=ip,e.globeToMercatorTransition=tp,e.globeUseCustomAntiAliasing=function(e,t,i){const r=tp(i.zoom),n=e.style.map._antialias,o=!!t.extStandardDerivatives,s=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!n&&!s&&o},e.identity=fl,e.identity$1=ql,e.invert=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*s,v=i*l-n*s,x=i*c-o*s,b=r*l-n*a,w=r*c-o*a,T=n*c-o*l,S=u*m-h*f,C=u*g-d*f,M=u*y-p*f,k=h*g-d*m,E=h*y-p*m,A=d*y-p*g,I=_*A-v*E+x*k+b*M-w*C+T*S;return I?(e[0]=(a*A-l*E+c*k)*(I=1/I),e[1]=(n*E-r*A-o*k)*I,e[2]=(m*T-g*w+y*b)*I,e[3]=(d*w-h*T-p*b)*I,e[4]=(l*M-s*A-c*C)*I,e[5]=(i*A-n*M+o*C)*I,e[6]=(g*x-f*T-y*v)*I,e[7]=(u*T-d*x+p*v)*I,e[8]=(s*E-a*M+c*S)*I,e[9]=(r*M-i*E-o*S)*I,e[10]=(f*w-m*x+y*_)*I,e[11]=(h*x-u*w-p*_)*I,e[12]=(a*C-s*k-l*S)*I,e[13]=(i*k-r*C+n*S)*I,e[14]=(m*v-f*b-g*_)*I,e[15]=(u*b-h*v+d*_)*I,e):null},e.isLngLatBehindGlobe=function(e,t){return ip(e,t)>Math.PI/2*1.01},e.isMapAuthenticated=function(e){return ye.has(e)},e.isMapboxURL=ne,e.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!O(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.latFromMercatorY=za,e.len=Nl,e.length=Sl,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=Vf,e.makeRequest=Ie,e.mapValue=function(e,t,i,r,n){return f((e-t)/(i-t)*(n-r)+r,r,n)},e.mercatorXfromLng=ka,e.mercatorYfromLat=Ea,e.mercatorZfromAltitude=Aa,e.mul=bl,e.mul$1=$l,e.multiply=ml,e.multiply$1=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],y=i[5],_=i[6],v=i[7],x=i[8];return e[0]=d*r+p*s+f*c,e[1]=d*n+p*a+f*u,e[2]=d*o+p*l+f*h,e[3]=m*r+g*s+y*c,e[4]=m*n+g*a+y*u,e[5]=m*o+g*l+y*h,e[6]=_*r+v*s+x*c,e[7]=_*n+v*a+x*u,e[8]=_*o+v*l+x*h,e},e.multiply$2=El,e.nextPowerOfTwo=T,e.normalize=Ll,e.normalize$1=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*i+r*r+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=o*s,e},e.number=yi,e.ortho=function(e,t,i,r,n,o,s){var a=1/(t-i),l=1/(r-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(s+o)*c,e[15]=1,e},e.pbf=lh,e.perspective=function(e,t,i,r,n){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(o=1/(r-n)),e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.plugin=Io,e.pointGeometry=n,e.polygonContainsPoint=il,e.polygonIntersectsBox=rl,e.polygonIntersectsPolygon=Wa,e.polygonizeBounds=function(e,t,i=0,r=!0){const o=new n(i,i),s=e.sub(o),a=t.add(o),l=[s,new n(a.x,s.y),a,new n(s.x,a.y)];return r&&l.push(s.clone()),l},e.posAttributes=Rd,e.postMapLoadEvent=fe,e.postTurnstileEvent=de,e.potpack=zh,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=c,e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:To,pluginURL:So}),ko.on("pluginStateChange",e),e},e.removeAuthState=function(e){ye.delete(e)},e.renderColorRamp=uc,e.resample=Ba,e.rotateX=_l,e.rotateX$1=Zl,e.rotateY=vl,e.rotateY$1=Wl,e.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*r,e[1]=s*n+u*r,e[2]=a*n+h*r,e[3]=l*n+d*r,e[4]=c*n-o*r,e[5]=u*n-s*r,e[6]=h*n-a*r,e[7]=d*n-l*r,e},e.rotateZ$1=function(e,t,i){i*=.5;var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=n*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},e.scale=yl,e.scale$1=Ul,e.scale$2=zl,e.scaleAndAdd=Pl,e.setCacheLimits=function(e,t){ve=e,xe=t},e.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.setRTLTextPlugin=function(e,t,i=!1){if(To===vo||To===xo||To===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");So=W.resolveURL(e),To=vo,wo=t,Mo(),i||Ao()},e.smoothstep=m,e.spec=Ge,e.storeAuthState=function(e,t){t?ye.add(e):ye.delete(e)},e.sub=jl,e.subtract=kl,e.symbolSize=th,e.tileAABB=function(e,t,i,r,n,o,s,a,l){if("globe"===l.name)return Zd(e,t,new Su(i,r,n));const c=ap({z:i,x:r,y:n},l);return new Yl([(o+c.x/c.scale)*t,t*(c.y/c.scale),s],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.tileTransform=ap,e.transformMat3=function(e,t,i){var r=t[0],n=t[1],o=t[2];return e[0]=r*i[0]+n*i[3]+o*i[6],e[1]=r*i[1]+n*i[4]+o*i[7],e[2]=r*i[2]+n*i[5]+o*i[8],e},e.transformMat4=Bl,e.transformMat4$1=Vl,e.transformQuat=Ol,e.translate=gl,e.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},e.triggerPluginCompletionEvent=Co,e.uniqueId=b,e.updateGlobeVertexNormal=function(e,t,i,r,n){const o=5*t+2;e.float32[o+0]=i,e.float32[o+1]=r,e.float32[o+2]=n},e.validateCustomStyleLayer=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.validateFilter=e=>Mn(ln(e)),e.validateFog=e=>Mn(vn(e)),e.validateLayer=e=>Mn(pn(e)),e.validateLight=e=>Mn(yn(e)),e.validateSource=e=>Mn(gn(e)),e.validateStyle=Tn,e.validateTerrain=e=>Mn(_n(e)),e.values=_,e.vectorTile=hu,e.version=U,e.warnOnce=z,e.window=t,e.wrap=g})),r(["./shared"],(function(e){function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let i="[";for(const r of e)i+=`${t(r)},`;return`${i}]`}let i="{";for(const r of Object.keys(e).sort())i+=`${r}:${t(e[r])},`;return`${i}}`}function i(i){let r="";for(const n of e.refProperties)r+=`/${t(i[n])}`;return r}class r{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,r){for(const i of t)this._layerConfigs[i.id]=i,(this._layers[i.id]=e.createStyleLayer(i)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const e of r)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const n=function(e,t){const r={};for(let n=0;n<e.length;n++){const o=t&&t[e[n].id]||i(e[n]);t&&(t[e[n].id]=o);let s=r[o];s||(s=r[o]=[]),s.push(e[n])}const n=[];for(const e in r)n.push(r[e]);return n}(e.values(this._layerConfigs),this.keyCache);for(const e of n){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(t)}}}class n{loadTile(t,i){const{uid:r,encoding:n,rawImageData:o,padding:s,buildQuadTree:a}=t,l=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap?this.getImageData(o,s):o;i(null,new e.DEMData(r,l,n,s<1,a))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}var o=function e(t,i){var r,n=t&&t.type;if("FeatureCollection"===n)for(r=0;r<t.features.length;r++)e(t.features[r],i);else if("GeometryCollection"===n)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],i);else if("Feature"===n)e(t.geometry,i);else if("Polygon"===n)s(t.coordinates,i);else if("MultiPolygon"===n)for(r=0;r<t.coordinates.length;r++)s(t.coordinates[r],i);return t};function s(e,t){if(0!==e.length){a(e[0],t);for(var i=1;i<e.length;i++)a(e[i],!t)}}function a(e,t){for(var i=0,r=0,n=0,o=e.length,s=o-1;n<o;s=n++){var a=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!t&&e.reverse()}const l=e.vectorTile.VectorTileFeature.prototype.toGeoJSON;class c{constructor(t){this._feature=t,this.extent=e.EXTENT,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.pointGeometry(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.pointGeometry(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return l.call(this,e,t,i)}}class u{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=t.length,this._features=t}feature(e){return new c(this._features[e])}}var h=e.vectorTile.VectorTileFeature,d=p;function p(e,t){this.options=t||{},this.features=e,this.length=e.length}function f(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}p.prototype.feature=function(e){return new f(this.features[e],this.options.extent)},f.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var i=0;i<t.length;i++){for(var r=t[i],n=[],o=0;o<r.length;o++)n.push(new e.pointGeometry(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=y,g=d;function y(t){var i=new e.pbf;return function(e,t){for(var i in e.layers)t.writeMessage(3,_,e.layers[i])}(t,i),i.finish()}function _(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,v,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var o=r.values;for(i=0;i<o.length;i++)t.writeMessage(4,S,o[i])}function v(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,x,e),t.writeVarintField(3,i.type),t.writeMessage(4,T,i)}function x(e,t){var i=e.feature,r=e.keys,n=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),t.writeVarint(d)}}}function b(e,t){return(t<<3)+(7&e)}function w(e){return e<<1^e>>31}function T(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,s=i.length,a=0;a<s;a++){var l=i[a],c=1;1===r&&(c=l.length),t.writeVarint(b(1,c));for(var u=3===r?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==r&&t.writeVarint(b(2,u-1));var d=l[h].x-n,p=l[h].y-o;t.writeVarint(w(d)),t.writeVarint(w(p)),n+=d,o+=p}3===r&&t.writeVarint(b(7,1))}}function S(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function C(e,t,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;M(e,t,s,r,n,o%2),C(e,t,i,r,s-1,o+1),C(e,t,i,s+1,n,o+1)}function M(e,t,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);M(e,t,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=r,l=n;for(k(e,t,r,i),t[2*n+o]>s&&k(e,t,r,n);a<l;){for(k(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?k(e,t,r,l):(l++,k(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function k(e,t,i,r){E(e,i,r),E(t,2*i,2*r),E(t,2*i+1,2*r+1)}function E(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function A(e,t,i,r){const n=e-i,o=t-r;return n*n+o*o}m.fromVectorTileJs=y,m.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new d(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return y({layers:i})},m.GeoJSONWrapper=g;class I{constructor(e,t,i,r=64,n){this.nodeSize=r,this.points=e;const o=e.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(e.length),a=this.coords=new n(2*e.length);for(let r=0;r<e.length;r++)s[r]=r,a[2*r]=t(e[r]),a[2*r+1]=i(e[r]);C(s,a,r,0,s.length-1,0)}range(e,t,i,r){return function(e,t,i,r,n,o,s){const a=[0,e.length-1,0],l=[];let c,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=s){for(let s=p;s<=d;s++)c=t[2*s],u=t[2*s+1],c>=i&&c<=n&&u>=r&&u<=o&&l.push(e[s]);continue}const f=Math.floor((p+d)/2);c=t[2*f],u=t[2*f+1],c>=i&&c<=n&&u>=r&&u<=o&&l.push(e[f]);const m=(h+1)%2;(0===h?i<=c:r<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?n>=c:o>=u)&&(a.push(f+1),a.push(d),a.push(m))}return l}(this.ids,this.coords,e,t,i,r,this.nodeSize)}within(e,t,i){return function(e,t,i,r,n,o){const s=[0,e.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let n=h;n<=u;n++)A(t[2*n],t[2*n+1],i,r)<=l&&a.push(e[n]);continue}const d=Math.floor((h+u)/2),p=t[2*d],f=t[2*d+1];A(p,f,i,r)<=l&&a.push(e[d]);const m=(c+1)%2;(0===c?i-n<=p:r-n<=f)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?i+n>=p:r+n>=f)&&(s.push(d+1),s.push(u),s.push(m))}return a}(this.ids,this.coords,e,t,i,this.nodeSize)}}const z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},P=Math.fround||(L=new Float32Array(1),e=>(L[0]=+e,L[0]));var L;class D{constructor(e){this.options=U(Object.create(z),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:i,maxZoom:r,nodeSize:n}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;let s=[];for(let t=0;t<e.length;t++)e[t].geometry&&s.push(B(e[t],t));this.trees[r+1]=new I(s,V,G,n,Float32Array),t&&console.timeEnd(o);for(let e=r;e>=i;e--){const i=+Date.now();s=this._cluster(s,e),this.trees[e]=new I(s,V,G,n,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,s.length,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),s=this.getClusters([-180,r,n,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(j(i),$(o),j(n),$(r)),l=[];for(const e of a){const t=s.points[e];l.push(t.numPoints?O(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.points[t];if(!o)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o.x,o.y,s),l=[];for(const t of a){const i=n.points[t];i.parentId===e&&l.push(i.numPoints?O(i):this.points[i.index])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((t-a)/n,l,(t+1+a)/n,c),r.points,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.points,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.points,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_addTileFeatures(e,t,i,r,n,o){for(const s of e){const e=t[s],a=e.numPoints;let l,c,u;if(a)l=F(e),c=e.x,u=e.y;else{const t=this.points[e.index];l=t.properties,c=j(t.geometry.coordinates[0]),u=$(t.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;a?d=e.id:this.options.generateId?d=e.index:this.points[e.index].id&&(d=this.points[e.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}_cluster(e,t){const i=[],{radius:r,extent:n,reduce:o,minPoints:s}=this.options,a=r/(n*Math.pow(2,t));for(let r=0;r<e.length;r++){const n=e[r];if(n.zoom<=t)continue;n.zoom=t;const l=this.trees[t+1],c=l.within(n.x,n.y,a),u=n.numPoints||1;let h=u;for(const e of c){const i=l.points[e];i.zoom>t&&(h+=i.numPoints||1)}if(h>u&&h>=s){let e=n.x*u,s=n.y*u,a=o&&u>1?this._map(n,!0):null;const d=(r<<5)+(t+1)+this.points.length;for(const i of c){const r=l.points[i];if(r.zoom<=t)continue;r.zoom=t;const c=r.numPoints||1;e+=r.x*c,s+=r.y*c,r.parentId=d,o&&(a||(a=this._map(n,!0)),o(a,this._map(r)))}n.parentId=d,i.push(R(e/h,s/h,d,h,a))}else if(i.push(n),h>1)for(const e of c){const r=l.points[e];r.zoom<=t||(r.zoom=t,i.push(r))}}return i}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?U({},e.properties):e.properties;const i=this.points[e.index].properties,r=this.options.map(i);return t&&r===i?U({},r):r}}function R(e,t,i,r,n){return{x:P(e),y:P(t),zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function B(e,t){const[i,r]=e.geometry.coordinates;return{x:P(j(i)),y:P($(r)),zoom:1/0,index:t,parentId:-1}}function O(e){return{type:"Feature",id:e.id,properties:F(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),N(e.y)]}};var t}function F(e){const t=e.numPoints,i=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?Math.round(t/100)/10+"k":t;return U(U({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function j(e){return e/360+.5}function $(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function N(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function U(e,t){for(const i in t)e[i]=t[i];return e}function V(e){return e.x}function G(e){return e.y}function q(e,t,i,r){for(var n,o=r,s=i-t>>1,a=i-t,l=e[t],c=e[t+1],u=e[i],h=e[i+1],d=t+3;d<i;d+=3){var p=Z(e[d],e[d+1],l,c,u,h);if(p>o)n=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(n=d,a=f)}}o>r&&(n-t>3&&q(e,t,n,r),e[n+2]=o,i-n>3&&q(e,n,i,r))}function Z(e,t,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var l=((e-i)*s+(t-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return(s=e-i)*s+(a=t-r)*a}function W(e,t,i,r){var n={id:void 0===e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)H(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var r=0;r<t.length;r++)H(e,t[r]);else if("MultiPolygon"===i)for(r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)H(e,t[r][n])}(n),n}function H(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function X(e,t,i,r){if(t.geometry){var n=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2),a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)K(n,a);else if("MultiPoint"===o)for(var c=0;c<n.length;c++)K(n[c],a);else if("LineString"===o)Y(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(c=0;c<n.length;c++)Y(n[c],a=[],s,!1),e.push(W(l,"LineString",a,t.properties));return}J(n,a,s,!1)}else if("Polygon"===o)J(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)X(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<n.length;c++){var u=[];J(n[c],u,s,!0),a.push(u)}}e.push(W(l,o,a,t.properties))}}function K(e,t){t.push(Q(e[0])),t.push(ee(e[1])),t.push(0)}function Y(e,t,i,r){for(var n,o,s=0,a=0;a<e.length;a++){var l=Q(e[a][0]),c=ee(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=r?(n*c-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(c-o,2))),n=l,o=c}var u=t.length-3;t[2]=1,q(t,0,u,i),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function J(e,t,i,r){for(var n=0;n<e.length;n++){var o=[];Y(e[n],o,i,r),t.push(o)}}function Q(e){return e/360+.5}function ee(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function te(e,t,i,r,n,o,s,a){if(r/=t,o>=(i/=t)&&s<r)return e;if(s<i||o>=r)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===n?u.minX:u.minY,f=0===n?u.maxX:u.maxY;if(p>=i&&f<r)l.push(u);else if(!(f<i||p>=r)){var m=[];if("Point"===d||"MultiPoint"===d)ie(h,m,i,r,n);else if("LineString"===d)re(h,m,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===d)oe(h,m,i,r,n,!1);else if("Polygon"===d)oe(h,m,i,r,n,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var y=[];oe(h[g],y,i,r,n,!0),y.length&&m.push(y)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(W(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(W(u.id,d,m,u.tags))}}}return l.length?l:null}function ie(e,t,i,r,n){for(var o=0;o<e.length;o+=3){var s=e[o+n];s>=i&&s<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function re(e,t,i,r,n,o,s){for(var a,l,c=ne(e),u=0===n?ae:le,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],y=e[d+4],_=0===n?p:f,v=0===n?g:y,x=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<i?v>i&&(l=u(c,p,f,g,y,i),s&&(c.start=h+a*l)):_>r?v<r&&(l=u(c,p,f,g,y,r),s&&(c.start=h+a*l)):se(c,p,f,m),v<i&&_>=i&&(l=u(c,p,f,g,y,i),x=!0),v>r&&_<=r&&(l=u(c,p,f,g,y,r),x=!0),!o&&x&&(s&&(c.end=h+a*l),t.push(c),c=ne(e)),s&&(h+=a)}var b=e.length-3;p=e[b],f=e[b+1],m=e[b+2],(_=0===n?p:f)>=i&&_<=r&&se(c,p,f,m),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&se(c,c[0],c[1],c[2]),c.length&&t.push(c)}function ne(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function oe(e,t,i,r,n,o){for(var s=0;s<e.length;s++)re(e[s],t,i,r,n,o,!1)}function se(e,t,i,r){e.push(t),e.push(i),e.push(r)}function ae(e,t,i,r,n,o){var s=(o-t)/(r-t);return e.push(o),e.push(i+(n-i)*s),e.push(1),s}function le(e,t,i,r,n,o){var s=(o-i)/(n-i);return e.push(t+(r-t)*s),e.push(o),e.push(1),s}function ce(e,t){for(var i=[],r=0;r<e.length;r++){var n,o=e[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)n=ue(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){n=[];for(var a=0;a<o.geometry.length;a++)n.push(ue(o.geometry[a],t))}else if("MultiPolygon"===s)for(n=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(ue(o.geometry[a][c],t));n.push(l)}i.push(W(o.id,s,n,o.tags))}return i}function ue(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function he(e,t){if(e.transformed)return e;var i,r,n,o=1<<e.z,s=e.x,a=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(r=0;r<c.length;r+=2)l.geometry.push(de(c[r],c[r+1],t,o,s,a));else for(r=0;r<c.length;r++){var h=[];for(n=0;n<c[r].length;n+=2)h.push(de(c[r][n],c[r][n+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function de(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function pe(e,t,i,r,n){for(var o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,fe(s,e[a],o,n);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function fe(e,t,i,r){var n=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)s.push(n[a]),s.push(n[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)me(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<n.length;a++)me(s,n[a],e,i,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var c=n[l];for(a=0;a<c.length;a++)me(s,c[a],e,i,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=n.start/n.size,u.mapbox_clip_end=n.end/n.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function me(e,t,i,r,n,o){var s=r*r;if(r>0&&t.size<(n?s:r))i.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>s)&&(i.numSimplified++,a.push(t[l]),a.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,o=n-2;r<n;o=r,r+=2)i+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var s=e[r],a=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=s,e[n-1-r]=a}}(a,o),e.push(a)}}function ge(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)X(i,e.features[r],t,r);else X(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=te(e,1,-1-i,i,0,-1,2,t),o=te(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=te(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=ce(n,1).concat(r)),o&&(r=r.concat(ce(o,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ye(e,t,i){return 32*((1<<e)*i+t)+e}function _e(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);const n=new u(r.features);let o=m(n);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),t(null,{vectorTile:n,rawData:o.buffer})}ge.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ge.prototype.splitTile=function(e,t,i,r,n,o,s){for(var a=[e,t,i,r],l=this.options,c=l.debug;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=ye(t,i,r),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=pe(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,n){if(t===l.maxZoom||t===n)continue;var f=1<<n-t;if(i!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,y,_,v,x,b=.5*l.buffer/l.extent,w=.5-b,T=.5+b,S=1+b;m=g=y=_=null,v=te(e,u,i-b,i+T,0,d.minX,d.maxX,l),x=te(e,u,i+w,i+S,0,d.minX,d.maxX,l),e=null,v&&(m=te(v,u,r-b,r+T,1,d.minY,d.maxY,l),g=te(v,u,r+w,r+S,1,d.minY,d.maxY,l),v=null),x&&(y=te(x,u,r-b,r+T,1,d.minY,d.maxY,l),_=te(x,u,r+w,r+S,1,d.minY,d.maxY,l),x=null),c>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*i,2*r),a.push(g||[],t+1,2*i,2*r+1),a.push(y||[],t+1,2*i+1,2*r),a.push(_||[],t+1,2*i+1,2*r+1)}}},ge.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,o=r.debug;if(e<0||e>24)return null;var s=1<<e,a=ye(e,t=(t%s+s)%s,i);if(this.tiles[a])return he(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,u=t,h=i;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[ye(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?he(this.tiles[a],n):null):null};class ve extends e.VectorTileWorkerSource{constructor(e,t,i,r,n){super(e,t,i,r,_e),n&&(this.loadGeoJSON=n)}loadData(t,i){const r=t&&t.request,n=r&&r.collectResourceTiming;this.loadGeoJSON(t,((s,a)=>{if(s||!a)return i(s);if("object"!=typeof a)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(t.filter){const i=e.createExpression(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=a.features.filter((e=>i.value.evaluate({zoom:0},e)));a={type:"FeatureCollection",features:r}}this._geoJSONIndex=t.cluster?new D(void 0).load(a.features):function(e,t){return new ge(e,t)}(a,t.geojsonVtOptions)}catch(s){return i(s)}this.loaded={};const l={};if(n){const i=e.getPerformanceMeasurement(r);i&&(l.resourceTiming={},l.resourceTiming[t.source]=JSON.parse(JSON.stringify(i)))}i(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.getJSON(t.request,i);else{if("string"!=typeof t.data)return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class xe{constructor(t){this.self=t,this.actor=new e.Actor(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.getProjection({name:"mercator"}),this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:ve},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){this.isSpriteLoaded[t]=i;for(const r in this.workerSources[t]){const n=this.workerSources[t][r];for(const t in n)n[t]instanceof e.VectorTileWorkerSource&&(n[t].isSpriteLoaded=i,n[t].fire(new e.Event("isSpriteLoaded")))}}setImages(e,t,i){this.availableImages[e]=t;for(const i in this.workerSources[e]){const r=this.workerSources[e][i];for(const e in r)r[e].availableImages=t}i()}enableTerrain(e,t,i){this.terrain=t,i()}setProjection(t,i){this.projections[t]=e.getProjection(i)}setLayers(e,t,i){this.getLayerIndex(e).replace(t),i()}updateLayers(e,t,i){this.getLayerIndex(e).update(t.layers,t.removedIds),i()}loadTile(t,i,r){const n=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;n.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).loadTile(n,r)}loadDEMTile(t,i,r){const n=this.enableTerrain?e.extend({buildQuadTree:this.terrain},i):i;this.getDEMWorkerSource(t,i.source).loadTile(n,r)}reloadTile(t,i,r){const n=this.enableTerrain?e.extend({enableTerrain:this.terrain},i):i;n.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,i.type,i.source).reloadTile(n,r)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source).removeTile(t,i)}removeSource(e,t,i){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,r){try{e.plugin.setState(i);const t=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=t){this.self.importScripts(t);const i=e.plugin.isParsed();r(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${t}`),i)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t}getWorkerSource(e,t,i){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][i]||(this.workerSources[e][t][i]=new this.workerSourceTypes[t]({send:(t,i,r,n,o,s)=>{this.actor.send(t,i,r,e,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])),this.workerSources[e][t][i]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new n),this.demWorkerSources[e][t]}enforceCacheSizeLimit(t,i){e.enforceCacheSizeLimit(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xe(self)),xe})),r(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i}var i=r;function r(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===n[t=e&&e.failIfMajorPerformanceCaveat]&&(n[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(r.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl",i)||t.getContext("experimental-webgl",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),n[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var n={};function o(t,i,r){const n=e.window.document.createElement(t);return void 0!==i&&(n.className=i),r&&r.appendChild(n),n}function s(t,i,r){const n=e.window.document.createElementNS("http://www.w3.org/2000/svg",t);for(const e of Object.keys(i))n.setAttributeNS(null,e,i[e]);return r&&r.appendChild(n),n}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=e.window.document&&e.window.document.documentElement.style,l=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let c;function u(){a&&l&&(c=a[l],a[l]="none")}function h(){a&&l&&(a[l]=c)}function d(t){t.preventDefault(),t.stopPropagation(),e.window.removeEventListener("click",d,!0)}function p(){e.window.addEventListener("click",d,!0),e.window.setTimeout((()=>{e.window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return y(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),r=[];for(let n=0;n<t.length;n++)r.push(y(e,i,t[n]));return r}function g(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function y(t,i,r){const n=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.pointGeometry((r.clientX-i.left)*n,(r.clientY-i.top)*n)}function _(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=i*o-n*r;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-n*s,e[3]=i*s,e):null}function v(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class x extends e.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new e.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(t,i){const r={};for(const i of t){this.images[i]||this.fire(new e.Event("styleimagemissing",{id:i}));const t=this.images[i];t?r[i]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(t){const i=this.patterns[t],r=this.getImage(t);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const e in this.patterns)t.push(this.patterns[e].bin);const{w:i,h:r}=e.potpack(t),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const t in this.patterns){const{bin:i}=this.patterns[t],r=i.x+1,o=i.y+1,s=this.images[t].data,a=s.width,l=s.height;e.RGBAImage.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),e.RGBAImage.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),e.RGBAImage.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),e.RGBAImage.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),e.RGBAImage.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e){if(this.callbackDispatchedThisFrame[t])continue;this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];v(e)&&this.updateImage(t,e)}}}const b=new e.Properties({anchor:new e.DataConstantProperty(e.spec.light.anchor),position:new class{constructor(){this.specification=e.spec.light.position}possiblyEvaluate(t,i){return function([t,i,r]){const n=e.degToRad(i+90),o=e.degToRad(r);return{x:t*Math.cos(n)*Math.sin(o),y:t*Math.sin(n)*Math.sin(o),z:t*Math.cos(o),azimuthal:i,polar:r}}(t.expression.evaluate(i))}interpolate(t,i,r){return{x:e.number(t.x,i.x,r),y:e.number(t.y,i.y,r),z:e.number(t.z,i.z,r),azimuthal:e.number(t.azimuthal,i.azimuthal,r),polar:e.number(t.polar,i.polar,r)}}},color:new e.DataConstantProperty(e.spec.light.color),intensity:new e.DataConstantProperty(e.spec.light.intensity)}),w="-transition";class T extends e.Evented{constructor(t){super(),this._transitionable=new e.Transitionable(b),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,i={}){if(!this._validate(e.validateLight,t,i))for(const i in t){const r=t[i];e.endsWith(i,w)?this._transitionable.setTransition(i.slice(0,-w.length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}const S=new e.Properties({source:new e.DataConstantProperty(e.spec.terrain.source),exaggeration:new e.DataConstantProperty(e.spec.terrain.exaggeration)}),C="-transition";class M extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(S),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t){for(const i in t){const r=t[i];e.endsWith(i,C)?this._transitionable.setTransition(i.slice(0,-C.length),r):this._transitionable.setValue(i,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function k(t,i,r,n){const o=e.smoothstep(45,65,r),[s,a]=E(t,n),l=e.length(i);let c=1-Math.min(1,Math.exp((l-s)/(a-s)*-6));return c*=c*c,c=Math.min(1,1.00747*c),c*o*t.alpha}function E(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}const A=new e.Properties({range:new e.DataConstantProperty(e.spec.fog.range),color:new e.DataConstantProperty(e.spec.fog.color),"high-color":new e.DataConstantProperty(e.spec.fog["high-color"]),"space-color":new e.DataConstantProperty(e.spec.fog["space-color"]),"horizon-blend":new e.DataConstantProperty(e.spec.fog["horizon-blend"]),"star-intensity":new e.DataConstantProperty(e.spec.fog["star-intensity"])}),I="-transition";class z extends e.Evented{constructor(t,i){super(),this._transitionable=new e.Transitionable(A),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=i}get state(){const t=this._transform,i="globe"===t.projection.name,r=e.globeToMercatorTransition(t.zoom),n=this.properties.get("range"),o=[.5,3];return{range:i?[e.number(o[0],n[0],r),e.number(o[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i={}){if(!this._validate(e.validateFog,t,i)){for(const i of Object.keys(e.spec.fog))t&&void 0===t[i]&&(t[i]=e.spec.fog[i].default);for(const i in t){const r=t[i];e.endsWith(i,I)?this._transitionable.setTransition(i.slice(0,-I.length),r):this._transitionable.setValue(i,r)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.smoothstep(45,65,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,r){const n=e.MercatorCoordinate.fromLngLat(i),o=r.elevation?r.elevation.getAtPointOrZero(n):0,s=[n.x,n.y,o];return e.transformMat4(s,s,r.mercatorFogMatrix),k(t,s,r.pitch,r._fov)}(this.state,t,i):0}getFovAdjustedRange(e){return this._transform.projection.supportsFog?E(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.spec})))}}class P{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=e.uniqueId();const r=this.workerPool.acquire(this.id);for(let e=0;e<r.length;e++){const t=new P.Actor(r[e],i,this.id);t.name=`Worker ${e}`,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,i,r){e.asyncAll(this.actors,((e,r)=>{e.send(t,i,r)}),r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}function L(t,i,r){return i*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}P.Actor=e.Actor;class D{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.pointGeometry||"number"==typeof t[0]){const o=e.pointGeometry.convert(t);r=[e.pointGeometry.convert(t)],n=i.isPointAboveHorizon(o)}else{const o=e.pointGeometry.convert(t[0]),s=e.pointGeometry.convert(t[1]);r=[o,s],n=e.polygonizeBounds(o,s).every((e=>i.isPointAboveHorizon(e)))}return new D(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],n=e.polygonizeBounds(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),e.bufferConvexPolygon(n,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.pointGeometry(1,1)):this.screenBounds[1],n=e.polygonizeBounds(i,r,t),o=this.cameraPoint.clone();switch(3*((o.y>i.y)+(o.y>r.y))+((o.x>i.x)+(o.x>r.x))){case 0:n[0]=o,n[4]=o.clone();break;case 1:n.splice(1,0,o);break;case 2:n[1]=o;break;case 3:n.splice(4,0,o);break;case 5:n.splice(2,0,o);break;case 6:n[3]=o;break;case 7:n.splice(3,0,o);break;case 8:n[2]=o}return n}containsTile(t,i,r,n=0){const o=t.queryPadding/i._projectionScaler+1,s=r?this._bufferedCameraMercator(o,i):this._bufferedScreenMercator(o,i);let a=t.tileID.wrap+(s.unwrapped?n:0);const l=s.polygon.map((i=>e.getTilePoint(t.tileTransform,i,a)));if(!e.polygonIntersectsBox(l,0,0,e.EXTENT,e.EXTENT))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>e.getTileVec3(t.tileTransform,i,a))),u=c.map((t=>new e.pointGeometry(t[0],t[1]))),h=i.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),d=e.getTileVec3(t.tileTransform,h,a),p=c.map((t=>{const i=e.sub(t,t,d);return e.normalize(i,i),new e.Ray(d,i)})),f=L(t,1,i.zoom)*i._projectionScaler;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.getBounds(l),m.min.x=e.clamp(m.min.x,0,e.EXTENT),m.min.y=e.clamp(m.min.y,0,e.EXTENT),m.max.x=e.clamp(m.max.x,0,e.EXTENT),m.max.y=e.clamp(m.max.y,0,e.EXTENT),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=O(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=O(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,i){const r=function(t,i){const r=e.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-e.GLOBE_RADIUS,0,1],o=[0,e.GLOBE_RADIUS,0,1],s=[0,0,0,1];e.transformMat4$1(n,n,r),e.transformMat4$1(o,o,r),e.transformMat4$1(s,s,r);const a=new e.pointGeometry(n[0]/n[3],n[1]/n[3]),l=new e.pointGeometry(o[0]/o[3],o[1]/o[3]),c=e.polygonContainsPoint(t,a)&&n[3]<s[3],u=e.polygonContainsPoint(t,l)&&o[3]<s[3];if(!c&&!u)return null;const h=function(e,t,i){for(let r=1;r<e.length;r++){const n=B(t.pointCoordinate3D(e[r-1]).x),o=B(t.pointCoordinate3D(e[r]).x);if(i<0){if(n<o)return{idx:r,t:-n/(o-1-n)}}else if(o<n)return{idx:r,t:(1-n)/(o+1-n)}}return null}(t,i,c?-1:1);if(!h)return null;const{idx:d,t:p}=h;let f=d>1?R(t.slice(0,d),i):[],m=d<t.length?R(t.slice(d),i):[];f=f.map((t=>new e.pointGeometry(B(t.x),t.y))),m=m.map((t=>new e.pointGeometry(B(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const y=e.number(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let _;return _=c?[new e.pointGeometry(0,y),new e.pointGeometry(0,0),new e.pointGeometry(1,0),new e.pointGeometry(1,y)]:[new e.pointGeometry(1,y),new e.pointGeometry(1,1),new e.pointGeometry(0,1),new e.pointGeometry(0,y)],g.push(..._),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:!1}}(t,i);if(r)return r;const n=function(t,i){let r=!1,n=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const i=(o+e)%(t.length-1),n=t[i],s=t[i+1];Math.abs(n.x-s.x)>.5&&(n.x<s.x?(n.x+=1,0===i&&(t[t.length-1].x+=1)):(s.x+=1,i+1===t.length-1&&(t[0].x+=1)),r=!0)}const s=e.mercatorXfromLng(i.center.lng);return r&&s<Math.abs(s-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:r}}(R(t,i).map((t=>new e.pointGeometry(B(t.x),t.y))),i);return{polygon:n.polygon.map((t=>new e.MercatorCoordinate(t.x,t.y))),unwrapped:n.unwrapped}}}function R(t,i){return e.resample(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function B(e){return e<0?1+e%1:e%1}function O(e){return 100*e|0}function F(t,i,r,n,o){const s=function(r,n){if(r)return o(r);if(n){const r=e.pick(e.extend(n,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),n.language_options&&(r.languageOptions=n.language_options),n.language&&n.language[n.id]&&(r.language=n.language[n.id]),n.worldview_options&&(r.worldviewOptions=n.worldview_options),n.worldview?r.worldview=n.worldview[n.id]:n.worldview_default&&(r.worldview=n.worldview_default),r.tiles=i.canonicalizeTileset(r,t.url),o(null,r)}};return t.url?e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url,null,r,n),e.ResourceType.Source),s):e.exported.frame((()=>s(null,t)))}class j{constructor(t,i,r){this.bounds=e.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*i),n=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*i),o=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*i),s=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*i);return t.x>=r&&t.x<o&&t.y>=n&&t.y<s}}class ${constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const N={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class U{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[N[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class V{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class G extends V{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class q extends V{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Z extends V{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class W extends V{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class H extends V{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class X extends V{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class K extends V{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Y extends V{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class J extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Q extends V{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ee extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class te extends V{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ie extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class re extends V{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ne extends V{getDefault(){return e.Color.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class oe extends V{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class se extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ae extends V{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class le extends V{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ce extends V{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ue extends V{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class he extends V{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class de extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class pe extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fe extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class me extends V{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ge extends V{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ye extends V{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class _e extends V{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ve extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class xe extends V{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class be extends V{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class we extends be{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Te extends be{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Se extends Te{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ce{constructor(e,t,i,r){this.context=e,this.width=t,this.height=i;const n=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new we(e,n),r&&(this.depthAttachment=new Te(e,n))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Me{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new q(this),this.clearStencil=new Z(this),this.colorMask=new W(this),this.depthMask=new H(this),this.stencilMask=new X(this),this.stencilFunc=new K(this),this.stencilOp=new Y(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new ee(this),this.depthFunc=new te(this),this.blend=new ie(this),this.blendFunc=new re(this),this.blendColor=new ne(this),this.blendEquation=new oe(this),this.cullFace=new se(this),this.cullFaceSide=new ae(this),this.frontFace=new le(this),this.program=new ce(this),this.activeTexture=new ue(this),this.viewport=new he(this),this.bindFramebuffer=new de(this),this.bindRenderbuffer=new pe(this),this.bindTexture=new fe(this),this.bindVertexBuffer=new me(this),this.bindElementBuffer=new ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ye(this),this.pixelStoreUnpack=new _e(this),this.pixelStoreUnpackPremultiplyAlpha=new ve(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new $(this,e,t)}createVertexBuffer(e,t,i){return new U(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i){return new Ce(this,e,t,i)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t(i.blendFunction,e.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ke extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.extend({type:"raster"},i),e.extend(this,e.pick(i,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=F(this._options,this.map._requestManager,null,null,((t,i)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(e.extend(this,i),i.bounds&&(this.tileBounds=new j(i.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(i.tiles),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.exported.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(n,e.ResourceType.Tile),((r,n,o,s)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):r?(t.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s}),t.setTexture(n,this.map.painter),t.state="loaded",e.cacheEntryPossiblyAdded(this.dispatcher),void i(null)):i(null))))}static loadTileData(e,t,i){e.setTexture(t,i)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}}let Ee;function Ae(t,i,r,n,o,s,a,l){const c=[t,r,o,i,n,s,1,1,1],u=[a,l,1],h=e.adjoint([],c),[d,p,f]=e.transformMat3(u,u,e.transpose(h,h));return e.multiply$1(c,[d,0,0,0,p,0,0,0,f],c)}class Ie extends e.Evented{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(t,i){this._loaded=i||!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),((i,r)=>{if(this._loaded=!0,i)this.fire(new e.ErrorEvent(i));else if(r){const{HTMLImageElement:i}=e.window;this.image=r instanceof i?e.exported.getImageData(r):r,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}}))}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const i=t.map(e.MercatorCoordinate.fromLngLat);return this.tileID=function(t){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const e of t)i=Math.min(i,e.x),r=Math.min(r,e.y),n=Math.max(n,e.x),o=Math.max(o,e.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new e.CanonicalTileID(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray)return;const i=e.tileTransform(this.tileID,this.map.transform.projection),[r,n,o,s]=this.coordinates.map((t=>{const r=i.projection.project(t[0],t[1]);return e.getTilePoint(i,r)._round()}));this.perspectiveTransform=function(t,i,r,n,o,s,a,l,c,u){const h=Ae(0,0,t,0,0,i,t,i),d=Ae(r,n,o,s,a,l,c,u);return e.multiply$1(d,e.adjoint(h,h),d),[d[6]/d[8]*t/e.EXTENT,d[7]/d[8]*i/e.EXTENT]}(this.width,this.height,r.x,r.y,n.x,n.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new e.StructArrayLayout4i8;a.emplaceBack(r.x,r.y,0,0),a.emplaceBack(n.x,n.y,e.EXTENT,0),a.emplaceBack(s.x,s.y,0,e.EXTENT),a.emplaceBack(o.x,o.y,e.EXTENT,e.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(a,e.boundsAttributes.members),this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,i=t.gl;this.texture?this.texture.update(this.image):(this.texture=new e.Texture(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ze={vector:class extends e.Evented{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.extend(this,e.pick(i,["url","scheme","tileSize","promoteId"])),this._options=e.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.DedupedRequest}load(t){this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,r=this.worldview||this.map._worldview;this._tileJSONRequest=F(this._options,this.map._requestManager,i,r,((n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),r&&2!==r.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new e.ErrorEvent(n))):o&&(e.extend(this,o),o.bounds&&(this.tileBounds=new j(o.bounds,this.minzoom,this.maxzoom)),e.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load((()=>{const e=this.map.style._getSourceCaches(this.id);for(const t of e)t.clearTiles()}))}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}_setLanguage(e){return e===this.language||this.setSourceProperty((()=>{this.language=e})),this}_setWorldview(e){return e===this.worldview?this:this.worldviewOptions&&e&&!this.worldviewOptions[e]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${e}".`),this):(this.setSourceProperty((()=>{this.worldview=e})),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return e.extend({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",n,o.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,o.bind(this),void 0,!0);else{const i=e.loadVectorTile.call({deduped:this._deduped},n,((e,i)=>{e||!i?o.call(this,e):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,o.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function o(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ke,"raster-dem":class extends ke{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,o,s,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:a});const i=e.window.ImageBitmap&&o instanceof e.window.ImageBitmap&&(null==Ee&&(Ee=e.window.OffscreenCanvas&&new e.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof e.window.createImageBitmap),Ee),r=1-(o.width-e.prevPowerOfTwo(o.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?o:e.exported.getImageData(o,r),c={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?t.wrap-1:t.wrap,s=(i.x+1+r)%r,a=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.OverscaledTileID(t.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const o=e.EXTENT/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:e.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*o,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.Event("dataloading",{dataType:"source"})),this._loaded=!1;const t=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(t.request=this.map._requestManager.transformRequest(e.exported.resolveURL(i),e.ResourceType.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((t,i)=>{if(this._loaded=!0,this._pendingLoad=null,t)this.fire(new e.ErrorEvent(t));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(t.resourceTiming=i.resourceTiming[this.id]),this.fire(new e.Event("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(r,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},((e,n)=>(delete t.request,t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ie{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.ResourceType.Source).url);e.getVideo(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.ErrorEvent(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ie,canvas:class extends Ie{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.Evented{constructor(t,i,r,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new j(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.extend(this,e.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const{x:r,y:n,z:o}=t.tileID.canonical,s=new e.window.AbortController,a=this._implementation.loadTile({x:r,y:n,z:o},{signal:s.signal});if(!a)return this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null);a.cancel=()=>s.abort(),t.request=a.then(function(r){return delete t.request,t.aborted?(t.state="unloaded",i(null)):r?function(t){return t instanceof e.window.ImageData||t instanceof e.window.ImageBitmap||t instanceof e.window.HTMLCanvasElement}(r)?(this.loadTileData(t,r),t.state="loaded",void i(null)):(t.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",i(null))}.bind(this)).catch((e=>{20!==e.code&&(t.state="errored",i(e))}))}loadTileData(e,t){ke.loadTileData(e,t,this._map.painter)}unloadTileData(e){ke.unloadTileData(e,this._map.painter)}prepareTile(e){if(!this._implementation.prepareTile)return null;const{x:t,y:i,z:r}=e.tileID.canonical,n=this._implementation.prepareTile({x:t,y:i,z:r});return n?(this.loadTileData(e,n),e.state="loaded",n):null}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:i,z:r}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:r})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_update(){this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Pe=function(t,i,r,n){const o=new ze[i.type](t,i,r,n);if(o.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${o.id}`);return e.bindAll(["load","abort","unload","serialize","prepare"],o),o};function Le(t,i){const r=e.identity([]);return e.scale(r,r,[.5*t.width,.5*-t.height,1]),e.translate(r,r,[1,-1,0]),e.multiply(r,r,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function De(e,t,i,r,n,o,s,a=!1){const l=e.tilesIn(r,s,a);l.sort(Be);const c=[];for(const r of l)c.push({wrappedTileID:r.tile.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,i,e._state,r,n,o,Le(e.transform,r.tile.tileID),a)});const u=function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in e){const r=e[i],n=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const i=t.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(r["source-layer"],i.id):{})}));return u}function Re(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,t))}return r}function Be(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function Oe(){return null!=uo.workerClass?new uo.workerClass:new e.window.Worker(uo.workerUrl)}const Fe="mapboxgl_preloaded_worker_pool";class je{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<je.workerCount;)this.workers.push(new Oe);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Fe]}numActive(){return Object.keys(this.active).length}}let $e;function Ne(){return $e||($e=new je),$e}function Ue(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.refProperties.forEach((e=>{e in i&&(r[e]=i[e])})),r}function Ve(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Ue(e[i],t[e[i].ref]));return e}je.workerCount=2;const Ge={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qe(e,t,i){i.push({command:Ge.addSource,args:[e,t[e]]})}function Ze(e,t,i){t.push({command:Ge.removeSource,args:[e]}),i[e]=!0}function We(e,t,i,r){Ze(e,i,r),qe(e,t,i)}function He(e,i,r){let n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;return!0}function Xe(e,i,r,n,o,s){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t(e[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t(e[a],i[a])||r.push({command:s,args:[n,a,i[a],o]}))}function Ke(e){return e.id}function Ye(e,t){return e[t.id]=t,e}class Je{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}class Qe{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const s=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)s.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];s.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return o?s.filter(o):s}return this._forEachCell(e,t,i,r,this._queryCell,s,{hitTest:n,seenUids:{box:{},circle:{}}},o),n?s.length>0:s}_queryCircle(e,t,i,r,n){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!r&&[];const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,o,s,a){const l=s.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=n[c+2]&&t<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const u=this.circleCells[n];if(null!==u){const n=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(n[u],n[u+1],n[u+2],e,t,i,r)&&(!a||a(this.circleKeys[c]))){if(s.hitTest)return o.push(!0),!0;{const e=n[u],t=n[u+1],i=n[u+2];o.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,o,s,a){const l=s.circle,c=s.seenUids,u=this.boxCells[n];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return o.push(!0),!0}}const h=this.circleCells[n];if(null!==h){const e=this.circles;for(const t of h)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){const s=r-e,a=n-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(t-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}const et=Math.tan(85*Math.PI/180);function tt(t,i,r,n,o,s,a){const l=e.create();if(r)if("globe"===s.name){const t=e.calculateGlobeLabelMatrix(o,i);e.multiply(l,l,t)}else{const t=_([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.rotateZ(l,l,o.angle)}else e.multiply(l,o.labelPlaneMatrix,t);return l}function it(e,t,i,r,n,o,s){const a=tt(e,t,i,r,n,o,s);return"globe"===o.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function rt(t,i,r,n,o,s,a){if(r){if("globe"===s.name){const l=tt(t,i,r,n,o,s,a);return e.invert(l,l),e.multiply(l,t,l),l}{const i=e.clone(t),r=e.identity([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],e.multiply(i,i,r),n||e.rotateZ(i,i,-o.angle),i}}return o.glCoordMatrix}function nt(t,i,r=0){const n=[t.x,t.y,r,1];r?e.transformMat4$1(n,n,i):yt(n,n,i);const o=n[3];return{point:[n[0]/o,n[1]/o,n[2]/o],signedDistanceFromCamera:o}}function ot(t,i){const r=[t[0],t[1],t[2],1];e.transformMat4$1(r,r,i);const n=r[3];return{point:[r[0]/n,r[1]/n,r[2]/n],signedDistanceFromCamera:n}}function st(e,t){return Math.min(.5+e/t*.5,1.5)}function at(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function lt(t,i,r,n,o,s,a,l,c,u){const h=r.transform,d=n?t.textSizeData:t.iconSizeData,p=e.evaluateSizeForZoom(d,r.transform.zoom),f="globe"===h.projection.name,m=[256/r.width*2+1,256/r.height*2+1],g=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let y=null;f&&(y=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,v=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=r.transform.width/r.transform.height;let b=!1;for(let n=0;n<v.length;n++){const f=v.get(n);if(f.writingMode!==e.WritingMode.vertical||b||0!==n&&v.get(n-1).writingMode===e.WritingMode.horizontal||(b=!0),(f.hidden||f.writingMode===e.WritingMode.vertical)&&!b){gt(f.numGlyphs,g);continue}b=!1;const w=new e.pointGeometry(f.tileAnchorX,f.tileAnchorY),T=c?c(w):[0,0,0],S=h.projection.projectTilePoint(w.x,w.y,u.canonical),C=[S.x+T[0],S.y+T[1],S.z+T[2]],M=[...C,1];if(e.transformMat4$1(M,M,i),!at(M,m)){gt(f.numGlyphs,g);continue}const k=st(r.transform.cameraToCenterDistance,M[3]),E=e.evaluateSizeForFeature(d,p,f),A=a?E/k:E*k,I=nt(new e.pointGeometry(C[0],C[1]),o,C[2]);if(I.signedDistanceFromCamera<=0){gt(f.numGlyphs,g);continue}let z={};const P=a?null:c,L=ht(f,A,!1,l,i,o,s,t.glyphOffsetArray,_,g,y,I.point,w,z,x,P,h.projection,u,a);b=L.useVertical,P&&L.needsFlipping&&(z={}),(L.notEnoughRoom||b||L.needsFlipping&&ht(f,A,!0,l,i,o,s,t.glyphOffsetArray,_,g,y,I.point,w,z,x,P,h.projection,u,a).notEnoughRoom)&&gt(f.numGlyphs,g)}n?(t.text.dynamicLayoutVertexBuffer.updateData(g),y&&t.text.globeExtVertexBuffer.updateData(y)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),y&&t.icon.globeExtVertexBuffer.updateData(y))}function ct(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=a.glyphStartIndex+a.numGlyphs,y=a.lineStartIndex,_=a.lineStartIndex+a.lineLength,v=t.getoffsetX(a.glyphStartIndex),x=t.getoffsetX(g-1),b=ft(e*v,i,r,n,o,s,a.segment,y,_,l,c,u,h,d,!0,p,f,m);if(!b)return null;const w=ft(e*x,i,r,n,o,s,a.segment,y,_,l,c,u,h,d,!0,p,f,m);return w?{first:b,last:w}:null}function ut(t,i,r,n){return t.writingMode===e.WritingMode.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:t.writingMode===e.WritingMode.vertical?i.y<r.y?{needsFlipping:!0}:null:0!==t.flipState&&function(e,t,i){const r=(t.x-e.x)*i;return 0===r||Math.abs((t.y-e.y)/r)>et}(i,r,n)?1===t.flipState?{needsFlipping:!0}:null:i.x>r.x?{needsFlipping:!0}:null}function ht(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v){const x=i/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x;let T;if(t.numGlyphs>1){const i=t.glyphStartIndex+t.numGlyphs,o=t.lineStartIndex,u=t.lineStartIndex+t.lineLength,h=ct(x,l,b,w,r,d,p,t,c,s,f,g,!1,y,_,v);if(!h)return{notEnoughRoom:!0};const S=ot(h.first.point,a).point,C=ot(h.last.point,a).point,M=new e.pointGeometry(S[0],S[1]),k=new e.pointGeometry(C[0],C[1]);if(n&&!r){const e=ut(t,M,k,m);if(t.flipState=e&&e.needsFlipping?1:2,e)return e}T=[h.first];for(let e=t.glyphStartIndex+1;e<i-1;e++)T.push(ft(x*l.getoffsetX(e),b,w,r,d,p,t.segment,o,u,c,s,f,g,!1,!1,y,_,v));T.push(h.last)}else{if(n&&!r){const i=nt(p,o).point,r=t.lineStartIndex+t.segment+1,n=new e.pointGeometry(c.getx(r),c.gety(r)),s=nt(n,o),a=s.signedDistanceFromCamera>0?s.point:pt(p,n,i,1,o,void 0,y,_.canonical),l=ut(t,new e.pointGeometry(i[0],i[1]),new e.pointGeometry(a[0],a[1]),m);if(t.flipState=l&&l.needsFlipping?1:2,l)return l}const i=ft(x*l.getoffsetX(t.glyphStartIndex),b,w,r,d,p,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,c,s,f,g,!1,!1,y,_,v);if(!i)return{notEnoughRoom:!0};T=[i]}if(h)for(const t of T)e.updateGlobeVertexNormal(h,u.length+0,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+1,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+2,t.up[0],t.up[1],t.up[2]),e.updateGlobeVertexNormal(h,u.length+3,t.up[0],t.up[1],t.up[2]),e.addDynamicAttributes(u,t.point[0],t.point[1],t.point[2],t.angle);else for(const t of T)e.addDynamicAttributes(u,t.point[0],t.point[1],t.point[2],t.angle);return{}}function dt(t,i,r,n,o){const s=n.projectTilePoint(t.x,t.y,i);if(!o)return nt(s,r,s.z);const a=o(t);return nt(new e.pointGeometry(s.x+a[0],s.y+a[1]),r,s.z+a[2])}function pt(t,i,r,n,o,s,a,l){const c=dt(t.add(t.sub(i)._unit()),l,o,a,s).point,u=e.sub([],r,c);return e.scaleAndAdd([],r,u,n/e.length(u))}function ft(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=n?t-i:t+i;let x=v>0?1:-1,b=0;n&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=x>0?l+a:l+a+1,T=o,S=o,C=0,M=0;const k=Math.abs(v),E=[],A=[];let I=s;const z=()=>{const t=w-x;return 0===C?s:new e.pointGeometry(u.getx(t),u.gety(t))},P=()=>pt(z(),I,S,k-C+1,h,p,g,y.canonical);for(;C+M<=k;){if(w+=x,w<l||w>=c)return null;if(S=T,E.push(T),f&&A.push(I||z()),T=d[w],void 0===T){I=new e.pointGeometry(u.getx(w),u.gety(w));const t=dt(I,y.canonical,h,g,p);T=t.signedDistanceFromCamera>0?d[w]=t.point:P()}else I=null;C+=M,M=e.distance(S,T)}I=I||new e.pointGeometry(u.getx(w),u.gety(w));const L=z();m&&p&&(d[w]=T=void 0===d[w]?T:P(),M=e.distance(S,T));const D=(k-C)/M,R=I.sub(L).mult(D)._add(L),B=e.sub([],T,S),O=e.scaleAndAdd([],S,B,D);let F=[0,0,1],j=B[0],$=B[1];if(_&&(F=g.upVector(y.canonical,R.x,R.y),0!==F[0]||0!==F[1]||1!==F[2])){const t=[1,0,0],i=[0,1,0];t[0]=F[2],t[1]=0,t[2]=-F[0],e.cross(i,F,t),e.normalize(t,t),e.normalize(i,i),j=e.dot(B,t),$=e.dot(B,i)}if(r){const t=e.cross([],F,B);e.normalize(t,t),e.scaleAndAdd(O,O,t,r*x)}const N=b+Math.atan2($,j);return E.push(O),f&&A.push(R),{point:O,angle:N,path:E,tilePath:A,up:F}}const mt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gt(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(mt,4*e)}}function yt(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const _t=100;class vt{constructor(e,t,i=new Qe(e.width+200,e.height+200,25),r=new Qe(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+_t,this.screenBottomBoundary=e.height+_t,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,o,s,a){let l=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const h=i.elevation,d=i.tileID;if(h&&d){const t=e.getProjection().upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),r=e.getProjection().upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=t[0]*h*r,c+=t[1]*h*r,u+=t[2]*h*r}const p=this.projectAndGetPerspectiveRatio(s,[l,c,u],i.tileID,"globe"===e.projection.name||!!h||this.transform.pitch>0,e.getProjection()),f=o*p.perspectiveRatio,m=(i.x1*t+r.x-i.padding)*f+p.point.x,g=(i.y1*t+r.y-i.padding)*f+p.point.y,y=(i.x2*t+r.x+i.padding)*f+p.point.x,_=(i.y2*t+r.y+i.padding)*f+p.point.y,v=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(m,g,y,_)||!n&&this.grid.hitTest(m,g,y,_,a)||v?{box:[],offscreen:!1,occluded:p.occluded}:{box:[m,g,y,_],offscreen:this.isOffscreen(m,g,y,_),occluded:!1}}placeCollisionCircles(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=[],y=this.transform.elevation,_=y?y.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,t.getProjection()):e=>[0,0,0],v=new e.pointGeometry(r.tileAnchorX,r.tileAnchorY),x=t.getProjection().projectTilePoint(r.tileAnchorX,r.tileAnchorY,m.canonical),b=_(v),w=[x.x+b[0],x.y+b[1],x.z+b[2]],T="globe"===t.projection.name,S=this.projectAndGetPerspectiveRatio(a,[w[0],w[1],w[2]],m,T||!!y||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:C}=S,M=(h?s/C:s*C)/e.ONE_EM,k=nt(new e.pointGeometry(w[0],w[1]),l,w[2]).point,E=S.signedDistanceFromCamera>0?ct(M,o,r.lineOffsetX*M,r.lineOffsetY*M,!1,k,v,r,n,l,{},y&&!h?_:null,h&&!!y,t.getProjection(),m,h):null;let A=!1,I=!1,z=!0;if(E&&!S.occluded){const t=.5*p*C+f,r=new e.pointGeometry(-100,-100),n=new e.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Je,s=E.first,a=E.last;let l=[];for(let e=s.path.length-1;e>=1;e--)l.push(s.path[e]);for(let e=1;e<a.path.length;e++)l.push(a.path[e]);const h=2.5*t;if(c){const e=l.map(y&&!T?(e,t)=>{const i=_(t<s.path.length-1?s.tilePath[s.path.length-1-t]:a.tilePath[t-s.path.length+2]);return e[2]=i[2],ot(e,c)}:e=>ot(e,c));l=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let m=[];if(l.length>0){const t=l.map((t=>new e.pointGeometry(t[0],t[1])));let i=1/0,o=-1/0,s=1/0,a=-1/0;for(let e=0;e<t.length;e++)i=Math.min(i,t[e].x),s=Math.min(s,t[e].y),o=Math.max(o,t[e].x),a=Math.max(a,t[e].y);m=i>=r.x&&o<=n.x&&s>=r.y&&a<=n.y?[t]:o<r.x||i>n.x||a<r.y||s>n.y?[]:e.clipLine([t],r.x,r.y,n.x,n.y)}for(const e of m){o.reset(e,.25*t);let r=0;r=o.length<=.5*t?1:Math.ceil(o.paddedLength/h)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),s=o.lerp(n),a=s.x+_t,l=s.y+_t;g.push(a,l,t,0);const c=a-t,h=l-t,p=a+t,f=l+t;if(z=z&&this.isOffscreen(c,h,p,f),I=I||this.isInsideGrid(c,h,p,f),!i&&this.grid.hitTestCircle(a,l,t,d)&&(A=!0,!u))return{circles:[],offscreen:!1,collisionDetected:A,occluded:!1}}}}return{circles:!u&&A||!I?[]:g,offscreen:z,collisionDetected:A,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of t){const t=new e.pointGeometry(a.x+_t,a.y+_t);r=Math.min(r,t.x),n=Math.min(n,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y),i.push(t)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const t of a){const r=t.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new e.pointGeometry(t.x1,t.y1),new e.pointGeometry(t.x2,t.y1),new e.pointGeometry(t.x2,t.y2),new e.pointGeometry(t.x1,t.y2)];e.polygonIntersectsPolygon(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const o=t?this.ignoredGrid:this.grid,s={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let t=0;t<e.length;t+=4)o.insertCircle(s,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(t,i,r,n,o){const s=[i[0],i[1],i[2],1];let a=!1;if(i[2]||this.transform.pitch>0){e.transformMat4$1(s,s,t);const n="globe"===o.name;this.fogState&&r&&!n&&(a=function(t,i,r,n,o,s){const a=s.calculateFogTileMatrix(o),l=[i,r,n];return e.transformMat4(l,l,a),k(t,l,s.pitch,s._fov)}(this.fogState,i[0],i[1],i[2],r.toUnwrapped(),this.transform)>.9)}else yt(s,s,t);return{point:new e.pointGeometry((s[0]/s[3]+1)/2*this.transform.width+_t,(-s[1]/s[3]+1)/2*this.transform.height+_t),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(o)/s[3]*.5,1.5),signedDistanceFromCamera:s[3],occluded:n&&s[2]>s[3]||a}}isOffscreen(e,t,i,r){return i<_t||e>=this.screenRightBoundary||r<_t||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}function xt(t,i,r){const n=i.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.multiply(new Float32Array(16),t.projMatrix,n)}function bt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),xt(r,t.getProjection(),e)}function wt(e,t,i){return t.name===i.projection.name?e.projMatrix:xt(i,t,e)}class Tt{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class St{constructor(e,t,i,r,n,o=!1){this.text=new Tt(e?e.text:null,t,i,n),this.icon=new Tt(e?e.icon:null,t,r,n),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ct{constructor(e,t,i,r=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class Mt{constructor(){this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]}}class kt{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Et{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function At(t,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=e.getAnchorAlignment(t),l=-(s-.5)*i,c=-(a-.5)*r,u=e.evaluateVariableOffset(t,n);return new e.pointGeometry(l+u[0]*o,c+u[1]*o)}function It(t,i,r,n,o){const s=new e.pointGeometry(t,i);return r&&s._rotate(n?o:-o),s}class zt{constructor(e,t,i,r,n){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new vt(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Et(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=o.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/e.EXTENT,h=r.tileID.toUnwrapped();this.transform.setProjection(o.projection);const d=(p=r.tileID,f=o.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):xt(m,f,p));var p,f,m;const g="map"===a.get("text-pitch-alignment"),y="map"===a.get("text-rotation-alignment");i.compileFilter();const _=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(r),b=it(d,r.tileID.canonical,g,y,this.transform,o.getProjection(),x);let w=null;if(g){const t=rt(d,r.tileID.canonical,g,y,this.transform,o.getProjection(),x);w=e.multiply([],this.transform.labelPlaneMatrix,t)}let T=null;_&&r.latestFeatureIndex&&(T={unwrappedTileID:h,dynamicFilter:_,dynamicFilterNeedsFeature:v,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new kt(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const S={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:T,scale:c,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const e of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:S})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:S})}attemptAnchorPlacement(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=[h.textOffset0,h.textOffset1],v=At(e,i,r,_,n),x=this.collisionIndex.placeCollisionBox(p,n,t,It(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p,p.getSymbolInstanceIconSize(y,this.transform.zoom,d),m,It(v.x,v.y,o,s,this.transform.angle),u,a,l,c.predicate).box.length)&&x.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(t=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:i,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(p,e,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:x}}}placeLayerBucketPart(t,i,r,n){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,y=s.get("text-optional"),_=s.get("icon-optional"),v=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),T="none"!==s.get("icon-text-fit"),S="viewport-y"===s.get("symbol-z-order");this.transform.setProjection(o.projection);let C=v&&(x||!o.hasIconData()||_),M=x&&(v||!o.hasTextData()||y);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),r&&n&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const k=(t,n,p)=>{if(u){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(u.dynamicFilterNeedsFeature){const e=this.retainedQueryData[o.bucketInstanceId];n=u.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(r,n,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.pointGeometry(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[t.crossTileID]=new Ct(!1,!1,!1,!0),void(i[t.crossTileID]=!0)}if(i[t.crossTileID])return;if(d)return void(this.placements[t.crossTileID]=new Ct(!1,!1,!1));let S=!1,k=!1,E=!0,A=!1,I=!1,z=null,P={box:null,offscreen:null,occluded:null},L={box:null,offscreen:null,occluded:null},D=null,R=null,B=null,O=0,F=0,j=0;p.textFeatureIndex?O=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(O=t.featureIndex),p.verticalTextFeatureIndex&&(F=p.verticalTextFeatureIndex);const $=e=>{e.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||e.elevation)&&(e.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,e.tileAnchorX,e.tileAnchorY):0)},N=p.textBox;if(N){$(N);const i=i=>{let r=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[t.crossTileID];e&&(this.placedOrientations[t.crossTileID]=e,r=e,this.markUsedOrientation(o,r,t))}return r},r=(i,r)=>{if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&p.verticalTextBox){for(const t of o.writingModes)if(t===e.WritingMode.vertical?(P=r(),L=P):P=i(),P&&P.box&&P.box.length)break}else P=i()};if(s.get("text-variable-anchor")){let l=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[t.crossTileID]){const e=this.prevPlacement.variableOffsets[t.crossTileID];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,r)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),c=(e.x2-e.x1)*s+2*e.padding,u=(e.y2-e.y1)*s+2*e.padding,d=T&&!x?i:null;d&&$(d);let p={box:[],offscreen:!1,occluded:!1};const y=v?2*l.length:l.length;for(let i=0;i<y;++i){const y=this.attemptAnchorPlacement(l[i%l.length],e,c,u,s,b,w,h,a,g,i>=l.length,t,n,o,r,d,f,m);if(y&&(p=y.placedGlyphBoxes,p&&p.box&&p.box.length)){S=!0,z=y.shift;break}}return p};r((()=>c(N,p.iconBox,e.WritingMode.horizontal)),(()=>{const i=p.verticalTextBox;return i&&$(i),o.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&t.numVerticalGlyphVertices>0&&i?c(i,p.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null,occluded:null}})),P&&(S=P.box,E=P.offscreen,A=P.occluded);const u=i(P&&P.box);if(!S&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[t.crossTileID];e&&(this.variableOffsets[t.crossTileID]=e,this.markUsedJustification(o,e.anchor,t,u))}}else{const s=(i,r)=>{const s=o.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(o,s,i,new e.pointGeometry(0,0),v,h,a,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(o,r,t),this.placedOrientations[t.crossTileID]=r),l};r((()=>s(N,e.WritingMode.horizontal)),(()=>{const i=p.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&i?($(i),s(i,e.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}})),i(P&&P.box&&P.box.length)}}if(D=P,S=D&&D.box&&D.box.length>0,E=D&&D.offscreen,A=D&&D.occluded,t.useRuntimeCollisionCircles){const i=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.evaluateSizeForFeature(o.textSizeData,f,i),u=s.get("text-padding");R=this.collisionIndex.placeCollisionCircles(o,v,i,o.lineVertexArray,o.glyphOffsetArray,n,a,l,c,r,w,g.predicate,t.collisionCircleDiameter*n/e.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),S=v||R.circles.length>0&&!R.collisionDetected,E=E&&R.offscreen,A=R.occluded}if(p.iconFeatureIndex&&(j=p.iconFeatureIndex),p.iconBox){const t=t=>{$(t);const i=T&&z?It(z.x,z.y,b,w,this.transform.angle):new e.pointGeometry(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,n);return this.collisionIndex.placeCollisionBox(o,r,t,i,x,h,a,g.predicate)};L&&L.box&&L.box.length&&p.verticalIconBox?(B=t(p.verticalIconBox),k=B.box.length>0):(B=t(p.iconBox),k=B.box.length>0),E=E&&B.offscreen,I=B.occluded}const U=y||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,V=_||0===t.numIconVertices;if(U||V?V?U||(k=k&&S):S=k&&S:k=S=k&&S,S&&D&&D.box&&this.collisionIndex.insertCollisionBox(D.box,s.get("text-ignore-placement"),o.bucketInstanceId,L&&L.box&&F?F:O,g.ID),k&&B&&this.collisionIndex.insertCollisionBox(B.box,s.get("icon-ignore-placement"),o.bucketInstanceId,j,g.ID),R&&(S&&this.collisionIndex.insertCollisionCircles(R.circles,s.get("text-ignore-placement"),o.bucketInstanceId,O,g.ID),r)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Mt);for(let e=0;e<R.circles.length;e+=4)t.circles.push(R.circles[e+0]),t.circles.push(R.circles[e+1]),t.circles.push(R.circles[e+2]),t.circles.push(R.collisionDetected?1:0)}const G="globe"!==o.projection.name;C=C&&(G||!A),M=M&&(G||!I),this.placements[t.crossTileID]=new Ct(S||C,k||M,E||o.justReloaded),i[t.crossTileID]=!0};if(S){const e=o.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];k(o.symbolInstances.get(i),i,o.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)k(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.invert(t.invProjMatrix,a),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,i,r,n){let o;o=n===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const e of s)e>=0&&(t.text.placedSymbolArray.get(e).crossTileID=o>=0&&e!==o?0:r.crossTileID)}markUsedOrientation(t,i,r){const n=i===e.WritingMode.horizontal||i===e.WritingMode.horizontalOnly?i:0,o=i===e.WritingMode.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const e of s)t.text.placedSymbolArray.get(e).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];o?(this.opacities[e]=new St(o,r,t.text,t.icon,null,t.clipped),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new St(null,r,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new St(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i,r.collisionBoxArray)}}updateBucketOpacities(t,i,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),s=new St(null,0,!1,!1,!0),a=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),u="map"===n.get("text-rotation-alignment"),h="map"===n.get("text-pitch-alignment"),d="none"!==n.get("icon-text-fit"),p=new St(null,0,a&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(a||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const f=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};let m=0;for(let r=0;r<t.symbolInstances.length;r++){const n=t.symbolInstances.get(r),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:l,crossTileID:g}=n;let y=this.opacities[g];i[g]?y=s:y||(y=p,this.opacities[g]=y),i[g]=!0;const _=a>0||l>0,v=n.numIconVertices>0,x=this.placedOrientations[n.crossTileID],b=x===e.WritingMode.vertical,w=x===e.WritingMode.horizontal||x===e.WritingMode.horizontalOnly;if(!_&&!v||y.isHidden()||m++,_){const e=$t(y.text);f(t.text,a,b?Nt:e),f(t.text,l,w?Nt:e);const i=y.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((e=>{e>=0&&(t.text.placedSymbolArray.get(e).hidden=i||b?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||w?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(t,r.anchor,n,x);const o=this.placedOrientations[n.crossTileID];o&&(this.markUsedJustification(t,"left",n,o),this.markUsedOrientation(t,o,n))}if(v){const e=$t(y.icon);n.placedIconSymbolIndex>=0&&(f(t.icon,n.numIconVertices,b?Nt:e),t.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=y.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(f(t.icon,n.numVerticalIconVertices,w?Nt:e),t.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=y.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[r];if(i){let r=new e.pointGeometry(0,0),n=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[g];e?(r=At(e.anchor,e.width,e.height,e.textOffset,e.textScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):n=!1}o&&(n=!y.clipped),i.textBox&&Pt(t.textCollisionBox.collisionVertexArray,y.text.placed,!n||b,r.x,r.y),i.verticalTextBox&&Pt(t.textCollisionBox.collisionVertexArray,y.text.placed,!n||w,r.x,r.y)}const s=n&&Boolean(!w&&i.verticalIconBox);i.iconBox&&Pt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,s,d?r.x:0,d?r.y:0),i.verticalIconBox&&Pt(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,d?r.x:0,d?r.y:0)}}}if(t.fullyClipped=0===m,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Pt(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const Lt=Math.pow(2,25),Dt=Math.pow(2,24),Rt=Math.pow(2,17),Bt=Math.pow(2,16),Ot=Math.pow(2,9),Ft=Math.pow(2,8),jt=Math.pow(2,1);function $t(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Lt+t*Dt+i*Rt+t*Bt+i*Ot+t*Ft+i*jt+t}const Nt=0;class Ut{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class Vt{constructor(e,t,i,r,n,o,s,a){this.placement=new zt(e,n,o,s,a),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r){const n=e.exported.now(),o=()=>{const t=e.exported.now()-n;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const e=i[t[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===e.type&&(!e.minzoom||e.minzoom<=n)&&(!e.maxzoom||e.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new Ut(e)),this._inProgressLayer.continuePlacement(r[e.source],this.placement,this._showCollisionBoxes,e,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Gt=512/e.EXTENT/2;class qt{constructor(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(let i=0;i<t.length;i++){const r=t.get(i),n=r.key;this.indexedSymbolInstances[n]||(this.indexedSymbolInstances[n]=[]),this.indexedSymbolInstances[n].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,e)})}}getScaledCoordinates(t,i){const r=Gt/Math.pow(2,i.canonical.z-this.tileID.canonical.z);return{x:Math.floor((i.canonical.x*e.EXTENT+t.tileAnchorX)*r),y:Math.floor((i.canonical.y*e.EXTENT+t.tileAnchorY)*r)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let n=0;n<e.length;n++){const o=e.get(n);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);for(const e of s)if(Math.abs(e.coord.x-a.x)<=r&&Math.abs(e.coord.y-a.y)<=r&&!i[e.crossTileID]){i[e.crossTileID]=!0,o.crossTileID=e.crossTileID;break}}}}class Zt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new qt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i in t.indexedSymbolInstances)for(const r of t.indexedSymbolInstances[i])delete this.usedCrossTileIDs[e][r.crossTileID]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class Ht{constructor(){this.layerIndexes={},this.crossTileIDs=new Zt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.id];void 0===n&&(n=this.layerIndexes[e.id]=new Wt);let o=!1;const s={};"globe"!==r.name&&n.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(i.tileID,t,this.crossTileIDs)&&(o=!0),s[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const Xt=(t,i)=>e.emitValidationErrors(t,i&&i.filter((e=>"source.canvas"!==e.identifier))),Kt=e.pick(Ge,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yt=e.pick(Ge,["setCenter","setZoom","setBearing","setPitch"]),Jt={version:8,layers:[],sources:{}},Qt={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ei extends e.Evented{constructor(t,i={}){super(),this.map=t,this.dispatcher=new P(Ne(),this),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new e.GlyphManager(t._requestManager,i.localFontFamily?e.LocalGlyphMode.all:i.localIdeographFontFamily?e.LocalGlyphMode.ideographs:e.LocalGlyphMode.none,i.localFontFamily||i.localIdeographFontFamily),this.lineAtlas=new e.LineAtlas(256,512),this.crossTileSymbolIndex=new Ht,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new e.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",e.getReferrer());const r=this;this._rtlTextPluginCallback=ei.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.triggerPluginCompletionEvent(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i)}}))}loadURL(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,i.accessToken);const n=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(n,((t,i)=>{this._request=null,t?this.fire(new e.ErrorEvent(t)):i&&this._load(i,r)}))}loadJSON(t,i={}){this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.exported.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(Jt,!1)}_updateLayerCount(e,t){const i=t?1:-1;e.is3D()&&(this._num3DLayers+=i),"circle"===e.type&&(this._numCircleLayers+=i),"symbol"===e.type&&(this._numSymbolLayers+=i)}_load(t,i){if(i&&Xt(this,e.validateStyle(t)))return;this._loaded=!0,this.stylesheet=e.clone$1(t),this._updateMapProjection();for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const r=Ve(this.stylesheet.layers);this._order=r.map((e=>e.id)),this._layers={},this._serializedLayers={};for(let t of r)t=e.createStyleLayer(t),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize(),this._updateLayerCount(t,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new T(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,o,s;const a=e.exported.devicePixelRatio>1?"@2x":"";let l=e.getJSON(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.ResourceType.SpriteJSON),((e,t)=>{l=null,s||(s=e,n=t,u())})),c=e.getImage(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.ResourceType.SpriteImage),((e,t)=>{c=null,s||(s=e,o=t,u())}));function u(){if(s)r(s);else if(n&&o){const t=e.exported.getImageData(o),i={};for(const r in n){const{width:o,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p}=n[r],f=new e.RGBAImage({width:o,height:s});e.RGBAImage.copy(t,f,{x:a,y:l},{x:0,y:0},{width:o,height:s}),i[r]={data:f,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.ErrorEvent(t));else if(i)for(const e in i)this.imageManager.addImage(e,i[e]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new e.Event("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&Qt[e.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const i=this._changed;if(this._changed){const e=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(e.length||i.length)&&this._updateWorkerLayers(e,i);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const e in this._updatedPaintProps)this._layers[e].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const r={};for(const e in this._sourceCaches){const t=this._sourceCaches[e];r[e]=t.used,t.used=!1}for(const e of this._order){const i=this._layers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this._getLayerSourceCache(i);e&&(e.used=!0)}const r=this.map.painter;if(r){const e=i.getProgramIds();if(!e)continue;const n=i.getProgramConfiguration(t.zoom);for(const t of e)r.useProgram(t,n)}}for(const t in r){const i=this._sourceCaches[t];r[t]!==i.used&&i.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new e.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Xt(this,e.validateStyle(i)))return!1;(i=e.clone$1(i)).layers=Ve(i.layers);const r=function(e,i){if(!e)return[{command:Ge.setStyle,args:[i]}];let r=[];try{if(!t(e.version,i.version))return[{command:Ge.setStyle,args:[i]}];t(e.center,i.center)||r.push({command:Ge.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||r.push({command:Ge.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||r.push({command:Ge.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||r.push({command:Ge.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||r.push({command:Ge.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||r.push({command:Ge.setGlyphs,args:[i.glyphs]}),t(e.transition,i.transition)||r.push({command:Ge.setTransition,args:[i.transition]}),t(e.light,i.light)||r.push({command:Ge.setLight,args:[i.light]}),t(e.fog,i.fog)||r.push({command:Ge.setFog,args:[i.fog]}),t(e.projection,i.projection)||r.push({command:Ge.setProjection,args:[i.projection]});const n={},o=[];!function(e,i,r,n){let o;for(o in i=i||{},e=e||{})e.hasOwnProperty(o)&&(i.hasOwnProperty(o)||Ze(o,r,n));for(o in i)i.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t(e[o],i[o])||("geojson"===e[o].type&&"geojson"===i[o].type&&He(e,i,o)?r.push({command:Ge.setGeoJSONSourceData,args:[o,i[o].data]}):We(o,i,r,n)):qe(o,i,r))}(e.sources,i.sources,o,n);const s=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:Ge.removeLayer,args:[e.id]}):s.push(e)}));let a=e.terrain;a&&n[a.source]&&(r.push({command:Ge.setTerrain,args:[void 0]}),a=void 0),r=r.concat(o),t(a,i.terrain)||r.push({command:Ge.setTerrain,args:[i.terrain]}),function(e,i,r){i=i||[];const n=(e=e||[]).map(Ke),o=i.map(Ke),s=e.reduce(Ye,{}),a=i.reduce(Ye,{}),l=n.slice(),c=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<n.length;u++)d=n[u],a.hasOwnProperty(d)?h++:(r.push({command:Ge.removeLayer,args:[d]}),l.splice(l.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],l[l.length-1-u]!==d&&(s.hasOwnProperty(d)?(r.push({command:Ge.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,m=l[l.length-u],r.push({command:Ge.addLayer,args:[a[d],m]}),l.splice(l.length-u,0,d),c[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in Xe(p.layout,f.layout,r,d,null,Ge.setLayoutProperty),Xe(p.paint,f.paint,r,d,null,Ge.setPaintProperty),t(p.filter,f.filter)||r.push({command:Ge.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||r.push({command:Ge.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],r,d,g.slice(6),Ge.setPaintProperty):t(p[g],f[g])||r.push({command:Ge.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Xe(p[g],f[g],r,d,g.slice(6),Ge.setPaintProperty):t(p[g],f[g])||r.push({command:Ge.setLayerProperty,args:[d,g,f[g]]}))}else r.push({command:Ge.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],r.push({command:Ge.addLayer,args:[f,m]})}(s,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:Ge.setStyle,args:[i]}]}return r}(this.serialize(),i).filter((e=>!(e.command in Yt)));if(0===r.length)return!1;const n=r.filter((e=>!(e.command in Kt)));if(n.length>0)throw new Error(`Unimplemented: ${n.map((e=>e.command)).join(", ")}.`);return r.forEach((e=>{"setTransition"!==e.command&&this[e.command].apply(this,e.args)})),this.stylesheet=i,this._updateMapProjection(),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new e.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,i,r={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(e.validateSource,`sources.${t}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=Pe(t,i,this.dispatcher,this);n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:n.serialize(),sourceId:t})));const o=i=>{const r=(i?"symbol:":"other:")+t,o=this._sourceCaches[r]=new e.SourceCache(r,n,i);(i?this._symbolSourceCaches:this._otherSourceCaches)[t]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==i.type&&"geojson"!==i.type||o(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const i=this.getSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(t);for(const t of r)delete this._sourceCaches[t.id],delete this._updatedSources[t.id],t.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){const t=this._getSourceCache(e);return t&&t.getSource()}addLayer(t,i,r={}){this._checkLoaded();const n=t.id;if(this.getLayer(n))return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${n}" already exists on this map`)));let o;if("custom"===t.type){if(Xt(this,e.validateCustomStyleLayer(t)))return;o=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.clone$1(t),t=e.extend(t,{source:n})),this._validate(e.validateLayer,`layers.${n}`,t,{arrayIndex:-1},r))return;o=e.createStyleLayer(t),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)return void this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`)));this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[n]&&o.source&&a&&"custom"!==o.type){const e=this._removedLayers[n];delete this._removedLayers[n],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,i){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new e.ErrorEvent(new Error(`Layer with id "${i}" does not exist on this map.`))):(this._order.splice(n,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const i=this._layers[t];if(!i)return void this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));i.setEventedParent(null),this._updateLayerCount(i,!1);const r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(t,i,r){this._checkLoaded();const n=this.getLayer(t);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,r,n={}){this._checkLoaded();const o=this.getLayer(i);if(o){if(!t(o.filter,r))return null==r?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(e.validateFilter,`layers.${o.id}.filter`,r,{layerType:o.type},n)||(o.filter=e.clone$1(r),this._updateLayer(o)))}else this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const i=this.getLayer(t);return i&&e.clone$1(i.filter)}setLayoutProperty(i,r,n,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getLayoutProperty(r),n)||(s.setLayoutProperty(r,n,o),this._updateLayer(s)):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,i){const r=this.getLayer(t);if(r)return r.getLayoutProperty(i);this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(i,r,n,o={}){this._checkLoaded();const s=this.getLayer(i);s?t(s.getPaintProperty(r),n)||(s.setPaintProperty(r,n,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new e.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){const i=this.getLayer(e);return i&&i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,o=this.getSource(r);if(!o)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&n)return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!n)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(r);for(const e of a)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this.getSource(r);if(!n)return void this.fire(new e.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.type,s="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(r);for(const e of a)e.removeFeatureState(s,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this.getSource(i);if(n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0;const t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(t(o)){i[o]=n;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<o)break;n.push(t),r.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)n.push(t.feature)}}return n}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(e.validateFilter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),a=D.createFromScreenPoints(t,r);for(const e in this._sourceCaches){const t=this._sourceCaches[e].getSource().id;i.layers&&!n[t]||o.push(De(this._sourceCaches[e],this._layers,this._serializedLayers,a,i,r,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(e,t,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(Be);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=a[e]=a[e]||[],n=r[e];n.sort(((e,t)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of n)t.push(e)}}for(const t in a)a[t].forEach((r=>{const n=r.feature,o=i(e[t]).getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o}));return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,i){i&&i.filter&&this._validate(e.validateFilter,"querySourceFeatures.filter",i.filter,null,i);const r=this._getSourceCaches(t);let n=[];for(const e of r)n=n.concat(Re(e,i));return n}addSourceType(e,t,i){return ei.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(ei.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t(e[i],r[i])){n=!0;break}if(!n)return;const o=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(e,i),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,r=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===r){if("object"==typeof i.source){const t="terrain-dem-src";this.addSource(t,i.source),i=e.clone$1(i),i=e.extend(i,{source:t})}if(this._validate(e.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&r!==this.terrain.drapeRenderMode)this._createTerrain(i,r);else{const r=this.terrain,n=r.get();for(const t of Object.keys(e.spec.terrain))!i.hasOwnProperty(t)&&e.spec.terrain[t].default&&(i[t]=e.spec.terrain[t].default);for(const e in i)if(!t(i[e],n[e])){r.set(i),this.stylesheet.terrain=i;const e=this._setTransitionParameters({duration:0});r.updateTransitions(e);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new z(e,this.map.transform);this.stylesheet.fog=e;const i=this._setTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog,r=i.get();0===Object.keys(e).length&&i.set(e);for(const n in e)if(!t(e[n],r[n])){i.set(e),this.stylesheet.fog=e;const t=this._setTransitionParameters({duration:0});i.updateTransitions(t);break}}else this._createFog(e);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:e.exported.now(),transition:e.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const e=this._order.filter((e=>this.isLayerDraped(this._layers[e]))),t=this._order.filter((e=>!this.isLayerDraped(this._layers[e])));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new M(e,t);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const r=this._setTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n,o={}){return(!o||!1!==o.validate)&&Xt(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:r,styleSpec:e.spec},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles(),this._sourceCaches[e].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){const t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){const t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n,o=!1){let s=!1,a=!1;const l={};for(const e of this._order){const i=this._layers[e];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this._getLayerSourceCache(i);if(!e)continue;l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],t.center.lng,t.projection);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.exported.now(),t.zoom))&&(this.pauseablePlacement=new Vt(t,this._order,o,i,r,n,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,i){this.imageManager.getImages(t.icons,i),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i)}getResource(t,i,r){return e.makeRequest(i,r)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}_getSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this._getSourceCaches(t);return 0===i.length?(this.fire(new e.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ei.getSourceType=function(e){return ze[e]},ei.setSourceType=function(e,t){ze[e]=t},ei.registerForPluginStateChange=e.registerForPluginStateChange;var ti="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ii="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ri={},ni={};ri=ci("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),ni=ci("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const oi=ci("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),si=ti,ai="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var li={background:ci("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ci("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ci("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ci("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ci("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ci("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ci("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ci("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ci("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ci("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ci("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ci("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ci("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ci("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ci("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ci("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ci("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:ci("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ci("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxGradient:ci("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ii),skyboxCapture:ci("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ci("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ci("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ci(e,t,i){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=e.match(n),a=t.match(n),l=ti.match(n);let c=a?a.concat(s):s;i||(ri.staticUniforms&&(c=ri.staticUniforms.concat(c)),ni.staticUniforms&&(c=ni.staticUniforms.concat(c))),c&&(c=c.concat(l));const u={};return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(u[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return u[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\nvarying ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nattribute ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:o,staticUniforms:c}}class ui{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,r,n,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!c&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(c=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===i&&!c&&this.boundIndexBuffer===n&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a&&this.boundDynamicVertexBuffer3===l?(e.bindVertexArrayOES.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind()):this.freshBind(t,i,r,n,o,s,a,l)}freshBind(e,t,i,r,n,o,s,a){let l;const c=e.numAttributes,u=this.context,h=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),l=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a;else{l=u.currentNumAttributes||0;for(let e=c;e<l;e++)h.disableVertexAttribArray(e)}t.enableAttributes(h,e);for(const t of i)t.enableAttributes(h,e);o&&o.enableAttributes(h,e),s&&s.enableAttributes(h,e),a&&a.enableAttributes(h,e),t.bind(),t.setVertexAttribPointers(h,e,n);for(const t of i)t.bind(),t.setVertexAttribPointers(h,e,n);o&&(o.bind(),o.setVertexAttribPointers(h,e,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(h,e,n)),a&&(a.bind(),a.setVertexAttribPointers(h,e,n)),u.currentNumAttributes=c}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function hi(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.MercatorCoordinate(0,n/r).toLngLat().lat,new e.MercatorCoordinate(0,(n+1)/r).toLngLat().lat]}function di(t,i,r,n,o,s,a){const l=t.context,c=l.gl,u=r.fbo;if(!u)return;t.prepareDrawTile();const h=t.useProgram("hillshade");l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,t,i,r)=>{const n=i.paint.get("hillshade-shadow-color"),o=i.paint.get("hillshade-highlight-color"),s=i.paint.get("hillshade-accent-color");let a=i.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===i.paint.get("hillshade-illumination-anchor")&&(a-=e.transform.angle);const l=!e.options.moving;return{u_matrix:r||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:hi(0,t.tileID),u_light:[i.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:o,u_accent:s}})(t,r,n,t.terrain?i.projMatrix:null);t.prepareDrawProgram(l,h,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(r);h.draw(l,c.TRIANGLES,o,s,a,e.CullFaceMode.disabled,d,n.id,p,f,m)}function pi(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,o=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const s=r.getPixels();i.demTexture?i.demTexture.update(s,{premultiply:!1}):i.demTexture=new e.Texture(n,s,o.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function fi(t,i,r,n,o,s){const a=t.context,l=a.gl;if(!i.dem)return;const c=i.dem;if(a.activeTexture.set(l.TEXTURE1),pi(t,i,c),!i.demTexture)return;i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);const u=c.dim;a.activeTexture.set(l.TEXTURE0);let h=i.fbo;if(!h){const t=new e.Texture(a,{width:u,height:u,data:null},l.RGBA);t.bind(l.LINEAR,l.CLAMP_TO_EDGE),h=i.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(t.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=t.getMercatorTileBoundsBuffers();t.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,e.CullFaceMode.disabled,((t,i)=>{const r=i.stride,n=e.create();return e.ortho(n,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(n,n,[0,-e.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:i.unpackVector}})(i.tileID,c),r.id,d,p,f),i.needsHillshadePrepare=!1}const mi=(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image0:new e.Uniform1i(t,i.u_image0),u_skirt_height:new e.Uniform1f(t,i.u_skirt_height)}),gi=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),yi=(e,t,i,r,n,o,s,a,l,c,u,h,d,p)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:h,u_viewport:d,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9)});function _i(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const vi=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},xi={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function bi(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const wi=e=>({u_matrix:e});function Ti(t,i,r,n,o){if(o>0){const s=e.exported.now(),a=(s-t.timeAdded)/o,l=i?(s-i.timeAdded)/o:-1,c=r.getSource(),u=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),h=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),d=h&&t.refreshedUponExpiration?1:e.clamp(h?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class Si extends e.SourceCache{constructor(e){const t={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new P(Ne(),null),r=Pe("mock-dem",t,i,e.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class Ci extends e.SourceCache{constructor(e){const t=Pe("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new P(Ne(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,i,r){if(t.freezeTileCoverage)return;this.transform=t;const n=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,r)=>{if(i[r.key]="",!this._tiles[r.key]){const i=new e.Tile(r,this._source.tileSize*r.overscaleFactor(),t.tileZoom);i.state="loaded",this._tiles[r.key]=i}return i}),{});for(const e in this._tiles)e in n||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Mi extends e.OverscaledTileID{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class ki extends e.Elevation{constructor(t,i){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,o]=function(t){const i=new e.StructArrayLayout4i8,r=new e.StructArrayLayout3ui6,n=131;i.reserve(17161),r.reserve(33800);const o=e.EXTENT/128,s=e.EXTENT+o/2,a=s+o;for(let t=-o;t<a;t+=o)for(let r=-o;r<a;r+=o){const n=r<0||r>s||t<0||t>s?24575:0,o=e.clamp(Math.round(r),0,e.EXTENT),a=e.clamp(Math.round(t),0,e.EXTENT);i.emplaceBack(o+n,a,o,a)}const l=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,r,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(r,e.boundsAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(n),this.gridSegments=e.SegmentVector.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ci(i.map),this.orthoMatrix=e.create(),e.ortho(this.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new e.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Si(i.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency()}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const n=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(n.get("source")),this._exaggeration=n.get("exaggeration");const o=()=>{this.sourceCache.used&&e.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),i.updateElevation(!r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&e.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.pointGeometry(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.pointGeometry(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),s=n.mult(1<<t.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)}))}(n,this.painter),this._previousZoom=r.zoom;const o=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const e in s){const i=s[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],o),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((e=>new Mi(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=e.exported.now();const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),pi(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-n.z),s=r||"";return i[`u_dem_tl${s}`]=[n.x*o%1,n.y*o%1],i[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const r=new e.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.Texture(t,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),n=new e.RGBAImage({width:1,height:1},new Uint8Array(e.DEMData.pack(r,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(n,{premultiply:!1}):o=this._emptyDEMTexture=new e.Texture(t,n,i.RGBA,{premultiply:!1}),o}setupElevationDraw(t,i,r){const n=this.painter.context,o=n.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();const l=this.painter.transform,c=l.projection,u=t.tileID.canonical;s.u_tile_tl_up=c.upVector(u,0,0),s.u_tile_tr_up=c.upVector(u,e.EXTENT,0),s.u_tile_br_up=c.upVector(u,e.EXTENT,e.EXTENT),s.u_tile_bl_up=c.upVector(u,0,e.EXTENT),s.u_tile_up_scale=r&&r.useDenormalizedUpVectorScale?e.GLOBE_METERS_TO_ECEF:c.upVectorScale(u,l.center.lat,l.worldSize).metersToTile;let h=null,d=null,p=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;p=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,s,"_prev")&&(d=e),this._prepareDemTileUniforms(t,i,s)&&(h=i))}if(d&&h?(n.activeTexture.set(o.TEXTURE2),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),n.activeTexture.set(o.TEXTURE4),d.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=p):(h=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,h,s)?h.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),n.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&h){const t=(1<<h.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=t}r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,s)}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,r,n,o){if("globe"===t.transform.projection.name)!function(t,i,r,n,o){const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=t.transform,d=e.globeUseCustomAntiAliasing(t,s,h),p=(e,i)=>{if(c===e)return;const r=[xi[e],"PROJECTION_GLOBE_VIEW"];d&&r.push("CUSTOM_ANTIALIASING"),i&&r.push(xi[u]),l=t.useProgram("globeRaster",null,r),c=e},f=t.colorModeForRenderPass(),m=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);vi.update(o);const g=e.calculateGlobeMercatorMatrix(h),y=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],_=t.globeSharedBuffers,v=[h.width*e.exported.devicePixelRatio,h.height*e.exported.devicePixelRatio];if((u?[!1,!0]:[!1]).forEach((u=>{c=-1;const d=u?a.LINES:a.TRIANGLES;for(const c of n){const n=r.getTile(c),x=e.StencilMode.disabled,b=i.prevTerrainTileForTile[c.key],w=i.terrainTileForTile[c.key];_i(b,w)&&vi.newMorphing(c.key,b,w,o,250),s.activeTexture.set(a.TEXTURE0),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=vi.getMorphValuesForProxy(c.key),S=T?1:0,C={useDenormalizedUpVectorScale:!0};T&&e.extend$1(C,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.easeCubicInOut(T.phase)}});const M=Float32Array.from(h.globeMatrix),k=e.globeTileLatLngCorners(c.canonical),E=e.getLatitudinalLod((k[0][0]+k[1][0])/2),A=e.getGridMatrix(c.canonical,k,E),I=e.globeNormalizeECEF(e.globeTileBounds(c.canonical)),z=yi(h.projMatrix,M,g,I,e.globeToMercatorTransition(h.zoom),y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,A);if(p(S,u),i.setupElevationDraw(n,l,C),t.prepareDrawProgram(s,l,c.toUnwrapped()),_){const[i,r,n]=u?_.getWirefameBuffers(t.context,E):_.getGridBuffers(E);l.draw(s,d,m,x,f,e.CullFaceMode.backCCW,z,"globe_raster",i,r,n)}}})),_){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=t.useProgram("globeRaster",null,o);for(const o of n){const{x:n,y:c,z:u}=o.canonical,d=0===c,p=c===(1<<u)-1,[g,x,b,w]=_.getPoleBuffers(u);if(w&&(d||p)){const c=r.getTile(o);s.activeTexture.set(a.TEXTURE0),c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=e.globePoleMatrixForTile(u,n,h);const T=e.globeNormalizeECEF(e.globeTileBounds(o.canonical)),S=(t,i)=>t.draw(s,a.TRIANGLES,m,e.StencilMode.disabled,f,e.CullFaceMode.disabled,yi(h.projMatrix,_,_,T,0,y,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v),"globe_pole_raster",i,b,w);i.setupElevationDraw(c,l,{}),t.prepareDrawProgram(s,l,o.toUnwrapped()),d&&S(l,g),p&&(_=e.scale(e.create(),_,[1,-1,1]),S(l,x))}}}}(t,i,r,n,o);else{const s=t.context,a=s.gl;let l,c;const u=t.options.showTerrainWireframe?2:0,h=(e,i)=>{if(c===e)return;const r=[xi[e]];i&&r.push(xi[u]),l=t.useProgram("terrainRaster",null,r),c=e},d=t.colorModeForRenderPass(),p=new e.DepthMode(a.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);vi.update(o);const f=t.transform,m=6*Math.pow(1.5,22-f.zoom)*i.exaggeration();(u?[!1,!0]:[!1]).forEach((u=>{c=-1;const g=u?a.LINES:a.TRIANGLES,[y,_]=u?i.getWirefameBuffer():[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),v=e.StencilMode.disabled,x=i.prevTerrainTileForTile[c.key],b=i.terrainTileForTile[c.key];_i(x,b)&&vi.newMorphing(c.key,x,b,o,250),s.activeTexture.set(a.TEXTURE0),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=vi.getMorphValuesForProxy(c.key),T=w?1:0;let S;w&&(S={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:e.easeCubicInOut(w.phase)}});const C=gi(c.projMatrix,bi(c.canonical,f.renderWorldCopies)?m/10:m);h(T,u),i.setupElevationDraw(n,l,S),t.prepareDrawProgram(s,l,c.toUnwrapped()),l.draw(s,g,p,v,d,e.CullFaceMode.backCCW,C,"terrain_raster",i.gridBuffer,y,_)}}))}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,o=this.proxiedCoords[n.id],s=this._drapedRenderBatches.shift(),a=[],l=i.style.order;let c=0;for(const u of o){const o=n.getTileByID(u.proxyTileKey),h=n.proxyCachedFBO[u.key]?n.proxyCachedFBO[u.key][t]:void 0,d=void 0!==h?n.renderCache[h]:this.pool[c++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:e.Color.transparent,stencil:0}),d.dirty=!1);for(let e=s.start;e<=s.end;++e){const t=i.style._layers[l[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style._getLayerSourceCache(t),o=n?this.proxyToSource[u.key][n.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,o,t,n),f=n?n.id:null),i.renderLayer(i,n,t,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),s.end+1}postRender(){}renderCacheEfficiency(e){const t=e.order.length;if(0===t)return{efficiency:100};let i,r=0,n=0,o=!1;for(let s=0;s<t;++s){const t=e._layers[e.order[s]];this._style.isLayerDraped(t)?(o&&++r,++n):o||(o=!0,i=t.id)}return 0===n?{efficiency:100}:{efficiency:100*(1-r/n),firstUndrapedLayer:i}}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,o=Math.pow(2,n.overscaledZ),{x:s,y:a}=n.canonical,l=s/o,c=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:l,miny:u,maxx:c,maxy:h,t:r.dem.tree.raycastRoot(l,u,c,h,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.Texture(t,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const o=t.createFramebuffer(r[0],r[1],!1);return o.colorAttachment.set(n.texture),o.depthAttachment=new Se(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._layers[e],i=t.isHidden(this.painter.transform.zoom),r=t.getCrossfadeParameters(),n=!!r&&1!==r.t,o=t.hasTransition();return"custom"!==t.type&&!i&&(n||o)}))}_clearRasterFadeFromRenderCache(){let e=!1;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t]._source instanceof ke){e=!0;break}if(e)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],i=t.isHidden(this.painter.transform.zoom),r=this._style._getLayerSourceCache(t);if("raster"!==t.type||i||!r)continue;const n=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=Ti(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,n);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupDrapedRenderBatches(){const e=this._style.order,t=e.length;if(0===t)return;const i=[];let r,n=0,o=this._style._layers[e[n]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++n<t;)o=this._style._layers[e[n]];for(;n<t;++n){const t=this._style._layers[e[n]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===r&&(r=n):void 0!==r&&(i.push({start:r,end:n-1}),r=void 0))}void 0!==r&&i.push({start:r,end:n-1}),this._drapedRenderBatches=i}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const r=Object.values(e[i]);t.renderCachePool.push(...r)}}return}this._clearRasterFadeFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let n=i.length-1;n>=0;n--){const o=i[n];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){const i=e[o.key],n=this.proxyToSource[o.key];let s=0;for(const e in n){const t=n[e],o=i[e];if(!o||o.length!==t.length||t.some(((t,i)=>t!==o[i]||r[e]&&r[e].hasOwnProperty(t.key)))){s=-1;break}++s}for(const e in t.proxyCachedFBO[o.key])t.renderCache[t.proxyCachedFBO[o.key][e]].dirty=s<0||s!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of n)for(const r of i){if(t.proxyCachedFBO[r.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[r.key]={},t.proxyCachedFBO[r.key][e.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,o=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let s;if(i.isTileClipped())s=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}_renderTileClippingMasks(t,i){const r=this.painter,n=this.painter.context,o=n.gl;r._tileClippingMaskIDs={},n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const s=r.useProgram("clippingMask");for(const a of t){const t=r._tileClippingMaskIDs[a.key]=--i;s.draw(n,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,wi(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.transformMat4$1(r,r,i.pixelMatrixInverse),e.scale$1(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,o=e.mercatorZfromAltitude(1,i.center.lat),s=[n[0],n[1],n[2]/o,0],a=e.subtract([],r.slice(0,3),s);e.normalize(a,a);const l=this.raycast(s,a,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(s,s,a,l),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,i=t.context,r=this.proxySourceCache,n=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,r=i.createFramebuffer(n,o,!0);i.activeTexture.set(t.TEXTURE0);const s=new e.Texture(i,{width:n,height:o,data:null},t.RGBA);s.bind(t.NEAREST,t.CLAMP_TO_EDGE),r.colorAttachment.set(s.texture);const a=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,o);r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=s}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,o]),function(t,i,r,n){if("globe"===t.transform.projection.name)return;const o=t.context,s=o.gl;o.clear({depth:1});const a=t.useProgram("terrainDepth"),l=new e.DepthMode(s.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D);for(const t of n){const n=r.getTile(t),c=gi(t.projMatrix,0);i.setupElevationDraw(n,a),a.draw(o,s.TRIANGLES,l,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,c,"terrain_depth",i.gridBuffer,i.gridIndexBuffer,i.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,t,i){if(e.getSource()instanceof Ie)return this._setupProxiedCoordsForImageSource(e,t,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const r=this.proxiedCoords[e.id]=[],n=this.proxyCoords;for(let t=0;t<n.length;t++){const o=n[t],s=this._findTileCoveringTileID(o,e);if(s){const t=this._createProxiedId(o,s,i[o.key]&&i[o.key][e.id]);r.push(t),this.proxyToSource[o.key][e.id]=[t]}}let o=!1;for(let n=0;n<t.length;n++){const s=e.getTile(t[n]);if(!s||!s.hasData())continue;const a=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==s.tileID.canonical.z){const t=this.proxyToSource[a.tileID.key][e.id],n=this._createProxiedId(a.tileID,s,i[a.tileID.key]&&i[a.tileID.key][e.id]);t?t.splice(t.length-1,0,n):this.proxyToSource[a.tileID.key][e.id]=[n],r.push(n),o=!0}}this._sourceTilesOverlap[e.id]=o}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=new e.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),l=s.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-a.x),e.min.y=Math.min(e.min.y,t.y-a.y),e.max.x=Math.max(e.max.x,t.x-a.x),e.max.y=Math.max(e.max.y,t.y-a.y),e)),{min:new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),o=e.EXTENT/(1<<t.canonical.z),s=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return r+o<s+l.min.x||r>s+l.max.x||n+o<a+l.min.y||n>a+l.max.y};for(let e=0;e<o.length;e++){const s=o[e];for(let e=0;e<i.length;e++){const o=t.getTile(i[e]);if(!o||!o.hasData())continue;if(c(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][t.id]),l=this.proxyToSource[s.key][t.id];l?l.push(a):this.proxyToSource[s.key][t.id]=[a],n.push(a)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let o,s,a;n=e.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(o=e.EXTENT>>r,s=o*((i.tileID.canonical.x<<r)-t.canonical.x+l),a=o*((i.tileID.canonical.y<<r)-t.canonical.y)):(o=e.EXTENT<<-r,s=e.EXTENT*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),a=e.EXTENT*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.ortho(n,0,o,0,o,0,1),e.translate(n,n,[s,a,0])}return new Mi(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],o=n[t.key];if(r=o?i.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:t,a=s.overscaledZ;const l=i.getSource().minzoom,c=[];if(!o){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),s=new e.OverscaledTileID(a,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(a=n,s=new e.OverscaledTileID(a,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}s.key!==t.key&&(c.push(s.key),r=i.getTile(s))}const u=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(a-=1;a>=l&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const e=s.calculateScaledKey(a);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):r=i.getTileByID(t)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(t){let i=0;const r=new e.StructArrayLayout2ui4,n=131;for(let e=1;e<129;e++){for(let t=1;t<129;t++)i=e*n+t,r.emplaceBack(i,i+1),r.emplaceBack(i,i+n),r.emplaceBack(i+1,i+n),128===e&&r.emplaceBack(i+n,i+n+1);r.emplaceBack(i+1,i+1+n)}return r}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=e.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ei(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const r=e[i].split(" ");t.push(r.pop())}return t}class Ai{static cacheKey(e,t,i){let r=`${e}${i?i.cacheKey:""}`;for(const e of t)r+=`/${e}`;return r}constructor(t,i,r,n,o,s){const a=t.gl;this.program=a.createProgram();const l=Ei(r.staticAttributes),c=n?n.getBinderAttributes():[],u=l.concat(c),h=r.staticUniforms?Ei(r.staticUniforms):[],d=n?n.getBinderUniforms():[],p=h.concat(d),f=[];for(const e of p)f.indexOf(e)<0&&f.push(e);let m=n?n.defines():[];m=m.concat(s.map((e=>`#define ${e}`)));const g=m.concat(t.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(ai):ai,ai,si,oi.fragmentSource,ni.fragmentSource,r.fragmentSource).join("\n"),y=m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",si,oi.vertexSource,ni.vertexSource,ri.vertexSource,r.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,y),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const x={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(_);for(let e=0;e<f.length;e++){const t=f[e];if(t&&!x[t]){const e=a.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=o(t,x),this.binderUniforms=n?n.getUniforms(t,x):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((t,i)=>({u_dem:new e.Uniform1i(t,i.u_dem),u_dem_prev:new e.Uniform1i(t,i.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,i.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,i.u_dem_tl),u_dem_scale:new e.Uniform1f(t,i.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,i.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,i.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,i.u_dem_size),u_dem_lerp:new e.Uniform1f(t,i.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,i.u_exaggeration),u_depth:new e.Uniform1i(t,i.u_depth),u_depth_size_inv:new e.Uniform2f(t,i.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,i.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,i.u_label_plane_matrix_inv),u_tile_tl_up:new e.Uniform3f(t,i.u_tile_tl_up),u_tile_tr_up:new e.Uniform3f(t,i.u_tile_tr_up),u_tile_br_up:new e.Uniform3f(t,i.u_tile_br_up),u_tile_bl_up:new e.Uniform3f(t,i.u_tile_bl_up),u_tile_up_scale:new e.Uniform1f(t,i.u_tile_up_scale)}))(t,x)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((t,i)=>({u_fog_matrix:new e.UniformMatrix4f(t,i.u_fog_matrix),u_fog_range:new e.Uniform2f(t,i.u_fog_range),u_fog_color:new e.Uniform4f(t,i.u_fog_color),u_fog_horizon_blend:new e.Uniform1f(t,i.u_fog_horizon_blend),u_fog_temporal_offset:new e.Uniform1f(t,i.u_fog_temporal_offset),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_globe_transition:new e.Uniform1f(t,i.u_globe_transition),u_is_globe:new e.Uniform1i(t,i.u_is_globe),u_viewport:new e.Uniform2f(t,i.u_viewport)}))(t,x))}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].location&&i[e].set(t[e])}}draw(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g){const y=e.gl;if(this.failedToCreate)return;e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(s[e]);p&&p.setUniforms(e,this.binderUniforms,h,{zoom:d});const _={[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t];for(const i of u.get()){const r=i.vaos||(i.vaos={});(r[a]||(r[a]=new ui)).bind(e,this,l,p?p.getPaintVertexBuffers():[],c,i.vertexOffset,f,m,g),y.drawElements(t,i.primitiveLength*_,y.UNSIGNED_SHORT,i.primitiveOffset*_*2)}}}function Ii(e,t,i){const r=1/L(i,1,t.transform.tileZoom),n=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,t.transform.tileZoom)/n,s=o*(i.tileID.canonical.x+i.tileID.wrap*n),a=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const zi=e.create(),Pi=(t,i,r,n,o,s,a,l,c)=>{const u=i.style.light,h=u.properties.get("position"),d=[h.x,h.y,h.z],p=e.create$1();"viewport"===u.properties.get("anchor")&&(e.fromRotation(p,-i.transform.angle),e.transformMat3(d,d,p));const f=u.properties.get("color"),m=i.transform,g={u_matrix:t,u_lightpos:d,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[f.r,f.g,f.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===m.projection.name&&(g.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],g.u_zoom_transition=a,g.u_inv_rot_matrix=c,g.u_merc_center=l,g.u_up_dir=m.projection.upVector(new e.CanonicalTileID(0,0,0),l[0]*e.EXTENT,l[1]*e.EXTENT),g.u_height_lift=s),g},Li=(t,i,r,n,o,s,a,l,c,u,h)=>{const d=Pi(t,i,r,n,o,l,c,u,h),p={u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8};return e.extend(d,Ii(s,i,a),p)},Di=e=>({u_matrix:e}),Ri=(t,i,r,n)=>e.extend(Di(t),Ii(r,i,n)),Bi=(e,t)=>({u_matrix:e,u_world:t}),Oi=(t,i,r,n,o)=>e.extend(Ri(t,i,r,n),{u_world:o}),Fi=e.create(),ji=(t,i,r,n,o,s)=>{const a=t.transform,l="globe"===a.projection.name;let c;if("map"===s.paint.get("circle-pitch-alignment"))if(l){const t=e.globePixelsToTileUnits(a.zoom,i.canonical)*a._projectionScaler;c=Float32Array.from([t,0,0,t])}else c=a.calculatePixelsToTileUnitsMatrix(r);else c=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:t.translatePosMatrix(i.projMatrix,r,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.exported.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Fi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(l){u.u_inv_rot_matrix=n,u.u_merc_center=o,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.globeToMercatorTransition(a.zoom);const t=o[0]*e.EXTENT,r=o[1]*e.EXTENT;u.u_up_dir=a.projection.upVector(new e.CanonicalTileID(0,0,0),t,r)}return u},$i=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Ni=(t,i,r,n)=>{const o=e.EXTENT/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/o,i.pixelsToGLUnits[1]/o]}},Ui=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),Vi=e.create(),Gi=(t,i,r,n,o,s,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.globePixelsToTileUnits(l.zoom,i.canonical)*l._projectionScaler:L(r,1,s),h={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Vi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){h.u_inv_rot_matrix=n,h.u_merc_center=o,h.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],h.u_zoom_transition=e.globeToMercatorTransition(l.zoom);const t=o[0]*e.EXTENT,r=o[1]*e.EXTENT;h.u_up_dir=l.projection.upVector(new e.CanonicalTileID(0,0,0),t,r)}return h},qi=(e,t,i,r,n,o,s,a)=>{const l=e.transform,c=l.calculatePixelsToTileUnitsMatrix(t),u={u_matrix:Hi(e,t,i,n),u_pixels_to_tile_units:c,u_device_pixel_ratio:s,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:a};if(Xi(i)){const i=Wi(t,e.transform);u.u_texsize=t.lineAtlasTexture.size,u.u_scale=[i,r.fromScale,r.toScale],u.u_mix=r.t}return u},Zi=(e,t,i,r,n,o)=>{const s=e.transform,a=Wi(t,s);return{u_matrix:Hi(e,t,i,n),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:o,u_image:0,u_scale:[a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Wi(e,t){return 1/L(e,1,t.tileZoom)}function Hi(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}function Xi(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ki=(e,t,i,r,n,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:i,u_fade_t:r.mix,u_opacity:r.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(a=n.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=n.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Yi(n.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Yi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Ji=e.create(),Qi=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g)=>{const y=o.transform,_={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:y.cameraToCenterDistance,u_rotate_symbol:+r,u_aspect_ratio:y.width/y.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ji,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ji,u_up_vector:[0,-1,0]};return"globe"===g.name&&(_.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],_.u_zoom_transition=d,_.u_inv_rot_matrix=f,_.u_merc_center=p,_.u_camera_forward=y._camera.forward(),_.u_ecef_origin=e.globeECEFOrigin(y.globeMatrix,h.toUnwrapped()),_.u_tile_matrix=Float32Array.from(y.globeMatrix),_.u_up_vector=m),_},er=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y)=>e.extend(Qi(t,i,r,n,o,s,a,l,c,u,d,p,f,m,g,y),{u_gamma_scale:n?o.transform.cameraToCenterDistance*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.exported.devicePixelRatio,u_is_halo:+h}),tr=(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g)=>e.extend(er(t,i,r,n,o,s,a,l,!0,c,!0,h,d,p,f,m,g),{u_texsize_icon:u,u_texture_icon:1}),ir=(e,t,i)=>({u_matrix:e,u_opacity:t,u_color:i}),rr=(t,i,r,n,o,s)=>e.extend(function(e,t,i,r){const n=i.imageManager.getPattern(e.from.toString()),o=i.imageManager.getPattern(e.to.toString()),{width:s,height:a}=i.imageManager.getPixelSize(),l=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,i.transform.tileZoom)/l,u=c*(r.tileID.canonical.x+r.tileID.wrap*l),h=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:t.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/L(r,1,i.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(n,s,r,o),{u_matrix:t,u_opacity:i}),nr={fillExtrusion:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_opacity:new e.Uniform1f(t,i.u_opacity),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift)}),fillExtrusionPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_lightpos:new e.Uniform3f(t,i.u_lightpos),u_lightintensity:new e.Uniform1f(t,i.u_lightintensity),u_lightcolor:new e.Uniform3f(t,i.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,i.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,i.u_height_factor),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_up_dir:new e.Uniform3f(t,i.u_up_dir),u_height_lift:new e.Uniform1f(t,i.u_height_lift),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_opacity:new e.Uniform1f(t,i.u_opacity)}),fill:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),fillPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),fillOutline:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world)}),fillOutlinePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_world:new e.Uniform2f(t,i.u_world),u_image:new e.Uniform1i(t,i.u_image),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade)}),circle:(t,i)=>({u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.UniformMatrix2f(t,i.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),collisionBox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,i.u_extrude_scale)}),collisionCircle:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,i.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,i.u_viewport_size)}),debug:(t,i)=>({u_color:new e.UniformColor(t,i.u_color),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_overlay:new e.Uniform1i(t,i.u_overlay),u_overlay_scale:new e.Uniform1f(t,i.u_overlay_scale)}),clippingMask:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix)}),heatmap:(t,i)=>({u_extrude_scale:new e.Uniform1f(t,i.u_extrude_scale),u_intensity:new e.Uniform1f(t,i.u_intensity),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_up_dir:new e.Uniform3f(t,i.u_up_dir)}),heatmapTexture:(t,i)=>({u_image:new e.Uniform1i(t,i.u_image),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_opacity:new e.Uniform1f(t,i.u_opacity)}),hillshade:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_latrange:new e.Uniform2f(t,i.u_latrange),u_light:new e.Uniform2f(t,i.u_light),u_shadow:new e.UniformColor(t,i.u_shadow),u_highlight:new e.UniformColor(t,i.u_highlight),u_accent:new e.UniformColor(t,i.u_accent)}),hillshadePrepare:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_image:new e.Uniform1i(t,i.u_image),u_dimension:new e.Uniform2f(t,i.u_dimension),u_zoom:new e.Uniform1f(t,i.u_zoom),u_unpack:new e.Uniform4f(t,i.u_unpack)}),line:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_dash_image:new e.Uniform1i(t,i.u_dash_image),u_gradient_image:new e.Uniform1i(t,i.u_gradient_image),u_image_height:new e.Uniform1f(t,i.u_image_height),u_texsize:new e.Uniform2f(t,i.u_texsize),u_scale:new e.Uniform3f(t,i.u_scale),u_mix:new e.Uniform1f(t,i.u_mix),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold),u_trim_offset:new e.Uniform2f(t,i.u_trim_offset)}),linePattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_texsize:new e.Uniform2f(t,i.u_texsize),u_pixels_to_tile_units:new e.UniformMatrix2f(t,i.u_pixels_to_tile_units),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_image:new e.Uniform1i(t,i.u_image),u_units_to_pixels:new e.Uniform2f(t,i.u_units_to_pixels),u_scale:new e.Uniform3f(t,i.u_scale),u_fade:new e.Uniform1f(t,i.u_fade),u_alpha_discard_threshold:new e.Uniform1f(t,i.u_alpha_discard_threshold)}),raster:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_tl_parent:new e.Uniform2f(t,i.u_tl_parent),u_scale_parent:new e.Uniform1f(t,i.u_scale_parent),u_fade_t:new e.Uniform1f(t,i.u_fade_t),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image0:new e.Uniform1i(t,i.u_image0),u_image1:new e.Uniform1i(t,i.u_image1),u_brightness_low:new e.Uniform1f(t,i.u_brightness_low),u_brightness_high:new e.Uniform1f(t,i.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,i.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,i.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,i.u_spin_weights),u_perspective_transform:new e.Uniform2f(t,i.u_perspective_transform)}),symbolIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_texture:new e.Uniform1i(t,i.u_texture)}),symbolSDF:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texture:new e.Uniform1i(t,i.u_texture),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_tile_id:new e.Uniform3f(t,i.u_tile_id),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_inv_rot_matrix:new e.UniformMatrix4f(t,i.u_inv_rot_matrix),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_camera_forward:new e.Uniform3f(t,i.u_camera_forward),u_tile_matrix:new e.UniformMatrix4f(t,i.u_tile_matrix),u_up_vector:new e.Uniform3f(t,i.u_up_vector),u_ecef_origin:new e.Uniform3f(t,i.u_ecef_origin),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),symbolTextAndIcon:(t,i)=>({u_is_size_zoom_constant:new e.Uniform1i(t,i.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,i.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,i.u_size_t),u_size:new e.Uniform1f(t,i.u_size),u_camera_to_center_distance:new e.Uniform1f(t,i.u_camera_to_center_distance),u_rotate_symbol:new e.Uniform1i(t,i.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,i.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,i.u_fade_change),u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,i.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,i.u_coord_matrix),u_is_text:new e.Uniform1i(t,i.u_is_text),u_pitch_with_map:new e.Uniform1i(t,i.u_pitch_with_map),u_texsize:new e.Uniform2f(t,i.u_texsize),u_texsize_icon:new e.Uniform2f(t,i.u_texsize_icon),u_texture:new e.Uniform1i(t,i.u_texture),u_texture_icon:new e.Uniform1i(t,i.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,i.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,i.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,i.u_is_halo)}),background:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_color:new e.UniformColor(t,i.u_color)}),backgroundPattern:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_opacity:new e.Uniform1f(t,i.u_opacity),u_image:new e.Uniform1i(t,i.u_image),u_pattern_tl_a:new e.Uniform2f(t,i.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,i.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,i.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,i.u_pattern_br_b),u_texsize:new e.Uniform2f(t,i.u_texsize),u_mix:new e.Uniform1f(t,i.u_mix),u_pattern_size_a:new e.Uniform2f(t,i.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,i.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,i.u_scale_a),u_scale_b:new e.Uniform1f(t,i.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,i.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,i.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,i.u_tile_units_to_pixels)}),terrainRaster:mi,terrainDepth:mi,skybox:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_cubemap:new e.Uniform1i(t,i.u_cubemap),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxGradient:(t,i)=>({u_matrix:new e.UniformMatrix4f(t,i.u_matrix),u_color_ramp:new e.Uniform1i(t,i.u_color_ramp),u_center_direction:new e.Uniform3f(t,i.u_center_direction),u_radius:new e.Uniform1f(t,i.u_radius),u_opacity:new e.Uniform1f(t,i.u_opacity),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset)}),skyboxCapture:(t,i)=>({u_matrix_3f:new e.UniformMatrix3f(t,i.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,i.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,i.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,i.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,i.u_color_tint_m),u_luminance:new e.Uniform1f(t,i.u_luminance)}),globeRaster:(t,i)=>({u_proj_matrix:new e.UniformMatrix4f(t,i.u_proj_matrix),u_globe_matrix:new e.UniformMatrix4f(t,i.u_globe_matrix),u_normalize_matrix:new e.UniformMatrix4f(t,i.u_normalize_matrix),u_merc_matrix:new e.UniformMatrix4f(t,i.u_merc_matrix),u_zoom_transition:new e.Uniform1f(t,i.u_zoom_transition),u_merc_center:new e.Uniform2f(t,i.u_merc_center),u_image0:new e.Uniform1i(t,i.u_image0),u_grid_matrix:new e.UniformMatrix3f(t,i.u_grid_matrix),u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_globe_pos:new e.Uniform3f(t,i.u_globe_pos),u_globe_radius:new e.Uniform1f(t,i.u_globe_radius),u_viewport:new e.Uniform2f(t,i.u_viewport)}),globeAtmosphere:(t,i)=>({u_frustum_tl:new e.Uniform3f(t,i.u_frustum_tl),u_frustum_tr:new e.Uniform3f(t,i.u_frustum_tr),u_frustum_br:new e.Uniform3f(t,i.u_frustum_br),u_frustum_bl:new e.Uniform3f(t,i.u_frustum_bl),u_horizon:new e.Uniform1f(t,i.u_horizon),u_transition:new e.Uniform1f(t,i.u_transition),u_fadeout_range:new e.Uniform1f(t,i.u_fadeout_range),u_color:new e.Uniform4f(t,i.u_color),u_high_color:new e.Uniform4f(t,i.u_high_color),u_space_color:new e.Uniform4f(t,i.u_space_color),u_star_intensity:new e.Uniform1f(t,i.u_star_intensity),u_star_density:new e.Uniform1f(t,i.u_star_density),u_star_size:new e.Uniform1f(t,i.u_star_size),u_temporal_offset:new e.Uniform1f(t,i.u_temporal_offset),u_horizon_angle:new e.Uniform1f(t,i.u_horizon_angle),u_rotation_matrix:new e.UniformMatrix4f(t,i.u_rotation_matrix)})};let or;function sr(t,i,r,n,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=t.useProgram("collisionBox"),d=[];let p=0,f=0;for(let m=0;m<n.length;m++){const g=n[m],y=i.getTile(g),_=y.getBucket(r);if(!_)continue;const v=bt(g,_,u);let x=v;0===o[0]&&0===o[1]||(x=t.translatePosMatrix(v,y,o,s));const b=a?_.textCollisionBox:_.iconCollisionBox,w=_.collisionCircleArray;if(w.length>0){const t=e.create(),i=x;e.mul(t,_.placementInvProjMatrix,u.glCoordMatrix),e.mul(t,t,_.placementViewportMatrix),d.push({circleArray:w,circleOffset:f,transform:i,invTransform:t,projection:_.getProjection()}),p+=w.length/4,f=p}b&&(t.terrain&&t.terrain.setupElevationDraw(y,h),h.draw(l,c.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,Ni(x,u,y,_.getProjection()),r.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,null,u.zoom,null,b.collisionVertexBuffer,b.collisionVertexBufferExt))}if(!a||!d.length)return;const m=t.useProgram("collisionCircle"),g=new e.StructArrayLayout2f1f2i16;g.resize(4*p),g._trim();let y=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];g.emplace(y++,r,n,o,s,0),g.emplace(y++,r,n,o,s,1),g.emplace(y++,r,n,o,s,2),g.emplace(y++,r,n,o,s,3)}(!or||or.length<2*p)&&(or=function(t){const i=2*t,r=new e.StructArrayLayout3ui6;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(p));const _=l.createIndexBuffer(or,!0),v=l.createVertexBuffer(g,e.collisionCircleLayout.members,!0);for(const i of d){const n={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(x=u).getCameraToCenterDistance(i.projection),u_viewport_size:[x.width,x.height]};m.draw(l,c.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,n,r.id,v,_,e.SegmentVector.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var x;v.destroy(),_.destroy()}const ar=e.create();function lr(t,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=e.getAnchorAlignment(t),c=-(a-.5)*i,u=-(l-.5)*r,h=e.evaluateVariableOffset(t,n);return new e.pointGeometry((c/o+h[0])*s,(u/o+h[1])*s)}function cr(t,i,r,n,o,s,a,l,c,u,h){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=wt(l,t.getProjection(),s),y=s.elevation,_=t.getProjection().upVectorScale(l.canonical,s.center.lat,s.worldSize);p.clear();for(let f=0;f<d.length;f++){const v=d.get(f),x=t.allowVerticalPlacement&&!v.placedOrientation,b=v.hidden||!v.crossTileID||x?null:n[v.crossTileID];if(b){const n=new e.pointGeometry(v.tileAnchorX,v.tileAnchorY),d=t.getProjection().upVector(l.canonical,n.x,n.y),f=y?y.getAtTileOffset(l,n.x,n.y):0,x=ot([v.projectedAnchorX+f*d[0]*_.metersToTile,v.projectedAnchorY+f*d[1]*_.metersToTile,v.projectedAnchorZ+f*d[2]*_.metersToTile],r?g:a),w=st(s.getCameraToCenterDistance(t.getProjection()),x.signedDistanceFromCamera);let T=o.evaluateSizeForFeature(t.textSizeData,u,v)*w/e.ONE_EM;r&&(T*=t.tilePixelRatio/c);const{width:S,height:C,anchor:M,textOffset:k,textScale:E}=b,A=lr(M,S,C,k,E,T);let I;if(r){const e=n.add(A),{x:i,y:r,z:o}=t.getProjection().projectTilePoint(e.x,e.y,l.canonical);I=ot([i+f*d[0]*_.metersToTile,r+f*d[1]*_.metersToTile,o+f*d[2]*_.metersToTile],a).point}else{const e=i?A.rotate(-s.angle):A;I=[x.point[0]+e.x,x.point[1]+e.y,0]}const z=t.allowVerticalPlacement&&v.placedOrientation===e.WritingMode.vertical?Math.PI/2:0;for(let t=0;t<v.numGlyphs;t++)e.addDynamicAttributes(p,I[0],I[1],I[2],z);h&&v.associatedIconIndex>=0&&(m[v.associatedIconIndex]={shiftedAnchor:I,angle:z})}else gt(v.numGlyphs,p)}if(h){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t);if(r.hidden)gt(r.numGlyphs,f);else{const i=m[t];if(i)for(let t=0;t<r.numGlyphs;t++)e.addDynamicAttributes(f,i.shiftedAnchor[0],i.shiftedAnchor[1],i.shiftedAnchor[2],i.angle);else gt(r.numGlyphs,f)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function ur(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function hr(t,i,r,n,o,s,a,l,c,u,h,d){const p=t.context,f=p.gl,m=t.transform,g="map"===l,y="map"===c,_=g&&"point"!==r.layout.get("symbol-placement"),v=g&&!y&&!_,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let b=!1;const w=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),T=[e.mercatorXfromLng(m.center.lng),e.mercatorYfromLat(m.center.lat)],S=r.layout.get("text-variable-anchor"),C="globe"===m.projection.name,M=[],k=[0,-1,0];let E=k;!C&&!m.mercatorFromTransition||g||(E=function(t){const i=t._camera.getWorldToCamera(t.worldSize,1),r=e.multiply([],i,t.globeMatrix);e.invert(r,r);const n=[0,0,0],o=[0,1,0,0];return e.transformMat4$1(o,o,r),n[0]=o[0],n[1]=o[1],n[2]=o[2],e.normalize(n,n),n}(m));for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;if("mercator"===c.projection.name&&C)continue;const h=o?c.text:c.icon;if(!h||c.fullyClipped||!h.segments.get().length)continue;const d=h.programConfigurations.get(r.id),p=o||c.sdfIcons,w=o?c.textSizeData:c.iconSizeData,A=y||0!==m.pitch,I=e.evaluateSizeForZoom(w,m.zoom);let z,P,L,D,R=[0,0],B=null;if(o){if(P=n.glyphAtlasTexture,L=f.LINEAR,z=n.glyphAtlasTexture.size,c.iconsInText){R=n.imageAtlasTexture.size,B=n.imageAtlasTexture;const e="composite"===w.kind||"camera"===w.kind;D=A||t.options.rotating||t.options.zooming||e?f.LINEAR:f.NEAREST}}else{const e=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;P=n.imageAtlasTexture,L=p||t.options.rotating||t.options.zooming||e||A?f.LINEAR:f.NEAREST,z=n.imageAtlasTexture.size}const O="globe"===c.projection.name,F=O?E:k,j=O?e.globeToMercatorTransition(m.zoom):0,$=wt(l,c.getProjection(),m),N=m.calculatePixelsToTileUnitsMatrix(n),U=tt($,n.tileID.canonical,y,g,m,c.getProjection(),N),V=t.terrain&&y&&_?e.invert(e.create(),U):ar,G=rt($,n.tileID.canonical,y,g,m,c.getProjection(),N),q=S&&c.hasTextData(),Z="none"!==r.layout.get("icon-text-fit")&&q&&c.hasIconData();if(_){const e=m.elevation,i=e?e.getAtTileOffsetFunc(l,m.center.lat,m.worldSize,c.getProjection()):e=>[0,0,0],r=it($,n.tileID.canonical,y,g,m,c.getProjection(),N);lt(c,$,t,o,r,G,y,u,i,l)}const W=_||o&&S||Z,H=t.translatePosMatrix($,n,s,a),X=W?ar:U,K=t.translatePosMatrix(G,n,s,a,!0),Y=c.getProjection().createInversionMatrix(m,l.canonical),J=[];t.terrain&&y&&J.push("PITCH_WITH_MAP_TERRAIN"),O&&J.push("PROJECTION_GLOBE_VIEW"),W&&J.push("PROJECTED_POS_ON_VIEWPORT");const Q=p&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let ee;ee=p?c.iconsInText?tr(w.kind,I,v,y,t,H,X,K,z,R,l,j,T,Y,F,c.getProjection()):er(w.kind,I,v,y,t,H,X,K,o,z,!0,l,j,T,Y,F,c.getProjection()):Qi(w.kind,I,v,y,t,H,X,K,o,z,l,j,T,Y,F,c.getProjection());const te={program:t.useProgram(ur(p,o,c),d,J),buffers:h,uniformValues:ee,atlasTexture:P,atlasTextureIcon:B,atlasInterpolation:L,atlasInterpolationIcon:D,isSDF:p,hasHalo:Q,tile:n,labelPlaneMatrixInv:V};if(x&&c.canOverlap){b=!0;const t=h.segments.get();for(const i of t)M.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:te})}else M.push({segments:h.segments,sortKey:0,state:te})}b&&M.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of M){const i=e.state;if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:!C,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,f.CLAMP_TO_EDGE),i.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,dr(i.buffers,e.segments,r,t,i.program,w,h,d,n)),n.u_is_halo=0}dr(i.buffers,e.segments,r,t,i.program,w,h,d,i.uniformValues)}}function dr(t,i,r,n,o,s,a,l,c){const u=n.context;o.draw(u,u.gl.TRIANGLES,s,a,l,e.CullFaceMode.disabled,c,r.id,t.layoutVertexBuffer,t.indexBuffer,i,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.globeExtVertexBuffer)}function pr(t,i,r,n,o,s,a){const l=t.context.gl,c=r.paint.get("fill-pattern"),u=c&&c.constantOr(1),h=r.getCrossfadeParameters();let d,p,f,m,g;a?(p=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=l.LINES):(p=u?"fillPattern":"fill",d=l.TRIANGLES);for(const y of n){const n=i.getTile(y);if(u&&!n.patternsLoaded())continue;const _=n.getBucket(r);if(!_)continue;t.prepareDrawTile();const v=_.programConfigurations.get(r.id),x=t.useProgram(p,v);u&&(t.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const b=c.constantOr(null);if(b&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[b.to.toString()],i=e.patternPositions[b.from.toString()];t&&i&&v.setConstantPatternPositions(t,i)}const w=t.translatePosMatrix(y.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){m=_.indexBuffer2,g=_.segments2;const e=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[l.drawingBufferWidth,l.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Oi(w,t,h,n,e):Bi(w,e)}else m=_.indexBuffer,g=_.segments,f=u?Ri(w,t,h,n):Di(w);t.prepareDrawProgram(t.context,x,y.toUnwrapped()),x.draw(t.context,d,o,t.stencilModeForClipping(y),s,e.CullFaceMode.disabled,f,r.id,_.layoutVertexBuffer,m,g,r.paint,t.transform.zoom,v)}}function fr(t,i,r,n,o,s,a){const l=t.context,c=l.gl,u=t.transform,h=r.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=r.getCrossfadeParameters(),f=r.paint.get("fill-extrusion-opacity"),m="globe"===u.projection.name?e.fillExtrusionHeightLift():0,g="globe"===u.projection.name,y=g?e.globeToMercatorTransition(u.zoom):0,_=[e.mercatorXfromLng(u.center.lng),e.mercatorYfromLat(u.center.lat)],v=[];g&&v.push("PROJECTION_GLOBE_VIEW");for(const x of n){const n=i.getTile(x),b=n.getBucket(r);if(!b||b.projection.name!==u.projection.name)continue;const w=b.programConfigurations.get(r.id),T=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",w,v);if(t.terrain){const e=t.terrain;if(t.style.terrainSetForDrapingOnly())e.setupElevationDraw(n,T,{useMeterToDem:!0});else{if(!b.enableTerrain)continue;if(e.setupElevationDraw(n,T,{useMeterToDem:!0}),mr(l,i,x,b,r,e),!b.centroidVertexBuffer){const e=T.attributes.a_centroid_pos;void 0!==e&&c.vertexAttrib2f(e,0,0)}}}d&&(t.context.activeTexture.set(c.TEXTURE0),n.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),w.updatePaintBuffers(p));const S=h.constantOr(null);if(S&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[S.to.toString()],i=e.patternPositions[S.from.toString()];t&&i&&w.setConstantPatternPositions(t,i)}const C=t.translatePosMatrix(x.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),M=u.projection.createInversionMatrix(u,x.canonical),k=r.paint.get("fill-extrusion-vertical-gradient"),E=d?Li(C,t,k,f,x,p,n,m,y,_,M):Pi(C,t,k,f,x,m,y,_,M);t.prepareDrawProgram(l,T,x.toUnwrapped()),T.draw(l,l.gl.TRIANGLES,o,s,a,e.CullFaceMode.backCCW,E,r.id,b.layoutVertexBuffer,b.indexBuffer,b.segments,r.paint,t.transform.zoom,w,t.terrain?b.centroidVertexBuffer:null,g?b.layoutVertexExtBuffer:null)}}function mr(t,i,r,n,o,s){const a=[t=>{let i=t.canonical.x-1,r=t.wrap;return i<0&&(i=(1<<t.canonical.z)-1,r--),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>{let i=t.canonical.x+1,r=t.wrap;return i===1<<t.canonical.z&&(i=0,r++),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,i,t.canonical.y)},t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)],l=e=>{const t=i.getSource().minzoom,r=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},n=[0,-1,1];for(const i of n){if(e.overscaledZ+i<t)continue;const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},c=[0,0,0],u=(t,i)=>(c[0]=Math.min(t.min.y,i.min.y),c[1]=Math.max(t.max.y,i.max.y),c[2]=e.EXTENT-i.min.x>t.max.x?i.min.x-e.EXTENT:t.max.x,c),h=(t,i)=>(c[0]=Math.min(t.min.x,i.min.x),c[1]=Math.max(t.max.x,i.max.x),c[2]=e.EXTENT-i.min.y>t.max.y?i.min.y-e.EXTENT:t.max.y,c),d=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>h(e,t),(e,t)=>h(t,e)],p=new e.pointGeometry(0,0);let f,m,g;const y=(t,i,n,o,a)=>{const l=[[o?n:t,o?t:n,0],[o?n:i,o?i:n,0]],c=a<0?e.EXTENT+a:a,u=[o?c:(t+i)/2,o?(t+i)/2:c,0];return 0===n&&a<0||0!==n&&a>0?s.getForTilePoints(g,[u],!0,m):l.push(u),s.getForTilePoints(r,l,!0,f),Math.max(l[0][2],l[1][2],u[2])/s.exaggeration()};for(let t=0;t<4;t++){const i=(t<2?1:5)-t,o=n.borders[t];if(0===o.length)continue;const c=g=a[t](r),u=l(c);if(!(u&&u instanceof e.FillExtrusionBucket&&u.enableTerrain))continue;if(n.borderDoneWithNeighborZ[t]===u.canonical.z&&u.borderDoneWithNeighborZ[i]===n.canonical.z)continue;if(m=s.findDEMTileFor(c),!m||!m.dem)continue;if(!f){const e=s.findDEMTileFor(r);if(!e||!e.dem)return;f=e}const h=u.borders[i];let _=0;const v=u.borderDoneWithNeighborZ[i]!==n.canonical.z;if(n.canonical.z===u.canonical.z){for(let r=0;r<o.length;r++){const s=n.featuresOnBorder[o[r]],a=s.borders[t];let l;for(;_<h.length&&(l=u.featuresOnBorder[h[_]],!(l.borders[i][1]>a[0]+3));)v&&u.encodeCentroid(void 0,l,!1),_++;if(l&&_<h.length){const r=_;let o=0;for(;!(l.borders[i][0]>a[1]-3)&&(o++,++_!==h.length);)l=u.featuresOnBorder[h[_]];if(l=u.featuresOnBorder[h[r]],s.intersectsCount()>1||l.intersectsCount()>1||1!==o){1!==o&&(_=r),n.encodeCentroid(void 0,s,!1),v&&u.encodeCentroid(void 0,l,!1);continue}const c=d[t](s,l),f=t%2?e.EXTENT-1:0;p.x=y(c[0],Math.min(e.EXTENT-1,c[1]),f,t<2,c[2]),p.y=0,n.encodeCentroid(p,s,!1),v&&u.encodeCentroid(p,l,!1)}else n.encodeCentroid(void 0,s,!1)}n.borderDoneWithNeighborZ[t]=u.canonical.z,n.needsCentroidUpdate=!0,v&&(u.borderDoneWithNeighborZ[i]=n.canonical.z,u.needsCentroidUpdate=!0)}else{for(const e of o)n.encodeCentroid(void 0,n.featuresOnBorder[e],!1);if(v){for(const e of h)u.encodeCentroid(void 0,u.featuresOnBorder[e],!1);u.borderDoneWithNeighborZ[i]=n.canonical.z,u.needsCentroidUpdate=!0}n.borderDoneWithNeighborZ[t]=u.canonical.z,n.needsCentroidUpdate=!0}}(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const gr=new e.Color(1,0,0,1),yr=new e.Color(0,1,0,1),_r=new e.Color(0,0,1,1),vr=new e.Color(1,0,1,1),xr=new e.Color(0,1,1,1);function br(e,t,i,r){Tr(e,0,t+i/2,e.transform.width,i,r)}function wr(e,t,i,r){Tr(e,t-i/2,0,i,e.transform.height,r)}function Tr(t,i,r,n,o,s){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.exported.devicePixelRatio,r*e.exported.devicePixelRatio,n*e.exported.devicePixelRatio,o*e.exported.devicePixelRatio),a.clear({color:s}),l.disable(l.SCISSOR_TEST)}function Sr(t,i,r){const n=t.context,o=n.gl,s="globe"===t.transform.projection.name,a=r.projMatrix,l=t.useProgram("debug",null,s?["PROJECTION_GLOBE_VIEW"]:null),c=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(c,l);const u=e.DepthMode.disabled,h=e.StencilMode.disabled,d=t.colorModeForRenderPass(),p="$debug";n.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?c._makeGlobeTileDebugBuffers(t.context,t.transform.projection):c._makeDebugTileBoundsBuffers(t.context,t.transform.projection);const f=c._tileDebugBuffer||t.debugBuffer,m=c._tileDebugIndexBuffer||t.debugIndexBuffer,g=c._tileDebugSegments||t.debugSegments;l.draw(n,o.LINE_STRIP,u,h,d,e.CullFaceMode.disabled,Ui(a,e.Color.red),p,f,m,g,null,null,null,c._globeTileDebugBorderBuffer);const y=c.latestRawTileData,_=Math.floor((y&&y.byteLength||0)/1024),v=i.getTile(r).tileSize,x=512/Math.min(v,512)*(r.overscaledZ/t.transform.zoom)*.5;let b=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(b+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,`${b} ${_}kb`);const w=c._tileDebugTextBuffer||t.debugBuffer,T=c._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,S=c._tileDebugTextSegments||t.debugSegments;l.draw(n,o.TRIANGLES,u,h,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,Ui(a,e.Color.transparent,x),p,w,T,S,null,null,null,c._globeTileDebugTextBuffer)}const Cr=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mr}=Cr;function kr(e,t,i,r){e.emplaceBack(t,i,r)}class Er{constructor(t){this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,kr(this.vertexArray,-1,-1,1),kr(this.vertexArray,1,-1,1),kr(this.vertexArray,-1,1,1),kr(this.vertexArray,1,1,1),kr(this.vertexArray,-1,-1,-1),kr(this.vertexArray,1,-1,-1),kr(this.vertexArray,-1,1,-1),kr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Mr),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)}}function Ar(t,i,r,n,o,s){const a=t.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),h=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.fromMat4(e.create$1(),n),o,u,l,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,i.skyboxTexture,0),r.draw(t,a.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Ir=e.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class zr{constructor(t){const i=new e.StructArrayLayout5f20;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new e.StructArrayLayout3ui6;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Ir.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pr={symbol:function(t,i,r,n,o){if("translucent"!==t.renderPass)return;const s=e.StencilMode.disabled,a=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,o,s,a){const l=i.transform,c="map"===o,u="map"===s;for(const i of t){const t=n.getTile(i),o=t.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)continue;const s=e.evaluateSizeForZoom(o.textSizeData,l.zoom),h=wt(i,o.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=tt(h,t.tileID.canonical,u,c,l,o.getProjection(),d),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(s){const r=Math.pow(2,l.zoom-t.tileID.overscaledZ);cr(o,c,u,a,e.symbolSize,l,p,i,r,s,f)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&hr(t,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&hr(t,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),i.map.showCollisionBoxes&&(sr(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),sr(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=t.context,u=c.gl,h=t.transform,d=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),p=e.StencilMode.disabled,f=t.colorModeForRenderPass(),m="globe"===h.projection.name,g=[e.mercatorXfromLng(h.center.lng),e.mercatorYfromLat(h.center.lat)],y=[];for(let o=0;o<n.length;o++){const s=n[o],a=i.getTile(s),c=a.getBucket(r);if(!c||c.projection.name!==h.projection.name)continue;const u=c.programConfigurations.get(r.id),d=$i(r);m&&d.push("PROJECTION_GLOBE_VIEW");const p=t.useProgram("circle",u,d),f=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,v=c.indexBuffer,x=h.projection.createInversionMatrix(h,s.canonical),b={programConfiguration:u,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:_,indexBuffer:v,uniformValues:ji(t,s,a,x,g,r),tile:a};if(l){const t=c.segments.get();for(const i of t)y.push({segments:new e.SegmentVector([i]),sortKey:i.sortKey,state:b})}else y.push({segments:c.segments,sortKey:0,state:b})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const _={useDepthForOcclusion:!m};for(const i of y){const{programConfiguration:n,program:o,layoutVertexBuffer:s,globeExtVertexBuffer:a,indexBuffer:l,uniformValues:g,tile:y}=i.state,v=i.segments;t.terrain&&t.terrain.setupElevationDraw(y,o,_),t.prepareDrawProgram(c,o,y.tileID.toUnwrapped()),o.draw(c,u.TRIANGLES,d,p,f,e.CullFaceMode.disabled,g,r.id,s,l,v,r.paint,h.zoom,n,m?a:null)}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,s=o.gl,a=e.StencilMode.disabled,l=new e.ColorMode([s.ONE,s.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,i,r){const n=e.gl,o=t.width*r,s=t.height*r;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,o,s]);let a=i.heatmapFbo;if(!a||a&&(a.width!==o||a.height!==s)){a&&a.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),a=i.heatmapFbo=e.createFramebuffer(o,s,!1),function(e,t,i,r,n,o){const s=e.gl;s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,o,0,s.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:s.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,0,t,a,o,s)}else n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer)}(o,t,r,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.Color.transparent});const c=t.transform,u="globe"===c.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=u?e.CullFaceMode.frontCCW:e.CullFaceMode.disabled,p=[e.mercatorXfromLng(c.center.lng),e.mercatorYfromLat(c.center.lat)];for(let f=0;f<n.length;f++){const m=n[f];if(i.hasRenderableParent(m))continue;const g=i.getTile(m),y=g.getBucket(r);if(!y||y.projection.name!==c.projection.name)continue;const _=y.programConfigurations.get(r.id),v=t.useProgram("heatmap",_,h),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(g,v),t.prepareDrawProgram(o,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(o,s.TRIANGLES,e.DepthMode.disabled,a,l,d,Gi(t,m,g,b,p,x,r.paint.get("heatmap-intensity")),r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,r.paint,t.transform.zoom,_,u?y.globeExtVertexBuffer:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,o=i.heatmapFbo;if(!o)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let s=i.colorRampTexture;s||(s=i.colorRampTexture=new e.Texture(r,i.colorRamp,n.RGBA)),s.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,n.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,((e,t,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),c=t.terrain&&t.terrain.renderingToTexture?1:e.exported.devicePixelRatio,u=r.paint.get("line-dasharray"),h=u.constantOr(1),d=r.layout.get("line-cap"),p=r.paint.get("line-pattern"),f=p.constantOr(1),m=r.paint.get("line-gradient"),g=r.getCrossfadeParameters(),y=f?"linePattern":"line",_=t.context,v=_.gl,x=(e=>{const t=[];Xi(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET");const r=e.paint.get("line-pattern").constantOr(1),n=1!==e.paint.get("line-opacity").constantOr(1);return!r&&n&&t.push("RENDER_LINE_ALPHA_DISCARD"),t})(r);let b=x.includes("RENDER_LINE_ALPHA_DISCARD");t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(b=!1);for(const o of n){const n=i.getTile(o);if(f&&!n.patternsLoaded())continue;const s=n.getBucket(r);if(!s)continue;t.prepareDrawTile();const w=s.programConfigurations.get(r.id),T=t.useProgram(y,w,x),S=p.constantOr(null);if(S&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[S.to.toString()],i=e.patternPositions[S.from.toString()];t&&i&&w.setConstantPatternPositions(t,i)}const C=u.constantOr(null),M=d.constantOr(null);if(!f&&C&&M&&n.lineAtlas){const e=n.lineAtlas,t=e.getDash(C.to,M),i=e.getDash(C.from,M);t&&i&&w.setConstantPatternPositions(t,i)}let[k,E]=r.paint.get("line-trim-offset");if("round"===M||"square"===M){const e=1;k!==E&&(0===k&&(k-=e),1===E&&(E+=e))}const A=t.terrain?o.projMatrix:null,I=f?Zi(t,n,r,g,A,c):qi(t,n,r,g,A,s.lineClipsArray.length,c,[k,E]);if(m){const n=s.gradients[r.id];let a=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-o.canonical.z):1;l=e.clamp(e.nextPowerOfTwo(s.maxLineLength/e.EXTENT*1024*n),256,_.maxTextureSize)}n.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:s.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.Texture(_,n.gradient,v.RGBA),n.version=r.gradientVersion,a=n.texture}_.activeTexture.set(v.TEXTURE1),a.bind(r.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}h&&(_.activeTexture.set(v.TEXTURE0),n.lineAtlasTexture.bind(v.LINEAR,v.REPEAT),w.updatePaintBuffers(g)),f&&(_.activeTexture.set(v.TEXTURE0),n.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),w.updatePaintBuffers(g)),t.prepareDrawProgram(_,T,o.toUnwrapped());const z=i=>{T.draw(_,v.TRIANGLES,a,i,l,e.CullFaceMode.disabled,I,r.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,r.paint,t.transform.zoom,w,s.layoutVertexBuffer2)};if(b){const i=t.stencilModeForClipping(o).ref;0===i&&t.terrain&&_.clear({stencil:0});const r={func:v.EQUAL,mask:255};I.u_alpha_discard_threshold=.8,z(new e.StencilMode(r,i,255,v.KEEP,v.KEEP,v.INVERT)),I.u_alpha_discard_threshold=0,z(new e.StencilMode(r,i,255,v.KEEP,v.KEEP,v.KEEP))}else z(t.stencilModeForClipping(o))}b&&(t.resetStencilClippingMasks(),t.terrain&&_.clear({stencil:0}))},fill:function(t,i,r,n){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),c=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(e.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(t.renderPass===c){const o=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);pr(t,i,r,n,o,a,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const o=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);pr(t,i,r,n,o,a,!0)}},"fill-extrusion":function(t,i,r,n){const o=r.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===t.renderPass){const s=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==o||r.paint.get("fill-extrusion-pattern").constantOr(1))fr(t,i,r,n,s,e.StencilMode.disabled,e.ColorMode.disabled),fr(t,i,r,n,s,t.stencilModeFor3D(),t.colorModeForRenderPass()),t.resetStencilClippingMasks();else{const o=t.colorModeForRenderPass();fr(t,i,r,n,s,e.StencilMode.disabled,o)}}},hillshade:function(t,i,r,n){if("offscreen"!==t.renderPass&&"translucent"!==t.renderPass)return;const o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),a=t.colorModeForRenderPass(),l=t.terrain&&t.terrain.renderingToTexture,[c,u]="translucent"!==t.renderPass||l?[{},n]:t.stencilConfigForOverlap(n);for(const n of u){const o=i.getTile(n);if(o.needsHillshadePrepare&&"offscreen"===t.renderPass)fi(t,o,r,s,e.StencilMode.disabled,a);else if("translucent"===t.renderPass){const e=l&&t.terrain?t.terrain.stencilModeForRTTOverlap(n):c[n.overscaledZ];di(t,n,o,r,s,e,a)}}o.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,i,r,n,o,s){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!n.length)return;const a=t.context,l=a.gl,c=i.getSource(),u=t.useProgram("raster"),h=t.colorModeForRenderPass(),d=t.terrain&&t.terrain.renderingToTexture,[p,f]=c instanceof Ie||d?[{},n]:t.stencilConfigForOverlap(n),m=f[f.length-1].overscaledZ,g=!t.options.moving;for(const n of f){const o=d?e.DepthMode.disabled:t.depthModeForSublayer(n.overscaledZ-m,1===r.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,l.LESS),f=n.toUnwrapped(),y=i.getTile(n);if(d&&(!y||!y.hasData()))continue;const _=d?n.projMatrix:t.transform.calculateProjMatrix(f,g),v=t.terrain&&d?t.terrain.stencilModeForRTTOverlap(n):p[n.overscaledZ],x=s?0:r.paint.get("raster-fade-duration");y.registerFadeDuration(x);const b=i.findLoadedParent(n,0),w=Ti(y,b,i,t.transform,x);let T,S;t.terrain&&t.terrain.prepareDrawTile();const C="nearest"===r.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;a.activeTexture.set(l.TEXTURE0),y.texture.bind(C,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),b?(b.texture.bind(C,l.CLAMP_TO_EDGE),T=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),S=[y.tileID.canonical.x*T%1,y.tileID.canonical.y*T%1]):y.texture.bind(C,l.CLAMP_TO_EDGE);const M=Ki(_,S||[0,0],T||1,w,r,c instanceof Ie?c.perspectiveTransform:[0,0]);if(t.prepareDrawProgram(a,u,f),c instanceof Ie)c.boundsBuffer&&c.boundsSegments&&u.draw(a,l.TRIANGLES,o,e.StencilMode.disabled,h,e.CullFaceMode.disabled,M,r.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments);else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:n,tileBoundsSegments:s}=t.getTileBoundsBuffers(y);u.draw(a,l.TRIANGLES,o,v,h,e.CullFaceMode.disabled,M,r.id,i,n,s)}}t.resetStencilClippingMasks()},background:function(t,i,r,n){const o=r.paint.get("background-color"),s=r.paint.get("background-opacity");if(0===s)return;const a=t.context,l=a.gl,c=t.transform,u=c.tileSize,h=r.paint.get("background-pattern");if(t.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==d)return;const p=e.StencilMode.disabled,f=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),m=t.colorModeForRenderPass(),g=t.useProgram(h?"backgroundPattern":"background");let y,_=n;_||(y=t.getBackgroundTiles(),_=Object.values(y).map((e=>e.tileID))),h&&(a.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));const v=r.getCrossfadeParameters();for(const d of _){const _=d.toUnwrapped(),x=n?d.projMatrix:t.transform.calculateProjMatrix(_);t.prepareDrawTile();const b=i?i.getTile(d):y?y[d.key]:new e.Tile(d,u,c.zoom,t),w=h?rr(x,s,t,h,{tileID:d,tileSize:u},v):ir(x,s,o);t.prepareDrawProgram(a,g,_);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:S,tileBoundsSegments:C}=t.getTileBoundsBuffers(b);g.draw(a,l.TRIANGLES,f,p,m,e.CullFaceMode.disabled,w,r.id,T,S,C)}},sky:function(t,i,r){const n=t.transform,o="mercator"===n.projection.name||"globe"===n.projection.name?1:e.smoothstep(7,8,n.zoom),s=r.paint.get("sky-opacity")*o;if(0===s)return;const a=t.context,l=r.paint.get("sky-type"),c=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),u=t.frameCounter/1e3%1;"atmosphere"===l?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i,r,n){const o=t.context,s=o.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=o.createFramebuffer(32,32,!1),i.skyboxGeometry=new Er(o),i.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,i.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let e=0;e<6;++e)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.useProgram("skyboxCapture"),u=new Float64Array(16);e.identity(u),e.rotateY(u,u,.5*-Math.PI),Ar(o,i,c,u,l,0),e.identity(u),e.rotateY(u,u,.5*Math.PI),Ar(o,i,c,u,l,1),e.identity(u),e.rotateX(u,u,.5*-Math.PI),Ar(o,i,c,u,l,2),e.identity(u),e.rotateX(u,u,.5*Math.PI),Ar(o,i,c,u,l,3),e.identity(u),Ar(o,i,c,u,l,4),e.identity(u),e.rotateY(u,u,Math.PI),Ar(o,i,c,u,l,5),o.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,i,r,n,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(l.skyboxMatrix,i.getCenter(t,!1),0,n,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,c,s,u):"gradient"===l&&"sky"===t.renderPass&&function(t,i,r,n,o){const s=t.context,a=s.gl,l=t.transform,c=t.useProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Er(s)),s.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new e.Texture(s,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((t,i,r,n,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.degToRad(r),u_opacity:n,u_temporal_offset:o}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,o);t.prepareDrawProgram(s,c),c.draw(s,a.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,c,s,u)},debug:function(e,t,i){for(let r=0;r<i.length;r++)Sr(e,t,i[r])},custom:function(t,i,r){const n=t.context,o=r.implementation;if(t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes("custom"))e.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===t.renderPass){const e=o.prerender;e&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),e.call(o,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(e.StencilMode.disabled);const i="3d"===o.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);n.setDepthMode(i),o.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}};class Lr{constructor(t,i){this.context=new Me(t),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ht,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ki(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=t.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,i){if(this.width=t*e.exported.devicePixelRatio,this.height=i*e.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._layers[e].resize()}setup(){const t=this.context,i=new e.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(e.EXTENT,0),i.emplaceBack(0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(i,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);const r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);const n=new e.StructArrayLayout2i4;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);const o=new e.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(e.EXTENT,0,e.EXTENT,0),o.emplaceBack(0,e.EXTENT,0,e.EXTENT),o.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.boundsAttributes.members),this.mercatorBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);const s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new e.StructArrayLayout1ui2;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.Texture(t,new e.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.create();const l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now()),this.atmosphereBuffer=new zr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,i=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,i.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,wi(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,i,r){if(!i||this.currentStencilSource===i.id||!t.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=i.id;const n=this.context,o=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(e.ColorMode.disabled),n.setDepthMode(e.DepthMode.disabled);const s=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const t of r){const r=i.getTile(t),a=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:l,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=this.getTileBoundsBuffers(r);s.draw(n,o.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:o.ALWAYS,mask:0},a,255,o.KEEP,o.KEEP,o.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,wi(t.projMatrix),"$clipping",l,c,u)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,i=this.context.gl;return new e.StencilMode({func:i.NOTEQUAL,mask:255},t,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const i=this.context.gl;return new e.StencilMode({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(t){const i=this.context.gl,r=t.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),n=r[r.length-1].overscaledZ,o=r[0].overscaledZ-n+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const t={};for(let r=0;r<o;r++)t[r+n]=new e.StencilMode({func:i.GEQUAL,mask:255},r+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=o,[t,r]}return[{[n]:e.StencilMode.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}depthModeForSublayer(t,i,r){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(r||this.context.gl.LEQUAL,i,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,i){this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.exported.now()),this.imageManager.beginFrame();const r=this.style.order,n=this.style._sourceCaches;for(const e in n){const t=n[e];t.used&&t.prepare(this.context)}const o={},s={},a={};for(const e in n){const t=n[e];o[e]=t.getVisibleCoordinates(),s[e]=o[e].slice().reverse(),a[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<r.length;e++)if(this.style._layers[r[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.GlobeSharedBuffers(this.context)),e.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const e of r){const i=this.style._layers[e],r=t._getLayerSourceCache(i);if(!i.hasOffscreenPass()||i.isHidden(this.transform.zoom))continue;const n=r?s[r.id]:void 0;("custom"===i.type||i.isSky()||n&&n.length)&&this.renderLayer(this,r,i,n)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:i.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky())continue;const n=i?s[i.id]:void 0;this._renderTileClippingMasks(e,i,n),this.renderLayer(this,i,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&function(t,i){const r=t.context,n=r.gl,o=t.transform,s=new e.DepthMode(n.LEQUAL,e.DepthMode.ReadOnly,[0,1]),a=t.useProgram("globeAtmosphere",null,"globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),l=e.globeToMercatorTransition(o.zoom),c=i.properties.get("color").toArray01(),u=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),d=e.identity$1([]);e.rotateY$1(d,d,-e.degToRad(o._center.lng)),e.rotateX$1(d,d,e.degToRad(o._center.lat)),e.rotateZ$1(d,d,o.angle),e.rotateX$1(d,d,-o._pitch);const p=e.fromQuat(new Float32Array(16),d),f=e.mapValue(i.properties.get("star-intensity"),0,1,0,.25),m=5e-4,g=e.mapValue(i.properties.get("horizon-blend"),0,1,m,.25),y=e.globeUseCustomAntiAliasing(t,r,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,_=t.frameCounter/1e3%1,v=e.length(o.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(y,2)),b=Math.acos(x/v),w=((t,i,r,n,o,s,a,l,c,u,h,d,p,f)=>({u_frustum_tl:t,u_frustum_tr:i,u_frustum_br:r,u_frustum_bl:n,u_horizon:o,u_transition:s,u_fadeout_range:a,u_color:l,u_high_color:c,u_space_color:u,u_star_intensity:h,u_star_size:5*e.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:d,u_horizon_angle:p,u_rotation_matrix:f}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,l,g,c,u,h,f,_,b,p);t.prepareDrawProgram(r,a);const T=t.atmosphereBuffer;T&&a.draw(r,n.TRIANGLES,s,e.StencilMode.disabled,e.ColorMode.alphaBlended,e.CullFaceMode.backCW,w,"skybox",T.vertexBuffer,T.indexBuffer,T.segments)}(this,this.style.fog),this.renderPass="sky",(e.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?s[i.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){const e=this.style._layers[r[this.currentLayer]],i=t._getLayerSourceCache(e);if(e.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const n=i?("symbol"===e.type?a:s)[i.id]:void 0;this._renderTileClippingMasks(e,i,i?o[i.id]:void 0),this.renderLayer(this,i,e,n),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let i=null;e.values(this.style._layers).forEach((e=>{const r=t._getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Pr.debug(this,i,i.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;br(e,e.transform.height-(t.top||0),3,gr),br(e,t.bottom||0,3,yr),wr(e,t.left||0,3,_r),wr(e,e.transform.width-(t.right||0),3,vr);const i=e.transform.centerPoint;!function(e,t,i,r){Tr(e,t-1,i-10,2,20,r),Tr(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,xr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)||Pr[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;let i=this.gpuTimers[e.id];i||(i=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),i.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=e.createQueryEXT();this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,o=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),t[i]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery;let i=0;for(const r of e)i+=t.getQueryObjectEXT(r,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(r);return i}translatePosMatrix(t,i,r,n,o){if(!r[0]&&!r[1])return t;const s=o?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const a=[o?r[0]:L(i,r[0],this.transform.zoom),o?r[1]:L(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.translate(l,t,a),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}currentGlobalDefines(){const e=this.terrain&&this.terrain.renderingToTexture,t=this.style&&this.style.fog,i=[];return this.terrain&&!this.terrain.renderingToTexture&&i.push("TERRAIN"),t&&!e&&0!==t.getOpacity(this.transform.pitch)&&i.push("FOG"),e&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}useProgram(e,t,i){this.cache=this.cache||{};const r=i||[],n=this.currentGlobalDefines().concat(r),o=Ai.cacheKey(e,n,t);return this.cache[o]||(this.cache[o]=new Ai(this.context,e,li[e],t,nr[e],n)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,i,r){if(this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const o=n.getOpacity(this.transform.pitch),s=((t,i,r,n,o,s,a,l,c,u,h)=>{const d=t.transform,p=i.properties.get("color").toArray01();p[3]=n;const f=t.frameCounter/1e3%1;return{u_fog_matrix:r?d.calculateFogTileMatrix(r):t.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:f,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:h,u_globe_transition:e.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,n,r,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.exported.devicePixelRatio,this.transform.height*e.exported.devicePixelRatio]);i.setFogUniformValues(t,s)}}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,i=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)i[n.key]=t[n.key]||new e.Tile(n,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}}class Dr{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.number(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.number(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.number(t.right,i.right,r)),this}getCenter(t,i){const r=e.clamp((this.left+t-this.right)/2,0,t),n=e.clamp((this.top+i-this.bottom)/2,0,i);return new e.pointGeometry(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rr(t,i){const r=e.getColumn(t,3);e.fromQuat(t,i),e.setColumn(t,3,r)}function Br(t,i){const r=e.identity$1([]);return e.rotateZ$1(r,r,-i),e.rotateX$1(r,r,-t),r}function Or(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.length(r)>=1e-15){const t=e.normalize([],r);e.scale$2(n,t,e.dot(n,t)),i[0]=n[0],i[1]=n[1]}const o=e.cross([],i,t);if(e.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Br(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}class Fr{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.MercatorCoordinate?t:new e.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.wrap(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this._elevation?this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)):0,n=this.position,o=e.MercatorCoordinate.fromLngLat(t,r),s=[o.x-n.x,o.y-n.y,o.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Or(s,i)}setPitchBearing(t,i){this.orientation=Br(e.degToRad(t),e.degToRad(-i))}}class jr{constructor(t,i){this._transform=e.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=e.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.setColumn(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.identity$1([]),t&&Rr(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Br(e,t),Rr(this._transform,this._orientation)}forward(){const t=e.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.invert(r,this.getWorldToCamera(t,i)),r}getWorldToCameraPosition(t,i,r){const n=this.position;e.scale$2(n,n,-t);const o=new Float64Array(16);return e.fromScaling(o,[r,r,r]),e.translate(o,o,n),o[10]*=i,o}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),o=this.position;return e.conjugate(n,this._orientation),e.scale$2(o,o,-t),e.fromQuat(r,n),e.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const o=new Float64Array(16);return e.perspective(o,t,i,r,n),o}getDistanceToElevation(t){const i=0===t?0:e.mercatorZfromAltitude(t,this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new jr([...this.position],[...this.orientation])}}function $r(t,i){const r=Ur(t.projection,t.zoom,t.width,t.height),n=function(t,i,r,n,o){const s=new e.LngLat(r.lng-180*Vr,r.lat),a=new e.LngLat(r.lng+180*Vr,r.lat),l=t.project(s.lng,s.lat),c=t.project(a.lng,a.lat),u=-Math.atan2(c.y-l.y,c.x-l.x),h=e.MercatorCoordinate.fromLngLat(r);h.y=e.clamp(h.y,-.999975,.999975);const d=h.toLngLat(),p=t.project(d.lng,d.lat),f=e.MercatorCoordinate.fromLngLat(d);f.x+=Vr;const m=f.toLngLat(),g=t.project(m.lng,m.lat),y=qr(g.x-p.x,g.y-p.y,u),_=e.MercatorCoordinate.fromLngLat(d);_.y+=Vr;const v=_.toLngLat(),x=t.project(v.lng,v.lat),b=qr(x.x-p.x,x.y-p.y,u),w=Math.abs(y.x)/Math.abs(b.y),T=e.identity([]);e.rotateZ(T,T,-u*(1-(o?0:n)));const S=e.identity([]);return e.scale(S,S,[1,1-(1-w)*n,1]),S[4]=-b.x/b.y*n,e.rotateZ(S,S,u),e.multiply(S,T,S),S}(t.projection,0,t.center,r,i),o=Nr(t);return e.scale(n,n,[o,o,1]),n}function Nr(t){const i=t.projection,r=Ur(t.projection,t.zoom,t.width,t.height),n=Gr(i,t.center),o=Gr(i,e.LngLat.convert(i.center));return Math.pow(2,n*r+(1-r)*o)}function Ur(t,i,r,n,o=1/0){const s=t.range;if(!s)return 0;const a=Math.min(o,Math.max(r,n)),l=Math.log(a/1024)/Math.LN2;return e.smoothstep(s[0]+l,s[1]+l,i)}const Vr=1/4e4;function Gr(t,i){const r=e.clamp(i.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),n=new e.LngLat(i.lng-180*Vr,r),o=new e.LngLat(i.lng+180*Vr,r),s=t.project(n.lng,r),a=t.project(o.lng,r),l=e.MercatorCoordinate.fromLngLat(n),c=e.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,d=c.x-l.x,p=c.y-l.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function qr(e,t,i){const r=Math.cos(i),n=Math.sin(i);return{x:e*r-t*n,y:e*n+t*r}}class Zr{constructor(t,i,r,n,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Dr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const e=new Zr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e){const t=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||t)&&this._updateCameraOnTerrain(),(e||t)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return e.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=e.getProjection(this.projectionOptions);const n=!t(r,this.getProjection());return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.pointGeometry(this.width,this.height)}get bearing(){return e.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;var r;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=(r=new e.ARRAY_TYPE(4),e.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=Math.sin(i),l=Math.cos(i);e[0]=r*l+o*a,e[1]=n*l+s*a,e[2]=r*-a+o*l,e[3]=n*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const e=this._elevation;this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,o=0;for(let s=0;s<i.length;s++){const a=new e.pointGeometry(i[s][0]*this.width,r+i[s][1]*(this.height-r)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,o+=c}return 0===o?NaN:n/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.length(e.sub([],this._camera.position,r));return e.clamp(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new Fr;return i.position=new e.MercatorCoordinate(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);const i=e.transformQuat([],[0,0,-1],t),r=e.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=Or(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.clamp(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.pointGeometry(0,0)),n=this.pointCoordinate(new e.pointGeometry(this.width,0)),o=this.pointCoordinate(new e.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new e.pointGeometry(0,this.height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new e.UnwrappedTileID(r,t))}return i}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=this.elevation&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,l=1<<i,c=[l*s.x,l*s.y,0],u="globe"===this.projection.name,h=!u,d=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=l*e.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),g=[l*p.x,l*p.y,m*(h?1:f)],y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),_=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?i:0,v=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,x=t.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?Nr(this):1,w=t=>{const i=1/4e4,r=new e.MercatorCoordinate(t.x+i,t.y,t.z),n=new e.MercatorCoordinate(t.x,t.y+i,t.z),o=t.toLngLat(),s=r.toLngLat(),a=n.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(h*d)*b/i},T=t=>{const i=v,r=x;return{aabb:e.tileAABB(this,l,0,0,0,t,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},S=[];let C=[];const M=i,k=t.reparseOverscaled?r:i,E=e=>e*e,A=E((m-this._centerAltitude)*f),I=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=z(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},z=t=>{if(t.zoom<_)return!0;if(t.zoom===M)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),o=t.aabb.distanceY(g);let s=A,l=1;if(u){s=E(t.aabb.distanceZ(g));const i=Math.pow(2,t.zoom),r=e.latFromMercatorY((t.y+1)/i),n=e.latFromMercatorY(t.y/i),o=Math.min(Math.max(a,r),n),c=e.circumferenceAtLatitude(o)/e.circumferenceAtLatitude(a);if(l=o===a?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.GLOBE_ZOOM_THRESHOLD_MIN&&t.zoom===M-1&&c>=.9)return!0}else if(n&&(s=E(t.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,t.zoom),r=w(new e.MercatorCoordinate((t.x+.5)/i,(t.y+.5)/i));l=r>.85?1:r}const c=i*i+o*o+s;return c<E((1<<M-t.zoom)*y*l*((e,t)=>{if(t*E(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,A),c))};if(this.renderWorldCopies)for(let e=1;e<=3;e++)S.push(T(-e)),S.push(T(e));for(S.push(T(0));S.length>0;){const r=S.pop(),s=r.x,a=r.y;let h=r.fullyVisible;if(!h){const e=r.aabb.intersects(d);if(0===e)continue;h=2===e}if(r.zoom!==M&&z(r))for(let t=0;t<4;t++){const i=(s<<1)+t%2,c=(a<<1)+(t>>1),d={aabb:o?r.aabb.quadrant(t):e.tileAABB(this,l,r.zoom+1,i,c,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:c,wrap:r.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};n&&!u&&(d.tileID=new e.OverscaledTileID(r.zoom+1===M?k:r.zoom+1,r.wrap,r.zoom+1,i,c),I(d)),S.push(d)}else{const n=r.zoom===M?k:r.zoom;if(t.minzoom&&t.minzoom>n)continue;const o=c[0]-(.5+s+(r.wrap<<r.zoom))*(1<<i-r.zoom),l=c[1]-.5-a,u=r.tileID?r.tileID:new e.OverscaledTileID(n,r.wrap,r.zoom,s,a);C.push({tileID:u,distanceSq:o*o+l*l})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();C=C.filter((n=>{const o=[0,0,0,1],s=[e.EXTENT,e.EXTENT,0,1],a=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.transformMat4$1(o,o,a),e.transformMat4$1(s,s,a);const l=e.getAABBPointSquareDist(o,s);if(0===l)return!0;let c=!1;const u=this._elevation;if(u&&l>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=u.getMinMaxForTile(n.tileID)),o||(o={min:x,max:v});const s=e.furthestTileCorner(this.rotation),a=[s[0]*e.EXTENT,s[1]*e.EXTENT,o.max];e.transformMat4(a,a,i),c=(1-a[1])*this.height*.5<r}return l<i||c}))}return C.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.clamp(t.lat,-e.MAX_MERCATOR_LATITUDE,e.MAX_MERCATOR_LATITUDE),r=this.projection.project(t.lng,i);return new e.pointGeometry(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,i){let r,n;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(i.x-o.x)/e,n=(i.y-o.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(o);r=e.x-t.x,n=e.y-t.y}const s=this.locationCoordinate(t);this.setLocation(new e.MercatorCoordinate(s.x-r,s.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const r=i?e.mercatorZfromAltitude(i,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.MercatorCoordinate(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4$1(n,n,this.pixelMatrixInverse),e.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];e.scale$1(n,n,1/n[3]),e.scale$1(o,o,1/s);const a=n[2],l=o[2];return{p0:n,p1:o,t:a===l?0:(r-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.transformMat4$1(i,i,this.pixelMatrixInverse),e.transformMat4$1(r,r,this.pixelMatrixInverse),e.scale$1(i,i,1/i[3]),e.scale$1(r,r,1/r[3]),i[2]=e.mercatorZfromAltitude(i[2],this._center.lat)*this.worldSize,r[2]=e.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,e.scale$1(i,i,1/this.worldSize),e.scale$1(r,r,1/this.worldSize),new e.Ray([i[0],i[1],i[2]],e.normalize([],e.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,o=e.mercatorZfromAltitude(i[2],this._center.lat),s=e.mercatorZfromAltitude(r[2],this._center.lat);return new e.MercatorCoordinate(e.number(i[0],r[0],n)/this.worldSize,e.number(i[1],r[1],n)/this.worldSize,e.number(o,s,n))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.MercatorCoordinate(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const o=.02*n,s=t.clone();for(let t=0;t<10&&n-r>o;t++){s.y=e.number(r,n,.66);const t=this.projection.pointCoordinate3D(this,s.x,s.y);t?(n=s.y,i=t):r=s.y}return i?new e.MercatorCoordinate(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.transformMat4$1(n,n,this.pixelMatrix),n[3]>0?new e.pointGeometry(n[0]/n[3],n[1]/n[3]):new e.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,i){const r=new e.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),n=new e.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new e.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new e.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(r,t),l=this.pointCoordinate(n,t);const c=this.pointCoordinate(o,i),u=this.pointCoordinate(s,i),h=(e,t)=>(t.y-e.y)/(t.x-e.x);return a.y>1&&l.y>=0?a=new e.MercatorCoordinate((1-u.y)/h(u,a)+u.x,1):a.y<0&&l.y<=1&&(a=new e.MercatorCoordinate(-u.y/h(u,a)+u.x,0)),l.y>1&&a.y>=0?l=new e.MercatorCoordinate((1-c.y)/h(c,l)+c.x,1):l.y<0&&a.y<=1&&(l=new e.MercatorCoordinate(-c.y/h(c,l)+c.x,0)),(new e.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(c))}_getBounds3D(){const e=this.elevation;if(!e.visibleDemTiles.length)return this._getBounds(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBounds(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.MAX_MERCATOR_LATITUDE,this.maxLat=e.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=e.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=e.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=e.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=t.canonical,o=1/this.height,s=this.cameraWorldSize/this.zoomScale(n.z),a=(n.x+Math.pow(2,n.z)*t.wrap)*s,l=n.y*s,c=this.point,u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return r[i]={bearing:[h,d],center:[(c.x-a)*o,(c.y-l)*o],scale:s/e.EXTENT*o},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return e.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(t,i=!1){const r=t.key,n=i?this._alignedProjMatrixCache:this._projMatrixCache;if(n[r])return n[r];const o=this.calculatePosMatrix(t,this.worldSize);return e.multiply(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.alignedProjMatrix:this.projMatrix,o),n[r]=new Float32Array(o),n[r]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=function(t,i){const{scale:r}=t.tileTransform,n=r*e.EXTENT/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o=new Float32Array(4),l=(s=i.inverseAdjustmentMatrix)[1],c=s[2],u=s[3],d=(a=[n,n])[1],o[0]=s[0]*(h=a[0]),o[1]=l*h,o[2]=c*d,o[3]=u*d,o;var o,s,a,l,c,u,h,d}(t,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),o=e.mercatorZfromAltitude(1,this._center.lat);r[2]/=o,n[2]/=o,e.normalize(n,n);const s=t.raycast(r,n,t.exaggeration());if(s){const t=e.scaleAndAdd([],r,n,s),i=new e.MercatorCoordinate(t[0],t[1],e.mercatorZfromAltitude(t[2],e.latFromMercatorY(t[1]))),a=(i.z+e.length([i.x-r[0],i.y-r[1],i.z-r[2]*o]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const i=e.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=t.getAtPointOrZero(new e.MercatorCoordinate(...r)),o=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),s=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*n;if(s<o){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[t.x-r[0],t.y-r[1],t.z-r[2]],n=e.length(i);i[2]-=(o-s)/this._projectionScaler;const a=e.length(i);if(0===a)return;e.scale$2(i,i,n/a*this._projectionScaler),this._camera.position=[t.x-i[0],t.y-i[1],t.z*this._projectionScaler-i[2]],this._camera.orientation=Or(i,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const t=this.center;return t.lat=e.clamp(t.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(t.lng=e.clamp(t.lng,this.minLng,this.maxLng)),this.center=t,void(this._constraining=!1)}const t=this._unmodified,{x:i,y:r}=this.point;let n=0,o=i,s=r;const a=this.width/2,l=this.height/2,c=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(r-l<c&&(s=c+l),r+l>u&&(s=u-l),u-c<this.height&&(n=Math.max(n,this.height/(u-c)),s=(u+c)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;o=(i+r+this.worldSize)%this.worldSize-r,o-a<e&&(o=e+a),o+a>t&&(o=t-a),t-e<this.width&&(n=Math.max(n,this.width/(t-e)),o=(t+e)/2)}o===i&&s===r||(this.center=this.unproject(new e.pointGeometry(o,s))),n&&(this.zoom+=this.scaleZoom(n)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i=this.pixelsPerMeter;if("globe"===this.projection.name){const t=e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,i=e.mercatorZfromAltitude(1,e.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=t/i}const r=Ur(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?i:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-t.x/this.width,o[9]=2*t.y/this.height;let s=e.mul([],o,n);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.identity([]);e.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.multiply(i,i,$r(this)),e.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.multiply(s,s,i),this.inverseAdjustmentMatrix=function(e){const t=$r(e,!0);return _([],[t[0],t[1],t[4],t[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize/i,1]),this.projMatrix=s,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);const a=e.invert([],o);this.frustumCorners=e.FrustumCorners.fromInvProjectionMatrix(a,this.horizonLineFromTop(),this.height);const l=new Float32Array(16);e.identity(l),e.scale(l,l,[1,-1,1]),e.rotateX(l,l,this._pitch),e.rotateZ(l,l,this.angle);const c=e.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),u=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;c[8]=2*-t.x/this.width,c[9]=2*(t.y+u)/this.height,this.skyboxMatrix=e.multiply(l,c,l);const h=this.point,d=h.x,p=h.y,f=this.width%2/2,m=this.height%2/2,g=Math.cos(this.angle),y=Math.sin(this.angle),v=d-Math.round(d)+g*f+y*m,x=p-Math.round(p)+g*m+y*f,b=new Float64Array(s);if(e.translate(b,b,[v>.5?v-1:v,x>.5?x-1:x,0]),this.alignedProjMatrix=b,s=e.create(),e.scale(s,s,[this.width/2,-this.height/2,1]),e.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=e.create(),e.scale(s,s,[1,-1,1]),e.translate(s,s,[-1,-1,0]),e.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=e.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=s,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.calculateGlobeMatrix(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.transformMat4(t,t,n),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=s;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._projectionScaler,o=[t,t,i];e.scale$2(o,o,n),e.scale$2(r,r,-1),e.multiply$2(r,r,o);const s=e.create();e.translate(s,s,r),e.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,e/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=t[2];let n=1;r>0&&(n=Math.min((i-this._camera.position[2])/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,n),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(r),s),l=this._zoomFromMercatorZ(a);e.scaleAndAdd(t,t,i,a),this._pitch=e.clamp(r,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(n,-Math.PI,Math.PI),this._setZoom(e.clamp(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),o=Math.min(t.y,i.y),s=Math.max(t.y,i.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.pointGeometry(r,o),new e.pointGeometry(n,s),new e.pointGeometry(r,s),new e.pointGeometry(n,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.pointGeometry(0,0),new e.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.length(e.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,i){const r=[t[0],t[1],t[2],1];e.transformMat4$1(r,r,i);const n=Math.max(r[3],1e-6);return[r[0]/n,r[1]/n,r[2]/n,n]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.pointGeometry(0,t))}}getCameraToCenterDistance(e){const t=Ur(e,this.zoom,this.width,this.height,1024),i=e.pixelSpaceConversion(this.center.lat,this.worldSize,t);return.5/Math.tan(.5*this._fov)*this.height*i}}function Wr(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}class Hr{constructor(t){this._hashName=t&&encodeURIComponent(t),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Wr(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),e.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const i=this._map;if(!i)return"";const r=i.getCenter(),n=Math.round(100*i.getZoom())/100,o=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,o),a=Math.round(r.lng*s)/s,l=Math.round(r.lat*s)/s,c=i.getBearing(),u=i.getPitch();let h="";if(h+=t?`/${a}/${l}/${n}`:`${n}/${l}/${a}`,(c||u)&&(h+="/"+Math.round(10*c)/10),u&&(h+=`/${Math.round(u)}`),this._hashName){const t=this._hashName;let i=!1;const r=e.window.location.hash.slice(1).split("&").map((e=>{const r=e.split("=")[0];return r===t?(i=!0,`${r}=${h}`):e})).filter((e=>e));return i||r.push(`${t}=${h}`),`#${r.join("&")}`}return`#${h}`}_getCurrentHash(){const t=e.window.location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((e=>e.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}const Xr={linearity:.3,easing:e.bezier(0,0,.3,1)},Kr=e.extend({deceleration:2500,maxSpeed:1400},Xr),Yr=e.extend({deceleration:20,maxSpeed:1400},Xr),Jr=e.extend({deceleration:1e3,maxSpeed:360},Xr),Qr=e.extend({deceleration:1e3,maxSpeed:90},Xr);class en{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.exported.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=rn(i.pan.mag(),r,e.extend({},Kr,t||{}));n.offset=i.pan.mult(o.amount/i.pan.mag()),n.center=this._map.transform.center,tn(n,o)}if(i.zoom){const e=rn(i.zoom,r,Yr);n.zoom=this._map.transform.zoom+e.amount,tn(n,e)}if(i.bearing){const t=rn(i.bearing,r,Jr);n.bearing=this._map.transform.bearing+e.clamp(t.amount,-179,179),tn(n,t)}if(i.pitch){const e=rn(i.pitch,r,Qr);n.pitch=this._map.transform.pitch+e.amount,tn(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function tn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function rn(t,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=e.clamp(t*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class nn extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r,n={}){const o=f(i.getCanvasContainer(),r),s=i.unproject(o);super(t,e.extend({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class on extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,o=m(i.getCanvasContainer(),n),s=o.map((e=>i.unproject(e))),a=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.pointGeometry(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:i.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class sn extends e.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class an{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new sn(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new nn(e.type,this._map,e))}mouseup(e){this._map.fire(new nn(e.type,this._map,e))}preclick(t){const i=e.extend({},t);i.type="preclick",this._map.fire(new nn(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new nn(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new nn(e.type,this._map,e))}mouseover(e){this._map.fire(new nn(e.type,this._map,e))}mouseout(e){this._map.fire(new nn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new on(e.type,this._map,e))}touchmove(e){this._map.fire(new on(e.type,this._map,e))}touchend(e){this._map.fire(new on(e.type,this._map,e))}touchcancel(e){this._map.fire(new on(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ln{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new nn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new nn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cn{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(u(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const n=Math.min(r.x,i.x),s=Math.max(r.x,i.x),a=Math.min(r.y,i.y),l=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${n}px,${a}px)`,this._box.style.width=s-n+"px",this._box.style.height=l-a+"px")}))}mouseupWindow(t,i){if(!this._active)return;if(0!==t.button)return;const r=this._startPos,n=i;if(this.reset(),p(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))}}function un(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class hn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.pointGeometry(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=un(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=un(i,t);for(const e in this.touches){const t=this.touches[e],i=r[e];(!i||i.dist(t)>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class dn{constructor(e){this.singleTap=new hn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class pn{constructor(){this._zoomIn=new dn({numTouches:1,numTaps:2}),this._zoomOut=new dn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fn={0:1,2:2};class mn{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=fn[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gn extends mn{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class yn extends mn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class _n extends mn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class vn{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.pointGeometry(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===i.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.preventDefault(),this._calculateTransform(e,t,i)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=un(r,i),o=new e.pointGeometry(0,0),s=new e.pointGeometry(0,0);let a=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,n[e]=t)}if(this._touches=n,a<this._minTouches||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")}),500)}}class xn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[n,o]=r,s=bn(i,t,n),a=bn(i,t,o);if(!s||!a)return;const l=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=bn(i,t,r),s=bn(i,t,n);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bn(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function wn(e,t){return Math.log(e/t)/Math.LN2}class Tn extends xn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(wn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wn(this._distance,i),pinchAround:t}}}function Sn(e,t){return 180*e.angleWith(t)/Math.PI}class Cn extends xn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sn(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=Sn(e,this._startVector);return Math.abs(i)<t}}function Mn(e){return Math.abs(e.y)>Math.abs(e.x)}class kn extends xn{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Mn(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){const r=this._lastPoints;if(!r)return;const n=e[0].sub(r[0]),o=e[1].sub(r[1]);return this._map._cooperativeGestures&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(n,o,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(n.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Mn(e)&&Mn(t)&&o}}const En={panStep:100,bearingStep:15,pitchStep:10};class An{constructor(){const e=En;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:In,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:s.getBearing()+i*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function In(e){return e*(2-e)}const zn=4.000244140625;class Pn{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,e.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.exported.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%zn==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform,i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>zn?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),o=Math.pow(2,n),s="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=i(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&n&&o){const t=Math.min((e.exported.now()-this._lastWheelEventTime)/200,1),i=o(t);s=e.number(n,r,i),t<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.ease;if(this._prevEase){const t=this._prevEase,r=(e.exported.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,s=Math.sqrt(.0729-o*o);i=e.bezier(o,s,.25,1)}return this._prevEase={start:e.exported.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(e.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!e.window.document.fullscreenElement||!!e.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")}),200)}}class Ln{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rn{constructor(){this._tap=new dn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bn{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class On{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fn{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const jn=e=>e.zoom||e.drag||e.pitch||e.rotate;class $n extends e.Event{}class Nn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.sub([],i,t);this.radius=e.length(r[2]<0?e.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);const i=e.scale$2([],t,this.radius);if(i[2]>0){const t=e.scale$2([],[0,0,1],e.dot(i,[0,0,1])),r=e.scale$2([],e.normalize([],[i[0],i[1],0]),this.radius),n=e.add([],i,e.scale$2([],e.sub([],e.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Un(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Vn{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new en(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[e.window,"blur",void 0]];for(const[t,i,r]of this._listeners)t.addEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(const[t,i,r]of this._listeners)t.removeEventListener(i,t===e.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new an(t,e));const r=t.boxZoom=new cn(t,e);this._add("boxZoom",r);const n=new pn,o=new Dn;t.doubleClickZoom=new Ln(o,n),this._add("tapZoom",n),this._add("clickZoom",o);const s=new Rn;this._add("tapDragZoom",s);const a=t.touchPitch=new kn(t);this._add("touchPitch",a);const l=new yn(e),c=new _n(e);t.dragRotate=new On(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new gn(e),h=new vn(t,e);t.dragPan=new Bn(i,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new Cn,p=new Tn;t.touchZoomRotate=new Fn(i,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ln(t));const f=t.scrollZoom=new Pn(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new An;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,r=i?void 0:e,n={needsRenderFrame:!1},o={},s={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?m(this._el,a):i?void 0:f(this._el,e);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;this._blockedByActive(s,u,i)?c.reset():c[t||e.type]&&(h=c[t||e.type](e,l,a),this.mergeHandlerResult(n,o,h,i,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||c.isActive())&&(s[i]=c)}const c={};for(const e in this._previousActiveHandlers)s[e]||(c[e]=r);this._previousActiveHandlers=s,(Object.keys(c).length||Un(n))&&(this._changes.push([n,o,c]),this._triggerRenderFrame()),(Object.keys(s).length||Un(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=n;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(t,i,r,n,o){if(!r)return;e.extend(t,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const t={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.pointGeometry(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.extend(i,o),e.extend(r,s);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,o=n.transform,s=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Un(t)){const e=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",e!==o.zoom&&this._map._update(!0)}if(!Un(t))return void this._fireEvents(i,r,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=t;void 0!==p&&(h=p),(e=>i.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",n._stop(!0),h=h||n.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a){const t=o.pointCoordinate(h);if("globe"===o.projection.name){const i=e.latFromMercatorY(t.y),r=o.center.lat,n=Math.min(e.mercatorZfromAltitude(1,i)/e.mercatorZfromAltitude(1,r),2);a=a.rotate(-o.angle),f[0]=-a.x/o.worldSize*n,f[1]=-a.y/o.worldSize*n}else{const e=o.pointCoordinate(h.sub(a));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=o.zoom,g=[0,0,0];if(l){const t=s(d||o.pointCoordinate3D(h)),i={dir:e.normalize([],e.sub([],t,o._camera.position))};if(i.dir[2]<0){const r=o.zoomDeltaToMovement(t,l);e.scale$2(g,i.dir,r)}}const y=e.add(f,f,g);o._translateCameraConstrained(y),l&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=jn(this._eventsInProgress),o=jn(t),s={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(s[`${e}start`]=i),this._eventsInProgress[e]=t[e]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in s)this._fireEvent(e,s[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,a[`${e}end`]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=jn(this._eventsInProgress);if(r&&(n||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.Event("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new $n("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Gn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qn extends e.Evented{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,e.bindAll(["_renderFrameCallback"],this)}getCenter(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.extend({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.extend({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.extend({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.extend({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=e.LngLatBounds.convert(t);const r=i&&i.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,i)}_extendCameraOptions(t){const i={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const e=t.padding;t.padding={top:e,bottom:e,right:e,left:e}}return t.padding=e.extend(i,t.padding),t}_cameraForBoxAndBearing(t,i,r,n){const o=this._extendCameraOptions(n),s=this.transform,a=s.padding,l=s.project(e.LngLat.convert(t)),c=s.project(e.LngLat.convert(i)),u=new e.pointGeometry(l.x,c.y),h=new e.pointGeometry(c.x,l.y),d=-e.degToRad(r),p=l.rotate(d),f=c.rotate(d),m=u.rotate(d),g=h.rotate(d),y=new e.pointGeometry(Math.max(p.x,f.x,m.x,g.x),Math.max(p.y,f.y,m.y,g.y)),_=new e.pointGeometry(Math.min(p.x,f.x,m.x,g.x),Math.min(p.y,f.y,m.y,g.y)),v=y.sub(_),x=(s.width-((a.left||0)+(a.right||0)+o.padding.left+o.padding.right))/v.x,b=(s.height-((a.top||0)+(a.bottom||0)+o.padding.top+o.padding.bottom))/v.y;if(b<0||x<0)return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const w=Math.min(s.scaleZoom(s.scale*Math.min(x,b)),o.maxZoom),T="number"==typeof o.offset.x&&"number"==typeof o.offset.y?new e.pointGeometry(o.offset.x,o.offset.y):e.pointGeometry.convert(o.offset),S=new e.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(r*Math.PI/180),C=T.add(S).mult(s.scale/s.zoomScale(w));return{center:s.unproject(l.add(c).div(2).sub(C)),zoom:w,bearing:r}}_cameraForBox(t,i,r,n,o){const s=this._extendCameraOptions(o);r=r||0,n=n||0,t=e.LngLat.convert(t),i=e.LngLat.convert(i);const a=this.transform.clone();a.padding=s.padding;const l=this.getFreeCameraOptions(),c=new e.LngLat(.5*(t.lng+i.lng),.5*(t.lat+i.lat)),u=.5*(r+n);if(a._camera.position[2]<e.mercatorZfromAltitude(u,c.lat))return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");l.lookAtPoint(c),a.setFreeCameraOptions(l);const h=e.MercatorCoordinate.fromLngLat(t),d=e.MercatorCoordinate.fromLngLat(i),p=a.pointRayIntersection(a.centerPoint,u),f=[(m=a.rayIntersectionCoordinate(p)).x,m.y,m.z];var m;const g=a.screenPointToMercatorRay(a.centerPoint),y="globe"!==a.projection.name;let _,v=0;do{const i=Math.floor(a.zoom),o=1<<i,s=Math.min(o*h.x,o*d.x),l=Math.min(o*h.y,o*d.y),c=Math.max(o*h.x,o*d.x),u=Math.max(o*h.y,o*d.y),p=new e.Aabb([s,l,r],[c,u,n]),m=e.Frustum.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,i,y);if(2!==p.intersects(m)){_&&(a._camera.position=e.scaleAndAdd([],a._camera.position,g.dir,-_),a._updateStateFromCamera());break}const v=e.sub([],a._camera.position,f);_=.5*e.length(v),a._camera.position=e.scaleAndAdd([],a._camera.position,g.dir,_);try{a._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,i,r){return"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,i),i,r)}_raycastElevationBox(t,i){const r=this.transform.elevation;if(!r)return;const n=new e.pointGeometry(t.x,i.y),o=new e.pointGeometry(i.x,t.y),s=r.pointCoordinate(t);if(!s)return;const a=r.pointCoordinate(i);if(!a)return;const l=r.pointCoordinate(n);if(!l)return;const c=r.pointCoordinate(o);if(!c)return;const u=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new e.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),p=new e.MercatorCoordinate(c[0],c[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),y=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),_=Math.min(s[3],Math.min(a[3],Math.min(l[3],c[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(l[3],c[3])));return{minLngLat:new e.LngLat(f,m),maxLngLat:new e.LngLat(g,y),minAltitude:_,maxAltitude:v}}fitScreenCoordinates(t,i,r,n,o){let s,a,l,c;"globe"===this.transform.projection.name&&e.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const u=e.pointGeometry.convert(t),h=e.pointGeometry.convert(i),d=this._raycastElevationBox(u,h);if(d)s=d.minLngLat,a=d.maxLngLat,l=d.minAltitude,c=d.maxAltitude;else{if(this.transform.anyCornerOffEdge(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)),this.transform.pointLocation(e.pointGeometry.convert(i)),r,n):this._cameraForBox(s,a,l,c,n),n,o)}_fitInternal(t,i,r){return t?(delete(i=e.extend(t,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let n=!1,o=!1,s=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),n&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),o&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),s&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.warnOnce(Gn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.warnOnce(Gn),this;this.stop();const n=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(t);const a=n!==r.zoom,l=o!==r.pitch,c=s!==r.bearing;return this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),a&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),c&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),l&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.exported.prefersReducedMotion)&&(t.duration=0);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:r.padding,d=e.pointGeometry.convert(t.offset);let p,f,m;if("globe"===r.projection.name){const i=e.MercatorCoordinate.fromLngLat(r.center),n=d.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const o=i.toLngLat(),s=e.LngLat.convert(t.center||o);this._normalizeCenter(s),p=r.centerPoint.add(n),f=new e.pointGeometry(i.x,i.y).mult(r.worldSize),m=new e.pointGeometry(e.mercatorXfromLng(s.lng),e.mercatorYfromLat(s.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const i=r.pointLocation(p),n=e.LngLat.convert(t.center||i);this._normalizeCenter(n),f=r.project(i),m=r.project(n).sub(f)}const g=r.zoomScale(l-n);let y,_;t.around&&(y=e.LngLat.convert(t.around),_=r.locationPoint(y));const v=this._zooming||l!==n,x=this._rotating||o!==c,b=this._pitching||u!==s,w=!r.isPaddingEqual(h),T=r=>T=>{if(v&&(r.zoom=e.number(n,l,T)),x&&(r.bearing=e.number(o,c,T)),b&&(r.pitch=e.number(s,u,T)),w&&(r.interpolatePadding(a,h,T),p=r.centerPoint.add(d)),y)r.setLocationAtPoint(y,_);else{const e=r.zoomScale(r.zoom-n),t=l>n?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-T),o=r.unproject(f.add(m.mult(T*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}return t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(T,t.duration,r);return this._preloadTiles(e),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,S),this._ease(T(r),(e=>{r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",i||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),n&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}flyTo(t,i){if(!t.essential&&e.exported.prefersReducedMotion){const r=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);const r=this.transform,n=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.clamp(+t.zoom,r.minZoom,r.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:r.padding,d=r.zoomScale(l-n),p=e.pointGeometry.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),g=e.LngLat.convert(t.center||m);this._normalizeCenter(g);const y=r.project(m),_=r.project(g).sub(y);let v=t.curve;const x=Math.max(r.width,r.height),b=x/d,w=_.mag();if("minZoom"in t){const i=e.clamp(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),o=x/r.zoomScale(i-n);v=Math.sqrt(o/w*2)}const T=v*v;function S(e){const t=(b*b-x*x+(e?-1:1)*T*T*w*w)/(2*(e?b:x)*T*w);return Math.log(Math.sqrt(t*t+1)-t)}function C(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}const k=S(0);let E=function(e){return M(k)/M(k+v*e)},A=function(e){return x*((M(k)*(C(t=k+v*e)/M(t))-C(k))/T)/w;var t},I=(S(1)-k)/v;if(Math.abs(w)<1e-6||!isFinite(I)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;I=Math.abs(Math.log(b/x))/v,A=function(){return 0},E=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*I/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const z=o!==c,P=u!==s,L=!r.isPaddingEqual(h),D=r=>d=>{const m=d*I,v=1/E(m);r.zoom=1===d?l:n+r.scaleZoom(v),z&&(r.bearing=e.number(o,c,d)),P&&(r.pitch=e.number(s,u,d)),L&&(r.interpolatePadding(a,h,d),f=r.centerPoint.add(p));const x=1===d?g:r.unproject(y.add(_.mult(A(m))).mult(v));return r.setLocationAtPoint(r.renderWorldCopies?x.wrap():x,f),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(D,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=z,this._pitching=P,this._padding=L,this._prepareEase(i,!1),this._ease(D(r),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.exported.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.exported.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.wrap(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.maxBounds)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_emulate(e,t,i){const r=Math.ceil(15*t/1e3),n=[],o=e(i.clone());for(let e=0;e<=r;e++){const t=o(e/r);n.push(t.clone())}return n}}class Zn{constructor(t={}){this.options=t,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.setAttribute("aria-label",i),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+=`${t.key}=${t.value}${r<i.length-1?"&":""}`),e)),"?");t.href=`${e.config.FEEDBACK_URL}/${r}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const i in t){const r=t[i];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wn{constructor(){e.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=o("div","mapboxgl-ctrl");const t=o("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Hn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Xn(t,i,r){if(t=new e.LngLat(t.lng,t.lat),i){const n=new e.LngLat(t.lng-360,t.lat),o=new e.LngLat(t.lng+360,t.lat),s=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),a=r.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<a&&(l||Math.abs(n.lng-r.center.lng)<s)?t=n:r.locationPoint(o).distSqr(i)<a&&(l||Math.abs(o.lng-r.center.lng)<s)&&(t=o)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const Kn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yn extends e.Evented{constructor(t,i){if(super(),(t instanceof e.window.HTMLElement||i)&&(t=e.extend({element:t},i)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=e.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const i=41,r=27,n=s("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${i}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},n));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=e.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const r=this._element.classList;for(const e in Kn)r.remove(`mapboxgl-marker-anchor-${e}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map;if(!e)return!1;const t=e.unproject(this._pos),i=e.getFreeCameraOptions();if(!i.position)return!1;const r=i.position.toLngLat();return r.distanceTo(t)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i);let n;t._usingGlobe()&&e.isLngLatBehindGlobe(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=.2)),this._element.style.opacity=`${n}`,this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._calculateXYTransform()+this._calculateZTransform(),i=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px) ${Kn[this._anchor]}\n            ${t}\n            translate(${i.x}px,${i.y}px)\n        `}_calculateXYTransform(){const t=this._pos,i=this._map;if("map"!==this.getPitchAlignment()||!i||!t)return"";if(!i._usingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.radToDeg(e.globeTiltAtLngLat(i.transform,this._lngLat)),n=t.sub(e.globeCenterToScreenPoint(i.transform)),o=r/(Math.abs(n.x)+Math.abs(n.y)),s=n.x*o,a=-n.y*o;return a||s?`rotateX(${a}deg) rotateY(${s}deg)`:""}_calculateZTransform(){const e=this._calculateRotation();return e?`rotateZ(${e}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const t=this._map;if(this._pos&&t&&t._usingGlobe()){const i=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),r=t.project(new e.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(i);return this._rotation+e.radToDeg(Math.atan2(r.y,r.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){e.window.cancelAnimationFrame(this._updateFrameId);const i=this._map;i&&(i.transform.renderWorldCopies&&(this._lngLat=Xn(this._lngLat,this._pos,i.transform)),this._pos=i.project(this._lngLat),!0===t?this._updateFrameId=e.window.requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),i._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(i._usingGlobe()||i.getTerrain()||i.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.pointGeometry.convert(t),this._update(),this}_onMove(t){const i=this._map;if(i){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=e}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map;t&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Jn{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}const Qn={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},eo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function to(e){e.parentNode&&e.parentNode.removeChild(e)}const io={showCompass:!0,showZoom:!0,visualizePitch:!1};class ro{constructor(t,i,r=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new yn({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new _n({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),u()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),e.window.removeEventListener("mousemove",this.mousemove),e.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),e.window.addEventListener("mousemove",this.mousemove),e.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const no={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},oo={maxWidth:100,unit:"metric"};function so(e,t,i,r,n,o){const s=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(i),a=s/i;o._requestDomTask((()=>{e.style.width=t*a+"px",e.innerHTML="nautical-mile"!==n?new Intl.NumberFormat(r,{style:"unit",unitDisplay:"narrow",unit:n}).format(s):`${s}&nbsp;nm`}))}const ao={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function co(t=new e.pointGeometry(0,0),i="bottom"){if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.pointGeometry(0,t);case"top-left":return new e.pointGeometry(r,r);case"top-right":return new e.pointGeometry(-r,r);case"bottom":return new e.pointGeometry(0,-t);case"bottom-left":return new e.pointGeometry(r,-r);case"bottom-right":return new e.pointGeometry(-r,-r);case"left":return new e.pointGeometry(t,0);case"right":return new e.pointGeometry(-t,0)}return new e.pointGeometry(0,0)}return t instanceof e.pointGeometry||Array.isArray(t)?e.pointGeometry.convert(t):e.pointGeometry.convert(t[i]||[0,0])}const uo={version:e.version,supported:i,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:class extends qn{constructor(t){if(null!=(t=e.extend({},eo,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.isSafariWithAntialiasingBug(e.window)&&(t.antialias=!1,e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Zr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._optimizeForTerrain=t.optimizeForTerrain,this._language="auto"===t.language?e.window.navigator.language:t.language,this._worldview=t.worldview,this._renderTaskQueue=new Hn,this._domRenderTaskQueue=new Hn,this._controls=[],this._markers=[],this._mapId=e.uniqueId(),this._locale=e.extend({},Qn,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jn(0),this._explicitProjection=null,this._requestManager=new e.RequestManager(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,"string"==typeof t.container){if(this._container=e.window.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof e.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),void 0!==e.window&&(e.window.addEventListener("online",this._onWindowOnline,!1),e.window.addEventListener("resize",this._onWindowResize,!1),e.window.addEventListener("orientationchange",this._onWindowResize,!1),e.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Vn(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&this.setStyle(t.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this._hash=t.hash&&new Hr("string"==typeof t.hash&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),this.resize(),t.attributionControl&&this.addControl(new Zn({customAttribution:t.customAttribution})),this._logoControl=new Wn,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.Event(`${t.dataType}data`,t))})),this.on("dataloading",(t=>{this.fire(new e.Event(`${t.dataType}dataloading`,t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)),this.fire(new e.Event("resize",t)),i&&this.fire(new e.Event("moveend",t)),this}getBounds(){return"globe"===this.transform.projection.name&&e.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}getLanguage(){return this._language}setLanguage(t){if(this._language="auto"===t?e.window.navigator.language:t,this.style)for(const e in this.style._sourceCaches){const t=this.style._sourceCaches[e]._source;t._setLanguage&&t._setLanguage(this._language)}for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){if(this._worldview=e,this.style)for(const t in this.style._sourceCaches){const i=this.style._sourceCaches[t]._source;i._setWorldview&&i._setWorldview(e)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._updateProjection(e)}_updateProjection(t){const i=this.getProjection();null===t&&(this._explicitProjection=null);const r=t||this.getProjection();let n;if(r&&"globe"===r.name&&this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?(n=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(n=this.transform.setProjection(r),this.transform.mercatorFromTransition=!1),t&&(this._explicitProjection="globe"===t.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),n){if("globe"===i.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const e in this.style._sourceCaches)this.style._sourceCaches[e].clearTiles()}this._update(!0)}return this}project(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}unproject(t){return this.transform.pointLocation3D(e.pointGeometry.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e))),s=o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new nn(e,this,n.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:o}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e)));(o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new nn(e,this,n.originalEvent)))},o=t=>{r&&(r=!1,i.call(this,new nn(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if(void 0===i)return super.on(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const e in r.delegates)this.on(e,r.delegates[e]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);Array.isArray(t)||(t=[t]);const r=this._createDelegatedListener(e,t,i);for(const e in r.delegates)this.once(e,r.delegates[e]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);const r=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const o=e[n];if(o.listener===i&&r(o.layers,t)){for(const e in o.delegates)this.off(e,o.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,i){return this.style?(void 0!==i||void 0===t||t instanceof e.pointGeometry||Array.isArray(t)||(i=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=e.extend({},{exaggerated:!0},i),r.getAtPoint(e.MercatorCoordinate.fromLngLat(t),null,i.exaggerated)):null}setStyle(t,i){return!1!==(i=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new ei(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ei(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,i){if("string"==typeof t){const r=this._requestManager.normalizeStyleURL(t),n=this._requestManager.transformRequest(r,e.ResourceType.Style);e.getJSON(n,((t,r)=>{t?this.fire(new e.ErrorEvent(t)):r&&this._updateDiff(r,i)}))}else"object"==typeof t&&this._updateDiff(t,i)}_updateDiff(t,i){try{this.style.setState(t)&&this._update(!0)}catch(r){e.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(t,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(t,i,{pixelRatio:r=1,sdf:n=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap){const{width:l,height:c,data:u}=e.exported.getImageData(i);this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,u=i;this.style.addImage(t,{data:new e.RGBAImage({width:l,height:c},new Uint8Array(u.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,t)}}updateImage(t,i){const r=this.style.getImage(t);if(!r)return void this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap?e.exported.getImageData(i):i,{width:o,height:s}=n;void 0!==o&&void 0!==s?o===r.data.width&&s===r.data.height?(r.data.replace(n.data,!(i instanceof e.window.HTMLImageElement||e.window.ImageBitmap&&i instanceof e.window.ImageBitmap)),this.style.updateImage(t,r)):this.fire(new e.ErrorEvent(new Error(`The width and height of the updated image (${o}, ${s})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`))):this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),((t,r)=>{i(t,r instanceof e.window.HTMLImageElement?e.exported.getImageData(r):r)}))}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,r={}){return this.style.setPaintProperty(e,t,i,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,r={}){return this.style.setLayoutProperty(e,t,i,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let r,n,o,s=this._container;for(;s&&(!n||!o);){const t=e.window.getComputedStyle(s).transform;t&&"none"!==t&&(r=t.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),s=s.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=o?Math.abs(i/o):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=o("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=o("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=o("div",`mapboxgl-ctrl-${e}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_setupPainter(){const t=e.extend({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);r?(e.storeAuthState(r,!0),this.painter=new Lr(r,this.transform),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.exported$1.testSupport(r)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;const r=this.painter.context.extTimerQuery,n=e.exported.now();if(this.listens("gpu-timing-frame")&&(i=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=e.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let o=!1;const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=e.exported.now();this.style.zoomHistory.update(t,r);const n=new e.EvaluationParameters(t,{now:r,fadeDuration:s,pitch:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=n.crossFadingFactor();1===a&&a===this._crossFadingFactor||(o=!0,this._crossFadingFactor=a),this.style.update(n)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(n),this.style._updateSources(this.transform),this._forceMarkerUpdate()):a=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.exported.now()-n;r.endQueryEXT(r.TIME_ELAPSED_EXT,i),setTimeout((()=>{const o=r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(i),this.fire(new e.Event("gpu-timing-frame",{cpuTime:t,gpuTime:o})),e.window.performance.mark("frame-gpu",{startTime:n,detail:{gpuTime:o}})}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.Event("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.Event("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(a=this._updateAverageElevation(n,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const e of this._markers)e._update()}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation(),n=!1;this.transform.elevation&&(n=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-r);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),i(r)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.AUTH_ERR_MSG||401===t.status)){const t=this.painter.context.gl;e.storeAuthState(t,!1),this._logoControl instanceof Wn&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let t=0;t<s.length;t+=4)s[t]===e[t]&&s[t+1]===e[t+1]&&s[t+2]===e[t+2]&&s[t+3]===e[t+3]&&(a+=1);r+=(i[o+2]-i[o+1])*(1-a/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),to(this._canvasContainer),to(this._controlContainer),to(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),e.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new e.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.exported.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?Object.values(this.style._sourceCaches):[];return e.asyncAll(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}_setCacheLimits(t,i){e.setCacheLimits(t,i)}get version(){return e.version}},NavigationControl:class{constructor(t){this.options=e.extend({},io,t),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ro(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=o("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.Evented{constructor(t){super(),this.options=e.extend({geolocation:e.window.navigator.geolocation},no,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Wr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((e=>{this._supportsGeolocation="denied"!==e.state,t(this._supportsGeolocation)})):(this._supportsGeolocation=!!this.geolocation,t(this._supportsGeolocation))}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),o=e.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),o,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.mercatorZfromAltitude(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.Event("trackuserlocationend")))}))}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{e.window.addEventListener("ondeviceorientationabsolute"in e.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==e.window.DeviceMotionEvent&&"function"==typeof e.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),e.window.removeEventListener("deviceorientation",this._onDeviceOrientation),e.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Zn,ScaleControl:class{constructor(t){this.options=e.extend({},oo,t),e.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(e,t,i,r){const n=r&&r.maxWidth||100,o=e._containerHeight/2,s=e._containerWidth/2-n/2,a=e.unproject([s,o]),l=e.unproject([s+n,o]),c=a.distanceTo(l);if(r&&"imperial"===r.unit){const r=3.2808*c;r>5280?so(t,n,r/5280,i,"mile",e):so(t,n,r,i,"foot",e)}else r&&"nautical"===r.unit?so(t,n,c/1852,i,"nautical-mile",e):c>=1e3?so(t,n,c/1e3,i,"kilometer",e):so(t,n,c,i,"meter",e)}(this._map,this._container,this._language,this.options)}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof e.window.HTMLElement?this._container=t.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.Evented{constructor(t){super(),this.options=e.extend(Object.create(ao),t),e.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new e.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(e.window.document.createTextNode(t))}setHTML(t){const i=e.window.document.createDocumentFragment(),r=e.window.document.createElement("body");let n;for(r.innerHTML=t;n=r.firstChild,n;)i.appendChild(n);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=o("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const n=i.offsetWidth,o=i.offsetHeight,s=r.x<n/2,a=r.x>t.transform.width-n/2;if(r.y+e<o)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=o("div","mapboxgl-popup",i.getContainer()),this._tip=o("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xn(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),r=co(this.options.offset),n=this._anchor=this._getAnchor(r.y),o=co(this.options.offset,n),s=e.add(o).round();i._requestDomTask((()=>{this._container&&n&&(this._container.style.transform=`${Kn[n]} translate(${s.x}px,${s.y}px)`)}))}if(!this._marker&&i._usingGlobe()){const t=e.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(lo);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Yn,Style:ei,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.pointGeometry,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:Fr,Evented:e.Evented,config:e.config,prewarm:function(){Ne().acquire(Fe)},clearPrewarmedResources:function(){const e=$e;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Fe),$e=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return je.workerCount},set workerCount(e){je.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.exported.setNow,restoreNow:e.exported.restoreNow};return uo})),i}(),yt=t({__proto__:null,default:gt},[mt.exports]),_t={exports:{}},vt=be(_t.exports=function(){var e={},t={};function i(i,r,n){if(t[i]=n,"index"===i){var o="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",s={};return t.shared(s),t.index(e,s),"undefined"!=typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),e}}return i("shared",["exports"],(function(e){function t(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((r=r.apply(e,t||[])).next())}))}function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r,n;function o(){if(n)return r;function e(e,t){this.x=e,this.y=t}return n=1,r=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t},r}"function"==typeof SuppressedError&&SuppressedError;var s,a,l=i(o()),c=function(){if(a)return s;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return a=1,s=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},s}(),u=i(c);let h,d;function p(){return null==h&&(h="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),h}function f(){if(null==d&&(d=!1,p())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let i=0;i<e*e;i++){const r=4*i;t.fillStyle=`rgb(${r},${r+1},${r+2})`,t.fillRect(i%e,Math.floor(i/e),1,1)}const i=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&i[t]!==t){d=!0;break}}}return d||!1}var m=1e-6,g="undefined"!=typeof Float32Array?Float32Array:Array;function y(){var e=new g(9);return g!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function _(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(){var e=new g(3);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function x(e){return Math.hypot(e[0],e[1],e[2])}function b(e,t,i){var r=new g(3);return r[0]=e,r[1]=t,r[2]=i,r}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var w,T=x;function S(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*o+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*o+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*o+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*o+i[15]*s,e}function C(){var e=new g(4);return g!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function M(){var e=new g(2);return g!=Float32Array&&(e[0]=0,e[1]=0),e}function k(e,t){var i=new g(2);return i[0]=e,i[1]=t,i}v(),w=new g(4),g!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),v(),b(1,0,0),b(0,1,0),C(),C(),y(),M();const E=8192;function A(e,t,i){return t*(E/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function I(e,t){return(e%t+t)%t}function z(e,t,i){return e*(1-i)+t*i}function P(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function L(e,t,i,r){const n=new u(e,t,i,r);return e=>n.solve(e)}const D=L(.25,.1,.25,1);function R(e,t,i){return Math.min(i,Math.max(t,e))}function B(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function O(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}let F=1;function j(e,t,i){const r={};for(const i in e)r[i]=t.call(this,e[i],i,e);return r}function $(e,t,i){const r={};for(const i in e)t.call(this,e[i],i,e)&&(r[i]=e[i]);return r}function N(e){return Array.isArray(e)?e.map(N):"object"==typeof e&&e?j(e,N):e}const U={};function V(e){U[e]||("undefined"!=typeof console&&console.warn(e),U[e]=!0)}function G(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function q(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let Z=null;function W(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function X(e,i,r,n,o){return t(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const t=new VideoFrame(e,{timestamp:0});try{const s=null==t?void 0:t.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(n*o*4);if(yield t.copyTo(l,function(e,t,i,r,n){const o=4*Math.max(1,0),s=(Math.max(0,i)-i)*r*4+o,a=4*r,l=Math.max(0,t),c=Math.max(0,i);return{rect:{x:l,y:c,width:Math.min(e.width,t+r)-l,height:Math.min(e.height,i+n)-c},layout:[{offset:s,stride:a}]}}(e,i,r,n,o)),a)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{t.close()}}))}let K,Y;function J(e,t,i,r){return e.addEventListener(t,i,r),{unsubscribe:()=>{e.removeEventListener(t,i,r)}}}function Q(e){return e*Math.PI/180}function ee(e){return e/Math.PI*180}const te={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ie={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},re="AbortError";function ne(){return new Error(re)}const oe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function se(e){return oe.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const ae="global-dispatcher";class le extends Error{constructor(e,t,i,r){super(`AJAXError: ${t} (${e}): ${i}`),this.status=e,this.statusText=t,this.url=i,this.body=r}}const ce=()=>q(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,ue=function(e,i){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const t=se(e.url);if(t)return t(e,i);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:ae},i)}if(!(/^file:/.test(r=e.url)||/^file:/.test(ce())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,i){return t(this,void 0,void 0,(function*(){const t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:ce(),signal:i.signal});let r,n;"json"!==e.type||t.headers.has("Accept")||t.headers.set("Accept","application/json");try{r=yield fetch(t)}catch(t){throw new le(0,t.message,e.url,new Blob)}if(!r.ok){const t=yield r.blob();throw new le(r.status,r.statusText,e.url,t)}n="arrayBuffer"===e.type||"image"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text();const o=yield n;if(i.signal.aborted)throw ne();return{data:o,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires")}}))}(e,i);if(q(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:ae},i)}var r;return function(e,t){return new Promise(((i,r)=>{var n;const o=new XMLHttpRequest;o.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(o.responseType="arraybuffer");for(const t in e.headers)o.setRequestHeader(t,e.headers[t]);"json"===e.type&&(o.responseType="text",(null===(n=e.headers)||void 0===n?void 0:n.Accept)||o.setRequestHeader("Accept","application/json")),o.withCredentials="include"===e.credentials,o.onerror=()=>{r(new Error(o.statusText))},o.onload=()=>{if(!t.signal.aborted)if((o.status>=200&&o.status<300||0===o.status)&&null!==o.response){let t=o.response;if("json"===e.type)try{t=JSON.parse(o.response)}catch(e){return void r(e)}i({data:t,cacheControl:o.getResponseHeader("Cache-Control"),expires:o.getResponseHeader("Expires")})}else{const t=new Blob([o.response],{type:o.getResponseHeader("Content-Type")});r(new le(o.status,o.statusText,e.url,t))}},t.signal.addEventListener("abort",(()=>{o.abort(),r(ne())})),o.send(e.body)}))}(e,i)};function he(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function de(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function pe(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class fe{constructor(e,t={}){O(this,t),this.type=e}}class me extends fe{constructor(e,t={}){super("error",O({error:e},t))}}class ge{on(e,t){return this._listeners=this._listeners||{},de(e,t,this._listeners),{unsubscribe:()=>{this.off(e,t)}}}off(e,t){return pe(e,t,this._listeners),pe(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},de(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new fe(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const t of r)pe(i,t,this._oneTimeListeners),t.call(this,e);const n=this._eventedParent;n&&(O(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof me&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const _e=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ve(e,t){const i={};for(const t in e)"ref"!==t&&(i[t]=e[t]);return _e.forEach((e=>{e in t&&(i[e]=t[e])})),i}function xe(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!xe(e[i],t[i]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const i in e)if(!xe(e[i],t[i]))return!1;return!0}return e===t}function be(e,t){e.push(t)}function we(e,t,i){be(i,{command:"addSource",args:[e,t[e]]})}function Te(e,t,i){be(t,{command:"removeSource",args:[e]}),i[e]=!0}function Se(e,t,i,r){Te(e,i,r),we(e,t,i)}function Ce(e,t,i){let r;for(r in e[i])if(Object.prototype.hasOwnProperty.call(e[i],r)&&"data"!==r&&!xe(e[i][r],t[i][r]))return!1;for(r in t[i])if(Object.prototype.hasOwnProperty.call(t[i],r)&&"data"!==r&&!xe(e[i][r],t[i][r]))return!1;return!0}function Me(e,t,i,r,n,o){e=e||{},t=t||{};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(xe(e[s],t[s])||i.push({command:o,args:[r,s,t[s],n]}));for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(xe(e[s],t[s])||i.push({command:o,args:[r,s,t[s],n]}))}function ke(e){return e.id}function Ee(e,t){return e[t.id]=t,e}class Ae{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function Ie(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}class ze extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Pe{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new Pe(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Le={kind:"null"},De={kind:"number"},Re={kind:"string"},Be={kind:"boolean"},Oe={kind:"color"},Fe={kind:"projectionDefinition"},je={kind:"object"},$e={kind:"value"},Ne={kind:"collator"},Ue={kind:"formatted"},Ve={kind:"padding"},Ge={kind:"colorArray"},qe={kind:"numberArray"},Ze={kind:"resolvedImage"},We={kind:"variableAnchorOffsetCollection"};function He(e,t){return{kind:"array",itemType:e,N:t}}function Xe(e){if("array"===e.kind){const t=Xe(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ke=[Le,De,Re,Be,Oe,Fe,Ue,je,He($e),Ve,qe,Ge,Ze,We];function Ye(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ye(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ke)if(!Ye(e,t))return null}return`Expected ${Xe(e)} but found ${Xe(t)} instead.`}function Je(e,t){return t.some((t=>t.kind===e.kind))}function Qe(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function et(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const tt=.96422,it=.82521,rt=4/29,nt=6/29,ot=3*nt*nt,st=nt*nt*nt,at=Math.PI/180,lt=180/Math.PI;function ct(e){return(e%=360)<0&&(e+=360),e}function ut([e,t,i,r]){let n,o;const s=dt((.2225045*(e=ht(e))+.7168786*(t=ht(t))+.0606169*(i=ht(i)))/1);e===t&&t===i?n=o=s:(n=dt((.4360747*e+.3850649*t+.1430804*i)/tt),o=dt((.0139322*e+.0971045*t+.7141733*i)/it));const a=116*s-16;return[a<0?0:a,500*(n-s),200*(s-o),r]}function ht(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function dt(e){return e>st?Math.pow(e,1/3):e/ot+rt}function pt([e,t,i,r]){let n=(e+16)/116,o=isNaN(t)?n:n+t/500,s=isNaN(i)?n:n-i/200;return n=1*mt(n),o=tt*mt(o),s=it*mt(s),[ft(3.1338561*o-1.6168667*n-.4906146*s),ft(-.9787684*o+1.9161415*n+.033454*s),ft(.0719453*o-.2289914*n+1.4052427*s),r]}function ft(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function mt(e){return e>nt?e*e*e:ot*(e-rt)}const gt=Object.hasOwn||function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};function yt(e,t){return gt(e,t)?e[t]:void 0}function _t(e){return parseInt(e.padEnd(2,e),16)/255}function vt(e,t){return xt(t?e/100:e,0,1)}function xt(e,t,i){return Math.min(Math.max(t,e),i)}function bt(e){return!e.some(Number.isNaN)}const wt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Tt(e,t,i){return e+i*(t-e)}function St(e,t,i){return e.map(((e,r)=>Tt(e,t[r],i)))}class Ct{constructor(e,t,i,r=1,n=!0){this.r=e,this.g=t,this.b=i,this.a=r,n||(this.r*=r,this.g*=r,this.b*=r,r||this.overwriteGetter("rgb",[e,t,i,r]))}static parse(e){if(e instanceof Ct)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=yt(wt,e);if(t){const[e,i,r]=t;return[e/255,i/255,r/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let i=1;return[_t(e.slice(i,i+=t)),_t(e.slice(i,i+=t)),_t(e.slice(i,i+=t)),_t(e.slice(i,i+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,i,r,n,o,s,a,l,c,u,h,d]=t,p=[n||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[r,s,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[xt(+i/t,0,1),xt(+o/t,0,1),xt(+l/t,0,1),h?vt(+h,d):1];if(bt(e))return e}}return}}const i=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(i){const[e,t,r,n,o,s,a,l,c]=i,u=[r||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,xt(+n,0,100),xt(+s,0,100),l?vt(+l,c):1];if(bt(e))return function([e,t,i,r]){function n(r){const n=(r+e/30)%12,o=t*Math.min(i,1-i);return i-o*Math.max(-1,Math.min(n-3,9-n,1))}return e=ct(e),t/=100,i/=100,[n(0),n(8),n(4),r]}(e)}}}(e);return t?new Ct(...t,!1):void 0}get rgb(){const{r:e,g:t,b:i,a:r}=this,n=r||1/0;return this.overwriteGetter("rgb",[e/n,t/n,i/n,r])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,i,r,n]=ut(e),o=Math.sqrt(i*i+r*r);return[Math.round(1e4*o)?ct(Math.atan2(r,i)*lt):NaN,o,t,n]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ut(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,i,r]=this.rgb;return`rgba(${[e,t,i].map((e=>Math.round(255*e))).join(",")},${r})`}static interpolate(e,t,i,r="rgb"){switch(r){case"rgb":{const[r,n,o,s]=St(e.rgb,t.rgb,i);return new Ct(r,n,o,s,!1)}case"hcl":{const[r,n,o,s]=e.hcl,[a,l,c,u]=t.hcl;let h,d;if(isNaN(r)||isNaN(a))isNaN(r)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=r,1!==c&&0!==c||(d=n));else{let e=a-r;a>r&&e>180?e-=360:a<r&&r-a>180&&(e+=360),h=r+i*e}const[p,f,m,g]=function([e,t,i,r]){return e=isNaN(e)?0:e*at,pt([i,Math.cos(e)*t,Math.sin(e)*t,r])}([h,null!=d?d:Tt(n,l,i),Tt(o,c,i),Tt(s,u,i)]);return new Ct(p,f,m,g,!1)}case"lab":{const[r,n,o,s]=pt(St(e.lab,t.lab,i));return new Ct(r,n,o,s,!1)}}}}Ct.black=new Ct(0,0,0,1),Ct.white=new Ct(1,1,1,1),Ct.transparent=new Ct(0,0,0,0),Ct.red=new Ct(1,0,0,1);class Mt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const kt=["bottom","center","top"];class Et{constructor(e,t,i,r,n,o){this.text=e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n,this.verticalAlign=o}}class At{constructor(e){this.sections=e}static fromString(e){return new At([new Et(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof At?e:At.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class It{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof It)return e;if("number"==typeof e)return new It([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new It(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){return new It(St(e.values,t.values,i))}}class zt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof zt)return e;if("number"==typeof e)return new zt([e]);if(Array.isArray(e)){for(const t of e)if("number"!=typeof t)return;return new zt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){return new zt(St(e.values,t.values,i))}}class Pt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Pt)return e;if("string"==typeof e){const t=Ct.parse(e);if(!t)return;return new Pt([t])}if(!Array.isArray(e))return;const t=[];for(const i of e){if("string"!=typeof i)return;const e=Ct.parse(i);if(!e)return;t.push(e)}return new Pt(t)}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i,r="rgb"){const n=[];if(e.values.length!=t.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${t.values.length}), cannot interpolate.`);for(let o=0;o<e.values.length;o++)n.push(Ct.interpolate(e.values[o],t.values[o],i,r));return new Pt(n)}}class Lt extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Dt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Rt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Rt)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];if("string"!=typeof i||!Dt.has(i))return;if(!Array.isArray(r)||2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])return}return new Rt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,i){const r=e.values,n=t.values;if(r.length!==n.length)throw new Lt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let e=0;e<r.length;e+=2){if(r[e]!==n[e])throw new Lt(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${r[e]}, to[${e}]: ${n[e]}`);o.push(r[e]);const[t,s]=r[e+1],[a,l]=n[e+1];o.push([Tt(t,a,i),Tt(s,l,i)])}return new Rt(o)}}class Bt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Bt({name:e,available:!1}):null}}class Ot{constructor(e,t,i){this.from=e,this.to=t,this.transition=i}static interpolate(e,t,i){return new Ot(e,t,i)}static parse(e){return e instanceof Ot?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Ot(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Ot(e.from,e.to,e.transition):"string"==typeof e?new Ot(e,e,1):void 0}}function Ft(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jt(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Ot||e instanceof Ct||e instanceof Mt||e instanceof At||e instanceof It||e instanceof zt||e instanceof Pt||e instanceof Rt||e instanceof Bt)return!0;if(Array.isArray(e)){for(const t of e)if(!jt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!jt(e[t]))return!1;return!0}return!1}function $t(e){if(null===e)return Le;if("string"==typeof e)return Re;if("boolean"==typeof e)return Be;if("number"==typeof e)return De;if(e instanceof Ct)return Oe;if(e instanceof Ot)return Fe;if(e instanceof Mt)return Ne;if(e instanceof At)return Ue;if(e instanceof It)return Ve;if(e instanceof zt)return qe;if(e instanceof Pt)return Ge;if(e instanceof Rt)return We;if(e instanceof Bt)return Ze;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=$t(t);if(i){if(i===e)continue;i=$e;break}i=e}return He(i||$e,t)}return je}function Nt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ct||e instanceof Ot||e instanceof At||e instanceof It||e instanceof zt||e instanceof Pt||e instanceof Rt||e instanceof Bt?e.toString():JSON.stringify(e)}class Ut{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!jt(e[1]))return t.error("invalid value");const i=e[1];let r=$t(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new Ut(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Vt={string:Re,number:De,boolean:Be,object:je};class Gt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Vt)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=Vt[i],r++}else n=$e;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=He(n,o)}else{if(!Vt[n])throw new Error(`Types doesn't contain name = ${n}`);i=Vt[n]}const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,$e);if(!i)return null;o.push(i)}return new Gt(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!Ye(this.type,$t(i)))return i;if(t===this.args.length-1)throw new Lt(`Expected value to be of type ${Xe(this.type)}, but found ${Xe($t(i))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const qt={"to-boolean":Be,"to-color":Oe,"to-number":De,"to-string":Re};class Zt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(!qt[i])throw new Error(`Can't parse ${i} as it is not part of the known types`);if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=qt[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,$e);if(!r)return null;n.push(r)}return new Zt(r,n)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof Ct)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Ft(t[0],t[1],t[2],t[3]),!i))return new Ct(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Lt(i||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const i of this.args){t=i.evaluate(e);const r=It.parse(t);if(r)return r}throw new Lt(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"numberArray":{let t;for(const i of this.args){t=i.evaluate(e);const r=zt.parse(t);if(r)return r}throw new Lt(`Could not parse numberArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"colorArray":{let t;for(const i of this.args){t=i.evaluate(e);const r=Pt.parse(t);if(r)return r}throw new Lt(`Could not parse colorArray from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const i of this.args){t=i.evaluate(e);const r=Rt.parse(t);if(r)return r}throw new Lt(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new Lt(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return At.fromString(Nt(this.args[0].evaluate(e)));case"resolvedImage":return Bt.fromString(Nt(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Nt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Wt=["Unknown","Point","LineString","Polygon"];class Ht{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Wt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache.get(e);return t||(t=Ct.parse(e),this._parseColorCache.set(e,t)),t}}class Xt{constructor(e,t,i=[],r,n=new Pe,o=[]){this.registry=e,this.path=i,this.key=i.map((e=>`[${e}]`)).join(""),this.scope=n,this.errors=o,this.expectedType=r,this._isConstant=t}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new Gt(t,[e]):"coerce"===i?new Zt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind){if("projectionDefinition"===e.kind&&["string","array"].includes(n.kind)||["color","formatted","resolvedImage"].includes(e.kind)&&["value","string"].includes(n.kind)||["padding","numberArray"].includes(e.kind)&&["value","number","array"].includes(n.kind)||"colorArray"===e.kind&&["value","string","array"].includes(n.kind)||"variableAnchorOffsetCollection"===e.kind&&["value","array"].includes(n.kind))r=i(r,e,t.typeAnnotation||"coerce");else if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof Ut)&&"resolvedImage"!==r.type.kind&&this._isConstant(r)){const t=new Ht;try{r=new Ut(r.type,r.evaluate(t))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Xt(this.registry,this._isConstant,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new ze(i,e))}checkSubtype(e,t){const i=Ye(e,t);return i&&this.error(i),i}}class Kt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new Kt(i,r):null}outputDefined(){return this.result.outputDefined()}}class Yt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Yt(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Jt{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,De),r=t.parse(e[2],2,He(t.expectedType||$e));return i&&r?new Jt(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new Lt(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new Lt(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new Lt(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Qt{constructor(e,t){this.type=Be,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,$e);return i&&r?Je(i.type,[Be,Re,De,Le,$e])?new Qt(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!i)return!1;if(!Qe(t,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${Xe($t(t))} instead.`);if(!Qe(i,["string","array"]))throw new Lt(`Expected second argument to be of type array or string, but found ${Xe($t(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ei{constructor(e,t,i){this.type=De,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,$e);if(!i||!r)return null;if(!Je(i.type,[Be,Re,De,Le,$e]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,De);return n?new ei(i,r,n):null}return new ei(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Qe(t,["boolean","string","number","null"]))throw new Lt(`Expected first argument to be of type boolean, string, number or null, but found ${Xe($t(t))} instead.`);let r;if(this.fromIndex&&(r=this.fromIndex.evaluate(e)),Qe(i,["string"])){const e=i.indexOf(t,r);return-1===e?-1:[...i.slice(0,e)].length}if(Qe(i,["array"]))return i.indexOf(t,r);throw new Lt(`Expected second argument to be of type array or string, but found ${Xe($t(i))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ti{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,$t(e)))return null}else i=$t(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,$e);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new ti(i,r,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return($t(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ii{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,Be);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);if(!n)return null;if(!i)throw new Error("Can't infer output type");return new ii(i,r,n)}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ri{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,$e),r=t.parse(e[2],2,De);if(!i||!r)return null;if(!Je(i.type,[He($e),Re,$e]))return t.error(`Expected first argument to be of type array or string, but found ${Xe(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,De);return n?new ri(i.type,i,r,n):null}return new ri(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);let r;if(this.endIndex&&(r=this.endIndex.evaluate(e)),Qe(t,["string"]))return[...t].slice(i,r).join("");if(Qe(t,["array"]))return t.slice(i,r);throw new Lt(`Expected first argument to be of type array or string, but found ${Xe($t(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ni(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new Lt("Input is not a number.");s=a-1}return 0}class oi{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,De);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new oi(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[ni(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function si(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ai,li,ci=function(){if(li)return ai;function e(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}return li=1,ai=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var o=this.sampleCurveDerivativeX(i);if(Math.abs(o)<1e-6)break;i-=n/o}var s=0,a=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?s=i:a=i,i=.5*(a-s)+s;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ai}(),ui=si(ci);class hi{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=di(t,e.base,i,r);else if("linear"===e.name)n=di(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new ui(o[0],o[1],o[2],o[3]).solve(di(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,De),!n)return null;const s=[];let a=null;"interpolate-hcl"!==i&&"interpolate-lab"!==i||t.expectedType==Ge?t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType):a=Oe;for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return et(a,De)||et(a,Fe)||et(a,Oe)||et(a,Ve)||et(a,qe)||et(a,Ge)||et(a,We)||et(a,He(De))?new hi(a,i,r,n,s):t.error(`Type ${Xe(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=ni(t,r),s=hi.interpolationFactor(this.interpolation,r,t[o],t[o+1]),a=i[o].evaluate(e),l=i[o+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Tt(a,l,s);case"color":return Ct.interpolate(a,l,s);case"padding":return It.interpolate(a,l,s);case"colorArray":return Pt.interpolate(a,l,s);case"numberArray":return zt.interpolate(a,l,s);case"variableAnchorOffsetCollection":return Rt.interpolate(a,l,s);case"array":return St(a,l,s);case"projectionDefinition":return Ot.interpolate(a,l,s)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ct.interpolate(a,l,s,"hcl");case"colorArray":return Pt.interpolate(a,l,s,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ct.interpolate(a,l,s,"lab");case"colorArray":return Pt.interpolate(a,l,s,"lab")}}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function di(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}const pi={color:Ct.interpolate,number:Tt,padding:It.interpolate,numberArray:zt.interpolate,colorArray:Pt.interpolate,variableAnchorOffsetCollection:Rt.interpolate,array:St};class fi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}if(!i)throw new Error("No output type");const o=r&&n.some((e=>Ye(r,e.type)));return new fi(o?$e:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args)if(r++,i=n.evaluate(e),i&&i instanceof Bt&&!i.available&&(t||(t=i.name),i=null,r===this.args.length&&(i=t)),null!==i)break;return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function mi(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function gi(e,t,i,r){return 0===r.compare(t,i)}function yi(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=Be,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,$e);if(!o)return null;if(!mi(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Xe(o.type)}'.`);let s=t.parse(e[2],2,$e);if(!s)return null;if(!mi(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Xe(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Xe(o.type)}' and '${Xe(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Gt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Gt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Ne),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=$t(o),i=$t(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new Lt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=$t(o),i=$t(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const _i=yi("==",(function(e,t,i){return t===i}),gi),vi=yi("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!gi(0,t,i,r)})),xi=yi("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),bi=yi(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),wi=yi("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),Ti=yi(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class Si{constructor(e,t,i){this.type=Ne,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Be);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Be);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,Re),!o)?null:new Si(r,n,o)}evaluate(e){return new Mt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Ci{constructor(e,t,i,r,n){this.type=Re,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,De);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,Re),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,Re),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,De),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=t.parse(r["max-fraction-digits"],1,De),!a)?null:new Ci(i,n,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Mi{constructor(e){this.type=Ue,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,De),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,He(Re)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Oe),!s))return null;let a=null;if(o["vertical-align"]){if("string"==typeof o["vertical-align"]&&!kt.includes(o["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${o["vertical-align"]}' instead.`);if(a=t.parse(o["vertical-align"],1,Re),!a)return null}const l=r[r.length-1];l.scale=e,l.font=i,l.textColor=s,l.verticalAlign=a}else{const o=t.parse(e[i],1,$e);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Mi(r)}evaluate(e){return new At(this.sections.map((t=>{const i=t.content.evaluate(e);return $t(i)===Ze?new Et("",i,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new Et(Nt(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class ki{constructor(e){this.type=Ze,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Re);return i?new ki(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Bt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ei{constructor(e){this.type=De,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Xe(i.type)} instead.`):new Ei(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Lt(`Expected value to be of type string or array, but found ${Xe($t(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ai=8192;function Ii(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*Ai),Math.round(r*n*Ai)]}function zi(e,t){const i=Math.pow(2,t.z);return[(n=(e[0]/Ai+t.x)/i,360*n-180),(r=(e[1]/Ai+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,n}function Pi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Li(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Di(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function Ri(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*o[0]&&!(!Ni(e,t,i,r)||!Ni(i,r,e,t));var n,o}function Bi(e,t,i){for(const r of i)for(let i=0;i<r.length-1;++i)if(Ri(e,t,r[i],r[i+1]))return!0;return!1}function Oi(e,t,i=!1){let r=!1;for(const a of t)for(let t=0;t<a.length-1;t++){if(Di(e,a[t],a[t+1]))return i;(o=a[t])[1]>(n=e)[1]!=(s=a[t+1])[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}var n,o,s;return r}function Fi(e,t){for(const i of t)if(Oi(e,i))return!0;return!1}function ji(e,t){for(const i of e)if(!Oi(i,t))return!1;for(let i=0;i<e.length-1;++i)if(Bi(e[i],e[i+1],t))return!1;return!0}function $i(e,t){for(const i of t)if(ji(e,i))return!0;return!1}function Ni(e,t,i,r){const n=r[0]-i[0],o=r[1]-i[1],s=(e[0]-i[0])*o-n*(e[1]-i[1]),a=(t[0]-i[0])*o-n*(t[1]-i[1]);return s>0&&a<0||s<0&&a>0}function Ui(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=Ii(e[n][r],i);Pi(t,s),o.push(s)}r.push(o)}return r}function Vi(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=Ui(e[n],t,i);r.push(o)}return r}function Gi(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Pi(t,e)}function qi(e,t,i,r){const n=Math.pow(2,r.z)*Ai,o=[r.x*Ai,r.y*Ai],s=[];for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];Gi(r,t,i,n),s.push(r)}return s}function Zi(e,t,i,r){const n=Math.pow(2,r.z)*Ai,o=[r.x*Ai,r.y*Ai],s=[];for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];Pi(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)Gi(r,t,i,n)}var a;return s}class Wi{constructor(e,t){this.type=Be,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jt(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const i of t.features){const{type:t,coordinates:r}=i.geometry;"Polygon"===t&&e.push(r),"MultiPolygon"===t&&e.push(...r)}if(e.length)return new Wi(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Wi(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Wi(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=Ui(t.coordinates,r,n),s=qi(e.geometry(),i,r,n);if(!Li(i,r))return!1;for(const e of s)if(!Oi(e,o))return!1}if("MultiPolygon"===t.type){const o=Vi(t.coordinates,r,n),s=qi(e.geometry(),i,r,n);if(!Li(i,r))return!1;for(const e of s)if(!Fi(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if("Polygon"===t.type){const o=Ui(t.coordinates,r,n),s=Zi(e.geometry(),i,r,n);if(!Li(i,r))return!1;for(const e of s)if(!ji(e,o))return!1}if("MultiPolygon"===t.type){const o=Vi(t.coordinates,r,n),s=Zi(e.geometry(),i,r,n);if(!Li(i,r))return!1;for(const e of s)if(!$i(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hi=class{constructor(e,t){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}};function Xi(e,t,i=0,r=e.length-1,n=Yi){for(;r>i;){if(r-i>600){const o=r-i+1,s=t-i+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);Xi(e,t,Math.max(i,Math.floor(t-s*l/o+c)),Math.min(r,Math.floor(t+(o-s)*l/o+c)),n)}const o=e[t];let s=i,a=r;for(Ki(e,i,t),n(e[r],o)>0&&Ki(e,i,r);s<a;){for(Ki(e,s,a),s++,a--;n(e[s],o)<0;)s++;for(;n(e[a],o)>0;)a--}0===n(e[i],o)?Ki(e,i,a):(a++,Ki(e,a,r)),a<=t&&(i=a+1),t<=a&&(r=a-1)}}function Ki(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function Yi(e,t){return e<t?-1:e>t?1:0}function Ji(e,t){if(e.length<=1)return[e];const i=[];let r,n;for(const t of e){const e=er(t);0!==e&&(t.area=Math.abs(e),void 0===n&&(n=e<0),n===e<0?(r&&i.push(r),r=[t]):r.push(t))}if(r&&i.push(r),t>1)for(let e=0;e<i.length;e++)i[e].length<=t||(Xi(i[e],t,1,i[e].length-1,Qi),i[e]=i[e].slice(0,t));return i}function Qi(e,t){return t.area-e.area}function er(e){let t=0;for(let i,r,n=0,o=e.length,s=o-1;n<o;s=n++)i=e[n],r=e[s],t+=(r.x-i.x)*(i.y+r.y);return t}const tr=1/298.257223563,ir=tr*(2-tr),rr=Math.PI/180;class nr{constructor(e){const t=6378.137*rr*1e3,i=Math.cos(e*rr),r=1/(1-ir*(1-i*i)),n=Math.sqrt(r);this.kx=t*n*i,this.ky=t*n*r*(1-ir)}distance(e,t){const i=this.wrap(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)}pointOnLine(e,t){let i,r,n,o,s=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=this.wrap(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,i=l,r=c,n=a,o=d)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function or(e,t){return t[0]-e[0]}function sr(e){return e[1]-e[0]+1}function ar(e,t){return e[1]>=e[0]&&e[1]<t}function lr(e,t){if(e[0]>e[1])return[null,null];const i=sr(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===i)return[e,null];const r=Math.floor(i/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}function cr(e,t){if(!ar(t,e.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let r=t[0];r<=t[1];++r)Pi(i,e[r]);return i}function ur(e){const t=[1/0,1/0,-1/0,-1/0];for(const i of e)for(const e of i)Pi(t,e);return t}function hr(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function dr(e,t,i){if(!hr(e)||!hr(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function pr(e,t,i){const r=i.pointOnLine(t,e);return i.distance(e,r.point)}function fr(e,t,i,r,n){const o=Math.min(pr(e,[i,r],n),pr(t,[i,r],n)),s=Math.min(pr(i,[e,t],n),pr(r,[e,t],n));return Math.min(o,s)}function mr(e,t,i,r,n){if(!ar(t,e.length)||!ar(r,i.length))return 1/0;let o=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],a=e[s+1];for(let e=r[0];e<r[1];++e){const r=i[e],s=i[e+1];if(Ri(t,a,r,s))return 0;o=Math.min(o,fr(t,a,r,s,n))}}return o}function gr(e,t,i,r,n){if(!ar(t,e.length)||!ar(r,i.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=r[0];t<=r[1];++t)if(o=Math.min(o,n.distance(e[s],i[t])),0===o)return o;return o}function yr(e,t,i){if(Oi(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n[0],o=n[n.length-1];if(t!==o&&(r=Math.min(r,pr(e,[o,t],i)),0===r))return r;const s=i.pointOnLine(n,e);if(r=Math.min(r,i.distance(e,s.point)),0===r)return r}return r}function _r(e,t,i,r){if(!ar(t,e.length))return NaN;for(let r=t[0];r<=t[1];++r)if(Oi(e[r],i,!0))return 0;let n=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],s=e[o+1];for(const e of i)for(let i=0,o=e.length,a=o-1;i<o;a=i++){const o=e[a],l=e[i];if(Ri(t,s,o,l))return 0;n=Math.min(n,fr(t,s,o,l,r))}}return n}function vr(e,t){for(const i of e)for(const e of i)if(Oi(e,t,!0))return!0;return!1}function xr(e,t,i,r=1/0){const n=ur(e),o=ur(t);if(r!==1/0&&dr(n,o,i)>=r)return r;if(Li(n,o)){if(vr(e,t))return 0}else if(vr(t,e))return 0;let s=1/0;for(const r of e)for(let e=0,n=r.length,o=n-1;e<n;o=e++){const n=r[o],a=r[e];for(const e of t)for(let t=0,r=e.length,o=r-1;t<r;o=t++){const r=e[o],l=e[t];if(Ri(n,a,r,l))return 0;s=Math.min(s,fr(n,a,r,l,i))}}return s}function br(e,t,i,r,n,o){if(!o)return;const s=dr(cr(r,o),n,i);s<t&&e.push([s,o,[0,0]])}function wr(e,t,i,r,n,o,s){if(!o||!s)return;const a=dr(cr(r,o),cr(n,s),i);a<t&&e.push([a,o,s])}function Tr(e,t,i,r,n=1/0){let o=Math.min(r.distance(e[0],i[0][0]),n);if(0===o)return o;const s=new Hi([[0,[0,e.length-1],[0,0]]],or),a=ur(i);for(;s.length>0;){const n=s.pop();if(n[0]>=o)continue;const l=n[1],c=t?50:100;if(sr(l)<=c){if(!ar(l,e.length))return NaN;if(t){const t=_r(e,l,i,r);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const n=yr(e[t],i,r);if(o=Math.min(o,n),0===o)return 0}}else{const i=lr(l,t);br(s,o,r,e,a,i[0]),br(s,o,r,e,a,i[1])}}return o}function Sr(e,t,i,r,n,o=1/0){let s=Math.min(o,n.distance(e[0],i[0]));if(0===s)return s;const a=new Hi([[0,[0,e.length-1],[0,i.length-1]]],or);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=t?50:100,h=r?50:100;if(sr(l)<=u&&sr(c)<=h){if(!ar(l,e.length)&&ar(c,i.length))return NaN;let o;if(t&&r)o=mr(e,l,i,c,n),s=Math.min(s,o);else if(t&&!r){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=pr(i[e],t,n),s=Math.min(s,o),0===s)return s}else if(!t&&r){const t=i.slice(c[0],c[1]+1);for(let i=l[0];i<=l[1];++i)if(o=pr(e[i],t,n),s=Math.min(s,o),0===s)return s}else o=gr(e,l,i,c,n),s=Math.min(s,o)}else{const o=lr(l,t),u=lr(c,r);wr(a,s,n,e,i,o[0],u[0]),wr(a,s,n,e,i,o[0],u[1]),wr(a,s,n,e,i,o[1],u[0]),wr(a,s,n,e,i,o[1],u[1])}}return s}function Cr(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class Mr{constructor(e,t){this.type=De,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(jt(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new Mr(t,t.features.map((e=>Cr(e.geometry))).flat());if("Feature"===t.type)return new Mr(t,Cr(t.geometry));if("type"in t&&"coordinates"in t)return new Mr(t,Cr(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>zi([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new nr(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Sr(r,!1,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Sr(r,!1,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,Tr(r,!1,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=e.geometry(),r=i.flat().map((t=>zi([t.x,t.y],e.canonical)));if(0===i.length)return NaN;const n=new nr(r[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Sr(r,!0,[e.coordinates],!1,n,o));break;case"LineString":o=Math.min(o,Sr(r,!0,e.coordinates,!0,n,o));break;case"Polygon":o=Math.min(o,Tr(r,!0,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const i=e.geometry();if(0===i.length||0===i[0].length)return NaN;const r=Ji(i,0).map((t=>t.map((t=>t.map((t=>zi([t.x,t.y],e.canonical))))))),n=new nr(r[0][0][0][1]);let o=1/0;for(const e of t)for(const t of r){switch(e.type){case"Point":o=Math.min(o,Tr([e.coordinates],!1,t,n,o));break;case"LineString":o=Math.min(o,Tr(e.coordinates,!0,t,n,o));break;case"Polygon":o=Math.min(o,xr(t,e.coordinates,n,o))}if(0===o)return o}return o}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class kr{constructor(e){this.type=$e,this.key=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=e[1];return null==i?t.error("Global state property must be defined."):"string"!=typeof i?t.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new kr(i)}evaluate(e){var t;const i=null===(t=e.globals)||void 0===t?void 0:t.globalState;return i&&0!==Object.keys(i).length?yt(i,this.key):null}eachChild(){}outputDefined(){return!1}}const Er={"==":_i,"!=":vi,">":bi,"<":xi,">=":Ti,"<=":wi,array:Gt,at:Jt,boolean:Gt,case:ii,coalesce:fi,collator:Si,format:Mi,image:ki,in:Qt,"index-of":ei,interpolate:hi,"interpolate-hcl":hi,"interpolate-lab":hi,length:Ei,let:Kt,literal:Ut,match:ti,number:Gt,"number-format":Ci,object:Gt,slice:ri,step:oi,string:Gt,"to-boolean":Zt,"to-color":Zt,"to-number":Zt,"to-string":Zt,var:Yt,within:Wi,distance:Mr,"global-state":kr};class Ar{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const i=e[0],r=Ar.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new Xt(t.registry,Dr,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new Ar(i,n,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Xe).join(", ")})`:`(${Xe(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Xe(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){Ar.definitions=t;for(const i in t)e[i]=Ar}}function Ir(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=Ft(t,i,r,o);if(s)throw new Lt(s);return new Ct(t/255,i/255,r/255,o,!1)}function zr(e,t){return e in t}function Pr(e,t){const i=t[e];return void 0===i?null:i}function Lr(e){return{type:e}}function Dr(e){if(e instanceof Yt)return Dr(e.boundExpression);if(e instanceof Ar&&"error"===e.name)return!1;if(e instanceof Si)return!1;if(e instanceof Wi)return!1;if(e instanceof Mr)return!1;if(e instanceof kr)return!1;const t=e instanceof Zt||e instanceof Gt;let i=!0;return e.eachChild((e=>{i=t?i&&Dr(e):i&&e instanceof Ut})),!!i&&Rr(e)&&Or(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Rr(e){if(e instanceof Ar){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Wi)return!1;if(e instanceof Mr)return!1;let t=!0;return e.eachChild((e=>{t&&!Rr(e)&&(t=!1)})),t}function Br(e){if(e instanceof Ar&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Br(e)&&(t=!1)})),t}function Or(e,t){if(e instanceof Ar&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Or(e,t)&&(i=!1)})),i}function Fr(e){return{result:"success",value:e}}function jr(e){return{result:"error",value:e}}function $r(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Nr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Ur(e){return!!e.expression&&e.expression.interpolated}function Vr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Gr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&$t(e)===je}function qr(e){return e}function Zr(e,t){const i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),n=e.type||(Ur(t)?"exponential":"interval"),o=function(e){switch(e.type){case"color":return Ct.parse;case"padding":return It.parse;case"numberArray":return zt.parse;case"colorArray":return Pt.parse;default:return null}}(t);if(o&&((e=Ie({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],o(e[1])]))),e.default=o(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==(s=e.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${e.colorSpace}"`);var s;const a=function(e){switch(e){case"exponential":return Kr;case"interval":return Xr;case"categorical":return Hr;case"identity":return Yr;default:throw new Error(`Unknown function type "${e}"`)}}(n);let l,c;if("categorical"===n){l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}if(i){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],o=n[0].zoom;void 0===i[o]&&(i[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},r.push(o)),i[o].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,Zr(i[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:hi.interpolationFactor.bind(void 0,o),zoomStops:n.map((e=>e[0])),evaluate:({zoom:i},r)=>Kr({stops:n,base:e.base},t,i).evaluate(i,r)}}if(r){const i="exponential"===n?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:hi.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:i})=>a(e,t,i,l,c)}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?Wr(e.default,t.default):a(e,t,n,l,c)}}}function Wr(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Hr(e,t,i,r,n){return Wr(typeof i===n?r[i]:void 0,e.default,t.default)}function Xr(e,t,i){if("number"!==Vr(i))return Wr(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=ni(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function Kr(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==Vr(i))return Wr(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const o=ni(e.stops.map((e=>e[0])),i),s=function(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1],c=pi[t.type]||qr;return"function"==typeof a.evaluate?{evaluate(...t){const i=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==i&&void 0!==r)return c(i,r,s,e.colorSpace)}}:c(a,l,s,e.colorSpace)}function Yr(e,t,i){switch(t.type){case"color":i=Ct.parse(i);break;case"formatted":i=At.fromString(i.toString());break;case"resolvedImage":i=Bt.fromString(i.toString());break;case"padding":i=It.parse(i);break;case"colorArray":i=Pt.parse(i);break;case"numberArray":i=zt.parse(i);break;default:Vr(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0)}return Wr(i,e.default,t.default)}Ar.register(Er,{error:[{kind:"error"},[Re],(e,[t])=>{throw new Lt(t.evaluate(e))}],typeof:[Re,[$e],(e,[t])=>Xe($t(t.evaluate(e)))],"to-rgba":[He(De,4),[Oe],(e,[t])=>{const[i,r,n,o]=t.evaluate(e).rgb;return[255*i,255*r,255*n,o]}],rgb:[Oe,[De,De,De],Ir],rgba:[Oe,[De,De,De,De],Ir],has:{type:Be,overloads:[[[Re],(e,[t])=>zr(t.evaluate(e),e.properties())],[[Re,je],(e,[t,i])=>zr(t.evaluate(e),i.evaluate(e))]]},get:{type:$e,overloads:[[[Re],(e,[t])=>Pr(t.evaluate(e),e.properties())],[[Re,je],(e,[t,i])=>Pr(t.evaluate(e),i.evaluate(e))]]},"feature-state":[$e,[Re],(e,[t])=>Pr(t.evaluate(e),e.featureState||{})],properties:[je,[],e=>e.properties()],"geometry-type":[Re,[],e=>e.geometryType()],id:[$e,[],e=>e.id()],zoom:[De,[],e=>e.globals.zoom],"heatmap-density":[De,[],e=>e.globals.heatmapDensity||0],"line-progress":[De,[],e=>e.globals.lineProgress||0],accumulated:[$e,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[De,Lr(De),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[De,Lr(De),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:De,overloads:[[[De,De],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[De],(e,[t])=>-t.evaluate(e)]]},"/":[De,[De,De],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[De,[De,De],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[De,[De],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[De,[De],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[De,[De],(e,[t])=>Math.log(t.evaluate(e))],log2:[De,[De],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[De,[De],(e,[t])=>Math.sin(t.evaluate(e))],cos:[De,[De],(e,[t])=>Math.cos(t.evaluate(e))],tan:[De,[De],(e,[t])=>Math.tan(t.evaluate(e))],asin:[De,[De],(e,[t])=>Math.asin(t.evaluate(e))],acos:[De,[De],(e,[t])=>Math.acos(t.evaluate(e))],atan:[De,[De],(e,[t])=>Math.atan(t.evaluate(e))],min:[De,Lr(De),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[De,Lr(De),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[De,[De],(e,[t])=>Math.abs(t.evaluate(e))],round:[De,[De],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[De,[De],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[De,[De],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Be,[Re,$e],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Be,[$e],(e,[t])=>e.id()===t.value],"filter-type-==":[Be,[Re],(e,[t])=>e.geometryType()===t.value],"filter-<":[Be,[Re,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[Be,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[Be,[Re,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[Be,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[Be,[Re,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[Be,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[Be,[Re,$e],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[Be,[$e],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[Be,[$e],(e,[t])=>t.value in e.properties()],"filter-has-id":[Be,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Be,[He(Re)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Be,[He($e)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Be,[Re,He($e)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Be,[Re,He($e)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Be,overloads:[[[Be,Be],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Lr(Be),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Be,overloads:[[[Be,Be],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Lr(Be),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Be,[Be],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Be,[Re],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Re,[Re],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Re,[Re],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Re,Lr($e),(e,t)=>t.map((t=>Nt(t.evaluate(e)))).join("")],"resolved-locale":[Re,[Ne],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Jr{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Ht,this._defaultValue=t?function(e){if("color"===e.type&&Gr(e.default))return new Ct(0,0,0,0);switch(e.type){case"color":return Ct.parse(e.default)||null;case"padding":return It.parse(e.default)||null;case"numberArray":return zt.parse(e.default)||null;case"colorArray":return Pt.parse(e.default)||null;case"variableAnchorOffsetCollection":return Rt.parse(e.default)||null;case"projectionDefinition":return Ot.parse(e.default)||null;default:return void 0===e.default?null:e.default}}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Lt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Qr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Er}function en(e,t){const i=new Xt(Er,Dr,[],t?function(e){const t={color:Oe,string:Re,number:De,enum:Re,boolean:Be,formatted:Ue,padding:Ve,numberArray:qe,colorArray:Ge,projectionDefinition:Fe,resolvedImage:Ze,variableAnchorOffsetCollection:We};return"array"===e.type?He(t[e.value]||$e,e.length):t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Fr(new Jr(r,t)):jr(i.errors)}class tn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Br(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class rn{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Br(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?hi.interpolationFactor(this.interpolationType,e,t,i):0}}function nn(e,t){const i=en(e,t);if("error"===i.result)return i;const r=i.value.expression,n=Rr(r);if(!n&&!$r(t))return jr([new ze("","data expressions not supported")]);const o=Or(r,["zoom"]);if(!o&&!Nr(t))return jr([new ze("","zoom expressions not supported")]);const s=sn(r);return s||o?s instanceof ze?jr([s]):s instanceof hi&&!Ur(t)?jr([new ze("",'"interpolate" expressions cannot be used with this property')]):Fr(s?new rn(n?"camera":"composite",i.value,s.labels,s instanceof hi?s.interpolation:void 0):new tn(n?"constant":"source",i.value)):jr([new ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class on{constructor(e,t){this._parameters=e,this._specification=t,Ie(this,Zr(this._parameters,this._specification))}static deserialize(e){return new on(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function sn(e){let t=null;if(e instanceof Kt)t=sn(e.result);else if(e instanceof fi){for(const i of e.args)if(t=sn(i),t)break}else(e instanceof oi||e instanceof hi)&&e.input instanceof Ar&&"zoom"===e.input.name&&(t=e);return t instanceof ze||e.eachChild((e=>{const i=sn(e);i instanceof ze?t=i:!t&&i?t=new ze("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new ze("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function an(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!an(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const ln={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function cn(e){if(null==e)return{filter:()=>!0,needGeometry:!1};an(e)||(e=dn(e));const t=en(e,ln);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,i,r)=>t.value.evaluate(e,i,{},r),needGeometry:hn(e)}}function un(e,t){return e<t?-1:e>t?1:0}function hn(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(hn(e[t]))return!0;return!1}function dn(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?pn(e[1],e[2],"=="):"!="===t?gn(pn(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?pn(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(dn))):"all"===t?["all"].concat(e.slice(1).map(dn)):"none"===t?["all"].concat(e.slice(1).map(dn).map(gn)):"in"===t?fn(e[1],e.slice(2)):"!in"===t?gn(fn(e[1],e.slice(2))):"has"===t?mn(e[1]):"!has"!==t||gn(mn(e[1]));var i}function pn(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function fn(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(un)]]:["filter-in-small",e,["literal",t]]}}function mn(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function gn(e){return["!",e]}function yn(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+=`${yn(i)},`;return`${t}]`}const i=Object.keys(e).sort();let r="{";for(let t=0;t<i.length;t++)r+=`${JSON.stringify(i[t])}:${yn(e[i[t]])},`;return`${r}}`}function _n(e){let t="";for(const i of _e)t+=`/${yn(e[i])}`;return t}function vn(e){const t=e.value;return t?[new Ae(e.key,t,"constants have been deprecated as of v8")]:[]}function xn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function bn(e){if(Array.isArray(e))return e.map(bn);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=bn(e[i]);return t}return xn(e)}function wn(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},o=e.style,s=e.styleSpec,a=e.validateSpec;let l=[];const c=Vr(i);if("object"!==c)return[new Ae(t,i,`object expected, ${c} found`)];for(const e in i){const c=e.split(".")[0],u=yt(r,c)||r["*"];let h;if(yt(n,c))h=n[c];else if(yt(r,c))h=a;else if(n["*"])h=n["*"];else{if(!r["*"]){l.push(new Ae(t,i[e],`unknown property "${e}"`));continue}h=a}l=l.concat(h({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:u,style:o,styleSpec:s,object:i,objectKey:e,validateSpec:a},i))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&l.push(new Ae(t,i,`missing required property "${e}"`));return l}function Tn(e){const t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,o=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==Vr(t))return[new Ae(o,t,`array expected, ${Vr(t)} found`)];if(i.length&&t.length!==i.length)return[new Ae(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Ae(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values};n.$version<7&&(a.function=i.function),"object"===Vr(i.value)&&(a=i.value);let l=[];for(let i=0;i<t.length;i++)l=l.concat(s({array:t,arrayIndex:i,value:t[i],valueSpec:a,validateSpec:e.validateSpec,style:r,styleSpec:n,key:`${o}[${i}]`}));return l}function Sn(e){const t=e.key,i=e.value,r=e.valueSpec;let n=Vr(i);return"number"===n&&i!=i&&(n="NaN"),"number"!==n?[new Ae(t,i,`number expected, ${n} found`)]:"minimum"in r&&i<r.minimum?[new Ae(t,i,`${i} is less than the minimum value ${r.minimum}`)]:"maximum"in r&&i>r.maximum?[new Ae(t,i,`${i} is greater than the maximum value ${r.maximum}`)]:[]}function Cn(e){const t=e.valueSpec,i=xn(e.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===Vr(e.value.stops)&&"array"===Vr(e.value.stops[0])&&"object"===Vr(e.value.stops[0][0]),u=wn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Ae(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;return t=t.concat(Tn({key:e.key,value:r,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Vr(r)&&0===r.length&&t.push(new Ae(e.key,r,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Ae(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Ae(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!Ur(e.valueSpec)&&u.push(new Ae(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!$r(e.valueSpec)?u.push(new Ae(e.key,e.value,"property functions not supported")):a&&!Nr(e.valueSpec)&&u.push(new Ae(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Ae(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const r=e.value,a=e.key;if("array"!==Vr(r))return[new Ae(a,r,`array expected, ${Vr(r)} found`)];if(2!==r.length)return[new Ae(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Vr(r[0]))return[new Ae(a,r,`object expected, ${Vr(r[0])} found`)];if(void 0===r[0].zoom)return[new Ae(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Ae(a,r,"object stop key must have value")];if(o&&o>xn(r[0].zoom))return[new Ae(a,r[0].zoom,"stop zoom values must appear in ascending order")];xn(r[0].zoom)!==o&&(o=xn(r[0].zoom),n=void 0,s={}),i=i.concat(wn({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Sn,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},r));return Qr(bn(r[1]))?i.concat([new Ae(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(e.validateSpec({key:`${a}[1]`,value:r[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Vr(e.value),l=xn(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new Ae(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Ae(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return $r(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ae(e.key,c,r)]}return"categorical"!==i||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&void 0!==n&&l<n?[new Ae(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new Ae(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Ae(e.key,c,`integer expected, found ${l}`)]}}function Mn(e){const t=("property"===e.expressionContext?nn:en)(bn(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Ae(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Ae(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Br(i))return[new Ae(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!Br(i))return[new Ae(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Or(i,["zoom","feature-state"]))return[new Ae(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Rr(i))return[new Ae(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function kn(e){const t=e.key,i=e.value,r=Vr(i);return"string"!==r?[new Ae(t,i,`color expected, ${r} found`)]:Ct.parse(String(i))?[]:[new Ae(t,i,`color expected, "${i}" found`)]}function En(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(xn(i))&&n.push(new Ae(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(xn(i))&&n.push(new Ae(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function An(e){return an(bn(e.value))?Mn(Ie({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):In(e)}function In(e){const t=e.value,i=e.key;if("array"!==Vr(t))return[new Ae(i,t,`array expected, ${Vr(t)} found`)];const r=e.styleSpec;let n,o=[];if(t.length<1)return[new Ae(i,t,"filter array must have at least 1 element")];switch(o=o.concat(En({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),xn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===xn(t[1])&&o.push(new Ae(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Ae(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=Vr(t[1]),"string"!==n&&o.push(new Ae(`${i}[1]`,t[1],`string expected, ${n} found`)));for(let s=2;s<t.length;s++)n=Vr(t[s]),"$type"===xn(t[1])?o=o.concat(En({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Ae(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(In({key:`${i}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=Vr(t[1]),2!==t.length?o.push(new Ae(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new Ae(`${i}[1]`,t[1],`string expected, ${n} found`))}return o}function zn(e,t){const i=e.key,r=e.validateSpec,n=e.style,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return r({key:i,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new Ae(i,s,`unknown property "${a}"`)];let h;if("string"===Vr(s)&&$r(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new Ae(i,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&d.push(new Ae(i,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Gr(bn(s))&&"identity"===xn(s.type)&&d.push(new Ae(i,s,'"text-font" does not support identity functions'))),d.concat(r({key:e.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function Pn(e){return zn(e,"paint")}function Ln(e){return zn(e,"layout")}function Dn(e){let t=[];const i=e.value,r=e.key,n=e.style,o=e.styleSpec;if("object"!==Vr(i))return[new Ae(r,i,`object expected, ${Vr(i)} found`)];i.type||i.ref||t.push(new Ae(r,i,'either "type" or "ref" is required'));let s=xn(i.type);const a=xn(i.ref);if(i.id){const o=xn(i.id);for(let s=0;s<e.arrayIndex;s++){const e=n.layers[s];xn(e.id)===o&&t.push(new Ae(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Ae(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{xn(t.id)===a&&(e=t)})),e?e.ref?t.push(new Ae(r,i.ref,"ref cannot reference another ref layer")):s=xn(e.type):t.push(new Ae(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(i.source){const e=n.sources&&n.sources[i.source],o=e&&xn(e.type);e?"vector"===o&&"raster"===s?t.push(new Ae(r,i.source,`layer "${i.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?t.push(new Ae(r,i.source,`layer "${i.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?t.push(new Ae(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Ae(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Ae(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ae(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Ae(r,i.source,`source "${i.source}" not found`))}else t.push(new Ae(r,i,'missing required property "source"'));return t=t.concat(wn({key:r,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:i,objectKey:"type"}),filter:An,layout:e=>wn({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Ln(Ie({layerType:s},e))}}),paint:e=>wn({layer:i,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Pn(Ie({layerType:s},e))}})}})),t}function Rn(e){const t=e.value,i=e.key,r=Vr(t);return"string"!==r?[new Ae(i,t,`string expected, ${r} found`)]:[]}const Bn={promoteId:function({key:e,value:t}){if("string"===Vr(t))return Rn({key:e,value:t});{const i=[];for(const r in t)i.push(...Rn({key:`${e}.${r}`,value:t[r]}));return i}}};function On(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style,o=e.validateSpec;if(!t.type)return[new Ae(i,t,'"type" is required')];const s=xn(t.type);let a;switch(s){case"vector":case"raster":return a=wn({key:i,value:t,valueSpec:r[`source_${s.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:Bn,validateSpec:o}),a;case"raster-dem":return a=function(e){var t;const i=null!==(t=e.sourceName)&&void 0!==t?t:"",r=e.value,n=e.styleSpec,o=n.source_raster_dem,s=e.style;let a=[];const l=Vr(r);if(void 0===r)return a;if("object"!==l)return a.push(new Ae("source_raster_dem",r,`object expected, ${l} found`)),a;const c="custom"===xn(r.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in r)!c&&u.includes(t)?a.push(new Ae(t,r[t],`In "${i}": "${t}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[t]?a=a.concat(e.validateSpec({key:t,value:r[t],valueSpec:o[t],validateSpec:e.validateSpec,style:s,styleSpec:n})):a.push(new Ae(t,r[t],`unknown property "${t}"`));return a}({sourceName:i,value:t,style:e.style,styleSpec:r,validateSpec:o}),a;case"geojson":if(a=wn({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,validateSpec:o,objectElementValidators:Bn}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;a.push(...Mn({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),a.push(...Mn({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return wn({key:i,value:t,valueSpec:r.source_video,style:n,validateSpec:o,styleSpec:r});case"image":return wn({key:i,value:t,valueSpec:r.source_image,style:n,validateSpec:o,styleSpec:r});case"canvas":return[new Ae(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return En({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fn(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];const s=Vr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ae("light",t,`object expected, ${s} found`)]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:i.transition,validateSpec:e.validateSpec,style:n,styleSpec:i}):r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i}):[new Ae(s,t[s],`unknown property "${s}"`)])}return o}function jn(e){const t=e.value,i=e.styleSpec,r=i.sky,n=e.style,o=Vr(t);if(void 0===t)return[];if("object"!==o)return[new Ae("sky",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i}):[new Ae(o,t[o],`unknown property "${o}"`)]);return s}function $n(e){const t=e.value,i=e.styleSpec,r=i.terrain,n=e.style;let o=[];const s=Vr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ae("terrain",t,`object expected, ${s} found`)]),o;for(const s in t)o=o.concat(r[s]?e.validateSpec({key:s,value:t[s],valueSpec:r[s],validateSpec:e.validateSpec,style:n,styleSpec:i}):[new Ae(s,t[s],`unknown property "${s}"`)]);return o}function Nn(e){let t=[];const i=e.value,r=e.key;if(Array.isArray(i)){const n=[],o=[];for(const s in i)i[s].id&&n.includes(i[s].id)&&t.push(new Ae(r,i,`all the sprites' ids must be unique, but ${i[s].id} is duplicated`)),n.push(i[s].id),i[s].url&&o.includes(i[s].url)&&t.push(new Ae(r,i,`all the sprites' URLs must be unique, but ${i[s].url} is duplicated`)),o.push(i[s].url),t=t.concat(wn({key:`${r}[${s}]`,value:i[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Rn({key:r,value:i})}function Un(e){return t=e.value,Boolean(t)&&t.constructor===Object?[]:[new Ae(e.key,e.value,`object expected, ${Vr(e.value)} found`)];var t}const Vn={"*":()=>[],array:Tn,boolean:function(e){const t=e.value,i=e.key,r=Vr(t);return"boolean"!==r?[new Ae(i,t,`boolean expected, ${r} found`)]:[]},number:Sn,color:kn,constants:vn,enum:En,filter:An,function:Cn,layer:Dn,object:wn,source:On,light:Fn,sky:jn,terrain:$n,projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,n=e.style,o=Vr(t);if(void 0===t)return[];if("object"!==o)return[new Ae("projection",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(r[o]?e.validateSpec({key:o,value:t[o],valueSpec:r[o],style:n,styleSpec:i}):[new Ae(o,t[o],`unknown property "${o}"`)]);return s},projectionDefinition:function(e){const t=e.key;let i=e.value;i=i instanceof String?i.valueOf():i;const r=Vr(i);return"array"!==r||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(i)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(i)?["array","string"].includes(r)?[]:[new Ae(t,i,`projection expected, invalid type "${r}" found`)]:[new Ae(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Rn,formatted:function(e){return 0===Rn(e).length?[]:Mn(e)},resolvedImage:function(e){return 0===Rn(e).length?[]:Mn(e)},padding:function(e){const t=e.key,i=e.value;if("array"===Vr(i)){if(i.length<1||i.length>4)return[new Ae(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const r={type:"number"};let n=[];for(let o=0;o<i.length;o++)n=n.concat(e.validateSpec({key:`${t}[${o}]`,value:i[o],validateSpec:e.validateSpec,valueSpec:r}));return n}return Sn({key:t,value:i,valueSpec:{}})},numberArray:function(e){const t=e.key,i=e.value;if("array"===Vr(i)){const r={type:"number"};if(i.length<1)return[new Ae(t,i,"array length at least 1 expected, length 0 found")];let n=[];for(let o=0;o<i.length;o++)n=n.concat(e.validateSpec({key:`${t}[${o}]`,value:i[o],validateSpec:e.validateSpec,valueSpec:r}));return n}return Sn({key:t,value:i,valueSpec:{}})},colorArray:function(e){const t=e.key,i=e.value;if("array"===Vr(i)){if(i.length<1)return[new Ae(t,i,"array length at least 1 expected, length 0 found")];let e=[];for(let r=0;r<i.length;r++)e=e.concat(kn({key:`${t}[${r}]`,value:i[r]}));return e}return kn({key:t,value:i})},variableAnchorOffsetCollection:function(e){const t=e.key,i=e.value,r=Vr(i),n=e.styleSpec;if("array"!==r||i.length<1||i.length%2!=0)return[new Ae(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let r=0;r<i.length;r+=2)o=o.concat(En({key:`${t}[${r}]`,value:i[r],valueSpec:n.layout_symbol["text-anchor"]})),o=o.concat(Tn({key:`${t}[${r+1}]`,value:i[r+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:n}));return o},sprite:Nn,state:Un};function Gn(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;return e.validateSpec=Gn,i.expression&&Gr(xn(t))?Cn(e):i.expression&&Qr(bn(t))?Mn(e):i.type&&Vn[i.type]?Vn[i.type](e):wn(Ie({},e,{valueSpec:i.type?r[i.type]:i}))}function qn(e){const t=e.value,i=e.key,r=Rn(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Ae(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Ae(i,t,'"glyphs" url must include a "{range}" token'))),r}function Zn(e,t=ye){let i=[];return i=i.concat(Gn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Gn,objectElementValidators:{glyphs:qn,"*":()=>[]}})),e.constants&&(i=i.concat(vn({key:"constants",value:e.constants}))),Hn(i)}function Wn(e){return function(t){return e({...t,validateSpec:Gn})}}function Hn(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Xn(e){return function(...t){return Hn(e.apply(this,t))}}Zn.source=Xn(Wn(On)),Zn.sprite=Xn(Wn(Nn)),Zn.glyphs=Xn(Wn(qn)),Zn.light=Xn(Wn(Fn)),Zn.sky=Xn(Wn(jn)),Zn.terrain=Xn(Wn($n)),Zn.state=Xn(Wn(Un)),Zn.layer=Xn(Wn(Dn)),Zn.filter=Xn(Wn(An)),Zn.paintProperty=Xn(Wn(Pn)),Zn.layoutProperty=Xn(Wn(Ln));const Kn=Zn,Yn=Kn.light,Jn=Kn.sky,Qn=Kn.paintProperty,eo=Kn.layoutProperty;function to(e,t){let i=!1;if(t&&t.length)for(const r of t)e.fire(new me(new Error(r.message))),i=!0;return i}class io{constructor(e,t,i){const r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(let e=0;e<this.d*this.d;e++){const t=n[3+e],i=n[3+e+1];r.push(t===i?null:n.subarray(t,i))}const o=n[3+r.length+1];this.keys=n.subarray(n[3+r.length],o),this.bboxes=n.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*i;for(let e=0;e<this.d*this.d;e++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;const n=i/t*e;this.min=-n,this.max=e+n}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,i,r,n,o){this.cells[n].push(o)}query(e,t,i,r,n){const o=this.min,s=this.max;if(e<=o&&t<=o&&s<=i&&s<=r&&!n)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(e,t,i,r,this._queryCell,o,{},n),o}}_queryCell(e,t,i,r,n,o,s,a){const l=this.cells[n];if(null!==l){const n=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&i>=c[l+0]&&r>=c[l+1])?(s[h]=!0,o.push(n[h])):s[h]=!1}}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(i),h=this._convertToCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&n.call(this,e,t,i,r,c,o,s,a))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let i=0;for(let e=0;e<this.cells.length;e++)i+=this.cells[e].length;const r=new Int32Array(t+i+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;let n=t;for(let t=0;t<e.length;t++){const i=e[t];r[3+t]=n,r.set(i,n),n+=i.length}return r[3+e.length]=n,r.set(this.keys,n),n+=this.keys.length,r[3+e.length+1]=n,r.set(this.bboxes,n),n+=this.bboxes.length,r.buffer}static serialize(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}}static deserialize(e){return new io(e.buffer)}}const ro={};function no(e,t,i={}){if(ro[e])throw new Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ro[e]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}no("Object",Object),no("TransferableGridIndex",io),no("Color",Ct),no("Error",Error),no("AJAXError",le),no("ResolvedImage",Bt),no("StylePropertyFunction",on),no("StyleExpression",Jr,{omit:["_evaluator"]}),no("ZoomDependentExpression",rn),no("ZoomConstantExpression",tn),no("CompoundExpression",Ar,{omit:["_evaluate"]});for(const e in Er)Er[e]._classRegistryKey||no(`Expression_${e}`,Er[e]);function oo(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function so(e){return e.$name||e.constructor._classRegistryKey}function ao(e){return!function(e){if(null===e||"object"!=typeof e)return!1;const t=so(e);return!(!t||"Object"===t)}(e)&&(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||oo(e)||W(e)||ArrayBuffer.isView(e)||e instanceof ImageData)}function lo(e,t){if(ao(e))return(oo(e)||W(e))&&t&&t.push(e),ArrayBuffer.isView(e)&&t&&t.push(e.buffer),e instanceof ImageData&&t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(lo(r,t));return i}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);const i=so(e);if(!i)throw new Error(`can't serialize object of unregistered class ${e.constructor.name}`);if(!ro[i])throw new Error(`${i} is not registered.`);const{klass:r}=ro[i],n=r.serialize?r.serialize(e,t):{};if(r.serialize){if(t&&n===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const r in e){if(!e.hasOwnProperty(r))continue;if(ro[i].omit.indexOf(r)>=0)continue;const o=e[r];n[r]=ro[i].shallow.indexOf(r)>=0?o:lo(o,t)}e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(n.$name=i),n}function co(e){if(ao(e))return e;if(Array.isArray(e))return e.map(co);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);const t=so(e)||"Object";if(!ro[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=ro[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const i of Object.keys(e)){if("$name"===i)continue;const n=e[i];r[i]=ro[t].shallow.indexOf(i)>=0?n:co(n)}return r}class uo{constructor(){this.first=!0}update(e,t){const i=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=i,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=i,!0):(this.lastFloorZoom>i?(this.lastIntegerZoom=i+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<i&&(this.lastIntegerZoom=i,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=i,!0))}}const ho={"Latin-1 Supplement":e=>e>=128&&e<=255,"Hangul Jamo":e=>e>=4352&&e<=4607,Khmer:e=>e>=6016&&e<=6143,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Kanbun:e=>e>=12688&&e<=12703,"CJK Strokes":e=>e>=12736&&e<=12783,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Hangul Syllables":e=>e>=44032&&e<=55215,"Private Use Area":e=>e>=57344&&e<=63743,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function po(e){for(const t of e)if(vo(t.charCodeAt(0)))return!0;return!1}function fo(e){for(const t of e)if(!yo(t.charCodeAt(0)))return!1;return!0}function mo(e){const t=e.map((e=>{try{return new RegExp(`\\p{sc=${e}}`,"u").source}catch(e){return null}})).filter((e=>e));return new RegExp(t.join("|"),"u")}const go=mo(["Arab","Dupl","Mong","Ougr","Syrc"]);function yo(e){return!go.test(String.fromCodePoint(e))}const _o=mo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vo(e){return!(746!==e&&747!==e&&(e<4352||!(ho["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ho["CJK Compatibility"](e)||ho["CJK Strokes"](e)||!(!ho["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ho["Enclosed CJK Letters and Months"](e)||ho["Ideographic Description Characters"](e)||ho.Kanbun(e)||ho.Katakana(e)&&12540!==e||!(!ho["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ho["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ho["Vertical Forms"](e)||ho["Yijing Hexagram Symbols"](e)||/\p{sc=Cans}/u.test(String.fromCodePoint(e))||/\p{sc=Hang}/u.test(String.fromCodePoint(e))||_o.test(String.fromCodePoint(e)))))}function xo(e){return!(vo(e)||function(e){return!!(ho["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ho["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ho["Letterlike Symbols"](e)||ho["Number Forms"](e)||ho["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ho["Control Pictures"](e)&&9251!==e||ho["Optical Character Recognition"](e)||ho["Enclosed Alphanumerics"](e)||ho["Geometric Shapes"](e)||ho["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ho["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ho["CJK Symbols and Punctuation"](e)||ho.Katakana(e)||ho["Private Use Area"](e)||ho["CJK Compatibility Forms"](e)||ho["Small Form Variants"](e)||ho["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}const bo=mo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function wo(e){return bo.test(String.fromCodePoint(e))}function To(e,t){return!(!t&&wo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ho.Khmer(e))}function So(e){for(const t of e)if(wo(t.charCodeAt(0)))return!0;return!1}const Co=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){if(Co.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(e,i){return t(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if("loading"!==e.pluginStatus)return this.setState(e),e;const t=e.pluginURL,r=new Promise((e=>{this.loadScriptResolve=e}));i(t);const n=new Promise((e=>setTimeout((()=>e()),this.TIMEOUT)));if(yield Promise.race([r,n]),this.isParsed()){const e={pluginStatus:"loaded",pluginURL:t};return this.setState(e),e}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${t}`)}))}};class Mo{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uo,this.transition={})}isSupportedScript(e){return function(e,t){for(const i of e)if(!To(i.charCodeAt(0),t))return!1;return!0}(e,"loaded"===Co.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),i=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*i}:{fromScale:.5,toScale:1,t:1-(1-i)*t}}}class ko{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(Gr(e))return new on(e,t);if(Qr(e)){const i=nn(e,t);if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return i.value}{let i=e;return"color"===t.type&&"string"==typeof e?i=Ct.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"numberArray"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"colorArray"!==t.type||"string"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?i=Rt.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(i=Ot.parse(e)):i=Pt.parse(e):i=zt.parse(e):i=It.parse(e),{kind:"constant",evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Eo{constructor(e){this.property=e,this.value=new ko(e,void 0)}transitioned(e,t){return new Io(this.property,this.value,t,O({},e.transition,this.transition),e.now)}untransitioned(){return new Io(this.property,this.value,null,{},0)}}class Ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return N(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Eo(this._values[e].property)),this._values[e].value=new ko(this._values[e].property,null===t?void 0:N(t))}getTransition(e){return N(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Eo(this._values[e].property)),this._values[e].transition=N(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e[`${t}-transition`]=r)}return e}transitioned(e,t){const i=new zo(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new zo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Io{constructor(e,t,i,r,n){this.property=e,this.value=t,this.begin=n+r.delay||0,this.end=this.begin+r.duration||0,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),o=this.prior;if(o){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return o.possiblyEvaluate(e,t,i);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,i),n,P(s))}}return n}}class zo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new Do(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Po{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return N(this._values[e].value)}setValue(e,t){this._values[e]=new ko(this._values[e].property,null===t?void 0:N(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new Do(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class Lo{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class Do{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ro{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,i){const r=pi[this.specification.type];return r?r(e,t,i):e}}class Bo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new Lo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Lo(this,{kind:"constant",value:void 0},e.parameters);const r=pi[this.specification.type];if(r){const n=r(e.value.value,t.value.value,i);return new Lo(this,{kind:"constant",value:n},e.parameters)}return e}evaluate(e,t,i,r,n,o){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,o)}}class Oo extends Bo{possiblyEvaluate(e,t,i,r){if(void 0===e.value)return new Lo(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r),o="resolvedImage"===e.property.specification.type&&"string"!=typeof n?n.name:n,s=this._calculate(o,o,o,t);return new Lo(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const i=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Lo(this,{kind:"constant",value:i},t)}return new Lo(this,e.expression,t)}evaluate(e,t,i,r,n,o){if("source"===e.kind){const s=e.evaluate(t,i,r,n,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},i,r),e.evaluate({zoom:Math.floor(t.zoom)},i,r),e.evaluate({zoom:Math.floor(t.zoom)+1},i,r),t):e.value}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class Fo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){if(void 0!==e.value){if("constant"===e.expression.kind){const n=e.expression.evaluate(t,null,{},i,r);return this._calculate(n,n,n,t)}return this._calculate(e.expression.evaluate(new Mo(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Mo(Math.floor(t.zoom),t)),e.expression.evaluate(new Mo(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,i,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:i,to:t}}interpolate(e){return e}}class jo{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class $o{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const i=e[t];i.specification.overridable&&this.overridableProperties.push(t);const r=this.defaultPropertyValues[t]=new ko(i,void 0),n=this.defaultTransitionablePropertyValues[t]=new Eo(i);this.defaultTransitioningPropertyValues[t]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=r.possiblyEvaluate({})}}}no("DataDrivenProperty",Bo),no("DataConstantProperty",Ro),no("CrossFadedDataDrivenProperty",Oo),no("CrossFadedProperty",Fo),no("ColorRampProperty",jo);const No="-transition";class Uo extends ge{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Po(t.layout)),t.paint)){this._transitionablePaint=new Ao(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,i={}){null!=t&&this._validate(eo,`layers.${this.id}.layout.${e}`,e,t,i)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(No)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,i={}){if(null!=t&&this._validate(Qn,`layers.${this.id}.paint.${e}`,e,t,i))return!1;if(e.endsWith(No))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],r="cross-faded-data-driven"===i.property.specification["property-type"],n=i.value.isDataDriven(),o=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||n||r||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),$(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,i,r,n={}){return(!n||!1!==n.validate)&&to(this,e.call(Kn,{key:t,layerType:this.type,objectKey:i,value:r,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Lo&&$r(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Vo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Go{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Zo(e,t=1){let i=0,r=0;return{members:e.map((e=>{const n=Vo[e.type].BYTES_PER_ELEMENT,o=i=Wo(i,Math.max(t,n)),s=e.components||1;return r=Math.max(r,n),i+=n*s,{name:e.name,type:e.type,components:s,offset:o}})),size:Wo(i,Math.max(r,t)),alignment:t}}function Wo(e,t){return Math.ceil(e/t)*t}class Ho extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}Ho.prototype.bytesPerElement=4,no("StructArrayLayout2i4",Ho);class Xo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Xo.prototype.bytesPerElement=6,no("StructArrayLayout3i6",Xo);class Ko extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,e}}Ko.prototype.bytesPerElement=8,no("StructArrayLayout4i8",Ko);class Yo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}Yo.prototype.bytesPerElement=12,no("StructArrayLayout2i4i12",Yo);class Jo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=4*e,l=8*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.uint8[l+4]=r,this.uint8[l+5]=n,this.uint8[l+6]=o,this.uint8[l+7]=s,e}}Jo.prototype.bytesPerElement=8,no("StructArrayLayout2i4ub8",Jo);class Qo extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}Qo.prototype.bytesPerElement=8,no("StructArrayLayout2f8",Qo);class es extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,i,r,n,o,s,a,l,c)}emplace(e,t,i,r,n,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=i,this.uint16[h+2]=r,this.uint16[h+3]=n,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}es.prototype.bytesPerElement=20,no("StructArrayLayout10ui20",es);class ts extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,o,s,a,l,c,u,h)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}ts.prototype.bytesPerElement=24,no("StructArrayLayout4i4ui4i24",ts);class is extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}is.prototype.bytesPerElement=12,no("StructArrayLayout3f12",is);class rs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}rs.prototype.bytesPerElement=4,no("StructArrayLayout1ul4",rs);class ns extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,i,r,n,o,s,a,l)}emplace(e,t,i,r,n,o,s,a,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=n,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}ns.prototype.bytesPerElement=20,no("StructArrayLayout6i1ul2ui20",ns);class os extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,this.int16[a+4]=o,this.int16[a+5]=s,e}}os.prototype.bytesPerElement=12,no("StructArrayLayout2i2i2i12",os);class ss extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n)}emplace(e,t,i,r,n,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=i,this.float32[s+2]=r,this.int16[a+6]=n,this.int16[a+7]=o,e}}ss.prototype.bytesPerElement=16,no("StructArrayLayout2f1f2i16",ss);class as extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,o)}emplace(e,t,i,r,n,o,s){const a=16*e,l=4*e,c=8*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[l+1]=r,this.float32[l+2]=n,this.int16[c+6]=o,this.int16[c+7]=s,e}}as.prototype.bytesPerElement=16,no("StructArrayLayout2ub2f2i16",as);class ls extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}ls.prototype.bytesPerElement=6,no("StructArrayLayout3ui6",ls);class cs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y){const _=24*e,v=12*e,x=48*e;return this.int16[_+0]=t,this.int16[_+1]=i,this.uint16[_+2]=r,this.uint16[_+3]=n,this.uint32[v+2]=o,this.uint32[v+3]=s,this.uint32[v+4]=a,this.uint16[_+10]=l,this.uint16[_+11]=c,this.uint16[_+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[x+36]=p,this.uint8[x+37]=f,this.uint8[x+38]=m,this.uint32[v+10]=g,this.int16[_+22]=y,e}}cs.prototype.bytesPerElement=48,no("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cs);class us extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k){const E=this.length;return this.resize(E+1),this.emplace(E,e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k)}emplace(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C,M,k,E){const A=32*e,I=16*e;return this.int16[A+0]=t,this.int16[A+1]=i,this.int16[A+2]=r,this.int16[A+3]=n,this.int16[A+4]=o,this.int16[A+5]=s,this.int16[A+6]=a,this.int16[A+7]=l,this.uint16[A+8]=c,this.uint16[A+9]=u,this.uint16[A+10]=h,this.uint16[A+11]=d,this.uint16[A+12]=p,this.uint16[A+13]=f,this.uint16[A+14]=m,this.uint16[A+15]=g,this.uint16[A+16]=y,this.uint16[A+17]=_,this.uint16[A+18]=v,this.uint16[A+19]=x,this.uint16[A+20]=b,this.uint16[A+21]=w,this.uint16[A+22]=T,this.uint32[I+12]=S,this.float32[I+13]=C,this.float32[I+14]=M,this.uint16[A+30]=k,this.uint16[A+31]=E,e}}us.prototype.bytesPerElement=64,no("StructArrayLayout8i15ui1ul2f2ui64",us);class hs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}hs.prototype.bytesPerElement=4,no("StructArrayLayout1f4",hs);class ds extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[6*e+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}ds.prototype.bytesPerElement=12,no("StructArrayLayout1ui2f12",ds);class ps extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=4*e;return this.uint32[2*e+0]=t,this.uint16[n+2]=i,this.uint16[n+3]=r,e}}ps.prototype.bytesPerElement=8,no("StructArrayLayout1ul2ui8",ps);class fs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}fs.prototype.bytesPerElement=4,no("StructArrayLayout2ui4",fs);class ms extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}ms.prototype.bytesPerElement=2,no("StructArrayLayout1ui2",ms);class gs extends qo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,e}}gs.prototype.bytesPerElement=16,no("StructArrayLayout4f16",gs);class ys extends Go{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new l(this.anchorPointX,this.anchorPointY)}}ys.prototype.size=20;class _s extends ns{get(e){return new ys(this,e)}}no("CollisionBoxArray",_s);class vs extends Go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}vs.prototype.size=48;class xs extends cs{get(e){return new vs(this,e)}}no("PlacedSymbolArray",xs);class bs extends Go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}bs.prototype.size=64;class ws extends us{get(e){return new bs(this,e)}}no("SymbolInstanceArray",ws);class Ts extends hs{getoffsetX(e){return this.float32[1*e+0]}}no("GlyphOffsetArray",Ts);class Ss extends Xo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}no("SymbolLineVertexArray",Ss);class Cs extends Go{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Cs.prototype.size=12;class Ms extends ds{get(e){return new Cs(this,e)}}no("TextAnchorOffsetArray",Ms);class ks extends Go{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ks.prototype.size=8;class Es extends ps{get(e){return new ks(this,e)}}no("FeatureIndexArray",Es);class As extends Ho{}class Is extends Ho{}class zs extends Ho{}class Ps extends Yo{}class Ls extends Jo{}class Ds extends Qo{}class Rs extends es{}class Bs extends ts{}class Os extends is{}class Fs extends rs{}class js extends os{}class $s extends as{}class Ns extends ls{}class Us extends fs{}const Vs=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gs}=Vs;class qs{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,t,i,r){const n=this.segments[this.segments.length-1];return e>qs.MAX_VERTEX_ARRAY_LENGTH&&V(`Max vertices per segment is ${qs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${qs.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!n||n.vertexLength+e>qs.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r?this.createNewSegment(t,i,r):n}createNewSegment(e,t,i){const r={vertexOffset:e.length,primitiveOffset:t.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==i&&(r.sortKey=i),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(r),r}getOrCreateLatestSegment(e,t,i){return this.prepareSegment(0,e,t,i)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new qs([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function Zs(e,t){return 256*(e=R(Math.floor(e),0,255))+R(Math.floor(t),0,255)}qs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,no("SegmentVector",qs);const Ws=Zo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Hs,Xs,Ks,Ys={exports:{}},Js={exports:{}},Qs={exports:{}},ea=function(){if(Ks)return Ys.exports;Ks=1;var e=(Hs||(Hs=1,Js.exports=function(e,t){var i,r,n,o,s,a,l,c;for(r=e.length-(i=3&e.length),n=t,s=3432918353,a=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(o=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}),Js.exports),t=(Xs||(Xs=1,Qs.exports=function(e,t){for(var i,r=e.length,n=t^r,o=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:n^=(255&e.charCodeAt(o+2))<<16;case 2:n^=(255&e.charCodeAt(o+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(o)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}),Qs.exports);return Ys.exports=e,Ys.exports.murmur3=e,Ys.exports.murmur2=t,Ys.exports}(),ta=i(ea);class ia{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(ra(e)),this.positions.push(t,i,r)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=ra(e);let i=0,r=this.ids.length-1;for(;i<r;){const e=i+r>>1;this.ids[e]>=t?r=e:i=e+1}const n=[];for(;this.ids[i]===t;)n.push({index:this.positions[3*i],start:this.positions[3*i+1],end:this.positions[3*i+2]}),i++;return n}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return na(i,r,0,i.length-1),t&&t.push(i.buffer,r.buffer),{ids:i,positions:r}}static deserialize(e){const t=new ia;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function ra(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ta(String(e))}function na(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let o=i-1,s=r+1;for(;;){do{o++}while(e[o]<n);do{s--}while(e[s]>n);if(o>=s)break;oa(e,o,s),oa(t,3*o,3*s),oa(t,3*o+1,3*s+1),oa(t,3*o+2,3*s+2)}s-i<r-s?(na(e,t,i,s),i=s+1):(na(e,t,s+1,r),r=s)}}function oa(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}no("FeaturePositionMap",ia);class sa{constructor(e,t){this.gl=e.gl,this.location=t}}class aa extends sa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class la extends sa{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ca extends sa{constructor(e,t){super(e,t),this.current=Ct.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ua=new Float32Array(16);function ha(e){return[Zs(255*e.r,255*e.g),Zs(255*e.b,255*e.a)]}class da{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=i}setUniform(e,t,i){e.set(i.constantOr(this.value))}getBinding(e,t,i){return"color"===this.type?new ca(e,t):new aa(e,t)}}class pa{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,i,r){const n="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;n&&e.set(n)}getBinding(e,t,i){return"u_pattern"===i.substr(0,9)?new la(e,t):new aa(e,t)}}class fa{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n){const o=this.paintVertexArray.length,s=this.expression.evaluate(new Mo(0),t,{},r,[],n);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:0},i,r);this._setPaintValue(e,t,n)}_setPaintValue(e,t,i){if("color"===this.type){const r=ha(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ma{constructor(e,t,i,r,n,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,i,r,n){const o=this.expression.evaluate(new Mo(this.zoom),t,{},r,[],n),s=this.expression.evaluate(new Mo(this.zoom+1),t,{},r,[],n),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,o,s)}updatePaintArray(e,t,i,r){const n=this.expression.evaluate({zoom:this.zoom},i,r),o=this.expression.evaluate({zoom:this.zoom+1},i,r);this._setPaintValue(e,t,n,o)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=ha(i),o=ha(r);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],o[0],o[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const i=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=R(this.expression.interpolationFactor(i,this.zoom,this.zoom+1),0,1);e.set(r)}getBinding(e,t,i){return new aa(e,t)}}class ga{constructor(e,t,i,r,n,o){this.expression=e,this.type=t,this.useIntegerZoom=i,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new n,this.zoomOutPaintVertexArray=new n}populatePaintArray(e,t,i){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],n)}_setPaintValues(e,t,i,r){if(!r||!i)return;const{min:n,mid:o,max:s}=i,a=r[n],l=r[o],c=r[s];if(a&&l&&c)for(let i=e;i<t;i++)this.zoomInPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(i,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ws.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ws.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ya{constructor(e,t,i){this.binders={},this._buffers=[];const r=[];for(const n in e.paint._values){if(!i(n))continue;const o=e.paint.get(n);if(!(o instanceof Lo&&$r(o.property.specification)))continue;const s=va(n,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[n]=h?new pa(a.value,s):new da(a.value,s,l),r.push(`/u_${n}`);else if("source"===a.kind||h){const i=xa(n,l,"source");this.binders[n]=h?new ga(a,l,c,t,i,e.id):new fa(a,s,l,i),r.push(`/a_${n}`)}else{const e=xa(n,l,"composite");this.binders[n]=new ma(a,s,l,c,t,e),r.push(`/z_${n}`)}}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof fa||t instanceof ma?t.maxValue:0}populatePaintArrays(e,t,i,r,n){for(const o in this.binders){const s=this.binders[o];(s instanceof fa||s instanceof ma||s instanceof ga)&&s.populatePaintArray(e,t,i,r,n)}}setConstantPatternPositions(e,t){for(const i in this.binders){const r=this.binders[i];r instanceof pa&&r.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,i,r,n){let o=!1;for(const s in e){const a=t.getPositions(s);for(const t of a){const a=i.feature(t.index);for(const i in this.binders){const l=this.binders[i];if((l instanceof fa||l instanceof ma||l instanceof ga)&&!0===l.expression.isStateDependent){const c=r.paint.get(i);l.expression=c.value,l.updatePaintArray(t.start,t.end,a,e[s],n),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof da||i instanceof pa)&&e.push(...i.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof fa||i instanceof ma)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name);else if(i instanceof ga)for(let t=0;t<Ws.members.length;t++)e.push(Ws.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof da||i instanceof pa||i instanceof ma)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const i=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof da||n instanceof pa||n instanceof ma)for(const o of n.uniformNames)if(t[o]){const s=n.getBinding(e,t[o],o);i.push({name:o,property:r,binding:s})}}return i}setUniforms(e,t,i,r){for(const{name:e,property:n,binding:o}of t)this.binders[n].setUniform(o,r,i.get(n),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const i=this.binders[t];if(e&&i instanceof ga){const t=2===e.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(i instanceof fa||i instanceof ma)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof fa||i instanceof ma||i instanceof ga)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof fa||t instanceof ma||t instanceof ga)&&t.destroy()}}}class _a{constructor(e,t,i=(()=>!0)){this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new ya(r,t,i);this.needsUpload=!1,this._featureMap=new ia,this._bufferOffset=0}populatePaintArrays(e,t,i,r,n,o){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,t,r,n,o);void 0!==t.id&&this._featureMap.add(t.id,i,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r){for(const n of i)this.needsUpload=this.programConfigurations[n.id].updatePaintArrays(e,this._featureMap,t,n,r)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function va(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function xa(e,t,i){const r={color:{source:Qo,composite:gs},number:{source:hs,composite:Qo}},n=function(e){return{"line-pattern":{source:Rs,composite:Rs},"fill-pattern":{source:Rs,composite:Rs},"fill-extrusion-pattern":{source:Rs,composite:Rs}}[e]}(e);return n&&n[i]||r[t][i]}no("ConstantBinder",da),no("CrossFadedConstantBinder",pa),no("SourceExpressionBinder",fa),no("CrossFadedCompositeBinder",ga),no("CompositeExpressionBinder",ma),no("ProgramConfiguration",ya,{omit:["_buffers"]}),no("ProgramConfigurationSet",_a);const ba=Math.pow(2,14)-1,wa=-ba-1;function Ta(e){const t=E/e.extent,i=e.loadGeometry();for(let e=0;e<i.length;e++){const r=i[e];for(let e=0;e<r.length;e++){const i=r[e],n=Math.round(i.x*t),o=Math.round(i.y*t);i.x=R(n,wa,ba),i.y=R(o,wa,ba),(n<i.x||n>i.x+1||o<i.y||o>i.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Sa(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ta(e):[]}}const Ca=-32768;function Ma(e,t,i,r,n){e.emplaceBack(Ca+8*t+r,Ca+8*i+n)}class ka{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Is,this.indexArray=new Ns,this.segments=new qs,this.programConfigurations=new _a(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){const r=this.layers[0],n=[];let o=null,s=!1,a="heatmap"===r.type;if("circle"===r.type){const e=r;o=e.layout.get("circle-sort-key"),s=!o.isConstant(),a=a||"map"===e.paint.get("circle-pitch-alignment")}const l=a?t.subdivisionGranularity.circle:1;for(const{feature:t,id:r,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Sa(t,e);if(!this.layers[0]._featureFilter.filter(new Mo(this.zoom),c,i))continue;const u=s?o.evaluate(c,{},i):void 0,h={id:r,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ta(t),patterns:{},sortKey:u};n.push(h)}s&&n.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of n){const{geometry:n,index:o,sourceLayerIndex:s}=r,a=e[o].feature;this.addFeature(r,n,o,i,l),t.featureIndex.insert(a,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n=1){let o;switch(n){case 1:o=[0,7];break;case 3:o=[0,2,5,7];break;case 5:o=[0,1,3,4,6,7];break;case 7:o=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${n}; valid values are 1, 3, 5, 7.`)}const s=o.length;for(const i of t)for(const t of i){const i=t.x,r=t.y;if(i<0||i>=E||r<0||r>=E)continue;const n=this.segments.prepareSegment(s*s,this.layoutVertexArray,this.indexArray,e.sortKey),a=n.vertexLength;for(let e=0;e<s;e++)for(let t=0;t<s;t++)Ma(this.layoutVertexArray,i,r,o[t],o[e]);for(let e=0;e<s-1;e++)for(let t=0;t<s-1;t++){const i=a+e*s+t,r=a+(e+1)*s+t;this.indexArray.emplaceBack(i,r+1,i+1),this.indexArray.emplaceBack(i,r,r+1)}n.vertexLength+=s*s,n.primitiveLength+=(s-1)*(s-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r)}}function Ea(e,t){for(let i=0;i<e.length;i++)if(Oa(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Oa(e,t[i]))return!0;return!!Pa(e,t)}function Aa(e,t,i){return!!Oa(e,t)||!!Da(t,e,i)}function Ia(e,t){if(1===e.length)return Ba(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(Oa(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(Ba(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Pa(e,t[i]))return!0;return!1}function za(e,t,i){if(e.length>1){if(Pa(e,t))return!0;for(let r=0;r<t.length;r++)if(Da(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Da(e[r],t,i))return!0;return!1}function Pa(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(La(r,n,t[e],t[e+1]))return!0}return!1}function La(e,t,i,r){return G(e,i,r)!==G(t,i,r)&&G(e,t,i)!==G(e,t,r)}function Da(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(Ra(e,t[i-1],t[i])<r)return!0;return!1}function Ra(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Ba(e,t){for(let i=0;i<e.length;i++)if(Oa(e[i],t))return!0;return!1}function Oa(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const o=e[r],s=e[n];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(i=!i)}return i}function Fa(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const o=G(e,t,i[0]);return o!==G(e,t,i[1])||o!==G(e,t,i[2])||o!==G(e,t,i[3])}function ja(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function $a(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Na(e,t,i,r,n){if(!t[0]&&!t[1])return e;const o=l.convert(t)._mult(n);"viewport"===i&&o._rotate(-r);const s=[];for(let t=0;t<e.length;t++)s.push(e[t].sub(o));return s}let Ua,Va;no("CircleBucket",ka,{omit:["layers"]});var Ga={get paint(){return Va=Va||new $o({"circle-radius":new Bo(ye.paint_circle["circle-radius"]),"circle-color":new Bo(ye.paint_circle["circle-color"]),"circle-blur":new Bo(ye.paint_circle["circle-blur"]),"circle-opacity":new Bo(ye.paint_circle["circle-opacity"]),"circle-translate":new Ro(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Ro(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ro(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ro(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Bo(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Bo(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Bo(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Ua=Ua||new $o({"circle-sort-key":new Bo(ye.layout_circle["circle-sort-key"])})}};class qa extends Uo{constructor(e){super(e,Ga)}createBucket(e){return new ka(e)}queryRadius(e){const t=e;return ja("circle-radius",this,t)+ja("circle-stroke-width",this,t)+$a(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o,unwrappedTileID:s,getElevation:a}){const l=Na(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-n.bearingInRadians,o),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t,i,r){return e.map((e=>Za(e,t,i,r)))}(l,n,s,a),d=u?c*o:c;for(const e of r)for(const t of e){const e=u?t:Za(t,n,s,a);let i=d;const r=n.projectTileCoordinates(t.x,t.y,s,a).signedDistanceFromCamera;if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?i*=r/n.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(i*=n.cameraToCenterDistance/r),Aa(h,e,i))return!0}return!1}}function Za(e,t,i,r){const n=t.projectTileCoordinates(e.x,e.y,i,r).point;return new l((.5*n.x+.5)*t.width,(.5*-n.y+.5)*t.height)}class Wa extends ka{}let Ha;no("HeatmapBucket",Wa,{omit:["layers"]});var Xa={get paint(){return Ha=Ha||new $o({"heatmap-radius":new Bo(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Bo(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ro(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jo(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ro(ye.paint_heatmap["heatmap-opacity"])})}};function Ka(e,{width:t,height:i},r,n){if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==t*i*r)throw new RangeError(`mismatched image size. expected: ${n.length} but got: ${t*i*r}`)}else n=new Uint8Array(t*i*r);return e.width=t,e.height=i,e.data=n,e}function Ya(e,{width:t,height:i},r){if(t===e.width&&i===e.height)return;const n=Ka({},{width:t,height:i},r);Ja(e,n,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,i)},r),e.width=t,e.height=i,e.data=n.data}function Ja(e,t,i,r,n,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<n.height;l++){const c=((i.y+l)*e.width+i.x)*o,u=((r.y+l)*t.width+r.x)*o;for(let e=0;e<n.width*o;e++)a[u+e]=s[c+e]}return t}class Qa{constructor(e,t){Ka(this,e,1,t)}resize(e){Ya(this,e,1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){Ja(e,t,i,r,n,1)}}class el{constructor(e,t){Ka(this,e,4,t)}resize(e){Ya(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new el({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){Ja(e,t,i,r,n,4)}}function tl(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new el({width:i,height:r});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const o=(i,r,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);n.data[i+r+0]=Math.floor(255*s.r/s.a),n.data[i+r+1]=Math.floor(255*s.g/s.a),n.data[i+r+2]=Math.floor(255*s.b/s.a),n.data[i+r+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,n=0;t<r;++t,n+=4*i)for(let r=0,s=0;r<i;r++,s+=4){const a=r/(i-1),{start:l,end:c}=e.clips[t];o(n,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<i;e++,t+=4)o(0,t,e/(i-1));return n}no("AlphaImage",Qa),no("RGBAImage",el);const il="big-fb";class rl extends Uo{createBucket(e){return new Wa(e)}constructor(e){super(e,Xa),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tl({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(il)&&this.heatmapFbos.delete(il)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let nl;var ol={get paint(){return nl=nl||new $o({"hillshade-illumination-direction":new Ro(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Ro(ye.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Ro(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ro(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ro(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ro(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ro(ye.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Ro(ye.paint_hillshade["hillshade-method"])})}};class sl extends Uo{constructor(e){super(e,ol),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,t=this.paint.get("hillshade-illumination-altitude").values,i=this.paint.get("hillshade-highlight-color").values,r=this.paint.get("hillshade-shadow-color").values;const n=Math.max(e.length,t.length,i.length,r.length);e=e.concat(Array(n-e.length).fill(e.at(-1))),t=t.concat(Array(n-t.length).fill(t.at(-1))),i=i.concat(Array(n-i.length).fill(i.at(-1))),r=r.concat(Array(n-r.length).fill(r.at(-1)));const o=t.map(Q);return{directionRadians:e.map(Q),altitudeRadians:o,shadowColor:r,highlightColor:i}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const al=Zo([{name:"a_pos",components:2,type:"Int16"}],4),{members:ll}=al;function cl(e,t,i){const r=i.patternDependencies;let n=!1;for(const i of t){const t=i.paint.get(`${e}-pattern`);t.isConstant()||(n=!0);const o=t.constantOr(null);o&&(n=!0,r[o.to]=!0,r[o.from]=!0)}return n}function ul(e,t,i,r,n){const o=n.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r-1},i,{},n.availableImages),a=t.evaluate({zoom:r},i,{},n.availableImages),l=t.evaluate({zoom:r+1},i,{},n.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,i.patterns[s.id]={min:e,mid:a,max:l}}}return i}function hl(e,t,i,r,n){let o;if(n===function(e,t,i,r){let n=0;for(let o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}(e,t,i,r)>0)for(let n=t;n<i;n+=r)o=Ll(n/r|0,e[n],e[n+1],o);else for(let n=i-r;n>=t;n-=r)o=Ll(n/r|0,e[n],e[n+1],o);return o&&kl(o,o.next)&&(Dl(o),o=o.next),o}function dl(e,t){if(!e)return e;t||(t=e);let i,r=e;do{if(i=!1,r.steiner||!kl(r,r.next)&&0!==Ml(r.prev,r,r.next))r=r.next;else{if(Dl(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function pl(e,t,i,r,n,o,s){if(!e)return;!s&&o&&function(e,t,i,r){let n=e;do{0===n.z&&(n.z=bl(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){let t,i=1;do{let r,n=e;e=null;let o=null;for(t=0;n;){t++;let s=n,a=0;for(let e=0;e<i&&(a++,s=s.nextZ,s);e++);let l=i;for(;a>0||l>0&&s;)0!==a&&(0===l||!s||n.z<=s.z)?(r=n,n=n.nextZ,a--):(r=s,s=s.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=s}o.nextZ=null,i*=2}while(t>1)}(n)}(e,r,n,o);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?ml(e,r,n,o):fl(e))t.push(l.i,e.i,c.i),Dl(e),e=c.next,a=c.next;else if((e=c)===a){s?1===s?pl(e=gl(dl(e),t),t,i,r,n,o,2):2===s&&yl(e,t,i,r,n,o):pl(dl(e),t,i,r,n,o,1);break}}}function fl(e){const t=e.prev,i=e,r=e.next;if(Ml(t,i,r)>=0)return!1;const n=t.x,o=i.x,s=r.x,a=t.y,l=i.y,c=r.y,u=Math.min(n,o,s),h=Math.min(a,l,c),d=Math.max(n,o,s),p=Math.max(a,l,c);let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Sl(n,a,o,l,s,c,f.x,f.y)&&Ml(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ml(e,t,i,r){const n=e.prev,o=e,s=e.next;if(Ml(n,o,s)>=0)return!1;const a=n.x,l=o.x,c=s.x,u=n.y,h=o.y,d=s.y,p=Math.min(a,l,c),f=Math.min(u,h,d),m=Math.max(a,l,c),g=Math.max(u,h,d),y=bl(p,f,t,i,r),_=bl(m,g,t,i,r);let v=e.prevZ,x=e.nextZ;for(;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Sl(a,u,l,h,c,d,v.x,v.y)&&Ml(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Sl(a,u,l,h,c,d,x.x,x.y)&&Ml(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==s&&Sl(a,u,l,h,c,d,v.x,v.y)&&Ml(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Sl(a,u,l,h,c,d,x.x,x.y)&&Ml(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function gl(e,t){let i=e;do{const r=i.prev,n=i.next.next;!kl(r,n)&&El(r,i,i.next,n)&&zl(r,n)&&zl(n,r)&&(t.push(r.i,i.i,n.i),Dl(i),Dl(i.next),i=e=n),i=i.next}while(i!==e);return dl(i)}function yl(e,t,i,r,n,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Cl(s,e)){let a=Pl(s,e);return s=dl(s,s.next),a=dl(a,a.next),pl(s,t,i,r,n,o,0),void pl(a,t,i,r,n,o,0)}e=e.next}s=s.next}while(s!==e)}function _l(e,t){let i=e.x-t.x;return 0===i&&(i=e.y-t.y,0===i)&&(i=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function vl(e,t){const i=function(e,t){let i=t;const r=e.x,n=e.y;let o,s=-1/0;if(kl(e,i))return i;do{if(kl(e,i.next))return i.next;if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>s&&(s=e,o=i.x<i.next.x?i:i.next,e===r))return o}i=i.next}while(i!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;i=o;do{if(r>=i.x&&i.x>=l&&r!==i.x&&Tl(n<c?r:s,n,l,c,n<c?s:r,n,i.x,i.y)){const t=Math.abs(n-i.y)/(r-i.x);zl(i,e)&&(t<u||t===u&&(i.x>o.x||i.x===o.x&&xl(o,i)))&&(o=i,u=t)}i=i.next}while(i!==a);return o}(e,t);if(!i)return t;const r=Pl(i,e);return dl(r,r.next),dl(i,i.next)}function xl(e,t){return Ml(e.prev,e,t.prev)<0&&Ml(t.next,e,e.next)<0}function bl(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function wl(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Tl(e,t,i,r,n,o,s,a){return(n-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(i-s)*(t-a)&&(i-s)*(o-a)>=(n-s)*(r-a)}function Sl(e,t,i,r,n,o,s,a){return!(e===s&&t===a)&&Tl(e,t,i,r,n,o,s,a)}function Cl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&El(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(zl(e,t)&&zl(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(Ml(e.prev,e,t.prev)||Ml(e,t.prev,t))||kl(e,t)&&Ml(e.prev,e,e.next)>0&&Ml(t.prev,t,t.next)>0)}function Ml(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function kl(e,t){return e.x===t.x&&e.y===t.y}function El(e,t,i,r){const n=Il(Ml(e,t,i)),o=Il(Ml(e,t,r)),s=Il(Ml(i,r,e)),a=Il(Ml(i,r,t));return n!==o&&s!==a||!(0!==n||!Al(e,i,t))||!(0!==o||!Al(e,r,t))||!(0!==s||!Al(i,e,r))||!(0!==a||!Al(i,t,r))}function Al(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Il(e){return e>0?1:e<0?-1:0}function zl(e,t){return Ml(e.prev,e,e.next)<0?Ml(e,t,e.next)>=0&&Ml(e,e.prev,t)>=0:Ml(e,t,e.prev)<0||Ml(e,e.next,t)<0}function Pl(e,t){const i=Rl(e.i,e.x,e.y),r=Rl(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Ll(e,t,i,r){const n=Rl(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Dl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Rl(e,t,i){return{i:e,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Bl{constructor(e,t){if(t>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=t}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ol{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ol.noSubdivision=new Ol({fill:new Bl(0,0),line:new Bl(0,0),tile:new Bl(0,0),stencil:new Bl(0,0),circle:1}),no("SubdivisionGranularityExpression",Bl),no("SubdivisionGranularitySetting",Ol);const Fl=-32768,jl=32767;class $l{constructor(e,t){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=E/e,this._canonical=t}_getKey(e,t){return(e+=32768)<<16|(t+=32768)<<0}_vertexToIndex(e,t){if(e<-32768||t<-32768||e>32767||t>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const i=0|Math.round(e),r=0|Math.round(t),n=this._getKey(i,r);if(this._vertexDictionary.has(n))return this._vertexDictionary.get(n);const o=this._vertexBuffer.length/2;return this._vertexDictionary.set(n,o),this._vertexBuffer.push(i,r),o}_subdivideTrianglesScanline(e){if(this._granularity<2)return function(e,t){const i=[];for(let r=0;r<t.length;r+=3){const n=t[r],o=t[r+1],s=t[r+2],a=e[2*n],l=e[2*n+1];(e[2*o]-a)*(e[2*s+1]-l)-(e[2*o+1]-l)*(e[2*s]-a)>0?(i.push(n),i.push(s),i.push(o)):(i.push(n),i.push(o),i.push(s))}return i}(this._vertexBuffer,e);const t=[],i=e.length;for(let r=0;r<i;r+=3){const i=[e[r+0],e[r+1],e[r+2]],n=[this._vertexBuffer[2*e[r+0]+0],this._vertexBuffer[2*e[r+0]+1],this._vertexBuffer[2*e[r+1]+0],this._vertexBuffer[2*e[r+1]+1],this._vertexBuffer[2*e[r+2]+0],this._vertexBuffer[2*e[r+2]+1]];let o=1/0,s=1/0,a=-1/0,l=-1/0;for(let e=0;e<3;e++){const t=n[2*e],i=n[2*e+1];o=Math.min(o,t),a=Math.max(a,t),s=Math.min(s,i),l=Math.max(l,i)}if(o===a||s===l)continue;const c=Math.floor(o/this._granularityCellSize),u=Math.ceil(a/this._granularityCellSize),h=Math.floor(s/this._granularityCellSize),d=Math.ceil(l/this._granularityCellSize);if(c!==u||h!==d)for(let e=h;e<d;e++){const r=this._scanlineGenerateVertexRingForCellRow(e,n,i);Vl(this._vertexBuffer,r,t)}else t.push(...i)}return t}_scanlineGenerateVertexRingForCellRow(e,t,i){const r=e*this._granularityCellSize,n=r+this._granularityCellSize,o=[];for(let e=0;e<3;e++){const s=t[2*e],a=t[2*e+1],l=t[2*(e+1)%6],c=t[(2*(e+1)+1)%6],u=t[2*(e+2)%6],h=t[(2*(e+2)+1)%6],d=l-s,p=c-a,f=0===d,m=0===p,g=(r-a)/p,y=(n-a)/p,_=Math.min(g,y),v=Math.max(g,y);if(!m&&(_>=1||v<=0)||m&&(a<r||a>n)){c>=r&&c<=n&&o.push(i[(e+1)%3]);continue}!m&&_>0&&o.push(this._vertexToIndex(s+d*_,a+p*_));const x=s+d*Math.max(_,0),b=s+d*Math.min(v,1);f||this._generateIntraEdgeVertices(o,s,a,l,c,x,b),!m&&v<1&&o.push(this._vertexToIndex(s+d*v,a+p*v)),(m||c>=r&&c<=n)&&o.push(i[(e+1)%3]),!m&&(c<=r||c>=n)&&this._generateInterEdgeVertices(o,s,a,l,c,u,h,b,r,n)}return o}_generateIntraEdgeVertices(e,t,i,r,n,o,s){const a=r-t,l=n-i,c=0===l,u=c?Math.min(t,r):Math.min(o,s),h=c?Math.max(t,r):Math.max(o,s),d=Math.floor(u/this._granularityCellSize)+1,p=Math.ceil(h/this._granularityCellSize)-1;if(c?t<r:o<s)for(let r=d;r<=p;r++){const n=r*this._granularityCellSize;e.push(this._vertexToIndex(n,i+l*(n-t)/a))}else for(let r=p;r>=d;r--){const n=r*this._granularityCellSize;e.push(this._vertexToIndex(n,i+l*(n-t)/a))}}_generateInterEdgeVertices(e,t,i,r,n,o,s,a,l,c){const u=n-i,h=o-r,d=s-n,p=(l-n)/d,f=(c-n)/d,m=Math.min(p,f),g=Math.max(p,f),y=r+h*m;let _=Math.floor(Math.min(y,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(y,a)/this._granularityCellSize)-1,x=a<y;const b=0===d;if(b&&(s===l||s===c))return;if(b||m>=1||g<=0){const e=i-s,r=o+(t-o)*Math.min((l-s)/e,(c-s)/e);_=Math.floor(Math.min(r,a)/this._granularityCellSize)+1,v=Math.ceil(Math.max(r,a)/this._granularityCellSize)-1,x=a<r}const w=u>0?c:l;if(x)for(let t=_;t<=v;t++)e.push(this._vertexToIndex(t*this._granularityCellSize,w));else for(let t=v;t>=_;t--)e.push(this._vertexToIndex(t*this._granularityCellSize,w))}_generateOutline(e){const t=[];for(const i of e){const e=Ul(i,this._granularity,!0),r=this._pointArrayToIndices(e),n=[];for(let e=1;e<r.length;e++)n.push(r[e-1]),n.push(r[e]);t.push(n)}return t}_handlePoles(e){let t=!1,i=!1;this._canonical&&(0===this._canonical.y&&(t=!0),this._canonical.y===(1<<this._canonical.z)-1&&(i=!0)),(t||i)&&this._fillPoles(e,t,i)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let t=0;t<e.length;t+=2){const i=e[t+1];i===Fl&&(e[t+1]=-32767),i===jl&&(e[t+1]=32766)}}_generatePoleQuad(e,t,i,r,n,o){r>n!=(o===Fl)?(e.push(t),e.push(i),e.push(this._vertexToIndex(r,o)),e.push(i),e.push(this._vertexToIndex(n,o)),e.push(this._vertexToIndex(r,o))):(e.push(i),e.push(t),e.push(this._vertexToIndex(r,o)),e.push(this._vertexToIndex(n,o)),e.push(i),e.push(this._vertexToIndex(r,o)))}_fillPoles(e,t,i){const r=this._vertexBuffer,n=E,o=e.length;for(let s=2;s<o;s+=3){const o=e[s-2],a=e[s-1],l=e[s],c=r[2*o],u=r[2*o+1],h=r[2*a],d=r[2*a+1],p=r[2*l],f=r[2*l+1];t&&(0===u&&0===d&&this._generatePoleQuad(e,o,a,c,h,Fl),0===d&&0===f&&this._generatePoleQuad(e,a,l,h,p,Fl),0===f&&0===u&&this._generatePoleQuad(e,l,o,p,c,Fl)),i&&(u===n&&d===n&&this._generatePoleQuad(e,o,a,c,h,jl),d===n&&f===n&&this._generatePoleQuad(e,a,l,h,p,jl),f===n&&u===n&&this._generatePoleQuad(e,l,o,p,c,jl))}}_initializeVertices(e){for(let t=0;t<e.length;t+=2)this._vertexToIndex(e[t],e[t+1])}subdividePolygonInternal(e,t){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:i,holeIndices:r}=function(e){const t=[],i=[];for(const r of e)if(0!==r.length){r!==e[0]&&t.push(i.length/2);for(let e=0;e<r.length;e++)i.push(r[e].x),i.push(r[e].y)}return{flattened:i,holeIndices:t}}(e);let n;this._initializeVertices(i);try{const e=function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let o=hl(e,0,n,i,!0);const s=[];if(!o||o.next===o.prev)return s;let a,l,c;if(r&&(o=function(e,t,i,r){const n=[];for(let i=0,o=t.length;i<o;i++){const s=hl(e,t[i]*r,i<o-1?t[i+1]*r:e.length,r,!1);s===s.next&&(s.steiner=!0),n.push(wl(s))}n.sort(_l);for(let e=0;e<n.length;e++)i=vl(n[e],i);return i}(e,t,o,i)),e.length>80*i){a=1/0,l=1/0;let t=-1/0,r=-1/0;for(let o=i;o<n;o+=i){const i=e[o],n=e[o+1];i<a&&(a=i),n<l&&(l=n),i>t&&(t=i),n>r&&(r=n)}c=Math.max(t-a,r-l),c=0!==c?32767/c:0}return pl(o,s,i,a,l,c,0),s}(i,r),t=this._convertIndices(i,e);n=this._subdivideTrianglesScanline(t)}catch(e){console.error(e)}let o=[];return t&&(o=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(n),{verticesFlattened:this._vertexBuffer,indicesTriangles:n,indicesLineList:o}}_convertIndices(e,t){const i=[];for(let r=0;r<t.length;r++)i.push(this._vertexToIndex(e[2*t[r]],e[2*t[r]+1]));return i}_pointArrayToIndices(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];t.push(this._vertexToIndex(r.x,r.y))}return t}}function Nl(e,t,i,r=!0){return new $l(i,t).subdividePolygonInternal(e,r)}function Ul(e,t,i=!1){if(!e||e.length<1)return[];if(e.length<2)return[];const r=e[0],n=e[e.length-1],o=i&&(r.x!==n.x||r.y!==n.y);if(t<2)return o?[...e,e[0]]:[...e];const s=Math.floor(E/t),a=[];a.push(new l(e[0].x,e[0].y));const c=e.length,u=o?c:c-1;for(let t=0;t<u;t++){const i=e[t],r=t<c-1?e[t+1]:e[0],n=i.x,o=i.y,u=r.x,h=r.y,d=n!==u,p=o!==h;if(!d&&!p)continue;const f=u-n,m=h-o,g=Math.abs(f),y=Math.abs(m);let _=n,v=o;for(;;){const e=f>0?(Math.floor(_/s)+1)*s:(Math.ceil(_/s)-1)*s,t=m>0?(Math.floor(v/s)+1)*s:(Math.ceil(v/s)-1)*s,i=Math.abs(_-e),r=Math.abs(v-t),n=Math.abs(_-u),o=Math.abs(v-h),c=d?i/g:Number.POSITIVE_INFINITY,x=p?r/y:Number.POSITIVE_INFINITY;if((n<=i||!d)&&(o<=r||!p))break;if(c<x&&d||!p){_=e,v+=m*c;const t=new l(_,Math.round(v));a[a.length-1].x===t.x&&a[a.length-1].y===t.y||a.push(t)}else{_+=f*x,v=t;const e=new l(Math.round(_),v);a[a.length-1].x===e.x&&a[a.length-1].y===e.y||a.push(e)}}const x=new l(u,h);a[a.length-1].x===x.x&&a[a.length-1].y===x.y||a.push(x)}return a}function Vl(e,t,i){if(0===t.length)throw new Error("Subdivision vertex ring is empty.");let r=0,n=e[2*t[0]];for(let i=1;i<t.length;i++){const o=e[2*t[i]];o<n&&(n=o,r=i)}const o=t.length;let s=r,a=(s+1)%o;for(;;){const r=s-1>=0?s-1:o-1,n=(a+1)%o,l=e[2*t[r]],c=e[2*t[n]],u=e[2*t[s]],h=e[2*t[s]+1],d=e[2*t[a]+1];let p=!1;if(l<c)p=!0;else if(l>c)p=!1;else{const i=d-h,o=-(e[2*t[a]]-u),s=h<d?1:-1;((l-u)*i+(e[2*t[r]+1]-h)*o)*s>((c-u)*i+(e[2*t[n]+1]-h)*o)*s&&(p=!0)}if(p){const e=t[r],n=t[s],l=t[a];e!==n&&e!==l&&n!==l&&i.push(l,n,e),s--,s<0&&(s=o-1)}else{const e=t[n],r=t[s],l=t[a];e!==r&&e!==l&&r!==l&&i.push(l,r,e),a++,a>=o&&(a=0)}if(r===n)break}}function Gl(e,t,i,r,n,o,s,a,l){const c=n.length/2,u=s&&a&&l;if(c<qs.MAX_VERTEX_ARRAY_LENGTH){const h=t.prepareSegment(c,i,r),d=h.vertexLength;for(let e=0;e<o.length;e+=3)r.emplaceBack(d+o[e],d+o[e+1],d+o[e+2]);let p,f;h.vertexLength+=c,h.primitiveLength+=o.length/3,u&&(f=s.prepareSegment(c,i,a),p=f.vertexLength,f.vertexLength+=c);for(let t=0;t<n.length;t+=2)e(n[t],n[t+1]);if(u)for(let e=0;e<l.length;e++){const t=l[e];for(let e=1;e<t.length;e+=2)a.emplaceBack(p+t[e-1],p+t[e]);f.primitiveLength+=t.length/2}}else!function(e,t,i,r,n,o){const s=[];for(let e=0;e<r.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,i),u=c.vertexLength;for(let h=2;h<n.length;h+=3){const d=n[h-2],p=n[h-1],f=n[h];let m=s[d]<l,g=s[p]<l,y=s[f]<l;c.vertexLength+((m?1:0)+(g?1:0)+(y?1:0))>qs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,i),l=a.count,m=!0,g=!0,y=!0,u=0);const _=ql(s,r,o,a,d,m,c),v=ql(s,r,o,a,p,g,c),x=ql(s,r,o,a,f,y,c);i.emplaceBack(u+_-l,u+v-l,u+x-l),c.primitiveLength++}}(t,i,r,n,o,e),u&&function(e,t,i,r,n,o){const s=[];for(let e=0;e<r.length/2;e++)s.push(-1);const a={count:0};let l=0,c=e.getOrCreateLatestSegment(t,i),u=c.vertexLength;for(let h=0;h<n.length;h++){const d=n[h];for(let p=1;p<n[h].length;p+=2){const n=d[p-1],h=d[p];let f=s[n]<l,m=s[h]<l;c.vertexLength+((f?1:0)+(m?1:0))>qs.MAX_VERTEX_ARRAY_LENGTH&&(c=e.createNewSegment(t,i),l=a.count,f=!0,m=!0,u=0);const g=ql(s,r,o,a,n,f,c),y=ql(s,r,o,a,h,m,c);i.emplaceBack(u+g-l,u+y-l),c.primitiveLength++}}}(s,i,a,n,l,e),t.forceNewSegmentOnNextPrepare(),null==s||s.forceNewSegmentOnNextPrepare()}function ql(e,t,i,r,n,o,s){if(o){const o=r.count;return i(t[2*n],t[2*n+1]),e[n]=r.count,r.count++,s.vertexLength++,o}return e[n]}class Zl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zs,this.indexArray=new Ns,this.indexArray2=new Us,this.programConfigurations=new _a(e.layers,e.zoom),this.segments=new qs,this.segments2=new qs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=cl("fill",this.layers,t);const r=this.layers[0].layout.get("fill-sort-key"),n=!r.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Sa(s,e);if(!this.layers[0]._featureFilter.filter(new Mo(this.zoom),u,i))continue;const h=n?r.evaluate(u,{},i,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ta(s),patterns:{},sortKey:h};o.push(d)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=ul("fill",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,i,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ll),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n,o){for(const e of Ji(t,500)){const t=Nl(e,r,o.fill.getGranularityForZoomLevel(r.z)),i=this.layoutVertexArray;Gl(((e,t)=>{i.emplaceBack(e,t)}),this.segments,this.layoutVertexArray,this.indexArray,t.verticesFlattened,t.indicesTriangles,this.segments2,this.indexArray2,t.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}}let Wl,Hl;no("FillBucket",Zl,{omit:["layers","patternFeatures"]});var Xl={get paint(){return Hl=Hl||new $o({"fill-antialias":new Ro(ye.paint_fill["fill-antialias"]),"fill-opacity":new Bo(ye.paint_fill["fill-opacity"]),"fill-color":new Bo(ye.paint_fill["fill-color"]),"fill-outline-color":new Bo(ye.paint_fill["fill-outline-color"]),"fill-translate":new Ro(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Ro(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Oo(ye.paint_fill["fill-pattern"])})},get layout(){return Wl=Wl||new $o({"fill-sort-key":new Bo(ye.layout_fill["fill-sort-key"])})}};class Kl extends Uo{constructor(e){super(e,Xl)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Zl(e)}queryRadius(){return $a(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:t,transform:i,pixelsToTileUnits:r}){return Ia(Na(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-i.bearingInRadians,r),t)}isTileClipped(){return!0}}const Yl=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jl=Zo([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ql}=Yl;var ec,tc,ic,rc,nc,oc,sc,ac={};function lc(){if(tc)return ec;tc=1;var e=o();function t(e,t,r,n,o){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,e.readFields(i,this,t)}function i(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function r(e){for(var t,i,r=0,n=0,o=e.length,s=o-1;n<o;s=n++)r+=((i=e[s]).x-(t=e[n]).x)*(t.y+i.y);return r}return ec=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var i,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,l=[];t.pos<r;){if(o<=0){var c=t.readVarint();n=7&c,o=c>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(i&&l.push(i),i=[]),i.push(new e(s,a));else{if(7!==n)throw new Error("unknown command "+n);i&&i.push(i[0].clone())}}return i&&l.push(i),l},t.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var u=e.readVarint();i=7&u,r=u>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==i)throw new Error("unknown command "+i)}return[s,l,a,c]},t.prototype.toGeoJSON=function(e,i,n){var o,s,a=this.extent*Math.pow(2,n),l=this.extent*e,c=this.extent*i,u=this.loadGeometry(),h=t.types[this.type];function d(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+l)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+c)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(o=0;o<u.length;o++)p[o]=u[o][0];d(u=p);break;case 2:for(o=0;o<u.length;o++)d(u[o]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var i,n,o=[],s=0;s<t;s++){var a=r(e[s]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(i&&o.push(i),i=[e[s]]):i.push(e[s]))}return i&&o.push(i),o}(u),o=0;o<u.length;o++)for(s=0;s<u[o].length;s++)d(u[o][s])}1===u.length?u=u[0]:h="Multi"+h;var f={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f},ec}function cc(){if(rc)return ic;rc=1;var e=lc();function t(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(i,this,t),this.length=this._features.length}function i(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}return ic=t,t.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var i=this._pbf.readVarint()+this._pbf.pos;return new e(this._pbf,i,this.extent,this._keys,this._values)},ic}function uc(){return sc||(sc=1,ac.VectorTile=function(){if(oc)return nc;oc=1;var e=cc();function t(t,i,r){if(3===t){var n=new e(r,r.readVarint()+r.pos);n.length&&(i[n.name]=n)}}return nc=function(e,i){this.layers=e.readFields(t,{},i)},nc}(),ac.VectorTileFeature=lc(),ac.VectorTileLayer=cc()),ac}var hc=i(uc());const dc=hc.VectorTileFeature.types,pc=Math.pow(2,13);function fc(e,t,i,r,n,o,s,a){e.emplaceBack(t,i,2*Math.floor(r*pc)+s,n*pc*2,o*pc*2,Math.round(a))}class mc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ps,this.centroidVertexArray=new As,this.indexArray=new Ns,this.programConfigurations=new _a(e.layers,e.zoom),this.segments=new qs,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.features=[],this.hasPattern=cl("fill-extrusion",this.layers,t);for(const{feature:r,id:n,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,a=Sa(r,e);if(!this.layers[0]._featureFilter.filter(new Mo(this.zoom),a,i))continue;const l={id:n,sourceLayerIndex:s,index:o,geometry:e?a.geometry:Ta(r),properties:r.properties,type:r.type,patterns:{}};this.hasPattern?this.features.push(ul("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,o,i,{},t.subdivisionGranularity),t.featureIndex.insert(r,l.geometry,o,s,this.index,!0)}}addFeatures(e,t,i){for(const r of this.features){const{geometry:n}=r;this.addFeature(r,n,r.index,t,i,e.subdivisionGranularity)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ql),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Jl.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,i,r,n,o){for(const i of Ji(t,500)){const t={x:0,y:0,sampleCount:0},n=this.layoutVertexArray.length;this.processPolygon(t,r,e,i,o);const s=this.layoutVertexArray.length-n,a=Math.floor(t.x/t.sampleCount),l=Math.floor(t.y/t.sampleCount);for(let e=0;e<s;e++)this.centroidVertexArray.emplaceBack(a,l)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}processPolygon(e,t,i,r,n){if(r.length<1)return;if(_c(r[0]))return;for(const t of r)0!==t.length&&gc(e,t);const o={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},s=n.fill.getGranularityForZoomLevel(t.z),a="Polygon"===dc[i.type];for(const e of r){if(0===e.length)continue;if(_c(e))continue;const t=Ul(e,s,a);this._generateSideFaces(t,o)}if(!a)return;const l=Nl(r,t,s,!1),c=this.layoutVertexArray;Gl(((e,t)=>{fc(c,e,t,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,l.verticesFlattened,l.indicesTriangles)}_generateSideFaces(e,t){let i=0;for(let r=1;r<e.length;r++){const n=e[r],o=e[r-1];if(yc(n,o))continue;t.segment.vertexLength+4>qs.MAX_VERTEX_ARRAY_LENGTH&&(t.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const s=n.sub(o)._perp()._unit(),a=o.dist(n);i+a>32768&&(i=0),fc(this.layoutVertexArray,n.x,n.y,s.x,s.y,0,0,i),fc(this.layoutVertexArray,n.x,n.y,s.x,s.y,0,1,i),i+=a,fc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,0,i),fc(this.layoutVertexArray,o.x,o.y,s.x,s.y,0,1,i);const l=t.segment.vertexLength;this.indexArray.emplaceBack(l,l+2,l+1),this.indexArray.emplaceBack(l+1,l+2,l+3),t.segment.vertexLength+=4,t.segment.primitiveLength+=2}}}function gc(e,t){for(let i=0;i<t.length;i++){const r=t[i];i===t.length-1&&t[0].x===r.x&&t[0].y===r.y||(e.x+=r.x,e.y+=r.y,e.sampleCount++)}}function yc(e,t){return e.x===t.x&&(e.x<0||e.x>E)||e.y===t.y&&(e.y<0||e.y>E)}function _c(e){return e.every((e=>e.x<0))||e.every((e=>e.x>E))||e.every((e=>e.y<0))||e.every((e=>e.y>E))}let vc;no("FillExtrusionBucket",mc,{omit:["layers","features"]});var xc={get paint(){return vc=vc||new $o({"fill-extrusion-opacity":new Ro(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Bo(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ro(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ro(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Oo(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Bo(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Bo(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ro(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class bc extends Uo{constructor(e){super(e,xc)}createBucket(e){return new mc(e)}queryRadius(){return $a(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o,pixelPosMatrix:s}){const a=Na(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-n.bearingInRadians,o),c=this.paint.get("fill-extrusion-height").evaluate(t,i),u=this.paint.get("fill-extrusion-base").evaluate(t,i),h=function(e,t,i){const r=[];for(const i of e){const e=[i.x,i.y,0,1];S(e,e,t),r.push(new l(e[0]/e[3],e[1]/e[3]))}return r}(a,s),d=function(e,t,i,r){const n=[],o=[],s=r[8]*t,a=r[9]*t,c=r[10]*t,u=r[11]*t,h=r[8]*i,d=r[9]*i,p=r[10]*i,f=r[11]*i;for(const t of e){const e=[],i=[];for(const n of t){const t=n.x,o=n.y,m=r[0]*t+r[4]*o+r[12],g=r[1]*t+r[5]*o+r[13],y=r[2]*t+r[6]*o+r[14],_=r[3]*t+r[7]*o+r[15],v=y+c,x=_+u,b=m+h,w=g+d,T=y+p,S=_+f,C=new l((m+s)/x,(g+a)/x);C.z=v/x,e.push(C);const M=new l(b/S,w/S);M.z=T/S,i.push(M)}n.push(e),o.push(i)}return[n,o]}(r,u,c,s);return function(e,t,i){let r=1/0;Ia(i,t)&&(r=Tc(i,t[0]));for(let n=0;n<t.length;n++){const o=t[n],s=e[n];for(let e=0;e<o.length-1;e++){const t=o[e],n=[t,o[e+1],s[e+1],s[e],t];Ea(i,n)&&(r=Math.min(r,Tc(i,n)))}}return r!==1/0&&r}(d[0],d[1],h)}}function wc(e,t){return e.x*t.x+e.y*t.y}function Tc(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const o=t[i],s=e[0],a=n.sub(r),l=o.sub(r),c=s.sub(r),u=wc(a,a),h=wc(a,l),d=wc(l,l),p=wc(c,a),f=wc(c,l),m=u*d-h*h,g=(d*p-h*f)/m,y=(u*f-h*p)/m,_=r.z*(1-g-y)+n.z*g+o.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}const Sc=Zo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cc}=Sc,Mc=Zo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:kc}=Mc,Ec=hc.VectorTileFeature.types,Ac=Math.cos(Math.PI/180*37.5),Ic=Math.pow(2,14)/.5;class zc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Ls,this.layoutVertexArray2=new Ds,this.indexArray=new Ns,this.programConfigurations=new _a(e.layers,e.zoom),this.segments=new qs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i){this.hasPattern=cl("line",this.layers,t);const r=this.layers[0].layout.get("line-sort-key"),n=!r.isConstant(),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Sa(t,e);if(!this.layers[0]._featureFilter.filter(new Mo(this.zoom),c,i))continue;const u=n?r.evaluate(c,{},i):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ta(t),patterns:{},sortKey:u};o.push(h)}n&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const r of o){const{geometry:n,index:o,sourceLayerIndex:s}=r;if(this.hasPattern){const e=ul("line",this.layers,r,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(r,n,o,i,{},t.subdivisionGranularity);t.featureIndex.insert(e[o].feature,n,o,s,this.index)}}update(e,t,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,i)}addFeatures(e,t,i){for(const r of this.patternFeatures)this.addFeature(r,r.geometry,r.index,t,i,e.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,kc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(e,{}),l=s.get("line-cap"),c=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const i of t)this.addLine(i,e,a,l,c,u,r,o);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,r)}addLine(e,t,i,r,n,o,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ul(e,s?a.line.getGranularityForZoomLevel(s.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const l="Polygon"===Ec[t.type];let c=e.length;for(;c>=2&&e[c-1].equals(e[c-2]);)c--;let u=0;for(;u<c-1&&e[u].equals(e[u+1]);)u++;if(c<(l?3:2))return;"bevel"===i&&(n=1.05);const h=this.overscaling<=16?15*E/(512*this.overscaling):0,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let p,f,m,g,y;this.e1=this.e2=-1,l&&(p=e[c-2],y=e[u].sub(p)._unit()._perp());for(let t=u;t<c;t++){if(m=t===c-1?l?e[u+1]:void 0:e[t+1],m&&e[t].equals(m))continue;y&&(g=y),p&&(f=p),p=e[t],y=m?m.sub(p)._unit()._perp():g,g=g||y;let s=g.add(y);0===s.x&&0===s.y||s._unit();const a=g.x*y.x+g.y*y.y,_=s.x*y.x+s.y*y.y,v=0!==_?1/_:1/0,x=2*Math.sqrt(2-2*_),b=_<Ac&&f&&m,w=g.x*y.y-g.y*y.x>0;if(b&&t>u){const e=p.dist(f);if(e>2*h){const t=p.sub(p.sub(f)._mult(h/e)._round());this.updateDistance(f,t),this.addCurrentVertex(t,g,0,0,d),f=t}}const T=f&&m;let S=T?i:l?"butt":r;if(T&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>n&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<n&&(S="miter")),f&&this.updateDistance(f,p),"miter"===S)s._mult(v),this.addCurrentVertex(p,s,0,0,d);else if("flipbevel"===S){if(v>100)s=y.mult(-1);else{const e=v*g.add(y).mag()/g.sub(y).mag();s._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(p,s,0,0,d),this.addCurrentVertex(p,s.mult(-1),0,0,d)}else if("bevel"===S||"fakeround"===S){const e=-Math.sqrt(v*v-1),t=w?e:0,i=w?0:e;if(f&&this.addCurrentVertex(p,g,t,i,d),"fakeround"===S){const e=Math.round(180*x/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const r=y.sub(g)._mult(i)._add(g)._unit()._mult(w?-1:1);this.addHalfVertex(p,r.x,r.y,!1,w,0,d)}}m&&this.addCurrentVertex(p,y,-t,-i,d)}else if("butt"===S)this.addCurrentVertex(p,s,0,0,d);else if("square"===S){const e=f?1:-1;this.addCurrentVertex(p,s,e,e,d)}else"round"===S&&(f&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,y,-1,-1,d,!0),this.addCurrentVertex(p,y,0,0,d)));if(b&&t<c-1){const e=p.dist(m);if(e>2*h){const t=p.add(m.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,y,0,0,d),p=t}}}}addCurrentVertex(e,t,i,r,n,o=!1){const s=t.y*r-t.x,a=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,o,!1,i,n),this.addHalfVertex(e,s,a,o,!0,-r,n),this.distance>Ic/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,i,r,n,o))}addHalfVertex({x:e,y:t},i,r,n,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(Ic-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(n?1:0),(t<<1)+(o?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,c,this.e2),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let Pc,Lc;no("LineBucket",zc,{omit:["layers","patternFeatures"]});var Dc={get paint(){return Lc=Lc||new $o({"line-opacity":new Bo(ye.paint_line["line-opacity"]),"line-color":new Bo(ye.paint_line["line-color"]),"line-translate":new Ro(ye.paint_line["line-translate"]),"line-translate-anchor":new Ro(ye.paint_line["line-translate-anchor"]),"line-width":new Bo(ye.paint_line["line-width"]),"line-gap-width":new Bo(ye.paint_line["line-gap-width"]),"line-offset":new Bo(ye.paint_line["line-offset"]),"line-blur":new Bo(ye.paint_line["line-blur"]),"line-dasharray":new Fo(ye.paint_line["line-dasharray"]),"line-pattern":new Oo(ye.paint_line["line-pattern"]),"line-gradient":new jo(ye.paint_line["line-gradient"])})},get layout(){return Pc=Pc||new $o({"line-cap":new Ro(ye.layout_line["line-cap"]),"line-join":new Bo(ye.layout_line["line-join"]),"line-miter-limit":new Ro(ye.layout_line["line-miter-limit"]),"line-round-limit":new Ro(ye.layout_line["line-round-limit"]),"line-sort-key":new Bo(ye.layout_line["line-sort-key"])})}};class Rc extends Bo{possiblyEvaluate(e,t){return t=new Mo(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=O({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}let Bc;class Oc extends Uo{constructor(e){super(e,Dc),this.gradientVersion=0,Bc||(Bc=new Rc(Dc.paint.properties["line-width"].specification),Bc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof oi,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Bc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new zc(e)}queryRadius(e){const t=e,i=Fc(ja("line-width",this,t),ja("line-gap-width",this,t)),r=ja("line-offset",this,t);return i/2+Math.abs(r)+$a(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:t,featureState:i,geometry:r,transform:n,pixelsToTileUnits:o}){const s=Na(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-n.bearingInRadians,o),a=o/2*Fc(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),c=this.paint.get("line-offset").evaluate(t,i);return c&&(r=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=[];for(let e=0;e<n.length;e++){const i=n[e-1],r=n[e],s=n[e+1],a=0===e?new l(0,0):r.sub(i)._unit()._perp(),c=e===n.length-1?new l(0,0):s.sub(r)._unit()._perp(),u=a._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),o.push(u._mult(t)._add(r))}i.push(o)}return i}(r,c*o)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(Oa(e,n[t]))return!0;if(za(e,n,i))return!0}return!1}(s,r,a)}isTileClipped(){return!0}}function Fc(e,t){return t>0?t+2*e:e}const jc=Zo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$c=Zo([{name:"a_projected_pos",components:3,type:"Float32"}],4);Zo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Nc=Zo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Zo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uc=Zo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vc=Zo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gc(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Co.applyArabicShaping&&(e=Co.applyArabicShaping(e)),e}(e.text,t,i)})),e}Zo([{name:"triangle",components:3,type:"Uint16"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Zo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Zo([{type:"Float32",name:"offsetX"}]),Zo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Zo([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Zc,Wc,Hc,Xc=24,Kc={};function Yc(){return Zc||(Zc=1,Kc.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=i?n-1:0,d=i?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},Kc.write=function(e,t,i,r,n,o){var s,a,l,c=8*o-n-1,u=(1<<c)-1,h=u>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,n),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,n),s=0));n>=8;e[i+p]=255&a,p+=f,a/=256,n-=8);for(s=s<<n|a,c+=n;c>0;e[i+p]=255&s,p+=f,s/=256,c-=8);e[i+p-f]|=128*m}),Kc}function Jc(){if(Hc)return Wc;Hc=1,Wc=t;var e=Yc();function t(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=4294967296,r=1/i,n="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function o(e){return e.type===t.Bytes?e.readVarint()+e.pos:e.pos+1}function s(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function a(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function l(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function c(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function h(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function y(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function _(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function v(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r,e(n,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=y(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=v(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=y(this.buf,this.pos)+y(this.buf,this.pos+4)*i;return this.pos+=8,e},readSFixed64:function(){var e=y(this.buf,this.pos)+v(this.buf,this.pos+4)*i;return this.pos+=8,e},readFloat:function(){var t=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,o=i.buf;if(r=(112&(n=o[i.pos++]))>>4,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<3,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<10,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<17,n<128)return s(e,r,t);if(r|=(127&(n=o[i.pos++]))<<24,n<128)return s(e,r,t);if(r|=(1&(n=o[i.pos++]))<<31,n<128)return s(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&n?function(e,t,i){return n.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var o,s,a,l=e[n],c=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u>i)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[n+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[n+2],128==(192&(o=e[n+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[n+2],a=e[n+3],128==(192&(o=e[n+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=u}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,i){if(this.type!==t.Bytes)return e.push(this.readVarint(i));var r=o(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(i));return e},readPackedSVarint:function(e){if(this.type!==t.Bytes)return e.push(this.readSVarint());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==t.Bytes)return e.push(this.readBoolean());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==t.Bytes)return e.push(this.readFloat());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==t.Bytes)return e.push(this.readDouble());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed32());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==t.Bytes)return e.push(this.readSFixed64());var i=o(this);for(e=e||[];this.pos<i;)e.push(this.readSFixed64());return e},skip:function(e){var i=7&e;if(i===t.Varint)for(;this.buf[this.pos++]>127;);else if(i===t.Bytes)this.pos=this.readVarint()+this.pos;else if(i===t.Fixed32)this.pos+=4;else{if(i!==t.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),_(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),_(this.buf,-1&e,this.pos),_(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!n){r>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&a(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),e.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),e.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&a(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,i,r){this.writeTag(e,t.Bytes),this.writeRawMessage(i,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,l,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,c,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,u,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,g,t)},writeBytesField:function(e,i){this.writeTag(e,t.Bytes),this.writeBytes(i)},writeFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(e,i){this.writeTag(e,t.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(e,i){this.writeTag(e,t.Fixed64),this.writeSFixed64(i)},writeVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeVarint(i)},writeSVarintField:function(e,i){this.writeTag(e,t.Varint),this.writeSVarint(i)},writeStringField:function(e,i){this.writeTag(e,t.Bytes),this.writeString(i)},writeFloatField:function(e,i){this.writeTag(e,t.Fixed32),this.writeFloat(i)},writeDoubleField:function(e,i){this.writeTag(e,t.Fixed64),this.writeDouble(i)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}},Wc}var Qc=i(Jc());const eu=3;function tu(e,t,i){1===e&&i.readMessage(iu,t)}function iu(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:o,left:s,top:a,advance:l}=i.readMessage(ru,{});t.push({id:e,bitmap:new Qa({width:n+2*eu,height:o+2*eu},r),metrics:{width:n,height:o,left:s,top:a,advance:l}})}}function ru(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const nu=eu;function ou(e){let t=0,i=0;for(const r of e)t+=r.w*r.h,i=Math.max(i,r.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,o=0;for(const t of e)for(let e=r.length-1;e>=0;e--){const i=r[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,o=Math.max(o,t.y+t.h),n=Math.max(n,t.x+t.w),t.w===i.w&&t.h===i.h){const t=r.pop();e<r.length&&(r[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(r.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:n,h:o,fill:t/(n*o)||0}}const su=1;class au{constructor(e,{pixelRatio:t,version:i,stretchX:r,stretchY:n,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=r,this.stretchY=n,this.content=o,this.version=i,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+su,this.paddedRect.y+su]}get br(){return[this.paddedRect.x+this.paddedRect.w-su,this.paddedRect.y+this.paddedRect.h-su]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*su)/this.pixelRatio,(this.paddedRect.h-2*su)/this.pixelRatio]}}class lu{constructor(e,t){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,i,n),this.addImages(t,r,n);const{w:o,h:s}=ou(n),a=new el({width:o||1,height:s||1});for(const t in e){const r=e[t],n=i[t].paddedRect;el.copy(r.data,a,{x:0,y:0},{x:n.x+su,y:n.y+su},r.data)}for(const e in t){const i=t[e],n=r[e].paddedRect,o=n.x+su,s=n.y+su,l=i.data.width,c=i.data.height;el.copy(i.data,a,{x:0,y:0},{x:o,y:s},i.data),el.copy(i.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),el.copy(i.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),el.copy(i.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),el.copy(i.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const r in e){const n=e[r],o={x:0,y:0,w:n.data.width+2*su,h:n.data.height+2*su};i.push(o),t[r]=new au(o,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const i in e.updatedImages)this.patchUpdatedImage(this.iconPositions[i],e.getImage(i),t),this.patchUpdatedImage(this.patternPositions[i],e.getImage(i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl;i.update(t.data,void 0,{x:r,y:n})}}var cu;no("ImagePosition",au),no("ImageAtlas",lu),e.al=void 0,(cu=e.al||(e.al={}))[cu.none=0]="none",cu[cu.horizontal=1]="horizontal",cu[cu.vertical=2]="vertical",cu[cu.horizontalOnly=3]="horizontalOnly";const uu=-17;class hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(e,t,i){const r=new hu;return r.scale=e||1,r.fontStack=t,r.verticalAlign=i||"bottom",r}static forImage(e,t){const i=new hu;return i.imageName=e,i.verticalAlign=t||"bottom",i}}class du{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new du;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i+1)||null,n=e.charCodeAt(i-1)||null;t+=r&&xo(r)&&!qc[e[i+1]]||n&&xo(n)&&!qc[e[i-1]]||!qc[e[i]]?e[i]:qc[e[i]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&fu[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&fu[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new du;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}getMaxImageSize(e){let t=0,i=0;for(let r=0;r<this.length();r++){const n=this.getSection(r);if(n.imageName){const r=e[n.imageName];if(!r)continue;const o=r.displaySize;t=Math.max(t,o[0]),i=Math.max(i,o[1])}}return{maxImageWidth:t,maxImageHeight:i}}addTextSection(e,t){this.text+=e.text,this.sections.push(hu.forText(e.scale,e.fontStack||t,e.verticalAlign));const i=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void V("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCharCode(i),this.sections.push(hu.forImage(t,e.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pu(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m){const g=du.fromFeature(t,o);let y;d===e.al.vertical&&g.verticalizePunctuation();const{processBidirectionalText:_,processStyledBidirectionalText:v}=Co;if(_&&1===g.sections.length){y=[];const e=_(g.toString(),wu(g,u,s,i,n,f));for(const t of e){const e=new du;e.text=t,e.sections=g.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);y.push(e)}}else if(v){y=[];const e=v(g.text,g.sectionIndex,wu(g,u,s,i,n,f));for(const t of e){const e=new du;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,y.push(e)}}else y=function(e,t){const i=[],r=e.text;let n=0;for(const r of t)i.push(e.substring(n,r)),n=r;return n<r.length&&i.push(e.substring(n,r.length)),i}(g,wu(g,u,s,i,n,f));const x=[],b={positionedLines:x,text:g.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(e,t,i,r,n,o,s,a,l,c,u,h){let d=0,p=0,f=0,m=0;const g="right"===a?1:"left"===a?0:.5,y=Xc/h;let _=0;for(const s of n){s.trim();const n=s.getMaxScale(),a={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=a;const h=a.positionedGlyphs;let v=0;if(!s.length()){p+=o,++_;continue}const x=Su(r,s,y);for(let o=0;o<s.length();o++){const a=s.getSection(o),f=s.getSectionIndex(o),m=s.getCharCode(o),g=Mu(l,u,m);let _;if(a.imageName){if(e.iconsInText=!0,a.scale=a.scale*y,_=Eu(a,g,n,x,r),!_)continue;v=Math.max(v,_.imageOffset)}else if(_=ku(a,m,g,x,t,i),!_)continue;const{rect:b,metrics:w,baselineOffset:T}=_;h.push({glyph:m,imageName:a.imageName,x:d,y:p+T+uu,vertical:g,scale:a.scale,fontStack:a.fontStack,sectionIndex:f,metrics:w,rect:b}),g?(e.verticalizable=!0,d+=(a.imageName?w.advance:Xc)*a.scale+c):d+=w.advance*a.scale+c}0!==h.length&&(f=Math.max(d-c,f),Au(h,0,h.length-1,g)),d=0,a.lineOffset=Math.max(v,(n-1)*Xc);const b=o*n+v;p+=b,m=Math.max(b,m),++_}const{horizontalAlign:v,verticalAlign:x}=Tu(s);(function(e,t,i,r,n,o,s,a,l){const c=(t-i)*n;let u=0;u=o!==s?-a*r-uu:-r*l*s+.5*s;for(const t of e)for(const e of t.positionedGlyphs)e.x+=c,e.y+=u})(e.positionedLines,g,v,x,f,m,o,p,n.length),e.top+=-x*p,e.bottom=e.top+p,e.left+=-v*f,e.right=e.left+f}(b,i,r,n,y,a,l,c,d,u,p,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const fu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},gu={40:!0};function yu(e,t,i,r,n,o){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*Xc/o+n:0}{const r=i[t.fontStack],o=r&&r[e];return o?o.metrics.advance*t.scale+n:0}}function _u(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function vu(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function xu(e,t,i,r,n,o){let s=null,a=_u(t,i,n,o);for(const e of r){const r=_u(t-e.x,i,n,o)+e.badness;r<=a&&(s=e,a=r)}return{index:e,x:t,priorBreak:s,badness:a}}function bu(e){return e?bu(e.priorBreak).concat(e.index):[]}function wu(e,t,i,r,n,o){if(!e)return[];const s=[],a=function(e,t,i,r,n,o){let s=0;for(let i=0;i<e.length();i++){const a=e.getSection(i);s+=yu(e.getCharCode(i),a,r,n,t,o)}return s/Math.max(1,Math.ceil(s/i))}(e,t,i,r,n,o),l=e.text.indexOf("​")>=0;let c=0;for(let i=0;i<e.length();i++){const h=e.getSection(i),d=e.getCharCode(i);if(fu[d]||(c+=yu(d,h,r,n,t,o)),i<e.length()-1){const t=!((u=d)<11904)&&(!!ho["CJK Compatibility Forms"](u)||!!ho["CJK Compatibility"](u)||!!ho["CJK Strokes"](u)||!!ho["CJK Symbols and Punctuation"](u)||!!ho["Enclosed CJK Letters and Months"](u)||!!ho["Halfwidth and Fullwidth Forms"](u)||!!ho["Ideographic Description Characters"](u)||!!ho["Vertical Forms"](u)||_o.test(String.fromCodePoint(u)));(mu[d]||t||h.imageName||i!==e.length()-2&&gu[e.getCharCode(i+1)])&&s.push(xu(i+1,c,a,s,vu(d,e.getCharCode(i+1),t&&l),!1))}}var u;return bu(xu(e.length(),c,a,s,0,!0))}function Tu(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Su(e,t,i){const r=t.getMaxScale()*Xc,{maxImageWidth:n,maxImageHeight:o}=t.getMaxImageSize(e),s=Math.max(r,o*i);return{verticalLineContentWidth:Math.max(r,n*i),horizontalLineContentHeight:s}}function Cu(e){switch(e){case"top":return 0;case"center":return.5;default:return 1}}function Mu(t,i,r){return!(t===e.al.horizontal||!i&&!vo(r)||i&&(fu[r]||(n=r,/\p{sc=Arab}/u.test(String.fromCodePoint(n)))));var n}function ku(e,t,i,r,n,o){const s=o[e.fontStack],a=function(e,t,i,r){if(e&&e.rect)return e;const n=t[i.fontStack],o=n&&n[r];return o?{rect:null,metrics:o.metrics}:null}(s&&s[t],n,e,t);if(null===a)return null;let l;if(i)l=r.verticalLineContentWidth-e.scale*Xc;else{const t=Cu(e.verticalAlign);l=(r.horizontalLineContentHeight-e.scale*Xc)*t}return{rect:a.rect,metrics:a.metrics,baselineOffset:l}}function Eu(e,t,i,r,n){const o=n[e.imageName];if(!o)return null;const s=o.paddedRect,a=o.displaySize,l={width:a[0],height:a[1],left:su,top:-3,advance:t?a[1]:a[0]};let c;if(t)c=r.verticalLineContentWidth-a[1]*e.scale;else{const t=Cu(e.verticalAlign);c=(r.horizontalLineContentHeight-a[1]*e.scale)*t}return{rect:s,metrics:l,baselineOffset:c,imageOffset:(t?a[0]:a[1])*e.scale-Xc*i}}function Au(e,t,i,r){if(0===r)return;const n=e[i],o=(e[i].x+n.metrics.advance*n.scale)*r;for(let r=t;r<=i;r++)e[r].x-=o}function Iu(e,t,i){const{horizontalAlign:r,verticalAlign:n}=Tu(i),o=t[0]-e.displaySize[0]*r,s=t[1]-e.displaySize[1]*n;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function zu(e){var t,i;let r=e.left,n=e.top,o=e.right-r,s=e.bottom-n;const a=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(i=e.image.textFitHeight)&&void 0!==i?i:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const e=Math.ceil(s*c);r*=e/o,o=e}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const e=Math.ceil(o/c);n*=e/s,s=e}return{x1:r,y1:n,x2:r+o,y2:n+s}}function Pu(e,t,i,r,n,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],h=n[0]+c+r[1]):(p=n[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===i||"both"===i?(u=n[1]+f-r[0],d=n[1]+m+r[2]):(u=n[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const Lu=255,Du=128,Ru=Lu*Du;function Bu(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Mo(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let o=n;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[n],a=t[o];return"composite"===i.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:i.evaluate(new Mo(s)),maxSize:i.evaluate(new Mo(a)),interpolationType:r}}}function Ou(e,t,i){let r="never";const n=e.get(t);return n?r=n:e.get(i)&&(r="always"),r}const Fu=hc.VectorTileFeature.types,ju=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $u(e,t,i,r,n,o,s,a,l,c,u,h,d){const p=a?Math.min(Ru,Math.round(a[0])):0,f=a?Math.min(Ru,Math.round(a[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function Nu(e,t,i){e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i),e.emplaceBack(t.x,t.y,i)}function Uu(e){for(const t of e.sections)if(So(t.text))return!0;return!1}class Vu{constructor(e){this.layoutVertexArray=new Bs,this.indexArray=new Ns,this.programConfigurations=e,this.segments=new qs,this.dynamicLayoutVertexArray=new Os,this.opacityVertexArray=new Fs,this.hasVisibleVertices=!1,this.placedSymbolArray=new xs}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,i,r){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$c.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ju,!0),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}no("SymbolBuffers",Vu);class Gu{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new qs,this.collisionVertexArray=new $s}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Nc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}no("CollisionBuffers",Gu);class qu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bu(this.zoom,i["text-size"]),this.iconSizeData=Bu(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap="never"!==Ou(r,"text-overlap","text-allow-overlap")||"never"!==Ou(r,"icon-overlap","icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!n.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((t=>e.al[t]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Vu(new _a(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Vu(new _a(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new Ts,this.lineVertexArray=new Ss,this.symbolInstances=new ws,this.textAnchorOffsets=new Ms}calculateGlyphDependencies(e,t,i,r,n){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(i||r)&&n){const i=qc[e.charAt(o)];i&&(t[i.charCodeAt(0)]=!0)}}populate(t,i,r){const n=this.layers[0],o=n.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof At&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=i.iconDependencies,p=i.glyphDependencies,f=i.availableImages,m=new Mo(this.zoom);for(const{feature:i,id:a,index:l,sourceLayerIndex:g}of t){const t=n._featureFilter.needGeometry,y=Sa(i,t);if(!n._featureFilter.filter(m,y,r))continue;let _,v;if(t||(y.geometry=Ta(i)),c){const e=n.getValueAndResolveTokens("text-field",y,r,f),t=At.factory(e),i=this.hasRTLText=this.hasRTLText||Uu(t);(!i||"unavailable"===Co.getRTLTextPluginStatus()||i&&Co.isParsed())&&(_=Gc(t,n,y))}if(u){const e=n.getValueAndResolveTokens("icon-image",y,r,f);v=e instanceof Bt?e:Bt.fromString(e)}if(!_&&!v)continue;const x=this.sortFeaturesByKey?h.evaluate(y,{},r):void 0;if(this.features.push({id:a,text:_,icon:v,index:l,sourceLayerIndex:g,geometry:y.geometry,properties:i.properties,type:Fu[i.type],sortKey:x}),v&&(d[v.name]=!0),_){const t=s.evaluate(y,{},r).join(","),i="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.al.vertical)>=0;for(const e of _.sections)if(e.image)d[e.image.name]=!0;else{const r=po(_.toString()),n=e.fontStack||t,o=p[n]=p[n]||{};this.calculateGlyphDependencies(e.text,o,i,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function o(t){r.push(e[t]),n++}function s(e,t,n){const o=i[e];return delete i[e],i[t]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function a(e,i,n){const o=t[i];return delete t[i],t[e]=o,r[o].geometry[0].shift(),r[o].geometry[0]=n[0].concat(r[o].geometry[0]),o}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:${r.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=a(p,f,h),n=s(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment){let i=e.dist(t[e.segment+1]),r=e.dist(t[e.segment]);const n={};for(let r=e.segment+1;r<t.length;r++)n[r]={x:t[r].x,y:t[r].y,tileUnitDistanceFromAnchor:i},r<t.length-1&&(i+=t[r+1].dist(t[r]));for(let i=e.segment||0;i>=0;i--)n[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:r},i>0&&(r+=t[i-1].dist(t[i]));for(let e=0;e<t.length;e++){const t=n[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,i,r,n,o,s,a,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,m=t.segments.prepareSegment(4*i.length,f,p,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,y=m.vertexLength,_=this.allowVerticalPlacement&&a===e.al.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let e=0;e<i.length;e++){const{tl:n,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:y,minFontScaleY:x,glyphOffset:b,isSDF:w,sectionIndex:T}=i[e],S=m.vertexLength,C=b[1];$u(f,l.x,l.y,n.x,C+n.y,u.x,u.y,r,w,h.x,h.y,y,x),$u(f,l.x,l.y,o.x,C+o.y,u.x+u.w,u.y,r,w,g.x,h.y,y,x),$u(f,l.x,l.y,a.x,C+a.y,u.x,u.y+u.h,r,w,h.x,g.y,y,x),$u(f,l.x,l.y,c.x,C+c.y,u.x+u.w,u.y+u.h,r,w,g.x,g.y,y,x),Nu(t.dynamicLayoutVertexArray,l,_),p.emplaceBack(S,S+2,S+1),p.emplaceBack(S+1,S+2,S+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(b[0]),e!==i.length-1&&T===i[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,v&&v[T])}t.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,y,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,h)}_addCollisionDebugVertex(e,t,i,r,n,o){return t.emplaceBack(0,0),e.emplaceBack(i.x,i.y,r,n,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,i,r,n,o,s){const a=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),c=a.vertexLength,u=n.layoutVertexArray,h=n.collisionVertexArray,d=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(u,h,o,d,p,new l(e,t)),this._addCollisionDebugVertex(u,h,o,d,p,new l(i,t)),this._addCollisionDebugVertex(u,h,o,d,p,new l(i,r)),this._addCollisionDebugVertex(u,h,o,d,p,new l(e,r)),a.vertexLength+=4;const f=n.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),a.primitiveLength+=4}addDebugCollisionBoxes(e,t,i,r){for(let n=e;n<t;n++){const e=this.collisionBoxArray.get(n);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,r?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,i)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Gu(js,Uc.members,Us),this.iconCollisionBox=new Gu(js,Uc.members,Us);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,o,s,a,l){const c={};for(let r=t;r<i;r++){const t=e.get(r);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let t=r;t<n;t++){const i=e.get(t);c.verticalTextBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalTextFeatureIndex=i.featureIndex;break}for(let t=o;t<s;t++){const i=e.get(t);c.iconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.iconFeatureIndex=i.featureIndex;break}for(let t=a;t<l;t++){const i=e.get(t);c.verticalIconBox={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,anchorPointX:i.anchorPointX,anchorPointY:i.anchorPointY},c.verticalIconFeatureIndex=i.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let t=i.vertexStartIndex;t<r;t+=4)e.indexArray.emplaceBack(t,t+2,t+1),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);r.push(0|Math.round(t*s.anchorX+i*s.anchorY)),n.push(s.featureIndex)}return o.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),o}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,i)=>{e>=0&&i.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Zu,Wu;no("SymbolBucket",qu,{omit:["layers","collisionBoxArray","features","compareText"]}),qu.MAX_GLYPHS=65535,qu.addDynamicAttributes=Nu;var Hu={get paint(){return Wu=Wu||new $o({"icon-opacity":new Bo(ye.paint_symbol["icon-opacity"]),"icon-color":new Bo(ye.paint_symbol["icon-color"]),"icon-halo-color":new Bo(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Bo(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Bo(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Ro(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ro(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new Bo(ye.paint_symbol["text-opacity"]),"text-color":new Bo(ye.paint_symbol["text-color"],{runtimeType:Oe,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Bo(ye.paint_symbol["text-halo-color"]),"text-halo-width":new Bo(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Bo(ye.paint_symbol["text-halo-blur"]),"text-translate":new Ro(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Ro(ye.paint_symbol["text-translate-anchor"])})},get layout(){return Zu=Zu||new $o({"symbol-placement":new Ro(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Ro(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ro(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Bo(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ro(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ro(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ro(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ro(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ro(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ro(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Bo(ye.layout_symbol["icon-size"]),"icon-text-fit":new Ro(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ro(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Bo(ye.layout_symbol["icon-image"]),"icon-rotate":new Bo(ye.layout_symbol["icon-rotate"]),"icon-padding":new Bo(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Ro(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Bo(ye.layout_symbol["icon-offset"]),"icon-anchor":new Bo(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ro(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ro(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ro(ye.layout_symbol["text-rotation-alignment"]),"text-field":new Bo(ye.layout_symbol["text-field"]),"text-font":new Bo(ye.layout_symbol["text-font"]),"text-size":new Bo(ye.layout_symbol["text-size"]),"text-max-width":new Bo(ye.layout_symbol["text-max-width"]),"text-line-height":new Ro(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Bo(ye.layout_symbol["text-letter-spacing"]),"text-justify":new Bo(ye.layout_symbol["text-justify"]),"text-radial-offset":new Bo(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ro(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Bo(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Bo(ye.layout_symbol["text-anchor"]),"text-max-angle":new Ro(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Ro(ye.layout_symbol["text-writing-mode"]),"text-rotate":new Bo(ye.layout_symbol["text-rotate"]),"text-padding":new Ro(ye.layout_symbol["text-padding"]),"text-keep-upright":new Ro(ye.layout_symbol["text-keep-upright"]),"text-transform":new Bo(ye.layout_symbol["text-transform"]),"text-offset":new Bo(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Ro(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new Ro(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new Ro(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Ro(ye.layout_symbol["text-optional"])})}};class Xu{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Le,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}no("FormatSectionOverride",Xu,{omit:["defaultValue"]});class Ku extends Uo{constructor(e){super(e,Hu)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const i of e)t.indexOf(i)<0&&t.push(i);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Qr(o.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>e&&i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new qu(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Hu.paint.overridableProperties){if(!Ku.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new Xu(t),r=new Jr(i,t.property.specification);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new tn("source",r):new rn("composite",r,t.value.zoomStops),this.paint._values[e]=new Lo(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&Ku.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=Hu.paint.properties[t];let n=!1;const o=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof At)o(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof Ut&&$t(t.value)===Ue?o(t.value.sections):t instanceof Mi?o(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}}let Yu;var Ju={get paint(){return Yu=Yu||new $o({"background-color":new Ro(ye.paint_background["background-color"]),"background-pattern":new Fo(ye.paint_background["background-pattern"]),"background-opacity":new Ro(ye.paint_background["background-opacity"])})}};class Qu extends Uo{constructor(e){super(e,Ju)}}let eh;var th={get paint(){return eh=eh||new $o({"raster-opacity":new Ro(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ro(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ro(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ro(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Ro(ye.paint_raster["raster-saturation"]),"raster-contrast":new Ro(ye.paint_raster["raster-contrast"]),"raster-resampling":new Ro(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Ro(ye.paint_raster["raster-fade-duration"])})}};class ih extends Uo{constructor(e){super(e,th)}}class rh extends Uo{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class nh{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const oh={once:!0},sh=6371008.8;class ah{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ah(B(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return sh*Math.acos(Math.min(n,1))}static convert(e){if(e instanceof ah)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ah(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ah(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lh=2*Math.PI*sh;function ch(e){return lh*Math.cos(e*Math.PI/180)}function uh(e){return(180+e)/360}function hh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function dh(e,t){return e/ch(t)}function ph(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function fh(e,t){return e*ch(ph(t))}class mh{constructor(e,t,i=0){this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e,t=0){const i=ah.convert(e);return new mh(uh(i.lng),hh(i.lat),dh(t,i.lat))}toLngLat(){return new ah(360*this.x-180,ph(this.y))}toAltitude(){return fh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lh*(e=ph(this.y),1/Math.cos(e*Math.PI/180));var e}}function gh(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class yh{constructor(e,t,i){if(!function(e,t,i){return!(e<0||e>25||i<0||i>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))}(e,t,i))throw new Error(`x=${t}, y=${i}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=i,this.key=xh(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,i){const r=(o=this.y,s=this.z,a=gh(256*(n=this.x),256*(o=Math.pow(2,s)-o-1),s),l=gh(256*(n+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var n,o,s,a,l;const c=function(e,t,i){let r,n="";for(let o=e;o>0;o--)r=1<<o-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,r)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new l((e.x*t-this.x)*E,(e.y*t-this.y)*E)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _h{constructor(e,t){this.wrap=e,this.canonical=t,this.key=xh(e,t.z,t.z,t.x,t.y)}}class vh{constructor(e,t,i,r,n){if(this.terrainRttPosMatrix32f=null,e<i)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${i}`);this.overscaledZ=e,this.wrap=t,this.canonical=new yh(i,+r,+n),this.key=xh(t,e,i,r,n)}clone(){return new vh(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new vh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?xh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):xh(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new vh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new vh(t,this.wrap,t,i,r),new vh(t,this.wrap,t,i+1,r),new vh(t,this.wrap,t,i,r+1),new vh(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _h(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new mh(e.x-this.wrap,e.y))}}function xh(e,t,i,r,n){(e*=2)<0&&(e=-1*e-1);const o=1<<i;return(o*o*e+o*n+r).toString(36)+i.toString(36)+t.toString(36)}no("CanonicalTileID",yh),no("OverscaledTileID",vh,{omit:["terrainRttPosMatrix32f"]});class bh{constructor(e,t,i,r=1,n=1,o=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&!["mapbox","terrarium","custom"].includes(i))return void V(`"${i}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const a=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),i){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=r,this.greenFactor=n,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<a;e++)for(let t=0;t<a;t++){const i=this.get(e,t);i>this.max&&(this.max=i),i<this.min&&(this.min=i)}}get(e,t){const i=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return this.unpack(i[r],i[r+1],i[r+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,i){return e*this.redFactor+t*this.greenFactor+i*this.blueFactor-this.baseShift}getPixels(){return new el({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,o=i*this.dim,s=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-i*this.dim;for(let t=o;t<s;t++)for(let i=r;i<n;i++)this.data[this._idx(i,t)]=e.data[this._idx(i+a,t+l)]}}no("DEMData",bh);class wh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Th{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=i,e._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class Sh{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new io(E,16,0),this.grid3D=new io(E,16,0),this.featureIndexArray=new Es,this.promoteId=t}insert(e,t,i,r,n,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n);const a=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const i=t[e],r=[1/0,1/0,-1/0,-1/0];for(let e=0;e<i.length;e++){const t=i[e];r[0]=Math.min(r[0],t.x),r[1]=Math.min(r[1],t.y),r[2]=Math.max(r[2],t.x),r[3]=Math.max(r[3],t.y)}r[0]<E&&r[1]<E&&r[2]>=0&&r[3]>=0&&a.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hc.VectorTile(new Qc(this.rawTileData)).layers,this.sourceLayerCoder=new wh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,i,r){this.loadVTLayers();const n=e.params,o=E/e.tileSize/e.scale,s=cn(n.filter),a=e.queryGeometry,c=e.queryPadding*o,u=Mh(a),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Mh(e.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((t,i,r,n)=>function(e,t,i,r,n){for(const o of e)if(t<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const o=[new l(t,i),new l(t,n),new l(r,n),new l(r,i)];if(e.length>2)for(const t of o)if(Oa(e,t))return!0;for(let t=0;t<e.length-1;t++)if(Fa(e[t],e[t+1],o))return!0;return!1}(e.cameraQueryGeometry,t-c,i-c,r+c,n+c)));for(const e of p)h.push(e);h.sort(kh);const f={};let m;for(let l=0;l<h.length;l++){const c=h[l];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,s,n.layers,n.availableImages,t,i,r,((t,i,r)=>(d||(d=Ta(t)),i.queryIntersectsFeature({queryGeometry:a,feature:t,featureState:r,geometry:d,zoom:this.z,transform:e.transform,pixelsToTileUnits:o,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return f}loadMatchingFeature(e,t,i,r,n,o,s,a,l,c,u){const h=this.bucketLayerIDs[t];if(o&&!h.some((e=>o.has(e))))return;const d=this.sourceLayerCoder.decode(i),p=this.vtLayers[d].feature(r);if(n.needGeometry){const e=Sa(p,!0);if(!n.filter(new Mo(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!n.filter(new Mo(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let t=0;t<h.length;t++){const i=h[t];if(o&&!o.has(i))continue;const n=a[i];if(!n)continue;let d={};f&&c&&(d=c.getState(n.sourceLayer||"_geojsonTileLayer",f));const m=O({},l[i]);m.paint=Ch(m.paint,n.paint,p,d,s),m.layout=Ch(m.layout,n.layout,p,d,s);const g=!u||u(p,n,d);if(!g)continue;const y=new Th(p,this.z,this.x,this.y,f);y.layer=m;let _=e[i];void 0===_&&(_=e[i]=[]),_.push({featureIndex:r,feature:y,intersectionZ:g})}}lookupSymbolFeatures(e,t,i,r,n,o,s,a){const l={};this.loadVTLayers();const c=cn(n);for(const n of e)this.loadMatchingFeature(l,i,r,n,c,o,s,a,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){var i;let r=e.id;return this.promoteId&&(r=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof r&&(r=Number(r)),void 0===r&&(null===(i=e.properties)||void 0===i?void 0:i.cluster)&&this.promoteId&&(r=Number(e.properties.cluster_id))),r}}function Ch(e,t,i,r,n){return j(e,((e,o)=>{const s=t instanceof Do?t.get(o):null;return s&&s.evaluate?s.evaluate(i,r,n):s}))}function Mh(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return{minX:t,minY:i,maxX:r,maxY:n}}function kh(e,t){return t-e}function Eh(e,t,i,r,n){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let c;for(let e=0;e<a.length-1;e++){let s=a[e],u=a[e+1];s.x<t&&u.x<t||(s.x<t?s=new l(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x<t&&(u=new l(t,s.y+(t-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y<i&&u.y<i||(s.y<i?s=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round():u.y<i&&(u=new l(s.x+(i-s.y)/(u.y-s.y)*(u.x-s.x),i)._round()),s.x>=r&&u.x>=r||(s.x>=r?s=new l(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round():u.x>=r&&(u=new l(r,s.y+(r-s.x)/(u.x-s.x)*(u.y-s.y))._round()),s.y>=n&&u.y>=n||(s.y>=n?s=new l(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round():u.y>=n&&(u=new l(s.x+(n-s.y)/(u.y-s.y)*(u.x-s.x),n)._round()),c&&s.equals(c[c.length-1])||(c=[s],o.push(c)),c.push(u)))))}}return o}no("FeatureIndex",Sh,{omit:["rawTileData","sourceLayerCoder"]});class Ah extends l{constructor(e,t,i,r){super(e,t),this.angle=i,void 0!==r&&(this.segment=r)}clone(){return new Ah(this.x,this.y,this.angle,this.segment)}}function Ih(e,t,i,r,n){if(void 0===t.segment||0===i)return!0;let o=t,s=t.segment+1,a=0;for(;a>-i/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<i/2;){const t=e[s],i=e[s+1];if(!i)return!1;let o=e[s-1].angleTo(t)-t.angleTo(i);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;s++,a+=t.dist(i)}return!0}function zh(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Ph(e,t,i){return e?.6*t*i:0}function Lh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Dh(e,t,i,r,n,o){const s=Ph(i,n,o),a=Lh(i,r)*o;let l=0;const c=zh(e)/2;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1],o=r.dist(n);if(l+o>c){const u=(c-l)/o,h=pi.number(r.x,n.x,u),d=pi.number(r.y,n.y,u),p=new Ah(h,d,n.angleTo(r),i);return p._round(),!s||Ih(e,p,a,s,t)?p:void 0}l+=o}}function Rh(e,t,i,r,n,o,s,a,l){const c=Ph(r,o,s),u=Lh(r,n),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Bh(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,i,h,d,!1,l)}function Bh(e,t,i,r,n,o,s,a,l){const c=o/2,u=zh(e);let h=0,d=t-i,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+i<h+f;){d+=i;const g=(d-h)/f,y=pi.number(s.x,a.x,g),_=pi.number(s.y,a.y,g);if(y>=0&&y<l&&_>=0&&_<l&&d-c>=0&&d+c<=u){const i=new Ah(y,_,m,t);i._round(),r&&!Ih(e,i,o,r,n)||p.push(i)}}h+=f}return a||p.length||s||(p=Bh(e,h/2,i,r,n,o,s,!0,l)),p}no("Anchor",Ah);const Oh=su;function Fh(e,t,i,r){const n=[],o=e.image,s=o.pixelRatio,a=o.paddedRect.w-2*Oh,c=o.paddedRect.h-2*Oh;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=o.stretchX||[[0,a]],d=o.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=a-f,y=c-m;let _=0,v=f,x=0,b=m,w=0,T=g,S=0,C=y;if(o.content&&r){const t=o.content,i=t[2]-t[0],r=t[3]-t[1];(o.textFitWidth||o.textFitHeight)&&(u=zu(e)),_=jh(h,0,t[0]),x=jh(d,0,t[1]),v=jh(h,t[0],t[2]),b=jh(d,t[1],t[3]),w=t[0]-_,S=t[1]-x,T=i-v,C=r-b}const M=u.x1,k=u.y1,E=u.x2-M,A=u.y2-k,I=(e,r,n,a)=>{const c=Nh(e.stretch-_,v,E,M),u=Uh(e.fixed-w,T,e.stretch,f),h=Nh(r.stretch-x,b,A,k),d=Uh(r.fixed-S,C,r.stretch,m),p=Nh(n.stretch-_,v,E,M),g=Uh(n.fixed-w,T,n.stretch,f),y=Nh(a.stretch-x,b,A,k),I=Uh(a.fixed-S,C,a.stretch,m),z=new l(c,h),P=new l(p,h),L=new l(p,y),D=new l(c,y),R=new l(u/s,d/s),B=new l(g/s,I/s),O=t*Math.PI/180;if(O){const e=Math.sin(O),t=Math.cos(O),i=[t,-e,e,t];z._matMult(i),P._matMult(i),D._matMult(i),L._matMult(i)}const F=e.stretch+e.fixed,j=r.stretch+r.fixed;return{tl:z,tr:P,bl:D,br:L,tex:{x:o.paddedRect.x+Oh+F,y:o.paddedRect.y+Oh+j,w:n.stretch+n.fixed-F,h:a.stretch+a.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:B,minFontScaleX:T/s/E,minFontScaleY:C/s/A,isSDF:i}};if(r&&(o.stretchX||o.stretchY)){const e=$h(h,g,f),t=$h(d,y,m);for(let i=0;i<e.length-1;i++){const r=e[i],o=e[i+1];for(let e=0;e<t.length-1;e++)n.push(I(r,t[e],o,t[e+1]))}}else n.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:c+1}));return n}function jh(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function $h(e,t,i){const r=[{fixed:-1,stretch:0}];for(const[t,i]of e){const e=r[r.length-1];r.push({fixed:t-e.stretch,stretch:e.stretch}),r.push({fixed:t-e.stretch,stretch:e.stretch+(i-t)})}return r.push({fixed:t+Oh,stretch:i}),r}function Nh(e,t,i,r){return e/t*i+r}function Uh(e,t,i,r){return e-t*i/r}class Vh{constructor(e,t,i,r,n,o,s,a,c,u){var h;if(this.boxStartIndex=e.length,c){let e=o.top,t=o.bottom;const i=o.collisionPadding;i&&(e-=i[1],t+=i[3]);let r=t-e;r>0&&(r=Math.max(10,r),this.circleDiameter=r)}else{const c=(null===(h=o.image)||void 0===h?void 0:h.content)&&(o.image.textFitWidth||o.image.textFitHeight)?zu(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};c.y1=c.y1*s-a[0],c.y2=c.y2*s+a[2],c.x1=c.x1*s-a[3],c.x2=c.x2*s+a[1];const d=o.collisionPadding;if(d&&(c.x1-=d[0]*s,c.y1-=d[1]*s,c.x2+=d[2]*s,c.y2+=d[3]*s),u){const e=new l(c.x1,c.y1),t=new l(c.x2,c.y1),i=new l(c.x1,c.y2),r=new l(c.x2,c.y2),n=u*Math.PI/180;e._rotate(n),t._rotate(n),i._rotate(n),r._rotate(n),c.x1=Math.min(e.x,t.x,i.x,r.x),c.x2=Math.max(e.x,t.x,i.x,r.x),c.y1=Math.min(e.y,t.y,i.y,r.y),c.y2=Math.max(e.y,t.y,i.y,r.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,i,r,n)}this.boxEndIndex=e.length}}class Gh{constructor(e,t){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:i}=this,r=t[e];for(;e>0;){const n=e-1>>1,o=t[n];if(i(r,o)>=0)break;t[e]=o,e=n}t[e]=r}_down(e){const{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let r=1+(e<<1);const o=r+1;if(o<this.length&&i(t[o],t[r])<0&&(r=o),i(t[r],n)>=0)break;t[e]=t[r],e=r}t[e]=n}}function qh(e,t,i=!1){let r=1/0,n=1/0,o=-1/0,s=-1/0;const a=e[0];for(let e=0;e<a.length;e++){const t=a[e];(!e||t.x<r)&&(r=t.x),(!e||t.y<n)&&(n=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>s)&&(s=t.y)}const c=Math.min(o-r,s-n);let u=c/2;const h=new Gh([],Zh);if(0===c)return new l(r,n);for(let t=r;t<o;t+=c)for(let i=n;i<s;i+=c)h.push(new Wh(t+u,i+u,u,e));let d=function(e){let t=0,i=0,r=0;const n=e[0];for(let e=0,o=n.length,s=o-1;e<o;s=e++){const o=n[e],a=n[s],l=o.x*a.y-a.x*o.y;i+=(o.x+a.x)*l,r+=(o.y+a.y)*l,t+=3*l}return new Wh(i/t,r/t,0,e)}(e),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=t||(u=r.h/2,h.push(new Wh(r.p.x-u,r.p.y-u,u,e)),h.push(new Wh(r.p.x+u,r.p.y-u,u,e)),h.push(new Wh(r.p.x-u,r.p.y+u,u,e)),h.push(new Wh(r.p.x+u,r.p.y+u,u,e)),p+=4)}return i&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Zh(e,t){return t.max-e.max}function Wh(e,t,i,r){this.p=new l(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const o=t[n];for(let t=0,n=o.length,s=n-1;t<n;s=t++){const n=o[t],a=o[s];n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(i=!i),r=Math.min(r,Ra(e,n,a))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}var Hh;e.aB=void 0,(Hh=e.aB||(e.aB={}))[Hh.center=1]="center",Hh[Hh.left=2]="left",Hh[Hh.right=3]="right",Hh[Hh.top=4]="top",Hh[Hh.bottom=5]="bottom",Hh[Hh["top-left"]=6]="top-left",Hh[Hh["top-right"]=7]="top-right",Hh[Hh["bottom-left"]=8]="bottom-left",Hh[Hh["bottom-right"]=9]="bottom-right";const Xh=7,Kh=Number.POSITIVE_INFINITY;function Yh(e,t){return t[1]!==Kh?function(e,t,i){let r=0,n=0;switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":n=i-Xh;break;case"bottom-right":case"bottom-left":case"bottom":n=-i+Xh}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,n]}(e,t[0],t[1]):function(e,t){let i=0,r=0;t<0&&(t=0);const n=t/Math.SQRT2;switch(e){case"top-right":case"top-left":r=n-Xh;break;case"bottom-right":case"bottom-left":r=-n+Xh;break;case"bottom":r=-t+Xh;break;case"top":r=t-Xh}switch(e){case"top-right":case"bottom-right":i=-n;break;case"top-left":case"bottom-left":i=n;break;case"left":i=t;break;case"right":i=-t}return[i,r]}(e,t[0])}function Jh(e,t,i){var r;const n=e.layout,o=null===(r=n.get("text-variable-anchor-offset"))||void 0===r?void 0:r.evaluate(t,{},i);if(o){const e=o.values,t=[];for(let i=0;i<e.length;i+=2){const r=t[i]=e[i],n=e[i+1].map((e=>e*Xc));r.startsWith("top")?n[1]-=Xh:r.startsWith("bottom")&&(n[1]+=Xh),t[i+1]=n}return new Rt(t)}const s=n.get("text-variable-anchor");if(s){let r;r=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[n.get("text-radial-offset").evaluate(t,{},i)*Xc,Kh]:n.get("text-offset").evaluate(t,{},i).map((e=>e*Xc));const o=[];for(const e of s)o.push(e,Yh(e,r));return new Rt(o)}return null}function Qh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ed(t,i,r,n,o,s,a,l,c,u,h,d){let p=s.textMaxSize.evaluate(i,{});void 0===p&&(p=a);const f=t.layers[0].layout,m=f.get("icon-offset").evaluate(i,{},h),g=id(r.horizontal),y=a/24,_=t.tilePixelRatio*y,v=t.tilePixelRatio*p/24,x=t.tilePixelRatio*l,b=t.tilePixelRatio*f.get("symbol-spacing"),w=f.get("text-padding")*t.tilePixelRatio,T=function(e,t,i,r=1){const n=e.get("icon-padding").evaluate(t,{},i),o=n&&n.values;return[o[0]*r,o[1]*r,o[2]*r,o[3]*r]}(f,i,h,t.tilePixelRatio),S=f.get("text-max-angle")/180*Math.PI,C="viewport"!==f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),M="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),k=f.get("symbol-placement"),A=b/2,I=f.get("icon-text-fit");let z;n&&"none"!==I&&(t.allowVerticalPlacement&&r.vertical&&(z=Pu(n,r.vertical,I,f.get("icon-text-fit-padding"),m,y)),g&&(n=Pu(n,g,I,f.get("icon-text-fit-padding"),m,y)));const P=h?d.line.getGranularityForZoomLevel(h.z):1,L=(l,d)=>{d.x<0||d.x>=E||d.y<0||d.y>=E||function(t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x,b,w,T,S,C){const M=t.addToLineVertexArray(i,r);let k,E,A,I,z=0,P=0,L=0,D=0,R=-1,B=-1;const O={};let F=ta("");if(t.allowVerticalPlacement&&n.vertical){const e=l.layout.get("text-rotate").evaluate(b,{},S)+90;A=new Vh(c,i,u,h,d,n.vertical,p,f,m,e),a&&(I=new Vh(c,i,u,h,d,a,y,_,m,e))}if(o){const r=l.layout.get("icon-rotate").evaluate(b,{}),n="none"!==l.layout.get("icon-text-fit"),s=Fh(o,r,T,n),p=a?Fh(a,r,T,n):void 0;E=new Vh(c,i,u,h,d,o,y,_,!1,r),z=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[Du*l.layout.get("icon-size").evaluate(b,{})],m[0]>Ru&&V(`${t.layerIds[0]}: Value for "icon-size" is >= ${Lu}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Du*w.compositeIconSizes[0].evaluate(b,{},S),Du*w.compositeIconSizes[1].evaluate(b,{},S)],(m[0]>Ru||m[1]>Ru)&&V(`${t.layerIds[0]}: Value for "icon-size" is >= ${Lu}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,x,v,b,e.al.none,i,M.lineStartIndex,M.lineLength,-1,S),R=t.icon.placedSymbolArray.length-1,p&&(P=4*p.length,t.addSymbols(t.icon,p,m,x,v,b,e.al.vertical,i,M.lineStartIndex,M.lineLength,-1,S),B=t.icon.placedSymbolArray.length-1)}const j=Object.keys(n.horizontal);for(const r of j){const o=n.horizontal[r];if(!k){F=ta(o.text);const e=l.layout.get("text-rotate").evaluate(b,{},S);k=new Vh(c,i,u,h,d,o,p,f,m,e)}const a=1===o.positionedLines.length;if(L+=td(t,i,o,s,l,m,b,g,M,n.vertical?e.al.horizontal:e.al.horizontalOnly,a?j:[r],O,R,w,S),a)break}n.vertical&&(D+=td(t,i,n.vertical,s,l,m,b,g,M,e.al.vertical,["vertical"],O,B,w,S));const $=k?k.boxStartIndex:t.collisionBoxArray.length,N=k?k.boxEndIndex:t.collisionBoxArray.length,U=A?A.boxStartIndex:t.collisionBoxArray.length,G=A?A.boxEndIndex:t.collisionBoxArray.length,q=E?E.boxStartIndex:t.collisionBoxArray.length,Z=E?E.boxEndIndex:t.collisionBoxArray.length,W=I?I.boxStartIndex:t.collisionBoxArray.length,H=I?I.boxEndIndex:t.collisionBoxArray.length;let X=-1;const K=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;X=K(k,X),X=K(A,X),X=K(E,X),X=K(I,X);const Y=X>-1?1:0;Y&&(X*=C/Xc),t.glyphOffsetArray.length>=qu.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey);const J=Jh(l,b,S),[Q,ee]=function(t,i){const r=t.length,n=null==i?void 0:i.values;if((null==n?void 0:n.length)>0)for(let i=0;i<n.length;i+=2){const r=n[i+1];t.emplaceBack(e.aB[n[i]],r[0],r[1])}return[r,t.length]}(t.textAnchorOffsets,J);t.symbolInstances.emplaceBack(i.x,i.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,R,B,F,$,N,U,G,q,Z,W,H,u,L,D,z,P,Y,0,p,X,Q,ee)}(t,d,l,r,n,o,z,t.layers[0],t.collisionBoxArray,i.index,i.sourceLayerIndex,t.index,_,[w,w,w,w],C,c,x,T,M,m,i,s,u,h,a)};if("line"===k)for(const e of Eh(i.geometry,0,0,E,E)){const i=Ul(e,P),o=Rh(i,b,S,r.vertical||g,n,24,v,t.overscaling,E);for(const e of o)g&&rd(t,g.text,A,e)||L(i,e)}else if("line-center"===k){for(const e of i.geometry)if(e.length>1){const t=Ul(e,P),i=Dh(t,S,r.vertical||g,n,24,v);i&&L(t,i)}}else if("Polygon"===i.type)for(const e of Ji(i.geometry,0)){const t=qh(e,16);L(Ul(e[0],P,!0),new Ah(t.x,t.y,0))}else if("LineString"===i.type)for(const e of i.geometry){const t=Ul(e,P);L(t,new Ah(t[0].x,t[0].y,0))}else if("Point"===i.type)for(const e of i.geometry)for(const t of e)L([t],new Ah(t.x,t.y,0))}function td(e,t,i,r,n,o,s,a,c,u,h,d,p,f,m){const g=function(e,t,i,r,n,o,s,a){const c=r.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=[];for(const e of t.positionedLines)for(const r of e.positionedGlyphs){if(!r.rect)continue;const o=r.rect||{};let h=nu+1,d=!0,p=1,f=0;const m=(n||a)&&r.vertical,g=r.metrics.advance*r.scale/2;if(a&&t.verticalizable&&(f=e.lineOffset/2-(r.imageName?-(Xc-r.metrics.width*r.scale)/2:(r.scale-1)*Xc)),r.imageName){const e=s[r.imageName];d=e.sdf,p=e.pixelRatio,h=su/p}const y=n?[r.x+g,r.y]:[0,0];let _=n?[0,0]:[r.x+g+i[0],r.y+i[1]-f],v=[0,0];m&&(v=_,_=[0,0]);const x=r.metrics.isDoubleResolution?2:1,b=(r.metrics.left-h)*r.scale-g+_[0],w=(-r.metrics.top-h)*r.scale+_[1],T=b+o.w/x*r.scale/p,S=w+o.h/x*r.scale/p,C=new l(b,w),M=new l(T,w),k=new l(b,S),E=new l(T,S);if(m){const e=new l(-g,g-uu),t=-Math.PI/2,i=Xc/2-g,n=new l(5-uu-i,-(r.imageName?i:0)),o=new l(...v);C._rotateAround(t,e)._add(n)._add(o),M._rotateAround(t,e)._add(n)._add(o),k._rotateAround(t,e)._add(n)._add(o),E._rotateAround(t,e)._add(n)._add(o)}if(c){const e=Math.sin(c),t=Math.cos(c),i=[t,-e,e,t];C._matMult(i),M._matMult(i),k._matMult(i),E._matMult(i)}const A=new l(0,0),I=new l(0,0);u.push({tl:C,tr:M,bl:k,br:E,tex:o,writingMode:t.writingMode,glyphOffset:y,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:A,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}return u}(0,i,a,n,o,s,r,e.allowVerticalPlacement),y=e.textSizeData;let _=null;"source"===y.kind?(_=[Du*n.layout.get("text-size").evaluate(s,{})],_[0]>Ru&&V(`${e.layerIds[0]}: Value for "text-size" is >= ${Lu}. Reduce your "text-size".`)):"composite"===y.kind&&(_=[Du*f.compositeTextSizes[0].evaluate(s,{},m),Du*f.compositeTextSizes[1].evaluate(s,{},m)],(_[0]>Ru||_[1]>Ru)&&V(`${e.layerIds[0]}: Value for "text-size" is >= ${Lu}. Reduce your "text-size".`)),e.addSymbols(e.text,g,_,a,o,s,u,t,c.lineStartIndex,c.lineLength,p,m);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*g.length}function id(e){for(const t in e)return e[t];return null}function rd(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}const nd=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class od{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error(`Got v${r} data when expected v1.`);const n=nd[15&i];if(!n)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new od(s,o,n,e)}constructor(e,t=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=nd.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(n<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return sd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:o,nodeSize:s}=this,a=[0,n.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=i&&c>=t&&c<=r&&l.push(n[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=i&&f>=t&&f<=r&&l.push(n[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?i>=p:r>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:o}=this,s=[0,r.length-1,0],a=[],l=i*i;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let i=h;i<=u;i++)ud(n[2*i],n[2*i+1],e,t)<=l&&a.push(r[i]);continue}const d=h+u>>1,p=n[2*d],f=n[2*d+1];ud(p,f,e,t)<=l&&a.push(r[d]),(0===c?e-i<=p:t-i<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function sd(e,t,i,r,n,o){if(n-r<=i)return;const s=r+n>>1;ad(e,t,s,r,n,o),sd(e,t,i,r,s-1,1-o),sd(e,t,i,s+1,n,1-o)}function ad(e,t,i,r,n,o){for(;n>r;){if(n-r>600){const s=n-r+1,a=i-r+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);ad(e,t,i,Math.max(r,Math.floor(i-a*c/s+u)),Math.min(n,Math.floor(i+(s-a)*c/s+u)),o)}const s=t[2*i+o];let a=r,l=n;for(ld(e,t,r,i),t[2*n+o]>s&&ld(e,t,r,n);a<l;){for(ld(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*r+o]===s?ld(e,t,r,l):(l++,ld(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function ld(e,t,i,r){cd(e,i,r),cd(t,2*i,2*r),cd(t,2*i+1,2*r+1)}function cd(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function ud(e,t,i,r){const n=e-i,o=t-r;return n*n+o*o}var hd;e.co=void 0,(hd=e.co||(e.co={})).create="create",hd.load="load",hd.fullLoad="fullLoad";let dd=null,pd=[];const fd=1e3/60,md="loadTime",gd="fullLoadTime",yd={mark(e){performance.mark(e)},frame(e){const t=e;null!=dd&&pd.push(t-dd),dd=t},clearMetrics(){dd=null,pd=[],performance.clearMeasures(md),performance.clearMeasures(gd);for(const t in e.co)performance.clearMarks(e.co[t])},getPerformanceMetrics(){performance.measure(md,e.co.create,e.co.load),performance.measure(gd,e.co.create,e.co.fullLoad);const t=performance.getEntriesByName(md)[0].duration,i=performance.getEntriesByName(gd)[0].duration,r=pd.length,n=1/(pd.reduce(((e,t)=>e+t),0)/r/1e3),o=pd.filter((e=>e>fd)).reduce(((e,t)=>e+(t-fd)/fd),0);return{loadTime:t,fullLoadTime:i,fps:n,percentDroppedFrames:o/(r+o)*100,totalFrames:r}}};e.$=mh,e.A=g,e.B=pi,e.C=Mo,e.D=Ro,e.E=ge,e.F=Jn,e.G=function(e){if(null==Z){const t=e.navigator?e.navigator.userAgent:null;Z=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Z},e.H=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new nh((()=>this.process())),this.subscription=J(this.target,"message",(e=>this.receive(e)),!1),this.globalScope=q(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(e,t){return new Promise(((i,r)=>{const n=Math.round(1e18*Math.random()).toString(36).substring(0,10),o=t?J(t.signal,"abort",(()=>{null==o||o.unsubscribe(),delete this.resolveRejects[n];const t={id:n,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)}),oh):null;this.resolveRejects[n]={resolve:e=>{null==o||o.unsubscribe(),i(e)},reject:e=>{null==o||o.unsubscribe(),r(e)}};const s=[],a=Object.assign(Object.assign({},e),{id:n,sourceMapId:this.mapId,origin:location.origin,data:lo(e.data,s)});this.target.postMessage(a,{transfer:s})}))}receive(e){const t=e.data,i=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&"resource://android"!==t.origin&&"resource://android"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[i];const e=this.abortControllers[i];return delete this.abortControllers[i],void(e&&e.abort())}if(q(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,i){return t(this,void 0,void 0,(function*(){if("<response>"===i.type){const t=this.resolveRejects[e];if(delete this.resolveRejects[e],!t)return;return void(i.error?t.reject(co(i.error)):t.resolve(co(i.data)))}if(!this.messageHandlers[i.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const t=co(i.data),r=new AbortController;this.abortControllers[e]=r;try{const n=yield this.messageHandlers[i.type](i.sourceMapId,t,r);this.completeTask(e,null,n)}catch(t){this.completeTask(e,t)}}))}completeTask(e,t,i){const r=[];delete this.abortControllers[e];const n={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?lo(t):null,data:lo(i,r)};this.target.postMessage(n,{transfer:r})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.I=au,e.J=ae,e.K=function(){var e=new g(16);return g!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.L=function(e,t,i){var r,n,o,s,a,l,c,u,h,d,p,f,m=i[0],g=i[1],y=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+a*g+h*y+t[12],e[13]=n*m+l*g+d*y+t[13],e[14]=o*m+c*g+p*y+t[14],e[15]=s*m+u*g+f*y+t[15]),e},e.M=function(e,t,i){var r=i[0],n=i[1],o=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.N=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*r+x*a+b*h+w*m,e[1]=v*n+x*l+b*d+w*g,e[2]=v*o+x*c+b*p+w*y,e[3]=v*s+x*u+b*f+w*_,e[4]=(v=i[4])*r+(x=i[5])*a+(b=i[6])*h+(w=i[7])*m,e[5]=v*n+x*l+b*d+w*g,e[6]=v*o+x*c+b*p+w*y,e[7]=v*s+x*u+b*f+w*_,e[8]=(v=i[8])*r+(x=i[9])*a+(b=i[10])*h+(w=i[11])*m,e[9]=v*n+x*l+b*d+w*g,e[10]=v*o+x*c+b*p+w*y,e[11]=v*s+x*u+b*f+w*_,e[12]=(v=i[12])*r+(x=i[13])*a+(b=i[14])*h+(w=i[15])*m,e[13]=v*n+x*l+b*d+w*g,e[14]=v*o+x*c+b*p+w*y,e[15]=v*s+x*u+b*f+w*_,e},e.O=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.P=l,e.Q=ah,e.R=el,e.S=hh,e.T=Ao,e.U=uh,e.V=p,e.W=f,e.X=X,e.Y=vh,e.Z=E,e._=t,e.a=oe,e.a$=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*r,e[5]=s*n+u*r,e[6]=a*n+h*r,e[7]=l*n+d*r,e[8]=c*n-o*r,e[9]=u*n-s*r,e[10]=h*n-a*r,e[11]=d*n-l*r,e},e.a0=25,e.a1=yh,e.a2=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((i=>{t.onloadstart=()=>{i(t)};for(const i of e){const e=window.document.createElement("source");he(i)||(t.crossOrigin="Anonymous"),e.src=i,t.appendChild(e)}}))},e.a3=Ae,e.a4=function(){return F++},e.a5=_s,e.a6=qu,e.a7=cn,e.a8=Sa,e.a9=Th,e.aA=function(e,t,i,r,n=!1){if(!i[0]&&!i[1])return[0,0];const o=n?"map"===r?-e.bearingInRadians:0:"viewport"===r?e.bearingInRadians:0;if(o){const e=Math.sin(o),t=Math.cos(o);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}return[n?i[0]:A(t,i[0],e.zoom),n?i[1]:A(t,i[1],e.zoom)]},e.aC=Ou,e.aD=Qh,e.aE=Tu,e.aF=od,e.aG=Zo,e.aH=Ol,e.aI=As,e.aJ=qs,e.aK=Ns,e.aL=B,e.aM=ee,e.aN=fh,e.aO=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},e.aP=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},e.aQ=function(e){var t=new g(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.aR=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e},e.aS=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},e.aT=function(e,t){var i=t[0],r=t[1],n=t[2],o=i*i+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},e.aU=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[0],a=i[1],l=i[2];return e[0]=n*l-o*a,e[1]=o*s-r*l,e[2]=r*a-n*s,e},e.aV=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.aW=_h,e.aX=xh,e.aY=function(e,t,i,r,n){var o,s=1/Math.tan(t/2);return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(o=1/(r-n)),e[14]=2*n*r*o):(e[10]=-1,e[14]=-2*r),e},e.aZ=function(e){var t=new g(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.a_=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*r,e[1]=s*n+u*r,e[2]=a*n+h*r,e[3]=l*n+d*r,e[4]=c*n-o*r,e[5]=u*n-s*r,e[6]=h*n-a*r,e[7]=d*n-l*r,e},e.aa=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const o=r||n;return t[i]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ab=Q,e.ac=function(e){return Math.pow(2,e)},e.ad=_,e.ae=R,e.af=85.051129,e.ag=dh,e.ah=function(e){return Math.log(e)/Math.LN2},e.ai=function(e){var t=e[0],i=e[1];return t*t+i*i},e.aj=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i},e.ak=function(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:o,maxZoom:s}=e,a=n?R(hi.interpolationFactor(n,t,o,s),0,1):0;"camera"===e.kind?r=pi.number(e.minSize,e.maxSize,a):i=a}return{uSizeT:i,uSize:r}},e.am=function(e,{uSize:t,uSizeT:i},{lowerSize:r,upperSize:n}){return"source"===e.kind?r/Du:"composite"===e.kind?pi.number(r/Du,n/Du,i):t},e.an=function(e,t){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=i*a-r*s,v=i*l-n*s,x=i*c-o*s,b=r*l-n*a,w=r*c-o*a,T=n*c-o*l,S=u*m-h*f,C=u*g-d*f,M=u*y-p*f,k=h*g-d*m,E=h*y-p*m,A=d*y-p*g,I=_*A-v*E+x*k+b*M-w*C+T*S;return I?(e[0]=(a*A-l*E+c*k)*(I=1/I),e[1]=(n*E-r*A-o*k)*I,e[2]=(m*T-g*w+y*b)*I,e[3]=(d*w-h*T-p*b)*I,e[4]=(l*M-s*A-c*C)*I,e[5]=(i*A-n*M+o*C)*I,e[6]=(g*x-f*T-y*v)*I,e[7]=(u*T-d*x+p*v)*I,e[8]=(s*E-a*M+c*S)*I,e[9]=(r*M-i*E-o*S)*I,e[10]=(f*w-m*x+y*_)*I,e[11]=(h*x-u*w-p*_)*I,e[12]=(a*C-s*k-l*S)*I,e[13]=(i*k-r*C+n*S)*I,e[14]=(m*v-f*b-g*_)*I,e[15]=(u*b-h*v+d*_)*I,e):null},e.ao=M,e.ap=function(e){return Math.hypot(e[0],e[1])},e.aq=function(e){return e[0]=0,e[1]=0,e},e.ar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},e.as=Nu,e.at=S,e.au=function(e,t,i,r){const n=t.y-e.y,o=t.x-e.x,s=r.y-i.y,a=r.x-i.x,c=s*o-a*n;if(0===c)return null;const u=(a*(e.y-i.y)-s*(e.x-i.x))/c;return new l(e.x+u*o,e.y+u*n)},e.av=Eh,e.aw=Ea,e.ax=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const o of e)t=Math.min(t,o.x),i=Math.min(i,o.y),r=Math.max(r,o.x),n=Math.max(n,o.y);return[t,i,r,n]},e.ay=Xc,e.az=A,e.b=W,e.b$=class extends ms{},e.b0=function(){const e=new Float32Array(16);return _(e),e},e.b1=function(){const e=new Float64Array(16);return _(e),e},e.b2=function(){return new Float64Array(16)},e.b3=function(e,t,i){const r=new Float64Array(4);return function(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);e[0]=o*l*u-s*a*c,e[1]=s*a*u+o*l*c,e[2]=s*l*c-o*a*u,e[3]=s*l*u+o*a*c}(r,e,t-90,i),r},e.b4=function(e,t,i,r){var n,o,s,a,l,c=t[0],u=t[1],h=t[2],d=t[3],p=i[0],f=i[1],g=i[2],y=i[3];return(o=c*p+u*f+h*g+d*y)<0&&(o=-o,p=-p,f=-f,g=-g,y=-y),1-o>m?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(a=1-r,l=r),e[0]=a*c+l*p,e[1]=a*u+l*f,e[2]=a*h+l*g,e[3]=a*d+l*y,e},e.b5=function(e){const t=new Float64Array(9);var i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v;h=(n=(r=e)[0])*(l=n+n),d=(o=r[1])*l,f=(s=r[2])*l,m=s*(c=o+o),y=(a=r[3])*l,_=a*c,v=a*(u=s+s),(i=t)[0]=1-(p=o*c)-(g=s*u),i[3]=d-v,i[6]=f+_,i[1]=d+v,i[4]=1-h-g,i[7]=m-y,i[2]=f-_,i[5]=m+y,i[8]=1-h-p;const x=ee(-Math.asin(R(t[2],-1,1)));let b,w;return Math.hypot(t[5],t[8])<.001?(b=0,w=-ee(Math.atan2(t[3],t[4]))):(b=ee(0===t[5]&&0===t[8]?0:Math.atan2(t[5],t[8])),w=ee(0===t[1]&&0===t[0]?0:Math.atan2(t[1],t[0]))),{roll:b,pitch:x+90,bearing:w}},e.b6=function(e,t){return e.roll==t.roll&&e.pitch==t.pitch&&e.bearing==t.bearing},e.b7=Ct,e.b8=aa,e.b9=Fl,e.bA=function(e){if("custom"===e.type)return new rh(e);switch(e.type){case"background":return new Qu(e);case"circle":return new qa(e);case"fill":return new Kl(e);case"fill-extrusion":return new bc(e);case"heatmap":return new rl(e);case"hillshade":return new sl(e);case"line":return new Oc(e);case"raster":return new ih(e);case"symbol":return new Ku(e)}},e.bB=N,e.bC=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let i=[];try{if(!xe(e.version,t.version))return[{command:"setStyle",args:[t]}];xe(e.center,t.center)||i.push({command:"setCenter",args:[t.center]}),xe(e.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),xe(e.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),xe(e.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),xe(e.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),xe(e.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),xe(e.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),xe(e.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),xe(e.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),xe(e.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),xe(e.light,t.light)||i.push({command:"setLight",args:[t.light]}),xe(e.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),xe(e.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),xe(e.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const r={},n=[];!function(e,t,i,r){let n;for(n in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(t,n)||Te(n,i,r));for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?xe(e[n],t[n])||("geojson"===e[n].type&&"geojson"===t[n].type&&Ce(e,t,n)?be(i,{command:"setGeoJSONSourceData",args:[n,t[n].data]}):Se(n,t,i,r)):we(n,t,i))}(e.sources,t.sources,n,r);const o=[];e.layers&&e.layers.forEach((e=>{"source"in e&&r[e.source]?i.push({command:"removeLayer",args:[e.id]}):o.push(e)})),i=i.concat(n),function(e,t,i){t=t||[];const r=(e=e||[]).map(ke),n=t.map(ke),o=e.reduce(Ee,{}),s=t.reduce(Ee,{}),a=r.slice(),l=Object.create(null);let c,u,h,d,p;for(let e=0,t=0;e<r.length;e++)c=r[e],Object.prototype.hasOwnProperty.call(s,c)?t++:(be(i,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,t),1));for(let e=0,t=0;e<n.length;e++)c=n[n.length-1-e],a[a.length-1-e]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(be(i,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-t),1)):t++,d=a[a.length-e],be(i,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-e,0,c),l[c]=!0);for(let e=0;e<n.length;e++)if(c=n[e],u=o[c],h=s[c],!l[c]&&!xe(u,h))if(xe(u.source,h.source)&&xe(u["source-layer"],h["source-layer"])&&xe(u.type,h.type)){for(p in Me(u.layout,h.layout,i,c,null,"setLayoutProperty"),Me(u.paint,h.paint,i,c,null,"setPaintProperty"),xe(u.filter,h.filter)||be(i,{command:"setFilter",args:[c,h.filter]}),xe(u.minzoom,h.minzoom)&&xe(u.maxzoom,h.maxzoom)||be(i,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Me(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):xe(u[p],h[p])||be(i,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?Me(u[p],h[p],i,c,p.slice(6),"setPaintProperty"):xe(u[p],h[p])||be(i,{command:"setLayerProperty",args:[c,p,h[p]]}))}else be(i,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],be(i,{command:"addLayer",args:[h,d]})}(o,t.layers,i)}catch(e){console.warn("Unable to compute style diff:",e),i=[{command:"setStyle",args:[t]}]}return i},e.bD=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:`layers.${i}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},e.bE=function e(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],i[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const r in t)if(!e(t[r],i[r]))return!1;return!0}return t===i},e.bF=j,e.bG=$,e.bH=class extends sa{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.bI=ca,e.bJ=class extends sa{constructor(e,t){super(e,t),this.current=ua}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.bK=la,e.bL=class extends sa{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.bM=class extends sa{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.bN=y,e.bO=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.bP=function(e,t,i){var r=t[0],n=t[1],o=t[2];return e[0]=r*i[0]+n*i[3]+o*i[6],e[1]=r*i[1]+n*i[4]+o*i[7],e[2]=r*i[2]+n*i[5]+o*i[8],e},e.bQ=function(e,t,i,r,n,o,s){var a=1/(t-i),l=1/(r-n),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(n+r)*l,e[14]=(s+o)*c,e[15]=1,e},e.bR=class extends sa{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(4*e.length);for(let i=0;i<e.length;i++)t[4*i]=e[i].r,t[4*i+1]=e[i].g,t[4*i+2]=e[i].b,t[4*i+3]=e[i].a;this.gl.uniform4fv(this.location,t)}}},e.bS=class extends sa{constructor(e,t){super(e,t),this.current=new Array}set(e){if(e!=this.current){this.current=e;const t=new Float32Array(e);this.gl.uniform1fv(this.location,t)}}},e.bT=class extends ss{},e.bU=Vc,e.bV=class extends ls{},e.bW=il,e.bX=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.bY=tl,e.bZ=function(e,t,i){var r=t[0],n=t[1],o=t[2],s=i[3]*r+i[7]*n+i[11]*o+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*o+i[12])/(s=s||1),e[1]=(i[1]*r+i[5]*n+i[9]*o+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*o+i[14])/s,e},e.b_=class extends Ko{},e.ba=jl,e.bb=Bl,e.bc=z,e.bd=P,e.be=Ot,e.bf=function(e,t,i,r,n){return z(r,n,R((e-t)/(i-t),0,1))},e.bg=I,e.bh=function(){return new Float64Array(3)},e.bi=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},e.bj=T,e.bk=function(){return new Float64Array(4)},e.bl=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bm=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bn=function(e,t,i,r){var n=[],o=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=o[0]+i[0],e[1]=o[1]+i[1],e[2]=o[2]+i[2],e},e.bo=x,e.bp=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*r,e[1]=s*n-u*r,e[2]=a*n-h*r,e[3]=l*n-d*r,e[8]=o*r+c*n,e[9]=s*r+u*n,e[10]=a*r+h*n,e[11]=l*r+d*n,e},e.bq=function(e,t){const i=I(e,360),r=I(t,360),n=r-i,o=r>i?n-360:n+360;return Math.abs(n)<Math.abs(o)?n:o},e.br=function(e){return e[0]=0,e[1]=0,e[2]=0,e},e.bs=function(e,t,i,r){const n=Math.sqrt(e*e+t*t),o=Math.sqrt(i*i+r*r);e/=n,t/=n,i/=o,r/=o;const s=Math.acos(e*i+t*r);return-t*i+e*r>0?s:-s},e.bt=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},e.bu=sh,e.bv=function(e,t){const i=I(e,2*Math.PI),r=I(t,2*Math.PI);return Math.min(Math.abs(i-r),Math.abs(i-r+2*Math.PI),Math.abs(i-r-2*Math.PI))},e.bw=function(){const e={},t=ye.$version;for(const i in ye.$root){const r=ye.$root[i];if(r.required){let n=null;n="version"===i?t:"array"===r.type?[]:{},null!=n&&(e[i]=n)}}return e},e.bx=uo,e.by=ce,e.bz=function(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=ve(e[i],t[e[i].ref]));return e},e.c=ne,e.c0=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.c1=function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],g=e[13],y=e[14],_=e[15],v=t[0],x=t[1],b=t[2],w=t[3],T=t[4],S=t[5],C=t[6],M=t[7],k=t[8],E=t[9],A=t[10],I=t[11],z=t[12],P=t[13],L=t[14],D=t[15];return Math.abs(i-v)<=m*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-x)<=m*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-b)<=m*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(o-w)<=m*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-T)<=m*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(a-S)<=m*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-C)<=m*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-M)<=m*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-k)<=m*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(h-E)<=m*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(d-A)<=m*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-I)<=m*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-z)<=m*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(g-P)<=m*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(y-L)<=m*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(_-D)<=m*Math.max(1,Math.abs(_),Math.abs(D))},e.c2=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.c3=e=>"symbol"===e.type,e.c4=e=>"circle"===e.type,e.c5=e=>"heatmap"===e.type,e.c6=e=>"line"===e.type,e.c7=e=>"fill"===e.type,e.c8=e=>"fill-extrusion"===e.type,e.c9=e=>"hillshade"===e.type,e.cA=Zl,e.cB=mc,e.cC=hc,e.cD=Qc,e.cE=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.cF=function(e,i,r,n,o){return t(this,void 0,void 0,(function*(){if(f())try{return yield X(e,i,r,n,o)}catch(e){}return function(e,t,i,r,n){const o=e.width,s=e.height;K&&Y||(K=new OffscreenCanvas(o,s),Y=K.getContext("2d",{willReadFrequently:!0})),K.width=o,K.height=s,Y.drawImage(e,0,0,o,s);const a=Y.getImageData(t,i,r,n);return Y.clearRect(0,0,o,s),a.data}(e,i,r,n,o)}))},e.cG=bh,e.cH=i,e.cI=o,e.cJ=uc,e.cK=Jc,e.cL=en,e.cM=Co,e.ca=e=>"raster"===e.type,e.cb=e=>"background"===e.type,e.cc=e=>"custom"===e.type,e.cd=L,e.ce=function(e,t,i){const r=k(t.x-i.x,t.y-i.y),n=k(e.x-i.x,e.y-i.y);var o,s;return ee(Math.atan2(r[0]*n[1]-r[1]*n[0],(o=r)[0]*(s=n)[0]+o[1]*s[1]))},e.cf=D,e.cg=function(e,t){return ie[t]&&(e instanceof MouseEvent||e instanceof WheelEvent)},e.ch=function(e,t){return te[t]&&"touches"in e},e.ci=function(e){return te[e]||ie[e]},e.cj=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},e.ck=function(e,t){const{x:i,y:r}=mh.fromLngLat(t);return!(e<0||e>25||r<0||r>=1||i<0||i>=1)},e.cl=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.cm=class extends Xo{},e.cn=yd,e.cp=function(e){return e.message===re},e.cq=le,e.cr=function(e,t){oe.REGISTERED_PROTOCOLS[e]=t},e.cs=function(e){delete oe.REGISTERED_PROTOCOLS[e]},e.ct=function(e,t){const i={};for(let r=0;r<e.length;r++){const n=t&&t[e[r].id]||_n(e[r]);t&&(t[e[r].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(e[r])}const r=[];for(const e in i)r.push(i[e]);return r},e.cu=no,e.cv=wh,e.cw=Sh,e.cx=lu,e.cy=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=E/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const i=t.bucket.layers[0],r=i.layout,n=i._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new Mo(t.bucket.zoom+1),t.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Mo(t.bucket.zoom+1),t.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Mo(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Mo(e),t.canonical),n["text-size"].possiblyEvaluate(new Mo(i),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Mo(e),t.canonical),n["icon-size"].possiblyEvaluate(new Mo(i),t.canonical)]}const s=r.get("text-line-height")*Xc,a="viewport"!==r.get("text-rotation-alignment")&&"point"!==r.get("symbol-placement"),l=r.get("text-keep-upright"),c=r.get("text-size");for(const n of t.bucket.features){const u=r.get("text-font").evaluate(n,{},t.canonical).join(","),h=c.evaluate(n,{},t.canonical),d=o.layoutTextSize.evaluate(n,{},t.canonical),p=o.layoutIconSize.evaluate(n,{},t.canonical),f={horizontal:{},vertical:void 0},m=n.text;let g,y=[0,0];if(m){const o=m.toString(),c=r.get("text-letter-spacing").evaluate(n,{},t.canonical)*Xc,p=fo(o)?c:0,g=r.get("text-anchor").evaluate(n,{},t.canonical),_=Jh(i,n,t.canonical);if(!_){const e=r.get("text-radial-offset").evaluate(n,{},t.canonical);y=e?Yh(g,[e*Xc,Kh]):r.get("text-offset").evaluate(n,{},t.canonical).map((e=>e*Xc))}let v=a?"center":r.get("text-justify").evaluate(n,{},t.canonical);const x="point"===r.get("symbol-placement")?r.get("text-max-width").evaluate(n,{},t.canonical)*Xc:1/0,b=()=>{t.bucket.allowVerticalPlacement&&po(o)&&(f.vertical=pu(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,"left",p,y,e.al.vertical,!0,d,h))};if(!a&&_){const i=new Set;if("auto"===v)for(let e=0;e<_.values.length;e+=2)i.add(Qh(_.values[e]));else i.add(v);let r=!1;for(const n of i)if(!f.horizontal[n])if(r)f.horizontal[n]=f.horizontal[0];else{const i=pu(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,"center",n,p,y,e.al.horizontal,!1,d,h);i&&(f.horizontal[n]=i,r=1===i.positionedLines.length)}b()}else{"auto"===v&&(v=Qh(g));const i=pu(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,v,p,y,e.al.horizontal,!1,d,h);i&&(f.horizontal[v]=i),b(),po(o)&&a&&l&&(f.vertical=pu(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,v,p,y,e.al.vertical,!1,d,h))}}let _=!1;if(n.icon&&n.icon.name){const e=t.imageMap[n.icon.name];e&&(g=Iu(t.imagePositions[n.icon.name],r.get("icon-offset").evaluate(n,{},t.canonical),r.get("icon-anchor").evaluate(n,{},t.canonical)),_=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=_:t.bucket.sdfIcons!==_&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==r.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const v=id(f.horizontal)||f.vertical;t.bucket.iconsInText=!!v&&v.iconsInText,(v||g)&&ed(t.bucket,n,f,g,t.imageMap,o,d,p,y,_,t.canonical,t.subdivisionGranularity)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.cz=zc,e.d=he,e.e=O,e.f=e=>t(void 0,void 0,void 0,(function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(e){throw new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),e.g=se,e.h=e=>new Promise(((t,i)=>{const r=new Image;r.onload=()=>{t(r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame((()=>{r.src=H}))},r.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(n):H})),e.i=q,e.j=(e,t)=>ue(O(e,{type:"json"}),t),e.k=me,e.l=fe,e.m=ue,e.n=(e,t)=>ue(O(e,{type:"arrayBuffer"}),t),e.o=function(e){return new Qc(e).readFields(tu,[])},e.p=ou,e.q=Qa,e.r=$o,e.s=J,e.t=Yn,e.u=ho,e.v=ye,e.w=V,e.x=to,e.y=Kn,e.z=function([e,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(i),y:e*Math.sin(t)*Math.sin(i),z:e*Math.cos(i)}}})),i("worker",["./shared"],(function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,i){for(const i of t){this._layerConfigs[i.id]=i;const t=this._layers[i.id]=e.bA(i);t._featureFilter=e.a7(t.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=e.ct(Object.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const o=i.sourceLayer||"_geojsonTileLayer";let s=n[o];s||(s=n[o]=[]),s.push(t)}}}class i{constructor(t){const i={},r=[];for(const e in t){const n=t[e],o=i[e]={};for(const e in n){const t=n[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};r.push(i),o[e]={rect:i,metrics:t.metrics}}}const{w:n,h:o}=e.p(r),s=new e.q({width:n||1,height:o||1});for(const r in t){const n=t[r];for(const t in n){const o=n[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=i[r][t].rect;e.q.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=i}}e.cu("GlyphAtlas",i);class r{constructor(t){this.tileID=new e.Y(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[]}parse(t,r,o,s,a){return e._(this,void 0,void 0,(function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.a5;const l=new e.cv(Object.keys(t.layers).sort()),c=new e.cw(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},h={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o,subdivisionGranularity:a},d=r.familiesBySource[this.source];for(const i in d){const r=t.layers[i];if(!r)continue;1===r.version&&e.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=l.encode(i),a=[];for(let e=0;e<r.length;e++){const t=r.feature(e),n=c.getId(t,i);a.push({feature:t,id:n,index:e,sourceLayerIndex:s})}for(const t of d[i]){const i=t[0];i.source!==this.source&&e.w(`layer.source = ${i.source} does not equal this.source = ${this.source}`),i.minzoom&&this.zoom<Math.floor(i.minzoom)||i.maxzoom&&this.zoom>=i.maxzoom||"none"!==i.visibility&&(n(t,this.zoom,o),(u[i.id]=i.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(a,h,this.tileID.canonical),c.bucketLayerIDs.push(t.map((e=>e.id))))}}const p=e.bF(h.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>null==e?void 0:e.abort())),this.inFlightDependencies=[];let f=Promise.resolve({});if(Object.keys(p).length){const e=new AbortController;this.inFlightDependencies.push(e),f=s.sendAsync({type:"GG",data:{stacks:p,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const m=Object.keys(h.iconDependencies);let g=Promise.resolve({});if(m.length){const e=new AbortController;this.inFlightDependencies.push(e),g=s.sendAsync({type:"GI",data:{icons:m,source:this.source,tileID:this.tileID,type:"icons"}},e)}const y=Object.keys(h.patternDependencies);let _=Promise.resolve({});if(y.length){const e=new AbortController;this.inFlightDependencies.push(e),_=s.sendAsync({type:"GI",data:{icons:y,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const[v,x,b]=yield Promise.all([f,g,_]),w=new i(v),T=new e.cx(x,b);for(const t in u){const i=u[t];i instanceof e.a6?(n(i.layers,this.zoom,o),e.cy({bucket:i,glyphMap:v,glyphPositions:w.positions,imageMap:x,imagePositions:T.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:h.subdivisionGranularity})):i.hasPattern&&(i instanceof e.cz||i instanceof e.cA||i instanceof e.cB)&&(n(i.layers,this.zoom,o),i.addFeatures(h,this.tileID.canonical,T.patternPositions))}return this.status="done",{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:w.image,imageAtlas:T,glyphMap:this.returnDependencies?v:null,iconMap:this.returnDependencies?x:null,glyphPositions:this.returnDependencies?w.positions:null}}))}}function n(t,i,r){const n=new e.C(i);for(const e of t)e.recalculate(n,r)}class o{constructor(e,t,i){this.actor=e,this.layerIndex=t,this.availableImages=i,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(t,i){return e._(this,void 0,void 0,(function*(){const r=yield e.n(t.request,i);try{return{vectorTile:new e.cC.VectorTile(new e.cD(r.data)),rawData:r.data,cacheControl:r.cacheControl,expires:r.expires}}catch(e){const i=new Uint8Array(r.data);let n=`Unable to parse the tile at ${t.request.url}, `;throw n+=31===i[0]&&139===i[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${e.message}`,new Error(n)}}))}loadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.uid,n=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cE(t.request),o=new r(t);this.loading[i]=o;const s=new AbortController;o.abort=s;try{const r=yield this.loadVectorTile(t,s);if(delete this.loading[i],!r)return null;const a=r.rawData,l={};r.expires&&(l.expires=r.expires),r.cacheControl&&(l.cacheControl=r.cacheControl);const c={};if(n){const e=n.finish();e&&(c.resourceTiming=JSON.parse(JSON.stringify(e)))}o.vectorTile=r.vectorTile;const u=o.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);this.loaded[i]=o,this.fetching[i]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const t=yield u;return e.e({rawTileData:a.slice(0)},t,l,c)}finally{delete this.fetching[i]}}catch(e){throw delete this.loading[i],o.status="done",this.loaded[i]=o,e}}))}reloadTile(t){return e._(this,void 0,void 0,(function*(){const i=t.uid;if(!this.loaded||!this.loaded[i])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const r=this.loaded[i];if(r.showCollisionBoxes=t.showCollisionBoxes,"parsing"===r.status){const n=yield r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity);let o;if(this.fetching[i]){const{rawTileData:t,cacheControl:r,resourceTiming:s}=this.fetching[i];delete this.fetching[i],o=e.e({rawTileData:t.slice(0)},n,r,s)}else o=n;return o}if("done"===r.status&&r.vectorTile)return r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,t.subdivisionGranularity)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){const e=this.loading,i=t.uid;e&&e[i]&&e[i].abort&&(e[i].abort.abort(),delete e[i])}))}removeTile(t){return e._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]}))}}class s{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,(function*(){const{uid:i,encoding:r,rawImageData:n,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=t,c=n.width+2,u=n.height+2,h=e.b(n)?new e.R({width:c,height:u},yield e.cF(n,-1,-1,c,u)):n,d=new e.cG(i,h,r,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[i]=d,d}))}removeTile(e){const t=this.loaded,i=e.uid;t&&t[i]&&delete t[i]}}var a,l,c=function(){if(l)return a;function e(e,i){if(0!==e.length){t(e[0],i);for(var r=1;r<e.length;r++)t(e[r],!i)}}function t(e,t){for(var i=0,r=0,n=0,o=e.length,s=o-1;n<o;s=n++){var a=(e[n][0]-e[s][0])*(e[s][1]+e[n][1]),l=i+a;r+=Math.abs(i)>=Math.abs(a)?i-l+a:a-l+i,i=l}i+r>=0!=!!t&&e.reverse()}return l=1,a=function t(i,r){var n,o=i&&i.type;if("FeatureCollection"===o)for(n=0;n<i.features.length;n++)t(i.features[n],r);else if("GeometryCollection"===o)for(n=0;n<i.geometries.length;n++)t(i.geometries[n],r);else if("Feature"===o)t(i.geometry,r);else if("Polygon"===o)e(i.coordinates,r);else if("MultiPolygon"===o)for(n=0;n<i.coordinates.length;n++)e(i.coordinates[n],r);return i}}(),u=e.cH(c);const h=e.cC.VectorTileFeature.prototype.toGeoJSON;class d{constructor(t){this._feature=t,this.extent=e.Z,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return h.call(this,e,t,i)}}class p{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.Z,this.length=t.length,this._features=t}feature(e){return new d(this._features[e])}}var f,m,g,y={exports:{}},_=function(){if(g)return y.exports;g=1;var t=e.cK(),i=function(){if(m)return f;m=1;var t=e.cI(),i=e.cJ().VectorTileFeature;function r(e,t){this.options=t||{},this.features=e,this.length=e.length}function n(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}return f=r,r.prototype.feature=function(e){return new n(this.features[e],this.options.extent)},n.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var r=e[i],n=[],o=0;o<r.length;o++)n.push(new t(r[o][0],r[o][1]));this.geometry.push(n)}return this.geometry},n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},n.prototype.toGeoJSON=i.prototype.toGeoJSON,f}();function r(e){var i=new t;return function(e,t){for(var i in e.layers)t.writeMessage(3,n,e.layers[i])}(e,i),i.finish()}function n(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,o,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var s=r.values;for(i=0;i<s.length;i++)t.writeMessage(4,u,s[i])}function o(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,s,e),t.writeVarintField(3,i.type),t.writeMessage(4,c,i)}function s(e,t){var i=e.feature,r=e.keys,n=e.values,o=e.keycache,s=e.valuecache;for(var a in i.properties){var l=i.properties[a],c=o[a];if(null!==l){void 0===c&&(r.push(a),o[a]=c=r.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(n.push(l),s[h]=d=n.length-1),t.writeVarint(d)}}}function a(e,t){return(t<<3)+(7&e)}function l(e){return e<<1^e>>31}function c(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,o=0,s=i.length,c=0;c<s;c++){var u=i[c],h=1;1===r&&(h=u.length),t.writeVarint(a(1,h));for(var d=3===r?u.length-1:u.length,p=0;p<d;p++){1===p&&1!==r&&t.writeVarint(a(2,d-1));var f=u[p].x-n,m=u[p].y-o;t.writeVarint(l(f)),t.writeVarint(l(m)),n+=f,o+=m}3===r&&t.writeVarint(a(7,1))}}function u(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}return y.exports=r,y.exports.fromVectorTileJs=r,y.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var o in e)n[o]=new i(e[o].features,t),n[o].name=o,n[o].version=t.version,n[o].extent=t.extent;return r({layers:n})},y.exports.GeoJSONWrapper=i,y.exports}(),v=e.cH(_);const x={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},b=Math.fround||(w=new Float32Array(1),e=>(w[0]=+e,w[0]));var w;const T=3,S=5,C=6;class M{constructor(e){this.options=Object.assign(Object.create(x),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:r}=this.options;t&&console.time("total time");const n=`prepare ${e.length} points`;t&&console.time(n),this.points=e;const o=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i.geometry)continue;const[r,n]=i.geometry.coordinates,s=b(A(r)),a=b(I(n));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[r+1]=this._createTree(o);t&&console.timeEnd(n);for(let e=r;e>=i;e--){const i=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),s=this.getClusters([-180,r,n,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(A(i),I(o),A(n),I(r)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+S]>1?k(l,t,this.clusterProps):this.points[l[t+T]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.data;if(t*this.stride>=o.length)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=n.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const i=t*this.stride;o[i+4]===e&&l.push(o[i+S]>1?k(o,i,this.clusterProps):this.points[o[i+T]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(i-a)/n,c=(i+1+a)/n,u={features:[]};return this._addTileFeatures(r.range((t-a)/n,l,(t+1+a)/n,c),r.data,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-a/n,l,1,c),r.data,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,l,a/n,c),r.data,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_createTree(t){const i=new e.aF(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,r,n,o){for(const s of e){const e=s*this.stride,a=t[e+S]>1;let l,c,u;if(a)l=E(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const i=this.points[t[e+T]];l=i.properties;const[r,n]=i.geometry.coordinates;c=A(r),u=I(n)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(u*n-r))]],tags:l};let d;d=a||this.options.generateId?t[e+T]:this.points[t[e+T]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:r,reduce:n,minPoints:o}=this.options,s=i/(r*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=t)continue;a[i+2]=t;const r=a[i],u=a[i+1],h=e.within(a[i],a[i+1],s),d=a[i+S];let p=d;for(const e of h){const i=e*c;a[i+2]>t&&(p+=a[i+S])}if(p>d&&p>=o){let e,o=r*d,s=u*d,f=-1;const m=((i/c|0)<<5)+(t+1)+this.points.length;for(const r of h){const l=r*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+S];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,n&&(e||(e=this._map(a,i,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(a,l)))}a[i+4]=m,l.push(o/p,s/p,1/0,m,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[i+e]);if(p>1)for(const e of h){const i=e*c;if(!(a[i+2]<=t)){a[i+2]=t;for(let e=0;e<c;e++)l.push(a[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+S]>1){const r=this.clusterProps[e[t+C]];return i?Object.assign({},r):r}const r=this.points[e[t+T]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function k(e,t,i){return{type:"Feature",id:e[t+T],properties:E(e,t,i),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),z(e[t+1])]}};var r}function E(e,t,i){const r=e[t+S],n=r>=1e4?`${Math.round(r/1e3)}k`:r>=1e3?Math.round(r/100)/10+"k":r,o=e[t+C],s=-1===o?{}:Object.assign({},i[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+T],point_count:r,point_count_abbreviated:n})}function A(e){return e/360+.5}function I(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function z(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function P(e,t,i,r){let n=r;const o=t+(i-t>>1);let s,a=i-t;const l=e[t],c=e[t+1],u=e[i],h=e[i+1];for(let r=t+3;r<i;r+=3){const t=L(e[r],e[r+1],l,c,u,h);if(t>n)s=r,n=t;else if(t===n){const e=Math.abs(r-o);e<a&&(s=r,a=e)}}n>r&&(s-t>3&&P(e,t,s,r),e[s+2]=n,i-s>3&&P(e,s,i,r))}function L(e,t,i,r,n,o){let s=n-i,a=o-r;if(0!==s||0!==a){const l=((e-i)*s+(t-r)*a)/(s*s+a*a);l>1?(i=n,r=o):l>0&&(i+=s*l,r+=a*l)}return s=e-i,a=t-r,s*s+a*a}function D(e,t,i,r){const n={id:null==e?null:e,type:t,geometry:i,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)R(n,i);else if("Polygon"===t)R(n,i[0]);else if("MultiLineString"===t)for(const e of i)R(n,e);else if("MultiPolygon"===t)for(const e of i)R(n,e[0]);return n}function R(e,t){for(let i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function B(e,t,i,r){if(!t.geometry)return;const n=t.geometry.coordinates;if(n&&0===n.length)return;const o=t.geometry.type,s=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],l=t.id;if(i.promoteId?l=t.properties[i.promoteId]:i.generateId&&(l=r||0),"Point"===o)O(n,a);else if("MultiPoint"===o)for(const e of n)O(e,a);else if("LineString"===o)F(n,a,s,!1);else if("MultiLineString"===o){if(i.lineMetrics){for(const i of n)a=[],F(i,a,s,!1),e.push(D(l,"LineString",a,t.properties));return}j(n,a,s,!1)}else if("Polygon"===o)j(n,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const n of t.geometry.geometries)B(e,{id:l,geometry:n,properties:t.properties},i,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of n){const t=[];j(e,t,s,!0),a.push(t)}}e.push(D(l,o,a,t.properties))}function O(e,t){t.push($(e[0]),N(e[1]),0)}function F(e,t,i,r){let n,o,s=0;for(let i=0;i<e.length;i++){const a=$(e[i][0]),l=N(e[i][1]);t.push(a,l,0),i>0&&(s+=r?(n*l-a*o)/2:Math.sqrt(Math.pow(a-n,2)+Math.pow(l-o,2))),n=a,o=l}const a=t.length-3;t[2]=1,P(t,0,a,i),t[a+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function j(e,t,i,r){for(let n=0;n<e.length;n++){const o=[];F(e[n],o,i,r),t.push(o)}}function $(e){return e/360+.5}function N(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function U(e,t,i,r,n,o,s,a){if(r/=t,o>=(i/=t)&&s<r)return e;if(s<i||o>=r)return null;const l=[];for(const t of e){const e=t.geometry;let o=t.type;const s=0===n?t.minX:t.minY,c=0===n?t.maxX:t.maxY;if(s>=i&&c<r){l.push(t);continue}if(c<i||s>=r)continue;let u=[];if("Point"===o||"MultiPoint"===o)V(e,u,i,r,n);else if("LineString"===o)G(e,u,i,r,n,!1,a.lineMetrics);else if("MultiLineString"===o)Z(e,u,i,r,n,!1);else if("Polygon"===o)Z(e,u,i,r,n,!0);else if("MultiPolygon"===o)for(const t of e){const e=[];Z(t,e,i,r,n,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===o){for(const e of u)l.push(D(t.id,o,e,t.tags));continue}"LineString"!==o&&"MultiLineString"!==o||(1===u.length?(o="LineString",u=u[0]):o="MultiLineString"),"Point"!==o&&"MultiPoint"!==o||(o=3===u.length?"Point":"MultiPoint"),l.push(D(t.id,o,u,t.tags))}}return l.length?l:null}function V(e,t,i,r,n){for(let o=0;o<e.length;o+=3){const s=e[o+n];s>=i&&s<=r&&W(t,e[o],e[o+1],e[o+2])}}function G(e,t,i,r,n,o,s){let a=q(e);const l=0===n?H:X;let c,u,h=e.start;for(let d=0;d<e.length-3;d+=3){const p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],y=e[d+4],_=0===n?p:f,v=0===n?g:y;let x=!1;s&&(c=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-y,2))),_<i?v>i&&(u=l(a,p,f,g,y,i),s&&(a.start=h+c*u)):_>r?v<r&&(u=l(a,p,f,g,y,r),s&&(a.start=h+c*u)):W(a,p,f,m),v<i&&_>=i&&(u=l(a,p,f,g,y,i),x=!0),v>r&&_<=r&&(u=l(a,p,f,g,y,r),x=!0),!o&&x&&(s&&(a.end=h+c*u),t.push(a),a=q(e)),s&&(h+=c)}let d=e.length-3;const p=e[d],f=e[d+1],m=0===n?p:f;m>=i&&m<=r&&W(a,p,f,e[d+2]),d=a.length-3,o&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&W(a,a[0],a[1],a[2]),a.length&&t.push(a)}function q(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Z(e,t,i,r,n,o){for(const s of e)G(s,t,i,r,n,o,!1)}function W(e,t,i,r){e.push(t,i,r)}function H(e,t,i,r,n,o){const s=(o-t)/(r-t);return W(e,o,i+(n-i)*s,1),s}function X(e,t,i,r,n,o){const s=(o-i)/(n-i);return W(e,t+(r-t)*s,o,1),s}function K(e,t){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=n.type;let s;if("Point"===o||"MultiPoint"===o||"LineString"===o)s=Y(n.geometry,t);else if("MultiLineString"===o||"Polygon"===o){s=[];for(const e of n.geometry)s.push(Y(e,t))}else if("MultiPolygon"===o){s=[];for(const e of n.geometry){const i=[];for(const r of e)i.push(Y(r,t));s.push(i)}}i.push(D(n.id,o,s,n.tags))}return i}function Y(e,t){const i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(let r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function J(e,t){if(e.transformed)return e;const i=1<<e.z,r=e.x,n=e.y;for(const o of e.features){const e=o.geometry,s=o.type;if(o.geometry=[],1===s)for(let s=0;s<e.length;s+=2)o.geometry.push(Q(e[s],e[s+1],t,i,r,n));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(Q(e[s][o],e[s][o+1],t,i,r,n));o.geometry.push(a)}}return e.transformed=!0,e}function Q(e,t,i,r,n,o){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-o))]}function ee(e,t,i,r,n){const o=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e)te(s,t,o,n);return s}function te(e,t,i,r){const n=t.geometry,o=t.type,s=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let t=0;t<n.length;t+=3)s.push(n[t],n[t+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ie(s,n,e,i,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let t=0;t<n.length;t++)ie(s,n[t],e,i,"Polygon"===o,0===t);else if("MultiPolygon"===o)for(let t=0;t<n.length;t++){const r=n[t];for(let t=0;t<r.length;t++)ie(s,r[t],e,i,!0,0===t)}if(s.length){let i=t.tags||null;if("LineString"===o&&r.lineMetrics){i={};for(const e in t.tags)i[e]=t.tags[e];i.mapbox_clip_start=n.start/n.size,i.mapbox_clip_end=n.end/n.size}const a={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:i};null!==t.id&&(a.id=t.id),e.features.push(a)}}function ie(e,t,i,r,n,o){const s=r*r;if(r>0&&t.size<(n?s:r))return void(i.numPoints+=t.length/3);const a=[];for(let e=0;e<t.length;e+=3)(0===r||t[e+2]>s)&&(i.numSimplified++,a.push(t[e],t[e+1])),i.numPoints++;n&&function(e,t){let i=0;for(let t=0,r=e.length,n=r-2;t<r;n=t,t+=2)i+=(e[t]-e[n])*(e[t+1]+e[n+1]);if(i>0===t)for(let t=0,i=e.length;t<i/2;t+=2){const r=e[t],n=e[t+1];e[t]=e[i-2-t],e[t+1]=e[i-1-t],e[i-2-t]=r,e[i-1-t]=n}}(a,o),e.push(a)}const re={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ne{constructor(e,t){const i=(t=this.options=function(e,t){for(const i in t)e[i]=t[i];return e}(Object.create(re),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(e,t){const i=[];if("FeatureCollection"===e.type)for(let r=0;r<e.features.length;r++)B(i,e.features[r],t,r);else B(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){const i=t.buffer/t.extent;let r=e;const n=U(e,1,-1-i,i,0,-1,2,t),o=U(e,1,1-i,2+i,0,-1,2,t);return(n||o)&&(r=U(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=K(n,1).concat(r)),o&&(r=r.concat(K(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,i,r,n,o,s){const a=[e,t,i,r],l=this.options,c=l.debug;for(;a.length;){r=a.pop(),i=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,h=oe(t,i,r);let d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=ee(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++}if(d.source=e,null==n){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===n)continue;if(null!=n){const e=n-t;if(i!==o>>e||r!==s>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,f=.5-p,m=.5+p,g=1+p;let y=null,_=null,v=null,x=null,b=U(e,u,i-p,i+m,0,d.minX,d.maxX,l),w=U(e,u,i+f,i+g,0,d.minX,d.maxX,l);e=null,b&&(y=U(b,u,r-p,r+m,1,d.minY,d.maxY,l),_=U(b,u,r+f,r+g,1,d.minY,d.maxY,l),b=null),w&&(v=U(w,u,r-p,r+m,1,d.minY,d.maxY,l),x=U(w,u,r+f,r+g,1,d.minY,d.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(y||[],t+1,2*i,2*r),a.push(_||[],t+1,2*i,2*r+1),a.push(v||[],t+1,2*i+1,2*r),a.push(x||[],t+1,2*i+1,2*r+1)}}getTile(e,t,i){e=+e,t=+t,i=+i;const r=this.options,{extent:n,debug:o}=r;if(e<0||e>24)return null;const s=1<<e,a=oe(e,t=t+s&s-1,i);if(this.tiles[a])return J(this.tiles[a],n);o>1&&console.log("drilling down to z%d-%d-%d",e,t,i);let l,c=e,u=t,h=i;for(;!l&&c>0;)c--,u>>=1,h>>=1,l=this.tiles[oe(c,u,h)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,h),console.time("drilling down")),this.splitTile(l.source,c,u,h,e,t,i),o>1&&console.timeEnd("drilling down"),this.tiles[a]?J(this.tiles[a],n):null):null}}function oe(e,t,i){return 32*((1<<e)*i+t)+e}function se(e,t){return t?e.properties[t]:e.id}function ae(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=se(e,t);if("FeatureCollection"===e.type){const i=new Set;for(const r of e.features){const e=se(r,t);if(null==e)return!1;if(i.has(e))return!1;i.add(e)}return!0}return!1}function le(e,t){const i=new Map;if(null==e);else if("Feature"===e.type)i.set(se(e,t),e);else for(const r of e.features)i.set(se(r,t),r);return i}class ce extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(t,i){return e._(this,void 0,void 0,(function*(){const e=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!i)return null;const r=new p(i.features);let n=v(r);return 0===n.byteOffset&&n.byteLength===n.buffer.byteLength||(n=new Uint8Array(n)),{vectorTile:r,rawData:n.buffer}}))}loadData(t){return e._(this,void 0,void 0,(function*(){var i;null===(i=this._pendingRequest)||void 0===i||i.abort();const r=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.cE(t.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest),this._geoJSONIndex=t.cluster?new M(function({superclusterOptions:t,clusterProperties:i}){if(!i||!t)return t;const r={},n={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys();for(const t of a){const[r,n]=i[t];e.cL(n),e.cL("string"==typeof r?[r,["accumulated"],["get",t]]:r)}return t.map=e=>{const t={};for(const e of a)t[e]=r[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=n[t].evaluate(o,s)},t}(t)).load((yield this._pendingData).features):(n=yield this._pendingData,new ne(n,t.geojsonVtOptions)),this.loaded={};const i={};if(r){const e=r.finish();e&&(i.resourceTiming={},i.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}return i}catch(t){if(delete this._pendingRequest,e.cp(t))return{abandoned:!0};throw t}var n}))}getData(){return e._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,i){return e._(this,void 0,void 0,(function*(){let r=yield this.loadGeoJSON(t,i);if(delete this._pendingRequest,"object"!=typeof r)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(u(r,!0),t.filter){const i=e.cL(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===i.result)throw new Error(i.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const n=r.features.filter((e=>i.value.evaluate({zoom:0},e)));r={type:"FeatureCollection",features:n}}return r}))}loadGeoJSON(t,i){return e._(this,void 0,void 0,(function*(){const{promoteId:r}=t;if(t.request){const n=yield e.j(t.request,i);return this._dataUpdateable=ae(n.data,r)?le(n.data,r):void 0,n.data}if("string"==typeof t.data)try{const e=JSON.parse(t.data);return this._dataUpdateable=ae(e,r)?le(e,r):void 0,e}catch(e){throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`)}if(!t.dataDiff)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${t.source}`);return function(e,t,i){var r,n,o,s;if(t.removeAll&&e.clear(),t.remove)for(const i of t.remove)e.delete(i);if(t.add)for(const r of t.add){const t=se(r,i);null!=t&&e.set(t,r)}if(t.update)for(const i of t.update){let t=e.get(i.id);if(null==t)continue;const a=!i.removeAllProperties&&((null===(r=i.removeProperties)||void 0===r?void 0:r.length)>0||(null===(n=i.addOrUpdateProperties)||void 0===n?void 0:n.length)>0);if((i.newGeometry||i.removeAllProperties||a)&&(t=Object.assign({},t),e.set(i.id,t),a&&(t.properties=Object.assign({},t.properties))),i.newGeometry&&(t.geometry=i.newGeometry),i.removeAllProperties)t.properties={};else if((null===(o=i.removeProperties)||void 0===o?void 0:o.length)>0)for(const e of i.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(s=i.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:e,value:r}of i.addOrUpdateProperties)t.properties[e]=r}}(this._dataUpdateable,t.dataDiff,r),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(t){return e._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class ue{constructor(t){this.self=t,this.actor=new e.H(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.cr,this.self.removeProtocol=e.cs,this.self.registerRTLTextPlugin=t=>{e.cM.setMethods(t)},this.actor.registerMessageHandler("LDT",((e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t))),this.actor.registerMessageHandler("RDT",((t,i)=>e._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(t,i.source).removeTile(i)})))),this.actor.registerMessageHandler("GCEZ",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterExpansionZoom(i)})))),this.actor.registerMessageHandler("GCC",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterChildren(i)})))),this.actor.registerMessageHandler("GCL",((t,i)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,i.type,i.source).getClusterLeaves(i)})))),this.actor.registerMessageHandler("LD",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t))),this.actor.registerMessageHandler("GD",((e,t)=>this._getWorkerSource(e,t.type,t.source).getData())),this.actor.registerMessageHandler("LT",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t))),this.actor.registerMessageHandler("RT",((e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t))),this.actor.registerMessageHandler("AT",((e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t))),this.actor.registerMessageHandler("RMT",((e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t))),this.actor.registerMessageHandler("RS",((t,i)=>e._(this,void 0,void 0,(function*(){if(!this.workerSources[t]||!this.workerSources[t][i.type]||!this.workerSources[t][i.type][i.source])return;const e=this.workerSources[t][i.type][i.source];delete this.workerSources[t][i.type][i.source],void 0!==e.removeSource&&e.removeSource(i)})))),this.actor.registerMessageHandler("RM",(t=>e._(this,void 0,void 0,(function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t]})))),this.actor.registerMessageHandler("SR",((t,i)=>e._(this,void 0,void 0,(function*(){this.referrer=i})))),this.actor.registerMessageHandler("SRPS",((e,t)=>this._syncRTLPluginState(e,t))),this.actor.registerMessageHandler("IS",((t,i)=>e._(this,void 0,void 0,(function*(){this.self.importScripts(i)})))),this.actor.registerMessageHandler("SI",((e,t)=>this._setImages(e,t))),this.actor.registerMessageHandler("UL",((t,i)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).update(i.layers,i.removedIds)})))),this.actor.registerMessageHandler("SL",((t,i)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).replace(i)}))))}_setImages(t,i){return e._(this,void 0,void 0,(function*(){this.availableImages[t]=i;for(const e in this.workerSources[t]){const r=this.workerSources[t][e];for(const e in r)r[e].availableImages=i}}))}_syncRTLPluginState(t,i){return e._(this,void 0,void 0,(function*(){return yield e.cM.syncState(i,this.self.importScripts)}))}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let i=this.layerIndexes[e];return i||(i=this.layerIndexes[e]=new t),i}_getWorkerSource(e,t,i){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][i]){const r={sendAsync:(t,i)=>(t.targetMapId=e,this.actor.sendAsync(t,i))};switch(t){case"vector":this.workerSources[e][t][i]=new o(r,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][i]=new ce(r,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][i]=new this.externalWorkerSourceTypes[t](r,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][i]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new s),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new ue(self)),ue})),i("index",["exports","./shared"],(function(e,t){var i="5.5.0";function r(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}let n,o;const s={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(e,i,r){const n=requestAnimationFrame((e=>{o(),i(e)})),{unsubscribe:o}=t.s(e.signal,"abort",(()=>{o(),cancelAnimationFrame(n),r(t.c())}),!1)},frameAsync(e){return new Promise(((t,i)=>{this.frame(e,t,i)}))},getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),i=t.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0,e.width,e.height),i},resolveURL:e=>(n||(n=document.createElement("a")),n.href=e,n.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==o&&(o=matchMedia("(prefers-reduced-motion: reduce)")),o.matches)}};class a{static testProp(e){if(!a.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in a.docStyle)return e[t];return e[0]}static create(e,t,i){const r=window.document.createElement(e);return void 0!==t&&(r.className=t),i&&i.appendChild(r),r}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){a.docStyle&&a.selectProp&&(a.userSelect=a.docStyle[a.selectProp],a.docStyle[a.selectProp]="none")}static enableDrag(){a.docStyle&&a.selectProp&&(a.docStyle[a.selectProp]=a.userSelect)}static setTransform(e,t){e.style[a.transformProp]=t}static addEventListener(e,t,i,r={}){e.addEventListener(t,i,"passive"in r?r:r.capture)}static removeEventListener(e,t,i,r={}){e.removeEventListener(t,i,"passive"in r?r:r.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",a.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",a.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",a.suppressClickInternal,!0)}),0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,i,r){const n=i.boundingClientRect;return new t.P((r.clientX-n.left)/i.x-e.clientLeft,(r.clientY-n.top)/i.y-e.clientTop)}static mousePos(e,t){const i=a.getScale(e);return a.getPoint(e,i,t)}static touchPos(e,t){const i=[],r=a.getScale(e);for(let n=0;n<t.length;n++)i.push(a.getPoint(e,r,t[n]));return i}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const t=(new DOMParser).parseFromString(e,"text/html").body||document.createElement("body"),i=t.querySelectorAll("script");for(const e of i)e.remove();return a.clean(t),t.innerHTML}static isPossiblyDangerous(e,t){const i=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!i.includes("javascript:")&&!i.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const t=e.children;for(const e of t)a.removeAttributes(e),a.clean(e)}static removeAttributes(e){for(const{name:t,value:i}of e.attributes)a.isPossiblyDangerous(t,i)&&e.removeAttribute(t)}}a.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,a.selectProp=a.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),a.transformProp=a.testProp(["transform","WebkitTransform"]);const l={supported:!1,testSupport:function(e){!h&&u&&(d?p(e):c=e)}};let c,u,h=!1,d=!1;function p(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,u),e.isContextLost())return;l.supported=!0}catch(e){}e.deleteTexture(t),h=!0}var f;"undefined"!=typeof document&&(u=document.createElement("img"),u.onload=()=>{c&&p(c),c=null,d=!0},u.onerror=()=>{h=!0,c=null},u.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let i,r,n,o;e.resetRequestQueue=()=>{i=[],r=0,n=0,o={}},e.addThrottleControl=e=>{const t=n++;return o[t]=e,t},e.removeThrottleControl=e=>{delete o[e],a()},e.getImage=(e,r,n=!0)=>new Promise(((o,s)=>{l.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),i.push({abortController:r,requestParameters:e,supportImageRefresh:n,state:"queued",onError:e=>{s(e)},onSuccess:e=>{o(e)}}),a()}));const s=e=>t._(this,void 0,void 0,(function*(){e.state="running";const{requestParameters:i,supportImageRefresh:n,onError:o,onSuccess:s,abortController:l}=e,u=!1===n&&!t.i(self)&&!t.g(i.url)&&(!i.headers||Object.keys(i.headers).reduce(((e,t)=>e&&"accept"===t),!0));r++;const h=u?c(i,l):t.m(i,l);try{const i=yield h;delete e.abortController,e.state="completed",i.data instanceof HTMLImageElement||t.b(i.data)?s(i):i.data&&s({data:yield(d=i.data,"function"==typeof createImageBitmap?t.f(d):t.h(d)),cacheControl:i.cacheControl,expires:i.expires})}catch(t){delete e.abortController,o(t)}finally{r--,a()}var d})),a=()=>{const e=(()=>{for(const e of Object.keys(o))if(o[e]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=r;t<e&&i.length>0;t++){const e=i.shift();e.abortController.signal.aborted?t--:s(e)}},c=(e,i)=>new Promise(((r,n)=>{const o=new Image,s=e.url,a=e.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!t.d(s))&&(o.crossOrigin="anonymous"),i.signal.addEventListener("abort",(()=>{o.src="",n(t.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,r({data:o})},o.onerror=()=>{o.onerror=o.onload=null,i.signal.aborted||n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(f||(f={})),f.resetRequestQueue();class m{constructor(e){this._transformRequestFn=e}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function g(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const i=[];for(const{id:r,url:n}of e){const e=`${r}${n}`;-1===i.indexOf(e)&&(i.push(e),t.push({id:r,url:n}))}}return t}function y(e,t,i){try{const r=new URL(e);return r.pathname+=`${t}${i}`,r.toString()}catch(t){throw new Error(`Invalid sprite URL "${e}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class _{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,i,r){const{width:n,height:o}=e,s=!(this.size&&this.size[0]===n&&this.size[1]===o||r),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(i&&i.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!i||!1!==i.premultiply)),s)this.size=[n,o],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,n,o,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:i,y:s}=r||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texSubImage2D(l.TEXTURE_2D,0,i,s,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,i,s,n,o,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D),a.pixelStoreUnpackFlipY.setDefault(),a.pixelStoreUnpack.setDefault(),a.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,t,i){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),i!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(i=n.LINEAR),e!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,i||e),this.filter=e),t!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function v(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class x extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const i=this.images[e];if(i&&!i.data&&i.spriteData){const e=i.spriteData;i.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),i.spriteData=null}return i}addImage(e,t){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(e,i){let r=!0;const n=i.data||i.spriteData;return this._validateStretch(i.stretchX,n&&n.width)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(i.stretchY,n&&n.height)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(i.content,i)||(this.fire(new t.k(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const i=t.spriteData,r=i&&i.width||t.data.width,n=i&&i.height||t.data.height;return!(e[0]<0||r<e[0]||e[1]<0||n<e[1]||e[2]<0||r<e[2]||e[3]<0||n<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,i=!0){const r=this.getImage(e);if(i&&(r.data.width!==t.data.width||r.data.height!==t.data.height))throw new Error(`size mismatch between old image (${r.data.width}x${r.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=r.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((t,i)=>{let r=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(r=!1);this.isLoaded()||r?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})}))}_getImagesForIds(e){const i={};for(const r of e){let e=this.getImage(r);e||(this.fire(new t.l("styleimagemissing",{id:r})),e=this.getImage(r)),e?i[r]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${r}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return i}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const i=this.patterns[e],r=this.getImage(e);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{const i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new t.I(i,r);this.patterns[e]={bin:i,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:i,h:r}=t.p(e),n=this.atlasImage;n.resize({width:i||1,height:r||1});for(const e in this.patterns){const{bin:i}=this.patterns[e],r=i.x+1,o=i.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,n,{x:0,y:0},{x:r,y:o},{width:a,height:l}),t.R.copy(s,n,{x:0,y:l-1},{x:r,y:o-1},{width:a,height:1}),t.R.copy(s,n,{x:0,y:0},{x:r,y:o+l},{width:a,height:1}),t.R.copy(s,n,{x:a-1,y:0},{x:r-1,y:o},{width:1,height:l}),t.R.copy(s,n,{x:0,y:0},{x:r+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const i of e){if(this.callbackDispatchedThisFrame[i])continue;this.callbackDispatchedThisFrame[i]=!0;const e=this.getImage(i);e||t.w(`Image with ID: "${i}" was not found`),v(e)&&this.updateImage(i,e)}}}const b=1e20;function w(e,t,i,r,n,o,s,a,l){for(let c=t;c<t+r;c++)T(e,i*o+c,o,n,s,a,l);for(let c=i;c<i+n;c++)T(e,c*o+t,1,r,s,a,l)}function T(e,t,i,r,n,o,s){o[0]=0,s[0]=-1e20,s[1]=b,n[0]=e[t];for(let a=1,l=0,c=0;a<r;a++){n[a]=e[t+a*i];const r=a*a;do{const e=o[l];c=(n[a]-n[e]+r-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=b}for(let a=0,l=0;a<r;a++){for(;s[l+1]<a;)l++;const r=o[l],c=a-r;e[t+a*i]=n[r]+c*c}}class S{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,(function*(){const t=[];for(const i in e)for(const r of e[i])t.push(this._getAndCacheGlyphsPromise(i,r));const i=yield Promise.all(t),r={};for(const{stack:e,id:t,glyph:n}of i)r[e]||(r[e]={}),r[e][t]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics};return r}))}_getAndCacheGlyphsPromise(e,i){return t._(this,void 0,void 0,(function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let r=t.glyphs[i];if(void 0!==r)return{stack:e,id:i,glyph:r};if(r=this._tinySDF(t,e,i),r)return t.glyphs[i]=r,{stack:e,id:i,glyph:r};const n=Math.floor(i/256);if(256*n>65535)throw new Error("glyphs > 65535 not supported");if(t.ranges[n])return{stack:e,id:i,glyph:r};if(!this.url)throw new Error("glyphsUrl is not set");if(!t.requests[n]){const i=S.loadGlyphRange(e,n,this.url,this.requestManager);t.requests[n]=i}const o=yield t.requests[n];for(const e in o)this._doesCharSupportLocalGlyph(+e)||(t.glyphs[+e]=o[+e]);return t.ranges[n]=!0,{stack:e,id:i,glyph:o[i]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))||t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e)||t.u["CJK Symbols and Punctuation"](e)||t.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,i,r){const n=this.localIdeographFontFamily;if(!n)return;if(!this._doesCharSupportLocalGlyph(r))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(i)?t="900":/medium/i.test(i)?t="500":/light/i.test(i)&&(t="200"),o=e.tinySDF=new S.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:n,fontWeight:t})}const s=o.draw(String.fromCharCode(r));return{id:r,bitmap:new t.q({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}S.loadGlyphRange=function(e,i,r,n){return t._(this,void 0,void 0,(function*(){const o=256*i,s=o+255,a=n.transformRequest(r.replace("{fontstack}",e).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield t.n(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${i}, ${o}-${s}`);const c={};for(const e of t.o(l.data))c[e.id]=e;return c}))},S.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=i;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${n}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-n))),l=Math.min(this.size-this.buffer,s+Math.ceil(r)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:y}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const _=f.getImageData(m,m,a,l);y.fill(b,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const i=_.data[4*(e*a+t)+3]/255;if(0===i)continue;const r=(e+m)*c+t+m;if(1===i)y[r]=0,g[r]=b;else{const e=.5-i;y[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}w(y,0,0,c,u,c,this.f,this.v,this.z),w(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(y[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class C{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,i){return t.z(e.expression.evaluate(i))}interpolate(e,i,r){return{x:t.B.number(e.x,i.x,r),y:t.B.number(e.y,i.y,r),z:t.B.number(e.z,i.z,r)}}}let M;class k extends t.E{constructor(e){super(),M=M||new t.r({anchor:new t.D(t.v.light.anchor),position:new C,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(M),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,i={}){if(!this._validate(t.t,e,i))for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r){return(!r||!1!==r.validate)&&t.x(this,e.call(t.y,{value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v}))}}const E=new t.r({"sky-color":new t.D(t.v.sky["sky-color"]),"horizon-color":new t.D(t.v.sky["horizon-color"]),"fog-color":new t.D(t.v.sky["fog-color"]),"fog-ground-blend":new t.D(t.v.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.v.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.v.sky["atmosphere-blend"])});class A extends t.E{constructor(e){super(),this._transitionable=new t.T(E),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.C(0))}setSky(e,i={}){if(!this._validate(t.F,e,i)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const t in e){const i=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),i):this._transitionable.setValue(t,i)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,i,r={}){return!1!==(null==r?void 0:r.validate)&&t.x(this,e.call(t.y,t.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class I{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const i=e.join(",")+String(t);return this.dashEntry[i]||(this.dashEntry[i]=this.addDash(e,t)),this.dashEntry[i]}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,o=e[0]*i,s=!0;r.push({left:n,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];n=a*i,a+=l,o=a*i,r.push({left:n,right:o,isDash:s,zeroLength:0===l})}return r}addRoundDash(e,t,i){const r=t/2;for(let t=-i;t<=i;t++){const n=this.width*(this.nextRow+i+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/i*(r+1);if(s.isDash){const e=r-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=r-Math.sqrt(u*u+d*d);this.data[n+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const i=e[t],r=e[t+1];i.zeroLength?e.splice(t,1):r&&r.isDash===i.isDash&&(r.left=i.left,e.splice(t,1))}const t=e[0],i=e[e.length-1];t.isDash===i.isDash&&(t.left=i.left-this.width,i.right=t.right+this.width);const r=this.width*this.nextRow;let n=0,o=e[n];for(let t=0;t<this.width;t++){t/o.right>1&&(o=e[++n]);const i=Math.abs(t-o.left),s=Math.abs(t-o.right),a=Math.min(i,s);this.data[r+t]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,i){const r=i?7:0,n=2*r+1;if(this.nextRow+n>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,n=this.getDashRanges(e,this.width,t);i?this.addRoundDash(n,t,r):this.addRegularDash(n)}const s={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=n,this.dirty=!0,s}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const z="maplibre_preloaded_worker_pool";class P{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<P.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[z]}numActive(){return Object.keys(this.active).length}}const L=Math.floor(s.hardwareConcurrency/2);let D,R;function B(){return D||(D=new P),D}P.workerCount=t.G(globalThis)?Math.max(Math.min(L,3),1):1;class O{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=i;const r=this.workerPool.acquire(i);for(let e=0;e<r.length;e++){const n=new t.H(r[e],i);n.name=`Worker ${e}`,this.actors.push(n)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const i=[];for(const r of this.actors)i.push(r.sendAsync({type:e,data:t}));return Promise.all(i)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const i of this.actors)i.registerMessageHandler(e,t)}}function F(){return R||(R=new O(B(),t.J),R.registerMessageHandler("GR",((e,i,r)=>t.m(i,r)))),R}function j(e,i){const r=t.K();return t.L(r,r,[1,1,0]),t.M(r,r,[.5*e.width,.5*e.height,1]),e.calculatePosMatrix?t.N(r,r,e.calculatePosMatrix(i.toUnwrapped())):r}function $(e,t,i,r,n,o,s){var a;const l=function(e,t,i){if(e)for(const r of e){const e=t[r];if(e&&e.source===i&&"fill-extrusion"===e.type)return!0}else for(const e in t){const r=t[e];if(r.source===i&&"fill-extrusion"===r.type)return!0}return!1}(null!==(a=null==n?void 0:n.layers)&&void 0!==a?a:null,t,e.id),c=o.maxPitchScaleFactor(),u=e.tilesIn(r,c,l);u.sort(N);const h=[];for(const r of u)h.push({wrappedTileID:r.tileID.wrapped().key,queryResults:r.tile.queryRenderedFeatures(t,i,e._state,r.queryGeometry,r.cameraQueryGeometry,r.scale,n,o,c,j(e.transform,r.tileID),s?(e,t)=>s(r.tileID,e,t):void 0)});return function(e,t){for(const i in e)for(const r of e[i])U(r,t);return e}(function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,o=i[n]=i[n]||{};for(const i in e){const r=e[i],n=o[i]=o[i]||{},s=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,s.push(e))}}return t}(h),e)}function N(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}function U(e,t){const i=e.feature,r=t.getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=r}function V(e,i,r){return t._(this,void 0,void 0,(function*(){let n=e;if(e.url?n=(yield t.j(i.transformRequest(e.url,"Source"),r)).data:yield s.frameAsync(r),!n)return null;const o=t.O(t.e(n,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in n&&n.vector_layers&&(o.vectorLayerIds=n.vector_layers.map((e=>e.id))),o}))}class G{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.Q?new t.Q(e.lng,e.lat):t.Q.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.Q?new t.Q(e.lng,e.lat):t.Q.convert(e),this}extend(e){const i=this._sw,r=this._ne;let n,o;if(e instanceof t.Q)n=e,o=e;else{if(!(e instanceof G))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(G.convert(e)):this.extend(t.Q.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.Q.convert(e)):this;if(n=e._sw,o=e._ne,!n||!o)return this}return i||r?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new t.Q(n.lng,n.lat),this._ne=new t.Q(o.lng,o.lat)),this}getCenter(){return new t.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.Q(this.getWest(),this.getNorth())}getSouthEast(){return new t.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=t.Q.convert(e);let n=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){return e instanceof G?e:e?new G(e):e}static fromLngLat(e,i=0){const r=360*i/40075017,n=r/Math.cos(Math.PI/180*e.lat);return new G(new t.Q(e.lng-n,e.lat-r),new t.Q(e.lng+n,e.lat+r))}adjustAntiMeridian(){const e=new t.Q(this._sw.lng,this._sw.lat),i=new t.Q(this._ne.lng,this._ne.lat);return new G(e,e.lng>i.lng?new t.Q(i.lng+360,i.lat):i)}}class q{constructor(e,t,i){this.bounds=G.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),r=Math.floor(t.U(this.bounds.getWest())*i),n=Math.floor(t.S(this.bounds.getNorth())*i),o=Math.ceil(t.U(this.bounds.getEast())*i),s=Math.ceil(t.S(this.bounds.getSouth())*i);return e.x>=r&&e.x<o&&e.y>=n&&e.y<s}}class Z extends t.E{constructor(e,i,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.O(i,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n)}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new q(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};i.request.collectResourceTiming=this._collectResourceTiming;let r="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise(((t,i)=>{e.reloadPromise={resolve:t,reject:i}}))}else e.actor=this.dispatcher.getActor(),r="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:r,data:i},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(t){if(delete e.abortController,e.aborted)return;if(t&&404!==t.status)throw t;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class W extends t.E{constructor(e,i,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},i),t.e(this,t.O(i,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield V(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(t.e(this,i),i.bounds&&(this.tileBounds=new q(i.bounds,this.minzoom,this.maxzoom)),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(e){this._tileJSONRequest=null,this.fire(new t.k(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const i=yield f.getImage(this.map._requestManager.transformRequest(t,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(i&&i.data){this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&e.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const t=this.map.painter.context,r=t.gl,n=i.data;e.texture=this.map.painter.getTileTexture(n.width),e.texture?e.texture.update(n,{useMipmap:!0}):(e.texture=new _(t,n,r.RGBA,{useMipmap:!0}),e.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE,r.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class H extends W{constructor(e,i,r,n){super(e,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox",this.redFactor=i.redFactor,this.greenFactor=i.greenFactor,this.blueFactor=i.blueFactor,this.baseShift=i.baseShift}loadTile(e){return t._(this,void 0,void 0,(function*(){const i=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),r=this.map._requestManager.transformRequest(i,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const i=yield f.getImage(r,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(i&&i.data){const r=i.data;this.map._refreshExpiredTiles&&(i.cacheControl||i.expires)&&e.setExpiryData({cacheControl:i.cacheControl,expires:i.expires});const n=t.b(r)&&t.V()?r:yield this.readImageNow(r),o={type:this.type,uid:e.uid,source:this.id,rawImageData:n,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:o});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}readImageNow(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.W()){const i=e.width+2,r=e.height+2;try{return new t.R({width:i,height:r},yield t.X(e,-1,-1,i,r))}catch(e){}}return s.getImageData(e,1)}))}_getNeighboringTiles(e){const i=e.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,o=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,l={};return l[new t.Y(e.overscaledZ,o,i.z,n,i.y).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(l[new t.Y(e.overscaledZ,o,i.z,n,i.y-1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new t.Y(e.overscaledZ,o,i.z,n,i.y+1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new t.Y(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class X extends t.E{constructor(e,i,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=t.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId,void 0!==i.clusterMaxZoom&&this.maxzoom<=i.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${i.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==i.buffer?i.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==i.tolerance?i.tolerance:.375),extent:t.Z,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.Z,radius:this._pixelsToTileUnits(i.clusterRadius||50),log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(t.Z/this.tileSize)}load(){return t._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return t._(this,void 0,void 0,(function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return"GeometryCollection"===e.type?e.geometries.map((e=>e.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return t._(this,void 0,void 0,(function*(){const e=new G,t=yield this.getData();let i;switch(t.type){case"FeatureCollection":i=t.features.map((e=>this.getCoordinatesFromGeometry(e.geometry))).flat(1/0);break;case"Feature":i=this.getCoordinatesFromGeometry(t.geometry);break;default:i=this.getCoordinatesFromGeometry(t)}if(0==i.length)return e;for(let t=0;t<i.length-1;t+=2)e.extend([i[t],i[t+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,i){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:i}})}_updateWorkerData(e){return t._(this,void 0,void 0,(function*(){const i=t.e({type:this.type},this.workerOptions);e?i.dataDiff=e:"string"==typeof this._data?(i.request=this.map._requestManager.transformRequest(s.resolveURL(this._data),"Source"),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.l("dataloading",{dataType:"source"}));try{const e=yield this.actor.sendAsync({type:"LD",data:i});if(this._pendingLoads--,this._removed||e.abandoned)return void this.fire(new t.l("dataabort",{dataType:"source"}));let r=null;e.resourceTiming&&e.resourceTiming[this.id]&&(r=e.resourceTiming[this.id].slice(0));const n={dataType:"source"};this._collectResourceTiming&&r&&r.length>0&&t.e(n,{resourceTiming:r}),this.fire(new t.l("data",Object.assign(Object.assign({},n),{sourceDataType:"metadata"}))),this.fire(new t.l("data",Object.assign(Object.assign({},n),{sourceDataType:"content"})))}catch(e){if(this._pendingLoads--,this._removed)return void this.fire(new t.l("dataabort",{dataType:"source"}));this.fire(new t.k(e))}}))}loaded(){return 0===this._pendingLoads}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const i={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const r=yield this.actor.sendAsync({type:t,data:i},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(r,this.map.painter,"RT"===t)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class K extends t.E{constructor(e,t,i,r){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=t}load(e){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield f.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,this.fire(new t.k(e))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const i=e.map(t.$.fromLngLat);var r;return this.tileID=function(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s=Math.max(n-i,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.a1(a,Math.floor((i+n)/2*l),Math.floor((r+o)/2*l))}(i),this.terrainTileRanges=this._getOverlappingTileRanges(i),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=i.map((e=>this.tileID.getTilePoint(e)._round())),this.flippedWindingOrder=((r=this.tileCoords)[1].x-r[0].x)*(r[2].y-r[0].y)-(r[1].y-r[0].y)*(r[2].x-r[0].x)<0,this.fire(new t.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,i=e.gl;this.texture||(this.texture=new _(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){let i=1/0,r=1/0,n=-1/0,o=-1/0;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);const s={};for(let e=0;e<=t.a0;e++){const t=Math.pow(2,e),a=Math.floor(i*t),l=Math.floor(r*t),c=Math.floor(n*t),u=Math.floor(o*t);s[e]={minTileX:a,minTileY:l,maxTileX:c,maxTileY:u}}return s}}class Y extends K{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.a2(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new t.k(e))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.k(new t.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new _(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class J extends K{constructor(e,i,r,n){super(e,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new t.k(new t.a3(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.k(new t.a3(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.k(new t.a3(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.k(new t.a3(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.k(new t.a3(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,r=i.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _(i,this.canvas,r.RGBA,{premultiply:!0});let n=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,n=!0)}n&&this.fire(new t.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Q={},ee=e=>{switch(e){case"geojson":return X;case"image":return K;case"raster":return W;case"raster-dem":return H;case"vector":return Z;case"video":return Y;case"canvas":return J}return Q[e]},te="RTLPluginLoaded";class ie extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=F()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((e=>{throw this.status="error",e}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,(function*(e,t=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=s.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!t)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return t._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.l(te))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let re=null;function ne(){return re||(re=new ie),re}class oe{constructor(e,i){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a4(),this.uses=0,this.tileSize=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,i,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.id]=r}}return i}(e.buckets,null==i?void 0:i.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a6){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const i=this.buckets[e];if(i instanceof t.a6&&i.hasRTLText){this.hasRTLText=!0,ne().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const i=this.buckets[t];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,i,r,n,o,s,a,l,c,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l,getElevation:u},e,t,i):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),o=i&&i.sourceLayer?i.sourceLayer:"",s=n._geojsonTileLayer||n[o];if(!s)return;const a=t.a7(i&&i.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let i=0;i<s.length;i++){const n=s.feature(i);if(a.needGeometry){const e=t.a8(n,!0);if(!a.filter(new t.C(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.C(this.tileID.overscaledZ),n))continue;const d=r.getId(n,o),p=new t.a9(n,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const i=t.aa(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else{const r=this.expirationTime-i;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const i=this.latestFeatureIndex.loadVTLayers();for(const r in this.buckets){if(!t.style.hasLayer(r))continue;const n=this.buckets[r],o=n.layers[0].sourceLayer||"_geojsonTileLayer",s=i[o],a=e[o];if(!s||!a||0===Object.keys(a).length)continue;n.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(n)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=s.now()+e}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}}class se{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const e of t)this.remove(e.value.tileID,e)}}class ae{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const n=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},t.e(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),n=t.e({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][i];if(null===t)return{};for(const e in t)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,i){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const i={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),t.e(this.state[e][r],this.stateChanges[e][r]),i[r]=this.state[e][r];r[e]=i}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const i={};if(null===this.deletedStates[e])for(const t in this.state[e])i[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const i of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][i];i[t]=this.state[e][t]}r[e]=r[e]||{},t.e(r[e],i)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const t in e)e[t].setFeatureState(r,i)}}const le=89.25;function ce(e,i){const r=t.ae(i.lat,-85.051129,t.af);return new t.P(t.U(i.lng)*e,t.S(r)*e)}function ue(e,i){return new t.$(i.x/e,i.y/e).toLngLat()}function he(e){return e.cameraToCenterDistance*Math.min(.85*Math.tan(t.ab(90-e.pitch)),Math.tan(t.ab(le-e.pitch)))}function de(e,i){const r=e.canonical,n=i/t.ac(r.z),o=r.x+Math.pow(2,r.z)*e.wrap,s=t.ad(new Float64Array(16));return t.L(s,s,[o*n,r.y*n,0]),t.M(s,s,[n/t.Z,n/t.Z,1]),s}function pe(e,i,r,n,o){const s=t.$.fromLngLat(e,i),a=o*t.ag(1,e.lat),l=a*Math.cos(t.ab(r)),c=Math.sqrt(a*a-l*l),u=c*Math.sin(t.ab(-n)),h=c*Math.cos(t.ab(-n));return new t.$(s.x+u,s.y+h,s.z+l)}function fe(e,t,i){const r=t.intersectsFrustum(e);if(!i)return r;const n=t.intersectsPlane(i);return 0===r||0===n?0:2===r&&2===n?2:1}function me(e,t,i){let r=0;const n=(i-t)/10;for(let o=0;o<10;o++)r+=n*Math.pow(Math.cos(t+(o+.5)/10*(i-t)),e);return r}function ge(e,i){return function(r,n,o,s,a){const l=2*((e-1)/t.ah(Math.cos(t.ab(le-a))/Math.cos(t.ab(le)))-1),c=Math.acos(o/s),u=2*me(l-1,0,t.ab(a/2)),h=Math.min(t.ab(le),c+t.ab(a/2)),d=me(l-1,Math.min(h,c-t.ab(a/2)),h),p=Math.atan(n/o),f=Math.hypot(n,o);let m=r;return m+=t.ah(s/f/Math.max(.5,Math.cos(t.ab(a/2)))),m+=l*t.ah(Math.cos(p))/2,m-=t.ah(Math.max(1,d/u/i))/2,m}}const ye=ge(9.314,3);function _e(e,i){const r=(i.roundZoom?Math.round:Math.floor)(e.zoom+t.ah(e.tileSize/i.tileSize));return Math.max(0,r)}function ve(e,i){const r=e.getCameraFrustum(),n=e.getClippingPlane(),o=e.screenPointToMercatorCoordinate(e.getCameraPoint()),s=t.$.fromLngLat(e.center,e.elevation);o.z=s.z+Math.cos(e.pitchInRadians)*e.cameraToCenterDistance/e.worldSize;const a=e.getCoveringTilesDetailsProvider(),l=a.allowVariableZoom(e,i),c=_e(e,i),u=i.minzoom||0,h=void 0!==i.maxzoom?i.maxzoom:e.maxZoom,d=Math.min(Math.max(0,c),h),p=Math.pow(2,d),f=[p*o.x,p*o.y,0],m=[p*s.x,p*s.y,0],g=Math.hypot(s.x-o.x,s.y-o.y),y=Math.abs(s.z-o.z),_=Math.hypot(g,y),v=e=>({zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),x=[],b=[];if(e.renderWorldCopies&&a.allowWorldCopies())for(let e=1;e<=3;e++)x.push(v(-e)),x.push(v(e));for(x.push(v(0));x.length>0;){const p=x.pop(),g=p.x,v=p.y;let w=p.fullyVisible;const T={x:g,y:v,z:p.zoom},S=a.getTileAABB(T,p.wrap,e.elevation,i);if(!w){const e=fe(r,S,n);if(0===e)continue;w=2===e}const C=a.distanceToTile2d(o.x,o.y,T,S);let M=c;l&&(M=(i.calculateTileZoom||ye)(e.zoom+t.ah(e.tileSize/i.tileSize),C,y,_,e.fov)),M=(i.roundZoom?Math.round:Math.floor)(M),M=Math.max(0,M);const k=Math.min(M,h);if(p.wrap=a.getWrap(s,T,p.wrap),p.zoom>=k){if(p.zoom<u)continue;const e=d-p.zoom,r=f[0]-.5-(g<<e),n=f[1]-.5-(v<<e),o=i.reparseOverscaled?Math.max(p.zoom,M):p.zoom;b.push({tileID:new t.Y(p.zoom===h?o:p.zoom,p.wrap,p.zoom,g,v),distanceSq:t.ai([m[0]-.5-g,m[1]-.5-v]),tileDistanceToCamera:Math.sqrt(r*r+n*n)})}else for(let e=0;e<4;e++)x.push({zoom:p.zoom+1,x:(g<<1)+e%2,y:(v<<1)+(e>>1),wrap:p.wrap,fullyVisible:w})}return b.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}class xe extends t.E{constructor(e,t,i){super(),this.id=e,this.dispatcher=i,this.on("data",(e=>this._dataHandler(e))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,t,i,r)=>{const n=new(ee(t.type))(e,t,i,r);if(n.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${n.id}`);return n})(e,t,i,this),this._tiles={},this._cache=new se(0,(e=>this._unloadTile(e))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ae,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,i,r){return t._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,i,r)}catch(i){e.state="errored",404!==i.status?this._source.fire(new t.k(i,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(be).map((e=>e.key))}getRenderableIds(e){const i=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&i.push(this._tiles[t]);return e?i.sort(((e,i)=>{const r=e.tileID,n=i.tileID,o=new t.P(r.canonical.x,r.canonical.y)._rotate(-this.transform.bearingInRadians),s=new t.P(n.canonical.x,n.canonical.y)._rotate(-this.transform.bearingInRadians);return r.overscaledZ-n.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):i.map((e=>e.tileID)).sort(be).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)(e||"errored"!==this._tiles[t].state)&&this._reloadTile(t,"reloading")}}_reloadTile(e,i){return t._(this,void 0,void 0,(function*(){const t=this._tiles[e];t&&("loading"!==t.state&&(t.state=i),yield this._loadTile(t,e,i))}))}_tileLoaded(e,i,r){e.timeAdded=s.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let o=this._tiles[n];if(r[n]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>i)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]||e[a.canonical.key]){r[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const i=Math.ceil(e.width/this._source.tileSize)+1,r=Math.ceil(e.height/this._source.tileSize)+1,n=Math.floor(i*r*(null===this._maxTileCacheZoomLevels?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(e,t,i,r,n,o){const a={},l={},c=Object.keys(e),u=s.now();for(const i of c){const r=e[i],n=this._tiles[i];if(!n||0!==n.fadeEndTime&&n.fadeEndTime<=u)continue;const o=this.findLoadedParent(r,t),s=this.findLoadedSibling(r),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[i]=r}this._retainLoadedChildren(l,r,i,e);for(const t in a)e[t]||(this._coveredTiles[t]=!0,e[t]=a[t]);if(o){const t={},i={};for(const e of n)this._tiles[e.key].hasData()?t[e.key]=e:i[e.key]=e;for(const r in i){const n=i[r].children(this._source.maxzoom);this._tiles[n[0].key]&&this._tiles[n[1].key]&&this._tiles[n[2].key]&&this._tiles[n[3].key]&&(t[n[0].key]=e[n[0].key]=n[0],t[n[1].key]=e[n[1].key]=n[1],t[n[2].key]=e[n[2].key]=n[2],t[n[3].key]=e[n[3].key]=n[3],delete i[r])}for(const r in i){const n=i[r],o=this.findLoadedParent(n,this._source.minzoom),s=this.findLoadedSibling(n),a=o||s||null;if(a){t[a.tileID.key]=e[a.tileID.key]=a.tileID;for(const e in t)t[e].isChildOf(a.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}update(e,i){if(!this._sourceLoaded||this._paused)return;let r;this.transform=e,this.terrain=i,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.Y(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(r=ve(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:i,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(r=r.filter((e=>this._source.hasTile(e))))):r=[];const n=_e(e,this._source),o=Math.max(n-xe.maxOverzooming,this._source.minzoom),s=Math.max(n+xe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const e={};for(const t of r)if(t.canonical.z>this._source.minzoom){const i=t.scaledTo(t.canonical.z-1);e[i.key]=i;const r=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[r.key]=r}r=r.concat(Object.values(e))}const a=0===r.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(r,n);we(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,n,r,i);for(const e in l)this._tiles[e].clearFadeHold();const c=t.aj(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var i;const r={},n={},o=Math.max(t-xe.maxOverzooming,this._source.minzoom),s=Math.max(t+xe.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);r[i.key]=i,e.hasData()||t<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,t,s,r);for(const s of e){let e=this._tiles[s.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){const e=s.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){r[e.key]=e;continue}}else{const e=s.children(this._source.maxzoom);if(r[e[0].key]&&r[e[1].key]&&r[e[2].key]&&r[e[3].key])continue}let a=e.wasRequested();for(let t=s.overscaledZ-1;t>=o;--t){const o=s.scaledTo(t);if(n[o.key])break;if(n[o.key]=!0,e=this.getTile(o),!e&&a&&(e=this._addTile(o)),e){const t=e.hasData();if((t||!(null===(i=this.map)||void 0===i?void 0:i.cancelPendingTileRequestsWhileZooming)||a)&&(r[o.key]=o),a=e.wasRequested(),t)break}}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const t=this._tiles[e].tileID,i=this._getLoadedTile(t);this._loadedSiblingTiles[t.key]=i}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=i;return i||(i=new oe(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(i,e.key,i.state)),i.uses++,this._tiles[e.key]=i,r||this._source.fire(new t.l("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}refreshTiles(e){for(const t in this._tiles)this._isIdRenderable(t)&&e.some((e=>e.equals(this._tiles[t].tileID.canonical)))&&this._reloadTile(t,"expired")}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){const t=e.sourceDataType;"source"===e.dataType&&"metadata"===t&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===t&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,i,r){const n=[],o=this.transform;if(!o)return n;const s=r?o.getCameraQueryGeometry(e):e,a=e.map((e=>o.screenPointToMercatorCoordinate(e,this.terrain))),l=s.map((e=>o.screenPointToMercatorCoordinate(e,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const e of l)u=Math.min(u,e.x),h=Math.min(h,e.y),d=Math.max(d,e.x),p=Math.max(p,e.y);for(let e=0;e<c.length;e++){const r=this._tiles[c[e]];if(r.holdingForFade())continue;const s=o.getCoveringTilesDetailsProvider().allowWorldCopies()?r.tileID:r.tileID.unwrapTo(0),f=Math.pow(2,o.zoom-r.tileID.overscaledZ),m=i*r.queryPadding*t.Z/r.tileSize/f,g=[s.getTilePoint(new t.$(u,h)),s.getTilePoint(new t.$(d,p))];if(g[0].x-m<t.Z&&g[0].y-m<t.Z&&g[1].x+m>=0&&g[1].y+m>=0){const e=a.map((e=>s.getTilePoint(e))),t=l.map((e=>s.getTilePoint(e)));n.push({tile:r,tileID:s,queryGeometry:e,cameraQueryGeometry:t,scale:f})}}return n}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));return this.transform&&this.transform.populateCache(t),t}hasTransition(){if(this._source.hasTransition())return!0;if(we(this._source.type)){const e=s.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}}function be(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function we(e){return"raster"===e||"image"===e||"video"===e}xe.maxOverzooming=10,xe.maxUnderzooming=3;class Te{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ae(e,0,1);let i=1,r=this._distances[i];const n=e*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const o=i-1,s=this._distances[o],a=r-s,l=a>0?(n-s)/a:0;return this.points[o].mult(1-l).add(this.points[i].mult(l))}}function Se(e,t){let i=!0;return"always"===e||"never"!==e&&"never"!==t||(i=!1),i}class Ce{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,o){this.boxCells[n].push(o)}_insertCircleCell(e,t,i,r,n,o){this.circleCells[n].push(o)}_query(e,t,i,r,n,o,s){if(i<0||e>this.width||r<0||t>this.height)return[];const a=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return[{key:null,x1:e,y1:t,x2:i,y2:r}];for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}}else this._forEachCell(e,t,i,r,this._queryCell,a,{hitTest:n,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(e,t,i,r){return this._query(e,t,i,r,!1,null)}hitTest(e,t,i,r,n,o){return this._query(e,t,i,r,!0,n,o).length>0}hitTestCircle(e,t,i,r,n){const o=e-i,s=e+i,a=t-i,l=t+i;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),c.length>0}_queryCell(e,t,i,r,n,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const n=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(e<=n[h+2]&&t<=n[h+3]&&i>=n[h+0]&&r>=n[h+1]&&(!a||a(d))&&(!c||!Se(u,d.overlapMode))&&(o.push({key:d,x1:n[h],y1:n[h+1],x2:n[h+2],y2:n[h+3]}),c))return!0}}const d=this.circleCells[n];if(null!==d){const n=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],e,t,i,r)&&(!a||a(d))&&(!c||!Se(u,d.overlapMode))){const e=n[h],t=n[h+1],i=n[h+2];if(o.push({key:d,x1:e-i,y1:t-i,x2:e+i,y2:t+i}),c)return!0}}}return!1}_queryCellCircle(e,t,i,r,n,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t,r=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(r))&&!Se(u,r.overlapMode))return o.push(!0),!0}}const d=this.circleCells[n];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const i=3*t,r=this.circleKeys[t];if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(r))&&!Se(u,r.overlapMode))return o.push(!0),!0}}}_forEachCell(e,t,i,r,n,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),h=this._convertToYCellCoord(r);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,o){const s=r-e,a=n-t,l=i+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,i,r,n,o,s){const a=(o-r)/2,l=Math.abs(e-(r+a));if(l>a+i)return!1;const c=(s-n)/2,u=Math.abs(t-(n+c));if(u>c+i)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=i*i}}function Me(e,i,n){const o=t.K();if(!e){const{vecSouth:e,vecEast:t}=Ee(i),n=r();n[0]=t[0],n[1]=t[1],n[2]=e[0],n[3]=e[1],s=n,(d=(l=(a=n)[0])*(h=a[3])-(u=a[2])*(c=a[1]))&&(s[0]=h*(d=1/d),s[1]=-c*d,s[2]=-u*d,s[3]=l*d),o[0]=n[0],o[1]=n[1],o[4]=n[2],o[5]=n[3]}var s,a,l,c,u,h,d;return t.M(o,o,[1/n,1/n,1]),o}function ke(e,i,r,n){if(e){const e=t.K();if(!i){const{vecSouth:t,vecEast:i}=Ee(r);e[0]=i[0],e[1]=i[1],e[4]=t[0],e[5]=t[1]}return t.M(e,e,[n,n,1]),e}return r.pixelsToClipSpaceMatrix}function Ee(e){const i=Math.cos(e.rollInRadians),r=Math.sin(e.rollInRadians),n=Math.cos(e.pitchInRadians),o=Math.cos(e.bearingInRadians),s=Math.sin(e.bearingInRadians),a=t.ao();a[0]=-o*n*r-s*i,a[1]=-s*n*r+o*i;const l=t.ap(a);l<1e-9?t.aq(a):t.ar(a,a,1/l);const c=t.ao();c[0]=o*n*i-s*r,c[1]=s*n*i+o*r;const u=t.ap(c);return u<1e-9?t.aq(c):t.ar(c,c,1/u),{vecEast:c,vecSouth:a}}function Ae(e,i,r,n){let o;n?(o=[e,i,n(e,i),1],t.at(o,o,r)):(o=[e,i,0,1],Ze(o,o,r));const s=o[3];return{point:new t.P(o[0]/s,o[1]/s),signedDistanceFromCamera:s,isOccluded:!1}}function Ie(e,t){return.5+e/t*.5}function ze(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function Pe(e,i,r,n,o,s,a,l,c,u,h,d,p){const f=r?e.textSizeData:e.iconSizeData,m=t.ak(f,i.transform.zoom),g=[256/i.width*2+1,256/i.height*2+1],y=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;y.clear();const _=e.lineVertexArray,v=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,x=i.transform.width/i.transform.height;let b=!1;for(let r=0;r<v.length;r++){const w=v.get(r);if(w.hidden||w.writingMode===t.al.vertical&&!b){qe(w.numGlyphs,y);continue}b=!1;const T=new t.P(w.anchorX,w.anchorY),S={getElevation:p,pitchedLabelPlaneMatrix:n,lineVertexArray:_,pitchWithMap:s,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:i.transform,tileAnchorPoint:T,unwrappedTileID:c,width:u,height:h,translation:d},C=$e(w.anchorX,w.anchorY,S);if(!ze(C.point,g)){qe(w.numGlyphs,y);continue}const M=Ie(i.transform.cameraToCenterDistance,C.signedDistanceFromCamera),k=t.am(f,m,w),E=s?k*i.transform.getPitchedTextCorrection(w.anchorX,w.anchorY,c)/M:k*M,A=Re({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:E,flip:!1,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l});b=A.useVertical,(A.notEnoughRoom||b||A.needsFlipping&&Re({projectionContext:S,pitchedLabelPlaneMatrixInverse:o,symbol:w,fontSize:E,flip:!0,keepUpright:a,glyphOffsetArray:e.glyphOffsetArray,dynamicLayoutVertexArray:y,aspectRatio:x,rotateToLine:l}).notEnoughRoom)&&qe(w.numGlyphs,y)}r?e.text.dynamicLayoutVertexBuffer.updateData(y):e.icon.dynamicLayoutVertexBuffer.updateData(y)}function Le(e,t,i,r,n,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=t.getoffsetX(o.glyphStartIndex),d=t.getoffsetX(l-1),p=Ve(e*h,i,r,n,o.segment,c,u,a,s);if(!p)return null;const f=Ve(e*d,i,r,n,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function De(e,i,r,n){return e===t.al.horizontal&&Math.abs(r.y-i.y)>Math.abs(r.x-i.x)*n?{useVertical:!0}:(e===t.al.vertical?i.y<r.y:i.x>r.x)?{needsFlipping:!0}:null}function Re(e){const{projectionContext:i,pitchedLabelPlaneMatrixInverse:r,symbol:n,fontSize:o,flip:s,keepUpright:a,glyphOffsetArray:l,dynamicLayoutVertexArray:c,aspectRatio:u,rotateToLine:h}=e,d=o/24,p=n.lineOffsetX*d,f=n.lineOffsetY*d;let m;if(n.numGlyphs>1){const e=n.glyphStartIndex+n.numGlyphs,t=n.lineStartIndex,o=n.lineStartIndex+n.lineLength,c=Le(d,l,p,f,s,n,h,i);if(!c)return{notEnoughRoom:!0};const g=je(c.first.point.x,c.first.point.y,i,r),y=je(c.last.point.x,c.last.point.y,i,r);if(a&&!s){const e=De(n.writingMode,g,y,u);if(e)return e}m=[c.first];for(let r=n.glyphStartIndex+1;r<e-1;r++)m.push(Ve(d*l.getoffsetX(r),p,f,s,n.segment,t,o,i,h));m.push(c.last)}else{if(a&&!s){const e=Fe(i.tileAnchorPoint.x,i.tileAnchorPoint.y,i).point,o=n.lineStartIndex+n.segment+1,s=new t.P(i.lineVertexArray.getx(o),i.lineVertexArray.gety(o)),a=Fe(s.x,s.y,i),l=a.signedDistanceFromCamera>0?a.point:Be(i.tileAnchorPoint,s,e,1,i),c=je(e.x,e.y,i,r),h=je(l.x,l.y,i,r),d=De(n.writingMode,c,h,u);if(d)return d}const e=Ve(d*l.getoffsetX(n.glyphStartIndex),p,f,s,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,i,h);if(!e||i.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[e]}for(const e of m)t.as(c,e.point,e.angle);return{}}function Be(e,t,i,r,n){const o=e.add(e.sub(t)._unit()),s=Fe(o.x,o.y,n).point,a=i.sub(s);return i.add(a._mult(r/a.mag()))}function Oe(e,i,r){const n=i.projectionCache;if(n.projections[e])return n.projections[e];const o=new t.P(i.lineVertexArray.getx(e),i.lineVertexArray.gety(e)),s=Fe(o.x,o.y,i);if(s.signedDistanceFromCamera>0)return n.projections[e]=s.point,n.anyProjectionOccluded=n.anyProjectionOccluded||s.isOccluded,s.point;const a=e-r.direction;return Be(0===r.distanceFromAnchor?i.tileAnchorPoint:new t.P(i.lineVertexArray.getx(a),i.lineVertexArray.gety(a)),o,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,i)}function Fe(e,t,i){const r=e+i.translation[0],n=t+i.translation[1];let o;return i.pitchWithMap?(o=Ae(r,n,i.pitchedLabelPlaneMatrix,i.getElevation),o.isOccluded=!1):(o=i.transform.projectTileCoordinates(r,n,i.unwrappedTileID,i.getElevation),o.point.x=(.5*o.point.x+.5)*i.width,o.point.y=(.5*-o.point.y+.5)*i.height),o}function je(e,i,r,n){if(r.pitchWithMap){const o=[e,i,0,1];return t.at(o,o,n),r.transform.projectTileCoordinates(o[0]/o[3],o[1]/o[3],r.unwrappedTileID,r.getElevation).point}return{x:e/r.width*2-1,y:i/r.height*2-1}}function $e(e,t,i){return i.transform.projectTileCoordinates(e,t,i.unwrappedTileID,i.getElevation)}function Ne(e,t,i){return e._unit()._perp()._mult(t*i)}function Ue(e,i,r,n,o,s,a,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=r.add(i);if(e+c.direction<n||e+c.direction>=o)return l.projectionCache.offsets[e]=u,u;const h=Oe(e+c.direction,l,c),d=Ne(h.sub(r),a,c.direction),p=r.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.au(s,u,p,f)||u,l.projectionCache.offsets[e]}function Ve(e,t,i,r,n,o,s,a,l){const c=r?e-t:e+t;let u=c>0?1:-1,h=0;r&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+n:o+n+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=Fe(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,m,g=d,y=d,_=0,v=0;const x=Math.abs(c),b=[];let w;for(;_+v<=x;){if(p+=u,p<o||p>=s)return null;_+=v,y=g,m=f;const e={absOffsetX:x,direction:u,distanceFromAnchor:_,previousVertex:y};if(g=Oe(p,a,e),0===i)b.push(y),w=g.sub(y);else{let t;const r=g.sub(y);t=0===r.mag()?Ne(Oe(p+u,a,e).sub(g),i,u):Ne(r,i,u),m||(m=y.add(t)),f=Ue(p,t,g,o,s,m,i,a,e),b.push(m),w=f.sub(m)}v=w.mag()}const T=w._mult((x-_)/v)._add(m||y),S=h+Math.atan2(g.y-y.y,g.x-y.x);return b.push(T),{point:T,angle:l?S:0,path:b}}const Ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function qe(e,t){for(let i=0;i<e;i++){const e=t.length;t.resize(e+4),t.float32.set(Ge,3*e)}}function Ze(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const We=100;class He{constructor(e,t=new Ce(e.width+200,e.height+200,25),i=new Ce(e.width+200,e.height+200,25)){this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+We,this.screenBottomBoundary=e.height+We,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,i,r,n,o,s,a,l,c,u,h){const d=this.projectAndGetPerspectiveRatio(e.anchorPointX+a[0],e.anchorPointY+a[1],n,c,h),p=i*d.perspectiveRatio;let f;if(o||s)f=this._projectCollisionBox(e,p,r,n,o,s,a,d,c,u,h);else{const t=d.x+(u?u.x*p:0),i=d.y+(u?u.y*p:0);f={allPointsOccluded:!1,box:[t+e.x1*p,i+e.y1*p,t+e.x2*p,i+e.y2*p]}}const[m,g,y,_]=f.box,v=o?f.allPointsOccluded:d.isOccluded;let x=v;return x||(x=d.perspectiveRatio<this.perspectiveRatioCutoff),x||(x=!this.isInsideGrid(m,g,y,_)),x||"always"!==t&&this.grid.hitTest(m,g,y,_,t,l)?{box:[m,g,y,_],placeable:!1,offscreen:!1,occluded:v}:{box:[m,g,y,_],placeable:!0,offscreen:this.isOffscreen(m,g,y,_),occluded:v}}placeCollisionCircles(e,i,r,n,o,s,a,l,c,u,h,d,p,f){const m=[],g=new t.P(i.anchorX,i.anchorY),y=this.getPerspectiveRatio(g.x,g.y,s,f),_=(c?o*this.transform.getPitchedTextCorrection(i.anchorX,i.anchorY,s)/y:o*y)/t.ay,v={getElevation:f,pitchedLabelPlaneMatrix:a,lineVertexArray:r,pitchWithMap:c,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:g,unwrappedTileID:s,width:this.transform.width,height:this.transform.height,translation:p},x=Le(_,n,i.lineOffsetX*_,i.lineOffsetY*_,!1,i,!1,v);let b=!1,w=!1,T=!0;if(x){const i=.5*h*y+d,r=new t.P(-100,-100),n=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new Te,s=x.first,a=x.last;let p=[];for(let e=s.path.length-1;e>=1;e--)p.push(s.path[e]);for(let e=1;e<a.path.length;e++)p.push(a.path[e]);const f=2.5*i;if(c){const e=this.projectPathToScreenSpace(p,v);p=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let g=[];if(p.length>0){const e=p[0].clone(),i=p[0].clone();for(let t=1;t<p.length;t++)e.x=Math.min(e.x,p[t].x),e.y=Math.min(e.y,p[t].y),i.x=Math.max(i.x,p[t].x),i.y=Math.max(i.y,p[t].y);g=e.x>=r.x&&i.x<=n.x&&e.y>=r.y&&i.y<=n.y?[p]:i.x<r.x||e.x>n.x||i.y<r.y||e.y>n.y?[]:t.av([p],r.x,r.y,n.x,n.y)}for(const t of g){o.reset(t,.25*i);let r=0;r=o.length<=.5*i?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<r;t++){const n=t/Math.max(r-1,1),s=o.lerp(n),a=s.x+We,c=s.y+We;m.push(a,c,i,0);const h=a-i,d=c-i,p=a+i,f=c+i;if(T=T&&this.isOffscreen(h,d,p,f),w=w||this.isInsideGrid(h,d,p,f),"always"!==e&&this.grid.hitTestCircle(a,c,i,e,u)&&(b=!0,!l))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!l&&b||!w||y<this.perspectiveRatioCutoff?[]:m,offscreen:T,collisionDetected:b}}projectPathToScreenSpace(e,i){const r=function(e,i){const r=t.K();return t.an(r,i.pitchedLabelPlaneMatrix),e.map((e=>{const t=Ae(e.x,e.y,r,i.getElevation),n=i.transform.projectTileCoordinates(t.point.x,t.point.y,i.unwrappedTileID,i.getElevation);return n.point.x=(.5*n.point.x+.5)*i.width,n.point.y=(.5*-n.point.y+.5)*i.height,n}))}(e,i);return function(e){let t=0,i=0,r=0,n=0;for(let o=0;o<e.length;o++)e[o].isOccluded?(r=o+1,n=0):(n++,n>i&&(i=n,t=r));return e.slice(t,t+i)}(r)}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+We,a.y+We);r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),i.push(e)}const a=this.grid.query(r,n,o,s).concat(this.ignoredGrid.query(r,n,o,s)),l={},c={};for(const e of a){const r=e.key;if(void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]={}),l[r.bucketInstanceId][r.featureIndex])continue;const n=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.aw(i,n)&&(l[r.bucketInstanceId][r.featureIndex]=!0,void 0===c[r.bucketInstanceId]&&(c[r.bucketInstanceId]=[]),c[r.bucketInstanceId].push(r.featureIndex))}return c}insertCollisionBox(e,t,i,r,n,o){(i?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n,o){const s=i?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:o,overlapMode:t};for(let t=0;t<e.length;t+=4)s.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,i,r,n,o){if(o){let r;n?(r=[e,i,n(e,i),1],t.at(r,r,o)):(r=[e,i,0,1],Ze(r,r,o));const s=r[3];return{x:(r[0]/s+1)/2*this.transform.width+We,y:(-r[1]/s+1)/2*this.transform.height+We,perspectiveRatio:.5+this.transform.cameraToCenterDistance/s*.5,isOccluded:!1,signedDistanceFromCamera:s}}{const t=this.transform.projectTileCoordinates(e,i,r,n);return{x:(t.point.x+1)/2*this.transform.width+We,y:(1-t.point.y)/2*this.transform.height+We,perspectiveRatio:.5+this.transform.cameraToCenterDistance/t.signedDistanceFromCamera*.5,isOccluded:t.isOccluded,signedDistanceFromCamera:t.signedDistanceFromCamera}}}getPerspectiveRatio(e,t,i,r){const n=this.transform.projectTileCoordinates(e,t,i,r);return.5+this.transform.cameraToCenterDistance/n.signedDistanceFromCamera*.5}isOffscreen(e,t,i,r){return i<We||e>=this.screenRightBoundary||r<We||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.ad([]);return t.L(e,e,[-100,-100,0]),e}_projectCollisionBox(e,i,r,n,o,s,a,l,c,u,h){let d=1,p=0,f=0,m=1;const g=e.anchorPointX+a[0],y=e.anchorPointY+a[1];if(s&&!o){const e=this.projectAndGetPerspectiveRatio(g+1,y,n,c,h),t=e.x-l.x,i=Math.atan((e.y-l.y)/t)+(t<0?Math.PI:0),r=Math.sin(i),o=Math.cos(i);d=o,p=r,f=-r,m=o}else if(!s&&o){const e=Ee(this.transform);d=e.vecEast[0],p=e.vecEast[1],f=e.vecSouth[0],m=e.vecSouth[1]}let _=l.x,v=l.y,x=i;o&&(_=g,v=y,x=Math.pow(2,-(this.transform.zoom-r.overscaledZ)),x*=this.transform.getPitchedTextCorrection(g,y,n),u||(x*=t.ae(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),u&&(_+=d*u.x*x+f*u.y*x,v+=p*u.x*x+m*u.y*x);const b=e.x1*x,w=e.x2*x,T=(b+w)/2,S=e.y1*x,C=e.y2*x,M=(S+C)/2,k=[{offsetX:b,offsetY:S},{offsetX:T,offsetY:S},{offsetX:w,offsetY:S},{offsetX:w,offsetY:M},{offsetX:w,offsetY:C},{offsetX:T,offsetY:C},{offsetX:b,offsetY:C},{offsetX:b,offsetY:M}];let E=[];for(const{offsetX:e,offsetY:i}of k)E.push(new t.P(_+d*e+f*i,v+p*e+m*i));let A=!1;if(o){const e=E.map((e=>this.projectAndGetPerspectiveRatio(e.x,e.y,n,c,h)));A=e.some((e=>!e.isOccluded)),E=e.map((e=>new t.P(e.x,e.y)))}else A=!0;return{box:t.ax(E),allPointsOccluded:!A}}}class Xe{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Ke{constructor(e,t,i,r,n){this.text=new Xe(e?e.text:null,t,i,n),this.icon=new Xe(e?e.icon:null,t,r,n)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ye{constructor(e,t,i){this.text=e,this.icon=t,this.skipFade=i}}class Je{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Qe{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function et(e,i,r,n,o){const{horizontalAlign:s,verticalAlign:a}=t.aE(e);return new t.P(-(s-.5)*i+n[0]*o,-(a-.5)*r+n[1]*o)}class tt{constructor(e,t,i,r,n){this.transform=e.clone(),this.terrain=t,this.collisionIndex=new He(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new Qe(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(i,r)=>t.getElevation(e,i,r):null}getBucketParts(e,i,r,n){const o=r.getBucket(i),s=r.latestFeatureIndex;if(!o||!s||i.id!==o.layerIds[0])return;const a=r.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/t.Z,d=r.tileID.toUnwrapped(),p="map"===l.get("text-rotation-alignment"),f=t.az(r,1,this.transform.zoom),m=t.aA(this.collisionIndex.transform,r,c.get("text-translate"),c.get("text-translate-anchor")),g=t.aA(this.collisionIndex.transform,r,c.get("icon-translate"),c.get("icon-translate-anchor")),y=Me(p,this.transform,f);this.retainedQueryData[o.bucketInstanceId]=new Je(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const _={bucket:o,layout:l,translationText:m,translationIcon:g,unwrappedTileID:d,pitchedLabelPlaneMatrix:y,scale:u,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.ak(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(n)for(const t of o.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=t;e.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:_})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:_})}attemptAnchorPlacement(e,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_,v,x){const b=t.aB[e.textAnchor],w=[e.textOffset0,e.textOffset1],T=et(b,r,n,w,o),S=this.collisionIndex.placeCollisionBox(i,d,l,c,u,a,s,g,h.predicate,v,T,x);if((!_||this.collisionIndex.placeCollisionBox(_,d,l,c,u,a,s,y,h.predicate,v,T,x).placeable)&&S.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:w,width:r,height:n,anchor:b,textBoxScale:o,prevAnchor:e},this.markUsedJustification(f,b,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:T,placedGlyphBoxes:S}}}placeLayerBucketPart(e,i,r){const{bucket:n,layout:o,translationText:s,translationIcon:a,unwrappedTileID:l,pitchedLabelPlaneMatrix:c,textPixelRatio:u,holdingForFade:h,collisionBoxArray:d,partiallyEvaluatedTextSize:p,collisionGroup:f}=e.parameters,m=o.get("text-optional"),g=o.get("icon-optional"),y=t.aC(o,"text-overlap","text-allow-overlap"),_="always"===y,v=t.aC(o,"icon-overlap","icon-allow-overlap"),x="always"===v,b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),T="none"!==o.get("icon-text-fit"),S="viewport-y"===o.get("symbol-z-order"),C=_&&(x||!n.hasIconData()||g),M=x&&(_||!n.hasTextData()||m);!n.collisionArrays&&d&&n.deserializeCollisionBoxes(d);const k=this.retainedQueryData[n.bucketInstanceId].tileID,E=this._getTerrainElevationFunc(k),A=this.transform.getFastPathSimpleProjectionMatrix(k),I=(e,d,x)=>{var S,I;if(i[e.crossTileID])return;if(h)return void(this.placements[e.crossTileID]=new Ye(!1,!1,!1));let z=!1,P=!1,L=!0,D=null,R={box:null,placeable:!1,offscreen:null,occluded:!1},B={placeable:!1},O=null,F=null,j=null,$=0,N=0,U=0;d.textFeatureIndex?$=d.textFeatureIndex:e.useRuntimeCollisionCircles&&($=e.featureIndex),d.verticalTextFeatureIndex&&(N=d.verticalTextFeatureIndex);const V=d.textBox;if(V){const i=i=>{let r=t.al.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(n,r,e))}return r},o=(i,r)=>{if(n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&d.verticalTextBox){for(const e of n.writingModes)if(e===t.al.vertical?(R=r(),B=R):R=i(),R&&R.placeable)break}else R=i()},c=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===c){const r=(t,i)=>{const r=this.collisionIndex.placeCollisionBox(t,y,u,k,l,w,b,s,f.predicate,E,void 0,A);return r&&r.placeable&&(this.markUsedOrientation(n,i,e),this.placedOrientations[e.crossTileID]=i),r};o((()=>r(V,t.al.horizontal)),(()=>{const i=d.verticalTextBox;return n.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&i?r(i,t.al.vertical):{box:null,offscreen:null}})),i(R&&R.placeable)}else{let p=t.aB[null===(I=null===(S=this.prevPlacement)||void 0===S?void 0:S.variableOffsets[e.crossTileID])||void 0===I?void 0:I.anchor];const m=(t,i,o)=>{const d=t.x2-t.x1,m=t.y2-t.y1,g=e.textBoxScale,_=T&&"never"===v?i:null;let x=null,S="never"===y?1:2,C="never";p&&S++;for(let i=0;i<S;i++){for(let i=c;i<h;i++){const r=n.textAnchorOffsets.get(i);if(p&&r.textAnchor!==p)continue;const c=this.attemptAnchorPlacement(r,t,d,m,g,b,w,u,k,l,f,C,e,n,o,s,a,_,E);if(c&&(x=c.placedGlyphBoxes,x&&x.placeable))return z=!0,D=c.shift,x}p?p=null:C=y}return r&&!x&&(x={box:this.collisionIndex.placeCollisionBox(V,"always",u,k,l,w,b,s,f.predicate,E,void 0,A).box,offscreen:!1,placeable:!1,occluded:!1}),x};o((()=>m(V,d.iconBox,t.al.horizontal)),(()=>{const i=d.verticalTextBox;return n.allowVerticalPlacement&&(!R||!R.placeable)&&e.numVerticalGlyphVertices>0&&i?m(i,d.verticalIconBox,t.al.vertical):{box:null,occluded:!0,offscreen:null}})),R&&(z=R.placeable,L=R.offscreen);const g=i(R&&R.placeable);if(!z&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(n,t.anchor,e,g))}}}if(O=R,z=O&&O.placeable,L=O&&O.offscreen,e.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),a=t.am(n.textSizeData,p,i),u=o.get("text-padding");F=this.collisionIndex.placeCollisionCircles(y,i,n.lineVertexArray,n.glyphOffsetArray,a,l,c,r,w,f.predicate,e.collisionCircleDiameter,u,s,E),F.circles.length&&F.collisionDetected&&!r&&t.w("Collisions detected, but collision boxes are not shown"),z=_||F.circles.length>0&&!F.collisionDetected,L=L&&F.offscreen}if(d.iconFeatureIndex&&(U=d.iconFeatureIndex),d.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,v,u,k,l,w,b,a,f.predicate,E,T&&D?D:void 0,A);B&&B.placeable&&d.verticalIconBox?(j=e(d.verticalIconBox),P=j.placeable):(j=e(d.iconBox),P=j.placeable),L=L&&j.offscreen}const G=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,q=g||0===e.numIconVertices;G||q?q?G||(P=P&&z):z=P&&z:P=z=P&&z;const Z=P&&j.placeable;if(z&&O.placeable&&this.collisionIndex.insertCollisionBox(O.box,y,o.get("text-ignore-placement"),n.bucketInstanceId,B&&B.placeable&&N?N:$,f.ID),Z&&this.collisionIndex.insertCollisionBox(j.box,v,o.get("icon-ignore-placement"),n.bucketInstanceId,U,f.ID),F&&z&&this.collisionIndex.insertCollisionCircles(F.circles,y,o.get("text-ignore-placement"),n.bucketInstanceId,$,f.ID),r&&this.storeCollisionData(n.bucketInstanceId,x,d,O,j,F),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===n.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new Ye((z||C)&&!(null==O?void 0:O.occluded),(P||M)&&!(null==j?void 0:j.occluded),L||n.justReloaded),i[e.crossTileID]=!0};if(S){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=n.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let e=t.length-1;e>=0;--e){const i=t[e];I(n.symbolInstances.get(i),n.collisionArrays[i],i)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)I(n.symbolInstances.get(t),n.collisionArrays[t],t);n.justReloaded=!1}storeCollisionData(e,t,i,r,n,o){if(i.textBox||i.iconBox){let o,s;this.collisionBoxArrays.has(e)?o=this.collisionBoxArrays.get(e):(o=new Map,this.collisionBoxArrays.set(e,o)),o.has(t)?s=o.get(t):(s={text:null,icon:null},o.set(t,s)),i.textBox&&(s.text=r.box),i.iconBox&&(s.icon=n.box)}if(o){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=[]);for(let e=0;e<o.circles.length;e+=4)t.push(o.circles[e+0]-We),t.push(o.circles[e+1]-We),t.push(o.circles[e+2]),t.push(o.collisionDetected?1:0)}}markUsedJustification(e,i,r,n){let o;o=n===t.al.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.aD(i)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,i,r){const n=i===t.al.horizontal||i===t.al.horizontalOnly?i:0,o=i===t.al.vertical?i:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=n;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=n[e];o?(this.opacities[e]=new Ke(o,r,t.text,t.icon),i=i||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Ke(null,r,t.text,t.icon,t.skipFade),i=i||t.text||t.icon)}for(const e in n){const t=n[e];if(!this.opacities[e]){const n=new Ke(t,r,!1,!1);n.isHidden()||(this.opacities[e]=n,i=i||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i={};for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r.tileID,i,r.collisionBoxArray)}}updateBucketOpacities(e,i,r,n){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const o=e.layers[0],s=o.layout,a=new Ke(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new Ke(null,0,l&&(c||!e.hasIconData()||s.get("icon-optional")),c&&(l||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const m=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i);e.hasVisibleVertices=e.hasVisibleVertices||i!==ht},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let i=0;i<e.symbolInstances.length;i++){const n=e.symbolInstances.get(i),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=n;let c=this.opacities[l];r[l]?c=a:c||(c=f,this.opacities[l]=c),r[l]=!0;const y=n.numIconVertices>0,_=this.placedOrientations[n.crossTileID],v=_===t.al.vertical,x=_===t.al.horizontal||_===t.al.horizontalOnly;if(o>0||s>0){const t=ut(c.text);m(e.text,o,v?ht:t),m(e.text,s,x?ht:t);const i=c.text.isHidden();[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=i||v?1:0)})),n.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).hidden=i||x?1:0);const r=this.variableOffsets[n.crossTileID];r&&this.markUsedJustification(e,r.anchor,n,_);const a=this.placedOrientations[n.crossTileID];a&&(this.markUsedJustification(e,"left",n,a),this.markUsedOrientation(e,a,n))}if(y){const t=ut(c.icon),i=!(p&&n.verticalPlacedIconSymbolIndex&&v);n.placedIconSymbolIndex>=0&&(m(e.icon,n.numIconVertices,i?t:ht),e.icon.placedSymbolArray.get(n.placedIconSymbolIndex).hidden=c.icon.isHidden()),n.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,n.numVerticalIconVertices,i?ht:t),e.icon.placedSymbolArray.get(n.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const b=g&&g.has(i)?g.get(i):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const r=e.collisionArrays[i];if(r){let i=new t.P(0,0);if(r.textBox||r.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[l];e?(i=et(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&i._rotate(d?-this.transform.bearingInRadians:this.transform.bearingInRadians)):t=!1}if(r.textBox||r.verticalTextBox){let n;r.textBox&&(n=v),r.verticalTextBox&&(n=x),it(e.textCollisionBox.collisionVertexArray,c.text.placed,!t||n,b.text,i.x,i.y)}}if(r.iconBox||r.verticalIconBox){const t=Boolean(!x&&r.verticalIconBox);let n;r.iconBox&&(n=t),r.verticalIconBox&&(n=!t),it(e.iconCollisionBox.collisionVertexArray,c.icon.placed,n,b.icon,p?i.x:0,p?i.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function it(e,t,i,r,n,o){r&&0!==r.length||(r=[0,0,0,0]);const s=r[0]-We,a=r[1]-We,l=r[2]-We,c=r[3]-We;e.emplaceBack(t?1:0,i?1:0,n||0,o||0,s,a),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,l,a),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,l,c),e.emplaceBack(t?1:0,i?1:0,n||0,o||0,s,c)}const rt=Math.pow(2,25),nt=Math.pow(2,24),ot=Math.pow(2,17),st=Math.pow(2,16),at=Math.pow(2,9),lt=Math.pow(2,8),ct=Math.pow(2,1);function ut(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*rt+t*nt+i*ot+t*st+i*at+t*lt+i*ct+t}const ht=0;class dt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,i,r,n){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,i),this._currentPartIndex++,n())return!0;return!1}}class pt{constructor(e,t,i,r,n,o,s,a){this.placement=new tt(e,t,o,s,a),this._currentPlacementIndex=i.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,t,i){const r=s.now(),n=()=>!this._forceFullPlacement&&s.now()-r>2;for(;this._currentPlacementIndex>=0;){const r=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=o)&&(!r.maxzoom||r.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new dt(r)),this._inProgressLayer.continuePlacement(i[r.source],this.placement,this._showCollisionBoxes,r,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ft=512/t.Z/2;class mt{constructor(e,i,r){this.tileID=e,this.bucketInstanceId=r,this._symbolsByKey={};const n=new Map;for(let e=0;e<i.length;e++){const t=i.get(e),r=t.key,o=n.get(r);o?o.push(t):n.set(r,[t])}for(const[e,i]of n){const r={positions:i.map((e=>({x:Math.floor(e.anchorX*ft),y:Math.floor(e.anchorY*ft)}))),crossTileIDs:i.map((e=>e.crossTileID))};if(r.positions.length>128){const e=new t.aF(r.positions.length,16,Uint16Array);for(const{x:t,y:i}of r.positions)e.add(t,i);e.finish(),delete r.positions,r.index=e}this._symbolsByKey[e]=r}}getScaledCoordinates(e,i){const{x:r,y:n,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=i.canonical,c=ft/Math.pow(2,l-o),u=(a*t.Z+e.anchorY)*c,h=n*t.Z*ft;return{x:Math.floor((s*t.Z+e.anchorX)*c-r*t.Z*ft),y:Math.floor(u-h)}}findMatches(e,t,i){const r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let n=0;n<e.length;n++){const o=e.get(n);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);if(s.index){const e=s.index.range(a.x-r,a.y-r,a.x+r,a.y+r).sort();for(const t of e){const e=s.crossTileIDs[t];if(!i[e]){i[e]=!0,o.crossTileID=e;break}}}else if(s.positions)for(let e=0;e<s.positions.length;e++){const t=s.positions[e],n=s.crossTileIDs[e];if(Math.abs(t.x-a.x)<=r&&Math.abs(t.y-a.y)<=r&&!i[n]){i[n]=!0,o.crossTileID=n;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class gt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],r={};for(const e in i){const n=i[e];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[e]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const r=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,r)}else{const o=n[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,r)}}for(let e=0;e<t.symbolInstances.length;e++){const n=t.symbolInstances.get(e);n.crossTileID||(n.crossTileID=i.generate(),r[n.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new mt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.getCrossTileIDsLists())for(const t of i)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class _t{constructor(){this.layerIndexes={},this.crossTileIDs=new gt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i){let r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new yt);let n=!1;const o={};r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(n=!0),o[t.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(n=!0),n}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}var vt="void main() {fragColor=vec4(1.0);}";const xt={prelude:bt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:bt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:bt("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:bt("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:bt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:bt("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:bt(vt,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:bt("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:bt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:bt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:bt(vt,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:bt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:bt("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:bt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:bt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:bt("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:bt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:bt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bt("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;switch(u_method){case BASIC:\nbasic_hillshade(deriv);break;case COMBINED:\ncombined_hillshade(deriv);break;case IGOR:\nigor_hillshade(deriv);break;case MULTIDIRECTIONAL:\nmultidirectional_hillshade(deriv);break;case STANDARD:\ndefault:\nstandard_hillshade(deriv);break;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:bt("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:bt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:bt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:bt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:bt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:bt("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:bt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:bt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:bt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:bt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:bt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:bt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:bt("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:bt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function bt(e,t){const i=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=t.match(/in ([\w]+) ([\w]+)/g),n=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(n):n,a={};return{fragmentSource:e=e.replace(i,((e,t,i,r,n)=>(a[n]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nin ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = u_${n};\n#endif\n`))),vertexSource:t=t.replace(i,((e,t,i,r,n)=>{const o="float"===r?"vec2":"vec4",s=n.match(/color/)?"color":o;return a[n]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\nout ${i} ${r} ${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${n}\nuniform lowp float u_${n}_t;\nin ${i} ${o} a_${n};\n#else\nuniform ${i} ${r} u_${n};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = a_${n};\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${n}\n    ${i} ${r} ${n} = unpack_mix_${s}(a_${n}, u_${n}_t);\n#else\n    ${i} ${r} ${n} = u_${n};\n#endif\n`})),staticAttributes:r,staticUniforms:s}}class wt{constructor(e,t,i){this.vertexBuffer=e,this.indexBuffer=t,this.segments=i}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Tt=t.aG([{name:"a_pos",type:"Int16",components:2}]);const St="#define PROJECTION_MERCATOR",Ct="mercator";class Mt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ct}get shaderDefine(){return St}get shaderPreludeCode(){return xt.projectionMercator}get vertexShaderPreludeCode(){return xt.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,i,r,n,o){if(this._cachedMesh)return this._cachedMesh;const s=new t.aI;s.emplaceBack(0,0),s.emplaceBack(t.Z,0),s.emplaceBack(0,t.Z),s.emplaceBack(t.Z,t.Z);const a=e.createVertexBuffer(s,Tt.members),l=t.aJ.simpleSegment(0,0,4,2),c=new t.aK;c.emplaceBack(1,0,2),c.emplaceBack(1,2,3);const u=e.createIndexBuffer(c);return this._cachedMesh=new wt(a,u,l),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class kt{constructor(e=0,t=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(e,i,r){return null!=i.top&&null!=e.top&&(this.top=t.B.number(e.top,i.top,r)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.B.number(e.bottom,i.bottom,r)),null!=i.left&&null!=e.left&&(this.left=t.B.number(e.left,i.left,r)),null!=i.right&&null!=e.right&&(this.right=t.B.number(e.right,i.right,r)),this}getCenter(e,i){const r=t.ae((this.left+e-this.right)/2,0,e),n=t.ae((this.top+i-this.bottom)/2,0,i);return new t.P(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new kt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Et(e,t){if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}function At(e){return Math.max(0,Math.floor(e))}class It{constructor(e,i,r,n,o,s){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=void 0===s||!!s,this._minZoom=i||0,this._maxZoom=r||22,this._minPitch=null==n?0:n,this._maxPitch=null==o?60:o,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=At(this._zoom),this._scale=t.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new kt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,i,r){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=At(this._zoom),this._scale=t.ac(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new kt(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!r&&e.autoCalculateNearFarZ,i&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const i=t.aL(e,-180,180)*Math.PI/180;var n,o,s,a,l,c,u,h,d;this._bearingInRadians!==i&&(this._unmodified=!1,this._bearingInRadians=i,this._calcMatrices(),this._rotationMatrix=r(),n=this._rotationMatrix,s=-this._bearingInRadians,a=(o=this._rotationMatrix)[0],l=o[1],c=o[2],u=o[3],h=Math.sin(s),d=Math.cos(s),n[0]=a*d+c*h,n[1]=l*d+u*h,n[2]=a*-h+c*d,n[3]=l*-h+u*d)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const i=t.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==i&&(this._unmodified=!1,this._pitchInRadians=i,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const t=e/180*Math.PI;this._rollInRadians!==t&&(this._unmodified=!1,this._rollInRadians=t,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aM(this._fovInRadians)}setFov(e){e=t.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=t.ab(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const i=this.getConstrained(this._center,e).zoom;this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this._tileZoom=Math.max(0,Math.floor(i)),this._scale=t.ac(i),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,t){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=t,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}resize(e,t,i=!0){this._width=e,this._height=t,i&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new G([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,t.af])}getConstrained(e,t){return this._callbacks.getConstrained(e,t)}getCameraQueryGeometry(e,i){if(1===i.length)return[i[0],e];{let r=e.x,n=e.y,o=e.x,s=e.y;for(const e of i)r=Math.min(r,e.x),n=Math.min(n,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y);return[new t.P(r,n),new t.P(o,n),new t.P(o,s),new t.P(r,s),new t.P(r,n)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:i}=this.getConstrained(this.center,this.zoom);this.setCenter(t),this.setZoom(i),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=t.ad(new Float64Array(16));t.M(e,e,[this._width/2,-this._height/2,1]),t.L(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=t.ad(new Float64Array(16)),t.M(e,e,[1,-1,1]),t.L(e,e,[-1,-1,0]),t.M(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,i,r,n){const o=void 0!==r?r:this.bearing,s=n=void 0!==n?n:this.pitch,a=t.$.fromLngLat(e,i),l=-Math.cos(t.ab(s)),c=Math.sin(t.ab(s)),u=c*Math.sin(t.ab(o)),h=-c*Math.cos(t.ab(o));let d=this.elevation;const p=i-d;let f;l*p>=0||Math.abs(l)<.1?(f=1e4,d=i+f*l):f=-p/l;let m,g,y=t.aN(1,a.y),_=0;do{if(_+=1,_>10)break;g=f/y,m=new t.$(a.x+u*g,a.y+h*g),y=1/m.meterInMercatorCoordinateUnits()}while(Math.abs(f-g*y)>1e-12);return{center:m.toLngLat(),elevation:d,zoom:t.ah(this.height/2/Math.tan(this.fovInRadians/2)/g/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const i=t.ag(1,this.center.lat)*this.worldSize,r=this.cameraToCenterDistance/i,n=t.$.fromLngLat(this.center,this.elevation),o=pe(this.center,this.elevation,this.pitch,this.bearing,r);this._elevation=e;const s=this.calculateCenterFromCameraLngLatAlt(o.toLngLat(),t.aN(o.z,n.y),this.bearing,this.pitch);this._elevation=s.elevation,this._center=s.center,this.setZoom(s.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=t.ag(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const i=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/i,e.canonical.y/i,1/i/t.Z,1/i/t.Z]}}class zt{constructor(e,i){this.min=e,this.max=i,this.center=t.aO([],t.aP([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=t.aQ(this.min),n=t.aQ(this.max);for(let e=0;e<i.length;e++)r[e]=i[e]?this.min[e]:this.center[e],n[e]=i[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new zt(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let t=!0;for(let i=0;i<e.planes.length;i++){const r=this.intersectsPlane(e.planes[i]);if(0===r)return 0;1===r&&(t=!1)}return t?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let t=e[3],i=e[3];for(let r=0;r<3;r++)e[r]>0?(t+=e[r]*this.min[r],i+=e[r]*this.max[r]):(i+=e[r]*this.min[r],t+=e[r]*this.max[r]);return t>=0?2:i<0?0:1}}class Pt{distanceToTile2d(e,t,i,r){const n=r.distanceX([e,t]),o=r.distanceY([e,t]);return Math.hypot(n,o)}getWrap(e,t,i){return i}getTileAABB(e,i,r,n){var o,s;let a=r,l=r;if(n.terrain){const c=new t.Y(e.z,i,e.z,e.x,e.y),u=n.terrain.getMinMaxElevation(c);a=null!==(o=u.minElevation)&&void 0!==o?o:r,l=null!==(s=u.maxElevation)&&void 0!==s?s:r}const c=1<<e.z;return new zt([i+e.x/c,e.y/c,a],[i+(e.x+1)/c,(e.y+1)/c,l])}allowVariableZoom(e,i){const r=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,n=t.ae(78.5-r/2,0,60);return!!i.terrain||e.pitch>n}allowWorldCopies(){return!0}recalculateCache(){}}class Lt{constructor(e,t,i){this.points=e,this.planes=t,this.aabb=i}static fromInvProjectionMatrix(e,i=1,r=0){const n=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=1/(r=t.at([],r,e))[3]/i*n;return t.aR(r,r,[o,o,1/r[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const i=t.aS([],o[e[0]],o[e[1]]),r=t.aS([],o[e[2]],o[e[1]]),n=t.aT([],t.aU([],i,r)),s=-t.aV(n,o[e[1]]);return n.concat(s)})),a=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],l=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const e of o)for(let t=0;t<3;t++)a[t]=Math.min(a[t],e[t]),l[t]=Math.max(l[t],e[t]);return new Lt(o,s,new zt(a,l))}}class Dt{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,i=!0){this._helper.resize(e,t,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,t){}constructor(e,t,i,r,n){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)},e,t,i,r,n),this._coveringTilesDetailsProvider=new Pt}clone(){const e=new Dt;return e.apply(this),e}apply(e,t,i){this._helper.apply(e,t,i)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const i=[new t.aW(0,e)];if(this._helper._renderWorldCopies){const r=this.screenPointToMercatorCoordinate(new t.P(0,0)),n=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),o=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),s=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),a=Math.floor(Math.min(r.x,n.x,o.x,s.x)),l=Math.floor(Math.max(r.x,n.x,o.x,s.x)),c=1;for(let r=a-c;r<=l+c;r++)0!==r&&i.push(new t.aW(r,e))}return i}getCameraFrustum(){return Lt.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const t=this.screenPointToLocation(this.centerPoint,e),i=e?e.getElevationForLngLatZoom(t,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(i)}setLocationAtPoint(e,i){const r=t.ag(this.elevation,this.center.lat),n=this.screenPointToMercatorCoordinateAtZ(i,r),o=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,r),s=t.$.fromLngLat(e),a=new t.$(s.x-(n.x-o.x),s.y-(n.y-o.y));this.setCenter(null==a?void 0:a.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,i){return i?this.coordinatePoint(t.$.fromLngLat(e),i.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(t.$.fromLngLat(e))}screenPointToLocation(e,t){var i;return null===(i=this.screenPointToMercatorCoordinate(e,t))||void 0===i?void 0:i.toLngLat()}screenPointToMercatorCoordinate(e,t){if(t){const i=t.pointCoordinate(e);if(null!=i)return i}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,i){const r=i||0,n=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.at(n,n,this._pixelMatrixInverse),t.at(o,o,this._pixelMatrixInverse);const s=n[3],a=o[3],l=n[1]/s,c=o[1]/a,u=n[2]/s,h=o[2]/a,d=u===h?0:(r-u)/(h-u);return new t.$(t.B.number(n[0]/s,o[0]/a,d)/this.worldSize,t.B.number(l,c,d)/this.worldSize,r)}coordinatePoint(e,i=0,r=this._pixelMatrix){const n=[e.x*this.worldSize,e.y*this.worldSize,i,1];return t.at(n,n,r),new t.P(n[0]/n[3],n[1]/n[3])}getBounds(){const e=Math.max(0,this._helper._height/2-he(this));return(new G).extend(this.screenPointToLocation(new t.P(0,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,e))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(e,t){return t?null!=t.pointCoordinate(e):e.y>this.height/2-he(this)}calculatePosMatrix(e,i=!1,r){var n;const o=null!==(n=e.key)&&void 0!==n?n:t.aX(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),s=i?this._alignedPosMatrixCache:this._posMatrixCache;if(s.has(o)){const e=s.get(o);return r?e.f32:e.f64}const a=de(e,this.worldSize);t.N(a,i?this._alignedProjMatrix:this._viewProjMatrix,a);const l={f64:a,f32:new Float32Array(a)};return s.set(o,l),r?l.f32:l.f64}calculateFogMatrix(e){const i=e.key,r=this._fogMatrixCacheF32;if(r.has(i))return r.get(i);const n=de(e,this.worldSize);return t.N(n,this._fogMatrix,n),r.set(i,new Float32Array(n)),r.get(i)}getConstrained(e,i){i=t.ae(+i,this.minZoom,this.maxZoom);const r={center:new t.Q(e.lng,e.lat),zoom:i};let n=this._helper._lngRange;this._helper._renderWorldCopies||null!==n||(n=[-179.9999999999,180-1e-10]);const o=this.tileSize*t.ac(r.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this._helper._latRange){const e=this._helper._latRange;s=t.S(e[1])*o,a=t.S(e[0])*o,a-s<p&&(u=p/(a-s))}n&&(l=t.aL(t.U(n[0])*o,0,o),c=t.aL(t.U(n[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=ce(o,e);let g,y;const _=Math.max(h||0,u||0);if(_){const e=new t.P(h?(c+l)/2:f,u?(a+s)/2:m);return r.center=ue(o,e).wrap(),r.zoom+=t.ah(_),r}if(this._helper._latRange){const e=p/2;m-e<s&&(y=s+e),m+e>a&&(y=a-e)}if(n){const e=(l+c)/2;let i=f;this._helper._renderWorldCopies&&(i=t.aL(f,e-o/2,e+o/2));const r=d/2;i-r<l&&(g=l+r),i+r>c&&(g=c-r)}if(void 0!==g||void 0!==y){const e=new t.P(null!=g?g:f,null!=y?y:m);r.center=ue(o,e).wrap()}return r}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}_calculateNearFarZIfNeeded(e,i,r){if(!this._helper.autoCalculateNearFarZ)return;const n=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),o=e-n*this._helper._pixelPerMeter/Math.cos(i),s=n<0?o:e,a=Math.PI/2+this.pitchInRadians,l=t.ab(this.fov)*(Math.abs(Math.cos(t.ab(this.roll)))*this.height+Math.abs(Math.sin(t.ab(this.roll)))*this.width)/this.height*(.5+r.y/this.height),c=Math.sin(l)*s/Math.sin(t.ae(Math.PI-a-l,.01,Math.PI-.01)),u=he(this),h=Math.atan(u/this._helper.cameraToCenterDistance),d=t.ab(.75),p=h>d?2*h*(.5+r.y/(2*u)):d,f=Math.sin(p)*s/Math.sin(t.ae(Math.PI-a-p,.01,Math.PI-.01)),m=Math.min(c,f);this._helper._farZ=1.01*(Math.cos(Math.PI/2-i)*m+s),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,i=ce(this.worldSize,this.center),r=i.x,n=i.y;this._helper._pixelPerMeter=t.ag(1,this.center.lat)*this.worldSize;const o=t.ab(Math.min(this.pitch,le)),s=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(o));let a;this._calculateNearFarZIfNeeded(s,o,e),a=new Float64Array(16),t.aY(a,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.an(this._invProjMatrix,a),a[8]=2*-e.x/this._helper._width,a[9]=2*e.y/this._helper._height,this._projectionMatrix=t.aZ(a),t.M(a,a,[1,-1,1]),t.L(a,a,[0,0,-this._helper.cameraToCenterDistance]),t.a_(a,a,-this.rollInRadians),t.a$(a,a,this.pitchInRadians),t.a_(a,a,-this.bearingInRadians),t.L(a,a,[-r,-n,0]),this._mercatorMatrix=t.M([],a,[this.worldSize,this.worldSize,this.worldSize]),t.M(a,a,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a),t.L(a,a,[0,0,-this.elevation]),this._viewProjMatrix=a,this._invViewProjMatrix=t.an([],a);const l=[0,0,-1,1];t.at(l,l,this._invViewProjMatrix),this._cameraPosition=[l[0]/l[3],l[1]/l[3],l[2]/l[3]],this._fogMatrix=new Float64Array(16),t.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,s,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,t.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.L(this._fogMatrix,this._fogMatrix,[-r,-n,0]),t.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,a);const c=this._helper._width%2/2,u=this._helper._height%2/2,h=Math.cos(this.bearingInRadians),d=Math.sin(-this.bearingInRadians),p=r-Math.round(r)+h*c+d*u,f=n-Math.round(n)+h*u+d*c,m=new Float64Array(a);if(t.L(m,m,[p>.5?p-1:p,f>.5?f-1:f,0]),this._alignedProjMatrix=m,a=t.an(new Float64Array(16),this._pixelMatrix),!a)throw new Error("failed to invert matrix");this._pixelMatrixInverse=a,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new t.P(0,0)),i=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.at(i,i,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=t.ag(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,i){const r=t.$.fromLngLat(e),n=[r.x*this.worldSize,r.y*this.worldSize,i,1];return t.at(n,n,this._viewProjMatrix),n[2]/n[3]}getProjectionData(e){const{overscaledTileID:i,aligned:r,applyTerrainMatrix:n}=e,o=this._helper.getMercatorTileCoordinates(i),s=i?this.calculatePosMatrix(i,r,!0):null;let a;return a=i&&i.terrainRttPosMatrix32f&&n?i.terrainRttPosMatrix32f:s||t.b0(),{mainMatrix:a,tileMercatorCoords:o,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,t,i){return 1}transformLightDirection(e){return t.aQ(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,i,r,n){const o=this.calculatePosMatrix(r);let s;n?(s=[e,i,n(e,i),1],t.at(s,s,o)):(s=[e,i,0,1],Ze(s,s,o));const a=s[3];return{point:new t.P(s[0]/a,s[1]/a),signedDistanceFromCamera:a,isOccluded:!1}}populateCache(e){for(const t of e)this.calculatePosMatrix(t)}getMatrixForModel(e,i){const r=t.$.fromLngLat(e,i),n=r.meterInMercatorCoordinateUnits(),o=t.b1();return t.L(o,o,[r.x,r.y,r.z]),t.a_(o,o,Math.PI),t.a$(o,o,Math.PI/2),t.M(o,o,[-n,n,n]),o}getProjectionDataForCustomLayer(e=!0){const i=new t.Y(0,0,0,0,0),r=this.getProjectionData({overscaledTileID:i,applyGlobeMatrix:e}),n=de(i,this.worldSize);t.N(n,this._viewProjMatrix,n),r.tileMercatorCoords=[0,0,1,1];const o=[t.Z,t.Z,this.worldSize/this._helper.pixelsPerMeter],s=t.b2();return t.M(s,n,o),r.fallbackMatrix=s,r.mainMatrix=s,r}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Rt(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Bt(e){if(e.useSlerp)if(e.k<1){const i=t.b3(e.startEulerAngles.roll,e.startEulerAngles.pitch,e.startEulerAngles.bearing),r=t.b3(e.endEulerAngles.roll,e.endEulerAngles.pitch,e.endEulerAngles.bearing),n=new Float64Array(4);t.b4(n,i,r,e.k);const o=t.b5(n);e.tr.setRoll(o.roll),e.tr.setPitch(o.pitch),e.tr.setBearing(o.bearing)}else e.tr.setRoll(e.endEulerAngles.roll),e.tr.setPitch(e.endEulerAngles.pitch),e.tr.setBearing(e.endEulerAngles.bearing);else e.tr.setRoll(t.B.number(e.startEulerAngles.roll,e.endEulerAngles.roll,e.k)),e.tr.setPitch(t.B.number(e.startEulerAngles.pitch,e.endEulerAngles.pitch,e.k)),e.tr.setBearing(t.B.number(e.startEulerAngles.bearing,e.endEulerAngles.bearing,e.k))}function Ot(e,i,r,n,o){const s=o.padding,a=ce(o.worldSize,r.getNorthWest()),l=ce(o.worldSize,r.getNorthEast()),c=ce(o.worldSize,r.getSouthEast()),u=ce(o.worldSize,r.getSouthWest()),h=t.ab(-n),d=a.rotate(h),p=l.rotate(h),f=c.rotate(h),m=u.rotate(h),g=new t.P(Math.max(d.x,p.x,m.x,f.x),Math.max(d.y,p.y,m.y,f.y)),y=new t.P(Math.min(d.x,p.x,m.x,f.x),Math.min(d.y,p.y,m.y,f.y)),_=g.sub(y),v=(o.width-(s.left+s.right+i.left+i.right))/_.x,x=(o.height-(s.top+s.bottom+i.top+i.bottom))/_.y;if(x<0||v<0)return void Rt();const b=Math.min(t.ah(o.scale*Math.min(v,x)),e.maxZoom),w=t.P.convert(e.offset),T=new t.P((i.left-i.right)/2,(i.top-i.bottom)/2).rotate(t.ab(n)),S=w.add(T).mult(o.scale/t.ac(b));return{center:ue(o.worldSize,a.add(c).div(2).sub(S)),zoom:b,bearing:n}}class Ft{get useGlobeControls(){return!1}handlePanInertia(e,t){return{easingOffset:e,easingCenter:t.center}}handleMapControlsRollPitchBearingZoom(e,t){e.bearingDelta&&t.setBearing(t.bearing+e.bearingDelta),e.pitchDelta&&t.setPitch(t.pitch+e.pitchDelta),e.rollDelta&&t.setRoll(t.roll+e.rollDelta),e.zoomDelta&&t.setZoom(t.zoom+e.zoomDelta)}handleMapControlsPan(e,t,i){e.around.distSqr(t.centerPoint)<.01||t.setLocationAtPoint(i,e.around)}cameraForBoxAndBearing(e,t,i,r,n){return Ot(e,t,i,r,n)}handleJumpToCenterZoom(e,i){e.zoom!==(void 0!==i.zoom?+i.zoom:e.zoom)&&e.setZoom(+i.zoom),void 0!==i.center&&e.setCenter(t.Q.convert(i.center))}handleEaseTo(e,i){const r=e.zoom,n=e.padding,o={roll:e.roll,pitch:e.pitch,bearing:e.bearing},s={roll:void 0===i.roll?e.roll:i.roll,pitch:void 0===i.pitch?e.pitch:i.pitch,bearing:void 0===i.bearing?e.bearing:i.bearing},a=void 0!==i.zoom,l=!e.isPaddingEqual(i.padding);let c=!1;const u=a?+i.zoom:e.zoom;let h=e.centerPoint.add(i.offsetAsPoint);const d=e.screenPointToLocation(h),{center:p,zoom:f}=e.getConstrained(t.Q.convert(i.center||d),null!=u?u:r);Et(e,p);const m=ce(e.worldSize,d),g=ce(e.worldSize,p).sub(m),y=t.ac(f-r);return c=f!==r,{easeFunc:a=>{if(c&&e.setZoom(t.B.number(r,f,a)),t.b6(o,s)||Bt({startEulerAngles:o,endEulerAngles:s,tr:e,k:a,useSlerp:o.roll!=s.roll}),l&&(e.interpolatePadding(n,i.padding,a),h=e.centerPoint.add(i.offsetAsPoint)),i.around)e.setLocationAtPoint(i.around,i.aroundPoint);else{const i=t.ac(e.zoom-r),n=f>r?Math.min(2,y):Math.max(.5,y),o=Math.pow(n,1-a),s=ue(e.worldSize,m.add(g.mult(a*o)).mult(i));e.setLocationAtPoint(e.renderWorldCopies?s.wrap():s,h)}},isZooming:c,elevationCenter:p}}handleFlyTo(e,i){const r=void 0!==i.zoom,n=e.zoom,o=e.getConstrained(t.Q.convert(i.center||i.locationAtOffset),r?+i.zoom:n),s=o.center,a=o.zoom;Et(e,s);const l=ce(e.worldSize,i.locationAtOffset),c=ce(e.worldSize,s).sub(l),u=c.mag(),h=t.ac(a-n);let d;if(void 0!==i.minZoom){const r=Math.min(+i.minZoom,n,a),o=e.getConstrained(s,r).zoom;d=t.ac(o-n)}return{easeFunc:(i,r,o,u)=>{e.setZoom(1===i?a:n+t.ah(r));const h=1===i?s:ue(e.worldSize,l.add(c.mult(o)).mult(r));e.setLocationAtPoint(e.renderWorldCopies?h.wrap():h,u)},scaleOfZoom:h,targetCenter:s,scaleOfMinZoom:d,pixelPathLength:u}}}class jt{constructor(e,t,i){this.blendFunction=e,this.blendColor=t,this.mask=i}}jt.Replace=[1,0],jt.disabled=new jt(jt.Replace,t.b7.transparent,[!1,!1,!1,!1]),jt.unblended=new jt(jt.Replace,t.b7.transparent,[!0,!0,!0,!0]),jt.alphaBlended=new jt([1,771],t.b7.transparent,[!0,!0,!0,!0]);const $t=2305;class Nt{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Nt.disabled=new Nt(!1,1029,$t),Nt.backCCW=new Nt(!0,1029,$t),Nt.frontCCW=new Nt(!0,1028,$t);class Ut{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const Vt=7680;class Gt{constructor(e,t,i,r,n,o){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=o}}Gt.disabled=new Gt({func:519,mask:0},0,0,Vt,Vt,Vt);const qt=new WeakMap;function Zt(e){var t;if(qt.has(e))return qt.get(e);{const i=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return qt.set(e,i),i}}class Wt{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const i=e.context,r=i.gl;this._texFormat=r.RGBA,this._texType=r.UNSIGNED_BYTE;const n=new t.aI;n.emplaceBack(-1,-1),n.emplaceBack(2,-1),n.emplaceBack(-1,2);const o=new t.aK;o.emplaceBack(0,1,2),this._fullscreenTriangle=new wt(i.createVertexBuffer(n,Tt.members),i.createIndexBuffer(o),t.aJ.simpleSegment(0,0,n.length,o.length)),this._resultBuffer=new Uint8Array(4),i.activeTexture.set(r.TEXTURE1);const s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=i.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(s),Zt(r)&&(this._pbo=r.createBuffer(),r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.bufferData(r.PIXEL_PACK_BUFFER,4,r.STREAM_READ),r.bindBuffer(r.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,t){const i=this._updateCount;return this._readbackQueue?i>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():i>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,t),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,t=e.gl;e.activeTexture.set(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,i){const r=this._cachedRenderContext.context,n=r.gl;if(this._bindFramebuffer(),r.viewport.set([0,0,this._texWidth,this._texHeight]),r.clear({color:t.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(r,n.TRIANGLES,Ut.disabled,Gt.disabled,jt.unblended,Nt.disabled,((e,t)=>({u_input:e,u_output_expected:t}))(e,i),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Zt(n)){n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.readBuffer(n.COLOR_ATTACHMENT0),n.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),n.bindBuffer(n.PIXEL_PACK_BUFFER,null);const e=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:e}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Zt(e)){const i=e.clientWaitSync(this._readbackQueue.sync,0,0);if(i===e.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(i===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Wt._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let t=0;return t+=e[0]/256,t+=e[1]/65536,t+=e[2]/16777216,e[3]<127&&(t=-t),t/128}}const Ht=t.Z/128;function Xt(e,i){const r=void 0!==e.granularity?Math.max(e.granularity,1):1,n=r+(e.generateBorders?2:0),o=r+(e.extendToNorthPole||e.generateBorders?1:0)+(e.extendToSouthPole||e.generateBorders?1:0),s=n+1,a=o+1,l=e.generateBorders?-1:0,c=e.generateBorders||e.extendToNorthPole?-1:0,u=r+(e.generateBorders?1:0),h=r+(e.generateBorders||e.extendToSouthPole?1:0),d=s*a,p=n*o*6,f=s*a>65536;if(f&&"16bit"===i)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const m=f||"32bit"===i,g=new Int16Array(2*d);let y=0;for(let i=c;i<=h;i++)for(let n=l;n<=u;n++){let o=n/r*t.Z;-1===n&&(o=-64),n===r+1&&(o=t.Z+Ht);let s=i/r*t.Z;-1===i&&(s=e.extendToNorthPole?t.b9:-64),i===r+1&&(s=e.extendToSouthPole?t.ba:t.Z+Ht),g[y++]=o,g[y++]=s}const _=m?new Uint32Array(p):new Uint16Array(p);let v=0;for(let e=0;e<o;e++)for(let t=0;t<n;t++){const i=t+1+e*s,r=t+(e+1)*s,n=t+1+(e+1)*s;_[v++]=t+e*s,_[v++]=r,_[v++]=i,_[v++]=i,_[v++]=r,_[v++]=n}return{vertices:g.buffer.slice(0),indices:_.buffer.slice(0),uses32bitIndices:m}}const Kt=new t.aH({fill:new t.bb(128,2),line:new t.bb(512,0),tile:new t.bb(128,32),stencil:new t.bb(128,1),circle:3});class Yt{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return xt.projectionGlobe}get vertexShaderPreludeCode(){return xt.projectionMercator.vertexSource}get subdivisionGranularity(){return Kt}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Wt(e));const i=t.S(this._errorQueryLatitudeDegrees),r=2*Math.atan(Math.exp(Math.PI-i*Math.PI*2))-.5*Math.PI,n=this._errorMeasurement.updateErrorLoop(i,r),o=s.now();n!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=n,this._errorMeasurementLastChangeTime=o);const a=Math.min(Math.max((o-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.bd(a))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,t,i,r,n){const o=("stencil"===n?Kt.stencil:Kt.tile).getGranularityForZoomLevel(t.z);return this._getMesh(e,{granularity:o,generateBorders:i,extendToNorthPole:0===t.y&&r,extendToSouthPole:t.y===(1<<t.z)-1&&r})}_getMesh(e,i){const r=this._getMeshKey(i);if(r in this._tileMeshCache)return this._tileMeshCache[r];const n=function(e,i){const r=Xt(i,"16bit"),n=t.aI.deserialize({arrayBuffer:r.vertices,length:r.vertices.byteLength/2/2}),o=t.aK.deserialize({arrayBuffer:r.indices,length:r.indices.byteLength/2/3});return new wt(e.createVertexBuffer(n,Tt.members),e.createIndexBuffer(o),t.aJ.simpleSegment(0,0,n.length,o.length))}(e,i);return this._tileMeshCache[r]=n,n}recalculate(e){}hasTransition(){const e=s.now();let t=!1;return t=t||(e-this._errorMeasurementLastChangeTime)/1e3<.7,t=t||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,t}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Jt=new t.r({type:new t.D(t.v.projection.type)});class Qt extends t.E{constructor(e){super(),this._transitionable=new t.T(Jt),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.C(0)),this._mercatorProjection=new Mt,this._verticalPerspectiveProjection=new Yt}get transitionState(){const e=this.properties.get("type");if("string"==typeof e&&"mercator"===e)return 0;if("string"==typeof e&&"vertical-perspective"===e)return 1;if(e instanceof t.be){if("vertical-perspective"===e.from&&"mercator"===e.to)return 1-e.transition;if("mercator"===e.from&&"vertical-perspective"===e.to)return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,t,i,r,n){return this.currentProjection.getMeshFromTileID(e,t,i,r,n)}setProjection(e){this._transitionable.setValue("type",(null==e?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function ei(e){const t=ri(e.worldSize,e.center.lat);return 2*Math.PI*t}function ti(e,i,r,n,o){const s=1/(1<<o),a=i/t.Z*s+n*s,l=t.bg((e/t.Z*s+r*s)*Math.PI*2+Math.PI,2*Math.PI),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,u=Math.cos(c),h=new Float64Array(3);return h[0]=Math.sin(l)*u,h[1]=Math.sin(c),h[2]=Math.cos(l)*u,h}function ii(e){return function(e,t){const i=Math.cos(t),r=new Float64Array(3);return r[0]=Math.sin(e)*i,r[1]=Math.sin(t),r[2]=Math.cos(e)*i,r}(e.lng*Math.PI/180,e.lat*Math.PI/180)}function ri(e,t){return e/(2*Math.PI)/Math.cos(t*Math.PI/180)}function ni(e){const i=Math.asin(e[1])/Math.PI*180,r=Math.sqrt(e[0]*e[0]+e[2]*e[2]);if(r>1e-6){const n=e[0]/r,o=Math.acos(e[2]/r),s=(n>0?o:-o)/Math.PI*180;return new t.Q(t.aL(s,-180,180),i)}return new t.Q(0,i)}function oi(e){return Math.cos(e*Math.PI/180)}function si(e,i){const r=oi(e),n=oi(i);return t.ah(n/r)}function ai(e,i){const r=e.rotate(i.bearingInRadians),n=i.zoom+si(i.center.lat,0),o=t.bc(1/oi(i.center.lat),1/oi(Math.min(Math.abs(i.center.lat),60)),t.bf(n,7,3,0,1)),s=360/ei({worldSize:i.worldSize,center:{lat:i.center.lat}});return new t.Q(i.center.lng-r.x*s*o,t.ae(i.center.lat+r.y*s,-85.051129,t.af))}function li(e){const t=.5*e,i=Math.sin(t),r=Math.cos(t);return Math.log(i+r)-Math.log(r-i)}function ci(e,i,r,n){const o=e.lat+r*n;if(Math.abs(r)>1){const s=(Math.sign(e.lat+r)!==Math.sign(e.lat)?-Math.abs(e.lat):Math.abs(e.lat))*Math.PI/180,a=Math.abs(e.lat+r)*Math.PI/180,l=li(s+n*(a-s)),c=li(s),u=li(a);return new t.Q(e.lng+i*((l-c)/(u-c)),o)}return new t.Q(e.lng+i*n,o)}class ui{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,t,i,r){const n=`${e.z}_${e.x}_${e.y}`,o=this._cache.get(n);if(o)return o;const s=this._cachePrevious.get(n);if(s)return this._cache.set(n,s),s;const a=this._aabbFactory(e,t,i,r);return this._cache.set(n,a),this._hadAnyChanges=!0,a}}function hi(e,t,i){const r=e-t;return r<0?-r:Math.max(0,r-i)}function di(e,t,i,r,n){const o=e-i;let s;return s=o<0?Math.min(-o,1+o-n):o>1?Math.min(Math.max(o-n,0),1-o):0,Math.max(s,hi(t,r,n))}class pi{constructor(){this._aabbCache=new ui(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,t,i,r){const n=1<<i.z,o=1/n,s=i.x/n,a=i.y/n;let l=2;return l=Math.min(l,di(e,t,s,a,o)),l=Math.min(l,di(e,t,s+.5,-a-o,o)),l=Math.min(l,di(e,t,s+.5,2-a-o,o)),l}getWrap(e,t,i){const r=1<<t.z,n=1/r,o=t.x/r,s=hi(e.x,o,n),a=hi(e.x,o-1,n),l=hi(e.x,o+1,n),c=Math.min(s,a,l);return c===l?1:c===a?-1:0}allowVariableZoom(e,t){return _e(e,t)>4}allowWorldCopies(){return!1}getTileAABB(e,t,i,r){return this._aabbCache.getTileAABB(e,t,i,r)}_computeTileAABB(e,i,r,n){if(e.z<=0)return new zt([-1,-1,-1],[1,1,1]);if(1===e.z)return new zt([0===e.x?-1:0,0===e.y?0:-1,-1],[0===e.x?0:1,0===e.y?1:0,1]);{const i=[ti(0,0,e.x,e.y,e.z),ti(t.Z,0,e.x,e.y,e.z),ti(t.Z,t.Z,e.x,e.y,e.z),ti(0,t.Z,e.x,e.y,e.z)],r=[1,1,1],n=[-1,-1,-1];for(const e of i)for(let t=0;t<3;t++)r[t]=Math.min(r[t],e[t]),n[t]=Math.max(n[t],e[t]);if(0===e.y||e.y===(1<<e.z)-1){const t=[0,0===e.y?1:-1,0];for(let e=0;e<3;e++)r[e]=Math.min(r[e],t[e]),n[e]=Math.max(n[e],t[e])}return new zt(r,n)}}}class fi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t){this._helper.resize(e,t)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=t.bk(),this._projectionMatrix=t.b1(),this._globeViewProjMatrix32f=t.b0(),this._globeViewProjMatrixNoCorrection=t.b1(),this._globeViewProjMatrixNoCorrectionInverted=t.b1(),this._globeProjMatrixInverted=t.b1(),this._cameraPosition=t.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._coveringTilesDetailsProvider=new pi}clone(){const e=new fi;return e.apply(this),e}apply(e,t){this._globeLatitudeErrorCorrectionRadians=t||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=t.bh();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:t,applyGlobeMatrix:i}=e,r=this._helper.getMercatorTileCoordinates(t);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:r,clippingPlane:this._cachedClippingPlane,projectionTransition:i?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const i=this.pitchInRadians,r=this.cameraToCenterDistance/e,n=Math.sin(i)*r,o=Math.cos(i)*r+1,s=1/Math.sqrt(n*n+o*o)*1;let a=-n,l=o;const c=Math.sqrt(a*a+l*l);a/=c,l/=c;const u=[0,a,l];t.bl(u,u,[0,0,0],-this.bearingInRadians),t.bm(u,u,[0,0,0],-1*this.center.lat*Math.PI/180),t.bn(u,u,[0,0,0],this.center.lng*Math.PI/180);const h=1/t.bo(u);return t.aO(u,u,h),[...u,-s*h]}isLocationOccluded(e){return!this.isSurfacePointVisible(ii(e))}transformLightDirection(e){const i=this._helper._center.lng*Math.PI/180,r=this._helper._center.lat*Math.PI/180,n=Math.cos(r),o=[Math.sin(i)*n,Math.sin(r),Math.cos(i)*n],s=[o[2],0,-o[0]],a=[0,0,0];t.aU(a,s,o),t.aT(s,s),t.aT(a,a);const l=[0,0,0];return t.aT(l,[s[0]*e[0]+a[0]*e[1]+o[0]*e[2],s[1]*e[0]+a[1]*e[1]+o[1]*e[2],s[2]*e[0]+a[2]*e[1]+o[2]*e[2]]),l}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,i,r){const n=function(e,i,r){const n=1/(1<<r.z);return new t.$(e/t.Z*n+r.x*n,i/t.Z*n+r.y*n)}(e,i,r.canonical),o=(s=n.y,[t.bg(n.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI]);var s;return this.getCircleRadiusCorrection()/Math.cos(o[1])}projectTileCoordinates(e,i,r,n){const o=r.canonical,s=ti(e,i,o.x,o.y,o.z),a=1+(n?n(e,i):0)/t.bu,l=[s[0]*a,s[1]*a,s[2]*a,1];t.at(l,l,this._globeViewProjMatrixNoCorrection);const c=this._cachedClippingPlane,u=c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]<0;return{point:new t.P(l[0]/l[3],l[1]/l[3]),signedDistanceFromCamera:l[3],isOccluded:u}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ri(this.worldSize,this.center.lat),i=t.b2(),r=t.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),t.aY(i,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const n=this.centerOffset;i[8]=2*-n.x/this._helper._width,i[9]=2*n.y/this._helper._height,this._projectionMatrix=t.aZ(i),this._globeProjMatrixInverted=t.b2(),t.an(this._globeProjMatrixInverted,i),t.L(i,i,[0,0,-this.cameraToCenterDistance]),t.a_(i,i,this.rollInRadians),t.a$(i,i,-this.pitchInRadians),t.a_(i,i,this.bearingInRadians),t.L(i,i,[0,0,-e]);const o=t.bh();o[0]=e,o[1]=e,o[2]=e,t.a$(r,i,this.center.lat*Math.PI/180),t.bp(r,r,-this.center.lng*Math.PI/180),t.M(r,r,o),this._globeViewProjMatrixNoCorrection=r,t.a$(i,i,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bp(i,i,-this.center.lng*Math.PI/180),t.M(i,i,o),this._globeViewProjMatrix32f=new Float32Array(i),this._globeViewProjMatrixNoCorrectionInverted=t.b2(),t.an(this._globeViewProjMatrixNoCorrectionInverted,r);const s=t.bh();this._cameraPosition=t.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/e,t.bl(this._cameraPosition,this._cameraPosition,s,-this.rollInRadians),t.bm(this._cameraPosition,this._cameraPosition,s,this.pitchInRadians),t.bl(this._cameraPosition,this._cameraPosition,s,-this.bearingInRadians),t.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bm(this._cameraPosition,this._cameraPosition,s,-this.center.lat*Math.PI/180),t.bn(this._cameraPosition,this._cameraPosition,s,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const a=t.aZ(this._globeViewProjMatrixNoCorrectionInverted);t.M(a,a,[1,1,-1]),this._cachedFrustum=Lt.fromInvProjectionMatrix(a)}calculateFogMatrix(e){t.w("calculateFogMatrix is not supported on globe projection.");const i=t.b2();return t.ad(i),i}getVisibleUnwrappedCoordinates(e){return[new t.aW(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,i){if(!this._globeViewProjMatrixNoCorrection)return 1;const r=ii(e);t.aO(r,r,1+i/t.bu);const n=t.bk();return t.at(n,[r[0],r[1],r[2],1],this._globeViewProjMatrixNoCorrection),n[2]/n[3]}populateCache(e){}getBounds(){const e=.5*this.width,i=.5*this.height,r=[new t.P(0,0),new t.P(e,0),new t.P(this.width,0),new t.P(this.width,i),new t.P(this.width,this.height),new t.P(e,this.height),new t.P(0,this.height),new t.P(0,i)],n=[];for(const e of r)n.push(this.unprojectScreenPoint(e));let o=0,s=0,a=0,l=0;const c=this.center;for(const e of n){const i=t.bq(c.lng,e.lng),r=t.bq(c.lat,e.lat);i<s&&(s=i),i>o&&(o=i),r<l&&(l=r),r>a&&(a=r)}const u=[c.lng+s,c.lat+l,c.lng+o,c.lat+a];return this.isSurfacePointOnScreen([0,1,0])&&(u[3]=90,u[0]=-180,u[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(u[1]=-90,u[0]=-180,u[2]=180),new G(u)}getConstrained(e,i){const r=t.ae(e.lat,-85.051129,t.af),n=t.ae(+i,this.minZoom+si(0,r),this.maxZoom);return{center:new t.Q(e.lng,r),zoom:n}}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}setLocationAtPoint(e,i){const r=ii(this.unprojectScreenPoint(i)),n=ii(e),o=t.bh();t.br(o);const s=t.bh();t.bn(s,r,o,-this.center.lng*Math.PI/180),t.bm(s,s,o,this.center.lat*Math.PI/180);const a=n[0]*n[0]+n[2]*n[2],l=s[0]*s[0];if(a<l)return;const c=Math.sqrt(a-l),u=-c,h=t.bs(n[0],n[2],s[0],c),d=t.bs(n[0],n[2],s[0],u),p=t.bh();t.bn(p,n,o,-h);const f=t.bs(p[1],p[2],s[1],s[2]),m=t.bh();t.bn(m,n,o,-d);const g=t.bs(m[1],m[2],s[1],s[2]),y=.5*Math.PI,_=f>=-y&&f<=y,v=g>=-y&&g<=y;let x,b;if(_&&v){const e=this.center.lng*Math.PI/180,i=this.center.lat*Math.PI/180;t.bv(h,e)+t.bv(f,i)<t.bv(d,e)+t.bv(g,i)?(x=h,b=f):(x=d,b=g)}else if(_)x=h,b=f;else{if(!v)return;x=d,b=g}const w=x/Math.PI*180,T=b/Math.PI*180,S=this.center.lat;this.setCenter(new t.Q(w,t.ae(T,-90,90))),this.setZoom(this.zoom+si(S,this.center.lat))}locationToScreenPoint(e,i){const r=ii(e);if(i){const n=i.getElevationForLngLatZoom(e,this._helper._tileZoom);t.aO(r,r,1+n/t.bu)}return this._projectSurfacePointToScreen(r)}_projectSurfacePointToScreen(e){const i=t.bk();return t.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],new t.P((.5*i[0]+.5)*this.width,(.5*-i[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,i){if(i){const t=i.pointCoordinate(e);if(t)return t}return t.$.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,t){var i;return null===(i=this.screenPointToMercatorCoordinate(e,t))||void 0===i?void 0:i.toLngLat()}isPointOnMapSurface(e,t){const i=this._cameraPosition,r=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(i,r)}getRayDirectionFromPixel(e){const i=t.bk();i[0]=e.x/this.width*2-1,i[1]=-1*(e.y/this.height*2-1),i[2]=1,i[3]=1,t.at(i,i,this._globeViewProjMatrixNoCorrectionInverted),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3];const r=t.bh();r[0]=i[0]-this._cameraPosition[0],r[1]=i[1]-this._cameraPosition[1],r[2]=i[2]-this._cameraPosition[2];const n=t.bh();return t.aT(n,r),n}isSurfacePointVisible(e){const t=this._cachedClippingPlane;return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const i=t.bk();return t.at(i,[...e,1],this._globeViewProjMatrixNoCorrection),i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],i[0]>-1&&i[0]<1&&i[1]>-1&&i[1]<1&&i[2]>-1&&i[2]<1}rayPlanetIntersection(e,i){const r=t.aV(e,i),n=t.bh(),o=t.bh();t.aO(o,i,r),t.aS(n,e,o);const s=1-t.aV(n,n);if(s<0)return null;const a=t.aV(e,e)-1,l=-r+(r<0?1:-1)*Math.sqrt(s),c=a/l,u=l;return{tMin:Math.min(c,u),tMax:Math.max(c,u)}}unprojectScreenPoint(e){const i=this._cameraPosition,r=this.getRayDirectionFromPixel(e),n=this.rayPlanetIntersection(i,r);if(n){const e=t.bh();t.aP(e,i,[r[0]*n.tMin,r[1]*n.tMin,r[2]*n.tMin]);const o=t.bh();return t.aT(o,e),ni(o)}const o=this._cachedClippingPlane,s=o[0]*r[0]+o[1]*r[1]+o[2]*r[2],a=-t.bt(o,i)/s,l=t.bh();if(a>0)t.aP(l,i,[r[0]*a,r[1]*a,r[2]*a]);else{const e=t.bh();t.aP(e,i,[2*r[0],2*r[1],2*r[2]]);const n=t.bt(this._cachedClippingPlane,e);t.aS(l,e,[this._cachedClippingPlane[0]*n,this._cachedClippingPlane[1]*n,this._cachedClippingPlane[2]*n])}const c=function(e){const i=t.bh();return i[0]=e[0]*-e[3],i[1]=e[1]*-e[3],i[2]=e[2]*-e[3],{center:i,radius:Math.sqrt(1-e[3]*e[3])}}(o);return ni(function(e,i,r){const n=t.bh();t.aS(n,r,e);const o=t.bh();return t.bi(o,e,n,i/t.bj(n)),o}(c.center,c.radius,l))}getMatrixForModel(e,i){const r=t.Q.convert(e),n=1/t.bu,o=t.b1();return t.bp(o,o,r.lng/180*Math.PI),t.a$(o,o,-r.lat/180*Math.PI),t.L(o,o,[0,0,1+i/t.bu]),t.a$(o,o,.5*Math.PI),t.M(o,o,[n,n,n]),o}getProjectionDataForCustomLayer(e=!0){const i=this.getProjectionData({overscaledTileID:new t.Y(0,0,0,0,0),applyGlobeMatrix:e});return i.tileMercatorCoords=[0,0,1,1],i}getFastPathSimpleProjectionMatrix(e){}}class mi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,t,i){return this._helper.interpolatePadding(e,t,i)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,t,i=!0){this._helper.resize(e,t,i)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,t){this._helper.overrideNearFarZ(e,t)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,t){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=t,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new It({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,t)=>this.getConstrained(e,t)}),this._globeness=1,this._mercatorTransform=new Dt,this._verticalPerspectiveTransform=new fi}clone(){const e=new mi;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const t=this._mercatorTransform.getProjectionData(e),i=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?i.mainMatrix:t.mainMatrix,clippingPlane:i.clippingPlane,tileMercatorCoords:i.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:t.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return t.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,i,r){const n=this._mercatorTransform.getPitchedTextCorrection(e,i,r),o=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,i,r);return t.bc(n,o,this._globeness)}projectTileCoordinates(e,t,i,r){return this.currentTransform.projectTileCoordinates(e,t,i,r)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,t){return this.currentTransform.lngLatToCameraDepth(e,t)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,t){return this.currentTransform.getConstrained(e,t)}calculateCenterFromCameraLngLatAlt(e,t,i,r){return this._helper.calculateCenterFromCameraLngLatAlt(e,t,i,r)}setLocationAtPoint(e,t){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,t),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,t),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,t){return this.currentTransform.locationToScreenPoint(e,t)}screenPointToMercatorCoordinate(e,t){return this.currentTransform.screenPointToMercatorCoordinate(e,t)}screenPointToLocation(e,t){return this.currentTransform.screenPointToLocation(e,t)}isPointOnMapSurface(e,t){return this.currentTransform.isPointOnMapSurface(e,t)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,t){return this.currentTransform.getMatrixForModel(e,t)}getProjectionDataForCustomLayer(e=!0){const t=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return t;const i=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return i.fallbackMatrix=t.mainMatrix,i}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class gi{get useGlobeControls(){return!0}handlePanInertia(e,i){const r=ai(e,i);return Math.abs(r.lng-i.center.lng)>180&&(r.lng=i.center.lng+179.5*Math.sign(r.lng-i.center.lng)),{easingCenter:r,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,i){const r=e.around,n=i.screenPointToLocation(r);e.bearingDelta&&i.setBearing(i.bearing+e.bearingDelta),e.pitchDelta&&i.setPitch(i.pitch+e.pitchDelta),e.rollDelta&&i.setRoll(i.roll+e.rollDelta);const o=i.zoom;e.zoomDelta&&i.setZoom(i.zoom+e.zoomDelta);const s=i.zoom-o;if(0===s)return;const a=t.bq(i.center.lng,n.lng),l=a/(Math.abs(a/180)+1),c=t.bq(i.center.lat,n.lat),u=i.getRayDirectionFromPixel(r),h=i.cameraPosition,d=-1*t.aV(h,u),p=t.bh();t.aP(p,h,[u[0]*d,u[1]*d,u[2]*d]);const f=t.bo(p)-1,m=Math.exp(.5*-Math.max(f-.3,0)),g=ri(i.worldSize,i.center.lat)/Math.min(i.width,i.height),y=t.bf(g,.9,.5,1,.25),_=(1-t.ac(-s))*Math.min(m,y),v=i.center.lat,x=i.zoom,b=new t.Q(i.center.lng+l*_,t.ae(i.center.lat+c*_,-85.051129,t.af));i.setLocationAtPoint(n,r);const w=i.center,T=t.bf(Math.abs(a),45,85,0,1),S=t.bf(g,.75,.35,0,1),C=Math.pow(Math.max(T,S),.25),M=t.bq(w.lng,b.lng),k=t.bq(w.lat,b.lat);i.setCenter(new t.Q(w.lng+M*C,w.lat+k*C).wrap()),i.setZoom(x+si(v,i.center.lat))}handleMapControlsPan(e,t,i){if(!e.panDelta)return;const r=t.center.lat,n=t.zoom;t.setCenter(ai(e.panDelta,t).wrap()),t.setZoom(n+si(r,t.center.lat))}cameraForBoxAndBearing(e,i,r,n,o){const s=Ot(e,i,r,n,o),a=i.left/o.width*2-1,l=(o.width-i.right)/o.width*2-1,c=i.top/o.height*-2+1,u=(o.height-i.bottom)/o.height*-2+1,h=t.bq(r.getWest(),r.getEast())<0,d=h?r.getEast():r.getWest(),p=h?r.getWest():r.getEast(),f=Math.max(r.getNorth(),r.getSouth()),m=Math.min(r.getNorth(),r.getSouth()),g=d+.5*t.bq(d,p),y=f+.5*t.bq(f,m),_=o.clone();_.setCenter(s.center),_.setBearing(s.bearing),_.setPitch(0),_.setRoll(0),_.setZoom(s.zoom);const v=_.modelViewProjectionMatrix,x=[ii(r.getNorthWest()),ii(r.getNorthEast()),ii(r.getSouthWest()),ii(r.getSouthEast()),ii(new t.Q(p,y)),ii(new t.Q(d,y)),ii(new t.Q(g,f)),ii(new t.Q(g,m))],b=ii(s.center);let w=Number.POSITIVE_INFINITY;for(const e of x)a<0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(e,b,v,"x",a))),l>0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(e,b,v,"x",l))),c>0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(e,b,v,"y",c))),u<0&&(w=gi.getLesserNonNegativeNonNull(w,gi.solveVectorScale(e,b,v,"y",u)));if(Number.isFinite(w)&&0!==w)return s.zoom=_.zoom+t.ah(w),s;Rt()}handleJumpToCenterZoom(e,i){const r=e.center.lat,n=e.getConstrained(i.center?t.Q.convert(i.center):e.center,e.zoom).center;e.setCenter(n.wrap());const o=void 0!==i.zoom?+i.zoom:e.zoom+si(r,n.lat);e.zoom!==o&&e.setZoom(o)}handleEaseTo(e,i){const r=e.zoom,n=e.center,o=e.padding,s={roll:e.roll,pitch:e.pitch,bearing:e.bearing},a={roll:void 0===i.roll?e.roll:i.roll,pitch:void 0===i.pitch?e.pitch:i.pitch,bearing:void 0===i.bearing?e.bearing:i.bearing},l=void 0!==i.zoom,c=!e.isPaddingEqual(i.padding);let u=!1;const h=i.center?t.Q.convert(i.center):n,d=e.getConstrained(h,r).center;Et(e,d);const p=e.clone();p.setCenter(d),p.setZoom(l?+i.zoom:r+si(n.lat,h.lat)),p.setBearing(i.bearing);const f=new t.P(t.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),t.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));p.setLocationAtPoint(d,f);const m=(i.offset&&i.offsetAsPoint.mag())>0?p.center:d,g=l?+i.zoom:r+si(n.lat,m.lat),y=r+si(n.lat,0),_=g+si(m.lat,0),v=t.bq(n.lng,m.lng),x=t.bq(n.lat,m.lat),b=t.ac(_-y);return u=g!==r,{easeFunc:r=>{if(t.b6(s,a)||Bt({startEulerAngles:s,endEulerAngles:a,tr:e,k:r,useSlerp:s.roll!=a.roll}),c&&e.interpolatePadding(o,i.padding,r),i.around)t.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(i.around,i.aroundPoint);else{const t=_>y?Math.min(2,b):Math.max(.5,b),i=Math.pow(t,1-r),o=ci(n,v,x,r*i);e.setCenter(o.wrap())}if(u){const i=t.B.number(y,_,r)+si(0,e.center.lat);e.setZoom(i)}},isZooming:u,elevationCenter:m}}handleFlyTo(e,i){const r=void 0!==i.zoom,n=e.center,o=e.zoom,s=e.padding,a=!e.isPaddingEqual(i.padding),l=e.getConstrained(t.Q.convert(i.center||i.locationAtOffset),o).center,c=r?+i.zoom:e.zoom+si(e.center.lat,l.lat),u=e.clone();u.setCenter(l),u.setZoom(c),u.setBearing(i.bearing);const h=new t.P(t.ae(e.centerPoint.x+i.offsetAsPoint.x,0,e.width),t.ae(e.centerPoint.y+i.offsetAsPoint.y,0,e.height));u.setLocationAtPoint(l,h);const d=u.center;Et(e,d);const p=function(e,i,r){const n=ii(i),o=ii(r),s=t.aV(n,o),a=Math.acos(s),l=ei(e);return a/(2*Math.PI)*l}(e,n,d),f=o+si(n.lat,0),m=c+si(d.lat,0),g=t.ac(m-f);let y;if("number"==typeof i.minZoom){const r=+i.minZoom+si(d.lat,0),n=Math.min(r,f,m)+si(0,d.lat),o=e.getConstrained(d,n).zoom+si(d.lat,0);y=t.ac(o-f)}const _=t.bq(n.lng,d.lng),v=t.bq(n.lat,d.lat);return{easeFunc:(r,o,l,u)=>{const h=ci(n,_,v,l);a&&e.interpolatePadding(s,i.padding,r);const p=1===r?d:h;e.setCenter(p.wrap());const m=f+t.ah(o);e.setZoom(1===r?c:m+si(0,p.lat))},scaleOfZoom:g,targetCenter:d,scaleOfMinZoom:y,pixelPathLength:p}}static solveVectorScale(e,t,i,r,n){const o="x"===r?[i[0],i[4],i[8],i[12]]:[i[1],i[5],i[9],i[13]],s=[i[3],i[7],i[11],i[15]],a=e[0]*o[0]+e[1]*o[1]+e[2]*o[2],l=e[0]*s[0]+e[1]*s[1]+e[2]*s[2],c=t[0]*o[0]+t[1]*o[1]+t[2]*o[2],u=t[0]*s[0]+t[1]*s[1]+t[2]*s[2];return c+n*l===a+n*u||s[3]*(a-c)+o[3]*(u-l)+a*u==c*l?null:(c+o[3]-n*u-n*s[3])/(c-a-n*u+n*l)}static getLesserNonNegativeNonNull(e,t){return null!==t&&t>=0&&t<e?t:e}}class yi{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ft,this._verticalPerspectiveCameraHelper=new gi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,t){return this.currentHelper.handlePanInertia(e,t)}handleMapControlsRollPitchBearingZoom(e,t){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,t)}handleMapControlsPan(e,t,i){this.currentHelper.handleMapControlsPan(e,t,i)}cameraForBoxAndBearing(e,t,i,r,n){return this.currentHelper.cameraForBoxAndBearing(e,t,i,r,n)}handleJumpToCenterZoom(e,t){this.currentHelper.handleJumpToCenterZoom(e,t)}handleEaseTo(e,t){return this.currentHelper.handleEaseTo(e,t)}handleFlyTo(e,t){return this.currentHelper.handleFlyTo(e,t)}}const _i=(e,i)=>t.x(e,i&&i.filter((e=>"source.canvas"!==e.identifier))),vi=t.bw();class xi extends t.E{constructor(e,i={}){super(),this._rtlPluginLoaded=()=>{for(const e in this.sourceCaches){const t=this.sourceCaches[e].getSource().type;"vector"!==t&&"geojson"!==t||this.sourceCaches[e].reload()}},this.map=e,this.dispatcher=new O(B(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((e,t)=>this.getGlyphs(e,t))),this.dispatcher.registerMessageHandler("GI",((e,t)=>this.getImages(e,t))),this.imageManager=new x,this.imageManager.setEventedParent(this),this.glyphManager=new S(e._requestManager,i.localIdeographFontFamily),this.lineAtlas=new I(256,512),this.crossTileSymbolIndex=new _t,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",t.by()),ne().on(te,this._rtlPluginLoaded),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const i=t.getSource();if(i&&i.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===i.id&&this._validateLayer(t)}}))}loadURL(e,i={},r){this.fire(new t.l("dataloading",{dataType:"style"})),i.validate="boolean"!=typeof i.validate||i.validate;const n=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const o=this._loadStyleRequest;t.j(n,this._loadStyleRequest).then((e=>{this._loadStyleRequest=null,this._load(e.data,i,r)})).catch((e=>{this._loadStyleRequest=null,e&&!o.signal.aborted&&this.fire(new t.k(e))}))}loadJSON(e,i={},r){this.fire(new t.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,s.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,i.validate=!1!==i.validate,this._load(e,i,r)})).catch((()=>{}))}loadEmpty(){this.fire(new t.l("dataloading",{dataType:"style"})),this._load(vi,{validate:!1})}_load(e,i,r){var n,o;const s=i.transformStyle?i.transformStyle(r,e):e;if(!i.validate||!_i(this,t.y(s))){this._loaded=!0,this.stylesheet=s;for(const e in s.sources)this.addSource(e,s.sources[e],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs),this._createLayers(),this.light=new k(this.stylesheet.light),this._setProjectionInternal((null===(n=this.stylesheet.projection)||void 0===n?void 0:n.type)||"mercator"),this.sky=new A(this.stylesheet.sky),this.map.setTerrain(null!==(o=this.stylesheet.terrain)&&void 0!==o?o:null),this.fire(new t.l("data",{dataType:"style"})),this.fire(new t.l("style.load"))}}_createLayers(){const e=t.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(const i of e){const e=t.bA(i);e.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=e}}_loadSprite(e,i=!1,r){let n;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(e,i,r,n){return t._(this,void 0,void 0,(function*(){const o=g(e),a=r>1?"@2x":"",l={},c={};for(const{id:e,url:r}of o){const o=i.transformRequest(y(r,a,".json"),"SpriteJSON");l[e]=t.j(o,n);const s=i.transformRequest(y(r,a,".png"),"SpriteImage");c[e]=f.getImage(s,n)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,i){return t._(this,void 0,void 0,(function*(){const t={};for(const r in e){t[r]={};const n=s.getImageCanvasContext((yield i[r]).data),o=(yield e[r]).data;for(const e in o){const{width:i,height:s,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=o[e];t[r][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:i,height:s,x:a,y:l,context:n}}}}return t}))}(l,c)}))}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const r=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in e))):[];for(const e of r)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const r in e[t]){const n="default"===t?r:`${t}:${r}`;this._spritesImagesIds[t].push(n),n in this.imageManager.images?this.imageManager.updateImage(n,e[t][r],!1):this.imageManager.addImage(n,e[t][r]),i&&(this._changedImages[n]=!0)}}})).catch((e=>{this._spriteRequest=null,n=e,this.fire(new t.k(n))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),i&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"})),r&&r(n)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}_validateLayer(e){const i=this.sourceCaches[e.source];if(!i)return;const r=e.sourceLayer;if(!r)return;const n=i.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.k(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,i=!1){const r=this._serializedAllLayers();if(!e||0===e.length)return Object.values(i?t.bB(r):r);const n=[];for(const o of e)if(r[o]){const e=i?t.bB(r[o]):r[o];n.push(e)}return n}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const i of t){const t=this._layers[i];"custom"!==t.type&&(e[i]=t.serialize())}return e}hasTransitions(){var e,t,i;if(null===(e=this.light)||void 0===e?void 0:e.hasTransition())return!0;if(null===(t=this.sky)||void 0===t?void 0:t.hasTransition())return!0;if(null===(i=this.projection)||void 0===i?void 0:i.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const i=this._changed;if(i){const t=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);(t.length||i.length)&&this._updateWorkerLayers(t,i);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const r={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];r[e]=t.used,t.used=!1}for(const t of this._order){const i=this._layers[t];i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)&&i.source&&(this.sourceCaches[i.source].used=!0)}for(const e in r){const i=this.sourceCaches[e];!!r[e]!=!!i.used&&i.fire(new t.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,i&&this.fire(new t.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,i={}){var r;this._checkLoaded();const n=this.serialize();if(e=i.transformStyle?i.transformStyle(n,e):e,(null===(r=i.validate)||void 0===r||r)&&_i(this,t.y(e)))return!1;(e=t.bB(e)).layers=t.bz(e.layers);const o=t.bC(n,e),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const e of s.operations)e();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const t=[],i=[];for(const r of e)switch(r.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":t.push((()=>this.addLayer.apply(this,r.args)));break;case"removeLayer":t.push((()=>this.removeLayer.apply(this,r.args)));break;case"setPaintProperty":t.push((()=>this.setPaintProperty.apply(this,r.args)));break;case"setLayoutProperty":t.push((()=>this.setLayoutProperty.apply(this,r.args)));break;case"setFilter":t.push((()=>this.setFilter.apply(this,r.args)));break;case"addSource":t.push((()=>this.addSource.apply(this,r.args)));break;case"removeSource":t.push((()=>this.removeSource.apply(this,r.args)));break;case"setLayerZoomRange":t.push((()=>this.setLayerZoomRange.apply(this,r.args)));break;case"setLight":t.push((()=>this.setLight.apply(this,r.args)));break;case"setGeoJSONSourceData":t.push((()=>this.setGeoJSONSourceData.apply(this,r.args)));break;case"setGlyphs":t.push((()=>this.setGlyphs.apply(this,r.args)));break;case"setSprite":t.push((()=>this.setSprite.apply(this,r.args)));break;case"setTerrain":t.push((()=>this.map.setTerrain.apply(this,r.args)));break;case"setSky":t.push((()=>this.setSky.apply(this,r.args)));break;case"setProjection":this.setProjection.apply(this,r.args);break;case"setTransition":t.push((()=>{}));break;default:i.push(r.command)}return{operations:t,unimplemented:i}}addImage(e,i){if(this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,i),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,i,r={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(t.y.source,`sources.${e}`,i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=this.sourceCaches[e]=new xe(e,i,this.dispatcher);n.style=this,n.setEventedParent(this,(()=>({isSourceLoaded:n.loaded(),source:n.serialize(),sourceId:e}))),n.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.k(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));const i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error(`There is no source with this ID=${e}`);const i=this.sourceCaches[e].getSource();if("geojson"!==i.type)throw new Error(`geojsonSource.type is ${i.type}, which is !== 'geojson`);i.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,i,r={}){this._checkLoaded();const n=e.id;if(this.getLayer(n))return void this.fire(new t.k(new Error(`Layer "${n}" already exists on this map.`)));let o;if("custom"===e.type){if(_i(this,t.bD(e)))return;o=t.bA(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(n,e.source),e=t.bB(e),e=t.e(e,{source:n})),this._validate(t.y.layer,`layers.${n}`,e,{arrayIndex:-1},r))return;o=t.bA(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:n}})}const s=i?this._order.indexOf(i):this._order.length;if(i&&-1===s)this.fire(new t.k(new Error(`Cannot add layer "${n}" before non-existing layer "${i}".`)));else{if(this._order.splice(s,0,n),this._layerOrderChanged=!0,this._layers[n]=o,this._removedLayers[n]&&o.source&&"custom"!==o.type){const e=this._removedLayers[n];delete this._removedLayers[n],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,i){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===i)return;const r=this._order.indexOf(e);this._order.splice(r,1);const n=i?this._order.indexOf(i):this._order.length;i&&-1===n?this.fire(new t.k(new Error(`Cannot move layer "${e}" before non-existing layer "${i}".`))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const i=this._layers[e];if(!i)return void this.fire(new t.k(new Error(`Cannot remove non-existing layer "${e}".`)));i.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=i,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],i.onRemove&&i.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,i,r){this._checkLoaded();const n=this.getLayer(e);n?n.minzoom===i&&n.maxzoom===r||(null!=i&&(n.minzoom=i),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new t.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,i,r={}){this._checkLoaded();const n=this.getLayer(e);if(n){if(!t.bE(n.filter,i))return null==i?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.y.filter,`layers.${n.id}.filter`,i,null,r)||(n.filter=t.bB(i),this._updateLayer(n)))}else this.fire(new t.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.bB(this.getLayer(e).filter)}setLayoutProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.bE(o.getLayoutProperty(i),r)||(o.setLayoutProperty(i,r,n),this._updateLayer(o)):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,i){const r=this.getLayer(e);if(r)return r.getLayoutProperty(i);this.fire(new t.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,i,r,n={}){this._checkLoaded();const o=this.getLayer(e);o?t.bE(o.getPaintProperty(i),r)||(o.setPaintProperty(i,r,n)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new t.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,i){this._checkLoaded();const r=e.source,n=e.sourceLayer,o=this.sourceCaches[r];if(void 0===o)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&n?this.fire(new t.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),o.setFeatureState(n,e.id,i)):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,i){this._checkLoaded();const r=e.source,n=this.sourceCaches[r];if(void 0===n)return void this.fire(new t.k(new Error(`The source '${r}' does not exist in the map's style.`)));const o=n.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?i&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.k(new Error("A feature id is required to remove its specific state property."))):n.removeFeatureState(s,e.id,i):this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const i=e.source,r=e.sourceLayer,n=this.sourceCaches[i];if(void 0!==n)return"vector"!==n.getSource().type||r?(void 0===e.id&&this.fire(new t.k(new Error("The feature id parameter must be provided."))),n.getFeatureState(r,e.id)):void this.fire(new t.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.k(new Error(`The source '${i}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.bF(this.sourceCaches,(e=>e.serialize())),i=this._serializeByIds(this._order,!0),r=this.map.getTerrain()||void 0,n=this.stylesheet;return t.bG({version:n.version,name:n.name,metadata:n.metadata,light:n.light,sky:n.sky,center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,sprite:n.sprite,glyphs:n.glyphs,transition:n.transition,projection:n.projection,sources:e,layers:i,terrain:r},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,i={},r=[];for(let n=this._order.length-1;n>=0;n--){const o=this._order[n];if(t(o)){i[o]=n;for(const t of e){const e=t[o];if(e)for(const t of e)r.push(t)}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const n=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(i[t.layer.id]<o)break;n.push(t),r.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)n.push(t.feature)}}return n}queryRenderedFeatures(e,i,r){i&&i.filter&&this._validate(t.y.filter,"queryRenderedFeatures.filter",i.filter,null,i);const n={};if(i&&i.layers){if(!(Array.isArray(i.layers)||i.layers instanceof Set))return this.fire(new t.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const e of i.layers){const i=this._layers[e];if(!i)return this.fire(new t.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[i.source]=!0}}const o=[];i.availableImages=this._availableImages;const s=this._serializedAllLayers(),a=i.layers instanceof Set?i.layers:Array.isArray(i.layers)?new Set(i.layers):null,l=Object.assign(Object.assign({},i),{layers:a});for(const t in this.sourceCaches)i.layers&&!n[t]||o.push($(this.sourceCaches[t],this._layers,s,e,l,r,this.map.terrain?(e,t,i)=>this.map.terrain.getElevation(e,t,i):void 0));return this.placement&&o.push(function(e,t,i,r,n,o,s){const a={},l=o.queryRenderedSymbols(r),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(N);for(const i of c){const r=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],t,i.bucketIndex,i.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in r){const t=a[e]=a[e]||[],n=r[e];n.sort(((e,t)=>{const r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));for(const e of n)t.push(e)}}return function(e,t,i){for(const r in e)for(const n of e[r])U(n,i[t[r].source]);return e}(a,e,i)}(this._layers,s,this.sourceCaches,e,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,i){i&&i.filter&&this._validate(t.y.filter,"querySourceFeatures.filter",i.filter,null,i);const r=this.sourceCaches[e];return r?function(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let e=0;e<i.length;e++){const o=i[e],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(r,t))}return r}(r,i):[]}getLight(){return this.light.getLight()}setLight(e,i={}){this._checkLoaded();const r=this.light.getLight();let n=!1;for(const i in e)if(!t.bE(e[i],r[i])){n=!0;break}if(!n)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,i),this.light.updateTransitions(o)}getProjection(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return null===(e=this.stylesheet)||void 0===e?void 0:e.sky}setSky(e,i={}){this._checkLoaded();const r=this.getSky();let n=!1;if(!e&&!r)return;if(e&&!r)n=!0;else if(!e&&r)n=!0;else for(const i in e)if(!t.bE(e[i],r[i])){n=!0;break}if(!n)return;const o={now:s.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,i),this.sky.updateTransitions(o)}_setProjectionInternal(e){const i=function(e){if(Array.isArray(e)){const t=new Qt({type:e});return{projection:t,transform:new mi,cameraHelper:new yi(t)}}switch(e){case"mercator":return{projection:new Mt,transform:new Dt,cameraHelper:new Ft};case"globe":{const e=new Qt({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:e,transform:new mi,cameraHelper:new yi(e)}}case"vertical-perspective":return{projection:new Yt,transform:new fi,cameraHelper:new gi};default:return t.w(`Unknown projection name: ${e}. Falling back to mercator projection.`),{projection:new Mt,transform:new Dt,cameraHelper:new Ft}}}(e);this.projection=i.projection,this.map.migrateProjection(i.transform,i.cameraHelper);for(const e in this.sourceCaches)this.sourceCaches[e].reload()}_validate(e,i,r,n,o={}){return(!o||!1!==o.validate)&&_i(this,e.call(t.y,t.e({key:i,style:this.serialize(),value:r,styleSpec:t.v},n)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ne().off(te,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,t,i,r,n=!1){let o=!1,a=!1;const l={};for(const t of this._order){const i=this._layers[t];if("symbol"!==i.type)continue;if(!l[i.source]){const e=this.sourceCaches[i.source];l[i.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const r=this.crossTileSymbolIndex.addLayer(i,l[i.source],e.center.lng);o=o||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((n=n||this._layerOrderChanged||0===i)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.now(),e.zoom))&&(this.pauseablePlacement=new pt(e,this.map.terrain,this._order,n,t,i,r,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,i){return t._(this,void 0,void 0,(function*(){const e=yield this.imageManager.getImages(i.icons);this._updateTilesForChangedImages();const t=this.sourceCaches[i.source];return t&&t.setDependencies(i.tileID.key,i.type,i.icons),e}))}getGlyphs(e,i){return t._(this,void 0,void 0,(function*(){const e=yield this.glyphManager.getGlyphs(i.stacks),t=this.sourceCaches[i.source];return t&&t.setDependencies(i.tileID.key,i.type,[""]),e}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,i={}){this._checkLoaded(),e&&this._validate(t.y.glyphs,"glyphs",e,null,i)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,i,r={},n){this._checkLoaded();const o=[{id:e,url:i}],s=[...g(this.stylesheet.sprite),...o];this._validate(t.y.sprite,"sprite",s,null,r)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,n))}removeSprite(e){this._checkLoaded();const i=g(this.stylesheet.sprite);if(i.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;i.splice(i.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=i.length>0?i:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.l("data",{dataType:"style"}))}else this.fire(new t.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return g(this.stylesheet.sprite)}setSprite(e,i={},r){this._checkLoaded(),e&&this._validate(t.y.sprite,"sprite",e,null,i)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,r):(this._unloadSprite(),r&&r(null)))}}var bi=t.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wi{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,i,r,n,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==r.length;for(let e=0;!c&&e<r.length;e++)this.boundPaintVertexBuffers[e]!==r[e]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,i,r,n,o,s,a,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),n&&n.dynamicDraw&&n.bind(),a&&a.bind(),l&&l.bind())}freshBind(e,t,i,r,n,o,s,a){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,t.enableAttributes(u,e);for(const t of i)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),a&&a.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,n);for(const t of i)t.bind(),t.setVertexAttribPointers(u,e,n);o&&(o.bind(),o.setVertexAttribPointers(u,e,n)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,n)),a&&(a.bind(),a.setVertexAttribPointers(u,e,n)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ti=(e,i,r,n,o)=>({u_texture:0,u_ele_delta:e,u_fog_matrix:i,u_fog_color:r?r.properties.get("fog-color"):t.b7.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:o?0:r?r.calculateFogBlendOpacity(n):0,u_horizon_color:r?r.properties.get("horizon-color"):t.b7.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:o?1:0}),Si={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ci(e){const t=[];for(let i=0;i<e.length;i++){if(null===e[i])continue;const r=e[i].split(" ");t.push(r.pop())}return t}class Mi{constructor(e,i,r,n,o,s,a,l,c=[]){const u=e.gl;this.program=u.createProgram();const h=Ci(i.staticAttributes),d=r?r.getBinderAttributes():[],p=h.concat(d),f=xt.prelude.staticUniforms?Ci(xt.prelude.staticUniforms):[],m=a.staticUniforms?Ci(a.staticUniforms):[],g=i.staticUniforms?Ci(i.staticUniforms):[],y=r?r.getBinderUniforms():[],_=f.concat(m).concat(g).concat(y),v=[];for(const e of _)v.indexOf(e)<0&&v.push(e);const x=r?r.defines():[];Zt(u)&&x.unshift("#version 300 es"),o&&x.push("#define OVERDRAW_INSPECTOR;"),s&&x.push("#define TERRAIN3D;"),l&&x.push(l),c&&x.push(...c);let b=x.concat(xt.prelude.fragmentSource,a.fragmentSource,i.fragmentSource).join("\n"),w=x.concat(xt.prelude.vertexSource,a.vertexSource,i.vertexSource).join("\n");Zt(u)||(b=function(e){return e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(b),w=function(e){return e.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(w));const T=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(T,b),u.compileShader(T),!u.getShaderParameter(T,u.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${u.getShaderInfoLog(T)}`);u.attachShader(this.program,T);const S=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);if(u.shaderSource(S,w),u.compileShader(S),!u.getShaderParameter(S,u.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${u.getShaderInfoLog(S)}`);u.attachShader(this.program,S),this.attributes={};const C={};this.numAttributes=p.length;for(let e=0;e<this.numAttributes;e++)p[e]&&(u.bindAttribLocation(this.program,e,p[e]),this.attributes[p[e]]=e);if(u.linkProgram(this.program),!u.getProgramParameter(this.program,u.LINK_STATUS))throw new Error(`Program failed to link: ${u.getProgramInfoLog(this.program)}`);u.deleteShader(S),u.deleteShader(T);for(let e=0;e<v.length;e++){const t=v[e];if(t&&!C[t]){const e=u.getUniformLocation(this.program,t);e&&(C[t]=e)}}this.fixedUniforms=n(e,C),this.terrainUniforms=((e,i)=>({u_depth:new t.bH(e,i.u_depth),u_terrain:new t.bH(e,i.u_terrain),u_terrain_dim:new t.b8(e,i.u_terrain_dim),u_terrain_matrix:new t.bJ(e,i.u_terrain_matrix),u_terrain_unpack:new t.bK(e,i.u_terrain_unpack),u_terrain_exaggeration:new t.b8(e,i.u_terrain_exaggeration)}))(e,C),this.projectionUniforms=((e,i)=>({u_projection_matrix:new t.bJ(e,i.u_projection_matrix),u_projection_tile_mercator_coords:new t.bK(e,i.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.bK(e,i.u_projection_clipping_plane),u_projection_transition:new t.b8(e,i.u_projection_transition),u_projection_fallback_matrix:new t.bJ(e,i.u_projection_fallback_matrix)}))(e,C),this.binderUniforms=r?r.getUniforms(e,C):[]}draw(e,t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,_){const v=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(i),e.setStencilMode(r),e.setColorMode(n),e.setCullFace(o),a){e.activeTexture.set(v.TEXTURE2),v.bindTexture(v.TEXTURE_2D,a.depthTexture),e.activeTexture.set(v.TEXTURE3),v.bindTexture(v.TEXTURE_2D,a.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(a[e])}if(l)for(const e in l)this.projectionUniforms[Si[e]].set(l[e]);if(s)for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);m&&m.setUniforms(e,this.binderUniforms,p,{zoom:f});let x=0;switch(t){case v.LINES:x=2;break;case v.TRIANGLES:x=3;break;case v.LINE_STRIP:x=1}for(const i of d.get()){const r=i.vaos||(i.vaos={});(r[c]||(r[c]=new wi)).bind(e,this,u,m?m.getPaintVertexBuffers():[],h,i.vertexOffset,g,y,_),v.drawElements(t,i.primitiveLength*x,v.UNSIGNED_SHORT,i.primitiveOffset*x*2)}}}function ki(e,i,r){const n=1/t.az(r,1,i.transform.tileZoom),o=Math.pow(2,r.tileID.overscaledZ),s=r.tileSize*Math.pow(2,i.transform.tileZoom)/o,a=s*(r.tileID.canonical.x+r.tileID.wrap*o),l=s*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[a>>16,l>>16],u_pixel_coord_lower:[65535&a,65535&l]}}const Ei=(e,i,r,n)=>{const o=e.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=t.bN();"viewport"===o.properties.get("anchor")&&t.bO(l,e.transform.bearingInRadians),t.bP(a,a,l);const c=e.transform.transformLightDirection(a),u=o.properties.get("color");return{u_lightpos:a,u_lightpos_globe:c,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+i,u_opacity:r,u_fill_translate:n}},Ai=(e,i,r,n,o,s,a)=>t.e(Ei(e,i,r,n),ki(s,e,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),Ii=(e,i,r,n)=>t.e(ki(i,e,r),{u_fill_translate:n}),zi=(e,t)=>({u_world:e,u_fill_translate:t}),Pi=(e,i,r,n,o)=>t.e(Ii(e,i,r,o),{u_world:n}),Li=(e,i,r,n,o)=>{const s=e.transform;let a,l,c=0;if("map"===r.paint.get("circle-pitch-alignment")){const e=t.az(i,1,s.zoom);a=!0,l=[e,e],c=e/(t.Z*Math.pow(2,i.tileID.overscaledZ))*2*Math.PI*o}else a=!1,l=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===r.paint.get("circle-pitch-scale")),u_pitch_with_map:+a,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:l,u_globe_extrude_scale:c,u_translate:n}},Di=e=>({u_pixel_extrude_scale:[1/e.width,1/e.height]}),Ri=e=>({u_viewport_size:[e.width,e.height]}),Bi=(e,t=1)=>({u_color:e,u_overlay:0,u_overlay_scale:t}),Oi=(e,i,r,n)=>{const o=t.az(e,1,i)/(t.Z*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*n;return{u_extrude_scale:t.az(e,1,i),u_intensity:r,u_globe_extrude_scale:o}},Fi=(e,i,r,n)=>{const o=t.K();t.bQ(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:r,u_color_ramp:n,u_opacity:i.paint.get("heatmap-opacity")}},ji=(e,t,i)=>{const r=i.paint.get("hillshade-accent-color");let n;switch(i.paint.get("hillshade-method")){case"basic":n=4;break;case"combined":n=1;break;case"igor":n=2;break;case"multidirectional":n=3;break;default:n=0}const o=i.getIlluminationProperties();for(let t=0;t<o.directionRadians.length;t++)"viewport"===i.paint.get("hillshade-illumination-anchor")&&(o.directionRadians[t]+=e.transform.bearingInRadians);return{u_image:0,u_latrange:Ni(0,t.tileID),u_exaggeration:i.paint.get("hillshade-exaggeration"),u_altitudes:o.altitudeRadians,u_azimuths:o.directionRadians,u_accent:r,u_method:n,u_highlights:o.highlightColor,u_shadows:o.shadowColor}},$i=(e,i)=>{const r=i.stride,n=t.K();return t.bQ(n,0,t.Z,-8192,0,0,1),t.L(n,n,[0,-8192,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:i.getUnpackVector()}};function Ni(e,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new t.$(0,n/r).toLngLat().lat,new t.$(0,(n+1)/r).toLngLat().lat]}const Ui=(e,i,r,n)=>{const o=e.transform;return{u_translation:Wi(e,i,r),u_ratio:n/t.az(i,1,o.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Vi=(e,i,r,n,o)=>t.e(Ui(e,i,r,n),{u_image:0,u_image_height:o}),Gi=(e,i,r,n,o)=>{const s=e.transform,a=Zi(i,s);return{u_translation:Wi(e,i,r),u_texsize:i.imageAtlasTexture.size,u_ratio:n/t.az(i,1,s.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[a,o.fromScale,o.toScale],u_fade:o.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]]}},qi=(e,i,r,n,o,s)=>{const a=e.lineAtlas,l=Zi(i,e.transform),c="round"===r.layout.get("line-cap"),u=a.getDash(o.from,c),h=a.getDash(o.to,c),d=u.width*s.fromScale,p=h.width*s.toScale;return t.e(Ui(e,i,r,n),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:s.t})};function Zi(e,i){return 1/t.az(e,1,i.tileZoom)}function Wi(e,i,r){return t.aA(e.transform,i,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Hi=(e,t,i,r,n)=>{return{u_tl_parent:e,u_scale_parent:t,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Xi(r.paint.get("raster-hue-rotate")),u_coords_top:[n[0].x,n[0].y,n[1].x,n[1].y],u_coords_bottom:[n[3].x,n[3].y,n[2].x,n[2].y]};var o,s};function Xi(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Ki=(e,t,i,r,n,o,s,a,l,c,u,h,d)=>{const p=s.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:p.cameraToCenterDistance,u_pitch:p.pitch/360*2*Math.PI,u_rotate_symbol:+i,u_aspect_ratio:p.width/p.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_pitch_with_map:+r,u_is_along_line:n,u_is_variable_anchor:o,u_texsize:h,u_texture:0,u_translation:c,u_pitched_scale:d}},Yi=(e,i,r,n,o,s,a,l,c,u,h,d,p,f)=>{const m=a.transform;return t.e(Ki(e,i,r,n,o,s,a,l,c,u,h,d,f),{u_gamma_scale:n?Math.cos(m.pitch*Math.PI/180)*m.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:1})},Ji=(e,i,r,n,o,s,a,l,c,u,h,d,p)=>t.e(Yi(e,i,r,n,o,s,a,l,c,u,!0,h,0,p),{u_texsize_icon:d,u_texture_icon:1}),Qi=(e,t)=>({u_opacity:e,u_color:t}),er=(e,i,r,n,o)=>t.e(function(e,i,r,n){const o=r.imageManager.getPattern(e.from.toString()),s=r.imageManager.getPattern(e.to.toString()),{width:a,height:l}=r.imageManager.getPixelSize(),c=Math.pow(2,n.tileID.overscaledZ),u=n.tileSize*Math.pow(2,r.transform.tileZoom)/c,h=u*(n.tileID.canonical.x+n.tileID.wrap*c),d=u*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:o.tl,u_pattern_br_a:o.br,u_pattern_tl_b:s.tl,u_pattern_br_b:s.br,u_texsize:[a,l],u_mix:i.t,u_pattern_size_a:o.displaySize,u_pattern_size_b:s.displaySize,u_scale_a:i.fromScale,u_scale_b:i.toScale,u_tile_units_to_pixels:1/t.az(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,d>>16],u_pixel_coord_lower:[65535&h,65535&d]}}(r,o,i,n),{u_opacity:e}),tr=(e,t)=>{},ir={fillExtrusion:(e,i)=>({u_lightpos:new t.bL(e,i.u_lightpos),u_lightpos_globe:new t.bL(e,i.u_lightpos_globe),u_lightintensity:new t.b8(e,i.u_lightintensity),u_lightcolor:new t.bL(e,i.u_lightcolor),u_vertical_gradient:new t.b8(e,i.u_vertical_gradient),u_opacity:new t.b8(e,i.u_opacity),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillExtrusionPattern:(e,i)=>({u_lightpos:new t.bL(e,i.u_lightpos),u_lightpos_globe:new t.bL(e,i.u_lightpos_globe),u_lightintensity:new t.b8(e,i.u_lightintensity),u_lightcolor:new t.bL(e,i.u_lightcolor),u_vertical_gradient:new t.b8(e,i.u_vertical_gradient),u_height_factor:new t.b8(e,i.u_height_factor),u_opacity:new t.b8(e,i.u_opacity),u_fill_translate:new t.bM(e,i.u_fill_translate),u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade)}),fill:(e,i)=>({u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillPattern:(e,i)=>({u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillOutline:(e,i)=>({u_world:new t.bM(e,i.u_world),u_fill_translate:new t.bM(e,i.u_fill_translate)}),fillOutlinePattern:(e,i)=>({u_world:new t.bM(e,i.u_world),u_image:new t.bH(e,i.u_image),u_texsize:new t.bM(e,i.u_texsize),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade),u_fill_translate:new t.bM(e,i.u_fill_translate)}),circle:(e,i)=>({u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_scale_with_map:new t.bH(e,i.u_scale_with_map),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_extrude_scale:new t.bM(e,i.u_extrude_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_globe_extrude_scale:new t.b8(e,i.u_globe_extrude_scale),u_translate:new t.bM(e,i.u_translate)}),collisionBox:(e,i)=>({u_pixel_extrude_scale:new t.bM(e,i.u_pixel_extrude_scale)}),collisionCircle:(e,i)=>({u_viewport_size:new t.bM(e,i.u_viewport_size)}),debug:(e,i)=>({u_color:new t.bI(e,i.u_color),u_overlay:new t.bH(e,i.u_overlay),u_overlay_scale:new t.b8(e,i.u_overlay_scale)}),depth:tr,clippingMask:tr,heatmap:(e,i)=>({u_extrude_scale:new t.b8(e,i.u_extrude_scale),u_intensity:new t.b8(e,i.u_intensity),u_globe_extrude_scale:new t.b8(e,i.u_globe_extrude_scale)}),heatmapTexture:(e,i)=>({u_matrix:new t.bJ(e,i.u_matrix),u_world:new t.bM(e,i.u_world),u_image:new t.bH(e,i.u_image),u_color_ramp:new t.bH(e,i.u_color_ramp),u_opacity:new t.b8(e,i.u_opacity)}),hillshade:(e,i)=>({u_image:new t.bH(e,i.u_image),u_latrange:new t.bM(e,i.u_latrange),u_exaggeration:new t.b8(e,i.u_exaggeration),u_altitudes:new t.bS(e,i.u_altitudes),u_azimuths:new t.bS(e,i.u_azimuths),u_accent:new t.bI(e,i.u_accent),u_method:new t.bH(e,i.u_method),u_shadows:new t.bR(e,i.u_shadows),u_highlights:new t.bR(e,i.u_highlights)}),hillshadePrepare:(e,i)=>({u_matrix:new t.bJ(e,i.u_matrix),u_image:new t.bH(e,i.u_image),u_dimension:new t.bM(e,i.u_dimension),u_zoom:new t.b8(e,i.u_zoom),u_unpack:new t.bK(e,i.u_unpack)}),line:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels)}),lineGradient:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_image:new t.bH(e,i.u_image),u_image_height:new t.b8(e,i.u_image_height)}),linePattern:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_texsize:new t.bM(e,i.u_texsize),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_image:new t.bH(e,i.u_image),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_scale:new t.bL(e,i.u_scale),u_fade:new t.b8(e,i.u_fade)}),lineSDF:(e,i)=>({u_translation:new t.bM(e,i.u_translation),u_ratio:new t.b8(e,i.u_ratio),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_units_to_pixels:new t.bM(e,i.u_units_to_pixels),u_patternscale_a:new t.bM(e,i.u_patternscale_a),u_patternscale_b:new t.bM(e,i.u_patternscale_b),u_sdfgamma:new t.b8(e,i.u_sdfgamma),u_image:new t.bH(e,i.u_image),u_tex_y_a:new t.b8(e,i.u_tex_y_a),u_tex_y_b:new t.b8(e,i.u_tex_y_b),u_mix:new t.b8(e,i.u_mix)}),raster:(e,i)=>({u_tl_parent:new t.bM(e,i.u_tl_parent),u_scale_parent:new t.b8(e,i.u_scale_parent),u_buffer_scale:new t.b8(e,i.u_buffer_scale),u_fade_t:new t.b8(e,i.u_fade_t),u_opacity:new t.b8(e,i.u_opacity),u_image0:new t.bH(e,i.u_image0),u_image1:new t.bH(e,i.u_image1),u_brightness_low:new t.b8(e,i.u_brightness_low),u_brightness_high:new t.b8(e,i.u_brightness_high),u_saturation_factor:new t.b8(e,i.u_saturation_factor),u_contrast_factor:new t.b8(e,i.u_contrast_factor),u_spin_weights:new t.bL(e,i.u_spin_weights),u_coords_top:new t.bK(e,i.u_coords_top),u_coords_bottom:new t.bK(e,i.u_coords_bottom)}),symbolIcon:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texture:new t.bH(e,i.u_texture),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),symbolSDF:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texture:new t.bH(e,i.u_texture),u_gamma_scale:new t.b8(e,i.u_gamma_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_is_halo:new t.bH(e,i.u_is_halo),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),symbolTextAndIcon:(e,i)=>({u_is_size_zoom_constant:new t.bH(e,i.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bH(e,i.u_is_size_feature_constant),u_size_t:new t.b8(e,i.u_size_t),u_size:new t.b8(e,i.u_size),u_camera_to_center_distance:new t.b8(e,i.u_camera_to_center_distance),u_pitch:new t.b8(e,i.u_pitch),u_rotate_symbol:new t.bH(e,i.u_rotate_symbol),u_aspect_ratio:new t.b8(e,i.u_aspect_ratio),u_fade_change:new t.b8(e,i.u_fade_change),u_label_plane_matrix:new t.bJ(e,i.u_label_plane_matrix),u_coord_matrix:new t.bJ(e,i.u_coord_matrix),u_is_text:new t.bH(e,i.u_is_text),u_pitch_with_map:new t.bH(e,i.u_pitch_with_map),u_is_along_line:new t.bH(e,i.u_is_along_line),u_is_variable_anchor:new t.bH(e,i.u_is_variable_anchor),u_texsize:new t.bM(e,i.u_texsize),u_texsize_icon:new t.bM(e,i.u_texsize_icon),u_texture:new t.bH(e,i.u_texture),u_texture_icon:new t.bH(e,i.u_texture_icon),u_gamma_scale:new t.b8(e,i.u_gamma_scale),u_device_pixel_ratio:new t.b8(e,i.u_device_pixel_ratio),u_is_halo:new t.bH(e,i.u_is_halo),u_translation:new t.bM(e,i.u_translation),u_pitched_scale:new t.b8(e,i.u_pitched_scale)}),background:(e,i)=>({u_opacity:new t.b8(e,i.u_opacity),u_color:new t.bI(e,i.u_color)}),backgroundPattern:(e,i)=>({u_opacity:new t.b8(e,i.u_opacity),u_image:new t.bH(e,i.u_image),u_pattern_tl_a:new t.bM(e,i.u_pattern_tl_a),u_pattern_br_a:new t.bM(e,i.u_pattern_br_a),u_pattern_tl_b:new t.bM(e,i.u_pattern_tl_b),u_pattern_br_b:new t.bM(e,i.u_pattern_br_b),u_texsize:new t.bM(e,i.u_texsize),u_mix:new t.b8(e,i.u_mix),u_pattern_size_a:new t.bM(e,i.u_pattern_size_a),u_pattern_size_b:new t.bM(e,i.u_pattern_size_b),u_scale_a:new t.b8(e,i.u_scale_a),u_scale_b:new t.b8(e,i.u_scale_b),u_pixel_coord_upper:new t.bM(e,i.u_pixel_coord_upper),u_pixel_coord_lower:new t.bM(e,i.u_pixel_coord_lower),u_tile_units_to_pixels:new t.b8(e,i.u_tile_units_to_pixels)}),terrain:(e,i)=>({u_texture:new t.bH(e,i.u_texture),u_ele_delta:new t.b8(e,i.u_ele_delta),u_fog_matrix:new t.bJ(e,i.u_fog_matrix),u_fog_color:new t.bI(e,i.u_fog_color),u_fog_ground_blend:new t.b8(e,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.b8(e,i.u_fog_ground_blend_opacity),u_horizon_color:new t.bI(e,i.u_horizon_color),u_horizon_fog_blend:new t.b8(e,i.u_horizon_fog_blend),u_is_globe_mode:new t.b8(e,i.u_is_globe_mode)}),terrainDepth:(e,i)=>({u_ele_delta:new t.b8(e,i.u_ele_delta)}),terrainCoords:(e,i)=>({u_texture:new t.bH(e,i.u_texture),u_terrain_coords_id:new t.b8(e,i.u_terrain_coords_id),u_ele_delta:new t.b8(e,i.u_ele_delta)}),projectionErrorMeasurement:(e,i)=>({u_input:new t.b8(e,i.u_input),u_output_expected:new t.b8(e,i.u_output_expected)}),atmosphere:(e,i)=>({u_sun_pos:new t.bL(e,i.u_sun_pos),u_atmosphere_blend:new t.b8(e,i.u_atmosphere_blend),u_globe_position:new t.bL(e,i.u_globe_position),u_globe_radius:new t.b8(e,i.u_globe_radius),u_inv_proj_matrix:new t.bJ(e,i.u_inv_proj_matrix)}),sky:(e,i)=>({u_sky_color:new t.bI(e,i.u_sky_color),u_horizon_color:new t.bI(e,i.u_horizon_color),u_horizon:new t.bM(e,i.u_horizon),u_horizon_normal:new t.bM(e,i.u_horizon_normal),u_sky_horizon_blend:new t.b8(e,i.u_sky_horizon_blend),u_sky_blend:new t.b8(e,i.u_sky_blend)})};class rr{constructor(e,t,i){this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class or{constructor(e,t,i,r){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],o=t.attributes[n.name];void 0!==o&&e.vertexAttribPointer(o,n.components,e[nr[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class sr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ar extends sr{getDefault(){return t.b7.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class lr extends sr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class cr extends sr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ur extends sr{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class hr extends sr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class dr extends sr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class pr extends sr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class fr extends sr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class mr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class gr extends sr{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class yr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class _r extends sr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class vr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class xr extends sr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class br extends sr{getDefault(){return t.b7.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wr extends sr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Tr extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Sr extends sr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Cr extends sr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Mr extends sr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class kr extends sr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Er extends sr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ar extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ir extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class zr extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Pr extends sr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Lr extends sr{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Dr extends sr{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const i=this.gl;Zt(i)?i.bindVertexArray(e):null===(t=i.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Rr extends sr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Br extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Or extends sr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Fr extends sr{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class jr extends Fr{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class $r extends Fr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nr extends Fr{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ur="Framebuffer is not complete";class Vr{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;const o=e.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new jr(e,s),r)this.depthAttachment=n?new Nr(e,s):new $r(e,s);else if(n)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error(Ur)}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Gr{constructor(e){var t,i;if(this.gl=e,this.clearColor=new ar(this),this.clearDepth=new lr(this),this.clearStencil=new cr(this),this.colorMask=new ur(this),this.depthMask=new hr(this),this.stencilMask=new dr(this),this.stencilFunc=new pr(this),this.stencilOp=new fr(this),this.stencilTest=new mr(this),this.depthRange=new gr(this),this.depthTest=new yr(this),this.depthFunc=new _r(this),this.blend=new vr(this),this.blendFunc=new xr(this),this.blendColor=new br(this),this.blendEquation=new wr(this),this.cullFace=new Tr(this),this.cullFaceSide=new Sr(this),this.frontFace=new Cr(this),this.program=new Mr(this),this.activeTexture=new kr(this),this.viewport=new Er(this),this.bindFramebuffer=new Ar(this),this.bindRenderbuffer=new Ir(this),this.bindTexture=new zr(this),this.bindVertexBuffer=new Pr(this),this.bindElementBuffer=new Lr(this),this.bindVertexArray=new Dr(this),this.pixelStoreUnpack=new Rr(this),this.pixelStoreUnpackPremultiplyAlpha=new Br(this),this.pixelStoreUnpackFlipY=new Or(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Zt(e)){this.HALF_FLOAT=e.HALF_FLOAT;const r=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==r?void 0:r.RGBA16F_EXT,this.RGB16F=null!==(i=e.RGB16F)&&void 0!==i?i:null==r?void 0:r.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new rr(this,e,t)}createVertexBuffer(e,t,i){return new or(this,e,t,i)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new Vr(this,e,t,i,r)}clear({color:e,depth:t,stencil:i}){const r=this.gl;let n=0;e&&(n|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(n|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(n|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(n)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.bE(e.blendFunction,jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Zt(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return Zt(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let qr;function Zr(e,i,r,n,o){const s=e.context,a=e.transform,l=s.gl,c=e.useProgram("collisionBox"),u=[];let h=0,d=0;for(let t=0;t<n.length;t++){const p=n[t],f=i.getTile(p).getBucket(r);if(!f)continue;const m=o?f.textCollisionBox:f.iconCollisionBox,g=f.collisionCircleArray;g.length>0&&(u.push({circleArray:g,circleOffset:d,coord:p}),h+=g.length/4,d=h),m&&c.draw(s,l.LINES,Ut.disabled,Gt.disabled,e.colorModeForRenderPass(),Nt.disabled,Di(e.transform),e.style.map.terrain&&e.style.map.terrain.getTerrainData(p),a.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,e.transform.zoom,null,null,m.collisionVertexBuffer)}if(!o||!u.length)return;const p=e.useProgram("collisionCircle"),f=new t.bT;f.resize(4*h),f._trim();let m=0;for(const e of u)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],o=e.circleArray[i+2],s=e.circleArray[i+3];f.emplace(m++,r,n,o,s,0),f.emplace(m++,r,n,o,s,1),f.emplace(m++,r,n,o,s,2),f.emplace(m++,r,n,o,s,3)}(!qr||qr.length<2*h)&&(qr=function(e){const i=2*e,r=new t.bV;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(h));const g=s.createIndexBuffer(qr,!0),y=s.createVertexBuffer(f,t.bU.members,!0);for(const i of u){const n=Ri(e.transform);p.draw(s,l.TRIANGLES,Ut.disabled,Gt.disabled,e.colorModeForRenderPass(),Nt.disabled,n,e.style.map.terrain&&e.style.map.terrain.getTerrainData(i.coord),null,r.id,y,g,t.aJ.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,e.transform.zoom,null,null,null)}y.destroy(),g.destroy()}const Wr=t.ad(new Float32Array(16));function Hr(e,i,r,n,o,s){const{horizontalAlign:a,verticalAlign:l}=t.aE(e);return new t.P((-(a-.5)*i/o+n[0])*s,(-(l-.5)*r/o+n[1])*s)}function Xr(e,i,r,n,o,s){const a=i.tileAnchorPoint.add(new t.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let e=n.mult(s);r||(e=e.rotate(-o));const t=a.add(e);return Ae(t.x,t.y,i.pitchedLabelPlaneMatrix,i.getElevation).point}if(r){const t=Fe(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(e),r=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(n.rotate(r))}return e.add(n)}function Kr(e,i,r,n,o,s,a,l,c,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={};f.clear();for(let m=0;m<p.length;m++){const y=p.get(m),_=y.hidden||!y.crossTileID||e.allowVerticalPlacement&&!y.placedOrientation?null:n[y.crossTileID];if(_){const n=new t.P(y.anchorX,y.anchorY),p={getElevation:d,width:o.width,height:o.height,pitchedLabelPlaneMatrix:s,pitchWithMap:r,transform:o,tileAnchorPoint:n,translation:u,unwrappedTileID:h},m=r?$e(n.x,n.y,p):Fe(n.x,n.y,p),v=Ie(o.cameraToCenterDistance,m.signedDistanceFromCamera);let x=t.am(e.textSizeData,l,y)*v/t.ay;r&&(x*=e.tilePixelRatio/a);const{width:b,height:w,anchor:T,textOffset:S,textBoxScale:C}=_,M=Hr(T,b,w,S,C,x),k=o.getPitchedTextCorrection(n.x+u[0],n.y+u[1],h),E=Xr(m.point,p,i,M,-o.bearingInRadians,k),A=e.allowVerticalPlacement&&y.placedOrientation===t.al.vertical?Math.PI/2:0;for(let e=0;e<y.numGlyphs;e++)t.as(f,E,A);c&&y.associatedIconIndex>=0&&(g[y.associatedIconIndex]={shiftedAnchor:E,angle:A})}else qe(y.numGlyphs,f)}if(c){m.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const r=i.get(e);if(r.hidden)qe(r.numGlyphs,m);else{const i=g[e];if(i)for(let e=0;e<r.numGlyphs;e++)t.as(m,i.shiftedAnchor,i.angle);else qe(r.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Yr(e,t,i){return i.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Jr(e,i,r,n,o,s,a,l,c,u,h,d,p){const f=e.context,m=f.gl,g=e.transform,y="map"===l,_="map"===c,v="viewport"!==l&&"point"!==r.layout.get("symbol-placement"),x=y&&!_&&!v,b=!r.layout.get("symbol-sort-key").isConstant();let w=!1;const T=e.getDepthModeForSublayer(0,Ut.ReadOnly),S=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),C=[],M=g.getCircleRadiusCorrection();for(const l of n){const n=i.getTile(l),c=n.getBucket(r);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(r.id),f=o||c.sdfIcons,T=o?c.textSizeData:c.iconSizeData,k=_||0!==g.pitch,E=e.useProgram(Yr(f,o,c),d),A=t.ak(T,g.zoom),I=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let z,P,L,D,R=[0,0],B=null;if(o)P=n.glyphAtlasTexture,L=m.LINEAR,z=n.glyphAtlasTexture.size,c.iconsInText&&(R=n.imageAtlasTexture.size,B=n.imageAtlasTexture,D=k||e.options.rotating||e.options.zooming||"composite"===T.kind||"camera"===T.kind?m.LINEAR:m.NEAREST);else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;P=n.imageAtlasTexture,L=f||e.options.rotating||e.options.zooming||t||k?m.LINEAR:m.NEAREST,z=n.imageAtlasTexture.size}const O=t.az(n,1,e.transform.zoom),F=Me(y,e.transform,O),j=t.K();t.an(j,F);const $=ke(_,y,e.transform,O),N=t.aA(g,n,s,a),U=g.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!p,applyTerrainMatrix:!0}),V=S&&c.hasTextData(),G="none"!==r.layout.get("icon-text-fit")&&V&&c.hasIconData();if(v){const t=e.style.map.terrain?(t,i)=>e.style.map.terrain.getElevation(l,t,i):null,i="map"===r.layout.get("text-rotation-alignment");Pe(c,e,o,F,j,_,u,i,l.toUnwrapped(),g.width,g.height,N,t)}const q=o&&S||G,Z=v||q?Wr:_?F:e.transform.clipSpaceToPixelsMatrix,W=f&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let H;H=f?c.iconsInText?Ji(T.kind,A,x,_,v,q,e,Z,$,N,z,R,M):Yi(T.kind,A,x,_,v,q,e,Z,$,N,o,z,0,M):Ki(T.kind,A,x,_,v,q,e,Z,$,N,o,z,M);const X={program:E,buffers:h,uniformValues:H,projectionData:U,atlasTexture:P,atlasTextureIcon:B,atlasInterpolation:L,atlasInterpolationIcon:D,isSDF:f,hasHalo:W};if(b&&c.canOverlap){w=!0;const e=h.segments.get();for(const i of e)C.push({segments:new t.aJ([i]),sortKey:i.sortKey,state:X,terrainData:I})}else C.push({segments:h.segments,sortKey:0,state:X,terrainData:I})}w&&C.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of C){const i=t.state;if(f.activeTexture.set(m.TEXTURE0),i.atlasTexture.bind(i.atlasInterpolation,m.CLAMP_TO_EDGE),i.atlasTextureIcon&&(f.activeTexture.set(m.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,m.CLAMP_TO_EDGE)),i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,Qr(i.buffers,t.segments,r,e,i.program,T,h,d,n,i.projectionData,t.terrainData)),n.u_is_halo=0}Qr(i.buffers,t.segments,r,e,i.program,T,h,d,i.uniformValues,i.projectionData,t.terrainData)}}function Qr(e,t,i,r,n,o,s,a,l,c,u){const h=r.context;n.draw(h,h.gl.TRIANGLES,o,s,a,Nt.backCCW,l,u,c,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function en(e,i,r,n,o){const s=e.context,a=s.gl,l=Gt.disabled,c=new jt([a.ONE,a.ONE],t.b7.transparent,[!0,!0,!0,!0]),u=i.getBucket(r);if(!u)return;const h=n.key;let d=r.heatmapFbos.get(h);d||(d=rn(s,i.tileSize,i.tileSize),r.heatmapFbos.set(h,d)),s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,i.tileSize,i.tileSize]),s.clear({color:t.b7.transparent});const p=u.programConfigurations.get(r.id),f=e.useProgram("heatmap",p,!o),m=e.transform.getProjectionData({overscaledTileID:i.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),g=e.style.map.terrain.getTerrainData(n);f.draw(s,a.TRIANGLES,Ut.disabled,l,c,Nt.disabled,Oi(i,e.transform.zoom,r.paint.get("heatmap-intensity"),1),g,m,r.id,u.layoutVertexBuffer,u.indexBuffer,u.segments,r.paint,e.transform.zoom,p)}function tn(e,t,i,r,n){const o=e.context,s=o.gl,a=e.transform;o.setColorMode(e.colorModeForRenderPass());const l=nn(o,t),c=i.key,u=t.heatmapFbos.get(c);if(!u)return;o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get()),o.activeTexture.set(s.TEXTURE1),l.bind(s.LINEAR,s.CLAMP_TO_EDGE);const h=a.getProjectionData({overscaledTileID:i,applyTerrainMatrix:n,applyGlobeMatrix:!r});e.useProgram("heatmapTexture").draw(o,s.TRIANGLES,Ut.disabled,Gt.disabled,e.colorModeForRenderPass(),Nt.disabled,Fi(e,t,0,1),null,h,t.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments,t.paint,a.zoom),u.destroy(),t.heatmapFbos.delete(c)}function rn(e,t,i){var r,n;const o=e.gl,s=o.createTexture();o.bindTexture(o.TEXTURE_2D,s),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR);const a=null!==(r=e.HALF_FLOAT)&&void 0!==r?r:o.UNSIGNED_BYTE,l=null!==(n=e.RGBA16F)&&void 0!==n?n:o.RGBA;o.texImage2D(o.TEXTURE_2D,0,l,t,i,0,o.RGBA,a,null);const c=e.createFramebuffer(t,i,!1,!1);return c.colorAttachment.set(s),c}function nn(e,t){return t.colorRampTexture||(t.colorRampTexture=new _(e,t.colorRamp,e.gl.RGBA)),t.colorRampTexture}function on(e,t,i,r,n){if(!i||!r||!r.imageAtlas)return;const o=r.imageAtlas.patternPositions;let s=o[i.to.toString()],a=o[i.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const e=n.getPaintProperty(t);s=o[e],a=o[e]}s&&a&&e.setConstantPatternPositions(s,a)}function sn(e,i,r,n,o,s,a,l){const c=e.context.gl,u="fill-pattern",h=r.paint.get(u),d=h&&h.constantOr(1),p=r.getCrossfadeParameters();let f,m,g,y,_;const v=e.transform,x=r.paint.get("fill-translate"),b=r.paint.get("fill-translate-anchor");a?(m=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",f=c.LINES):(m=d?"fillPattern":"fill",f=c.TRIANGLES);const w=h.constantOr(null);for(const h of n){const n=i.getTile(h);if(d&&!n.patternsLoaded())continue;const T=n.getBucket(r);if(!T)continue;const S=T.programConfigurations.get(r.id),C=e.useProgram(m,S),M=e.style.map.terrain&&e.style.map.terrain.getTerrainData(h);d&&(e.context.activeTexture.set(c.TEXTURE0),n.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),S.updatePaintBuffers(p)),on(S,u,w,n,r);const k=v.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!l,applyTerrainMatrix:!0}),E=t.aA(v,n,x,b);if(a){y=T.indexBuffer2,_=T.segments2;const t=[c.drawingBufferWidth,c.drawingBufferHeight];g="fillOutlinePattern"===m&&d?Pi(e,p,n,t,E):zi(t,E)}else y=T.indexBuffer,_=T.segments,g=d?Ii(e,p,n,E):{u_fill_translate:E};const A=e.stencilModeForClipping(h);C.draw(e.context,f,o,A,s,Nt.backCCW,g,M,k,r.id,T.layoutVertexBuffer,y,_,r.paint,e.transform.zoom,S)}}function an(e,i,r,n,o,s,a,l){const c=e.context,u=c.gl,h="fill-extrusion-pattern",d=r.paint.get(h),p=d.constantOr(1),f=r.getCrossfadeParameters(),m=r.paint.get("fill-extrusion-opacity"),g=d.constantOr(null),y=e.transform;for(const d of n){const n=i.getTile(d),_=n.getBucket(r);if(!_)continue;const v=e.style.map.terrain&&e.style.map.terrain.getTerrainData(d),x=_.programConfigurations.get(r.id),b=e.useProgram(p?"fillExtrusionPattern":"fillExtrusion",x);p&&(e.context.activeTexture.set(u.TEXTURE0),n.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers(f));const w=y.getProjectionData({overscaledTileID:d,applyGlobeMatrix:!l,applyTerrainMatrix:!0});on(x,h,g,n,r);const T=t.aA(y,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),S=r.paint.get("fill-extrusion-vertical-gradient"),C=p?Ai(e,S,m,T,d,f,n):Ei(e,S,m,T);b.draw(c,c.gl.TRIANGLES,o,s,a,Nt.backCCW,C,v,w,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,e.transform.zoom,x,e.style.map.terrain&&_.centroidVertexBuffer)}}function ln(e,t,i,r,n,o,s,a,l){var c;const u=e.style.projection,h=e.context,d=e.transform,p=h.gl,f=[`#define NUM_ILLUMINATION_SOURCES ${i.paint.get("hillshade-highlight-color").values.length}`],m=e.useProgram("hillshade",null,!1,f),g=!e.options.moving;for(const f of r){const r=t.getTile(f),y=r.fbo;if(!y)continue;const _=u.getMeshFromTileID(h,f.canonical,a,!0,"raster"),v=null===(c=e.style.map.terrain)||void 0===c?void 0:c.getTerrainData(f);h.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,y.colorAttachment.get());const x=d.getProjectionData({overscaledTileID:f,aligned:g,applyGlobeMatrix:!l,applyTerrainMatrix:!0});m.draw(h,p.TRIANGLES,o,n[f.overscaledZ],s,Nt.backCCW,ji(e,r,i),v,x,i.id,_.vertexBuffer,_.indexBuffer,_.segments)}}const cn=[new t.P(0,0),new t.P(t.Z,0),new t.P(t.Z,t.Z),new t.P(0,t.Z)];function un(e,t,i,r,n,o,s,a,l=!1,c=!1){const u=r[r.length-1].overscaledZ,h=e.context,d=h.gl,p=e.useProgram("raster"),f=e.transform,m=e.style.projection,g=e.colorModeForRenderPass(),y=!e.options.moving;for(const _ of r){const r=e.getDepthModeForSublayer(_.overscaledZ-u,1===i.paint.get("raster-opacity")?Ut.ReadWrite:Ut.ReadOnly,d.LESS),v=t.getTile(_);v.registerFadeDuration(i.paint.get("raster-fade-duration"));const x=t.findLoadedParent(_,0),b=t.findLoadedSibling(_),w=hn(v,x||b||null,t,i,e.transform,e.style.map.terrain);let T,S;const C="nearest"===i.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;h.activeTexture.set(d.TEXTURE0),v.texture.bind(C,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),h.activeTexture.set(d.TEXTURE1),x?(x.texture.bind(C,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),T=Math.pow(2,x.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*T%1,v.tileID.canonical.y*T%1]):v.texture.bind(C,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),v.texture.useMipmap&&h.extTextureFilterAnisotropic&&e.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const M=e.style.map.terrain&&e.style.map.terrain.getTerrainData(_),k=f.getProjectionData({overscaledTileID:_,aligned:y,applyGlobeMatrix:!c,applyTerrainMatrix:!0}),E=Hi(S||[0,0],T||1,w,i,a),A=m.getMeshFromTileID(h,_.canonical,o,s,"raster");p.draw(h,d.TRIANGLES,r,n?n[_.overscaledZ]:Gt.disabled,g,l?Nt.frontCCW:Nt.backCCW,E,M,k,i.id,A.vertexBuffer,A.indexBuffer,A.segments)}}function hn(e,i,r,n,o,a){const l=n.paint.get("raster-fade-duration");if(!a&&l>0){const n=s.now(),a=(n-e.timeAdded)/l,c=i?(n-i.timeAdded)/l:-1,u=r.getSource(),h=_e(o,{tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=d&&e.refreshedUponExpiration?1:t.ae(d?a:1-c,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const dn=new t.b7(1,0,0,1),pn=new t.b7(0,1,0,1),fn=new t.b7(0,0,1,1),mn=new t.b7(1,0,1,1),gn=new t.b7(0,1,1,1);function yn(e,t,i,r){vn(e,0,t+i/2,e.transform.width,i,r)}function _n(e,t,i,r){vn(e,t-i/2,0,i,e.transform.height,r)}function vn(e,t,i,r,n,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*e.pixelRatio,i*e.pixelRatio,r*e.pixelRatio,n*e.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function xn(e,i,r){const n=e.context,o=n.gl,s=e.useProgram("debug"),a=Ut.disabled,l=Gt.disabled,c=e.colorModeForRenderPass(),u="$debug",h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(r);n.activeTexture.set(o.TEXTURE0);const d=i.getTileByID(r.key).latestRawTileData,p=Math.floor((d&&d.byteLength||0)/1024),f=i.getTile(r).tileSize,m=512/Math.min(f,512)*(r.overscaledZ/e.transform.zoom)*.5;let g=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(g+=` => ${r.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${g} ${p}kB`);const y=e.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});s.draw(n,o.TRIANGLES,a,l,jt.alphaBlended,Nt.disabled,Bi(t.b7.transparent,m),null,y,u,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),s.draw(n,o.LINE_STRIP,a,l,c,Nt.disabled,Bi(t.b7.red),h,y,u,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function bn(e,t,i,r){const{isRenderingGlobe:n}=r,o=e.context,s=o.gl,a=e.transform,l=e.colorModeForRenderPass(),c=e.getDepthModeFor3D(),u=e.useProgram("terrain");o.bindFramebuffer.set(null),o.viewport.set([0,0,e.width,e.height]);for(const r of i){const i=t.getTerrainMesh(r.tileID),h=e.renderToTexture.getTexture(r),d=t.getTerrainData(r.tileID);o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,h.texture);const p=t.getMeshFrameDelta(a.zoom),f=a.calculateFogMatrix(r.tileID.toUnwrapped()),m=Ti(p,f,e.style.sky,a.pitch,n),g=a.getProjectionData({overscaledTileID:r.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(o,s.TRIANGLES,c,Gt.disabled,l,Nt.backCCW,m,d,g,"terrain",i.vertexBuffer,i.indexBuffer,i.segments)}}function wn(e,i){if(!i.mesh){const r=new t.aI;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const n=new t.aK;n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),i.mesh=new wt(e.createVertexBuffer(r,Tt.members),e.createIndexBuffer(n),t.aJ.simpleSegment(0,0,r.length,n.length))}return i.mesh}class Tn{constructor(e,i){this.context=new Gr(e),this.transform=i,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=xe.maxUnderzooming+xe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _t}resize(e,t,i){if(this.width=Math.floor(e*i),this.height=Math.floor(t*i),this.pixelRatio=i,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const e=this.context,i=new t.aI;i.emplaceBack(0,0),i.emplaceBack(t.Z,0),i.emplaceBack(0,t.Z),i.emplaceBack(t.Z,t.Z),this.tileExtentBuffer=e.createVertexBuffer(i,Tt.members),this.tileExtentSegments=t.aJ.simpleSegment(0,0,4,2);const r=new t.aI;r.emplaceBack(0,0),r.emplaceBack(t.Z,0),r.emplaceBack(0,t.Z),r.emplaceBack(t.Z,t.Z),this.debugBuffer=e.createVertexBuffer(r,Tt.members),this.debugSegments=t.aJ.simpleSegment(0,0,4,5);const n=new t.b_;n.emplaceBack(0,0,0,0),n.emplaceBack(t.Z,0,t.Z,0),n.emplaceBack(0,t.Z,0,t.Z),n.emplaceBack(t.Z,t.Z,t.Z,t.Z),this.rasterBoundsBuffer=e.createVertexBuffer(n,bi.members),this.rasterBoundsSegments=t.aJ.simpleSegment(0,0,4,2);const o=new t.aI;o.emplaceBack(0,0),o.emplaceBack(t.Z,0),o.emplaceBack(0,t.Z),o.emplaceBack(t.Z,t.Z),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(o,Tt.members),this.rasterBoundsSegmentsPosOnly=t.aJ.simpleSegment(0,0,4,5);const s=new t.aI;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,Tt.members),this.viewportSegments=t.aJ.simpleSegment(0,0,4,2);const a=new t.b$;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);const l=new t.aK;l.emplaceBack(1,0,2),l.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);const c=this.context.gl;this.stencilClearMode=new Gt({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.tileExtentMesh=new wt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,i=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const r=t.K();t.bQ(r,0,this.width,this.height,0,0,1),t.M(r,r,[i.drawingBufferWidth,i.drawingBufferHeight,0]);const n={mainMatrix:r,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:r};this.useProgram("clippingMask",null,!0).draw(e,i.TRIANGLES,Ut.disabled,this.stencilClearMode,jt.disabled,Nt.disabled,null,null,n,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t,i){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source,this.nextStencilID+t.length>256&&this.clearStencil();const r=this.context;r.setColorMode(jt.disabled),r.setDepthMode(Ut.disabled);const n={};for(const e of t)n[e.key]=this.nextStencilID++;this._renderTileMasks(n,t,i,!0),this._renderTileMasks(n,t,i,!1),this._tileClippingMaskIDs=n}_renderTileMasks(e,t,i,r){const n=this.context,o=n.gl,s=this.style.projection,a=this.transform,l=this.useProgram("clippingMask");for(const c of t){const t=e[c.key],u=this.style.map.terrain&&this.style.map.terrain.getTerrainData(c),h=s.getMeshFromTileID(this.context,c.canonical,r,!0,"stencil"),d=a.getProjectionData({overscaledTileID:c,applyGlobeMatrix:!i,applyTerrainMatrix:!0});l.draw(n,o.TRIANGLES,Ut.disabled,new Gt({func:o.ALWAYS,mask:0},t,255,o.KEEP,o.KEEP,o.REPLACE),jt.disabled,i?Nt.disabled:Nt.backCCW,null,u,d,"$clipping",h.vertexBuffer,h.indexBuffer,h.segments)}}_renderTilesDepthBuffer(){const e=this.context,t=e.gl,i=this.style.projection,r=this.transform,n=this.useProgram("depth"),o=this.getDepthModeFor3D(),s=ve(r,{tileSize:r.tileSize});for(const a of s){const s=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a),l=i.getMeshFromTileID(this.context,a.canonical,!0,!0,"raster"),c=r.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});n.draw(e,t.TRIANGLES,o,Gt.disabled,jt.disabled,Nt.backCCW,null,s,c,"$clipping",l.vertexBuffer,l.indexBuffer,l.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Gt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new Gt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let i=0;i<n;i++)e[i+r]=new Gt({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,i]}return[{[r]:Gt.disabled},i]}stencilConfigForOverlapTwoPass(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(this.clearStencil(),n>1){const e={},o={};for(let i=0;i<n;i++)e[i+r]=new Gt({func:t.GREATER,mask:255},n+1+i,255,t.KEEP,t.KEEP,t.REPLACE),o[i+r]=new Gt({func:t.GREATER,mask:255},1+i,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID=2*n+1,[e,o,i]}return this.nextStencilID=3,[{[r]:new Gt({func:t.GREATER,mask:255},2,255,t.KEEP,t.KEEP,t.REPLACE)},{[r]:new Gt({func:t.GREATER,mask:255},1,255,t.KEEP,t.KEEP,t.REPLACE)},i]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new jt([e.CONSTANT_COLOR,e.ONE],new t.b7(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?jt.unblended:jt.alphaBlended}getDepthModeForSublayer(e,t,i){if(!this.opaquePassEnabledForLayer())return Ut.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ut(i||this.context.gl.LEQUAL,t,[r,r])}getDepthModeFor3D(){return new Ut(this.context.gl.LEQUAL,Ut.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,i){var r,n;this.style=e,this.options=i,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(s.now()),this.imageManager.beginFrame();const o=this.style._order,a=this.style.sourceCaches,l={},c={},u={},h={isRenderingToTexture:!1,isRenderingGlobe:(null===(r=e.projection)||void 0===r?void 0:r.transitionState)>0};for(const e in a){const t=a[e];t.used&&t.prepare(this.context),l[e]=t.getVisibleCoordinates(!1),c[e]=l[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<o.length;e++)if(this.style._layers[o[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of o){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const i=c[t.source];("custom"===t.type||i.length)&&this.renderLayer(this,a[t.source],t,i,h)}if(null===(n=this.style.projection)||void 0===n||n.updateGPUdependent({context:this.context,useProgram:e=>this.useProgram(e)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?t.b7.black:t.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(e,t){const i=e.context,r=i.gl,n=((e,t,i)=>{const r=Math.cos(t.rollInRadians),n=Math.sin(t.rollInRadians),o=he(t),s=t.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:e.properties.get("sky-color"),u_horizon_color:e.properties.get("horizon-color"),u_horizon:[(t.width/2-o*n)*i,(t.height/2+o*r)*i],u_horizon_normal:[-n,r],u_sky_horizon_blend:e.properties.get("sky-horizon-blend")*t.height/2*i,u_sky_blend:s}})(t,e.style.map.transform,e.pixelRatio),o=new Ut(r.LEQUAL,Ut.ReadWrite,[0,1]),s=Gt.disabled,a=e.colorModeForRenderPass(),l=e.useProgram("sky"),c=wn(i,t);l.draw(i,r.TRIANGLES,o,s,a,Nt.disabled,n,null,void 0,"sky",c.vertexBuffer,c.indexBuffer,c.segments)}(this,this.style.sky),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=o.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[o[this.currentLayer]],t=a[e.source],i=l[e.source];this._renderTileClippingMasks(e,i,!1),this.renderLayer(this,t,e,i,h)}this.renderPass="translucent";let d=!1;for(this.currentLayer=0;this.currentLayer<o.length;this.currentLayer++){const e=this.style._layers[o[this.currentLayer]],t=a[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e,h))continue;this.opaquePassEnabledForLayer()||d||(d=!0,h.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const i=("symbol"===e.type?u:c)[e.source];this._renderTileClippingMasks(e,l[e.source],!!this.renderToTexture),this.renderLayer(this,t,e,i,h)}if(h.isRenderingGlobe&&function(e,i,r){const n=e.context,o=n.gl,s=e.useProgram("atmosphere"),a=new Ut(o.LEQUAL,Ut.ReadOnly,[0,1]),l=e.transform,c=function(e,i){const r=e.properties.get("position"),n=[-r.x,-r.y,-r.z],o=t.ad(new Float64Array(16));return"map"===e.properties.get("anchor")&&(t.a_(o,o,i.rollInRadians),t.a$(o,o,-i.pitchInRadians),t.a_(o,o,i.bearingInRadians),t.a$(o,o,i.center.lat*Math.PI/180),t.bp(o,o,-i.center.lng*Math.PI/180)),t.bZ(n,n,o),n}(r,e.transform),u=l.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h=i.properties.get("atmosphere-blend")*u.projectionTransition;if(0===h)return;const d=ri(l.worldSize,l.center.lat),p=l.inverseProjectionMatrix,f=new Float64Array(4);f[3]=1,t.at(f,f,l.modelViewProjectionMatrix),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1,t.at(f,f,p),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[3]=1;const m=((e,t,i,r,n)=>({u_sun_pos:e,u_atmosphere_blend:t,u_globe_position:i,u_globe_radius:r,u_inv_proj_matrix:n}))(c,h,[f[0],f[1],f[2]],d,p),g=wn(n,i);s.draw(n,o.TRIANGLES,a,Gt.disabled,jt.alphaBlended,Nt.disabled,m,null,null,"atmosphere",g.vertexBuffer,g.indexBuffer,g.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const e=function(e,t){let i=null;const r=Object.values(e._layers).flatMap((i=>i.source&&!i.isHidden(t)?[e.sourceCaches[i.source]]:[])),n=r.filter((e=>"vector"===e.getSource().type)),o=r.filter((e=>"vector"!==e.getSource().type)),s=e=>{(!i||i.getSource().maxzoom<e.getSource().maxzoom)&&(i=e)};return n.forEach((e=>s(e))),i||o.forEach((e=>s(e))),i}(this.style,this.transform.zoom);e&&function(e,t,i){for(let r=0;r<i.length;r++)xn(e,t,i[r])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;yn(e,e.transform.height-(t.top||0),3,dn),yn(e,t.bottom||0,3,pn),_n(e,t.left||0,3,fn),_n(e,e.transform.width-(t.right||0),3,mn);const i=e.transform.centerPoint;!function(e,t,i,r){vn(e,t-1,i-10,2,20,r),vn(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,gn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const i=this.terrainFacilitator.matrix,r=this.transform.modelViewProjectionMatrix;let n=this.terrainFacilitator.dirty;n||(n=e?!t.c0(i,r):!t.c1(i,r)),n||(n=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),n&&(t.c2(i,r),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,i){const r=e.context,n=r.gl,o=e.transform,s=jt.unblended,a=new Ut(n.LEQUAL,Ut.ReadWrite,[0,1]),l=i.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");r.bindFramebuffer.set(i.getFramebuffer("depth").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.b7.transparent,depth:1});for(const e of l){const t=i.getTerrainMesh(e.tileID),l=i.getTerrainData(e.tileID),u=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),h={u_ele_delta:i.getMeshFrameDelta(o.zoom)};c.draw(r,n.TRIANGLES,a,Gt.disabled,s,Nt.backCCW,h,l,u,"terrain",t.vertexBuffer,t.indexBuffer,t.segments)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,i){const r=e.context,n=r.gl,o=e.transform,s=jt.unblended,a=new Ut(n.LEQUAL,Ut.ReadWrite,[0,1]),l=i.getCoordsTexture(),c=i.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");r.bindFramebuffer.set(i.getFramebuffer("coords").framebuffer),r.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),r.clear({color:t.b7.transparent,depth:1}),i.coordsIndex=[];for(const e of c){const t=i.getTerrainMesh(e.tileID),c=i.getTerrainData(e.tileID);r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l.texture);const h={u_terrain_coords_id:(255-i.coordsIndex.length)/255,u_texture:0,u_ele_delta:i.getMeshFrameDelta(o.zoom)},d=o.getProjectionData({overscaledTileID:e.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});u.draw(r,n.TRIANGLES,a,Gt.disabled,s,Nt.backCCW,h,c,d,"terrain",t.vertexBuffer,t.indexBuffer,t.segments),i.coordsIndex.push(e.tileID.key)}r.bindFramebuffer.set(null),r.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,i,r,n,o){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||(n||[]).length)&&(this.id=r.id,t.c3(r)?function(e,i,r,n,o,s){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:a}=s,l=Gt.disabled,c=e.colorModeForRenderPass();(r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,i,r,n,o,s,a,l,c){const u=i.transform,h=i.style.map.terrain,d="map"===o,p="map"===s;for(const o of e){const e=n.getTile(o),s=e.getBucket(r);if(!s||!s.text||!s.text.segments.get().length)continue;const f=t.ak(s.textSizeData,u.zoom),m=t.az(e,1,i.transform.zoom),g=Me(d,i.transform,m),y="none"!==r.layout.get("icon-text-fit")&&s.hasIconData();if(f){const i=Math.pow(2,u.zoom-e.tileID.overscaledZ),r=h?(e,t)=>h.getElevation(o,e,t):null;Kr(s,d,p,c,u,g,i,f,y,t.aA(u,e,a,l),o.toUnwrapped(),r)}}}(n,e,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&Jr(e,i,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),l,c,a),0!==r.paint.get("text-opacity").constantOr(1)&&Jr(e,i,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),l,c,a),i.map.showCollisionBoxes&&(Zr(e,i,r,n,!0),Zr(e,i,r,n,!1))}(e,i,r,n,this.style.placement.variableOffsets,o):t.c4(r)?function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=r.paint.get("circle-opacity"),l=r.paint.get("circle-stroke-width"),c=r.paint.get("circle-stroke-opacity"),u=!r.layout.get("circle-sort-key").isConstant();if(0===a.constantOr(1)&&(0===l.constantOr(1)||0===c.constantOr(1)))return;const h=e.context,d=h.gl,p=e.transform,f=e.getDepthModeForSublayer(0,Ut.ReadOnly),m=Gt.disabled,g=e.colorModeForRenderPass(),y=[],_=p.getCircleRadiusCorrection();for(let o=0;o<n.length;o++){const a=n[o],l=i.getTile(a),c=l.getBucket(r);if(!c)continue;const h=r.paint.get("circle-translate"),d=r.paint.get("circle-translate-anchor"),f=t.aA(p,l,h,d),m=c.programConfigurations.get(r.id),g=e.useProgram("circle",m),v=c.layoutVertexBuffer,x=c.indexBuffer,b=e.style.map.terrain&&e.style.map.terrain.getTerrainData(a),w={programConfiguration:m,program:g,layoutVertexBuffer:v,indexBuffer:x,uniformValues:Li(e,l,r,f,_),terrainData:b,projectionData:p.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!s,applyTerrainMatrix:!0})};if(u){const e=c.segments.get();for(const i of e)y.push({segments:new t.aJ([i]),sortKey:i.sortKey,state:w})}else y.push({segments:c.segments,sortKey:0,state:w})}u&&y.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of y){const{programConfiguration:i,program:n,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l,projectionData:c}=t.state;n.draw(h,d.TRIANGLES,f,m,g,Nt.backCCW,a,l,c,r.id,o,s,t.segments,r.paint,e.transform.zoom,i)}}(e,i,r,n,o):t.c5(r)?function(e,i,r,n,o){if(0===r.paint.get("heatmap-opacity"))return;const s=e.context,{isRenderingToTexture:a,isRenderingGlobe:l}=o;if(e.style.map.terrain){for(const t of n){const n=i.getTile(t);i.hasRenderableParent(t)||("offscreen"===e.renderPass?en(e,n,r,t,l):"translucent"===e.renderPass&&tn(e,r,t,a,l))}s.viewport.set([0,0,e.width,e.height])}else"offscreen"===e.renderPass?function(e,i,r,n){const o=e.context,s=o.gl,a=e.transform,l=Gt.disabled,c=new jt([s.ONE,s.ONE],t.b7.transparent,[!0,!0,!0,!0]);(function(e,i,r){const n=e.gl;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,i.width/4,i.height/4]);let o=r.heatmapFbos.get(t.bW);o?(n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer)):(o=rn(e,i.width/4,i.height/4),r.heatmapFbos.set(t.bW,o))})(o,e,r),o.clear({color:t.b7.transparent});for(let t=0;t<n.length;t++){const u=n[t];if(i.hasRenderableParent(u))continue;const h=i.getTile(u),d=h.getBucket(r);if(!d)continue;const p=d.programConfigurations.get(r.id),f=e.useProgram("heatmap",p),m=a.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),g=a.getCircleRadiusCorrection();f.draw(o,s.TRIANGLES,Ut.disabled,l,c,Nt.backCCW,Oi(h,a.zoom,r.paint.get("heatmap-intensity"),g),null,m,r.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,r.paint,a.zoom,p)}o.viewport.set([0,0,e.width,e.height])}(e,i,r,n):"translucent"===e.renderPass&&function(e,i){const r=e.context,n=r.gl;r.setColorMode(e.colorModeForRenderPass());const o=i.heatmapFbos.get(t.bW);o&&(r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1),nn(r,i).bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,n.TRIANGLES,Ut.disabled,Gt.disabled,e.colorModeForRenderPass(),Nt.disabled,Fi(e,i,0,1),null,null,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom))}(e,r)}(e,i,r,n,o):t.c6(r)?function(e,i,r,n,o){if("translucent"!==e.renderPass)return;const{isRenderingToTexture:s}=o,a=r.paint.get("line-opacity"),l=r.paint.get("line-width");if(0===a.constantOr(1)||0===l.constantOr(1))return;const c=e.getDepthModeForSublayer(0,Ut.ReadOnly),u=e.colorModeForRenderPass(),h=r.paint.get("line-dasharray"),d=r.paint.get("line-pattern"),p=d.constantOr(1),f=r.paint.get("line-gradient"),m=r.getCrossfadeParameters(),g=p?"linePattern":h?"lineSDF":f?"lineGradient":"line",y=e.context,v=y.gl,x=e.transform;let b=!0;for(const o of n){const n=i.getTile(o);if(p&&!n.patternsLoaded())continue;const a=n.getBucket(r);if(!a)continue;const l=a.programConfigurations.get(r.id),w=e.context.program.get(),T=e.useProgram(g,l),S=b||T.program!==w,C=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),M=d.constantOr(null);if(M&&n.imageAtlas){const e=n.imageAtlas,t=e.patternPositions[M.to.toString()],i=e.patternPositions[M.from.toString()];t&&i&&l.setConstantPatternPositions(t,i)}const k=x.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!s,applyTerrainMatrix:!0}),E=x.getPixelScale(),A=p?Gi(e,n,r,E,m):h?qi(e,n,r,E,h,m):f?Vi(e,n,r,E,a.lineClipsArray.length):Ui(e,n,r,E);if(p)y.activeTexture.set(v.TEXTURE0),n.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),l.updatePaintBuffers(m);else if(h&&(S||e.lineAtlas.dirty))y.activeTexture.set(v.TEXTURE0),e.lineAtlas.bind(y);else if(f){const n=a.gradients[r.id];let s=n.texture;if(r.gradientVersion!==n.version){let l=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=o.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.ae(t.bX(a.maxLineLength/t.Z*1024*n),256,y.maxTextureSize)}n.gradient=t.bY({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new _(y,n.gradient,v.RGBA),n.version=r.gradientVersion,s=n.texture}y.activeTexture.set(v.TEXTURE0),s.bind(r.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}const I=e.stencilModeForClipping(o);T.draw(y,v.TRIANGLES,c,I,u,Nt.disabled,A,C,k,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,r.paint,e.transform.zoom,l,a.layoutVertexBuffer2),b=!1}}(e,i,r,n,o):t.c7(r)?function(e,i,r,n,o){const s=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0===a.constantOr(1))return;const{isRenderingToTexture:l}=o,c=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===s.constantOr(t.b7.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===h){const t=e.getDepthModeForSublayer(1,"opaque"===e.renderPass?Ut.ReadWrite:Ut.ReadOnly);sn(e,i,r,n,t,c,!1,l)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const t=e.getDepthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);sn(e,i,r,n,t,c,!0,l)}}(e,i,r,n,o):t.c8(r)?function(e,t,i,r,n){const o=i.paint.get("fill-extrusion-opacity");if(0===o)return;const{isRenderingToTexture:s}=n;if("translucent"===e.renderPass){const n=new Ut(e.context.gl.LEQUAL,Ut.ReadWrite,e.depthRangeFor3D);if(1!==o||i.paint.get("fill-extrusion-pattern").constantOr(1))an(e,t,i,r,n,Gt.disabled,jt.disabled,s),an(e,t,i,r,n,e.stencilModeFor3D(),e.colorModeForRenderPass(),s);else{const o=e.colorModeForRenderPass();an(e,t,i,r,n,Gt.disabled,o,s)}}}(e,i,r,n,o):t.c9(r)?function(e,t,i,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const{isRenderingToTexture:o}=n,s=e.context,a=e.style.projection.useSubdivision,l=e.getDepthModeForSublayer(0,Ut.ReadOnly),c=e.colorModeForRenderPass();if("offscreen"===e.renderPass)!function(e,t,i,r,n,o,s){const a=e.context,l=a.gl;for(const c of i){const i=t.getTile(c),u=i.dem;if(!u||!u.data)continue;if(!i.needsHillshadePrepare)continue;const h=u.dim,d=u.stride,p=u.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(d),i.demTexture){const e=i.demTexture;e.update(p,{premultiply:!1}),e.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else i.demTexture=new _(a,p,l.RGBA,{premultiply:!1}),i.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let f=i.fbo;if(!f){const e=new _(a,{width:h,height:h,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),f=i.fbo=a.createFramebuffer(h,h,!0,!1),f.colorAttachment.set(e.texture)}a.bindFramebuffer.set(f.framebuffer),a.viewport.set([0,0,h,h]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,n,o,s,Nt.disabled,$i(i.tileID,u),null,null,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),i.needsHillshadePrepare=!1}}(e,t,r,i,l,Gt.disabled,c),s.viewport.set([0,0,e.width,e.height]);else if("translucent"===e.renderPass)if(a){const[n,s,a]=e.stencilConfigForOverlapTwoPass(r);ln(e,t,i,a,n,l,c,!1,o),ln(e,t,i,a,s,l,c,!0,o)}else{const[n,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);ln(e,t,i,s,n,l,c,!1,o)}}(e,i,r,n,o):t.ca(r)?function(e,t,i,r,n){if("translucent"!==e.renderPass)return;if(0===i.paint.get("raster-opacity"))return;if(!r.length)return;const{isRenderingToTexture:o}=n,s=t.getSource(),a=e.style.projection.useSubdivision;if(s instanceof K)un(e,t,i,r,null,!1,!1,s.tileCoords,s.flippedWindingOrder,o);else if(a){const[n,s,a]=e.stencilConfigForOverlapTwoPass(r);un(e,t,i,a,n,!1,!0,cn,!1,o),un(e,t,i,a,s,!0,!0,cn,!1,o)}else{const[n,s]=e.getStencilConfigForOverlapAndUpdateStencilID(r);un(e,t,i,s,n,!1,!0,cn,!1,o)}}(e,i,r,n,o):t.cb(r)?function(e,t,i,r,n){const o=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0===s)return;const{isRenderingToTexture:a}=n,l=e.context,c=l.gl,u=e.style.projection,h=e.transform,d=h.tileSize,p=i.paint.get("background-pattern");if(e.isPatternMissing(p))return;const f=!p&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==f)return;const m=Gt.disabled,g=e.getDepthModeForSublayer(0,"opaque"===f?Ut.ReadWrite:Ut.ReadOnly),y=e.colorModeForRenderPass(),_=e.useProgram(p?"backgroundPattern":"background"),v=r||ve(h,{tileSize:d,terrain:e.style.map.terrain});p&&(l.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const x=i.getCrossfadeParameters();for(const t of v){const r=h.getProjectionData({overscaledTileID:t,applyGlobeMatrix:!a,applyTerrainMatrix:!0}),n=p?er(s,e,p,{tileID:t,tileSize:d},x):Qi(s,o),f=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t),v=u.getMeshFromTileID(l,t.canonical,!1,!0,"raster");_.draw(l,c.TRIANGLES,g,m,y,Nt.backCCW,n,f,r,i.id,v.vertexBuffer,v.indexBuffer,v.segments)}}(e,0,r,n,o):t.cc(r)&&function(e,t,i,r){const{isRenderingGlobe:n}=r,o=e.context,s=i.implementation,a=e.style.projection,l=e.transform,c=l.getProjectionDataForCustomLayer(n),u={farZ:l.farZ,nearZ:l.nearZ,fov:l.fov*Math.PI/180,modelViewProjectionMatrix:l.modelViewProjectionMatrix,projectionMatrix:l.projectionMatrix,shaderData:{variantName:a.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${a.shaderPreludeCode.vertexSource}`,define:a.shaderDefine},defaultProjectionData:c},h=s.renderingMode?s.renderingMode:"2d";if("offscreen"===e.renderPass){const t=s.prerender;t&&(e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),t.call(s,o.gl,u),o.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),o.setColorMode(e.colorModeForRenderPass()),o.setStencilMode(Gt.disabled);const t="3d"===h?e.getDepthModeFor3D():e.getDepthModeForSublayer(0,Ut.ReadOnly);o.setDepthMode(t),s.render(o.gl,u),o.setDirty(),e.setBaseState(),o.bindFramebuffer.set(null)}}(e,0,r,o))}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),i=this.imageManager.getPattern(e.to.toString());return!t||!i}useProgram(e,t,i=!1,r=[]){this.cache=this.cache||{};const n=!!this.style.map.terrain,o=this.style.projection,s=i?xt.projectionMercator:o.shaderPreludeCode,a=i?St:o.shaderDefine,l=e+(t?t.cacheKey:"")+`/${i?Ct:o.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(n?"/terrain":"")+(r?`/${r.join("/")}`:"");return this.cache[l]||(this.cache[l]=new Mi(this.context,xt[e],t,ir[e],this._showOverdrawInspector,n,s,a,r)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}function Sn(e,t){let i,r=!1,n=null,o=null;const s=()=>{n=null,r&&(e.apply(o,i),n=setTimeout(s,t),r=!1)};return(...e)=>(r=!0,o=this,i=e,n||s(),n)}class Cn{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(!this._isValidHash(e))return!1;const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,e)},this._removeHash=()=>{const e=this._getCurrentHash();if(0===e.length)return;const t=e.join("/");let i=t;i.split("&").length>0&&(i=i.split("&")[0]),this._hashName&&(i=`${this._hashName}=${t}`);let r=window.location.hash.replace(i,"");r.startsWith("#&")?r=r.slice(0,1)+r.slice(2):"#"===r&&(r="");let n=window.location.href.replace(/(#.+)?$/,r);n=n.replace("&&","&"),window.history.replaceState(window.history.state,null,n)},this._updateHash=Sn(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,r),o=Math.round(t.lng*n)/n,s=Math.round(t.lat*n)/n,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?`/${o}/${s}/${i}`:`${i}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const e=this._hashName;let t=!1;const i=window.location.hash.slice(1).split("&").map((i=>{const r=i.split("=")[0];return r===e?(t=!0,`${r}=${c}`):i})).filter((e=>e));return t||i.push(`${e}=${c}`),`#${i.join("&")}`}return`#${c}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new t.Q(+e[2],+e[1])}catch(e){return!1}const i=+e[0],r=+(e[3]||0),n=+(e[4]||0);return i>=this._map.getMinZoom()&&i<=this._map.getMaxZoom()&&r>=-180&&r<=180&&n>=this._map.getMinPitch()&&n<=this._map.getMaxPitch()}}const Mn={linearity:.3,easing:t.cd(0,0,.3,1)},kn=t.e({deceleration:2500,maxSpeed:1400},Mn),En=t.e({deceleration:20,maxSpeed:1400},Mn),An=t.e({deceleration:1e3,maxSpeed:360},Mn),In=t.e({deceleration:1e3,maxSpeed:90},Mn),zn=t.e({deceleration:1e3,maxSpeed:360},Mn);class Pn{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=s.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,i.roll+=e.rollDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const o=Dn(i.pan.mag(),r,t.e({},kn,e||{})),s=i.pan.mult(o.amount/i.pan.mag()),a=this._map.cameraHelper.handlePanInertia(s,this._map.transform);n.center=a.easingCenter,n.offset=a.easingOffset,Ln(n,o)}if(i.zoom){const e=Dn(i.zoom,r,En);n.zoom=this._map.transform.zoom+e.amount,Ln(n,e)}if(i.bearing){const e=Dn(i.bearing,r,An);n.bearing=this._map.transform.bearing+t.ae(e.amount,-179,179),Ln(n,e)}if(i.pitch){const e=Dn(i.pitch,r,In);n.pitch=this._map.transform.pitch+e.amount,Ln(n,e)}if(i.roll){const e=Dn(i.roll,r,zn);n.roll=this._map.transform.roll+t.ae(e.amount,-179,179),Ln(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(n,{noMoveStart:!0})}}function Ln(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Dn(e,i,r){const{maxSpeed:n,linearity:o,deceleration:s}=r,a=t.ae(e*o/(i/1e3),-n,n),l=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*l,amount:a*(l/2)}}class Rn extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r,n={}){r=r instanceof MouseEvent?r:new MouseEvent(e,r);const o=a.mousePos(i.getCanvas(),r),s=i.unproject(o);super(e,t.e({point:o,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class Bn extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,r){const n="touchend"===e?r.changedTouches:r.touches,o=a.touchPos(i.getCanvasContainer(),n),s=o.map((e=>i.unproject(e))),l=o.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new t.P(0,0));super(e,{points:o,point:l,lngLats:s,lngLat:i.unproject(l),originalEvent:r}),this._defaultPrevented=!1}}class On extends t.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class Fn{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new On(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Rn(e.type,this._map,e))}mouseup(e){this._map.fire(new Rn(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Rn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Rn(e.type,this._map,e))}mouseover(e){this._map.fire(new Rn(e.type,this._map,e))}mouseout(e){this._map.fire(new Rn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Bn(e.type,this._map,e))}touchmove(e){this._map.fire(new Bn(e.type,this._map,e))}touchend(e){this._map.fire(new Bn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Bn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Rn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Rn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Rn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $n{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this._map.terrain)}}class Nn{constructor(e,t){this._map=e,this._tr=new $n(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(a.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=i,this._box||(this._box=a.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const n=Math.min(r.x,i.x),o=Math.max(r.x,i.x),s=Math.min(r.y,i.y),l=Math.max(r.y,i.y);a.setTransform(this._box,`translate(${n}px,${s}px)`),this._box.style.width=o-n+"px",this._box.style.height=l-s+"px"}mouseupWindow(e,i){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,n=i;if(this.reset(),a.suppressClick(),r.x!==n.x||r.y!==n.y)return this._map.fire(new t.l("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(a.remove(this._box),this._box=null),a.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.l(e,{originalEvent:i}))}}function Un(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class Vn{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=Un(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=Un(i,t);for(const e in this.touches){const t=r[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Gn{constructor(e){this.singleTap=new Vn(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class qn{constructor(e){this._tr=new $n(e),this._zoomIn=new Gn({numTouches:1,numTaps:2}),this._zoomOut=new Gn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i),o=this._tr;return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.rollDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(t)?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const r=Array.isArray(t)?t[0]:t;return!this._moved&&r.dist(i)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=r,this._move(i,r))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&a.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Wn={0:1,2:2};class Hn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=a.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const i=Wn[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton)}isValidEndEvent(e){return a.mouseButton(e)===this._eventButton}}class Xn{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Kn{constructor(e=new Hn({checkCorrectEvent:()=>!0}),t=new Xn){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=t}_executeRelevantHandler(e,t,i){return e instanceof MouseEvent?t(e):"undefined"!=typeof TouchEvent&&e instanceof TouchEvent?i(e):void 0}startMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.startMove(e)),(e=>this.oneFingerTouchMoveStateManager.startMove(e)))}endMove(e){this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.endMove(e)),(e=>this.oneFingerTouchMoveStateManager.endMove(e)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidStartEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidStartEvent(e)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidMoveEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(e)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(e=>this.mouseMoveStateManager.isValidEndEvent(e)),(e=>this.oneFingerTouchMoveStateManager.isValidEndEvent(e)))}}const Yn=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}};class Jn{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(e,t,i){if(this._active){if(!this._shouldBePrevented(i.length))return e.preventDefault(),this._calculateTransform(e,t,i);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&this._shouldBePrevented(i.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,r){r.length>0&&(this._active=!0);const n=Un(r,i),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(o._add(t),s._add(t.sub(i)),a++,n[e]=t)}if(this._touches=n,this._shouldBePrevented(a)||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){if(!this._firstTwoTouches)return;e.preventDefault();const[r,n]=this._firstTwoTouches,o=eo(i,t,r),s=eo(i,t,n);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,o=eo(i,t,r),s=eo(i,t,n);o&&s||(this._active&&a.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function eo(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function to(e,t){return Math.log(e/t)/Math.LN2}class io extends Qn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(to(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:to(this._distance,i),pinchAround:t}}}function ro(e,t){return 180*e.angleWith(t)/Math.PI}class no extends Qn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,i){const r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ro(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=ro(e,this._startVector);return Math.abs(i)<t}}function oo(e){return Math.abs(e.y)>Math.abs(e.x)}class so extends Qn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,i){super.touchstart(e,t,i),this._currentTouchCount=i.length}_start(e){this._lastPoints=e,oo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const r=e[0].sub(this._lastPoints[0]),n=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(r,n,i.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+n.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return void 0===this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return oo(e)&&oo(t)&&o}}const ao={panStep:100,bearingStep:15,pitchStep:10};class lo{constructor(e){this._tr=new $n(e);const t=ao;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:co,zoom:t?Math.round(a.zoom)+t*(e.shiftKey?2:1):a.zoom,bearing:a.bearing+i*this._bearingStep,pitch:a.pitch+r*this._pitchStep,offset:[-n*this._panStep,-o*this._panStep],center:a.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function co(e){return e*(2-e)}const uo=4.000244140625;class ho{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new $n(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const i=s.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==t&&t%uo==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const i=a.mousePos(this._map.getCanvas(),e),r=this._tr;this._aroundPoint=this._aroundCenter?r.transform.locationToScreenPoint(t.Q.convert(r.center)):i,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const t=e.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=t),"number"==typeof this._targetZoom&&(this._targetZoom+=t)}if(0!==this._delta){const i="wheel"===this._type&&Math.abs(this._delta)>uo?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==r&&(r=1/r);const n="number"!=typeof this._targetZoom?e.scale:t.ac(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),t.ah(n*r)).zoom,"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"!=typeof this._targetZoom?e.zoom:this._targetZoom,r=this._startZoom,n=this._easing;let o,a=!1;if("wheel"===this._type&&r&&n){const e=s.now()-this._lastWheelEventTime,l=Math.min((e+5)/200,1),c=n(l);o=t.B.number(r,i,c),l<1?this._frameId||(this._frameId=!0):a=!0}else o=i,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=o,{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.cf;if(this._prevEase){const e=this._prevEase,r=(s.now()-e.start)/e.duration,n=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(n*n+1e-4)*.01,a=Math.sqrt(.0729-o*o);i=t.cd(o,a,.25,1)}return this._prevEase={start:s.now(),duration:e,easing:i},i}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class po{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fo{constructor(e){this._tr=new $n(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mo{constructor(){this._tap=new Gn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,i){if(!this._swipePoint)if(this._tapTime){const r=t[0],n=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;n&&o?i.length>0&&(this._swipePoint=r,this._swipeTouch=i[0].identifier):this.reset()}else this._tap.touchstart(e,t,i)}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){if(this._tapTime)this._swipePoint&&0===i.length&&this.reset();else{const r=this._tap.touchend(e,t,i);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yo{constructor(e,t,i,r){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=t,this._mousePitch=i,this._mouseRoll=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class _o{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class vo{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=a.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const i=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),r=document.createElement("div");r.className="maplibregl-desktop-message",r.textContent=t,this._container.appendChild(r);const n=document.createElement("div");n.className="maplibregl-mobile-message",n.textContent=i,this._container.appendChild(n),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(a.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,i){this._enabled&&(this._map.fire(new t.l("cooperativegestureprevented",{gestureType:e,originalEvent:i})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const xo=e=>e.zoom||e.drag||e.roll||e.pitch||e.rotate;class bo extends t.l{}function wo(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta||e.rollDelta}class To{constructor(e,i){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,i)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const r="renderFrame"===e.type?void 0:e,n={needsRenderFrame:!1},o={},s={};for(const{handlerName:l,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let h;if(this._blockedByActive(s,u,l))c.reset();else if(c[i||e.type]){if(t.cg(e,i||e.type)){const t=a.mousePos(this._map.getCanvas(),e);h=c[i||e.type](e,t)}else if(t.ch(e,i||e.type)){const t=this._getMapTouches(e.touches),r=a.touchPos(this._map.getCanvas(),t);h=c[i||e.type](e,r,t)}else t.ci(i||e.type)||(h=c[i||e.type](e));this.mergeHandlerResult(n,o,h,l,r),h&&h.needsRenderFrame&&this._triggerRenderFrame()}(h||c.isActive())&&(s[l]=c)}const l={};for(const e in this._previousActiveHandlers)s[e]||(l[e]=r);this._previousActiveHandlers=s,(Object.keys(l).length||wo(n))&&(this._changes.push([n,o,l]),this._triggerRenderFrame()),(Object.keys(s).length||wo(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:c}=n;c&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],c(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pn(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(i);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,i]of this._listeners)a.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,i)}destroy(){for(const[e,t,i]of this._listeners)a.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){const i=this._map,r=i.getCanvasContainer();this._add("mapEvent",new Fn(i,e));const n=i.boxZoom=new Nn(i,e);this._add("boxZoom",n),e.interactive&&e.boxZoom&&n.enable();const o=i.cooperativeGestures=new vo(i,e.cooperativeGestures);this._add("cooperativeGestures",o),e.cooperativeGestures&&o.enable();const s=new qn(i),l=new fo(i);i.doubleClickZoom=new po(l,s),this._add("tapZoom",s),this._add("clickZoom",l),e.interactive&&e.doubleClickZoom&&i.doubleClickZoom.enable();const c=new mo;this._add("tapDragZoom",c);const u=i.touchPitch=new so(i);this._add("touchPitch",u),e.interactive&&e.touchPitch&&i.touchPitch.enable(e.touchPitch);const h=()=>i.project(i.getCenter()),d=function({enable:e,clickTolerance:i,aroundCenter:r=!0,minPixelCenterThreshold:n=100,rotateDegreesPerPixelMoved:o=.8},s){const l=new Hn({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)&&!e.ctrlKey});return new Zn({clickTolerance:i,move:(e,i)=>{const a=s();if(r&&Math.abs(a.y-e.y)>n)return{bearingDelta:t.ce(new t.P(e.x,i.y),i,a)};let l=(i.x-e.x)*o;return r&&i.y<a.y&&(l=-l),{bearingDelta:l}},moveStateManager:l,enable:e,assignEvents:Yn})}(e,h),p=function({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:i=-.5}){const r=new Hn({checkCorrectEvent:e=>0===a.mouseButton(e)&&e.ctrlKey||2===a.mouseButton(e)});return new Zn({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*i}),moveStateManager:r,enable:e,assignEvents:Yn})}(e),f=function({enable:e,clickTolerance:t,rollDegreesPerPixelMoved:i=.3},r){const n=new Hn({checkCorrectEvent:e=>2===a.mouseButton(e)&&e.ctrlKey});return new Zn({clickTolerance:t,move:(e,t)=>{const n=r();let o=(t.x-e.x)*i;return t.y<n.y&&(o=-o),{rollDelta:o}},moveStateManager:n,enable:e,assignEvents:Yn})}(e,h);i.dragRotate=new yo(e,d,p,f),this._add("mouseRotate",d,["mousePitch"]),this._add("mousePitch",p,["mouseRotate","mouseRoll"]),this._add("mouseRoll",f,["mousePitch"]),e.interactive&&e.dragRotate&&i.dragRotate.enable();const m=function({enable:e,clickTolerance:t}){const i=new Hn({checkCorrectEvent:e=>0===a.mouseButton(e)&&!e.ctrlKey});return new Zn({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:i,enable:e,assignEvents:Yn})}(e),g=new Jn(e,i);i.dragPan=new go(r,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&i.dragPan.enable(e.dragPan);const y=new no,_=new io;i.touchZoomRotate=new _o(r,_,y,c),this._add("touchRotate",y,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&i.touchZoomRotate.enable(e.touchZoomRotate);const v=i.scrollZoom=new ho(i,(()=>this._triggerRenderFrame()));this._add("scrollZoom",v,["mousePan"]),e.interactive&&e.scrollZoom&&i.scrollZoom.enable(e.scrollZoom);const x=i.keyboard=new lo(i);this._add("keyboard",x),e.interactive&&e.keyboard&&i.keyboard.enable(),this._add("blockableMapEvent",new jn(i))}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(xo(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}mergeHandlerResult(e,i,r,n,o){if(!r)return;t.e(e,r);const s={handlerName:n,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(i.zoom=s),void 0!==r.panDelta&&(i.drag=s),void 0!==r.rollDelta&&(i.roll=s),void 0!==r.pitchDelta&&(i.pitch=s),void 0!==r.bearingDelta&&(i.rotate=s)}_applyChanges(){const e={},i={},r={};for(const[n,o,s]of this._changes)n.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(n.panDelta)),n.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+n.pitchDelta),n.rollDelta&&(e.rollDelta=(e.rollDelta||0)+n.rollDelta),void 0!==n.around&&(e.around=n.around),void 0!==n.pinchAround&&(e.pinchAround=n.pinchAround),n.noInertia&&(e.noInertia=n.noInertia),t.e(i,o),t.e(r,s);this._updateMapTransform(e,i,r),this._changes=[]}_updateMapTransform(e,t,i){const r=this._map,n=r._getTransformForUpdate(),o=r.terrain;if(!(wo(e)||o&&this._terrainMovement))return this._fireEvents(t,i,!0);r._stop(!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,rollDelta:u,around:h,pinchAround:d}=e;void 0!==d&&(h=d),h=h||r.transform.centerPoint,o&&!n.isPointOnMapSurface(h)&&(h=n.centerPoint);const p={panDelta:s,zoomDelta:a,rollDelta:u,pitchDelta:c,bearingDelta:l,around:h};this._map.cameraHelper.useGlobeControls&&!n.isPointOnMapSurface(h)&&(h=n.centerPoint);const f=h.distSqr(n.centerPoint)<.01?n.center:n.screenPointToLocation(s?h.sub(s):h);o?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,n),this._terrainMovement||!t.drag&&!t.zoom?t.drag&&this._terrainMovement?n.setCenter(n.screenPointToLocation(n.centerPoint.sub(s))):this._map.cameraHelper.handleMapControlsPan(p,n,f):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(p,n,f))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(p,n),this._map.cameraHelper.handleMapControlsPan(p,n,f)),r._applyUpdatedTransform(n),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,i,!0)}_fireEvents(e,i,r){const n=xo(this._eventsInProgress),o=xo(e),a={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!n&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=i[t]||r,l[`${e}end`]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=xo(this._eventsInProgress),h=(n||o)&&!u;if(h&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const e=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&e.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(e)}if(r&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&s.prefersReducedMotion?(this._map.fire(new t.l("moveend",{originalEvent:c})),i(this._map.getBearing())&&this._map.resetNorth()):(i(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.l(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new bo("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class So extends t.E{constructor(e,t,i){super(),this._renderFrameCallback=()=>{const e=Math.min((s.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this.cameraHelper=t,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,t){e.apply(this.transform),this.transform=e,this.cameraHelper=t}getCenter(){return new t.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,t){return this.jumpTo({elevation:e},t),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,i,r){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},i),r)}panTo(e,i,r){return this.easeTo(t.e({center:e},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,i,r){return this.easeTo(t.e({zoom:e},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,i){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new t.l("movestart",i)).fire(new t.l("move",i)).fire(new t.l("moveend",i))),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,i,r){return this.easeTo(t.e({bearing:e},i),r)}resetNorth(e,i){return this.rotateTo(0,t.e({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},e),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}getRoll(){return this.transform.roll}setRoll(e,t){return this.jumpTo({roll:e},t),this}cameraForBounds(e,t){e=G.convert(e).adjustAntiMeridian();const i=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),i,t)}_cameraForBoxAndBearing(e,i,r,n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const e=n.padding;n.padding={top:e,bottom:e,right:e,left:e}}const s=t.e(o,n.padding);n.padding=s;const a=this.transform,l=new G(e,i);return this.cameraHelper.cameraForBoxAndBearing(n,s,l,r,a)}fitBounds(e,t,i){return this._fitInternal(this.cameraForBounds(e,t),t,i)}fitScreenCoordinates(e,i,r,n,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(e)),this.transform.screenPointToLocation(t.P.convert(i)),r,n),n,o)}_fitInternal(e,i,r){return e?(delete(i=t.e(e,i)).padding,i.linear?this.easeTo(i,r):this.flyTo(i,r)):this}jumpTo(e,i){this.stop();const r=this._getTransformForUpdate();let n=!1,o=!1,s=!1;const a=r.zoom;this.cameraHelper.handleJumpToCenterZoom(r,e);const l=r.zoom!==a;return"elevation"in e&&r.elevation!==+e.elevation&&r.setElevation(+e.elevation),"bearing"in e&&r.bearing!==+e.bearing&&(n=!0,r.setBearing(+e.bearing)),"pitch"in e&&r.pitch!==+e.pitch&&(o=!0,r.setPitch(+e.pitch)),"roll"in e&&r.roll!==+e.roll&&(s=!0,r.setRoll(+e.roll)),null==e.padding||r.isPaddingEqual(e.padding)||r.setPadding(e.padding),this._applyUpdatedTransform(r),this.fire(new t.l("movestart",i)).fire(new t.l("move",i)),l&&this.fire(new t.l("zoomstart",i)).fire(new t.l("zoom",i)).fire(new t.l("zoomend",i)),n&&this.fire(new t.l("rotatestart",i)).fire(new t.l("rotate",i)).fire(new t.l("rotateend",i)),o&&this.fire(new t.l("pitchstart",i)).fire(new t.l("pitch",i)).fire(new t.l("pitchend",i)),s&&this.fire(new t.l("rollstart",i)).fire(new t.l("roll",i)).fire(new t.l("rollend",i)),this.fire(new t.l("moveend",i))}calculateCameraOptionsFromTo(e,i,r,n=0){const o=t.$.fromLngLat(e,i),s=t.$.fromLngLat(r,n),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=t.ah(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),elevation:n,zoom:d,pitch:f,bearing:p}}calculateCameraOptionsFromCameraLngLatAltRotation(e,t,i,r,n){const o=this.transform.calculateCenterFromCameraLngLatAlt(e,t,i,r);return{center:o.center,elevation:o.elevation,zoom:o.zoom,bearing:i,pitch:r,roll:n}}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.cf},e)).animate||!e.essential&&s.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),n=this.getBearing(),o=r.pitch,a=r.roll,l="bearing"in e?this._normalizeBearing(e.bearing,n):n,c="pitch"in e?+e.pitch:o,u="roll"in e?this._normalizeBearing(e.roll,a):a,h="padding"in e?e.padding:r.padding,d=t.P.convert(e.offset);let p,f;e.around&&(p=t.Q.convert(e.around),f=r.locationToScreenPoint(p));const m={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},g=this.cameraHelper.handleEaseTo(r,{bearing:l,pitch:c,roll:u,padding:h,around:p,aroundPoint:f,offsetAsPoint:d,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||n!==l,this._pitching=this._pitching||c!==o,this._rolling=this._rolling||u!==a,this._padding=!r.isPaddingEqual(h),this._zooming=this._zooming||g.isZooming,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,m),this.terrain&&this._prepareElevation(g.elevationCenter),this._ease((t=>{g.easeFunc(t),this.terrain&&!e.freezeElevation&&this._updateElevation(t),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,r={}){this._moving=!0,i||r.moving||this.fire(new t.l("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.l("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.l("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.l("pitchstart",e)),this._rolling&&!r.rolling&&this.fire(new t.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const i=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&i!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(i-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=i}this.transform.setElevation(t.B.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const t=e.getCameraLngLat(),i=e.getCameraAltitude(),r=this.terrain?this.terrain.getElevationForLngLatZoom(t,e.zoom):0;if(i<r){const i=this.calculateCameraOptionsFromTo(t,r,e.center,e.elevation);return{pitch:i.pitch,zoom:i.zoom}}return{}}_applyUpdatedTransform(e){const t=[];if(t.push((e=>this._elevateCameraIfInsideTerrain(e))),this.transformCameraUpdate&&t.push((e=>this.transformCameraUpdate(e))),!t.length)return;const i=e.clone();for(const e of t){const t=i.clone(),{center:r,zoom:n,roll:o,pitch:s,bearing:a,elevation:l}=e(t);r&&t.setCenter(r),void 0!==l&&t.setElevation(l),void 0!==n&&t.setZoom(n),void 0!==o&&t.setRoll(o),void 0!==s&&t.setPitch(s),void 0!==a&&t.setBearing(a),i.apply(t)}this.transform.apply(i)}_fireMoveEvents(e){this.fire(new t.l("move",e)),this._zooming&&this.fire(new t.l("zoom",e)),this._rotating&&this.fire(new t.l("rotate",e)),this._pitching&&this.fire(new t.l("pitch",e)),this._rolling&&this.fire(new t.l("roll",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;delete this._easeId;const r=this._zooming,n=this._rotating,o=this._pitching,s=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,r&&this.fire(new t.l("zoomend",e)),n&&this.fire(new t.l("rotateend",e)),o&&this.fire(new t.l("pitchend",e)),s&&this.fire(new t.l("rollend",e)),this.fire(new t.l("moveend",e))}flyTo(e,i){if(!e.essential&&s.prefersReducedMotion){const r=t.O(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(r,i)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.cf},e);const r=this._getTransformForUpdate(),n=r.bearing,o=r.pitch,a=r.roll,l=r.padding,c="bearing"in e?this._normalizeBearing(e.bearing,n):n,u="pitch"in e?+e.pitch:o,h="roll"in e?this._normalizeBearing(e.roll,a):a,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const m=r.screenPointToLocation(f),g=this.cameraHelper.handleFlyTo(r,{bearing:c,pitch:u,roll:h,padding:d,locationAtOffset:m,offsetAsPoint:p,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let y=e.curve;const _=Math.max(r.width,r.height),v=_/g.scaleOfZoom,x=g.pixelPathLength;"number"==typeof g.scaleOfMinZoom&&(y=Math.sqrt(_/g.scaleOfMinZoom/x*2));const b=y*y;function w(e){const t=(v*v-_*_+(e?-1:1)*b*b*x*x)/(2*(e?v:_)*b*x);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const C=w(!1);let M=function(e){return S(C)/S(C+y*e)},k=function(e){return _*((S(C)*(T(t=C+y*e)/S(t))-T(C))/b)/x;var t},E=(w(!0)-C)/y;if(Math.abs(x)<2e-6||!isFinite(E)){if(Math.abs(_-v)<1e-6)return this.easeTo(e,i);const t=v<_?-1:1;E=Math.abs(Math.log(v/_))/y,k=()=>0,M=e=>Math.exp(t*y*e)}return e.duration="duration"in e?+e.duration:1e3*E/("screenSpeed"in e?+e.screenSpeed/y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=n!==c,this._pitching=u!==o,this._rolling=h!==a,this._padding=!r.isPaddingEqual(d),this._prepareEase(i,!1),this.terrain&&this._prepareElevation(g.targetCenter),this._ease((s=>{const m=s*E,y=1/M(m),_=k(m);this._rotating&&r.setBearing(t.B.number(n,c,s)),this._pitching&&r.setPitch(t.B.number(o,u,s)),this._rolling&&r.setRoll(t.B.number(a,h,s)),this._padding&&(r.interpolatePadding(l,d,s),f=r.centerPoint.add(p)),g.easeFunc(s,y,_,f),this.terrain&&!e.freezeElevation&&this._updateElevation(s),this._applyUpdatedTransform(r),this._fireMoveEvents(i)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(i)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var i;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(i=this.handlers)||void 0===i||i.stop(!1),this}_ease(e,t,i){!1===i.animate||0===i.duration?(e(1),t()):(this._easeStart=s.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,i){e=t.aL(e,-180,180);const r=Math.abs(e-i);return Math.abs(e-360-i)<r&&(e-=360),Math.abs(e+360-i)<r&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.Q.convert(e),this.transform.tileZoom):null}}const Co={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Mo{constructor(e=Co){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=a.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=a.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString(`AttributionControl.${t}`);e.title=i,e.setAttribute("aria-label",i)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.sourceCaches;for(const i in t){const r=t[i];if(r.used||r.usedForTerrain){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=a.sanitize(i),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ko{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=a.create("div","maplibregl-ctrl");const t=a.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){a.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Eo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Ao=t.aG([{name:"a_pos3d",type:"Int16",components:3}]);class Io extends t.E{constructor(e){super(),this._lastTilesetChange=s.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,i){this.sourceCache.update(e,i),this._renderableTilesKeys=[];const r={};for(const n of ve(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:i,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))r[n.key]=!0,this._renderableTilesKeys.push(n.key),this._tiles[n.key]||(n.terrainRttPosMatrix32f=new Float64Array(16),t.bQ(n.terrainRttPosMatrix32f,0,t.Z,t.Z,0,0,1),this._tiles[n.key]=new oe(n,this.tileSize),this._lastTilesetChange=s.now());for(const e in this._tiles)r[e]||delete this._tiles[e]}freeRtt(e){for(const t in this._tiles){const i=this._tiles[t];(!e||i.tileID.equals(e)||i.tileID.isChildOf(e)||e.isChildOf(i.tileID))&&(i.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,t){return t?this._getTerrainCoordsForTileRanges(e,t):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const i={};for(const r of this._renderableTilesKeys){const n=this._tiles[r].tileID,o=e.clone(),s=t.b2();if(n.canonical.equals(e.canonical))t.bQ(s,0,t.Z,t.Z,0,0,1);else if(n.canonical.isChildOf(e.canonical)){const i=n.canonical.z-e.canonical.z,r=n.canonical.x-(n.canonical.x>>i<<i),o=n.canonical.y-(n.canonical.y>>i<<i),a=t.Z>>i;t.bQ(s,0,a,a,0,0,1),t.L(s,s,[-r*a,-o*a,0])}else{if(!e.canonical.isChildOf(n.canonical))continue;{const i=e.canonical.z-n.canonical.z,r=e.canonical.x-(e.canonical.x>>i<<i),o=e.canonical.y-(e.canonical.y>>i<<i),a=t.Z>>i;t.bQ(s,0,t.Z,t.Z,0,0,1),t.L(s,s,[r*a,o*a,0]),t.M(s,s,[1/2**i,1/2**i,0])}}o.terrainRttPosMatrix32f=new Float32Array(s),i[r]=o}return i}_getTerrainCoordsForTileRanges(e,i){const r={};for(const n of this._renderableTilesKeys){const o=this._tiles[n].tileID;if(!this._isWithinTileRanges(o,i))continue;const s=e.clone(),a=t.b2();if(o.canonical.z===e.canonical.z){const i=e.canonical.x-o.canonical.x,r=e.canonical.y-o.canonical.y;t.bQ(a,0,t.Z,t.Z,0,0,1),t.L(a,a,[i*t.Z,r*t.Z,0])}else if(o.canonical.z>e.canonical.z){const i=o.canonical.z-e.canonical.z,r=o.canonical.x-(o.canonical.x>>i<<i),n=o.canonical.y-(o.canonical.y>>i<<i),s=e.canonical.x-(o.canonical.x>>i),l=e.canonical.y-(o.canonical.y>>i),c=t.Z>>i;t.bQ(a,0,c,c,0,0,1),t.L(a,a,[-r*c+s*t.Z,-n*c+l*t.Z,0])}else{const i=e.canonical.z-o.canonical.z,r=e.canonical.x-(e.canonical.x>>i<<i),n=e.canonical.y-(e.canonical.y>>i<<i),s=(e.canonical.x>>i)-o.canonical.x,l=(e.canonical.y>>i)-o.canonical.y,c=t.Z<<i;t.bQ(a,0,c,c,0,0,1),t.L(a,a,[r*t.Z+s*c,n*t.Z+l*c,0])}s.terrainRttPosMatrix32f=new Float32Array(a),r[n]=s}return r}getSourceTile(e,t){const i=this.sourceCache._source;let r=e.overscaledZ-this.deltaZoom;if(r>i.maxzoom&&(r=i.maxzoom),r<i.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(r).key);let n=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!n||!n.dem)&&t)for(;r>=i.minzoom&&(!n||!n.dem);)n=this.sourceCache.getTileByID(e.scaledTo(r--).key);return n}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,t){return t[e.canonical.z]&&e.canonical.x>=t[e.canonical.z].minTileX&&e.canonical.x<=t[e.canonical.z].maxTileX&&e.canonical.y>=t[e.canonical.z].minTileY&&e.canonical.y<=t[e.canonical.z].maxTileY}}class zo{constructor(e,t,i){this._meshCache={},this.painter=e,this.sourceCache=new Io(t),this.options=i,this.exaggeration="number"==typeof i.exaggeration?i.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,i,r,n=t.Z){var o;if(!(i>=0&&i<n&&r>=0&&r<n))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=t.cj([],[i/n*t.Z,r/n*t.Z],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,i){if(!t.ck(i,e.wrap()))return 0;const{tileID:r,mercatorX:n,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,i);return this.getElevation(r,n%t.Z,o%t.Z,t.Z)}getElevation(e,i,r,n=t.Z){return this.getDEMElevation(e,i,r,n)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,i=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _(e,i,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.ad([])}const i=this.sourceCache.getSourceTile(e,!0);if(i&&i.dem&&(!i.demTexture||i.needsTerrainPrepare)){const e=this.painter.context;i.demTexture=this.painter.getTileTexture(i.dem.stride),i.demTexture?i.demTexture.update(i.dem.getPixels(),{premultiply:!1}):i.demTexture=new _(e,i.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),i.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),i.needsTerrainPrepare=!1}const r=i&&i+i.tileID.key+e.key;if(r&&!this._demMatrixCache[r]){const r=this.sourceCache.sourceCache._source.maxzoom;let n=e.canonical.z-i.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=r?n=e.canonical.z-r:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>n<<n),s=e.canonical.y-(e.canonical.y>>n<<n),a=t.cl(new Float64Array(16),[1/(t.Z<<n),1/(t.Z<<n),0]);t.L(a,a,[o*t.Z,s*t.Z,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:i&&i.dem&&i.dem.dim||1,u_terrain_matrix:r?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:i&&i.dem&&i.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(i&&i.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:i}}getFramebuffer(e){const t=this.painter,i=t.width/devicePixelRatio,r=t.height/devicePixelRatio;return!this._fbo||this._fbo.width===i&&this._fbo.height===r||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _(t.context,{width:i,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _(t.context,{width:i,height:r,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=t.context.createFramebuffer(i,r,!0,!1),this._fbo.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,i,r))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const i=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let r=0;r<this._coordsTextureSize;r++,t+=4)i[t+0]=255&r,i[t+1]=255&e,i[t+2]=r>>8<<4|e>>8,i[t+3]=0;const r=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(i.buffer)),n=new _(e,r,e.gl.RGBA,{premultiply:!1});return n.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=n,n}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const i=new Uint8Array(4),r=this.painter.context,n=r.gl,o=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);r.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),n.readPixels(o,a-s-1,1,1,n.RGBA,n.UNSIGNED_BYTE,i),r.bindFramebuffer.set(null);const l=i[0]+(i[2]>>4<<8),c=i[1]+((15&i[2])<<8),u=this.coordsIndex[255-i[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.$((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),i=this.painter.context,r=i.gl;return i.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),r.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,r.RGBA,r.UNSIGNED_BYTE,t),i.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(e){var i;const r=(null===(i=this.painter.style.projection)||void 0===i?void 0:i.transitionState)>0,n=r&&0===e.canonical.y,o=r&&e.canonical.y===(1<<e.canonical.z)-1,s=`m_${n?"n":""}_${o?"s":""}`;if(this._meshCache[s])return this._meshCache[s];const a=this.painter.context,l=new t.cm,c=new t.aK,u=this.meshSize,h=t.Z/u,d=u*u;for(let e=0;e<=u;e++)for(let t=0;t<=u;t++)l.emplaceBack(t*h,e*h,0);for(let e=0;e<d;e+=u+1)for(let t=0;t<u;t++)c.emplaceBack(t+e,u+t+e+1,u+t+e+2),c.emplaceBack(t+e,u+t+e+2,t+e+1);const p=l.length,f=p+(u+1),m=(u+1)*u,g=n?t.b9:0,y=n?0:1,_=o?t.ba:t.Z,v=o?0:1;for(let e=0;e<=u;e++)l.emplaceBack(e*h,g,y);for(let e=0;e<=u;e++)l.emplaceBack(e*h,_,v);for(let e=0;e<u;e++)c.emplaceBack(m+e,f+e,f+e+1),c.emplaceBack(m+e,f+e+1,m+e+1),c.emplaceBack(0+e,p+e+1,p+e),c.emplaceBack(0+e,0+e+1,p+e+1);const x=l.length,b=x+2*(u+1);for(const e of[0,1])for(let i=0;i<=u;i++)for(const r of[0,1])l.emplaceBack(e*t.Z,i*h,r);for(let e=0;e<2*u;e+=2)c.emplaceBack(x+e,x+e+1,x+e+3),c.emplaceBack(x+e,x+e+3,x+e+2),c.emplaceBack(b+e,b+e+3,b+e+1),c.emplaceBack(b+e,b+e+2,b+e+3);const w=new wt(a.createVertexBuffer(l,Ao.members),a.createIndexBuffer(c),t.aJ.simpleSegment(0,0,l.length,c.length));return this._meshCache[s]=w,w}getMeshFrameDelta(e){return 2*Math.PI*t.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,t){var i;const{tileID:r}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(i=this.getMinMaxElevation(r).minElevation)&&void 0!==i?i:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,i={minElevation:null,maxElevation:null};return t&&t.dem&&(i.minElevation=t.dem.min*this.exaggeration,i.maxElevation=t.dem.max*this.exaggeration),i}_getOverscaledTileIDFromLngLatZoom(e,i){const r=t.$.fromLngLat(e.wrap()),n=(1<<i)*t.Z,o=r.x*n,s=r.y*n,a=Math.floor(o/t.Z),l=Math.floor(s/t.Z);return{tileID:new t.Y(i,0,i,a,l),mercatorX:o,mercatorY:s}}}class Po{constructor(e,t,i){this._context=e,this._size=t,this._tileSize=i,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const t=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),i=new _(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return i.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),t.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),t.colorAttachment.set(i.texture),{id:e,fbo:t,texture:i,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((t=>e.id!==t)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}const Lo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Do{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new Po(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((i=>!e._layers[i].isHidden(t))),this._coordsAscending={};for(const t in e.sourceCaches){this._coordsAscending[t]={};const i=e.sourceCaches[t].getVisibleCoordinates(),r=e.sourceCaches[t].getSource(),n=r instanceof K?r.terrainTileRanges:null;for(const e of i){const i=this.terrain.sourceCache.getTerrainCoords(e,n);for(const e in i)this._coordsAscending[t][e]||(this._coordsAscending[t][e]=[]),this._coordsAscending[t][e].push(i[e])}}this._coordsAscendingStr={};for(const t of e._order){const i=e._layers[t],r=i.source;if(Lo[i.type]&&!this._coordsAscendingStr[r]){this._coordsAscendingStr[r]={};for(const e in this._coordsAscending[r])this._coordsAscendingStr[r][e]=this._coordsAscending[r][e].map((e=>e.key)).sort().join()}}for(const e of this._renderableTiles)for(const t in this._coordsAscendingStr){const i=this._coordsAscendingStr[t][e.tileID.key];i&&i!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(e,i){if(e.isHidden(this.painter.transform.zoom))return!1;const r=Object.assign(Object.assign({},i),{isRenderingToTexture:!0}),n=e.type,o=this.painter,s=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Lo[n]&&(this._prevType&&Lo[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!s))return!0;if(Lo[this._prevType]||Lo[n]&&s){this._prevType=n;const e=this._stacks.length-1,i=this._stacks[e]||[];for(const n of this._renderableTiles){if(this.pool.isFull()&&(bn(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(n),n.rtt[e]){const t=this.pool.getObjectForId(n.rtt[e].id);if(t.stamp===n.rtt[e].stamp){this.pool.useObject(t);continue}}const s=this.pool.getOrCreateFreeObject();this.pool.useObject(s),this.pool.stampObject(s),n.rtt[e]={id:s.id,stamp:s.stamp},o.context.bindFramebuffer.set(s.fbo.framebuffer),o.context.clear({color:t.b7.transparent,stencil:0}),o.currentStencilSource=void 0;for(let e=0;e<i.length;e++){const t=o.style._layers[i[e]],a=t.source?this._coordsAscending[t.source][n.tileID.key]:[n.tileID];o.context.viewport.set([0,0,s.fbo.width,s.fbo.height]),o._renderTileClippingMasks(t,a,!0),o.renderLayer(o,o.style.sourceCaches[t.source],t,a,r),t.source&&(n.rttCoords[t.source]=this._coordsAscendingStr[t.source][n.tileID.key])}}return bn(this.painter,this.terrain,this._rttTiles,r),this._rttTiles=[],this.pool.freeAllObjects(),Lo[n]}return!1}}const Ro={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bo=i,Oo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Co,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Fo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class jo{constructor(e,i,r=!1){this.mousedown=e=>{this.startMove(e,a.mousePos(this.element,e)),a.addEventListener(window,"mousemove",this.mousemove),a.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.move(e,a.mousePos(this.element,e))},this.mouseup=e=>{this._rotatePitchHanlder.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.startMove(e,this._startPos),a.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=a.touchPos(this.element,e.targetTouches)[0],this.move(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=i;const n=new Kn;this._rotatePitchHanlder=new Zn({clickTolerance:3,move:(e,n)=>{const o=i.getBoundingClientRect(),s=new t.P((o.bottom-o.top)/2,(o.right-o.left)/2);return{bearingDelta:t.ce(new t.P(e.x,n.y),n,s),pitchDelta:r?-.5*(n.y-e.y):void 0}},moveStateManager:n,enable:!0,assignEvents:()=>{}}),this.map=e,a.addEventListener(i,"mousedown",this.mousedown),a.addEventListener(i,"touchstart",this.touchstart,{passive:!1}),a.addEventListener(i,"touchcancel",this.reset)}startMove(e,t){this._rotatePitchHanlder.dragStart(e,t),a.disableDrag()}move(e,t){const i=this.map,{bearingDelta:r,pitchDelta:n}=this._rotatePitchHanlder.dragMove(e,t)||{};r&&i.setBearing(i.getBearing()+r),n&&i.setPitch(i.getPitch()+n)}off(){const e=this.element;a.removeEventListener(e,"mousedown",this.mousedown),a.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend),a.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){a.enableDrag(),a.removeEventListener(window,"mousemove",this.mousemove),a.removeEventListener(window,"mouseup",this.mouseup),a.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),a.removeEventListener(window,"touchend",this.touchend)}}let $o;function No(e,i,r,n=!1){if(n||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return null==e?void 0:e.wrap();const o=new t.Q(e.lng,e.lat);if(e=new t.Q(e.lng,e.lat),i){const n=new t.Q(e.lng-360,e.lat),o=new t.Q(e.lng+360,e.lat),s=r.locationToScreenPoint(e).distSqr(i);r.locationToScreenPoint(n).distSqr(i)<s?e=n:r.locationToScreenPoint(o).distSqr(i)<s&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationToScreenPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e.lng!==o.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(e))?e:o}const Uo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vo(e,t,i){const r=e.classList;for(const e in Uo)r.remove(`maplibregl-${i}-anchor-${e}`);r.add(`maplibregl-${i}-anchor-${t}`)}class Go extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()},this._update=e=>{if(!this._map)return;const t=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!t)&&this._map.once("render",this._update),this._lngLat=No(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let i="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?i=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(i=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||e&&"moveend"!==e.type||(this._pos=this._pos.round()),a.setTransform(this._element,`${Uo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${r} ${i}`),s.frameAsync(new AbortController).then((()=>{this._updateOpacity(e&&"moveend"===e.type)})).catch((()=>{}))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.l("dragstart"))),this.fire(new t.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.l("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=a.create("div");const i=a.createNS("http://www.w3.org/2000/svg","svg"),r=41,n=27;i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height",`${r}px`),i.setAttributeNS(null,"width",`${n}px`),i.setAttributeNS(null,"viewBox",`0 0 ${n} ${r}`);const o=a.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const s=a.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");const l=a.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=a.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=a.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=a.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=a.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=a.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=a.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=a.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=a.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const y=a.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(y),s.appendChild(l),s.appendChild(u),s.appendChild(d),s.appendChild(f),s.appendChild(m),i.appendChild(s),i.setAttributeNS(null,"height",r*this._scale+"px"),i.setAttributeNS(null,"width",n*this._scale+"px"),this._element.appendChild(i),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),Vo(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),a.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.Q.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.abs(i)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-13.5,-1*(t-i)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var i,r;const n=null===(i=this._map)||void 0===i?void 0:i.terrain,o=this._map.transform.isLocationOccluded(this._lngLat);if(!n||o){const e=o?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==e&&(this._element.style.opacity=e))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const s=this._map,a=s.terrain.depthAtPoint(this._pos),l=s.terrain.getElevationForLngLatZoom(this._lngLat,s.transform.tileZoom);if(s.transform.lngLatToCameraDepth(this._lngLat,l)-a<.006)return void(this._element.style.opacity=this._opacity);const c=-this._offset.y/s.transform.pixelsPerMeter,u=Math.sin(s.getPitch()*Math.PI/180)*c,h=s.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),d=s.transform.lngLatToCameraDepth(this._lngLat,l+u)-h>.006;(null===(r=this._popup)||void 0===r?void 0:r.isOpen())&&d&&this._popup.remove(),this._element.style.opacity=d?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return(void 0===this._opacity||void 0===e&&void 0===t)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const qo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Zo=0,Wo=!1;const Ho={maxWidth:100,unit:"metric"};function Xo(e,t,i){const r=i&&i.maxWidth||100,n=e._container.clientHeight/2,o=e._container.clientWidth/2,s=e.unproject([o-r/2,n]),a=e.unproject([o+r/2,n]),l=Math.round(e.project(a).x-e.project(s).x),c=Math.min(r,l,e._container.clientWidth),u=s.distanceTo(a);if(i&&"imperial"===i.unit){const i=3.2808*u;i>5280?Ko(t,c,i/5280,e._getUIString("ScaleControl.Miles")):Ko(t,c,i,e._getUIString("ScaleControl.Feet"))}else i&&"nautical"===i.unit?Ko(t,c,u/1852,e._getUIString("ScaleControl.NauticalMiles")):u>=1e3?Ko(t,c,u/1e3,e._getUIString("ScaleControl.Kilometers")):Ko(t,c,u,e._getUIString("ScaleControl.Meters"))}function Ko(e,t,i,r){const n=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(i);e.style.width=t*(n/i)+"px",e.innerHTML=`${n}&nbsp;${r}`}const Yo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Jo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qo(e){if(e){if("number"==typeof e){const i=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(i,i),"top-right":new t.P(-i,i),bottom:new t.P(0,-e),"bottom-left":new t.P(i,-i),"bottom-right":new t.P(-i,-i),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const i=t.P.convert(e);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return Qo(new t.P(0,0))}const es=i;e.AJAXError=t.cq,e.Event=t.l,e.Evented=t.E,e.LngLat=t.Q,e.MercatorCoordinate=t.$,e.Point=t.P,e.addProtocol=t.cr,e.config=t.a,e.removeProtocol=t.cs,e.AttributionControl=Mo,e.BoxZoomHandler=Nn,e.CanvasSource=J,e.CooperativeGesturesHandler=vo,e.DoubleClickZoomHandler=po,e.DragPanHandler=go,e.DragRotateHandler=yo,e.EdgeInsets=kt,e.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){a.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=a.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);a.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=X,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const i=new t.Q(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,n=this._map.getBearing(),o=t.e({bearing:n},this.options.fitBoundsOptions),s=G.fromLngLat(i,r);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const i=new t.Q(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Wo)return;this.options.trackUserLocation&&this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=a.create("button","maplibregl-ctrl-geolocate",this._container),a.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Go({element:this._dotElement}),this._circleElement=a.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Go({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.l("trackuserlocationend")),this.fire(new t.l("userlocationlostfocus")))}))}},this.options=t.e({},qo,e)}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,(function*(e=!1){if(void 0!==$o&&!e)return $o;if(void 0===window.navigator.permissions)return $o=!!window.navigator.geolocation,$o;try{const e=yield window.navigator.permissions.query({name:"geolocation"});$o="denied"!==e.state}catch(e){$o=!!window.navigator.geolocation}return $o}))}().then((e=>this._finishSetupUI(e))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),a.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Zo=0,Wo=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const e=this._map.getBounds(),t=e.getSouthEast(),i=e.getNorthEast(),r=t.distanceTo(i),n=Math.ceil(this._accuracy/(r/this._map._container.clientHeight)*2);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Zo--,Wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.l("trackuserlocationstart")),this.fire(new t.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Zo++,Zo>1?(e={maximumAge:6e5,timeout:0},Wo=!0):(e=this.options.positionOptions,Wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.GlobeControl=class{constructor(){this._toggleProjection=()=>{var e;const t=null===(e=this._map.getProjection())||void 0===e?void 0:e.type;this._map.setProjection("mercator"!==t&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var e;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(e=this._map.getProjection())||void 0===e?void 0:e.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=a.create("button","maplibregl-ctrl-globe",this._container),a.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){a.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},e.Hash=Cn,e.ImageSource=K,e.KeyboardHandler=lo,e.LngLatBounds=G,e.LogoControl=ko,e.Map=class extends So{constructor(e){var i,r;t.cn.mark(t.co.create);const n=Object.assign(Object.assign(Object.assign({},Oo),e),{canvasContextAttributes:Object.assign(Object.assign({},Oo.canvasContextAttributes),e.canvasContextAttributes)});if(null!=n.minZoom&&null!=n.maxZoom&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=n.minPitch&&null!=n.maxPitch&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=n.minPitch&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=n.maxPitch&&n.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const o=new Dt,s=new Ft;if(void 0!==n.minZoom&&o.setMinZoom(n.minZoom),void 0!==n.maxZoom&&o.setMaxZoom(n.maxZoom),void 0!==n.minPitch&&o.setMinPitch(n.minPitch),void 0!==n.maxPitch&&o.setMaxPitch(n.maxPitch),void 0!==n.renderWorldCopies&&o.setRenderWorldCopies(n.renderWorldCopies),super(o,s,{bearingSnap:n.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Eo,this._controls=[],this._mapId=t.a4(),this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new t.l("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.l("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=n.interactive,this._maxTileCacheSize=n.maxTileCacheSize,this._maxTileCacheZoomLevels=n.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},n.canvasContextAttributes),this._trackResize=!0===n.trackResize,this._bearingSnap=n.bearingSnap,this._centerClampedToGround=n.centerClampedToGround,this._refreshExpiredTiles=!0===n.refreshExpiredTiles,this._fadeDuration=n.fadeDuration,this._crossSourceCollisions=!0===n.crossSourceCollisions,this._collectResourceTiming=!0===n.collectResourceTiming,this._locale=Object.assign(Object.assign({},Ro),n.locale),this._clickTolerance=n.clickTolerance,this._overridePixelRatio=n.pixelRatio,this._maxCanvasSize=n.maxCanvasSize,this.transformCameraUpdate=n.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=!0===n.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=f.addThrottleControl((()=>this.isMoving())),this._requestManager=new m(n.transformRequest),"string"==typeof n.container){if(this._container=document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container}' not found.`)}else{if(!(n.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(n.maxBounds&&this.setMaxBounds(n.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1;const t=Sn((e=>{this._trackResize&&!this._removed&&(this.resize(e),this.redraw())}),50);this._resizeObserver=new ResizeObserver((i=>{e?t(i):e=!0})),this._resizeObserver.observe(this._container)}this.handlers=new To(this,n),this._hash=n.hash&&new Cn("string"==typeof n.hash&&n.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:n.center,elevation:n.elevation,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,roll:n.roll}),n.bounds&&(this.resize(),this.fitBounds(n.bounds,t.e({},n.fitBoundsOptions,{duration:0}))));const a="string"==typeof n.style||!("globe"===(null===(r=null===(i=n.style)||void 0===i?void 0:i.projection)||void 0===r?void 0:r.type));this.resize(null,a),this._localIdeographFontFamily=n.localIdeographFontFamily,this._validateStyle=n.validateStyle,n.style&&this.setStyle(n.style,{localIdeographFontFamily:n.localIdeographFontFamily}),n.attributionControl&&this.addControl(new Mo("boolean"==typeof n.attributionControl?void 0:n.attributionControl)),n.maplibreLogo&&this.addControl(new ko,n.logoPosition),this.on("style.load",(()=>{if(a||this._resizeTransform(),this.transform.unmodified){const e=t.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(e)}})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.l(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.l(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.l("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,i,r){return null==r&&this.terrain&&(r=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,i,r)}resize(e,i=!0){const[r,n]=this._containerDimensions(),o=this._getClampedPixelRatio(r,n);if(this._resizeCanvas(r,n,o),this.painter.resize(r,n,o),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const t=this._getClampedPixelRatio(r,n);this._resizeCanvas(r,n,t),this.painter.resize(r,n,t)}this._resizeTransform(i);const s=!this._moving;return s&&(this.stop(),this.fire(new t.l("movestart",e)).fire(new t.l("move",e))),this.fire(new t.l("resize",e)),s&&this.fire(new t.l("moveend",e)),this}_resizeTransform(e=!0){var t;const[i,r]=this._containerDimensions();this.transform.resize(i,r,e),null===(t=this._requestedCameraState)||void 0===t||t.resize(i,r,e)}_getClampedPixelRatio(e,t){const{0:i,1:r}=this._maxCanvasSize,n=this.getPixelRatio(),o=e*n,s=t*n;return Math.min(o>i?i/o:1,s>r?r/s:1)*n}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds(G.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.setMinZoom(e),this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.setMaxZoom(e),this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.setMinPitch(e),this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>180)throw new Error("maxPitch must be less than or equal to 180");if(e>=this.transform.minPitch)return this.transform.setMaxPitch(e),this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.setRenderWorldCopies(e),this._update()}project(e){return this.transform.locationToScreenPoint(t.Q.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.screenPointToLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e))),s=0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[];s.length?r||(r=!0,i.call(this,new Rn(e,this,n.originalEvent,{features:s}))):r=!1};return{layers:t,listener:i,delegates:{mousemove:n,mouseout:()=>{r=!1}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const o=t.filter((e=>this.getLayer(e)));(0!==o.length?this.queryRenderedFeatures(n.point,{layers:o}):[]).length?r=!0:r&&(r=!1,i.call(this,new Rn(e,this,n.originalEvent)))},o=t=>{r&&(r=!1,i.call(this,new Rn(e,this,t.originalEvent)))};return{layers:t,listener:i,delegates:{mousemove:n,mouseout:o}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=0!==r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:t,listener:i,delegates:{[e]:r}}}}_saveDelegatedListener(e,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(t)}_removeDelegatedListener(e,t,i){if(!this._delegatedListeners||!this._delegatedListeners[e])return;const r=this._delegatedListeners[e];for(let e=0;e<r.length;e++){const n=r[e];if(n.listener===i&&n.layers.length===t.length&&n.layers.every((e=>t.includes(e)))){for(const e in n.delegates)this.off(e,n.delegates[e]);return void r.splice(e,1)}}}on(e,t,i){if(void 0===i)return super.on(e,t);const r="string"==typeof t?[t]:t,n=this._createDelegatedListener(e,r,i);this._saveDelegatedListener(e,n);for(const e in n.delegates)this.on(e,n.delegates[e]);return{unsubscribe:()=>{this._removeDelegatedListener(e,r,i)}}}once(e,t,i){if(void 0===i)return super.once(e,t);const r="string"==typeof t?[t]:t,n=this._createDelegatedListener(e,r,i);for(const t in n.delegates){const o=n.delegates[t];n.delegates[t]=(...t)=>{this._removeDelegatedListener(e,r,i),o(...t)}}this._saveDelegatedListener(e,n);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,t,i){return void 0===i?super.off(e,t):(this._removeDelegatedListener(e,"string"==typeof t?[t]:t,i),this)}queryRenderedFeatures(e,i){if(!this.style)return[];let r;const n=e instanceof t.P||Array.isArray(e),o=n?e:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(n?{}:e)||{},o instanceof t.P||"number"==typeof o[0])r=[t.P.convert(o)];else{const e=t.P.convert(o[0]),i=t.P.convert(o[1]);r=[e,new t.P(i.x,e.y),i,new t.P(e.x,i.y),e]}return this.style.queryRenderedFeatures(r,i,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,i){return!1!==(i=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(e,i))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){var i,r;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(e,t)));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new xi(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,n):this.style.loadJSON(e,t,n),this):(null===(r=null===(i=this.style)||void 0===i?void 0:i.projection)||void 0===r||r.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,i){if("string"==typeof e){const r=this._requestManager.transformRequest(e,"Style");t.j(r,new AbortController).then((e=>{this._updateDiff(e.data,i)})).catch((e=>{e&&this.fire(new t.k(e))}))}else"object"==typeof e&&this._updateDiff(e,i)}_updateDiff(e,i){try{this.style.setState(e,i)&&this._update(!0)}catch(r){t.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const i=this.style&&this.style.sourceCaches[e];if(void 0!==i)return i.loaded();this.fire(new t.k(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const i=this.style.sourceCaches[e.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&i.reload();for(const i in this.style._layers){const r=this.style._layers[i];"hillshade"===r.type&&r.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new zo(this.painter,i,e),this.painter.renderToTexture=new Do(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=t=>{var i;"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(i=t.source)||void 0===i?void 0:i.type)?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.l("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}setSourceTileLodParams(e,t,i){if(i){const r=this.getSource(i);if(!r)throw new Error(`There is no source with ID "${i}", cannot set LOD parameters`);r.calculateTileZoom=ge(Math.max(1,e),Math.max(1,t))}else for(const i in this.style.sourceCaches)this.style.sourceCaches[i].getSource().calculateTileZoom=ge(Math.max(1,e),Math.max(1,t));return this._update(!0),this}refreshTiles(e,i){const r=this.style.sourceCaches[e];if(!r)throw new Error(`There is no source cache with ID "${e}", cannot refresh tile`);void 0===i?r.reload():r.refreshTiles(i.map((e=>new t.a1(e.z,e.x,e.y))))}addImage(e,i,r={}){const{pixelRatio:n=1,sdf:o=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=r;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||t.b(i))){if(void 0===i.width||void 0===i.height)return this.fire(new t.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:r,height:s,data:d}=i,p=i;return this.style.addImage(e,{data:new t.R({width:r,height:s},new Uint8Array(d)),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:r,height:d,data:p}=s.getImageData(i);this.style.addImage(e,{data:new t.R({width:r,height:d},p),pixelRatio:n,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:o,version:0})}}updateImage(e,i){const r=this.style.getImage(e);if(!r)return this.fire(new t.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||t.b(i)?s.getImageData(i):i,{width:o,height:a,data:l}=n;if(void 0===o||void 0===a)return this.fire(new t.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==r.data.width||a!==r.data.height)return this.fire(new t.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(i instanceof HTMLImageElement||t.b(i));return r.data.replace(l,c),this.style.updateImage(e,r),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.k(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return f.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0)}setFilter(e,t,i={}){return this.style.setFilter(e,t,i),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,i,r={}){return this.style.setPaintProperty(e,t,i,r),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,i,r={}){return this.style.setLayoutProperty(e,t,i,r),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,i={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,i,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,(e=>{e||this._update(!0)})),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(e,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=a.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=a.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const i=this._containerDimensions(),r=this._getClampedPixelRatio(i[0],i[1]);this._resizeCanvas(i[0],i[1],r);const n=this._controlContainer=a.create("div","maplibregl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{o[e]=a.create("div",`maplibregl-ctrl-${e} `,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,i){this._canvas.width=Math.floor(i*e),this._canvas.height=Math.floor(i*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const e=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(i=>{t={requestedAttributes:e},i&&(t.statusMessage=i.statusMessage,t.type=i.type)}),{once:!0});let i=null;if(i=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,e):this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e),!i){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new Tn(i,this.transform),l.testSupport(i)}migrateProjection(e,i){super.migrateProjection(e,i),this.painter.transform=e,this.fire(new t.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){var i,r,n,o,a;const l=this._idleTriggered?this._fadeDuration:0,c=(null===(i=this.style.projection)||void 0===i?void 0:i.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=s.now();this.style.zoomHistory.update(e,i);const r=new t.C(e,{now:i,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),n=r.crossFadingFactor();1===n&&n===this._crossFadingFactor||(u=!0,this._crossFadingFactor=n),this.style.update(r)}const h=(null===(r=this.style.projection)||void 0===r?void 0:r.transitionState)>0!==c;null===(n=this.style.projection)||void 0===n||n.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState,null===(a=this.style.projection)||void 0===a?void 0:a.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||h)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,h),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new t.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cn.mark(t.co.load),this.fire(new t.l("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.l("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,t.cn.mark(t.co.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),f.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");(null==i?void 0:i.loseContext)&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),a.remove(this._canvasContainer),a.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cn.clearMetrics(),this._removed=!0,this.fire(new t.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,s.frame(this._frameRequest,(e=>{t.cn.frame(e),this._frameRequest=null;try{this._render(e)}catch(e){if(!t.cp(e)&&!function(e){return e.message===Ur}(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return Bo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(e){return this._lazyInitEmptyStyle(),this.style.setProjection(e),this._update(!0)}},e.MapMouseEvent=Rn,e.MapTouchEvent=Bn,e.MapWheelEvent=On,e.Marker=Go,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),i=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,t)=>{const i=this._map._getUIString(`NavigationControl.${t}`);e.title=i,e.setAttribute("aria-label",i)},this.options=t.e({},Fo,e),this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),a.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=a.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){a.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const i=a.create("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}},e.Popup=class extends t.E{constructor(e){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&a.remove(this._content),this._container&&(a.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=a.create("div","maplibregl-popup",this._map.getContainer()),this._tip=a.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=No(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const t=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let i=this.options.anchor;const r=Qo(this.options.offset);if(!i){const e=this._container.offsetWidth,n=this._container.offsetHeight;let o;o=t.y+r.bottom.y<n?["top"]:t.y>this._map.transform.height-n?["bottom"]:[],t.x<e/2?o.push("left"):t.x>this._map.transform.width-e/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}let n=t.add(r[i]);this.options.subpixelPositioning||(n=n.round()),a.setTransform(this._container,`${Uo[i]} translate(${n.x}px,${n.y}px)`),Vo(this._container,i,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Yo),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.Q.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=a.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}_createCloseButton(){this.options.closeButton&&(this._closeButton=a.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Jo);e&&e.focus()}},e.RasterDEMTileSource=H,e.RasterTileSource=W,e.ScaleControl=class{constructor(e){this._onMove=()=>{Xo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Xo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ho),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){a.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=ho,e.Style=xi,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=a.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=a.create("button","maplibregl-ctrl-terrain",this._container),a.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){a.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=so,e.TwoFingersTouchRotateHandler=no,e.TwoFingersTouchZoomHandler=io,e.TwoFingersTouchZoomRotateHandler=_o,e.VectorTileSource=Z,e.VideoSource=Y,e.addSourceType=(e,i)=>t._(void 0,void 0,void 0,(function*(){if(ee(e))throw new Error(`A source type called "${e}" already exists.`);((e,t)=>{Q[e]=t})(e,i)})),e.clearPrewarmedResources=function(){const e=D;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(z),D=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.createTileMesh=Xt,e.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return ne().getRTLTextPluginStatus()},e.getVersion=function(){return es},e.getWorkerCount=function(){return P.workerCount},e.getWorkerUrl=function(){return t.a.WORKER_URL},e.importScriptInWorkers=function(e){return F().broadcast("IS",e)},e.prewarm=function(){B().acquire(z)},e.setMaxParallelImageRequests=function(e){t.a.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setRTLTextPlugin=function(e,t){return ne().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){P.workerCount=e},e.setWorkerUrl=function(e){t.a.WORKER_URL=e}})),e}()),xt=t({__proto__:null,default:vt},[_t.exports]),bt={$version:8,$root:{version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Mercator, Natural Earth, and Winkel Tripel. Terrain, fog, sky and CustomLayerInterface are not supported for projections other than mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},sources:{"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster:{type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) — it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},source_video:{type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},source_image:{type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},layer:{id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesn’t support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},filter:{type:"array",value:"*",doc:"A filter selects specific features from a layer."},filter_symbol:{type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] ≠ value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] ≥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] ≤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] ∈ {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] ∉ {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 ∧ ... ∧ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 ∨ ... ∨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `¬f0 ∧ ... ∧ ¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},geometry_type:{type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:"A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:\n* In categorical functions, when the feature value does not match any of the stop domain values.\n* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.\n* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a `circle-color` property but the feature property value is not a string or not a valid color).\n* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.\nIf no default is provided, the style property's default is used in these circumstances."}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},expression:{type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},expression_name:{doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`. `Multi*` feature types are only returned in GeoJSON sources. When working with vector tile sources, use the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the fog. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the fog to the color of the sky. A value of zero leaves a sharp transition from fog to sky. Increasing the value blends the color of fog into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0"}}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0° (0° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0°, directly above, to 180°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},projection:{name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carrée projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},terrain:{source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0° is directly above, at zenith, and 90° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0° is directly above, at zenith, and 90° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"cross-faded":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms."},"cross-faded-data-driven":{type:"property-type",doc:"Property is non-interpolable; rather, its values will be cross-faded to smoothly transition between integer zooms. It can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:{"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}}},wt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Tt(e){var t={exports:{}};return e(t,t.exports),t.exports}function St(e,t){return Object.prototype.hasOwnProperty.call(e,t)}
/*! https://mths.be/punycode v1.3.2 by @mathias */
Tt((function(e,t){!function(i){var r=t&&!t.nodeType&&t,n=e&&!e.nodeType&&e,o="object"==typeof wt&&wt;o.global!==o&&o.window!==o&&o.self!==o||(i=o);var s,a,l=2147483647,c=36,u=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(p[e])}function y(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function _(e,t){var i=e.split("@"),r="";return i.length>1&&(r=i[0]+"@",e=i[1]),r+y((e=e.replace(d,".")).split("."),t).join(".")}function v(e){for(var t,i,r=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function x(e){return y(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function w(e,t,i){var r=0;for(e=i?f(e/700):e>>1,e+=f(e/t);e>455;r+=c)e=f(e/35);return f(r+36*e/(e+38))}function T(e){var t,i,r,n,o,s,a,u,h,d,p,m=[],y=e.length,_=0,v=128,b=72;for((i=e.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)e.charCodeAt(r)>=128&&g("not-basic"),m.push(e.charCodeAt(r));for(n=i>0?i+1:0;n<y;){for(o=_,s=1,a=c;n>=y&&g("invalid-input"),((u=(p=e.charCodeAt(n++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:c)>=c||u>f((l-_)/s))&&g("overflow"),_+=u*s,!(u<(h=a<=b?1:a>=b+26?26:a-b));a+=c)s>f(l/(d=c-h))&&g("overflow"),s*=d;b=w(_-o,t=m.length+1,0==o),f(_/t)>l-v&&g("overflow"),v+=f(_/t),_%=t,m.splice(_++,0,v)}return x(m)}function S(e){var t,i,r,n,o,s,a,u,h,d,p,y,_,x,T,S=[];for(y=(e=v(e)).length,t=128,i=0,o=72,s=0;s<y;++s)(p=e[s])<128&&S.push(m(p));for(r=n=S.length,n&&S.push("-");r<y;){for(a=l,s=0;s<y;++s)(p=e[s])>=t&&p<a&&(a=p);for(a-t>f((l-i)/(_=r+1))&&g("overflow"),i+=(a-t)*_,t=a,s=0;s<y;++s)if((p=e[s])<t&&++i>l&&g("overflow"),p==t){for(u=i,h=c;!(u<(d=h<=o?1:h>=o+26?26:h-o));h+=c)T=u-d,x=c-d,S.push(m(b(d+T%x,0))),u=f(T/x);S.push(m(b(u,0))),o=w(i,_,r==n),i=0,++r}++i,++t}return S.join("")}if(s={version:"1.3.2",ucs2:{decode:v,encode:x},decode:T,encode:S,toASCII:function(e){return _(e,(function(e){return h.test(e)?"xn--"+S(e):e}))},toUnicode:function(e){return _(e,(function(e){return u.test(e)?T(e.slice(4).toLowerCase()):e}))}},r&&n)if(e.exports==r)n.exports=s;else for(a in s)s.hasOwnProperty(a)&&(r[a]=s[a]);else i.punycode=s}(wt)}));var Ct=function(e,t,i,r){t=t||"&",i=i||"=";var n={};if("string"!=typeof e||0===e.length)return n;var o=/\+/g;e=e.split(t);var s=1e3;r&&"number"==typeof r.maxKeys&&(s=r.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var l=0;l<a;++l){var c,u,h,d,p=e[l].replace(o,"%20"),f=p.indexOf(i);f>=0?(c=p.substr(0,f),u=p.substr(f+1)):(c=p,u=""),h=decodeURIComponent(c),d=decodeURIComponent(u),St(n,h)?Array.isArray(n[h])?n[h].push(d):n[h]=[n[h],d]:n[h]=d}return n},Mt=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},kt=function(e,t,i,r){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var n=encodeURIComponent(Mt(r))+i;return Array.isArray(e[r])?e[r].map((function(e){return n+encodeURIComponent(Mt(e))})).join(t):n+encodeURIComponent(Mt(e[r]))})).join(t):r?encodeURIComponent(Mt(r))+i+encodeURIComponent(Mt(e)):""};function Et(e,...t){for(const i of t)for(const t in i)e[t]=i[t];return e}Tt((function(e,t){t.decode=t.parse=Ct,t.encode=t.stringify=kt}));class At extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class It{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,i]of t)this.bindings[e]=i}concat(e){return new It(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zt={kind:"null"},Pt={kind:"number"},Lt={kind:"string"},Dt={kind:"boolean"},Rt={kind:"color"},Bt={kind:"object"},Ot={kind:"value"},Ft={kind:"collator"},jt={kind:"formatted"},$t={kind:"resolvedImage"};function Nt(e,t){return{kind:"array",itemType:e,N:t}}function Ut(e){if("array"===e.kind){const t=Ut(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Vt=[zt,Pt,Lt,Dt,Rt,jt,Bt,Nt(Ot),$t];function Gt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Gt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Vt)if(!Gt(e,t))return null}return`Expected ${Ut(e)} but found ${Ut(t)} instead.`}function qt(e,t){return t.some((t=>t.kind===e.kind))}function Zt(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}var Wt=Tt((function(e,t){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function n(e){return e<0?0:e>1?1:e}function o(e){return"%"===e[e.length-1]?r(parseFloat(e)/100*255):r(parseInt(e))}function s(e){return"%"===e[e.length-1]?n(parseFloat(e)/100):n(parseFloat(e))}function a(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{t.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in i)return i[n].slice();if("#"===n[0])return 4===n.length?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===n.length&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=n.indexOf("("),c=n.indexOf(")");if(-1!==l&&c+1===n.length){var u=n.substr(0,l),h=n.substr(l+1,c-(l+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=s(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),d];case"hsla":if(4!==h.length)return null;d=s(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=s(h[1]),m=s(h[2]),g=m<=.5?m*(f+1):m+f-m*f,y=2*m-g;return[r(255*a(y,g,p+1/3)),r(255*a(y,g,p)),r(255*a(y,g,p-1/3)),d];default:return null}}return null}}catch(e){}}));class Ht{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof Ht)return e;if("string"!=typeof e)return;const t=Wt.parseCSSColor(e);return t?new Ht(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}}Ht.black=new Ht(0,0,0,1),Ht.white=new Ht(1,1,1,1),Ht.transparent=new Ht(0,0,0,0),Ht.red=new Ht(1,0,0,1),Ht.blue=new Ht(0,0,1,1);class Xt{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kt{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class Yt{constructor(e){this.sections=e}static fromString(e){return new Yt([new Kt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Yt?e:Yt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class Jt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Jt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Qt(e,t,i,r){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255)){return`Invalid rgba value [${("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,i,r].join(", ")}]: 'a' must be between 0 and 1.`}function ei(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Ht)return!0;if(e instanceof Xt)return!0;if(e instanceof Yt)return!0;if(e instanceof Jt)return!0;if(Array.isArray(e)){for(const t of e)if(!ei(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!ei(e[t]))return!1;return!0}return!1}function ti(e){if(null===e)return zt;if("string"==typeof e)return Lt;if("boolean"==typeof e)return Dt;if("number"==typeof e)return Pt;if(e instanceof Ht)return Rt;if(e instanceof Xt)return Ft;if(e instanceof Yt)return jt;if(e instanceof Jt)return $t;if(Array.isArray(e)){const t=e.length;let i;for(const t of e){const e=ti(t);if(i){if(i===e)continue;i=Ot;break}i=e}return Nt(i||Ot,t)}return Bt}function ii(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Ht||e instanceof Yt||e instanceof Jt?e.toString():JSON.stringify(e)}class ri{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ei(e[1]))return t.error("invalid value");const i=e[1];let r=ti(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new ri(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ht?["rgba"].concat(this.value.toArray()):this.value instanceof Yt?this.value.serialize():this.value}}class ni{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const oi={string:Lt,number:Pt,boolean:Dt,object:Bt};class si{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in oi)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=oi[i],r++}else n=Ot;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=Nt(n,o)}else i=oi[n];const o=[];for(;r<e.length;r++){const i=t.parse(e[r],r,Ot);if(!i)return null;o.push(i)}return new si(i,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!Gt(this.type,ti(i)))return i;if(t===this.args.length-1)throw new ni(`Expected value to be of type ${Ut(this.type)}, but found ${Ut(ti(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class ai{constructor(e){this.type=jt,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let i=1;i<=e.length-1;++i){const o=e[i];if(n&&"object"==typeof o&&!Array.isArray(o)){n=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,Pt),!e))return null;let i=null;if(o["text-font"]&&(i=t.parse(o["text-font"],1,Nt(Lt)),!i))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,Rt),!s))return null;const a=r[r.length-1];a.scale=e,a.font=i,a.textColor=s}else{const o=t.parse(e[i],1,Ot);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:o,scale:null,font:null,textColor:null})}}return new ai(r)}evaluate(e){return new Yt(this.sections.map((t=>{const i=t.content.evaluate(e);return ti(i)===$t?new Kt("",i,null,null,null):new Kt(ii(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class li{constructor(e){this.type=$t,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Lt);return i?new li(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Jt.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ci={"to-boolean":Dt,"to-color":Rt,"to-number":Pt,"to-string":Lt};class ui{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");const r=ci[i],n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],i,Ot);if(!r)return null;n.push(r)}return new ui(r,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof Ht)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Qt(t[0],t[1],t[2],t[3]),!i))return new Ht(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ni(i||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new ni(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Yt.fromString(ii(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Jt.fromString(ii(this.args[0].evaluate(e))):ii(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new ai([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new li(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild((t=>{e.push(t.serialize())})),e}}const hi=["Unknown","Point","LineString","Polygon"];class di{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?hi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord,n=i*t-e[0],o=r*t-e[1];return this.featureDistanceData.bearing[0]*n+this.featureDistanceData.bearing[1]*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ht.parse(e)),t}}class pi{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=pi.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const n=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[r,o]of s){a=new Bi(t.registry,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(r)?r[t-1]:r.type,o=a.parse(i,1+s.length,n);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(r)&&r.length!==s.length)a.error(`Expected ${r.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(r)?r[e]:r.type,i=s[e];a.concat(e+1).checkSubtype(t,i.type)}if(0===a.errors.length)return new pi(i,n,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const i=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(Ut).join(", ")})`:`(${Ut(t.type)}...)`;var t})).join(" | "),r=[];for(let i=1;i<e.length;i++){const n=t.parse(e[i],1+r.length);if(!n)return null;r.push(Ut(n.type))}t.error(`Expected arguments of type ${i}, but found (${r.join(", ")}) instead.`)}return null}static register(e,t){pi.definitions=t;for(const i in t)e[i]=pi}}class fi{constructor(e,t,i){this.type=Ft,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Dt);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Dt);if(!n)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,Lt),!o)?null:new fi(r,n,o)}evaluate(e){return new Xt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function mi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function gi(e,t){return!(e[0]<=t[0])&&(!(e[2]>=t[2])&&(!(e[1]<=t[1])&&!(e[3]>=t[3])))}function yi(e,t){const i=(180+e[0])/360;const r=(n=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360);var n;const o=Math.pow(2,t.z);return[Math.round(i*o*8192),Math.round(r*o*8192)]}function _i(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],o=e[0]-i[0],s=e[1]-i[1];return r*s-o*n==0&&r*o<=0&&n*s<=0}function vi(e,t){let i=!1;for(let s=0,a=t.length;s<a;s++){const a=t[s];for(let t=0,s=a.length;t<s-1;t++){if(_i(e,a[t],a[t+1]))return!1;r=e,n=a[t],o=a[t+1],n[1]>r[1]!=o[1]>r[1]&&r[0]<(o[0]-n[0])*(r[1]-n[1])/(o[1]-n[1])+n[0]&&(i=!i)}}var r,n,o;return i}function xi(e,t){for(let i=0;i<t.length;i++)if(vi(e,t[i]))return!0;return!1}function bi(e,t,i,r){const n=e[0]-i[0],o=e[1]-i[1],s=t[0]-i[0],a=t[1]-i[1],l=r[0]-i[0],c=r[1]-i[1],u=n*c-l*o,h=s*c-l*a;return u>0&&h<0||u<0&&h>0}function wi(e,t,i,r){const n=[t[0]-e[0],t[1]-e[1]],o=[r[0]-i[0],r[1]-i[1]];return 0!=(s=o)[0]*(a=n)[1]-s[1]*a[0]&&!(!bi(e,t,i,r)||!bi(i,r,e,t));var s,a}function Ti(e,t,i){for(const r of i)for(let i=0;i<r.length-1;++i)if(wi(e,t,r[i],r[i+1]))return!0;return!1}function Si(e,t){for(let i=0;i<e.length;++i)if(!vi(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Ti(e[i],e[i+1],t))return!1;return!0}function Ci(e,t){for(let i=0;i<t.length;i++)if(Si(e,t[i]))return!0;return!1}function Mi(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=[];for(let r=0;r<e[n].length;r++){const s=yi(e[n][r],i);mi(t,s),o.push(s)}r.push(o)}return r}function ki(e,t,i){const r=[];for(let n=0;n<e.length;n++){const o=Mi(e[n],t,i);r.push(o)}return r}function Ei(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}mi(t,e)}function Ai(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],s=[];if(!e)return s;for(const r of e)for(const e of r){const r=[e.x+o[0],e.y+o[1]];Ei(r,t,i,n),s.push(r)}return s}function Ii(e,t,i,r){const n=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],s=[];if(!e)return s;for(const i of e){const e=[];for(const r of i){const i=[r.x+o[0],r.y+o[1]];mi(t,i),e.push(i)}s.push(e)}if(t[2]-t[0]<=n/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const r of e)Ei(r,t,i,n)}var a;return s}class zi{constructor(e,t){this.type=Dt,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ei(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new zi(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new zi(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new zi(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Mi(t.coordinates,r,n),s=Ai(e.geometry(),i,r,n);if(!gi(i,r))return!1;for(const e of s)if(!vi(e,o))return!1}if("MultiPolygon"===t.type){const o=ki(t.coordinates,r,n),s=Ai(e.geometry(),i,r,n);if(!gi(i,r))return!1;for(const e of s)if(!xi(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const o=Mi(t.coordinates,r,n),s=Ii(e.geometry(),i,r,n);if(!gi(i,r))return!1;for(const e of s)if(!Si(e,o))return!1}if("MultiPolygon"===t.type){const o=ki(t.coordinates,r,n),s=Ii(e.geometry(),i,r,n);if(!gi(i,r))return!1;for(const e of s)if(!Ci(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Pi(e){if(e instanceof pi){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof zi)return!1;let t=!0;return e.eachChild((e=>{t&&!Pi(e)&&(t=!1)})),t}function Li(e){if(e instanceof pi&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Li(e)&&(t=!1)})),t}function Di(e,t){if(e instanceof pi&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!Di(e,t)&&(i=!1)})),i}class Ri{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Ri(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Bi{constructor(e,t=[],i,r=new It,n=[]){this.registry=e,this.path=t,this.key=t.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=n,this.expectedType=i}parse(e,t,i,r,n={}){return t?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new si(t,[e]):"coerce"===i?new ui(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const n=this.registry[r];if(n){let r=n.parse(e,this);if(!r)return null;if(this.expectedType){const e=this.expectedType,n=r.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else r=i(r,e,t.typeAnnotation||"coerce");else r=i(r,e,t.typeAnnotation||"assert")}if(!(r instanceof ri)&&"resolvedImage"!==r.type.kind&&Oi(r)){const e=new di;try{r=new ri(r.type,r.evaluate(e))}catch(e){return this.error(e.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Bi(this.registry,r,t||null,n,this.errors)}error(e,...t){const i=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new At(i,e))}checkSubtype(e,t){const i=Gt(e,t);return i&&this.error(i),i}}function Oi(e){if(e instanceof Ri)return Oi(e.boundExpression);if(e instanceof pi&&"error"===e.name)return!1;if(e instanceof fi)return!1;if(e instanceof zi)return!1;const t=e instanceof ui||e instanceof si;let i=!0;return e.eachChild((e=>{i=t?i&&Oi(e):i&&e instanceof ri})),!!i&&(Pi(e)&&Di(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function Fi(e,t){const i=e.length-1;let r,n,o=0,s=i,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],n=e[a+1],r<=t){if(a===i||t<n)return a;o=a+1}else{if(!(r>t))throw new ni("Input is not a number.");s=a-1}return 0}class ji{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Pt);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let i=1;i<e.length;i+=2){const o=1===i?-1/0:e[i],s=e[i+1],a=i,l=i+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,n);if(!c)return null;n=n||c.type,r.push([o,c])}return new ji(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);return i[Fi(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var $i=Ni;function Ni(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=i,this.p2y=r}function Ui(e,t,i){return e*(1-i)+t*i}Ni.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},Ni.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},Ni.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},Ni.prototype.solveCurveX=function(e,t){var i,r,n,o,s;for(void 0===t&&(t=1e-6),n=e,s=0;s<8;s++){if(o=this.sampleCurveX(n)-e,Math.abs(o)<t)return n;var a=this.sampleCurveDerivativeX(n);if(Math.abs(a)<1e-6)break;n-=o/a}if((n=e)<(i=0))return i;if(n>(r=1))return r;for(;i<r;){if(o=this.sampleCurveX(n),Math.abs(o-e)<t)return n;e>o?i=n:r=n,n=.5*(r-i)+i}return n},Ni.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Vi=Object.freeze({__proto__:null,number:Ui,color:function(e,t,i){return new Ht(Ui(e.r,t.r,i),Ui(e.g,t.g,i),Ui(e.b,t.b,i),Ui(e.a,t.a,i))},array:function(e,t,i){return e.map(((e,r)=>Ui(e,t[r],i)))}});const Gi=4/29,qi=6/29,Zi=3*qi*qi,Wi=Math.PI/180,Hi=180/Math.PI;function Xi(e){return e>.008856451679035631?Math.pow(e,1/3):e/Zi+Gi}function Ki(e){return e>qi?e*e*e:Zi*(e-Gi)}function Yi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ji(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Qi(e){const t=Ji(e.r),i=Ji(e.g),r=Ji(e.b),n=Xi((.4124564*t+.3575761*i+.1804375*r)/.95047),o=Xi((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*o-16,a:500*(n-o),b:200*(o-Xi((.0193339*t+.119192*i+.9503041*r)/1.08883)),alpha:e.a}}function er(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Ki(t),i=.95047*Ki(i),r=1.08883*Ki(r),new Ht(Yi(3.2404542*i-1.5371385*t-.4985314*r),Yi(-.969266*i+1.8760108*t+.041556*r),Yi(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function tr(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const ir={forward:Qi,reverse:er,interpolate:function(e,t,i){return{l:Ui(e.l,t.l,i),a:Ui(e.a,t.a,i),b:Ui(e.b,t.b,i),alpha:Ui(e.alpha,t.alpha,i)}}},rr={forward:function(e){const{l:t,a:i,b:r}=Qi(e),n=Math.atan2(r,i)*Hi;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Wi,i=e.c;return er({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:tr(e.h,t.h,i),c:Ui(e.c,t.c,i),l:Ui(e.l,t.l,i),alpha:Ui(e.alpha,t.alpha,i)}}};class nr{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=or(t,e.base,i,r);else if("linear"===e.name)n=or(t,1,i,r);else if("cubic-bezier"===e.name){const o=e.controlPoints;n=new $i(o[0],o[1],o[2],o[3]).solve(or(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...o]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Pt),!n)return null;const s=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=Rt:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const i=o[e],r=o[e+1],n=e+3,l=e+4;if("number"!=typeof i)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(s.length&&s[s.length-1][0]>=i)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,l,a);if(!c)return null;a=a||c.type,s.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new nr(a,i,r,n,s):t.error(`Type ${Ut(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const o=Fi(t,r),s=t[o],a=t[o+1],l=nr.interpolationFactor(this.interpolation,r,s,a),c=i[o].evaluate(e),u=i[o+1].evaluate(e);return"interpolate"===this.operator?Vi[this.type.kind.toLowerCase()](c,u,l):"interpolate-hcl"===this.operator?rr.reverse(rr.interpolate(rr.forward(c),rr.forward(u),l)):ir.reverse(ir.interpolate(ir.forward(c),ir.forward(u),l))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function or(e,t,i,r){const n=r-i,o=e-i;return 0===n?0:1===t?o/n:(Math.pow(t,o)-1)/(Math.pow(t,n)-1)}class sr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const r of e.slice(1)){const e=t.parse(r,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const o=r&&n.some((e=>Gt(r,e.type)));return new sr(o?Ot:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof Jt&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class ar{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let r=1;r<e.length-1;r+=2){const n=e[r];if("string"!=typeof n)return t.error(`Expected string, but found ${typeof n} instead.`,r);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",r);const o=t.parse(e[r+1],r+1);if(!o)return null;i.push([n,o])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new ar(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class lr{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Pt),r=t.parse(e[2],2,Nt(t.expectedType||Ot));if(!i||!r)return null;const n=r.type;return new lr(n.itemType,i,r)}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ni(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new ni(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new ni(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class cr{constructor(e,t){this.type=Dt,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ot),r=t.parse(e[2],2,Ot);return i&&r?qt(i.type,[Dt,Lt,Pt,zt,Ot])?new cr(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(i.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!Zt(t,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(ti(t))} instead.`);if(!Zt(i,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${Ut(ti(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ur{constructor(e,t,i){this.type=Pt,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ot),r=t.parse(e[2],2,Ot);if(!i||!r)return null;if(!qt(i.type,[Dt,Lt,Pt,zt,Ot]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Pt);return n?new ur(i,r,n):null}return new ur(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Zt(t,["boolean","string","number","null"]))throw new ni(`Expected first argument to be of type boolean, string, number or null, but found ${Ut(ti(t))} instead.`);if(!Zt(i,["string","array"]))throw new ni(`Expected second argument to be of type array or string, but found ${Ut(ti(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hr{constructor(e,t,i,r,n,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ti(e)))return null}else i=ti(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=o.length}const u=t.parse(l,s,r);if(!u)return null;r=r||u.type,o.push(u)}const s=t.parse(e[1],1,Ot);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,r);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(i,s.type)?null:new hr(i,r,s,n,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(ti(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const e of t){const t=r[this.cases[e]];void 0===t?(r[this.cases[e]]=i.length,i.push([this.cases[e],[e]])):i[t][1].push(e)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,r]of i)1===r.length?e.push(n(r[0])):e.push(r.map(n)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}}class dr{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let n=1;n<e.length-1;n+=2){const o=t.parse(e[n],n,Dt);if(!o)return null;const s=t.parse(e[n+1],n+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new dr(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class pr{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,Ot),r=t.parse(e[2],2,Pt);if(!i||!r)return null;if(!qt(i.type,[Nt(Ot),Lt,Ot]))return t.error(`Expected first argument to be of type array or string, but found ${Ut(i.type)} instead`);if(4===e.length){const n=t.parse(e[3],3,Pt);return n?new pr(i.type,i,r,n):null}return new pr(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Zt(t,["string","array"]))throw new ni(`Expected first argument to be of type array or string, but found ${Ut(ti(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function fr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function mr(e,t,i,r){return 0===r.compare(t,i)}function gr(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=Dt,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let o=t.parse(e[1],1,Ot);if(!o)return null;if(!fr(i,o.type))return t.concat(1).error(`"${i}" comparisons are not supported for type '${Ut(o.type)}'.`);let s=t.parse(e[2],2,Ot);if(!s)return null;if(!fr(i,s.type))return t.concat(2).error(`"${i}" comparisons are not supported for type '${Ut(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${Ut(o.type)}' and '${Ut(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new si(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new si(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Ft),!a)return null}return new n(o,s,a)}evaluate(n){const o=this.lhs.evaluate(n),s=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=ti(o),i=ti(s);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new ni(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${i.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const e=ti(o),i=ti(s);if("string"!==e.kind||"string"!==i.kind)return t(n,o,s)}return this.collator?i(n,o,s,this.collator.evaluate(n)):t(n,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const yr=gr("==",(function(e,t,i){return t===i}),mr),_r=gr("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!mr(0,t,i,r)})),vr=gr("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),xr=gr(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),br=gr("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),wr=gr(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class Tr{constructor(e,t,i,r,n){this.type=Lt,this.number=e,this.locale=t,this.currency=i,this.minFractionDigits=r,this.maxFractionDigits=n}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Pt);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,Lt),!n))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,Lt),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,Pt),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=t.parse(r["max-fraction-digits"],1,Pt),!a)?null:new Tr(i,n,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Sr{constructor(e){this.type=Pt,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error(`Expected argument of type string or array, but found ${Ut(i.type)} instead.`):new Sr(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new ni(`Expected value to be of type string or array, but found ${Ut(ti(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Cr={"==":yr,"!=":_r,">":xr,"<":vr,">=":wr,"<=":br,array:si,at:lr,boolean:si,case:dr,coalesce:sr,collator:fi,format:ai,image:li,in:cr,"index-of":ur,interpolate:nr,"interpolate-hcl":nr,"interpolate-lab":nr,length:Sr,let:ar,literal:ri,match:hr,number:si,"number-format":Tr,object:si,slice:pr,step:ji,string:si,"to-boolean":ui,"to-color":ui,"to-number":ui,"to-string":ui,var:Ri,within:zi};function Mr(e,[t,i,r,n]){t=t.evaluate(e),i=i.evaluate(e),r=r.evaluate(e);const o=n?n.evaluate(e):1,s=Qt(t,i,r,o);if(s)throw new ni(s);return new Ht(t/255*o,i/255*o,r/255*o,o)}function kr(e,t){return e in t}function Er(e,t){const i=t[e];return void 0===i?null:i}function Ar(e){return{type:e}}function Ir(e){return{result:"success",value:e}}function zr(e){return{result:"error",value:e}}function Pr(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Lr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Dr(e){return!!e.expression&&e.expression.interpolated}function Rr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Br(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}pi.register(Cr,{error:[{kind:"error"},[Lt],(e,[t])=>{throw new ni(t.evaluate(e))}],typeof:[Lt,[Ot],(e,[t])=>Ut(ti(t.evaluate(e)))],"to-rgba":[Nt(Pt,4),[Rt],(e,[t])=>t.evaluate(e).toArray()],rgb:[Rt,[Pt,Pt,Pt],Mr],rgba:[Rt,[Pt,Pt,Pt,Pt],Mr],has:{type:Dt,overloads:[[[Lt],(e,[t])=>kr(t.evaluate(e),e.properties())],[[Lt,Bt],(e,[t,i])=>kr(t.evaluate(e),i.evaluate(e))]]},get:{type:Ot,overloads:[[[Lt],(e,[t])=>Er(t.evaluate(e),e.properties())],[[Lt,Bt],(e,[t,i])=>Er(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Ot,[Lt],(e,[t])=>Er(t.evaluate(e),e.featureState||{})],properties:[Bt,[],e=>e.properties()],"geometry-type":[Lt,[],e=>e.geometryType()],id:[Ot,[],e=>e.id()],zoom:[Pt,[],e=>e.globals.zoom],pitch:[Pt,[],e=>e.globals.pitch||0],"distance-from-center":[Pt,[],e=>e.distanceFromCenter()],"heatmap-density":[Pt,[],e=>e.globals.heatmapDensity||0],"line-progress":[Pt,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[Pt,[],e=>e.globals.skyRadialProgress||0],accumulated:[Ot,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Pt,Ar(Pt),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Pt,Ar(Pt),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Pt,overloads:[[[Pt,Pt],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[Pt],(e,[t])=>-t.evaluate(e)]]},"/":[Pt,[Pt,Pt],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[Pt,[Pt,Pt],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[Pt,[Pt],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[Pt,[Pt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[Pt,[Pt],(e,[t])=>Math.log(t.evaluate(e))],log2:[Pt,[Pt],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[Pt,[Pt],(e,[t])=>Math.sin(t.evaluate(e))],cos:[Pt,[Pt],(e,[t])=>Math.cos(t.evaluate(e))],tan:[Pt,[Pt],(e,[t])=>Math.tan(t.evaluate(e))],asin:[Pt,[Pt],(e,[t])=>Math.asin(t.evaluate(e))],acos:[Pt,[Pt],(e,[t])=>Math.acos(t.evaluate(e))],atan:[Pt,[Pt],(e,[t])=>Math.atan(t.evaluate(e))],min:[Pt,Ar(Pt),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Pt,Ar(Pt),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Pt,[Pt],(e,[t])=>Math.abs(t.evaluate(e))],round:[Pt,[Pt],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[Pt,[Pt],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[Pt,[Pt],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Dt,[Lt,Ot],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Dt,[Ot],(e,[t])=>e.id()===t.value],"filter-type-==":[Dt,[Lt],(e,[t])=>e.geometryType()===t.value],"filter-<":[Dt,[Lt,Ot],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<n}],"filter-id-<":[Dt,[Ot],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<r}],"filter->":[Dt,[Lt,Ot],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>n}],"filter-id->":[Dt,[Ot],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>r}],"filter-<=":[Dt,[Lt,Ot],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r<=n}],"filter-id-<=":[Dt,[Ot],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i<=r}],"filter->=":[Dt,[Lt,Ot],(e,[t,i])=>{const r=e.properties()[t.value],n=i.value;return typeof r==typeof n&&r>=n}],"filter-id->=":[Dt,[Ot],(e,[t])=>{const i=e.id(),r=t.value;return typeof i==typeof r&&i>=r}],"filter-has":[Dt,[Ot],(e,[t])=>t.value in e.properties()],"filter-has-id":[Dt,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Dt,[Nt(Lt)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Dt,[Nt(Ot)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Dt,[Lt,Nt(Ot)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Dt,[Lt,Nt(Ot)],(e,[t,i])=>function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[Ar(Dt),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[Ar(Dt),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Dt,[Dt],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Dt,[Lt],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Lt,[Lt],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Lt,[Lt],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Lt,Ar(Ot),(e,t)=>t.map((t=>ii(t.evaluate(e)))).join("")],"resolved-locale":[Lt,[Ft],(e,[t])=>t.evaluate(e).resolvedLocale()]});class Or{constructor(e,t){var i;this.expression=e,this._warningHistory={},this._evaluator=new di,this._defaultValue=t?"color"===(i=t).type&&Br(i.default)?new Ht(0,0,0,0):"color"===i.type?Ht.parse(i.default)||null:void 0===i.default?null:i.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,o,s,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,o,s,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new ni(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Fr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Cr}function jr(e,t){const i=new Bi(Cr,[],t?function(e){const t={color:Rt,string:Lt,number:Pt,enum:Lt,boolean:Dt,formatted:jt,resolvedImage:$t};if("array"===e.type)return Nt(t[e.value]||Ot,e.length);return t[e.type]}(t):void 0),r=i.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Ir(new Or(r,t)):zr(i.errors)}class $r{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Li(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}}class Nr{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Li(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,o)}evaluate(e,t,i,r,n,o){return this._styleExpression.evaluate(e,t,i,r,n,o)}interpolationFactor(e,t,i){return this.interpolationType?nr.interpolationFactor(this.interpolationType,e,t,i):0}}function Ur(e,t){if("error"===(e=jr(e,t)).result)return e;const i=e.value.expression,r=Pi(i);if(!r&&!Pr(t))return zr([new At("","data expressions not supported")]);const n=Di(i,["zoom","pitch","distance-from-center"]);if(!n&&!Lr(t))return zr([new At("","zoom expressions not supported")]);const o=Vr(i);if(!o&&!n)return zr([new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof At)return zr([o]);if(o instanceof nr&&!Dr(t))return zr([new At("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Ir(new $r(r?"constant":"source",e.value));const s=o instanceof nr?o.interpolation:void 0;return Ir(new Nr(r?"camera":"composite",e.value,o.labels,s))}function Vr(e){let t=null;if(e instanceof ar)t=Vr(e.result);else if(e instanceof sr){for(const i of e.args)if(t=Vr(i),t)break}else(e instanceof ji||e instanceof nr)&&e.input instanceof pi&&"zoom"===e.input.name&&(t=e);return t instanceof At||e.eachChild((e=>{const i=Vr(e);i instanceof At?t=i:!t&&i?t=new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&i&&t!==i&&(t=new At("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Gr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function qr(e){if(Array.isArray(e))return e.map(qr);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=qr(e[i]);return t}return Gr(e)}function Zr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Zr(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}class Wr{constructor(e,t,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}class Hr{constructor(e){this.error=e,this.message=e.message;const t=e.message.match(/line (\d+)/);this.line=t?parseInt(t[1],10):0}}function Xr(e){const t=e.key,i=e.value,r=e.valueSpec||{},n=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const l=Rr(i);if("object"!==l)return[new Wr(t,i,`object expected, ${l} found`)];for(const e in i){const l=e.split(".")[0],c=r[l]||r["*"];let u;n[l]?u=n[l]:r[l]?u=cn:n["*"]?u=n["*"]:r["*"]&&(u=cn),u?a=a.concat(u({key:(t?`${t}.`:t)+e,value:i[e],valueSpec:c,style:o,styleSpec:s,object:i,objectKey:e},i)):a.push(new Wr(t,i[e],`unknown property "${e}"`))}for(const e in r)n[e]||r[e].required&&void 0===r[e].default&&void 0===i[e]&&a.push(new Wr(t,i,`missing required property "${e}"`));return a}function Kr(e){const t=e.value,i=e.valueSpec,r=e.style,n=e.styleSpec,o=e.key,s=e.arrayElementValidator||cn;if("array"!==Rr(t))return[new Wr(o,t,`array expected, ${Rr(t)} found`)];if(i.length&&t.length!==i.length)return[new Wr(o,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Wr(o,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let a={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};n.$version<7&&(a.function=i.function),"object"===Rr(i.value)&&(a=i.value);let l=[];for(let e=0;e<t.length;e++)l=l.concat(s({array:t,arrayIndex:e,value:t[e],valueSpec:a,style:r,styleSpec:n,key:`${o}[${e}]`}));return l}function Yr(e){const t=e.key,i=e.value,r=e.valueSpec;let n=Rr(i);if("number"===n&&i!=i&&(n="NaN"),"number"!==n)return[new Wr(t,i,`number expected, ${n} found`)];if("minimum"in r){let n=r.minimum;if("array"===Rr(r.minimum)){const t=e.arrayIndex;n=r.minimum[t]}if(i<n)return[new Wr(t,i,`${i} is less than the minimum value ${n}`)]}if("maximum"in r){let n=r.maximum;if("array"===Rr(r.maximum)){const t=e.arrayIndex;n=r.maximum[t]}if(i>n)return[new Wr(t,i,`${i} is greater than the maximum value ${n}`)]}return[]}function Jr(e){const t=e.valueSpec,i=Gr(e.value.type);let r,n,o,s={};const a="categorical"!==i&&void 0===e.value.property,l=!a,c="array"===Rr(e.value.stops)&&"array"===Rr(e.value.stops[0])&&"object"===Rr(e.value.stops[0][0]),u=Xr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===i)return[new Wr(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const r=e.value;t=t.concat(Kr({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Rr(r)&&0===r.length&&t.push(new Wr(e.key,r,"array must have at least one stop"));return t},default:function(e){return cn({key:e.key,value:e.value,valueSpec:t,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===i&&a&&u.push(new Wr(e.key,e.value,'missing required property "property"')),"identity"===i||e.value.stops||u.push(new Wr(e.key,e.value,'missing required property "stops"')),"exponential"===i&&e.valueSpec.expression&&!Dr(e.valueSpec)&&u.push(new Wr(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Pr(e.valueSpec)?u.push(new Wr(e.key,e.value,"property functions not supported")):a&&!Lr(e.valueSpec)&&u.push(new Wr(e.key,e.value,"zoom functions not supported"))),"categorical"!==i&&!c||void 0!==e.value.property||u.push(new Wr(e.key,e.value,'"property" property is required')),u;function h(e){let i=[];const r=e.value,a=e.key;if("array"!==Rr(r))return[new Wr(a,r,`array expected, ${Rr(r)} found`)];if(2!==r.length)return[new Wr(a,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==Rr(r[0]))return[new Wr(a,r,`object expected, ${Rr(r[0])} found`)];if(void 0===r[0].zoom)return[new Wr(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new Wr(a,r,"object stop key must have value")];const t=Gr(r[0].zoom);if("number"!=typeof t)return[new Wr(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>t)return[new Wr(a,r[0].zoom,"stop zoom values must appear in ascending order")];t!==o&&(o=t,n=void 0,s={}),i=i.concat(Xr({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Yr,value:d}}))}else i=i.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return Fr(qr(r[1]))?i.concat([new Wr(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):i.concat(cn({key:`${a}[1]`,value:r[1],valueSpec:t,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=Rr(e.value),l=Gr(e.value),c=null!==e.value?e.value:o;if(r){if(a!==r)return[new Wr(e.key,c,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new Wr(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==i){let r=`number expected, ${a} found`;return Pr(t)&&void 0===i&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wr(e.key,c,r)]}return"categorical"!==i||"number"!==a||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==i&&"number"===a&&"number"==typeof l&&"number"==typeof n&&void 0!==n&&l<n?[new Wr(e.key,c,"stop domain values must appear in ascending order")]:(n=l,"categorical"===i&&l in s?[new Wr(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new Wr(e.key,c,`integer expected, found ${String(l)}`)]}}function Qr(e){const t=("property"===e.expressionContext?Ur:jr)(qr(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Wr(`${e.key}${t.key}`,e.value,t.message)));const i=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!i.outputDefined())return[new Wr(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!Li(i))return[new Wr(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return en(i,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Di(i,["zoom","feature-state"]))return[new Wr(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!Pi(i))return[new Wr(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function en(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const e of t.valueSpec.expression.parameters)i.delete(e);if(0===i.size)return[];const r=[];return e instanceof pi&&i.has(e.name)?[new Wr(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild((e=>{r.push(...en(e,t))})),r)}function tn(e){const t=e.key,i=e.value,r=e.valueSpec,n=[];return Array.isArray(r.values)?-1===r.values.indexOf(Gr(i))&&n.push(new Wr(t,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Gr(i))&&n.push(new Wr(t,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),n}function rn(e){if(Zr(qr(e.value))){const t=e.layerType||"fill";return Qr(Et({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${t}`]}))}return nn(e)}function nn(e){const t=e.value,i=e.key;if("array"!==Rr(t))return[new Wr(i,t,`array expected, ${Rr(t)} found`)];const r=e.styleSpec;let n,o=[];if(t.length<1)return[new Wr(i,t,"filter array must have at least 1 element")];switch(o=o.concat(tn({key:`${i}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),Gr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Gr(t[1])&&o.push(new Wr(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new Wr(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(n=Rr(t[1]),"string"!==n&&o.push(new Wr(`${i}[1]`,t[1],`string expected, ${n} found`)));for(let s=2;s<t.length;s++)n=Rr(t[s]),"$type"===Gr(t[1])?o=o.concat(tn({key:`${i}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Wr(`${i}[${s}]`,t[s],`string, number, or boolean expected, ${n} found`));break;case"any":case"all":case"none":for(let r=1;r<t.length;r++)o=o.concat(nn({key:`${i}[${r}]`,value:t[r],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=Rr(t[1]),2!==t.length?o.push(new Wr(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==n&&o.push(new Wr(`${i}[1]`,t[1],`string expected, ${n} found`));break;case"within":n=Rr(t[1]),2!==t.length?o.push(new Wr(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):"object"!==n&&o.push(new Wr(`${i}[1]`,t[1],`object expected, ${n} found`))}return o}function on(e,t){const i=e.key,r=e.style,n=e.styleSpec,o=e.value,s=e.objectKey,a=n[`${t}_${e.layerType}`];if(!a)return[];const l=s.match(/^(.*)-transition$/);if("paint"===t&&l&&a[l[1]]&&a[l[1]].transition)return cn({key:i,value:o,valueSpec:n.transition,style:r,styleSpec:n});const c=e.valueSpec||a[s];if(!c)return[new Wr(i,o,`unknown property "${s}"`)];let u;if("string"===Rr(o)&&Pr(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Wr(i,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===e.layerType&&("text-field"===s&&r&&!r.glyphs&&h.push(new Wr(i,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&Br(qr(o))&&"identity"===Gr(o.type)&&h.push(new Wr(i,o,'"text-font" does not support identity functions'))),h.concat(cn({key:e.key,value:o,valueSpec:c,style:r,styleSpec:n,expressionContext:"property",propertyType:t,propertyKey:s}))}function sn(e){const t=e.value,i=e.key,r=Rr(t);return"string"!==r?[new Wr(i,t,`string expected, ${r} found`)]:[]}const an={promoteId:function({key:e,value:t}){if("string"===Rr(t))return sn({key:e,value:t});{const i=[];for(const r in t)i.push(...sn({key:`${e}.${r}`,value:t[r]}));return i}}};const ln={"*":()=>[],array:Kr,boolean:function(e){const t=e.value,i=e.key,r=Rr(t);return"boolean"!==r?[new Wr(i,t,`boolean expected, ${r} found`)]:[]},number:Yr,color:function(e){const t=e.key,i=e.value,r=Rr(i);return"string"!==r?[new Wr(t,i,`color expected, ${r} found`)]:null===Wt.parseCSSColor(i)?[new Wr(t,i,`color expected, "${i}" found`)]:[]},enum:tn,filter:rn,function:Jr,layer:function(e){let t=[];const i=e.value,r=e.key,n=e.style,o=e.styleSpec;i.type||i.ref||t.push(new Wr(r,i,'either "type" or "ref" is required'));let s=Gr(i.type);const a=Gr(i.ref);if(i.id){const o=Gr(i.id);for(let s=0;s<e.arrayIndex;s++){const e=n.layers[s];Gr(e.id)===o&&t.push(new Wr(r,i.id,`duplicate layer id "${i.id}", previously used at line ${e.id.__line__}`))}}if("ref"in i){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in i&&t.push(new Wr(r,i[e],`"${e}" is prohibited for ref layers`))})),n.layers.forEach((t=>{Gr(t.id)===a&&(e=t)})),e?e.ref?t.push(new Wr(r,i.ref,"ref cannot reference another ref layer")):s=Gr(e.type):"string"==typeof a&&t.push(new Wr(r,i.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(i.source){const e=n.sources&&n.sources[i.source],o=e&&Gr(e.type);e?"vector"===o&&"raster"===s?t.push(new Wr(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===o&&"raster"!==s?t.push(new Wr(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==o||i["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new Wr(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!i.paint||!i.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new Wr(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Wr(r,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Wr(r,i.source,`source "${i.source}" not found`))}else t.push(new Wr(r,i,'missing required property "source"'));return t=t.concat(Xr({key:r,value:i,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>cn({key:`${r}.type`,value:i.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:e=>rn(Et({layerType:s},e)),layout:e=>Xr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>function(e){return on(e,"layout")}(Et({layerType:s},e))}}),paint:e=>Xr({layer:i,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>function(e){return on(e,"paint")}(Et({layerType:s},e))}})}})),t},object:Xr,source:function(e){const t=e.value,i=e.key,r=e.styleSpec,n=e.style;if(!t.type)return[new Wr(i,t,'"type" is required')];const o=Gr(t.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=Xr({key:i,value:t,valueSpec:r[`source_${o.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:an}),s;case"geojson":if(s=Xr({key:i,value:t,valueSpec:r.source_geojson,style:n,styleSpec:r,objectElementValidators:an}),t.cluster)for(const e in t.clusterProperties){const[r,n]=t.clusterProperties[e],o="string"==typeof r?[r,["accumulated"],["get",e]]:r;s.push(...Qr({key:`${i}.${e}.map`,value:n,expressionContext:"cluster-map"})),s.push(...Qr({key:`${i}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return Xr({key:i,value:t,valueSpec:r.source_video,style:n,styleSpec:r});case"image":return Xr({key:i,value:t,valueSpec:r.source_image,style:n,styleSpec:r});case"canvas":return[new Wr(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tn({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:r})}},light:function(e){const t=e.value,i=e.styleSpec,r=i.light,n=e.style;let o=[];const s=Rr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Wr("light",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=s&&r[s[1]]&&r[s[1]].transition?o.concat(cn({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i})):r[e]?o.concat(cn({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i})):o.concat([new Wr(e,t[e],`unknown property "${e}"`)])}return o},terrain:function(e){const t=e.value,i=e.key,r=e.style,n=e.styleSpec,o=n.terrain;let s=[];const a=Rr(t);if(void 0===t)return s;if("object"!==a)return s=s.concat([new Wr("terrain",t,`object expected, ${a} found`)]),s;for(const e in t){const i=e.match(/^(.*)-transition$/);s=i&&o[i[1]]&&o[i[1]].transition?s.concat(cn({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n})):o[e]?s.concat(cn({key:e,value:t[e],valueSpec:o[e],style:r,styleSpec:n})):s.concat([new Wr(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=r.sources&&r.sources[t.source],n=e&&Gr(e.type);e?"raster-dem"!==n&&s.push(new Wr(i,t.source,`terrain cannot be used with a source of type ${String(n)}, it only be used with a "raster-dem" source type`)):s.push(new Wr(i,t.source,`source "${t.source}" not found`))}else s.push(new Wr(i,t,'terrain is missing required property "source"'));return s},fog:function(e){const t=e.value,i=e.style,r=e.styleSpec,n=r.fog;let o=[];const s=Rr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Wr("fog",t,`object expected, ${s} found`)]),o;for(const e in t){const s=e.match(/^(.*)-transition$/);o=s&&n[s[1]]&&n[s[1]].transition?o.concat(cn({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r})):n[e]?o.concat(cn({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r})):o.concat([new Wr(e,t[e],`unknown property "${e}"`)])}return o},string:sn,formatted:function(e){return 0===sn(e).length?[]:Qr(e)},resolvedImage:function(e){return 0===sn(e).length?[]:Qr(e)},projection:function(e){const t=e.value,i=e.styleSpec,r=i.projection,n=e.style;let o=[];const s=Rr(t);if("object"===s)for(const e in t)o=o.concat(cn({key:e,value:t[e],valueSpec:r[e],style:n,styleSpec:i}));else"string"!==s&&(o=o.concat([new Wr("projection",t,`object or string expected, ${s} found`)]));return o}};function cn(e){const t=e.value,i=e.valueSpec,r=e.styleSpec;if(i.expression&&Br(Gr(t)))return Jr(e);if(i.expression&&Fr(qr(t)))return Qr(e);if(i.type&&ln[i.type])return ln[i.type](e);return Xr(Et({},e,{valueSpec:i.type?r[i.type]:i}))}function un(e){const t=e.value,i=e.key,r=sn(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Wr(i,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Wr(i,t,'"glyphs" url must include a "{range}" token'))),r}var hn=Tt((function(e,t){var i=function(){var e=function(e,t,i,r){for(i=i||{},r=e.length;r--;i[e[r]]=t);return i},t=[1,12],i=[1,13],r=[1,9],n=[1,10],o=[1,11],s=[1,14],a=[1,15],l=[14,18,22,24],c=[18,22],u=[22,24],h={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,t,i,r,n,o,s){var a=o.length-1;switch(n){case 1:this.$=new String(e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(e),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=o[a-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[a-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[a-2],o[a]];break;case 16:this.$={},this.$[o[a][0]]=o[a][1];break;case 17:this.$=o[a-2],o[a-2][o[a][0]]=o[a][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[a]];break;case 21:this.$=o[a-2],o[a-2].push(o[a])}},table:[{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,12:1,13:2,15:7,16:8,17:s,23:a},{1:[3]},{14:[1,16]},e(l,[2,7]),e(l,[2,8]),e(l,[2,9]),e(l,[2,10]),e(l,[2,11]),e(l,[2,12]),e(l,[2,3]),e(l,[2,4]),e(l,[2,5]),e([14,18,21,22,24],[2,1]),e(l,[2,2]),{3:20,4:t,18:[1,17],19:18,20:19},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:23,15:7,16:8,17:s,23:a,24:[1,21],25:22},{1:[2,6]},e(l,[2,13]),{18:[1,24],22:[1,25]},e(c,[2,16]),{21:[1,26]},e(l,[2,18]),{22:[1,28],24:[1,27]},e(u,[2,20]),e(l,[2,14]),{3:20,4:t,20:29},{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:30,15:7,16:8,17:s,23:a},e(l,[2,19]),{3:5,4:t,5:6,6:i,7:3,8:r,9:4,10:n,11:o,13:31,15:7,16:8,17:s,23:a},e(c,[2,17]),e(c,[2,15]),e(u,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){var t=this,i=[0],r=[null],n=[],o=this.table,s="",a=0,l=0,c=2,u=1,h=n.slice.call(arguments,1),d=Object.create(this.lexer),p={yy:{}};for(var f in this.yy)Object.prototype.hasOwnProperty.call(this.yy,f)&&(p.yy[f]=this.yy[f]);d.setInput(e,p.yy),p.yy.lexer=d,p.yy.parser=this,void 0===d.yylloc&&(d.yylloc={});var m=d.yylloc;n.push(m);var g=d.options&&d.options.ranges;function y(){var e;return"number"!=typeof(e=d.lex()||u)&&(e=t.symbols_[e]||e),e}"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var _,v,x,b,w,T,S,C,M={};;){if(v=i[i.length-1],this.defaultActions[v]?x=this.defaultActions[v]:(null==_&&(_=y()),x=o[v]&&o[v][_]),void 0===x||!x.length||!x[0]){var k="";for(w in C=[],o[v])this.terminals_[w]&&w>c&&C.push("'"+this.terminals_[w]+"'");k=d.showPosition?"Parse error on line "+(a+1)+":\n"+d.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[_]||_)+"'":"Parse error on line "+(a+1)+": Unexpected "+(_==u?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(k,{text:d.match,token:this.terminals_[_]||_,line:d.yylineno,loc:m,expected:C})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+_);switch(x[0]){case 1:i.push(_),r.push(d.yytext),n.push(d.yylloc),i.push(x[1]),_=null,l=d.yyleng,s=d.yytext,a=d.yylineno,m=d.yylloc;break;case 2:if(T=this.productions_[x[1]][1],M.$=r[r.length-T],M._$={first_line:n[n.length-(T||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(T||1)].first_column,last_column:n[n.length-1].last_column},g&&(M._$.range=[n[n.length-(T||1)].range[0],n[n.length-1].range[1]]),void 0!==(b=this.performAction.apply(M,[s,l,a,p.yy,x[1],r,n].concat(h))))return b;T&&(i=i.slice(0,-1*T*2),r=r.slice(0,-1*T),n=n.slice(0,-1*T)),i.push(this.productions_[x[1]][0]),r.push(M.$),n.push(M._$),S=o[i[i.length-2]][i[i.length-1]],i.push(S);break;case 3:return!0}}return!0}},d={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var n=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===r.length?this.yylloc.first_column:0)+r[r.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var i,r,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],i=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var o in n)this[o]=n[o];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var n=this._currentRules(),o=0;o<n.length;o++)if((i=this._input.match(this.rules[n[o]]))&&(!t||i[0].length>t[0].length)){if(t=i,r=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(i,n[o])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,n[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,i,r){switch(i){case 0:break;case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};function p(){this.yy={}}return h.lexer=d,p.prototype=h,h.Parser=p,new p}();t.parser=i,t.Parser=i.Parser,t.parse=function(){return i.parse.apply(i,arguments)}}));function dn(e,t=bt){let i=e;try{i=function(e){if(e instanceof String||"string"==typeof e||e instanceof Buffer)try{return hn.parse(e.toString())}catch(e){throw new Hr(e)}return e}(i)}catch(e){return[e]}return function(e,t=bt){return i=cn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:un,"*":()=>[]}}),i.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0));var i}(i,t)}let pn,fn={};Ke.subscribe((e=>fn=e)),Je.subscribe((e=>pn=e));const mn=(e,t)=>{e.once("styledata",(()=>{const i=()=>{e.isStyleLoaded()?t():setTimeout(i,150)};i()}))},gn=(e,t,i)=>{if(!fn.puck)return;const r={type:"Feature",geometry:{type:"Point",coordinates:t}};e.getSource(Re)&&e.getSource(Re).setData(r),e.getLayer(Re)&&e.setLayoutProperty(Re,"icon-rotate",i)},yn=(e,t,i,r)=>{const n=fn[i];if(!fn[i])return void console.warn(`${i} is not loaded.`);if(!e.hasImage(i)){const{url:t}=n;e.loadImage(t,((t,r)=>{if(t)throw t;e.addImage(i,r)}))}e.getSource(i)||e.addSource(i,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:t}}});e.getLayer(i)||e.addLayer({id:i,type:"symbol",source:i,layout:{"icon-image":i,"icon-allow-overlap":!0,...r}})},_n=(e,t)=>{e.removeLayer(t),e.removeSource(t)},vn=e=>{!!e.getSource(Fe)||e.addSource(Fe,{type:"geojson",data:{type:"FeatureCollection",features:[]}});if(!!!e.getLayer("route-line-internal-mock-layer_0")){let t=e.getStyle().layers.find((e=>"symbol"===e.type&&e?.layout?.["text-field"]))?.id;pn.forEach((i=>{!!!e.getLayer(i.id)&&e.addLayer(i,t),t=i.id}))}},xn=(e,t,i,r={fitToBounds:!0})=>{if(!i)return;const{fitToBounds:n}=r,{coordinates:o}=i,s={type:"Feature",geometry:{type:"LineString",coordinates:o}};e.getSource(Fe).setData(s);if(n){const i=new("maplibre-gl"===t?vt:gt).LngLatBounds(o[0],o[o.length-1]);for(const e of o)i.extend(e);e.setPitch(0),e.fitBounds(i,{padding:20})}};function bn(e){let t;return{c(){t=w("div"),A(t,"id","map-viewer"),A(t,"class","map svelte-16q73l0")},m(e,i){v(e,t,i)},p:i,i:i,o:i,d(e){e&&x(t)}}}function wn(e,t,i){let r,n,{id:o}=t,{url:s}=t,{mapRenderer:a}=t;Ge.subscribe((e=>({mapboxGlAccessToken:n}=e)));let l,c,u,h;Ze.subscribe((e=>i(3,({response:l}=e),l))),He.subscribe((e=>c=e)),Je.subscribe((e=>i(4,u=e))),Ke.subscribe((e=>e));const d=Me.throttle((()=>{if(!h)return;const e=h.getBearing(),t=h.getPitch(),i=h.getZoom(),r={bearing:e,center:h.getCenter(),pitch:t,zoom:i};He.set(r)}),250);var p;return j((async()=>{await(async()=>{"maplibre-gl"===a?(await Promise.resolve().then((function(){return i_})),r=await Promise.resolve().then((function(){return xt}))):(await Promise.resolve().then((function(){return r_})),r=await Promise.resolve().then((function(){return yt})),r.accessToken=n)})();i(5,h=new r.Map({id:o,container:"map-viewer",style:s,preserveDrawingBuffer:!0,...c})),Xe.set(h),h.once("styledata",(()=>{mn(h,(()=>{et.set({loading:!0,helperText:"Loading assets"}),ft(h).then((e=>{Ke.update((t=>Object.keys(t).reduce(((t,i)=>(t[i]=e.find((e=>e.name===i))??null,t)),{}))),et.set({loading:!1})})).catch((e=>{et.set({loading:!1}),console.error(e)})),vn(h),xn(h,a,l)}))})),h.on("move",(()=>{d()}))})),p=()=>{h&&h.remove()},F().$$.on_destroy.push(p),e.$$set=e=>{"id"in e&&i(0,o=e.id),"url"in e&&i(1,s=e.url),"mapRenderer"in e&&i(2,a=e.mapRenderer)},e.$$.update=()=>{if(62&e.$$.dirty&&h&&s){let e,t,i,r;try{const{layers:n,sources:o}=h.getStyle();e=n.find((e=>e.id===Re)),t=n.find((e=>"destination-pin"===e.id)),i=o.puck,r=o["destination-pin"]}catch(e){}if("string"==typeof s){h.setStyle(s);const n=()=>{vn(h),xn(h,a,l,{fitToBounds:!1}),t&&!h.getLayer("destination-pin")&&(h.addSource("destination-pin",r),h.addLayer(t)),e&&!h.getLayer(Re)&&(h.addSource(Re,i),h.addLayer(e))};mn(h,n)}else{const n=s,o=n.layers.find((e=>e.id.includes("route-line-internal-mock-layer"))),a=n.layers.findIndex((e=>"symbol"===e.type&&e?.layout?.["text-field"]))||n.layers.length;!o&&n.layers.splice(a,0,...u);const c=n.layers.find((e=>"destination-pin"===e.id)),d=n.layers.find((e=>e.id===Re));t&&!c&&(n.sources["destination-pin"]=r,n.layers.push(t)),e&&!d&&(n.sources.puck=i,n.layers.push(e));const{coordinates:p}=l,f={type:"Feature",geometry:{type:"LineString",coordinates:p}};let m=geometries?{type:"geojson",data:f}:je;n.sources[Fe]=m,h.setStyle(n)}}32&e.$$.dirty&&h&&h.once("render",(()=>{const e=document.getElementById("map-viewer");if(e){new ResizeObserver((()=>{h.resize({resize:!0})})).observe(e)}})),44&e.$$.dirty&&h&&h.isStyleLoaded()&&l&&xn(h,a,l,{fitToBounds:!0})},[o,s,a,l,u,h]}class Tn extends ve{constructor(e){super(),_e(this,e,wn,bn,l,{id:0,url:1,mapRenderer:2})}}function Sn(e){let t,i;return t=new ot({props:{height:e[1],width:e[0],children:Tn,childProps:{id:e[2]?.id,url:e[2]?.url,mapRenderer:e[2]?.renderer??e[2]?.type}}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r={};2&i&&(r.height=e[1]),1&i&&(r.width=e[0]),4&i&&(r.childProps={id:e[2]?.id,url:e[2]?.url,mapRenderer:e[2]?.renderer??e[2]?.type}),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Cn(e){let t,r,n,o=e[2]?.renderer??e[2]?.type,s=Sn(e);return{c(){t=w("div"),r=w("div"),s.c(),A(r,"class","device-container svelte-l666nc"),A(t,"class","display-area svelte-l666nc")},m(e,i){v(e,t,i),_(t,r),s.m(r,null),n=!0},p(e,[t]){4&t&&l(o,o=e[2]?.renderer??e[2]?.type)?(oe(),le(s,1,1,i),se(),s=Sn(e),s.c(),ae(s,1),s.m(r,null)):s.p(e,t)},i(e){n||(ae(s),n=!0)},o(e){le(s),n=!1},d(e){e&&x(t),s.d(e)}}}function Mn(e,t,i){let r,n;Ge.subscribe((e=>{({devices:r}=e),({styles:n}=e)}));let o=r[0].width,s=r[0].height;Qe.subscribe((e=>{e&&(i(0,o=e.width),i(1,s=e.height))}));let a=n[0];return Ye.subscribe((e=>{e&&i(2,a=e)})),[o,s,a]}class kn extends ve{constructor(e){super(),_e(this,e,Mn,Cn,l,{})}}function En(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function An(e){let t,n,o=e[1]&&En(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M22 16L12 26 10.6 24.6 19.2 16 10.6 7.4 12 6z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=En(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function In(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var zn=class extends ve{constructor(e){super(),_e(this,e,In,An,l,{size:0,title:1})}};function Pn(e,t,i){const r=e.slice();return r[2]=t[i].width,r}function Ln(e){let t,i,n,o,a=[e[4],{style:i="width: "+e[2]+";"+e[4].style}],l={};for(let e=0;e<a.length;e+=1)l=r(l,a[e]);return{c(){t=w("p"),I(t,l),R(t,"bx--skeleton__text",!0),R(t,"bx--skeleton__heading",e[0])},m(i,r){v(i,t,r),n||(o=[k(t,"click",e[12]),k(t,"mouseover",e[13]),k(t,"mouseenter",e[14]),k(t,"mouseleave",e[15])],n=!0)},p(e,r){I(t,l=de(a,[16&r&&e[4],20&r&&i!==(i="width: "+e[2]+";"+e[4].style)&&{style:i}])),R(t,"bx--skeleton__text",!0),R(t,"bx--skeleton__heading",e[0])},d(e){e&&x(t),n=!1,s(o)}}}function Dn(e){let t,i,n,o=e[3],a=[];for(let t=0;t<o.length;t+=1)a[t]=Rn(Pn(e,o,t));let l=[e[4]],c={};for(let e=0;e<l.length;e+=1)c=r(c,l[e]);return{c(){t=w("div");for(let e=0;e<a.length;e+=1)a[e].c();I(t,c)},m(r,o){v(r,t,o);for(let e=0;e<a.length;e+=1)a[e].m(t,null);i||(n=[k(t,"click",e[8]),k(t,"mouseover",e[9]),k(t,"mouseenter",e[10]),k(t,"mouseleave",e[11])],i=!0)},p(e,i){if(9&i){let r;for(o=e[3],r=0;r<o.length;r+=1){const n=Pn(e,o,r);a[r]?a[r].p(n,i):(a[r]=Rn(n),a[r].c(),a[r].m(t,null))}for(;r<a.length;r+=1)a[r].d(1);a.length=o.length}I(t,c=de(l,[16&i&&e[4]]))},d(e){e&&x(t),b(a,e),i=!1,s(n)}}}function Rn(e){let t;return{c(){t=w("p"),D(t,"width",e[2]),R(t,"bx--skeleton__text",!0),R(t,"bx--skeleton__heading",e[0])},m(e,i){v(e,t,i)},p(e,i){8&i&&D(t,"width",e[2]),1&i&&R(t,"bx--skeleton__heading",e[0])},d(e){e&&x(t)}}}function Bn(e){let t;function r(e,t){return e[1]?Dn:Ln}let n=r(e),o=n(e);return{c(){o.c(),t=M()},m(e,i){o.m(e,i),v(e,t,i)},p(e,[i]){n===(n=r(e))&&o?o.p(e,i):(o.d(1),o=n(e),o&&(o.c(),o.m(t.parentNode,t)))},i:i,o:i,d(e){o.d(e),e&&x(t)}}}function On(e,t,i){let n,o,s;const a=["lines","heading","paragraph","width"];let l=m(t,a),{lines:c=3}=t,{heading:u=!1}=t,{paragraph:h=!1}=t,{width:d="100%"}=t;const p=[.973,.153,.567];return e.$$set=e=>{t=r(r({},t),f(e)),i(4,l=m(t,a)),"lines"in e&&i(5,c=e.lines),"heading"in e&&i(0,u=e.heading),"paragraph"in e&&i(1,h=e.paragraph),"width"in e&&i(2,d=e.width)},e.$$.update=()=>{if(4&e.$$.dirty&&i(7,o=parseInt(d,10)),4&e.$$.dirty&&i(6,s=d.includes("px")),238&e.$$.dirty&&h)for(let e=0;e<c;e++){const t=s?o-75:0,r=s?o:75,a=Math.floor(p[e%3]*(r-t+1))+t+"px";i(3,n=[...n,{width:s?a:`calc(${d} - ${a})`}])}},i(3,n=[]),[u,h,d,n,l,c,s,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var Fn=class extends ve{constructor(e){super(),_e(this,e,On,Bn,l,{lines:5,heading:0,paragraph:1,width:2})}};function jn(e,t,i){const r=e.slice();return r[9]=t[i],r}function $n(e){let t,i,r,n,o,s,a,l,c,u,h,d,p;return r=new zn({props:{class:"bx--accordion__arrow"}}),o=new Fn({props:{class:"bx--accordion__title"}}),l=new Fn({props:{width:"90%"}}),u=new Fn({props:{width:"80%"}}),d=new Fn({props:{width:"95%"}}),{c(){t=w("li"),i=w("span"),me(r.$$.fragment),n=C(),me(o.$$.fragment),s=C(),a=w("div"),me(l.$$.fragment),c=C(),me(u.$$.fragment),h=C(),me(d.$$.fragment),R(i,"bx--accordion__heading",!0),A(a,"class","bx--accordion__content"),R(t,"bx--accordion__item",!0),R(t,"bx--accordion__item--active",!0)},m(e,f){v(e,t,f),_(t,i),ge(r,i,null),_(i,n),ge(o,i,null),_(t,s),_(t,a),ge(l,a,null),_(a,c),ge(u,a,null),_(a,h),ge(d,a,null),p=!0},i(e){p||(ae(r.$$.fragment,e),ae(o.$$.fragment,e),ae(l.$$.fragment,e),ae(u.$$.fragment,e),ae(d.$$.fragment,e),p=!0)},o(e){le(r.$$.fragment,e),le(o.$$.fragment,e),le(l.$$.fragment,e),le(u.$$.fragment,e),le(d.$$.fragment,e),p=!1},d(e){e&&x(t),ye(r),ye(o),ye(l),ye(u),ye(d)}}}function Nn(e,t){let i,r,n,o,s,a,l;return n=new zn({props:{class:"bx--accordion__arrow"}}),s=new Fn({props:{class:"bx--accordion__title"}}),{key:e,first:null,c(){i=w("li"),r=w("span"),me(n.$$.fragment),o=C(),me(s.$$.fragment),a=C(),A(r,"class","bx--accordion__heading"),A(i,"class","bx--accordion__item"),this.first=i},m(e,t){v(e,i,t),_(i,r),ge(n,r,null),_(r,o),ge(s,r,null),_(i,a),l=!0},p(e,t){e},i(e){l||(ae(n.$$.fragment,e),ae(s.$$.fragment,e),l=!0)},o(e){le(n.$$.fragment,e),le(s.$$.fragment,e),l=!1},d(e){e&&x(i),ye(n),ye(s)}}}function Un(e){let t,i,n,o,a,l=[],c=new Map,u=e[3]&&$n(),h=Array.from({length:e[3]?e[0]-1:e[0]},Vn);const d=e=>e[9];for(let t=0;t<h.length;t+=1){let i=jn(e,h,t),r=d(i);c.set(r,l[t]=Nn(r))}let p=[e[4]],f={};for(let e=0;e<p.length;e+=1)f=r(f,p[e]);return{c(){t=w("ul"),u&&u.c(),i=C();for(let e=0;e<l.length;e+=1)l[e].c();I(t,f),R(t,"bx--skeleton",!0),R(t,"bx--accordion",!0),R(t,"bx--accordion--start","start"===e[1]),R(t,"bx--accordion--end","end"===e[1]),R(t,"bx--accordion--sm","sm"===e[2]),R(t,"bx--accordion--xl","xl"===e[2])},m(r,s){v(r,t,s),u&&u.m(t,null),_(t,i);for(let e=0;e<l.length;e+=1)l[e].m(t,null);n=!0,o||(a=[k(t,"click",e[5]),k(t,"mouseover",e[6]),k(t,"mouseenter",e[7]),k(t,"mouseleave",e[8])],o=!0)},p(e,[r]){e[3]?u?8&r&&ae(u,1):(u=$n(),u.c(),ae(u,1),u.m(t,i)):u&&(oe(),le(u,1,1,(()=>{u=null})),se()),9&r&&(h=Array.from({length:e[3]?e[0]-1:e[0]},Vn),oe(),l=he(l,r,d,1,e,h,c,t,ue,Nn,null,jn),se()),I(t,f=de(p,[16&r&&e[4]])),R(t,"bx--skeleton",!0),R(t,"bx--accordion",!0),R(t,"bx--accordion--start","start"===e[1]),R(t,"bx--accordion--end","end"===e[1]),R(t,"bx--accordion--sm","sm"===e[2]),R(t,"bx--accordion--xl","xl"===e[2])},i(e){if(!n){ae(u);for(let e=0;e<h.length;e+=1)ae(l[e]);n=!0}},o(e){le(u);for(let e=0;e<l.length;e+=1)le(l[e]);n=!1},d(e){e&&x(t),u&&u.d();for(let e=0;e<l.length;e+=1)l[e].d();o=!1,s(a)}}}const Vn=(e,t)=>t;function Gn(e,t,i){const n=["count","align","size","open"];let o=m(t,n),{count:s=4}=t,{align:a="end"}=t,{size:l}=t,{open:c=!0}=t;return e.$$set=e=>{t=r(r({},t),f(e)),i(4,o=m(t,n)),"count"in e&&i(0,s=e.count),"align"in e&&i(1,a=e.align),"size"in e&&i(2,l=e.size),"open"in e&&i(3,c=e.open)},[s,a,l,c,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var qn=class extends ve{constructor(e){super(),_e(this,e,Gn,Un,l,{count:0,align:1,size:2,open:3})}};function Zn(e){let t,i,n,o;const a=e[6].default,l=c(a,e,e[5],null);let u=[e[3]],f={};for(let e=0;e<u.length;e+=1)f=r(f,u[e]);return{c(){t=w("ul"),l&&l.c(),I(t,f),R(t,"bx--accordion",!0),R(t,"bx--accordion--start","start"===e[0]),R(t,"bx--accordion--end","end"===e[0]),R(t,"bx--accordion--sm","sm"===e[1]),R(t,"bx--accordion--xl","xl"===e[1])},m(r,s){v(r,t,s),l&&l.m(t,null),i=!0,n||(o=[k(t,"click",e[7]),k(t,"mouseover",e[8]),k(t,"mouseenter",e[9]),k(t,"mouseleave",e[10])],n=!0)},p(e,r){l&&l.p&&(!i||32&r)&&d(l,a,e,e[5],i?h(a,e[5],r,null):p(e[5]),null),I(t,f=de(u,[8&r&&e[3]])),R(t,"bx--accordion",!0),R(t,"bx--accordion--start","start"===e[0]),R(t,"bx--accordion--end","end"===e[0]),R(t,"bx--accordion--sm","sm"===e[1]),R(t,"bx--accordion--xl","xl"===e[1])},i(e){i||(ae(l,e),i=!0)},o(e){le(l,e),i=!1},d(e){e&&x(t),l&&l.d(e),n=!1,s(o)}}}function Wn(e){let t,i;const n=[e[3],{align:e[0]},{size:e[1]}];let o={};for(let e=0;e<n.length;e+=1)o=r(o,n[e]);return t=new qn({props:o}),t.$on("click",e[11]),t.$on("mouseover",e[12]),t.$on("mouseenter",e[13]),t.$on("mouseleave",e[14]),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r=11&i?de(n,[8&i&&pe(e[3]),1&i&&{align:e[0]},2&i&&{size:e[1]}]):{};t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Hn(e){let t,i,r,n;const o=[Wn,Zn],s=[];function a(e,t){return e[2]?0:1}return t=a(e),i=s[t]=o[t](e),{c(){i.c(),r=M()},m(e,i){s[t].m(e,i),v(e,r,i),n=!0},p(e,[n]){let l=t;t=a(e),t===l?s[t].p(e,n):(oe(),le(s[l],1,1,(()=>{s[l]=null})),se(),i=s[t],i?i.p(e,n):(i=s[t]=o[t](e),i.c()),ae(i,1),i.m(r.parentNode,r))},i(e){n||(ae(i),n=!0)},o(e){le(i),n=!1},d(e){s[t].d(e),e&&x(r)}}}function Xn(e,t,i){const n=["align","size","disabled","skeleton"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{align:l="end"}=t,{size:c}=t,{disabled:u=!1}=t,{skeleton:h=!1}=t;const d=De(u);var p,g;return p="Accordion",g={disableItems:d},F().$$.context.set(p,g),e.$$set=e=>{t=r(r({},t),f(e)),i(3,o=m(t,n)),"align"in e&&i(0,l=e.align),"size"in e&&i(1,c=e.size),"disabled"in e&&i(4,u=e.disabled),"skeleton"in e&&i(2,h=e.skeleton),"$$scope"in e&&i(5,a=e.$$scope)},e.$$.update=()=>{16&e.$$.dirty&&d.set(u)},[l,c,h,o,u,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var Kn=class extends ve{constructor(e){super(),_e(this,e,Xn,Hn,l,{align:0,size:1,disabled:4,skeleton:2})}};const Yn=e=>({}),Jn=e=>({});function Qn(e){let t,i,n,o,a,l,u,f,m,g;n=new zn({props:{class:"bx--accordion__arrow","aria-label":e[3]}});const y=e[7].title,b=c(y,e,e[6],Jn),T=b||function(e){let t;return{c(){t=S(e[2])},m(e,i){v(e,t,i)},p(e,i){4&i&&P(t,e[2])},d(e){e&&x(t)}}}(e),M=e[7].default,E=c(M,e,e[6],null);let z=[e[5]],L={};for(let e=0;e<z.length;e+=1)L=r(L,z[e]);return{c(){t=w("li"),i=w("button"),me(n.$$.fragment),o=C(),a=w("div"),T&&T.c(),l=C(),u=w("div"),E&&E.c(),R(a,"bx--accordion__title",!0),A(i,"type","button"),A(i,"title",e[3]),A(i,"aria-expanded",e[0]),i.disabled=e[1],R(i,"bx--accordion__heading",!0),R(u,"bx--accordion__content",!0),I(t,L),R(t,"bx--accordion__item",!0),R(t,"bx--accordion__item--active",e[0]),R(t,"bx--accordion__item--disabled",e[1]),R(t,"bx--accordion__item--expanding","expanding"===e[4]),R(t,"bx--accordion__item--collapsing","collapsing"===e[4])},m(r,s){v(r,t,s),_(t,i),ge(n,i,null),_(i,o),_(i,a),T&&T.m(a,null),_(t,l),_(t,u),E&&E.m(u,null),f=!0,m||(g=[k(i,"click",e[9]),k(i,"click",e[14]),k(i,"mouseover",e[10]),k(i,"mouseenter",e[11]),k(i,"mouseleave",e[12]),k(i,"keydown",e[13]),k(i,"keydown",e[15]),k(t,"animationend",e[8]),k(t,"animationend",e[16])],m=!0)},p(e,[r]){const o={};8&r&&(o["aria-label"]=e[3]),n.$set(o),b?b.p&&(!f||64&r)&&d(b,y,e,e[6],f?h(y,e[6],r,Yn):p(e[6]),Jn):T&&T.p&&(!f||4&r)&&T.p(e,f?r:-1),(!f||8&r)&&A(i,"title",e[3]),(!f||1&r)&&A(i,"aria-expanded",e[0]),(!f||2&r)&&(i.disabled=e[1]),E&&E.p&&(!f||64&r)&&d(E,M,e,e[6],f?h(M,e[6],r,null):p(e[6]),null),I(t,L=de(z,[32&r&&e[5]])),R(t,"bx--accordion__item",!0),R(t,"bx--accordion__item--active",e[0]),R(t,"bx--accordion__item--disabled",e[1]),R(t,"bx--accordion__item--expanding","expanding"===e[4]),R(t,"bx--accordion__item--collapsing","collapsing"===e[4])},i(e){f||(ae(n.$$.fragment,e),ae(T,e),ae(E,e),f=!0)},o(e){le(n.$$.fragment,e),le(T,e),le(E,e),f=!1},d(e){e&&x(t),ye(n),T&&T.d(e),E&&E.d(e),m=!1,s(g)}}}function eo(e,t,i){const n=["title","open","disabled","iconDescription"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{title:l="title"}=t,{open:c=!1}=t,{disabled:u=!1}=t,{iconDescription:h="Expand/Collapse"}=t,d=u;const p=N("Accordion").disableItems.subscribe((e=>{!e&&d||i(1,u=e)}));let g;j((()=>()=>{p()}));return e.$$set=e=>{t=r(r({},t),f(e)),i(5,o=m(t,n)),"title"in e&&i(2,l=e.title),"open"in e&&i(0,c=e.open),"disabled"in e&&i(1,u=e.disabled),"iconDescription"in e&&i(3,h=e.iconDescription),"$$scope"in e&&i(6,a=e.$$scope)},[c,u,l,h,g,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},()=>{i(0,c=!c),i(4,g=c?"expanding":"collapsing")},({key:e})=>{c&&"Escape"===e&&i(0,c=!1)},()=>{i(4,g=void 0)}]}var to=class extends ve{constructor(e){super(),_e(this,e,eo,Qn,l,{title:2,open:0,disabled:1,iconDescription:3})}};function io(e){let t,i,n,o=[e[2]],a={};for(let e=0;e<o.length;e+=1)a=r(a,o[e]);return{c(){t=w("div"),I(t,a),R(t,"bx--skeleton",!0),R(t,"bx--btn",!0),R(t,"bx--btn--field","field"===e[1]),R(t,"bx--btn--sm","small"===e[1]),R(t,"bx--btn--lg","lg"===e[1]),R(t,"bx--btn--xl","xl"===e[1])},m(r,o){v(r,t,o),i||(n=[k(t,"click",e[7]),k(t,"mouseover",e[8]),k(t,"mouseenter",e[9]),k(t,"mouseleave",e[10])],i=!0)},p(e,i){I(t,a=de(o,[4&i&&e[2]])),R(t,"bx--skeleton",!0),R(t,"bx--btn",!0),R(t,"bx--btn--field","field"===e[1]),R(t,"bx--btn--sm","small"===e[1]),R(t,"bx--btn--lg","lg"===e[1]),R(t,"bx--btn--xl","xl"===e[1])},d(e){e&&x(t),i=!1,s(n)}}}function ro(e){let t,i,n,o,a,l=[{href:e[0]},{rel:n="_blank"===e[2].target?"noopener noreferrer":void 0},{role:"button"},e[2]],c={};for(let e=0;e<l.length;e+=1)c=r(c,l[e]);return{c(){t=w("a"),i=S(""),I(t,c),R(t,"bx--skeleton",!0),R(t,"bx--btn",!0),R(t,"bx--btn--field","field"===e[1]),R(t,"bx--btn--sm","small"===e[1]),R(t,"bx--btn--lg","lg"===e[1]),R(t,"bx--btn--xl","xl"===e[1])},m(r,n){v(r,t,n),_(t,i),o||(a=[k(t,"click",e[3]),k(t,"mouseover",e[4]),k(t,"mouseenter",e[5]),k(t,"mouseleave",e[6])],o=!0)},p(e,i){I(t,c=de(l,[1&i&&{href:e[0]},4&i&&n!==(n="_blank"===e[2].target?"noopener noreferrer":void 0)&&{rel:n},{role:"button"},4&i&&e[2]])),R(t,"bx--skeleton",!0),R(t,"bx--btn",!0),R(t,"bx--btn--field","field"===e[1]),R(t,"bx--btn--sm","small"===e[1]),R(t,"bx--btn--lg","lg"===e[1]),R(t,"bx--btn--xl","xl"===e[1])},d(e){e&&x(t),o=!1,s(a)}}}function no(e){let t;function r(e,t){return e[0]?ro:io}let n=r(e),o=n(e);return{c(){o.c(),t=M()},m(e,i){o.m(e,i),v(e,t,i)},p(e,[i]){n===(n=r(e))&&o?o.p(e,i):(o.d(1),o=n(e),o&&(o.c(),o.m(t.parentNode,t)))},i:i,o:i,d(e){o.d(e),e&&x(t)}}}function oo(e,t,i){const n=["href","size"];let o=m(t,n),{href:s}=t,{size:a="default"}=t;return e.$$set=e=>{t=r(r({},t),f(e)),i(2,o=m(t,n)),"href"in e&&i(0,s=e.href),"size"in e&&i(1,a=e.size)},[s,a,o,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var so=class extends ve{constructor(e){super(),_e(this,e,oo,no,l,{href:0,size:1})}};const ao=e=>({props:512&e[0]}),lo=e=>({props:e[9]});function co(e){let t,i,n,o,a,l,u=e[8]&&fo(e);const f=e[19].default,m=c(f,e,e[18],null);var g=e[2];function y(e){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":e[3]}}}g&&(n=new g(y(e)));let b=[e[9]],T={};for(let e=0;e<b.length;e+=1)T=r(T,b[e]);return{c(){t=w("button"),u&&u.c(),i=C(),m&&m.c(),n&&me(n.$$.fragment),I(t,T)},m(r,s){v(r,t,s),u&&u.m(t,null),_(t,i),m&&m.m(t,null),n&&ge(n,t,null),t.autofocus&&t.focus(),e[33](t),o=!0,a||(l=[k(t,"click",e[24]),k(t,"mouseover",e[25]),k(t,"mouseenter",e[26]),k(t,"mouseleave",e[27])],a=!0)},p(e,r){e[8]?u?u.p(e,r):(u=fo(e),u.c(),u.m(t,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&r[0])&&d(m,f,e,e[18],o?h(f,e[18],r,null):p(e[18]),null);const s={};if(8&r[0]&&(s["aria-label"]=e[3]),g!==(g=e[2])){if(n){oe();const e=n;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}g?(n=new g(y(e)),me(n.$$.fragment),ae(n.$$.fragment,1),ge(n,t,null)):n=null}else g&&n.$set(s);I(t,T=de(b,[512&r[0]&&e[9]]))},i(e){o||(ae(m,e),n&&ae(n.$$.fragment,e),o=!0)},o(e){le(m,e),n&&le(n.$$.fragment,e),o=!1},d(i){i&&x(t),u&&u.d(),m&&m.d(i),n&&ye(n),e[33](null),a=!1,s(l)}}}function uo(e){let t,i,n,o,a,l,u=e[8]&&mo(e);const f=e[19].default,m=c(f,e,e[18],null);var g=e[2];function y(e){return{props:{"aria-hidden":"true",class:"bx--btn__icon","aria-label":e[3]}}}g&&(n=new g(y(e)));let b=[e[9]],T={};for(let e=0;e<b.length;e+=1)T=r(T,b[e]);return{c(){t=w("a"),u&&u.c(),i=C(),m&&m.c(),n&&me(n.$$.fragment),I(t,T)},m(r,s){v(r,t,s),u&&u.m(t,null),_(t,i),m&&m.m(t,null),n&&ge(n,t,null),e[32](t),o=!0,a||(l=[k(t,"click",e[20]),k(t,"mouseover",e[21]),k(t,"mouseenter",e[22]),k(t,"mouseleave",e[23])],a=!0)},p(e,r){e[8]?u?u.p(e,r):(u=mo(e),u.c(),u.m(t,i)):u&&(u.d(1),u=null),m&&m.p&&(!o||262144&r[0])&&d(m,f,e,e[18],o?h(f,e[18],r,null):p(e[18]),null);const s={};if(8&r[0]&&(s["aria-label"]=e[3]),g!==(g=e[2])){if(n){oe();const e=n;le(e.$$.fragment,1,0,(()=>{ye(e,1)})),se()}g?(n=new g(y(e)),me(n.$$.fragment),ae(n.$$.fragment,1),ge(n,t,null)):n=null}else g&&n.$set(s);I(t,T=de(b,[512&r[0]&&e[9]]))},i(e){o||(ae(m,e),n&&ae(n.$$.fragment,e),o=!0)},o(e){le(m,e),n&&le(n.$$.fragment,e),o=!1},d(i){i&&x(t),u&&u.d(),m&&m.d(i),n&&ye(n),e[32](null),a=!1,s(l)}}}function ho(e){let t;const i=e[19].default,r=c(i,e,e[18],lo);return{c(){r&&r.c()},m(e,i){r&&r.m(e,i),t=!0},p(e,n){r&&r.p&&(!t||262656&n[0])&&d(r,i,e,e[18],t?h(i,e[18],n,ao):p(e[18]),lo)},i(e){t||(ae(r,e),t=!0)},o(e){le(r,e),t=!1},d(e){r&&r.d(e)}}}function po(e){let t,i;const n=[{href:e[7]},{size:e[1]},e[10],{style:e[8]&&"width: 3rem;"}];let o={};for(let e=0;e<n.length;e+=1)o=r(o,n[e]);return t=new so({props:o}),t.$on("click",e[28]),t.$on("mouseover",e[29]),t.$on("mouseenter",e[30]),t.$on("mouseleave",e[31]),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r=1410&i[0]?de(n,[128&i[0]&&{href:e[7]},2&i[0]&&{size:e[1]},1024&i[0]&&pe(e[10]),256&i[0]&&{style:e[8]&&"width: 3rem;"}]):{};t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function fo(e){let t,i;return{c(){t=w("span"),i=S(e[3]),R(t,"bx--assistive-text",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,t){8&t[0]&&P(i,e[3])},d(e){e&&x(t)}}}function mo(e){let t,i;return{c(){t=w("span"),i=S(e[3]),R(t,"bx--assistive-text",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,t){8&t[0]&&P(i,e[3])},d(e){e&&x(t)}}}function go(e){let t,i,r,n;const o=[po,ho,uo,co],s=[];function a(e,t){return e[5]?0:e[4]?1:e[7]&&!e[6]?2:3}return t=a(e),i=s[t]=o[t](e),{c(){i.c(),r=M()},m(e,i){s[t].m(e,i),v(e,r,i),n=!0},p(e,n){let l=t;t=a(e),t===l?s[t].p(e,n):(oe(),le(s[l],1,1,(()=>{s[l]=null})),se(),i=s[t],i?i.p(e,n):(i=s[t]=o[t](e),i.c()),ae(i,1),i.m(r.parentNode,r))},i(e){n||(ae(i),n=!0)},o(e){le(i),n=!1},d(e){s[t].d(e),e&&x(r)}}}function yo(e,t,i){let n,o;const s=["kind","size","expressive","isSelected","icon","iconDescription","tooltipAlignment","tooltipPosition","as","skeleton","disabled","href","tabindex","type","ref"];let a=m(t,s),{$$slots:l={},$$scope:c}=t;const u=g(l);let{kind:h="primary"}=t,{size:d="default"}=t,{expressive:p=!1}=t,{isSelected:y=!1}=t,{icon:_}=t,{iconDescription:v}=t,{tooltipAlignment:x="center"}=t,{tooltipPosition:b="bottom"}=t,{as:w=!1}=t,{skeleton:T=!1}=t,{disabled:S=!1}=t,{href:C}=t,{tabindex:M="0"}=t,{type:k="button"}=t,{ref:E=null}=t;const A=N("ComposedModal");return e.$$set=e=>{t=r(r({},t),f(e)),i(10,a=m(t,s)),"kind"in e&&i(11,h=e.kind),"size"in e&&i(1,d=e.size),"expressive"in e&&i(12,p=e.expressive),"isSelected"in e&&i(13,y=e.isSelected),"icon"in e&&i(2,_=e.icon),"iconDescription"in e&&i(3,v=e.iconDescription),"tooltipAlignment"in e&&i(14,x=e.tooltipAlignment),"tooltipPosition"in e&&i(15,b=e.tooltipPosition),"as"in e&&i(4,w=e.as),"skeleton"in e&&i(5,T=e.skeleton),"disabled"in e&&i(6,S=e.disabled),"href"in e&&i(7,C=e.href),"tabindex"in e&&i(16,M=e.tabindex),"type"in e&&i(17,k=e.type),"ref"in e&&i(0,E=e.ref),"$$scope"in e&&i(18,c=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty[0]&&A&&E&&A.declareRef(E),4&e.$$.dirty[0]&&i(8,n=_&&!u.default),i(9,o={type:C&&!S?void 0:k,tabindex:M,disabled:!0===S||void 0,href:C,"aria-pressed":n&&"ghost"===h&&!C?y:void 0,...a,class:["bx--btn",p&&"bx--btn--expressive",("small"===d&&!p||"sm"===d&&!p||"small"===d&&!p)&&"bx--btn--sm","field"===d&&!p||"md"===d&&!p&&"bx--btn--md","field"===d&&"bx--btn--field","small"===d&&"bx--btn--sm","lg"===d&&"bx--btn--lg","xl"===d&&"bx--btn--xl",h&&`bx--btn--${h}`,S&&"bx--btn--disabled",n&&"bx--btn--icon-only",n&&"bx--tooltip__trigger",n&&"bx--tooltip--a11y",n&&b&&`bx--btn--icon-only--${b}`,n&&x&&`bx--tooltip--align-${x}`,n&&y&&"ghost"===h&&"bx--btn--selected",a.class].filter(Boolean).join(" ")})},[E,d,_,v,w,T,S,C,n,o,a,h,p,y,x,b,M,k,c,l,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{E=e,i(0,E)}))},function(e){G[e?"unshift":"push"]((()=>{E=e,i(0,E)}))}]}var _o=class extends ve{constructor(e){super(),_e(this,e,yo,go,l,{kind:11,size:1,expressive:12,isSelected:13,icon:2,iconDescription:3,tooltipAlignment:14,tooltipPosition:15,as:4,skeleton:5,disabled:6,href:7,tabindex:16,type:17,ref:0},null,[-1,-1])}};function vo(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function xo(e){let t,n,o,s=e[1]&&vo(e),a=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],l={};for(let e=0;e<a.length;e+=1)l=r(l,a[e]);return{c(){t=T("svg"),s&&s.c(),n=T("path"),o=T("path"),A(n,"d","M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25\tc-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"),A(o,"fill","none"),A(o,"d","M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22\tC16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z"),A(o,"data-icon-path","inner-path"),A(o,"opacity","0"),z(t,l)},m(e,i){v(e,t,i),s&&s.m(t,null),_(t,n),_(t,o)},p(e,[i]){e[1]?s?s.p(e,i):(s=vo(e),s.c(),s.m(t,n)):s&&(s.d(1),s=null),z(t,l=de(a,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),s&&s.d()}}}function bo(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var wo=class extends ve{constructor(e){super(),_e(this,e,bo,xo,l,{size:0,title:1})}};function To(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function So(e){let t,n,o,s,a=e[1]&&To(e),l=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],c={};for(let e=0;e<l.length;e+=1)c=r(c,l[e]);return{c(){t=T("svg"),a&&a.c(),n=T("path"),o=T("path"),s=T("path"),A(n,"fill","none"),A(n,"d","M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z"),A(n,"data-icon-path","inner-path"),A(o,"d","M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"),A(s,"d","M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"),z(t,c)},m(e,i){v(e,t,i),a&&a.m(t,null),_(t,n),_(t,o),_(t,s)},p(e,[i]){e[1]?a?a.p(e,i):(a=To(e),a.c(),a.m(t,n)):a&&(a.d(1),a=null),z(t,c=de(l,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),a&&a.d()}}}function Co(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var Mo=class extends ve{constructor(e){super(),_e(this,e,Co,So,l,{size:0,title:1})}};function ko(e){let t,i;return{c(){t=w("div"),i=S(e[6]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,t){64&t&&P(i,e[6])},d(e){e&&x(t)}}}function Eo(e){let t,i;return{c(){t=w("div"),i=S(e[8]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,t){256&t&&P(i,e[8])},d(e){e&&x(t)}}}function Ao(e){let t,i,n,o,a,l,u,f;const m=e[11].default,g=c(m,e,e[10],null);let y=[{role:"listbox"},{tabindex:"-1"},{"data-invalid":i=e[5]||void 0},e[9]],_={};for(let e=0;e<y.length;e+=1)_=r(_,y[e]);let b=e[5]&&ko(e),T=!e[5]&&e[7]&&Eo(e);return{c(){t=w("div"),g&&g.c(),n=C(),b&&b.c(),o=C(),T&&T.c(),a=M(),I(t,_),R(t,"bx--list-box",!0),R(t,"bx--list-box--sm","sm"===e[0]),R(t,"bx--list-box--xl","xl"===e[0]),R(t,"bx--list-box--inline","inline"===e[1]),R(t,"bx--list-box--disabled",e[4]),R(t,"bx--list-box--expanded",e[2]),R(t,"bx--list-box--light",e[3]),R(t,"bx--list-box--warning",!e[5]&&e[7])},m(i,r){v(i,t,r),g&&g.m(t,null),v(i,n,r),b&&b.m(i,r),v(i,o,r),T&&T.m(i,r),v(i,a,r),l=!0,u||(f=[k(t,"keydown",e[12]),k(t,"keydown",Io),k(t,"click",E(e[13]))],u=!0)},p(e,[r]){g&&g.p&&(!l||1024&r)&&d(g,m,e,e[10],l?h(m,e[10],r,null):p(e[10]),null),I(t,_=de(y,[{role:"listbox"},{tabindex:"-1"},(!l||32&r&&i!==(i=e[5]||void 0))&&{"data-invalid":i},512&r&&e[9]])),R(t,"bx--list-box",!0),R(t,"bx--list-box--sm","sm"===e[0]),R(t,"bx--list-box--xl","xl"===e[0]),R(t,"bx--list-box--inline","inline"===e[1]),R(t,"bx--list-box--disabled",e[4]),R(t,"bx--list-box--expanded",e[2]),R(t,"bx--list-box--light",e[3]),R(t,"bx--list-box--warning",!e[5]&&e[7]),e[5]?b?b.p(e,r):(b=ko(e),b.c(),b.m(o.parentNode,o)):b&&(b.d(1),b=null),!e[5]&&e[7]?T?T.p(e,r):(T=Eo(e),T.c(),T.m(a.parentNode,a)):T&&(T.d(1),T=null)},i(e){l||(ae(g,e),l=!0)},o(e){le(g,e),l=!1},d(e){e&&x(t),g&&g.d(e),e&&x(n),b&&b.d(e),e&&x(o),T&&T.d(e),e&&x(a),u=!1,s(f)}}}const Io=e=>{"Escape"===e.key&&e.stopPropagation()};function zo(e,t,i){const n=["size","type","open","light","disabled","invalid","invalidText","warn","warnText"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{size:l}=t,{type:c="default"}=t,{open:u=!1}=t,{light:h=!1}=t,{disabled:d=!1}=t,{invalid:p=!1}=t,{invalidText:g=""}=t,{warn:y=!1}=t,{warnText:_=""}=t;return e.$$set=e=>{t=r(r({},t),f(e)),i(9,o=m(t,n)),"size"in e&&i(0,l=e.size),"type"in e&&i(1,c=e.type),"open"in e&&i(2,u=e.open),"light"in e&&i(3,h=e.light),"disabled"in e&&i(4,d=e.disabled),"invalid"in e&&i(5,p=e.invalid),"invalidText"in e&&i(6,g=e.invalidText),"warn"in e&&i(7,y=e.warn),"warnText"in e&&i(8,_=e.warnText),"$$scope"in e&&i(10,a=e.$$scope)},[l,c,u,h,d,p,g,y,_,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var Po=class extends ve{constructor(e){super(),_e(this,e,zo,Ao,l,{size:0,type:1,open:2,light:3,disabled:4,invalid:5,invalidText:6,warn:7,warnText:8})}};function Lo(e){let t,i,n,o,s;const a=e[4].default,l=c(a,e,e[3],null);let u=[{role:"listbox"},{id:i="menu-"+e[1]},e[2]],f={};for(let e=0;e<u.length;e+=1)f=r(f,u[e]);return{c(){t=w("div"),l&&l.c(),I(t,f),R(t,"bx--list-box__menu",!0)},m(i,r){v(i,t,r),l&&l.m(t,null),e[6](t),n=!0,o||(s=k(t,"scroll",e[5]),o=!0)},p(e,[r]){l&&l.p&&(!n||8&r)&&d(l,a,e,e[3],n?h(a,e[3],r,null):p(e[3]),null),I(t,f=de(u,[{role:"listbox"},(!n||2&r&&i!==(i="menu-"+e[1]))&&{id:i},4&r&&e[2]])),R(t,"bx--list-box__menu",!0)},i(e){n||(ae(l,e),n=!0)},o(e){le(l,e),n=!1},d(i){i&&x(t),l&&l.d(i),e[6](null),o=!1,s()}}}function Do(e,t,i){const n=["id","ref"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{id:l="ccs-"+Math.random().toString(36)}=t,{ref:c=null}=t;return e.$$set=e=>{t=r(r({},t),f(e)),i(2,o=m(t,n)),"id"in e&&i(1,l=e.id),"ref"in e&&i(0,c=e.ref),"$$scope"in e&&i(3,a=e.$$scope)},[c,l,o,a,s,function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{c=e,i(0,c)}))}]}var Ro=class extends ve{constructor(e){super(),_e(this,e,Do,Lo,l,{id:1,ref:0})}};function Bo(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function Oo(e){let t,n,o=e[1]&&Bo(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M16 22L6 12 7.4 10.6 16 19.2 24.6 10.6 26 12z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=Bo(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Fo(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var jo=class extends ve{constructor(e){super(),_e(this,e,Fo,Oo,l,{size:0,title:1})}};function $o(e){let t,i,n,o,s;i=new jo({props:{"aria-label":e[1],title:e[1]}});let a=[e[2]],l={};for(let e=0;e<a.length;e+=1)l=r(l,a[e]);return{c(){t=w("div"),me(i.$$.fragment),I(t,l),R(t,"bx--list-box__menu-icon",!0),R(t,"bx--list-box__menu-icon--open",e[0])},m(r,a){v(r,t,a),ge(i,t,null),n=!0,o||(s=k(t,"click",E(e[6])),o=!0)},p(e,[r]){const n={};2&r&&(n["aria-label"]=e[1]),2&r&&(n.title=e[1]),i.$set(n),I(t,l=de(a,[4&r&&e[2]])),R(t,"bx--list-box__menu-icon",!0),R(t,"bx--list-box__menu-icon--open",e[0])},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(e){e&&x(t),ye(i),o=!1,s()}}}function No(e,t,i){let n,o;const s=["open","translationIds","translateWithId"];let a=m(t,s),{open:l=!1}=t;const c={close:"close",open:"open"};let{translateWithId:u=(e=>h[e])}=t;const h={[c.close]:"Close menu",[c.open]:"Open menu"};return e.$$set=e=>{t=r(r({},t),f(e)),i(2,a=m(t,s)),"open"in e&&i(0,l=e.open),"translateWithId"in e&&i(4,u=e.translateWithId)},e.$$.update=()=>{1&e.$$.dirty&&i(5,n=l?c.close:c.open),48&e.$$.dirty&&i(1,o=u?.(n)??h[n])},[l,o,a,c,u,n,function(t){U.call(this,e,t)}]}var Uo=class extends ve{constructor(e){super(),_e(this,e,No,$o,l,{open:0,translationIds:3,translateWithId:4})}get translationIds(){return this.$$.ctx[3]}};function Vo(e){let t,i,n,o,a;const l=e[4].default,u=c(l,e,e[3],null);let f=[e[2]],m={};for(let e=0;e<f.length;e+=1)m=r(m,f[e]);return{c(){t=w("div"),i=w("div"),u&&u.c(),R(i,"bx--list-box__menu-item__option",!0),I(t,m),R(t,"bx--list-box__menu-item",!0),R(t,"bx--list-box__menu-item--active",e[0]),R(t,"bx--list-box__menu-item--highlighted",e[1])},m(r,s){v(r,t,s),_(t,i),u&&u.m(i,null),n=!0,o||(a=[k(t,"click",e[5]),k(t,"mouseenter",e[6]),k(t,"mouseleave",e[7])],o=!0)},p(e,[i]){u&&u.p&&(!n||8&i)&&d(u,l,e,e[3],n?h(l,e[3],i,null):p(e[3]),null),I(t,m=de(f,[4&i&&e[2]])),R(t,"bx--list-box__menu-item",!0),R(t,"bx--list-box__menu-item--active",e[0]),R(t,"bx--list-box__menu-item--highlighted",e[1])},i(e){n||(ae(u,e),n=!0)},o(e){le(u,e),n=!1},d(e){e&&x(t),u&&u.d(e),o=!1,s(a)}}}function Go(e,t,i){const n=["active","highlighted"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{active:l=!1}=t,{highlighted:c=!1}=t;return e.$$set=e=>{t=r(r({},t),f(e)),i(2,o=m(t,n)),"active"in e&&i(0,l=e.active),"highlighted"in e&&i(1,c=e.highlighted),"$$scope"in e&&i(3,a=e.$$scope)},[l,c,o,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)}]}var qo=class extends ve{constructor(e){super(),_e(this,e,Go,Vo,l,{active:0,highlighted:1})}};function Zo(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function Wo(e){let t,n,o=e[1]&&Zo(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M24 9.4L22.6 8 16 14.6 9.4 8 8 9.4 14.6 16 8 22.6 9.4 24 16 17.4 22.6 24 24 22.6 17.4 16 24 9.4z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=Zo(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Ho(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var Xo=class extends ve{constructor(e){super(),_e(this,e,Ho,Wo,l,{size:0,title:1})}};function Ko(e,t,i){const r=e.slice();return r[37]=t[i],r[39]=i,r}const Yo=e=>({item:16&e[0],index:16&e[0]}),Jo=e=>({item:e[37],index:e[39]});function Qo(e){let t,i;return{c(){t=w("label"),i=S(e[11]),A(t,"for",e[20]),R(t,"bx--label",!0),R(t,"bx--label--disabled",e[10]),R(t,"bx--visually-hidden",e[18])},m(e,r){v(e,t,r),_(t,i)},p(e,r){2048&r[0]&&P(i,e[11]),1048576&r[0]&&A(t,"for",e[20]),1024&r[0]&&R(t,"bx--label--disabled",e[10]),262144&r[0]&&R(t,"bx--visually-hidden",e[18])},d(e){e&&x(t)}}}function es(e){let t,i;return t=new wo({props:{class:"bx--list-box__invalid-icon"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function ts(e){let t,i;return t=new Mo({props:{class:"bx--list-box__invalid-icon bx--list-box__invalid-icon--warning"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function is(e){let t;return{c(){t=S(e[17])},m(e,i){v(e,t,i)},p(e,i){131072&i[0]&&P(t,e[17])},d(e){e&&x(t)}}}function rs(e){let t,i=e[5](e[22])+"";return{c(){t=S(i)},m(e,i){v(e,t,i)},p(e,r){4194336&r[0]&&i!==(i=e[5](e[22])+"")&&P(t,i)},d(e){e&&x(t)}}}function ns(e){let t,i;return t=new Ro({props:{"aria-labelledby":e[20],id:e[20],$$slots:{default:[as]},$$scope:{ctx:e}}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r={};1048576&i[0]&&(r["aria-labelledby"]=e[20]),1048576&i[0]&&(r.id=e[20]),8388665&i[0]|16&i[1]&&(r.$$scope={dirty:i,ctx:e}),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function os(e){let t,i;const r=e[27].default,n=c(r,e,e[35],Jo),o=n||function(e){let t,i=e[5](e[37])+"";return{c(){t=S(i)},m(e,i){v(e,t,i)},p(e,r){48&r[0]&&i!==(i=e[5](e[37])+"")&&P(t,i)},d(e){e&&x(t)}}}(e);return{c(){o&&o.c(),t=C()},m(e,r){o&&o.m(e,r),v(e,t,r),i=!0},p(e,t){n?n.p&&(!i||16&t[0]|16&t[1])&&d(n,r,e,e[35],i?h(r,e[35],t,Yo):p(e[35]),Jo):o&&o.p&&(!i||48&t[0])&&o.p(e,i?t:[-1,-1])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){o&&o.d(e),e&&x(t)}}}function ss(e,t){let i,r,n;return r=new qo({props:{id:t[37].id,active:t[0]===t[37].id,highlighted:t[23]===t[39]||t[0]===t[37].id,$$slots:{default:[os]},$$scope:{ctx:t}}}),r.$on("click",(function(){return t[32](t[37])})),r.$on("mouseenter",(function(){return t[33](t[39])})),{key:e,first:null,c(){i=M(),me(r.$$.fragment),this.first=i},m(e,t){v(e,i,t),ge(r,e,t),n=!0},p(e,i){t=e;const n={};16&i[0]&&(n.id=t[37].id),17&i[0]&&(n.active=t[0]===t[37].id),8388625&i[0]&&(n.highlighted=t[23]===t[39]||t[0]===t[37].id),48&i[0]|16&i[1]&&(n.$$scope={dirty:i,ctx:t}),r.$set(n)},i(e){n||(ae(r.$$.fragment,e),n=!0)},o(e){le(r.$$.fragment,e),n=!1},d(e){e&&x(i),ye(r,e)}}}function as(e){let t,i,r=[],n=new Map,o=e[4];const s=e=>e[37].id;for(let t=0;t<o.length;t+=1){let i=Ko(e,o,t),a=s(i);n.set(a,r[t]=ss(a,i))}return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=M()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);v(e,t,n),i=!0},p(e,i){8388665&i[0]|16&i[1]&&(o=e[4],oe(),r=he(r,i,s,1,e,o,n,t.parentNode,ue,ss,t,Ko),se())},i(e){if(!i){for(let e=0;e<o.length;e+=1)ae(r[e]);i=!0}},o(e){for(let e=0;e<r.length;e+=1)le(r[e]);i=!1},d(e){for(let t=0;t<r.length;t+=1)r[t].d(e);e&&x(t)}}}function ls(e){let t,i,r,n,o,s,a,l,c,u,h,d=e[12]&&es(),p=!e[12]&&e[14]&&ts();function f(e,t){return e[22]?rs:is}let m=f(e),g=m(e);s=new Uo({props:{translateWithId:e[19],open:e[1]}}),s.$on("click",e[29]);let y=e[1]&&ns(e);return{c(){d&&d.c(),t=C(),p&&p.c(),i=C(),r=w("button"),n=w("span"),g.c(),o=C(),me(s.$$.fragment),a=C(),y&&y.c(),l=M(),A(n,"class","bx--list-box__label"),A(r,"type","button"),A(r,"tabindex","0"),A(r,"aria-expanded",e[1]),r.disabled=e[10],A(r,"translatewithid",e[19]),A(r,"id",e[20]),R(r,"bx--list-box__field",!0)},m(f,m){d&&d.m(f,m),v(f,t,m),p&&p.m(f,m),v(f,i,m),v(f,r,m),_(r,n),g.m(n,null),_(r,o),ge(s,r,null),e[30](r),v(f,a,m),y&&y.m(f,m),v(f,l,m),c=!0,u||(h=k(r,"keydown",e[31]),u=!0)},p(e,o){e[12]?d?4096&o[0]&&ae(d,1):(d=es(),d.c(),ae(d,1),d.m(t.parentNode,t)):d&&(oe(),le(d,1,1,(()=>{d=null})),se()),!e[12]&&e[14]?p?20480&o[0]&&ae(p,1):(p=ts(),p.c(),ae(p,1),p.m(i.parentNode,i)):p&&(oe(),le(p,1,1,(()=>{p=null})),se()),m===(m=f(e))&&g?g.p(e,o):(g.d(1),g=m(e),g&&(g.c(),g.m(n,null)));const a={};524288&o[0]&&(a.translateWithId=e[19]),2&o[0]&&(a.open=e[1]),s.$set(a),(!c||2&o[0])&&A(r,"aria-expanded",e[1]),(!c||1024&o[0])&&(r.disabled=e[10]),(!c||524288&o[0])&&A(r,"translatewithid",e[19]),(!c||1048576&o[0])&&A(r,"id",e[20]),e[1]?y?(y.p(e,o),2&o[0]&&ae(y,1)):(y=ns(e),y.c(),ae(y,1),y.m(l.parentNode,l)):y&&(oe(),le(y,1,1,(()=>{y=null})),se())},i(e){c||(ae(d),ae(p),ae(s.$$.fragment,e),ae(y),c=!0)},o(e){le(d),le(p),le(s.$$.fragment,e),le(y),c=!1},d(n){d&&d.d(n),n&&x(t),p&&p.d(n),n&&x(i),n&&x(r),g.d(),ye(s),e[30](null),n&&x(a),y&&y.d(n),n&&x(l),u=!1,h()}}}function cs(e){let t,i;return{c(){t=w("div"),i=S(e[16]),R(t,"bx--form__helper-text",!0),R(t,"bx--form__helper-text--disabled",e[10])},m(e,r){v(e,t,r),_(t,i)},p(e,r){65536&r[0]&&P(i,e[16]),1024&r[0]&&R(t,"bx--form__helper-text--disabled",e[10])},d(e){e&&x(t)}}}function us(e){let t,i,n,o,s,a,l,c=e[11]&&Qo(e);n=new Po({props:{type:e[6],size:e[8],id:e[20],name:e[21],"aria-label":e[26]["aria-label"],class:"bx--dropdown "+("top"===e[7]&&"bx--list-box--up")+" "+(e[12]&&"bx--dropdown--invalid")+" "+(!e[12]&&e[14]&&"bx--dropdown--warning")+" "+(e[1]&&"bx--dropdown--open")+"\n      "+("sm"===e[8]&&"bx--dropdown--sm")+"\n      "+("xl"===e[8]&&"bx--dropdown--xl")+"\n      "+(e[2]&&"bx--dropdown--inline")+"\n      "+(e[10]&&"bx--dropdown--disabled")+"\n      "+(e[9]&&"bx--dropdown--light"),disabled:e[10],open:e[1],invalid:e[12],invalidText:e[13],light:e[9],warn:e[14],warnText:e[15],$$slots:{default:[ls]},$$scope:{ctx:e}}}),n.$on("click",e[34]);let u=!e[2]&&!e[12]&&!e[14]&&e[16]&&cs(e),h=[e[25]],d={};for(let e=0;e<h.length;e+=1)d=r(d,h[e]);return{c(){t=w("div"),c&&c.c(),i=C(),me(n.$$.fragment),o=C(),u&&u.c(),I(t,d),R(t,"bx--dropdown__wrapper",!0),R(t,"bx--list-box__wrapper",!0),R(t,"bx--dropdown__wrapper--inline",e[2]),R(t,"bx--list-box__wrapper--inline",e[2]),R(t,"bx--dropdown__wrapper--inline--invalid",e[2]&&e[12])},m(r,h){v(r,t,h),c&&c.m(t,null),_(t,i),ge(n,t,null),_(t,o),u&&u.m(t,null),s=!0,a||(l=k(window,"click",e[28]),a=!0)},p(e,r){e[11]?c?c.p(e,r):(c=Qo(e),c.c(),c.m(t,i)):c&&(c.d(1),c=null);const o={};64&r[0]&&(o.type=e[6]),256&r[0]&&(o.size=e[8]),1048576&r[0]&&(o.id=e[20]),2097152&r[0]&&(o.name=e[21]),67108864&r[0]&&(o["aria-label"]=e[26]["aria-label"]),22406&r[0]&&(o.class="bx--dropdown "+("top"===e[7]&&"bx--list-box--up")+" "+(e[12]&&"bx--dropdown--invalid")+" "+(!e[12]&&e[14]&&"bx--dropdown--warning")+" "+(e[1]&&"bx--dropdown--open")+"\n      "+("sm"===e[8]&&"bx--dropdown--sm")+"\n      "+("xl"===e[8]&&"bx--dropdown--xl")+"\n      "+(e[2]&&"bx--dropdown--inline")+"\n      "+(e[10]&&"bx--dropdown--disabled")+"\n      "+(e[9]&&"bx--dropdown--light")),1024&r[0]&&(o.disabled=e[10]),2&r[0]&&(o.open=e[1]),4096&r[0]&&(o.invalid=e[12]),8192&r[0]&&(o.invalidText=e[13]),512&r[0]&&(o.light=e[9]),16384&r[0]&&(o.warn=e[14]),32768&r[0]&&(o.warnText=e[15]),14308411&r[0]|16&r[1]&&(o.$$scope={dirty:r,ctx:e}),n.$set(o),e[2]||e[12]||e[14]||!e[16]?u&&(u.d(1),u=null):u?u.p(e,r):(u=cs(e),u.c(),u.m(t,null)),I(t,d=de(h,[33554432&r[0]&&e[25]])),R(t,"bx--dropdown__wrapper",!0),R(t,"bx--list-box__wrapper",!0),R(t,"bx--dropdown__wrapper--inline",e[2]),R(t,"bx--list-box__wrapper--inline",e[2]),R(t,"bx--dropdown__wrapper--inline--invalid",e[2]&&e[12])},i(e){s||(ae(n.$$.fragment,e),s=!0)},o(e){le(n.$$.fragment,e),s=!1},d(e){e&&x(t),c&&c.d(),ye(n),u&&u.d(),a=!1,l()}}}function hs(e,t,i){let n;const o=["items","itemToString","selectedId","type","direction","size","open","inline","light","disabled","titleText","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","id","name","ref"];let s=m(t,o),{$$slots:a={},$$scope:l}=t,{items:c=[]}=t,{itemToString:u=(e=>e.text||e.id)}=t,{selectedId:h}=t,{type:d="default"}=t,{direction:p="bottom"}=t,{size:g}=t,{open:y=!1}=t,{inline:_=!1}=t,{light:v=!1}=t,{disabled:x=!1}=t,{titleText:b=""}=t,{invalid:w=!1}=t,{invalidText:T=""}=t,{warn:S=!1}=t,{warnText:C=""}=t,{helperText:M=""}=t,{label:k}=t,{hideLabel:E=!1}=t,{translateWithId:A}=t,{id:I="ccs-"+Math.random().toString(36)}=t,{name:z}=t,{ref:P=null}=t;const L=$();let D=-1;function R(e){let t=D+e;t<0?t=c.length-1:t>=c.length&&(t=0),i(23,D=t)}return e.$$set=e=>{i(26,t=r(r({},t),f(e))),i(25,s=m(t,o)),"items"in e&&i(4,c=e.items),"itemToString"in e&&i(5,u=e.itemToString),"selectedId"in e&&i(0,h=e.selectedId),"type"in e&&i(6,d=e.type),"direction"in e&&i(7,p=e.direction),"size"in e&&i(8,g=e.size),"open"in e&&i(1,y=e.open),"inline"in e&&i(2,_=e.inline),"light"in e&&i(9,v=e.light),"disabled"in e&&i(10,x=e.disabled),"titleText"in e&&i(11,b=e.titleText),"invalid"in e&&i(12,w=e.invalid),"invalidText"in e&&i(13,T=e.invalidText),"warn"in e&&i(14,S=e.warn),"warnText"in e&&i(15,C=e.warnText),"helperText"in e&&i(16,M=e.helperText),"label"in e&&i(17,k=e.label),"hideLabel"in e&&i(18,E=e.hideLabel),"translateWithId"in e&&i(19,A=e.translateWithId),"id"in e&&i(20,I=e.id),"name"in e&&i(21,z=e.name),"ref"in e&&i(3,P=e.ref),"$$scope"in e&&i(35,l=e.$$scope)},e.$$.update=()=>{17&e.$$.dirty[0]&&i(22,n=c.find((e=>e.id===h))),4194305&e.$$.dirty[0]&&void 0!==h&&L("select",{selectedId:h,selectedItem:n}),64&e.$$.dirty[0]&&i(2,_="inline"===d),2&e.$$.dirty[0]&&(y||i(23,D=-1))},t=f(t),[h,y,_,P,c,u,d,p,g,v,x,b,w,T,S,C,M,k,E,A,I,z,n,D,R,s,t,a,({target:e})=>{y&&P&&!P.contains(e)&&i(1,y=!1)},e=>{e.stopPropagation(),x||i(1,y=!y)},function(e){G[e?"unshift":"push"]((()=>{P=e,i(3,P)}))},e=>{const{key:t}=e;["Enter","ArrowDown","ArrowUp"].includes(t)&&e.preventDefault(),"Enter"===t?(i(1,y=!y),D>-1&&c[D].id!==h&&(i(0,h=c[D].id),i(1,y=!1))):"Tab"===t?(i(1,y=!1),P.blur()):"ArrowDown"===t?R(1):"ArrowUp"===t&&R(-1)},e=>{i(0,h=e.id),P.focus()},e=>{i(23,D=e)},({target:e})=>{x||i(1,y=!!P.contains(e)&&!y)},l]}var ds=class extends ve{constructor(e){super(),_e(this,e,hs,us,l,{items:4,itemToString:5,selectedId:0,type:6,direction:7,size:8,open:1,inline:2,light:9,disabled:10,titleText:11,invalid:12,invalidText:13,warn:14,warnText:15,helperText:16,label:17,hideLabel:18,translateWithId:19,id:20,name:21,ref:3},null,[-1,-1])}};function ps(e,t,i){const r=e.slice();return r[54]=t[i],r}const fs=e=>({}),ms=e=>({}),gs=e=>({}),ys=e=>({});function _s(e){let t,i,r,n,o;return i=new Xo({props:{size:20,"aria-label":e[7],class:"bx--modal-close__icon"}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"type","button"),A(t,"aria-label",e[7]),A(t,"title",e[7]),R(t,"bx--modal-close",!0)},m(s,a){v(s,t,a),ge(i,t,null),e[37](t),r=!0,n||(o=k(t,"click",e[38]),n=!0)},p(e,n){const o={};128&n[0]&&(o["aria-label"]=e[7]),i.$set(o),(!r||128&n[0])&&A(t,"aria-label",e[7]),(!r||128&n[0])&&A(t,"title",e[7])},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(r){r&&x(t),ye(i),e[37](null),n=!1,o()}}}function vs(e){let t,i;const r=e[31].label,n=c(r,e,e[50],ys),o=n||function(e){let t;return{c(){t=S(e[6])},m(e,i){v(e,t,i)},p(e,i){64&i[0]&&P(t,e[6])},d(e){e&&x(t)}}}(e);return{c(){t=w("h2"),o&&o.c(),A(t,"id",e[25]),R(t,"bx--modal-header__label",!0)},m(e,r){v(e,t,r),o&&o.m(t,null),i=!0},p(e,s){n?n.p&&(!i||524288&s[1])&&d(n,r,e,e[50],i?h(r,e[50],s,gs):p(e[50]),ys):o&&o.p&&(!i||64&s[0])&&o.p(e,i?s:[-1,-1]),(!i||33554432&s[0])&&A(t,"id",e[25])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){e&&x(t),o&&o.d(e)}}}function xs(e){let t,i,r,n,o;return i=new Xo({props:{size:20,"aria-label":e[7],class:"bx--modal-close__icon"}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"type","button"),A(t,"aria-label",e[7]),A(t,"title",e[7]),R(t,"bx--modal-close",!0)},m(s,a){v(s,t,a),ge(i,t,null),e[39](t),r=!0,n||(o=k(t,"click",e[40]),n=!0)},p(e,n){const o={};128&n[0]&&(o["aria-label"]=e[7]),i.$set(o),(!r||128&n[0])&&A(t,"aria-label",e[7]),(!r||128&n[0])&&A(t,"title",e[7])},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(r){r&&x(t),ye(i),e[39](null),n=!1,o()}}}function bs(e){let t;return{c(){t=w("div"),R(t,"bx--modal-content--overflow-indicator",!0)},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function ws(e){let t,i,r,n,o,s;const a=[Ss,Ts],l=[];function c(e,t){return e[15].length>0?0:e[14]?1:-1}return~(i=c(e))&&(r=l[i]=a[i](e)),o=new _o({props:{kind:e[3]?"danger":"primary",disabled:e[11],icon:e[12],$$slots:{default:[Es]},$$scope:{ctx:e}}}),o.$on("click",e[43]),{c(){t=w("div"),r&&r.c(),n=C(),me(o.$$.fragment),R(t,"bx--modal-footer",!0),R(t,"bx--modal-footer--three-button",2===e[15].length)},m(e,r){v(e,t,r),~i&&l[i].m(t,null),_(t,n),ge(o,t,null),s=!0},p(e,s){let u=i;i=c(e),i===u?~i&&l[i].p(e,s):(r&&(oe(),le(l[u],1,1,(()=>{l[u]=null})),se()),~i?(r=l[i],r?r.p(e,s):(r=l[i]=a[i](e),r.c()),ae(r,1),r.m(t,n)):r=null);const h={};8&s[0]&&(h.kind=e[3]?"danger":"primary"),2048&s[0]&&(h.disabled=e[11]),4096&s[0]&&(h.icon=e[12]),1024&s[0]|524288&s[1]&&(h.$$scope={dirty:s,ctx:e}),o.$set(h),32768&s[0]&&R(t,"bx--modal-footer--three-button",2===e[15].length)},i(e){s||(ae(r),ae(o.$$.fragment,e),s=!0)},o(e){le(r),le(o.$$.fragment,e),s=!1},d(e){e&&x(t),~i&&l[i].d(),ye(o)}}}function Ts(e){let t,i;return t=new _o({props:{kind:"secondary",$$slots:{default:[Cs]},$$scope:{ctx:e}}}),t.$on("click",e[42]),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r={};16384&i[0]|524288&i[1]&&(r.$$scope={dirty:i,ctx:e}),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Ss(e){let t,i,r=e[15],n=[];for(let t=0;t<r.length;t+=1)n[t]=ks(ps(e,r,t));const o=e=>le(n[e],1,1,(()=>{n[e]=null}));return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=M()},m(e,r){for(let t=0;t<n.length;t+=1)n[t].m(e,r);v(e,t,r),i=!0},p(e,i){if(67141632&i[0]){let s;for(r=e[15],s=0;s<r.length;s+=1){const o=ps(e,r,s);n[s]?(n[s].p(o,i),ae(n[s],1)):(n[s]=ks(o),n[s].c(),ae(n[s],1),n[s].m(t.parentNode,t))}for(oe(),s=r.length;s<n.length;s+=1)o(s);se()}},i(e){if(!i){for(let e=0;e<r.length;e+=1)ae(n[e]);i=!0}},o(e){n=n.filter(Boolean);for(let e=0;e<n.length;e+=1)le(n[e]);i=!1},d(e){b(n,e),e&&x(t)}}}function Cs(e){let t;return{c(){t=S(e[14])},m(e,i){v(e,t,i)},p(e,i){16384&i[0]&&P(t,e[14])},d(e){e&&x(t)}}}function Ms(e){let t,i,r=e[54].text+"";return{c(){t=S(r),i=C()},m(e,r){v(e,t,r),v(e,i,r)},p(e,i){32768&i[0]&&r!==(r=e[54].text+"")&&P(t,r)},d(e){e&&x(t),e&&x(i)}}}function ks(e){let t,i;return t=new _o({props:{kind:"secondary",$$slots:{default:[Ms]},$$scope:{ctx:e}}}),t.$on("click",(function(){return e[41](e[54])})),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(i,r){e=i;const n={};32768&r[0]|524288&r[1]&&(n.$$scope={dirty:r,ctx:e}),t.$set(n)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Es(e){let t;return{c(){t=S(e[10])},m(e,i){v(e,t,i)},p(e,i){1024&i[0]&&P(t,e[10])},d(e){e&&x(t)}}}function As(e){let t,i,n,o,a,l,u,f,m,g,y,b,T,M,E,z,L,D,B=e[4]&&_s(e),O=e[6]&&vs(e);const F=e[31].heading,j=c(F,e,e[50],ms),$=j||function(e){let t;return{c(){t=S(e[5])},m(e,i){v(e,t,i)},p(e,i){32&i[0]&&P(t,e[5])},d(e){e&&x(t)}}}(e);let N=!e[4]&&xs(e);const U=e[31].default,V=c(U,e,e[50],null);let G=e[9]&&bs(),q=!e[4]&&ws(e),Z=[{role:"dialog"},{tabindex:"-1"},e[22],{"aria-modal":"true"},{"aria-label":e[23]}],W={};for(let e=0;e<Z.length;e+=1)W=r(W,Z[e]);let H=[{role:"presentation"},{id:e[17]},e[27]],X={};for(let e=0;e<H.length;e+=1)X=r(X,H[e]);return{c(){t=w("div"),i=w("div"),n=w("div"),B&&B.c(),o=C(),O&&O.c(),a=C(),l=w("h3"),$&&$.c(),u=C(),N&&N.c(),f=C(),m=w("div"),V&&V.c(),M=C(),G&&G.c(),E=C(),q&&q.c(),A(l,"id",e[24]),R(l,"bx--modal-header__heading",!0),R(n,"bx--modal-header",!0),A(m,"id",e[18]),A(m,"tabindex",g=e[9]?"0":void 0),A(m,"role",y=e[9]?"region":void 0),A(m,"aria-label",b=e[9]?e[23]:void 0),A(m,"aria-labelledby",T=e[6]?e[25]:e[24]),R(m,"bx--modal-content",!0),R(m,"bx--modal-content--with-form",e[8]),R(m,"bx--modal-scroll-content",e[9]),I(i,W),R(i,"bx--modal-container",!0),R(i,"bx--modal-container--xs","xs"===e[2]),R(i,"bx--modal-container--sm","sm"===e[2]),R(i,"bx--modal-container--lg","lg"===e[2]),I(t,X),R(t,"bx--modal",!0),R(t,"bx--modal-tall",!e[4]),R(t,"is-visible",e[0]),R(t,"bx--modal--danger",e[3])},m(r,s){v(r,t,s),_(t,i),_(i,n),B&&B.m(n,null),_(n,o),O&&O.m(n,null),_(n,a),_(n,l),$&&$.m(l,null),_(n,u),N&&N.m(n,null),_(i,f),_(i,m),V&&V.m(m,null),_(i,M),G&&G.m(i,null),_(i,E),q&&q.m(i,null),e[44](i),e[46](t),z=!0,L||(D=[k(i,"click",e[45]),k(t,"keydown",e[32]),k(t,"keydown",e[47]),k(t,"click",e[33]),k(t,"click",e[48]),k(t,"mouseover",e[34]),k(t,"mouseenter",e[35]),k(t,"mouseleave",e[36]),k(t,"transitionend",e[49])],L=!0)},p(e,r){e[4]?B?(B.p(e,r),16&r[0]&&ae(B,1)):(B=_s(e),B.c(),ae(B,1),B.m(n,o)):B&&(oe(),le(B,1,1,(()=>{B=null})),se()),e[6]?O?(O.p(e,r),64&r[0]&&ae(O,1)):(O=vs(e),O.c(),ae(O,1),O.m(n,a)):O&&(oe(),le(O,1,1,(()=>{O=null})),se()),j?j.p&&(!z||524288&r[1])&&d(j,F,e,e[50],z?h(F,e[50],r,fs):p(e[50]),ms):$&&$.p&&(!z||32&r[0])&&$.p(e,z?r:[-1,-1]),(!z||16777216&r[0])&&A(l,"id",e[24]),e[4]?N&&(oe(),le(N,1,1,(()=>{N=null})),se()):N?(N.p(e,r),16&r[0]&&ae(N,1)):(N=xs(e),N.c(),ae(N,1),N.m(n,null)),V&&V.p&&(!z||524288&r[1])&&d(V,U,e,e[50],z?h(U,e[50],r,null):p(e[50]),null),(!z||262144&r[0])&&A(m,"id",e[18]),(!z||512&r[0]&&g!==(g=e[9]?"0":void 0))&&A(m,"tabindex",g),(!z||512&r[0]&&y!==(y=e[9]?"region":void 0))&&A(m,"role",y),(!z||8389120&r[0]&&b!==(b=e[9]?e[23]:void 0))&&A(m,"aria-label",b),(!z||50331712&r[0]&&T!==(T=e[6]?e[25]:e[24]))&&A(m,"aria-labelledby",T),256&r[0]&&R(m,"bx--modal-content--with-form",e[8]),512&r[0]&&R(m,"bx--modal-scroll-content",e[9]),e[9]?G||(G=bs(),G.c(),G.m(i,E)):G&&(G.d(1),G=null),e[4]?q&&(oe(),le(q,1,1,(()=>{q=null})),se()):q?(q.p(e,r),16&r[0]&&ae(q,1)):(q=ws(e),q.c(),ae(q,1),q.m(i,null)),I(i,W=de(Z,[{role:"dialog"},{tabindex:"-1"},4194304&r[0]&&e[22],{"aria-modal":"true"},(!z||8388608&r[0])&&{"aria-label":e[23]}])),R(i,"bx--modal-container",!0),R(i,"bx--modal-container--xs","xs"===e[2]),R(i,"bx--modal-container--sm","sm"===e[2]),R(i,"bx--modal-container--lg","lg"===e[2]),I(t,X=de(H,[{role:"presentation"},(!z||131072&r[0])&&{id:e[17]},134217728&r[0]&&e[27]])),R(t,"bx--modal",!0),R(t,"bx--modal-tall",!e[4]),R(t,"is-visible",e[0]),R(t,"bx--modal--danger",e[3])},i(e){z||(ae(B),ae(O),ae($,e),ae(N),ae(V,e),ae(q),z=!0)},o(e){le(B),le(O),le($,e),le(N),le(V,e),le(q),z=!1},d(i){i&&x(t),B&&B.d(),O&&O.d(),$&&$.d(i),N&&N.d(),V&&V.d(i),G&&G.d(),q&&q.d(),e[44](null),e[46](null),L=!1,s(D)}}}function Is(e,t,i){let n,o,s,a;const l=["size","open","danger","alert","passiveModal","modalHeading","modalLabel","modalAriaLabel","iconDescription","hasForm","hasScrollingContent","primaryButtonText","primaryButtonDisabled","primaryButtonIcon","shouldSubmitOnEnter","secondaryButtonText","secondaryButtons","selectorPrimaryFocus","preventCloseOnClickOutside","id","ref"];let c=m(t,l),{$$slots:u={},$$scope:h}=t,{size:d}=t,{open:p=!1}=t,{danger:g=!1}=t,{alert:y=!1}=t,{passiveModal:_=!1}=t,{modalHeading:v}=t,{modalLabel:x}=t,{modalAriaLabel:b}=t,{iconDescription:w="Close the modal"}=t,{hasForm:T=!1}=t,{hasScrollingContent:S=!1}=t,{primaryButtonText:C=""}=t,{primaryButtonDisabled:M=!1}=t,{primaryButtonIcon:k}=t,{shouldSubmitOnEnter:E=!0}=t,{secondaryButtonText:A=""}=t,{secondaryButtons:I=[]}=t,{selectorPrimaryFocus:z="[data-modal-primary-focus]"}=t,{preventCloseOnClickOutside:P=!1}=t,{id:L="ccs-"+Math.random().toString(36)}=t,{ref:D=null}=t;const R=$();let B=null,O=null,N=!1,V=!1;var q;j((()=>()=>{document.body.classList.remove("bx--body--with-modal-open")})),q=()=>{N?p||(N=!1,R("close"),document.body.classList.remove("bx--body--with-modal-open")):p&&(N=!0,function(e){((e||O).querySelector(z)||B).focus()}(),R("open"),document.body.classList.add("bx--body--with-modal-open"))},F().$$.after_update.push(q);let Z={};return e.$$set=e=>{i(53,t=r(r({},t),f(e))),i(27,c=m(t,l)),"size"in e&&i(2,d=e.size),"open"in e&&i(0,p=e.open),"danger"in e&&i(3,g=e.danger),"alert"in e&&i(28,y=e.alert),"passiveModal"in e&&i(4,_=e.passiveModal),"modalHeading"in e&&i(5,v=e.modalHeading),"modalLabel"in e&&i(6,x=e.modalLabel),"modalAriaLabel"in e&&i(29,b=e.modalAriaLabel),"iconDescription"in e&&i(7,w=e.iconDescription),"hasForm"in e&&i(8,T=e.hasForm),"hasScrollingContent"in e&&i(9,S=e.hasScrollingContent),"primaryButtonText"in e&&i(10,C=e.primaryButtonText),"primaryButtonDisabled"in e&&i(11,M=e.primaryButtonDisabled),"primaryButtonIcon"in e&&i(12,k=e.primaryButtonIcon),"shouldSubmitOnEnter"in e&&i(13,E=e.shouldSubmitOnEnter),"secondaryButtonText"in e&&i(14,A=e.secondaryButtonText),"secondaryButtons"in e&&i(15,I=e.secondaryButtons),"selectorPrimaryFocus"in e&&i(30,z=e.selectorPrimaryFocus),"preventCloseOnClickOutside"in e&&i(16,P=e.preventCloseOnClickOutside),"id"in e&&i(17,L=e.id),"ref"in e&&i(1,D=e.ref),"$$scope"in e&&i(50,h=e.$$scope)},e.$$.update=()=>{131072&e.$$.dirty[0]&&i(25,n=`bx--modal-header__label--modal-${L}`),131072&e.$$.dirty[0]&&i(24,o=`bx--modal-header__heading--modal-${L}`),131072&e.$$.dirty[0]&&i(18,s=`bx--modal-body--${L}`),i(23,a=x||t["aria-label"]||b||v),268697616&e.$$.dirty[0]&&y&&(_&&i(22,Z.role="alert",Z),_||(i(22,Z.role="alertdialog",Z),i(22,Z["aria-describedby"]=s,Z)))},t=f(t),[p,D,d,g,_,v,x,w,T,S,C,M,k,E,A,I,P,L,s,B,O,V,Z,a,o,n,R,c,y,b,z,u,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{B=e,i(19,B)}))},()=>{i(0,p=!1)},function(e){G[e?"unshift":"push"]((()=>{B=e,i(19,B)}))},()=>{i(0,p=!1)},e=>{R("click:button--secondary",{text:e.text})},()=>{R("click:button--secondary",{text:A})},()=>{R("submit"),R("click:button--primary")},function(e){G[e?"unshift":"push"]((()=>{O=e,i(20,O)}))},()=>{i(21,V=!0)},function(e){G[e?"unshift":"push"]((()=>{D=e,i(1,D)}))},e=>{if(p)if("Escape"===e.key)i(0,p=!1);else if("Tab"===e.key){const t="\n  a[href], area[href], input:not([disabled]):not([tabindex='-1']),\n  button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),\n  textarea:not([disabled]):not([tabindex='-1']),\n  iframe, object, embed, *[tabindex]:not([tabindex='-1']):not([disabled]), *[contenteditable=true]\n",i=Array.from(D.querySelectorAll(t));let r=i.indexOf(document.activeElement);-1===r&&e.shiftKey&&(r=0),r+=i.length+(e.shiftKey?-1:1),r%=i.length,i[r].focus(),e.preventDefault()}else E&&"Enter"===e.key&&(R("submit"),R("click:button--primary"))},()=>{V||P||i(0,p=!1),i(21,V=!1)},e=>{"transform"===e.propertyName&&R("transitionend",{open:p})},h]}var zs=class extends ve{constructor(e){super(),_e(this,e,Is,As,l,{size:2,open:0,danger:3,alert:28,passiveModal:4,modalHeading:5,modalLabel:6,modalAriaLabel:29,iconDescription:7,hasForm:8,hasScrollingContent:9,primaryButtonText:10,primaryButtonDisabled:11,primaryButtonIcon:12,shouldSubmitOnEnter:13,secondaryButtonText:14,secondaryButtons:15,selectorPrimaryFocus:30,preventCloseOnClickOutside:16,id:17,ref:1},null,[-1,-1])}};function Ps(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function Ls(e){let t,n,o=e[1]&&Ps(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M17 15L17 8 15 8 15 15 8 15 8 17 15 17 15 24 17 24 17 17 24 17 24 15z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=Ps(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Ds(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var Rs=class extends ve{constructor(e){super(),_e(this,e,Ds,Ls,l,{size:0,title:1})}};function Bs(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function Os(e){let t,n,o=e[1]&&Bs(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M8 15H24V17H8z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=Bs(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Fs(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var js=class extends ve{constructor(e){super(),_e(this,e,Fs,Os,l,{size:0,title:1})}};function $s(e){let t,i;return{c(){t=T("title"),i=S(e[1])},m(e,r){v(e,t,r),_(t,i)},p(e,t){2&t&&P(i,e[1])},d(e){e&&x(t)}}}function Ns(e){let t,n,o=e[1]&&$s(e),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:e[0]},{height:e[0]},e[2],e[3]],a={};for(let e=0;e<s.length;e+=1)a=r(a,s[e]);return{c(){t=T("svg"),o&&o.c(),n=T("path"),A(n,"d","M30 28.6L3.4 2 2 3.4l10.1 10.1L4 21.6V28h6.4l8.1-8.1L28.6 30 30 28.6zM9.6 26H6v-3.6l7.5-7.5 3.6 3.6L9.6 26zM29.4 6.2L29.4 6.2l-3.6-3.6c-.8-.8-2-.8-2.8 0l0 0 0 0-8 8 1.4 1.4L20 8.4l3.6 3.6L20 15.6l1.4 1.4 8-8C30.2 8.2 30.2 7 29.4 6.2L29.4 6.2zM25 10.6L21.4 7l3-3L28 7.6 25 10.6z"),z(t,a)},m(e,i){v(e,t,i),o&&o.m(t,null),_(t,n)},p(e,[i]){e[1]?o?o.p(e,i):(o=$s(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),z(t,a=de(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},1&i&&{width:e[0]},1&i&&{height:e[0]},4&i&&e[2],8&i&&e[3]]))},i:i,o:i,d(e){e&&x(t),o&&o.d()}}}function Us(e,t,i){let n,o;const s=["size","title"];let a=m(t,s),{size:l=16}=t,{title:c}=t;return e.$$set=e=>{i(5,t=r(r({},t),f(e))),i(3,a=m(t,s)),"size"in e&&i(0,l=e.size),"title"in e&&i(1,c=e.title)},e.$$.update=()=>{i(4,n=t["aria-label"]||t["aria-labelledby"]||c),i(2,o={"aria-hidden":!n||void 0,role:n?"img":void 0,focusable:0===Number(t.tabindex)||void 0})},t=f(t),[l,c,o,a,n]}var Vs=class extends ve{constructor(e){super(),_e(this,e,Us,Ns,l,{size:0,title:1})}};const Gs=e=>({}),qs=e=>({});function Zs(e){let t,i;const r=e[34].label,n=c(r,e,e[33],qs),o=n||function(e){let t;return{c(){t=S(e[16])},m(e,i){v(e,t,i)},p(e,i){65536&i[0]&&P(t,e[16])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),o&&o.c(),A(t,"for",e[18]),R(t,"bx--label",!0),R(t,"bx--label--disabled",e[8]),R(t,"bx--visually-hidden",e[17])},m(e,r){v(e,t,r),o&&o.m(t,null),i=!0},p(e,s){n?n.p&&(!i||4&s[1])&&d(n,r,e,e[33],i?h(r,e[33],s,Gs):p(e[33]),qs):o&&o.p&&(!i||65536&s[0])&&o.p(e,i?s:[-1,-1]),(!i||262144&s[0])&&A(t,"for",e[18]),256&s[0]&&R(t,"bx--label--disabled",e[8]),131072&s[0]&&R(t,"bx--visually-hidden",e[17])},i(e){i||(ae(o,e),i=!0)},o(e){le(o,e),i=!1},d(e){e&&x(t),o&&o.d(e)}}}function Ws(e){let t,i;return t=new wo({props:{class:"bx--number__invalid"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Hs(e){let t,i;return t=new Mo({props:{class:"bx--number__invalid bx--number__invalid--warning"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Xs(e){let t,i;return t=new Vs({props:{class:"bx--text-input__readonly-icon"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Ks(e){let t,i,r,n,o,a,l,c,u,h,d,p,f,m,g,y,b;return r=new js({props:{class:"down-icon"}}),h=new Rs({props:{class:"up-icon"}}),{c(){t=w("div"),i=w("button"),me(r.$$.fragment),a=C(),l=w("div"),c=C(),u=w("button"),me(h.$$.fragment),f=C(),m=w("div"),A(i,"type","button"),A(i,"tabindex","-1"),A(i,"title",n=e[23]||e[10]),A(i,"aria-label",o=e[23]||e[10]),i.disabled=e[8],R(i,"bx--number__control-btn",!0),R(i,"down-icon",!0),R(l,"bx--number__rule-divider",!0),A(u,"type","button"),A(u,"tabindex","-1"),A(u,"title",d=e[24]||e[10]),A(u,"aria-label",p=e[24]||e[10]),u.disabled=e[8],R(u,"bx--number__control-btn",!0),R(u,"up-icon",!0),R(m,"bx--number__rule-divider",!0),R(t,"bx--number__controls",!0)},m(n,o){v(n,t,o),_(t,i),ge(r,i,null),_(t,a),_(t,l),_(t,c),_(t,u),ge(h,u,null),_(t,f),_(t,m),g=!0,y||(b=[k(i,"click",e[42]),k(u,"click",e[43])],y=!0)},p(e,t){(!g||8389632&t[0]&&n!==(n=e[23]||e[10]))&&A(i,"title",n),(!g||8389632&t[0]&&o!==(o=e[23]||e[10]))&&A(i,"aria-label",o),(!g||256&t[0])&&(i.disabled=e[8]),(!g||16778240&t[0]&&d!==(d=e[24]||e[10]))&&A(u,"title",d),(!g||16778240&t[0]&&p!==(p=e[24]||e[10]))&&A(u,"aria-label",p),(!g||256&t[0])&&(u.disabled=e[8])},i(e){g||(ae(r.$$.fragment,e),ae(h.$$.fragment,e),g=!0)},o(e){le(r.$$.fragment,e),le(h.$$.fragment,e),g=!1},d(e){e&&x(t),ye(r),ye(h),y=!1,s(b)}}}function Ys(e){let t,i;return{c(){t=w("div"),i=S(e[15]),R(t,"bx--form__helper-text",!0),R(t,"bx--form__helper-text--disabled",e[8])},m(e,r){v(e,t,r),_(t,i)},p(e,r){32768&r[0]&&P(i,e[15]),256&r[0]&&R(t,"bx--form__helper-text--disabled",e[8])},d(e){e&&x(t)}}}function Js(e){let t,i;return{c(){t=w("div"),i=S(e[12]),A(t,"id",e[21]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){4096&r[0]&&P(i,e[12]),2097152&r[0]&&A(t,"id",e[21])},d(e){e&&x(t)}}}function Qs(e){let t,i;return{c(){t=w("div"),i=S(e[14]),A(t,"id",e[21]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){16384&r[0]&&P(i,e[14]),2097152&r[0]&&A(t,"id",e[21])},d(e){e&&x(t)}}}function ea(e){let t,i,n,o,a,l,c,u,h,d,p,f,m,g,y,b,T,S,M,E,z,P=(e[28].label||e[16])&&Zs(e),L=[{type:"number"},{pattern:"[0-9]*"},{"aria-describedby":e[21]},{"data-invalid":l=e[11]||void 0},{"aria-invalid":c=e[11]||void 0},{"aria-label":u=e[16]?void 0:e[20]},{disabled:e[8]},{id:e[18]},{name:e[19]},{max:e[4]},{min:e[5]},{step:e[3]},{value:h=e[0]??""},{readOnly:e[7]},e[29]],D={};for(let e=0;e<L.length;e+=1)D=r(D,L[e]);let B=e[11]&&Ws(),O=!e[11]&&e[13]&&Hs(),F=e[7]&&Xs(),j=!e[9]&&Ks(e),$=!e[22]&&!e[13]&&e[15]&&Ys(e),N=e[22]&&Js(e),U=!e[22]&&e[13]&&Qs(e);return{c(){t=w("div"),i=w("div"),P&&P.c(),n=C(),o=w("div"),a=w("input"),d=C(),B&&B.c(),p=C(),O&&O.c(),f=C(),F&&F.c(),m=C(),j&&j.c(),g=C(),$&&$.c(),y=C(),N&&N.c(),b=C(),U&&U.c(),I(a,D),R(o,"bx--number__input-wrapper",!0),R(o,"bx--number__input-wrapper--warning",!e[11]&&e[13]),A(i,"data-invalid",T=e[22]||void 0),A(i,"class",S=e[2]&&`bx--number--${e[2]}`),R(i,"bx--number",!0),R(i,"bx--number--helpertext",!0),R(i,"bx--number--readonly",e[7]),R(i,"bx--number--light",e[6]),R(i,"bx--number--nolabel",e[17]),R(i,"bx--number--nosteppers",e[9]),R(t,"bx--form-item",!0)},m(r,s){v(r,t,s),_(t,i),P&&P.m(i,null),_(i,n),_(i,o),_(o,a),a.autofocus&&a.focus(),e[41](a),_(o,d),B&&B.m(o,null),_(o,p),O&&O.m(o,null),_(o,f),F&&F.m(o,null),_(o,m),j&&j.m(o,null),_(i,g),$&&$.m(i,null),_(i,y),N&&N.m(i,null),_(i,b),U&&U.m(i,null),M=!0,E||(z=[k(a,"change",e[27]),k(a,"input",e[26]),k(a,"focus",e[39]),k(a,"blur",e[40]),k(t,"click",e[35]),k(t,"mouseover",e[36]),k(t,"mouseenter",e[37]),k(t,"mouseleave",e[38])],E=!0)},p(e,t){e[28].label||e[16]?P?(P.p(e,t),268500992&t[0]&&ae(P,1)):(P=Zs(e),P.c(),ae(P,1),P.m(i,n)):P&&(oe(),le(P,1,1,(()=>{P=null})),se()),I(a,D=de(L,[{type:"number"},{pattern:"[0-9]*"},(!M||2097152&t[0])&&{"aria-describedby":e[21]},(!M||2048&t[0]&&l!==(l=e[11]||void 0))&&{"data-invalid":l},(!M||2048&t[0]&&c!==(c=e[11]||void 0))&&{"aria-invalid":c},(!M||1114112&t[0]&&u!==(u=e[16]?void 0:e[20]))&&{"aria-label":u},(!M||256&t[0])&&{disabled:e[8]},(!M||262144&t[0])&&{id:e[18]},(!M||524288&t[0])&&{name:e[19]},(!M||16&t[0])&&{max:e[4]},(!M||32&t[0])&&{min:e[5]},(!M||8&t[0])&&{step:e[3]},(!M||1&t[0]&&h!==(h=e[0]??"")&&a.value!==h)&&{value:h},(!M||128&t[0])&&{readOnly:e[7]},536870912&t[0]&&e[29]])),e[11]?B?2048&t[0]&&ae(B,1):(B=Ws(),B.c(),ae(B,1),B.m(o,p)):B&&(oe(),le(B,1,1,(()=>{B=null})),se()),!e[11]&&e[13]?O?10240&t[0]&&ae(O,1):(O=Hs(),O.c(),ae(O,1),O.m(o,f)):O&&(oe(),le(O,1,1,(()=>{O=null})),se()),e[7]?F?128&t[0]&&ae(F,1):(F=Xs(),F.c(),ae(F,1),F.m(o,m)):F&&(oe(),le(F,1,1,(()=>{F=null})),se()),e[9]?j&&(oe(),le(j,1,1,(()=>{j=null})),se()):j?(j.p(e,t),512&t[0]&&ae(j,1)):(j=Ks(e),j.c(),ae(j,1),j.m(o,null)),10240&t[0]&&R(o,"bx--number__input-wrapper--warning",!e[11]&&e[13]),e[22]||e[13]||!e[15]?$&&($.d(1),$=null):$?$.p(e,t):($=Ys(e),$.c(),$.m(i,y)),e[22]?N?N.p(e,t):(N=Js(e),N.c(),N.m(i,b)):N&&(N.d(1),N=null),!e[22]&&e[13]?U?U.p(e,t):(U=Qs(e),U.c(),U.m(i,null)):U&&(U.d(1),U=null),(!M||4194304&t[0]&&T!==(T=e[22]||void 0))&&A(i,"data-invalid",T),(!M||4&t[0]&&S!==(S=e[2]&&`bx--number--${e[2]}`))&&A(i,"class",S),4&t[0]&&R(i,"bx--number",!0),4&t[0]&&R(i,"bx--number--helpertext",!0),132&t[0]&&R(i,"bx--number--readonly",e[7]),68&t[0]&&R(i,"bx--number--light",e[6]),131076&t[0]&&R(i,"bx--number--nolabel",e[17]),516&t[0]&&R(i,"bx--number--nosteppers",e[9])},i(e){M||(ae(P),ae(B),ae(O),ae(F),ae(j),M=!0)},o(e){le(P),le(B),le(O),le(F),le(j),M=!1},d(i){i&&x(t),P&&P.d(),e[41](null),B&&B.d(),O&&O.d(),F&&F.d(),j&&j.d(),$&&$.d(),N&&N.d(),U&&U.d(),E=!1,s(z)}}}function ta(e){return""!=e?Number(e):null}function ia(e,t,i){let n,o,s,a,l;const c=["size","value","step","max","min","light","readonly","allowEmpty","disabled","hideSteppers","iconDescription","invalid","invalidText","warn","warnText","helperText","label","hideLabel","translateWithId","translationIds","id","name","ref"];let u=m(t,c),{$$slots:h={},$$scope:d}=t;const p=g(h);let{size:y}=t,{value:_=null}=t,{step:v=1}=t,{max:x}=t,{min:b}=t,{light:w=!1}=t,{readonly:T=!1}=t,{allowEmpty:S=!1}=t,{disabled:C=!1}=t,{hideSteppers:M=!1}=t,{iconDescription:k=""}=t,{invalid:E=!1}=t,{invalidText:A=""}=t,{warn:I=!1}=t,{warnText:z=""}=t,{helperText:P=""}=t,{label:L=""}=t,{hideLabel:D=!1}=t,{translateWithId:R=(e=>N[e])}=t;const B={increment:"increment",decrement:"decrement"};let{id:O="ccs-"+Math.random().toString(36)}=t,{name:F}=t,{ref:j=null}=t;const N={[B.increment]:"Increment number",[B.decrement]:"Decrement number"},V=$();function q(e){const t=i(0,_+=e*v);i(0,_=t<b?b:t>x?x:t),V("input",_),V("change",_)}return e.$$set=e=>{i(46,t=r(r({},t),f(e))),i(29,u=m(t,c)),"size"in e&&i(2,y=e.size),"value"in e&&i(0,_=e.value),"step"in e&&i(3,v=e.step),"max"in e&&i(4,x=e.max),"min"in e&&i(5,b=e.min),"light"in e&&i(6,w=e.light),"readonly"in e&&i(7,T=e.readonly),"allowEmpty"in e&&i(30,S=e.allowEmpty),"disabled"in e&&i(8,C=e.disabled),"hideSteppers"in e&&i(9,M=e.hideSteppers),"iconDescription"in e&&i(10,k=e.iconDescription),"invalid"in e&&i(11,E=e.invalid),"invalidText"in e&&i(12,A=e.invalidText),"warn"in e&&i(13,I=e.warn),"warnText"in e&&i(14,z=e.warnText),"helperText"in e&&i(15,P=e.helperText),"label"in e&&i(16,L=e.label),"hideLabel"in e&&i(17,D=e.hideLabel),"translateWithId"in e&&i(31,R=e.translateWithId),"id"in e&&i(18,O=e.id),"name"in e&&i(19,F=e.name),"ref"in e&&i(1,j=e.ref),"$$scope"in e&&i(33,d=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty[1]&&i(24,n=R("increment")),1&e.$$.dirty[1]&&i(23,o=R("decrement")),1073743921&e.$$.dirty[0]&&i(22,s=E||!S&&null==_||_>x||_<b),262144&e.$$.dirty[0]&&i(21,a=`error-${O}`),i(20,l=t["aria-label"]||"Numeric input field with increment and decrement buttons")},t=f(t),[_,j,y,v,x,b,w,T,C,M,k,E,A,I,z,P,L,D,O,F,l,a,s,o,n,q,function({target:e}){i(0,_=ta(e.value)),V("input",_)},function({target:e}){V("change",ta(e.value))},p,u,S,R,B,d,h,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{j=e,i(1,j)}))},()=>{q(-1)},()=>{q(1)}]}var ra=class extends ve{constructor(e){super(),_e(this,e,ia,ea,l,{size:2,value:0,step:3,max:4,min:5,light:6,readonly:7,allowEmpty:30,disabled:8,hideSteppers:9,iconDescription:10,invalid:11,invalidText:12,warn:13,warnText:14,helperText:15,label:16,hideLabel:17,translateWithId:31,translationIds:32,id:18,name:19,ref:1},null,[-1,-1])}get translationIds(){return this.$$.ctx[32]}};const na=e=>({}),oa=e=>({});function sa(e){let t,i,n,o,a,l,u,f,m,g,y,b,T,M,E,z,L,B,O,F,j,$,N,U,V,G,q,Z,W,H,X=(e[5]||e[4])+"",K=(e[3]||e[2])+"";const Y=e[30].labelText,J=c(Y,e,e[29],oa),Q=J||function(e){let t;return{c(){t=S(e[15])},m(e,i){v(e,t,i)},p(e,i){32768&i[0]&&P(t,e[15])},d(e){e&&x(t)}}}(e);let ee=[e[25]],te={};for(let e=0;e<ee.length;e+=1)te=r(te,ee[e]);return{c(){t=w("div"),i=w("label"),Q&&Q.c(),n=C(),o=w("div"),a=w("span"),l=S(X),u=C(),f=w("div"),m=w("div"),g=C(),y=w("div"),b=C(),T=w("div"),M=C(),E=w("input"),z=C(),L=w("span"),B=S(K),O=C(),F=w("input"),A(i,"for",e[13]),A(i,"id",e[20]),R(i,"bx--label",!0),R(i,"bx--label--disabled",e[10]),R(a,"bx--slider__range-label",!0),A(m,"role","slider"),A(m,"tabindex","0"),D(m,"left",e[19]+"%"),A(m,"aria-valuemax",e[2]),A(m,"aria-valuemin",e[4]),A(m,"aria-valuenow",e[0]),A(m,"id",e[13]),R(m,"bx--slider__thumb",!0),R(y,"bx--slider__track",!0),D(T,"transform","translate(0, -50%) scaleX("+e[19]/100+")"),R(T,"bx--slider__filled-track",!0),A(E,"type","hidden"),A(E,"name",e[16]),E.value=e[0],E.required=e[8],A(E,"min",e[4]),A(E,"max",e[2]),A(E,"step",e[6]),R(E,"bx--slider__input",!0),A(f,"role","presentation"),A(f,"tabindex","-1"),R(f,"bx--slider",!0),R(f,"bx--slider--disabled",e[10]),R(L,"bx--slider__range-label",!0),A(F,"type",j=e[12]?"hidden":e[9]),A(F,"style",$=e[12]?"display: none":void 0),A(F,"id",N="input-"+e[13]),A(F,"name",e[16]),F.value=e[0],A(F,"aria-labelledby",U=e[26]["aria-label"]?void 0:e[20]),A(F,"aria-label",V=e[26]["aria-label"]||"Slider number input"),F.disabled=e[10],F.required=e[8],A(F,"min",e[4]),A(F,"max",e[2]),A(F,"step",e[6]),A(F,"data-invalid",G=e[14]||null),A(F,"aria-invalid",q=e[14]||null),R(F,"bx--text-input",!0),R(F,"bx--slider-text-input",!0),R(F,"bx--text-input--light",e[11]),R(F,"bx--text-input--invalid",e[14]),R(o,"bx--slider-container",!0),I(t,te),R(t,"bx--form-item",!0)},m(r,s){v(r,t,s),_(t,i),Q&&Q.m(i,null),_(t,n),_(t,o),_(o,a),_(a,l),_(o,u),_(o,f),_(f,m),_(f,g),_(f,y),e[35](y),_(f,b),_(f,T),_(f,M),_(f,E),e[36](f),_(o,z),_(o,L),_(L,B),_(o,O),_(o,F),Z=!0,W||(H=[k(window,"mousemove",e[24]),k(window,"touchmove",e[24]),k(window,"mouseup",e[23]),k(window,"touchend",e[23]),k(window,"touchcancel",e[23]),k(f,"mousedown",e[21]),k(f,"mousedown",e[22]),k(f,"touchstart",e[22],{passive:!0}),k(f,"keydown",e[37]),k(F,"change",e[38]),k(t,"click",e[31]),k(t,"mouseover",e[32]),k(t,"mouseenter",e[33]),k(t,"mouseleave",e[34])],W=!0)},p(e,r){J?J.p&&(!Z||536870912&r[0])&&d(J,Y,e,e[29],Z?h(Y,e[29],r,na):p(e[29]),oa):Q&&Q.p&&(!Z||32768&r[0])&&Q.p(e,Z?r:[-1,-1]),(!Z||8192&r[0])&&A(i,"for",e[13]),(!Z||1048576&r[0])&&A(i,"id",e[20]),1024&r[0]&&R(i,"bx--label--disabled",e[10]),(!Z||48&r[0])&&X!==(X=(e[5]||e[4])+"")&&P(l,X),(!Z||524288&r[0])&&D(m,"left",e[19]+"%"),(!Z||4&r[0])&&A(m,"aria-valuemax",e[2]),(!Z||16&r[0])&&A(m,"aria-valuemin",e[4]),(!Z||1&r[0])&&A(m,"aria-valuenow",e[0]),(!Z||8192&r[0])&&A(m,"id",e[13]),(!Z||524288&r[0])&&D(T,"transform","translate(0, -50%) scaleX("+e[19]/100+")"),(!Z||65536&r[0])&&A(E,"name",e[16]),(!Z||1&r[0])&&(E.value=e[0]),(!Z||256&r[0])&&(E.required=e[8]),(!Z||16&r[0])&&A(E,"min",e[4]),(!Z||4&r[0])&&A(E,"max",e[2]),(!Z||64&r[0])&&A(E,"step",e[6]),1024&r[0]&&R(f,"bx--slider--disabled",e[10]),(!Z||12&r[0])&&K!==(K=(e[3]||e[2])+"")&&P(B,K),(!Z||4608&r[0]&&j!==(j=e[12]?"hidden":e[9]))&&A(F,"type",j),(!Z||4096&r[0]&&$!==($=e[12]?"display: none":void 0))&&A(F,"style",$),(!Z||8192&r[0]&&N!==(N="input-"+e[13]))&&A(F,"id",N),(!Z||65536&r[0])&&A(F,"name",e[16]),(!Z||1&r[0]&&F.value!==e[0])&&(F.value=e[0]),(!Z||68157440&r[0]&&U!==(U=e[26]["aria-label"]?void 0:e[20]))&&A(F,"aria-labelledby",U),(!Z||67108864&r[0]&&V!==(V=e[26]["aria-label"]||"Slider number input"))&&A(F,"aria-label",V),(!Z||1024&r[0])&&(F.disabled=e[10]),(!Z||256&r[0])&&(F.required=e[8]),(!Z||16&r[0])&&A(F,"min",e[4]),(!Z||4&r[0])&&A(F,"max",e[2]),(!Z||64&r[0])&&A(F,"step",e[6]),(!Z||16384&r[0]&&G!==(G=e[14]||null))&&A(F,"data-invalid",G),(!Z||16384&r[0]&&q!==(q=e[14]||null))&&A(F,"aria-invalid",q),2048&r[0]&&R(F,"bx--text-input--light",e[11]),16384&r[0]&&R(F,"bx--text-input--invalid",e[14]),I(t,te=de(ee,[33554432&r[0]&&e[25]])),R(t,"bx--form-item",!0)},i(e){Z||(ae(Q,e),Z=!0)},o(e){le(Q,e),Z=!1},d(i){i&&x(t),Q&&Q.d(i),e[35](null),e[36](null),W=!1,s(H)}}}function aa(e,t,i){let n,o,s;const a=["value","max","maxLabel","min","minLabel","step","stepMultiplier","required","inputType","disabled","light","hideTextInput","id","invalid","labelText","name","ref"];let l=m(t,a),{$$slots:c={},$$scope:u}=t,{value:h=0}=t,{max:d=100}=t,{maxLabel:p=""}=t,{min:g=0}=t,{minLabel:y=""}=t,{step:_=1}=t,{stepMultiplier:v=4}=t,{required:x=!1}=t,{inputType:b="number"}=t,{disabled:w=!1}=t,{light:T=!1}=t,{hideTextInput:S=!1}=t,{id:C="ccs-"+Math.random().toString(36)}=t,{invalid:M=!1}=t,{labelText:k=""}=t,{name:E=""}=t,{ref:A=null}=t;const I=$();let z=null,P=!1,L=!1;function D(){i(27,P=!0)}return e.$$set=e=>{i(26,t=r(r({},t),f(e))),i(25,l=m(t,a)),"value"in e&&i(0,h=e.value),"max"in e&&i(2,d=e.max),"maxLabel"in e&&i(3,p=e.maxLabel),"min"in e&&i(4,g=e.min),"minLabel"in e&&i(5,y=e.minLabel),"step"in e&&i(6,_=e.step),"stepMultiplier"in e&&i(7,v=e.stepMultiplier),"required"in e&&i(8,x=e.required),"inputType"in e&&i(9,b=e.inputType),"disabled"in e&&i(10,w=e.disabled),"light"in e&&i(11,T=e.light),"hideTextInput"in e&&i(12,S=e.hideTextInput),"id"in e&&i(13,C=e.id),"invalid"in e&&i(14,M=e.invalid),"labelText"in e&&i(15,k=e.labelText),"name"in e&&i(16,E=e.name),"ref"in e&&i(1,A=e.ref),"$$scope"in e&&i(29,u=e.$$scope)},e.$$.update=()=>{8192&e.$$.dirty[0]&&i(20,n=`label-${C}`),20&e.$$.dirty[0]&&i(17,o=d-g),402654229&e.$$.dirty[0]&&(h<=g?i(0,h=g):h>=d&&i(0,h=d),P&&(!function(e){if(w)return;const t=e.touches?e.touches[0].clientX:e.clientX,{left:r,width:n}=z.getBoundingClientRect();let o=g+Math.round((t-r)/n*(d-g)/_)*_;o<=g?o=g:o>=d&&(o=d),i(0,h=o)}(event),i(27,P=!1)),L||w||I("change",h)),131089&e.$$.dirty[0]&&i(19,s=(h-g)/o*100)},t=f(t),[h,A,d,p,g,y,_,v,x,b,w,T,S,C,M,k,E,o,z,s,n,D,function(){i(28,L=!0)},function(){i(28,L=!1),i(27,P=!1)},function(){L&&D()},l,t,P,L,u,c,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{z=e,i(18,z)}))},function(e){G[e?"unshift":"push"]((()=>{A=e,i(1,A)}))},({shiftKey:e,key:t})=>{const r={ArrowDown:-1,ArrowLeft:-1,ArrowRight:1,ArrowUp:1};r[t]&&i(0,h+=_*(e?o/_/v:1)*r[t])},({target:e})=>{i(0,h=Number(e.value))}]}var la=class extends ve{constructor(e){super(),_e(this,e,aa,sa,l,{value:0,max:2,maxLabel:3,min:4,minLabel:5,step:6,stepMultiplier:7,required:8,inputType:9,disabled:10,light:11,hideTextInput:12,id:13,invalid:14,labelText:15,name:16,ref:1},null,[-1,-1])}};const ca=e=>({}),ua=e=>({}),ha=e=>({}),da=e=>({});function pa(e){let t,i,r,n=e[9]&&fa(e),o=!e[20]&&e[6]&&ma(e);return{c(){t=w("div"),n&&n.c(),i=C(),o&&o.c(),R(t,"bx--text-input__label-helper-wrapper",!0)},m(e,s){v(e,t,s),n&&n.m(t,null),_(t,i),o&&o.m(t,null),r=!0},p(e,r){e[9]?n?(n.p(e,r),512&r[0]&&ae(n,1)):(n=fa(e),n.c(),ae(n,1),n.m(t,i)):n&&(oe(),le(n,1,1,(()=>{n=null})),se()),!e[20]&&e[6]?o?o.p(e,r):(o=ma(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},i(e){r||(ae(n),r=!0)},o(e){le(n),r=!1},d(e){e&&x(t),n&&n.d(),o&&o.d()}}}function fa(e){let t,i,r;const n=e[26].labelText,o=c(n,e,e[25],da),s=o||function(e){let t;return{c(){t=S(e[9])},m(e,i){v(e,t,i)},p(e,i){512&i[0]&&P(t,e[9])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),s&&s.c(),A(t,"for",e[7]),A(t,"class",i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`),R(t,"bx--label",!0),R(t,"bx--visually-hidden",e[10]),R(t,"bx--label--disabled",e[5]),R(t,"bx--label--inline",e[16])},m(e,i){v(e,t,i),s&&s.m(t,null),r=!0},p(e,a){o?o.p&&(!r||33554432&a[0])&&d(o,n,e,e[25],r?h(n,e[25],a,ha):p(e[25]),da):s&&s.p&&(!r||512&a[0])&&s.p(e,r?a:[-1,-1]),(!r||128&a[0])&&A(t,"for",e[7]),(!r||65540&a[0]&&i!==(i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`))&&A(t,"class",i),65540&a[0]&&R(t,"bx--label",!0),66564&a[0]&&R(t,"bx--visually-hidden",e[10]),65572&a[0]&&R(t,"bx--label--disabled",e[5]),65540&a[0]&&R(t,"bx--label--inline",e[16])},i(e){r||(ae(s,e),r=!0)},o(e){le(s,e),r=!1},d(e){e&&x(t),s&&s.d(e)}}}function ma(e){let t,i;return{c(){t=w("div"),i=S(e[6]),R(t,"bx--form__helper-text",!0),R(t,"bx--form__helper-text--disabled",e[5]),R(t,"bx--form__helper-text--inline",e[16])},m(e,r){v(e,t,r),_(t,i)},p(e,r){64&r[0]&&P(i,e[6]),32&r[0]&&R(t,"bx--form__helper-text--disabled",e[5]),65536&r[0]&&R(t,"bx--form__helper-text--inline",e[16])},d(e){e&&x(t)}}}function ga(e){let t,i,r;const n=e[26].labelText,o=c(n,e,e[25],ua),s=o||function(e){let t;return{c(){t=S(e[9])},m(e,i){v(e,t,i)},p(e,i){512&i[0]&&P(t,e[9])},d(e){e&&x(t)}}}(e);return{c(){t=w("label"),s&&s.c(),A(t,"for",e[7]),A(t,"class",i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`),R(t,"bx--label",!0),R(t,"bx--visually-hidden",e[10]),R(t,"bx--label--disabled",e[5]),R(t,"bx--label--inline",e[16])},m(e,i){v(e,t,i),s&&s.m(t,null),r=!0},p(e,a){o?o.p&&(!r||33554432&a[0])&&d(o,n,e,e[25],r?h(n,e[25],a,ca):p(e[25]),ua):s&&s.p&&(!r||512&a[0])&&s.p(e,r?a:[-1,-1]),(!r||128&a[0])&&A(t,"for",e[7]),(!r||65540&a[0]&&i!==(i=e[16]&&!!e[2]&&`bx--label--inline--${e[2]}`))&&A(t,"class",i),65540&a[0]&&R(t,"bx--label",!0),66564&a[0]&&R(t,"bx--visually-hidden",e[10]),65572&a[0]&&R(t,"bx--label--disabled",e[5]),65540&a[0]&&R(t,"bx--label--inline",e[16])},i(e){r||(ae(s,e),r=!0)},o(e){le(s,e),r=!1},d(e){e&&x(t),s&&s.d(e)}}}function ya(e){let t,i;return t=new wo({props:{class:"bx--text-input__invalid-icon"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function _a(e){let t,i;return t=new Mo({props:{class:"bx--text-input__invalid-icon\n            bx--text-input__invalid-icon--warning"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function va(e){let t,i;return t=new Vs({props:{class:"bx--text-input__readonly-icon"}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function xa(e){let t;return{c(){t=w("hr"),R(t,"bx--text-input__divider",!0)},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function ba(e){let t,i;return{c(){t=w("div"),i=S(e[12]),A(t,"id",e[19]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){4096&r[0]&&P(i,e[12]),524288&r[0]&&A(t,"id",e[19])},d(e){e&&x(t)}}}function wa(e){let t,i;return{c(){t=w("div"),i=S(e[14]),A(t,"id",e[18]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){16384&r[0]&&P(i,e[14]),262144&r[0]&&A(t,"id",e[18])},d(e){e&&x(t)}}}function Ta(e){let t,i;return{c(){t=w("div"),i=S(e[6]),R(t,"bx--form__helper-text",!0),R(t,"bx--form__helper-text--disabled",e[5]),R(t,"bx--form__helper-text--inline",e[16])},m(e,r){v(e,t,r),_(t,i)},p(e,r){64&r[0]&&P(i,e[6]),32&r[0]&&R(t,"bx--form__helper-text--disabled",e[5]),65536&r[0]&&R(t,"bx--form__helper-text--inline",e[16])},d(e){e&&x(t)}}}function Sa(e){let t,i;return{c(){t=w("div"),i=S(e[12]),A(t,"id",e[19]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){4096&r[0]&&P(i,e[12]),524288&r[0]&&A(t,"id",e[19])},d(e){e&&x(t)}}}function Ca(e){let t,i;return{c(){t=w("div"),i=S(e[14]),A(t,"id",e[18]),R(t,"bx--form-requirement",!0)},m(e,r){v(e,t,r),_(t,i)},p(e,r){16384&r[0]&&P(i,e[14]),262144&r[0]&&A(t,"id",e[18])},d(e){e&&x(t)}}}function Ma(e){let t,i,n,o,a,l,c,u,h,d,p,f,m,g,y,b,T,S,M,E,z,P,D,B,O,F=e[16]&&pa(e),j=!e[16]&&(e[9]||e[24].labelText)&&ga(e),$=e[11]&&ya(),N=!e[11]&&e[13]&&_a(),U=e[17]&&va(),V=[{"data-invalid":d=e[11]||void 0},{"aria-invalid":p=e[11]||void 0},{"data-warn":f=e[13]||void 0},{"aria-describedby":m=e[11]?e[19]:e[13]?e[18]:void 0},{disabled:e[5]},{id:e[7]},{name:e[8]},{placeholder:e[3]},{required:e[15]},{readOnly:e[17]},e[23],{class:g=e[2]&&`bx--text-input--${e[2]}`}],G={};for(let e=0;e<V.length;e+=1)G=r(G,V[e]);let q=e[20]&&xa(),Z=e[20]&&!e[16]&&e[11]&&ba(e),W=e[20]&&!e[16]&&e[13]&&wa(e),H=!e[11]&&!e[13]&&!e[20]&&!e[16]&&e[6]&&Ta(e),X=!e[20]&&e[11]&&Sa(e),K=!e[20]&&!e[11]&&e[13]&&Ca(e);return{c(){t=w("div"),F&&F.c(),i=C(),j&&j.c(),n=C(),o=w("div"),a=w("div"),$&&$.c(),l=C(),N&&N.c(),c=C(),U&&U.c(),u=C(),h=w("input"),y=C(),q&&q.c(),b=C(),Z&&Z.c(),T=C(),W&&W.c(),E=C(),H&&H.c(),z=C(),X&&X.c(),P=C(),K&&K.c(),I(h,G),R(h,"bx--text-input",!0),R(h,"bx--text-input--light",e[4]),R(h,"bx--text-input--invalid",e[11]),R(h,"bx--text-input--warn",e[13]),A(a,"data-invalid",S=e[11]||void 0),A(a,"data-warn",M=e[13]||void 0),R(a,"bx--text-input__field-wrapper",!0),R(a,"bx--text-input__field-wrapper--warning",!e[11]&&e[13]),R(o,"bx--text-input__field-outer-wrapper",!0),R(o,"bx--text-input__field-outer-wrapper--inline",e[16]),R(t,"bx--form-item",!0),R(t,"bx--text-input-wrapper",!0),R(t,"bx--text-input-wrapper--inline",e[16]),R(t,"bx--text-input-wrapper--light",e[4]),R(t,"bx--text-input-wrapper--readonly",e[17])},m(r,s){v(r,t,s),F&&F.m(t,null),_(t,i),j&&j.m(t,null),_(t,n),_(t,o),_(o,a),$&&$.m(a,null),_(a,l),N&&N.m(a,null),_(a,c),U&&U.m(a,null),_(a,u),_(a,h),h.autofocus&&h.focus(),e[35](h),L(h,e[0]),_(a,y),q&&q.m(a,null),_(a,b),Z&&Z.m(a,null),_(a,T),W&&W.m(a,null),_(o,E),H&&H.m(o,null),_(o,z),X&&X.m(o,null),_(o,P),K&&K.m(o,null),D=!0,B||(O=[k(h,"input",e[36]),k(h,"change",e[22]),k(h,"input",e[21]),k(h,"keydown",e[31]),k(h,"keyup",e[32]),k(h,"focus",e[33]),k(h,"blur",e[34]),k(t,"click",e[27]),k(t,"mouseover",e[28]),k(t,"mouseenter",e[29]),k(t,"mouseleave",e[30])],B=!0)},p(e,r){e[16]?F?(F.p(e,r),65536&r[0]&&ae(F,1)):(F=pa(e),F.c(),ae(F,1),F.m(t,i)):F&&(oe(),le(F,1,1,(()=>{F=null})),se()),e[16]||!e[9]&&!e[24].labelText?j&&(oe(),le(j,1,1,(()=>{j=null})),se()):j?(j.p(e,r),16843264&r[0]&&ae(j,1)):(j=ga(e),j.c(),ae(j,1),j.m(t,n)),e[11]?$?2048&r[0]&&ae($,1):($=ya(),$.c(),ae($,1),$.m(a,l)):$&&(oe(),le($,1,1,(()=>{$=null})),se()),!e[11]&&e[13]?N?10240&r[0]&&ae(N,1):(N=_a(),N.c(),ae(N,1),N.m(a,c)):N&&(oe(),le(N,1,1,(()=>{N=null})),se()),e[17]?U?131072&r[0]&&ae(U,1):(U=va(),U.c(),ae(U,1),U.m(a,u)):U&&(oe(),le(U,1,1,(()=>{U=null})),se()),I(h,G=de(V,[(!D||2048&r[0]&&d!==(d=e[11]||void 0))&&{"data-invalid":d},(!D||2048&r[0]&&p!==(p=e[11]||void 0))&&{"aria-invalid":p},(!D||8192&r[0]&&f!==(f=e[13]||void 0))&&{"data-warn":f},(!D||796672&r[0]&&m!==(m=e[11]?e[19]:e[13]?e[18]:void 0))&&{"aria-describedby":m},(!D||32&r[0])&&{disabled:e[5]},(!D||128&r[0])&&{id:e[7]},(!D||256&r[0])&&{name:e[8]},(!D||8&r[0])&&{placeholder:e[3]},(!D||32768&r[0])&&{required:e[15]},(!D||131072&r[0])&&{readOnly:e[17]},8388608&r[0]&&e[23],(!D||4&r[0]&&g!==(g=e[2]&&`bx--text-input--${e[2]}`))&&{class:g}])),1&r[0]&&h.value!==e[0]&&L(h,e[0]),R(h,"bx--text-input",!0),R(h,"bx--text-input--light",e[4]),R(h,"bx--text-input--invalid",e[11]),R(h,"bx--text-input--warn",e[13]),e[20]?q||(q=xa(),q.c(),q.m(a,b)):q&&(q.d(1),q=null),e[20]&&!e[16]&&e[11]?Z?Z.p(e,r):(Z=ba(e),Z.c(),Z.m(a,T)):Z&&(Z.d(1),Z=null),e[20]&&!e[16]&&e[13]?W?W.p(e,r):(W=wa(e),W.c(),W.m(a,null)):W&&(W.d(1),W=null),(!D||2048&r[0]&&S!==(S=e[11]||void 0))&&A(a,"data-invalid",S),(!D||8192&r[0]&&M!==(M=e[13]||void 0))&&A(a,"data-warn",M),10240&r[0]&&R(a,"bx--text-input__field-wrapper--warning",!e[11]&&e[13]),e[11]||e[13]||e[20]||e[16]||!e[6]?H&&(H.d(1),H=null):H?H.p(e,r):(H=Ta(e),H.c(),H.m(o,z)),!e[20]&&e[11]?X?X.p(e,r):(X=Sa(e),X.c(),X.m(o,P)):X&&(X.d(1),X=null),e[20]||e[11]||!e[13]?K&&(K.d(1),K=null):K?K.p(e,r):(K=Ca(e),K.c(),K.m(o,null)),65536&r[0]&&R(o,"bx--text-input__field-outer-wrapper--inline",e[16]),65536&r[0]&&R(t,"bx--text-input-wrapper--inline",e[16]),16&r[0]&&R(t,"bx--text-input-wrapper--light",e[4]),131072&r[0]&&R(t,"bx--text-input-wrapper--readonly",e[17])},i(e){D||(ae(F),ae(j),ae($),ae(N),ae(U),D=!0)},o(e){le(F),le(j),le($),le(N),le(U),D=!1},d(i){i&&x(t),F&&F.d(),j&&j.d(),$&&$.d(),N&&N.d(),U&&U.d(),e[35](null),q&&q.d(),Z&&Z.d(),W&&W.d(),H&&H.d(),X&&X.d(),K&&K.d(),B=!1,s(O)}}}function ka(e,t,i){let n,o,s;const a=["size","value","placeholder","light","disabled","helperText","id","name","labelText","hideLabel","invalid","invalidText","warn","warnText","ref","required","inline","readonly"];let l=m(t,a),{$$slots:c={},$$scope:u}=t;const h=g(c);let{size:d}=t,{value:p=""}=t,{placeholder:y=""}=t,{light:_=!1}=t,{disabled:v=!1}=t,{helperText:x=""}=t,{id:b="ccs-"+Math.random().toString(36)}=t,{name:w}=t,{labelText:T=""}=t,{hideLabel:S=!1}=t,{invalid:C=!1}=t,{invalidText:M=""}=t,{warn:k=!1}=t,{warnText:E=""}=t,{ref:A=null}=t,{required:I=!1}=t,{inline:z=!1}=t,{readonly:P=!1}=t;const L=N("Form"),D=$();function R(e){return"number"!==l.type?e:""!=e?Number(e):null}return e.$$set=e=>{t=r(r({},t),f(e)),i(23,l=m(t,a)),"size"in e&&i(2,d=e.size),"value"in e&&i(0,p=e.value),"placeholder"in e&&i(3,y=e.placeholder),"light"in e&&i(4,_=e.light),"disabled"in e&&i(5,v=e.disabled),"helperText"in e&&i(6,x=e.helperText),"id"in e&&i(7,b=e.id),"name"in e&&i(8,w=e.name),"labelText"in e&&i(9,T=e.labelText),"hideLabel"in e&&i(10,S=e.hideLabel),"invalid"in e&&i(11,C=e.invalid),"invalidText"in e&&i(12,M=e.invalidText),"warn"in e&&i(13,k=e.warn),"warnText"in e&&i(14,E=e.warnText),"ref"in e&&i(1,A=e.ref),"required"in e&&i(15,I=e.required),"inline"in e&&i(16,z=e.inline),"readonly"in e&&i(17,P=e.readonly),"$$scope"in e&&i(25,u=e.$$scope)},e.$$.update=()=>{128&e.$$.dirty[0]&&i(19,o=`error-${b}`),128&e.$$.dirty[0]&&i(18,s=`warn-${b}`)},i(20,n=!!L&&L.isFluid),[p,A,d,y,_,v,x,b,w,T,S,C,M,k,E,I,z,P,s,o,n,e=>{i(0,p=R(e.target.value)),D("input",p)},e=>{D("change",R(e.target.value))},l,h,u,c,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(e){G[e?"unshift":"push"]((()=>{A=e,i(1,A)}))},function(){p=this.value,i(0,p)}]}var Ea=class extends ve{constructor(e){super(),_e(this,e,ka,Ma,l,{size:2,value:0,placeholder:3,light:4,disabled:5,helperText:6,id:7,name:8,labelText:9,hideLabel:10,invalid:11,invalidText:12,warn:13,warnText:14,ref:1,required:15,inline:16,readonly:17},null,[-1,-1])}};const Aa=e=>({}),Ia=e=>({}),za=e=>({}),Pa=e=>({}),La=e=>({}),Da=e=>({});function Ra(e){let t,i,n,o,a,l,u,f,m,g,y,b,T;const M=e[11].labelText,E=c(M,e,e[10],Da),z=E||function(e){let t;return{c(){t=S(e[5])},m(e,i){v(e,t,i)},p(e,i){32&i&&P(t,e[5])},d(e){e&&x(t)}}}(e),L=e[11].labelA,D=c(L,e,e[10],Pa),B=D||function(e){let t;return{c(){t=S(e[3])},m(e,i){v(e,t,i)},p(e,i){8&i&&P(t,e[3])},d(e){e&&x(t)}}}(e),O=e[11].labelB,F=c(O,e,e[10],Ia),j=F||function(e){let t;return{c(){t=S(e[4])},m(e,i){v(e,t,i)},p(e,i){16&i&&P(t,e[4])},d(e){e&&x(t)}}}(e);let $=[e[8]],N={};for(let e=0;e<$.length;e+=1)N=r(N,$[e]);return{c(){t=w("div"),i=w("input"),n=C(),o=w("label"),z&&z.c(),a=C(),l=w("span"),u=w("span"),B&&B.c(),f=C(),m=w("span"),j&&j.c(),A(i,"type","checkbox"),i.checked=e[0],i.disabled=e[2],A(i,"id",e[6]),A(i,"name",e[7]),R(i,"bx--toggle-input",!0),R(i,"bx--toggle-input--small","sm"===e[1]),A(u,"aria-hidden","true"),R(u,"bx--toggle__text--off",!0),A(m,"aria-hidden","true"),R(m,"bx--toggle__text--on",!0),R(l,"bx--toggle__switch",!0),A(o,"aria-label",g=e[5]?void 0:e[9]["aria-label"]||"Toggle"),A(o,"for",e[6]),R(o,"bx--toggle-input__label",!0),I(t,N),R(t,"bx--form-item",!0)},m(r,s){v(r,t,s),_(t,i),_(t,n),_(t,o),z&&z.m(o,null),_(o,a),_(o,l),_(l,u),B&&B.m(u,null),_(l,f),_(l,m),j&&j.m(m,null),y=!0,b||(T=[k(i,"change",e[16]),k(i,"change",e[20]),k(i,"keyup",e[17]),k(i,"keyup",e[21]),k(i,"focus",e[18]),k(i,"blur",e[19]),k(t,"click",e[12]),k(t,"mouseover",e[13]),k(t,"mouseenter",e[14]),k(t,"mouseleave",e[15])],b=!0)},p(e,[r]){(!y||1&r)&&(i.checked=e[0]),(!y||4&r)&&(i.disabled=e[2]),(!y||64&r)&&A(i,"id",e[6]),(!y||128&r)&&A(i,"name",e[7]),2&r&&R(i,"bx--toggle-input--small","sm"===e[1]),E?E.p&&(!y||1024&r)&&d(E,M,e,e[10],y?h(M,e[10],r,La):p(e[10]),Da):z&&z.p&&(!y||32&r)&&z.p(e,y?r:-1),D?D.p&&(!y||1024&r)&&d(D,L,e,e[10],y?h(L,e[10],r,za):p(e[10]),Pa):B&&B.p&&(!y||8&r)&&B.p(e,y?r:-1),F?F.p&&(!y||1024&r)&&d(F,O,e,e[10],y?h(O,e[10],r,Aa):p(e[10]),Ia):j&&j.p&&(!y||16&r)&&j.p(e,y?r:-1),(!y||544&r&&g!==(g=e[5]?void 0:e[9]["aria-label"]||"Toggle"))&&A(o,"aria-label",g),(!y||64&r)&&A(o,"for",e[6]),I(t,N=de($,[256&r&&e[8]])),R(t,"bx--form-item",!0)},i(e){y||(ae(z,e),ae(B,e),ae(j,e),y=!0)},o(e){le(z,e),le(B,e),le(j,e),y=!1},d(e){e&&x(t),z&&z.d(e),B&&B.d(e),j&&j.d(e),b=!1,s(T)}}}function Ba(e,t,i){const n=["size","toggled","disabled","labelA","labelB","labelText","id","name"];let o=m(t,n),{$$slots:s={},$$scope:a}=t,{size:l="default"}=t,{toggled:c=!1}=t,{disabled:u=!1}=t,{labelA:h="Off"}=t,{labelB:d="On"}=t,{labelText:p=""}=t,{id:g="ccs-"+Math.random().toString(36)}=t,{name:y}=t;const _=$();return e.$$set=e=>{i(9,t=r(r({},t),f(e))),i(8,o=m(t,n)),"size"in e&&i(1,l=e.size),"toggled"in e&&i(0,c=e.toggled),"disabled"in e&&i(2,u=e.disabled),"labelA"in e&&i(3,h=e.labelA),"labelB"in e&&i(4,d=e.labelB),"labelText"in e&&i(5,p=e.labelText),"id"in e&&i(6,g=e.id),"name"in e&&i(7,y=e.name),"$$scope"in e&&i(10,a=e.$$scope)},e.$$.update=()=>{1&e.$$.dirty&&_("toggle",{toggled:c})},t=f(t),[c,l,u,h,d,p,g,y,o,t,a,s,function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},function(t){U.call(this,e,t)},()=>{i(0,c=!c)},e=>{" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),i(0,c=!c))}]}var Oa=class extends ve{constructor(e){super(),_e(this,e,Ba,Ra,l,{size:1,toggled:0,disabled:2,labelA:3,labelB:4,labelText:5,id:6,name:7})}},Fa={prefix:"fas",iconName:"check",icon:[448,512,[10004,10003],"f00c","M438.6 105.4C451.1 117.9 451.1 138.1 438.6 150.6L182.6 406.6C170.1 419.1 149.9 419.1 137.4 406.6L9.372 278.6C-3.124 266.1-3.124 245.9 9.372 233.4C21.87 220.9 42.13 220.9 54.63 233.4L159.1 338.7L393.4 105.4C405.9 92.88 426.1 92.88 438.6 105.4H438.6z"]},ja={prefix:"fas",iconName:"pencil",icon:[512,512,[61504,9999,"pencil-alt"],"f303","M421.7 220.3L188.5 453.4L154.6 419.5L158.1 416H112C103.2 416 96 408.8 96 400V353.9L92.51 357.4C87.78 362.2 84.31 368 82.42 374.4L59.44 452.6L137.6 429.6C143.1 427.7 149.8 424.2 154.6 419.5L188.5 453.4C178.1 463.8 165.2 471.5 151.1 475.6L30.77 511C22.35 513.5 13.24 511.2 7.03 504.1C.8198 498.8-1.502 489.7 .976 481.2L36.37 360.9C40.53 346.8 48.16 333.9 58.57 323.5L291.7 90.34L421.7 220.3zM492.7 58.75C517.7 83.74 517.7 124.3 492.7 149.3L444.3 197.7L314.3 67.72L362.7 19.32C387.7-5.678 428.3-5.678 453.3 19.32L492.7 58.75z"]},$a={prefix:"fas",iconName:"plus",icon:[448,512,[10133,61543,"add"],"2b","M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"]},Na={prefix:"fas",iconName:"trash",icon:[448,512,[],"f1f8","M135.2 17.69C140.6 6.848 151.7 0 163.8 0H284.2C296.3 0 307.4 6.848 312.8 17.69L320 32H416C433.7 32 448 46.33 448 64C448 81.67 433.7 96 416 96H32C14.33 96 0 81.67 0 64C0 46.33 14.33 32 32 32H128L135.2 17.69zM394.8 466.1C393.2 492.3 372.3 512 346.9 512H101.1C75.75 512 54.77 492.3 53.19 466.1L31.1 128H416L394.8 466.1z"]},Ua={prefix:"fas",iconName:"xmark",icon:[320,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"]};
/*!
 * Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2022 Fonticons, Inc.
 */const Va=parseFloat;function Ga(e,t=";"){let i;if(Array.isArray(e))i=e.filter((e=>e));else{i=[];for(const t in e)e[t]&&i.push(`${t}:${e[t]}`)}return i.join(t)}function qa(e){let t,i,r,n,o,s,a;function l(e,t){return"string"==typeof e[7][4]?Wa:Za}let c=l(e),u=c(e);return{c(){t=T("svg"),i=T("g"),r=T("g"),u.c(),A(r,"transform",e[10]),A(i,"transform",n=`translate(${e[7][0]/2} ${e[7][1]/2})`),A(i,"transform-origin",o=e[7][0]/4+" 0"),A(t,"id",e[0]),A(t,"class",s=y(e[8])+" svelte-1cj2gr0"),A(t,"style",e[9]),A(t,"viewBox",a=`0 0 ${e[7][0]} ${e[7][1]}`),A(t,"aria-hidden","true"),A(t,"role","img"),A(t,"xmlns","http://www.w3.org/2000/svg")},m(e,n){v(e,t,n),_(t,i),_(i,r),u.m(r,null)},p(e,h){c===(c=l(e))&&u?u.p(e,h):(u.d(1),u=c(e),u&&(u.c(),u.m(r,null))),1024&h&&A(r,"transform",e[10]),128&h&&n!==(n=`translate(${e[7][0]/2} ${e[7][1]/2})`)&&A(i,"transform",n),128&h&&o!==(o=e[7][0]/4+" 0")&&A(i,"transform-origin",o),1&h&&A(t,"id",e[0]),256&h&&s!==(s=y(e[8])+" svelte-1cj2gr0")&&A(t,"class",s),512&h&&A(t,"style",e[9]),128&h&&a!==(a=`0 0 ${e[7][0]} ${e[7][1]}`)&&A(t,"viewBox",a)},d(e){e&&x(t),u.d()}}}function Za(e){let t,i,r,n,o,s,a,l,c,u;return{c(){t=T("path"),s=T("path"),A(t,"d",i=e[7][4][0]),A(t,"fill",r=e[3]||e[1]||"currentColor"),A(t,"fill-opacity",n=0!=e[6]?e[4]:e[5]),A(t,"transform",o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`),A(s,"d",a=e[7][4][1]),A(s,"fill",l=e[2]||e[1]||"currentColor"),A(s,"fill-opacity",c=0!=e[6]?e[5]:e[4]),A(s,"transform",u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){v(e,t,i),v(e,s,i)},p(e,h){128&h&&i!==(i=e[7][4][0])&&A(t,"d",i),10&h&&r!==(r=e[3]||e[1]||"currentColor")&&A(t,"fill",r),112&h&&n!==(n=0!=e[6]?e[4]:e[5])&&A(t,"fill-opacity",n),128&h&&o!==(o=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(t,"transform",o),128&h&&a!==(a=e[7][4][1])&&A(s,"d",a),6&h&&l!==(l=e[2]||e[1]||"currentColor")&&A(s,"fill",l),112&h&&c!==(c=0!=e[6]?e[5]:e[4])&&A(s,"fill-opacity",c),128&h&&u!==(u=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(s,"transform",u)},d(e){e&&x(t),e&&x(s)}}}function Wa(e){let t,i,r,n;return{c(){t=T("path"),A(t,"d",i=e[7][4]),A(t,"fill",r=e[1]||e[2]||"currentColor"),A(t,"transform",n=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)},m(e,i){v(e,t,i)},p(e,o){128&o&&i!==(i=e[7][4])&&A(t,"d",i),6&o&&r!==(r=e[1]||e[2]||"currentColor")&&A(t,"fill",r),128&o&&n!==(n=`translate(${e[7][0]/-2} ${e[7][1]/-2})`)&&A(t,"transform",n)},d(e){e&&x(t)}}}function Ha(e){let t,r=e[7][4]&&qa(e);return{c(){r&&r.c(),t=M()},m(e,i){r&&r.m(e,i),v(e,t,i)},p(e,[i]){e[7][4]?r?r.p(e,i):(r=qa(e),r.c(),r.m(t.parentNode,t)):r&&(r.d(1),r=null)},i:i,o:i,d(e){r&&r.d(e),e&&x(t)}}}function Xa(e,t,i){let r,n,o,s,{class:a=""}=t,{id:l=""}=t,{style:c=""}=t,{icon:u}=t,{size:h=""}=t,{color:d=""}=t,{fw:p=!1}=t,{pull:f=""}=t,{scale:m=1}=t,{translateX:g=0}=t,{translateY:y=0}=t,{rotate:_=""}=t,{flip:v=!1}=t,{spin:x=!1}=t,{pulse:b=!1}=t,{primaryColor:w=""}=t,{secondaryColor:T=""}=t,{primaryOpacity:S=1}=t,{secondaryOpacity:C=.4}=t,{swapOpacity:M=!1}=t;return e.$$set=e=>{"class"in e&&i(11,a=e.class),"id"in e&&i(0,l=e.id),"style"in e&&i(12,c=e.style),"icon"in e&&i(13,u=e.icon),"size"in e&&i(14,h=e.size),"color"in e&&i(1,d=e.color),"fw"in e&&i(15,p=e.fw),"pull"in e&&i(16,f=e.pull),"scale"in e&&i(17,m=e.scale),"translateX"in e&&i(18,g=e.translateX),"translateY"in e&&i(19,y=e.translateY),"rotate"in e&&i(20,_=e.rotate),"flip"in e&&i(21,v=e.flip),"spin"in e&&i(22,x=e.spin),"pulse"in e&&i(23,b=e.pulse),"primaryColor"in e&&i(2,w=e.primaryColor),"secondaryColor"in e&&i(3,T=e.secondaryColor),"primaryOpacity"in e&&i(4,S=e.primaryOpacity),"secondaryOpacity"in e&&i(5,C=e.secondaryOpacity),"swapOpacity"in e&&i(6,M=e.swapOpacity)},e.$$.update=()=>{8192&e.$$.dirty&&i(7,r=u&&u.icon||[0,0,"",[],""]),12584960&e.$$.dirty&&i(8,n=Ga([a,"svelte-fa",x&&"spin",b&&"pulse"]," ")),118784&e.$$.dirty&&i(9,o=function(e,t,i,r){let n,o,s,a,l,c="-.125em";return r&&(l="center",o="1.25em"),i&&(n=i),t&&("lg"==t?(a="1.33333em",s=".75em",c="-.225em"):a="xs"==t?".75em":"sm"==t?".875em":t.replace("x","em")),Ga([Ga({float:n,width:o,height:"1em","line-height":s,"font-size":a,"text-align":l,"vertical-align":c,"transform-origin":"center",overflow:"visible"}),e])}(c,h,f,p)),4063232&e.$$.dirty&&i(10,s=function(e,t,i,r,n,o,s="",a=""){let l=1,c=1;return n&&("horizontal"==n?l=-1:"vertical"==n?c=-1:l=c=-1),Ga([`translate(${Va(t)*o}${s},${Va(i)*o}${s})`,`scale(${l*Va(e)},${c*Va(e)})`,r&&`rotate(${r}${a})`]," ")}(m,g,y,_,v,512))},[l,d,w,T,S,C,M,r,n,o,s,a,c,u,h,p,f,m,g,y,_,v,x,b]}var Ka=class extends ve{constructor(e){super(),_e(this,e,Xa,Ha,l,{class:11,id:0,style:12,icon:13,size:14,color:1,fw:15,pull:16,scale:17,translateX:18,translateY:19,rotate:20,flip:21,spin:22,pulse:23,primaryColor:2,secondaryColor:3,primaryOpacity:4,secondaryOpacity:5,swapOpacity:6})}},Ya={exports:{}},Ja=Ya.exports=function(){function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){if(!a&&we)return we(s);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[s]={exports:{}};t[s][0].call(c.exports,(function(e){return n(t[s][1][e]||e)}),c,c.exports,e,t,i,r)}return i[s].exports}for(var o=we,s=0;s<r.length;s++)n(r[s]);return n}return e}()({1:[function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var o=e("nanoid").nanoid;n.prototype={select:function(e,t){var i=this.getSelectedIndex(e,t),r=this.getEventPayload("search.select",t);if(r.resultIndex=i,r.resultPlaceName=e.place_name,r.resultId=e.id,(i!==this.lastSentIndex||r.queryString!==this.lastSentInput)&&-1!=i&&(this.lastSentIndex=i,this.lastSentInput=r.queryString,r.queryString))return this.push(r)},start:function(e){var t=this.getEventPayload("search.start",e);if(t.queryString)return this.push(t)},keyevent:function(e,t){if(e.key&&!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)){var i=this.getEventPayload("search.keystroke",t);if(i.lastAction=e.key,i.queryString)return this.push(i)}},send:function(e,t){if(this.enableEventLogging){var i=this.getRequestOptions(e);this.request(i,function(e){return e?this.handleError(e,t):t?t():void 0}.bind(this))}else if(t)return t()},getRequestOptions:function(e){return Array.isArray(e)||(e=[e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},getEventPayload:function(e,t){var i;i=t.options.proximity?"object"===r(t.options.proximity)?[t.options.proximity.longitude,t.options.proximity.latitude]:"ip"===t.options.proximity?[999,999]:t.options.proximity:null;var n=t._map?t._map.getZoom():void 0,o={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:i,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:n,keyboardLocale:this.locale};return"search.select"===e?o.queryString=t.inputString:"search.select"!=e&&t._inputEl?o.queryString=t._inputEl.value:o.queryString=t.inputString,o},request:function(e,t){var i=new XMLHttpRequest;for(var r in i.onreadystatechange=function(){if(4==this.readyState)return t(204==this.status?null:this.statusText)},i.open(e.method,e.host+"/"+e.path,!0),e.headers){var n=e.headers[r];i.setRequestHeader(r,n)}i.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return o()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var i=t._typeahead.data,r=e.id;return i.map((function(e){return e.id})).indexOf(r)}},shouldEnableLogging:function(e){return!(!1===e.enableEventLogging||e.origin&&"https://api.mapbox.com"!==e.origin||e.localGeocoder||e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}},t.exports=n},{nanoid:32}],2:[function(e,t,i){t.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(e,t,i){function r(){}r.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){var e={enableHighAccuracy:!0};return new Promise((function(t,i){window.navigator.geolocation.getCurrentPosition(t,i,e)}))}},t.exports=r},{}],4:[function(e,t,i){function r(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function n(e){this._eventEmitter=new l,this.options=a({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new m}var o=e("suggestions"),s=e("lodash.debounce"),a=e("xtend"),l=e("events").EventEmitter,c=e("./exceptions"),u=e("@mapbox/mapbox-sdk"),h=e("@mapbox/mapbox-sdk/services/geocoding"),d=e("./events"),p=e("./localization"),f=e("subtag"),m=e("./geolocation"),g=e("./utils"),y={FORWARD:0,LOCAL:1,REVERSE:2};n.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},addTo:function(e){function t(e,t){if(!document.body.contains(t))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var i=e.onAdd();t.appendChild(i)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else{if("string"!=typeof e)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");var i=document.querySelectorAll(e);if(0===i.length)throw new Error("Element ",e,"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,i[0])}},onAdd:function(e){if(e&&"string"!=typeof e&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new d(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(e){this.eventManager.keyevent(e,this)}.bind(this));var n=document.createElement("div");n.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),n.appendChild(this._clearEl),n.appendChild(this._loadingEl),t.appendChild(i),t.appendChild(this._inputEl),t.appendChild(n),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var l=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(l),n.appendChild(this._geolocateEl),this._showGeolocateButton()}var c=this._typeahead=new o(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),c.getItemValue=this.options.getItemValue;var p=c.list.draw,f=this._footerNode=r();return c.list.draw=function(){p.call(this),f.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),f.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(f)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();var t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;var i={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){var r=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(r),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(i).send().then(function(e){var i=e.body.features[0];if(i){var r=g.transformFeatureToGeolocationText(i,this.options.addressAccuracy);this._setInputValue(r),i.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:i})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){1===e.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width",18),i.setAttribute("height",18),i.innerHTML=t,i},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){if(27===e.keyCode&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var t=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target;if(!t||!t.value)return this.fresh=!0,9!==e.keyCode&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),e.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(e.keyCode)||t.value.length>=this.options.minLength&&this._geocode(t.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&c[e.properties.short_code])t=a({},this.options.flyTo),this._map&&this._map.fitBounds(c[e.properties.short_code].bbox,t);else if(e.bbox){var i=e.bbox;t=a({},this.options.flyTo),this._map&&this._map.fitBounds([[i[0],i[1]],[i[2],i[3]]],t)}else{var r={zoom:this.options.zoom};t=a({},r,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){return e.localGeocoderOnly?y.LOCAL:e.reverseGeocode&&g.REVERSE_GEOCODE_COORD_RGX.test(t)?y.REVERSE:y.FORWARD},_setupConfig:function(e,t){var i=/[\s,]+/,r=this,n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce((function(e,t){if(void 0===r.options[t]||null===r.options[t])return e;["countries","types","language"].indexOf(t)>-1?e[t]=r.options[t].split(i):e[t]=r.options[t];var n="number"==typeof r.options[t].longitude&&"number"==typeof r.options[t].latitude;if("proximity"===t&&n){var o=r.options[t].longitude,s=r.options[t].latitude;e[t]=[o,s]}return e}),{});switch(e){case y.REVERSE:var o=t.split(i).map((function(e){return parseFloat(e,10)}));r.options.flipCoordinates||o.reverse(),n.types&&n.types[0],n=a(n,{query:o,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach((function(e){e in n&&delete n[e]}));break;case y.FORWARD:/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(t.trim())&&(t=t.replace(/,/g," ")),n=a(n,{query:t})}return n},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});var t,i=this._requestType(this.options,e),r=this._setupConfig(i,e);switch(i){case y.LOCAL:t=Promise.resolve();break;case y.FORWARD:t=this.geocoderService.forwardGeocode(r).send();break;case y.REVERSE:t=this.geocoderService.reverseGeocode(r).send()}var n=this.options.localGeocoder&&this.options.localGeocoder(e)||[],o=[],s=null;return t.catch(function(e){s=e}.bind(this)).then(function(t){this._hideLoadingIcon();var i={};return t?"200"==t.statusCode&&((i=t.body).request=t.request,i.headers=t.headers):i={type:"FeatureCollection",features:[]},i.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),i.features=i.features?n.concat(i.features):n,this.options.externalGeocoder?(o=this.options.externalGeocoder(e,i.features)||Promise.resolve([])).then((function(e){return i.features=i.features?e.concat(i.features):e,i}),(function(){return i})):i}.bind(this)).then(function(e){if(s)throw s;this.options.filter&&e.features.length&&(e.features=e.features.filter(this.options.filter)),e.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",e),this._typeahead.update(e.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",e))}.bind(this)).catch(function(e){this._hideLoadingIcon(),this._hideAttribution(),n.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(n)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:n}),this._eventEmitter.emit("error",{error:e})}.bind(this)),t},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var i=t.features[0];this._typeahead.selected=i,this._inputEl.value=i.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=f.language(e),i=p.placeholder[t];if(i)return i}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&"function"==typeof e&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=h(u({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t=a({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(t),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}},t.exports=n},{"./events":1,"./exceptions":2,"./geolocation":3,"./localization":5,"./utils":6,"@mapbox/mapbox-sdk":8,"@mapbox/mapbox-sdk/services/geocoding":19,events:28,"lodash.debounce":31,subtag:35,suggestions:36,xtend:39}],5:[function(e,t,i){var r={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"};t.exports={placeholder:r}},{}],6:[function(e,t,i){function r(e,t){var i=n(e),r=["address","street","place","country"];if("function"==typeof t)return t(i);var o=r.indexOf(t);return(-1===o?r:r.slice(o)).reduce((function(e,t){return i[t]?(""!==e&&(e+=", "),e+i[t]):e}),"")}function n(e){var t=e.address||"",i=e.text||"",r=e.place_name||"",n={address:r.split(",")[0],houseNumber:t,street:i,placeName:r};return e.context.forEach((function(e){var t=e.id.split(".")[0];n[t]=e.text})),n}var o=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;t.exports={transformFeatureToGeolocationText:r,getAddressInfo:n,REVERSE_GEOCODE_COORD_RGX:o}},{}],7:[function(e,t,i){function r(e){var t=Array.isArray(e),i=function(i){return t?e[i]:e};return function(r){var o=n(m.plainArray,r);if(o)return o;if(t&&r.length!==e.length)return"an array with "+e.length+" items";for(var s=0;s<r.length;s++)if(o=n(i(s),r[s]))return[s].concat(o)}}function n(e,t){if(null!=t||e.hasOwnProperty("__required")){var i=e(t);return i?Array.isArray(i)?i:[i]:void 0}}function o(e,t){var i=e.length,r=e[i-1],n=e.slice(0,i-1);return 0===n.length&&(n=[f]),t=p(t,{path:n}),"function"==typeof r?r(t):c(t,a(r))}function s(e){return e.length<2?e[0]:2===e.length?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function a(e){return"must be "+l(e)+"."}function l(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function c(e,t){return(u(e.path)?"Item at position ":"")+e.path.join(".")+" "+t}function u(e){return"number"==typeof e[e.length-1]||"number"==typeof e[0]}function h(e){return Object.keys(e||{}).map((function(t){return{key:t,value:e[t]}}))}var d=e("is-plain-obj"),p=e("xtend"),f="value",m={assert:function(e,t){return t=t||{},function(i){var r=n(e,i);if(r){var s=o(r,t);throw t.apiName&&(s=t.apiName+": "+s),new Error(s)}}},shape:function(e){var t=h(e);return function(e){var i=n(m.plainObject,e);if(i)return i;for(var r,s=[],a=0;a<t.length;a++)r=t[a].key,(i=n(t[a].value,e[r]))&&s.push([r].concat(i));return s.length<2?s[0]:function(e){s=s.map((function(t){return"- "+t[0]+": "+o(t,e).split("\n").join("\n  ")}));var t=e.path.join(".");return"The following properties"+(t===f?"":" of "+t)+" have invalid values:\n  "+s.join("\n  ")}}},strictShape:function(e){var t=m.shape(e);return function(i){var r=t(i);if(r)return r;var n=Object.keys(i).reduce((function(t,i){return void 0===e[i]&&t.push(i),t}),[]);return 0!==n.length?function(){return"The following keys are invalid: "+n.join(", ")}:void 0}},arrayOf:function(e){return r(e)},tuple:function(){return r(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},required:function(e){function t(t){return null==t?function(e){return c(e,u(e.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return t.__required=!0,t},oneOfType:function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(t){var i=e.map((function(e){return n(e,t)})).filter(Boolean);if(i.length===e.length)return i.every((function(e){return 1===e.length&&"string"==typeof e[0]}))?s(i.map((function(e){return e[0]}))):i.reduce((function(e,t){return t.length>e.length?t:e}))}},equal:function(e){return function(t){if(t!==e)return JSON.stringify(e)}},oneOf:function(){var e=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map((function(e){return m.equal(e)}));return m.oneOfType.apply(this,e)},range:function(e){var t=e[0],i=e[1];return function(e){if(n(m.number,e)||e<t||e>i)return"number between "+t+" & "+i+" (inclusive)"}},any:function(){},boolean:function(e){if("boolean"!=typeof e)return"boolean"},number:function(e){if("number"!=typeof e)return"number"},plainArray:function(e){if(!Array.isArray(e))return"array"},plainObject:function(e){if(!d(e))return"object"},string:function(e){if("string"!=typeof e)return"string"},func:function(e){if("function"!=typeof e)return"function"}};m.validate=n,m.processMessage=o,t.exports=m},{"is-plain-obj":30,xtend:39}],8:[function(e,t,i){var r=e("./lib/client");t.exports=r},{"./lib/client":9}],9:[function(e,t,i){function r(e){s.call(this,e)}function n(e){return new r(e)}var o=e("./browser-layer"),s=e("../classes/mapi-client");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.sendRequest=o.browserSend,r.prototype.abortRequest=o.browserAbort,t.exports=n},{"../classes/mapi-client":11,"./browser-layer":10}],10:[function(e,t,i){function r(e){var t=p[e.id];t&&(t.abort(),delete p[e.id])}function n(e,t){return new c(e,{body:t.response,headers:d(t.getAllResponseHeaders()),statusCode:t.status})}function o(e){var t=e.total,i=e.loaded;return{total:t,transferred:i,percent:100*i/t}}function s(e,t){return new Promise((function(i,r){t.onprogress=function(t){e.emitter.emit(h.EVENT_PROGRESS_DOWNLOAD,o(t))};var n=e.file;n&&(t.upload.onprogress=function(t){e.emitter.emit(h.EVENT_PROGRESS_UPLOAD,o(t))}),t.onerror=function(e){r(e)},t.onabort=function(){var t=new u({request:e,type:h.ERROR_REQUEST_ABORTED});r(t)},t.onload=function(){if(delete p[e.id],t.status<200||t.status>=400){var n=new u({request:e,body:t.response,statusCode:t.status});r(n)}else i(t)};var s=e.body;"string"==typeof s?t.send(s):s?t.send(JSON.stringify(s)):n?t.send(n):t.send(),p[e.id]=t})).then((function(t){return n(e,t)}))}function a(e,t){var i=e.url(t),r=new window.XMLHttpRequest;return r.open(e.method,i),Object.keys(e.headers).forEach((function(t){r.setRequestHeader(t,e.headers[t])})),r}function l(e){return Promise.resolve().then((function(){var t=a(e,e.client.accessToken);return s(e,t)}))}var c=e("../classes/mapi-response"),u=e("../classes/mapi-error"),h=e("../constants"),d=e("../helpers/parse-headers"),p={};t.exports={browserAbort:r,sendRequestXhr:s,browserSend:l,createRequestXhr:a}},{"../classes/mapi-error":12,"../classes/mapi-response":14,"../constants":15,"../helpers/parse-headers":16}],11:[function(e,t,i){function r(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");n(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||s.API_ORIGIN}var n=e("@mapbox/parse-mapbox-token"),o=e("./mapi-request"),s=e("../constants");r.prototype.createRequest=function(e){return new o(this,e)},t.exports=r},{"../constants":15,"./mapi-request":13,"@mapbox/parse-mapbox-token":25}],12:[function(e,t,i){function r(e){var t,i=e.type||n.ERROR_HTTP;if(e.body)try{t=JSON.parse(e.body)}catch(i){t=e.body}else t=null;var r=e.message||null;r||("string"==typeof t?r=t:t&&"string"==typeof t.message?r=t.message:i===n.ERROR_REQUEST_ABORTED&&(r="Request aborted")),this.message=r,this.type=i,this.statusCode=e.statusCode||null,this.request=e.request,this.body=t}var n=e("../constants");t.exports=r},{"../constants":15}],13:[function(e,t,i){function r(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var i={};t.body&&(i["content-type"]="application/json");var r=o(i,t.headers),n=Object.keys(r).reduce((function(e,t){return e[t.toLowerCase()]=r[t],e}),{});this.id=c++,this._options=t,this.emitter=new s,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=n}var n=e("@mapbox/parse-mapbox-token"),o=e("xtend"),s=e("eventemitter3"),a=e("../helpers/url-utils"),l=e("../constants"),c=1;r.prototype.url=function(e){var t=a.prependOrigin(this.path,this.origin);t=a.appendQueryObject(t,this.query);var i=this.params,r=null==e?this.client.accessToken:e;if(r){t=a.appendQueryParam(t,"access_token",r);var s=n(r).user;i=o({ownerId:s},i)}return t=a.interpolateRouteParams(t,i)},r.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then((function(t){return e.response=t,e.emitter.emit(l.EVENT_RESPONSE,t),t}),(function(t){throw e.error=t,e.emitter.emit(l.EVENT_ERROR,t),t}))},r.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},r.prototype.eachPage=function(e){function t(t){function i(){delete n._nextPageRequest;var e=t.nextPage();e&&(n._nextPageRequest=e,r(e))}e(null,t,i)}function i(t){e(t,null,(function(){}))}function r(e){e.send().then(t,i)}var n=this;r(this)},r.prototype.clone=function(){return this._extend()},r.prototype._extend=function(e){var t=o(this._options,e);return new r(this.client,t)},t.exports=r},{"../constants":15,"../helpers/url-utils":18,"@mapbox/parse-mapbox-token":25,eventemitter3:27,xtend:39}],14:[function(e,t,i){function r(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch(e){this.body=t.body}this.links=n(this.headers.link)}var n=e("../helpers/parse-link-header");r.prototype.hasNextPage=function(){return!!this.links.next},r.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},t.exports=r},{"../helpers/parse-link-header":17}],15:[function(e,t,i){t.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],16:[function(e,t,i){function r(e){var t=e.indexOf(":");return{name:e.substring(0,t).trim().toLowerCase(),value:e.substring(t+1).trim()}}function n(e){var t={};return e?(e.trim().split(/[\r|\n]+/).forEach((function(e){var i=r(e);t[i.name]=i.value})),t):t}t.exports=n},{}],17:[function(e,t,i){function r(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function n(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var i=t[1],n=t[2].split(";"),o=null,s=n.reduce((function(e,t){var i=r(t);return i?"rel"===i.key?(o||(o=i.value),e):(e[i.key]=i.value,e):e}),{});return o?{url:i,rel:o,params:s}:null}function o(e){return e?e.split(/,\s*</).reduce((function(e,t){var i=n(t);return i?(i.rel.split(/\s+/).forEach((function(t){e[t]||(e[t]={url:i.url,params:i.params})})),e):e}),{}):{}}t.exports=o},{}],18:[function(e,t,i){function r(e){return e.map(encodeURIComponent).join(",")}function n(e){return Array.isArray(e)?r(e):encodeURIComponent(String(e))}function o(e,t,i){if(!1===i||null===i)return e;var r=/\?/.test(e)?"&":"?",o=encodeURIComponent(t);return void 0!==i&&""!==i&&!0!==i&&(o+="="+n(i)),""+e+r+o}function s(e,t){if(!t)return e;var i=e;return Object.keys(t).forEach((function(e){var r=t[e];void 0!==r&&(Array.isArray(r)&&(r=r.filter((function(e){return null!=e})).join(",")),i=o(i,e,r))})),i}function a(e,t){if(!t)return e;if("http"===e.slice(0,4))return e;var i="/"===e[0]?"":"/";return""+t.replace(/\/$/,"")+i+e}function l(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,(function(e,i){var r=t[i];if(void 0===r)throw new Error("Unspecified route parameter "+i);return"/"+n(r)})):e}t.exports={appendQueryObject:s,appendQueryParam:o,prependOrigin:a,interpolateRouteParams:l}},{}],19:[function(e,t,i){var r=e("xtend"),n=e("./service-helpers/validator"),o=e("./service-helpers/pick"),s=e("./service-helpers/stringify-booleans"),a=e("./service-helpers/create-service-factory"),l={},c=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];l.forwardGeocode=function(e){n.assertShape({query:n.required(n.string),mode:n.oneOf("mapbox.places","mapbox.places-permanent"),countries:n.arrayOf(n.string),proximity:n.oneOf(n.coordinates,"ip"),types:n.arrayOf(n.oneOf(c)),autocomplete:n.boolean,bbox:n.arrayOf(n.number),limit:n.number,language:n.arrayOf(n.string),routing:n.boolean,fuzzyMatch:n.boolean,worldview:n.string})(e),e.mode=e.mode||"mapbox.places";var t=s(r({country:e.countries},o(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},l.reverseGeocode=function(e){n.assertShape({query:n.required(n.coordinates),mode:n.oneOf("mapbox.places","mapbox.places-permanent"),countries:n.arrayOf(n.string),types:n.arrayOf(n.oneOf(c)),bbox:n.arrayOf(n.number),limit:n.number,language:n.arrayOf(n.string),reverseMode:n.oneOf("distance","score"),routing:n.boolean,worldview:n.string})(e),e.mode=e.mode||"mapbox.places";var t=s(r({country:e.countries},o(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(e,["mode","query"]),query:t})},t.exports=a(l)},{"./service-helpers/create-service-factory":20,"./service-helpers/pick":22,"./service-helpers/stringify-booleans":23,"./service-helpers/validator":24,xtend:39}],20:[function(e,t,i){function r(e){return function(t){var i;i=n.prototype.isPrototypeOf(t)?t:o(t);var r=Object.create(e);return r.client=i,r}}var n=e("../../lib/classes/mapi-client"),o=e("../../lib/client");t.exports=r},{"../../lib/classes/mapi-client":11,"../../lib/client":9}],21:[function(e,t,i){function r(e,t){return Object.keys(e).reduce((function(i,r){return i[r]=t(r,e[r]),i}),{})}t.exports=r},{}],22:[function(e,t,i){function r(e,t){var i=function(e,i){return-1!==t.indexOf(e)&&void 0!==i};return"function"==typeof t&&(i=t),Object.keys(e).filter((function(t){return i(t,e[t])})).reduce((function(t,i){return t[i]=e[i],t}),{})}t.exports=r},{}],23:[function(e,t,i){function r(e){return n(e,(function(e,t){return"boolean"==typeof t?JSON.stringify(t):t}))}var n=e("./object-map");t.exports=r},{"./object-map":21}],24:[function(e,t,i){(function(i){(function(){function r(e){if("undefined"!=typeof window){if(e instanceof i.Blob||e instanceof i.ArrayBuffer)return;return"Blob or ArrayBuffer"}if("string"!=typeof e&&void 0===e.pipe)return"Filename or Readable stream"}function n(e,t){return l.assert(l.strictShape(e),t)}function o(e){if("boolean"==typeof e)return"date";try{var t=new Date(e);if(t.getTime&&isNaN(t.getTime()))return"date"}catch(e){return"date"}}function s(e){return l.tuple(l.number,l.number)(e)}var a=e("xtend"),l=e("@mapbox/fusspot");t.exports=a(l,{file:r,date:o,coordinates:s,assertShape:n})}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@mapbox/fusspot":7,xtend:39}],25:[function(e,t,i){function r(e){if(a[e])return a[e];var t=e.split("."),i=t[0],r=t[1];if(!r)throw new Error("Invalid token");var s=n(r),l={usage:i,user:s.u};return o(s,"a")&&(l.authorization=s.a),o(s,"exp")&&(l.expires=1e3*s.exp),o(s,"iat")&&(l.created=1e3*s.iat),o(s,"scopes")&&(l.scopes=s.scopes),o(s,"client")&&(l.client=s.client),o(s,"ll")&&(l.lastLogin=s.ll),o(s,"iu")&&(l.impersonator=s.iu),a[e]=l,l}function n(e){try{return JSON.parse(s.decode(e))}catch(e){throw new Error("Invalid token")}}function o(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var s=e("base-64"),a={};t.exports=r},{"base-64":26}],26:[function(e,t,i){(function(e){(function(){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n){var o="object"==(void 0===i?"undefined":r(i))&&i,s="object"==(void 0===t?"undefined":r(t))&&t&&t.exports==o&&t,a="object"==(void 0===e?"undefined":r(e))&&e;a.global!==a&&a.window!==a||(n=a);var l=function(e){this.message=e};l.prototype=new Error,l.prototype.name="InvalidCharacterError";var c=function(e){throw new l(e)},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=/[\t\n\f\r ]/g,d=function(e){var t=(e=String(e).replace(h,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&c("Invalid character: the string to be decoded is not correctly encoded.");for(var i,r,n=0,o="",s=-1;++s<t;)r=u.indexOf(e.charAt(s)),i=n%4?64*i+r:r,n++%4&&(o+=String.fromCharCode(255&i>>(-2*n&6)));return o},p=function(e){e=String(e),/[^\0-\xFF]/.test(e)&&c("The string to be encoded contains characters outside of the Latin1 range.");for(var t,i=e.length%3,r="",n=-1,o=e.length-i;++n<o;)t=(e.charCodeAt(n)<<16)+(e.charCodeAt(++n)<<8)+e.charCodeAt(++n),r+=u.charAt(t>>18&63)+u.charAt(t>>12&63)+u.charAt(t>>6&63)+u.charAt(63&t);return 2==i?(t=(e.charCodeAt(n)<<8)+e.charCodeAt(++n),r+=u.charAt(t>>10)+u.charAt(t>>4&63)+u.charAt(t<<2&63)+"="):1==i&&(t=e.charCodeAt(n),r+=u.charAt(t>>2)+u.charAt(t<<4&63)+"=="),r},f={encode:p,decode:d,version:"0.1.0"};if(o&&!o.nodeType)if(s)s.exports=f;else for(var m in f)f.hasOwnProperty(m)&&(o[m]=f[m]);else n.base64=f}(void 0)}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(e,t,i){function r(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,r,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var s=new n(i,r||e,o),a=c?c+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}var l=Object.prototype.hasOwnProperty,c="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(c=!1)),a.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)l.call(e,t)&&i.push(c?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=c?c+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,n=i.length,o=new Array(n);r<n;r++)o[r]=i[r].fn;return o},a.prototype.listenerCount=function(e){var t=c?c+e:e,i=this._events[t];return i?i.fn?1:i.length:0},a.prototype.emit=function(e,t,i,r,n,o){var s=c?c+e:e;if(!this._events[s])return!1;var a,l,u=this._events[s],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,n),!0;case 6:return u.fn.call(u.context,t,i,r,n,o),!0}for(l=1,a=new Array(h-1);l<h;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,r);break;default:if(!a)for(d=1,a=new Array(h-1);d<h;d++)a[d-1]=arguments[d];u[l].fn.apply(u[l].context,a)}}return!0},a.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,i,r){var n=c?c+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||r&&!o.once||i&&o.context!==i||s(this,n);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==t||r&&!o[a].once||i&&o[a].context!==i)&&l.push(o[a]);l.length?this._events[n]=1===l.length?l[0]:l:s(this,n)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=c?c+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=c,a.EventEmitter=a,void 0!==t&&(t.exports=a)},{}],28:[function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=w(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function o(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function s(e,t,i){if(t)e.call(i);else for(var r=e.length,n=y(e,r),o=0;o<r;++o)n[o].call(i)}function a(e,t,i,r){if(t)e.call(i,r);else for(var n=e.length,o=y(e,n),s=0;s<n;++s)o[s].call(i,r)}function l(e,t,i,r,n){if(t)e.call(i,r,n);else for(var o=e.length,s=y(e,o),a=0;a<o;++a)s[a].call(i,r,n)}function c(e,t,i,r,n,o){if(t)e.call(i,r,n,o);else for(var s=e.length,a=y(e,s),l=0;l<s;++l)a[l].call(i,r,n,o)}function u(e,t,i,r){if(t)e.apply(i,r);else for(var n=e.length,o=y(e,n),s=0;s<n;++s)o[s].apply(i,r)}function h(e,t,i,n){var s,a,l;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),l=a[t]):(a=e._events=w(null),e._eventsCount=0),l){if("function"==typeof l?l=a[t]=n?[i,l]:[l,i]:n?l.unshift(i):l.push(i),!l.warned&&(s=o(e))&&s>0&&l.length>s){l.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+l.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=l.length,"object"===("undefined"==typeof console?"undefined":r(console))&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else l=a[t]=i,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=S.call(d,r);return n.listener=i,r.wrapFn=n,n}function f(e,t,i){var r=e._events;if(!r)return[];var n=r[t];return n?"function"==typeof n?i?[n.listener||n]:[n]:i?_(n):y(n,n.length):[]}function m(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function g(e,t){for(var i=t,r=i+1,n=e.length;r<n;i+=1,r+=1)e[i]=e[r];e.pop()}function y(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}function _(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}function v(e){var t=function(){};return t.prototype=e,new t}function x(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return i}function b(e){var t=this;return function(){return t.apply(e,arguments)}}var w=Object.create||v,T=Object.keys||x,S=Function.prototype.bind||b;t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0;var C,M=10;try{var k={};Object.defineProperty&&Object.defineProperty(k,"x",{value:0}),C=0===k.x}catch(e){C=!1}C?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');M=e}}):n.defaultMaxListeners=M,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return o(this)},n.prototype.emit=function(e){var t,i,r,n,o,h,d="error"===e;if(h=this._events)d=d&&null==h.error;else if(!d)return!1;if(d){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var p=new Error('Unhandled "error" event. ('+t+")");throw p.context=t,p}if(!(i=h[e]))return!1;var f="function"==typeof i;switch(r=arguments.length){case 1:s(i,f,this);break;case 2:a(i,f,this,arguments[1]);break;case 3:l(i,f,this,arguments[1],arguments[2]);break;case 4:c(i,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(r-1),o=1;o<r;o++)n[o-1]=arguments[o];u(i,f,this,n)}return!0},n.prototype.addListener=function(e,t){return h(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return h(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},n.prototype.removeListener=function(e,t){var i,r,n,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=w(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){s=i[o].listener,n=o;break}if(n<0)return this;0===n?i.shift():g(i,n),1===i.length&&(r[e]=i[0]),r.removeListener&&this.emit("removeListener",e,s||t)}return this},n.prototype.removeAllListeners=function(e){var t,i,r;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=w(null),this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=w(null):delete i[e]),this;if(0===arguments.length){var n,o=T(i);for(r=0;r<o.length;++r)"removeListener"!==(n=o[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=w(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},n.prototype.listeners=function(e){return f(this,e,!0)},n.prototype.rawListeners=function(e){return f(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},n.prototype.listenerCount=m,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],29:[function(e,t,i){!function(){var e=this,r={};void 0!==i?t.exports=r:e.fuzzy=r,r.simpleFilter=function(e,t){return t.filter((function(t){return r.test(e,t)}))},r.test=function(e,t){return null!==r.match(e,t)},r.match=function(e,t,i){i=i||{};var r,n=0,o=[],s=t.length,a=0,l=0,c=i.pre||"",u=i.post||"",h=i.caseSensitive&&t||t.toLowerCase();e=i.caseSensitive&&e||e.toLowerCase();for(var d=0;d<s;d++)r=t[d],h[d]===e[n]?(r=c+r+u,n+=1,l+=1+l):l=0,a+=l,o[o.length]=r;return n===e.length?(a=h===e?1/0:a,{rendered:o.join(""),score:a}):null},r.filter=function(e,t,i){return t&&0!==t.length?"string"!=typeof e?t:(i=i||{},t.reduce((function(t,n,o,s){var a=n;i.extract&&(a=i.extract(n));var l=r.match(e,a,i);return null!=l&&(t[t.length]={string:l.rendered,score:l.score,index:o,original:n}),t}),[]).sort((function(e,t){return t.score-e.score||e.index-t.index}))):[]}}()},{}],30:[function(e,t,i){var r=Object.prototype.toString;t.exports=function(e){var t;return"[object Object]"===r.call(e)&&(null===(t=Object.getPrototypeOf(e))||t===Object.getPrototypeOf({}))}},{}],31:[function(e,t,i){(function(e){(function(){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,i){function r(t){var i=m,r=g;return m=g=void 0,S=t,_=e.apply(r,i)}function o(e){return S=e,v=setTimeout(u,t),C?r(e):_}function s(e){var i=t-(e-T);return M?b(i,y-(e-S)):i}function c(e){var i=e-T;return void 0===T||i>=t||i<0||M&&e-S>=y}function u(){var e=w();if(c(e))return h(e);v=setTimeout(u,s(e))}function h(e){return v=void 0,k&&m?r(e):(m=g=void 0,_)}function d(){void 0!==v&&clearTimeout(v),S=0,m=T=g=v=void 0}function p(){return void 0===v?_:h(w())}function f(){var e=w(),i=c(e);if(m=arguments,g=this,T=e,i){if(void 0===v)return o(T);if(M)return v=setTimeout(u,t),r(T)}return void 0===v&&(v=setTimeout(u,t)),_}var m,g,y,_,v,T,S=0,C=!1,M=!1,k=!0;if("function"!=typeof e)throw new TypeError(l);return t=a(t)||0,n(i)&&(C=!!i.leading,y=(M="maxWait"in i)?x(a(i.maxWait)||0,t):y,k="trailing"in i?!!i.trailing:k),f.cancel=d,f.flush=p,f}function n(e){var t=i(e);return!!e&&("object"==t||"function"==t)}function o(e){return!!e&&"object"==i(e)}function s(e){return"symbol"==i(e)||o(e)&&v.call(e)==u}function a(e){if("number"==typeof e)return e;if(s(e))return c;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(h,"");var i=p.test(e);return i||f.test(e)?m(e.slice(2),i?2:8):d.test(e)?c:+e}var l="Expected a function",c=NaN,u="[object Symbol]",h=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,f=/^0o[0-7]+$/i,m=parseInt,g="object"==(void 0===e?"undefined":i(e))&&e&&e.Object===Object&&e,y="object"==("undefined"==typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,_=g||y||Function("return this")(),v=Object.prototype.toString,x=Math.max,b=Math.min,w=function(){return _.Date.now()};t.exports=r}).call(this)}).call(this,void 0!==xe?xe:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(e,t,i){(function(i){(function(){var r=e("./url-alphabet/index.cjs").urlAlphabet;if("production"!==i.env.NODE_ENV){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you don’t need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you don’t need unpredictable IDs, you can use nanoid/non-secure.")}var n=function(e){return crypto.getRandomValues(new Uint8Array(e))},o=function(e,t,i){var r=(2<<Math.log(e.length-1)/Math.LN2)-1,n=-~(1.6*r*t/e.length);return function(){for(var o="";;)for(var s=i(n),a=n;a--;)if((o+=e[s[a]&r]||"").length===t)return o}},s=function(e,t){return o(e,t,n)},a=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,t="",i=crypto.getRandomValues(new Uint8Array(e));e--;){var r=63&i[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t};t.exports={nanoid:a,customAlphabet:s,customRandom:o,urlAlphabet:r,random:n}}).call(this)}).call(this,e("_process"))},{"./url-alphabet/index.cjs":33,_process:34}],33:[function(e,t,i){t.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}},{}],34:[function(e,t,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(h===setTimeout)return setTimeout(e,0);if((h===r||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(e){if(d===clearTimeout)return clearTimeout(e);if((d===n||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){g&&f&&(g=!1,f.length?m=f.concat(m):y=-1,m.length&&l())}function l(){if(!g){var e=o(a);g=!0;for(var t=m.length;t;){for(f=m,m=[];++y<t;)f&&f[y].run();y=-1,t=m.length}f=null,g=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var h,d,p=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:r}catch(e){h=r}try{d="function"==typeof clearTimeout?clearTimeout:n}catch(e){d=n}}();var f,m=[],g=!1,y=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];m.push(new c(e,t)),1!==m.length||g||o(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],35:[function(e,t,i){!function(e,i,r){void 0!==t&&t.exports?t.exports=r():e.subtag=r()}(void 0,0,(function(){function e(e){return e.match(s)||[]}function t(t){return e(t).filter((function(e,t){return e&&t}))}function i(t){return{language:(t=e(t))[1]||o,extlang:t[2]||o,script:t[3]||o,region:t[4]||o}}function r(e,t,i){Object.defineProperty(e,t,{value:i,enumerable:!0})}function n(t,n,s){function a(i){return e(i)[t]||o}r(a,"pattern",n),r(i,s,a)}var o="",s=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return n(1,/^[a-zA-Z]{2,3}$/,"language"),n(2,/^[a-zA-Z]{3}$/,"extlang"),n(3,/^[a-zA-Z]{4}$/,"script"),n(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),r(i,"split",t),i}))},{}],36:[function(e,t,i){var r=e("./src/suggestions");t.exports=r,"undefined"!=typeof window&&(window.Suggestions=r)},{"./src/suggestions":38}],37:[function(e,t,i){var r=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};r.prototype.show=function(){this.element.style.display="block"},r.prototype.hide=function(){this.element.style.display="none"},r.prototype.add=function(e){this.items.push(e)},r.prototype.clear=function(){this.items=[],this.active=0},r.prototype.isEmpty=function(){return!this.items.length},r.prototype.isVisible=function(){return"block"===this.element.style.display},r.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()}else this.hide()},r.prototype.drawItem=function(e,t){var i=document.createElement("li"),r=document.createElement("a");t&&(i.className+=" active"),r.innerHTML=e.string,i.appendChild(r),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))},r.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},r.prototype.move=function(e){this.active=e,this.draw()},r.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},r.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},r.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()},t.exports=r},{}],38:[function(e,t,i){var r=e("xtend"),n=e("fuzzy"),o=e("./list"),s=function(e,t,i){return i=i||{},this.options=r({minLength:2,limit:5,filter:!0,hideOnBlur:!0},i),this.el=e,this.data=t||[],this.list=new o(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(e){this.handleKeyUp(e.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(e){this.handleKeyDown(e)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(e){this.handlePaste(e)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};s.prototype.handleKeyUp=function(e){40!==e&&38!==e&&27!==e&&13!==e&&9!==e&&this.handleInputChange(this.el.value)},s.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},s.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},s.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout((function(){t.handleInputChange(e.target.value)}),100)}},s.prototype.handleInputChange=function(e){this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}.bind(this))},s.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},s.prototype.update=function(e){this.data=e,this.handleKeyUp()},s.prototype.clear=function(){this.data=[],this.list.clear()},s.prototype.normalize=function(e){return e.toLowerCase()},s.prototype.match=function(e,t){return e.indexOf(t)>-1},s.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")},s.prototype.getCandidates=function(e){var t,i={pre:"<strong>",post:"</strong>",extract:function(e){return this.getItemValue(e)}.bind(this)};t=this.options.filter?(t=n.filter(this.query,this.data,i)).map(function(e){return{original:e.original,string:this.render(e.original,e.string)}}.bind(this)):this.data.map(function(e){return{original:e,string:this.render(e)}}.bind(this)),e(t)},s.prototype.getItemValue=function(e){return e},s.prototype.render=function(e,t){if(t)return t;for(var i=e.original?this.getItemValue(e.original):this.getItemValue(e),r=this.normalize(i),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;i=i.slice(0,n)+"<strong>"+i.slice(n,o)+"</strong>"+i.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return i},s.prototype.renderError=function(e){this.list.drawError(e)},t.exports=s},{"./list":37,fuzzy:29,xtend:39}],39:[function(e,t,i){function r(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var r in i)n.call(i,r)&&(e[r]=i[r])}return e}t.exports=r;var n=Object.prototype.hasOwnProperty},{}]},{},[4])(4);let Qa;Ge.subscribe((e=>({mapboxGlAccessToken:Qa}=e)));const el=async(...e)=>{let t;try{const i=((...e)=>`https://api.mapbox.com/directions/v5/mapbox/driving/${e.map((e=>{const{lng:t,lat:i}=e;return`${t},${i}`})).join(";")}?geometries=geojson&steps=true&access_token=${Qa}`)(...e),r=await fetch(i);t=await r.json()}catch(e){console.error(e)}return(e=>{const t=e.routes[0].legs.reduce(((e,t)=>{const i=t.steps.reduce(((e,t)=>e.concat(t)),[]);return e.concat(i)}),[]);let i=t.map((e=>e.geometry));return i=i.reduce(((e,t)=>e.concat(t.coordinates)),[]),{steps:t,coordinates:i}})(t)};var tl={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function il(e,t,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function rl(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!al(e[0])||!al(e[1]))throw new Error("coordinates must contain numbers");return il({type:"Point",coordinates:e},t,i)}function nl(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return il({type:"LineString",coordinates:e},t,i)}function ol(e){return 180*(e%(2*Math.PI))/Math.PI}function sl(e){return e%360*Math.PI/180}function al(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function ll(e,t,i){if(null!==e)for(var r,n,o,s,a,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,g=f?e.features.length:1,y=0;y<g;y++){a=(u=!!(c=f?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<a;_++){var v=0,x=0;if(null!==(s=u?c.geometries[_]:c)){l=s.coordinates;var b=s.type;switch(h=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===t(l,d,y,v,x))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],d,y,v,x))return!1;d++,"MultiPoint"===b&&v++}"LineString"===b&&v++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(n=0;n<l[r].length-h;n++){if(!1===t(l[r][n],d,y,v,x))return!1;d++}"MultiLineString"===b&&v++,"Polygon"===b&&x++}"Polygon"===b&&v++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,n=0;n<l[r].length;n++){for(o=0;o<l[r][n].length-h;o++){if(!1===t(l[r][n][o],d,y,v,x))return!1;d++}x++}v++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===ll(s.geometries[r],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function cl(e,t){!function(e,t){var i,r,n,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(i=0;i<m;i++){for(a=p?e.features[i].geometry:f?e.geometry:e,c=p?e.features[i].properties:f?e.properties:{},u=p?e.features[i].bbox:f?e.bbox:void 0,h=p?e.features[i].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<s;n++)if(null!==(o=l?a.geometries[n]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}(e,(function(e,i,r,n,o){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(il(e,r,{bbox:n,id:o}),i,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l];if(!1===t(il({type:s,coordinates:c},r),i,l))return!1}}))}function ul(e,t){cl(e,(function(e,i,r){var n=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,c=0;return!1!==ll(e,(function(o,u,h,d,p){if(void 0===s||i>a||d>l||p>c)return s=o,a=i,l=d,c=p,void(n=0);var f=nl([s,o],e.properties);if(!1===t(f,i,r,p,n))return!1;n++,s=o}))&&void 0}}}))}function hl(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dl(e,t,i){void 0===i&&(i={});var r=hl(e),n=hl(t),o=sl(n[1]-r[1]),s=sl(n[0]-r[0]),a=sl(r[1]),l=sl(n[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(l);return function(e,t){void 0===t&&(t="kilometers");var i=tl[t];if(!i)throw new Error(t+" units is invalid");return e*i}(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),i.units)}function pl(e,t,i,r){void 0===r&&(r={});var n=hl(e),o=sl(n[0]),s=sl(n[1]),a=sl(i),l=function(e,t){void 0===t&&(t="kilometers");var i=tl[t];if(!i)throw new Error(t+" units is invalid");return e/i}(t,r.units),c=Math.asin(Math.sin(s)*Math.cos(l)+Math.cos(s)*Math.sin(l)*Math.cos(a));return rl([ol(o+Math.atan2(Math.sin(a)*Math.sin(l)*Math.cos(s),Math.cos(l)-Math.sin(s)*Math.sin(c))),ol(c)],r.properties)}function fl(e,t,i){if(void 0===i&&(i={}),!0===i.final)return function(e,t){var i=fl(t,e);return i=(i+180)%360}(e,t);var r=hl(e),n=hl(t),o=sl(r[0]),s=sl(n[0]),a=sl(r[1]),l=sl(n[1]),c=Math.sin(s-o)*Math.cos(l),u=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return ol(Math.atan2(c,u))}function ml(e,t,i){void 0===i&&(i={});for(var r,n=("Feature"===(r=e).type?r.geometry:r).coordinates,o=0,s=0;s<n.length&&!(t>=o&&s===n.length-1);s++){if(o>=t){var a=t-o;if(a){var l=fl(n[s],n[s-1])-180;return pl(n[s],a,l,i)}return rl(n[s])}o+=dl(n[s],n[s+1],i)}return rl(n[n.length-1])}function gl(e,t){return void 0===t&&(t={}),function(e,t,i){var r=i,n=!1;return ul(e,(function(e,o,s,a,l){r=!1===n&&void 0===i?e:t(r,e,o,s,a,l),n=!0})),r}(e,(function(e,i){var r=i.geometry.coordinates;return e+dl(r[0],r[1],t)}),0)}function yl(e,t,i,r){if(!(n=r=r||{})||n.constructor!==Object)throw new Error("options is invalid");var n,o,s=[];if("Feature"===e.type)o=e.geometry.coordinates;else{if("LineString"!==e.type)throw new Error("input must be a LineString Feature or Geometry");o=e.coordinates}for(var a,l,c,u=o.length,h=0,d=0;d<o.length&&!(t>=h&&d===o.length-1);d++){if(h>t&&0===s.length){if(!(a=t-h))return s.push(o[d]),nl(s);l=fl(o[d],o[d-1])-180,c=pl(o[d],a,l,r),s.push(c.geometry.coordinates)}if(h>=i)return(a=i-h)?(l=fl(o[d],o[d-1])-180,c=pl(o[d],a,l,r),s.push(c.geometry.coordinates),nl(s)):(s.push(o[d]),nl(s));if(h>=t&&s.push(o[d]),d===o.length-1)return nl(s);h+=dl(o[d],o[d+1],r)}if(h<t&&o.length===u)throw new Error("Start position is beyond line");var p=o[o.length-1];return nl([p,p])}function _l(e,t,i){var r;return void 0===i&&(i={}),(r=i.final?vl(hl(t),hl(e)):vl(hl(e),hl(t)))>180?-(360-r):r}function vl(e,t){var i=sl(e[1]),r=sl(t[1]),n=sl(t[0]-e[0]);n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI);var o=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(i/2+Math.PI/4));return(ol(Math.atan2(n,o))+360)%360}let xl,bl,wl,Tl,Sl,Cl={};Ke.subscribe((e=>Cl=e)),it.subscribe((e=>({routingOptions:bl,maneuverOptions:wl,speedOptions:Tl,durationMultiplier:Sl}=e)));const Ml=(e,t,i,r,n)=>(e-t)*(n-r)/(i-t)+r,kl=(e,t,i)=>i?((e,t)=>{let i=t+(360-e);return i>360?i-360:i})(e,t):((e,t)=>{let i=e+(360-t);return i>360?i-360:i})(e,t),El=e=>(e>360&&(e-=360),e<0&&(e=360+e),360===e&&(e=0),e),Al=(e,t,i,r)=>{let n=kl(e,t,i);return El(i?e+n*r:e-n*r)},Il=(e,t,i,r)=>{const n=1-Ml(Math.min(i,r),0,r,0,1);let o=e.pitch,s=e.zoom;if(void 0!==t.pitch){const i=t.pitch>e.pitch,r=Math.min(e.pitch,t.pitch),s=Math.max(e.pitch,t.pitch);o=Ml(i?n:1-n,0,1,r,s)}if(void 0!==t.zoom){const i=t.zoom>e.zoom,r=Math.min(e.zoom,t.zoom),o=Math.max(e.zoom,t.zoom);s=Ml(i?n:1-n,0,1,r,o)}return{pitch:o,zoom:s}},zl=(e,t)=>new Promise((async i=>{const{steps:r,distance:n,duration:o,coordinates:s,maneuver:a,nextManeuver:l}=t,c=n/o;let u=Tl?.speed&&Tl?.speed<c?{...bl,...Tl}:bl;if("arrive"===a.type)return i({segmentComplete:!0});const h=e.getBearing()<0?360+e.getBearing():e.getBearing();let d=await((e,t,i)=>new Promise((r=>{let n,{bearing_after:o,location:s,modifier:a}=t,l=i;if(!a||!o)return r(l);const c=kl(i,o,!0),u=kl(i,o,!1),h=c<u,d=(h?c:u)*Sl/10;window.requestAnimationFrame((function t(a){n||(n=a);const c=(a-n)/d;if(c>1)return r(l);l=Al(i,o,h,c),gn(e,s,l),e.jumpTo({center:s,bearing:l}),window.requestAnimationFrame(t)}))})))(e,a,h);const p=s,f=o*Sl,m=gl(nl(p));let g,y,_,v,x;window.requestAnimationFrame((function t(o){if(JSON.stringify(r)!==JSON.stringify(xl))return i({segmentComplete:!0});x||(x=o);const s=(o-x)/f,a=ml(nl(p),m*s).geometry.coordinates,c=ml(nl(p),m*Math.min(s+.025,1)).geometry.coordinates;if(s>1)return i({segmentComplete:!0});let h,b,w=El(_l(rl(a),rl(c)));d=((e,t)=>{const i=kl(e,t,!1),r=kl(e,t,!0);let n=r<i,o=n?r:i;o=Math.min(o,5);const s=Ml(5-o,0,5,.05,.5);return Al(e,t,n,s)})(d,w);const T=ml(nl(p.slice(1).concat([p[p.length-1]])),m*s).geometry.coordinates,S=_l(rl(a),rl(T));gn(e,a,S);const C=n-n*s,M=u?.leadDistance;if(M&&C<=M){g||(g=e.getPitch()),y||(y=e.getZoom());const t=wl?.["*"]||wl?.[l?.type],i=Il({pitch:g,zoom:y},{pitch:void 0!==t?.pitch?t?.pitch:u.pitch,zoom:void 0!==t?.zoom?t?.zoom:u.zoom},C,Math.min(M,n));h=i.pitch,b=i.zoom}else if(M&&n*s<=M){_||(_=e.getPitch()),v||(v=e.getZoom());const t=Il({pitch:_,zoom:v},{pitch:u.pitch,zoom:u.zoom},M-n*s,Math.min(M,n));h=t.pitch,b=t.zoom}else h=u.pitch,b=u.zoom;e.jumpTo({center:a,zoom:b,pitch:h,bearing:d}),window.requestAnimationFrame(t)}))})),Pl=async(e,t)=>{const{coordinates:i,steps:r}=t;if(xl=r,r)return new Promise((t=>{const n=i[0],o=i[i.length-1],s=r?.[0]?.maneuver?.bearing_after||0,a="arrive"===r[r.length-1]?.maneuver?.type;e.easeTo({center:n,speed:.2,curve:1,duration:1e3,zoom:bl.zoom,pitch:bl.pitch,bearing:s}),e.once("moveend",(()=>{Cl["destination-pin"]&&a&&yn(e,o,"destination-pin",{"icon-pitch-alignment":"viewport","icon-offset":[0,-.5*Cl["destination-pin"].height]}),Cl.puck&&yn(e,n,Re,{"icon-pitch-alignment":"map","icon-rotation-alignment":"map"}),(async(e,t)=>{for(let i=0;i<t.length;i++){const r=t[i],{distance:n,duration:o,geometry:s,maneuver:a}=r,l=t?.[i+1]?.maneuver;if(JSON.stringify(t)!==JSON.stringify(xl))return;await zl(e,{steps:t,duration:o,distance:n,coordinates:s.coordinates,maneuver:a,nextManeuver:l})}return{routeComplete:!0}})(e,r).then((e=>{t(e)}))}))}))},{Boolean:Ll}=ce;function Dl(e,t,i){const r=e.slice();return r[26]=t[i],r[28]=i,r}function Rl(e){let t,i,r,n,o,s,a,l,c,u,h,d=e[26].id.toUpperCase()+"",p=e[28]>=2&&function(e){let t,i,r,n,o;function s(){return e[16](e[26])}return i=new Ka({props:{icon:Ua}}),{c(){t=w("button"),me(i.$$.fragment),A(t,"class","remove-stop svelte-17426y6"),t.disabled=e[0]},m(e,a){v(e,t,a),ge(i,t,null),r=!0,n||(o=k(t,"click",s),n=!0)},p(i,n){e=i,(!r||1&n)&&(t.disabled=e[0])},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(e){e&&x(t),ye(i),n=!1,o()}}}(e);return{c(){t=w("div"),i=w("div"),r=w("span"),n=S(d),o=S(":"),s=C(),a=w("div"),l=w("div"),u=C(),p&&p.c(),A(r,"class","label svelte-17426y6"),A(l,"id",c=e[26].id),A(l,"class","geocoder unfocused-input svelte-17426y6"),A(a,"class","geocoder-container svelte-17426y6"),A(i,"class","search-container svelte-17426y6"),A(t,"class","stop svelte-17426y6")},m(e,c){v(e,t,c),_(t,i),_(i,r),_(r,n),_(r,o),_(i,s),_(i,a),_(a,l),_(t,u),p&&p.m(t,null),h=!0},p(e,t){(!h||2&t)&&d!==(d=e[26].id.toUpperCase()+"")&&P(n,d),(!h||2&t&&c!==(c=e[26].id))&&A(l,"id",c),e[28]>=2&&p.p(e,t)},i(e){h||(ae(p),h=!0)},o(e){le(p),h=!1},d(e){e&&x(t),p&&p.d()}}}function Bl(e){let t,i,r,n,o,l,c,u,h,d,p,f,m,g,y,T,M,E,I,z,L,D,R,B,O,F,j,$=e[0]?"Cancel route":"Run route",N=e[11]&&e[11].length&&function(e){let t,i,r;return i=new ds({props:{titleText:"Presets",selectedId:e[4],items:e[11]}}),i.$on("select",e[12]),{c(){t=w("div"),me(i.$$.fragment),A(t,"class","dropdown svelte-17426y6")},m(e,n){v(e,t,n),ge(i,t,null),r=!0},p(e,t){const r={};16&t&&(r.selectedId=e[4]),i.$set(r)},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(e){e&&x(t),ye(i)}}}(e),U=e[1],V=[];for(let t=0;t<U.length;t+=1)V[t]=Rl(Dl(e,U,t));const G=e=>le(V[e],1,1,(()=>{V[e]=null}));return{c(){t=w("div"),N&&N.c(),i=C();for(let e=0;e<V.length;e+=1)V[e].c();r=C(),n=w("div"),o=w("button"),l=S("Add stop"),h=C(),d=w("button"),p=S("Clear route"),m=C(),g=w("button"),y=S("Submit"),M=C(),E=w("button"),I=S("Copy route to clipboard"),L=C(),D=w("button"),R=S($),A(o,"class","secondary-button svelte-17426y6"),o.disabled=c=e[1].length>=4||e[0],A(o,"title",u=e[1].length>=4?"maximum of 4 stops allowed":""),A(d,"class","secondary-button svelte-17426y6"),d.disabled=e[0],A(d,"title",f=e[1].length>=4?"maximum of 4 stops allowed":""),A(n,"class","button-margin svelte-17426y6"),A(g,"class","primary-button button-margin svelte-17426y6"),g.disabled=T=e[3]||e[0],A(E,"class","primary-button button-margin mt12 svelte-17426y6"),E.disabled=z=!e[2],A(D,"class","primary-button button-margin svelte-17426y6"),D.disabled=B=!e[2],A(t,"class","directions svelte-17426y6")},m(s,c){v(s,t,c),N&&N.m(t,null),_(t,i);for(let e=0;e<V.length;e+=1)V[e].m(t,null);_(t,r),_(t,n),_(n,o),_(o,l),_(n,h),_(n,d),_(d,p),_(t,m),_(t,g),_(g,y),_(t,M),_(t,E),_(E,I),_(t,L),_(t,D),_(D,R),O=!0,F||(j=[k(o,"click",e[6]),k(d,"click",e[8]),k(g,"click",e[5]),k(E,"click",e[13]),k(D,"click",(function(){a(e[0]?e[10]:e[9])&&(e[0]?e[10]:e[9]).apply(this,arguments)}))],F=!0)},p(i,[n]){if((e=i)[11]&&e[11].length&&N.p(e,n),131&n){let i;for(U=e[1],i=0;i<U.length;i+=1){const o=Dl(e,U,i);V[i]?(V[i].p(o,n),ae(V[i],1)):(V[i]=Rl(o),V[i].c(),ae(V[i],1),V[i].m(t,r))}for(oe(),i=U.length;i<V.length;i+=1)G(i);se()}(!O||3&n&&c!==(c=e[1].length>=4||e[0]))&&(o.disabled=c),(!O||2&n&&u!==(u=e[1].length>=4?"maximum of 4 stops allowed":""))&&A(o,"title",u),(!O||1&n)&&(d.disabled=e[0]),(!O||2&n&&f!==(f=e[1].length>=4?"maximum of 4 stops allowed":""))&&A(d,"title",f),(!O||9&n&&T!==(T=e[3]||e[0]))&&(g.disabled=T),(!O||4&n&&z!==(z=!e[2]))&&(E.disabled=z),(!O||1&n)&&$!==($=e[0]?"Cancel route":"Run route")&&P(R,$),(!O||4&n&&B!==(B=!e[2]))&&(D.disabled=B)},i(e){if(!O){ae(N);for(let e=0;e<U.length;e+=1)ae(V[e]);O=!0}},o(e){le(N),V=V.filter(Ll);for(let e=0;e<V.length;e+=1)le(V[e]);O=!1},d(e){e&&x(t),N&&N.d(),b(V,e),F=!1,s(j)}}}function Ol(e,t,i){let r,n,o,{routeFlag:s}=t,{setRouteFlag:a}=t;Ge.subscribe((e=>i(15,({mapboxGlAccessToken:r,directionsApiCall:n,presetRoutes:o}=e),o)));let l,c,u=!1,h="custom",d=Oe;Ze.subscribe((e=>{e&&e.hasOwnProperty("locations")&&i(1,d=e.locations)})),Xe.subscribe((e=>l=e));const p=()=>d.map((e=>e.center)).filter(Boolean).length>=2,f=async()=>{const e=d.map((e=>e.center?e.center:_(e.id))).filter(Boolean),t=n?await n(...e):await el(...e);t&&(i(2,c=t),Ze.set({locations:d,response:t}))},m=e=>{const t=new Ja({accessToken:r,mapboxgl:gt});t.addTo(`#${e}`),t.on("result",(t=>{const{center:r,placeName:n}=(e=>{const{place_name:t}=e;return{center:{lat:e.center[1],lng:e.center[0]},placeName:t}})(t.result);i(1,d=d.map((t=>t.id===e?{...t,center:r,locationText:n}:t)))})),t.on("clear",(t=>{i(1,d=d.map((t=>t.id===e?{...t,center:null,locationText:""}:t)))}))},g=e=>{const t=document.getElementById(e);t.classList.remove("focused-input"),t.classList.add("unfocused-input")},y=()=>{[...document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")].forEach(((e,t)=>{e.value=d[t].locationText,e.addEventListener("focusin",(()=>(e=>{const t=document.getElementById(e);t.classList.remove("unfocused-input"),t.classList.add("focused-input"),d.filter((t=>t.id!==e)).map((e=>e.id)).forEach((e=>{g(e)}))})(d[t].id)))}))};j((()=>{d.forEach((e=>m(e.id))),y(),p()&&f()}));const _=e=>{i(1,d=d.filter((t=>t.id!==e)))},v=async()=>{i(1,d=Oe),await K(),y(),Ze.set({locations:d,response:null}),i(2,c=void 0);l.getSource(Fe).setData({type:"FeatureCollection",features:[]})},x=o?o.map((e=>({id:e.id,text:e.name}))).concat([{id:"custom",text:"Custom"}]):null;return e.$$set=e=>{"routeFlag"in e&&i(0,s=e.routeFlag),"setRouteFlag"in e&&i(14,a=e.setRouteFlag)},e.$$.update=()=>{if(2&e.$$.dirty&&d&&i(3,u=!p()),32770&e.$$.dirty){const e=o.find((e=>{const{route:t}=e;return d.every((e=>Object.entries(e).every((([e,i])=>t.some((t=>JSON.stringify(t[e])===JSON.stringify(i)))))))}));i(4,h=e?e?.id:"custom")}},[s,d,c,u,h,f,async()=>{const e=String.fromCharCode(d.length+1+64).toLowerCase();i(1,d=d.concat([{id:e,center:null,locationText:""}])),await K(),m(e)},_,v,async()=>{a(!0),await Pl(l,c),a(!1)},async()=>{await Pl(l,{steps:null}),a(!1)},x,e=>{const{selectedId:t}=e.detail;if(i(4,h=t),"custom"===t)return;v();const r=o.find((e=>e.id===h));r&&i(1,d=r.route)},()=>{navigator.clipboard.writeText(JSON.stringify(d,null,2))},a,o,e=>_(e.id)]}class Fl extends ve{constructor(e){super(),_e(this,e,Ol,Bl,l,{routeFlag:0,setRouteFlag:14})}}let jl,$l,Nl,Ul,Vl;const Gl=()=>{const e=jl.memory().subarray($l);Nl.readPixels(0,0,Ul,Vl,Nl.RGBA,Nl.UNSIGNED_BYTE,e),jl.encodeRGBPointer()};function ql(e){let t;return{c(){t=w("div"),A(t,"class","record svelte-2yk0nq")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function Zl(e){let t,i,r,n,o,a,l,c,u,h,d,p,f,m,g,y;r=new ds({props:{titleText:"Moments",selectedId:e[3],label:"Select a maneuver",items:e[2],disabled:!e[0].length}}),r.$on("select",e[10]);let b=e[1]&&ql();return{c(){t=w("div"),i=w("div"),me(r.$$.fragment),n=C(),o=w("button"),a=S("Submit"),c=C(),u=w("button"),h=S("Record"),p=C(),b&&b.c(),f=M(),A(i,"class","dropdown-container svelte-2yk0nq"),A(o,"class","primary-button svelte-2yk0nq"),o.disabled=l=!e[3]||!e[0].length,A(u,"class","primary-button svelte-2yk0nq"),u.disabled=d=!e[3]||!e[0].length,A(t,"class","container svelte-2yk0nq")},m(s,l){v(s,t,l),_(t,i),ge(r,i,null),_(t,n),_(t,o),_(o,a),_(t,c),_(t,u),_(u,h),v(s,p,l),b&&b.m(s,l),v(s,f,l),m=!0,g||(y=[k(o,"click",e[5]),k(u,"click",e[6])],g=!0)},p(e,[t]){const i={};8&t&&(i.selectedId=e[3]),4&t&&(i.items=e[2]),1&t&&(i.disabled=!e[0].length),r.$set(i),(!m||9&t&&l!==(l=!e[3]||!e[0].length))&&(o.disabled=l),(!m||9&t&&d!==(d=!e[3]||!e[0].length))&&(u.disabled=d),e[1]?b||(b=ql(),b.c(),b.m(f.parentNode,f)):b&&(b.d(1),b=null)},i(e){m||(ae(r.$$.fragment,e),m=!0)},o(e){le(r.$$.fragment,e),m=!1},d(e){e&&x(t),ye(r),e&&x(p),b&&b.d(e),e&&x(f),g=!1,s(y)}}}function Wl(t,i,r){let n,o,s,{routeFlag:a}=i,{setRouteFlag:l}=i,c=!1,u=null,h="";Ze.subscribe((e=>{if(r(9,u=e&&e?.response?e?.response:null),e&&e?.locations&&e?.locations.every((e=>!!e?.center))){h=0;for(const t of e?.locations){const{center:e}=t;h=h+e.lat+e.lng}h=`${h}`.replace(".","")}})),Xe.subscribe((e=>n=e)),Ge.subscribe((e=>({routingOptions:o,speedOptions:s}=e)));let d,p=[],f=[];const m=e=>{r(3,d=e)},g=async()=>{const e=p.find((e=>e.id===d));await(async e=>{const t={coordinates:(e?.steps||[]).reduce(((e,t)=>e.concat(t?.geometry?.coordinates||[])),[]),steps:e.steps};l(!0),await Pl(n,t),l(!1)})(e)};return t.$$set=e=>{"routeFlag"in e&&r(7,a=e.routeFlag),"setRouteFlag"in e&&r(8,l=e.setRouteFlag)},t.$$.update=()=>{512&t.$$.dirty&&(u?(e=>{const t=e.steps;for(let e=0;e<t.length;e++){const i={units:"meters"},n=t?.[e-1],a=t[e],{distance:l,geometry:c,duration:u,maneuver:h}=a,d=n?.geometry,f=d&&gl(d,i),m=gl(c,i),g=n&&n?.distance/n?.duration,y=l/u,_=g&&g>=s?.speed?s?.leadDistance:o?.leadDistance,v=y&&y>=s?.speed?s?.leadDistance:o?.leadDistance;let x=d,b=c,w=f&&Math.min(_,f),T=Math.min(v,m);f&&(x=yl(d,Math.max(0,f-_),f,i)?.geometry),T&&(b=yl(c,0,T,i)?.geometry);let S=Math.min(_,f)/f*n?.duration??0,C=Math.min(v,m)/m*u;const M={geometry:x,distance:w,duration:S,maneuver:{bearing_after:h.bearing_before}},k={geometry:b,distance:T,duration:C,maneuver:h};r(0,p=p.concat([{maneuver:h,steps:x?[M,k]:[k],id:`${e}`}]))}})(u):r(0,p=[])),128&t.$$.dirty&&(a||r(1,c=!1)),1&t.$$.dirty&&r(2,f=p.map((e=>{const{type:t,instruction:i}=e.maneuver,r=`${t}: ${i}`;return{id:e.id,text:r}})))},[p,c,f,d,m,g,async()=>{const{id:t,maneuver:i}=p.find((e=>e.id===d));let o=i?.instruction||i?.type;o=`${h}-${t}-${o.toLowerCase().replaceAll(" ","-")}`,r(1,c=!0),await(async t=>{const i=await e();Nl=t.painter.context.gl,Ul=Nl.drawingBufferWidth,Vl=Nl.drawingBufferHeight,jl=i.create({width:Ul,height:Vl,fps:30,kbps:8e3,rgbFlipY:!0}),$l=jl.getRGBPointer()})(n),n.on("render",Gl),await g(),n.off("render",Gl),(e=>{const t=jl.end(),i=document.createElement("a");i.href=URL.createObjectURL(new Blob([t],{type:"video/mp4"})),i.download=e,i.click()})(o),r(1,c=!1)},a,l,u,e=>m(e.detail.selectedId)]}class Hl extends ve{constructor(e){super(),_e(this,e,Wl,Zl,l,{routeFlag:7,setRouteFlag:8})}}var Xl={exports:{}};!function(e){e.defineMode("javascript",(function(t,i){var r,n,o=t.indentUnit,s=i.statementIndent,a=i.jsonld,l=i.json||a,c=!1!==i.trackScope,u=i.typescript,h=i.wordCharacters||/[\w$\xa1-\uffff]/,d=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),i=e("keyword b"),r=e("keyword c"),n=e("keyword d"),o=e("operator"),s={type:"atom",style:"atom"};return{if:e("if"),while:t,with:t,else:i,do:i,try:i,finally:i,return:n,break:n,continue:n,new:e("new"),delete:r,void:r,throw:r,debugger:e("debugger"),var:e("var"),const:e("var"),let:e("var"),function:e("function"),catch:e("catch"),for:e("for"),switch:e("switch"),case:e("case"),default:e("default"),in:o,typeof:o,instanceof:o,true:s,false:s,null:s,undefined:s,NaN:s,Infinity:s,this:e("this"),class:e("class"),super:e("atom"),yield:r,export:e("export"),import:e("import"),extends:r,await:r}}(),p=/[+\-*&%=<>!?|~^@]/,f=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function m(e){for(var t,i=!1,r=!1;null!=(t=e.next());){if(!i){if("/"==t&&!r)return;"["==t?r=!0:r&&"]"==t&&(r=!1)}i=!i&&"\\"==t}}function g(e,t,i){return r=e,n=i,t}function y(e,t){var i=e.next();if('"'==i||"'"==i)return t.tokenize=_(i),t.tokenize(e,t);if("."==i&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return g("number","number");if("."==i&&e.match(".."))return g("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return g(i);if("="==i&&e.eat(">"))return g("=>","operator");if("0"==i&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return g("number","number");if(/\d/.test(i))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),g("number","number");if("/"==i)return e.eat("*")?(t.tokenize=v,v(e,t)):e.eat("/")?(e.skipToEnd(),g("comment","comment")):nt(e,t,1)?(m(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),g("regexp","string-2")):(e.eat("="),g("operator","operator",e.current()));if("`"==i)return t.tokenize=x,x(e,t);if("#"==i&&"!"==e.peek())return e.skipToEnd(),g("meta","meta");if("#"==i&&e.eatWhile(h))return g("variable","property");if("<"==i&&e.match("!--")||"-"==i&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),g("comment","comment");if(p.test(i))return">"==i&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=i&&"="!=i||e.eat("="):/[<>*+\-|&?]/.test(i)&&(e.eat(i),">"==i&&e.eat(i))),"?"==i&&e.eat(".")?g("."):g("operator","operator",e.current());if(h.test(i)){e.eatWhile(h);var r=e.current();if("."!=t.lastType){if(d.propertyIsEnumerable(r)){var n=d[r];return g(n.type,n.style,r)}if("async"==r&&e.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return g("async","keyword",r)}return g("variable","variable",r)}}function _(e){return function(t,i){var r,n=!1;if(a&&"@"==t.peek()&&t.match(f))return i.tokenize=y,g("jsonld-keyword","meta");for(;null!=(r=t.next())&&(r!=e||n);)n=!n&&"\\"==r;return n||(i.tokenize=y),g("string","string")}}function v(e,t){for(var i,r=!1;i=e.next();){if("/"==i&&r){t.tokenize=y;break}r="*"==i}return g("comment","comment")}function x(e,t){for(var i,r=!1;null!=(i=e.next());){if(!r&&("`"==i||"$"==i&&e.eat("{"))){t.tokenize=y;break}r=!r&&"\\"==i}return g("quasi","string-2",e.current())}var b="([{}])";function w(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var i=e.string.indexOf("=>",e.start);if(!(i<0)){if(u){var r=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,i));r&&(i=r.index)}for(var n=0,o=!1,s=i-1;s>=0;--s){var a=e.string.charAt(s),l=b.indexOf(a);if(l>=0&&l<3){if(!n){++s;break}if(0==--n){"("==a&&(o=!0);break}}else if(l>=3&&l<6)++n;else if(h.test(a))o=!0;else if(/["'\/`]/.test(a))for(;;--s){if(0==s)return;if(e.string.charAt(s-1)==a&&"\\"!=e.string.charAt(s-2)){s--;break}}else if(o&&!n){++s;break}}o&&!n&&(t.fatArrowAt=s)}}var T={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function S(e,t,i,r,n,o){this.indented=e,this.column=t,this.type=i,this.prev=n,this.info=o,null!=r&&(this.align=r)}function C(e,t){if(!c)return!1;for(var i=e.localVars;i;i=i.next)if(i.name==t)return!0;for(var r=e.context;r;r=r.prev)for(i=r.vars;i;i=i.next)if(i.name==t)return!0}function M(e,t,i,r,n){var o=e.cc;for(k.state=e,k.stream=n,k.marked=null,k.cc=o,k.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((o.length?o.pop():l?q:V)(i,r)){for(;o.length&&o[o.length-1].lex;)o.pop()();return k.marked?k.marked:"variable"==i&&C(e,r)?"variable-2":t}}var k={state:null,column:null,marked:null,cc:null};function E(){for(var e=arguments.length-1;e>=0;e--)k.cc.push(arguments[e])}function A(){return E.apply(null,arguments),!0}function I(e,t){for(var i=t;i;i=i.next)if(i.name==e)return!0;return!1}function z(e){var t=k.state;if(k.marked="def",c){if(t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var r=P(e,t.context);if(null!=r)return void(t.context=r)}else if(!I(e,t.localVars))return void(t.localVars=new R(e,t.localVars));i.globalVars&&!I(e,t.globalVars)&&(t.globalVars=new R(e,t.globalVars))}}function P(e,t){if(t){if(t.block){var i=P(e,t.prev);return i?i==t.prev?t:new D(i,t.vars,!0):null}return I(e,t.vars)?t:new D(t.prev,new R(e,t.vars),!1)}return null}function L(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function D(e,t,i){this.prev=e,this.vars=t,this.block=i}function R(e,t){this.name=e,this.next=t}var B=new R("this",new R("arguments",null));function O(){k.state.context=new D(k.state.context,k.state.localVars,!1),k.state.localVars=B}function F(){k.state.context=new D(k.state.context,k.state.localVars,!0),k.state.localVars=null}function j(){k.state.localVars=k.state.context.vars,k.state.context=k.state.context.prev}function $(e,t){var i=function(){var i=k.state,r=i.indented;if("stat"==i.lexical.type)r=i.lexical.indented;else for(var n=i.lexical;n&&")"==n.type&&n.align;n=n.prev)r=n.indented;i.lexical=new S(r,k.stream.column(),e,null,i.lexical,t)};return i.lex=!0,i}function N(){var e=k.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function U(e){function t(i){return i==e?A():";"==e||"}"==i||")"==i||"]"==i?E():A(t)}return t}function V(e,t){return"var"==e?A($("vardef",t),Ee,U(";"),N):"keyword a"==e?A($("form"),W,V,N):"keyword b"==e?A($("form"),V,N):"keyword d"==e?k.stream.match(/^\s*$/,!1)?A():A($("stat"),X,U(";"),N):"debugger"==e?A(U(";")):"{"==e?A($("}"),F,de,N,j):";"==e?A():"if"==e?("else"==k.state.lexical.info&&k.state.cc[k.state.cc.length-1]==N&&k.state.cc.pop()(),A($("form"),W,V,N,De)):"function"==e?A(Fe):"for"==e?A($("form"),F,Re,V,j,N):"class"==e||u&&"interface"==t?(k.marked="keyword",A($("form","class"==e?e:t),Ve,N)):"variable"==e?u&&"declare"==t?(k.marked="keyword",A(V)):u&&("module"==t||"enum"==t||"type"==t)&&k.stream.match(/^\s*\w/,!1)?(k.marked="keyword","enum"==t?A(tt):"type"==t?A($e,U("operator"),ye,U(";")):A($("form"),Ae,U("{"),$("}"),de,N,N)):u&&"namespace"==t?(k.marked="keyword",A($("form"),q,V,N)):u&&"abstract"==t?(k.marked="keyword",A(V)):A($("stat"),oe):"switch"==e?A($("form"),W,U("{"),$("}","switch"),F,de,N,N,j):"case"==e?A(q,U(":")):"default"==e?A(U(":")):"catch"==e?A($("form"),O,G,V,N,j):"export"==e?A($("stat"),We,N):"import"==e?A($("stat"),Xe,N):"async"==e?A(V):"@"==t?A(q,V):E($("stat"),q,U(";"),N)}function G(e){if("("==e)return A(Ne,U(")"))}function q(e,t){return H(e,t,!1)}function Z(e,t){return H(e,t,!0)}function W(e){return"("!=e?E():A($(")"),X,U(")"),N)}function H(e,t,i){if(k.state.fatArrowAt==k.stream.start){var r=i?te:ee;if("("==e)return A(O,$(")"),ue(Ne,")"),N,U("=>"),r,j);if("variable"==e)return E(O,Ae,U("=>"),r,j)}var n=i?Y:K;return T.hasOwnProperty(e)?A(n):"function"==e?A(Fe,n):"class"==e||u&&"interface"==t?(k.marked="keyword",A($("form"),Ue,N)):"keyword c"==e||"async"==e?A(i?Z:q):"("==e?A($(")"),X,U(")"),N,n):"operator"==e||"spread"==e?A(i?Z:q):"["==e?A($("]"),et,N,n):"{"==e?he(ae,"}",null,n):"quasi"==e?E(J,n):"new"==e?A(ie(i)):A()}function X(e){return e.match(/[;\}\)\],]/)?E():E(q)}function K(e,t){return","==e?A(X):Y(e,t,!1)}function Y(e,t,i){var r=0==i?K:Y,n=0==i?q:Z;return"=>"==e?A(O,i?te:ee,j):"operator"==e?/\+\+|--/.test(t)||u&&"!"==t?A(r):u&&"<"==t&&k.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?A($(">"),ue(ye,">"),N,r):"?"==t?A(q,U(":"),n):A(n):"quasi"==e?E(J,r):";"!=e?"("==e?he(Z,")","call",r):"."==e?A(se,r):"["==e?A($("]"),X,U("]"),N,r):u&&"as"==t?(k.marked="keyword",A(ye,r)):"regexp"==e?(k.state.lastType=k.marked="operator",k.stream.backUp(k.stream.pos-k.stream.start-1),A(n)):void 0:void 0}function J(e,t){return"quasi"!=e?E():"${"!=t.slice(t.length-2)?A(J):A(X,Q)}function Q(e){if("}"==e)return k.marked="string-2",k.state.tokenize=x,A(J)}function ee(e){return w(k.stream,k.state),E("{"==e?V:q)}function te(e){return w(k.stream,k.state),E("{"==e?V:Z)}function ie(e){return function(t){return"."==t?A(e?ne:re):"variable"==t&&u?A(Ce,e?Y:K):E(e?Z:q)}}function re(e,t){if("target"==t)return k.marked="keyword",A(K)}function ne(e,t){if("target"==t)return k.marked="keyword",A(Y)}function oe(e){return":"==e?A(N,V):E(K,U(";"),N)}function se(e){if("variable"==e)return k.marked="property",A()}function ae(e,t){return"async"==e?(k.marked="property",A(ae)):"variable"==e||"keyword"==k.style?(k.marked="property","get"==t||"set"==t?A(le):(u&&k.state.fatArrowAt==k.stream.start&&(i=k.stream.match(/^\s*:\s*/,!1))&&(k.state.fatArrowAt=k.stream.pos+i[0].length),A(ce))):"number"==e||"string"==e?(k.marked=a?"property":k.style+" property",A(ce)):"jsonld-keyword"==e?A(ce):u&&L(t)?(k.marked="keyword",A(ae)):"["==e?A(q,pe,U("]"),ce):"spread"==e?A(Z,ce):"*"==t?(k.marked="keyword",A(ae)):":"==e?E(ce):void 0;var i}function le(e){return"variable"!=e?E(ce):(k.marked="property",A(Fe))}function ce(e){return":"==e?A(Z):"("==e?E(Fe):void 0}function ue(e,t,i){function r(n,o){if(i?i.indexOf(n)>-1:","==n){var s=k.state.lexical;return"call"==s.info&&(s.pos=(s.pos||0)+1),A((function(i,r){return i==t||r==t?E():E(e)}),r)}return n==t||o==t?A():i&&i.indexOf(";")>-1?E(e):A(U(t))}return function(i,n){return i==t||n==t?A():E(e,r)}}function he(e,t,i){for(var r=3;r<arguments.length;r++)k.cc.push(arguments[r]);return A($(t,i),ue(e,t),N)}function de(e){return"}"==e?A():E(V,de)}function pe(e,t){if(u){if(":"==e)return A(ye);if("?"==t)return A(pe)}}function fe(e,t){if(u&&(":"==e||"in"==t))return A(ye)}function me(e){if(u&&":"==e)return k.stream.match(/^\s*\w+\s+is\b/,!1)?A(q,ge,ye):A(ye)}function ge(e,t){if("is"==t)return k.marked="keyword",A()}function ye(e,t){return"keyof"==t||"typeof"==t||"infer"==t||"readonly"==t?(k.marked="keyword",A("typeof"==t?Z:ye)):"variable"==e||"void"==t?(k.marked="type",A(Se)):"|"==t||"&"==t?A(ye):"string"==e||"number"==e||"atom"==e?A(Se):"["==e?A($("]"),ue(ye,"]",","),N,Se):"{"==e?A($("}"),ve,N,Se):"("==e?A(ue(Te,")"),_e,Se):"<"==e?A(ue(ye,">"),ye):"quasi"==e?E(be,Se):void 0}function _e(e){if("=>"==e)return A(ye)}function ve(e){return e.match(/[\}\)\]]/)?A():","==e||";"==e?A(ve):E(xe,ve)}function xe(e,t){return"variable"==e||"keyword"==k.style?(k.marked="property",A(xe)):"?"==t||"number"==e||"string"==e?A(xe):":"==e?A(ye):"["==e?A(U("variable"),fe,U("]"),xe):"("==e?E(je,xe):e.match(/[;\}\)\],]/)?void 0:A()}function be(e,t){return"quasi"!=e?E():"${"!=t.slice(t.length-2)?A(be):A(ye,we)}function we(e){if("}"==e)return k.marked="string-2",k.state.tokenize=x,A(be)}function Te(e,t){return"variable"==e&&k.stream.match(/^\s*[?:]/,!1)||"?"==t?A(Te):":"==e?A(ye):"spread"==e?A(Te):E(ye)}function Se(e,t){return"<"==t?A($(">"),ue(ye,">"),N,Se):"|"==t||"."==e||"&"==t?A(ye):"["==e?A(ye,U("]"),Se):"extends"==t||"implements"==t?(k.marked="keyword",A(ye)):"?"==t?A(ye,U(":"),ye):void 0}function Ce(e,t){if("<"==t)return A($(">"),ue(ye,">"),N,Se)}function Me(){return E(ye,ke)}function ke(e,t){if("="==t)return A(ye)}function Ee(e,t){return"enum"==t?(k.marked="keyword",A(tt)):E(Ae,pe,Pe,Le)}function Ae(e,t){return u&&L(t)?(k.marked="keyword",A(Ae)):"variable"==e?(z(t),A()):"spread"==e?A(Ae):"["==e?he(ze,"]"):"{"==e?he(Ie,"}"):void 0}function Ie(e,t){return"variable"!=e||k.stream.match(/^\s*:/,!1)?("variable"==e&&(k.marked="property"),"spread"==e?A(Ae):"}"==e?E():"["==e?A(q,U("]"),U(":"),Ie):A(U(":"),Ae,Pe)):(z(t),A(Pe))}function ze(){return E(Ae,Pe)}function Pe(e,t){if("="==t)return A(Z)}function Le(e){if(","==e)return A(Ee)}function De(e,t){if("keyword b"==e&&"else"==t)return A($("form","else"),V,N)}function Re(e,t){return"await"==t?A(Re):"("==e?A($(")"),Be,N):void 0}function Be(e){return"var"==e?A(Ee,Oe):"variable"==e?A(Oe):E(Oe)}function Oe(e,t){return")"==e?A():";"==e?A(Oe):"in"==t||"of"==t?(k.marked="keyword",A(q,Oe)):E(q,Oe)}function Fe(e,t){return"*"==t?(k.marked="keyword",A(Fe)):"variable"==e?(z(t),A(Fe)):"("==e?A(O,$(")"),ue(Ne,")"),N,me,V,j):u&&"<"==t?A($(">"),ue(Me,">"),N,Fe):void 0}function je(e,t){return"*"==t?(k.marked="keyword",A(je)):"variable"==e?(z(t),A(je)):"("==e?A(O,$(")"),ue(Ne,")"),N,me,j):u&&"<"==t?A($(">"),ue(Me,">"),N,je):void 0}function $e(e,t){return"keyword"==e||"variable"==e?(k.marked="type",A($e)):"<"==t?A($(">"),ue(Me,">"),N):void 0}function Ne(e,t){return"@"==t&&A(q,Ne),"spread"==e?A(Ne):u&&L(t)?(k.marked="keyword",A(Ne)):u&&"this"==e?A(pe,Pe):E(Ae,pe,Pe)}function Ue(e,t){return"variable"==e?Ve(e,t):Ge(e,t)}function Ve(e,t){if("variable"==e)return z(t),A(Ge)}function Ge(e,t){return"<"==t?A($(">"),ue(Me,">"),N,Ge):"extends"==t||"implements"==t||u&&","==e?("implements"==t&&(k.marked="keyword"),A(u?ye:q,Ge)):"{"==e?A($("}"),qe,N):void 0}function qe(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||u&&L(t))&&k.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(k.marked="keyword",A(qe)):"variable"==e||"keyword"==k.style?(k.marked="property",A(Ze,qe)):"number"==e||"string"==e?A(Ze,qe):"["==e?A(q,pe,U("]"),Ze,qe):"*"==t?(k.marked="keyword",A(qe)):u&&"("==e?E(je,qe):";"==e||","==e?A(qe):"}"==e?A():"@"==t?A(q,qe):void 0}function Ze(e,t){if("!"==t)return A(Ze);if("?"==t)return A(Ze);if(":"==e)return A(ye,Pe);if("="==t)return A(Z);var i=k.state.lexical.prev;return E(i&&"interface"==i.info?je:Fe)}function We(e,t){return"*"==t?(k.marked="keyword",A(Qe,U(";"))):"default"==t?(k.marked="keyword",A(q,U(";"))):"{"==e?A(ue(He,"}"),Qe,U(";")):E(V)}function He(e,t){return"as"==t?(k.marked="keyword",A(U("variable"))):"variable"==e?E(Z,He):void 0}function Xe(e){return"string"==e?A():"("==e?E(q):"."==e?E(K):E(Ke,Ye,Qe)}function Ke(e,t){return"{"==e?he(Ke,"}"):("variable"==e&&z(t),"*"==t&&(k.marked="keyword"),A(Je))}function Ye(e){if(","==e)return A(Ke,Ye)}function Je(e,t){if("as"==t)return k.marked="keyword",A(Ke)}function Qe(e,t){if("from"==t)return k.marked="keyword",A(q)}function et(e){return"]"==e?A():E(ue(Z,"]"))}function tt(){return E($("form"),Ae,U("{"),$("}"),ue(it,"}"),N,N)}function it(){return E(Ae,Pe)}function rt(e,t){return"operator"==e.lastType||","==e.lastType||p.test(t.charAt(0))||/[,.]/.test(t.charAt(0))}function nt(e,t,i){return t.tokenize==y&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(i||0)))}return O.lex=F.lex=!0,j.lex=!0,N.lex=!0,{startState:function(e){var t={tokenize:y,lastType:"sof",cc:[],lexical:new S((e||0)-o,0,"block",!1),localVars:i.localVars,context:i.localVars&&new D(null,null,!1),indented:e||0};return i.globalVars&&"object"==typeof i.globalVars&&(t.globalVars=i.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),w(e,t)),t.tokenize!=v&&e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==r?i:(t.lastType="operator"!=r||"++"!=n&&"--"!=n?r:"incdec",M(t,i,r,n,e))},indent:function(t,r){if(t.tokenize==v||t.tokenize==x)return e.Pass;if(t.tokenize!=y)return 0;var n,a=r&&r.charAt(0),l=t.lexical;if(!/^\s*else\b/.test(r))for(var c=t.cc.length-1;c>=0;--c){var u=t.cc[c];if(u==N)l=l.prev;else if(u!=De&&u!=j)break}for(;("stat"==l.type||"form"==l.type)&&("}"==a||(n=t.cc[t.cc.length-1])&&(n==K||n==Y)&&!/^[,\.=+\-*:?[\(]/.test(r));)l=l.prev;s&&")"==l.type&&"stat"==l.prev.type&&(l=l.prev);var h=l.type,d=a==h;return"vardef"==h?l.indented+("operator"==t.lastType||","==t.lastType?l.info.length+1:0):"form"==h&&"{"==a?l.indented:"form"==h?l.indented+o:"stat"==h?l.indented+(rt(t,r)?s||o:0):"switch"!=l.info||d||0==i.doubleIndentSwitch?l.align?l.column+(d?0:1):l.indented+(d?0:o):l.indented+(/^(?:case|default)\b/.test(r)?o:2*o)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:l?null:"/*",blockCommentEnd:l?null:"*/",blockCommentContinue:l?null:" * ",lineComment:l?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:l?"json":"javascript",jsonldMode:a,jsonMode:l,expressionAllowed:nt,skipExpression:function(t){M(t,"atom","atom","true",new e.StringStream("",2,null))}}})),e.registerHelper("wordChars","javascript",/[\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/x-javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/manifest+json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}(Xl.exports=function(){var e=navigator.userAgent,t=navigator.platform,i=/gecko\/\d/i.test(e),r=/MSIE \d/.test(e),n=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),o=/Edge\/(\d+)/.exec(e),s=r||n||o,a=s&&(r?document.documentMode||6:+(o||n)[1]),l=!o&&/WebKit\//.test(e),c=l&&/Qt\/\d+\.\d+/.test(e),u=!o&&/Chrome\/(\d+)/.exec(e),h=u&&+u[1],d=/Opera\//.test(e),p=/Apple Computer/.test(navigator.vendor),f=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),m=/PhantomJS/.test(e),g=p&&(/Mobile\/\w+/.test(e)||navigator.maxTouchPoints>2),y=/Android/.test(e),_=g||y||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),v=g||/Mac/.test(t),x=/\bCrOS\b/.test(e),b=/win/i.test(t),w=d&&e.match(/Version\/(\d*\.\d*)/);w&&(w=Number(w[1])),w&&w>=15&&(d=!1,l=!0);var T=v&&(c||d&&(null==w||w<12.11)),S=i||s&&a>=9;function C(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var M,k=function(e,t){var i=e.className,r=C(t).exec(i);if(r){var n=i.slice(r.index+r[0].length);e.className=i.slice(0,r.index)+(n?r[1]+n:"")}};function E(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function A(e,t){return E(e).appendChild(t)}function I(e,t,i,r){var n=document.createElement(e);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)n.appendChild(t[o]);return n}function z(e,t,i,r){var n=I(e,t,i,r);return n.setAttribute("role","presentation"),n}function P(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function L(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function D(e,t){var i=e.className;C(t).test(i)||(e.className+=(i?" ":"")+t)}function R(e,t){for(var i=e.split(" "),r=0;r<i.length;r++)i[r]&&!C(i[r]).test(t)&&(t+=" "+i[r]);return t}M=document.createRange?function(e,t,i,r){var n=document.createRange();return n.setEnd(r||e,i),n.setStart(e,t),n}:function(e,t,i){var r=document.body.createTextRange();try{r.moveToElementText(e.parentNode)}catch(e){return r}return r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",t),r};var B=function(e){e.select()};function O(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function F(e,t,i){for(var r in t||(t={}),e)!e.hasOwnProperty(r)||!1===i&&t.hasOwnProperty(r)||(t[r]=e[r]);return t}function j(e,t,i,r,n){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=r||0,s=n||0;;){var a=e.indexOf("\t",o);if(a<0||a>=t)return s+(t-o);s+=a-o,s+=i-s%i,o=a+1}}g?B=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:s&&(B=function(e){try{e.select()}catch(e){}});var $=function(){this.id=null,this.f=null,this.time=0,this.handler=O(this.onTimeout,this)};function N(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}$.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},$.prototype.set=function(e,t){this.f=t;var i=+new Date+e;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=i)};var U=50,V={toString:function(){return"CodeMirror.Pass"}},G={scroll:!1},q={origin:"*mouse"},Z={origin:"+move"};function W(e,t,i){for(var r=0,n=0;;){var o=e.indexOf("\t",r);-1==o&&(o=e.length);var s=o-r;if(o==e.length||n+s>=t)return r+Math.min(s,t-n);if(n+=o-r,r=o+1,(n+=i-n%i)>=t)return r}}var H=[""];function X(e){for(;H.length<=e;)H.push(K(H)+" ");return H[e]}function K(e){return e[e.length-1]}function Y(e,t){for(var i=[],r=0;r<e.length;r++)i[r]=t(e[r],r);return i}function J(e,t,i){for(var r=0,n=i(t);r<e.length&&i(e[r])<=n;)r++;e.splice(r,0,t)}function Q(){}function ee(e,t){var i;return Object.create?i=Object.create(e):(Q.prototype=e,i=new Q),t&&F(t,i),i}var te=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ie(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||te.test(e))}function re(e,t){return t?!!(t.source.indexOf("\\w")>-1&&ie(e))||t.test(e):ie(e)}function ne(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var oe=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function se(e){return e.charCodeAt(0)>=768&&oe.test(e)}function ae(e,t,i){for(;(i<0?t>0:t<e.length)&&se(e.charAt(t));)t+=i;return t}function le(e,t,i){for(var r=t>i?-1:1;;){if(t==i)return t;var n=(t+i)/2,o=r<0?Math.ceil(n):Math.floor(n);if(o==t)return e(o)?t:i;e(o)?i=o:t=o+r}}function ce(e,t,i,r){if(!e)return r(t,i,"ltr",0);for(var n=!1,o=0;o<e.length;++o){var s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(r(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),n=!0)}n||r(t,i,"ltr")}var ue=null;function he(e,t,i){var r;ue=null;for(var n=0;n<e.length;++n){var o=e[n];if(o.from<t&&o.to>t)return n;o.to==t&&(o.from!=o.to&&"before"==i?r=n:ue=n),o.from==t&&(o.from!=o.to&&"before"!=i?r=n:ue=n)}return null!=r?r:ue}var de=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function i(i){return i<=247?e.charAt(i):1424<=i&&i<=1524?"R":1536<=i&&i<=1785?t.charAt(i-1536):1774<=i&&i<=2220?"r":8192<=i&&i<=8203?"w":8204==i?"b":"L"}var r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,n=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;function l(e,t,i){this.level=e,this.from=t,this.to=i}return function(e,t){var c="ltr"==t?"L":"R";if(0==e.length||"ltr"==t&&!r.test(e))return!1;for(var u=e.length,h=[],d=0;d<u;++d)h.push(i(e.charCodeAt(d)));for(var p=0,f=c;p<u;++p){var m=h[p];"m"==m?h[p]=f:f=m}for(var g=0,y=c;g<u;++g){var _=h[g];"1"==_&&"r"==y?h[g]="n":o.test(_)&&(y=_,"r"==_&&(h[g]="R"))}for(var v=1,x=h[0];v<u-1;++v){var b=h[v];"+"==b&&"1"==x&&"1"==h[v+1]?h[v]="1":","!=b||x!=h[v+1]||"1"!=x&&"n"!=x||(h[v]=x),x=b}for(var w=0;w<u;++w){var T=h[w];if(","==T)h[w]="N";else if("%"==T){var S=void 0;for(S=w+1;S<u&&"%"==h[S];++S);for(var C=w&&"!"==h[w-1]||S<u&&"1"==h[S]?"1":"N",M=w;M<S;++M)h[M]=C;w=S-1}}for(var k=0,E=c;k<u;++k){var A=h[k];"L"==E&&"1"==A?h[k]="L":o.test(A)&&(E=A)}for(var I=0;I<u;++I)if(n.test(h[I])){var z=void 0;for(z=I+1;z<u&&n.test(h[z]);++z);for(var P="L"==(I?h[I-1]:c),L=P==("L"==(z<u?h[z]:c))?P?"L":"R":c,D=I;D<z;++D)h[D]=L;I=z-1}for(var R,B=[],O=0;O<u;)if(s.test(h[O])){var F=O;for(++O;O<u&&s.test(h[O]);++O);B.push(new l(0,F,O))}else{var j=O,$=B.length,N="rtl"==t?1:0;for(++O;O<u&&"L"!=h[O];++O);for(var U=j;U<O;)if(a.test(h[U])){j<U&&(B.splice($,0,new l(1,j,U)),$+=N);var V=U;for(++U;U<O&&a.test(h[U]);++U);B.splice($,0,new l(2,V,U)),$+=N,j=U}else++U;j<O&&B.splice($,0,new l(1,j,O))}return"ltr"==t&&(1==B[0].level&&(R=e.match(/^\s+/))&&(B[0].from=R[0].length,B.unshift(new l(0,0,R[0].length))),1==K(B).level&&(R=e.match(/\s+$/))&&(K(B).to-=R[0].length,B.push(new l(0,u-R[0].length,u)))),"rtl"==t?B.reverse():B}}();function pe(e,t){var i=e.order;return null==i&&(i=e.order=de(e.text,t)),i}var fe=[],me=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var r=e._handlers||(e._handlers={});r[t]=(r[t]||fe).concat(i)}};function ge(e,t){return e._handlers&&e._handlers[t]||fe}function ye(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var r=e._handlers,n=r&&r[t];if(n){var o=N(n,i);o>-1&&(r[t]=n.slice(0,o).concat(n.slice(o+1)))}}}function _e(e,t){var i=ge(e,t);if(i.length)for(var r=Array.prototype.slice.call(arguments,2),n=0;n<i.length;++n)i[n].apply(null,r)}function ve(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),_e(e,i||t.type,e,t),Ce(t)||t.codemirrorIgnore}function xe(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),r=0;r<t.length;++r)-1==N(i,t[r])&&i.push(t[r])}function be(e,t){return ge(e,t).length>0}function we(e){e.prototype.on=function(e,t){me(this,e,t)},e.prototype.off=function(e,t){ye(this,e,t)}}function Te(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Se(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Ce(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Me(e){Te(e),Se(e)}function ke(e){return e.target||e.srcElement}function Ee(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),v&&e.ctrlKey&&1==t&&(t=3),t}var Ae,Ie,ze=function(){if(s&&a<9)return!1;var e=I("div");return"draggable"in e||"dragDrop"in e}();function Pe(e){if(null==Ae){var t=I("span","​");A(e,I("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ae=t.offsetWidth<=1&&t.offsetHeight>2&&!(s&&a<8))}var i=Ae?I("span","​"):I("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function Le(e){if(null!=Ie)return Ie;var t=A(e,document.createTextNode("AخA")),i=M(t,0,1).getBoundingClientRect(),r=M(t,1,2).getBoundingClientRect();return E(e),!(!i||i.left==i.right)&&(Ie=r.right-i.right<3)}var De,Re=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],r=e.length;t<=r;){var n=e.indexOf("\n",t);-1==n&&(n=e.length);var o=e.slice(t,"\r"==e.charAt(n-1)?n-1:n),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),t+=s+1):(i.push(o),t=n+1)}return i}:function(e){return e.split(/\r\n?|\n/)},Be=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Oe="oncopy"in(De=I("div"))||(De.setAttribute("oncopy","return;"),"function"==typeof De.oncopy),Fe=null;function je(e){if(null!=Fe)return Fe;var t=A(e,I("span","x")),i=t.getBoundingClientRect(),r=M(t,0,1).getBoundingClientRect();return Fe=Math.abs(i.left-r.left)>1}var $e={},Ne={};function Ue(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),$e[e]=t}function Ve(e,t){Ne[e]=t}function Ge(e){if("string"==typeof e&&Ne.hasOwnProperty(e))e=Ne[e];else if(e&&"string"==typeof e.name&&Ne.hasOwnProperty(e.name)){var t=Ne[e.name];"string"==typeof t&&(t={name:t}),(e=ee(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function qe(e,t){t=Ge(t);var i=$e[t.name];if(!i)return qe(e,"text/plain");var r=i(e,t);if(Ze.hasOwnProperty(t.name)){var n=Ze[t.name];for(var o in n)n.hasOwnProperty(o)&&(r.hasOwnProperty(o)&&(r["_"+o]=r[o]),r[o]=n[o])}if(r.name=t.name,t.helperType&&(r.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)r[s]=t.modeProps[s];return r}var Ze={};function We(e,t){F(t,Ze.hasOwnProperty(e)?Ze[e]:Ze[e]={})}function He(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var i={};for(var r in t){var n=t[r];n instanceof Array&&(n=n.concat([])),i[r]=n}return i}function Xe(e,t){for(var i;e.innerMode&&(i=e.innerMode(t))&&i.mode!=e;)t=i.state,e=i.mode;return i||{mode:e,state:t}}function Ke(e,t,i){return!e.startState||e.startState(t,i)}var Ye=function(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};function Je(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var r=0;;++r){var n=i.children[r],o=n.chunkSize();if(t<o){i=n;break}t-=o}return i.lines[t]}function Qe(e,t,i){var r=[],n=t.line;return e.iter(t.line,i.line+1,(function(e){var o=e.text;n==i.line&&(o=o.slice(0,i.ch)),n==t.line&&(o=o.slice(t.ch)),r.push(o),++n})),r}function et(e,t,i){var r=[];return e.iter(t,i,(function(e){r.push(e.text)})),r}function tt(e,t){var i=t-e.height;if(i)for(var r=e;r;r=r.parent)r.height+=i}function it(e){if(null==e.parent)return null;for(var t=e.parent,i=N(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var n=0;r.children[n]!=t;++n)i+=r.children[n].chunkSize();return i+t.first}function rt(e,t){var i=e.first;e:do{for(var r=0;r<e.children.length;++r){var n=e.children[r],o=n.height;if(t<o){e=n;continue e}t-=o,i+=n.chunkSize()}return i}while(!e.lines);for(var s=0;s<e.lines.length;++s){var a=e.lines[s].height;if(t<a)break;t-=a}return i+s}function nt(e,t){return t>=e.first&&t<e.first+e.size}function ot(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function st(e,t,i){if(void 0===i&&(i=null),!(this instanceof st))return new st(e,t,i);this.line=e,this.ch=t,this.sticky=i}function at(e,t){return e.line-t.line||e.ch-t.ch}function lt(e,t){return e.sticky==t.sticky&&0==at(e,t)}function ct(e){return st(e.line,e.ch)}function ut(e,t){return at(e,t)<0?t:e}function ht(e,t){return at(e,t)<0?e:t}function dt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function pt(e,t){if(t.line<e.first)return st(e.first,0);var i=e.first+e.size-1;return t.line>i?st(i,Je(e,i).text.length):ft(t,Je(e,t.line).text.length)}function ft(e,t){var i=e.ch;return null==i||i>t?st(e.line,t):i<0?st(e.line,0):e}function mt(e,t){for(var i=[],r=0;r<t.length;r++)i[r]=pt(e,t[r]);return i}Ye.prototype.eol=function(){return this.pos>=this.string.length},Ye.prototype.sol=function(){return this.pos==this.lineStart},Ye.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Ye.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Ye.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},Ye.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},Ye.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},Ye.prototype.skipToEnd=function(){this.pos=this.string.length},Ye.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},Ye.prototype.backUp=function(e){this.pos-=e},Ye.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=j(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?j(this.string,this.lineStart,this.tabSize):0)},Ye.prototype.indentation=function(){return j(this.string,null,this.tabSize)-(this.lineStart?j(this.string,this.lineStart,this.tabSize):0)},Ye.prototype.match=function(e,t,i){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&!1!==t&&(this.pos+=r[0].length),r)}var n=function(e){return i?e.toLowerCase():e};if(n(this.string.substr(this.pos,e.length))==n(e))return!1!==t&&(this.pos+=e.length),!0},Ye.prototype.current=function(){return this.string.slice(this.start,this.pos)},Ye.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},Ye.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},Ye.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var gt=function(e,t){this.state=e,this.lookAhead=t},yt=function(e,t,i,r){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=r||0,this.baseTokens=null,this.baseTokenPos=1};function _t(e,t,i,r){var n=[e.state.modeGen],o={};kt(e,t.text,e.doc.mode,i,(function(e,t){return n.push(e,t)}),o,r);for(var s=i.state,a=function(r){i.baseTokens=n;var a=e.state.overlays[r],l=1,c=0;i.state=!0,kt(e,t.text,a.mode,i,(function(e,t){for(var i=l;c<e;){var r=n[l];r>e&&n.splice(l,1,e,n[l+1],r),l+=2,c=Math.min(e,r)}if(t)if(a.opaque)n.splice(i,l-i,e,"overlay "+t),l=i+2;else for(;i<l;i+=2){var o=n[i+1];n[i+1]=(o?o+" ":"")+"overlay "+t}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1},l=0;l<e.state.overlays.length;++l)a(l);return{styles:n,classes:o.bgClass||o.textClass?o:null}}function vt(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){var r=xt(e,it(t)),n=t.text.length>e.options.maxHighlightLength&&He(e.doc.mode,r.state),o=_t(e,t,r);n&&(r.state=n),t.stateAfter=r.save(!n),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function xt(e,t,i){var r=e.doc,n=e.display;if(!r.mode.startState)return new yt(r,!0,t);var o=Et(e,t,i),s=o>r.first&&Je(r,o-1).stateAfter,a=s?yt.fromSaved(r,s,o):new yt(r,Ke(r.mode),o);return r.iter(o,t,(function(i){bt(e,i.text,a);var r=a.line;i.stateAfter=r==t-1||r%5==0||r>=n.viewFrom&&r<n.viewTo?a.save():null,a.nextLine()})),i&&(r.modeFrontier=a.line),a}function bt(e,t,i,r){var n=e.doc.mode,o=new Ye(t,e.options.tabSize,i);for(o.start=o.pos=r||0,""==t&&wt(n,i.state);!o.eol();)Tt(n,o,i.state),o.start=o.pos}function wt(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var i=Xe(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function Tt(e,t,i,r){for(var n=0;n<10;n++){r&&(r[0]=Xe(e,i).mode);var o=e.token(t,i);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}yt.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},yt.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},yt.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},yt.fromSaved=function(e,t,i){return t instanceof gt?new yt(e,He(e.mode,t.state),i,t.lookAhead):new yt(e,He(e.mode,t),i)},yt.prototype.save=function(e){var t=!1!==e?He(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new gt(t,this.maxLookAhead):t};var St=function(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i};function Ct(e,t,i,r){var n,o,s=e.doc,a=s.mode,l=Je(s,(t=pt(s,t)).line),c=xt(e,t.line,i),u=new Ye(l.text,e.options.tabSize,c);for(r&&(o=[]);(r||u.pos<t.ch)&&!u.eol();)u.start=u.pos,n=Tt(a,u,c.state),r&&o.push(new St(u,n,He(s.mode,c.state)));return r?o:new St(u,n,c.state)}function Mt(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var r=i[1]?"bgClass":"textClass";null==t[r]?t[r]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(t[r])||(t[r]+=" "+i[2])}return e}function kt(e,t,i,r,n,o,s){var a=i.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,u=null,h=new Ye(t,e.options.tabSize,r),d=e.options.addModeClass&&[null];for(""==t&&Mt(wt(i,r.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(a=!1,s&&bt(e,t,r,h.pos),h.pos=t.length,l=null):l=Mt(Tt(i,h,r.state,d),o),d){var p=d[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||u!=l){for(;c<h.start;)n(c=Math.min(h.start,c+5e3),u);u=l}h.start=h.pos}for(;c<h.pos;){var f=Math.min(h.pos,c+5e3);n(f,u),c=f}}function Et(e,t,i){for(var r,n,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=Je(o,a-1),c=l.stateAfter;if(c&&(!i||a+(c instanceof gt?c.lookAhead:0)<=o.modeFrontier))return a;var u=j(l.text,null,e.options.tabSize);(null==n||r>u)&&(n=a-1,r=u)}return n}function At(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var i=e.first,r=t-1;r>i;r--){var n=Je(e,r).stateAfter;if(n&&(!(n instanceof gt)||r+n.lookAhead<t)){i=r+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)}}var It=!1,zt=!1;function Pt(){It=!0}function Lt(){zt=!0}function Dt(e,t,i){this.marker=e,this.from=t,this.to=i}function Rt(e,t){if(e)for(var i=0;i<e.length;++i){var r=e[i];if(r.marker==t)return r}}function Bt(e,t){for(var i,r=0;r<e.length;++r)e[r]!=t&&(i||(i=[])).push(e[r]);return i}function Ot(e,t,i){var r=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));r&&e.markedSpans&&r.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],r&&r.add(e.markedSpans)),t.marker.attachLine(e)}function Ft(e,t,i){var r;if(e)for(var n=0;n<e.length;++n){var o=e[n],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(r||(r=[])).push(new Dt(s,o.from,a?null:o.to))}}return r}function jt(e,t,i){var r;if(e)for(var n=0;n<e.length;++n){var o=e[n],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(r||(r=[])).push(new Dt(s,a?null:o.from-t,null==o.to?null:o.to-t))}}return r}function $t(e,t){if(t.full)return null;var i=nt(e,t.from.line)&&Je(e,t.from.line).markedSpans,r=nt(e,t.to.line)&&Je(e,t.to.line).markedSpans;if(!i&&!r)return null;var n=t.from.ch,o=t.to.ch,s=0==at(t.from,t.to),a=Ft(i,n,s),l=jt(r,o,s),c=1==t.text.length,u=K(t.text).length+(c?n:0);if(a)for(var h=0;h<a.length;++h){var d=a[h];if(null==d.to){var p=Rt(l,d.marker);p?c&&(d.to=null==p.to?null:p.to+u):d.to=n}}if(l)for(var f=0;f<l.length;++f){var m=l[f];null!=m.to&&(m.to+=u),null==m.from?Rt(a,m.marker)||(m.from=u,c&&(a||(a=[])).push(m)):(m.from+=u,c&&(a||(a=[])).push(m))}a&&(a=Nt(a)),l&&l!=a&&(l=Nt(l));var g=[a];if(!c){var y,_=t.text.length-2;if(_>0&&a)for(var v=0;v<a.length;++v)null==a[v].to&&(y||(y=[])).push(new Dt(a[v].marker,null,null));for(var x=0;x<_;++x)g.push(y);g.push(l)}return g}function Nt(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Ut(e,t,i){var r=null;if(e.iter(t.line,i.line+1,(function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||r&&-1!=N(r,i)||(r||(r=[])).push(i)}})),!r)return null;for(var n=[{from:t,to:i}],o=0;o<r.length;++o)for(var s=r[o],a=s.find(0),l=0;l<n.length;++l){var c=n[l];if(!(at(c.to,a.from)<0||at(c.from,a.to)>0)){var u=[l,1],h=at(c.from,a.from),d=at(c.to,a.to);(h<0||!s.inclusiveLeft&&!h)&&u.push({from:c.from,to:a.from}),(d>0||!s.inclusiveRight&&!d)&&u.push({from:a.to,to:c.to}),n.splice.apply(n,u),l+=u.length-3}}return n}function Vt(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function Gt(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function qt(e){return e.inclusiveLeft?-1:0}function Zt(e){return e.inclusiveRight?1:0}function Wt(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var r=e.find(),n=t.find(),o=at(r.from,n.from)||qt(e)-qt(t);if(o)return-o;var s=at(r.to,n.to)||Zt(e)-Zt(t);return s||t.id-e.id}function Ht(e,t){var i,r=zt&&e.markedSpans;if(r)for(var n=void 0,o=0;o<r.length;++o)(n=r[o]).marker.collapsed&&null==(t?n.from:n.to)&&(!i||Wt(i,n.marker)<0)&&(i=n.marker);return i}function Xt(e){return Ht(e,!0)}function Kt(e){return Ht(e,!1)}function Yt(e,t){var i,r=zt&&e.markedSpans;if(r)for(var n=0;n<r.length;++n){var o=r[n];o.marker.collapsed&&(null==o.from||o.from<t)&&(null==o.to||o.to>t)&&(!i||Wt(i,o.marker)<0)&&(i=o.marker)}return i}function Jt(e,t,i,r,n){var o=Je(e,t),s=zt&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),u=at(c.from,i)||qt(l.marker)-qt(n),h=at(c.to,r)||Zt(l.marker)-Zt(n);if(!(u>=0&&h<=0||u<=0&&h>=0)&&(u<=0&&(l.marker.inclusiveRight&&n.inclusiveLeft?at(c.to,i)>=0:at(c.to,i)>0)||u>=0&&(l.marker.inclusiveRight&&n.inclusiveLeft?at(c.from,r)<=0:at(c.from,r)<0)))return!0}}}function Qt(e){for(var t;t=Xt(e);)e=t.find(-1,!0).line;return e}function ei(e){for(var t;t=Kt(e);)e=t.find(1,!0).line;return e}function ti(e){for(var t,i;t=Kt(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function ii(e,t){var i=Je(e,t),r=Qt(i);return i==r?t:it(r)}function ri(e,t){if(t>e.lastLine())return t;var i,r=Je(e,t);if(!ni(e,r))return t;for(;i=Kt(r);)r=i.find(1,!0).line;return it(r)+1}function ni(e,t){var i=zt&&t.markedSpans;if(i)for(var r=void 0,n=0;n<i.length;++n)if((r=i[n]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&oi(e,t,r))return!0}}function oi(e,t,i){if(null==i.to){var r=i.marker.find(1,!0);return oi(e,r.line,Rt(r.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var n=void 0,o=0;o<t.markedSpans.length;++o)if((n=t.markedSpans[o]).marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&oi(e,t,n))return!0}function si(e){for(var t=0,i=(e=Qt(e)).parent,r=0;r<i.lines.length;++r){var n=i.lines[r];if(n==e)break;t+=n.height}for(var o=i.parent;o;o=(i=o).parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==i)break;t+=a.height}return t}function ai(e){if(0==e.height)return 0;for(var t,i=e.text.length,r=e;t=Xt(r);){var n=t.find(0,!0);r=n.from.line,i+=n.from.ch-n.to.ch}for(r=e;t=Kt(r);){var o=t.find(0,!0);i-=r.text.length-o.from.ch,i+=(r=o.to.line).text.length-o.to.ch}return i}function li(e){var t=e.display,i=e.doc;t.maxLine=Je(i,i.first),t.maxLineLength=ai(t.maxLine),t.maxLineChanged=!0,i.iter((function(e){var i=ai(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)}))}var ci=function(e,t,i){this.text=e,Gt(this,t),this.height=i?i(this):1};function ui(e,t,i,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Vt(e),Gt(e,i);var n=r?r(e):1;n!=e.height&&tt(e,n)}function hi(e){e.parent=null,Vt(e)}ci.prototype.lineNo=function(){return it(this)},we(ci);var di={},pi={};function fi(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?pi:di;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function mi(e,t){var i=z("span",null,null,l?"padding-right: .1px":null),r={pre:z("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var n=0;n<=(t.rest?t.rest.length:0);n++){var o=n?t.rest[n-1]:t.line,s=void 0;r.pos=0,r.addToken=yi,Le(e.display.measure)&&(s=pe(o,e.doc.direction))&&(r.addToken=vi(r.addToken,s)),r.map=[],bi(o,r,vt(e,o,t!=e.display.externalMeasured&&it(o))),o.styleClasses&&(o.styleClasses.bgClass&&(r.bgClass=R(o.styleClasses.bgClass,r.bgClass||"")),o.styleClasses.textClass&&(r.textClass=R(o.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(Pe(e.display.measure))),0==n?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(l){var a=r.content.lastChild;(/\bcm-tab\b/.test(a.className)||a.querySelector&&a.querySelector(".cm-tab"))&&(r.content.className="cm-tab-wrap-hack")}return _e(e,"renderLine",e,t.line,r.pre),r.pre.className&&(r.textClass=R(r.pre.className,r.textClass||"")),r}function gi(e){var t=I("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function yi(e,t,i,r,n,o,l){if(t){var c,u=e.splitSpaces?_i(t,e.trailingSpace):t,h=e.cm.state.specialChars,d=!1;if(h.test(t)){c=document.createDocumentFragment();for(var p=0;;){h.lastIndex=p;var f=h.exec(t),m=f?f.index-p:t.length-p;if(m){var g=document.createTextNode(u.slice(p,p+m));s&&a<9?c.appendChild(I("span",[g])):c.appendChild(g),e.map.push(e.pos,e.pos+m,g),e.col+=m,e.pos+=m}if(!f)break;p+=m+1;var y=void 0;if("\t"==f[0]){var _=e.cm.options.tabSize,v=_-e.col%_;(y=c.appendChild(I("span",X(v),"cm-tab"))).setAttribute("role","presentation"),y.setAttribute("cm-text","\t"),e.col+=v}else"\r"==f[0]||"\n"==f[0]?((y=c.appendChild(I("span","\r"==f[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",f[0]),e.col+=1):((y=e.cm.options.specialCharPlaceholder(f[0])).setAttribute("cm-text",f[0]),s&&a<9?c.appendChild(I("span",[y])):c.appendChild(y),e.col+=1);e.map.push(e.pos,e.pos+1,y),e.pos++}}else e.col+=t.length,c=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,c),s&&a<9&&(d=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),i||r||n||d||o||l){var x=i||"";r&&(x+=r),n&&(x+=n);var b=I("span",[c],x,o);if(l)for(var w in l)l.hasOwnProperty(w)&&"style"!=w&&"class"!=w&&b.setAttribute(w,l[w]);return e.content.appendChild(b)}e.content.appendChild(c)}}function _i(e,t){if(e.length>1&&!/  /.test(e))return e;for(var i=t,r="",n=0;n<e.length;n++){var o=e.charAt(n);" "!=o||!i||n!=e.length-1&&32!=e.charCodeAt(n+1)||(o=" "),r+=o,i=" "==o}return r}function vi(e,t){return function(i,r,n,o,s,a,l){n=n?n+" cm-force-border":"cm-force-border";for(var c=i.pos,u=c+r.length;;){for(var h=void 0,d=0;d<t.length&&!((h=t[d]).to>c&&h.from<=c);d++);if(h.to>=u)return e(i,r,n,o,s,a,l);e(i,r.slice(0,h.to-c),n,o,null,a,l),o=null,r=r.slice(h.to-c),c=h.to}}}function xi(e,t,i,r){var n=!r&&i.widgetNode;n&&e.map.push(e.pos,e.pos+t,n),!r&&e.cm.display.input.needsContentAttribute&&(n||(n=e.content.appendChild(document.createElement("span"))),n.setAttribute("cm-marker",i.id)),n&&(e.cm.display.input.setUneditable(n),e.content.appendChild(n)),e.pos+=t,e.trailingSpace=!1}function bi(e,t,i){var r=e.markedSpans,n=e.text,o=0;if(r)for(var s,a,l,c,u,h,d,p=n.length,f=0,m=1,g="",y=0;;){if(y==f){l=c=u=a="",d=null,h=null,y=1/0;for(var _=[],v=void 0,x=0;x<r.length;++x){var b=r[x],w=b.marker;if("bookmark"==w.type&&b.from==f&&w.widgetNode)_.push(w);else if(b.from<=f&&(null==b.to||b.to>f||w.collapsed&&b.to==f&&b.from==f)){if(null!=b.to&&b.to!=f&&y>b.to&&(y=b.to,c=""),w.className&&(l+=" "+w.className),w.css&&(a=(a?a+";":"")+w.css),w.startStyle&&b.from==f&&(u+=" "+w.startStyle),w.endStyle&&b.to==y&&(v||(v=[])).push(w.endStyle,b.to),w.title&&((d||(d={})).title=w.title),w.attributes)for(var T in w.attributes)(d||(d={}))[T]=w.attributes[T];w.collapsed&&(!h||Wt(h.marker,w)<0)&&(h=b)}else b.from>f&&y>b.from&&(y=b.from)}if(v)for(var S=0;S<v.length;S+=2)v[S+1]==y&&(c+=" "+v[S]);if(!h||h.from==f)for(var C=0;C<_.length;++C)xi(t,0,_[C]);if(h&&(h.from||0)==f){if(xi(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=p)break;for(var M=Math.min(p,y);;){if(g){var k=f+g.length;if(!h){var E=k>M?g.slice(0,M-f):g;t.addToken(t,E,s?s+l:l,u,f+E.length==y?c:"",a,d)}if(k>=M){g=g.slice(M-f),f=M;break}f=k,u=""}g=n.slice(o,o=i[m++]),s=fi(i[m++],t.cm.options)}}else for(var A=1;A<i.length;A+=2)t.addToken(t,n.slice(o,o=i[A]),fi(i[A+1],t.cm.options))}function wi(e,t,i){this.line=t,this.rest=ti(t),this.size=this.rest?it(K(this.rest))-i+1:1,this.node=this.text=null,this.hidden=ni(e,t)}function Ti(e,t,i){for(var r,n=[],o=t;o<i;o=r){var s=new wi(e.doc,Je(e.doc,o),o);r=o+s.size,n.push(s)}return n}var Si=null;function Ci(e){Si?Si.ops.push(e):e.ownsGroup=Si={ops:[e],delayedCallbacks:[]}}function Mi(e){var t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(var r=0;r<e.ops.length;r++){var n=e.ops[r];if(n.cursorActivityHandlers)for(;n.cursorActivityCalled<n.cursorActivityHandlers.length;)n.cursorActivityHandlers[n.cursorActivityCalled++].call(null,n.cm)}}while(i<t.length)}function ki(e,t){var i=e.ownsGroup;if(i)try{Mi(i)}finally{Si=null,t(i)}}var Ei=null;function Ai(e,t){var i=ge(e,t);if(i.length){var r,n=Array.prototype.slice.call(arguments,2);Si?r=Si.delayedCallbacks:Ei?r=Ei:(r=Ei=[],setTimeout(Ii,0));for(var o=function(e){r.push((function(){return i[e].apply(null,n)}))},s=0;s<i.length;++s)o(s)}}function Ii(){var e=Ei;Ei=null;for(var t=0;t<e.length;++t)e[t]()}function zi(e,t,i,r){for(var n=0;n<t.changes.length;n++){var o=t.changes[n];"text"==o?Ri(e,t):"gutter"==o?Oi(e,t,i,r):"class"==o?Bi(e,t):"widget"==o&&Fi(e,t,r)}t.changes=null}function Pi(e){return e.node==e.text&&(e.node=I("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),s&&a<8&&(e.node.style.zIndex=2)),e.node}function Li(e,t){var i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){var r=Pi(t);t.background=r.insertBefore(I("div",null,i),r.firstChild),e.display.input.setUneditable(t.background)}}function Di(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):mi(e,t)}function Ri(e,t){var i=t.text.className,r=Di(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,Bi(e,t)):i&&(t.text.className=i)}function Bi(e,t){Li(e,t),t.line.wrapClass?Pi(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function Oi(e,t,i,r){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var n=Pi(t);t.gutterBackground=I("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),n.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var s=Pi(t),a=t.gutter=I("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(a.setAttribute("aria-hidden","true"),e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(I("div",ot(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<e.display.gutterSpecs.length;++l){var c=e.display.gutterSpecs[l].className,u=o.hasOwnProperty(c)&&o[c];u&&a.appendChild(I("div",[u],"CodeMirror-gutter-elt","left: "+r.gutterLeft[c]+"px; width: "+r.gutterWidth[c]+"px"))}}}function Fi(e,t,i){t.alignable&&(t.alignable=null);for(var r=C("CodeMirror-linewidget"),n=t.node.firstChild,o=void 0;n;n=o)o=n.nextSibling,r.test(n.className)&&t.node.removeChild(n);$i(e,t,i)}function ji(e,t,i,r){var n=Di(e,t);return t.text=t.node=n.pre,n.bgClass&&(t.bgClass=n.bgClass),n.textClass&&(t.textClass=n.textClass),Bi(e,t),Oi(e,t,i,r),$i(e,t,r),t.node}function $i(e,t,i){if(Ni(e,t.line,t,i,!0),t.rest)for(var r=0;r<t.rest.length;r++)Ni(e,t.rest[r],t,i,!1)}function Ni(e,t,i,r,n){if(t.widgets)for(var o=Pi(i),s=0,a=t.widgets;s<a.length;++s){var l=a[s],c=I("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Ui(l,c,i,r),e.display.input.setUneditable(c),n&&l.above?o.insertBefore(c,i.gutter||i.text):o.appendChild(c),Ai(l,"redraw")}}function Ui(e,t,i,r){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var n=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(n-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=n+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function Vi(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!P(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),A(t.display.measure,I("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Gi(e,t){for(var i=ke(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function qi(e){return e.lineSpace.offsetTop}function Zi(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Wi(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=A(e.measure,I("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,r={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(e.cachedPaddingH=r),r}function Hi(e){return U-e.display.nativeBarWidth}function Xi(e){return e.display.scroller.clientWidth-Hi(e)-e.display.barWidth}function Ki(e){return e.display.scroller.clientHeight-Hi(e)-e.display.barHeight}function Yi(e,t,i){var r=e.options.lineWrapping,n=r&&Xi(e);if(!t.measure.heights||r&&t.measure.width!=n){var o=t.measure.heights=[];if(r){t.measure.width=n;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ji(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r]};for(var n=0;n<e.rest.length;n++)if(it(e.rest[n])>i)return{map:e.measure.maps[n],cache:e.measure.caches[n],before:!0}}}function Qi(e,t){var i=it(t=Qt(t)),r=e.display.externalMeasured=new wi(e.doc,t,i);r.lineN=i;var n=r.built=mi(e,r);return r.text=n.pre,A(e.display.lineMeasure,n.pre),r}function er(e,t,i,r){return rr(e,ir(e,t),i,r)}function tr(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Br(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function ir(e,t){var i=it(t),r=tr(e,i);r&&!r.text?r=null:r&&r.changes&&(zi(e,r,i,zr(e)),e.curOp.forceUpdate=!0),r||(r=Qi(e,t));var n=Ji(r,t,i);return{line:t,view:r,rect:null,map:n.map,cache:n.cache,before:n.before,hasHeights:!1}}function rr(e,t,i,r,n){t.before&&(i=-1);var o,s=i+(r||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Yi(e,t.view,t.rect),t.hasHeights=!0),(o=lr(e,t,i,r)).bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:n?o.rtop:o.top,bottom:n?o.rbottom:o.bottom}}var nr,or={left:0,right:0,top:0,bottom:0};function sr(e,t,i){for(var r,n,o,s,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(n=0,o=1,s="left"):t<l?o=1+(n=t-a):(c==e.length-3||t==l&&e[c+3]>t)&&(n=(o=l-a)-1,t>=l&&(s="right")),null!=n){if(r=e[c+2],a==l&&i==(r.insertLeft?"left":"right")&&(s=i),"left"==i&&0==n)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)r=e[2+(c-=3)],s="left";if("right"==i&&n==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)r=e[(c+=3)+2],s="right";break}return{node:r,start:n,end:o,collapse:s,coverStart:a,coverEnd:l}}function ar(e,t){var i=or;if("left"==t)for(var r=0;r<e.length&&(i=e[r]).left==i.right;r++);else for(var n=e.length-1;n>=0&&(i=e[n]).left==i.right;n--);return i}function lr(e,t,i,r){var n,o=sr(t.map,i,r),l=o.node,c=o.start,u=o.end,h=o.collapse;if(3==l.nodeType){for(var d=0;d<4;d++){for(;c&&se(t.line.text.charAt(o.coverStart+c));)--c;for(;o.coverStart+u<o.coverEnd&&se(t.line.text.charAt(o.coverStart+u));)++u;if((n=s&&a<9&&0==c&&u==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():ar(M(l,c,u).getClientRects(),r)).left||n.right||0==c)break;u=c,c-=1,h="right"}s&&a<11&&(n=cr(e.display.measure,n))}else{var p;c>0&&(h=r="right"),n=e.options.lineWrapping&&(p=l.getClientRects()).length>1?p["right"==r?p.length-1:0]:l.getBoundingClientRect()}if(s&&a<9&&!c&&(!n||!n.left&&!n.right)){var f=l.parentNode.getClientRects()[0];n=f?{left:f.left,right:f.left+Ir(e.display),top:f.top,bottom:f.bottom}:or}for(var m=n.top-t.rect.top,g=n.bottom-t.rect.top,y=(m+g)/2,_=t.view.measure.heights,v=0;v<_.length-1&&!(y<_[v]);v++);var x=v?_[v-1]:0,b=_[v],w={left:("right"==h?n.right:n.left)-t.rect.left,right:("left"==h?n.left:n.right)-t.rect.left,top:x,bottom:b};return n.left||n.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=m,w.rbottom=g),w}function cr(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!je(e))return t;var i=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*r,bottom:t.bottom*r}}function ur(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function hr(e){e.display.externalMeasure=null,E(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)ur(e.display.view[t])}function dr(e){hr(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function pr(){return u&&y?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function fr(){return u&&y?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function mr(e){var t=Qt(e).widgets,i=0;if(t)for(var r=0;r<t.length;++r)t[r].above&&(i+=Vi(t[r]));return i}function gr(e,t,i,r,n){if(!n){var o=mr(t);i.top+=o,i.bottom+=o}if("line"==r)return i;r||(r="local");var s=si(t);if("local"==r?s+=qi(e.display):s-=e.display.viewOffset,"page"==r||"window"==r){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==r?0:fr());var l=a.left+("window"==r?0:pr());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function yr(e,t,i){if("div"==i)return t;var r=t.left,n=t.top;if("page"==i)r-=pr(),n-=fr();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();r+=o.left,n+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:r-s.left,top:n-s.top}}function _r(e,t,i,r,n){return r||(r=Je(e.doc,t.line)),gr(e,r,er(e,r,t.ch,n),i)}function vr(e,t,i,r,n,o){function s(t,s){var a=rr(e,n,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,gr(e,r,a,i)}r=r||Je(e.doc,t.line),n||(n=ir(e,r));var a=pe(r,e.doc.direction),l=t.ch,c=t.sticky;if(l>=r.text.length?(l=r.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(e,t,i){return s(i?e-1:e,1==a[t].level!=i)}var h=he(a,l,c),d=ue,p=u(l,h,"before"==c);return null!=d&&(p.other=u(l,d,"before"!=c)),p}function xr(e,t){var i=0;t=pt(e.doc,t),e.options.lineWrapping||(i=Ir(e.display)*t.ch);var r=Je(e.doc,t.line),n=si(r)+qi(e.display);return{left:i,right:i,top:n,bottom:n+r.height}}function br(e,t,i,r,n){var o=st(e,t,i);return o.xRel=n,r&&(o.outside=r),o}function wr(e,t,i){var r=e.doc;if((i+=e.display.viewOffset)<0)return br(r.first,0,null,-1,-1);var n=rt(r,i),o=r.first+r.size-1;if(n>o)return br(r.first+r.size-1,Je(r,o).text.length,null,1,1);t<0&&(t=0);for(var s=Je(r,n);;){var a=Mr(e,s,n,t,i),l=Yt(s,a.ch+(a.xRel>0||a.outside>0?1:0));if(!l)return a;var c=l.find(1);if(c.line==n)return c;s=Je(r,n=c.line)}}function Tr(e,t,i,r){r-=mr(t);var n=t.text.length,o=le((function(t){return rr(e,i,t-1).bottom<=r}),n,0);return{begin:o,end:n=le((function(t){return rr(e,i,t).top>r}),o,n)}}function Sr(e,t,i,r){return i||(i=ir(e,t)),Tr(e,t,i,gr(e,t,rr(e,i,r),"line").top)}function Cr(e,t,i,r){return!(e.bottom<=i)&&(e.top>i||(r?e.left:e.right)>t)}function Mr(e,t,i,r,n){n-=si(t);var o=ir(e,t),s=mr(t),a=0,l=t.text.length,c=!0,u=pe(t,e.doc.direction);if(u){var h=(e.options.lineWrapping?Er:kr)(e,t,i,o,u,r,n);a=(c=1!=h.level)?h.from:h.to-1,l=c?h.to:h.from-1}var d,p,f=null,m=null,g=le((function(t){var i=rr(e,o,t);return i.top+=s,i.bottom+=s,!!Cr(i,r,n,!1)&&(i.top<=n&&i.left<=r&&(f=t,m=i),!0)}),a,l),y=!1;if(m){var _=r-m.left<m.right-r,v=_==c;g=f+(v?0:1),p=v?"after":"before",d=_?m.left:m.right}else{c||g!=l&&g!=a||g++,p=0==g?"after":g==t.text.length?"before":rr(e,o,g-(c?1:0)).bottom+s<=n==c?"after":"before";var x=vr(e,st(i,g,p),"line",t,o);d=x.left,y=n<x.top?-1:n>=x.bottom?1:0}return br(i,g=ae(t.text,g,1),p,y,r-d)}function kr(e,t,i,r,n,o,s){var a=le((function(a){var l=n[a],c=1!=l.level;return Cr(vr(e,st(i,c?l.to:l.from,c?"before":"after"),"line",t,r),o,s,!0)}),0,n.length-1),l=n[a];if(a>0){var c=1!=l.level,u=vr(e,st(i,c?l.from:l.to,c?"after":"before"),"line",t,r);Cr(u,o,s,!0)&&u.top>s&&(l=n[a-1])}return l}function Er(e,t,i,r,n,o,s){var a=Tr(e,t,r,s),l=a.begin,c=a.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var u=null,h=null,d=0;d<n.length;d++){var p=n[d];if(!(p.from>=c||p.to<=l)){var f=rr(e,r,1!=p.level?Math.min(c,p.to)-1:Math.max(l,p.from)).right,m=f<o?o-f+1e9:f-o;(!u||h>m)&&(u=p,h=m)}}return u||(u=n[n.length-1]),u.from<l&&(u={from:l,to:u.to,level:u.level}),u.to>c&&(u={from:u.from,to:c,level:u.level}),u}function Ar(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==nr){nr=I("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)nr.appendChild(document.createTextNode("x")),nr.appendChild(I("br"));nr.appendChild(document.createTextNode("x"))}A(e.measure,nr);var i=nr.offsetHeight/50;return i>3&&(e.cachedTextHeight=i),E(e.measure),i||1}function Ir(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=I("span","xxxxxxxxxx"),i=I("pre",[t],"CodeMirror-line-like");A(e.measure,i);var r=t.getBoundingClientRect(),n=(r.right-r.left)/10;return n>2&&(e.cachedCharWidth=n),n||10}function zr(e){for(var t=e.display,i={},r={},n=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var a=e.display.gutterSpecs[s].className;i[a]=o.offsetLeft+o.clientLeft+n,r[a]=o.clientWidth}return{fixedPos:Pr(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function Pr(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Lr(e){var t=Ar(e.display),i=e.options.lineWrapping,r=i&&Math.max(5,e.display.scroller.clientWidth/Ir(e.display)-3);return function(n){if(ni(e.doc,n))return 0;var o=0;if(n.widgets)for(var s=0;s<n.widgets.length;s++)n.widgets[s].height&&(o+=n.widgets[s].height);return i?o+(Math.ceil(n.text.length/r)||1)*t:o+t}}function Dr(e){var t=e.doc,i=Lr(e);t.iter((function(e){var t=i(e);t!=e.height&&tt(e,t)}))}function Rr(e,t,i,r){var n=e.display;if(!i&&"true"==ke(t).getAttribute("cm-not-content"))return null;var o,s,a=n.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(e){return null}var l,c=wr(e,o,s);if(r&&c.xRel>0&&(l=Je(e.doc,c.line).text).length==c.ch){var u=j(l,l.length,e.options.tabSize)-l.length;c=st(c.line,Math.max(0,Math.round((o-Wi(e.display).left)/Ir(e.display))-u))}return c}function Br(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var i=e.display.view,r=0;r<i.length;r++)if((t-=i[r].size)<0)return r}function Or(e,t,i,r){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),r||(r=0);var n=e.display;if(r&&i<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>t)&&(n.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=n.viewTo)zt&&ii(e.doc,t)<n.viewTo&&jr(e);else if(i<=n.viewFrom)zt&&ri(e.doc,i+r)>n.viewFrom?jr(e):(n.viewFrom+=r,n.viewTo+=r);else if(t<=n.viewFrom&&i>=n.viewTo)jr(e);else if(t<=n.viewFrom){var o=$r(e,i,i+r,1);o?(n.view=n.view.slice(o.index),n.viewFrom=o.lineN,n.viewTo+=r):jr(e)}else if(i>=n.viewTo){var s=$r(e,t,t,-1);s?(n.view=n.view.slice(0,s.index),n.viewTo=s.lineN):jr(e)}else{var a=$r(e,t,t,-1),l=$r(e,i,i+r,1);a&&l?(n.view=n.view.slice(0,a.index).concat(Ti(e,a.lineN,l.lineN)).concat(n.view.slice(l.index)),n.viewTo+=r):jr(e)}var c=n.externalMeasured;c&&(i<c.lineN?c.lineN+=r:t<c.lineN+c.size&&(n.externalMeasured=null))}function Fr(e,t,i){e.curOp.viewChanged=!0;var r=e.display,n=e.display.externalMeasured;if(n&&t>=n.lineN&&t<n.lineN+n.size&&(r.externalMeasured=null),!(t<r.viewFrom||t>=r.viewTo)){var o=r.view[Br(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==N(s,i)&&s.push(i)}}}function jr(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function $r(e,t,i,r){var n,o=Br(e,t),s=e.display.view;if(!zt||i==e.doc.first+e.doc.size)return{index:o,lineN:i};for(var a=e.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=t){if(r>0){if(o==s.length-1)return null;n=a+s[o].size-t,o++}else n=a-t;t+=n,i+=n}for(;ii(e.doc,i)!=i;){if(o==(r<0?0:s.length-1))return null;i+=r*s[o-(r<0?1:0)].size,o+=r}return{index:o,lineN:i}}function Nr(e,t,i){var r=e.display;0==r.view.length||t>=r.viewTo||i<=r.viewFrom?(r.view=Ti(e,t,i),r.viewFrom=t):(r.viewFrom>t?r.view=Ti(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(Br(e,t))),r.viewFrom=t,r.viewTo<i?r.view=r.view.concat(Ti(e,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,Br(e,i)))),r.viewTo=i}function Ur(e){for(var t=e.display.view,i=0,r=0;r<t.length;r++){var n=t[r];n.hidden||n.node&&!n.changes||++i}return i}function Vr(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Gr(e,t){void 0===t&&(t=!0);var i=e.doc,r={},n=r.cursors=document.createDocumentFragment(),o=r.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(var a=0;a<i.sel.ranges.length;a++)if(t||a!=i.sel.primIndex){var l=i.sel.ranges[a];if(!(l.from().line>=e.display.viewTo||l.to().line<e.display.viewFrom)){var c=l.empty();if(s){var u=s(e,l);u&&qr(e,u,n)}else(c||e.options.showCursorWhenSelecting)&&qr(e,l.head,n);c||Wr(e,l,o)}}return r}function qr(e,t,i){var r=vr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),n=i.appendChild(I("div"," ","CodeMirror-cursor"));if(n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=_r(e,t,"div",null,null),s=o.right-o.left;n.style.width=(s>0?s:e.defaultCharWidth())+"px"}if(r.other){var a=i.appendChild(I("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));a.style.display="",a.style.left=r.other.left+"px",a.style.top=r.other.top+"px",a.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Zr(e,t){return e.top-t.top||e.left-t.left}function Wr(e,t,i){var r=e.display,n=e.doc,o=document.createDocumentFragment(),s=Wi(e.display),a=s.left,l=Math.max(r.sizerWidth,Xi(e)-r.sizer.offsetLeft)-s.right,c="ltr"==n.direction;function u(e,t,i,r){t<0&&(t=0),t=Math.round(t),r=Math.round(r),o.appendChild(I("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==i?l-e:i)+"px;\n                             height: "+(r-t)+"px"))}function h(t,i,r){var o,s,h=Je(n,t),d=h.text.length;function p(i,r){return _r(e,st(t,i),"div",h,r)}function f(t,i,r){var n=Sr(e,h,null,t),o="ltr"==i==("after"==r)?"left":"right";return p("after"==r?n.begin:n.end-(/\s/.test(h.text.charAt(n.end-1))?2:1),o)[o]}var m=pe(h,n.direction);return ce(m,i||0,null==r?d:r,(function(e,t,n,h){var g="ltr"==n,y=p(e,g?"left":"right"),_=p(t-1,g?"right":"left"),v=null==i&&0==e,x=null==r&&t==d,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){var T=(c?x:v)&&w,S=(c?v:x)&&b?a:(g?y:_).left,C=T?l:(g?_:y).right;u(S,y.top,C-S,y.bottom)}else{var M,k,E,A;g?(M=c&&v&&b?a:y.left,k=c?l:f(e,n,"before"),E=c?a:f(t,n,"after"),A=c&&x&&w?l:_.right):(M=c?f(e,n,"before"):a,k=!c&&v&&b?l:y.right,E=!c&&x&&w?a:_.left,A=c?f(t,n,"after"):l),u(M,y.top,k-M,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(E,_.top,A-E,_.bottom)}(!o||Zr(y,o)<0)&&(o=y),Zr(_,o)<0&&(o=_),(!s||Zr(y,s)<0)&&(s=y),Zr(_,s)<0&&(s=_)})),{start:o,end:s}}var d=t.from(),p=t.to();if(d.line==p.line)h(d.line,d.ch,p.ch);else{var f=Je(n,d.line),m=Je(n,p.line),g=Qt(f)==Qt(m),y=h(d.line,d.ch,g?f.text.length+1:null).end,_=h(p.line,g?0:null,p.ch).start;g&&(y.top<_.top-2?(u(y.right,y.top,null,y.bottom),u(a,_.top,_.left,_.bottom)):u(y.right,y.top,_.left-y.right,y.bottom)),y.bottom<_.top&&u(a,y.bottom,null,_.top)}i.appendChild(o)}function Hr(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((function(){e.hasFocus()||Jr(e),t.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Xr(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||Yr(e))}function Kr(e){e.state.delayingBlurEvent=!0,setTimeout((function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&Jr(e))}),100)}function Yr(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(_e(e,"focus",e,t),e.state.focused=!0,D(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),l&&setTimeout((function(){return e.display.input.reset(!0)}),20)),e.display.input.receivedFocus()),Hr(e))}function Jr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(_e(e,"blur",e,t),e.state.focused=!1,k(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((function(){e.state.focused||(e.display.shift=!1)}),150))}function Qr(e){for(var t=e.display,i=t.lineDiv.offsetTop,r=Math.max(0,t.scroller.getBoundingClientRect().top),n=t.lineDiv.getBoundingClientRect().top,o=0,l=0;l<t.view.length;l++){var c=t.view[l],u=e.options.lineWrapping,h=void 0,d=0;if(!c.hidden){if(n+=c.line.height,s&&a<8){var p=c.node.offsetTop+c.node.offsetHeight;h=p-i,i=p}else{var f=c.node.getBoundingClientRect();h=f.bottom-f.top,!u&&c.text.firstChild&&(d=c.text.firstChild.getBoundingClientRect().right-f.left-1)}var m=c.line.height-h;if((m>.005||m<-.005)&&(n<r&&(o-=m),tt(c.line,h),en(c.line),c.rest))for(var g=0;g<c.rest.length;g++)en(c.rest[g]);if(d>e.display.sizerWidth){var y=Math.ceil(d/Ir(e.display));y>e.display.maxLineLength&&(e.display.maxLineLength=y,e.display.maxLine=c.line,e.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function en(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var i=e.widgets[t],r=i.node.parentNode;r&&(i.height=r.offsetHeight)}}function tn(e,t,i){var r=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;r=Math.floor(r-qi(e));var n=i&&null!=i.bottom?i.bottom:r+e.wrapper.clientHeight,o=rt(t,r),s=rt(t,n);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;a<o?(o=a,s=rt(t,si(Je(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=s&&(o=rt(t,si(Je(t,l))-e.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function rn(e,t){if(!ve(e,"scrollCursorIntoView")){var i=e.display,r=i.sizer.getBoundingClientRect(),n=null;if(t.top+r.top<0?n=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null!=n&&!m){var o=I("div","​",null,"position: absolute;\n                         top: "+(t.top-i.viewOffset-qi(e.display))+"px;\n                         height: "+(t.bottom-t.top+Hi(e)+i.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(n),e.display.lineSpace.removeChild(o)}}}function nn(e,t,i,r){var n;null==r&&(r=0),e.options.lineWrapping||t!=i||(i="before"==t.sticky?st(t.line,t.ch+1,"before"):t,t=t.ch?st(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t);for(var o=0;o<5;o++){var s=!1,a=vr(e,t),l=i&&i!=t?vr(e,i):a,c=sn(e,n={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-r,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+r}),u=e.doc.scrollTop,h=e.doc.scrollLeft;if(null!=c.scrollTop&&(pn(e,c.scrollTop),Math.abs(e.doc.scrollTop-u)>1&&(s=!0)),null!=c.scrollLeft&&(mn(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-h)>1&&(s=!0)),!s)break}return n}function on(e,t){var i=sn(e,t);null!=i.scrollTop&&pn(e,i.scrollTop),null!=i.scrollLeft&&mn(e,i.scrollLeft)}function sn(e,t){var i=e.display,r=Ar(e.display);t.top<0&&(t.top=0);var n=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=Ki(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var a=e.doc.height+Zi(i),l=t.top<r,c=t.bottom>a-r;if(t.top<n)s.scrollTop=l?0:t.top;else if(t.bottom>n+o){var u=Math.min(t.top,(c?a:t.bottom)-o);u!=n&&(s.scrollTop=u)}var h=e.options.fixedGutter?0:i.gutters.offsetWidth,d=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft-h,p=Xi(e)-i.gutters.offsetWidth,f=t.right-t.left>p;return f&&(t.right=t.left+p),t.left<10?s.scrollLeft=0:t.left<d?s.scrollLeft=Math.max(0,t.left+h-(f?0:10)):t.right>p+d-3&&(s.scrollLeft=t.right+(f?0:10)-p),s}function an(e,t){null!=t&&(hn(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function ln(e){hn(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function cn(e,t,i){null==t&&null==i||hn(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function un(e,t){hn(e),e.curOp.scrollToPos=t}function hn(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,dn(e,xr(e,t.from),xr(e,t.to),t.margin))}function dn(e,t,i,r){var n=sn(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-r,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+r});cn(e,n.scrollLeft,n.scrollTop)}function pn(e,t){Math.abs(e.doc.scrollTop-t)<2||(i||Gn(e,{top:t}),fn(e,t,!0),i&&Gn(e),Bn(e,100))}function fn(e,t,i){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function mn(e,t,i,r){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!r||(e.doc.scrollLeft=t,Hn(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function gn(e){var t=e.display,i=t.gutters.offsetWidth,r=Math.round(e.doc.height+Zi(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:r,scrollHeight:r+Hi(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}var yn=function(e,t,i){this.cm=i;var r=this.vert=I("div",[I("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),n=this.horiz=I("div",[I("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");r.tabIndex=n.tabIndex=-1,e(r),e(n),me(r,"scroll",(function(){r.clientHeight&&t(r.scrollTop,"vertical")})),me(n,"scroll",(function(){n.clientWidth&&t(n.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,s&&a<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};yn.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,r=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?r+"px":"0";var n=e.viewHeight-(t?r:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+n)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?r+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(i?r:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?r:0,bottom:t?r:0}},yn.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},yn.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},yn.prototype.zeroWidthHack=function(){var e=v&&!f?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new $,this.disableVert=new $},yn.prototype.enableZeroWidthBar=function(e,t,i){function r(){var n=e.getBoundingClientRect();("vert"==i?document.elementFromPoint(n.right-1,(n.top+n.bottom)/2):document.elementFromPoint((n.right+n.left)/2,n.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,r)}e.style.pointerEvents="auto",t.set(1e3,r)},yn.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var _n=function(){};function vn(e,t){t||(t=gn(e));var i=e.display.barWidth,r=e.display.barHeight;xn(e,t);for(var n=0;n<4&&i!=e.display.barWidth||r!=e.display.barHeight;n++)i!=e.display.barWidth&&e.options.lineWrapping&&Qr(e),xn(e,gn(e)),i=e.display.barWidth,r=e.display.barHeight}function xn(e,t){var i=e.display,r=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=r.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=r.bottom)+"px",i.heightForcer.style.borderBottom=r.bottom+"px solid transparent",r.right&&r.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=r.bottom+"px",i.scrollbarFiller.style.width=r.right+"px"):i.scrollbarFiller.style.display="",r.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=r.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}_n.prototype.update=function(){return{bottom:0,right:0}},_n.prototype.setScrollLeft=function(){},_n.prototype.setScrollTop=function(){},_n.prototype.clear=function(){};var bn={native:yn,null:_n};function wn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&k(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new bn[e.options.scrollbarStyle]((function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),me(t,"mousedown",(function(){e.state.focused&&setTimeout((function(){return e.display.input.focus()}),0)})),t.setAttribute("cm-not-content","true")}),(function(t,i){"horizontal"==i?mn(e,t):pn(e,t)}),e),e.display.scrollbars.addClass&&D(e.display.wrapper,e.display.scrollbars.addClass)}var Tn=0;function Sn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Tn,markArrays:null},Ci(e.curOp)}function Cn(e){var t=e.curOp;t&&ki(t,(function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;Mn(e)}))}function Mn(e){for(var t=e.ops,i=0;i<t.length;i++)kn(t[i]);for(var r=0;r<t.length;r++)En(t[r]);for(var n=0;n<t.length;n++)An(t[n]);for(var o=0;o<t.length;o++)In(t[o]);for(var s=0;s<t.length;s++)zn(t[s])}function kn(e){var t=e.cm,i=t.display;jn(t),e.updateMaxLine&&li(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Fn(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function En(e){e.updatedDisplay=e.mustUpdate&&Un(e.cm,e.update)}function An(e){var t=e.cm,i=t.display;e.updatedDisplay&&Qr(t),e.barMeasure=gn(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=er(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+Hi(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-Xi(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection())}function In(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&mn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var i=e.focus&&e.focus==L();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&vn(t,e.barMeasure),e.updatedDisplay&&Wn(t,e.barMeasure),e.selectionChanged&&Hr(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&Xr(e.cm)}function zn(e){var t=e.cm,i=t.display,r=t.doc;e.updatedDisplay&&Vn(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&fn(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&mn(t,e.scrollLeft,!0,!0),e.scrollToPos&&rn(t,nn(t,pt(r,e.scrollToPos.from),pt(r,e.scrollToPos.to),e.scrollToPos.margin));var n=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(n)for(var s=0;s<n.length;++s)n[s].lines.length||_e(n[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&_e(o[a],"unhide");i.wrapper.offsetHeight&&(r.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&_e(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Pn(e,t){if(e.curOp)return t();Sn(e);try{return t()}finally{Cn(e)}}function Ln(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Sn(e);try{return t.apply(e,arguments)}finally{Cn(e)}}}function Dn(e){return function(){if(this.curOp)return e.apply(this,arguments);Sn(this);try{return e.apply(this,arguments)}finally{Cn(this)}}}function Rn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Sn(t);try{return e.apply(this,arguments)}finally{Cn(t)}}}function Bn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,O(On,e))}function On(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var i=+new Date+e.options.workTime,r=xt(e,t.highlightFrontier),n=[];t.iter(r.line,Math.min(t.first+t.size,e.display.viewTo+500),(function(o){if(r.line>=e.display.viewFrom){var s=o.styles,a=o.text.length>e.options.maxHighlightLength?He(t.mode,r.state):null,l=_t(e,o,r,!0);a&&(r.state=a),o.styles=l.styles;var c=o.styleClasses,u=l.classes;u?o.styleClasses=u:c&&(o.styleClasses=null);for(var h=!s||s.length!=o.styles.length||c!=u&&(!c||!u||c.bgClass!=u.bgClass||c.textClass!=u.textClass),d=0;!h&&d<s.length;++d)h=s[d]!=o.styles[d];h&&n.push(r.line),o.stateAfter=r.save(),r.nextLine()}else o.text.length<=e.options.maxHighlightLength&&bt(e,o.text,r),o.stateAfter=r.line%5==0?r.save():null,r.nextLine();if(+new Date>i)return Bn(e,e.options.workDelay),!0})),t.highlightFrontier=r.line,t.modeFrontier=Math.max(t.modeFrontier,r.line),n.length&&Pn(e,(function(){for(var t=0;t<n.length;t++)Fr(e,n[t],"text")}))}}var Fn=function(e,t,i){var r=e.display;this.viewport=t,this.visible=tn(r,e.doc,t),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=Xi(e),this.force=i,this.dims=zr(e),this.events=[]};function jn(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Hi(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Hi(e)+"px",t.scrollbarsClipped=!0)}function $n(e){if(e.hasFocus())return null;var t=L();if(!t||!P(e.display.lineDiv,t))return null;var i={activeElt:t};if(window.getSelection){var r=window.getSelection();r.anchorNode&&r.extend&&P(e.display.lineDiv,r.anchorNode)&&(i.anchorNode=r.anchorNode,i.anchorOffset=r.anchorOffset,i.focusNode=r.focusNode,i.focusOffset=r.focusOffset)}return i}function Nn(e){if(e&&e.activeElt&&e.activeElt!=L()&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&P(document.body,e.anchorNode)&&P(document.body,e.focusNode))){var t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}function Un(e,t){var i=e.display,r=e.doc;if(t.editorIsHidden)return jr(e),!1;if(!t.force&&t.visible.from>=i.viewFrom&&t.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==Ur(e))return!1;Xn(e)&&(jr(e),t.dims=zr(e));var n=r.first+r.size,o=Math.max(t.visible.from-e.options.viewportMargin,r.first),s=Math.min(n,t.visible.to+e.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(r.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(n,i.viewTo)),zt&&(o=ii(e.doc,o),s=ri(e.doc,s));var a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=t.wrapperHeight||i.lastWrapWidth!=t.wrapperWidth;Nr(e,o,s),i.viewOffset=si(Je(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";var l=Ur(e);if(!a&&0==l&&!t.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var c=$n(e);return l>4&&(i.lineDiv.style.display="none"),qn(e,i.updateLineNumbers,t.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,Nn(c),E(i.cursorDiv),E(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=t.wrapperHeight,i.lastWrapWidth=t.wrapperWidth,Bn(e,400)),i.updateLineNumbers=null,!0}function Vn(e,t){for(var i=t.viewport,r=!0;;r=!1){if(r&&e.options.lineWrapping&&t.oldDisplayWidth!=Xi(e))r&&(t.visible=tn(e.display,e.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(e.doc.height+Zi(e.display)-Ki(e),i.top)}),t.visible=tn(e.display,e.doc,i),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!Un(e,t))break;Qr(e);var n=gn(e);Vr(e),vn(e,n),Wn(e,n),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Gn(e,t){var i=new Fn(e,t);if(Un(e,i)){Qr(e),Vn(e,i);var r=gn(e);Vr(e),vn(e,r),Wn(e,r),i.finish()}}function qn(e,t,i){var r=e.display,n=e.options.lineNumbers,o=r.lineDiv,s=o.firstChild;function a(t){var i=t.nextSibling;return l&&v&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var c=r.view,u=r.viewFrom,h=0;h<c.length;h++){var d=c[h];if(d.hidden);else if(d.node&&d.node.parentNode==o){for(;s!=d.node;)s=a(s);var p=n&&null!=t&&t<=u&&d.lineNumber;d.changes&&(N(d.changes,"gutter")>-1&&(p=!1),zi(e,d,u,i)),p&&(E(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(ot(e.options,u)))),s=d.node.nextSibling}else{var f=ji(e,d,u,i);o.insertBefore(f,s)}u+=d.size}for(;s;)s=a(s)}function Zn(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",Ai(e,"gutterChanged",e)}function Wn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Hi(e)+"px"}function Hn(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var r=Pr(t)-t.scroller.scrollLeft+e.doc.scrollLeft,n=t.gutters.offsetWidth,o=r+"px",s=0;s<i.length;s++)if(!i[s].hidden){e.options.fixedGutter&&(i[s].gutter&&(i[s].gutter.style.left=o),i[s].gutterBackground&&(i[s].gutterBackground.style.left=o));var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=r+n+"px")}}function Xn(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=ot(e.options,t.first+t.size-1),r=e.display;if(i.length!=r.lineNumChars){var n=r.measure.appendChild(I("div",[I("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=n.firstChild.offsetWidth,s=n.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-s)+1,r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Zn(e.display),!0}return!1}function Kn(e,t){for(var i=[],r=!1,n=0;n<e.length;n++){var o=e[n],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;r=!0}i.push({className:o,style:s})}return t&&!r&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function Yn(e){var t=e.gutters,i=e.gutterSpecs;E(t),e.lineGutter=null;for(var r=0;r<i.length;++r){var n=i[r],o=n.className,s=n.style,a=t.appendChild(I("div",null,"CodeMirror-gutter "+o));s&&(a.style.cssText=s),"CodeMirror-linenumbers"==o&&(e.lineGutter=a,a.style.width=(e.lineNumWidth||1)+"px")}t.style.display=i.length?"":"none",Zn(e)}function Jn(e){Yn(e.display),Or(e),Hn(e)}function Qn(e,t,r,n){var o=this;this.input=r,o.scrollbarFiller=I("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=I("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=z("div",null,"CodeMirror-code"),o.selectionDiv=I("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=I("div",null,"CodeMirror-cursors"),o.measure=I("div",null,"CodeMirror-measure"),o.lineMeasure=I("div",null,"CodeMirror-measure"),o.lineSpace=z("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var c=z("div",[o.lineSpace],"CodeMirror-lines");o.mover=I("div",[c],null,"position: relative"),o.sizer=I("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=I("div",null,null,"position: absolute; height: "+U+"px; width: 1px;"),o.gutters=I("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=I("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=I("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),o.wrapper.setAttribute("translate","no"),s&&a<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),l||i&&_||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,o.gutterSpecs=Kn(n.gutters,n.lineNumbers),Yn(o),r.init(o)}Fn.prototype.signal=function(e,t){be(e,t)&&this.events.push(arguments)},Fn.prototype.finish=function(){for(var e=0;e<this.events.length;e++)_e.apply(null,this.events[e])};var eo=0,to=null;function io(e){var t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function ro(e){var t=io(e);return t.x*=to,t.y*=to,t}function no(e,t){u&&h>=102&&(null==e.display.chromeScrollHack?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout((function(){e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""}),100));var r=io(t),n=r.x,o=r.y,s=to;0===t.deltaMode&&(n=t.deltaX,o=t.deltaY,s=1);var a=e.display,c=a.scroller,p=c.scrollWidth>c.clientWidth,f=c.scrollHeight>c.clientHeight;if(n&&p||o&&f){if(o&&v&&l)e:for(var m=t.target,g=a.view;m!=c;m=m.parentNode)for(var y=0;y<g.length;y++)if(g[y].node==m){e.display.currentWheelTarget=m;break e}if(n&&!i&&!d&&null!=s)return o&&f&&pn(e,Math.max(0,c.scrollTop+o*s)),mn(e,Math.max(0,c.scrollLeft+n*s)),(!o||o&&f)&&Te(t),void(a.wheelStartX=null);if(o&&null!=s){var _=o*s,x=e.doc.scrollTop,b=x+a.wrapper.clientHeight;_<0?x=Math.max(0,x+_-50):b=Math.min(e.doc.height,b+_+50),Gn(e,{top:x,bottom:b})}eo<20&&0!==t.deltaMode&&(null==a.wheelStartX?(a.wheelStartX=c.scrollLeft,a.wheelStartY=c.scrollTop,a.wheelDX=n,a.wheelDY=o,setTimeout((function(){if(null!=a.wheelStartX){var e=c.scrollLeft-a.wheelStartX,t=c.scrollTop-a.wheelStartY,i=t&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX;a.wheelStartX=a.wheelStartY=null,i&&(to=(to*eo+i)/(eo+1),++eo)}}),200)):(a.wheelDX+=n,a.wheelDY+=o))}}s?to=-.53:i?to=15:u?to=-.7:p&&(to=-1/3);var oo=function(e,t){this.ranges=e,this.primIndex=t};oo.prototype.primary=function(){return this.ranges[this.primIndex]},oo.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var i=this.ranges[t],r=e.ranges[t];if(!lt(i.anchor,r.anchor)||!lt(i.head,r.head))return!1}return!0},oo.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new so(ct(this.ranges[t].anchor),ct(this.ranges[t].head));return new oo(e,this.primIndex)},oo.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},oo.prototype.contains=function(e,t){t||(t=e);for(var i=0;i<this.ranges.length;i++){var r=this.ranges[i];if(at(t,r.from())>=0&&at(e,r.to())<=0)return i}return-1};var so=function(e,t){this.anchor=e,this.head=t};function ao(e,t,i){var r=e&&e.options.selectionsMayTouch,n=t[i];t.sort((function(e,t){return at(e.from(),t.from())})),i=N(t,n);for(var o=1;o<t.length;o++){var s=t[o],a=t[o-1],l=at(a.to(),s.from());if(r&&!s.empty()?l>0:l>=0){var c=ht(a.from(),s.from()),u=ut(a.to(),s.to()),h=a.empty()?s.from()==s.head:a.from()==a.head;o<=i&&--i,t.splice(--o,2,new so(h?u:c,h?c:u))}}return new oo(t,i)}function lo(e,t){return new oo([new so(e,t||e)],0)}function co(e){return e.text?st(e.from.line+e.text.length-1,K(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function uo(e,t){if(at(e,t.from)<0)return e;if(at(e,t.to)<=0)return co(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=co(t).ch-t.to.ch),st(i,r)}function ho(e,t){for(var i=[],r=0;r<e.sel.ranges.length;r++){var n=e.sel.ranges[r];i.push(new so(uo(n.anchor,t),uo(n.head,t)))}return ao(e.cm,i,e.sel.primIndex)}function po(e,t,i){return e.line==t.line?st(i.line,e.ch-t.ch+i.ch):st(i.line+(e.line-t.line),e.ch)}function fo(e,t,i){for(var r=[],n=st(e.first,0),o=n,s=0;s<t.length;s++){var a=t[s],l=po(a.from,n,o),c=po(co(a),n,o);if(n=a.to,o=c,"around"==i){var u=e.sel.ranges[s],h=at(u.head,u.anchor)<0;r[s]=new so(h?c:l,h?l:c)}else r[s]=new so(l,l)}return new oo(r,e.sel.primIndex)}function mo(e){e.doc.mode=qe(e.options,e.doc.modeOption),go(e)}function go(e){e.doc.iter((function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Bn(e,100),e.state.modeGen++,e.curOp&&Or(e)}function yo(e,t){return 0==t.from.ch&&0==t.to.ch&&""==K(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _o(e,t,i,r){function n(e){return i?i[e]:null}function o(e,i,n){ui(e,i,n,r),Ai(e,"change",e,t)}function s(e,t){for(var i=[],o=e;o<t;++o)i.push(new ci(c[o],n(o),r));return i}var a=t.from,l=t.to,c=t.text,u=Je(e,a.line),h=Je(e,l.line),d=K(c),p=n(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(yo(e,t)){var m=s(0,c.length-1);o(h,h.text,p),f&&e.remove(a.line,f),m.length&&e.insert(a.line,m)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),p);else{var g=s(1,c.length-1);g.push(new ci(d+u.text.slice(l.ch),p,r)),o(u,u.text.slice(0,a.ch)+c[0],n(0)),e.insert(a.line+1,g)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),n(0)),e.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],n(0)),o(h,d+h.text.slice(l.ch),p);var y=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,y)}Ai(e,"change",e,t)}function vo(e,t,i){function r(e,n,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=n){var l=o&&a.sharedHist;i&&!l||(t(a.doc,l),r(a.doc,e,l))}}}r(e,null,!0)}function xo(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Dr(e),mo(e),bo(e),e.options.direction=t.direction,e.options.lineWrapping||li(e),e.options.mode=t.modeOption,Or(e)}function bo(e){("rtl"==e.doc.direction?D:k)(e.display.lineDiv,"CodeMirror-rtl")}function wo(e){Pn(e,(function(){bo(e),Or(e)}))}function To(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function So(e,t){var i={from:ct(t.from),to:co(t),text:Qe(e,t.from,t.to)};return zo(e,i,t.from.line,t.to.line+1),vo(e,(function(e){return zo(e,i,t.from.line,t.to.line+1)}),!0),i}function Co(e){for(;e.length&&K(e).ranges;)e.pop()}function Mo(e,t){return t?(Co(e.done),K(e.done)):e.done.length&&!K(e.done).ranges?K(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),K(e.done)):void 0}function ko(e,t,i,r){var n=e.history;n.undone.length=0;var o,s,a=+new Date;if((n.lastOp==r||n.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&n.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=Mo(n,n.lastOp==r)))s=K(o.changes),0==at(t.from,t.to)&&0==at(t.from,s.to)?s.to=co(t):o.changes.push(So(e,t));else{var l=K(n.done);for(l&&l.ranges||Io(e.sel,n.done),o={changes:[So(e,t)],generation:n.generation},n.done.push(o);n.done.length>n.undoDepth;)n.done.shift(),n.done[0].ranges||n.done.shift()}n.done.push(i),n.generation=++n.maxGeneration,n.lastModTime=n.lastSelTime=a,n.lastOp=n.lastSelOp=r,n.lastOrigin=n.lastSelOrigin=t.origin,s||_e(e,"historyAdded")}function Eo(e,t,i,r){var n=t.charAt(0);return"*"==n||"+"==n&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Ao(e,t,i,r){var n=e.history,o=r&&r.origin;i==n.lastSelOp||o&&n.lastSelOrigin==o&&(n.lastModTime==n.lastSelTime&&n.lastOrigin==o||Eo(e,o,K(n.done),t))?n.done[n.done.length-1]=t:Io(t,n.done),n.lastSelTime=+new Date,n.lastSelOrigin=o,n.lastSelOp=i,r&&!1!==r.clearRedo&&Co(n.undone)}function Io(e,t){var i=K(t);i&&i.ranges&&i.equals(e)||t.push(e)}function zo(e,t,i,r){var n=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,r),(function(i){i.markedSpans&&((n||(n=t["spans_"+e.id]={}))[o]=i.markedSpans),++o}))}function Po(e){if(!e)return null;for(var t,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function Lo(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var r=[],n=0;n<t.text.length;++n)r.push(Po(i[n]));return r}function Do(e,t){var i=Lo(e,t),r=$t(e,t);if(!i)return r;if(!r)return i;for(var n=0;n<i.length;++n){var o=i[n],s=r[n];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(i[n]=s)}return i}function Ro(e,t,i){for(var r=[],n=0;n<e.length;++n){var o=e[n];if(o.ranges)r.push(i?oo.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];r.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],u=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var h in c)(u=h.match(/^spans_(\d+)$/))&&N(t,Number(u[1]))>-1&&(K(a)[h]=c[h],delete c[h])}}}return r}function Bo(e,t,i,r){if(r){var n=e.anchor;if(i){var o=at(t,n)<0;o!=at(i,n)<0?(n=t,t=i):o!=at(t,i)<0&&(t=i)}return new so(n,t)}return new so(i||t,t)}function Oo(e,t,i,r,n){null==n&&(n=e.cm&&(e.cm.display.shift||e.extend)),Vo(e,new oo([Bo(e.sel.primary(),t,i,n)],0),r)}function Fo(e,t,i){for(var r=[],n=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)r[o]=Bo(e.sel.ranges[o],t[o],null,n);Vo(e,ao(e.cm,r,e.sel.primIndex),i)}function jo(e,t,i,r){var n=e.sel.ranges.slice(0);n[t]=i,Vo(e,ao(e.cm,n,e.sel.primIndex),r)}function $o(e,t,i,r){Vo(e,lo(t,i),r)}function No(e,t,i){var r={ranges:t.ranges,update:function(t){this.ranges=[];for(var i=0;i<t.length;i++)this.ranges[i]=new so(pt(e,t[i].anchor),pt(e,t[i].head))},origin:i&&i.origin};return _e(e,"beforeSelectionChange",e,r),e.cm&&_e(e.cm,"beforeSelectionChange",e.cm,r),r.ranges!=t.ranges?ao(e.cm,r.ranges,r.ranges.length-1):t}function Uo(e,t,i){var r=e.history.done,n=K(r);n&&n.ranges?(r[r.length-1]=t,Go(e,t,i)):Vo(e,t,i)}function Vo(e,t,i){Go(e,t,i),Ao(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function Go(e,t,i){(be(e,"beforeSelectionChange")||e.cm&&be(e.cm,"beforeSelectionChange"))&&(t=No(e,t,i));var r=i&&i.bias||(at(t.primary().head,e.sel.primary().head)<0?-1:1);qo(e,Wo(e,t,r,!0)),i&&!1===i.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||ln(e.cm)}function qo(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,xe(e.cm)),Ai(e,"cursorActivity",e))}function Zo(e){qo(e,Wo(e,e.sel,null,!1))}function Wo(e,t,i,r){for(var n,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Xo(e,s.anchor,a&&a.anchor,i,r),c=Xo(e,s.head,a&&a.head,i,r);(n||l!=s.anchor||c!=s.head)&&(n||(n=t.ranges.slice(0,o)),n[o]=new so(l,c))}return n?ao(e.cm,n,t.primIndex):t}function Ho(e,t,i,r,n){var o=Je(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(u?a.to>=t.ch:a.to>t.ch))){if(n&&(_e(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){var h=l.find(r<0?1:-1),d=void 0;if((r<0?u:c)&&(h=Ko(e,h,-r,h&&h.line==t.line?o:null)),h&&h.line==t.line&&(d=at(h,i))&&(r<0?d<0:d>0))return Ho(e,h,t,r,n)}var p=l.find(r<0?-1:1);return(r<0?c:u)&&(p=Ko(e,p,r,p.line==t.line?o:null)),p?Ho(e,p,t,r,n):null}}return t}function Xo(e,t,i,r,n){var o=r||1,s=Ho(e,t,i,o,n)||!n&&Ho(e,t,i,o,!0)||Ho(e,t,i,-o,n)||!n&&Ho(e,t,i,-o,!0);return s||(e.cantEdit=!0,st(e.first,0))}function Ko(e,t,i,r){return i<0&&0==t.ch?t.line>e.first?pt(e,st(t.line-1)):null:i>0&&t.ch==(r||Je(e,t.line)).text.length?t.line<e.first+e.size-1?st(t.line+1,0):null:new st(t.line,t.ch+i)}function Yo(e){e.setSelection(st(e.firstLine(),0),st(e.lastLine()),G)}function Jo(e,t,i){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return r.canceled=!0}};return i&&(r.update=function(t,i,n,o){t&&(r.from=pt(e,t)),i&&(r.to=pt(e,i)),n&&(r.text=n),void 0!==o&&(r.origin=o)}),_e(e,"beforeChange",e,r),e.cm&&_e(e.cm,"beforeChange",e.cm,r),r.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Qo(e,t,i){if(e.cm){if(!e.cm.curOp)return Ln(e.cm,Qo)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(be(e,"beforeChange")||e.cm&&be(e.cm,"beforeChange"))||(t=Jo(e,t,!0))){var r=It&&!i&&Ut(e,t.from,t.to);if(r)for(var n=r.length-1;n>=0;--n)es(e,{from:r[n].from,to:r[n].to,text:n?[""]:t.text,origin:t.origin});else es(e,t)}}function es(e,t){if(1!=t.text.length||""!=t.text[0]||0!=at(t.from,t.to)){var i=ho(e,t);ko(e,t,i,e.cm?e.cm.curOp.id:NaN),rs(e,t,i,$t(e,t));var r=[];vo(e,(function(e,i){i||-1!=N(r,e.history)||(ls(e.history,t),r.push(e.history)),rs(e,t,null,$t(e,t))}))}}function ts(e,t,i){var r=e.cm&&e.cm.state.suppressEdits;if(!r||i){for(var n,o=e.history,s=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,c=0;c<a.length&&(n=a[c],i?!n.ranges||n.equals(e.sel):n.ranges);c++);if(c!=a.length){for(o.lastOrigin=o.lastSelOrigin=null;;){if(!(n=a.pop()).ranges){if(r)return void a.push(n);break}if(Io(n,l),i&&!n.equals(e.sel))return void Vo(e,n,{clearRedo:!1});s=n}var u=[];Io(s,l),l.push({changes:u,generation:o.generation}),o.generation=n.generation||++o.maxGeneration;for(var h=be(e,"beforeChange")||e.cm&&be(e.cm,"beforeChange"),d=function(i){var r=n.changes[i];if(r.origin=t,h&&!Jo(e,r,!1))return a.length=0,{};u.push(So(e,r));var o=i?ho(e,r):K(a);rs(e,r,o,Do(e,r)),!i&&e.cm&&e.cm.scrollIntoView({from:r.from,to:co(r)});var s=[];vo(e,(function(e,t){t||-1!=N(s,e.history)||(ls(e.history,r),s.push(e.history)),rs(e,r,null,Do(e,r))}))},p=n.changes.length-1;p>=0;--p){var f=d(p);if(f)return f.v}}}}function is(e,t){if(0!=t&&(e.first+=t,e.sel=new oo(Y(e.sel.ranges,(function(e){return new so(st(e.anchor.line+t,e.anchor.ch),st(e.head.line+t,e.head.ch))})),e.sel.primIndex),e.cm)){Or(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,r=i.viewFrom;r<i.viewTo;r++)Fr(e.cm,r,"gutter")}}function rs(e,t,i,r){if(e.cm&&!e.cm.curOp)return Ln(e.cm,rs)(e,t,i,r);if(t.to.line<e.first)is(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var n=t.text.length-1-(e.first-t.from.line);is(e,n),t={from:st(e.first,0),to:st(t.to.line+n,t.to.ch),text:[K(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:st(o,Je(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Qe(e,t.from,t.to),i||(i=ho(e,t)),e.cm?ns(e.cm,t,r):_o(e,t,r),Go(e,i,G),e.cantEdit&&Xo(e,st(e.firstLine(),0))&&(e.cantEdit=!1)}}function ns(e,t,i){var r=e.doc,n=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=it(Qt(Je(r,o.line))),r.iter(l,s.line+1,(function(e){if(e==n.maxLine)return a=!0,!0}))),r.sel.contains(t.from,t.to)>-1&&xe(e),_o(r,t,i,Lr(e)),e.options.lineWrapping||(r.iter(l,o.line+t.text.length,(function(e){var t=ai(e);t>n.maxLineLength&&(n.maxLine=e,n.maxLineLength=t,n.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0)),At(r,o.line),Bn(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?Or(e):o.line!=s.line||1!=t.text.length||yo(e.doc,t)?Or(e,o.line,s.line+1,c):Fr(e,o.line,"text");var u=be(e,"changes"),h=be(e,"change");if(h||u){var d={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};h&&Ai(e,"change",e,d),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(d)}e.display.selForContextMenu=null}function os(e,t,i,r,n){var o;r||(r=i),at(r,i)<0&&(i=(o=[r,i])[0],r=o[1]),"string"==typeof t&&(t=e.splitLines(t)),Qo(e,{from:i,to:r,text:t,origin:n})}function ss(e,t,i,r){i<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function as(e,t,i,r){for(var n=0;n<e.length;++n){var o=e[n],s=!0;if(o.ranges){o.copied||((o=e[n]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)ss(o.ranges[a].anchor,t,i,r),ss(o.ranges[a].head,t,i,r)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(i<c.from.line)c.from=st(c.from.line+r,c.from.ch),c.to=st(c.to.line+r,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,n+1),n=0)}}}function ls(e,t){var i=t.from.line,r=t.to.line,n=t.text.length-(r-i)-1;as(e.done,i,r,n),as(e.undone,i,r,n)}function cs(e,t,i,r){var n=t,o=t;return"number"==typeof t?o=Je(e,dt(e,t)):n=it(t),null==n?null:(r(o,n)&&e.cm&&Fr(e.cm,n,i),o)}function us(e){this.lines=e,this.parent=null;for(var t=0,i=0;i<e.length;++i)e[i].parent=this,t+=e[i].height;this.height=t}function hs(e){this.children=e;for(var t=0,i=0,r=0;r<e.length;++r){var n=e[r];t+=n.chunkSize(),i+=n.height,n.parent=this}this.size=t,this.height=i,this.parent=null}so.prototype.from=function(){return ht(this.anchor,this.head)},so.prototype.to=function(){return ut(this.anchor,this.head)},so.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},us.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var i=e,r=e+t;i<r;++i){var n=this.lines[i];this.height-=n.height,hi(n),Ai(n,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=this},iterN:function(e,t,i){for(var r=e+t;e<r;++e)if(i(this.lines[e]))return!0}},hs.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var i=0;i<this.children.length;++i){var r=this.children[i],n=r.chunkSize();if(e<n){var o=Math.min(t,n-e),s=r.height;if(r.removeInner(e,o),this.height-=s-r.height,n==o&&(this.children.splice(i--,1),r.parent=null),0==(t-=o))break;e=0}else e-=n}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof us))){var a=[];this.collapse(a),this.children=[new us(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,i){this.size+=t.length,this.height+=i;for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(e<=o){if(n.insertInner(e,t,i),n.lines&&n.lines.length>50){for(var s=n.lines.length%25+25,a=s;a<n.lines.length;){var l=new us(n.lines.slice(a,a+=25));n.height-=l.height,this.children.splice(++r,0,l),l.parent=this}n.lines=n.lines.slice(0,s),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new hs(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var i=N(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{var r=new hs(e.children);r.parent=e,e.children=[r,t],e=r}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,i){for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(e<o){var s=Math.min(t,o-e);if(n.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=o}}};var ds=function(e,t,i){if(i)for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);this.doc=e,this.node=t};function ps(e,t,i){si(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&an(e,i)}function fs(e,t,i,r){var n=new ds(e,i,r),o=e.cm;return o&&n.noHScroll&&(o.display.alignWidgets=!0),cs(e,t,"widget",(function(t){var i=t.widgets||(t.widgets=[]);if(null==n.insertAt?i.push(n):i.splice(Math.min(i.length,Math.max(0,n.insertAt)),0,n),n.line=t,o&&!ni(e,t)){var r=si(t)<e.scrollTop;tt(t,t.height+Vi(n)),r&&an(o,n.height),o.curOp.forceUpdate=!0}return!0})),o&&Ai(o,"lineWidgetAdded",o,n,"number"==typeof t?t:it(t)),n}ds.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,i=this.line,r=it(i);if(null!=r&&t){for(var n=0;n<t.length;++n)t[n]==this&&t.splice(n--,1);t.length||(i.widgets=null);var o=Vi(this);tt(i,Math.max(0,i.height-o)),e&&(Pn(e,(function(){ps(e,i,-o),Fr(e,r,"widget")})),Ai(e,"lineWidgetCleared",e,this,r))}},ds.prototype.changed=function(){var e=this,t=this.height,i=this.doc.cm,r=this.line;this.height=null;var n=Vi(this)-t;n&&(ni(this.doc,r)||tt(r,r.height+n),i&&Pn(i,(function(){i.curOp.forceUpdate=!0,ps(i,r,n),Ai(i,"lineWidgetChanged",i,e,it(r))})))},we(ds);var ms=0,gs=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++ms};function ys(e,t,i,r,n){if(r&&r.shared)return vs(e,t,i,r,n);if(e.cm&&!e.cm.curOp)return Ln(e.cm,ys)(e,t,i,r,n);var o=new gs(e,n),s=at(t,i);if(r&&F(r,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=z("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),r.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Jt(e,t.line,t,i,o)||t.line!=i.line&&Jt(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Lt()}o.addToHistory&&ko(e,{from:t,to:i,origin:"markText"},e.sel,NaN);var a,l=t.line,c=e.cm;if(e.iter(l,i.line+1,(function(r){c&&o.collapsed&&!c.options.lineWrapping&&Qt(r)==c.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&tt(r,0),Ot(r,new Dt(o,l==t.line?t.ch:null,l==i.line?i.ch:null),e.cm&&e.cm.curOp),++l})),o.collapsed&&e.iter(t.line,i.line+1,(function(t){ni(e,t)&&tt(t,0)})),o.clearOnEnter&&me(o,"beforeCursorEnter",(function(){return o.clear()})),o.readOnly&&(Pt(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++ms,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)Or(c,t.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var u=t.line;u<=i.line;u++)Fr(c,u,"text");o.atomic&&Zo(c.doc),Ai(c,"markerAdded",c,o)}return o}gs.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Sn(e),be(this,"clear")){var i=this.find();i&&Ai(this,"clear",i.from,i.to)}for(var r=null,n=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Rt(s.markedSpans,this);e&&!this.collapsed?Fr(e,it(s),"text"):e&&(null!=a.to&&(n=it(s)),null!=a.from&&(r=it(s))),s.markedSpans=Bt(s.markedSpans,a),null==a.from&&this.collapsed&&!ni(this.doc,s)&&e&&tt(s,Ar(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var c=Qt(this.lines[l]),u=ai(c);u>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=u,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&Or(e,r,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Zo(e.doc)),e&&Ai(e,"markerCleared",e,this,r,n),t&&Cn(e),this.parent&&this.parent.clear()}},gs.prototype.find=function(e,t){var i,r;null==e&&"bookmark"==this.type&&(e=1);for(var n=0;n<this.lines.length;++n){var o=this.lines[n],s=Rt(o.markedSpans,this);if(null!=s.from&&(i=st(t?o:it(o),s.from),-1==e))return i;if(null!=s.to&&(r=st(t?o:it(o),s.to),1==e))return r}return i&&{from:i,to:r}},gs.prototype.changed=function(){var e=this,t=this.find(-1,!0),i=this,r=this.doc.cm;t&&r&&Pn(r,(function(){var n=t.line,o=it(t.line),s=tr(r,o);if(s&&(ur(s),r.curOp.selectionChanged=r.curOp.forceUpdate=!0),r.curOp.updateMaxLine=!0,!ni(i.doc,n)&&null!=i.height){var a=i.height;i.height=null;var l=Vi(i)-a;l&&tt(n,n.height+l)}Ai(r,"markerChanged",r,e)}))},gs.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=N(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},gs.prototype.detachLine=function(e){if(this.lines.splice(N(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},we(gs);var _s=function(e,t){this.markers=e,this.primary=t;for(var i=0;i<e.length;++i)e[i].parent=this};function vs(e,t,i,r,n){(r=F(r)).shared=!1;var o=[ys(e,t,i,r,n)],s=o[0],a=r.widgetNode;return vo(e,(function(e){a&&(r.widgetNode=a.cloneNode(!0)),o.push(ys(e,pt(e,t),pt(e,i),r,n));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=K(o)})),new _s(o,s)}function xs(e){return e.findMarks(st(e.first,0),e.clipPos(st(e.lastLine())),(function(e){return e.parent}))}function bs(e,t){for(var i=0;i<t.length;i++){var r=t[i],n=r.find(),o=e.clipPos(n.from),s=e.clipPos(n.to);if(at(o,s)){var a=ys(e,o,s,r.primary,r.primary.type);r.markers.push(a),a.parent=r}}}function ws(e){for(var t=function(t){var i=e[t],r=[i.primary.doc];vo(i.primary.doc,(function(e){return r.push(e)}));for(var n=0;n<i.markers.length;n++){var o=i.markers[n];-1==N(r,o.doc)&&(o.parent=null,i.markers.splice(n--,1))}},i=0;i<e.length;i++)t(i)}_s.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();Ai(this,"clear")}},_s.prototype.find=function(e,t){return this.primary.find(e,t)},we(_s);var Ts=0,Ss=function(e,t,i,r,n){if(!(this instanceof Ss))return new Ss(e,t,i,r,n);null==i&&(i=0),hs.call(this,[new us([new ci("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=st(i,0);this.sel=lo(o),this.history=new To(null),this.id=++Ts,this.modeOption=t,this.lineSep=r,this.direction="rtl"==n?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_o(this,{from:o,to:o,text:e}),Vo(this,lo(o),G)};Ss.prototype=ee(hs.prototype,{constructor:Ss,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,r=0;r<t.length;++r)i+=t[r].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=et(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Rn((function(e){var t=st(this.first,0),i=this.first+this.size-1;Qo(this,{from:t,to:st(i,Je(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&cn(this.cm,0,0),Vo(this,lo(t),G)})),replaceRange:function(e,t,i,r){os(this,e,t=pt(this,t),i=i?pt(this,i):t,r)},getRange:function(e,t,i){var r=Qe(this,pt(this,e),pt(this,t));return!1===i?r:""===i?r.join(""):r.join(i||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(nt(this,e))return Je(this,e)},getLineNumber:function(e){return it(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Je(this,e)),Qt(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return pt(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Rn((function(e,t,i){$o(this,pt(this,"number"==typeof e?st(e,t||0):e),null,i)})),setSelection:Rn((function(e,t,i){$o(this,pt(this,e),pt(this,t||e),i)})),extendSelection:Rn((function(e,t,i){Oo(this,pt(this,e),t&&pt(this,t),i)})),extendSelections:Rn((function(e,t){Fo(this,mt(this,e),t)})),extendSelectionsBy:Rn((function(e,t){Fo(this,mt(this,Y(this.sel.ranges,e)),t)})),setSelections:Rn((function(e,t,i){if(e.length){for(var r=[],n=0;n<e.length;n++)r[n]=new so(pt(this,e[n].anchor),pt(this,e[n].head||e[n].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Vo(this,ao(this.cm,r,t),i)}})),addSelection:Rn((function(e,t,i){var r=this.sel.ranges.slice(0);r.push(new so(pt(this,e),pt(this,t||e))),Vo(this,ao(this.cm,r,r.length-1),i)})),getSelection:function(e){for(var t,i=this.sel.ranges,r=0;r<i.length;r++){var n=Qe(this,i[r].from(),i[r].to());t=t?t.concat(n):n}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],i=this.sel.ranges,r=0;r<i.length;r++){var n=Qe(this,i[r].from(),i[r].to());!1!==e&&(n=n.join(e||this.lineSeparator())),t[r]=n}return t},replaceSelection:function(e,t,i){for(var r=[],n=0;n<this.sel.ranges.length;n++)r[n]=e;this.replaceSelections(r,t,i||"+input")},replaceSelections:Rn((function(e,t,i){for(var r=[],n=this.sel,o=0;o<n.ranges.length;o++){var s=n.ranges[o];r[o]={from:s.from(),to:s.to(),text:this.splitLines(e[o]),origin:i}}for(var a=t&&"end"!=t&&fo(this,r,t),l=r.length-1;l>=0;l--)Qo(this,r[l]);a?Uo(this,a):this.cm&&ln(this.cm)})),undo:Rn((function(){ts(this,"undo")})),redo:Rn((function(){ts(this,"redo")})),undoSelection:Rn((function(){ts(this,"undo",!0)})),redoSelection:Rn((function(){ts(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,r=0;r<e.done.length;r++)e.done[r].ranges||++t;for(var n=0;n<e.undone.length;n++)e.undone[n].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){var e=this;this.history=new To(this.history),vo(this,(function(t){return t.history=e.history}),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Ro(this.history.done),undone:Ro(this.history.undone)}},setHistory:function(e){var t=this.history=new To(this.history);t.done=Ro(e.done.slice(0),null,!0),t.undone=Ro(e.undone.slice(0),null,!0)},setGutterMarker:Rn((function(e,t,i){return cs(this,e,"gutter",(function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=i,!i&&ne(r)&&(e.gutterMarkers=null),!0}))})),clearGutter:Rn((function(e){var t=this;this.iter((function(i){i.gutterMarkers&&i.gutterMarkers[e]&&cs(t,i,"gutter",(function(){return i.gutterMarkers[e]=null,ne(i.gutterMarkers)&&(i.gutterMarkers=null),!0}))}))})),lineInfo:function(e){var t;if("number"==typeof e){if(!nt(this,e))return null;if(t=e,!(e=Je(this,e)))return null}else if(null==(t=it(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Rn((function(e,t,i){return cs(this,e,"gutter"==t?"gutter":"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[r]){if(C(i).test(e[r]))return!1;e[r]+=" "+i}else e[r]=i;return!0}))})),removeLineClass:Rn((function(e,t,i){return cs(this,e,"gutter"==t?"gutter":"class",(function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",n=e[r];if(!n)return!1;if(null==i)e[r]=null;else{var o=n.match(C(i));if(!o)return!1;var s=o.index+o[0].length;e[r]=n.slice(0,o.index)+(o.index&&s!=n.length?" ":"")+n.slice(s)||null}return!0}))})),addLineWidget:Rn((function(e,t,i){return fs(this,e,t,i)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return ys(this,pt(this,e),pt(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return ys(this,e=pt(this,e),e,i,"bookmark")},findMarksAt:function(e){var t=[],i=Je(this,(e=pt(this,e)).line).markedSpans;if(i)for(var r=0;r<i.length;++r){var n=i[r];(null==n.from||n.from<=e.ch)&&(null==n.to||n.to>=e.ch)&&t.push(n.marker.parent||n.marker)}return t},findMarks:function(e,t,i){e=pt(this,e),t=pt(this,t);var r=[],n=e.line;return this.iter(e.line,t.line+1,(function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&n==e.line&&e.ch>=l.to||null==l.from&&n!=e.line||null!=l.from&&n==t.line&&l.from>=t.ch||i&&!i(l.marker)||r.push(l.marker.parent||l.marker)}++n})),r},getAllMarks:function(){var e=[];return this.iter((function(t){var i=t.markedSpans;if(i)for(var r=0;r<i.length;++r)null!=i[r].from&&e.push(i[r].marker)})),e},posFromIndex:function(e){var t,i=this.first,r=this.lineSeparator().length;return this.iter((function(n){var o=n.text.length+r;if(o>e)return t=e,!0;e-=o,++i})),pt(this,st(i,t))},indexFromPos:function(e){var t=(e=pt(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,e.line,(function(e){t+=e.text.length+i})),t},copy:function(e){var t=new Ss(et(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var r=new Ss(et(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],bs(r,xs(this)),r},unlinkDoc:function(e){if(e instanceof Fa&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t)if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),ws(xs(this));break}if(e.history==this.history){var i=[e.id];vo(e,(function(e){return i.push(e.id)}),!0),e.history=new To(null),e.history.done=Ro(this.history.done,i),e.history.undone=Ro(this.history.undone,i)}},iterLinkedDocs:function(e){vo(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Re(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Rn((function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter((function(e){return e.order=null})),this.cm&&wo(this.cm))}))}),Ss.prototype.eachLine=Ss.prototype.iter;var Cs=0;function Ms(e){var t=this;if(As(t),!ve(t,e)&&!Gi(t.display,e)){Te(e),s&&(Cs=+new Date);var i=Rr(t,e,!0),r=e.dataTransfer.files;if(i&&!t.isReadOnly())if(r&&r.length&&window.FileReader&&window.File)for(var n=r.length,o=Array(n),a=0,l=function(){++a==n&&Ln(t,(function(){var e={from:i=pt(t.doc,i),to:i,text:t.doc.splitLines(o.filter((function(e){return null!=e})).join(t.doc.lineSeparator())),origin:"paste"};Qo(t.doc,e),Uo(t.doc,lo(pt(t.doc,i),pt(t.doc,co(e))))}))()},c=function(e,i){if(t.options.allowDropFileTypes&&-1==N(t.options.allowDropFileTypes,e.type))l();else{var r=new FileReader;r.onerror=function(){return l()},r.onload=function(){var e=r.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(o[i]=e),l()},r.readAsText(e)}},u=0;u<r.length;u++)c(r[u],u);else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout((function(){return t.display.input.focus()}),20);try{var h=e.dataTransfer.getData("Text");if(h){var d;if(t.state.draggingText&&!t.state.draggingText.copy&&(d=t.listSelections()),Go(t.doc,lo(i,i)),d)for(var p=0;p<d.length;++p)os(t.doc,"",d[p].anchor,d[p].head,"drag");t.replaceSelection(h,"around","paste"),t.display.input.focus()}}catch(e){}}}}function ks(e,t){if(s&&(!e.state.draggingText||+new Date-Cs<100))Me(t);else if(!ve(e,t)&&!Gi(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!p)){var i=I("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",d&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),d&&i.parentNode.removeChild(i)}}function Es(e,t){var i=Rr(e,t);if(i){var r=document.createDocumentFragment();qr(e,i,r),e.display.dragCursor||(e.display.dragCursor=I("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),A(e.display.dragCursor,r)}}function As(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Is(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),i=[],r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&i.push(n)}i.length&&i[0].operation((function(){for(var t=0;t<i.length;t++)e(i[t])}))}}var zs=!1;function Ps(){zs||(Ls(),zs=!0)}function Ls(){var e;me(window,"resize",(function(){null==e&&(e=setTimeout((function(){e=null,Is(Ds)}),100))})),me(window,"blur",(function(){return Is(Jr)}))}function Ds(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Rs={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Bs=0;Bs<10;Bs++)Rs[Bs+48]=Rs[Bs+96]=String(Bs);for(var Os=65;Os<=90;Os++)Rs[Os]=String.fromCharCode(Os);for(var Fs=1;Fs<=12;Fs++)Rs[Fs+111]=Rs[Fs+63235]="F"+Fs;var js={};function $s(e){var t,i,r,n,o=e.split(/-(?!$)/);e=o[o.length-1];for(var s=0;s<o.length-1;s++){var a=o[s];if(/^(cmd|meta|m)$/i.test(a))n=!0;else if(/^a(lt)?$/i.test(a))t=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);r=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),n&&(e="Cmd-"+e),r&&(e="Shift-"+e),e}function Ns(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==r){delete e[i];continue}for(var n=Y(i.split(" "),$s),o=0;o<n.length;o++){var s=void 0,a=void 0;o==n.length-1?(a=n.join(" "),s=r):(a=n.slice(0,o+1).join(" "),s="...");var l=t[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else t[a]=s}delete e[i]}for(var c in t)e[c]=t[c];return e}function Us(e,t,i,r){var n=(t=Zs(t)).call?t.call(e,r):t[e];if(!1===n)return"nothing";if("..."===n)return"multi";if(null!=n&&i(n))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Us(e,t.fallthrough,i,r);for(var o=0;o<t.fallthrough.length;o++){var s=Us(e,t.fallthrough[o],i,r);if(s)return s}}}function Vs(e){var t="string"==typeof e?e:Rs[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Gs(e,t,i){var r=e;return t.altKey&&"Alt"!=r&&(e="Alt-"+e),(T?t.metaKey:t.ctrlKey)&&"Ctrl"!=r&&(e="Ctrl-"+e),(T?t.ctrlKey:t.metaKey)&&"Mod"!=r&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=r&&(e="Shift-"+e),e}function qs(e,t){if(d&&34==e.keyCode&&e.char)return!1;var i=Rs[e.keyCode];return null!=i&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(i=e.code),Gs(i,e,t))}function Zs(e){return"string"==typeof e?js[e]:e}function Ws(e,t){for(var i=e.doc.sel.ranges,r=[],n=0;n<i.length;n++){for(var o=t(i[n]);r.length&&at(o.from,K(r).to)<=0;){var s=r.pop();if(at(s.from,o.from)<0){o.from=s.from;break}}r.push(o)}Pn(e,(function(){for(var t=r.length-1;t>=0;t--)os(e.doc,"",r[t].from,r[t].to,"+delete");ln(e)}))}function Hs(e,t,i){var r=ae(e.text,t+i,i);return r<0||r>e.text.length?null:r}function Xs(e,t,i){var r=Hs(e,t.ch,i);return null==r?null:new st(t.line,r,i<0?"after":"before")}function Ks(e,t,i,r,n){if(e){"rtl"==t.doc.direction&&(n=-n);var o=pe(i,t.doc.direction);if(o){var s,a=n<0?K(o):o[0],l=n<0==(1==a.level)?"after":"before";if(a.level>0||"rtl"==t.doc.direction){var c=ir(t,i);s=n<0?i.text.length-1:0;var u=rr(t,c,s).top;s=le((function(e){return rr(t,c,e).top==u}),n<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=Hs(i,s,1))}else s=n<0?a.to:a.from;return new st(r,s,l)}}return new st(r,n<0?i.text.length:0,n<0?"before":"after")}function Ys(e,t,i,r){var n=pe(t,e.doc.direction);if(!n)return Xs(t,i,r);i.ch>=t.text.length?(i.ch=t.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");var o=he(n,i.ch,i.sticky),s=n[o];if("ltr"==e.doc.direction&&s.level%2==0&&(r>0?s.to>i.ch:s.from<i.ch))return Xs(t,i,r);var a,l=function(e,i){return Hs(t,e instanceof st?e.ch:e,i)},c=function(i){return e.options.lineWrapping?(a=a||ir(e,t),Sr(e,t,a,i)):{begin:0,end:t.text.length}},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==e.doc.direction||1==s.level){var h=1==s.level==r<0,d=l(i,h?1:-1);if(null!=d&&(h?d<=s.to&&d<=u.end:d>=s.from&&d>=u.begin)){var p=h?"before":"after";return new st(i.line,d,p)}}var f=function(e,t,r){for(var o=function(e,t){return t?new st(i.line,l(e,1),"before"):new st(i.line,e,"after")};e>=0&&e<n.length;e+=t){var s=n[e],a=t>0==(1!=s.level),c=a?r.begin:l(r.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),r.begin<=c&&c<r.end)return o(c,a)}},m=f(o+r,r,u);if(m)return m;var g=r>0?u.end:l(u.begin,-1);return null==g||r>0&&g==t.text.length||!(m=f(r>0?0:n.length-1,r,c(g)))?null:m}js.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},js.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},js.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},js.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},js.default=v?js.macDefault:js.pcDefault;var Js={selectAll:Yo,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),G)},killLine:function(e){return Ws(e,(function(t){if(t.empty()){var i=Je(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:st(t.head.line+1,0)}:{from:t.head,to:st(t.head.line,i)}}return{from:t.from(),to:t.to()}}))},deleteLine:function(e){return Ws(e,(function(t){return{from:st(t.from().line,0),to:pt(e.doc,st(t.to().line+1,0))}}))},delLineLeft:function(e){return Ws(e,(function(e){return{from:st(e.from().line,0),to:e.from()}}))},delWrappedLineLeft:function(e){return Ws(e,(function(t){var i=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:i},"div"),to:t.from()}}))},delWrappedLineRight:function(e){return Ws(e,(function(t){var i=e.charCoords(t.head,"div").top+5,r=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:r}}))},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(st(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(st(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy((function(t){return Qs(e,t.head.line)}),{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy((function(t){return ta(e,t.head)}),{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy((function(t){return ea(e,t.head.line)}),{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")}),Z)},goLineLeft:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")}),Z)},goLineLeftSmart:function(e){return e.extendSelectionsBy((function(t){var i=e.cursorCoords(t.head,"div").top+5,r=e.coordsChar({left:0,top:i},"div");return r.ch<e.getLine(r.line).search(/\S/)?ta(e,t.head):r}),Z)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),r=e.options.tabSize,n=0;n<i.length;n++){var o=i[n].from(),s=j(e.getLine(o.line),o.ch,r);t.push(X(r-s%r))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return Pn(e,(function(){for(var t=e.listSelections(),i=[],r=0;r<t.length;r++)if(t[r].empty()){var n=t[r].head,o=Je(e.doc,n.line).text;if(o)if(n.ch==o.length&&(n=new st(n.line,n.ch-1)),n.ch>0)n=new st(n.line,n.ch+1),e.replaceRange(o.charAt(n.ch-1)+o.charAt(n.ch-2),st(n.line,n.ch-2),n,"+transpose");else if(n.line>e.doc.first){var s=Je(e.doc,n.line-1).text;s&&(n=new st(n.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),st(n.line-1,s.length-1),n,"+transpose"))}i.push(new so(n,n))}e.setSelections(i)}))},newlineAndIndent:function(e){return Pn(e,(function(){for(var t=e.listSelections(),i=t.length-1;i>=0;i--)e.replaceRange(e.doc.lineSeparator(),t[i].anchor,t[i].head,"+input");t=e.listSelections();for(var r=0;r<t.length;r++)e.indentLine(t[r].from().line,null,!0);ln(e)}))},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Qs(e,t){var i=Je(e.doc,t),r=Qt(i);return r!=i&&(t=it(r)),Ks(!0,e,r,t,1)}function ea(e,t){var i=Je(e.doc,t),r=ei(i);return r!=i&&(t=it(r)),Ks(!0,e,i,t,-1)}function ta(e,t){var i=Qs(e,t.line),r=Je(e.doc,i.line),n=pe(r,e.doc.direction);if(!n||0==n[0].level){var o=Math.max(i.ch,r.text.search(/\S/)),s=t.line==i.line&&t.ch<=o&&t.ch;return st(i.line,s?0:o,i.sticky)}return i}function ia(e,t,i){if("string"==typeof t&&!(t=Js[t]))return!1;e.display.input.ensurePolled();var r=e.display.shift,n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),n=t(e)!=V}finally{e.display.shift=r,e.state.suppressEdits=!1}return n}function ra(e,t,i){for(var r=0;r<e.state.keyMaps.length;r++){var n=Us(t,e.state.keyMaps[r],i,e);if(n)return n}return e.options.extraKeys&&Us(t,e.options.extraKeys,i,e)||Us(t,e.options.keyMap,i,e)}var na=new $;function oa(e,t,i,r){var n=e.state.keySeq;if(n){if(Vs(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:na.set(50,(function(){e.state.keySeq==n&&(e.state.keySeq=null,e.display.input.reset())})),sa(e,n+" "+t,i,r))return!0}return sa(e,t,i,r)}function sa(e,t,i,r){var n=ra(e,t,r);return"multi"==n&&(e.state.keySeq=t),"handled"==n&&Ai(e,"keyHandled",e,t,i),"handled"!=n&&"multi"!=n||(Te(i),Hr(e)),!!n}function aa(e,t){var i=qs(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?oa(e,"Shift-"+i,t,(function(t){return ia(e,t,!0)}))||oa(e,i,t,(function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return ia(e,t)})):oa(e,i,t,(function(t){return ia(e,t)})))}function la(e,t,i){return oa(e,"'"+i+"'",t,(function(t){return ia(e,t,!0)}))}var ca=null;function ua(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||(t.curOp.focus=L(),ve(t,e)))){s&&a<11&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=aa(t,e);d&&(ca=n?r:null,n||88!=r||Oe||!(v?e.metaKey:e.ctrlKey)||t.replaceSelection("",null,"cut")),i&&!v&&!n&&46==r&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ha(t)}}function ha(e){var t=e.display.lineDiv;function i(e){18!=e.keyCode&&e.altKey||(k(t,"CodeMirror-crosshair"),ye(document,"keyup",i),ye(document,"mouseover",i))}D(t,"CodeMirror-crosshair"),me(document,"keyup",i),me(document,"mouseover",i)}function da(e){16==e.keyCode&&(this.doc.sel.shift=!1),ve(this,e)}function pa(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField()||Gi(t.display,e)||ve(t,e)||e.ctrlKey&&!e.altKey||v&&e.metaKey)){var i=e.keyCode,r=e.charCode;if(d&&i==ca)return ca=null,void Te(e);if(!d||e.which&&!(e.which<10)||!aa(t,e)){var n=String.fromCharCode(null==r?i:r);"\b"!=n&&(la(t,e,n)||t.display.input.onKeyPress(e))}}}var fa,ma,ga=400,ya=function(e,t,i){this.time=e,this.pos=t,this.button=i};function _a(e,t){var i=+new Date;return ma&&ma.compare(i,e,t)?(fa=ma=null,"triple"):fa&&fa.compare(i,e,t)?(ma=new ya(i,e,t),fa=null,"double"):(fa=new ya(i,e,t),ma=null,"single")}function va(e){var t=this,i=t.display;if(!(ve(t,e)||i.activeTouch&&i.input.supportsTouch()))if(i.input.ensurePolled(),i.shift=e.shiftKey,Gi(i,e))l||(i.scroller.draggable=!1,setTimeout((function(){return i.scroller.draggable=!0}),100));else if(!Ea(t,e)){var r=Rr(t,e),n=Ee(e),o=r?_a(r,n):"single";window.focus(),1==n&&t.state.selectingText&&t.state.selectingText(e),r&&xa(t,n,r,o,e)||(1==n?r?wa(t,r,o,e):ke(e)==i.scroller&&Te(e):2==n?(r&&Oo(t.doc,r),setTimeout((function(){return i.input.focus()}),20)):3==n&&(S?t.display.input.onContextMenu(e):Kr(t)))}}function xa(e,t,i,r,n){var o="Click";return"double"==r?o="Double"+o:"triple"==r&&(o="Triple"+o),oa(e,Gs(o=(1==t?"Left":2==t?"Middle":"Right")+o,n),n,(function(t){if("string"==typeof t&&(t=Js[t]),!t)return!1;var r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r=t(e,i)!=V}finally{e.state.suppressEdits=!1}return r}))}function ba(e,t,i){var r=e.getOption("configureMouse"),n=r?r(e,t,i):{};if(null==n.unit){var o=x?i.shiftKey&&i.metaKey:i.altKey;n.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==n.extend||e.doc.extend)&&(n.extend=e.doc.extend||i.shiftKey),null==n.addNew&&(n.addNew=v?i.metaKey:i.ctrlKey),null==n.moveOnDrag&&(n.moveOnDrag=!(v?i.altKey:i.ctrlKey)),n}function wa(e,t,i,r){s?setTimeout(O(Xr,e),0):e.curOp.focus=L();var n,o=ba(e,i,r),a=e.doc.sel;e.options.dragDrop&&ze&&!e.isReadOnly()&&"single"==i&&(n=a.contains(t))>-1&&(at((n=a.ranges[n]).from(),t)<0||t.xRel>0)&&(at(n.to(),t)>0||t.xRel<0)?Ta(e,r,t,o):Ca(e,r,t,o)}function Ta(e,t,i,r){var n=e.display,o=!1,c=Ln(e,(function(t){l&&(n.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:Kr(e)),ye(n.wrapper.ownerDocument,"mouseup",c),ye(n.wrapper.ownerDocument,"mousemove",u),ye(n.scroller,"dragstart",h),ye(n.scroller,"drop",c),o||(Te(t),r.addNew||Oo(e.doc,i,null,null,r.extend),l&&!p||s&&9==a?setTimeout((function(){n.wrapper.ownerDocument.body.focus({preventScroll:!0}),n.input.focus()}),20):n.input.focus())})),u=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},h=function(){return o=!0};l&&(n.scroller.draggable=!0),e.state.draggingText=c,c.copy=!r.moveOnDrag,me(n.wrapper.ownerDocument,"mouseup",c),me(n.wrapper.ownerDocument,"mousemove",u),me(n.scroller,"dragstart",h),me(n.scroller,"drop",c),e.state.delayingBlurEvent=!0,setTimeout((function(){return n.input.focus()}),20),n.scroller.dragDrop&&n.scroller.dragDrop()}function Sa(e,t,i){if("char"==i)return new so(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new so(st(t.line,0),pt(e.doc,st(t.line+1,0)));var r=i(e,t);return new so(r.from,r.to)}function Ca(e,t,i,r){s&&Kr(e);var n=e.display,o=e.doc;Te(t);var a,l,c=o.sel,u=c.ranges;if(r.addNew&&!r.extend?(l=o.sel.contains(i),a=l>-1?u[l]:new so(i,i)):(a=o.sel.primary(),l=o.sel.primIndex),"rectangle"==r.unit)r.addNew||(a=new so(i,i)),i=Rr(e,t,!0,!0),l=-1;else{var h=Sa(e,i,r.unit);a=r.extend?Bo(a,h.anchor,h.head,r.extend):h}r.addNew?-1==l?(l=u.length,Vo(o,ao(e,u.concat([a]),l),{scroll:!1,origin:"*mouse"})):u.length>1&&u[l].empty()&&"char"==r.unit&&!r.extend?(Vo(o,ao(e,u.slice(0,l).concat(u.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),c=o.sel):jo(o,l,a,q):(l=0,Vo(o,new oo([a],0),q),c=o.sel);var d=i;function p(t){if(0!=at(d,t))if(d=t,"rectangle"==r.unit){for(var n=[],s=e.options.tabSize,u=j(Je(o,i.line).text,i.ch,s),h=j(Je(o,t.line).text,t.ch,s),p=Math.min(u,h),f=Math.max(u,h),m=Math.min(i.line,t.line),g=Math.min(e.lastLine(),Math.max(i.line,t.line));m<=g;m++){var y=Je(o,m).text,_=W(y,p,s);p==f?n.push(new so(st(m,_),st(m,_))):y.length>_&&n.push(new so(st(m,_),st(m,W(y,f,s))))}n.length||n.push(new so(i,i)),Vo(o,ao(e,c.ranges.slice(0,l).concat(n),l),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var v,x=a,b=Sa(e,t,r.unit),w=x.anchor;at(b.anchor,w)>0?(v=b.head,w=ht(x.from(),b.anchor)):(v=b.anchor,w=ut(x.to(),b.head));var T=c.ranges.slice(0);T[l]=Ma(e,new so(pt(o,w),v)),Vo(o,ao(e,T,l),q)}}var f=n.wrapper.getBoundingClientRect(),m=0;function g(t){var i=++m,s=Rr(e,t,!0,"rectangle"==r.unit);if(s)if(0!=at(s,d)){e.curOp.focus=L(),p(s);var a=tn(n,o);(s.line>=a.to||s.line<a.from)&&setTimeout(Ln(e,(function(){m==i&&g(t)})),150)}else{var l=t.clientY<f.top?-20:t.clientY>f.bottom?20:0;l&&setTimeout(Ln(e,(function(){m==i&&(n.scroller.scrollTop+=l,g(t))})),50)}}function y(t){e.state.selectingText=!1,m=1/0,t&&(Te(t),n.input.focus()),ye(n.wrapper.ownerDocument,"mousemove",_),ye(n.wrapper.ownerDocument,"mouseup",v),o.history.lastSelOrigin=null}var _=Ln(e,(function(e){0!==e.buttons&&Ee(e)?g(e):y(e)})),v=Ln(e,y);e.state.selectingText=v,me(n.wrapper.ownerDocument,"mousemove",_),me(n.wrapper.ownerDocument,"mouseup",v)}function Ma(e,t){var i=t.anchor,r=t.head,n=Je(e.doc,i.line);if(0==at(i,r)&&i.sticky==r.sticky)return t;var o=pe(n);if(!o)return t;var s=he(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return t;var l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return t;if(r.line!=i.line)l=(r.line-i.line)*("ltr"==e.doc.direction?1:-1)>0;else{var u=he(o,r.ch,r.sticky),h=u-s||(r.ch-i.ch)*(1==a.level?-1:1);l=u==c-1||u==c?h<0:h>0}var d=o[c+(l?-1:0)],p=l==(1==d.level),f=p?d.from:d.to,m=p?"after":"before";return i.ch==f&&i.sticky==m?t:new so(new st(i.line,f,m),r)}function ka(e,t,i,r){var n,o;if(t.touches)n=t.touches[0].clientX,o=t.touches[0].clientY;else try{n=t.clientX,o=t.clientY}catch(e){return!1}if(n>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&Te(t);var s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!be(e,i))return Ce(t);o-=a.top-s.viewOffset;for(var l=0;l<e.display.gutterSpecs.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=n)return _e(e,i,e,rt(e.doc,o),e.display.gutterSpecs[l].className,t),Ce(t)}}function Ea(e,t){return ka(e,t,"gutterClick",!0)}function Aa(e,t){Gi(e.display,t)||Ia(e,t)||ve(e,t,"contextmenu")||S||e.display.input.onContextMenu(t)}function Ia(e,t){return!!be(e,"gutterContextMenu")&&ka(e,t,"gutterContextMenu",!1)}function za(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),dr(e)}ya.prototype.compare=function(e,t,i){return this.time+ga>e&&0==at(t,this.pos)&&i==this.button};var Pa={toString:function(){return"CodeMirror.Init"}},La={},Da={};function Ra(e){var t=e.optionHandlers;function i(i,r,n,o){e.defaults[i]=r,n&&(t[i]=o?function(e,t,i){i!=Pa&&n(e,t,i)}:n)}e.defineOption=i,e.Init=Pa,i("value","",(function(e,t){return e.setValue(t)}),!0),i("mode",null,(function(e,t){e.doc.modeOption=t,mo(e)}),!0),i("indentUnit",2,mo,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(function(e){go(e),dr(e),Or(e)}),!0),i("lineSeparator",null,(function(e,t){if(e.doc.lineSep=t,t){var i=[],r=e.doc.first;e.doc.iter((function(e){for(var n=0;;){var o=e.text.indexOf(t,n);if(-1==o)break;n=o+t.length,i.push(st(r,o))}r++}));for(var n=i.length-1;n>=0;n--)os(e.doc,t,i[n],st(i[n].line,i[n].ch+t.length))}})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(function(e,t,i){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=Pa&&e.refresh()})),i("specialCharPlaceholder",gi,(function(e){return e.refresh()}),!0),i("electricChars",!0),i("inputStyle",_?"contenteditable":"textarea",(function(){throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,(function(e,t){return e.getInputField().spellcheck=t}),!0),i("autocorrect",!1,(function(e,t){return e.getInputField().autocorrect=t}),!0),i("autocapitalize",!1,(function(e,t){return e.getInputField().autocapitalize=t}),!0),i("rtlMoveVisually",!b),i("wholeLineUpdateBefore",!0),i("theme","default",(function(e){za(e),Jn(e)}),!0),i("keyMap","default",(function(e,t,i){var r=Zs(t),n=i!=Pa&&Zs(i);n&&n.detach&&n.detach(e,r),r.attach&&r.attach(e,n||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,Oa,!0),i("gutters",[],(function(e,t){e.display.gutterSpecs=Kn(t,e.options.lineNumbers),Jn(e)}),!0),i("fixedGutter",!0,(function(e,t){e.display.gutters.style.left=t?Pr(e.display)+"px":"0",e.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(function(e){return vn(e)}),!0),i("scrollbarStyle","native",(function(e){wn(e),vn(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),i("lineNumbers",!1,(function(e,t){e.display.gutterSpecs=Kn(e.options.gutters,t),Jn(e)}),!0),i("firstLineNumber",1,Jn,!0),i("lineNumberFormatter",(function(e){return e}),Jn,!0),i("showCursorWhenSelecting",!1,Vr,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,(function(e,t){"nocursor"==t&&(Jr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),i("screenReaderLabel",null,(function(e,t){t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),i("disableInput",!1,(function(e,t){t||e.display.input.reset()}),!0),i("dragDrop",!0,Ba),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,Vr,!0),i("singleCursorHeightPerLine",!0,Vr,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,go,!0),i("addModeClass",!1,go,!0),i("pollInterval",100),i("undoDepth",200,(function(e,t){return e.doc.history.undoDepth=t})),i("historyEventDelay",1250),i("viewportMargin",10,(function(e){return e.refresh()}),!0),i("maxHighlightLength",1e4,go,!0),i("moveInputWithCursor",!0,(function(e,t){t||e.display.input.resetPosition()})),i("tabindex",null,(function(e,t){return e.display.input.getField().tabIndex=t||""})),i("autofocus",null),i("direction","ltr",(function(e,t){return e.doc.setDirection(t)}),!0),i("phrases",null)}function Ba(e,t,i){if(!t!=!(i&&i!=Pa)){var r=e.display.dragFunctions,n=t?me:ye;n(e.display.scroller,"dragstart",r.start),n(e.display.scroller,"dragenter",r.enter),n(e.display.scroller,"dragover",r.over),n(e.display.scroller,"dragleave",r.leave),n(e.display.scroller,"drop",r.drop)}}function Oa(e){e.options.lineWrapping?(D(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(k(e.display.wrapper,"CodeMirror-wrap"),li(e)),Dr(e),Or(e),dr(e),setTimeout((function(){return vn(e)}),100)}function Fa(e,t){var i=this;if(!(this instanceof Fa))return new Fa(e,t);this.options=t=t?F(t):{},F(La,t,!1);var r=t.value;"string"==typeof r?r=new Ss(r,t.mode,null,t.lineSeparator,t.direction):t.mode&&(r.modeOption=t.mode),this.doc=r;var n=new Fa.inputStyles[t.inputStyle](this),o=this.display=new Qn(e,r,n,t);for(var c in o.wrapper.CodeMirror=this,za(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),wn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new $,keySeq:null,specialChars:null},t.autofocus&&!_&&o.input.focus(),s&&a<11&&setTimeout((function(){return i.display.input.reset(!0)}),20),ja(this),Ps(),Sn(this),this.curOp.forceUpdate=!0,xo(this,r),t.autofocus&&!_||this.hasFocus()?setTimeout((function(){i.hasFocus()&&!i.state.focused&&Yr(i)}),20):Jr(this),Da)Da.hasOwnProperty(c)&&Da[c](this,t[c],Pa);Xn(this),t.finishInit&&t.finishInit(this);for(var u=0;u<$a.length;++u)$a[u](this);Cn(this),l&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function ja(e){var t=e.display;me(t.scroller,"mousedown",Ln(e,va)),me(t.scroller,"dblclick",s&&a<11?Ln(e,(function(t){if(!ve(e,t)){var i=Rr(e,t);if(i&&!Ea(e,t)&&!Gi(e.display,t)){Te(t);var r=e.findWordAt(i);Oo(e.doc,r.anchor,r.head)}}})):function(t){return ve(e,t)||Te(t)}),me(t.scroller,"contextmenu",(function(t){return Aa(e,t)})),me(t.input.getField(),"contextmenu",(function(i){t.scroller.contains(i.target)||Aa(e,i)}));var i,r={end:0};function n(){t.activeTouch&&(i=setTimeout((function(){return t.activeTouch=null}),1e3),(r=t.activeTouch).end=+new Date)}function o(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function l(e,t){if(null==t.left)return!0;var i=t.left-e.left,r=t.top-e.top;return i*i+r*r>400}me(t.scroller,"touchstart",(function(n){if(!ve(e,n)&&!o(n)&&!Ea(e,n)){t.input.ensurePolled(),clearTimeout(i);var s=+new Date;t.activeTouch={start:s,moved:!1,prev:s-r.end<=300?r:null},1==n.touches.length&&(t.activeTouch.left=n.touches[0].pageX,t.activeTouch.top=n.touches[0].pageY)}})),me(t.scroller,"touchmove",(function(){t.activeTouch&&(t.activeTouch.moved=!0)})),me(t.scroller,"touchend",(function(i){var r=t.activeTouch;if(r&&!Gi(t,i)&&null!=r.left&&!r.moved&&new Date-r.start<300){var o,s=e.coordsChar(t.activeTouch,"page");o=!r.prev||l(r,r.prev)?new so(s,s):!r.prev.prev||l(r,r.prev.prev)?e.findWordAt(s):new so(st(s.line,0),pt(e.doc,st(s.line+1,0))),e.setSelection(o.anchor,o.head),e.focus(),Te(i)}n()})),me(t.scroller,"touchcancel",n),me(t.scroller,"scroll",(function(){t.scroller.clientHeight&&(pn(e,t.scroller.scrollTop),mn(e,t.scroller.scrollLeft,!0),_e(e,"scroll",e))})),me(t.scroller,"mousewheel",(function(t){return no(e,t)})),me(t.scroller,"DOMMouseScroll",(function(t){return no(e,t)})),me(t.wrapper,"scroll",(function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0})),t.dragFunctions={enter:function(t){ve(e,t)||Me(t)},over:function(t){ve(e,t)||(Es(e,t),Me(t))},start:function(t){return ks(e,t)},drop:Ln(e,Ms),leave:function(t){ve(e,t)||As(e)}};var c=t.input.getField();me(c,"keyup",(function(t){return da.call(e,t)})),me(c,"keydown",Ln(e,ua)),me(c,"keypress",Ln(e,pa)),me(c,"focus",(function(t){return Yr(e,t)})),me(c,"blur",(function(t){return Jr(e,t)}))}Fa.defaults=La,Fa.optionHandlers=Da;var $a=[];function Na(e,t,i,r){var n,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?n=xt(e,t).state:i="prev");var s=e.options.tabSize,a=Je(o,t),l=j(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(r||/\S/.test(a.text)){if("smart"==i&&((c=o.mode.indent(n,a.text.slice(u.length),a.text))==V||c>150)){if(!r)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?j(Je(o,t-1).text,null,s):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var h="",d=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/s);p;--p)d+=s,h+="\t";if(d<c&&(h+=X(c-d)),h!=u)return os(o,h,st(t,0),st(t,u.length),"+input"),a.stateAfter=null,!0;for(var f=0;f<o.sel.ranges.length;f++){var m=o.sel.ranges[f];if(m.head.line==t&&m.head.ch<u.length){var g=st(t,u.length);jo(o,f,new so(g,g));break}}}Fa.defineInitHook=function(e){return $a.push(e)};var Ua=null;function Va(e){Ua=e}function Ga(e,t,i,r,n){var o=e.doc;e.display.shift=!1,r||(r=o.sel);var s=+new Date-200,a="paste"==n||e.state.pasteIncoming>s,l=Re(t),c=null;if(a&&r.ranges.length>1)if(Ua&&Ua.text.join("\n")==t){if(r.ranges.length%Ua.text.length==0){c=[];for(var u=0;u<Ua.text.length;u++)c.push(o.splitLines(Ua.text[u]))}}else l.length==r.ranges.length&&e.options.pasteLinesPerSelection&&(c=Y(l,(function(e){return[e]})));for(var h=e.curOp.updateInput,d=r.ranges.length-1;d>=0;d--){var p=r.ranges[d],f=p.from(),m=p.to();p.empty()&&(i&&i>0?f=st(f.line,f.ch-i):e.state.overwrite&&!a?m=st(m.line,Math.min(Je(o,m.line).text.length,m.ch+K(l).length)):a&&Ua&&Ua.lineWise&&Ua.text.join("\n")==l.join("\n")&&(f=m=st(f.line,0)));var g={from:f,to:m,text:c?c[d%c.length]:l,origin:n||(a?"paste":e.state.cutIncoming>s?"cut":"+input")};Qo(e.doc,g),Ai(e,"inputRead",e,g)}t&&!a&&Za(e,t),ln(e),e.curOp.updateInput<2&&(e.curOp.updateInput=h),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function qa(e,t){var i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||!t.hasFocus()||Pn(t,(function(){return Ga(t,i,0,null,"paste")})),!0}function Za(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var i=e.doc.sel,r=i.ranges.length-1;r>=0;r--){var n=i.ranges[r];if(!(n.head.ch>100||r&&i.ranges[r-1].head.line==n.head.line)){var o=e.getModeAt(n.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(t.indexOf(o.electricChars.charAt(a))>-1){s=Na(e,n.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Je(e.doc,n.head.line).text.slice(0,n.head.ch))&&(s=Na(e,n.head.line,"smart"));s&&Ai(e,"electricInput",e,n.head.line)}}}function Wa(e){for(var t=[],i=[],r=0;r<e.doc.sel.ranges.length;r++){var n=e.doc.sel.ranges[r].head.line,o={anchor:st(n,0),head:st(n+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function Ha(e,t,i,r){e.setAttribute("autocorrect",i?"":"off"),e.setAttribute("autocapitalize",r?"":"off"),e.setAttribute("spellcheck",!!t)}function Xa(){var e=I("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=I("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return l?e.style.width="1000px":e.setAttribute("wrap","off"),g&&(e.style.border="1px solid black"),Ha(e),t}function Ka(e){var t=e.optionHandlers,i=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,i){var r=this.options,n=r[e];r[e]==i&&"mode"!=e||(r[e]=i,t.hasOwnProperty(e)&&Ln(this,t[e])(this,i,n),_e(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Zs(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:Dn((function(t,i){var r=t.token?t:e.getMode(this.options,t);if(r.startState)throw new Error("Overlays may not be stateful.");J(this.state.overlays,{mode:r,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},(function(e){return e.priority})),this.state.modeGen++,Or(this)})),removeOverlay:Dn((function(e){for(var t=this.state.overlays,i=0;i<t.length;++i){var r=t[i].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(i,1),this.state.modeGen++,void Or(this)}})),indentLine:Dn((function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),nt(this.doc,e)&&Na(this,e,t,i)})),indentSelection:Dn((function(e){for(var t=this.doc.sel.ranges,i=-1,r=0;r<t.length;r++){var n=t[r];if(n.empty())n.head.line>i&&(Na(this,n.head.line,e,!0),i=n.head.line,r==this.doc.sel.primIndex&&ln(this));else{var o=n.from(),s=n.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var l=a;l<i;++l)Na(this,l,e);var c=this.doc.sel.ranges;0==o.ch&&t.length==c.length&&c[r].from().ch>0&&jo(this.doc,r,new so(o,c[r].to()),G)}}})),getTokenAt:function(e,t){return Ct(this,e,t)},getLineTokens:function(e,t){return Ct(this,st(e),t,!0)},getTokenTypeAt:function(e){e=pt(this.doc,e);var t,i=vt(this,Je(this.doc,e.line)),r=0,n=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){var s=r+n>>1;if((s?i[2*s-1]:0)>=o)n=s;else{if(!(i[2*s+1]<o)){t=i[2*s+2];break}r=s+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var r=[];if(!i.hasOwnProperty(t))return r;var n=i[t],o=this.getModeAt(e);if("string"==typeof o[t])n[o[t]]&&r.push(n[o[t]]);else if(o[t])for(var s=0;s<o[t].length;s++){var a=n[o[t][s]];a&&r.push(a)}else o.helperType&&n[o.helperType]?r.push(n[o.helperType]):n[o.name]&&r.push(n[o.name]);for(var l=0;l<n._global.length;l++){var c=n._global[l];c.pred(o,this)&&-1==N(r,c.val)&&r.push(c.val)}return r},getStateAfter:function(e,t){var i=this.doc;return xt(this,(e=dt(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){var i=this.doc.sel.primary();return vr(this,null==e?i.head:"object"==typeof e?pt(this.doc,e):e?i.from():i.to(),t||"page")},charCoords:function(e,t){return _r(this,pt(this.doc,e),t||"page")},coordsChar:function(e,t){return wr(this,(e=yr(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=yr(this,{top:e,left:0},t||"page").top,rt(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){var r,n=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,n=!0),r=Je(this.doc,e)}else r=e;return gr(this,r,{top:0,left:0},t||"page",i||n).top+(n?this.doc.height-si(r):0)},defaultTextHeight:function(){return Ar(this.display)},defaultCharWidth:function(){return Ir(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,r,n){var o=this.display,s=(e=vr(this,pt(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==r)s=e.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==n?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==n?a=0:"middle"==n&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&on(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:Dn(ua),triggerOnKeyPress:Dn(pa),triggerOnKeyUp:da,triggerOnMouseDown:Dn(va),execCommand:function(e){if(Js.hasOwnProperty(e))return Js[e].call(null,this)},triggerElectric:Dn((function(e){Za(this,e)})),findPosH:function(e,t,i,r){var n=1;t<0&&(n=-1,t=-t);for(var o=pt(this.doc,e),s=0;s<t&&!(o=Ya(this.doc,o,n,i,r)).hitSide;++s);return o},moveH:Dn((function(e,t){var i=this;this.extendSelectionsBy((function(r){return i.display.shift||i.doc.extend||r.empty()?Ya(i.doc,r.head,e,t,i.options.rtlMoveVisually):e<0?r.from():r.to()}),Z)})),deleteH:Dn((function(e,t){var i=this.doc.sel,r=this.doc;i.somethingSelected()?r.replaceSelection("",null,"+delete"):Ws(this,(function(i){var n=Ya(r,i.head,e,t,!1);return e<0?{from:n,to:i.head}:{from:i.head,to:n}}))})),findPosV:function(e,t,i,r){var n=1,o=r;t<0&&(n=-1,t=-t);for(var s=pt(this.doc,e),a=0;a<t;++a){var l=vr(this,s,"div");if(null==o?o=l.left:l.left=o,(s=Ja(this,l,n,i)).hitSide)break}return s},moveV:Dn((function(e,t){var i=this,r=this.doc,n=[],o=!this.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy((function(s){if(o)return e<0?s.from():s.to();var a=vr(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),n.push(a.left);var l=Ja(i,a,e,t);return"page"==t&&s==r.sel.primary()&&an(i,_r(i,l,"div").top-a.top),l}),Z),n.length)for(var s=0;s<r.sel.ranges.length;s++)r.sel.ranges[s].goalColumn=n[s]})),findWordAt:function(e){var t=Je(this.doc,e.line).text,i=e.ch,r=e.ch;if(t){var n=this.getHelper(e,"wordChars");"before"!=e.sticky&&r!=t.length||!i?++r:--i;for(var o=t.charAt(i),s=re(o,n)?function(e){return re(e,n)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!re(e)};i>0&&s(t.charAt(i-1));)--i;for(;r<t.length&&s(t.charAt(r));)++r}return new so(st(e.line,i),st(e.line,r))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?D(this.display.cursorDiv,"CodeMirror-overwrite"):k(this.display.cursorDiv,"CodeMirror-overwrite"),_e(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==L()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Dn((function(e,t){cn(this,e,t)})),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Hi(this)-this.display.barHeight,width:e.scrollWidth-Hi(this)-this.display.barWidth,clientHeight:Ki(this),clientWidth:Xi(this)}},scrollIntoView:Dn((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:st(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?un(this,e):dn(this,e.from,e.to,e.margin)})),setSize:Dn((function(e,t){var i=this,r=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=r(e)),null!=t&&(this.display.wrapper.style.height=r(t)),this.options.lineWrapping&&hr(this);var n=this.display.viewFrom;this.doc.iter(n,this.display.viewTo,(function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){Fr(i,n,"widget");break}++n})),this.curOp.forceUpdate=!0,_e(this,"refresh",this)})),operation:function(e){return Pn(this,e)},startOperation:function(){return Sn(this)},endOperation:function(){return Cn(this)},refresh:Dn((function(){var e=this.display.cachedTextHeight;Or(this),this.curOp.forceUpdate=!0,dr(this),cn(this,this.doc.scrollLeft,this.doc.scrollTop),Zn(this.display),(null==e||Math.abs(e-Ar(this.display))>.5||this.options.lineWrapping)&&Dr(this),_e(this,"refresh",this)})),swapDoc:Dn((function(e){var t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),xo(this,e),dr(this),this.display.input.reset(),cn(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,Ai(this,"swapDoc",this,t),t})),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},we(e),e.registerHelper=function(t,r,n){i.hasOwnProperty(t)||(i[t]=e[t]={_global:[]}),i[t][r]=n},e.registerGlobalHelper=function(t,r,n,o){e.registerHelper(t,r,o),i[t]._global.push({pred:n,val:o})}}function Ya(e,t,i,r,n){var o=t,s=i,a=Je(e,t.line),l=n&&"rtl"==e.direction?-i:i;function c(){var i=t.line+l;return!(i<e.first||i>=e.first+e.size)&&(t=new st(i,t.ch,t.sticky),a=Je(e,i))}function u(o){var s;if("codepoint"==r){var u=a.text.charCodeAt(t.ch+(i>0?0:-1));if(isNaN(u))s=null;else{var h=i>0?u>=55296&&u<56320:u>=56320&&u<57343;s=new st(t.line,Math.max(0,Math.min(a.text.length,t.ch+i*(h?2:1))),-i)}}else s=n?Ys(e.cm,a,t,i):Xs(a,t,i);if(null==s){if(o||!c())return!1;t=Ks(n,e.cm,a,t.line,l)}else t=s;return!0}if("char"==r||"codepoint"==r)u();else if("column"==r)u(!0);else if("word"==r||"group"==r)for(var h=null,d="group"==r,p=e.cm&&e.cm.getHelper(t,"wordChars"),f=!0;!(i<0)||u(!f);f=!1){var m=a.text.charAt(t.ch)||"\n",g=re(m,p)?"w":d&&"\n"==m?"n":!d||/\s/.test(m)?null:"p";if(!d||f||g||(g="s"),h&&h!=g){i<0&&(i=1,u(),t.sticky="after");break}if(g&&(h=g),i>0&&!u(!f))break}var y=Xo(e,t,o,s,!0);return lt(o,y)&&(y.hitSide=!0),y}function Ja(e,t,i,r){var n,o,s=e.doc,a=t.left;if("page"==r){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*Ar(e.display),3);n=(i>0?t.bottom:t.top)+i*c}else"line"==r&&(n=i>0?t.bottom+3:t.top-3);for(;(o=wr(e,a,n)).outside;){if(i<0?n<=0:n>=s.height){o.hitSide=!0;break}n+=5*i}return o}var Qa=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new $,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};function el(e,t){var i=tr(e,t.line);if(!i||i.hidden)return null;var r=Je(e.doc,t.line),n=Ji(i,r,t.line),o=pe(r,e.doc.direction),s="left";o&&(s=he(o,t.ch)%2?"right":"left");var a=sr(n.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function tl(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function il(e,t){return t&&(e.bad=!0),e}function rl(e,t,i,r,n){var o="",s=!1,a=e.doc.lineSeparator(),l=!1;function c(e){return function(t){return t.id==e}}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(e){e&&(u(),o+=e)}function d(t){if(1==t.nodeType){var i=t.getAttribute("cm-text");if(i)return void h(i);var o,p=t.getAttribute("cm-marker");if(p){var f=e.findMarks(st(r,0),st(n+1,0),c(+p));return void(f.length&&(o=f[0].find(0))&&h(Qe(e.doc,o.from,o.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;var m=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;m&&u();for(var g=0;g<t.childNodes.length;g++)d(t.childNodes[g]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),m&&(s=!0)}else 3==t.nodeType&&h(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;d(t),t!=i;)t=t.nextSibling,l=!1;return o}function nl(e,t,i){var r;if(t==e.display.lineDiv){if(!(r=e.display.lineDiv.childNodes[i]))return il(e.clipPos(st(e.display.viewTo-1)),!0);t=null,i=0}else for(r=t;;r=r.parentNode){if(!r||r==e.display.lineDiv)return null;if(r.parentNode&&r.parentNode==e.display.lineDiv)break}for(var n=0;n<e.display.view.length;n++){var o=e.display.view[n];if(o.node==r)return ol(o,t,i)}}function ol(e,t,i){var r=e.text.firstChild,n=!1;if(!t||!P(r,t))return il(st(it(e.line),0),!0);if(t==r&&(n=!0,t=r.childNodes[i],i=0,!t)){var o=e.rest?K(e.rest):e.line;return il(st(it(o),o.text.length),n)}var s=3==t.nodeType?t:null,a=t;for(s||1!=t.childNodes.length||3!=t.firstChild.nodeType||(s=t.firstChild,i&&(i=s.nodeValue.length));a.parentNode!=r;)a=a.parentNode;var l=e.measure,c=l.maps;function u(t,i,r){for(var n=-1;n<(c?c.length:0);n++)for(var o=n<0?l.map:c[n],s=0;s<o.length;s+=3){var a=o[s+2];if(a==t||a==i){var u=it(n<0?e.line:e.rest[n]),h=o[s]+r;return(r<0||a!=t)&&(h=o[s+(r?1:0)]),st(u,h)}}}var h=u(s,a,i);if(h)return il(h,n);for(var d=a.nextSibling,p=s?s.nodeValue.length-i:0;d;d=d.nextSibling){if(h=u(d,d.firstChild,0))return il(st(h.line,h.ch-p),n);p+=d.textContent.length}for(var f=a.previousSibling,m=i;f;f=f.previousSibling){if(h=u(f,f.firstChild,-1))return il(st(h.line,h.ch+m),n);m+=f.textContent.length}}Qa.prototype.init=function(e){var t=this,i=this,r=i.cm,n=i.div=e.lineDiv;function o(e){for(var t=e.target;t;t=t.parentNode){if(t==n)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function s(e){if(o(e)&&!ve(r,e)){if(r.somethingSelected())Va({lineWise:!1,text:r.getSelections()}),"cut"==e.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var t=Wa(r);Va({lineWise:!0,text:t.text}),"cut"==e.type&&r.operation((function(){r.setSelections(t.ranges,0,G),r.replaceSelection("",null,"cut")}))}if(e.clipboardData){e.clipboardData.clearData();var s=Ua.text.join("\n");if(e.clipboardData.setData("Text",s),e.clipboardData.getData("Text")==s)return void e.preventDefault()}var a=Xa(),l=a.firstChild;r.display.lineSpace.insertBefore(a,r.display.lineSpace.firstChild),l.value=Ua.text.join("\n");var c=L();B(l),setTimeout((function(){r.display.lineSpace.removeChild(a),c.focus(),c==n&&i.showPrimarySelection()}),50)}}n.contentEditable=!0,Ha(n,r.options.spellcheck,r.options.autocorrect,r.options.autocapitalize),me(n,"paste",(function(e){!o(e)||ve(r,e)||qa(e,r)||a<=11&&setTimeout(Ln(r,(function(){return t.updateFromDOM()})),20)})),me(n,"compositionstart",(function(e){t.composing={data:e.data,done:!1}})),me(n,"compositionupdate",(function(e){t.composing||(t.composing={data:e.data,done:!1})})),me(n,"compositionend",(function(e){t.composing&&(e.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)})),me(n,"touchstart",(function(){return i.forceCompositionEnd()})),me(n,"input",(function(){t.composing||t.readFromDOMSoon()})),me(n,"copy",s),me(n,"cut",s)},Qa.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},Qa.prototype.prepareSelection=function(){var e=Gr(this.cm,!1);return e.focus=L()==this.div,e},Qa.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Qa.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},Qa.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),o=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||o.line<t.display.viewFrom)e.removeAllRanges();else{var s=nl(t,e.anchorNode,e.anchorOffset),a=nl(t,e.focusNode,e.focusOffset);if(!s||s.bad||!a||a.bad||0!=at(ht(s,a),n)||0!=at(ut(s,a),o)){var l=t.display.view,c=n.line>=t.display.viewFrom&&el(t,n)||{node:l[0].measure.map[2],offset:0},u=o.line<t.display.viewTo&&el(t,o);if(!u){var h=l[l.length-1].measure,d=h.maps?h.maps[h.maps.length-1]:h.map;u={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}}if(c&&u){var p,f=e.rangeCount&&e.getRangeAt(0);try{p=M(c.node,c.offset,u.offset,u.node)}catch(e){}p&&(!i&&t.state.focused?(e.collapse(c.node,c.offset),p.collapsed||(e.removeAllRanges(),e.addRange(p))):(e.removeAllRanges(),e.addRange(p)),f&&null==e.anchorNode?e.addRange(f):i&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Qa.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation((function(){return e.cm.curOp.selectionChanged=!0}))}),20)},Qa.prototype.showMultipleSelections=function(e){A(this.cm.display.cursorDiv,e.cursors),A(this.cm.display.selectionDiv,e.selection)},Qa.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Qa.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return P(this.div,t)},Qa.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&L()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Qa.prototype.blur=function(){this.div.blur()},Qa.prototype.getField=function(){return this.div},Qa.prototype.supportsTouch=function(){return!0},Qa.prototype.receivedFocus=function(){var e=this,t=this;function i(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,i))}this.selectionInEditor()?setTimeout((function(){return e.pollSelection()}),20):Pn(this.cm,(function(){return t.cm.curOp.selectionChanged=!0})),this.polling.set(this.cm.options.pollInterval,i)},Qa.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Qa.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=this.getSelection(),t=this.cm;if(y&&u&&this.cm.display.gutterSpecs.length&&tl(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=nl(t,e.anchorNode,e.anchorOffset),r=nl(t,e.focusNode,e.focusOffset);i&&r&&Pn(t,(function(){Vo(t.doc,lo(i,r),G),(i.bad||r.bad)&&(t.curOp.selectionChanged=!0)}))}}},Qa.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,i,r=this.cm,n=r.display,o=r.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>r.firstLine()&&(s=st(s.line-1,Je(r.doc,s.line-1).length)),a.ch==Je(r.doc,a.line).text.length&&a.line<r.lastLine()&&(a=st(a.line+1,0)),s.line<n.viewFrom||a.line>n.viewTo-1)return!1;s.line==n.viewFrom||0==(e=Br(r,s.line))?(t=it(n.view[0].line),i=n.view[0].node):(t=it(n.view[e].line),i=n.view[e-1].node.nextSibling);var l,c,u=Br(r,a.line);if(u==n.view.length-1?(l=n.viewTo-1,c=n.lineDiv.lastChild):(l=it(n.view[u+1].line)-1,c=n.view[u+1].node.previousSibling),!i)return!1;for(var h=r.doc.splitLines(rl(r,i,c,t,l)),d=Qe(r.doc,st(t,0),st(l,Je(r.doc,l).text.length));h.length>1&&d.length>1;)if(K(h)==K(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),t++}for(var p=0,f=0,m=h[0],g=d[0],y=Math.min(m.length,g.length);p<y&&m.charCodeAt(p)==g.charCodeAt(p);)++p;for(var _=K(h),v=K(d),x=Math.min(_.length-(1==h.length?p:0),v.length-(1==d.length?p:0));f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==d.length&&t==s.line)for(;p&&p>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)p--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(p).replace(/\u200b+$/,"");var b=st(t,p),w=st(l,d.length?K(d).length-f:0);return h.length>1||h[0]||at(b,w)?(os(r.doc,h,b,w,"+input"),!0):void 0},Qa.prototype.ensurePolled=function(){this.forceCompositionEnd()},Qa.prototype.reset=function(){this.forceCompositionEnd()},Qa.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Qa.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()}),80))},Qa.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||Pn(this.cm,(function(){return Or(e.cm)}))},Qa.prototype.setUneditable=function(e){e.contentEditable="false"},Qa.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Ln(this.cm,Ga)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Qa.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Qa.prototype.onContextMenu=function(){},Qa.prototype.resetPosition=function(){},Qa.prototype.needsContentAttribute=!0;var sl=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new $,this.hasSelection=!1,this.composing=null};function al(e,t){if((t=t?F(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var i=L();t.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}function r(){e.value=a.getValue()}var n;if(e.form&&(me(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form;n=o.submit;try{var s=o.submit=function(){r(),o.submit=n,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(i){i.save=r,i.getTextArea=function(){return e},i.toTextArea=function(){i.toTextArea=isNaN,r(),e.parentNode.removeChild(i.getWrapperElement()),e.style.display="",e.form&&(ye(e.form,"submit",r),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=n))}},e.style.display="none";var a=Fa((function(t){return e.parentNode.insertBefore(t,e.nextSibling)}),t);return a}function ll(e){e.off=ye,e.on=me,e.wheelEventPixels=ro,e.Doc=Ss,e.splitLines=Re,e.countColumn=j,e.findColumn=W,e.isWordChar=ie,e.Pass=V,e.signal=_e,e.Line=ci,e.changeEnd=co,e.scrollbarModel=bn,e.Pos=st,e.cmpPos=at,e.modes=$e,e.mimeModes=Ne,e.resolveMode=Ge,e.getMode=qe,e.modeExtensions=Ze,e.extendMode=We,e.copyState=He,e.startState=Ke,e.innerMode=Xe,e.commands=Js,e.keyMap=js,e.keyName=qs,e.isModifierKey=Vs,e.lookupKey=Us,e.normalizeKeyMap=Ns,e.StringStream=Ye,e.SharedTextMarker=_s,e.TextMarker=gs,e.LineWidget=ds,e.e_preventDefault=Te,e.e_stopPropagation=Se,e.e_stop=Me,e.addClass=D,e.contains=P,e.rmClass=k,e.keyNames=Rs}sl.prototype.init=function(e){var t=this,i=this,r=this.cm;this.createField(e);var n=this.textarea;function o(e){if(!ve(r,e)){if(r.somethingSelected())Va({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var t=Wa(r);Va({lineWise:!0,text:t.text}),"cut"==e.type?r.setSelections(t.ranges,null,G):(i.prevInput="",n.value=t.text.join("\n"),B(n))}"cut"==e.type&&(r.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),g&&(n.style.width="0px"),me(n,"input",(function(){s&&a>=9&&t.hasSelection&&(t.hasSelection=null),i.poll()})),me(n,"paste",(function(e){ve(r,e)||qa(e,r)||(r.state.pasteIncoming=+new Date,i.fastPoll())})),me(n,"cut",o),me(n,"copy",o),me(e.scroller,"paste",(function(t){if(!Gi(e,t)&&!ve(r,t)){if(!n.dispatchEvent)return r.state.pasteIncoming=+new Date,void i.focus();var o=new Event("paste");o.clipboardData=t.clipboardData,n.dispatchEvent(o)}})),me(e.lineSpace,"selectstart",(function(t){Gi(e,t)||Te(t)})),me(n,"compositionstart",(function(){var e=r.getCursor("from");i.composing&&i.composing.range.clear(),i.composing={start:e,range:r.markText(e,r.getCursor("to"),{className:"CodeMirror-composing"})}})),me(n,"compositionend",(function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)}))},sl.prototype.createField=function(e){this.wrapper=Xa(),this.textarea=this.wrapper.firstChild},sl.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},sl.prototype.prepareSelection=function(){var e=this.cm,t=e.display,i=e.doc,r=Gr(e);if(e.options.moveInputWithCursor){var n=vr(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,n.top+s.top-o.top)),r.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,n.left+s.left-o.left))}return r},sl.prototype.showSelection=function(e){var t=this.cm.display;A(t.cursorDiv,e.cursors),A(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},sl.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var i=t.getSelection();this.textarea.value=i,t.state.focused&&B(this.textarea),s&&a>=9&&(this.hasSelection=i)}else e||(this.prevInput=this.textarea.value="",s&&a>=9&&(this.hasSelection=null))}},sl.prototype.getField=function(){return this.textarea},sl.prototype.supportsTouch=function(){return!1},sl.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!_||L()!=this.textarea))try{this.textarea.focus()}catch(e){}},sl.prototype.blur=function(){this.textarea.blur()},sl.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},sl.prototype.receivedFocus=function(){this.slowPoll()},sl.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,(function(){e.poll(),e.cm.state.focused&&e.slowPoll()}))},sl.prototype.fastPoll=function(){var e=!1,t=this;function i(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,i))}t.pollingFast=!0,t.polling.set(20,i)},sl.prototype.poll=function(){var e=this,t=this.cm,i=this.textarea,r=this.prevInput;if(this.contextMenuPending||!t.state.focused||Be(i)&&!r&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var n=i.value;if(n==r&&!t.somethingSelected())return!1;if(s&&a>=9&&this.hasSelection===n||v&&/[\uf700-\uf7ff]/.test(n))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=n.charCodeAt(0);if(8203!=o||r||(r="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,c=Math.min(r.length,n.length);l<c&&r.charCodeAt(l)==n.charCodeAt(l);)++l;return Pn(t,(function(){Ga(t,n.slice(l),r.length-l,null,e.composing?"*compose":null),n.length>1e3||n.indexOf("\n")>-1?i.value=e.prevInput="":e.prevInput=n,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))})),!0},sl.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},sl.prototype.onKeyPress=function(){s&&a>=9&&(this.hasSelection=null),this.fastPoll()},sl.prototype.onContextMenu=function(e){var t=this,i=t.cm,r=i.display,n=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=Rr(i,e),c=r.scroller.scrollTop;if(o&&!d){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&Ln(i,Vo)(i.doc,lo(o),G);var u,h=n.style.cssText,p=t.wrapper.style.cssText,f=t.wrapper.offsetParent.getBoundingClientRect();if(t.wrapper.style.cssText="position: static",n.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(s?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",l&&(u=window.scrollY),r.input.focus(),l&&window.scrollTo(null,u),r.input.reset(),i.somethingSelected()||(n.value=t.prevInput=" "),t.contextMenuPending=y,r.selForContextMenu=i.doc.sel,clearTimeout(r.detectingSelectAll),s&&a>=9&&g(),S){Me(e);var m=function(){ye(window,"mouseup",m),setTimeout(y,20)};me(window,"mouseup",m)}else setTimeout(y,50)}function g(){if(null!=n.selectionStart){var e=i.somethingSelected(),o="​"+(e?n.value:"");n.value="⇚",n.value=o,t.prevInput=e?"":"​",n.selectionStart=1,n.selectionEnd=o.length,r.selForContextMenu=i.doc.sel}}function y(){if(t.contextMenuPending==y&&(t.contextMenuPending=!1,t.wrapper.style.cssText=p,n.style.cssText=h,s&&a<9&&r.scrollbars.setScrollTop(r.scroller.scrollTop=c),null!=n.selectionStart)){(!s||s&&a<9)&&g();var e=0,o=function(){r.selForContextMenu==i.doc.sel&&0==n.selectionStart&&n.selectionEnd>0&&"​"==t.prevInput?Ln(i,Yo)(i):e++<10?r.detectingSelectAll=setTimeout(o,500):(r.selForContextMenu=null,r.input.reset())};r.detectingSelectAll=setTimeout(o,200)}}},sl.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e},sl.prototype.setUneditable=function(){},sl.prototype.needsContentAttribute=!1,Ra(Fa),Ka(Fa);var cl="iter insert remove copy getEditor constructor".split(" ");for(var ul in Ss.prototype)Ss.prototype.hasOwnProperty(ul)&&N(cl,ul)<0&&(Fa.prototype[ul]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ss.prototype[ul]));return we(Ss),Fa.inputStyles={textarea:sl,contenteditable:Qa},Fa.defineMode=function(e){Fa.defaults.mode||"null"==e||(Fa.defaults.mode=e),Ue.apply(this,arguments)},Fa.defineMIME=Ve,Fa.defineMode("null",(function(){return{token:function(e){return e.skipToEnd()}}})),Fa.defineMIME("text/plain","null"),Fa.defineExtension=function(e,t){Fa.prototype[e]=t},Fa.defineDocExtension=function(e,t){Ss.prototype[e]=t},Fa.fromTextArea=al,ll(Fa),Fa.version="5.65.5",Fa}());let Kl=navigator.userAgent,Yl=navigator.platform,Jl=/gecko\/\d/i.test(Kl),Ql=/MSIE \d/.test(Kl),ec=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Kl),tc=/Edge\/(\d+)/.exec(Kl),ic=Ql||ec||tc,rc=ic&&(Ql?document.documentMode||6:+(tc||ec)[1]),nc=!tc&&/WebKit\//.test(Kl),oc=nc&&/Qt\/\d+\.\d+/.test(Kl),sc=!tc&&/Chrome\/(\d+)/.exec(Kl),ac=sc&&+sc[1],lc=/Opera\//.test(Kl),cc=/Apple Computer/.test(navigator.vendor),uc=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(Kl),hc=/PhantomJS/.test(Kl),dc=cc&&(/Mobile\/\w+/.test(Kl)||navigator.maxTouchPoints>2),pc=/Android/.test(Kl),fc=dc||pc||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(Kl),mc=dc||/Mac/.test(Yl),gc=/\bCrOS\b/.test(Kl),yc=/win/i.test(Yl),_c=lc&&Kl.match(/Version\/(\d*\.\d*)/);_c&&(_c=Number(_c[1])),_c&&_c>=15&&(lc=!1,nc=!0);let vc=mc&&(oc||lc&&(null==_c||_c<12.11)),xc=Jl||ic&&rc>=9;function bc(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}let wc,Tc=function(e,t){let i=e.className,r=bc(t).exec(i);if(r){let t=i.slice(r.index+r[0].length);e.className=i.slice(0,r.index)+(t?r[1]+t:"")}};function Sc(e){for(let t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function Cc(e,t){return Sc(e).appendChild(t)}function Mc(e,t,i,r){let n=document.createElement(e);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(let e=0;e<t.length;++e)n.appendChild(t[e]);return n}function kc(e,t,i,r){let n=Mc(e,t,i,r);return n.setAttribute("role","presentation"),n}function Ec(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function Ac(){let e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function Ic(e,t){let i=e.className;bc(t).test(i)||(e.className+=(i?" ":"")+t)}function zc(e,t){let i=e.split(" ");for(let e=0;e<i.length;e++)i[e]&&!bc(i[e]).test(t)&&(t+=" "+i[e]);return t}wc=document.createRange?function(e,t,i,r){let n=document.createRange();return n.setEnd(r||e,i),n.setStart(e,t),n}:function(e,t,i){let r=document.body.createTextRange();try{r.moveToElementText(e.parentNode)}catch(e){return r}return r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",t),r};let Pc=function(e){e.select()};function Lc(e){let t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function Dc(e,t,i){t||(t={});for(let r in e)!e.hasOwnProperty(r)||!1===i&&t.hasOwnProperty(r)||(t[r]=e[r]);return t}function Rc(e,t,i,r,n){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(let o=r||0,s=n||0;;){let r=e.indexOf("\t",o);if(r<0||r>=t)return s+(t-o);s+=r-o,s+=i-s%i,o=r+1}}dc?Pc=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:ic&&(Pc=function(e){try{e.select()}catch(e){}});class Bc{constructor(){this.id=null,this.f=null,this.time=0,this.handler=Lc(this.onTimeout,this)}onTimeout(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)}set(e,t){this.f=t;const i=+new Date+e;(!this.id||i<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=i)}}function Oc(e,t){for(let i=0;i<e.length;++i)if(e[i]==t)return i;return-1}let Fc={toString:function(){return"CodeMirror.Pass"}},jc={scroll:!1},$c={origin:"*mouse"},Nc={origin:"+move"};function Uc(e,t,i){for(let r=0,n=0;;){let o=e.indexOf("\t",r);-1==o&&(o=e.length);let s=o-r;if(o==e.length||n+s>=t)return r+Math.min(s,t-n);if(n+=o-r,n+=i-n%i,r=o+1,n>=t)return r}}let Vc=[""];function Gc(e){for(;Vc.length<=e;)Vc.push(qc(Vc)+" ");return Vc[e]}function qc(e){return e[e.length-1]}function Zc(e,t){let i=[];for(let r=0;r<e.length;r++)i[r]=t(e[r],r);return i}function Wc(){}function Hc(e,t){let i;return Object.create?i=Object.create(e):(Wc.prototype=e,i=new Wc),t&&Dc(t,i),i}let Xc=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Kc(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Xc.test(e))}function Yc(e,t){return t?!!(t.source.indexOf("\\w")>-1&&Kc(e))||t.test(e):Kc(e)}function Jc(e){for(let t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}let Qc=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function eu(e){return e.charCodeAt(0)>=768&&Qc.test(e)}function tu(e,t,i){for(;(i<0?t>0:t<e.length)&&eu(e.charAt(t));)t+=i;return t}function iu(e,t,i){let r=t>i?-1:1;for(;;){if(t==i)return t;let n=(t+i)/2,o=r<0?Math.ceil(n):Math.floor(n);if(o==t)return e(o)?t:i;e(o)?i=o:t=o+r}}let ru=null;function nu(e,t,i){let r;ru=null;for(let n=0;n<e.length;++n){let o=e[n];if(o.from<t&&o.to>t)return n;o.to==t&&(o.from!=o.to&&"before"==i?r=n:ru=n),o.from==t&&(o.from!=o.to&&"before"!=i?r=n:ru=n)}return null!=r?r:ru}let ou=function(){let e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,t=/[stwN]/,i=/[LRr]/,r=/[Lb1n]/,n=/[1n]/;function o(e,t,i){this.level=e,this.from=t,this.to=i}return function(s,a){let l="ltr"==a?"L":"R";if(0==s.length||"ltr"==a&&!e.test(s))return!1;let c=s.length,u=[];for(let e=0;e<c;++e)u.push((h=s.charCodeAt(e))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(h):1424<=h&&h<=1524?"R":1536<=h&&h<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(h-1536):1774<=h&&h<=2220?"r":8192<=h&&h<=8203?"w":8204==h?"b":"L");var h;for(let e=0,t=l;e<c;++e){let i=u[e];"m"==i?u[e]=t:t=i}for(let e=0,t=l;e<c;++e){let r=u[e];"1"==r&&"r"==t?u[e]="n":i.test(r)&&(t=r,"r"==r&&(u[e]="R"))}for(let e=1,t=u[0];e<c-1;++e){let i=u[e];"+"==i&&"1"==t&&"1"==u[e+1]?u[e]="1":","!=i||t!=u[e+1]||"1"!=t&&"n"!=t||(u[e]=t),t=i}for(let e=0;e<c;++e){let t=u[e];if(","==t)u[e]="N";else if("%"==t){let t;for(t=e+1;t<c&&"%"==u[t];++t);let i=e&&"!"==u[e-1]||t<c&&"1"==u[t]?"1":"N";for(let r=e;r<t;++r)u[r]=i;e=t-1}}for(let e=0,t=l;e<c;++e){let r=u[e];"L"==t&&"1"==r?u[e]="L":i.test(r)&&(t=r)}for(let e=0;e<c;++e)if(t.test(u[e])){let i;for(i=e+1;i<c&&t.test(u[i]);++i);let r="L"==(e?u[e-1]:l),n=r==("L"==(i<c?u[i]:l))?r?"L":"R":l;for(let t=e;t<i;++t)u[t]=n;e=i-1}let d,p=[];for(let e=0;e<c;)if(r.test(u[e])){let t=e;for(++e;e<c&&r.test(u[e]);++e);p.push(new o(0,t,e))}else{let t=e,i=p.length,r="rtl"==a?1:0;for(++e;e<c&&"L"!=u[e];++e);for(let s=t;s<e;)if(n.test(u[s])){t<s&&(p.splice(i,0,new o(1,t,s)),i+=r);let a=s;for(++s;s<e&&n.test(u[s]);++s);p.splice(i,0,new o(2,a,s)),i+=r,t=s}else++s;t<e&&p.splice(i,0,new o(1,t,e))}return"ltr"==a&&(1==p[0].level&&(d=s.match(/^\s+/))&&(p[0].from=d[0].length,p.unshift(new o(0,0,d[0].length))),1==qc(p).level&&(d=s.match(/\s+$/))&&(qc(p).to-=d[0].length,p.push(new o(0,c-d[0].length,c)))),"rtl"==a?p.reverse():p}}();function su(e,t){let i=e.order;return null==i&&(i=e.order=ou(e.text,t)),i}const au=[];let lu=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{let r=e._handlers||(e._handlers={});r[t]=(r[t]||au).concat(i)}};function cu(e,t){return e._handlers&&e._handlers[t]||au}function uu(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{let r=e._handlers,n=r&&r[t];if(n){let e=Oc(n,i);e>-1&&(r[t]=n.slice(0,e).concat(n.slice(e+1)))}}}function hu(e,t){let i=cu(e,t);if(!i.length)return;let r=Array.prototype.slice.call(arguments,2);for(let e=0;e<i.length;++e)i[e].apply(null,r)}function du(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),hu(e,i||t.type,e,t),_u(t)||t.codemirrorIgnore}function pu(e){let t=e._handlers&&e._handlers.cursorActivity;if(!t)return;let i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]);for(let e=0;e<t.length;++e)-1==Oc(i,t[e])&&i.push(t[e])}function fu(e,t){return cu(e,t).length>0}function mu(e){e.prototype.on=function(e,t){lu(this,e,t)},e.prototype.off=function(e,t){uu(this,e,t)}}function gu(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function yu(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function _u(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function vu(e){gu(e),yu(e)}function xu(e){return e.target||e.srcElement}function bu(e){let t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),mc&&e.ctrlKey&&1==t&&(t=3),t}let wu,Tu,Su=function(){if(ic&&rc<9)return!1;let e=Mc("div");return"draggable"in e||"dragDrop"in e}();function Cu(e){if(null==wu){let t=Mc("span","​");Cc(e,Mc("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(wu=t.offsetWidth<=1&&t.offsetHeight>2&&!(ic&&rc<8))}let t=wu?Mc("span","​"):Mc("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return t.setAttribute("cm-text",""),t}function Mu(e){if(null!=Tu)return Tu;let t=Cc(e,document.createTextNode("AخA")),i=wc(t,0,1).getBoundingClientRect(),r=wc(t,1,2).getBoundingClientRect();return Sc(e),!(!i||i.left==i.right)&&(Tu=r.right-i.right<3)}let ku=3!="\n\nb".split(/\n/).length?e=>{let t=0,i=[],r=e.length;for(;t<=r;){let r=e.indexOf("\n",t);-1==r&&(r=e.length);let n=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),o=n.indexOf("\r");-1!=o?(i.push(n.slice(0,o)),t+=o+1):(i.push(n),t=r+1)}return i}:e=>e.split(/\r\n?|\n/),Eu=window.getSelection?e=>{try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:e=>{let t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Au=(()=>{let e=Mc("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)})(),Iu=null;let zu={},Pu={};function Lu(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),zu[e]=t}function Du(e){if("string"==typeof e&&Pu.hasOwnProperty(e))e=Pu[e];else if(e&&"string"==typeof e.name&&Pu.hasOwnProperty(e.name)){let t=Pu[e.name];"string"==typeof t&&(t={name:t}),(e=Hc(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Du("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Du("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ru(e,t){t=Du(t);let i=zu[t.name];if(!i)return Ru(e,"text/plain");let r=i(e,t);if(Bu.hasOwnProperty(t.name)){let e=Bu[t.name];for(let t in e)e.hasOwnProperty(t)&&(r.hasOwnProperty(t)&&(r["_"+t]=r[t]),r[t]=e[t])}if(r.name=t.name,t.helperType&&(r.helperType=t.helperType),t.modeProps)for(let e in t.modeProps)r[e]=t.modeProps[e];return r}let Bu={};function Ou(e,t){Dc(t,Bu.hasOwnProperty(e)?Bu[e]:Bu[e]={})}function Fu(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);let i={};for(let e in t){let r=t[e];r instanceof Array&&(r=r.concat([])),i[e]=r}return i}function ju(e,t){let i;for(;e.innerMode&&(i=e.innerMode(t),i&&i.mode!=e);)t=i.state,e=i.mode;return i||{mode:e,state:t}}function $u(e,t,i){return!e.startState||e.startState(t,i)}class Nu{constructor(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i}eol(){return this.pos>=this.string.length}sol(){return this.pos==this.lineStart}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let t,i=this.string.charAt(this.pos);if(t="string"==typeof e?i==e:i&&(e.test?e.test(i):e(i)),t)return++this.pos,i}eatWhile(e){let t=this.pos;for(;this.eat(e););return this.pos>t}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Rc(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Rc(this.string,this.lineStart,this.tabSize):0)}indentation(){return Rc(this.string,null,this.tabSize)-(this.lineStart?Rc(this.string,this.lineStart,this.tabSize):0)}match(e,t,i){if("string"!=typeof e){let i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}{let r=e=>i?e.toLowerCase():e;if(r(this.string.substr(this.pos,e.length))==r(e))return!1!==t&&(this.pos+=e.length),!0}}current(){return this.string.slice(this.start,this.pos)}hideFirstChars(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}lookAhead(e){let t=this.lineOracle;return t&&t.lookAhead(e)}baseToken(){let e=this.lineOracle;return e&&e.baseToken(this.pos)}}function Uu(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");let i=e;for(;!i.lines;)for(let e=0;;++e){let r=i.children[e],n=r.chunkSize();if(t<n){i=r;break}t-=n}return i.lines[t]}function Vu(e,t,i){let r=[],n=t.line;return e.iter(t.line,i.line+1,(e=>{let o=e.text;n==i.line&&(o=o.slice(0,i.ch)),n==t.line&&(o=o.slice(t.ch)),r.push(o),++n})),r}function Gu(e,t,i){let r=[];return e.iter(t,i,(e=>{r.push(e.text)})),r}function qu(e,t){let i=t-e.height;if(i)for(let t=e;t;t=t.parent)t.height+=i}function Zu(e){if(null==e.parent)return null;let t=e.parent,i=Oc(t.lines,e);for(let e=t.parent;e;t=e,e=e.parent)for(let r=0;e.children[r]!=t;++r)i+=e.children[r].chunkSize();return i+t.first}function Wu(e,t){let i=e.first;e:do{for(let r=0;r<e.children.length;++r){let n=e.children[r],o=n.height;if(t<o){e=n;continue e}t-=o,i+=n.chunkSize()}return i}while(!e.lines);let r=0;for(;r<e.lines.length;++r){let i=e.lines[r].height;if(t<i)break;t-=i}return i+r}function Hu(e,t){return t>=e.first&&t<e.first+e.size}function Xu(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function Ku(e,t,i=null){if(!(this instanceof Ku))return new Ku(e,t,i);this.line=e,this.ch=t,this.sticky=i}function Yu(e,t){return e.line-t.line||e.ch-t.ch}function Ju(e,t){return e.sticky==t.sticky&&0==Yu(e,t)}function Qu(e){return Ku(e.line,e.ch)}function eh(e,t){return Yu(e,t)<0?t:e}function th(e,t){return Yu(e,t)<0?e:t}function ih(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function rh(e,t){if(t.line<e.first)return Ku(e.first,0);let i=e.first+e.size-1;return t.line>i?Ku(i,Uu(e,i).text.length):function(e,t){let i=e.ch;return null==i||i>t?Ku(e.line,t):i<0?Ku(e.line,0):e}(t,Uu(e,t.line).text.length)}function nh(e,t){let i=[];for(let r=0;r<t.length;r++)i[r]=rh(e,t[r]);return i}class oh{constructor(e,t){this.state=e,this.lookAhead=t}}class sh{constructor(e,t,i,r){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=r||0,this.baseTokens=null,this.baseTokenPos=1}lookAhead(e){let t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t}baseToken(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;let t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}}nextLine(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--}static fromSaved(e,t,i){return t instanceof oh?new sh(e,Fu(e.mode,t.state),i,t.lookAhead):new sh(e,Fu(e.mode,t),i)}save(e){let t=!1!==e?Fu(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new oh(t,this.maxLookAhead):t}}function ah(e,t,i,r){let n=[e.state.modeGen],o={};gh(e,t.text,e.doc.mode,i,((e,t)=>n.push(e,t)),o,r);let s=i.state;for(let r=0;r<e.state.overlays.length;++r){i.baseTokens=n;let a=e.state.overlays[r],l=1,c=0;i.state=!0,gh(e,t.text,a.mode,i,((e,t)=>{let i=l;for(;c<e;){let t=n[l];t>e&&n.splice(l,1,e,n[l+1],t),l+=2,c=Math.min(e,t)}if(t)if(a.opaque)n.splice(i,l-i,e,"overlay "+t),l=i+2;else for(;i<l;i+=2){let e=n[i+1];n[i+1]=(e?e+" ":"")+"overlay "+t}}),o),i.state=s,i.baseTokens=null,i.baseTokenPos=1}return{styles:n,classes:o.bgClass||o.textClass?o:null}}function lh(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){let r=ch(e,Zu(t)),n=t.text.length>e.options.maxHighlightLength&&Fu(e.doc.mode,r.state),o=ah(e,t,r);n&&(r.state=n),t.stateAfter=r.save(!n),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function ch(e,t,i){let r=e.doc,n=e.display;if(!r.mode.startState)return new sh(r,!0,t);let o=function(e,t,i){let r,n,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100);for(let a=t;a>s;--a){if(a<=o.first)return o.first;let t=Uu(o,a-1),s=t.stateAfter;if(s&&(!i||a+(s instanceof oh?s.lookAhead:0)<=o.modeFrontier))return a;let l=Rc(t.text,null,e.options.tabSize);(null==n||r>l)&&(n=a-1,r=l)}return n}(e,t,i),s=o>r.first&&Uu(r,o-1).stateAfter,a=s?sh.fromSaved(r,s,o):new sh(r,$u(r.mode),o);return r.iter(o,t,(i=>{uh(e,i.text,a);let r=a.line;i.stateAfter=r==t-1||r%5==0||r>=n.viewFrom&&r<n.viewTo?a.save():null,a.nextLine()})),i&&(r.modeFrontier=a.line),a}function uh(e,t,i,r){let n=e.doc.mode,o=new Nu(t,e.options.tabSize,i);for(o.start=o.pos=r||0,""==t&&hh(n,i.state);!o.eol();)dh(n,o,i.state),o.start=o.pos}function hh(e,t){if(e.blankLine)return e.blankLine(t);if(!e.innerMode)return;let i=ju(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}function dh(e,t,i,r){for(let n=0;n<10;n++){r&&(r[0]=ju(e,i).mode);let n=e.token(t,i);if(t.pos>t.start)return n}throw new Error("Mode "+e.name+" failed to advance stream.")}class ph{constructor(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i}}function fh(e,t,i,r){let n,o,s=e.doc,a=s.mode,l=Uu(s,(t=rh(s,t)).line),c=ch(e,t.line,i),u=new Nu(l.text,e.options.tabSize,c);for(r&&(o=[]);(r||u.pos<t.ch)&&!u.eol();)u.start=u.pos,n=dh(a,u,c.state),r&&o.push(new ph(u,n,Fu(s.mode,c.state)));return r?o:new ph(u,n,c.state)}function mh(e,t){if(e)for(;;){let i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);let r=i[1]?"bgClass":"textClass";null==t[r]?t[r]=i[2]:new RegExp("(?:^|\\s)"+i[2]+"(?:$|\\s)").test(t[r])||(t[r]+=" "+i[2])}return e}function gh(e,t,i,r,n,o,s){let a=i.flattenSpans;null==a&&(a=e.options.flattenSpans);let l,c=0,u=null,h=new Nu(t,e.options.tabSize,r),d=e.options.addModeClass&&[null];for(""==t&&mh(hh(i,r.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(a=!1,s&&uh(e,t,r,h.pos),h.pos=t.length,l=null):l=mh(dh(i,h,r.state,d),o),d){let e=d[0].name;e&&(l="m-"+(l?e+" "+l:e))}if(!a||u!=l){for(;c<h.start;)c=Math.min(h.start,c+5e3),n(c,u);u=l}h.start=h.pos}for(;c<h.pos;){let e=Math.min(h.pos,c+5e3);n(e,u),c=e}}let yh=!1,_h=!1;function vh(e,t,i){this.marker=e,this.from=t,this.to=i}function xh(e,t){if(e)for(let i=0;i<e.length;++i){let r=e[i];if(r.marker==t)return r}}function bh(e,t){let i;for(let r=0;r<e.length;++r)e[r]!=t&&(i||(i=[])).push(e[r]);return i}function wh(e,t){if(t.full)return null;let i=Hu(e,t.from.line)&&Uu(e,t.from.line).markedSpans,r=Hu(e,t.to.line)&&Uu(e,t.to.line).markedSpans;if(!i&&!r)return null;let n=t.from.ch,o=t.to.ch,s=0==Yu(t.from,t.to),a=function(e,t,i){let r;if(e)for(let n=0;n<e.length;++n){let o=e[n],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){let e=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(r||(r=[])).push(new vh(s,o.from,e?null:o.to))}}return r}(i,n,s),l=function(e,t,i){let r;if(e)for(let n=0;n<e.length;++n){let o=e[n],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){let e=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(r||(r=[])).push(new vh(s,e?null:o.from-t,null==o.to?null:o.to-t))}}return r}(r,o,s),c=1==t.text.length,u=qc(t.text).length+(c?n:0);if(a)for(let e=0;e<a.length;++e){let t=a[e];if(null==t.to){let e=xh(l,t.marker);e?c&&(t.to=null==e.to?null:e.to+u):t.to=n}}if(l)for(let e=0;e<l.length;++e){let t=l[e];if(null!=t.to&&(t.to+=u),null==t.from){xh(a,t.marker)||(t.from=u,c&&(a||(a=[])).push(t))}else t.from+=u,c&&(a||(a=[])).push(t)}a&&(a=Th(a)),l&&l!=a&&(l=Th(l));let h=[a];if(!c){let e,i=t.text.length-2;if(i>0&&a)for(let t=0;t<a.length;++t)null==a[t].to&&(e||(e=[])).push(new vh(a[t].marker,null,null));for(let t=0;t<i;++t)h.push(e);h.push(l)}return h}function Th(e){for(let t=0;t<e.length;++t){let i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function Sh(e){let t=e.markedSpans;if(t){for(let i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function Ch(e,t){if(t){for(let i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function Mh(e){return e.inclusiveLeft?-1:0}function kh(e){return e.inclusiveRight?1:0}function Eh(e,t){let i=e.lines.length-t.lines.length;if(0!=i)return i;let r=e.find(),n=t.find(),o=Yu(r.from,n.from)||Mh(e)-Mh(t);if(o)return-o;let s=Yu(r.to,n.to)||kh(e)-kh(t);return s||t.id-e.id}function Ah(e,t){let i,r=_h&&e.markedSpans;if(r)for(let e,n=0;n<r.length;++n)e=r[n],e.marker.collapsed&&null==(t?e.from:e.to)&&(!i||Eh(i,e.marker)<0)&&(i=e.marker);return i}function Ih(e){return Ah(e,!0)}function zh(e){return Ah(e,!1)}function Ph(e,t){let i,r=_h&&e.markedSpans;if(r)for(let e=0;e<r.length;++e){let n=r[e];n.marker.collapsed&&(null==n.from||n.from<t)&&(null==n.to||n.to>t)&&(!i||Eh(i,n.marker)<0)&&(i=n.marker)}return i}function Lh(e,t,i,r,n){let o=Uu(e,t),s=_h&&o.markedSpans;if(s)for(let e=0;e<s.length;++e){let t=s[e];if(!t.marker.collapsed)continue;let o=t.marker.find(0),a=Yu(o.from,i)||Mh(t.marker)-Mh(n),l=Yu(o.to,r)||kh(t.marker)-kh(n);if(!(a>=0&&l<=0||a<=0&&l>=0)&&(a<=0&&(t.marker.inclusiveRight&&n.inclusiveLeft?Yu(o.to,i)>=0:Yu(o.to,i)>0)||a>=0&&(t.marker.inclusiveRight&&n.inclusiveLeft?Yu(o.from,r)<=0:Yu(o.from,r)<0)))return!0}}function Dh(e){let t;for(;t=Ih(e);)e=t.find(-1,!0).line;return e}function Rh(e,t){let i=Uu(e,t),r=Dh(i);return i==r?t:Zu(r)}function Bh(e,t){if(t>e.lastLine())return t;let i,r=Uu(e,t);if(!Oh(e,r))return t;for(;i=zh(r);)r=i.find(1,!0).line;return Zu(r)+1}function Oh(e,t){let i=_h&&t.markedSpans;if(i)for(let r,n=0;n<i.length;++n)if(r=i[n],r.marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&Fh(e,t,r))return!0}}function Fh(e,t,i){if(null==i.to){let t=i.marker.find(1,!0);return Fh(e,t.line,xh(t.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(let r,n=0;n<t.markedSpans.length;++n)if(r=t.markedSpans[n],r.marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&Fh(e,t,r))return!0}function jh(e){let t=0,i=(e=Dh(e)).parent;for(let r=0;r<i.lines.length;++r){let n=i.lines[r];if(n==e)break;t+=n.height}for(let e=i.parent;e;i=e,e=i.parent)for(let r=0;r<e.children.length;++r){let n=e.children[r];if(n==i)break;t+=n.height}return t}function $h(e){if(0==e.height)return 0;let t,i=e.text.length,r=e;for(;t=Ih(r);){let e=t.find(0,!0);r=e.from.line,i+=e.from.ch-e.to.ch}for(r=e;t=zh(r);){let e=t.find(0,!0);i-=r.text.length-e.from.ch,r=e.to.line,i+=r.text.length-e.to.ch}return i}function Nh(e){let t=e.display,i=e.doc;t.maxLine=Uu(i,i.first),t.maxLineLength=$h(t.maxLine),t.maxLineChanged=!0,i.iter((e=>{let i=$h(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)}))}class Uh{constructor(e,t,i){this.text=e,Ch(this,t),this.height=i?i(this):1}lineNo(){return Zu(this)}}function Vh(e){e.parent=null,Sh(e)}mu(Uh);let Gh={},qh={};function Zh(e,t){if(!e||/^\s*$/.test(e))return null;let i=t.addModeClass?qh:Gh;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function Wh(e,t){let i=kc("span",null,null,nc?"padding-right: .1px":null),r={pre:kc("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(let i=0;i<=(t.rest?t.rest.length:0);i++){let n,o=i?t.rest[i-1]:t.line;r.pos=0,r.addToken=Xh,Mu(e.display.measure)&&(n=su(o,e.doc.direction))&&(r.addToken=Kh(r.addToken,n)),r.map=[],Jh(o,r,lh(e,o,t!=e.display.externalMeasured&&Zu(o))),o.styleClasses&&(o.styleClasses.bgClass&&(r.bgClass=zc(o.styleClasses.bgClass,r.bgClass||"")),o.styleClasses.textClass&&(r.textClass=zc(o.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(Cu(e.display.measure))),0==i?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(nc){let e=r.content.lastChild;(/\bcm-tab\b/.test(e.className)||e.querySelector&&e.querySelector(".cm-tab"))&&(r.content.className="cm-tab-wrap-hack")}return hu(e,"renderLine",e,t.line,r.pre),r.pre.className&&(r.textClass=zc(r.pre.className,r.textClass||"")),r}function Hh(e){let t=Mc("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function Xh(e,t,i,r,n,o,s){if(!t)return;let a,l=e.splitSpaces?function(e,t){if(e.length>1&&!/  /.test(e))return e;let i=t,r="";for(let t=0;t<e.length;t++){let n=e.charAt(t);" "!=n||!i||t!=e.length-1&&32!=e.charCodeAt(t+1)||(n=" "),r+=n,i=" "==n}return r}(t,e.trailingSpace):t,c=e.cm.state.specialChars,u=!1;if(c.test(t)){a=document.createDocumentFragment();let i=0;for(;;){c.lastIndex=i;let r,n=c.exec(t),o=n?n.index-i:t.length-i;if(o){let t=document.createTextNode(l.slice(i,i+o));ic&&rc<9?a.appendChild(Mc("span",[t])):a.appendChild(t),e.map.push(e.pos,e.pos+o,t),e.col+=o,e.pos+=o}if(!n)break;if(i+=o+1,"\t"==n[0]){let t=e.cm.options.tabSize,i=t-e.col%t;r=a.appendChild(Mc("span",Gc(i),"cm-tab")),r.setAttribute("role","presentation"),r.setAttribute("cm-text","\t"),e.col+=i}else"\r"==n[0]||"\n"==n[0]?(r=a.appendChild(Mc("span","\r"==n[0]?"␍":"␤","cm-invalidchar")),r.setAttribute("cm-text",n[0]),e.col+=1):(r=e.cm.options.specialCharPlaceholder(n[0]),r.setAttribute("cm-text",n[0]),ic&&rc<9?a.appendChild(Mc("span",[r])):a.appendChild(r),e.col+=1);e.map.push(e.pos,e.pos+1,r),e.pos++}}else e.col+=t.length,a=document.createTextNode(l),e.map.push(e.pos,e.pos+t.length,a),ic&&rc<9&&(u=!0),e.pos+=t.length;if(e.trailingSpace=32==l.charCodeAt(t.length-1),i||r||n||u||o||s){let t=i||"";r&&(t+=r),n&&(t+=n);let l=Mc("span",[a],t,o);if(s)for(let e in s)s.hasOwnProperty(e)&&"style"!=e&&"class"!=e&&l.setAttribute(e,s[e]);return e.content.appendChild(l)}e.content.appendChild(a)}function Kh(e,t){return(i,r,n,o,s,a,l)=>{n=n?n+" cm-force-border":"cm-force-border";let c=i.pos,u=c+r.length;for(;;){let h;for(let e=0;e<t.length&&(h=t[e],!(h.to>c&&h.from<=c));e++);if(h.to>=u)return e(i,r,n,o,s,a,l);e(i,r.slice(0,h.to-c),n,o,null,a,l),o=null,r=r.slice(h.to-c),c=h.to}}}function Yh(e,t,i,r){let n=!r&&i.widgetNode;n&&e.map.push(e.pos,e.pos+t,n),!r&&e.cm.display.input.needsContentAttribute&&(n||(n=e.content.appendChild(document.createElement("span"))),n.setAttribute("cm-marker",i.id)),n&&(e.cm.display.input.setUneditable(n),e.content.appendChild(n)),e.pos+=t,e.trailingSpace=!1}function Jh(e,t,i){let r=e.markedSpans,n=e.text,o=0;if(!r){for(let e=1;e<i.length;e+=2)t.addToken(t,n.slice(o,o=i[e]),Zh(i[e+1],t.cm.options));return}let s,a,l,c,u,h,d,p=n.length,f=0,m=1,g="",y=0;for(;;){if(y==f){l=c=u=a="",d=null,h=null,y=1/0;let e,i=[];for(let t=0;t<r.length;++t){let n=r[t],o=n.marker;if("bookmark"==o.type&&n.from==f&&o.widgetNode)i.push(o);else if(n.from<=f&&(null==n.to||n.to>f||o.collapsed&&n.to==f&&n.from==f)){if(null!=n.to&&n.to!=f&&y>n.to&&(y=n.to,c=""),o.className&&(l+=" "+o.className),o.css&&(a=(a?a+";":"")+o.css),o.startStyle&&n.from==f&&(u+=" "+o.startStyle),o.endStyle&&n.to==y&&(e||(e=[])).push(o.endStyle,n.to),o.title&&((d||(d={})).title=o.title),o.attributes)for(let e in o.attributes)(d||(d={}))[e]=o.attributes[e];o.collapsed&&(!h||Eh(h.marker,o)<0)&&(h=n)}else n.from>f&&y>n.from&&(y=n.from)}if(e)for(let t=0;t<e.length;t+=2)e[t+1]==y&&(c+=" "+e[t]);if(!h||h.from==f)for(let e=0;e<i.length;++e)Yh(t,0,i[e]);if(h&&(h.from||0)==f){if(Yh(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(f>=p)break;let e=Math.min(p,y);for(;;){if(g){let i=f+g.length;if(!h){let r=i>e?g.slice(0,e-f):g;t.addToken(t,r,s?s+l:l,u,f+r.length==y?c:"",a,d)}if(i>=e){g=g.slice(e-f),f=e;break}f=i,u=""}g=n.slice(o,o=i[m++]),s=Zh(i[m++],t.cm.options)}}}function Qh(e,t,i){this.line=t,this.rest=function(e){let t,i;for(;t=zh(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}(t),this.size=this.rest?Zu(qc(this.rest))-i+1:1,this.node=this.text=null,this.hidden=Oh(e,t)}function ed(e,t,i){let r,n=[];for(let o=t;o<i;o=r){let t=new Qh(e.doc,Uu(e.doc,o),o);r=o+t.size,n.push(t)}return n}let td=null;let id=null;function rd(e,t){let i=cu(e,t);if(!i.length)return;let r,n=Array.prototype.slice.call(arguments,2);td?r=td.delayedCallbacks:id?r=id:(r=id=[],setTimeout(nd,0));for(let e=0;e<i.length;++e)r.push((()=>i[e].apply(null,n)))}function nd(){let e=id;id=null;for(let t=0;t<e.length;++t)e[t]()}function od(e,t,i,r){for(let n=0;n<t.changes.length;n++){let o=t.changes[n];"text"==o?ld(e,t):"gutter"==o?ud(e,t,i,r):"class"==o?cd(e,t):"widget"==o&&hd(e,t,r)}t.changes=null}function sd(e){return e.node==e.text&&(e.node=Mc("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),ic&&rc<8&&(e.node.style.zIndex=2)),e.node}function ad(e,t){let i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):Wh(e,t)}function ld(e,t){let i=t.text.className,r=ad(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,cd(e,t)):i&&(t.text.className=i)}function cd(e,t){!function(e,t){let i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){let r=sd(t);t.background=r.insertBefore(Mc("div",null,i),r.firstChild),e.display.input.setUneditable(t.background)}}(e,t),t.line.wrapClass?sd(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");let i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function ud(e,t,i,r){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){let i=sd(t);t.gutterBackground=Mc("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,`left: ${e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth}px; width: ${r.gutterTotalWidth}px`),e.display.input.setUneditable(t.gutterBackground),i.insertBefore(t.gutterBackground,t.text)}let n=t.line.gutterMarkers;if(e.options.lineNumbers||n){let o=sd(t),s=t.gutter=Mc("div",null,"CodeMirror-gutter-wrapper",`left: ${e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth}px`);if(s.setAttribute("aria-hidden","true"),e.display.input.setUneditable(s),o.insertBefore(s,t.text),t.line.gutterClass&&(s.className+=" "+t.line.gutterClass),!e.options.lineNumbers||n&&n["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(Mc("div",Xu(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt",`left: ${r.gutterLeft["CodeMirror-linenumbers"]}px; width: ${e.display.lineNumInnerWidth}px`))),n)for(let t=0;t<e.display.gutterSpecs.length;++t){let i=e.display.gutterSpecs[t].className,o=n.hasOwnProperty(i)&&n[i];o&&s.appendChild(Mc("div",[o],"CodeMirror-gutter-elt",`left: ${r.gutterLeft[i]}px; width: ${r.gutterWidth[i]}px`))}}}function hd(e,t,i){t.alignable&&(t.alignable=null);let r=bc("CodeMirror-linewidget");for(let e,i=t.node.firstChild;i;i=e)e=i.nextSibling,r.test(i.className)&&t.node.removeChild(i);pd(e,t,i)}function dd(e,t,i,r){let n=ad(e,t);return t.text=t.node=n.pre,n.bgClass&&(t.bgClass=n.bgClass),n.textClass&&(t.textClass=n.textClass),cd(e,t),ud(e,t,i,r),pd(e,t,r),t.node}function pd(e,t,i){if(fd(e,t.line,t,i,!0),t.rest)for(let r=0;r<t.rest.length;r++)fd(e,t.rest[r],t,i,!1)}function fd(e,t,i,r,n){if(!t.widgets)return;let o=sd(i);for(let s=0,a=t.widgets;s<a.length;++s){let t=a[s],l=Mc("div",[t.node],"CodeMirror-linewidget"+(t.className?" "+t.className:""));t.handleMouseEvents||l.setAttribute("cm-ignore-events","true"),md(t,l,i,r),e.display.input.setUneditable(l),n&&t.above?o.insertBefore(l,i.gutter||i.text):o.appendChild(l),rd(t,"redraw")}}function md(e,t,i,r){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);let n=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(n-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=n+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function gd(e){if(null!=e.height)return e.height;let t=e.doc.cm;if(!t)return 0;if(!Ec(document.body,e.node)){let i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),Cc(t.display.measure,Mc("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function yd(e,t){for(let i=xu(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function _d(e){return e.lineSpace.offsetTop}function vd(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function xd(e){if(e.cachedPaddingH)return e.cachedPaddingH;let t=Cc(e.measure,Mc("pre","x","CodeMirror-line-like")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,r={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(e.cachedPaddingH=r),r}function bd(e){return 50-e.display.nativeBarWidth}function wd(e){return e.display.scroller.clientWidth-bd(e)-e.display.barWidth}function Td(e){return e.display.scroller.clientHeight-bd(e)-e.display.barHeight}function Sd(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(let i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(let t=0;t<e.rest.length;t++)if(Zu(e.rest[t])>i)return{map:e.measure.maps[t],cache:e.measure.caches[t],before:!0}}}function Cd(e,t,i,r){return Ed(e,kd(e,t),i,r)}function Md(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[op(e,t)];let i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function kd(e,t){let i=Zu(t),r=Md(e,i);r&&!r.text?r=null:r&&r.changes&&(od(e,r,i,ep(e)),e.curOp.forceUpdate=!0),r||(r=function(e,t){let i=Zu(t=Dh(t)),r=e.display.externalMeasured=new Qh(e.doc,t,i);r.lineN=i;let n=r.built=Wh(e,r);return r.text=n.pre,Cc(e.display.lineMeasure,n.pre),r}(e,t));let n=Sd(r,t,i);return{line:t,view:r,rect:null,map:n.map,cache:n.cache,before:n.before,hasHeights:!1}}function Ed(e,t,i,r,n){t.before&&(i=-1);let o,s=i+(r||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(!function(e,t,i){let r=e.options.lineWrapping,n=r&&wd(e);if(!t.measure.heights||r&&t.measure.width!=n){let e=t.measure.heights=[];if(r){t.measure.width=n;let r=t.text.firstChild.getClientRects();for(let t=0;t<r.length-1;t++){let n=r[t],o=r[t+1];Math.abs(n.bottom-o.bottom)>2&&e.push((n.bottom+o.top)/2-i.top)}}e.push(i.bottom-i.top)}}(e,t.view,t.rect),t.hasHeights=!0),o=function(e,t,i,r){let n,o=zd(t.map,i,r),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(let e=0;e<4;e++){for(;a&&eu(t.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&eu(t.line.text.charAt(o.coverStart+l));)++l;if(n=ic&&rc<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():Pd(wc(s,a,l).getClientRects(),r),n.left||n.right||0==a)break;l=a,a-=1,c="right"}ic&&rc<11&&(n=function(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(e){if(null!=Iu)return Iu;let t=Cc(e,Mc("span","x")),i=t.getBoundingClientRect(),r=wc(t,0,1).getBoundingClientRect();return Iu=Math.abs(i.left-r.left)>1}(e))return t;let i=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*r,bottom:t.bottom*r}}(e.display.measure,n))}else{let t;a>0&&(c=r="right"),n=e.options.lineWrapping&&(t=s.getClientRects()).length>1?t["right"==r?t.length-1:0]:s.getBoundingClientRect()}if(ic&&rc<9&&!a&&(!n||!n.left&&!n.right)){let t=s.parentNode.getClientRects()[0];n=t?{left:t.left,right:t.left+Qd(e.display),top:t.top,bottom:t.bottom}:Id}let u=n.top-t.rect.top,h=n.bottom-t.rect.top,d=(u+h)/2,p=t.view.measure.heights,f=0;for(;f<p.length-1&&!(d<p[f]);f++);let m=f?p[f-1]:0,g=p[f],y={left:("right"==c?n.right:n.left)-t.rect.left,right:("left"==c?n.left:n.right)-t.rect.left,top:m,bottom:g};n.left||n.right||(y.bogus=!0);e.options.singleCursorHeightPerLine||(y.rtop=u,y.rbottom=h);return y}(e,t,i,r),o.bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:n?o.rtop:o.top,bottom:n?o.rbottom:o.bottom}}let Ad,Id={left:0,right:0,top:0,bottom:0};function zd(e,t,i){let r,n,o,s,a,l;for(let c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(n=0,o=1,s="left"):t<l?(n=t-a,o=n+1):(c==e.length-3||t==l&&e[c+3]>t)&&(o=l-a,n=o-1,t>=l&&(s="right")),null!=n){if(r=e[c+2],a==l&&i==(r.insertLeft?"left":"right")&&(s=i),"left"==i&&0==n)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)r=e[2+(c-=3)],s="left";if("right"==i&&n==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)r=e[(c+=3)+2],s="right";break}return{node:r,start:n,end:o,collapse:s,coverStart:a,coverEnd:l}}function Pd(e,t){let i=Id;if("left"==t)for(let t=0;t<e.length&&(i=e[t]).left==i.right;t++);else for(let t=e.length-1;t>=0&&(i=e[t]).left==i.right;t--);return i}function Ld(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(let t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Dd(e){e.display.externalMeasure=null,Sc(e.display.lineMeasure);for(let t=0;t<e.display.view.length;t++)Ld(e.display.view[t])}function Rd(e){Dd(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function Bd(){return sc&&pc?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Od(){return sc&&pc?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function Fd(e){let{widgets:t}=Dh(e),i=0;if(t)for(let e=0;e<t.length;++e)t[e].above&&(i+=gd(t[e]));return i}function jd(e,t,i,r,n){if(!n){let e=Fd(t);i.top+=e,i.bottom+=e}if("line"==r)return i;r||(r="local");let o=jh(t);if("local"==r?o+=_d(e.display):o-=e.display.viewOffset,"page"==r||"window"==r){let t=e.display.lineSpace.getBoundingClientRect();o+=t.top+("window"==r?0:Od());let n=t.left+("window"==r?0:Bd());i.left+=n,i.right+=n}return i.top+=o,i.bottom+=o,i}function $d(e,t,i){if("div"==i)return t;let r=t.left,n=t.top;if("page"==i)r-=Bd(),n-=Od();else if("local"==i||!i){let t=e.display.sizer.getBoundingClientRect();r+=t.left,n+=t.top}let o=e.display.lineSpace.getBoundingClientRect();return{left:r-o.left,top:n-o.top}}function Nd(e,t,i,r,n){return r||(r=Uu(e.doc,t.line)),jd(e,r,Cd(e,r,t.ch,n),i)}function Ud(e,t,i,r,n,o){function s(t,s){let a=Ed(e,n,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,jd(e,r,a,i)}r=r||Uu(e.doc,t.line),n||(n=kd(e,r));let a=su(r,e.doc.direction),l=t.ch,c=t.sticky;if(l>=r.text.length?(l=r.text.length,c="before"):l<=0&&(l=0,c="after"),!a)return s("before"==c?l-1:l,"before"==c);function u(e,t,i){return s(i?e-1:e,1==a[t].level!=i)}let h=nu(a,l,c),d=ru,p=u(l,h,"before"==c);return null!=d&&(p.other=u(l,d,"before"!=c)),p}function Vd(e,t){let i=0;t=rh(e.doc,t),e.options.lineWrapping||(i=Qd(e.display)*t.ch);let r=Uu(e.doc,t.line),n=jh(r)+_d(e.display);return{left:i,right:i,top:n,bottom:n+r.height}}function Gd(e,t,i,r,n){let o=Ku(e,t,i);return o.xRel=n,r&&(o.outside=r),o}function qd(e,t,i){let r=e.doc;if((i+=e.display.viewOffset)<0)return Gd(r.first,0,null,-1,-1);let n=Wu(r,i),o=r.first+r.size-1;if(n>o)return Gd(r.first+r.size-1,Uu(r,o).text.length,null,1,1);t<0&&(t=0);let s=Uu(r,n);for(;;){let o=Xd(e,s,n,t,i),a=Ph(s,o.ch+(o.xRel>0||o.outside>0?1:0));if(!a)return o;let l=a.find(1);if(l.line==n)return l;s=Uu(r,n=l.line)}}function Zd(e,t,i,r){r-=Fd(t);let n=t.text.length,o=iu((t=>Ed(e,i,t-1).bottom<=r),n,0);return n=iu((t=>Ed(e,i,t).top>r),o,n),{begin:o,end:n}}function Wd(e,t,i,r){return i||(i=kd(e,t)),Zd(e,t,i,jd(e,t,Ed(e,i,r),"line").top)}function Hd(e,t,i,r){return!(e.bottom<=i)&&(e.top>i||(r?e.left:e.right)>t)}function Xd(e,t,i,r,n){n-=jh(t);let o=kd(e,t),s=Fd(t),a=0,l=t.text.length,c=!0,u=su(t,e.doc.direction);if(u){let s=(e.options.lineWrapping?Yd:Kd)(e,t,i,o,u,r,n);c=1!=s.level,a=c?s.from:s.to-1,l=c?s.to:s.from-1}let h,d,p=null,f=null,m=iu((t=>{let i=Ed(e,o,t);return i.top+=s,i.bottom+=s,!!Hd(i,r,n,!1)&&(i.top<=n&&i.left<=r&&(p=t,f=i),!0)}),a,l),g=!1;if(f){let e=r-f.left<f.right-r,t=e==c;m=p+(t?0:1),d=t?"after":"before",h=e?f.left:f.right}else{c||m!=l&&m!=a||m++,d=0==m?"after":m==t.text.length?"before":Ed(e,o,m-(c?1:0)).bottom+s<=n==c?"after":"before";let r=Ud(e,Ku(i,m,d),"line",t,o);h=r.left,g=n<r.top?-1:n>=r.bottom?1:0}return m=tu(t.text,m,1),Gd(i,m,d,g,r-h)}function Kd(e,t,i,r,n,o,s){let a=iu((a=>{let l=n[a],c=1!=l.level;return Hd(Ud(e,Ku(i,c?l.to:l.from,c?"before":"after"),"line",t,r),o,s,!0)}),0,n.length-1),l=n[a];if(a>0){let c=1!=l.level,u=Ud(e,Ku(i,c?l.from:l.to,c?"after":"before"),"line",t,r);Hd(u,o,s,!0)&&u.top>s&&(l=n[a-1])}return l}function Yd(e,t,i,r,n,o,s){let{begin:a,end:l}=Zd(e,t,r,s);/\s/.test(t.text.charAt(l-1))&&l--;let c=null,u=null;for(let t=0;t<n.length;t++){let i=n[t];if(i.from>=l||i.to<=a)continue;let s=Ed(e,r,1!=i.level?Math.min(l,i.to)-1:Math.max(a,i.from)).right,h=s<o?o-s+1e9:s-o;(!c||u>h)&&(c=i,u=h)}return c||(c=n[n.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>l&&(c={from:c.from,to:l,level:c.level}),c}function Jd(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==Ad){Ad=Mc("pre",null,"CodeMirror-line-like");for(let e=0;e<49;++e)Ad.appendChild(document.createTextNode("x")),Ad.appendChild(Mc("br"));Ad.appendChild(document.createTextNode("x"))}Cc(e.measure,Ad);let t=Ad.offsetHeight/50;return t>3&&(e.cachedTextHeight=t),Sc(e.measure),t||1}function Qd(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;let t=Mc("span","xxxxxxxxxx"),i=Mc("pre",[t],"CodeMirror-line-like");Cc(e.measure,i);let r=t.getBoundingClientRect(),n=(r.right-r.left)/10;return n>2&&(e.cachedCharWidth=n),n||10}function ep(e){let t=e.display,i={},r={},n=t.gutters.clientLeft;for(let o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){let t=e.display.gutterSpecs[s].className;i[t]=o.offsetLeft+o.clientLeft+n,r[t]=o.clientWidth}return{fixedPos:tp(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function tp(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function ip(e){let t=Jd(e.display),i=e.options.lineWrapping,r=i&&Math.max(5,e.display.scroller.clientWidth/Qd(e.display)-3);return n=>{if(Oh(e.doc,n))return 0;let o=0;if(n.widgets)for(let e=0;e<n.widgets.length;e++)n.widgets[e].height&&(o+=n.widgets[e].height);return i?o+(Math.ceil(n.text.length/r)||1)*t:o+t}}function rp(e){let t=e.doc,i=ip(e);t.iter((e=>{let t=i(e);t!=e.height&&qu(e,t)}))}function np(e,t,i,r){let n=e.display;if(!i&&"true"==xu(t).getAttribute("cm-not-content"))return null;let o,s,a=n.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(t){return null}let l,c=qd(e,o,s);if(r&&c.xRel>0&&(l=Uu(e.doc,c.line).text).length==c.ch){let t=Rc(l,l.length,e.options.tabSize)-l.length;c=Ku(c.line,Math.max(0,Math.round((o-xd(e.display).left)/Qd(e.display))-t))}return c}function op(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;let i=e.display.view;for(let e=0;e<i.length;e++)if((t-=i[e].size)<0)return e}function sp(e,t,i,r){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),r||(r=0);let n=e.display;if(r&&i<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>t)&&(n.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=n.viewTo)_h&&Rh(e.doc,t)<n.viewTo&&lp(e);else if(i<=n.viewFrom)_h&&Bh(e.doc,i+r)>n.viewFrom?lp(e):(n.viewFrom+=r,n.viewTo+=r);else if(t<=n.viewFrom&&i>=n.viewTo)lp(e);else if(t<=n.viewFrom){let t=cp(e,i,i+r,1);t?(n.view=n.view.slice(t.index),n.viewFrom=t.lineN,n.viewTo+=r):lp(e)}else if(i>=n.viewTo){let i=cp(e,t,t,-1);i?(n.view=n.view.slice(0,i.index),n.viewTo=i.lineN):lp(e)}else{let o=cp(e,t,t,-1),s=cp(e,i,i+r,1);o&&s?(n.view=n.view.slice(0,o.index).concat(ed(e,o.lineN,s.lineN)).concat(n.view.slice(s.index)),n.viewTo+=r):lp(e)}let o=n.externalMeasured;o&&(i<o.lineN?o.lineN+=r:t<o.lineN+o.size&&(n.externalMeasured=null))}function ap(e,t,i){e.curOp.viewChanged=!0;let r=e.display,n=e.display.externalMeasured;if(n&&t>=n.lineN&&t<n.lineN+n.size&&(r.externalMeasured=null),t<r.viewFrom||t>=r.viewTo)return;let o=r.view[op(e,t)];if(null==o.node)return;let s=o.changes||(o.changes=[]);-1==Oc(s,i)&&s.push(i)}function lp(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function cp(e,t,i,r){let n,o=op(e,t),s=e.display.view;if(!_h||i==e.doc.first+e.doc.size)return{index:o,lineN:i};let a=e.display.viewFrom;for(let e=0;e<o;e++)a+=s[e].size;if(a!=t){if(r>0){if(o==s.length-1)return null;n=a+s[o].size-t,o++}else n=a-t;t+=n,i+=n}for(;Rh(e.doc,i)!=i;){if(o==(r<0?0:s.length-1))return null;i+=r*s[o-(r<0?1:0)].size,o+=r}return{index:o,lineN:i}}function up(e){let t=e.display.view,i=0;for(let e=0;e<t.length;e++){let r=t[e];r.hidden||r.node&&!r.changes||++i}return i}function hp(e){e.display.input.showSelection(e.display.input.prepareSelection())}function dp(e,t=!0){let i=e.doc,r={},n=r.cursors=document.createDocumentFragment(),o=r.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(let r=0;r<i.sel.ranges.length;r++){if(!t&&r==i.sel.primIndex)continue;let a=i.sel.ranges[r];if(a.from().line>=e.display.viewTo||a.to().line<e.display.viewFrom)continue;let l=a.empty();if(s){let t=s(e,a);t&&pp(e,t,n)}else(l||e.options.showCursorWhenSelecting)&&pp(e,a.head,n);l||mp(e,a,o)}return r}function pp(e,t,i){let r=Ud(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),n=i.appendChild(Mc("div"," ","CodeMirror-cursor"));if(n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){let i=Nd(e,t,"div",null,null),r=i.right-i.left;n.style.width=(r>0?r:e.defaultCharWidth())+"px"}if(r.other){let e=i.appendChild(Mc("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));e.style.display="",e.style.left=r.other.left+"px",e.style.top=r.other.top+"px",e.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function fp(e,t){return e.top-t.top||e.left-t.left}function mp(e,t,i){let r=e.display,n=e.doc,o=document.createDocumentFragment(),s=xd(e.display),a=s.left,l=Math.max(r.sizerWidth,wd(e)-r.sizer.offsetLeft)-s.right,c="ltr"==n.direction;function u(e,t,i,r){t<0&&(t=0),t=Math.round(t),r=Math.round(r),o.appendChild(Mc("div",null,"CodeMirror-selected",`position: absolute; left: ${e}px;\n                             top: ${t}px; width: ${null==i?l-e:i}px;\n                             height: ${r-t}px`))}function h(t,i,r){let o,s,h=Uu(n,t),d=h.text.length;function p(i,r){return Nd(e,Ku(t,i),"div",h,r)}function f(t,i,r){let n=Wd(e,h,null,t),o="ltr"==i==("after"==r)?"left":"right";return p("after"==r?n.begin:n.end-(/\s/.test(h.text.charAt(n.end-1))?2:1),o)[o]}let m=su(h,n.direction);return function(e,t,i,r){if(!e)return r(t,i,"ltr",0);let n=!1;for(let o=0;o<e.length;++o){let s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(r(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr",o),n=!0)}n||r(t,i,"ltr")}(m,i||0,null==r?d:r,((e,t,n,h)=>{let g="ltr"==n,y=p(e,g?"left":"right"),_=p(t-1,g?"right":"left"),v=null==i&&0==e,x=null==r&&t==d,b=0==h,w=!m||h==m.length-1;if(_.top-y.top<=3){let e=(c?x:v)&&w,t=(c?v:x)&&b?a:(g?y:_).left,i=e?l:(g?_:y).right;u(t,y.top,i-t,y.bottom)}else{let i,r,o,s;g?(i=c&&v&&b?a:y.left,r=c?l:f(e,n,"before"),o=c?a:f(t,n,"after"),s=c&&x&&w?l:_.right):(i=c?f(e,n,"before"):a,r=!c&&v&&b?l:y.right,o=!c&&x&&w?a:_.left,s=c?f(t,n,"after"):l),u(i,y.top,r-i,y.bottom),y.bottom<_.top&&u(a,y.bottom,null,_.top),u(o,_.top,s-o,_.bottom)}(!o||fp(y,o)<0)&&(o=y),fp(_,o)<0&&(o=_),(!s||fp(y,s)<0)&&(s=y),fp(_,s)<0&&(s=_)})),{start:o,end:s}}let d=t.from(),p=t.to();if(d.line==p.line)h(d.line,d.ch,p.ch);else{let e=Uu(n,d.line),t=Uu(n,p.line),i=Dh(e)==Dh(t),r=h(d.line,d.ch,i?e.text.length+1:null).end,o=h(p.line,i?0:null,p.ch).start;i&&(r.top<o.top-2?(u(r.right,r.top,null,r.bottom),u(a,o.top,o.left,o.bottom)):u(r.right,r.top,o.left-r.right,r.bottom)),r.bottom<o.top&&u(a,r.bottom,null,o.top)}i.appendChild(o)}function gp(e){if(!e.state.focused)return;let t=e.display;clearInterval(t.blinker);let i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval((()=>{e.hasFocus()||xp(e),t.cursorDiv.style.visibility=(i=!i)?"":"hidden"}),e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}function yp(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||vp(e))}function _p(e){e.state.delayingBlurEvent=!0,setTimeout((()=>{e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&xp(e))}),100)}function vp(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(hu(e,"focus",e,t),e.state.focused=!0,Ic(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),nc&&setTimeout((()=>e.display.input.reset(!0)),20)),e.display.input.receivedFocus()),gp(e))}function xp(e,t){e.state.delayingBlurEvent||(e.state.focused&&(hu(e,"blur",e,t),e.state.focused=!1,Tc(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((()=>{e.state.focused||(e.display.shift=!1)}),150))}function bp(e){let t=e.display,i=t.lineDiv.offsetTop,r=Math.max(0,t.scroller.getBoundingClientRect().top),n=t.lineDiv.getBoundingClientRect().top,o=0;for(let s=0;s<t.view.length;s++){let a,l=t.view[s],c=e.options.lineWrapping,u=0;if(l.hidden)continue;if(n+=l.line.height,ic&&rc<8){let e=l.node.offsetTop+l.node.offsetHeight;a=e-i,i=e}else{let e=l.node.getBoundingClientRect();a=e.bottom-e.top,!c&&l.text.firstChild&&(u=l.text.firstChild.getBoundingClientRect().right-e.left-1)}let h=l.line.height-a;if((h>.005||h<-.005)&&(n<r&&(o-=h),qu(l.line,a),wp(l.line),l.rest))for(let e=0;e<l.rest.length;e++)wp(l.rest[e]);if(u>e.display.sizerWidth){let t=Math.ceil(u/Qd(e.display));t>e.display.maxLineLength&&(e.display.maxLineLength=t,e.display.maxLine=l.line,e.display.maxLineChanged=!0)}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function wp(e){if(e.widgets)for(let t=0;t<e.widgets.length;++t){let i=e.widgets[t],r=i.node.parentNode;r&&(i.height=r.offsetHeight)}}function Tp(e,t,i){let r=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;r=Math.floor(r-_d(e));let n=i&&null!=i.bottom?i.bottom:r+e.wrapper.clientHeight,o=Wu(t,r),s=Wu(t,n);if(i&&i.ensure){let r=i.ensure.from.line,n=i.ensure.to.line;r<o?(o=r,s=Wu(t,jh(Uu(t,r))+e.wrapper.clientHeight)):Math.min(n,t.lastLine())>=s&&(o=Wu(t,jh(Uu(t,n))-e.wrapper.clientHeight),s=n)}return{from:o,to:Math.max(s,o+1)}}function Sp(e,t){let i=e.display,r=Jd(e.display);t.top<0&&(t.top=0);let n=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=Td(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);let a=e.doc.height+vd(i),l=t.top<r,c=t.bottom>a-r;if(t.top<n)s.scrollTop=l?0:t.top;else if(t.bottom>n+o){let e=Math.min(t.top,(c?a:t.bottom)-o);e!=n&&(s.scrollTop=e)}let u=e.options.fixedGutter?0:i.gutters.offsetWidth,h=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft-u,d=wd(e)-i.gutters.offsetWidth,p=t.right-t.left>d;return p&&(t.right=t.left+d),t.left<10?s.scrollLeft=0:t.left<h?s.scrollLeft=Math.max(0,t.left+u-(p?0:10)):t.right>d+h-3&&(s.scrollLeft=t.right+(p?0:10)-d),s}function Cp(e,t){null!=t&&(Ep(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function Mp(e){Ep(e);let t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function kp(e,t,i){null==t&&null==i||Ep(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function Ep(e){let t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null,Ap(e,Vd(e,t.from),Vd(e,t.to),t.margin)}}function Ap(e,t,i,r){let n=Sp(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-r,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+r});kp(e,n.scrollLeft,n.scrollTop)}function Ip(e,t){Math.abs(e.doc.scrollTop-t)<2||(Jl||tf(e,{top:t}),zp(e,t,!0),Jl&&tf(e),Kp(e,100))}function zp(e,t,i){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Pp(e,t,i,r){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!r||(e.doc.scrollLeft=t,of(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Lp(e){let t=e.display,i=t.gutters.offsetWidth,r=Math.round(e.doc.height+vd(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:r,scrollHeight:r+bd(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}function Dp(e,t){t||(t=Lp(e));let i=e.display.barWidth,r=e.display.barHeight;Rp(e,t);for(let t=0;t<4&&i!=e.display.barWidth||r!=e.display.barHeight;t++)i!=e.display.barWidth&&e.options.lineWrapping&&bp(e),Rp(e,Lp(e)),i=e.display.barWidth,r=e.display.barHeight}function Rp(e,t){let i=e.display,r=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=r.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=r.bottom)+"px",i.heightForcer.style.borderBottom=r.bottom+"px solid transparent",r.right&&r.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=r.bottom+"px",i.scrollbarFiller.style.width=r.right+"px"):i.scrollbarFiller.style.display="",r.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=r.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}let Bp={native:class{constructor(e,t,i){this.cm=i;let r=this.vert=Mc("div",[Mc("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),n=this.horiz=Mc("div",[Mc("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");r.tabIndex=n.tabIndex=-1,e(r),e(n),lu(r,"scroll",(()=>{r.clientHeight&&t(r.scrollTop,"vertical")})),lu(n,"scroll",(()=>{n.clientWidth&&t(n.scrollLeft,"horizontal")})),this.checkedZeroWidth=!1,ic&&rc<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}update(e){let t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,r=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?r+"px":"0";let i=e.viewHeight-(t?r:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?r+"px":"0",this.horiz.style.left=e.barLeft+"px";let t=e.viewWidth-e.barLeft-(i?r:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+t)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?r:0,bottom:t?r:0}}setScrollLeft(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}setScrollTop(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}zeroWidthHack(){let e=mc&&!uc?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Bc,this.disableVert=new Bc}enableZeroWidthBar(e,t,i){e.style.pointerEvents="auto",t.set(1e3,(function r(){let n=e.getBoundingClientRect();("vert"==i?document.elementFromPoint(n.right-1,(n.top+n.bottom)/2):document.elementFromPoint((n.right+n.left)/2,n.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,r)}))}clear(){let e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)}},null:class{update(){return{bottom:0,right:0}}setScrollLeft(){}setScrollTop(){}clear(){}}};function Op(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Tc(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Bp[e.options.scrollbarStyle]((t=>{e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),lu(t,"mousedown",(()=>{e.state.focused&&setTimeout((()=>e.display.input.focus()),0)})),t.setAttribute("cm-not-content","true")}),((t,i)=>{"horizontal"==i?Pp(e,t):Ip(e,t)}),e),e.display.scrollbars.addClass&&Ic(e.display.wrapper,e.display.scrollbars.addClass)}let Fp=0;function jp(e){var t;e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Fp,markArrays:null},t=e.curOp,td?td.ops.push(t):t.ownsGroup=td={ops:[t],delayedCallbacks:[]}}function $p(e){let t=e.curOp;t&&function(e,t){let i=e.ownsGroup;if(i)try{!function(e){let t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(let t=0;t<e.ops.length;t++){let i=e.ops[t];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(i<t.length)}(i)}finally{td=null,t(i)}}(t,(e=>{for(let t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;!function(e){let t=e.ops;for(let e=0;e<t.length;e++)Np(t[e]);for(let e=0;e<t.length;e++)Up(t[e]);for(let e=0;e<t.length;e++)Vp(t[e]);for(let e=0;e<t.length;e++)Gp(t[e]);for(let e=0;e<t.length;e++)qp(t[e])}(e)}))}function Np(e){let t=e.cm,i=t.display;!function(e){let t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=bd(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=bd(e)+"px",t.scrollbarsClipped=!0)}(t),e.updateMaxLine&&Nh(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Jp(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function Up(e){e.updatedDisplay=e.mustUpdate&&Qp(e.cm,e.update)}function Vp(e){let t=e.cm,i=t.display;e.updatedDisplay&&bp(t),e.barMeasure=Lp(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Cd(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+bd(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-wd(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection())}function Gp(e){let t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Pp(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);let i=e.focus&&e.focus==Ac();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&Dp(t,e.barMeasure),e.updatedDisplay&&nf(t,e.barMeasure),e.selectionChanged&&gp(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&yp(e.cm)}function qp(e){let t=e.cm,i=t.display,r=t.doc;if(e.updatedDisplay&&ef(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&zp(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Pp(t,e.scrollLeft,!0,!0),e.scrollToPos){let i=function(e,t,i,r){let n;null==r&&(r=0),e.options.lineWrapping||t!=i||(i="before"==t.sticky?Ku(t.line,t.ch+1,"before"):t,t=t.ch?Ku(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t);for(let o=0;o<5;o++){let o=!1,s=Ud(e,t),a=i&&i!=t?Ud(e,i):s;n={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-r,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+r};let l=Sp(e,n),c=e.doc.scrollTop,u=e.doc.scrollLeft;if(null!=l.scrollTop&&(Ip(e,l.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(o=!0)),null!=l.scrollLeft&&(Pp(e,l.scrollLeft),Math.abs(e.doc.scrollLeft-u)>1&&(o=!0)),!o)break}return n}(t,rh(r,e.scrollToPos.from),rh(r,e.scrollToPos.to),e.scrollToPos.margin);!function(e,t){if(du(e,"scrollCursorIntoView"))return;let i=e.display,r=i.sizer.getBoundingClientRect(),n=null;if(t.top+r.top<0?n=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null!=n&&!hc){let r=Mc("div","​",null,`position: absolute;\n                         top: ${t.top-i.viewOffset-_d(e.display)}px;\n                         height: ${t.bottom-t.top+bd(e)+i.barHeight}px;\n                         left: ${t.left}px; width: ${Math.max(2,t.right-t.left)}px;`);e.display.lineSpace.appendChild(r),r.scrollIntoView(n),e.display.lineSpace.removeChild(r)}}(t,i)}let n=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(n)for(let e=0;e<n.length;++e)n[e].lines.length||hu(n[e],"hide");if(o)for(let e=0;e<o.length;++e)o[e].lines.length&&hu(o[e],"unhide");i.wrapper.offsetHeight&&(r.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&hu(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function Zp(e,t){if(e.curOp)return t();jp(e);try{return t()}finally{$p(e)}}function Wp(e,t){return function(){if(e.curOp)return t.apply(e,arguments);jp(e);try{return t.apply(e,arguments)}finally{$p(e)}}}function Hp(e){return function(){if(this.curOp)return e.apply(this,arguments);jp(this);try{return e.apply(this,arguments)}finally{$p(this)}}}function Xp(e){return function(){let t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);jp(t);try{return e.apply(this,arguments)}finally{$p(t)}}}function Kp(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,Lc(Yp,e))}function Yp(e){let t=e.doc;if(t.highlightFrontier>=e.display.viewTo)return;let i=+new Date+e.options.workTime,r=ch(e,t.highlightFrontier),n=[];t.iter(r.line,Math.min(t.first+t.size,e.display.viewTo+500),(o=>{if(r.line>=e.display.viewFrom){let i=o.styles,s=o.text.length>e.options.maxHighlightLength?Fu(t.mode,r.state):null,a=ah(e,o,r,!0);s&&(r.state=s),o.styles=a.styles;let l=o.styleClasses,c=a.classes;c?o.styleClasses=c:l&&(o.styleClasses=null);let u=!i||i.length!=o.styles.length||l!=c&&(!l||!c||l.bgClass!=c.bgClass||l.textClass!=c.textClass);for(let e=0;!u&&e<i.length;++e)u=i[e]!=o.styles[e];u&&n.push(r.line),o.stateAfter=r.save(),r.nextLine()}else o.text.length<=e.options.maxHighlightLength&&uh(e,o.text,r),o.stateAfter=r.line%5==0?r.save():null,r.nextLine();if(+new Date>i)return Kp(e,e.options.workDelay),!0})),t.highlightFrontier=r.line,t.modeFrontier=Math.max(t.modeFrontier,r.line),n.length&&Zp(e,(()=>{for(let t=0;t<n.length;t++)ap(e,n[t],"text")}))}class Jp{constructor(e,t,i){let r=e.display;this.viewport=t,this.visible=Tp(r,e.doc,t),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=wd(e),this.force=i,this.dims=ep(e),this.events=[]}signal(e,t){fu(e,t)&&this.events.push(arguments)}finish(){for(let e=0;e<this.events.length;e++)hu.apply(null,this.events[e])}}function Qp(e,t){let i=e.display,r=e.doc;if(t.editorIsHidden)return lp(e),!1;if(!t.force&&t.visible.from>=i.viewFrom&&t.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==up(e))return!1;sf(e)&&(lp(e),t.dims=ep(e));let n=r.first+r.size,o=Math.max(t.visible.from-e.options.viewportMargin,r.first),s=Math.min(n,t.visible.to+e.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(r.first,i.viewFrom)),i.viewTo>s&&i.viewTo-s<20&&(s=Math.min(n,i.viewTo)),_h&&(o=Rh(e.doc,o),s=Bh(e.doc,s));let a=o!=i.viewFrom||s!=i.viewTo||i.lastWrapHeight!=t.wrapperHeight||i.lastWrapWidth!=t.wrapperWidth;!function(e,t,i){let r=e.display;0==r.view.length||t>=r.viewTo||i<=r.viewFrom?(r.view=ed(e,t,i),r.viewFrom=t):(r.viewFrom>t?r.view=ed(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(op(e,t))),r.viewFrom=t,r.viewTo<i?r.view=r.view.concat(ed(e,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,op(e,i)))),r.viewTo=i}(e,o,s),i.viewOffset=jh(Uu(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";let l=up(e);if(!a&&0==l&&!t.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;let c=function(e){if(e.hasFocus())return null;let t=Ac();if(!t||!Ec(e.display.lineDiv,t))return null;let i={activeElt:t};if(window.getSelection){let t=window.getSelection();t.anchorNode&&t.extend&&Ec(e.display.lineDiv,t.anchorNode)&&(i.anchorNode=t.anchorNode,i.anchorOffset=t.anchorOffset,i.focusNode=t.focusNode,i.focusOffset=t.focusOffset)}return i}(e);return l>4&&(i.lineDiv.style.display="none"),function(e,t,i){let r=e.display,n=e.options.lineNumbers,o=r.lineDiv,s=o.firstChild;function a(t){let i=t.nextSibling;return nc&&mc&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}let l=r.view,c=r.viewFrom;for(let r=0;r<l.length;r++){let u=l[r];if(u.hidden);else if(u.node&&u.node.parentNode==o){for(;s!=u.node;)s=a(s);let r=n&&null!=t&&t<=c&&u.lineNumber;u.changes&&(Oc(u.changes,"gutter")>-1&&(r=!1),od(e,u,c,i)),r&&(Sc(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(Xu(e.options,c)))),s=u.node.nextSibling}else{let t=dd(e,u,c,i);o.insertBefore(t,s)}c+=u.size}for(;s;)s=a(s)}(e,i.updateLineNumbers,t.dims),l>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,function(e){if(e&&e.activeElt&&e.activeElt!=Ac()&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&Ec(document.body,e.anchorNode)&&Ec(document.body,e.focusNode))){let t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}(c),Sc(i.cursorDiv),Sc(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,a&&(i.lastWrapHeight=t.wrapperHeight,i.lastWrapWidth=t.wrapperWidth,Kp(e,400)),i.updateLineNumbers=null,!0}function ef(e,t){let i=t.viewport;for(let r=!0;;r=!1){if(r&&e.options.lineWrapping&&t.oldDisplayWidth!=wd(e))r&&(t.visible=Tp(e.display,e.doc,i));else if(i&&null!=i.top&&(i={top:Math.min(e.doc.height+vd(e.display)-Td(e),i.top)}),t.visible=Tp(e.display,e.doc,i),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break;if(!Qp(e,t))break;bp(e);let n=Lp(e);hp(e),Dp(e,n),nf(e,n),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function tf(e,t){let i=new Jp(e,t);if(Qp(e,i)){bp(e),ef(e,i);let t=Lp(e);hp(e),Dp(e,t),nf(e,t),i.finish()}}function rf(e){let t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",rd(e,"gutterChanged",e)}function nf(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+bd(e)+"px"}function of(e){let t=e.display,i=t.view;if(!(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter))return;let r=tp(t)-t.scroller.scrollLeft+e.doc.scrollLeft,n=t.gutters.offsetWidth,o=r+"px";for(let t=0;t<i.length;t++)if(!i[t].hidden){e.options.fixedGutter&&(i[t].gutter&&(i[t].gutter.style.left=o),i[t].gutterBackground&&(i[t].gutterBackground.style.left=o));let r=i[t].alignable;if(r)for(let e=0;e<r.length;e++)r[e].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=r+n+"px")}function sf(e){if(!e.options.lineNumbers)return!1;let t=e.doc,i=Xu(e.options,t.first+t.size-1),r=e.display;if(i.length!=r.lineNumChars){let t=r.measure.appendChild(Mc("div",[Mc("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),n=t.firstChild.offsetWidth,o=t.offsetWidth-n;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(n,r.lineGutter.offsetWidth-o)+1,r.lineNumWidth=r.lineNumInnerWidth+o,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",rf(e.display),!0}return!1}function af(e,t){let i=[],r=!1;for(let n=0;n<e.length;n++){let o=e[n],s=null;if("string"!=typeof o&&(s=o.style,o=o.className),"CodeMirror-linenumbers"==o){if(!t)continue;r=!0}i.push({className:o,style:s})}return t&&!r&&i.push({className:"CodeMirror-linenumbers",style:null}),i}function lf(e){let t=e.gutters,i=e.gutterSpecs;Sc(t),e.lineGutter=null;for(let r=0;r<i.length;++r){let{className:n,style:o}=i[r],s=t.appendChild(Mc("div",null,"CodeMirror-gutter "+n));o&&(s.style.cssText=o),"CodeMirror-linenumbers"==n&&(e.lineGutter=s,s.style.width=(e.lineNumWidth||1)+"px")}t.style.display=i.length?"":"none",rf(e)}function cf(e){lf(e.display),sp(e),of(e)}function uf(e,t,i,r){let n=this;this.input=i,n.scrollbarFiller=Mc("div",null,"CodeMirror-scrollbar-filler"),n.scrollbarFiller.setAttribute("cm-not-content","true"),n.gutterFiller=Mc("div",null,"CodeMirror-gutter-filler"),n.gutterFiller.setAttribute("cm-not-content","true"),n.lineDiv=kc("div",null,"CodeMirror-code"),n.selectionDiv=Mc("div",null,null,"position: relative; z-index: 1"),n.cursorDiv=Mc("div",null,"CodeMirror-cursors"),n.measure=Mc("div",null,"CodeMirror-measure"),n.lineMeasure=Mc("div",null,"CodeMirror-measure"),n.lineSpace=kc("div",[n.measure,n.lineMeasure,n.selectionDiv,n.cursorDiv,n.lineDiv],null,"position: relative; outline: none");let o=kc("div",[n.lineSpace],"CodeMirror-lines");n.mover=Mc("div",[o],null,"position: relative"),n.sizer=Mc("div",[n.mover],"CodeMirror-sizer"),n.sizerWidth=null,n.heightForcer=Mc("div",null,null,"position: absolute; height: 50px; width: 1px;"),n.gutters=Mc("div",null,"CodeMirror-gutters"),n.lineGutter=null,n.scroller=Mc("div",[n.sizer,n.heightForcer,n.gutters],"CodeMirror-scroll"),n.scroller.setAttribute("tabIndex","-1"),n.wrapper=Mc("div",[n.scrollbarFiller,n.gutterFiller,n.scroller],"CodeMirror"),n.wrapper.setAttribute("translate","no"),ic&&rc<8&&(n.gutters.style.zIndex=-1,n.scroller.style.paddingRight=0),nc||Jl&&fc||(n.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(n.wrapper):e(n.wrapper)),n.viewFrom=n.viewTo=t.first,n.reportedViewFrom=n.reportedViewTo=t.first,n.view=[],n.renderedView=null,n.externalMeasured=null,n.viewOffset=0,n.lastWrapHeight=n.lastWrapWidth=0,n.updateLineNumbers=null,n.nativeBarWidth=n.barHeight=n.barWidth=0,n.scrollbarsClipped=!1,n.lineNumWidth=n.lineNumInnerWidth=n.lineNumChars=null,n.alignWidgets=!1,n.cachedCharWidth=n.cachedTextHeight=n.cachedPaddingH=null,n.maxLine=null,n.maxLineLength=0,n.maxLineChanged=!1,n.wheelDX=n.wheelDY=n.wheelStartX=n.wheelStartY=null,n.shift=!1,n.selForContextMenu=null,n.activeTouch=null,n.gutterSpecs=af(r.gutters,r.lineNumbers),lf(n),i.init(n)}let hf=0,df=null;function pf(e){let t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function ff(e){let t=pf(e);return t.x*=df,t.y*=df,t}function mf(e,t){sc&&ac>=102&&(null==e.display.chromeScrollHack?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout((()=>{e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""}),100));let i=pf(t),r=i.x,n=i.y,o=df;0===t.deltaMode&&(r=t.deltaX,n=t.deltaY,o=1);let s=e.display,a=s.scroller,l=a.scrollWidth>a.clientWidth,c=a.scrollHeight>a.clientHeight;if(r&&l||n&&c){if(n&&mc&&nc)e:for(let i=t.target,r=s.view;i!=a;i=i.parentNode)for(let t=0;t<r.length;t++)if(r[t].node==i){e.display.currentWheelTarget=i;break e}if(r&&!Jl&&!lc&&null!=o)return n&&c&&Ip(e,Math.max(0,a.scrollTop+n*o)),Pp(e,Math.max(0,a.scrollLeft+r*o)),(!n||n&&c)&&gu(t),void(s.wheelStartX=null);if(n&&null!=o){let t=n*o,i=e.doc.scrollTop,r=i+s.wrapper.clientHeight;t<0?i=Math.max(0,i+t-50):r=Math.min(e.doc.height,r+t+50),tf(e,{top:i,bottom:r})}hf<20&&0!==t.deltaMode&&(null==s.wheelStartX?(s.wheelStartX=a.scrollLeft,s.wheelStartY=a.scrollTop,s.wheelDX=r,s.wheelDY=n,setTimeout((()=>{if(null==s.wheelStartX)return;let e=a.scrollLeft-s.wheelStartX,t=a.scrollTop-s.wheelStartY,i=t&&s.wheelDY&&t/s.wheelDY||e&&s.wheelDX&&e/s.wheelDX;s.wheelStartX=s.wheelStartY=null,i&&(df=(df*hf+i)/(hf+1),++hf)}),200)):(s.wheelDX+=r,s.wheelDY+=n))}}ic?df=-.53:Jl?df=15:sc?df=-.7:cc&&(df=-1/3);class gf{constructor(e,t){this.ranges=e,this.primIndex=t}primary(){return this.ranges[this.primIndex]}equals(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(let t=0;t<this.ranges.length;t++){let i=this.ranges[t],r=e.ranges[t];if(!Ju(i.anchor,r.anchor)||!Ju(i.head,r.head))return!1}return!0}deepCopy(){let e=[];for(let t=0;t<this.ranges.length;t++)e[t]=new yf(Qu(this.ranges[t].anchor),Qu(this.ranges[t].head));return new gf(e,this.primIndex)}somethingSelected(){for(let e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1}contains(e,t){t||(t=e);for(let i=0;i<this.ranges.length;i++){let r=this.ranges[i];if(Yu(t,r.from())>=0&&Yu(e,r.to())<=0)return i}return-1}}class yf{constructor(e,t){this.anchor=e,this.head=t}from(){return th(this.anchor,this.head)}to(){return eh(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}}function _f(e,t,i){let r=e&&e.options.selectionsMayTouch,n=t[i];t.sort(((e,t)=>Yu(e.from(),t.from()))),i=Oc(t,n);for(let e=1;e<t.length;e++){let n=t[e],o=t[e-1],s=Yu(o.to(),n.from());if(r&&!n.empty()?s>0:s>=0){let r=th(o.from(),n.from()),s=eh(o.to(),n.to()),a=o.empty()?n.from()==n.head:o.from()==o.head;e<=i&&--i,t.splice(--e,2,new yf(a?s:r,a?r:s))}}return new gf(t,i)}function vf(e,t){return new gf([new yf(e,t||e)],0)}function xf(e){return e.text?Ku(e.from.line+e.text.length-1,qc(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function bf(e,t){if(Yu(e,t.from)<0)return e;if(Yu(e,t.to)<=0)return xf(t);let i=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=xf(t).ch-t.to.ch),Ku(i,r)}function wf(e,t){let i=[];for(let r=0;r<e.sel.ranges.length;r++){let n=e.sel.ranges[r];i.push(new yf(bf(n.anchor,t),bf(n.head,t)))}return _f(e.cm,i,e.sel.primIndex)}function Tf(e,t,i){return e.line==t.line?Ku(i.line,e.ch-t.ch+i.ch):Ku(i.line+(e.line-t.line),e.ch)}function Sf(e){e.doc.mode=Ru(e.options,e.doc.modeOption),Cf(e)}function Cf(e){e.doc.iter((e=>{e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)})),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Kp(e,100),e.state.modeGen++,e.curOp&&sp(e)}function Mf(e,t){return 0==t.from.ch&&0==t.to.ch&&""==qc(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function kf(e,t,i,r){function n(e){return i?i[e]:null}function o(e,i,n){!function(e,t,i,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Sh(e),Ch(e,i);let n=r?r(e):1;n!=e.height&&qu(e,n)}(e,i,n,r),rd(e,"change",e,t)}function s(e,t){let i=[];for(let o=e;o<t;++o)i.push(new Uh(c[o],n(o),r));return i}let a=t.from,l=t.to,c=t.text,u=Uu(e,a.line),h=Uu(e,l.line),d=qc(c),p=n(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(Mf(e,t)){let t=s(0,c.length-1);o(h,h.text,p),f&&e.remove(a.line,f),t.length&&e.insert(a.line,t)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),p);else{let t=s(1,c.length-1);t.push(new Uh(d+u.text.slice(l.ch),p,r)),o(u,u.text.slice(0,a.ch)+c[0],n(0)),e.insert(a.line+1,t)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),n(0)),e.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],n(0)),o(h,d+h.text.slice(l.ch),p);let t=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,t)}rd(e,"change",e,t)}function Ef(e,t,i){!function e(r,n,o){if(r.linked)for(let s=0;s<r.linked.length;++s){let a=r.linked[s];if(a.doc==n)continue;let l=o&&a.sharedHist;i&&!l||(t(a.doc,l),e(a.doc,r,l))}}(e,null,!0)}function Af(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,rp(e),Sf(e),If(e),e.options.direction=t.direction,e.options.lineWrapping||Nh(e),e.options.mode=t.modeOption,sp(e)}function If(e){("rtl"==e.doc.direction?Ic:Tc)(e.display.lineDiv,"CodeMirror-rtl")}function zf(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function Pf(e,t){let i={from:Qu(t.from),to:xf(t),text:Vu(e,t.from,t.to)};return Of(e,i,t.from.line,t.to.line+1),Ef(e,(e=>Of(e,i,t.from.line,t.to.line+1)),!0),i}function Lf(e){for(;e.length;){if(!qc(e).ranges)break;e.pop()}}function Df(e,t,i,r){let n=e.history;n.undone.length=0;let o,s,a=+new Date;if((n.lastOp==r||n.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&n.lastModTime>a-(e.cm?e.cm.options.historyEventDelay:500)||"*"==t.origin.charAt(0)))&&(o=function(e,t){return t?(Lf(e.done),qc(e.done)):e.done.length&&!qc(e.done).ranges?qc(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),qc(e.done)):void 0}(n,n.lastOp==r)))s=qc(o.changes),0==Yu(t.from,t.to)&&0==Yu(t.from,s.to)?s.to=xf(t):o.changes.push(Pf(e,t));else{let i=qc(n.done);for(i&&i.ranges||Bf(e.sel,n.done),o={changes:[Pf(e,t)],generation:n.generation},n.done.push(o);n.done.length>n.undoDepth;)n.done.shift(),n.done[0].ranges||n.done.shift()}n.done.push(i),n.generation=++n.maxGeneration,n.lastModTime=n.lastSelTime=a,n.lastOp=n.lastSelOp=r,n.lastOrigin=n.lastSelOrigin=t.origin,s||hu(e,"historyAdded")}function Rf(e,t,i,r){let n=e.history,o=r&&r.origin;i==n.lastSelOp||o&&n.lastSelOrigin==o&&(n.lastModTime==n.lastSelTime&&n.lastOrigin==o||function(e,t,i,r){let n=t.charAt(0);return"*"==n||"+"==n&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}(e,o,qc(n.done),t))?n.done[n.done.length-1]=t:Bf(t,n.done),n.lastSelTime=+new Date,n.lastSelOrigin=o,n.lastSelOp=i,r&&!1!==r.clearRedo&&Lf(n.undone)}function Bf(e,t){let i=qc(t);i&&i.ranges&&i.equals(e)||t.push(e)}function Of(e,t,i,r){let n=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,r),(i=>{i.markedSpans&&((n||(n=t["spans_"+e.id]={}))[o]=i.markedSpans),++o}))}function Ff(e){if(!e)return null;let t;for(let i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function jf(e,t){let i=function(e,t){let i=t["spans_"+e.id];if(!i)return null;let r=[];for(let e=0;e<t.text.length;++e)r.push(Ff(i[e]));return r}(e,t),r=wh(e,t);if(!i)return r;if(!r)return i;for(let e=0;e<i.length;++e){let t=i[e],n=r[e];if(t&&n)e:for(let e=0;e<n.length;++e){let i=n[e];for(let e=0;e<t.length;++e)if(t[e].marker==i.marker)continue e;t.push(i)}else n&&(i[e]=n)}return i}function $f(e,t,i){let r=[];for(let o=0;o<e.length;++o){let s=e[o];if(s.ranges){r.push(i?gf.prototype.deepCopy.call(s):s);continue}let a=s.changes,l=[];r.push({changes:l});for(let e=0;e<a.length;++e){let i,r=a[e];if(l.push({from:r.from,to:r.to,text:r.text}),t)for(var n in r)(i=n.match(/^spans_(\d+)$/))&&Oc(t,Number(i[1]))>-1&&(qc(l)[n]=r[n],delete r[n])}}return r}function Nf(e,t,i,r){if(r){let r=e.anchor;if(i){let e=Yu(t,r)<0;e!=Yu(i,r)<0?(r=t,t=i):e!=Yu(t,i)<0&&(t=i)}return new yf(r,t)}return new yf(i||t,t)}function Uf(e,t,i,r,n){null==n&&(n=e.cm&&(e.cm.display.shift||e.extend)),Wf(e,new gf([Nf(e.sel.primary(),t,i,n)],0),r)}function Vf(e,t,i){let r=[],n=e.cm&&(e.cm.display.shift||e.extend);for(let i=0;i<e.sel.ranges.length;i++)r[i]=Nf(e.sel.ranges[i],t[i],null,n);Wf(e,_f(e.cm,r,e.sel.primIndex),i)}function Gf(e,t,i,r){let n=e.sel.ranges.slice(0);n[t]=i,Wf(e,_f(e.cm,n,e.sel.primIndex),r)}function qf(e,t,i,r){Wf(e,vf(t,i),r)}function Zf(e,t,i){let r=e.history.done,n=qc(r);n&&n.ranges?(r[r.length-1]=t,Hf(e,t,i)):Wf(e,t,i)}function Wf(e,t,i){Hf(e,t,i),Rf(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function Hf(e,t,i){(fu(e,"beforeSelectionChange")||e.cm&&fu(e.cm,"beforeSelectionChange"))&&(t=function(e,t,i){let r={ranges:t.ranges,update:function(t){this.ranges=[];for(let i=0;i<t.length;i++)this.ranges[i]=new yf(rh(e,t[i].anchor),rh(e,t[i].head))},origin:i&&i.origin};return hu(e,"beforeSelectionChange",e,r),e.cm&&hu(e.cm,"beforeSelectionChange",e.cm,r),r.ranges!=t.ranges?_f(e.cm,r.ranges,r.ranges.length-1):t}(e,t,i));let r=i&&i.bias||(Yu(t.primary().head,e.sel.primary().head)<0?-1:1);Xf(e,Yf(e,t,r,!0)),i&&!1===i.scroll||!e.cm||"nocursor"==e.cm.getOption("readOnly")||Mp(e.cm)}function Xf(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,pu(e.cm)),rd(e,"cursorActivity",e))}function Kf(e){Xf(e,Yf(e,e.sel,null,!1))}function Yf(e,t,i,r){let n;for(let o=0;o<t.ranges.length;o++){let s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Qf(e,s.anchor,a&&a.anchor,i,r),c=Qf(e,s.head,a&&a.head,i,r);(n||l!=s.anchor||c!=s.head)&&(n||(n=t.ranges.slice(0,o)),n[o]=new yf(l,c))}return n?_f(e.cm,n,t.primIndex):t}function Jf(e,t,i,r,n){let o=Uu(e,t.line);if(o.markedSpans)for(let s=0;s<o.markedSpans.length;++s){let a=o.markedSpans[s],l=a.marker,c="selectLeft"in l?!l.selectLeft:l.inclusiveLeft,u="selectRight"in l?!l.selectRight:l.inclusiveRight;if((null==a.from||(c?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(u?a.to>=t.ch:a.to>t.ch))){if(n&&(hu(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(i){let s,a=l.find(r<0?1:-1);if((r<0?u:c)&&(a=em(e,a,-r,a&&a.line==t.line?o:null)),a&&a.line==t.line&&(s=Yu(a,i))&&(r<0?s<0:s>0))return Jf(e,a,t,r,n)}let a=l.find(r<0?-1:1);return(r<0?c:u)&&(a=em(e,a,r,a.line==t.line?o:null)),a?Jf(e,a,t,r,n):null}}return t}function Qf(e,t,i,r,n){let o=r||1,s=Jf(e,t,i,o,n)||!n&&Jf(e,t,i,o,!0)||Jf(e,t,i,-o,n)||!n&&Jf(e,t,i,-o,!0);return s||(e.cantEdit=!0,Ku(e.first,0))}function em(e,t,i,r){return i<0&&0==t.ch?t.line>e.first?rh(e,Ku(t.line-1)):null:i>0&&t.ch==(r||Uu(e,t.line)).text.length?t.line<e.first+e.size-1?Ku(t.line+1,0):null:new Ku(t.line,t.ch+i)}function tm(e){e.setSelection(Ku(e.firstLine(),0),Ku(e.lastLine()),jc)}function im(e,t,i){let r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:()=>r.canceled=!0};return i&&(r.update=(t,i,n,o)=>{t&&(r.from=rh(e,t)),i&&(r.to=rh(e,i)),n&&(r.text=n),void 0!==o&&(r.origin=o)}),hu(e,"beforeChange",e,r),e.cm&&hu(e.cm,"beforeChange",e.cm,r),r.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:r.from,to:r.to,text:r.text,origin:r.origin}}function rm(e,t,i){if(e.cm){if(!e.cm.curOp)return Wp(e.cm,rm)(e,t,i);if(e.cm.state.suppressEdits)return}if((fu(e,"beforeChange")||e.cm&&fu(e.cm,"beforeChange"))&&!(t=im(e,t,!0)))return;let r=yh&&!i&&function(e,t,i){let r=null;if(e.iter(t.line,i.line+1,(e=>{if(e.markedSpans)for(let t=0;t<e.markedSpans.length;++t){let i=e.markedSpans[t].marker;!i.readOnly||r&&-1!=Oc(r,i)||(r||(r=[])).push(i)}})),!r)return null;let n=[{from:t,to:i}];for(let e=0;e<r.length;++e){let t=r[e],i=t.find(0);for(let e=0;e<n.length;++e){let r=n[e];if(Yu(r.to,i.from)<0||Yu(r.from,i.to)>0)continue;let o=[e,1],s=Yu(r.from,i.from),a=Yu(r.to,i.to);(s<0||!t.inclusiveLeft&&!s)&&o.push({from:r.from,to:i.from}),(a>0||!t.inclusiveRight&&!a)&&o.push({from:i.to,to:r.to}),n.splice.apply(n,o),e+=o.length-3}}return n}(e,t.from,t.to);if(r)for(let i=r.length-1;i>=0;--i)nm(e,{from:r[i].from,to:r[i].to,text:i?[""]:t.text,origin:t.origin});else nm(e,t)}function nm(e,t){if(1==t.text.length&&""==t.text[0]&&0==Yu(t.from,t.to))return;let i=wf(e,t);Df(e,t,i,e.cm?e.cm.curOp.id:NaN),am(e,t,i,wh(e,t));let r=[];Ef(e,((e,i)=>{i||-1!=Oc(r,e.history)||(hm(e.history,t),r.push(e.history)),am(e,t,null,wh(e,t))}))}function om(e,t,i){let r=e.cm&&e.cm.state.suppressEdits;if(r&&!i)return;let n,o=e.history,s=e.sel,a="undo"==t?o.done:o.undone,l="undo"==t?o.undone:o.done,c=0;for(;c<a.length&&(n=a[c],i?!n.ranges||n.equals(e.sel):n.ranges);c++);if(c==a.length)return;for(o.lastOrigin=o.lastSelOrigin=null;;){if(n=a.pop(),!n.ranges){if(r)return void a.push(n);break}if(Bf(n,l),i&&!n.equals(e.sel))return void Wf(e,n,{clearRedo:!1});s=n}let u=[];Bf(s,l),l.push({changes:u,generation:o.generation}),o.generation=n.generation||++o.maxGeneration;let h=fu(e,"beforeChange")||e.cm&&fu(e.cm,"beforeChange");for(let i=n.changes.length-1;i>=0;--i){let r=n.changes[i];if(r.origin=t,h&&!im(e,r,!1))return void(a.length=0);u.push(Pf(e,r));let o=i?wf(e,r):qc(a);am(e,r,o,jf(e,r)),!i&&e.cm&&e.cm.scrollIntoView({from:r.from,to:xf(r)});let s=[];Ef(e,((e,t)=>{t||-1!=Oc(s,e.history)||(hm(e.history,r),s.push(e.history)),am(e,r,null,jf(e,r))}))}}function sm(e,t){if(0!=t&&(e.first+=t,e.sel=new gf(Zc(e.sel.ranges,(e=>new yf(Ku(e.anchor.line+t,e.anchor.ch),Ku(e.head.line+t,e.head.ch)))),e.sel.primIndex),e.cm)){sp(e.cm,e.first,e.first-t,t);for(let t=e.cm.display,i=t.viewFrom;i<t.viewTo;i++)ap(e.cm,i,"gutter")}}function am(e,t,i,r){if(e.cm&&!e.cm.curOp)return Wp(e.cm,am)(e,t,i,r);if(t.to.line<e.first)return void sm(e,t.text.length-1-(t.to.line-t.from.line));if(t.from.line>e.lastLine())return;if(t.from.line<e.first){let i=t.text.length-1-(e.first-t.from.line);sm(e,i),t={from:Ku(e.first,0),to:Ku(t.to.line+i,t.to.ch),text:[qc(t.text)],origin:t.origin}}let n=e.lastLine();t.to.line>n&&(t={from:t.from,to:Ku(n,Uu(e,n).text.length),text:[t.text[0]],origin:t.origin}),t.removed=Vu(e,t.from,t.to),i||(i=wf(e,t)),e.cm?function(e,t,i){let r=e.doc,n=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=Zu(Dh(Uu(r,o.line))),r.iter(l,s.line+1,(e=>{if(e==n.maxLine)return a=!0,!0})));r.sel.contains(t.from,t.to)>-1&&pu(e);kf(r,t,i,ip(e)),e.options.lineWrapping||(r.iter(l,o.line+t.text.length,(e=>{let t=$h(e);t>n.maxLineLength&&(n.maxLine=e,n.maxLineLength=t,n.maxLineChanged=!0,a=!1)})),a&&(e.curOp.updateMaxLine=!0));(function(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),e.highlightFrontier<t-10)return;let i=e.first;for(let r=t-1;r>i;r--){let n=Uu(e,r).stateAfter;if(n&&(!(n instanceof oh)||r+n.lookAhead<t)){i=r+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)})(r,o.line),Kp(e,400);let c=t.text.length-(s.line-o.line)-1;t.full?sp(e):o.line!=s.line||1!=t.text.length||Mf(e.doc,t)?sp(e,o.line,s.line+1,c):ap(e,o.line,"text");let u=fu(e,"changes"),h=fu(e,"change");if(h||u){let i={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};h&&rd(e,"change",e,i),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(i)}e.display.selForContextMenu=null}(e.cm,t,r):kf(e,t,r),Hf(e,i,jc),e.cantEdit&&Qf(e,Ku(e.firstLine(),0))&&(e.cantEdit=!1)}function lm(e,t,i,r,n){r||(r=i),Yu(r,i)<0&&([i,r]=[r,i]),"string"==typeof t&&(t=e.splitLines(t)),rm(e,{from:i,to:r,text:t,origin:n})}function cm(e,t,i,r){i<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function um(e,t,i,r){for(let n=0;n<e.length;++n){let o=e[n],s=!0;if(o.ranges){o.copied||(o=e[n]=o.deepCopy(),o.copied=!0);for(let e=0;e<o.ranges.length;e++)cm(o.ranges[e].anchor,t,i,r),cm(o.ranges[e].head,t,i,r)}else{for(let e=0;e<o.changes.length;++e){let n=o.changes[e];if(i<n.from.line)n.from=Ku(n.from.line+r,n.from.ch),n.to=Ku(n.to.line+r,n.to.ch);else if(t<=n.to.line){s=!1;break}}s||(e.splice(0,n+1),n=0)}}}function hm(e,t){let i=t.from.line,r=t.to.line,n=t.text.length-(r-i)-1;um(e.done,i,r,n),um(e.undone,i,r,n)}function dm(e,t,i,r){let n=t,o=t;return"number"==typeof t?o=Uu(e,ih(e,t)):n=Zu(t),null==n?null:(r(o,n)&&e.cm&&ap(e.cm,n,i),o)}function pm(e){this.lines=e,this.parent=null;let t=0;for(let i=0;i<e.length;++i)e[i].parent=this,t+=e[i].height;this.height=t}function fm(e){this.children=e;let t=0,i=0;for(let r=0;r<e.length;++r){let n=e[r];t+=n.chunkSize(),i+=n.height,n.parent=this}this.size=t,this.height=i,this.parent=null}pm.prototype={chunkSize(){return this.lines.length},removeInner(e,t){for(let i=e,r=e+t;i<r;++i){let e=this.lines[i];this.height-=e.height,Vh(e),rd(e,"delete")}this.lines.splice(e,t)},collapse(e){e.push.apply(e,this.lines)},insertInner(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(let e=0;e<t.length;++e)t[e].parent=this},iterN(e,t,i){for(let r=e+t;e<r;++e)if(i(this.lines[e]))return!0}},fm.prototype={chunkSize(){return this.size},removeInner(e,t){this.size-=t;for(let i=0;i<this.children.length;++i){let r=this.children[i],n=r.chunkSize();if(e<n){let o=Math.min(t,n-e),s=r.height;if(r.removeInner(e,o),this.height-=s-r.height,n==o&&(this.children.splice(i--,1),r.parent=null),0==(t-=o))break;e=0}else e-=n}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof pm))){let e=[];this.collapse(e),this.children=[new pm(e)],this.children[0].parent=this}},collapse(e){for(let t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner(e,t,i){this.size+=t.length,this.height+=i;for(let r=0;r<this.children.length;++r){let n=this.children[r],o=n.chunkSize();if(e<=o){if(n.insertInner(e,t,i),n.lines&&n.lines.length>50){let e=n.lines.length%25+25;for(let t=e;t<n.lines.length;){let e=new pm(n.lines.slice(t,t+=25));n.height-=e.height,this.children.splice(++r,0,e),e.parent=this}n.lines=n.lines.slice(0,e),this.maybeSpill()}break}e-=o}},maybeSpill(){if(this.children.length<=10)return;let e=this;do{let t=new fm(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;let i=Oc(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{let i=new fm(e.children);i.parent=e,e.children=[i,t],e=i}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iterN(e,t,i){for(let r=0;r<this.children.length;++r){let n=this.children[r],o=n.chunkSize();if(e<o){let r=Math.min(t,o-e);if(n.iterN(e,r,i))return!0;if(0==(t-=r))break;e=0}else e-=o}}};class mm{constructor(e,t,i){if(i)for(let e in i)i.hasOwnProperty(e)&&(this[e]=i[e]);this.doc=e,this.node=t}clear(){let e=this.doc.cm,t=this.line.widgets,i=this.line,r=Zu(i);if(null==r||!t)return;for(let e=0;e<t.length;++e)t[e]==this&&t.splice(e--,1);t.length||(i.widgets=null);let n=gd(this);qu(i,Math.max(0,i.height-n)),e&&(Zp(e,(()=>{gm(e,i,-n),ap(e,r,"widget")})),rd(e,"lineWidgetCleared",e,this,r))}changed(){let e=this.height,t=this.doc.cm,i=this.line;this.height=null;let r=gd(this)-e;r&&(Oh(this.doc,i)||qu(i,i.height+r),t&&Zp(t,(()=>{t.curOp.forceUpdate=!0,gm(t,i,r),rd(t,"lineWidgetChanged",t,this,Zu(i))})))}}function gm(e,t,i){jh(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Cp(e,i)}mu(mm);let ym=0;class _m{constructor(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++ym}clear(){if(this.explicitlyCleared)return;let e=this.doc.cm,t=e&&!e.curOp;if(t&&jp(e),fu(this,"clear")){let e=this.find();e&&rd(this,"clear",e.from,e.to)}let i=null,r=null;for(let t=0;t<this.lines.length;++t){let n=this.lines[t],o=xh(n.markedSpans,this);e&&!this.collapsed?ap(e,Zu(n),"text"):e&&(null!=o.to&&(r=Zu(n)),null!=o.from&&(i=Zu(n))),n.markedSpans=bh(n.markedSpans,o),null==o.from&&this.collapsed&&!Oh(this.doc,n)&&e&&qu(n,Jd(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(let t=0;t<this.lines.length;++t){let i=Dh(this.lines[t]),r=$h(i);r>e.display.maxLineLength&&(e.display.maxLine=i,e.display.maxLineLength=r,e.display.maxLineChanged=!0)}null!=i&&e&&this.collapsed&&sp(e,i,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Kf(e.doc)),e&&rd(e,"markerCleared",e,this,i,r),t&&$p(e),this.parent&&this.parent.clear()}find(e,t){let i,r;null==e&&"bookmark"==this.type&&(e=1);for(let n=0;n<this.lines.length;++n){let o=this.lines[n],s=xh(o.markedSpans,this);if(null!=s.from&&(i=Ku(t?o:Zu(o),s.from),-1==e))return i;if(null!=s.to&&(r=Ku(t?o:Zu(o),s.to),1==e))return r}return i&&{from:i,to:r}}changed(){let e=this.find(-1,!0),t=this,i=this.doc.cm;e&&i&&Zp(i,(()=>{let r=e.line,n=Zu(e.line),o=Md(i,n);if(o&&(Ld(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!Oh(t.doc,r)&&null!=t.height){let e=t.height;t.height=null;let i=gd(t)-e;i&&qu(r,r.height+i)}rd(i,"markerChanged",i,this)}))}attachLine(e){if(!this.lines.length&&this.doc.cm){let e=this.doc.cm.curOp;e.maybeHiddenMarkers&&-1!=Oc(e.maybeHiddenMarkers,this)||(e.maybeUnhiddenMarkers||(e.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)}detachLine(e){if(this.lines.splice(Oc(this.lines,e),1),!this.lines.length&&this.doc.cm){let e=this.doc.cm.curOp;(e.maybeHiddenMarkers||(e.maybeHiddenMarkers=[])).push(this)}}}function vm(e,t,i,r,n){if(r&&r.shared)return function(e,t,i,r,n){(r=Dc(r)).shared=!1;let o=[vm(e,t,i,r,n)],s=o[0],a=r.widgetNode;return Ef(e,(e=>{a&&(r.widgetNode=a.cloneNode(!0)),o.push(vm(e,rh(e,t),rh(e,i),r,n));for(let t=0;t<e.linked.length;++t)if(e.linked[t].isParent)return;s=qc(o)})),new xm(o,s)}(e,t,i,r,n);if(e.cm&&!e.cm.curOp)return Wp(e.cm,vm)(e,t,i,r,n);let o=new _m(e,n),s=Yu(t,i);if(r&&Dc(r,o,!1),s>0||0==s&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=kc("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),r.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Lh(e,t.line,t,i,o)||t.line!=i.line&&Lh(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");_h=!0}o.addToHistory&&Df(e,{from:t,to:i,origin:"markText"},e.sel,NaN);let a,l=t.line,c=e.cm;if(e.iter(l,i.line+1,(r=>{c&&o.collapsed&&!c.options.lineWrapping&&Dh(r)==c.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&qu(r,0),function(e,t,i){let r=i&&window.WeakSet&&(i.markedSpans||(i.markedSpans=new WeakSet));r&&e.markedSpans&&r.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],r&&r.add(e.markedSpans)),t.marker.attachLine(e)}(r,new vh(o,l==t.line?t.ch:null,l==i.line?i.ch:null),e.cm&&e.cm.curOp),++l})),o.collapsed&&e.iter(t.line,i.line+1,(t=>{Oh(e,t)&&qu(t,0)})),o.clearOnEnter&&lu(o,"beforeCursorEnter",(()=>o.clear())),o.readOnly&&(yh=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++ym,o.atomic=!0),c){if(a&&(c.curOp.updateMaxLine=!0),o.collapsed)sp(c,t.line,i.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(let e=t.line;e<=i.line;e++)ap(c,e,"text");o.atomic&&Kf(c.doc),rd(c,"markerAdded",c,o)}return o}mu(_m);class xm{constructor(e,t){this.markers=e,this.primary=t;for(let t=0;t<e.length;++t)e[t].parent=this}clear(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(let e=0;e<this.markers.length;++e)this.markers[e].clear();rd(this,"clear")}}find(e,t){return this.primary.find(e,t)}}function bm(e){return e.findMarks(Ku(e.first,0),e.clipPos(Ku(e.lastLine())),(e=>e.parent))}function wm(e){for(let t=0;t<e.length;t++){let i=e[t],r=[i.primary.doc];Ef(i.primary.doc,(e=>r.push(e)));for(let e=0;e<i.markers.length;e++){let t=i.markers[e];-1==Oc(r,t.doc)&&(t.parent=null,i.markers.splice(e--,1))}}}mu(xm);let Tm=0,Sm=function(e,t,i,r,n){if(!(this instanceof Sm))return new Sm(e,t,i,r,n);null==i&&(i=0),fm.call(this,[new pm([new Uh("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;let o=Ku(i,0);this.sel=vf(o),this.history=new zf(null),this.id=++Tm,this.modeOption=t,this.lineSep=r,this.direction="rtl"==n?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),kf(this,{from:o,to:o,text:e}),Wf(this,vf(o),jc)};Sm.prototype=Hc(fm.prototype,{constructor:Sm,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){let i=0;for(let e=0;e<t.length;++e)i+=t[e].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){let t=Gu(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:Xp((function(e){let t=Ku(this.first,0),i=this.first+this.size-1;rm(this,{from:t,to:Ku(i,Uu(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&kp(this.cm,0,0),Wf(this,vf(t),jc)})),replaceRange:function(e,t,i,r){lm(this,e,t=rh(this,t),i=i?rh(this,i):t,r)},getRange:function(e,t,i){let r=Vu(this,rh(this,e),rh(this,t));return!1===i?r:""===i?r.join(""):r.join(i||this.lineSeparator())},getLine:function(e){let t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(Hu(this,e))return Uu(this,e)},getLineNumber:function(e){return Zu(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=Uu(this,e)),Dh(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return rh(this,e)},getCursor:function(e){let t,i=this.sel.primary();return t=null==e||"head"==e?i.head:"anchor"==e?i.anchor:"end"==e||"to"==e||!1===e?i.to():i.from(),t},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Xp((function(e,t,i){qf(this,rh(this,"number"==typeof e?Ku(e,t||0):e),null,i)})),setSelection:Xp((function(e,t,i){qf(this,rh(this,e),rh(this,t||e),i)})),extendSelection:Xp((function(e,t,i){Uf(this,rh(this,e),t&&rh(this,t),i)})),extendSelections:Xp((function(e,t){Vf(this,nh(this,e),t)})),extendSelectionsBy:Xp((function(e,t){Vf(this,nh(this,Zc(this.sel.ranges,e)),t)})),setSelections:Xp((function(e,t,i){if(!e.length)return;let r=[];for(let t=0;t<e.length;t++)r[t]=new yf(rh(this,e[t].anchor),rh(this,e[t].head||e[t].anchor));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),Wf(this,_f(this.cm,r,t),i)})),addSelection:Xp((function(e,t,i){let r=this.sel.ranges.slice(0);r.push(new yf(rh(this,e),rh(this,t||e))),Wf(this,_f(this.cm,r,r.length-1),i)})),getSelection:function(e){let t,i=this.sel.ranges;for(let e=0;e<i.length;e++){let r=Vu(this,i[e].from(),i[e].to());t=t?t.concat(r):r}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){let t=[],i=this.sel.ranges;for(let r=0;r<i.length;r++){let n=Vu(this,i[r].from(),i[r].to());!1!==e&&(n=n.join(e||this.lineSeparator())),t[r]=n}return t},replaceSelection:function(e,t,i){let r=[];for(let t=0;t<this.sel.ranges.length;t++)r[t]=e;this.replaceSelections(r,t,i||"+input")},replaceSelections:Xp((function(e,t,i){let r=[],n=this.sel;for(let t=0;t<n.ranges.length;t++){let o=n.ranges[t];r[t]={from:o.from(),to:o.to(),text:this.splitLines(e[t]),origin:i}}let o=t&&"end"!=t&&function(e,t,i){let r=[],n=Ku(e.first,0),o=n;for(let s=0;s<t.length;s++){let a=t[s],l=Tf(a.from,n,o),c=Tf(xf(a),n,o);if(n=a.to,o=c,"around"==i){let t=e.sel.ranges[s],i=Yu(t.head,t.anchor)<0;r[s]=new yf(i?c:l,i?l:c)}else r[s]=new yf(l,l)}return new gf(r,e.sel.primIndex)}(this,r,t);for(let e=r.length-1;e>=0;e--)rm(this,r[e]);o?Zf(this,o):this.cm&&Mp(this.cm)})),undo:Xp((function(){om(this,"undo")})),redo:Xp((function(){om(this,"redo")})),undoSelection:Xp((function(){om(this,"undo",!0)})),redoSelection:Xp((function(){om(this,"redo",!0)})),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){let e=this.history,t=0,i=0;for(let i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(let t=0;t<e.undone.length;t++)e.undone[t].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new zf(this.history),Ef(this,(e=>e.history=this.history),!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:$f(this.history.done),undone:$f(this.history.undone)}},setHistory:function(e){let t=this.history=new zf(this.history);t.done=$f(e.done.slice(0),null,!0),t.undone=$f(e.undone.slice(0),null,!0)},setGutterMarker:Xp((function(e,t,i){return dm(this,e,"gutter",(e=>{let r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=i,!i&&Jc(r)&&(e.gutterMarkers=null),!0}))})),clearGutter:Xp((function(e){this.iter((t=>{t.gutterMarkers&&t.gutterMarkers[e]&&dm(this,t,"gutter",(()=>(t.gutterMarkers[e]=null,Jc(t.gutterMarkers)&&(t.gutterMarkers=null),!0)))}))})),lineInfo:function(e){let t;if("number"==typeof e){if(!Hu(this,e))return null;if(t=e,!(e=Uu(this,e)))return null}else if(t=Zu(e),null==t)return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:Xp((function(e,t,i){return dm(this,e,"gutter"==t?"gutter":"class",(e=>{let r="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass";if(e[r]){if(bc(i).test(e[r]))return!1;e[r]+=" "+i}else e[r]=i;return!0}))})),removeLineClass:Xp((function(e,t,i){return dm(this,e,"gutter"==t?"gutter":"class",(e=>{let r="text"==t?"textClass":"background"==t?"bgClass":"gutter"==t?"gutterClass":"wrapClass",n=e[r];if(!n)return!1;if(null==i)e[r]=null;else{let t=n.match(bc(i));if(!t)return!1;let o=t.index+t[0].length;e[r]=n.slice(0,t.index)+(t.index&&o!=n.length?" ":"")+n.slice(o)||null}return!0}))})),addLineWidget:Xp((function(e,t,i){return function(e,t,i,r){let n=new mm(e,i,r),o=e.cm;return o&&n.noHScroll&&(o.display.alignWidgets=!0),dm(e,t,"widget",(t=>{let i=t.widgets||(t.widgets=[]);if(null==n.insertAt?i.push(n):i.splice(Math.min(i.length,Math.max(0,n.insertAt)),0,n),n.line=t,o&&!Oh(e,t)){let i=jh(t)<e.scrollTop;qu(t,t.height+gd(n)),i&&Cp(o,n.height),o.curOp.forceUpdate=!0}return!0})),o&&rd(o,"lineWidgetAdded",o,n,"number"==typeof t?t:Zu(t)),n}(this,e,t,i)})),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return vm(this,rh(this,e),rh(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){let i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return vm(this,e=rh(this,e),e,i,"bookmark")},findMarksAt:function(e){let t=[],i=Uu(this,(e=rh(this,e)).line).markedSpans;if(i)for(let r=0;r<i.length;++r){let n=i[r];(null==n.from||n.from<=e.ch)&&(null==n.to||n.to>=e.ch)&&t.push(n.marker.parent||n.marker)}return t},findMarks:function(e,t,i){e=rh(this,e),t=rh(this,t);let r=[],n=e.line;return this.iter(e.line,t.line+1,(o=>{let s=o.markedSpans;if(s)for(let o=0;o<s.length;o++){let a=s[o];null!=a.to&&n==e.line&&e.ch>=a.to||null==a.from&&n!=e.line||null!=a.from&&n==t.line&&a.from>=t.ch||i&&!i(a.marker)||r.push(a.marker.parent||a.marker)}++n})),r},getAllMarks:function(){let e=[];return this.iter((t=>{let i=t.markedSpans;if(i)for(let t=0;t<i.length;++t)null!=i[t].from&&e.push(i[t].marker)})),e},posFromIndex:function(e){let t,i=this.first,r=this.lineSeparator().length;return this.iter((n=>{let o=n.text.length+r;if(o>e)return t=e,!0;e-=o,++i})),rh(this,Ku(i,t))},indexFromPos:function(e){let t=(e=rh(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;let i=this.lineSeparator().length;return this.iter(this.first,e.line,(e=>{t+=e.text.length+i})),t},copy:function(e){let t=new Sm(Gu(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});let t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);let r=new Sm(Gu(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],function(e,t){for(let i=0;i<t.length;i++){let r=t[i],n=r.find(),o=e.clipPos(n.from),s=e.clipPos(n.to);if(Yu(o,s)){let t=vm(e,o,s,r.primary,r.primary.type);r.markers.push(t),t.parent=r}}}(r,bm(this)),r},unlinkDoc:function(e){if(e instanceof yg&&(e=e.doc),this.linked)for(let t=0;t<this.linked.length;++t){if(this.linked[t].doc==e){this.linked.splice(t,1),e.unlinkDoc(this),wm(bm(this));break}}if(e.history==this.history){let t=[e.id];Ef(e,(e=>t.push(e.id)),!0),e.history=new zf(null),e.history.done=$f(this.history.done,t),e.history.undone=$f(this.history.undone,t)}},iterLinkedDocs:function(e){Ef(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):ku(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Xp((function(e){var t;("rtl"!=e&&(e="ltr"),e!=this.direction)&&(this.direction=e,this.iter((e=>e.order=null)),this.cm&&Zp(t=this.cm,(()=>{If(t),sp(t)})))}))}),Sm.prototype.eachLine=Sm.prototype.iter;let Cm=0;function Mm(e){let t=this;if(km(t),du(t,e)||yd(t.display,e))return;gu(e),ic&&(Cm=+new Date);let i=np(t,e,!0),r=e.dataTransfer.files;if(i&&!t.isReadOnly())if(r&&r.length&&window.FileReader&&window.File){let e=r.length,n=Array(e),o=0;const s=()=>{++o==e&&Wp(t,(()=>{i=rh(t.doc,i);let e={from:i,to:i,text:t.doc.splitLines(n.filter((e=>null!=e)).join(t.doc.lineSeparator())),origin:"paste"};rm(t.doc,e),Zf(t.doc,vf(rh(t.doc,i),rh(t.doc,xf(e))))}))()},a=(e,i)=>{if(t.options.allowDropFileTypes&&-1==Oc(t.options.allowDropFileTypes,e.type))return void s();let r=new FileReader;r.onerror=()=>s(),r.onload=()=>{let e=r.result;/[\x00-\x08\x0e-\x1f]{2}/.test(e)||(n[i]=e),s()},r.readAsText(e)};for(let e=0;e<r.length;e++)a(r[e],e)}else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout((()=>t.display.input.focus()),20);try{let r=e.dataTransfer.getData("Text");if(r){let e;if(t.state.draggingText&&!t.state.draggingText.copy&&(e=t.listSelections()),Hf(t.doc,vf(i,i)),e)for(let i=0;i<e.length;++i)lm(t.doc,"",e[i].anchor,e[i].head,"drag");t.replaceSelection(r,"around","paste"),t.display.input.focus()}}catch(e){}}}function km(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Em(e){if(!document.getElementsByClassName)return;let t=document.getElementsByClassName("CodeMirror"),i=[];for(let e=0;e<t.length;e++){let r=t[e].CodeMirror;r&&i.push(r)}i.length&&i[0].operation((()=>{for(let t=0;t<i.length;t++)e(i[t])}))}let Am=!1;function Im(){Am||(!function(){let e;lu(window,"resize",(()=>{null==e&&(e=setTimeout((()=>{e=null,Em(zm)}),100))})),lu(window,"blur",(()=>Em(xp)))}(),Am=!0)}function zm(e){let t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}let Pm={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(let e=0;e<10;e++)Pm[e+48]=Pm[e+96]=String(e);for(let e=65;e<=90;e++)Pm[e]=String.fromCharCode(e);for(let e=1;e<=12;e++)Pm[e+111]=Pm[e+63235]="F"+e;let Lm={};function Dm(e){let t,i,r,n,o=e.split(/-(?!$)/);e=o[o.length-1];for(let e=0;e<o.length-1;e++){let s=o[e];if(/^(cmd|meta|m)$/i.test(s))n=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))i=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);r=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),n&&(e="Cmd-"+e),r&&(e="Shift-"+e),e}function Rm(e){let t={};for(let i in e)if(e.hasOwnProperty(i)){let r=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==r){delete e[i];continue}let n=Zc(i.split(" "),Dm);for(let e=0;e<n.length;e++){let i,o;e==n.length-1?(o=n.join(" "),i=r):(o=n.slice(0,e+1).join(" "),i="...");let s=t[o];if(s){if(s!=i)throw new Error("Inconsistent bindings for "+o)}else t[o]=i}delete e[i]}for(let i in t)e[i]=t[i];return e}function Bm(e,t,i,r){let n=(t=$m(t)).call?t.call(e,r):t[e];if(!1===n)return"nothing";if("..."===n)return"multi";if(null!=n&&i(n))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return Bm(e,t.fallthrough,i,r);for(let n=0;n<t.fallthrough.length;n++){let o=Bm(e,t.fallthrough[n],i,r);if(o)return o}}}function Om(e){let t="string"==typeof e?e:Pm[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function Fm(e,t,i){let r=e;return t.altKey&&"Alt"!=r&&(e="Alt-"+e),(vc?t.metaKey:t.ctrlKey)&&"Ctrl"!=r&&(e="Ctrl-"+e),(vc?t.ctrlKey:t.metaKey)&&"Mod"!=r&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=r&&(e="Shift-"+e),e}function jm(e,t){if(lc&&34==e.keyCode&&e.char)return!1;let i=Pm[e.keyCode];return null!=i&&!e.altGraphKey&&(3==e.keyCode&&e.code&&(i=e.code),Fm(i,e,t))}function $m(e){return"string"==typeof e?Lm[e]:e}function Nm(e,t){let i=e.doc.sel.ranges,r=[];for(let e=0;e<i.length;e++){let n=t(i[e]);for(;r.length&&Yu(n.from,qc(r).to)<=0;){let e=r.pop();if(Yu(e.from,n.from)<0){n.from=e.from;break}}r.push(n)}Zp(e,(()=>{for(let t=r.length-1;t>=0;t--)lm(e.doc,"",r[t].from,r[t].to,"+delete");Mp(e)}))}function Um(e,t,i){let r=tu(e.text,t+i,i);return r<0||r>e.text.length?null:r}function Vm(e,t,i){let r=Um(e,t.ch,i);return null==r?null:new Ku(t.line,r,i<0?"after":"before")}function Gm(e,t,i,r,n){if(e){"rtl"==t.doc.direction&&(n=-n);let e=su(i,t.doc.direction);if(e){let o,s=n<0?qc(e):e[0],a=n<0==(1==s.level)?"after":"before";if(s.level>0||"rtl"==t.doc.direction){let e=kd(t,i);o=n<0?i.text.length-1:0;let r=Ed(t,e,o).top;o=iu((i=>Ed(t,e,i).top==r),n<0==(1==s.level)?s.from:s.to-1,o),"before"==a&&(o=Um(i,o,1))}else o=n<0?s.to:s.from;return new Ku(r,o,a)}}return new Ku(r,n<0?i.text.length:0,n<0?"before":"after")}Lm.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Lm.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Lm.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Lm.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Lm.default=mc?Lm.macDefault:Lm.pcDefault;let qm={selectAll:tm,singleSelection:e=>e.setSelection(e.getCursor("anchor"),e.getCursor("head"),jc),killLine:e=>Nm(e,(t=>{if(t.empty()){let i=Uu(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:Ku(t.head.line+1,0)}:{from:t.head,to:Ku(t.head.line,i)}}return{from:t.from(),to:t.to()}})),deleteLine:e=>Nm(e,(t=>({from:Ku(t.from().line,0),to:rh(e.doc,Ku(t.to().line+1,0))}))),delLineLeft:e=>Nm(e,(e=>({from:Ku(e.from().line,0),to:e.from()}))),delWrappedLineLeft:e=>Nm(e,(t=>{let i=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:i},"div"),to:t.from()}})),delWrappedLineRight:e=>Nm(e,(t=>{let i=e.charCoords(t.head,"div").top+5,r=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div");return{from:t.from(),to:r}})),undo:e=>e.undo(),redo:e=>e.redo(),undoSelection:e=>e.undoSelection(),redoSelection:e=>e.redoSelection(),goDocStart:e=>e.extendSelection(Ku(e.firstLine(),0)),goDocEnd:e=>e.extendSelection(Ku(e.lastLine())),goLineStart:e=>e.extendSelectionsBy((t=>Zm(e,t.head.line)),{origin:"+move",bias:1}),goLineStartSmart:e=>e.extendSelectionsBy((t=>Wm(e,t.head)),{origin:"+move",bias:1}),goLineEnd:e=>e.extendSelectionsBy((t=>function(e,t){let i=Uu(e.doc,t),r=function(e){let t;for(;t=zh(e);)e=t.find(1,!0).line;return e}(i);r!=i&&(t=Zu(r));return Gm(!0,e,i,t,-1)}(e,t.head.line)),{origin:"+move",bias:-1}),goLineRight:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")}),Nc),goLineLeft:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")}),Nc),goLineLeftSmart:e=>e.extendSelectionsBy((t=>{let i=e.cursorCoords(t.head,"div").top+5,r=e.coordsChar({left:0,top:i},"div");return r.ch<e.getLine(r.line).search(/\S/)?Wm(e,t.head):r}),Nc),goLineUp:e=>e.moveV(-1,"line"),goLineDown:e=>e.moveV(1,"line"),goPageUp:e=>e.moveV(-1,"page"),goPageDown:e=>e.moveV(1,"page"),goCharLeft:e=>e.moveH(-1,"char"),goCharRight:e=>e.moveH(1,"char"),goColumnLeft:e=>e.moveH(-1,"column"),goColumnRight:e=>e.moveH(1,"column"),goWordLeft:e=>e.moveH(-1,"word"),goGroupRight:e=>e.moveH(1,"group"),goGroupLeft:e=>e.moveH(-1,"group"),goWordRight:e=>e.moveH(1,"word"),delCharBefore:e=>e.deleteH(-1,"codepoint"),delCharAfter:e=>e.deleteH(1,"char"),delWordBefore:e=>e.deleteH(-1,"word"),delWordAfter:e=>e.deleteH(1,"word"),delGroupBefore:e=>e.deleteH(-1,"group"),delGroupAfter:e=>e.deleteH(1,"group"),indentAuto:e=>e.indentSelection("smart"),indentMore:e=>e.indentSelection("add"),indentLess:e=>e.indentSelection("subtract"),insertTab:e=>e.replaceSelection("\t"),insertSoftTab:e=>{let t=[],i=e.listSelections(),r=e.options.tabSize;for(let n=0;n<i.length;n++){let o=i[n].from(),s=Rc(e.getLine(o.line),o.ch,r);t.push(Gc(r-s%r))}e.replaceSelections(t)},defaultTab:e=>{e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:e=>Zp(e,(()=>{let t=e.listSelections(),i=[];for(let r=0;r<t.length;r++){if(!t[r].empty())continue;let n=t[r].head,o=Uu(e.doc,n.line).text;if(o)if(n.ch==o.length&&(n=new Ku(n.line,n.ch-1)),n.ch>0)n=new Ku(n.line,n.ch+1),e.replaceRange(o.charAt(n.ch-1)+o.charAt(n.ch-2),Ku(n.line,n.ch-2),n,"+transpose");else if(n.line>e.doc.first){let t=Uu(e.doc,n.line-1).text;t&&(n=new Ku(n.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+t.charAt(t.length-1),Ku(n.line-1,t.length-1),n,"+transpose"))}i.push(new yf(n,n))}e.setSelections(i)})),newlineAndIndent:e=>Zp(e,(()=>{let t=e.listSelections();for(let i=t.length-1;i>=0;i--)e.replaceRange(e.doc.lineSeparator(),t[i].anchor,t[i].head,"+input");t=e.listSelections();for(let i=0;i<t.length;i++)e.indentLine(t[i].from().line,null,!0);Mp(e)})),openLine:e=>e.replaceSelection("\n","start"),toggleOverwrite:e=>e.toggleOverwrite()};function Zm(e,t){let i=Uu(e.doc,t),r=Dh(i);return r!=i&&(t=Zu(r)),Gm(!0,e,r,t,1)}function Wm(e,t){let i=Zm(e,t.line),r=Uu(e.doc,i.line),n=su(r,e.doc.direction);if(!n||0==n[0].level){let e=Math.max(i.ch,r.text.search(/\S/)),n=t.line==i.line&&t.ch<=e&&t.ch;return Ku(i.line,n?0:e,i.sticky)}return i}function Hm(e,t,i){if("string"==typeof t&&!(t=qm[t]))return!1;e.display.input.ensurePolled();let r=e.display.shift,n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),n=t(e)!=Fc}finally{e.display.shift=r,e.state.suppressEdits=!1}return n}let Xm=new Bc;function Km(e,t,i,r){let n=e.state.keySeq;if(n){if(Om(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:Xm.set(50,(()=>{e.state.keySeq==n&&(e.state.keySeq=null,e.display.input.reset())})),Ym(e,n+" "+t,i,r))return!0}return Ym(e,t,i,r)}function Ym(e,t,i,r){let n=function(e,t,i){for(let r=0;r<e.state.keyMaps.length;r++){let n=Bm(t,e.state.keyMaps[r],i,e);if(n)return n}return e.options.extraKeys&&Bm(t,e.options.extraKeys,i,e)||Bm(t,e.options.keyMap,i,e)}(e,t,r);return"multi"==n&&(e.state.keySeq=t),"handled"==n&&rd(e,"keyHandled",e,t,i),"handled"!=n&&"multi"!=n||(gu(i),gp(e)),!!n}function Jm(e,t){let i=jm(t,!0);return!!i&&(t.shiftKey&&!e.state.keySeq?Km(e,"Shift-"+i,t,(t=>Hm(e,t,!0)))||Km(e,i,t,(t=>{if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return Hm(e,t)})):Km(e,i,t,(t=>Hm(e,t))))}let Qm=null;function eg(e){let t=this;if(e.target&&e.target!=t.display.input.getField())return;if(t.curOp.focus=Ac(),du(t,e))return;ic&&rc<11&&27==e.keyCode&&(e.returnValue=!1);let i=e.keyCode;t.display.shift=16==i||e.shiftKey;let r=Jm(t,e);lc&&(Qm=r?i:null,r||88!=i||Au||!(mc?e.metaKey:e.ctrlKey)||t.replaceSelection("",null,"cut")),Jl&&!mc&&!r&&46==i&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||function(e){let t=e.display.lineDiv;function i(e){18!=e.keyCode&&e.altKey||(Tc(t,"CodeMirror-crosshair"),uu(document,"keyup",i),uu(document,"mouseover",i))}Ic(t,"CodeMirror-crosshair"),lu(document,"keyup",i),lu(document,"mouseover",i)}(t)}function tg(e){16==e.keyCode&&(this.doc.sel.shift=!1),du(this,e)}function ig(e){let t=this;if(e.target&&e.target!=t.display.input.getField())return;if(yd(t.display,e)||du(t,e)||e.ctrlKey&&!e.altKey||mc&&e.metaKey)return;let i=e.keyCode,r=e.charCode;if(lc&&i==Qm)return Qm=null,void gu(e);if(lc&&(!e.which||e.which<10)&&Jm(t,e))return;let n=String.fromCharCode(null==r?i:r);"\b"!=n&&(function(e,t,i){return Km(e,"'"+i+"'",t,(t=>Hm(e,t,!0)))}(t,e,n)||t.display.input.onKeyPress(e))}class rg{constructor(e,t,i){this.time=e,this.pos=t,this.button=i}compare(e,t,i){return this.time+400>e&&0==Yu(t,this.pos)&&i==this.button}}let ng,og;function sg(e){let t=this,i=t.display;if(du(t,e)||i.activeTouch&&i.input.supportsTouch())return;if(i.input.ensurePolled(),i.shift=e.shiftKey,yd(i,e))return void(nc||(i.scroller.draggable=!1,setTimeout((()=>i.scroller.draggable=!0),100)));if(cg(t,e))return;let r=np(t,e),n=bu(e),o=r?function(e,t){let i=+new Date;return og&&og.compare(i,e,t)?(ng=og=null,"triple"):ng&&ng.compare(i,e,t)?(og=new rg(i,e,t),ng=null,"double"):(ng=new rg(i,e,t),og=null,"single")}(r,n):"single";window.focus(),1==n&&t.state.selectingText&&t.state.selectingText(e),r&&function(e,t,i,r,n){let o="Click";"double"==r?o="Double"+o:"triple"==r&&(o="Triple"+o);return o=(1==t?"Left":2==t?"Middle":"Right")+o,Km(e,Fm(o,n),n,(t=>{if("string"==typeof t&&(t=qm[t]),!t)return!1;let r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r=t(e,i)!=Fc}finally{e.state.suppressEdits=!1}return r}))}(t,n,r,o,e)||(1==n?r?function(e,t,i,r){ic?setTimeout(Lc(yp,e),0):e.curOp.focus=Ac();let n,o=function(e,t,i){let r=e.getOption("configureMouse"),n=r?r(e,t,i):{};if(null==n.unit){let e=gc?i.shiftKey&&i.metaKey:i.altKey;n.unit=e?"rectangle":"single"==t?"char":"double"==t?"word":"line"}(null==n.extend||e.doc.extend)&&(n.extend=e.doc.extend||i.shiftKey);null==n.addNew&&(n.addNew=mc?i.metaKey:i.ctrlKey);null==n.moveOnDrag&&(n.moveOnDrag=!(mc?i.altKey:i.ctrlKey));return n}(e,i,r),s=e.doc.sel;e.options.dragDrop&&Su&&!e.isReadOnly()&&"single"==i&&(n=s.contains(t))>-1&&(Yu((n=s.ranges[n]).from(),t)<0||t.xRel>0)&&(Yu(n.to(),t)>0||t.xRel<0)?function(e,t,i,r){let n=e.display,o=!1,s=Wp(e,(t=>{nc&&(n.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:_p(e)),uu(n.wrapper.ownerDocument,"mouseup",s),uu(n.wrapper.ownerDocument,"mousemove",a),uu(n.scroller,"dragstart",l),uu(n.scroller,"drop",s),o||(gu(t),r.addNew||Uf(e.doc,i,null,null,r.extend),nc&&!cc||ic&&9==rc?setTimeout((()=>{n.wrapper.ownerDocument.body.focus({preventScroll:!0}),n.input.focus()}),20):n.input.focus())})),a=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},l=()=>o=!0;nc&&(n.scroller.draggable=!0);e.state.draggingText=s,s.copy=!r.moveOnDrag,lu(n.wrapper.ownerDocument,"mouseup",s),lu(n.wrapper.ownerDocument,"mousemove",a),lu(n.scroller,"dragstart",l),lu(n.scroller,"drop",s),e.state.delayingBlurEvent=!0,setTimeout((()=>n.input.focus()),20),n.scroller.dragDrop&&n.scroller.dragDrop()}(e,r,t,o):function(e,t,i,r){ic&&_p(e);let n=e.display,o=e.doc;gu(t);let s,a,l=o.sel,c=l.ranges;r.addNew&&!r.extend?(a=o.sel.contains(i),s=a>-1?c[a]:new yf(i,i)):(s=o.sel.primary(),a=o.sel.primIndex);if("rectangle"==r.unit)r.addNew||(s=new yf(i,i)),i=np(e,t,!0,!0),a=-1;else{let t=ag(e,i,r.unit);s=r.extend?Nf(s,t.anchor,t.head,r.extend):t}r.addNew?-1==a?(a=c.length,Wf(o,_f(e,c.concat([s]),a),{scroll:!1,origin:"*mouse"})):c.length>1&&c[a].empty()&&"char"==r.unit&&!r.extend?(Wf(o,_f(e,c.slice(0,a).concat(c.slice(a+1)),0),{scroll:!1,origin:"*mouse"}),l=o.sel):Gf(o,a,s,$c):(a=0,Wf(o,new gf([s],0),$c),l=o.sel);let u=i;function h(t){if(0!=Yu(u,t))if(u=t,"rectangle"==r.unit){let r=[],n=e.options.tabSize,s=Rc(Uu(o,i.line).text,i.ch,n),c=Rc(Uu(o,t.line).text,t.ch,n),u=Math.min(s,c),h=Math.max(s,c);for(let s=Math.min(i.line,t.line),a=Math.min(e.lastLine(),Math.max(i.line,t.line));s<=a;s++){let e=Uu(o,s).text,t=Uc(e,u,n);u==h?r.push(new yf(Ku(s,t),Ku(s,t))):e.length>t&&r.push(new yf(Ku(s,t),Ku(s,Uc(e,h,n))))}r.length||r.push(new yf(i,i)),Wf(o,_f(e,l.ranges.slice(0,a).concat(r),a),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{let i,n=s,c=ag(e,t,r.unit),u=n.anchor;Yu(c.anchor,u)>0?(i=c.head,u=th(n.from(),c.anchor)):(i=c.anchor,u=eh(n.to(),c.head));let h=l.ranges.slice(0);h[a]=function(e,t){let{anchor:i,head:r}=t,n=Uu(e.doc,i.line);if(0==Yu(i,r)&&i.sticky==r.sticky)return t;let o=su(n);if(!o)return t;let s=nu(o,i.ch,i.sticky),a=o[s];if(a.from!=i.ch&&a.to!=i.ch)return t;let l,c=s+(a.from==i.ch==(1!=a.level)?0:1);if(0==c||c==o.length)return t;if(r.line!=i.line)l=(r.line-i.line)*("ltr"==e.doc.direction?1:-1)>0;else{let e=nu(o,r.ch,r.sticky),t=e-s||(r.ch-i.ch)*(1==a.level?-1:1);l=e==c-1||e==c?t<0:t>0}let u=o[c+(l?-1:0)],h=l==(1==u.level),d=h?u.from:u.to,p=h?"after":"before";return i.ch==d&&i.sticky==p?t:new yf(new Ku(i.line,d,p),r)}(e,new yf(rh(o,u),i)),Wf(o,_f(e,h,a),$c)}}let d=n.wrapper.getBoundingClientRect(),p=0;function f(t){let i=++p,s=np(e,t,!0,"rectangle"==r.unit);if(s)if(0!=Yu(s,u)){e.curOp.focus=Ac(),h(s);let r=Tp(n,o);(s.line>=r.to||s.line<r.from)&&setTimeout(Wp(e,(()=>{p==i&&f(t)})),150)}else{let r=t.clientY<d.top?-20:t.clientY>d.bottom?20:0;r&&setTimeout(Wp(e,(()=>{p==i&&(n.scroller.scrollTop+=r,f(t))})),50)}}function m(t){e.state.selectingText=!1,p=1/0,t&&(gu(t),n.input.focus()),uu(n.wrapper.ownerDocument,"mousemove",g),uu(n.wrapper.ownerDocument,"mouseup",y),o.history.lastSelOrigin=null}let g=Wp(e,(e=>{0!==e.buttons&&bu(e)?f(e):m(e)})),y=Wp(e,m);e.state.selectingText=y,lu(n.wrapper.ownerDocument,"mousemove",g),lu(n.wrapper.ownerDocument,"mouseup",y)}(e,r,t,o)}(t,r,o,e):xu(e)==i.scroller&&gu(e):2==n?(r&&Uf(t.doc,r),setTimeout((()=>i.input.focus()),20)):3==n&&(xc?t.display.input.onContextMenu(e):_p(t)))}function ag(e,t,i){if("char"==i)return new yf(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new yf(Ku(t.line,0),rh(e.doc,Ku(t.line+1,0)));let r=i(e,t);return new yf(r.from,r.to)}function lg(e,t,i,r){let n,o;if(t.touches)n=t.touches[0].clientX,o=t.touches[0].clientY;else try{n=t.clientX,o=t.clientY}catch(t){return!1}if(n>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&gu(t);let s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!fu(e,i))return _u(t);o-=a.top-s.viewOffset;for(let r=0;r<e.display.gutterSpecs.length;++r){let a=s.gutters.childNodes[r];if(a&&a.getBoundingClientRect().right>=n){return hu(e,i,e,Wu(e.doc,o),e.display.gutterSpecs[r].className,t),_u(t)}}}function cg(e,t){return lg(e,t,"gutterClick",!0)}function ug(e,t){yd(e.display,t)||function(e,t){return!!fu(e,"gutterContextMenu")&&lg(e,t,"gutterContextMenu",!1)}(e,t)||du(e,t,"contextmenu")||xc||e.display.input.onContextMenu(t)}function hg(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Rd(e)}let dg={toString:function(){return"CodeMirror.Init"}},pg={},fg={};function mg(e,t,i){if(!t!=!(i&&i!=dg)){let i=e.display.dragFunctions,r=t?lu:uu;r(e.display.scroller,"dragstart",i.start),r(e.display.scroller,"dragenter",i.enter),r(e.display.scroller,"dragover",i.over),r(e.display.scroller,"dragleave",i.leave),r(e.display.scroller,"drop",i.drop)}}function gg(e){e.options.lineWrapping?(Ic(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Tc(e.display.wrapper,"CodeMirror-wrap"),Nh(e)),rp(e),sp(e),Rd(e),setTimeout((()=>Dp(e)),100)}function yg(e,t){if(!(this instanceof yg))return new yg(e,t);this.options=t=t?Dc(t):{},Dc(pg,t,!1);let i=t.value;"string"==typeof i?i=new Sm(i,t.mode,null,t.lineSeparator,t.direction):t.mode&&(i.modeOption=t.mode),this.doc=i;let r=new yg.inputStyles[t.inputStyle](this),n=this.display=new uf(e,i,r,t);n.wrapper.CodeMirror=this,hg(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Op(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Bc,keySeq:null,specialChars:null},t.autofocus&&!fc&&n.input.focus(),ic&&rc<11&&setTimeout((()=>this.display.input.reset(!0)),20),function(e){let t=e.display;lu(t.scroller,"mousedown",Wp(e,sg)),lu(t.scroller,"dblclick",ic&&rc<11?Wp(e,(t=>{if(du(e,t))return;let i=np(e,t);if(!i||cg(e,t)||yd(e.display,t))return;gu(t);let r=e.findWordAt(i);Uf(e.doc,r.anchor,r.head)})):t=>du(e,t)||gu(t));lu(t.scroller,"contextmenu",(t=>ug(e,t))),lu(t.input.getField(),"contextmenu",(i=>{t.scroller.contains(i.target)||ug(e,i)}));let i,r={end:0};function n(){t.activeTouch&&(i=setTimeout((()=>t.activeTouch=null),1e3),r=t.activeTouch,r.end=+new Date)}function o(e){if(1!=e.touches.length)return!1;let t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function s(e,t){if(null==t.left)return!0;let i=t.left-e.left,r=t.top-e.top;return i*i+r*r>400}lu(t.scroller,"touchstart",(n=>{if(!du(e,n)&&!o(n)&&!cg(e,n)){t.input.ensurePolled(),clearTimeout(i);let e=+new Date;t.activeTouch={start:e,moved:!1,prev:e-r.end<=300?r:null},1==n.touches.length&&(t.activeTouch.left=n.touches[0].pageX,t.activeTouch.top=n.touches[0].pageY)}})),lu(t.scroller,"touchmove",(()=>{t.activeTouch&&(t.activeTouch.moved=!0)})),lu(t.scroller,"touchend",(i=>{let r=t.activeTouch;if(r&&!yd(t,i)&&null!=r.left&&!r.moved&&new Date-r.start<300){let n,o=e.coordsChar(t.activeTouch,"page");n=!r.prev||s(r,r.prev)?new yf(o,o):!r.prev.prev||s(r,r.prev.prev)?e.findWordAt(o):new yf(Ku(o.line,0),rh(e.doc,Ku(o.line+1,0))),e.setSelection(n.anchor,n.head),e.focus(),gu(i)}n()})),lu(t.scroller,"touchcancel",n),lu(t.scroller,"scroll",(()=>{t.scroller.clientHeight&&(Ip(e,t.scroller.scrollTop),Pp(e,t.scroller.scrollLeft,!0),hu(e,"scroll",e))})),lu(t.scroller,"mousewheel",(t=>mf(e,t))),lu(t.scroller,"DOMMouseScroll",(t=>mf(e,t))),lu(t.wrapper,"scroll",(()=>t.wrapper.scrollTop=t.wrapper.scrollLeft=0)),t.dragFunctions={enter:t=>{du(e,t)||vu(t)},over:t=>{du(e,t)||(!function(e,t){let i=np(e,t);if(!i)return;let r=document.createDocumentFragment();pp(e,i,r),e.display.dragCursor||(e.display.dragCursor=Mc("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),Cc(e.display.dragCursor,r)}(e,t),vu(t))},start:t=>function(e,t){if(ic&&(!e.state.draggingText||+new Date-Cm<100))vu(t);else if(!du(e,t)&&!yd(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!cc)){let i=Mc("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",lc&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),lc&&i.parentNode.removeChild(i)}}(e,t),drop:Wp(e,Mm),leave:t=>{du(e,t)||km(e)}};let a=t.input.getField();lu(a,"keyup",(t=>tg.call(e,t))),lu(a,"keydown",Wp(e,eg)),lu(a,"keypress",Wp(e,ig)),lu(a,"focus",(t=>vp(e,t))),lu(a,"blur",(t=>xp(e,t)))}(this),Im(),jp(this),this.curOp.forceUpdate=!0,Af(this,i),t.autofocus&&!fc||this.hasFocus()?setTimeout((()=>{this.hasFocus()&&!this.state.focused&&vp(this)}),20):xp(this);for(let e in fg)fg.hasOwnProperty(e)&&fg[e](this,t[e],dg);sf(this),t.finishInit&&t.finishInit(this);for(let e=0;e<_g.length;++e)_g[e](this);$p(this),nc&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(n.lineDiv).textRendering&&(n.lineDiv.style.textRendering="auto")}yg.defaults=pg,yg.optionHandlers=fg;let _g=[];function vg(e,t,i,r){let n,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?n=ch(e,t).state:i="prev");let s=e.options.tabSize,a=Uu(o,t),l=Rc(a.text,null,s);a.stateAfter&&(a.stateAfter=null);let c,u=a.text.match(/^\s*/)[0];if(r||/\S/.test(a.text)){if("smart"==i&&(c=o.mode.indent(n,a.text.slice(u.length),a.text),c==Fc||c>150)){if(!r)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?Rc(Uu(o,t-1).text,null,s):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);let h="",d=0;if(e.options.indentWithTabs)for(let e=Math.floor(c/s);e;--e)d+=s,h+="\t";if(d<c&&(h+=Gc(c-d)),h!=u)return lm(o,h,Ku(t,0),Ku(t,u.length),"+input"),a.stateAfter=null,!0;for(let e=0;e<o.sel.ranges.length;e++){let i=o.sel.ranges[e];if(i.head.line==t&&i.head.ch<u.length){let i=Ku(t,u.length);Gf(o,e,new yf(i,i));break}}}yg.defineInitHook=e=>_g.push(e);let xg=null;function bg(e){xg=e}function wg(e,t,i,r,n){let o=e.doc;e.display.shift=!1,r||(r=o.sel);let s=+new Date-200,a="paste"==n||e.state.pasteIncoming>s,l=ku(t),c=null;if(a&&r.ranges.length>1)if(xg&&xg.text.join("\n")==t){if(r.ranges.length%xg.text.length==0){c=[];for(let e=0;e<xg.text.length;e++)c.push(o.splitLines(xg.text[e]))}}else l.length==r.ranges.length&&e.options.pasteLinesPerSelection&&(c=Zc(l,(e=>[e])));let u=e.curOp.updateInput;for(let t=r.ranges.length-1;t>=0;t--){let u=r.ranges[t],h=u.from(),d=u.to();u.empty()&&(i&&i>0?h=Ku(h.line,h.ch-i):e.state.overwrite&&!a?d=Ku(d.line,Math.min(Uu(o,d.line).text.length,d.ch+qc(l).length)):a&&xg&&xg.lineWise&&xg.text.join("\n")==l.join("\n")&&(h=d=Ku(h.line,0)));let p={from:h,to:d,text:c?c[t%c.length]:l,origin:n||(a?"paste":e.state.cutIncoming>s?"cut":"+input")};rm(e.doc,p),rd(e,"inputRead",e,p)}t&&!a&&Sg(e,t),Mp(e),e.curOp.updateInput<2&&(e.curOp.updateInput=u),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Tg(e,t){let i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||!t.hasFocus()||Zp(t,(()=>wg(t,i,0,null,"paste"))),!0}function Sg(e,t){if(!e.options.electricChars||!e.options.smartIndent)return;let i=e.doc.sel;for(let r=i.ranges.length-1;r>=0;r--){let n=i.ranges[r];if(n.head.ch>100||r&&i.ranges[r-1].head.line==n.head.line)continue;let o=e.getModeAt(n.head),s=!1;if(o.electricChars){for(let i=0;i<o.electricChars.length;i++)if(t.indexOf(o.electricChars.charAt(i))>-1){s=vg(e,n.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(Uu(e.doc,n.head.line).text.slice(0,n.head.ch))&&(s=vg(e,n.head.line,"smart"));s&&rd(e,"electricInput",e,n.head.line)}}function Cg(e){let t=[],i=[];for(let r=0;r<e.doc.sel.ranges.length;r++){let n=e.doc.sel.ranges[r].head.line,o={anchor:Ku(n,0),head:Ku(n+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function Mg(e,t,i,r){e.setAttribute("autocorrect",i?"":"off"),e.setAttribute("autocapitalize",r?"":"off"),e.setAttribute("spellcheck",!!t)}function kg(){let e=Mc("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=Mc("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return nc?e.style.width="1000px":e.setAttribute("wrap","off"),dc&&(e.style.border="1px solid black"),Mg(e),t}function Eg(e,t,i,r,n){let o=t,s=i,a=Uu(e,t.line),l=n&&"rtl"==e.direction?-i:i;function c(o){let s;if("codepoint"==r){let e=a.text.charCodeAt(t.ch+(i>0?0:-1));if(isNaN(e))s=null;else{let r=i>0?e>=55296&&e<56320:e>=56320&&e<57343;s=new Ku(t.line,Math.max(0,Math.min(a.text.length,t.ch+i*(r?2:1))),-i)}}else s=n?function(e,t,i,r){let n=su(t,e.doc.direction);if(!n)return Vm(t,i,r);i.ch>=t.text.length?(i.ch=t.text.length,i.sticky="before"):i.ch<=0&&(i.ch=0,i.sticky="after");let o=nu(n,i.ch,i.sticky),s=n[o];if("ltr"==e.doc.direction&&s.level%2==0&&(r>0?s.to>i.ch:s.from<i.ch))return Vm(t,i,r);let a,l=(e,i)=>Um(t,e instanceof Ku?e.ch:e,i),c=i=>e.options.lineWrapping?(a=a||kd(e,t),Wd(e,t,a,i)):{begin:0,end:t.text.length},u=c("before"==i.sticky?l(i,-1):i.ch);if("rtl"==e.doc.direction||1==s.level){let e=1==s.level==r<0,t=l(i,e?1:-1);if(null!=t&&(e?t<=s.to&&t<=u.end:t>=s.from&&t>=u.begin)){let r=e?"before":"after";return new Ku(i.line,t,r)}}let h=(e,t,r)=>{let o=(e,t)=>t?new Ku(i.line,l(e,1),"before"):new Ku(i.line,e,"after");for(;e>=0&&e<n.length;e+=t){let i=n[e],s=t>0==(1!=i.level),a=s?r.begin:l(r.end,-1);if(i.from<=a&&a<i.to)return o(a,s);if(a=s?i.from:l(i.to,-1),r.begin<=a&&a<r.end)return o(a,s)}},d=h(o+r,r,u);if(d)return d;let p=r>0?u.end:l(u.begin,-1);return null==p||r>0&&p==t.text.length||(d=h(r>0?0:n.length-1,r,c(p)),!d)?null:d}(e.cm,a,t,i):Vm(a,t,i);if(null==s){if(o||!function(){let i=t.line+l;return!(i<e.first||i>=e.first+e.size)&&(t=new Ku(i,t.ch,t.sticky),a=Uu(e,i))}())return!1;t=Gm(n,e.cm,a,t.line,l)}else t=s;return!0}if("char"==r||"codepoint"==r)c();else if("column"==r)c(!0);else if("word"==r||"group"==r){let n=null,o="group"==r,s=e.cm&&e.cm.getHelper(t,"wordChars");for(let e=!0;!(i<0)||c(!e);e=!1){let r=a.text.charAt(t.ch)||"\n",l=Yc(r,s)?"w":o&&"\n"==r?"n":!o||/\s/.test(r)?null:"p";if(!o||e||l||(l="s"),n&&n!=l){i<0&&(i=1,c(),t.sticky="after");break}if(l&&(n=l),i>0&&!c(!e))break}}let u=Qf(e,t,o,s,!0);return Ju(o,u)&&(u.hitSide=!0),u}function Ag(e,t,i,r){let n,o,s=e.doc,a=t.left;if("page"==r){let r=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),o=Math.max(r-.5*Jd(e.display),3);n=(i>0?t.bottom:t.top)+i*o}else"line"==r&&(n=i>0?t.bottom+3:t.top-3);for(;o=qd(e,a,n),o.outside;){if(i<0?n<=0:n>=s.height){o.hitSide=!0;break}n+=5*i}return o}class Ig{constructor(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Bc,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null}init(e){let t=this,i=t.cm,r=t.div=e.lineDiv;function n(e){for(let t=e.target;t;t=t.parentNode){if(t==r)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function o(e){if(!n(e)||du(i,e))return;if(i.somethingSelected())bg({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;{let t=Cg(i);bg({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation((()=>{i.setSelections(t.ranges,0,jc),i.replaceSelection("",null,"cut")}))}}if(e.clipboardData){e.clipboardData.clearData();let t=xg.text.join("\n");if(e.clipboardData.setData("Text",t),e.clipboardData.getData("Text")==t)return void e.preventDefault()}let o=kg(),s=o.firstChild;i.display.lineSpace.insertBefore(o,i.display.lineSpace.firstChild),s.value=xg.text.join("\n");let a=Ac();Pc(s),setTimeout((()=>{i.display.lineSpace.removeChild(o),a.focus(),a==r&&t.showPrimarySelection()}),50)}r.contentEditable=!0,Mg(r,i.options.spellcheck,i.options.autocorrect,i.options.autocapitalize),lu(r,"paste",(e=>{!n(e)||du(i,e)||Tg(e,i)||rc<=11&&setTimeout(Wp(i,(()=>this.updateFromDOM())),20)})),lu(r,"compositionstart",(e=>{this.composing={data:e.data,done:!1}})),lu(r,"compositionupdate",(e=>{this.composing||(this.composing={data:e.data,done:!1})})),lu(r,"compositionend",(e=>{this.composing&&(e.data!=this.composing.data&&this.readFromDOMSoon(),this.composing.done=!0)})),lu(r,"touchstart",(()=>t.forceCompositionEnd())),lu(r,"input",(()=>{this.composing||this.readFromDOMSoon()})),lu(r,"copy",o),lu(r,"cut",o)}screenReaderLabelChanged(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")}prepareSelection(){let e=dp(this.cm,!1);return e.focus=Ac()==this.div,e}showSelection(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))}getSelection(){return this.cm.display.wrapper.ownerDocument.getSelection()}showPrimarySelection(){let e=this.getSelection(),t=this.cm,i=t.doc.sel.primary(),r=i.from(),n=i.to();if(t.display.viewTo==t.display.viewFrom||r.line>=t.display.viewTo||n.line<t.display.viewFrom)return void e.removeAllRanges();let o=Lg(t,e.anchorNode,e.anchorOffset),s=Lg(t,e.focusNode,e.focusOffset);if(o&&!o.bad&&s&&!s.bad&&0==Yu(th(o,s),r)&&0==Yu(eh(o,s),n))return;let a=t.display.view,l=r.line>=t.display.viewFrom&&zg(t,r)||{node:a[0].measure.map[2],offset:0},c=n.line<t.display.viewTo&&zg(t,n);if(!c){let e=a[a.length-1].measure,t=e.maps?e.maps[e.maps.length-1]:e.map;c={node:t[t.length-1],offset:t[t.length-2]-t[t.length-3]}}if(!l||!c)return void e.removeAllRanges();let u,h=e.rangeCount&&e.getRangeAt(0);try{u=wc(l.node,l.offset,c.offset,c.node)}catch(e){}u&&(!Jl&&t.state.focused?(e.collapse(l.node,l.offset),u.collapsed||(e.removeAllRanges(),e.addRange(u))):(e.removeAllRanges(),e.addRange(u)),h&&null==e.anchorNode?e.addRange(h):Jl&&this.startGracePeriod()),this.rememberSelection()}startGracePeriod(){clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout((()=>{this.gracePeriod=!1,this.selectionChanged()&&this.cm.operation((()=>this.cm.curOp.selectionChanged=!0))}),20)}showMultipleSelections(e){Cc(this.cm.display.cursorDiv,e.cursors),Cc(this.cm.display.selectionDiv,e.selection)}rememberSelection(){let e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset}selectionInEditor(){let e=this.getSelection();if(!e.rangeCount)return!1;let t=e.getRangeAt(0).commonAncestorContainer;return Ec(this.div,t)}focus(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()&&Ac()==this.div||this.showSelection(this.prepareSelection(),!0),this.div.focus())}blur(){this.div.blur()}getField(){return this.div}supportsTouch(){return!0}receivedFocus(){let e=this;this.selectionInEditor()?setTimeout((()=>this.pollSelection()),20):Zp(this.cm,(()=>e.cm.curOp.selectionChanged=!0)),this.polling.set(this.cm.options.pollInterval,(function t(){e.cm.state.focused&&(e.pollSelection(),e.polling.set(e.cm.options.pollInterval,t))}))}selectionChanged(){let e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset}pollSelection(){if(null!=this.readDOMTimeout||this.gracePeriod||!this.selectionChanged())return;let e=this.getSelection(),t=this.cm;if(pc&&sc&&this.cm.display.gutterSpecs.length&&function(e){for(let t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(this.composing)return;this.rememberSelection();let i=Lg(t,e.anchorNode,e.anchorOffset),r=Lg(t,e.focusNode,e.focusOffset);i&&r&&Zp(t,(()=>{Wf(t.doc,vf(i,r),jc),(i.bad||r.bad)&&(t.curOp.selectionChanged=!0)}))}pollContent(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);let e,t,i,r=this.cm,n=r.display,o=r.doc.sel.primary(),s=o.from(),a=o.to();if(0==s.ch&&s.line>r.firstLine()&&(s=Ku(s.line-1,Uu(r.doc,s.line-1).length)),a.ch==Uu(r.doc,a.line).text.length&&a.line<r.lastLine()&&(a=Ku(a.line+1,0)),s.line<n.viewFrom||a.line>n.viewTo-1)return!1;s.line==n.viewFrom||0==(e=op(r,s.line))?(t=Zu(n.view[0].line),i=n.view[0].node):(t=Zu(n.view[e].line),i=n.view[e-1].node.nextSibling);let l,c,u=op(r,a.line);if(u==n.view.length-1?(l=n.viewTo-1,c=n.lineDiv.lastChild):(l=Zu(n.view[u+1].line)-1,c=n.view[u+1].node.previousSibling),!i)return!1;let h=r.doc.splitLines(function(e,t,i,r,n){let o="",s=!1,a=e.doc.lineSeparator(),l=!1;function c(e){return t=>t.id==e}function u(){s&&(o+=a,l&&(o+=a),s=l=!1)}function h(e){e&&(u(),o+=e)}function d(t){if(1==t.nodeType){let i=t.getAttribute("cm-text");if(i)return void h(i);let o,p=t.getAttribute("cm-marker");if(p){let t=e.findMarks(Ku(r,0),Ku(n+1,0),c(+p));return void(t.length&&(o=t[0].find(0))&&h(Vu(e.doc,o.from,o.to).join(a)))}if("false"==t.getAttribute("contenteditable"))return;let f=/^(pre|div|p|li|table|br)$/i.test(t.nodeName);if(!/^br$/i.test(t.nodeName)&&0==t.textContent.length)return;f&&u();for(let e=0;e<t.childNodes.length;e++)d(t.childNodes[e]);/^(pre|p)$/i.test(t.nodeName)&&(l=!0),f&&(s=!0)}else 3==t.nodeType&&h(t.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;d(t),t!=i;)t=t.nextSibling,l=!1;return o}(r,i,c,t,l)),d=Vu(r.doc,Ku(t,0),Ku(l,Uu(r.doc,l).text.length));for(;h.length>1&&d.length>1;)if(qc(h)==qc(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),t++}let p=0,f=0,m=h[0],g=d[0],y=Math.min(m.length,g.length);for(;p<y&&m.charCodeAt(p)==g.charCodeAt(p);)++p;let _=qc(h),v=qc(d),x=Math.min(_.length-(1==h.length?p:0),v.length-(1==d.length?p:0));for(;f<x&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)++f;if(1==h.length&&1==d.length&&t==s.line)for(;p&&p>s.ch&&_.charCodeAt(_.length-f-1)==v.charCodeAt(v.length-f-1);)p--,f++;h[h.length-1]=_.slice(0,_.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(p).replace(/\u200b+$/,"");let b=Ku(t,p),w=Ku(l,d.length?qc(d).length-f:0);return h.length>1||h[0]||Yu(b,w)?(lm(r.doc,h,b,w,"+input"),!0):void 0}ensurePolled(){this.forceCompositionEnd()}reset(){this.forceCompositionEnd()}forceCompositionEnd(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())}readFromDOMSoon(){null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout((()=>{if(this.readDOMTimeout=null,this.composing){if(!this.composing.done)return;this.composing=null}this.updateFromDOM()}),80))}updateFromDOM(){!this.cm.isReadOnly()&&this.pollContent()||Zp(this.cm,(()=>sp(this.cm)))}setUneditable(e){e.contentEditable="false"}onKeyPress(e){0==e.charCode||this.composing||(e.preventDefault(),this.cm.isReadOnly()||Wp(this.cm,wg)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))}readOnlyChanged(e){this.div.contentEditable=String("nocursor"!=e)}onContextMenu(){}resetPosition(){}}function zg(e,t){let i=Md(e,t.line);if(!i||i.hidden)return null;let r=Uu(e.doc,t.line),n=Sd(i,r,t.line),o=su(r,e.doc.direction),s="left";if(o){s=nu(o,t.ch)%2?"right":"left"}let a=zd(n.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function Pg(e,t){return t&&(e.bad=!0),e}function Lg(e,t,i){let r;if(t==e.display.lineDiv){if(r=e.display.lineDiv.childNodes[i],!r)return Pg(e.clipPos(Ku(e.display.viewTo-1)),!0);t=null,i=0}else for(r=t;;r=r.parentNode){if(!r||r==e.display.lineDiv)return null;if(r.parentNode&&r.parentNode==e.display.lineDiv)break}for(let n=0;n<e.display.view.length;n++){let o=e.display.view[n];if(o.node==r)return Dg(o,t,i)}}function Dg(e,t,i){let r=e.text.firstChild,n=!1;if(!t||!Ec(r,t))return Pg(Ku(Zu(e.line),0),!0);if(t==r&&(n=!0,t=r.childNodes[i],i=0,!t)){let t=e.rest?qc(e.rest):e.line;return Pg(Ku(Zu(t),t.text.length),n)}let o=3==t.nodeType?t:null,s=t;for(o||1!=t.childNodes.length||3!=t.firstChild.nodeType||(o=t.firstChild,i&&(i=o.nodeValue.length));s.parentNode!=r;)s=s.parentNode;let a=e.measure,l=a.maps;function c(t,i,r){for(let n=-1;n<(l?l.length:0);n++){let o=n<0?a.map:l[n];for(let s=0;s<o.length;s+=3){let a=o[s+2];if(a==t||a==i){let i=Zu(n<0?e.line:e.rest[n]),l=o[s]+r;return(r<0||a!=t)&&(l=o[s+(r?1:0)]),Ku(i,l)}}}}let u=c(o,s,i);if(u)return Pg(u,n);for(let e=s.nextSibling,t=o?o.nodeValue.length-i:0;e;e=e.nextSibling){if(u=c(e,e.firstChild,0),u)return Pg(Ku(u.line,u.ch-t),n);t+=e.textContent.length}for(let e=s.previousSibling,t=i;e;e=e.previousSibling){if(u=c(e,e.firstChild,-1),u)return Pg(Ku(u.line,u.ch+t),n);t+=e.textContent.length}}Ig.prototype.needsContentAttribute=!0;class Rg{constructor(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Bc,this.hasSelection=!1,this.composing=null}init(e){let t=this,i=this.cm;this.createField(e);const r=this.textarea;function n(e){if(!du(i,e)){if(i.somethingSelected())bg({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;{let n=Cg(i);bg({lineWise:!0,text:n.text}),"cut"==e.type?i.setSelections(n.ranges,null,jc):(t.prevInput="",r.value=n.text.join("\n"),Pc(r))}}"cut"==e.type&&(i.state.cutIncoming=+new Date)}}e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),dc&&(r.style.width="0px"),lu(r,"input",(()=>{ic&&rc>=9&&this.hasSelection&&(this.hasSelection=null),t.poll()})),lu(r,"paste",(e=>{du(i,e)||Tg(e,i)||(i.state.pasteIncoming=+new Date,t.fastPoll())})),lu(r,"cut",n),lu(r,"copy",n),lu(e.scroller,"paste",(n=>{if(yd(e,n)||du(i,n))return;if(!r.dispatchEvent)return i.state.pasteIncoming=+new Date,void t.focus();const o=new Event("paste");o.clipboardData=n.clipboardData,r.dispatchEvent(o)})),lu(e.lineSpace,"selectstart",(t=>{yd(e,t)||gu(t)})),lu(r,"compositionstart",(()=>{let e=i.getCursor("from");t.composing&&t.composing.range.clear(),t.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}})),lu(r,"compositionend",(()=>{t.composing&&(t.poll(),t.composing.range.clear(),t.composing=null)}))}createField(e){this.wrapper=kg(),this.textarea=this.wrapper.firstChild}screenReaderLabelChanged(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")}prepareSelection(){let e=this.cm,t=e.display,i=e.doc,r=dp(e);if(e.options.moveInputWithCursor){let n=Ud(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,n.top+s.top-o.top)),r.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,n.left+s.left-o.left))}return r}showSelection(e){let t=this.cm.display;Cc(t.cursorDiv,e.cursors),Cc(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")}reset(e){if(this.contextMenuPending||this.composing)return;let t=this.cm;if(t.somethingSelected()){this.prevInput="";let e=t.getSelection();this.textarea.value=e,t.state.focused&&Pc(this.textarea),ic&&rc>=9&&(this.hasSelection=e)}else e||(this.prevInput=this.textarea.value="",ic&&rc>=9&&(this.hasSelection=null))}getField(){return this.textarea}supportsTouch(){return!1}focus(){if("nocursor"!=this.cm.options.readOnly&&(!fc||Ac()!=this.textarea))try{this.textarea.focus()}catch(e){}}blur(){this.textarea.blur()}resetPosition(){this.wrapper.style.top=this.wrapper.style.left=0}receivedFocus(){this.slowPoll()}slowPoll(){this.pollingFast||this.polling.set(this.cm.options.pollInterval,(()=>{this.poll(),this.cm.state.focused&&this.slowPoll()}))}fastPoll(){let e=!1,t=this;t.pollingFast=!0,t.polling.set(20,(function i(){t.poll()||e?(t.pollingFast=!1,t.slowPoll()):(e=!0,t.polling.set(60,i))}))}poll(){let e=this.cm,t=this.textarea,i=this.prevInput;if(this.contextMenuPending||!e.state.focused||Eu(t)&&!i&&!this.composing||e.isReadOnly()||e.options.disableInput||e.state.keySeq)return!1;let r=t.value;if(r==i&&!e.somethingSelected())return!1;if(ic&&rc>=9&&this.hasSelection===r||mc&&/[\uf700-\uf7ff]/.test(r))return e.display.input.reset(),!1;if(e.doc.sel==e.display.selForContextMenu){let e=r.charCodeAt(0);if(8203!=e||i||(i="​"),8666==e)return this.reset(),this.cm.execCommand("undo")}let n=0,o=Math.min(i.length,r.length);for(;n<o&&i.charCodeAt(n)==r.charCodeAt(n);)++n;return Zp(e,(()=>{wg(e,r.slice(n),i.length-n,null,this.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?t.value=this.prevInput="":this.prevInput=r,this.composing&&(this.composing.range.clear(),this.composing.range=e.markText(this.composing.start,e.getCursor("to"),{className:"CodeMirror-composing"}))})),!0}ensurePolled(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)}onKeyPress(){ic&&rc>=9&&(this.hasSelection=null),this.fastPoll()}onContextMenu(e){let t=this,i=t.cm,r=i.display,n=t.textarea;t.contextMenuPending&&t.contextMenuPending();let o=np(i,e),s=r.scroller.scrollTop;if(!o||lc)return;i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(o)&&Wp(i,Wf)(i.doc,vf(o),jc);let a,l=n.style.cssText,c=t.wrapper.style.cssText,u=t.wrapper.offsetParent.getBoundingClientRect();function h(){if(null!=n.selectionStart){let e=i.somethingSelected(),o="​"+(e?n.value:"");n.value="⇚",n.value=o,t.prevInput=e?"":"​",n.selectionStart=1,n.selectionEnd=o.length,r.selForContextMenu=i.doc.sel}}function d(){if(t.contextMenuPending==d&&(t.contextMenuPending=!1,t.wrapper.style.cssText=c,n.style.cssText=l,ic&&rc<9&&r.scrollbars.setScrollTop(r.scroller.scrollTop=s),null!=n.selectionStart)){(!ic||ic&&rc<9)&&h();let e=0,o=()=>{r.selForContextMenu==i.doc.sel&&0==n.selectionStart&&n.selectionEnd>0&&"​"==t.prevInput?Wp(i,tm)(i):e++<10?r.detectingSelectAll=setTimeout(o,500):(r.selForContextMenu=null,r.input.reset())};r.detectingSelectAll=setTimeout(o,200)}}if(t.wrapper.style.cssText="position: static",n.style.cssText=`position: absolute; width: 30px; height: 30px;\n      top: ${e.clientY-u.top-5}px; left: ${e.clientX-u.left-5}px;\n      z-index: 1000; background: ${ic?"rgba(255, 255, 255, .05)":"transparent"};\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`,nc&&(a=window.scrollY),r.input.focus(),nc&&window.scrollTo(null,a),r.input.reset(),i.somethingSelected()||(n.value=t.prevInput=" "),t.contextMenuPending=d,r.selForContextMenu=i.doc.sel,clearTimeout(r.detectingSelectAll),ic&&rc>=9&&h(),xc){vu(e);let t=()=>{uu(window,"mouseup",t),setTimeout(d,20)};lu(window,"mouseup",t)}else setTimeout(d,50)}readOnlyChanged(e){e||this.reset(),this.textarea.disabled="nocursor"==e,this.textarea.readOnly=!!e}setUneditable(){}}Rg.prototype.needsContentAttribute=!1,function(e){let t=e.optionHandlers;function i(i,r,n,o){e.defaults[i]=r,n&&(t[i]=o?(e,t,i)=>{i!=dg&&n(e,t,i)}:n)}e.defineOption=i,e.Init=dg,i("value","",((e,t)=>e.setValue(t)),!0),i("mode",null,((e,t)=>{e.doc.modeOption=t,Sf(e)}),!0),i("indentUnit",2,Sf,!0),i("indentWithTabs",!1),i("smartIndent",!0),i("tabSize",4,(e=>{Cf(e),Rd(e),sp(e)}),!0),i("lineSeparator",null,((e,t)=>{if(e.doc.lineSep=t,!t)return;let i=[],r=e.doc.first;e.doc.iter((e=>{for(let n=0;;){let o=e.text.indexOf(t,n);if(-1==o)break;n=o+t.length,i.push(Ku(r,o))}r++}));for(let r=i.length-1;r>=0;r--)lm(e.doc,t,i[r],Ku(i[r].line,i[r].ch+t.length))})),i("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,((e,t,i)=>{e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=dg&&e.refresh()})),i("specialCharPlaceholder",Hh,(e=>e.refresh()),!0),i("electricChars",!0),i("inputStyle",fc?"contenteditable":"textarea",(()=>{throw new Error("inputStyle can not (yet) be changed in a running editor")}),!0),i("spellcheck",!1,((e,t)=>e.getInputField().spellcheck=t),!0),i("autocorrect",!1,((e,t)=>e.getInputField().autocorrect=t),!0),i("autocapitalize",!1,((e,t)=>e.getInputField().autocapitalize=t),!0),i("rtlMoveVisually",!yc),i("wholeLineUpdateBefore",!0),i("theme","default",(e=>{hg(e),cf(e)}),!0),i("keyMap","default",((e,t,i)=>{let r=$m(t),n=i!=dg&&$m(i);n&&n.detach&&n.detach(e,r),r.attach&&r.attach(e,n||null)})),i("extraKeys",null),i("configureMouse",null),i("lineWrapping",!1,gg,!0),i("gutters",[],((e,t)=>{e.display.gutterSpecs=af(t,e.options.lineNumbers),cf(e)}),!0),i("fixedGutter",!0,((e,t)=>{e.display.gutters.style.left=t?tp(e.display)+"px":"0",e.refresh()}),!0),i("coverGutterNextToScrollbar",!1,(e=>Dp(e)),!0),i("scrollbarStyle","native",(e=>{Op(e),Dp(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)}),!0),i("lineNumbers",!1,((e,t)=>{e.display.gutterSpecs=af(e.options.gutters,t),cf(e)}),!0),i("firstLineNumber",1,cf,!0),i("lineNumberFormatter",(e=>e),cf,!0),i("showCursorWhenSelecting",!1,hp,!0),i("resetSelectionOnContextMenu",!0),i("lineWiseCopyCut",!0),i("pasteLinesPerSelection",!0),i("selectionsMayTouch",!1),i("readOnly",!1,((e,t)=>{"nocursor"==t&&(xp(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)})),i("screenReaderLabel",null,((e,t)=>{t=""===t?null:t,e.display.input.screenReaderLabelChanged(t)})),i("disableInput",!1,((e,t)=>{t||e.display.input.reset()}),!0),i("dragDrop",!0,mg),i("allowDropFileTypes",null),i("cursorBlinkRate",530),i("cursorScrollMargin",0),i("cursorHeight",1,hp,!0),i("singleCursorHeightPerLine",!0,hp,!0),i("workTime",100),i("workDelay",100),i("flattenSpans",!0,Cf,!0),i("addModeClass",!1,Cf,!0),i("pollInterval",100),i("undoDepth",200,((e,t)=>e.doc.history.undoDepth=t)),i("historyEventDelay",1250),i("viewportMargin",10,(e=>e.refresh()),!0),i("maxHighlightLength",1e4,Cf,!0),i("moveInputWithCursor",!0,((e,t)=>{t||e.display.input.resetPosition()})),i("tabindex",null,((e,t)=>e.display.input.getField().tabIndex=t||"")),i("autofocus",null),i("direction","ltr",((e,t)=>e.doc.setDirection(t)),!0),i("phrases",null)}(yg),function(e){let t=e.optionHandlers,i=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,i){let r=this.options,n=r[e];r[e]==i&&"mode"!=e||(r[e]=i,t.hasOwnProperty(e)&&Wp(this,t[e])(this,i,n),hu(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"]($m(e))},removeKeyMap:function(e){let t=this.state.keyMaps;for(let i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:Hp((function(t,i){let r=t.token?t:e.getMode(this.options,t);if(r.startState)throw new Error("Overlays may not be stateful.");!function(e,t,i){let r=0,n=i(t);for(;r<e.length&&i(e[r])<=n;)r++;e.splice(r,0,t)}(this.state.overlays,{mode:r,modeSpec:t,opaque:i&&i.opaque,priority:i&&i.priority||0},(e=>e.priority)),this.state.modeGen++,sp(this)})),removeOverlay:Hp((function(e){let t=this.state.overlays;for(let i=0;i<t.length;++i){let r=t[i].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(i,1),this.state.modeGen++,void sp(this)}})),indentLine:Hp((function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Hu(this.doc,e)&&vg(this,e,t,i)})),indentSelection:Hp((function(e){let t=this.doc.sel.ranges,i=-1;for(let r=0;r<t.length;r++){let n=t[r];if(n.empty())n.head.line>i&&(vg(this,n.head.line,e,!0),i=n.head.line,r==this.doc.sel.primIndex&&Mp(this));else{let o=n.from(),s=n.to(),a=Math.max(i,o.line);i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(let t=a;t<i;++t)vg(this,t,e);let l=this.doc.sel.ranges;0==o.ch&&t.length==l.length&&l[r].from().ch>0&&Gf(this.doc,r,new yf(o,l[r].to()),jc)}}})),getTokenAt:function(e,t){return fh(this,e,t)},getLineTokens:function(e,t){return fh(this,Ku(e),t,!0)},getTokenTypeAt:function(e){e=rh(this.doc,e);let t,i=lh(this,Uu(this.doc,e.line)),r=0,n=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){let e=r+n>>1;if((e?i[2*e-1]:0)>=o)n=e;else{if(!(i[2*e+1]<o)){t=i[2*e+2];break}r=e+1}}let s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){let i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){let r=[];if(!i.hasOwnProperty(t))return r;let n=i[t],o=this.getModeAt(e);if("string"==typeof o[t])n[o[t]]&&r.push(n[o[t]]);else if(o[t])for(let e=0;e<o[t].length;e++){let i=n[o[t][e]];i&&r.push(i)}else o.helperType&&n[o.helperType]?r.push(n[o.helperType]):n[o.name]&&r.push(n[o.name]);for(let e=0;e<n._global.length;e++){let t=n._global[e];t.pred(o,this)&&-1==Oc(r,t.val)&&r.push(t.val)}return r},getStateAfter:function(e,t){let i=this.doc;return ch(this,(e=ih(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){let i,r=this.doc.sel.primary();return i=null==e?r.head:"object"==typeof e?rh(this.doc,e):e?r.from():r.to(),Ud(this,i,t||"page")},charCoords:function(e,t){return Nd(this,rh(this.doc,e),t||"page")},coordsChar:function(e,t){return qd(this,(e=$d(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=$d(this,{top:e,left:0},t||"page").top,Wu(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){let r,n=!1;if("number"==typeof e){let t=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>t&&(e=t,n=!0),r=Uu(this.doc,e)}else r=e;return jd(this,r,{top:0,left:0},t||"page",i||n).top+(n?this.doc.height-jh(r):0)},defaultTextHeight:function(){return Jd(this.display)},defaultCharWidth:function(){return Qd(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,r,n){let o=this.display,s=(e=Ud(this,rh(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==r)s=e.top;else if("above"==r||"near"==r){let i=Math.max(o.wrapper.clientHeight,this.doc.height),n=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>i)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=i&&(s=e.bottom),a+t.offsetWidth>n&&(a=n-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==n?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==n?a=0:"middle"==n&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&function(e,t){let i=Sp(e,t);null!=i.scrollTop&&Ip(e,i.scrollTop),null!=i.scrollLeft&&Pp(e,i.scrollLeft)}(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:Hp(eg),triggerOnKeyPress:Hp(ig),triggerOnKeyUp:tg,triggerOnMouseDown:Hp(sg),execCommand:function(e){if(qm.hasOwnProperty(e))return qm[e].call(null,this)},triggerElectric:Hp((function(e){Sg(this,e)})),findPosH:function(e,t,i,r){let n=1;t<0&&(n=-1,t=-t);let o=rh(this.doc,e);for(let e=0;e<t&&(o=Eg(this.doc,o,n,i,r),!o.hitSide);++e);return o},moveH:Hp((function(e,t){this.extendSelectionsBy((i=>this.display.shift||this.doc.extend||i.empty()?Eg(this.doc,i.head,e,t,this.options.rtlMoveVisually):e<0?i.from():i.to()),Nc)})),deleteH:Hp((function(e,t){let i=this.doc.sel,r=this.doc;i.somethingSelected()?r.replaceSelection("",null,"+delete"):Nm(this,(i=>{let n=Eg(r,i.head,e,t,!1);return e<0?{from:n,to:i.head}:{from:i.head,to:n}}))})),findPosV:function(e,t,i,r){let n=1,o=r;t<0&&(n=-1,t=-t);let s=rh(this.doc,e);for(let e=0;e<t;++e){let e=Ud(this,s,"div");if(null==o?o=e.left:e.left=o,s=Ag(this,e,n,i),s.hitSide)break}return s},moveV:Hp((function(e,t){let i=this.doc,r=[],n=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy((o=>{if(n)return e<0?o.from():o.to();let s=Ud(this,o.head,"div");null!=o.goalColumn&&(s.left=o.goalColumn),r.push(s.left);let a=Ag(this,s,e,t);return"page"==t&&o==i.sel.primary()&&Cp(this,Nd(this,a,"div").top-s.top),a}),Nc),r.length)for(let e=0;e<i.sel.ranges.length;e++)i.sel.ranges[e].goalColumn=r[e]})),findWordAt:function(e){let t=Uu(this.doc,e.line).text,i=e.ch,r=e.ch;if(t){let n=this.getHelper(e,"wordChars");"before"!=e.sticky&&r!=t.length||!i?++r:--i;let o=t.charAt(i),s=Yc(o,n)?e=>Yc(e,n):/\s/.test(o)?e=>/\s/.test(e):e=>!/\s/.test(e)&&!Yc(e);for(;i>0&&s(t.charAt(i-1));)--i;for(;r<t.length&&s(t.charAt(r));)++r}return new yf(Ku(e.line,i),Ku(e.line,r))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Ic(this.display.cursorDiv,"CodeMirror-overwrite"):Tc(this.display.cursorDiv,"CodeMirror-overwrite"),hu(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Ac()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Hp((function(e,t){kp(this,e,t)})),getScrollInfo:function(){let e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-bd(this)-this.display.barHeight,width:e.scrollWidth-bd(this)-this.display.barWidth,clientHeight:Td(this),clientWidth:wd(this)}},scrollIntoView:Hp((function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:Ku(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?function(e,t){Ep(e),e.curOp.scrollToPos=t}(this,e):Ap(this,e.from,e.to,e.margin)})),setSize:Hp((function(e,t){let i=e=>"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e;null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&Dd(this);let r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,(e=>{if(e.widgets)for(let t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){ap(this,r,"widget");break}++r})),this.curOp.forceUpdate=!0,hu(this,"refresh",this)})),operation:function(e){return Zp(this,e)},startOperation:function(){return jp(this)},endOperation:function(){return $p(this)},refresh:Hp((function(){let e=this.display.cachedTextHeight;sp(this),this.curOp.forceUpdate=!0,Rd(this),kp(this,this.doc.scrollLeft,this.doc.scrollTop),rf(this.display),(null==e||Math.abs(e-Jd(this.display))>.5||this.options.lineWrapping)&&rp(this),hu(this,"refresh",this)})),swapDoc:Hp((function(e){let t=this.doc;return t.cm=null,this.state.selectingText&&this.state.selectingText(),Af(this,e),Rd(this),this.display.input.reset(),kp(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,rd(this,"swapDoc",this,t),t})),phrase:function(e){let t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},mu(e),e.registerHelper=function(t,r,n){i.hasOwnProperty(t)||(i[t]=e[t]={_global:[]}),i[t][r]=n},e.registerGlobalHelper=function(t,r,n,o){e.registerHelper(t,r,o),i[t]._global.push({pred:n,val:o})}}(yg);let Bg="iter insert remove copy getEditor constructor".split(" ");for(let e in Sm.prototype)Sm.prototype.hasOwnProperty(e)&&Oc(Bg,e)<0&&(yg.prototype[e]=function(e){return function(){return e.apply(this.doc,arguments)}}(Sm.prototype[e]));function Og(e){let t;return{c(){t=w("div"),A(t,"class",e[0])},m(i,r){v(i,t,r),e[5](t)},p(e,[i]){1&i&&A(t,"class",e[0])},i:i,o:i,d(i){i&&x(t),e[5](null)}}}function Fg(e,t,i){let r,{class:n=""}=t,{editor:o=null}=t,{options:s={}}=t,{value:a}=t;function l(e){window&&r&&(o&&i(1,r.innerHTML="",r),i(2,o=yg(r,{...e,value:a})),o.on("change",(()=>{i(3,a=o.getValue())})))}return j((()=>l(s))),e.$$set=e=>{"class"in e&&i(0,n=e.class),"editor"in e&&i(2,o=e.editor),"options"in e&&i(4,s=e.options),"value"in e&&i(3,a=e.value)},e.$$.update=()=>{if(18&e.$$.dirty&&r&&l(s),12&e.$$.dirty&&o){const e=o.getCursor();o.setValue(a),o.setCursor(e)}20&e.$$.dirty&&o&&Object.entries(s).forEach((([e,t])=>{o.setOption(e,t)}))},[n,r,o,a,s,function(e){G[e?"unshift":"push"]((()=>{r=e,i(1,r)}))}]}mu(Sm),yg.inputStyles={textarea:Rg,contenteditable:Ig},yg.defineMode=function(e){yg.defaults.mode||"null"==e||(yg.defaults.mode=e),Lu.apply(this,arguments)},yg.defineMIME=function(e,t){Pu[e]=t},yg.defineMode("null",(()=>({token:e=>e.skipToEnd()}))),yg.defineMIME("text/plain","null"),yg.defineExtension=(e,t)=>{yg.prototype[e]=t},yg.defineDocExtension=(e,t)=>{Sm.prototype[e]=t},yg.fromTextArea=function(e,t){if((t=t?Dc(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){let i=Ac();t.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}function i(){e.value=n.getValue()}let r;if(e.form&&(lu(e.form,"submit",i),!t.leaveSubmitMethodAlone)){let t=e.form;r=t.submit;try{let e=t.submit=()=>{i(),t.submit=r,t.submit(),t.submit=e}}catch(e){}}t.finishInit=n=>{n.save=i,n.getTextArea=()=>e,n.toTextArea=()=>{n.toTextArea=isNaN,i(),e.parentNode.removeChild(n.getWrapperElement()),e.style.display="",e.form&&(uu(e.form,"submit",i),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=r))}},e.style.display="none";let n=yg((t=>e.parentNode.insertBefore(t,e.nextSibling)),t);return n},function(e){e.off=uu,e.on=lu,e.wheelEventPixels=ff,e.Doc=Sm,e.splitLines=ku,e.countColumn=Rc,e.findColumn=Uc,e.isWordChar=Kc,e.Pass=Fc,e.signal=hu,e.Line=Uh,e.changeEnd=xf,e.scrollbarModel=Bp,e.Pos=Ku,e.cmpPos=Yu,e.modes=zu,e.mimeModes=Pu,e.resolveMode=Du,e.getMode=Ru,e.modeExtensions=Bu,e.extendMode=Ou,e.copyState=Fu,e.startState=$u,e.innerMode=ju,e.commands=qm,e.keyMap=Lm,e.keyName=jm,e.isModifierKey=Om,e.lookupKey=Bm,e.normalizeKeyMap=Rm,e.StringStream=Nu,e.SharedTextMarker=xm,e.TextMarker=_m,e.LineWidget=mm,e.e_preventDefault=gu,e.e_stopPropagation=yu,e.e_stop=vu,e.addClass=Ic,e.contains=Ec,e.rmClass=Tc,e.keyNames=Pm}(yg),yg.version="5.65.5";class jg extends ve{constructor(e){super(),_e(this,e,Fg,Og,l,{class:0,editor:2,options:4,value:3})}}function $g(e,t,i){const r=e.slice();return r[13]=t[i],r}function Ng(e){let t,r,n,o,s;return r=new Ka({props:{icon:Na}}),{c(){t=w("button"),me(r.$$.fragment),A(t,"class","trash svelte-1b4qqgs")},m(i,a){v(i,t,a),ge(r,t,null),n=!0,o||(s=k(t,"click",e[5]),o=!0)},p:i,i(e){n||(ae(r.$$.fragment,e),n=!0)},o(e){le(r.$$.fragment,e),n=!1},d(e){e&&x(t),ye(r),o=!1,s()}}}function Ug(e){let t,i,r=e[13]+"";return{c(){t=w("div"),i=S(r),A(t,"class","error svelte-1b4qqgs")},m(e,r){v(e,t,r),_(t,i)},p(e,t){8&t&&r!==(r=e[13]+"")&&P(i,r)},d(e){e&&x(t)}}}function Vg(e){let t,i,r,n,o,s,a,l,c,u,h,d;function p(t){e[8](t)}function f(t){e[9](t)}let m={options:e[4],class:"editor"};void 0!==e[2]&&(m.editor=e[2]),void 0!==e[1]&&(m.value=e[1]),r=new jg({props:m}),G.push((()=>fe(r,"editor",p))),G.push((()=>fe(r,"value",f))),l=new Ka({props:{size:"2x",icon:e[3].length?Ua:Fa,color:e[3].length?"red":"green"}});let g=0!==e[0]&&Ng(e),y=e[3],T=[];for(let t=0;t<y.length;t+=1)T[t]=Ug($g(e,y,t));return{c(){t=w("div"),i=w("div"),me(r.$$.fragment),s=C(),a=w("div"),me(l.$$.fragment),u=C(),g&&g.c(),h=C();for(let e=0;e<T.length;e+=1)T[e].c();A(a,"class","icon svelte-1b4qqgs"),A(a,"title",c=e[3].length?"Layer is invalid":"Valid layer"),A(i,"class","container svelte-1b4qqgs")},m(e,n){v(e,t,n),_(t,i),ge(r,i,null),_(i,s),_(i,a),ge(l,a,null),_(i,u),g&&g.m(i,null),_(t,h);for(let e=0;e<T.length;e+=1)T[e].m(t,null);d=!0},p(e,[s]){const u={};!n&&4&s&&(n=!0,u.editor=e[2],J((()=>n=!1))),!o&&2&s&&(o=!0,u.value=e[1],J((()=>o=!1))),r.$set(u);const h={};if(8&s&&(h.icon=e[3].length?Ua:Fa),8&s&&(h.color=e[3].length?"red":"green"),l.$set(h),(!d||8&s&&c!==(c=e[3].length?"Layer is invalid":"Valid layer"))&&A(a,"title",c),0!==e[0]?g?(g.p(e,s),1&s&&ae(g,1)):(g=Ng(e),g.c(),ae(g,1),g.m(i,null)):g&&(oe(),le(g,1,1,(()=>{g=null})),se()),8&s){let i;for(y=e[3],i=0;i<y.length;i+=1){const r=$g(e,y,i);T[i]?T[i].p(r,s):(T[i]=Ug(r),T[i].c(),T[i].m(t,null))}for(;i<T.length;i+=1)T[i].d(1);T.length=y.length}},i(e){d||(ae(r.$$.fragment,e),ae(l.$$.fragment,e),ae(g),d=!0)},o(e){le(r.$$.fragment,e),le(l.$$.fragment,e),le(g),d=!1},d(e){e&&x(t),ye(r),ye(l),g&&g.d(),b(T,e)}}}function Gg(e,t,i){const r=$();let n,o,s,{routeLineLayer:a}=t,{index:l}=t,c=[];const u=e=>{const t={layout:e.layout||{},paint:e.paint||{}};i(1,n=JSON.stringify(t,null,2))};Xe.subscribe((e=>i(7,s=e)));return e.$$set=e=>{"routeLineLayer"in e&&i(6,a=e.routeLineLayer),"index"in e&&i(0,l=e.index)},e.$$.update=()=>{if(64&e.$$.dirty&&a&&u(a),66&e.$$.dirty){let e=n;try{e={...a,...JSON.parse(n)};const t=(e=>{const t={version:8,sources:{[e.source]:{data:{type:"FeatureCollection",features:[]},type:"geojson"}},layers:[e]};return dn(JSON.stringify(t))})(e);i(3,c=(e=>e.map((e=>{let t=e.message,[i,r]=t.split(":");return i=i.split(".").slice(1).join("."),`${i}: ${r}`})))(t))}catch(e){i(3,c=["JSON is invalid"])}}if(203&e.$$.dirty&&!c.length&&s&&n!==JSON.stringify({layout:a.layout||{},paint:a.paint||{}},null,2)){const e={...a,...JSON.parse(n)};r("setRouteLine",{index:l,layer:e})}76&e.$$.dirty&&o&&o.on("blur",(()=>{c.length&&u(a)}))},[l,n,o,c,{mode:"javascript",lineNumbers:!1,smartIndent:!0},()=>{r("deleteLayer",{index:l})},a,s,function(e){o=e,i(2,o)},function(e){n=e,i(1,n)}]}class qg extends ve{constructor(e){super(),_e(this,e,Gg,Vg,l,{routeLineLayer:6,index:0})}}function Zg(e){let t,r,n,o,s,a=e[4].find(e[8])?.text.toLowerCase()+"";return{c(){t=w("button"),r=S("Add a "),n=S(a),A(t,"class","primary-button svelte-1f3nuer")},m(i,a){v(i,t,a),_(t,r),_(t,n),o||(s=k(t,"click",e[6]),o=!0)},p(e,t){1&t&&a!==(a=e[4].find(e[8])?.text.toLowerCase()+"")&&P(n,a)},i:i,o:i,d(e){e&&x(t),o=!1,s()}}}function Wg(e){let t,i;return t=new qg({props:{routeLineLayer:e[1],index:Number(e[0])}}),t.$on("setRouteLine",e[2]),t.$on("deleteLayer",e[3]),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r={};2&i&&(r.routeLineLayer=e[1]),1&i&&(r.index=Number(e[0])),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Hg(e){let t,i,r,n,o,s,a;r=new ds({props:{titleText:"Route line layers",selectedId:e[0],items:e[4]}}),r.$on("select",e[5]);const l=[Wg,Zg],c=[];function u(e,t){return e[1]?0:1}return o=u(e),s=c[o]=l[o](e),{c(){t=w("div"),i=w("div"),me(r.$$.fragment),n=C(),s.c(),A(i,"class","dropdown-container svelte-1f3nuer")},m(e,s){v(e,t,s),_(t,i),ge(r,i,null),_(t,n),c[o].m(t,null),a=!0},p(e,[i]){const n={};1&i&&(n.selectedId=e[0]),r.$set(n);let a=o;o=u(e),o===a?c[o].p(e,i):(oe(),le(c[a],1,1,(()=>{c[a]=null})),se(),s=c[o],s?s.p(e,i):(s=c[o]=l[o](e),s.c()),ae(s,1),s.m(t,null))},i(e){a||(ae(r.$$.fragment,e),ae(s),a=!0)},o(e){le(r.$$.fragment,e),le(s),a=!1},d(e){e&&x(t),ye(r),c[o].d()}}}function Xg(e,t,i){let r,n,o,s="0";Je.subscribe((e=>{i(7,n=e)})),Xe.subscribe((e=>o=e));return e.$$.update=()=>{129&e.$$.dirty&&s&&i(1,r=n[Number(s)])},[s,r,e=>{const{index:t,layer:i}=e.detail;Je.update((e=>(e.splice(t,1,i),e)))},e=>{const{index:t}=e.detail;Je.update((e=>(e.splice(t,1),e)))},[{id:"0",text:"Route line"},{id:"1",text:"Route line casing"}],e=>{i(0,s=e.detail.selectedId)},()=>{Je.update((e=>{let t=e[e.length-1];return t={...t,id:`route-line-internal-mock-layer_${s}`},e.splice(Number(s),0,t),e})),vn(o)},n,e=>e.id===s]}class Kg extends ve{constructor(e){super(),_e(this,e,Xg,Hg,l,{})}}function Yg(e,t,i){const r=e.slice();return r[26]=t[i],r}function Jg(e){let t,i,r,n;i=new ds({props:{titleText:"Maneuvers",items:e[5],label:"Select a maneuver",selectedId:e[4]}}),i.$on("select",e[17]);let o=e[3]&&e[4]&&Qg(e);return{c(){t=w("div"),me(i.$$.fragment),r=C(),o&&o.c(),A(t,"class","option add-maneuver svelte-spkgz3")},m(e,s){v(e,t,s),ge(i,t,null),_(t,r),o&&o.m(t,null),n=!0},p(e,r){const n={};32&r&&(n.items=e[5]),16&r&&(n.selectedId=e[4]),i.$set(n),e[3]&&e[4]?o?(o.p(e,r),24&r&&ae(o,1)):(o=Qg(e),o.c(),ae(o,1),o.m(t,null)):o&&(oe(),le(o,1,1,(()=>{o=null})),se())},i(e){n||(ae(i.$$.fragment,e),ae(o),n=!0)},o(e){le(i.$$.fragment,e),le(o),n=!1},d(e){e&&x(t),ye(i),o&&o.d()}}}function Qg(e){let t,i,r,n,o,a,l,c,u,h,d,p,f,m;return i=new ra({props:{size:"sm",label:"pitch",value:e[2].pitch,step:Ue.pitch,min:0,max:85}}),i.$on("change",e[18]),o=new ra({props:{size:"sm",label:"zoom",value:e[2].zoom,step:Ue.zoom,min:0,max:24}}),o.$on("change",e[19]),{c(){t=w("div"),me(i.$$.fragment),r=C(),n=w("div"),me(o.$$.fragment),a=C(),l=w("div"),c=w("button"),u=S("Submit"),d=w("button"),d.textContent="Cancel",A(t,"class","number-input-container svelte-spkgz3"),A(n,"class","number-input-container svelte-spkgz3"),A(c,"class","button svelte-spkgz3"),c.disabled=e[7],A(c,"title",h=e[7]?"Settings must be different from the default":""),A(d,"class","button svelte-spkgz3"),A(l,"class","button-container svelte-spkgz3")},m(s,h){v(s,t,h),ge(i,t,null),v(s,r,h),v(s,n,h),ge(o,n,null),v(s,a,h),v(s,l,h),_(l,c),_(c,u),_(l,d),p=!0,f||(m=[k(c,"click",e[11]),k(d,"click",e[9])],f=!0)},p(e,t){const r={};4&t&&(r.value=e[2].pitch),i.$set(r);const n={};4&t&&(n.value=e[2].zoom),o.$set(n),(!p||128&t)&&(c.disabled=e[7]),(!p||128&t&&h!==(h=e[7]?"Settings must be different from the default":""))&&A(c,"title",h)},i(e){p||(ae(i.$$.fragment,e),ae(o.$$.fragment,e),p=!0)},o(e){le(i.$$.fragment,e),le(o.$$.fragment,e),p=!1},d(e){e&&x(t),ye(i),e&&x(r),e&&x(n),ye(o),e&&x(a),e&&x(l),f=!1,s(m)}}}function ey(e){let t;return{c(){t=w("div"),t.innerHTML='<div class="message svelte-spkgz3">Configured maneuvers will appear here</div>',A(t,"class","message-container svelte-spkgz3")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function ty(e){let t,i,r,n,o,a,l,c,u,h,d,p,f,m,g,y,b,T,M,E,I,z,L,D,B,O,F=e[26].name+"",j=(e[26].options.pitch??e[1])+"",$=(e[26].options.zoom??e[0])+"";function N(){return e[20](e[26])}function U(){return e[21](e[26])}return n=new Ka({props:{icon:ja}}),c=new Ka({props:{icon:Na}}),{c(){t=w("div"),i=w("div"),r=w("button"),me(n.$$.fragment),a=C(),l=w("button"),me(c.$$.fragment),h=C(),d=w("div"),p=S(F),f=C(),m=w("div"),g=S("Pitch: "),y=w("span"),b=S(j),T=C(),M=w("div"),E=S("Zoom: "),I=w("span"),z=S($),L=C(),A(r,"class","action-button svelte-spkgz3"),r.disabled=o=e[14](e[6],e[26]),A(l,"class","action-button svelte-spkgz3"),l.disabled=u=e[14](e[6],e[26]),A(i,"class","maneuver-actions svelte-spkgz3"),A(d,"class","bold svelte-spkgz3"),A(y,"class","code svelte-spkgz3"),A(I,"class","code svelte-spkgz3"),A(t,"class","set-maneuver svelte-spkgz3"),R(t,"disabled",e[14](e[6],e[26]))},m(e,o){v(e,t,o),_(t,i),_(i,r),ge(n,r,null),_(i,a),_(i,l),ge(c,l,null),_(t,h),_(t,d),_(d,p),_(t,f),_(t,m),_(m,g),_(m,y),_(y,b),_(t,T),_(t,M),_(M,E),_(M,I),_(I,z),_(t,L),D=!0,B||(O=[k(r,"click",N),k(l,"click",U)],B=!0)},p(i,n){e=i,(!D||64&n&&o!==(o=e[14](e[6],e[26])))&&(r.disabled=o),(!D||64&n&&u!==(u=e[14](e[6],e[26])))&&(l.disabled=u),(!D||64&n)&&F!==(F=e[26].name+"")&&P(p,F),(!D||66&n)&&j!==(j=(e[26].options.pitch??e[1])+"")&&P(b,j),(!D||65&n)&&$!==($=(e[26].options.zoom??e[0])+"")&&P(z,$),16448&n&&R(t,"disabled",e[14](e[6],e[26]))},i(e){D||(ae(n.$$.fragment,e),ae(c.$$.fragment,e),D=!0)},o(e){le(n.$$.fragment,e),le(c.$$.fragment,e),D=!1},d(e){e&&x(t),ye(n),ye(c),B=!1,s(O)}}}function iy(e){let t,i,r,n,o,s,a,l,c,u,h,d,p,f,m;s=new Ka({props:{icon:$a}});let g=e[3]&&Jg(e),y=!e[6].length&&ey(),T=e[6],M=[];for(let t=0;t<T.length;t+=1)M[t]=ty(Yg(e,T,t));const E=e=>le(M[e],1,1,(()=>{M[e]=null}));return{c(){t=w("div"),i=w("div"),r=S("Maneuver options: "),n=w("div"),o=w("button"),me(s.$$.fragment),a=S(" Add a maneuver config"),l=C(),g&&g.c(),c=S("\n  Configured maneuvers:\n  "),u=w("div"),h=w("div"),y&&y.c(),d=C();for(let e=0;e<M.length;e+=1)M[e].c();A(o,"class","button svelte-spkgz3"),o.disabled=e[3],A(i,"class","option svelte-spkgz3"),A(h,"class","scroll-window svelte-spkgz3"),A(u,"class","maneuver-list svelte-spkgz3"),A(t,"class","options svelte-spkgz3")},m(x,b){v(x,t,b),_(t,i),_(i,r),_(i,n),_(n,o),ge(s,o,null),_(o,a),_(t,l),g&&g.m(t,null),_(t,c),_(t,u),_(u,h),y&&y.m(h,null),_(h,d);for(let e=0;e<M.length;e+=1)M[e].m(h,null);p=!0,f||(m=k(o,"click",e[16]),f=!0)},p(e,[i]){if((!p||8&i)&&(o.disabled=e[3]),e[3]?g?(g.p(e,i),8&i&&ae(g,1)):(g=Jg(e),g.c(),ae(g,1),g.m(t,c)):g&&(oe(),le(g,1,1,(()=>{g=null})),se()),e[6].length?y&&(y.d(1),y=null):y||(y=ey(),y.c(),y.m(h,d)),28739&i){let t;for(T=e[6],t=0;t<T.length;t+=1){const r=Yg(e,T,t);M[t]?(M[t].p(r,i),ae(M[t],1)):(M[t]=ty(r),M[t].c(),ae(M[t],1),M[t].m(h,null))}for(oe(),t=T.length;t<M.length;t+=1)E(t);se()}},i(e){if(!p){ae(s.$$.fragment,e),ae(g);for(let e=0;e<T.length;e+=1)ae(M[e]);p=!0}},o(e){le(s.$$.fragment,e),le(g),M=M.filter(Boolean);for(let e=0;e<M.length;e+=1)le(M[e]);p=!1},d(e){e&&x(t),ye(s),g&&g.d(),y&&y.d(),b(M,e),f=!1,m()}}}function ry(e,t,i){const r=$();let n,{maneuverOptions:o}=t,{defaultZoom:s}=t,{defaultPitch:a}=t,l=!1;const c={zoom:s,pitch:a};let u=c,h=[{id:"*",text:"all maneuvers"}];h=h.concat(Ne.map((e=>({id:e,text:e}))));const d=()=>Object.keys(o).filter((e=>"*"===e||Ne.includes(e))).sort((e=>"*"===e?-1:1)).map((e=>({id:e,name:h.find((t=>t.id===e)).text,options:o[e]})));let p=d();const f=()=>Object.entries(u).every((e=>{const[t,i]=e;return c[t]===i}));let m=f();const g=e=>{i(4,n=e),i(2,u={...u,...o[n]??{}})},y=()=>{i(2,u=c),i(3,l=!1),i(4,n=void 0)},_=(e,t)=>{const r=`${Ue[e]??.1}`.split(".")[1]?.length??0;i(2,u[e]=Number(t.toFixed(r)),u)},v=e=>{i(3,l=!0),g(e)},x=e=>{const t=o;delete t[e],r("setManeuverOptions",t)};return e.$$set=e=>{"maneuverOptions"in e&&i(15,o=e.maneuverOptions),"defaultZoom"in e&&i(0,s=e.defaultZoom),"defaultPitch"in e&&i(1,a=e.defaultPitch)},e.$$.update=()=>{32768&e.$$.dirty&&o&&i(6,p=d()),4&e.$$.dirty&&u&&i(7,m=f())},[s,a,u,l,n,h,p,m,g,y,_,()=>{if(!m){const e={...o,[n]:u};r("setManeuverOptions",e)}y()},v,x,(e,t)=>e.some((e=>"*"===e.id))&&"*"!==t.id,o,()=>i(3,l=!0),e=>g(e.detail.selectedId),e=>_("pitch",e.detail),e=>_("zoom",e.detail),e=>v(e.id),e=>x(e.id)]}class ny extends ve{constructor(e){super(),_e(this,e,ry,iy,l,{maneuverOptions:15,defaultZoom:0,defaultPitch:1})}}function oy(e,t,i){const r=e.slice();return r[7]=t[i],r}function sy(e){let t,i,r,n;return i=new ra({props:{size:"sm",label:e[3]?.[e[7]]?.label??e[7].charAt(0).toUpperCase()+e[7].slice(1),value:e[1]?.[e[7]],min:e[3]?.[e[7]]?.min??0,max:e[3]?.[e[7]]?.max??1e3,step:Ue?.[e[7]]??1,disabled:e[0]}}),i.$on("change",(function(...t){return e[5](e[7],...t)})),{c(){t=w("div"),me(i.$$.fragment),r=C(),A(t,"class","number-input-container svelte-10niw6b")},m(e,o){v(e,t,o),ge(i,t,null),_(t,r),n=!0},p(t,r){e=t;const n={};2&r&&(n.value=e[1]?.[e[7]]),1&r&&(n.disabled=e[0]),i.$set(n)},i(e){n||(ae(i.$$.fragment,e),n=!0)},o(e){le(i.$$.fragment,e),n=!1},d(e){e&&x(t),ye(i)}}}function ay(e){let t,i,r=void 0!==e[1][e[7]]&&sy(e);return{c(){r&&r.c(),t=M()},m(e,n){r&&r.m(e,n),v(e,t,n),i=!0},p(e,i){void 0!==e[1][e[7]]?r?(r.p(e,i),2&i&&ae(r,1)):(r=sy(e),r.c(),ae(r,1),r.m(t.parentNode,t)):r&&(oe(),le(r,1,1,(()=>{r=null})),se())},i(e){i||(ae(r),i=!0)},o(e){le(r),i=!1},d(e){r&&r.d(e),e&&x(t)}}}function ly(e){let t,i,r,n,o=Object.keys(e[3]),s=[];for(let t=0;t<o.length;t+=1)s[t]=ay(oy(e,o,t));const a=e=>le(s[e],1,1,(()=>{s[e]=null}));return{c(){t=w("div"),i=S(e[2]),r=S(":\n  ");for(let e=0;e<s.length;e+=1)s[e].c();A(t,"class","option svelte-10niw6b")},m(e,o){v(e,t,o),_(t,i),_(t,r);for(let e=0;e<s.length;e+=1)s[e].m(t,null);n=!0},p(e,[r]){if((!n||4&r)&&P(i,e[2]),27&r){let i;for(o=Object.keys(e[3]),i=0;i<o.length;i+=1){const n=oy(e,o,i);s[i]?(s[i].p(n,r),ae(s[i],1)):(s[i]=ay(n),s[i].c(),ae(s[i],1),s[i].m(t,null))}for(oe(),i=o.length;i<s.length;i+=1)a(i);se()}},i(e){if(!n){for(let e=0;e<o.length;e+=1)ae(s[e]);n=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)le(s[e]);n=!1},d(e){e&&x(t),b(s,e)}}}function cy(e,t,i){let{disabled:r}=t;const n=$(),o={leadDistance:{label:"Maneuver lead distance",min:0,max:1e3},speed:{label:"Threshold (meters/second)",min:0,max:30},pitch:{min:0,max:85},zoom:{min:0,max:24}};let{routingOptions:s}=t,{title:a}=t;const l=(e,t)=>{n("setProperty",{property:e,value:t})};return e.$$set=e=>{"disabled"in e&&i(0,r=e.disabled),"routingOptions"in e&&i(1,s=e.routingOptions),"title"in e&&i(2,a=e.title)},[r,s,a,o,l,(e,t)=>l(e,t.detail)]}class uy extends ve{constructor(e){super(),_e(this,e,cy,ly,l,{disabled:0,routingOptions:1,title:2})}}function hy(e,t,i){const r=e.slice();return r[21]=t[i],r}function dy(e,t,i){const r=e.slice();return r[24]=t[i],r}function py(e,t,i){const r=e.slice();return r[21]=t[i],r}function fy(e,t,i){const r=e.slice();return r[21]=t[i],r}function my(e){let t,i,r,n,o,s,a=e[21]+"",l=e[3][e[21]]+"";return{c(){t=w("div"),i=S(a),r=S(": "),n=w("span"),o=S(l),s=C(),A(n,"class","code svelte-14zv50t"),A(t,"class","indent-1 svelte-14zv50t")},m(e,a){v(e,t,a),_(t,i),_(t,r),_(t,n),_(n,o),_(t,s)},p(e,t){8&t[0]&&a!==(a=e[21]+"")&&P(i,a),8&t[0]&&l!==(l=e[3][e[21]]+"")&&P(o,l)},d(e){e&&x(t)}}}function gy(e){let t,i,r,n=Object.keys(e[4]),o=[];for(let t=0;t<n.length;t+=1)o[t]=yy(py(e,n,t));return{c(){t=w("div"),i=w("span"),i.textContent="Speed options:",r=C();for(let e=0;e<o.length;e+=1)o[e].c();A(i,"class","bold svelte-14zv50t"),A(t,"class","section svelte-14zv50t")},m(e,n){v(e,t,n),_(t,i),_(t,r);for(let e=0;e<o.length;e+=1)o[e].m(t,null)},p(e,i){if(16&i[0]){let r;for(n=Object.keys(e[4]),r=0;r<n.length;r+=1){const s=py(e,n,r);o[r]?o[r].p(s,i):(o[r]=yy(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){e&&x(t),b(o,e)}}}function yy(e){let t,i,r,n,o,s,a=e[21]+"",l=e[4][e[21]]+"";return{c(){t=w("div"),i=S(a),r=S(": "),n=w("span"),o=S(l),s=C(),A(n,"class","code svelte-14zv50t"),A(t,"class","indent-1 svelte-14zv50t")},m(e,a){v(e,t,a),_(t,i),_(t,r),_(t,n),_(n,o),_(t,s)},p(e,t){16&t[0]&&a!==(a=e[21]+"")&&P(i,a),16&t[0]&&l!==(l=e[4][e[21]]+"")&&P(o,l)},d(e){e&&x(t)}}}function _y(e){let t,i,r,n=Object.keys(e[1]),o=[];for(let t=0;t<n.length;t+=1)o[t]=xy(hy(e,n,t));return{c(){t=w("div"),i=w("span"),i.textContent="Maneuver options:",r=C();for(let e=0;e<o.length;e+=1)o[e].c();A(i,"class","bold svelte-14zv50t"),A(t,"class","section svelte-14zv50t")},m(e,n){v(e,t,n),_(t,i),_(t,r);for(let e=0;e<o.length;e+=1)o[e].m(t,null)},p(e,i){if(2&i[0]){let r;for(n=Object.keys(e[1]),r=0;r<n.length;r+=1){const s=hy(e,n,r);o[r]?o[r].p(s,i):(o[r]=xy(s),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){e&&x(t),b(o,e)}}}function vy(e){let t,i,r,n,o,s=e[24]+"",a=e[1][e[21]][e[24]]+"";return{c(){t=w("div"),i=S(s),r=S(":\n                  "),n=w("span"),o=S(a),A(n,"class","code svelte-14zv50t"),A(t,"class","indent-2 svelte-14zv50t")},m(e,s){v(e,t,s),_(t,i),_(t,r),_(t,n),_(n,o)},p(e,t){2&t[0]&&s!==(s=e[24]+"")&&P(i,s),2&t[0]&&a!==(a=e[1][e[21]][e[24]]+"")&&P(o,a)},d(e){e&&x(t)}}}function xy(e){let t,i,r,n,o=e[21]+"",s=Object.keys(e[1][e[21]]),a=[];for(let t=0;t<s.length;t+=1)a[t]=vy(dy(e,s,t));return{c(){t=w("div"),i=S(o),r=S(": ");for(let e=0;e<a.length;e+=1)a[e].c();n=C(),A(t,"class","indent-1 svelte-14zv50t")},m(e,o){v(e,t,o),_(t,i),_(t,r);for(let e=0;e<a.length;e+=1)a[e].m(t,null);_(t,n)},p(e,r){if(2&r[0]&&o!==(o=e[21]+"")&&P(i,o),2&r[0]){let i;for(s=Object.keys(e[1][e[21]]),i=0;i<s.length;i+=1){const o=dy(e,s,i);a[i]?a[i].p(o,r):(a[i]=vy(o),a[i].c(),a[i].m(t,n))}for(;i<a.length;i+=1)a[i].d(1);a.length=s.length}},d(e){e&&x(t),b(a,e)}}}function by(e){let t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,b;return o=new la({props:{min:1,max:1e3,value:e[2],labelText:"Duration multiplier"}}),o.$on("change",e[15]),l=new uy({props:{title:"Routing options",routingOptions:e[3]}}),l.$on("setProperty",e[16]),h=new uy({props:{title:"Speed options",routingOptions:{...e[3],...e[4]},disabled:!e[6]}}),h.$on("setProperty",e[17]),f=new Oa({props:{labelA:"",labelB:"",size:"sm",toggled:e[6]}}),f.$on("toggle",e[18]),y=new ny({props:{maneuverOptions:e[0]||{},defaultPitch:e[3].pitch,defaultZoom:e[3].zoom}}),y.$on("setManeuverOptions",e[13]),{c(){t=w("div"),i=w("div"),r=w("div"),n=w("div"),me(o.$$.fragment),s=C(),a=w("div"),me(l.$$.fragment),c=C(),u=w("div"),me(h.$$.fragment),d=C(),p=w("div"),me(f.$$.fragment),m=C(),g=w("div"),me(y.$$.fragment),A(n,"class","number-input-container svelte-14zv50t"),A(r,"class","option svelte-14zv50t"),A(a,"class","option svelte-14zv50t"),A(p,"class","toggle-container svelte-14zv50t"),A(u,"class","option svelte-14zv50t"),A(i,"class","options svelte-14zv50t"),A(g,"class","options svelte-14zv50t"),A(t,"class","modal-container svelte-14zv50t")},m(e,x){v(e,t,x),_(t,i),_(i,r),_(r,n),ge(o,n,null),_(i,s),_(i,a),ge(l,a,null),_(i,c),_(i,u),ge(h,u,null),_(u,d),_(u,p),ge(f,p,null),_(t,m),_(t,g),ge(y,g,null),b=!0},p(e,t){const i={};4&t[0]&&(i.value=e[2]),o.$set(i);const r={};8&t[0]&&(r.routingOptions=e[3]),l.$set(r);const n={};24&t[0]&&(n.routingOptions={...e[3],...e[4]}),64&t[0]&&(n.disabled=!e[6]),h.$set(n);const s={};64&t[0]&&(s.toggled=e[6]),f.$set(s);const a={};1&t[0]&&(a.maneuverOptions=e[0]||{}),8&t[0]&&(a.defaultPitch=e[3].pitch),8&t[0]&&(a.defaultZoom=e[3].zoom),y.$set(a)},i(e){b||(ae(o.$$.fragment,e),ae(l.$$.fragment,e),ae(h.$$.fragment,e),ae(f.$$.fragment,e),ae(y.$$.fragment,e),b=!0)},o(e){le(o.$$.fragment,e),le(l.$$.fragment,e),le(h.$$.fragment,e),le(f.$$.fragment,e),le(y.$$.fragment,e),b=!1},d(e){e&&x(t),ye(o),ye(l),ye(h),ye(f),ye(y)}}}function wy(e){let t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,T,M,E,I,z,L=e[4]&&!e[9](e[4]),D=e[1]&&!e[7](e[1]),R=Object.keys(e[3]),B=[];for(let t=0;t<R.length;t+=1)B[t]=my(fy(e,R,t));let O=L&&gy(e),F=D&&_y(e);function j(t){e[19](t)}let $={modalHeading:"Camera behavior",passiveModal:!0,$$slots:{default:[by]},$$scope:{ctx:e}};return void 0!==e[5]&&($.open=e[5]),T=new zs({props:$}),G.push((()=>fe(T,"open",j))),{c(){t=w("div"),i=w("div"),r=w("div"),n=w("div"),o=w("span"),o.textContent="Duration multiplier:",s=C(),a=w("span"),l=S(e[2]),c=C(),u=w("div"),h=w("span"),h.textContent="Routing options:",d=C();for(let e=0;e<B.length;e+=1)B[e].c();p=C(),O&&O.c(),f=C(),F&&F.c(),m=C(),g=w("button"),g.textContent="Adjust camera behavior",y=C(),me(T.$$.fragment),A(o,"class","bold svelte-14zv50t"),A(a,"class","code svelte-14zv50t"),A(n,"class","section svelte-14zv50t"),A(h,"class","bold svelte-14zv50t"),A(u,"class","section svelte-14zv50t"),A(r,"class","window svelte-14zv50t"),A(i,"class","container svelte-14zv50t"),A(g,"class","primary-button svelte-14zv50t")},m(x,b){v(x,t,b),_(t,i),_(i,r),_(r,n),_(n,o),_(n,s),_(n,a),_(a,l),_(r,c),_(r,u),_(u,h),_(u,d);for(let e=0;e<B.length;e+=1)B[e].m(u,null);_(r,p),O&&O.m(r,null),_(r,f),F&&F.m(r,null),_(t,m),_(t,g),v(x,y,b),ge(T,x,b),E=!0,I||(z=k(g,"click",e[14]),I=!0)},p(e,t){if((!E||4&t[0])&&P(l,e[2]),8&t[0]){let i;for(R=Object.keys(e[3]),i=0;i<R.length;i+=1){const r=fy(e,R,i);B[i]?B[i].p(r,t):(B[i]=my(r),B[i].c(),B[i].m(u,null))}for(;i<B.length;i+=1)B[i].d(1);B.length=R.length}16&t[0]&&(L=e[4]&&!e[9](e[4])),L?O?O.p(e,t):(O=gy(e),O.c(),O.m(r,f)):O&&(O.d(1),O=null),2&t[0]&&(D=e[1]&&!e[7](e[1])),D?F?F.p(e,t):(F=_y(e),F.c(),F.m(r,null)):F&&(F.d(1),F=null);const i={};93&t[0]|1&t[1]&&(i.$$scope={dirty:t,ctx:e}),!M&&32&t[0]&&(M=!0,i.open=e[5],J((()=>M=!1))),T.$set(i)},i(e){E||(ae(T.$$.fragment,e),E=!0)},o(e){le(T.$$.fragment,e),E=!1},d(e){e&&x(t),b(B,e),O&&O.d(),F&&F.d(),e&&x(y),ye(T,e),I=!1,z()}}}function Ty(e,t,i){let r=1,n={},o={},s={},a={};const l=e=>Me.isObject(e)&&!Object.keys(e).length,c=e=>({speed:17,...e});it.subscribe((e=>{e.durationMultiplier&&i(2,r=e.durationMultiplier),e.routingOptions&&i(3,n=e.routingOptions),i(4,o=l(e?.speedOptions)?c(n):e?.speedOptions),i(0,s=e?.maneuverOptions)}));let u=!1,h=void 0!==o;const d=({property:e,value:t})=>{const i=`${Ue[e]??.1}`.split(".")[1]?.length??0,r={...n,[e]:Number(t.toFixed(i))};Object.entries(r).every((e=>{const[t,i]=e;return n?.[t]===i}))||it.update((e=>({...e,routingOptions:r})))},p=e=>Object.entries(e).every((e=>{const[t,i]=e;return c(n)?.[t]===i})),f=({property:e,value:t})=>{const i=`${Ue[e]??.1}`.split(".")[1]?.length??0,r={...o,[e]:Number(t.toFixed(i))},n=Object.entries(r).every((e=>{const[t,i]=e;return o?.[t]===i})),s=p(r);n||it.update((e=>s?{...e,speedOptions:{}}:{...e,speedOptions:r}))},m=e=>{it.update((t=>({...t,durationMultiplier:e})))},g=e=>{i(6,h=e),h||(i(4,o=c(n)),it.update((e=>({...e,speedOptions:{}}))))};return e.$$.update=()=>{3&e.$$.dirty[0]&&(i(1,a=JSON.parse(JSON.stringify(s))),Object.keys(a).includes("*")&&i(1,a={"all maneuvers":a["*"]}))},[s,a,r,n,o,u,h,l,d,p,f,m,g,e=>{let t=e.detail??{};it.update((e=>({...e,maneuverOptions:t})))},()=>i(5,u=!0),e=>m(e.detail),e=>d(e.detail),e=>f(e.detail),e=>g(e.detail.toggled),function(e){u=e,i(5,u)}]}class Sy extends ve{constructor(e){super(),_e(this,e,Ty,wy,l,{},null,[-1,-1])}}function Cy(e){let t,i,r,n,o,s,a,l,c,u,h,d,p,f,m,g,y,b,T,M,E,I,z,P,L,D,R,B;return s=new Oa({props:{labelA:"",labelB:"",size:"sm",toggled:e[5]}}),s.$on("toggle",e[10]),h=new Ea({props:{labelText:"Personal access token:",value:e[1],disabled:e[5]}}),h.$on("input",e[11]),f=new Ea({props:{labelText:"File key:",value:e[0],disabled:e[5]}}),f.$on("input",e[12]),y=new Ea({props:{labelText:"puck frame:",helperText:"Icon within frame must be named `puck`",value:e[2],disabled:e[5]}}),y.$on("input",e[13]),M=new Ea({props:{labelText:"destination-pin frame:",helperText:"Icon within frame must be named `destination-pin`",value:e[3],disabled:e[5]}}),M.$on("input",e[14]),{c(){t=w("div"),i=w("div"),r=S("Use default map assets\n      "),n=w("div"),o=w("div"),me(s.$$.fragment),a=C(),l=w("div"),l.textContent="Note: Figma link set via modal is not persisted via url. To persist on\n      refresh, it must be set in the config to protect your private keys.",c=C(),u=w("div"),me(h.$$.fragment),d=C(),p=w("div"),me(f.$$.fragment),m=C(),g=w("div"),me(y.$$.fragment),b=C(),T=w("div"),me(M.$$.fragment),E=C(),I=w("div"),z=w("button"),P=S("Submit"),A(o,"class","toggle-container svelte-e37ji8"),A(n,"class","default-toggle mb12 svelte-e37ji8"),A(i,"class","default-toggle-container svelte-e37ji8"),A(l,"class","mb12 svelte-e37ji8"),A(u,"class","mb12 svelte-e37ji8"),A(p,"class","mb12 svelte-e37ji8"),A(g,"class","mb12 svelte-e37ji8"),A(T,"class","mb12 svelte-e37ji8"),A(z,"class","primary-button svelte-e37ji8"),z.disabled=L=e[5]||e[6],A(I,"class","submit-button-container svelte-e37ji8"),A(t,"class","modal-container svelte-e37ji8")},m(x,w){v(x,t,w),_(t,i),_(i,r),_(i,n),_(n,o),ge(s,o,null),_(t,a),_(t,l),_(t,c),_(t,u),ge(h,u,null),_(t,d),_(t,p),ge(f,p,null),_(t,m),_(t,g),ge(y,g,null),_(t,b),_(t,T),ge(M,T,null),_(t,E),_(t,I),_(I,z),_(z,P),D=!0,R||(B=k(z,"click",e[15]),R=!0)},p(e,t){const i={};32&t&&(i.toggled=e[5]),s.$set(i);const r={};2&t&&(r.value=e[1]),32&t&&(r.disabled=e[5]),h.$set(r);const n={};1&t&&(n.value=e[0]),32&t&&(n.disabled=e[5]),f.$set(n);const o={};4&t&&(o.value=e[2]),32&t&&(o.disabled=e[5]),y.$set(o);const a={};8&t&&(a.value=e[3]),32&t&&(a.disabled=e[5]),M.$set(a),(!D||96&t&&L!==(L=e[5]||e[6]))&&(z.disabled=L)},i(e){D||(ae(s.$$.fragment,e),ae(h.$$.fragment,e),ae(f.$$.fragment,e),ae(y.$$.fragment,e),ae(M.$$.fragment,e),D=!0)},o(e){le(s.$$.fragment,e),le(h.$$.fragment,e),le(f.$$.fragment,e),le(y.$$.fragment,e),le(M.$$.fragment,e),D=!1},d(e){e&&x(t),ye(s),ye(h),ye(f),ye(y),ye(M),R=!1,B()}}}function My(e){let t,i,r,n,o,s,a,l;function c(t){e[16](t)}let u={modalHeading:"Figma link",size:"sm",passiveModal:!0,$$slots:{default:[Cy]},$$scope:{ctx:e}};return void 0!==e[4]&&(u.open=e[4]),n=new zs({props:u}),G.push((()=>fe(n,"open",c))),{c(){t=w("div"),i=w("button"),i.textContent="Figma link",r=C(),me(n.$$.fragment),A(i,"class","primary-button svelte-e37ji8")},m(o,c){v(o,t,c),_(t,i),v(o,r,c),ge(n,o,c),s=!0,a||(l=k(i,"click",e[9]),a=!0)},p(e,[t]){const i={};33554559&t&&(i.$$scope={dirty:t,ctx:e}),!o&&16&t&&(o=!0,i.open=e[4],J((()=>o=!1))),n.$set(i)},i(e){s||(ae(n.$$.fragment,e),s=!0)},o(e){le(n.$$.fragment,e),s=!1},d(e){e&&x(t),e&&x(r),ye(n,e),a=!1,l()}}}function ky(e,t,i){let r,n;Ge.subscribe((e=>({figmaLink:r}=e))),Xe.subscribe((e=>n=e));let o=!1,s=!1,a=r?.fileKey??null,l=r?.personalAccessToken??null,c=r?.puck??null,u=r?.["destination-pin"]??null,h=!1;const d=async e=>{const t=i=>{n.hasImage(e)?(n.removeImage(e),setTimeout((()=>t(i)),150)):i()};return new Promise((e=>t(e)))},p=()=>!!(a&&l&&c&&u),f=async e=>{if(i(5,s=e),s)(async()=>{const e=[{name:"puck",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA4CAYAAABZjWCTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAp9SURBVHgB5Vp7TFTZGf/mDczIQ6QsqIRawYKWKAJKuqvgK6atiXSF2uI7rs1Wk+1WGtFkVeKjWuu2UdvgglLFF9HEbaJ1/7CtxBRfa8362i5oQn3CqsibYV709x3uHYcRhnlcWHb3l5zcO3fu3Lm/8z3P9x2ibzA0NDBQyWPz5s3qqKgo9fjx49V3795VuXxHbucD8hJKPoePapejOiYmRmWz2dTPnj0TN4Ao4bwLpzwcLkNcY6hUqi5SAFryH+6ENC5DKw1NU1OTGu+rlu6h1tZWfnE7vSJlkz6LY1pamvydnQKEz5LjiRU/BPjl4+PjNbW1tbrQ0FBdc3OzISgoSId79J2dnXp8r8vMzAwfO3ZsaEpKyhsOh0PV0NDQXFdX13Ls2LHHVgD3WPEbq9lstgwbNqyzpaXFwkQnT55svX79ujwB4q/JR/hKTrYRIaHhw4fr8X56vFAwPgfrdLrgrVu3Tpk0aVJ2eHj4OKPRmKDVak19Pay9vb0GE1J969atSpC9UlVV9QxE2zUajbmtrc2MWwRR6pairLLkLXwhJ9QPUtBC1XSwGwM+h2AYlyxZMnbBggXz8V0eXmwY+YknT56cu3Llyt8KCwv/DZKtkGY7LnfguZZ79+4xQUHS2+d5S06Vm5urPnnypA7nhhAAsz4MpBJXrFjxLpzGj0hBYPJuVFRU7AZu4GMLRisGS9IG72vHcHjznH7JsSvHYDVkYqx+rGZh+PPlEyZMWOlJ7QIFbPPsoUOH/nzw4MFqk8nUAmfEkpRVVfa4fcJjnGMVLygo0MIR6GEDRlwKX7p0aXJJSckeOJIctVqtpwEECCWmp6fPDA4O/ryysrKBXoUP+ehROH1+ycTglrXwWDr8iQmzFrZ27doMkPuDwWB4gwYZd+7c+XDhwoWlFoulCR9bkpOTO3HN6ikmqjxcV48aNUr/6NEjI8hErFmzJgP2VTyQatgfqqurS+fNm/chThup2xY7IQRbXwTVvVwTzgNHHYgFw2uF5uTkJH3VxBiJiYkrT5069Q5OQ6FMIXBkOhBj0+pVSL3ZHOeAnF0E8UMWLVqUvG7duo8QwyJpCCA6Ojpz5MiRd86dO/cIpmKFdnUhVsp22APu5IQ64gEGiNuEAB2xb9++3yH7GE9DCGPGjEm7efPmJw8fPmwHMfaerpmME+5qyeS09fX1BsQx4+HDh3OR6L5FQwzs0LZt21ao1+vZTIIhPRbSaybmvMDeMSsrSz1ixAh27yGwsYSJEyeuoiEKThy2bNnCEx8C9TQgF+2bXFFRkerChQsaKeENgRP5qdIu/+rVq6QkZsyY8UscjI2NjYYXL15oOOEgF+fitDkQ4y/0yA1NSKuS5s6d+1slvePp06dp9erVNGXKFIJDICWAyY8ZPXr0Z+fPn38AghZwkJdLAk7JSWLVdXR0BE2fPj1TSak9fvyY9u7dS+nz3yMkxQQnQEpBkh6nhZzI93CQghyLE5mIBrGDVTI4KSnpJ6QgmNh3s1bSzFV/ImNcOsFRkVJADp84bdq0KJzq4fy0UowWEExllURqY1q2bFnirFmz1pJCYHUsP3mG3v7gY/E59vtT6cC2X1H29LcIzosCBee3CF0P8T+34eE7EKOdqimzVEdERGh5FY18UrGYJqvjL3b8y3ktLDqefpi/ieDKSSnExcWlwYy4GsDJh0quFgjvAnujly9fanBRi4VhGikEWR2ZkCvS5/+a6swhhOUMKQFUBFLh5XVYvWixWlFLJRBBrgv2Jgo4uEGLGxNIAfCL/7PqBr2Zv7nX73/8fhmVlJUL6QYKyfnpEO+4nuMMBUJyYCtXsFg1YyhA8Asjbeuhju5gaabM+43wnkogPz+f44tcfXNKjiS2QnpKhIDFixdT+sKi19TRHUqqZ2xsLNduVFwXleF0m3CpilR/2c40kQnixb3BzHf+KKQcqHrCnERhSnYmDCc5uFHCsoYCAb8gu322J28R/b2JiqgnQoI4Pn/+nJc+r9QSWTUfHHAyDpS+W8lPsDqyA+lPHd3xJkLDF//7kpBGkb8AObGeQ8xzFo6Et8SKW1xAEO+y2+1+kWN1HJ40m34wayn5A5b2+vXr/U7Nbt++/YSkEjwyLkFOtjPWx1CMKFR9iyMjI6f58Fyhjjk/XyG8o69Sc8U/PnqfksNe0oYNG8hXjBs3bhIOdRhcQOrEcAjJSUM0I1DCe+rDM8VM+6uO7mD1/PiTSp+XRlzExcJVLrs7uOzO14XNIdmUuyqWmpqaT314rvB0gaijKwzGcKGevq4ckF1Vw19wuUGU2+VqmCCHMrksOeuRI0e8njZ2ADzTPONKIS4li2LTc8WkeYv79+9/iuyqE+GApedczwmXKZXMebnDi9PvXLt2rRxJaKqnB7KdsTq+aGwjgymclEZTfS2Vl5dTRkaGx/vYu6Nryz6iHqWHxqdPn3JPQRB0bSBq0XbiJTtXvBbMnj37954eymqD1hUNJNCvI0yyx3tA5u9z5swpQGb1Jd6nFeZmkdVS7qx2Sd0Tbgaa0eSoys7ObvVUZuA/7e+PBwPFxcX7EcLaMUSJz7X67MxQQIwPrLOdFy9erEe+eZyGOLifd+LEifs47SCpveX6vWtpT/aYHCPad+7c+VdMhk9hYbBRWlr6Fxxa4EjMWJPaNm3a1KMw6yQnre/kxns7Yk3d2bNni2iIgpsiR48erUHdpwPmYcGa1K5y6ym7FzJZX5mcBS3blo0bN1588OBBBQ0xsEah27MXpy3o3XVgPWqTAnePfkFvXR4HKs9snGbuhUGP93FjnoYImNiOHTu4Es5Rvg29eSvXK3trY73W5eEJWL58eReae128kwIZiwUp2X8yMzOzA2nmKwGOaWVlZe/t37//M+rOITmmsYfvtUf+muQkte1CYLRDn9m5NCNr+XzXrl2rvkoHw8QOHDjw7u7du6/xOyFgs4fskxjD08pbLj1wJZcrumHo1SWhV1eCJDXgOosv4EnFBBfAg3Pey11Vbvx77KoyPJYVWEXxYw70ohKNYcJqPeLMmTOFMOKf0SCAM/49e/Z8AHL/JcnOqFti8p4U/8gxujftqEQfgbq7rZy1hCLvy+MW10BJkdUQC9BS5K9lWGU3wXvzIppVsc9mozu83mRDUukPAdPQ0NAgS9GEQPp2amrqSqVIMilk+RXbt28/cvnyZV5dt6Ia3mY0Gi2oGDAxeZuGVy/tFSQJcnVag4DJaiqrqhEkjTD2HG6g9Lea6AscbvDylUzq0qVL9dRtVzzkPWByD0Dx7VE97pe2SnEYkUkGSSMYTid+6tSpyQkJCZO5es1FXnepsoNgCfGmNjQNv8CzLhw/frwWmb0ZyzKzRKhTIsUB2i57cfIBftUp5dpgXl6eTJLtkTfj6FFg4h4fE9ZK1/koKtuQsEp6QQdiqA1krCDDGZFVImJBUdWKwGxDImFDcHZuMiU/oMROWWGPCPoaqJYaq4kem0phKxokAaIQhVRJBeIOXOvCNaFmsCcbygR2lBftUEvXnXle2dVgQuyYxazL4YNjpFBXDN4Uw1sYeQShm8RNeiFZqLmYDNdq8dcBrhu2hWq6NOUVKd9/a/F/5g6+kqbMKG8AAAAASUVORK5CYII="},{name:"destination-pin",path:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAA1CAYAAAAklDnhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANMSURBVHgBtVnBVRsxEB0JHphTnA7sCxgucQcsFSRUgNOBU4GdCkIqYFMBUAGbCuJceHCyqCDcbC7ezMiys+uspJFk//dg7dVI+/U1o5mVBQRg2um04eAgAyEyAXCO1zbe7qwNynKC915LgJ/4reg+PRXcsQXHaNrrdfAhQyHlFV7bwIdCUl+RUO4zdBIhBeTR0ahEEpAGLyErkenZWV8sFrdQlT4deTmff+kq9QocIi+93lUpxHXgMvCAfoRjX6I6ClxEjBK/YJcgMm9vF1VlZI0EOqVZjt1CiL5otb5Vb9WIoDw3EOITGKr4v6j8hWAwPTkZVp69BKoxMEQ4yDEKfjTtE2acEXAmRHvObNalJVoTUb3elNFZlVJedh8fJx47IjQ2hJwwYT2WplPGIgFwwSFBoMHR/rPPTgjxka7SfPvk66BJbIQcg0yOofrdPXDZpyDRRERZfgA38lASa8xmY+PULmQrRfouK1pHiAQ5IqYIryrSfLDvoEJMotX4h8LViH7yTurM6gCq8QKpmM+dDo5+9F76Zov+8wcS0ZTkNp+x2lmVzYjYQiJ0QeUAqa6JoDP9thnpSiwVrZYzGMgPl4pIWViN0JHNhpeCgbN1NitWUXPnsuNs1TbojA5w5TApyIc0EeOwymGcTY+PvbuvBWNXI7rFPV3XZQBlU1cHsbd3Q0UTBAArvZFHDfKPuxoR8NUT6CsYZg/VGsIGihJ1enpbetSA5SuH0nyqd7EUeMBLBn7oqhydfLLKxjpEMTpwZucY8kNOvUvZeVXZ79cahLjHWWfgR0cXUYsFkd8cnNQDJorVh1qpiGGUMzLltlDL6DUirEy5JWxmdNlgk8PuUWzmuP+IGIMCdoimrUJaDKMLIQZU0ztwIxHzmlDADmCbpAztkAhlOxGwEtmFKq7JydiOEVCu8xEnkW2q4puUkwhnACaU7/jKS2QbqnAm4yXCHcgBrxpsIimqcCfBIhIy4AZYagQRiVElhDybSOjAEKBGMJEQVUKXMohIwAOC1IgiQqr4Xj04R1bJRAzGjragXyWSiFAVZzsbi1EjmohG89lY9FlbNJGmij8lFcQrQpjPryuqxJ88phKpqpJaLuxDKlCV8vCw3X1+VpCAvyZEloGR0vYXAAAAAElFTkSuQmCC"}];for(const t of e)await d(t.name),n.loadImage(t.path,((e,i)=>{e?console.error(e):(n.addImage(t.name,i),Ke.update((e=>({...e,[t.name]:{name:t.name,url:t.path,width:i.width,height:i.height}}))))}))})();else{for(const e of Be)await d(e);p&&g()}},m=()=>({"destination-pin":u,puck:c,fileKey:a,personalAccessToken:l,scale:1}),g=()=>{if(!p())return;const e=m();Ge.update((t=>({...t,figmaLink:e}))),K(),et.set({loading:!0,helperText:"Loading assets"}),ft(n).then((e=>{Ke.update((t=>Object.keys(t).reduce(((t,i)=>(t[i]=e.find((e=>e.name===i))??null,t)),{}))),et.set({loading:!1})})).catch((e=>{et.set({loading:!1}),console.error(e)}))};return e.$$.update=()=>{15&e.$$.dirty&&a&&l&&c&&u&&i(6,h=!(()=>{const e=m();return Object.entries(e).some((e=>{const[t,i]=e;return r?.[t]!==i}))})())},[a,l,c,u,o,s,h,f,g,()=>i(4,o=!0),e=>f(e.detail.toggled),e=>i(1,l=e.detail),e=>i(0,a=e.detail),e=>i(2,c=e.detail),e=>i(3,u=e.detail),()=>{g(),i(4,o=!1)},function(e){o=e,i(4,o)}]}class Ey extends ve{constructor(e){super(),_e(this,e,ky,My,l,{})}}function Ay(e){let t,i,r,n,o,s;return i=new Fl({props:{setRouteFlag:e[1],routeFlag:e[0]}}),o=new Hl({props:{setRouteFlag:e[1],routeFlag:e[0]}}),{c(){t=w("div"),me(i.$$.fragment),r=C(),n=w("div"),me(o.$$.fragment),A(t,"class","control svelte-z0209z"),A(n,"class","control mt24 svelte-z0209z")},m(e,a){v(e,t,a),ge(i,t,null),v(e,r,a),v(e,n,a),ge(o,n,null),s=!0},p(e,t){const r={};2&t&&(r.setRouteFlag=e[1]),1&t&&(r.routeFlag=e[0]),i.$set(r);const n={};2&t&&(n.setRouteFlag=e[1]),1&t&&(n.routeFlag=e[0]),o.$set(n)},i(e){s||(ae(i.$$.fragment,e),ae(o.$$.fragment,e),s=!0)},o(e){le(i.$$.fragment,e),le(o.$$.fragment,e),s=!1},d(e){e&&x(t),ye(i),e&&x(r),e&&x(n),ye(o)}}}function Iy(e){let t,r,n;return r=new Kg({}),{c(){t=w("div"),me(r.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(r,t,null),n=!0},p:i,i(e){n||(ae(r.$$.fragment,e),n=!0)},o(e){le(r.$$.fragment,e),n=!1},d(e){e&&x(t),ye(r)}}}function zy(e){let t,r,n;return r=new Sy({}),{c(){t=w("div"),me(r.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(r,t,null),n=!0},p:i,i(e){n||(ae(r.$$.fragment,e),n=!0)},o(e){le(r.$$.fragment,e),n=!1},d(e){e&&x(t),ye(r)}}}function Py(e){let t,r,n;return r=new Ey({}),{c(){t=w("div"),me(r.$$.fragment),A(t,"class","control svelte-z0209z")},m(e,i){v(e,t,i),ge(r,t,null),n=!0},p:i,i(e){n||(ae(r.$$.fragment,e),n=!0)},o(e){le(r.$$.fragment,e),n=!1},d(e){e&&x(t),ye(r)}}}function Ly(e){let t,i,r,n,o,s,a,l;return t=new to({props:{title:"Route:",open:!0,$$slots:{default:[Ay]},$$scope:{ctx:e}}}),r=new to({props:{title:"Route-line:",open:!0,$$slots:{default:[Iy]},$$scope:{ctx:e}}}),o=new to({props:{title:"Camera behavior:",open:!0,$$slots:{default:[zy]},$$scope:{ctx:e}}}),a=new to({props:{title:"Map assets:",open:!0,$$slots:{default:[Py]},$$scope:{ctx:e}}}),{c(){me(t.$$.fragment),i=C(),me(r.$$.fragment),n=C(),me(o.$$.fragment),s=C(),me(a.$$.fragment)},m(e,c){ge(t,e,c),v(e,i,c),ge(r,e,c),v(e,n,c),ge(o,e,c),v(e,s,c),ge(a,e,c),l=!0},p(e,i){const n={};7&i&&(n.$$scope={dirty:i,ctx:e}),t.$set(n);const s={};4&i&&(s.$$scope={dirty:i,ctx:e}),r.$set(s);const l={};4&i&&(l.$$scope={dirty:i,ctx:e}),o.$set(l);const c={};4&i&&(c.$$scope={dirty:i,ctx:e}),a.$set(c)},i(e){l||(ae(t.$$.fragment,e),ae(r.$$.fragment,e),ae(o.$$.fragment,e),ae(a.$$.fragment,e),l=!0)},o(e){le(t.$$.fragment,e),le(r.$$.fragment,e),le(o.$$.fragment,e),le(a.$$.fragment,e),l=!1},d(e){ye(t,e),e&&x(i),ye(r,e),e&&x(n),ye(o,e),e&&x(s),ye(a,e)}}}function Dy(e){let t,i,r;return i=new Kn({props:{$$slots:{default:[Ly]},$$scope:{ctx:e}}}),{c(){t=w("div"),me(i.$$.fragment),A(t,"class","panel svelte-z0209z")},m(e,n){v(e,t,n),ge(i,t,null),r=!0},p(e,[t]){const r={};7&t&&(r.$$scope={dirty:t,ctx:e}),i.$set(r)},i(e){r||(ae(i.$$.fragment,e),r=!0)},o(e){le(i.$$.fragment,e),r=!1},d(e){e&&x(t),ye(i)}}}function Ry(e,t,i){let{routeFlag:r}=t,{setRouteFlag:n}=t;return e.$$set=e=>{"routeFlag"in e&&i(0,r=e.routeFlag),"setRouteFlag"in e&&i(1,n=e.setRouteFlag)},[r,n]}class By extends ve{constructor(e){super(),_e(this,e,Ry,Dy,l,{routeFlag:0,setRouteFlag:1})}}let Oy;Ge.subscribe((e=>({mapboxGlAccessToken:Oy}=e)));const Fy=e=>{if("string"!=typeof e)return!1;return e.startsWith("mapbox://styles/")&&5===e.split("/").length};function jy(e){let t,i,r,n,o,s,a,l,c,u,h;return i=new Ea({props:{placeholder:"Enter height...",value:e[4]??""}}),i.$on("input",e[18]),n=new Ea({props:{placeholder:"Enter width...",value:e[3]??""}}),n.$on("input",e[19]),{c(){t=w("div"),me(i.$$.fragment),r=C(),me(n.$$.fragment),o=C(),s=w("button"),a=S("Submit"),A(s,"class","submit-button svelte-k7mtpz"),s.disabled=l=!e[3]||!e[4],A(t,"class","custom-url-container svelte-k7mtpz")},m(l,d){v(l,t,d),ge(i,t,null),_(t,r),ge(n,t,null),_(t,o),_(t,s),_(s,a),c=!0,u||(h=k(s,"click",e[15]),u=!0)},p(e,t){const r={};16&t&&(r.value=e[4]??""),i.$set(r);const o={};8&t&&(o.value=e[3]??""),n.$set(o),(!c||24&t&&l!==(l=!e[3]||!e[4]))&&(s.disabled=l)},i(e){c||(ae(i.$$.fragment,e),ae(n.$$.fragment,e),c=!0)},o(e){le(i.$$.fragment,e),le(n.$$.fragment,e),c=!1},d(e){e&&x(t),ye(i),ye(n),u=!1,h()}}}function $y(e){let t,i,r,n,o,s,a,l,c,u;r=new Ea({props:{placeholder:"Enter map style url...",disabled:e[0],value:e[5]}}),r.$on("input",e[20]),r.$on("focus",e[21]);let h=e[6]&&Ny();return{c(){t=w("div"),i=w("div"),me(r.$$.fragment),n=C(),o=w("button"),o.textContent="Submit",s=C(),h&&h.c(),a=M(),A(o,"class","submit-button svelte-k7mtpz"),A(t,"class","custom-url-container svelte-k7mtpz")},m(d,p){v(d,t,p),_(t,i),ge(r,i,null),_(t,n),_(t,o),v(d,s,p),h&&h.m(d,p),v(d,a,p),l=!0,c||(u=k(o,"click",e[11]),c=!0)},p(e,t){const i={};1&t&&(i.disabled=e[0]),32&t&&(i.value=e[5]),r.$set(i),e[6]?h||(h=Ny(),h.c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i(e){l||(ae(r.$$.fragment,e),l=!0)},o(e){le(r.$$.fragment,e),l=!1},d(e){e&&x(t),ye(r),e&&x(s),h&&h.d(e),e&&x(a),c=!1,u()}}}function Ny(e){let t;return{c(){t=w("div"),t.textContent="Style not found",A(t,"class","error svelte-k7mtpz")},m(e,i){v(e,t,i)},d(e){e&&x(t)}}}function Uy(e){let t,i,r,n,o,s,a,l,c,u,h,d,p;n=new ds({props:{titleText:"Devices",selectedId:e[1],items:e[9],disabled:e[0]}}),n.$on("select",e[13]);let f="custom"===e[1]&&jy(e);l=new ds({props:{titleText:"Map styles",selectedId:e[8],items:e[10],disabled:e[0]}}),l.$on("select",e[12]);let m="custom"===e[8]&&$y(e);return d=new ds({props:{titleText:"Renderers",selectedId:e[2],items:e[7],disabled:e[0]}}),d.$on("select",e[14]),{c(){t=w("div"),i=w("div"),r=w("div"),me(n.$$.fragment),o=C(),f&&f.c(),s=C(),a=w("div"),me(l.$$.fragment),c=C(),m&&m.c(),u=C(),h=w("div"),me(d.$$.fragment),A(r,"class","dropdown svelte-k7mtpz"),A(a,"class","dropdown svelte-k7mtpz"),A(h,"class","dropdown svelte-k7mtpz"),A(i,"class","dropdown-container svelte-k7mtpz"),A(t,"class","panel svelte-k7mtpz")},m(e,g){v(e,t,g),_(t,i),_(i,r),ge(n,r,null),_(i,o),f&&f.m(i,null),_(i,s),_(i,a),ge(l,a,null),_(i,c),m&&m.m(i,null),_(i,u),_(i,h),ge(d,h,null),p=!0},p(e,[t]){const r={};2&t&&(r.selectedId=e[1]),1&t&&(r.disabled=e[0]),n.$set(r),"custom"===e[1]?f?(f.p(e,t),2&t&&ae(f,1)):(f=jy(e),f.c(),ae(f,1),f.m(i,s)):f&&(oe(),le(f,1,1,(()=>{f=null})),se());const o={};256&t&&(o.selectedId=e[8]),1&t&&(o.disabled=e[0]),l.$set(o),"custom"===e[8]?m?(m.p(e,t),256&t&&ae(m,1)):(m=$y(e),m.c(),ae(m,1),m.m(i,u)):m&&(oe(),le(m,1,1,(()=>{m=null})),se());const a={};4&t&&(a.selectedId=e[2]),128&t&&(a.items=e[7]),1&t&&(a.disabled=e[0]),d.$set(a)},i(e){p||(ae(n.$$.fragment,e),ae(f),ae(l.$$.fragment,e),ae(m),ae(d.$$.fragment,e),p=!0)},o(e){le(n.$$.fragment,e),le(f),le(l.$$.fragment,e),le(m),le(d.$$.fragment,e),p=!1},d(e){e&&x(t),ye(n),f&&f.d(),ye(l),m&&m.d(),ye(d)}}}function Vy(e,t,i){let r,n,{routeFlag:o}=t;Ge.subscribe((e=>{({devices:r}=e),({styles:n}=e)}));let s,a=r[0].width,l=r[0].height,c=r[0]?.id??"custom",u=null,h=null;Qe.subscribe((e=>{e&&(a=e.width,l=e.height,i(1,c=e.id),"custom"===c&&(i(3,u=a),i(4,h=l)))}));let d,p="",f="";const m=r.map((e=>({id:e.id,text:e.name}))).concat([{id:"custom",text:"Responsive"}]),g=n.map((e=>({id:e.id,text:e.name}))).concat([{id:"custom",text:"Custom URL"}]);let y,_=[{id:"mapbox-gl",text:"Mapbox GL"},{id:"maplibre-gl",text:"Maplibre GL"}],v=g?.[0]?.id;const x=async e=>{if(!e)return;let t=e;if(e.includes("localhost")){const[e,i]=t.split("localhost");e||(t=`http://localhost${i}`)}try{const e=await(async e=>{const t=Fy(e);let i=e;if(t){const[,,,e,t]=i.split("/");i=`https://api.mapbox.com/styles/v1/${e}/${t}?title=true&access_token=${Oy}`}const r=await fetch(i),n=await r.json();if(t&&n.message)throw new Error(n.message);return n})(t);if(e&&"object"==typeof e)return i(17,y.url=e,y),i(16,f=t),T(t),{status:"200",url:t}}catch(e){return i(6,d=new Error("Style was not found.")),{status:"404",url:t}}},b=e=>{Fy(e)?(i(7,_=[{id:"mapbox-gl",text:"Mapbox GL"}]),i(2,s="mapbox-gl")):i(7,_=[{id:"mapbox-gl",text:"Mapbox GL"},{id:"maplibre-gl",text:"Maplibre GL"}])},w=async()=>{const e=await x(p),{status:t,url:r}=e;if("200"===t){b(r);i(17,y={id:"custom",name:"Custom",type:"mapbox-gl",url:r})}};Ye.subscribe((e=>{if(y)return;i(17,y=e||n[0]),i(2,s=y?.renderer??y?.type);const t=y?.id??"custom";i(8,v=t),"custom"===t&&(i(5,p=e?.url),w())}));const T=e=>{const t=e=>e&&e.includes("localhost")&&f===e;t(e)&&setTimeout((()=>t(e)&&x(e)),3e3)};return e.$$set=e=>{"routeFlag"in e&&i(0,o=e.routeFlag)},e.$$.update=()=>{if(196608&e.$$.dirty&&y){const e="string"==typeof y?.url?y.url:f;i(2,s=y?.renderer??y?.type),Ye.set({...y,url:e})}},[o,c,s,u,h,p,d,_,v,m,g,w,e=>{const{selectedId:t}=e.detail;if(i(8,v=t),"custom"===t)return i(5,p=y.url),void i(6,d="");i(5,p=""),i(16,f=""),i(6,d="");const r=n.find((e=>e.id===t));i(17,y=r),b(y?.url)},e=>{const{selectedId:t}=e.detail;if(i(1,c=t),"custom"===t)return i(3,u=a),void i(4,h=l);i(3,u=null),i(4,h=null);const n=r.find((e=>e.id===t));a=n.width,l=n.height,Qe.set(n)},e=>{const{selectedId:t}=e.detail;i(17,y={...y,renderer:t})},()=>{const e={id:"custom",width:Number(u),height:Number(h)};a=e.width,l=e.height,Qe.set(e)},f,y,e=>i(4,h=e.detail),e=>i(3,u=e.detail),e=>i(5,p=e.detail),()=>i(6,d="")]}class Gy extends ve{constructor(e){super(),_e(this,e,Vy,Uy,l,{routeFlag:0})}}function qy(e){let t;return{c(){t=w("div"),A(t,"class","circle svelte-14upwad"),D(t,"--size",e[3]+e[1]),D(t,"--color",e[0]),D(t,"--duration",e[2])},m(e,i){v(e,t,i)},p(e,[i]){10&i&&D(t,"--size",e[3]+e[1]),1&i&&D(t,"--color",e[0]),4&i&&D(t,"--duration",e[2])},i:i,o:i,d(e){e&&x(t)}}}function Zy(e,t,i){let{color:r="#FF3E00"}=t,{unit:n="px"}=t,{duration:o="0.75s"}=t,{size:s="60"}=t;return e.$$set=e=>{"color"in e&&i(0,r=e.color),"unit"in e&&i(1,n=e.unit),"duration"in e&&i(2,o=e.duration),"size"in e&&i(3,s=e.size)},[r,n,o,s]}class Wy extends ve{constructor(e){super(),_e(this,e,Zy,qy,l,{color:0,unit:1,duration:2,size:3})}}function Hy(e){let t,i,r,n,o,s,a;return r=new Wy({props:{size:"100",color:"white",unit:"px"}}),{c(){t=w("div"),i=w("div"),me(r.$$.fragment),n=C(),o=w("div"),s=S(e[0]),A(o,"class","text svelte-17kqyn2"),A(i,"class","container svelte-17kqyn2"),A(t,"class","loader svelte-17kqyn2")},m(e,l){v(e,t,l),_(t,i),ge(r,i,null),_(i,n),_(i,o),_(o,s),a=!0},p(e,[t]){(!a||1&t)&&P(s,e[0])},i(e){a||(ae(r.$$.fragment,e),a=!0)},o(e){le(r.$$.fragment,e),a=!1},d(e){e&&x(t),ye(r)}}}function Xy(e,t,i){let{helperText:r}=t;return e.$$set=e=>{"helperText"in e&&i(0,r=e.helperText)},[r]}class Ky extends ve{constructor(e){super(),_e(this,e,Xy,Hy,l,{helperText:0})}}function Yy(e){let t,i;return t=new Ky({props:{helperText:e[0].helperText||null}}),{c(){me(t.$$.fragment)},m(e,r){ge(t,e,r),i=!0},p(e,i){const r={};1&i&&(r.helperText=e[0].helperText||null),t.$set(r)},i(e){i||(ae(t.$$.fragment,e),i=!0)},o(e){le(t.$$.fragment,e),i=!1},d(e){ye(t,e)}}}function Jy(e){let t,i,r,n,o,s,a,l,c,u;n=new By({props:{setRouteFlag:e[2],routeFlag:e[1]}}),s=new kn({props:{routeFlag:e[1]}}),l=new Gy({props:{routeFlag:e[1]}});let h=e[0].loading&&Yy(e);return{c(){t=w("base"),i=C(),r=w("main"),me(n.$$.fragment),o=C(),me(s.$$.fragment),a=C(),me(l.$$.fragment),c=C(),h&&h.c(),A(t,"href","/"),A(r,"class","svelte-2y1l8u")},m(e,d){_(document.head,t),v(e,i,d),v(e,r,d),ge(n,r,null),_(r,o),ge(s,r,null),_(r,a),ge(l,r,null),_(r,c),h&&h.m(r,null),u=!0},p(e,[t]){const i={};2&t&&(i.routeFlag=e[1]),n.$set(i);const o={};2&t&&(o.routeFlag=e[1]),s.$set(o);const a={};2&t&&(a.routeFlag=e[1]),l.$set(a),e[0].loading?h?(h.p(e,t),1&t&&ae(h,1)):(h=Yy(e),h.c(),ae(h,1),h.m(r,null)):h&&(oe(),le(h,1,1,(()=>{h=null})),se())},i(e){u||(ae(n.$$.fragment,e),ae(s.$$.fragment,e),ae(l.$$.fragment,e),ae(h),u=!0)},o(e){le(n.$$.fragment,e),le(s.$$.fragment,e),le(l.$$.fragment,e),le(h),u=!1},d(e){x(t),e&&x(i),e&&x(r),ye(n),ye(s),ye(l),h&&h.d()}}}function Qy(e,t,i){let{localConfig:r}=t;const n=(e=>{const t={leadDistance:125,pitch:60,zoom:16,...e?.routingOptions||{}};let i=JSON.parse(JSON.stringify(e));return i?.routingOptions&&delete i.routingOptions,e.directionsApiCall&&(i={...i,directionsApiCall:e.directionsApiCall}),{devices:[{id:"google-pixel",name:"Google Pixel",height:732,width:412},{id:"iphone-13",name:"iPhone 13",height:844,width:390}],styles:[{id:"mapbox-streets",name:"Mapbox Streets",type:"mapbox-gl",url:"mapbox://styles/mapbox/streets-v11"},{id:"mapbox-outdoors",name:"Mapbox Outdoors",type:"mapbox-gl",url:"mapbox://styles/mapbox/outdoors-v11"},{id:"mapbox-light",name:"Mapbox Light",type:"mapbox-gl",url:"mapbox://styles/mapbox/light-v10"},{id:"mapbox-dark",name:"Mapbox Dark",type:"mapbox-gl",url:"mapbox://styles/mapbox/dark-v10"}],mapState:{bearing:0,center:{lng:-73.92169,lat:40.83962},pitch:0,zoom:13.25},durationMultiplier:50,routingOptions:t,...i}})(r);Ge.set(n);let o,s=null,a=null,l=null,c=null,u=!0;it.subscribe((e=>{if(i(4,s=null),i(5,a=null),i(6,l=null),i(7,c=null),u){u=!1;const t=Me.cloneDeep({durationMultiplier:n.durationMultiplier??{},routingOptions:n.routingOptions??{},speedOptions:n.speedOptions??{},maneuverOptions:n.maneuverOptions??{}});let i=Me.assign(t,e);it.set(i)}else{const t=e=>Me.isObject(e)&&!Object.keys(e).length;if(e.durationMultiplier!==n.durationMultiplier&&i(4,s=e.durationMultiplier??null),Me.isEqual(e?.routingOptions,n.routingOptions)||i(5,a=e.routingOptions),!Me.isEqual(e?.speedOptions,n.speedOptions)){const r=t(e.speedOptions)&&!n.speedOptions;i(6,l=r?null:e.speedOptions)}if(!Me.isEqual(e?.maneuverOptions,n.maneuverOptions)){const r=t(e.maneuverOptions)&&!n.maneuverOptions;i(7,c=r?null:e.maneuverOptions)}}})),He.subscribe((e=>{e&&Object.keys(e).length?i(8,o=e):He.set(n.mapState)}));let h=null;Ze.subscribe((e=>{const{locations:t}=e;i(9,h=t&&t.every((e=>null!==e.center))?t:null)}));let d=null;Je.subscribe((e=>{const t=e.map((e=>({layout:e.layout,paint:e.paint}))),r=e.map((()=>$e));JSON.stringify(r)!==JSON.stringify(t)?i(10,d=t):i(10,d=null)}));let p=null;Ye.subscribe((e=>{i(11,p=e||null)}));let f=null;Qe.subscribe((e=>{i(12,f=e??null)}));let m,g={loading:!1};et.subscribe((e=>i(0,g=e))),Xe.subscribe((e=>m=e));let y=!1;return e.$$set=e=>{"localConfig"in e&&i(3,r=e.localConfig)},e.$$.update=()=>{8176&e.$$.dirty&&(o||h||d||p||f||s||a||l||c)&&Pe({locations:h,routeLines:d,styleUrl:p,deviceSize:f,durationMultiplier:s,routingOptions:a,speedOptions:l,maneuverOptions:c,...o})},[g,y,e=>{i(1,y=e),m&&!y&&m.once("move",(()=>{m.getLayer("destination-pin")&&_n(m,"destination-pin"),m.getLayer(Re)&&_n(m,Re)}))},r,s,a,l,c,o,h,d,p,f]}class e_ extends ve{constructor(e){super(),_e(this,e,Qy,Jy,l,{localConfig:3})}}const t_=(e,t)=>new e_({target:e,props:t});var i_=Object.freeze({__proto__:null}),r_=Object.freeze({__proto__:null});export{t_ as startApp};
//# sourceMappingURL=bundle.js.map
